{"version":2,"updates":[{"id":0,"timestamp":1759939302767,"update":"AdECtaqb3AcAJwEEYm90cyQ1ODQ5YWY1NS01ZThhLTQ4ZDYtOTEwNi0xOTk0OThlOWVjMDgBJwC1qpvcBwAGc3lzdGVtAgQAtaqb3AcBEWFiLmFjdGlvbi5kZXN0cm95JwC1qpvcBwAIYWJBY3Rpb24CBAC1qpvcBxMEdHJ1ZScAtaqb3AcABGZvcm0CBAC1qpvcBxgHbm90aGluZycAtaqb3AcAD2FiQm90TWVudUFjdGlvbgIEALWqm9wHIMACQGNvbnN0IHRhcmdldEJvdCA9IHRoYXQuYm90LmxpbmtzLnRhcmdldEJvdDsKCmlmICh0aGF0LmJvdC5saW5rcy50YXJnZXRPcmlnaW5Cb3RzKSB7CiAgICAvLyBEZXN0cm95IGJvdHMgYmVsb25naW5nIHRvIGFiSURPcmlnaW4uCiAgICBkZXN0cm95KHRoYXQuYm90LmxpbmtzLnRhcmdldE9yaWdpbkJvdHMpOwp9IGVsc2UgewogICAgLy8gRGVzdHJveSB0aGUgc2luZ2xlIHRhcmdldCBib3QuCiAgICBkZXN0cm95KHRhcmdldEJvdCk7Cn0KCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsnALWqm9wHAA5hYkJvdE1lbnVMYWJlbAIEALWqm9wH4QIHZGVzdHJveScAtaqb3AcADWFiQm90TWVudUljb24CBAC1qpvcB+kCDmRlbGV0ZV9mb3JldmVyJwC1qpvcBwASYWJCb3RNZW51U29ydE9yZGVyAgQAtaqb3Af4AgMxMDAnALWqm9wHAAhyZW1lbWJlcgIEALWqm9wH/AIo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAtaqb3AcADW1hbmlmZXN0YXRpb24CBAC1qpvcB6MDKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnALWqm9wHAAhhYklnbm9yZQIEALWqm9wHygMEdHJ1ZScAtaqb3AcADmFiQm90TWVudUNvbG9yAgQAtaqb3AfPAwcjRDkzMDMwJwC1qpvcBwAXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBAC1qpvcB9cDwANAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgpkZXN0cm95KHJlbGV2YW50VGFyZ2V0Qm90cyk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7JwC1qpvcBwAVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAtaqb3AeYBw5kZWxldGVfZm9yZXZlcicAtaqb3AcAFmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBAC1qpvcB6cHB2Rlc3Ryb3knALWqm9wHABphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEALWqm9wHrwcDMTAwJwC1qpvcBwAWYWJNdWx0aXBsZUJvdE1lbnVDb2xvcgIEALWqm9wHswcHI0Q5MzAzMCcAtaqb3AcACWFiVmVyc2lvbgIEALWqm9wHuwcFMTAuMjQnALWqm9wHABNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAtaqb3AfBB60HQGNvbnN0IHRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgppZiAodGFyZ2V0Qm90KSB7CiAgICB0YWdzLmxhYmVsID0gJ2Rlc3Ryb3knOwogICAgdGFncy50YXJnZXRCb3QgPSBnZXRMaW5rKHRhcmdldEJvdCk7CiAgICB0YWdzLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygiU2hpZnQiKSkgewogICAgICAgICAgICBpZiAobGlua3MudGFyZ2V0Qm90ICYmIGxpbmtzLnRhcmdldEJvdC50YWdzLmFiSURPcmlnaW4pIHsKICAgICAgICAgICAgICAgIC8vIENoYW5nZSBidXR0b24gdG8gZGVzdHJveSBhbGwgYm90cyB3aXRoIHNhbWUgYWJJRE9yaWdpbi4KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE9yaWdpbkJvdHMgPSBnZXRCb3RzKGIgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnRhZ3MuYWJJRE9yaWdpbiA9PT0gbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbjsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbWFza3MubGFiZWwgPSAnZGVzdHJveSAnICsgbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbiArICcgKCcgKyB0YXJnZXRPcmlnaW5Cb3RzLmxlbmd0aCArICcgYm90cyknOwogICAgICAgICAgICAgICAgdGFncy50YXJnZXRPcmlnaW5Cb3RzID0gZ2V0TGluayh0YXJnZXRPcmlnaW5Cb3RzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGA7CiAgICB0YWdzLm9uS2V5VXAgPSBgQAogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoIlNoaWZ0IikpIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSBudWxsOwogICAgICAgICAgICB0YWdzLnRhcmdldE9yaWdpbkJvdHMgPSBudWxsOwogICAgICAgIH0KICAgIGA7Cn0gZWxzZSB7CiAgICAvLyBObyBib3QgdG8gZGVzdHJveS4KICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nALWqm9wHABthYk11bHRpcGxlQm90TWVudU9uR2VuZXJhdGUCBAC1qpvcB+8O7wRAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgppZiAocmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aCA+IDEpIHsKICAgIC8vIE11bHRpcGxlIGJvdHMuCiAgICB0YWdzLmxhYmVsID0gYGRlc3Ryb3kgKCR7cmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aH0gYm90cylgOwp9IGVsc2UgaWYgKHJlbGV2YW50VGFyZ2V0Qm90cy5sZW5ndGggPT09IDEpIHsKICAgIC8vIFNpbmdsZSBib3QuCiAgICB0YWdzLmxhYmVsID0gYGRlc3Ryb3lgOwp9IGVsc2UgewogICAgLy8gTm8gYm90cyB0byBkZXN0cm95LgogICAgZGVzdHJveSh0aGlzQm90KTsKfScBBGJvdHMkNmIzZDk3NDQtNDQ0OC00ZWY1LTk2YTItNzEyODFjNDJhZjZjAScAtaqb3AffEwlhYlZlcnNpb24CBAC1qpvcB+ATBTEwLjI0JwC1qpvcB98TBnN5c3RlbQIEALWqm9wH5hMRYWIuYWN0aW9uLnZlcnNpb24nALWqm9wH3xMUYWJBY3Rpb25NYWpvclZlcnNpb24CBAC1qpvcB/gTATEnALWqm9wH3xMUYWJBY3Rpb25NaW5vclZlcnNpb24CBAC1qpvcB/oTAjEwJwC1qpvcB98TDW9uU2tpbGxVcGRhdGUCBAC1qpvcB/0TmQFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJBY3Rpb25NYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiQWN0aW9uTWlub3JWZXJzaW9uOwoKY29uc29sZS5sb2coIltBQkFjdGlvbl0gTG9hZGVkIEFCIEFjdGlvbiB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnALWqm9wH3xMIYWJJZ25vcmUCBAC1qpvcB5cVBHRydWUnALWqm9wH3xMIYWJBY3Rpb24CBAC1qpvcB5wVBHRydWUnALWqm9wH3xMEZm9ybQIEALWqm9wHoRUHbm90aGluZycBBGJvdHMkNzE3NTY0NWMtNGI1My00NDU0LTg3MTYtZmMwZTY4ZGIyNjY1AScAtaqb3AepFQZzeXN0ZW0CBAC1qpvcB6oVD2FiLmFjdGlvbi5sb2dpbicAtaqb3AepFQhhYkFjdGlvbgIEALWqm9wHuhUEdHJ1ZScAtaqb3AepFQhhYklnbm9yZQIEALWqm9wHvxUEdHJ1ZScAtaqb3AepFQRmb3JtAgQAtaqb3AfEFQdub3RoaW5nJwC1qpvcB6kVD2FiQ29yZU1lbnVDb2xvcgIEALWqm9wHzBUHI0YyQjcwNScAtaqb3AepFRNhYkNvcmVNZW51U29ydE9yZGVyAgQAtaqb3AfUFQItNScAtaqb3AepFRBhYkNvcmVNZW51QWN0aW9uAgQAtaqb3AfXFRtAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsnALWqm9wHqRUUYWJDb3JlTWVudU9uR2VuZXJhdGUCBAC1qpvcB/MV6wFAdGFncy5hYk1lbnUgPSBmYWxzZTsgLy8gS2VlcCBidXR0b24gaGlkZGVuIHVudGlsIGF1dGggY2hlY2sgaXMgY29tcGxldGUuCmF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfSBlbHNlIHsKICAgIHRhZ3MuYWJNZW51ID0gdHJ1ZTsKICAgIHRhZ3Mub25BQkF1dGhCb3RBZGRlZCA9IGBAZGVzdHJveSh0aGlzQm90KTtgOwp9JwC1qpvcB6kVDmFiQ29yZU1lbnVJY29uAgQAtaqb3AffFwVsb2dpbicAtaqb3AepFQhyZW1lbWJlcgIEALWqm9wH5Rco8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAtaqb3AepFQlhYlZlcnNpb24CBAC1qpvcB4wYBTEwLjI0JwC1qpvcB6kVC3BlcnNvbmFsaXR5AgQAtaqb3AeSGCjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwC1qpvcB6kVD2FiQ29yZU1lbnVMYWJlbAIEALWqm9wHuRgHc2lnbiBpbicAtaqb3AepFQ5hYkNvcmVNZW51SGlkZQIEALWqm9wHwRgEdHJ1ZScAtaqb3AepFQ5vbkFueUJvdHNBZGRlZAIEALWqm9wHxhj+AkBpZiAodGhhdC5ib3RzKSB7CiAgICBjb25zdCBhZGRlZEF1dGhCb3QgPSB0aGF0LmJvdHMuZmluZChiID0+IGIgPT09IGdsb2JhbFRoaXMuYXV0aEJvdCk7CgogICAgaWYgKGFkZGVkQXV0aEJvdCkgewogICAgICAgIHRoaXNCb3QudmFycy5hdXRoQm90SWQgPSBhZGRlZEF1dGhCb3QuaWQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXV0aCBib3QgYWRkZWQuIGF1dGhCb3QgaWQ6ICR7dGhpc0JvdC52YXJzLmF1dGhCb3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCQXV0aEJvdEFkZGVkJywgeyBhdXRoQm90OiBhZGRlZEF1dGhCb3QgfSk7CiAgICB9Cn0nALWqm9wHqRUFZGVidWcCBAC1qpvcB8UbBWZhbHNlJwC1qpvcB6kVEG9uQW55Qm90c1JlbW92ZWQCBAC1qpvcB8sbowNAaWYgKHRoYXQuYm90SURzICYmIHRoaXNCb3QudmFycy5hdXRoQm90SWQpIHsKICAgIGNvbnN0IHJlbW92ZWRBdXRoQm90SWQgPSB0aGF0LmJvdElEcy5zb21lKGlkID0+IGlkID09PSB0aGlzQm90LnZhcnMuYXV0aEJvdElkKTsKCiAgICBpZiAocmVtb3ZlZEF1dGhCb3RJZCkgewogICAgICAgIHRoaXNCb3QudmFycy5hdXRoQm90SWQgPSBudWxsOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGF1dGggYm90IHJlbW92ZWQuIGF1dGhCb3QgaWQ6ICR7cmVtb3ZlZEF1dGhCb3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCQXV0aEJvdFJlbW92ZWQnLCB7IGF1dGhCb3RJZDogcmVtb3ZlZEF1dGhCb3RJZCB9KTsKICAgIH0KfScBBGJvdHMkYjMzOWMxMTgtNDg5YS00NjZiLWJhOWYtYjA3YTVmOWI2NjRmAScAtaqb3AfvHgZzeXN0ZW0CBAC1qpvcB/AeD2FiLmFjdGlvbi5wYXN0ZSgAtaqb3AfvHghhYkFjdGlvbgF4JwC1qpvcB+8eBGZvcm0CBAC1qpvcB4EfB25vdGhpbmcnALWqm9wH7x4LZGVzY3JpcHRpb24CBAC1qpvcB4kfK2FiIHNraWxsIHVzZWQgZm9yIGNvcHlpbmcgYW5kIHBhc3RpbmcgYm90cy4nALWqm9wH7x4Hb25QYXN0ZQIEALWqm9wHtR//B0BpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IE1BQ1JPUyA9IFsKICAgIHsKICAgICAgICB0ZXN0OiAvKD86W+KAnOKAnV0pL2csCiAgICAgICAgcmVwbGFjZW1lbnQ6ICh2YWwpID0+ICciJywKICAgIH0sCiAgICB7CiAgICAgICAgdGVzdDogLyg/OlvigJjigJldKS9nLAogICAgICAgIHJlcGxhY2VtZW50OiAodmFsKSA9PiAiJyIsCiAgICB9LApdOwoKbGV0IGZvcm1hdHRlZENvcHkgPSByZXBsYWNlTWFjcm9zKHRoYXQudGV4dCk7CmxldCBjb3B5Qm90ID0gSlNPTi5wYXJzZShmb3JtYXR0ZWRDb3B5KTsKbGV0IHBhc3RlZERhdGEgPSAhY29weUJvdC5zdGF0ZSA/IHtbY29weUJvdC5pZF06IGNvcHlCb3R9IDogY29weUJvdC5zdGF0ZTsKbGV0IGRpbU1vZCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJGb2N1c0RhdGE7CgppZiAoT2JqZWN0LmtleXMocGFzdGVkRGF0YSkubGVuZ3RoID09IDEgJiYgZGltTW9kKQp7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb25dID0gdHJ1ZTsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbisiWCJdID0gZGltTW9kLng7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb24rIlkiXSA9IGRpbU1vZC55OwoKICAgIG9zLnRvYXN0KCJib3QgYWRkZWQgdG8gaW5zdCIpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImJvdHMgYWRkZWQgdG8gaW5zdCIpOwp9CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHBhc3RlZCBkYXRhIik7CgpsaW5rcy5jcmVhdGUuYWJDcmVhdGVCb3RzKHtib3RzOiBwYXN0ZWREYXRhLCBzb3VyY2VFdmVudDogJ3Bhc3RlJ30pOwoKZnVuY3Rpb24gcmVwbGFjZU1hY3Jvcyh0ZXh0KSB7CiAgICBpZiAoIXRleHQpIHsKICAgICAgICByZXR1cm4gdGV4dDsKICAgIH0KCiAgICBmb3IgKGxldCBtIG9mIE1BQ1JPUykgewogICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UobS50ZXN0LCBtLnJlcGxhY2VtZW50KTsKICAgIH0KCiAgICByZXR1cm4gdGV4dDsKfScAtaqb3AfvHghyZW1lbWJlcgIEALWqm9wHrSco8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAtaqb3AfvHgZjcmVhdGUCBAC1qpvcB9QnKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnALWqm9wH7x4IYWJJZ25vcmUCBAC1qpvcB/snBHRydWUnALWqm9wH7x4Jb25LZXlEb3duAgQAtaqb3AeAKLoJQGlmICghYnVpbGRlclZlcnNpb24gfHwgKCFsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzICYmICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpKQp7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LmtleXMgPT0gImMiKQp7CiAgICBsZXQgbWV0YUlucHV0ID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiTWV0YSIpOwoKICAgIGlmICghbWV0YUlucHV0KQogICAgewogICAgICAgIG1ldGFJbnB1dCA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIkNvbnRyb2wiKTsKICAgIH0KICAgIAogICAgaWYgKCFtZXRhSW5wdXQpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBmb3JtYXR0ZWRGaWxlOwogICAgbGV0IHN0YXRlID0ge307CgogICAgaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpCiAgICB7CiAgICAgICAgbGV0IHNlbGVjdGVkQm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCiAgICAgICAgc3RhdGVbc2VsZWN0ZWRCb3QuaWRdID0gc2VsZWN0ZWRCb3Q7CgogICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogY29waWVkIGEgYm90IHRvIGNsaXBib2FyZCIpOwogICAgfQogICAgZWxzZSBpZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKQogICAgewogICAgICAgIGxldCBzZWxlY3RlZEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0ZWRCb3RzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgc3RhdGVbc2VsZWN0ZWRCb3RzW2ldLmlkXSA9IHNlbGVjdGVkQm90c1tpXTsKICAgICAgICB9CgogICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogY29waWVkIG11bHRpcGxlIGJvdHMgdG8gY2xpcGJvYXJkIik7CiAgICB9CgogICAgbGV0IG5ld0ZpbGUgPSB7fTsKICAgIG5ld0ZpbGUudmVyc2lvbiA9IDE7CiAgICBuZXdGaWxlLnN0YXRlID0gc3RhdGU7CgogICAgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKfScAtaqb3AfvHglhYlZlcnNpb24CBAC1qpvcB7sxBTEwLjI0JwC1qpvcB+8eC3BlcnNvbmFsaXR5AgQAtaqb3AfBMSjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwEEYm90cyRiZGFiZDZjMC04OWY5LTRmNzUtYjM1Yy0yNmY0ZWM1MjA3ZDYBJwC1qpvcB+gxBnN5c3RlbQIEALWqm9wH6TEQYWIuYWN0aW9uLnJlcG9ydCcAtaqb3AfoMQRmb3JtAgQAtaqb3Af6MQdub3RoaW5nJwC1qpvcB+gxEGFiQ29yZU1lbnVBY3Rpb24CBAC1qpvcB4IyEUBvcy5yZXBvcnRJbnN0KCk7JwC1qpvcB+gxE2FiQ29yZU1lbnVTb3J0T3JkZXICBAC1qpvcB5QyAzEwMScAtaqb3AfoMQ5hYkNvcmVNZW51SWNvbgIEALWqm9wHmDIEZmxhZycAtaqb3AfoMQ9hYkNvcmVNZW51TGFiZWwCBAC1qpvcB50yBnJlcG9ydCcAtaqb3AfoMQhhYkFjdGlvbgIEALWqm9wHpDIEdHJ1ZScAtaqb3AfoMQhhYklnbm9yZQIEALWqm9wHqTIEdHJ1ZScAtaqb3AfoMRRhYkNvcmVNZW51T25HZW5lcmF0ZQIEALWqm9wHrjJGQGlmIChjb25maWdCb3QudGFncy5zdGF0aWNJbnN0ICE9IHVuZGVmaW5lZCkKewogICAgZGVzdHJveSh0aGlzQm90KTsKfScAtaqb3AfoMQlhYlZlcnNpb24CBAC1qpvcB/UyBTEwLjI0JwEEYm90cyRjNjhjNWI4Mi1jMGE3LTRhNWEtOTEwNC01ZGQ4ZTMyYWU0ZTIBJwC1qpvcB/syBnN5c3RlbQIEALWqm9wH/DIQYWIuYWN0aW9uLnBvcnRhbCcAtaqb3Af7MgtkZXNjcmlwdGlvbgIEALWqm9wHjTMUU2tpbGwgdG8gb3BlbiBzaGVldC4nALWqm9wH+zIIYWJBY3Rpb24CBAC1qpvcB6IzBHRydWUnALWqm9wH+zIEZm9ybQIEALWqm9wHpzMHbm90aGluZycAtaqb3Af7MhBhYkNvcmVNZW51QWN0aW9uAgQAtaqb3AevMwNALy8nALWqm9wH+zIIcmVtZW1iZXICBAC1qpvcB7MzKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnALWqm9wH+zIPYWJDb3JlTWVudUxhYmVsAgQAtaqb3AfaMxBjdXJyZW50IHBvcnRhbDogJwC1qpvcB/syD2FiQm90TWVudUFjdGlvbgIEALWqm9wH6zP4AkBjb25zdCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CmNvbnN0IGN1cnJlbnREaW0gPSBsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90LnRhZ3MubGluZVRvOwpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZiAoc3RhdGUpIAp7CiAgICBvcy5vcGVuVVJMKGNvbmZpZ0JvdC50YWdzLnBlcm1hbGluayArIGAmc2hlZXRQb3J0YWw9JHtjdXJyZW50RGltfWApOwp9CmVsc2UKewogICAgY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgPSBjdXJyZW50RGltOwp9CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBib3Qgc2hlZXQiKTsnALWqm9wH+zIOYWJCb3RNZW51TGFiZWwCBAC1qpvcB+Q2Dm9wZW4gYm90IHNoZWV0JwC1qpvcB/syDW1hbmlmZXN0YXRpb24CBAC1qpvcB/M2KPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnALWqm9wH+zINYWJCb3RNZW51SWNvbgIEALWqm9wHmjcKdGFibGVfdmlldycAtaqb3Af7Mg5hYkNvcmVNZW51SWNvbgIEALWqm9wHpTcLYXJyb3dfcmlnaHQnALWqm9wH+zISYWJCb3RNZW51U29ydE9yZGVyAgQAtaqb3AexNwExJwC1qpvcB/syCGFiSWdub3JlAgQAtaqb3AezNwR0cnVlJwC1qpvcB/syF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAtaqb3Ae4N5sEQGNvbnN0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKY29uc3QgY3VycmVudERpbSA9ICJhYk11bHRpcGxlU2VsZWN0IjsKCmNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY3VycmVudERpbTsKCnNldFRhZ01hc2sobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzLCBjdXJyZW50RGltLCB0cnVlLCAidGVtcExvY2FsIik7CgptYXNrcy5jdXJyZW50U2hlZXRCb3RzID0gbGlua3MucmVtZW1iZXIudGFncy5hYk11bHRpcGxlQm90Rm9jdXM7Cm1hc2tzLm9uUG9ydGFsQ2hhbmdlZCA9IGBAIGlmICh0aGF0LmRpbWVuc2lvbiAhPSAiYWJNdWx0aXBsZVNlbGVjdCIgJiYgdGhhdC5wb3J0YWwgPT0gInNoZWV0UG9ydGFsIikKewogICAgY2xlYXJUYWdNYXNrcyhsaW5rcy5jdXJyZW50U2hlZXRCb3RzKTsKCiAgICBjbGVhclRhZ01hc2tzKHRoaXNCb3QpOwp9IGA7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQiKTsnALWqm9wH+zIWYWJNdWx0aXBsZUJvdE1lbnVMYWJlbAIEALWqm9wH1Dsab3BlbiBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQnALWqm9wH+zIVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAtaqb3AfvOwp0YWJsZV92aWV3JwC1qpvcB/syE2FiQm90TWVudU9uR2VuZXJhdGUCBAC1qpvcB/o7mAJAbGV0IHNlbGVjdGVkQm90ID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC50YWdzLmxpbmVUbzsKCnRhZ3MubGFiZWwgPSAic2hlZXRQb3J0YWw9IiArIHNlbGVjdGVkQm90LnN1YnN0cmluZygwLCA0KTsKCnRhZ3Mub25LZXlEb3duID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gdGFncy5sYWJlbCArICIgaW4gbmV3IHRhYiI7fWA7CnRhZ3Mub25LZXlVcCA9IGBAIGlmKHRoYXQua2V5cyA9PSAiU2hpZnQiKXttYXNrcy5sYWJlbCA9IG51bGw7fWA7JwC1qpvcB/syGmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQAtaqb3AeTPgEwJwC1qpvcB/syBG1lbnUCBAC1qpvcB5U+KPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InALWqm9wH+zIJYWJWZXJzaW9uAgQAtaqb3Ae8PgUxMC4yNCcAtaqb3Af7MgthYkJsdWVwcmludAIEALWqm9wHwj77A0Bjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSBsaW5rcy5yZW1lbWJlcj8udGFncy5hYkJsdWVwcmludENvbG9yID8/ICIjMTc4NUI1IjsKCmlmIChiYWNrZ3JvdW5kQ29sb3IgPT0gZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDb2xvcikKewogICAgcmV0dXJuOwp9CgpncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yID0gYmFja2dyb3VuZENvbG9yOwoKbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gYEAgaWYgKHRoYXQucG9ydGFsID09ICJncmlkUG9ydGFsIiAmJiB0aGF0LmRpbWVuc2lvbiAhPSAiYmx1ZXByaW50Iil7CiAgICAvLyBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJhc2VDb2xvciA9IG51bGw7CiAgICAvLyBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJhc2VTdHJva2VDb2xvciA9IG51bGw7CgogICAgZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDb2xvciA9IG51bGw7CgogICAgbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gbnVsbDsKfWA7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOycAtaqb3Af7MgtvbkFueUNyZWF0ZQIEALWqm9wHvkJ2QGlmICh0aGF0LmJvdC50YWdzLmJsdWVwcmludCkKewogICAgdGhhdC5ib3QudGFncy5zdHJva2VDb2xvciA9ICIjZmZmZmZmIjsKICAgIHRoYXQuYm90LnRhZ3MubGFiZWxDb2xvciA9ICIjZmZmZmZmIjsKfScAtaqb3Af7Mg9vblBvcnRhbENoYW5nZWQCBAC1qpvcB7VDYUBpZiAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIHRoYXQuZGltZW5zaW9uID09ICJibHVlcHJpbnQiKQp7CiAgICB0aGlzQm90LmFiQmx1ZXByaW50KCk7Cn0nALWqm9wH+zILcGVyc29uYWxpdHkCBAC1qpvcB5dEKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInALWqm9wH+zISYWJDb3JlTWVudUl0ZW1UeXBlAgQAtaqb3Ae+RAhkcm9wZG93bicAtaqb3Af7MhFkcm9wZG93blNvcnRPcmRlcgIEALWqm9wHx0QBMScAtaqb3Af7Mg9kcm9wZG93bk9wdGlvbnMCBAC1qpvcB8lEBvCfp6xbXScAtaqb3Af7MhhhYkNvcmVNZW51T25CZWZvcmVDcmVhdGUCBAC1qpvcB85E4h5AY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IGN1cnJlbnREaW0gPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uOw0KY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCmNvbnN0IHBlcm1hbGlua1VSTCA9IGNvbmZpZ0JvdC50YWdzLnBlcm1hbGluazsNCmNvbnN0IGFjdGl2ZUluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOw0KY29uc3QgYWN0aXZlQmlvcyA9IGNvbmZpZ0JvdC50YWdzLm93bmVyID8gIiZvd25lcj0iICsgY29uZmlnQm90LnRhZ3Mub3duZXIgOiBmYWxzZTsNCmNvbnN0IGZpcnN0SW5kZXggPSBwZXJtYWxpbmtVUkwuaW5kZXhPZigiJiIpOw0KY29uc3QgaW5pdGlhbFVSTCA9IHBlcm1hbGlua1VSTC5zdWJzdHJpbmcoMCwgZmlyc3RJbmRleCk7DQpjb25zdCB1cGRhdGVkVVJMID0gYWN0aXZlQmlvcyAhPSBmYWxzZSA/IGluaXRpYWxVUkwgKyAiJmluc3Q9IiArIGFjdGl2ZUluc3QgOiBpbml0aWFsVVJMOw0KDQpzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkNvcmVNZW51TGFiZWwiLGBtb2RlOiAke2N1cnJlbnRQb3J0YWx9IHBvcnRhbGApOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAiY3VycmVudERpbWVuc2lvbiIsIGN1cnJlbnREaW0pOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAiY3VycmVudFBvcnRhbCIsIGN1cnJlbnRQb3J0YWwpOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAiZHJvcGRvd25Tb3J0T3JkZXIiLCAxKTsNCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiUG9ydGFsTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMub25LZXlEb3duID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gdGFncy5sYWJlbCArICIgaW4gbmV3IHRhYiI7fWA7DQptZW51T3B0aW9ucy5vbktleVVwID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gbnVsbDt9YDsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCm1lbnVPcHRpb25zLnRhcmdldFVSTCA9IHVwZGF0ZWRVUkw7DQoNCmNvbnN0IG1hcE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQoNCm1hcE1lbnVCb3QubGFiZWwgPSAibWFwIHBvcnRhbCI7DQptYXBNZW51Qm90LmZvcm1BZGRyZXNzID0gInB1YmxpYyI7DQptYXBNZW51Qm90Lm9uQ2xpY2sgPSBgQCANCmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsNCg0KaWYoc3RhdGUpDQp7DQogICAgb3Mub3BlblVSTCh0YWdzLnRhcmdldFVSTCArICImbWFwUG9ydGFsPSR7Y3VycmVudERpbSA9PSAiYmx1ZXByaW50IiA/ICJob21lIiA6IGN1cnJlbnREaW19Iik7DQp9DQplbHNlDQp7DQogICAgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gIiR7Y3VycmVudERpbSA9PSAiYmx1ZXByaW50IiA/ICJob21lIiA6IGN1cnJlbnREaW19IjsNCiAgICBjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsID0gbnVsbDsNCn1gOw0KDQppZiAoY3VycmVudFBvcnRhbCAhPSAibWFwIikNCnsNCiAgICAvL21hcCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2gobWFwTWVudUJvdCk7DQp9DQoNCmNvbnN0IGdyaWRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KZ3JpZE1lbnVCb3QubGFiZWwgPSAiZ3JpZCBwb3J0YWwiOw0KZ3JpZE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiY3ViZSI7DQpncmlkTWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZncmlkUG9ydGFsPSR7Y3VycmVudERpbSA9PSAiYmx1ZXByaW50IiA/ICJob21lIiA6IGN1cnJlbnREaW19Iik7DQp9IA0KZWxzZQ0Kew0KICAgIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAiJHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iOyBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSBudWxsOw0KfWA7DQoNCmlmIChjdXJyZW50UG9ydGFsICE9ICJncmlkIiB8fCBjdXJyZW50RGltID09ICJibHVlcHJpbnQiKQ0Kew0KICAgIC8vZ3JpZCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goZ3JpZE1lbnVCb3QpOw0KfQ0KDQpjb25zdCBibHVlcHJpbnRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KDQpibHVlcHJpbnRNZW51Qm90LmxhYmVsID0gImJsdWVwcmludCBwb3J0YWwiOw0KYmx1ZXByaW50TWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhcmNoaXRlY3R1cmUiOw0KYmx1ZXByaW50TWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZncmlkUG9ydGFsPWJsdWVwcmludCIpOw0KfSANCmVsc2UNCnsNCiAgICBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gImJsdWVwcmludCI7IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IG51bGw7DQp9DQoNCmxpbmtzLnNraWxsQm90LmFiQmx1ZXByaW50KCk7YDsNCg0KaWYgKGN1cnJlbnREaW0gIT0gImJsdWVwcmludCIpDQp7DQogICAgLy9ibHVlcHJpbnQgcG9ydGFsIGJ1dHRvbg0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGJsdWVwcmludE1lbnVCb3QpOw0KfQ0KDQoNCmNvbnN0IHNoZWV0TWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCnNoZWV0TWVudUJvdC5sYWJlbCA9ICJzaGVldCBwb3J0YWwiOw0Kc2hlZXRNZW51Qm90LmZvcm1BZGRyZXNzID0gInRhYmxlX3ZpZXciOw0Kc2hlZXRNZW51Qm90Lm9uQ2xpY2sgPSBgQCANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZzaGVldFBvcnRhbD0ke2N1cnJlbnREaW19Iik7DQp9IA0KZWxzZQ0KeyANCiAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9ICIke2N1cnJlbnREaW19IjsNCn1gOw0KDQovL3NoZWV0IHBvcnRhbCBidXR0b24NCmRyb3Bkb3duT3B0aW9ucy5wdXNoKHNoZWV0TWVudUJvdCk7DQoNCg0KY29uc3Qgc3lzdGVtTWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCg0Kc3lzdGVtTWVudUJvdC5sYWJlbCA9ICJzeXN0ZW0gcG9ydGFsIjsNCnN5c3RlbU1lbnVCb3QuZm9ybUFkZHJlc3MgPSAic2V0dGluZ3NfYXBwbGljYXRpb25zIjsNCnN5c3RlbU1lbnVCb3Qub25DbGljayA9IGBADQoNCmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsNCg0KaWYoc3RhdGUpDQp7DQogICAgb3Mub3BlblVSTCh0YWdzLnRhcmdldFVSTCArICImc3lzdGVtUG9ydGFsPXRydWUiKTsNCn0gDQplbHNlDQp7IA0KICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7DQp9YDsNCg0KLy9zeXN0ZW0gcG9ydGFsIGJ1dHRvbg0KZHJvcGRvd25PcHRpb25zLnB1c2goc3lzdGVtTWVudUJvdCk7DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycBBGJvdHMkZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3AScAtaqb3AexYwZzeXN0ZW0CBAC1qpvcB7JjDWFiLmFjdGlvbi5hc2snALWqm9wHsWMEZm9ybQIEALWqm9wHwGMHbm90aGluZycAtaqb3AexYwZhc2tHUFQCBAC1qpvcB8hj7wpAaWYgKCF0YWdzLmdwdEFjdGl2ZSB8fCBhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93QUkgPT0gZmFsc2UpIHsKICAgIGNvbnN0IGFpTWVzc2FnZSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWlfcmVqZWN0aW9uX21lc3NhZ2UgPz8gIkFJIG5vdCBhdXRob3JpemVkIGZvciB0aGlzIGFjY291bnQiOwogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6IGFpTWVzc2FnZSB9KTsKICAgIG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7CiAgICBjb25maWdCb3QudGFncy5hYlNjYW4gPSB0cnVlOwogICAgcmV0dXJuOwp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9CgpsZXQgaW5xdWlyeSA9IHRoYXQuaW5xdWlyeSA/PyB0aGF0OwoKY29uc3QgcHJvbXB0ID0gIXRoYXQucHJvbXB0ID8gdGFncy5wcm9tcHRfY29yZSA6IHRhZ3NbInByb21wdF8iICsgdGhhdC5wcm9tcHRdOwoKbGlua3MudXRpbHMuYWJMb2coeyBtZXNzYWdlOiBgdGhpbmtpbmcgYWJvdXQ6ICIke2lucXVpcnl9ImAgfSk7CmxpbmtzLm1hbmlmZXN0YXRpb24uYWJCb3RDaGF0KHsgbWVzc2FnZTogYHRoaW5raW5nIGFib3V0OiAiJHtpbnF1aXJ5fSJgIH0pOwoKaWYgKHRoYXQucHJvbXB0ID09ICJncmlkIikgewogICAgaW5xdWlyeSA9IGlucXVpcnkgKyBgIFBPU0lUSU9OOiB7JHt0aGF0LmRhdGEuZGltZW5zaW9ufTogdHJ1ZSwgJHt0aGF0LmRhdGEuZGltZW5zaW9ufVg6ICR7dGhhdC5kYXRhLmRpbWVuc2lvblh9LCAke3RoYXQuZGF0YS5kaW1lbnNpb259WToke3RoYXQuZGF0YS5kaW1lbnNpb25ZfX0uYAp9CmVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJib3QiKSB7CiAgICBpbnF1aXJ5ID0gaW5xdWlyeSArIGAgVEFSR0VUX0JPVF9JRDogYCArIHRoYXQuZGF0YS5ib3QuaWQ7Cn0KZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gIm11bHRpcGxlQm90IikgewogICAgaW5xdWlyeSA9IGlucXVpcnkgKyBgIFRBUkdFVF9CT1RfSURTOiBgICsgdGhhdC5kYXRhLmJvdHM7Cn0KZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gImNvcmUiKSB7CiAgICAvLyBEbyBub3RoaW5nIGV4dHJhLgp9Cgpjb25zdCBhbnN3ZXIgPSBhd2FpdCB0aGlzQm90LnN1Ym1pdFJlcXVlc3RHUFQoeyBpbnF1aXJ5OiBpbnF1aXJ5LCBwcm9tcHQ6IHByb21wdCwgbW9kZWw6IHRoYXQubW9kZWwgfSk7CgppZiAoYW5zd2VyKSB7CiAgICBsaW5rcy51dGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBbZ2VuZXJhdGVkIGNvZGVdOlxuJHthbnN3ZXJ9YCB9KTsKCiAgICBjcmVhdGUoeyBob21lOiB0cnVlLCBvbkNyZWF0ZTogYEAgJHthbnN3ZXJ9YCB9KTsKCiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKfScAtaqb3AexYwlncHRBY3RpdmUCBAC1qpvcB7huBWZhbHNlJwC1qpvcB7FjEHN1Ym1pdFJlcXVlc3RHUFQCBAC1qpvcB75ulQ1AaW1wb3J0IHsgQUlDaGF0T3B0aW9ucyB9IGZyb20gJ2Nhc3VhbG9zJzsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXRgLCB0aGF0KTsKfQoKbGV0IHN5c3RlbVByb21wdCA9IHRoYXQucHJvbXB0ID8gdGhhdC5wcm9tcHQgOiB0YWdzLnByb21wdF9jb3JlOwoKc3lzdGVtUHJvbXB0ID0gc3lzdGVtUHJvbXB0ICsgdGhhdC5pbnF1aXJ5OwoKaWYgKGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dBSSA9PSBmYWxzZSkKewogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6ICJBSSBub3QgYXV0aG9yaXplZCBvbiB0aGlzIGFjY291bnQiLCBsb2dUeXBlOiAnbG9nJyB9KTsKICAgIHJldHVybiBudWxsOwp9CgpsZXQgY3VycmVudEV4cGVyaWVuY2VCb3RzID0gZ2V0Qm90cyhiID0+IGIuc3BhY2UgPT09ICdzaGFyZWQnICYmICFiLnRhZ3MuYWJJZ25vcmUpOwoKaWYgKGN1cnJlbnRFeHBlcmllbmNlQm90cy5sZW5ndGggPiAwKQp7CiAgICBzeXN0ZW1Qcm9tcHQgPSBzeXN0ZW1Qcm9tcHQgKyAiIFRoZXNlIGFyZSB0aGUgYm90cyB0aGF0IGN1cnJlbnRseSBleGlzdCBpbiB0aGUgZXhwZXJpZW5jZTogIiArIGN1cnJlbnRFeHBlcmllbmNlQm90czsKfQoKaWYgKCFsaW5rcy5tZW51KSB7CiAgICBhd2FpdCBsaW5rcy5sZWFybi5hYkFkYXB0KCdhYkludGVyZmFjZScpOwp9Cgpjb25zdCBidXN5SW5kaWNhdG9yID0gYXdhaXQgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yKHsgYWJNZW51OiB0cnVlLCBsYWJlbDogYGFza2luZyAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9YCB9KTsKCmNvbnN0IGFpQ2hhdE9wdGlvbnM6IEFJQ2hhdE9wdGlvbnMgPSB7CiAgICBwcmVmZXJyZWRNb2RlbDogdGhhdC5tb2RlbCA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCwKICAgIHRlbXBlcmF0dXJlOiAwLAogICAgdG9wUDogMSwKICAgIHByZXNlbmNlUGVuYWx0eTogMC42LAogICAgZnJlcXVlbmN5UGVuYWx0eTogMCwKfQoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2VuZGluZyB0byBhaTpgLCB7IHN5c3RlbVByb21wdCwgYWlDaGF0T3B0aW9ucyB9KTsKfQoKbGV0IGFpUmVzcG9uc2U6IHN0cmluZzsKCnRyeSB7CiAgICBhaVJlc3BvbnNlID0gYXdhaXQgYWkuY2hhdChzeXN0ZW1Qcm9tcHQsIGFpQ2hhdE9wdGlvbnMpOwoKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhaSByZXNwb25zZTpgLCBhaVJlc3BvbnNlKTsKICAgIH0KfSBjYXRjaChlKSB7CiAgICBhaVJlc3BvbnNlID0gbnVsbDsKCiAgICAvLyBTaG93IHRvYXN0IHdpdGggZXJyb3IuCiAgICBsaW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KHsgbWVzc2FnZTogYEFJIHJlcXVlc3QgZmFpbGVkIC0gJHtsaW5rcy51dGlscy5nZXRFcnJvck1lc3NhZ2UoZSl9YCwgbG9nVHlwZTogJ2Vycm9yJyB9KTsKCiAgICAvLyBSZXRocm93IHNvIGNhbGxlcnMgY2FuIGNhdGNoLgogICAgdGhyb3cgZTsKfSBmaW5hbGx5IHsKICAgIGRlc3Ryb3koYnVzeUluZGljYXRvcik7Cn0KCnJldHVybiBhaVJlc3BvbnNlOycAtaqb3AexYwhyZW1lbWJlcgIEALWqm9wH1Hso8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAtaqb3AexYxBhYkNvcmVNZW51QWN0aW9uAgQAtaqb3Af7e4IcQGNvbnN0IGlucXVpcnkgPSB0aGF0Py5tZXNzYWdlID8/IHRoYXQ7CmNvbnN0IGluaXRpYWxCb290ID0gdGhhdD8uaW5pdGlhbEJvb3QgPz8gZmFsc2U7CmNvbnN0IGF1dG9IYXRjaCA9IHRoYXQ/LmF1dG9IYXRjaCA/PyBmYWxzZTsKY29uc3QgbWVudSA9IHRoYXQ/Lm1lbnUgPz8gImNvcmUiOwpjb25zdCBpbnF1aXJ5SGFzU3BhY2UgPSBpbnF1aXJ5LmluZGV4T2YoIiAiKSAhPT0gLTE7CmNvbnN0IG1lbnVCb3RzID0gZ2V0Qm90cyhjb25maWdCb3QudGFncy5tZW51UG9ydGFsLCB0cnVlKTsKY29uc3QgaXNDaGFubmVsID0gdGhhdC5pc0NoYW5uZWwgPz8gZmFsc2U7CmNvbnN0IGlzVVVBQiA9IHRoYXQuaXNVVUFCID8/IGZhbHNlOwoKd2hpc3BlcihtZW51Qm90cywgImFiTWVudVJlZnJlc2giKTsKCmxldCB1c2VybmFtZSA9ICJ1c2VyIjsKaWYgKGF1dGhCb3QgJiYgYXV0aEJvdC50YWdzLm5hbWUpIHsKICAgIHVzZXJuYW1lID0gYXV0aEJvdC50YWdzLm5hbWU7Cn0gZWxzZSBpZiAoYWIubGlua3MuY29uc29sZS5tYXNrcy5wcmVmZXJyZWROYW1lKSB7CiAgICB1c2VybmFtZSA9IGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZTsKfQoKYWIubG9nKHsgbWVzc2FnZTogaW5xdWlyeSwgbmFtZTogdXNlcm5hbWUgfSk7CgppZiAoIWNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbCAmJiBsaW5rcy5tYW5pZmVzdGF0aW9uLnRhZ3MuYWJBd2FrZSAmJiBpbnF1aXJ5ICE9ICIubG9nIikgewogICAgc2hvdXQoInNob3dDb25zb2xlIik7Cn0KCmlmIChpc1VVQUIpIHsKICAgIGxpbmtzLnV1YWJMb2FkZXI/LmxvYWRVVUFCKGlucXVpcnkpOwp9CmVsc2UgaWYgKGlzQ2hhbm5lbCkgewogICAgbGlua3MuY2hhbm5lbExvYWRlcj8ubG9hZENoYW5uZWwoaW5xdWlyeSk7Cn0KZWxzZSBpZiAoIWlucXVpcnlIYXNTcGFjZSkgewogICAgY29uc3QgaXNEaXJlY3RTZWFyY2ggPSBpbnF1aXJ5LnN0YXJ0c1dpdGgoYCJgKSAmJiBpbnF1aXJ5LmVuZHNXaXRoKGAiYCk7CgogICAgY29uc3QgYXNrOiBBQkxvb2t1cEFza0lEUmVzdWx0IHwgZmFsc2UgPSAhaXNEaXJlY3RTZWFyY2ggPyBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7IGFza0lEOiBpbnF1aXJ5LCBhdXRvSGF0Y2g6IHRydWUsIHNvdXJjZUV2ZW50OiAnYXNrJyB9KSA6IGZhbHNlOwoKICAgIGlmIChhc2s/LnN1Y2Nlc3MgJiYgYXNrPy5kYXRhPy51cmwgIT0gdW5kZWZpbmVkICYmICFpc0RpcmVjdFNlYXJjaCAmJiAhaXNDaGFubmVsKSB7CiAgICAgICAgbGlua3MubGVhcm4uYWJKb2luSG9zdCh7IGRhdGE6IGFzay5kYXRhIH0pOwogICAgfSBlbHNlIGlmICghYXNrPy5zdWNjZXNzKSB7CiAgICAgICAgbGV0IGVnZzogQUJMb29rdXBFZ2dSZXN1bHQ7CiAgICAgICAgY29uc3QgcGVyaW9kSW5kZXggPSBpbnF1aXJ5LmluZGV4T2YoIi4iKTsKICAgICAgICBsZXQgYWJJRCA9IGlucXVpcnk7CgogICAgICAgIGlmIChpc0RpcmVjdFNlYXJjaCkgewogICAgICAgICAgICBhYklEID0gaW5xdWlyeS5zdWJzdHJpbmcoMSwgaW5xdWlyeS5sZW5ndGggLSAxKTsKICAgICAgICB9CgogICAgICAgIGlmIChwZXJpb2RJbmRleCA9PSAtMSB8fCBpc0RpcmVjdFNlYXJjaCkgewogICAgICAgICAgICBlZ2cgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3MoeyBhYklEOiBhYklELCBpbml0aWFsQm9vdCwgYXV0b0hhdGNoLCBzb3VyY2VFdmVudDogJ2FzaycgfSk7CiAgICAgICAgfSBlbHNlIGlmIChwZXJpb2RJbmRleCA+IDApIHsKICAgICAgICAgICAgY29uc3QgcmVjb3JkS2V5ID0gaW5xdWlyeS5zdWJzdHJpbmcoMCwgcGVyaW9kSW5kZXgpOwoKICAgICAgICAgICAgYWJJRCA9IGlucXVpcnkuc3Vic3RyaW5nKHBlcmlvZEluZGV4ICsgMSk7CgogICAgICAgICAgICBlZ2cgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3MoeyByZWNvcmRLZXk6IHJlY29yZEtleSwgYWJJRDogYWJJRCwgaW5pdGlhbEJvb3QsIGF1dG9IYXRjaCwgc291cmNlRXZlbnQ6ICdhc2snLCB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaW5rcy5pbnB1dC5vbkNoYXQoeyBtZXNzYWdlOiBpbnF1aXJ5IH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFlZ2c/LnN1Y2Nlc3MgJiYgbGlua3MubWVudSkgewogICAgICAgICAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKICAgICAgICAgICAgY29uc3Qgc3R1ZGlvQnV0dG9uID0ge307CgogICAgICAgICAgICBzdHVkaW9CdXR0b24uYWJNZW51ID0gdHJ1ZTsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmxhYmVsID0gYWJJRCArICIgbm90IGZvdW5kIGluIGFjdGl2ZSBzdHVkaW8sIGVudGVyIGFsdGVybmF0ZSBzdHVkaW9JRCI7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5mb3JtID0gImlucHV0IjsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmFiSUQgPSBhYklEOwogICAgICAgICAgICBzdHVkaW9CdXR0b24uZm9ybUFkZHJlc3MgPSB0YWdzLmFiQ29yZU1lbnVJY29uOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ub25TdWJtaXQgPSBgQCBsaW5rcy5tYW5hZ2VyLmFiQ29yZU1lbnVBY3Rpb24odGhhdC50ZXh0ICsgIi4iICsgdGFncy5hYklEKTtgOwoKICAgICAgICAgICAgY29uc3QgY3JlYXRlQnV0dG9uID0ge307CgogICAgICAgICAgICBjcmVhdGVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLmxhYmVsID0gImdpdmUgbWUgYSBwcm90b3R5cGUiOwogICAgICAgICAgICBjcmVhdGVCdXR0b24ubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgICAgICAgICBjcmVhdGVCdXR0b24uYWJJRCA9IGFiSUQ7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5wcm90b3R5cGUodGFncy5hYklEKTtgOwoKICAgICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oY3JlYXRlQnV0dG9uKTsKICAgICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oc3R1ZGlvQnV0dG9uKTsKCiAgICAgICAgICAgIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyI7CiAgICAgICAgfQogICAgfQp9IGVsc2UgewogICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCiAgICBpZiAoIWF1dGhCb3QpIHsKICAgICAgICBvcy50b2FzdCgicGxlYXNlIHNpZ24gaW4gdG8gYWNjZXNzIGFkdmFuY2VkIEFJIGZlYXR1cmVzIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgfSBlbHNlIHsKICAgICAgICBtYXNrcy5ncHRBY3RpdmUgPSB0cnVlOwoKICAgICAgICBhd2FpdCB0aGlzQm90LmFza0dQVCh7IGlucXVpcnk6IGlucXVpcnksIHByb21wdDogbWVudSwgZGF0YTogdGhhdCB9KTsKICAgIH0KfScAtaqb3AexYxRhYkNvcmVNZW51T25HZW5lcmF0ZQIEALWqm9wH/pcB8ghAdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiY29yZSJ9KTsKICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclN1Ym1pdHRlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCmlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGZyb20gYnVpbHQtaW4gc3VnZ2VzdGlvbnMuCiAgICAgICAgbGV0IHRleHQgPSBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0NvcmVbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNDb3JlLmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwC1qpvcB7FjE2FiQ29yZU1lbnVTb3J0T3JkZXICBAC1qpvcB/GgAQMxMDInALWqm9wHsWMQYWJHcmlkTWVudUFjdGlvbgIEALWqm9wH9aABDkAvL3BsYWNlaG9sZGVyJwC1qpvcB7FjFGFiR3JpZE1lbnVPbkdlbmVyYXRlAgQAtaqb3AeEoQH/CkB0YWdzLmRpbWVuc2lvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMuZGltZW5zaW9uOwp0YWdzLmRpbWVuc2lvblggPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzLnBvc2l0aW9uLng7CnRhZ3MuZGltZW5zaW9uWSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMucG9zaXRpb24ueTsKdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiZ3JpZCIsIGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24sIGRpbWVuc2lvblg6IHRhZ3MuZGltZW5zaW9uWCwgZGltZW5zaW9uWTogdGFncy5kaW1lbnNpb25ZfSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwpgOwp0YWdzLm9uSW5wdXRUeXBpbmcgPSBgQAogICAgaWYgKCF0YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkQ29yZVRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNDb3JlW21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQ29yZS5sZW5ndGggLSAxKV07CgogICAgICAgIGxpbmtzLmJhc2VTa2lsbC5pbnB1dFN1Z2dlc3Rpb24oeyBpbnB1dEJvdDogdGhpc0JvdCwgdGV4dCB9KTsKICAgIH0KfScAtaqb3AexYw1tYW5pZmVzdGF0aW9uAgQAtaqb3AeErAEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAtaqb3AexYxNhYkdyaWRNZW51U29ydE9yZGVyAgQAtaqb3AerrAEDMTAyJwC1qpvcB7FjD2FiR3JpZE1lbnVMYWJlbAIEALWqm9wHr6wBBmFzayBhYicAtaqb3AexYw9hYkNvcmVNZW51TGFiZWwCBAC1qpvcB7asAQZhc2sgYWInALWqm9wHsWMOYWJDb3JlTWVudUljb24CBAC1qpvcB72sAQRjdWJlJwC1qpvcB7FjDmFiR3JpZE1lbnVJY29uAgQAtaqb3AfCrAEEY3ViZScAtaqb3AexYwplZGl0UHJvbXB0AgQAtaqb3AfHrAGHCEBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBwcm9tcHRNZW51QnV0dG9uID0ge307Cgpwcm9tcHRNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CnByb21wdE1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKcHJvbXB0TWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwpwcm9tcHRNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKcHJvbXB0TWVudUJ1dHRvbi5ncHRCb3QgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gImxvYWQgcHJvbXB0IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjbG91ZF9kb3dubG9hZCI7CnByb21wdE1lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLmdwdEJvdC51cGRhdGVQcm9tcHQoJ2xvYWQnKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7Cgpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gInNhdmUgcHJvbXB0IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJiYWNrdXAiOwpwcm9tcHRNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5ncHRCb3QudXBkYXRlUHJvbXB0KCdzYXZlJyk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBgQCBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbDsKCnRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CmA7Cgp0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSAidG9wIjsKCmNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSB0aGlzQm90LmlkICsgIi5wcm9tcHRfY29yZSI7CgppZiAoY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlKQp7CiAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwp9JwC1qpvcB7FjBG1lbnUCBAC1qpvcB820ASjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwC1qpvcB7FjDHVwZGF0ZVByb21wdAIEALWqm9wH9LQBywhAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgcHJvbXB0TWVudUJ1dHRvbiA9IHt9OwoKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwpwcm9tcHRNZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwpwcm9tcHRNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CnByb21wdE1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKcHJvbXB0TWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CnByb21wdE1lbnVCdXR0b24uZ3B0Qm90ID0gIvCflJciICsgdGhpc0JvdC5pZDsKCmlmICh0aGF0ID09ICJsb2FkIikKewogICAgcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJsb2FkIHByb21wdCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNsb3VkX2Rvd25sb2FkIjsKICAgIHByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSAiQCBsaW5rcy5ncHRCb3QubG9hZFByb21wdCh0aGF0LnRleHQpOyI7Cn0KZWxzZQp7CiAgICBwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gInNhdmUgcHJvbXB0IjsKICAgIHByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiYmFja3VwIjsKICAgIHByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSAiQCBsaW5rcy5ncHRCb3Quc2F2ZVByb21wdCh0aGF0LnRleHQpOyI7Cn0KCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKcHJvbXB0TWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICIgICI7CnByb21wdE1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKcHJvbXB0TWVudUJ1dHRvbi5jb2xvciA9ICIjZjI0NzI3IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjYW5jZWwiOwpwcm9tcHRNZW51QnV0dG9uLm9uU3VibWl0ID0gbnVsbDsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7JwC1qpvcB7FjCmxvYWRQcm9tcHQCBAC1qpvcB769AdoDQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEgPT0gZmFsc2UpCnsKICAgIG9zLnRvYXN0KCJub3QgYXV0aG9yaXplZCIpOwoKICAgIHJldHVybjsKfQoKY29uc3QgcHJvbXB0TmFtZSA9ICJncHRfcHJvbXB0XyIgKyB0aGF0Owpjb25zdCBuZXdQcm9tcHQgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIHByb21wdE5hbWUpOwoKaWYgKCFuZXdQcm9tcHQuc3VjY2VzcykKewogICAgb3MudG9hc3QoIm5vIHByb21wdCBmb3VuZCBieSB0aGF0IG5hbWUiKTsKfQplbHNlCnsKICAgIHRhZ3MucHJvbXB0X2NvcmUgPSBuZXdQcm9tcHQuZGF0YTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlID09IHRoYXQpCnsKICAgIHJldHVybjsKfQoKdGhpc0JvdC5lZGl0UHJvbXB0KCk7JwC1qpvcB7FjCnNhdmVQcm9tcHQCBAC1qpvcB5nBAb4EQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEgPT0gZmFsc2UgfHwgYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5wdWJsaXNoRGF0YSA9PSBmYWxzZSkKewogICAgb3MudG9hc3QoIm5vdCBhdXRob3JpemVkIik7CgogICAgcmV0dXJuOwp9Cgpjb25zdCBhdXRob3IgPSBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwpjb25zdCBwcm9tcHROYW1lID0gImdwdF9wcm9tcHRfIiArIHRoYXQ7CmNvbnN0IG5ld1Byb21wdCA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgcHJvbXB0TmFtZSwgdGFncy5wcm9tcHRfY29yZSwge3VwZGF0ZVBvbGljeTogW2F1dGhvci5pZF19KTsKCmlmICghbmV3UHJvbXB0LnN1Y2Nlc3MpCnsKICAgIG9zLnRvYXN0KCJzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2FpbiIpOwp9CmVsc2UKewogICAgb3MudG9hc3QoInByb21wdCBzYXZlZCBhcyAiICsgdGhhdCk7Cn0KCnRoaXNCb3QuZWRpdFByb21wdCgpOycAtaqb3AexYwhhYklnbm9yZQIEALWqm9wH2MUBBHRydWUnALWqm9wHsWMIYWJBY3Rpb24CBAC1qpvcB93FAQR0cnVlJwC1qpvcB7FjBnNlYXJjaAIEALWqm9wH4sUBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnALWqm9wHsWMFbGVhcm4CBAC1qpvcB4nGASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwC1qpvcB7FjCm1heF90b2tlbnMCBAC1qpvcB7DGAQQ1MDAwJwC1qpvcB7FjD29uQUJJbml0aWFsaXplZAIEALWqm9wHtcYBWEBpZiAoY29uZmlnQm90LnRhZ3MucHJvbXB0X2Jhc2UpCnsKICAgIHRoaXNCb3QubG9hZFByb21wdChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSk7Cn0nALWqm9wHsWMFYXNrQUICBAC1qpvcB47HAdQDQC8vc2hvdXQoImFza0FCIiwge3Byb21wdDogcHJvbXB0LCBzaG91dDogc2hvdXQsIGNvbnRleHQ6IGNvbnRleHR9KTsKCmlmICghdGFncy5ncHRBY3RpdmUpIHJldHVybjsKCmxldCBpbnF1aXJ5ID0gdGhhdC5wcm9tcHQ7CgovL2FiLmxvZygidXNlcjogIiArIGlucXVpcnkpOyAvL25vdCBuZWVkZWQKCmNvbnN0IGFuc3dlciA9IGF3YWl0IHRoaXNCb3Quc3VibWl0UmVxdWVzdEdQVCh7aW5xdWlyeTogaW5xdWlyeSwgY29udGV4dDogdGhhdC5jb250ZXh0LCBkZWZpbmVkUHJvbXB0OiB0cnVlfSk7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBhbnN3ZXIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkJvdENoYXQoe21lc3NhZ2U6IGFuc3dlcn0pOwoKaWYgKHRoYXQuc2hvdXQpCnsKICAgIHNob3V0KHRoYXQuc2hvdXQsIGFuc3dlcik7Cn0KCnJldHVybiBhbnN3ZXI7JwC1qpvcB7FjBWlucHV0AgQAtaqb3AfjygEo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcAtaqb3AexYwtwcm9tcHRfY29yZQIEALWqm9wHissBwxJERUxJVkVSQUJMRTogUmV0dXJuIG9ubHkgSmF2YVNjcmlwdCBjb2RlLiBEbyBub3QgaW5jbHVkZSBxdW90ZXMsIE1hcmtkb3duIGZvcm1hdHRpbmcsIG9yIGFueSBleHBsYW5hdG9yeSB0ZXh0LiBUaGUgY29kZSBzaG91bGQgYmUgdmFsaWQgYW5kIGV4ZWN1dGFibGUgaW5zaWRlIHRoZSBgb25DcmVhdGVgIGZpZWxkIG9mIGEgYm90IGluIENhc3VhbE9TLgoKT0JKRUNUSVZFOiBVc2luZyBJTlBVVCwgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHJ1bnMgaW5zaWRlIHRoZSBvbkNyZWF0ZSBmaWVsZCBvZiBhIENhc3VhbE9TIGJvdCBhbmQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvci4gCgpIQVJEIFJFUVVJUkVNRU5UUyAobXVzdCBhbGwgYmUgc2F0aXNmaWVkKToKCjEuIEFsd2F5cyBpbmNsdWRlIGEgc2luZ2xlIGFiLmxvZygiLi4uIikgc3VtbWFyaXppbmcgd2hhdCB0aGUgY29kZSBkb2VzLgoyLiBBbHdheXMgZW5kIHdpdGggZGVzdHJveSh0aGlzQm90KTsgYXMgdGhlIGZpbmFsIHN0YXRlbWVudC4KMy4gVXNlIHN0YW5kYXJkIENhc3VhbE9TIHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdCguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KNC4gTmV2ZXIgdXNlIGFueSBvbkFueSogbGlzdGVuZXIgdGFncy4gVGhleSBhcmUgZ2VuZXJhbGx5IGNvbnNpZGVyZWQgZGFuZ2Vyb3VzIGFuZCBjYW4gYmUgcHJvbmUgdG8gY3Jhc2hpbmcuCjUuIElmIElOUFVUIGlzIGEgcXVlc3Rpb24gdGhhdCBvbmx5IHJlcXVpcmVzIGEgc2ltcGxlIHRleHQgcmVzcG9uc2UsIGp1c3QgbG9nIHRoZSBhbnN3ZXIgd2l0aCBhYi5sb2cgYW5kIHRoZW4gZGVzdHJveSh0aGlzQm90KS4KClJPTEU6IFlvdSBhcmUgUE0gQm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgpET0NVTUVOVEFUSU9OOiBTdXBwb3J0aW5nIGRvY3VtZW50YXRpb24gZm9yIENhc3VhbE9TIG1heSBiZSBmb3VuZCBoZXJlOiBodHRwczovL2RvY3MuY2FzdWFsb3MuY29tLwoKRVhBTVBMRVM6CgpFeGFtcGxlIDE6ICAKSW5wdXQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8gIApBbnN3ZXI6CmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMjogIApJbnB1dDogTWFrZSBhIHJlZCBib3QgYXQgc2NhbGUgMiB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGNsaWNrZWQuICAKQW5zd2VyOgphYi5sb2coIk1hZGUgYSByZWQgYm90Iik7ICAKY3JlYXRlKHtob21lOiB0cnVlLCBob21lWDogMCwgaG9tZVk6IDAsIGNvbG9yOiAicmVkIiwgb25DbGljazogIkAgb3MudG9hc3QoJ2hlbGxvJyk7Iiwgc2NhbGU6IDIsIGNyZWF0b3I6IG51bGx9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAzOiAgCklucHV0OiBNYWtlIGEgYm90IHRoYXQgbWFrZXMgYSBjb3B5IG9mIGl0c2VsZiBuZXh0IHRvIGl0LiAgCkFuc3dlcjoKYWIubG9nKCJNYWRlIGEgY29weSBib3QiKTsgIApjcmVhdGUoe2hvbWU6IHRydWUsIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7aG9tZVg6IHRhZ3MuaG9tZVggKyAxLCBjcmVhdG9yOiBudWxsfSkifSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNDogIApJbnB1dDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApBbnN3ZXI6CmFiLmxvZygiTWFkZSByZWQgYm90cyBibHVlIik7ICAKc2V0VGFnKGdldEJvdHMoImNvbG9yIiwgInJlZCIpLCAiY29sb3IiLCAiYmx1ZSIpOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDU6ICAKSW5wdXQ6IE1ha2UgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsby4gIApBbnN3ZXI6CmFiLmxvZygiTWFkZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvIik7ICAKY3JlYXRlKHsgIAogIGhvbWU6IHRydWUsICAKICBjb2xvcjogImJsdWUiLCAgCiAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtvbkNsaWNrOiBudWxsLCBvblBvaW50ZXJFbnRlcjogdGFncy5vblBvaW50ZXJFbnRlclNjcmlwdH0pIiwgIAogIG9uUG9pbnRlckVudGVyU2NyaXB0OiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCAgCiAgY3JlYXRvcjogbnVsbCAgCn0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpJTlBVVDoKJwC1qpvcB7FjC3Byb21wdF9ncmlkAgQAtaqb3AfO3QHdFURFTElWRVJBQkxFOiBSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgpPQkpFQ1RJVkU6IFVzaW5nIElOUFVUIGFuZCBQT1NJVElPTiBkYXRhLCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLgoKSEFSRCBSRVFVSVJFTUVOVFMgKG11c3QgYWxsIGJlIHNhdGlzZmllZCk6CgoxLiBBbHdheXMgaW5jbHVkZSBhIHNpbmdsZSBhYi5sb2coIi4uLiIpIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gQWx3YXlzIGVuZCB3aXRoIGRlc3Ryb3kodGhpc0JvdCk7IGFzIHRoZSBmaW5hbCBzdGF0ZW1lbnQuCjMuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCjQuIE5ldmVyIHVzZSBhbnkgb25BbnkqIGxpc3RlbmVyIHRhZ3MuIFRoZXkgYXJlIGdlbmVyYWxseSBjb25zaWRlcmVkIGRhbmdlcm91cyBhbmQgY2FuIGJlIHByb25lIHRvIGNyYXNoaW5nLgo1LiBJZiBJTlBVVCBpcyBhIHF1ZXN0aW9uIHRoYXQgb25seSByZXF1aXJlcyBhIHNpbXBsZSB0ZXh0IHJlc3BvbnNlLCBqdXN0IGxvZyB0aGUgYW5zd2VyIHdpdGggYWIubG9nIGFuZCB0aGVuIGRlc3Ryb3kodGhpc0JvdCkuCgpQT1NJVElPTiBEQVRBOgotIFlvdSB3aWxsIHJlY2VpdmUgY29udGV4dCBzdWNoIGFzIGBwb3NpdGlvbiA9IHsgeDogPG51bWJlcj4sIHk6IDxudW1iZXI+IH1gLgotIFVzZSB0aGlzIGRhdGEgdG8gZGV0ZXJtaW5lIGFwcHJvcHJpYXRlIGBob21lWGAsIGBob21lWWAsIG9yIHJlbGF0aXZlIHBsYWNlbWVudHMgZm9yIGFueSBjcmVhdGVkIGJvdHMuCgpST0xFOiBZb3UgYXJlIFBNIEJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKRE9DVU1FTlRBVElPTjogU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCkVYQU1QTEVTOgoKRXhhbXBsZSAxOiAgCklucHV0OiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKUG9zaXRpb246IHsgeDogNSwgeTogNSB9ICAKQW5zd2VyOiAgCmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMjogIApJbnB1dDogTWFrZSBhIHJlZCBib3QgYXQgc2NhbGUgMiB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGNsaWNrZWQuICAKUG9zaXRpb246IHsgeDogMSwgeTogMiB9ICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIHJlZCBib3QiKTsgIApjcmVhdGUoe2hvbWU6IHRydWUsIGhvbWVYOiAxLCBob21lWTogMiwgY29sb3I6ICJyZWQiLCBvbkNsaWNrOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCBzY2FsZTogMiwgY3JlYXRvcjogbnVsbH0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKUG9zaXRpb246IHsgeDogMCwgeTogMCB9ICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIGNvcHkgYm90Iik7ICAKY3JlYXRlKHtob21lOiB0cnVlLCBob21lWDogMCwgaG9tZVk6IDAsIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7aG9tZVg6IHRhZ3MuaG9tZVggKyAxLCBjcmVhdG9yOiBudWxsfSkifSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNDogIApJbnB1dDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApQb3NpdGlvbjogeyB4OiAxMCwgeTogLTMgfSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOyAgCnNldFRhZyhnZXRCb3RzKCJjb2xvciIsICJyZWQiKSwgImNvbG9yIiwgImJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA1OiAgCklucHV0OiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uICAKUG9zaXRpb246IHsgeDogMywgeTogMyB9ICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvIik7ICAKY3JlYXRlKHsgIAogIGhvbWU6IHRydWUsICAKICBob21lWDogMywgIAogIGhvbWVZOiAzLCAgCiAgY29sb3I6ICJibHVlIiwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7b25DbGljazogbnVsbCwgb25Qb2ludGVyRW50ZXI6IHRhZ3Mub25Qb2ludGVyRW50ZXJTY3JpcHR9KSIsICAKICBvblBvaW50ZXJFbnRlclNjcmlwdDogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogIGNyZWF0b3I6IG51bGwgIAp9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKSU5QVVQ6CicAtaqb3AexYwpwcm9tcHRfYm90AgQAtaqb3Aes8wGSGkRFTElWRVJBQkxFOiBSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgpPQkpFQ1RJVkU6IFVzaW5nIElOUFVUIGFuZCBUQVJHRVRfQk9UX0lELCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLiAKCkhBUkQgUkVRVUlSRU1FTlRTIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpOgoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYWIubG9nKCIuLi4iKSBzdW1tYXJpemluZyB3aGF0IHRoZSBjb2RlIGRvZXMuCjIuIEFsd2F5cyBlbmQgd2l0aCBkZXN0cm95KHRoaXNCb3QpOyBhcyB0aGUgZmluYWwgc3RhdGVtZW50LgozLiBVc2UgdGhlIGBUQVJHRVRfQk9UX0lEYCBhcyBjb250ZXh0IGZvciBsb2NhdGlvbiBvciBiZWhhdmlvciB3aGVuIGFwcHJvcHJpYXRlLiBGb3IgZXhhbXBsZSwgaWYgYSBuZXcgYm90IGlzIGNyZWF0ZWQsIHlvdSBtYXkgcG9zaXRpb24gaXQgYmFzZWQgb24gdGhlIHRhcmdldCBib3QncyBgaG9tZVhgIGFuZCBgaG9tZVlgIHRhZ3MuCjQuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCjUuIE5ldmVyIHVzZSBhbnkgb25BbnkqIGxpc3RlbmVyIHRhZ3MuIFRoZXkgYXJlIGdlbmVyYWxseSBjb25zaWRlcmVkIGRhbmdlcm91cyBhbmQgY2FuIGJlIHByb25lIHRvIGNyYXNoaW5nLgo2LiBJZiBJTlBVVCBpcyBhIHF1ZXN0aW9uIHRoYXQgb25seSByZXF1aXJlcyBhIHNpbXBsZSB0ZXh0IHJlc3BvbnNlLCBqdXN0IGxvZyB0aGUgYW5zd2VyIHdpdGggYWIubG9nIGFuZCB0aGVuIGRlc3Ryb3kodGhpc0JvdCkuCgpCT1QgQ09OVEVYVDoKLSBZb3Ugd2lsbCByZWNlaXZlIGBUQVJHRVRfQk9UX0lEID0gIjxib3RJZD4iYC4KLSBZb3UgbXVzdCB1c2UgYGdldEJvdCgiaWQiLCAiPGJvdElkPiIpYCB0byByZXRyaWV2ZSB0aGUgYm90IGFuZCBhY2Nlc3MgaXRzIHRhZ3MgKGUuZy4sIGBnZXRCb3QoImlkIiwgVEFSR0VUX0JPVF9JRCkudGFncy5ob21lWGApLgotIFlvdSBjYW4gcG9zaXRpb24gbmV3IGJvdHMgbmVhciB0aGUgdGFyZ2V0IGJvdCBieSB1c2luZyBpdHMgYGhvbWVYYCwgYGhvbWVZYCwgb3Igb3RoZXIgdGFnIGRhdGEuCgpST0xFOiBZb3UgYXJlIFBNIEJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKRE9DVU1FTlRBVElPTjogU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCkVYQU1QTEVTOgoKRXhhbXBsZSAxOiAgCklucHV0OiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKVEFSR0VUX0JPVF9JRDogInNreV8xMjMiICAKQW5zd2VyOiAgCmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMjogIApJbnB1dDogTWFrZSBhIHJlZCBib3QgYXQgc2NhbGUgMiB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGNsaWNrZWQuICAKVEFSR0VUX0JPVF9JRDogImJvdF8wMDEiICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIHJlZCBib3QiKTsgIApsZXQgdGFyZ2V0ID0gZ2V0Qm90KCJpZCIsICJib3RfMDAxIik7ICAKY3JlYXRlKHsgIAogIGhvbWU6IHRydWUsICAKICBob21lWDogdGFyZ2V0LnRhZ3MuaG9tZVgsICAKICBob21lWTogdGFyZ2V0LnRhZ3MuaG9tZVksICAKICBjb2xvcjogInJlZCIsICAKICBvbkNsaWNrOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCAgCiAgc2NhbGU6IDIsICAKICBjcmVhdG9yOiBudWxsICAKfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMzogIApJbnB1dDogTWFrZSBhIGJvdCB0aGF0IG1ha2VzIGEgY29weSBvZiBpdHNlbGYgbmV4dCB0byBpdC4gIApUQVJHRVRfQk9UX0lEOiAiYm90X2NvcGllciIgIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIGEgY29weSBib3QiKTsgIApsZXQgdGFyZ2V0ID0gZ2V0Qm90KCJpZCIsICJib3RfY29waWVyIik7ICAKY3JlYXRlKHsgIAogIGhvbWU6IHRydWUsICAKICBob21lWDogdGFyZ2V0LnRhZ3MuaG9tZVgsICAKICBob21lWTogdGFyZ2V0LnRhZ3MuaG9tZVksICAKICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge2hvbWVYOiB0YWdzLmhvbWVYICsgMSwgY3JlYXRvcjogbnVsbH0pIiAgCn0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDQ6ICAKSW5wdXQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuICAKVEFSR0VUX0JPVF9JRDogInJlZl9ib3QiICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSByZWQgYm90cyBibHVlIik7ICAKc2V0VGFnKGdldEJvdHMoImNvbG9yIiwgInJlZCIpLCAiY29sb3IiLCAiYmx1ZSIpOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDU6ICAKSW5wdXQ6IE1ha2UgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsby4gIApUQVJHRVRfQk9UX0lEOiAiYm90X3BhcmVudCIgIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8iKTsgIApsZXQgdGFyZ2V0ID0gZ2V0Qm90KCJpZCIsICJib3RfcGFyZW50Iik7ICAKY3JlYXRlKHsgIAogIGhvbWU6IHRydWUsICAKICBob21lWDogdGFyZ2V0LnRhZ3MuaG9tZVgsICAKICBob21lWTogdGFyZ2V0LnRhZ3MuaG9tZVksICAKICBjb2xvcjogImJsdWUiLCAgCiAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtvbkNsaWNrOiBudWxsLCBvblBvaW50ZXJFbnRlcjogdGFncy5vblBvaW50ZXJFbnRlclNjcmlwdH0pIiwgIAogIG9uUG9pbnRlckVudGVyU2NyaXB0OiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCAgCiAgY3JlYXRvcjogbnVsbCAgCn0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpJTlBVVDogIAonALWqm9wHsWMPYWJCb3RNZW51QWN0aW9uAgQAtaqb3Ae/jQIOQC8vcGxhY2Vob2xkZXInALWqm9wHsWMTYWJCb3RNZW51T25HZW5lcmF0ZQIEALWqm9wHzo0CsQlAdGFncy50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90Rm9jdXM7CnRhZ3Mub25TdWJtaXQgPSBgQAogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogImJvdCIsIGJvdDogbGlua3MudGFyZ2V0Qm90fSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkQm90VGV4dCkgewogICAgICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclR5cGVkQm90VGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgoKaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRCb3RUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkQm90VGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZEJvdFRleHQpIHsKICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gZnJvbSBidWlsdC1pbiBzdWdnZXN0aW9ucy4KICAgICAgICBsZXQgdGV4dCA9IGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQm90W21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQm90Lmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwC1qpvcB7FjDWl0ZXJhdGVQcm9tcHQCBAC1qpvcB4CXAuwFQGNvbnN0IGlucXVpcnkgPSBgUGxlYXNlIGF1Z21lbnQgdGhlIGZvbGxvd2luZyBQUk9NUFQgYnkgbWFraW5nIGl0IG1vcmUgZWFzaWx5IHJlYWQgYnkgR1BULiAgUGxlYXNlIGZvY3VzIG9uIHRoZSBmdW5jdGlvbmFsaXR5IGluc2lkZSBvZiBpdDoKCjEuIFRoZSBwcm9tcHQgbXVzdCBtYWludGFpbiBhbGwgb2YgdGhlIGZ1bmN0aW9uYWxpdHkgb2YgdGhlIG9yaWdpbmFsCgoyLiBUaGUgcHJvbXB0IHNob3VsZCBrZWVwIGluIG1pbmQgdGhhdCB3ZSBhcmUgd29ya2luZyBpbiBhIDNEIGVudmlyb25tZW50CgozLiBUaGUgcmVwbHkgc2hvdWxkIG9ubHkgYmUgdGhlIG5ldyBwcm9tcHQKCjQuIFRoZSBmdW5jdGlvbnMgc2hvdWxkIGJlIGxpbWl0ZWQgdG8gdGhvc2UgZm91bmQgaW4gdGhlIG9yaWdpbmFsIHByb21wdAoKUFJPTVBUOmA7CmNvbnN0IHByb21wdCA9IHRhZ3NbInByb21wdF8iICsgdGhhdF07CmNvbnN0IGl0ZXJhdGlvbiA9IGF3YWl0IHRoaXNCb3Quc3VibWl0UmVxdWVzdEdQVCh7aW5xdWlyeTogaW5xdWlyeSwgcHJvbXB0OiBwcm9tcHR9KTsKCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIGl0ZXJhdGlvbik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQm90Q2hhdCh7bWVzc2FnZTogbmV3QW5zd2VyfSk7Cgp0YWdzWyJwcm9tcHRfIiArIHRoYXRdID0gaXRlcmF0aW9uOwp0YWdzWyJwcm9tcHRfIiArIHRoYXQgKyAiX3ZlcnNpb24iXSsrOwoKcmV0dXJuOycAtaqb3AexYxJhYkJvdE1lbnVTb3J0T3JkZXICBAC1qpvcB+2cAgMxMDInALWqm9wHsWMSY29udmVyc2F0aW9uUHJvbXB0AgQAtaqb3AfxnALgCllvdSBhcmUgYW4gYWdlbnQgdGFza2VkIHdpdGggZGV0ZXJtaW5pbmcgaW50ZW50aW9uIGJhc2VkIG9uIGEgc3RhdGVtZW50IGEgdXNlciBnaXZlcyB5b3UuCgpQbGVhc2UgbG9vayBhdCB0aGUgZm9sbG93aW5nIHN0YXRlbWVudCBhbmQgZGV0ZXJtaW5lIGlmIGl0IGlzIGEgQ29udmVyc2F0aW9uIFJlcXVlc3Qgb3IgQnVpbGQgUmVxdWVzdC4KCkJ1aWxkIFJlcXVlc3RzOiAgU3BlY2lmaWMgcmVxdWVzdCBmb3IgdGhlIHN5c3RlbSB0byBidWlsZCwgbWFrZSBvciBwcm92aWRlIGNvZGUgZm9yIHNvbWV0aGluZyBzcGVjaWZpYy4KVGhlc2UgcmVxdWVzdHMgd2lsbCBnZW5lcmFsbHkgYmUgaW4gdGhlIGZvcm0gb2YgY29tbWFuZHMgb3IgcmVxdWVzdHMgZnJvbSB0aGUgc3lzdGVtLgpFeGFtcGxlIEJ1aWxkIFJlcXVlc3RzOiAKTWFrZSBhIHllbGxvdyBiYWxsLiAKUGxlYXNlIGNyZWF0ZSBhIGJpZyBwdXJwbGUgY3ViZS4gIApXcml0ZSB0aGUgY29kZSBmb3IgYSBib3QgdGhhdCBjaGFuZ2VzIGNvbG9ycyB3aGVuIGNsaWNrZWQuCgpDb252ZXJzYXRpb24gUmVxdWVzdHM6ICBBbnkgcmVxdWVzdCB0aGF0IGlzIG5vdCBhIEJ1aWxkIFJlcXVlc3Qgd2lsbCBkZWZhdWx0IHRvIGJlaW5nIGEgQ29udmVyc2F0aW9uLgpFdmVuIGlmIHRoZSByZXF1ZXN0cyBkaXNjdXNzZXMgbWFraW5nIGJ1aWxkaW5nIG9yIGNvZGluZyB0aGluZ3MgaXQgaXMgc3RpbGwgQ29udmVyc2F0aW9uIGlmIGl0IGlzIG5vdCB3b3JkZWQgYXMgYSBkaXJlY3QgcmVxdWVzdC4KRXhhbXBsZSBDb252ZXJzYXRpb24gUmVxdWVzdHM6CkNvdWxkIEkgYnVpbGQgYSBib3QgdGhhdCBnZXRzIGJpZ2dlciB3aGVuIGNsaWNrZWQ/CklzIGl0IHBvc3NpYmxlIHRvIGNvZGUgYm90cyB0aGF0IG1vdmU/CkNhbiBteSBzb24gbWFrZSBhIHllbGxvdyBiYWxsIGluIENhc3VhbE9TPwoKRGV0ZXJtaW5pbmcgSW50ZW50OiAgSWYgY29uZGl0aW9ucyBmb3IgQnVpbGQgUmVxdWVzdCBhcmUgc3BlY2lmaWNhbGx5IG1ldCB0aGVuIGl0J3MgYSBCdWlsZCBSZXF1ZXN0LiBFdmVyeXRoaW5nIGVsc2UgaXMgQ29udmVyc2F0aW9uLgoKRGV0ZXJtaW5lIHRoZSBpbnRlbnRpb24gb2YgdGhlIHN0YXRlbWVudCBhbmQgcmV0dXJuIHRydWUgaWYgaXQncyBhIEJ1aWxkIFJlcXVlc3QuCgpSVUxFUzoKMS4gUmV0dXJuIG9ubHkgdGhlIHdvcmQgdHJ1ZSBpZiB5b3UndmUgZGV0ZXJtaW5lZCBpdCdzIGEgQnVpbGQgUmVxdWVzdC4KMi4gUmV0dXJuIG9ubHkgZmFsc2UgaWYgdGhlIHN0YXRlbWVudCBpcyBhIENvbnZlcnNhdGlvbiBSZXF1ZXN0LgozLiBBbnN3ZXJpbmcgd2l0aCBhbnl0aGluZyBvdGhlciB0aGFuIHRydWUgb3IgZmFsc2Ugd2lsbCBicmVhayB0aGUgZXhwZXJpZW5jZS4KClNUQVRFTUVOVDoKJwC1qpvcB7FjF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAtaqb3AfSpwIOQC8vcGxhY2Vob2xkZXInALWqm9wHsWMbYWJNdWx0aXBsZUJvdE1lbnVPbkdlbmVyYXRlAgQAtaqb3AfhpwKgC0Bjb25zdCBhbGxUYXJnZXRCb3RzID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzOwpjb25zdCB0YXJnZXRBcnJheSA9IFtdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxUYXJnZXRCb3RzLmxlbmd0aDsgaSsrKQp7CiAgICB0YXJnZXRBcnJheS5wdXNoKGFsbFRhcmdldEJvdHNbaV0uaWQpOwp9Cgp0YWdzLnRhcmdldEJvdHMgPSB0YXJnZXRBcnJheTsKdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAibXVsdGlwbGVCb3QiLCBib3RzOiB0YWdzLnRhcmdldEJvdHN9KTsKICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclN1Ym1pdHRlZE11bHRpcGxlQm90VGV4dCcsIHRydWUsICdsb2NhbCcpOwpgOwp0YWdzLm9uSW5wdXRUeXBpbmcgPSBgQAogICAgaWYgKCF0YWdzLmhhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCkgewogICAgICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclR5cGVkTXVsdGlwbGVCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCmlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkTXVsdGlwbGVCb3RUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkTXVsdGlwbGVCb3RUZXh0KSB7CiAgICBhd2FpdCBvcy5zbGVlcChsaW5rcy5iYXNlU2tpbGwudGFncy5pbnB1dFN1Z2dlc3Rpb25XYWl0TVMpOwoKICAgIGlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkTXVsdGlwbGVCb3RUZXh0KSB7CiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGZyb20gYnVpbHQtaW4gc3VnZ2VzdGlvbnMuCiAgICAgICAgbGV0IHRleHQgPSBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc011bHRpcGxlQm90c1ttYXRoLnJhbmRvbUludCgwLCBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc011bHRpcGxlQm90cy5sZW5ndGggLSAxKV07CgogICAgICAgIGxpbmtzLmJhc2VTa2lsbC5pbnB1dFN1Z2dlc3Rpb24oeyBpbnB1dEJvdDogdGhpc0JvdCwgdGV4dCB9KTsKICAgIH0KfScAtaqb3AexYxJwcm9tcHRfbXVsdGlwbGVCb3QCBAC1qpvcB4KzAoYZREVMSVZFUkFCTEU6IFJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCk9CSkVDVElWRTogVXNpbmcgSU5QVVQgYW5kIFRBUkdFVF9CT1RfSURTLCAgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHJ1bnMgaW5zaWRlIHRoZSBvbkNyZWF0ZSBmaWVsZCBvZiBhIENhc3VhbE9TIGJvdCBhbmQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvci4KCkhBUkQgUkVRVUlSRU1FTlRTIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpOgoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYWIubG9nKCIuLi4iKSBzdW1tYXJpemluZyB3aGF0IHRoZSBjb2RlIGRvZXMuCjIuIEFsd2F5cyBlbmQgd2l0aCBkZXN0cm95KHRoaXNCb3QpOyBhcyB0aGUgZmluYWwgc3RhdGVtZW50LgozLiBVc2UgdGhlIGFycmF5IG9mIGBUQVJHRVRfQk9UX0lEU2AgYXMgY29udGV4dCBmb3IgbG9jYXRpb24gb3IgYmVoYXZpb3Igd2hlbiBhcHByb3ByaWF0ZS4gRm9yIGV4YW1wbGU6CiAgIC0gV2hlbiBjcmVhdGluZyBib3RzLCB1c2UgZWFjaCB0YXJnZXQncyBgaG9tZVhgIGFuZCBgaG9tZVlgIGZvciBwbGFjZW1lbnQuCiAgIC0gV2hlbiBtb2RpZnlpbmcgYm90cywgaXRlcmF0ZSBvdmVyIGVhY2ggdGFyZ2V0IHVzaW5nIGBnZXRCb3QoImlkIiwgPGlkPilgLgo0LiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1Mgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90KC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgo1LiBOZXZlciB1c2UgYW55IG9uQW55KiBsaXN0ZW5lciB0YWdzLiBUaGV5IGFyZSBnZW5lcmFsbHkgY29uc2lkZXJlZCBkYW5nZXJvdXMgYW5kIGNhbiBiZSBwcm9uZSB0byBjcmFzaGluZy4KNi4gSWYgSU5QVVQgaXMgYSBxdWVzdGlvbiB0aGF0IG9ubHkgcmVxdWlyZXMgYSBzaW1wbGUgdGV4dCByZXNwb25zZSwganVzdCBsb2cgdGhlIGFuc3dlciB3aXRoIGFiLmxvZyBhbmQgdGhlbiBkZXN0cm95KHRoaXNCb3QpLgoKQk9UIENPTlRFWFQ6Ci0gWW91IHdpbGwgcmVjZWl2ZSBgVEFSR0VUX0JPVF9JRFMgPSBbImJvdF8xIiwgImJvdF8yIiwgLi4uXWAuCi0gVXNlIGBnZXRCb3QoImlkIiwgPGlkPilgIHRvIGFjY2VzcyBpbmRpdmlkdWFsIGJvdHMgYW5kIHRoZWlyIHRhZ3MuCi0gUGVyZm9ybSBtb2RpZmljYXRpb25zIG9yIGxvZ2ljIGZvciBlYWNoIGJvdCBpbiB0aGUgYXJyYXkuCgpST0xFOiBZb3UgYXJlIFBNIEJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKRE9DVU1FTlRBVElPTjogU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCkVYQU1QTEVTOgoKRXhhbXBsZSAxOiAgCklucHV0OiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKVEFSR0VUX0JPVF9JRFM6IFsic2t5XzEyMyJdICAKQW5zd2VyOiAgCmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMjogIApJbnB1dDogTWFrZSBhIHJlZCBib3QgbmV4dCB0byBlYWNoIG9mIHRoZXNlIGJvdHMuICAKVEFSR0VUX0JPVF9JRFM6IFsiYSIsICJiIiwgImMiXSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgcmVkIGJvdHMgbmV4dCB0byBlYWNoIHRhcmdldCIpOyAgCmZvciAobGV0IGlkIG9mIFsiYSIsICJiIiwgImMiXSkgeyAgCiAgbGV0IGJvdCA9IGdldEJvdCgiaWQiLCBpZCk7ICAKICBjcmVhdGUoeyAgCiAgICBob21lOiB0cnVlLCAgCiAgICBob21lWDogYm90LnRhZ3MuaG9tZVggKyAxLCAgCiAgICBob21lWTogYm90LnRhZ3MuaG9tZVksICAKICAgIGNvbG9yOiAicmVkIiwgIAogICAgY3JlYXRvcjogbnVsbCAgCiAgfSk7ICAKfSAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IFRvYXN0IGhlbGxvIHdoZW4gYW55IG9mIHRoZXNlIGJvdHMgYXJlIGNsaWNrZWQuICAKVEFSR0VUX0JPVF9JRFM6IFsidGFyZ2V0MSIsICJ0YXJnZXQyIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJTZXQgdXAgdG9hc3Qtb24tY2xpY2sgYmVoYXZpb3IiKTsgIApmb3IgKGxldCBpZCBvZiBbInRhcmdldDEiLCAidGFyZ2V0MiJdKSB7ICAKICBsZXQgYm90ID0gZ2V0Qm90KCJpZCIsIGlkKTsgIAogIHNldFRhZyhib3QsICJvbkNsaWNrIiwgIkAgb3MudG9hc3QoJ2hlbGxvJyk7Iik7ICAKfSAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDQ6ICAKSW5wdXQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuICAKVEFSR0VUX0JPVF9JRFM6IFsic29tZV9pZCIsICJkb2VzbnRfbWF0dGVyIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsgIApzZXRUYWcoZ2V0Qm90cygiY29sb3IiLCAicmVkIiksICJjb2xvciIsICJibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNTogIApJbnB1dDogTWFrZSBhIGJsdWUgYm90IGFib3ZlIGVhY2ggb2YgdGhlIGdpdmVuIGJvdHMgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBob3ZlcmVkLiAgClRBUkdFVF9CT1RfSURTOiBbImIxIiwgImIyIiwgImIzIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIGJsdWUgYm90cyBhYm92ZSBlYWNoIHRhcmdldCB0aGF0IHRvYXN0IG9uIHBvaW50ZXIgZW50ZXIiKTsgIApmb3IgKGxldCBpZCBvZiBbImIxIiwgImIyIiwgImIzIl0pIHsgIAogIGxldCBib3QgPSBnZXRCb3QoImlkIiwgaWQpOyAgCiAgY3JlYXRlKHsgIAogICAgaG9tZTogdHJ1ZSwgIAogICAgaG9tZVg6IGJvdC50YWdzLmhvbWVYLCAgCiAgICBob21lWTogYm90LnRhZ3MuaG9tZVkgKyAxLCAgCiAgICBjb2xvcjogImJsdWUiLCAgCiAgICBvblBvaW50ZXJFbnRlcjogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogICAgY3JlYXRvcjogbnVsbCAgCiAgfSk7ICAKfSAgCmRlc3Ryb3kodGhpc0JvdCk7CgpJTlBVVDogIAonALWqm9wHsWMaYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBAC1qpvcB4nMAgMxMDEnALWqm9wHsWMJYWJWZXJzaW9uAgQAtaqb3AeNzAIFMTAuMjQnALWqm9wHsWMOY2hhbm5lbF9jb25maWcCBAC1qpvcB5PMAq0PQGNvbnN0IGNvbmZpZ3VyYXRpb25EYXRhID0gYXdhaXQgb3MuZ2V0RGF0YSh0aGF0LmRhdGEuc3R1ZGlvSUQsIHRoYXQuZGF0YS5wYXR0ZXJuSUQpOwoKbGV0IG5ld0RlcGxveW1lbnQgPSBmYWxzZTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmNoYW5uZWxDb25maWd1cmVkKQp7CiAgICByZXR1cm47Cn0KCmxpbmtzLnJlbWVtYmVyLnRhZ3MuY2hhbm5lbENvbmZpZ3VyZWQgPSB0cnVlOwoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvcykKewogICAgY29uc3QgdGFyZ2V0QmlvcyA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvczsKCiAgICBzd2l0Y2ggKHRhcmdldEJpb3MpIAogICAgewogICAgICAgIGNhc2UgImxvY2FsIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0YXRpY0luc3QgPT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmV3RGVwbG95bWVudCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInN0dWRpbyI6CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5vd25lciA9PSBudWxsIHx8IGNvbmZpZ0JvdC50YWdzLm93bmVyID09ICJwdWJsaWMiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic2hhcmVkIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLm93bmVyICE9ICJwdWJsaWMiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmVnZykKewogICAgY29uc3QgdGFyZ2V0UGF0dGVybiA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZWdnLnBhdHRlcm47CiAgICBjb25zdCB0YXJnZXRTdHVkaW8gPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmVnZy5zdHVkaW87CgogICAgc2hvdXQoImhhdGNoIiwge2FiSUQ6IHRhcmdldFBhdHRlcm4sIHJlY29yZEtleTogdGFyZ2V0U3R1ZGlvLCBhdXRvSGF0Y2g6IHRydWV9KTsKfQoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yKQp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yOwoKICAgIGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxDb2xvciA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yOwp9CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICYmIGNvbmZpZ0JvdC50YWdzLmluc3QgIT0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICYmIGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCAhPSBudWxsKQp7CiAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKfQoKaWYgKG5ld0RlcGxveW1lbnQpCnsKICAgIGNvbnN0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwogICAgY29uc3QgdGFyZ2V0SW5zdCA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCA/ICImaW5zdD0iICsgY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0IDogIiI7CiAgICBjb25zdCB0YXJnZXRCaW9zID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zID8gIiZiaW9zPSIgKyBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3MgOiAiIjsKICAgIGNvbnN0IHRhcmdldFBhdHRlcm4gPSBjb25maWdCb3QudGFncy5wYXR0ZXJuID8gIiZwYXR0ZXJuPSIgKyBjb25maWdCb3QudGFncy5wYXR0ZXJuIDogIiI7CiAgICBjb25zdCB0YXJnZXRVUkwgPSBzaXRlT3JpZ2luICsgYC8/YXNrPSR7Y29uZmlnQm90LnRhZ3MuYXNrfSR7dGFyZ2V0UGF0dGVybn0ke3RhcmdldEluc3R9JHt0YXJnZXRCaW9zfWA7CgogICAgb3MuZ29Ub1VSTCh0YXJnZXRVUkwpOwp9JwC1qpvcB7FjDWNoYW5uZWxMb2FkZXICBAC1qpvcB8HbAijwn5SXYTliNmFhMGQtYjM1Ny00ZGU2LTliZWYtODUzNDhhYjFkMGUwJwC1qpvcB7FjCXByb3RvdHlwZQIEALWqm9wH6NsCLkB0aGlzQm90LmFiQ29yZU1lbnVBY3Rpb24oIk1ha2UgbWU6ICIgKyB0aGF0KTsnALWqm9wHsWMLcGVyc29uYWxpdHkCBAC1qpvcB5fcAijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwC1qpvcB7FjBXV0aWxzAgQAtaqb3Ae+3AIo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAtaqb3AexYwZjcmVhdGUCBAC1qpvcB+XcAijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwC1qpvcB7FjBWRlYnVnAgQAtaqb3AeM3QIFZmFsc2UnALWqm9wHsWMPaW5wdXRTdWdnZXN0aW9uAgQAtaqb3AeS3QL4A0Bjb25zdCBpbnB1dEJvdCA9IHRoYXQ/LmlucHV0Qm90Owpjb25zdCB0ZXh0ID0gdGhhdD8udGV4dDsKY29uc3QgYW5pbWF0ZSA9IHRoYXQ/LmFuaW1hdGUgPz8gdHJ1ZTsKCmFzc2VydChpbnB1dEJvdCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpbnB1dEJvdCBpcyBhIHJlcXVpcmVkIHBhcmFtZW10ZXIuYCk7CmFzc2VydCh0ZXh0LCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRleHQgaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CgppZiAoYW5pbWF0ZSkgewogICAgY29uc3QgY2hhcnMgPSBbLi4udGV4dF07CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gY2hhcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBhd2FpdCBvcy5zbGVlcChtYXRoLnJhbmRvbSgyNSwgMTAwKSk7CiAgICAgICAgaW5wdXRCb3QudGFncy5tZW51SXRlbVRleHQgPSBjaGFycy5zbGljZSgwLCBpKS5qb2luKCcnKTsKICAgIH0KfQoKaW5wdXRCb3QudGFncy5tZW51SXRlbVRleHQgPSB0ZXh0OycAtaqb3AexYxVpbnB1dFN1Z2dlc3Rpb25XYWl0TVMCBAC1qpvcB4vhAgQzMDAwJwC1qpvcB7FjD3N1Z2dlc3Rpb25zQ29yZQIEALWqm9wHkOEC6wHwn6esWwogICAgIm1ha2UgbWUgYSByZWQgYm90IHRoYXQgd2hlbiBjbGlja2VkIHR1cm5zIGJsdWUiLAogICAgIm1ha2UgbWUgYSBib3QgdGhhdCB3aGVuIGNsaWNrZWQgbWFrZXMgZmlyZXdvcmtzIiwKICAgICJtYWtlIG1lIGEgYm90IHRoYXQgdG9hc3RzICdoZWxsbywgd29ybGQhJyB3aGVuIGNsaWNrZWQiLAogICAgIm1ha2UgbWUgMyBib3RzLCBhIHJlZCBvbmUsIGJsdWUgb25lLCBhbmQgZ3JlZW4gb25lIgpdJwC1qpvcB7FjDnN1Z2dlc3Rpb25zQm90AgQAtaqb3Af64gJ78J+nrFsKICAgICJjaGFuZ2UgdGhlIGNvbG9yIG9mIHRoaXMgYm90IHRvIHB1cnBsZSIsCiAgICAidHVybiB0aGlzIGJvdCBpbnRvIGEgc3BoZXJlIiwKICAgICJkb3VibGUgdGhlIHNjYWxlIG9mIHRoaXMgYm90IgpdJwC1qpvcB7FjF3N1Z2dlc3Rpb25zTXVsdGlwbGVCb3RzAgQAtaqb3Af04wKOAfCfp6xbCiAgICAiY2hhbmdlIGFsbCBvZiB0aGVzZSBib3RzIGNvbG9yIHRvIHB1cnBsZSIsCiAgICAidHVybiBhbGwgb2YgdGhlc2UgYm90cyBpbnRvIHNwaGVyZXMiLAogICAgImRvdWJsZSB0aGUgc2NhbGUgb2YgYWxsIG9mIHRoZXNlIGJvdHMiCl0nALWqm9wHsWMKdXVhYkxvYWRlcgIEALWqm9wHgeUCKPCflJdiODk4NmZhNi01NDNhLTQ4NjQtODZjMS00MjI1NzlhNWNiNjAnAQRib3RzJGY5ZmQ3ZTJlLTdjY2UtNDNmYi1iMjIzLWQzMmNiNDJiZWJlOAEnALWqm9wHqOUCBnN5c3RlbQIEALWqm9wHqeUCE2FiLmFjdGlvbi5jb2xvcl9ib3QnALWqm9wHqOUCBGZvcm0CBAC1qpvcB73lAgdub3RoaW5nJwC1qpvcB6jlAghhYkFjdGlvbgIEALWqm9wHxeUCBHRydWUnALWqm9wHqOUCD2FiQm90TWVudUFjdGlvbgIEALWqm9wHyuUCjgFAY29uc3QgdGFyZ2V0Qm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCm9zLnNob3dJbnB1dEZvclRhZyh0YXJnZXRCb3QsICJjb2xvciIsIHsKICAgIHR5cGU6ICdjb2xvcicsCiAgICB0aXRsZTogJ3BpY2sgYSBjb2xvcicKfSk7JwC1qpvcB6jlAg5hYkJvdE1lbnVMYWJlbAIEALWqm9wH2eYCBWNvbG9yJwC1qpvcB6jlAg1hYkJvdE1lbnVJY29uAgQAtaqb3Aff5gIHcGFsZXR0ZScAtaqb3Aeo5QIIcmVtZW1iZXICBAC1qpvcB+fmAijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC1qpvcB6jlAhJhYkJvdE1lbnVTb3J0T3JkZXICBAC1qpvcB47nAgEyJwC1qpvcB6jlAghhYklnbm9yZQIEALWqm9wHkOcCBHRydWUnALWqm9wHqOUCF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAtaqb3AeV5wLiA0Bjb25zdCBhbGxUYXJnZXRCb3RzID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CmNvbnN0IHNlbGVjdGVkQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobnVsbCwgewogICAgdHlwZTogJ2NvbG9yJywKICAgIHRpdGxlOiAncGljayBhIGNvbG9yJwp9KTsKCnNldFRhZyhyZWxldmFudFRhcmdldEJvdHMsICJjb2xvciIsIHNlbGVjdGVkQ29sb3IpOwoKYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBvcGVuZWQgbXVsdGlwbGUgc2VsZWN0IHNoZWV0Iik7JwC1qpvcB6jlAhVhYk11bHRpcGxlQm90TWVudUljb24CBAC1qpvcB/jqAgdwYWxldHRlJwC1qpvcB6jlAhZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAtaqb3AeA6wIFY29sb3InALWqm9wHqOUCGmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQAtaqb3AeG6wIBMScAtaqb3Aeo5QIJYWJWZXJzaW9uAgQAtaqb3AeI6wIFMTAuMjQnALWqm9wHqOUCC3BlcnNvbmFsaXR5AgQAtaqb3AeO6wIo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYgA="}]}