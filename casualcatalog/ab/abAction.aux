{"version":2,"updates":[{"id":0,"timestamp":1752181916692,"update":"AbMCzLCHuwQAJwEEYm90cyQzOTg4MDFmZS00YjM1LTRjZTQtODI2Zi0yMzgzNWMxYjlhYzUBJwDMsIe7BAAGc3lzdGVtAgQAzLCHuwQBFGFiLmFjdGlvbi5jcmVhdGVfYm90JwDMsIe7BAAIYWJBY3Rpb24CBADMsIe7BBYEdHJ1ZScAzLCHuwQABGZvcm0CBADMsIe7BBsHbm90aGluZycAzLCHuwQAC2Rlc2NyaXB0aW9uAgQAzLCHuwQjDUNyZWF0ZXMgYm90cy4nAMywh7sEABBhYkdyaWRNZW51QWN0aW9uAgQAzLCHuwQxqwVAY29uc3QgZ3JpZEluZm9ybWF0aW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKY29uc3QgbmV3Qm90ID0ge307CgpuZXdCb3QuY3JlYXRvciA9IG51bGw7Cm5ld0JvdFtncmlkSW5mb3JtYXRpb24uZGltZW5zaW9uXSA9IHRydWU7Cm5ld0JvdFtncmlkSW5mb3JtYXRpb24uZGltZW5zaW9uICsgIlgiXSA9IGdyaWRJbmZvcm1hdGlvbi5wb3NpdGlvbi54OwpuZXdCb3RbZ3JpZEluZm9ybWF0aW9uLmRpbWVuc2lvbiArICJZIl0gPSBncmlkSW5mb3JtYXRpb24ucG9zaXRpb24ueTsKbmV3Qm90LmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKCmxldCBjcmVhdGVkQm90ID0gY3JlYXRlKG5ld0JvdCk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90Lm1hc2tzLmxpbmVDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QubWFza3MubGluZVRvID0gY3JlYXRlZEJvdC5pZDsKCmxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQm90Rm9jdXMgPSAi8J+UlyIgKyBjcmVhdGVkQm90LmlkOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHttZW51OiAiYm90In0pOycAzLCHuwQAD2FiR3JpZE1lbnVMYWJlbAIEAMywh7sE2wUDYm90JwDMsIe7BAAOYWJHcmlkTWVudUljb24CBADMsIe7BN8FB2FkZF9ib3gnAMywh7sEAAhyZW1lbWJlcgIEAMywh7sE5wUo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAzLCHuwQADW1hbmlmZXN0YXRpb24CBADMsIe7BI4GKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAMywh7sEAAhhYklnbm9yZQIEAMywh7sEtQYEdHJ1ZScAzLCHuwQAE2FiR3JpZE1lbnVTb3J0T3JkZXICBADMsIe7BLoGATEnAMywh7sEAAlhYlZlcnNpb24CBADMsIe7BLwGBDEwLjQnAQRib3RzJDU4NDlhZjU1LTVlOGEtNDhkNi05MTA2LTE5OTQ5OGU5ZWMwOAEnAMywh7sEwQYGc3lzdGVtAgQAzLCHuwTCBhFhYi5hY3Rpb24uZGVzdHJveScAzLCHuwTBBghhYkFjdGlvbgIEAMywh7sE1AYEdHJ1ZScAzLCHuwTBBgRmb3JtAgQAzLCHuwTZBgdub3RoaW5nJwDMsIe7BMEGD2FiQm90TWVudUFjdGlvbgIEAMywh7sE4QaBAUBjb25zdCB0YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzOwoKZGVzdHJveSh0YXJnZXRCb3QpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOycAzLCHuwTBBg5hYkJvdE1lbnVMYWJlbAIEAMywh7sE4wcHZGVzdHJveScAzLCHuwTBBg1hYkJvdE1lbnVJY29uAgQAzLCHuwTrBw5kZWxldGVfZm9yZXZlcicAzLCHuwTBBhJhYkJvdE1lbnVTb3J0T3JkZXICBADMsIe7BPoHAzEwMCcAzLCHuwTBBghyZW1lbWJlcgIEAMywh7sE/gco8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAzLCHuwTBBg1tYW5pZmVzdGF0aW9uAgQAzLCHuwSlCCjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDMsIe7BMEGCGFiSWdub3JlAgQAzLCHuwTMCAR0cnVlJwDMsIe7BMEGDmFiQm90TWVudUNvbG9yAgQAzLCHuwTRCAcjRDkzMDMwJwDMsIe7BMEGF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAzLCHuwTZCMwCQGNvbnN0IGFsbFRhcmdldEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CmNvbnN0IGJ1aWxkZXIgPSBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90ID8gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC5pZCA6IG51bGw7CmNvbnN0IHJlbGV2YW50VGFyZ2V0Qm90cyA9IGFsbFRhcmdldEJvdHMuZmlsdGVyKCh0YXJnZXQpID0+IHRhcmdldC5pZCAhPSBidWlsZGVyKTsKCmRlc3Ryb3kocmVsZXZhbnRUYXJnZXRCb3RzKTsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsnAMywh7sEwQYVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAzLCHuwSmCw5kZWxldGVfZm9yZXZlcicAzLCHuwTBBhZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAzLCHuwS1CwdkZXN0cm95JwDMsIe7BMEGGmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQAzLCHuwS9CwMxMDAnAMywh7sEwQYWYWJNdWx0aXBsZUJvdE1lbnVDb2xvcgIEAMywh7sEwQsHI0Q5MzAzMCcAzLCHuwTBBglhYlZlcnNpb24CBADMsIe7BMkLBDEwLjQnAQRib3RzJDcxNzU2NDVjLTRiNTMtNDQ1NC04NzE2LWZjMGU2OGRiMjY2NQEnAMywh7sEzgsGc3lzdGVtAgQAzLCHuwTPCw9hYi5hY3Rpb24ubG9naW4nAMywh7sEzgsIYWJBY3Rpb24CBADMsIe7BN8LBHRydWUnAMywh7sEzgsIYWJJZ25vcmUCBADMsIe7BOQLBHRydWUnAMywh7sEzgsEZm9ybQIEAMywh7sE6QsHbm90aGluZycAzLCHuwTOCw9hYkNvcmVNZW51Q29sb3ICBADMsIe7BPELByNGMkI3MDUnAMywh7sEzgsTYWJDb3JlTWVudVNvcnRPcmRlcgIEAMywh7sE+QsCLTUnAMywh7sEzgsQYWJDb3JlTWVudUFjdGlvbgIEAMywh7sE/AssQG9zLmdvVG9VUkwobGlua3MucmVtZW1iZXIudGFncy5hYkF1dGhTaXRlKTsnAMywh7sEzgsUYWJDb3JlTWVudU9uR2VuZXJhdGUCBADMsIe7BKkMoAJAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkF1dGhTaXRlKQp7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9Cgp0YWdzLmxhYmVsID0gImJ1eSAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKCmlmICghYXV0aEJvdCkKewogICAgcmV0dXJuOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHJldHVybjsKfQoKZGVzdHJveSh0aGlzQm90KTsnAMywh7sEzgsOYWJDb3JlTWVudUljb24CBADMsIe7BMoODmFjY291bnRfY2lyY2xlJwDMsIe7BM4LCHJlbWVtYmVyAgQAzLCHuwTZDijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDMsIe7BM4LCWFiVmVyc2lvbgIEAMywh7sEgA8EMTAuNCcAzLCHuwTOCwtwZXJzb25hbGl0eQIEAMywh7sEhQ8o8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicBBGJvdHMkYjMzOWMxMTgtNDg5YS00NjZiLWJhOWYtYjA3YTVmOWI2NjRmAScAzLCHuwSsDwZzeXN0ZW0CBADMsIe7BK0PD2FiLmFjdGlvbi5wYXN0ZSgAzLCHuwSsDwhhYkFjdGlvbgF4JwDMsIe7BKwPBGZvcm0CBADMsIe7BL4PB25vdGhpbmcnAMywh7sErA8LZGVzY3JpcHRpb24CBADMsIe7BMYPK2FiIHNraWxsIHVzZWQgZm9yIGNvcHlpbmcgYW5kIHBhc3RpbmcgYm90cy4nAMywh7sErA8Hb25QYXN0ZQIEAMywh7sE8g/pB0BpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IE1BQ1JPUyA9IFsKICAgIHsKICAgICAgICB0ZXN0OiAvKD86W+KAnOKAnV0pL2csCiAgICAgICAgcmVwbGFjZW1lbnQ6ICh2YWwpID0+ICciJywKICAgIH0sCiAgICB7CiAgICAgICAgdGVzdDogLyg/OlvigJjigJldKS9nLAogICAgICAgIHJlcGxhY2VtZW50OiAodmFsKSA9PiAiJyIsCiAgICB9LApdOwoKbGV0IGZvcm1hdHRlZENvcHkgPSByZXBsYWNlTWFjcm9zKHRoYXQudGV4dCk7CmxldCBjb3B5Qm90ID0gSlNPTi5wYXJzZShmb3JtYXR0ZWRDb3B5KTsKbGV0IHBhc3RlZERhdGEgPSAhY29weUJvdC5zdGF0ZSA/IHtbY29weUJvdC5pZF06IGNvcHlCb3R9IDogY29weUJvdC5zdGF0ZTsKbGV0IGRpbU1vZCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJGb2N1c0RhdGE7CgppZiAoT2JqZWN0LmtleXMocGFzdGVkRGF0YSkubGVuZ3RoID09IDEgJiYgZGltTW9kKQp7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb25dID0gdHJ1ZTsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbisiWCJdID0gZGltTW9kLng7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb24rIlkiXSA9IGRpbU1vZC55OwoKICAgIG9zLnRvYXN0KCJib3QgYWRkZWQgdG8gaW5zdCIpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImJvdHMgYWRkZWQgdG8gaW5zdCIpOwp9CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHBhc3RlZCBkYXRhIik7CgpsaW5rcy5jcmVhdGUuYWJDcmVhdGVCb3RzKHtib3RzOiBwYXN0ZWREYXRhfSk7CgpmdW5jdGlvbiByZXBsYWNlTWFjcm9zKHRleHQpIHsKICAgIGlmICghdGV4dCkgewogICAgICAgIHJldHVybiB0ZXh0OwogICAgfQoKICAgIGZvciAobGV0IG0gb2YgTUFDUk9TKSB7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShtLnRlc3QsIG0ucmVwbGFjZW1lbnQpOwogICAgfQoKICAgIHJldHVybiB0ZXh0Owp9JwDMsIe7BKwPCHJlbWVtYmVyAgQAzLCHuwTUFyjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDMsIe7BKwPBmNyZWF0ZQIEAMywh7sE+xco8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycAzLCHuwSsDwhhYklnbm9yZQIEAMywh7sEohgEdHJ1ZScAzLCHuwSsDwlvbktleURvd24CBADMsIe7BKcYuglAaWYgKCFidWlsZGVyVmVyc2lvbiB8fCAoIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMgJiYgIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cykpCnsKICAgIHJldHVybjsKfQoKaWYgKHRoYXQua2V5cyA9PSAiYyIpCnsKICAgIGxldCBtZXRhSW5wdXQgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJNZXRhIik7CgogICAgaWYgKCFtZXRhSW5wdXQpCiAgICB7CiAgICAgICAgbWV0YUlucHV0ID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiQ29udHJvbCIpOwogICAgfQogICAgCiAgICBpZiAoIW1ldGFJbnB1dCkKICAgIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IGZvcm1hdHRlZEZpbGU7CiAgICBsZXQgc3RhdGUgPSB7fTsKCiAgICBpZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykKICAgIHsKICAgICAgICBsZXQgc2VsZWN0ZWRCb3QgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzOwoKICAgICAgICBzdGF0ZVtzZWxlY3RlZEJvdC5pZF0gPSBzZWxlY3RlZEJvdDsKCiAgICAgICAgYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBjb3BpZWQgYSBib3QgdG8gY2xpcGJvYXJkIik7CiAgICB9CiAgICBlbHNlIGlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpCiAgICB7CiAgICAgICAgbGV0IHNlbGVjdGVkQm90cyA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1czsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3RlZEJvdHMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBzdGF0ZVtzZWxlY3RlZEJvdHNbaV0uaWRdID0gc2VsZWN0ZWRCb3RzW2ldOwogICAgICAgIH0KCiAgICAgICAgYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBjb3BpZWQgbXVsdGlwbGUgYm90cyB0byBjbGlwYm9hcmQiKTsKICAgIH0KCiAgICBsZXQgbmV3RmlsZSA9IHt9OwogICAgbmV3RmlsZS52ZXJzaW9uID0gMTsKICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkobmV3RmlsZSk7CgogICAgb3Muc2V0Q2xpcGJvYXJkKGZvcm1hdHRlZEZpbGUpOwoKICAgIG9zLnRvYXN0KCJib3QgY29waWVkIHRvIGNsaXBib2FyZCIpOwp9JwDMsIe7BKwPCWFiVmVyc2lvbgIEAMywh7sE4iEEMTAuNCcAzLCHuwSsDwtwZXJzb25hbGl0eQIEAMywh7sE5yEo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicBBGJvdHMkYmRhYmQ2YzAtODlmOS00Zjc1LWIzNWMtMjZmNGVjNTIwN2Q2AScAzLCHuwSOIgZzeXN0ZW0CBADMsIe7BI8iEGFiLmFjdGlvbi5yZXBvcnQnAMywh7sEjiIEZm9ybQIEAMywh7sEoCIHbm90aGluZycAzLCHuwSOIhBhYkNvcmVNZW51QWN0aW9uAgQAzLCHuwSoIhFAb3MucmVwb3J0SW5zdCgpOycAzLCHuwSOIhNhYkNvcmVNZW51U29ydE9yZGVyAgQAzLCHuwS6IgMxMDEnAMywh7sEjiIOYWJDb3JlTWVudUljb24CBADMsIe7BL4iBGZsYWcnAMywh7sEjiIPYWJDb3JlTWVudUxhYmVsAgQAzLCHuwTDIgZyZXBvcnQnAMywh7sEjiIIYWJBY3Rpb24CBADMsIe7BMoiBHRydWUnAMywh7sEjiIIYWJJZ25vcmUCBADMsIe7BM8iBHRydWUnAMywh7sEjiIUYWJDb3JlTWVudU9uR2VuZXJhdGUCBADMsIe7BNQiRkBpZiAoY29uZmlnQm90LnRhZ3Muc3RhdGljSW5zdCAhPSB1bmRlZmluZWQpCnsKICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAMywh7sEjiIJYWJWZXJzaW9uAgQAzLCHuwSbIwQxMC40JwEEYm90cyRjNjhjNWI4Mi1jMGE3LTRhNWEtOTEwNC01ZGQ4ZTMyYWU0ZTIBJwDMsIe7BKAjBnN5c3RlbQIEAMywh7sEoSMQYWIuYWN0aW9uLnBvcnRhbCcAzLCHuwSgIwtkZXNjcmlwdGlvbgIEAMywh7sEsiMUU2tpbGwgdG8gb3BlbiBzaGVldC4nAMywh7sEoCMIYWJBY3Rpb24CBADMsIe7BMcjBHRydWUnAMywh7sEoCMEZm9ybQIEAMywh7sEzCMHbm90aGluZycAzLCHuwSgIxBhYkNvcmVNZW51QWN0aW9uAgQAzLCHuwTUI84kQHNob3V0KCJhYlBvcnRhbE1lbnVSZWZyZXNoIik7Cgpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsKY29uc3QgYWN0aXZlRGltZW5zaW9uID0gdGhhdC5ib3QudGFncy5jdXJyZW50RGltZW5zaW9uOwpjb25zdCBhY3RpdmVQb3J0YWwgPSB0aGF0LmJvdC50YWdzLmN1cnJlbnRQb3J0YWw7CgovLyB0aGF0LmJvdC5tYXNrc1thY3RpdmVNZW51XSA9IGZhbHNlOwp0aGF0LmJvdC5tYXNrcy5hYlBvcnRhbE1lbnVSZWZyZXNoID0gIkAgY2xlYXJUYWdNYXNrcyh0aGlzQm90KTsiOwp0aGF0LmJvdC5tYXNrcy5mb3JtQWRkcmVzcyA9ICJhcnJvd19kcm9wX2Rvd24iOwp0aGF0LmJvdC5tYXNrcy5vbkNsaWNrID0gYEAgc2hvdXQoImFiUG9ydGFsTWVudVJlZnJlc2giKTtgOwp0aGF0LmJvdC5tYXNrcy5tZW51SXRlbVN0eWxlID0gewogICAgImJvcmRlci1yYWRpdXMiOiI4cHggOHB4IDBweCAwcHgiLCAKICAgICJtYXJnaW4tdG9wIjoiOHB4IiwgCiAgICAiYm9yZGVyLXdpZHRoIjogIjJweCIsIAogICAgImJvcmRlci1jb2xvciI6ICIjMDAwIiwgCiAgICAiYm9yZGVyLXRvcC1zdHlsZSI6ICJzb2xpZCIsCiAgICAiYm9yZGVyLWxlZnQtc3R5bGUiOiAic29saWQiLAogICAgImJvcmRlci1yaWdodC1zdHlsZSI6ICJzb2xpZCIsCiAgICAiYm94LXNoYWRvdyI6ICIzcHggNHB4ICMwMDAiLAogICAgIm1pbi1oZWlnaHQiOiAiNDRweCIKfTsKCmNvbnN0IHBlcm1hbGlua1VSTCA9IGNvbmZpZ0JvdC50YWdzLnBlcm1hbGluazsKY29uc3QgYWN0aXZlSW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CmNvbnN0IGFjdGl2ZUJpb3MgPSBjb25maWdCb3QudGFncy5vd25lciA/ICImb3duZXI9IiArIGNvbmZpZ0JvdC50YWdzLm93bmVyIDogZmFsc2U7CmNvbnN0IGZpcnN0SW5kZXggPSBwZXJtYWxpbmtVUkwuaW5kZXhPZigiJiIpOwpjb25zdCBpbml0aWFsVVJMID0gcGVybWFsaW5rVVJMLnN1YnN0cmluZygwLCBmaXJzdEluZGV4KTsKY29uc3QgdXBkYXRlZFVSTCA9IGFjdGl2ZUJpb3MgIT0gZmFsc2UgPyBpbml0aWFsVVJMICsgIiZpbnN0PSIgKyBhY3RpdmVJbnN0IDogaW5pdGlhbFVSTDsKY29uc3QgbWVudUJvdCA9IHt9OwoKbWVudUJvdC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwptZW51Qm90LmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7Cm1lbnVCb3RbYWN0aXZlTWVudV0gPSB0cnVlOwptZW51Qm90LmFiUG9ydGFsTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm1lbnVCb3QuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJvdC5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsKbWVudUJvdC5vbktleVVwID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gbnVsbDt9YDsKbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGF0LmJvdCk7Cm1lbnVCb3Quc2tpbGxCb3QgPSBnZXRMaW5rKHRoaXNCb3QpOwptZW51Qm90LnRhcmdldFVSTCA9IHVwZGF0ZWRVUkw7CgptZW51Qm90LmxhYmVsID0gIm1hcCBwb3J0YWwiOwptZW51Qm90LmZvcm1BZGRyZXNzID0gInB1YmxpYyI7Cm1lbnVCb3Qub25DbGljayA9IGBAIHNob3V0KCJhYlBvcnRhbE1lbnVSZWZyZXNoIik7Cgpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZihzdGF0ZSkKewogICAgb3Mub3BlblVSTCh0YWdzLnRhcmdldFVSTCArICImbWFwUG9ydGFsPSR7YWN0aXZlRGltZW5zaW9uID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogYWN0aXZlRGltZW5zaW9ufSIpOwp9CmVsc2UKewogICAgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gIiR7YWN0aXZlRGltZW5zaW9uID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogYWN0aXZlRGltZW5zaW9ufSI7Owp9YDsKbWVudUJvdFthY3RpdmVNZW51ICsgIlNvcnRPcmRlciJdID0gMC4yOwptZW51Qm90Lm1lbnVJdGVtU3R5bGUgPSB7CiAgICAiYm9yZGVyLXJhZGl1cyI6IjAiLCAKICAgICJtYXJnaW4tdG9wIjoiMHB4IiwKICAgICJib3JkZXItd2lkdGgiOiAiMnB4IiwgCiAgICAiYm9yZGVyLWNvbG9yIjogIiMwMDAiLCAKICAgICJib3JkZXItdG9wLXN0eWxlIjogInNvbGlkIiwKICAgICJib3JkZXItbGVmdC1zdHlsZSI6ICJzb2xpZCIsCiAgICAiYm9yZGVyLXJpZ2h0LXN0eWxlIjogInNvbGlkIiwKICAgICJib3gtc2hhZG93IjogIjNweCA0cHggIzAwMCIsCiAgICAibWluLWhlaWdodCI6ICI0NHB4Igp9OwoKaWYgKGFjdGl2ZVBvcnRhbCAhPSAibWFwIikKewogICAgLy9tYXAgcG9ydGFsIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJvdCk7Cn0KCm1lbnVCb3QubGFiZWwgPSAiZ3JpZCBwb3J0YWwiOwptZW51Qm90LmZvcm1BZGRyZXNzID0gImN1YmUiOwptZW51Qm90Lm9uQ2xpY2sgPSBgQCBzaG91dCgiYWJQb3J0YWxNZW51UmVmcmVzaCIpOyAKCmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCmlmKHN0YXRlKQp7CiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZncmlkUG9ydGFsPSR7YWN0aXZlRGltZW5zaW9uID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogYWN0aXZlRGltZW5zaW9ufSIpOwp9IAplbHNlCnsKICAgIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAiJHthY3RpdmVEaW1lbnNpb24gPT0gImJsdWVwcmludCIgPyAiaG9tZSIgOiBhY3RpdmVEaW1lbnNpb259IjsgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gbnVsbDsKfWA7Cm1lbnVCb3RbYWN0aXZlTWVudSArICJTb3J0T3JkZXIiXSA9IDAuMjsKCmlmIChhY3RpdmVQb3J0YWwgIT0gImdyaWQiIHx8IGFjdGl2ZURpbWVuc2lvbiA9PSAiYmx1ZXByaW50IikKewogICAgLy9ncmlkIHBvcnRhbCBidXR0b24KICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCb3QpOwp9CgptZW51Qm90LmxhYmVsID0gImJsdWVwcmludCBwb3J0YWwiOwptZW51Qm90LmZvcm1BZGRyZXNzID0gImFyY2hpdGVjdHVyZSI7Cm1lbnVCb3Qub25DbGljayA9IGBAIHNob3V0KCJhYlBvcnRhbE1lbnVSZWZyZXNoIik7IAoKY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOwoKaWYoc3RhdGUpCnsKICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9Ymx1ZXByaW50Iik7Cn0gCmVsc2UKewogICAgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9ICJibHVlcHJpbnQiOyBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSBudWxsOwp9CgpsaW5rcy5za2lsbEJvdC5hYkJsdWVwcmludCgpO2A7Cm1lbnVCb3RbYWN0aXZlTWVudSArICJTb3J0T3JkZXIiXSA9IDAuMzsKCmlmIChhY3RpdmVEaW1lbnNpb24gIT0gImJsdWVwcmludCIpCnsKICAgIC8vYmx1ZXByaW50IHBvcnRhbCBidXR0b24KICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCb3QpOwp9CgptZW51Qm90LmxhYmVsID0gInNoZWV0IHBvcnRhbCI7Cm1lbnVCb3QuZm9ybUFkZHJlc3MgPSAidGFibGVfdmlldyI7Cm1lbnVCb3Qub25DbGljayA9IGBAIHNob3V0KCJhYlBvcnRhbE1lbnVSZWZyZXNoIik7Cgpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZihzdGF0ZSkKewogICAgb3Mub3BlblVSTCh0YWdzLnRhcmdldFVSTCArICImc2hlZXRQb3J0YWw9JHthY3RpdmVEaW1lbnNpb259Iik7Cn0gCmVsc2UKeyAKICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gIiR7YWN0aXZlRGltZW5zaW9ufSI7Cn1gOwptZW51Qm90W2FjdGl2ZU1lbnUgKyAiU29ydE9yZGVyIl0gPSAwLjE7CgovL3NoZWV0IHBvcnRhbCBidXR0b24KbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJvdCk7CgptZW51Qm90LmxhYmVsID0gInN5c3RlbSBwb3J0YWwiOwptZW51Qm90LmZvcm1BZGRyZXNzID0gInNldHRpbmdzX2FwcGxpY2F0aW9ucyI7Cm1lbnVCb3Qub25DbGljayA9IGBAIHNob3V0KCJhYlBvcnRhbE1lbnVSZWZyZXNoIik7Cgpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZihzdGF0ZSkKewogICAgb3Mub3BlblVSTCh0YWdzLnRhcmdldFVSTCArICImc3lzdGVtUG9ydGFsPXRydWUiKTsKfSAKZWxzZQp7IAogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gdHJ1ZTsKfWA7Cm1lbnVCb3RbYWN0aXZlTWVudSArICJTb3J0T3JkZXIiXSA9IDAuNDsKbWVudUJvdC5tZW51SXRlbVN0eWxlID0gewogICAgImJvcmRlci1yYWRpdXMiOiIwIDAgOHB4IDhweCIsCiAgICAibWFyZ2luLXRvcCI6IjBweCIsCiAgICAiYm9yZGVyLXdpZHRoIjogIjJweCIsIAogICAgImJvcmRlci1jb2xvciI6ICIjMDAwIiwgCiAgICAiYm9yZGVyLXRvcC1zdHlsZSI6ICJzb2xpZCIsCiAgICAiYm9yZGVyLWxlZnQtc3R5bGUiOiAic29saWQiLAogICAgImJvcmRlci1yaWdodC1zdHlsZSI6ICJzb2xpZCIsCiAgICAiYm94LXNoYWRvdyI6ICIzcHggNHB4ICMwMDAiLAogICAgIm1pbi1oZWlnaHQiOiAiNDRweCIKfTsKCi8vc3lzdGVtIHBvcnRhbCBidXR0b24KbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJvdCk7JwDMsIe7BKAjCHJlbWVtYmVyAgQAzLCHuwSjSCjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDMsIe7BKAjD2FiQ29yZU1lbnVMYWJlbAIEAMywh7sEykgQY3VycmVudCBwb3J0YWw6ICcAzLCHuwSgIw9hYkJvdE1lbnVBY3Rpb24CBADMsIe7BNtI+AJAY29uc3QgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwpjb25zdCBjdXJyZW50RGltID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC50YWdzLmxpbmVUbzsKY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOwoKaWYgKHN0YXRlKSAKewogICAgb3Mub3BlblVSTChjb25maWdCb3QudGFncy5wZXJtYWxpbmsgKyBgJnNoZWV0UG9ydGFsPSR7Y3VycmVudERpbX1gKTsKfQplbHNlCnsKICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY3VycmVudERpbTsKfQoKYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBvcGVuZWQgYm90IHNoZWV0Iik7JwDMsIe7BKAjDmFiQm90TWVudUxhYmVsAgQAzLCHuwTUSw5vcGVuIGJvdCBzaGVldCcAzLCHuwSgIw1tYW5pZmVzdGF0aW9uAgQAzLCHuwTjSyjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDMsIe7BKAjDWFiQm90TWVudUljb24CBADMsIe7BIpMCnRhYmxlX3ZpZXcnAMywh7sEoCMOYWJDb3JlTWVudUljb24CBADMsIe7BJVMC2Fycm93X3JpZ2h0JwDMsIe7BKAjEmFiQm90TWVudVNvcnRPcmRlcgIEAMywh7sEoUwBMScAzLCHuwSgIwhhYklnbm9yZQIEAMywh7sEo0wEdHJ1ZScAzLCHuwSgIxdhYk11bHRpcGxlQm90TWVudUFjdGlvbgIEAMywh7sEqEybBEBjb25zdCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CmNvbnN0IGN1cnJlbnREaW0gPSAiYWJNdWx0aXBsZVNlbGVjdCI7Cgpjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9IGN1cnJlbnREaW07CgpzZXRUYWdNYXNrKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cywgY3VycmVudERpbSwgdHJ1ZSwgInRlbXBMb2NhbCIpOwoKbWFza3MuY3VycmVudFNoZWV0Qm90cyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJNdWx0aXBsZUJvdEZvY3VzOwptYXNrcy5vblBvcnRhbENoYW5nZWQgPSBgQCBpZiAodGhhdC5kaW1lbnNpb24gIT0gImFiTXVsdGlwbGVTZWxlY3QiICYmIHRoYXQucG9ydGFsID09ICJzaGVldFBvcnRhbCIpCnsKICAgIGNsZWFyVGFnTWFza3MobGlua3MuY3VycmVudFNoZWV0Qm90cyk7CgogICAgY2xlYXJUYWdNYXNrcyh0aGlzQm90KTsKfSBgOwoKYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBvcGVuZWQgbXVsdGlwbGUgc2VsZWN0IHNoZWV0Iik7JwDMsIe7BKAjFmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBADMsIe7BMRQGm9wZW4gbXVsdGlwbGUgc2VsZWN0IHNoZWV0JwDMsIe7BKAjFWFiTXVsdGlwbGVCb3RNZW51SWNvbgIEAMywh7sE31AKdGFibGVfdmlldycAzLCHuwSgIxRhYkNvcmVNZW51T25HZW5lcmF0ZQIEAMywh7sE6lDHAkBjb25zdCBjdXJyZW50RGltID0gbGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsKY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7Cgp0YWdzLmxhYmVsID0gYG1vZGU6ICR7Y3VycmVudFBvcnRhbH0gcG9ydGFsYDsKdGFncy5jdXJyZW50RGltZW5zaW9uID0gY3VycmVudERpbTsKdGFncy5jdXJyZW50UG9ydGFsID0gY3VycmVudFBvcnRhbDsKdGFncy5vblBvaW50ZXJEb3duID0gIkAgLy8iOycAzLCHuwSgIxNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAzLCHuwSyU5gCQGxldCBzZWxlY3RlZEJvdCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QudGFncy5saW5lVG87Cgp0YWdzLmxhYmVsID0gInNoZWV0UG9ydGFsPSIgKyBzZWxlY3RlZEJvdC5zdWJzdHJpbmcoMCwgNCk7Cgp0YWdzLm9uS2V5RG93biA9IGBAIGlmKHRoYXQua2V5cyA9PSAiU2hpZnQiKXttYXNrcy5sYWJlbCA9IHRhZ3MubGFiZWwgKyAiIGluIG5ldyB0YWIiO31gOwp0YWdzLm9uS2V5VXAgPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSBudWxsO31gOycAzLCHuwSgIxphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAMywh7sEy1UBMCcAzLCHuwSgIwRtZW51AgQAzLCHuwTNVSjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwDMsIe7BKAjCWFiVmVyc2lvbgIEAMywh7sE9FUEMTAuNCcAzLCHuwSgIwthYkJsdWVwcmludAIEAMywh7sE+VX7A0Bjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSBsaW5rcy5yZW1lbWJlcj8udGFncy5hYkJsdWVwcmludENvbG9yID8/ICIjMTc4NUI1IjsKCmlmIChiYWNrZ3JvdW5kQ29sb3IgPT0gZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDb2xvcikKewogICAgcmV0dXJuOwp9CgpncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yID0gYmFja2dyb3VuZENvbG9yOwoKbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gYEAgaWYgKHRoYXQucG9ydGFsID09ICJncmlkUG9ydGFsIiAmJiB0aGF0LmRpbWVuc2lvbiAhPSAiYmx1ZXByaW50Iil7CiAgICAvLyBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJhc2VDb2xvciA9IG51bGw7CiAgICAvLyBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJhc2VTdHJva2VDb2xvciA9IG51bGw7CgogICAgZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDb2xvciA9IG51bGw7CgogICAgbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gbnVsbDsKfWA7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOycAzLCHuwSgIwtvbkFueUNyZWF0ZQIEAMywh7sE9Vl2QGlmICh0aGF0LmJvdC50YWdzLmJsdWVwcmludCkKewogICAgdGhhdC5ib3QudGFncy5zdHJva2VDb2xvciA9ICIjZmZmZmZmIjsKICAgIHRoYXQuYm90LnRhZ3MubGFiZWxDb2xvciA9ICIjZmZmZmZmIjsKfScAzLCHuwSgIw9vblBvcnRhbENoYW5nZWQCBADMsIe7BOxaYUBpZiAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIHRoYXQuZGltZW5zaW9uID09ICJibHVlcHJpbnQiKQp7CiAgICB0aGlzQm90LmFiQmx1ZXByaW50KCk7Cn0nAMywh7sEoCMLcGVyc29uYWxpdHkCBADMsIe7BM5bKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAQRib3RzJGVjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNwEnAMywh7sE9VsGc3lzdGVtAgQAzLCHuwT2Ww1hYi5hY3Rpb24uYXNrJwDMsIe7BPVbBGZvcm0CBADMsIe7BIRcB25vdGhpbmcnAMywh7sE9VsGYXNrR1BUAgQAzLCHuwSMXJYKQGlmICghdGFncy5ncHRBY3RpdmUgfHwgYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd0FJID09IGZhbHNlKQp7CiAgICBjb25zdCBhaU1lc3NhZ2UgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFpX3JlamVjdGlvbl9tZXNzYWdlID8/ICJBSSBub3QgYXV0aG9yaXplZCBmb3IgdGhpcyBhY2NvdW50IjsKCiAgICBvcy50b2FzdChhaU1lc3NhZ2UsIDcpOwoKICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgICI6ICIgKyBhaU1lc3NhZ2UpOwogICAgCiAgICByZXR1cm47Cn0gCgovLyBjb25zb2xlLmxvZygiQVNLIiwgdGhhdCk7CgpsZXQgaW5xdWlyeSA9IHRoYXQuaW5xdWlyeSA/PyB0aGF0OwoKY29uc3QgcHJvbXB0ID0gIXRoYXQucHJvbXB0ID8gdGFncy5wcm9tcHRfY29yZSA6IHRhZ3NbInByb21wdF8iICsgdGhhdC5wcm9tcHRdOwoKYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiB0aGlua2luZyBhYm91dCAiICsgaW5xdWlyeSk7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQm90Q2hhdCh7bWVzc2FnZTogInRoaW5raW5nIGFib3V0ICIgKyBpbnF1aXJ5fSk7CgppZiAodGhhdC5wcm9tcHQgPT0gImdyaWQiKQp7CiAgICBpbnF1aXJ5ID0gaW5xdWlyeSArIGAgUE9TSVRJT046IHske3RoYXQuZGF0YS5kaW1lbnNpb259OiB0cnVlLCAke3RoYXQuZGF0YS5kaW1lbnNpb259WDogJHt0aGF0LmRhdGEuZGltZW5zaW9uWH0sICR7dGhhdC5kYXRhLmRpbWVuc2lvbn1ZOiR7dGhhdC5kYXRhLmRpbWVuc2lvbll9fS5gCn0KZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gImJvdCIpCnsKICAgIGlucXVpcnkgPSBpbnF1aXJ5ICsgYCBUQVJHRVRfQk9UX0lEOiBgICsgdGhhdC5kYXRhLmJvdC5pZDsKfQplbHNlIGlmICh0aGF0LnByb21wdCA9PSAibXVsdGlwbGVCb3QiKQp7CiAgICBpbnF1aXJ5ID0gaW5xdWlyeSArIGAgVEFSR0VUX0JPVF9JRFM6IGAgKyB0aGF0LmRhdGEuYm90czsKfQplbHNlIGlmICh0aGF0LnByb21wdCA9PSAiY29yZSIpCnsKCn0KCmNvbnN0IGFuc3dlciA9IGF3YWl0IHRoaXNCb3Quc3VibWl0UmVxdWVzdEdQVCh7aW5xdWlyeTogaW5xdWlyeSwgcHJvbXB0OiBwcm9tcHQsIG1vZGVsOiB0aGF0Lm1vZGVsfSk7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBhbnN3ZXIpOwoKY3JlYXRlKHtob21lOiB0cnVlLCBvbkNyZWF0ZTogYEAgJHthbnN3ZXJ9YH0pOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgpyZXR1cm47JwDMsIe7BPVbCWdwdEFjdGl2ZQIEAMywh7sEo2YFZmFsc2UnAMywh7sE9VsQc3VibWl0UmVxdWVzdEdQVAIEAMywh7sEqWaoBkBsZXQgc3lzdGVtUHJvbXB0ID0gdGhhdC5wcm9tcHQgPyB0aGF0LnByb21wdCA6IHRhZ3MucHJvbXB0X2NvcmU7CgpzeXN0ZW1Qcm9tcHQgPSBzeXN0ZW1Qcm9tcHQgKyB0aGF0LmlucXVpcnk7CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd0FJID09IGZhbHNlKQp7CiAgICBvcy50b2FzdCgiQUkgbm90IGF1dGhvcml6ZWQgb24gdGhpcyBhY2NvdW50Iik7CgogICAgcmV0dXJuOwp9CgpsZXQgY3VycmVudEV4cGVyaWVuY2VCb3RzID0gZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbH0pKTsKCmlmIChjdXJyZW50RXhwZXJpZW5jZUJvdHMubGVuZ3RoID4gMCkKewogICAgc3lzdGVtUHJvbXB0ID0gc3lzdGVtUHJvbXB0ICsgIiBUaGVzZSBhcmUgdGhlIGJvdHMgdGhhdCBjdXJyZW50bHkgZXhpc3QgaW4gdGhlIGV4cGVyaWVuY2U6ICIgKyBjdXJyZW50RXhwZXJpZW5jZUJvdHM7Cn0KCmxldCBuZXdTdGF0dXNCYXIgPSBhd2FpdCBsaW5rcy5pbnB1dC5hYlByb2dyZXNzQmFyKGBhc2tpbmcgJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWApOwoKY29uc3QgYWlSZXNwID0gYXdhaXQgYWkuY2hhdChzeXN0ZW1Qcm9tcHQsIHsKICAgIG1vZGVsOiB0aGF0Lm1vZGVsID8/ICJjbGF1ZGUtMy01LXNvbm5ldC1sYXRlc3QiLAogICAgdGVtcGVyYXR1cmU6IDAsCiAgICB0b3BQOiAxLAogICAgcHJlc2VuY2VQZW5hbHR5OiAwLjYsCiAgICBmcmVxdWVuY3lQZW5hbHR5OiAwCn0pOwoKZGVzdHJveShuZXdTdGF0dXNCYXIpOwoKcmV0dXJuIGFpUmVzcDsnAMywh7sE9VsIcmVtZW1iZXICBADMsIe7BNJsKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAMywh7sE9VsQYWJDb3JlTWVudUFjdGlvbgIEAMywh7sE+Wz9HEBjb25zdCBpbnF1aXJ5ID0gdGhhdC5tZXNzYWdlID8/IHRoYXQ7CmNvbnN0IGJhc2VJbnF1aXJ5ID0gaW5xdWlyeTsKY29uc3QgbWVudSA9IHRoYXQubWVudSA/PyAiY29yZSI7CmNvbnN0IHNwYWNlQ2hlY2sgPSBpbnF1aXJ5LmluZGV4T2YoIiAiKTsKY29uc3QgbWVudUJvdHMgPSBnZXRCb3RzKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwsIHRydWUpOwoKd2hpc3BlcihtZW51Qm90cywgImFiTWVudVJlZnJlc2giKTsKCmFiLmxvZygidXNlcjogIiArIGlucXVpcnkpOwoKaWYgKCFjb25maWdCb3QudGFncy50YWdQb3J0YWwgJiYgbGlua3MucmVtZW1iZXIudGFncy5hYkF3YWtlU3RhdGUgJiYgdGhhdC5tZXNzYWdlICE9ICIubG9nIikKewogICAgc2hvdXQoInNob3dDb25zb2xlIik7Cn0KCmlmIChzcGFjZUNoZWNrID09IC0xKQp7CiAgICBjb25zdCBxdW9hdGF0aW9uQ2hlY2sxID0gYmFzZUlucXVpcnkuaW5kZXhPZignIicpOwogICAgY29uc3QgcXVvYXRhdGlvbkNoZWNrMiA9IGJhc2VJbnF1aXJ5Lmxhc3RJbmRleE9mKCciJyk7CiAgICBjb25zdCBkaXJlY3RTZWFyY2ggPSBxdW9hdGF0aW9uQ2hlY2sxID09IDAgJiYgcXVvYXRhdGlvbkNoZWNrMiA9PSBiYXNlSW5xdWlyeS5sZW5ndGggLTE7CiAgICBjb25zdCBjaGFubmVsQ29uZmlnQ2hlY2sgPSBiYXNlSW5xdWlyeVswXSA9PSAiQCI7CiAgICBjb25zdCBhc2tKb2luSUQgPSBpbnF1aXJ5LnJlcGxhY2VBbGwoIi0iLCAiIik7CgogICAgbGV0IGFzayA9ICFkaXJlY3RTZWFyY2ggPyBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7YXNrSUQ6IGFza0pvaW5JRCwgY2hhbm5lbENvbmZpZzogY2hhbm5lbENvbmZpZ0NoZWNrfSkgOiBmYWxzZTsKICAgIAogICAgaWYgKGFzaz8uc3VjY2VzcyAmJiBhc2s/LmRhdGEudXJsICE9IHVuZGVmaW5lZCAmJiAhZGlyZWN0U2VhcmNoICYmICFjaGFubmVsQ29uZmlnQ2hlY2spCiAgICB7CiAgICAgICAgbGlua3MubGVhcm4uYWJKb2luSG9zdCh7ZGF0YTogYXNrLmRhdGF9KTsKICAgIH0KICAgIGVsc2UgaWYgKGFzaz8uc3VjY2VzcyAmJiBjaGFubmVsQ29uZmlnQ2hlY2spCiAgICB7CiAgICAgICAgbGlua3MuY2hhbm5lbExvYWRlcj8ubG9hZENoYW5uZWwoYXNrKTsKICAgIH0KICAgIGVsc2UgaWYgKCFhc2s/LnN1Y2Nlc3MpCiAgICB7CiAgICAgICAgY29uc3QgcGVyaW9kSW5kZXggPSBiYXNlSW5xdWlyeS5pbmRleE9mKCIuIik7CgogICAgICAgIGxldCBhYklEID0gYmFzZUlucXVpcnk7CgogICAgICAgIGlmIChkaXJlY3RTZWFyY2gpCiAgICAgICAgewogICAgICAgICAgICBhYklEID0gYmFzZUlucXVpcnkuc3Vic3RyaW5nKDEsIGJhc2VJbnF1aXJ5Lmxlbmd0aCAtIDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHBlcmlvZEluZGV4ID09IC0xIHx8IGRpcmVjdFNlYXJjaCkKICAgICAgICB7CiAgICAgICAgICAgIGFzayA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogYWJJRCwgaW5pdGlhbEJvb3Q6IHRoYXQuaW5pdGlhbEJvb3QsIGF1dG9IYXRjaDogdGhhdC5hdXRvSGF0Y2h9KTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocGVyaW9kSW5kZXggPiAwKQogICAgICAgIHsKICAgICAgICAgICAgY29uc3QgcmVjb3JkS2V5ID0gYmFzZUlucXVpcnkuc3Vic3RyaW5nKDAsIHBlcmlvZEluZGV4KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGFiSUQgPSBiYXNlSW5xdWlyeS5zdWJzdHJpbmcocGVyaW9kSW5kZXggKyAxKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGFzayA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7cmVjb3JkS2V5OiByZWNvcmRLZXksIGFiSUQ6IGFiSUQsIGluaXRpYWxCb290OiB0aGF0LmluaXRpYWxCb290LCBhdXRvSGF0Y2g6IHRoYXQuYXV0b0hhdGNofSk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGxpbmtzLmlucHV0Lm9uQ2hhdCh7bWVzc2FnZTogaW5xdWlyeX0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFhc2s/LnN1Y2Nlc3MgJiYgbGlua3MubWVudSkKICAgICAgICB7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgogICAgICAgICAgICBjb25zdCBzdHVkaW9CdXR0b24gPSB7fTsKCiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ubGFiZWwgPSBhYklEICsgIiBub3QgZm91bmQgaW4gYWN0aXZlIHN0dWRpbywgZW50ZXIgYWx0ZXJuYXRlIHN0dWRpb0lEIjsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgICAgICAgICBzdHVkaW9CdXR0b24uYWJJRCA9IGFiSUQ7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5mb3JtQWRkcmVzcyA9IHRhZ3MuYWJDb3JlTWVudUljb247CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5vblN1Ym1pdCA9IGBAIGxpbmtzLm1hbmFnZXIuYWJDb3JlTWVudUFjdGlvbih0aGF0LnRleHQgKyAiLiIgKyB0YWdzLmFiSUQpO2A7CgogICAgICAgICAgICBjb25zdCBjcmVhdGVCdXR0b24gPSB7fTsKCiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgICAgICAgICBjcmVhdGVCdXR0b24ubGFiZWwgPSAiZ2l2ZSBtZSBhIHByb3RvdHlwZSI7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYklEID0gYWJJRDsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnByb3RvdHlwZSh0YWdzLmFiSUQpO2A7CgogICAgICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihjcmVhdGVCdXR0b24pOwogICAgICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihzdHVkaW9CdXR0b24pOwoKICAgICAgICAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IjsKICAgICAgICB9CiAgICB9Cn0KZWxzZQp7CiAgICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKICAgIGlmICghYXV0aEJvdCkKICAgIHsKICAgICAgICBvcy50b2FzdCgicGxlYXNlIHNpZ24gaW4gdG8gYWNjZXNzIGFkdmFuY2VkIEFJIGZlYXR1cmVzIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgfQogICAgZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKICAgIHsKICAgICAgICBvcy50b2FzdCgicGxlYXNlIGNoZWNrIHlvdXIgc3Vic2NyaXB0aW9uIGluIG9yZGVyIHRvIGFjY2VzcyBhZHZhbmNlZCBBSSBmZWF0dXJlcyIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBtYXNrcy5ncHRBY3RpdmUgPSB0cnVlOwoKICAgICAgICBhd2FpdCB0aGlzQm90LmFza0dQVCh7aW5xdWlyeTogaW5xdWlyeSwgcHJvbXB0OiBtZW51LCBkYXRhOiB0aGF0fSk7CiAgICB9Cn0nAMywh7sE9VsUYWJDb3JlTWVudU9uR2VuZXJhdGUCBADMsIe7BPeJAeEDQHRhZ3Mub25TdWJtaXQgPSBgQCBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiY29yZSJ9KTtgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIGNvbnNvbGUubG9nKCJ0ZXN0aW5nZXIiLCBsaW5rcy5wZXJzb25hbGl0eSkKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CicAzLCHuwT1WxNhYkNvcmVNZW51U29ydE9yZGVyAgQAzLCHuwTZjQEDMTAyJwDMsIe7BPVbEGFiR3JpZE1lbnVBY3Rpb24CBADMsIe7BN2NAQ5ALy9wbGFjZWhvbGRlcicAzLCHuwT1WxRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAMywh7sE7I0BvAVAdGFncy5kaW1lbnNpb24gPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzLmRpbWVuc2lvbjsKdGFncy5kaW1lbnNpb25YID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cy5wb3NpdGlvbi54Owp0YWdzLmRpbWVuc2lvblkgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzLnBvc2l0aW9uLnk7CnRhZ3Mub25TdWJtaXQgPSBgQGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJncmlkIiwgZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgZGltZW5zaW9uWDogdGFncy5kaW1lbnNpb25YLCBkaW1lbnNpb25ZOiB0YWdzLmRpbWVuc2lvbll9KTtgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9JwDMsIe7BPVbDW1hbmlmZXN0YXRpb24CBADMsIe7BKmTASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDMsIe7BPVbE2FiR3JpZE1lbnVTb3J0T3JkZXICBADMsIe7BNCTAQMxMDInAMywh7sE9VsPYWJHcmlkTWVudUxhYmVsAgQAzLCHuwTUkwEGYXNrIGFiJwDMsIe7BPVbD2FiQ29yZU1lbnVMYWJlbAIEAMywh7sE25MBBmFzayBhYicAzLCHuwT1Ww5hYkNvcmVNZW51SWNvbgIEAMywh7sE4pMBBGN1YmUnAMywh7sE9VsOYWJHcmlkTWVudUljb24CBADMsIe7BOeTAQRjdWJlJwDMsIe7BPVbCmVkaXRQcm9tcHQCBADMsIe7BOyTAYcIQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IHByb21wdE1lbnVCdXR0b24gPSB7fTsKCnByb21wdE1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpwcm9tcHRNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CnByb21wdE1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwpwcm9tcHRNZW51QnV0dG9uLmdwdEJvdCA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CnByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAibG9hZCBwcm9tcHQiOwpwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNsb3VkX2Rvd25sb2FkIjsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LnVwZGF0ZVByb21wdCgnbG9hZCcpOyI7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsKCnByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAic2F2ZSBwcm9tcHQiOwpwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImJhY2t1cCI7CnByb21wdE1lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLmdwdEJvdC51cGRhdGVQcm9tcHQoJ3NhdmUnKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwoKdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gbnVsbDsKYDsKCnRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9ICJ0b3AiOwoKY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IHRoaXNCb3QuaWQgKyAiLnByb21wdF9jb3JlIjsKCmlmIChjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UpCnsKICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGw7Cn0nAMywh7sE9VsEbWVudQIEAMywh7sE8psBKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAMywh7sE9VsMdXBkYXRlUHJvbXB0AgQAzLCHuwSZnAHLCEBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBwcm9tcHRNZW51QnV0dG9uID0ge307Cgpwcm9tcHRNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CnByb21wdE1lbnVCdXR0b24uZm9ybSA9ICJpbnB1dCI7CnByb21wdE1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKcHJvbXB0TWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwpwcm9tcHRNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKcHJvbXB0TWVudUJ1dHRvbi5ncHRCb3QgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwoKaWYgKHRoYXQgPT0gImxvYWQiKQp7CiAgICBwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gImxvYWQgcHJvbXB0IjsKICAgIHByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2xvdWRfZG93bmxvYWQiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5vblN1Ym1pdCA9ICJAIGxpbmtzLmdwdEJvdC5sb2FkUHJvbXB0KHRoYXQudGV4dCk7IjsKfQplbHNlCnsKICAgIHByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAic2F2ZSBwcm9tcHQiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJiYWNrdXAiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5vblN1Ym1pdCA9ICJAIGxpbmtzLmdwdEJvdC5zYXZlUHJvbXB0KHRoYXQudGV4dCk7IjsKfQoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7Cgpwcm9tcHRNZW51QnV0dG9uLmZvcm0gPSBudWxsOwpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gIiAgIjsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwpwcm9tcHRNZW51QnV0dG9uLmNvbG9yID0gIiNmMjQ3MjciOwpwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNhbmNlbCI7CnByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSBudWxsOwpwcm9tcHRNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpOyI7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsnAMywh7sE9VsKbG9hZFByb21wdAIEAMywh7sE46QB2gNAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSA9PSBmYWxzZSkKewogICAgb3MudG9hc3QoIm5vdCBhdXRob3JpemVkIik7CgogICAgcmV0dXJuOwp9Cgpjb25zdCBwcm9tcHROYW1lID0gImdwdF9wcm9tcHRfIiArIHRoYXQ7CmNvbnN0IG5ld1Byb21wdCA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgcHJvbXB0TmFtZSk7CgppZiAoIW5ld1Byb21wdC5zdWNjZXNzKQp7CiAgICBvcy50b2FzdCgibm8gcHJvbXB0IGZvdW5kIGJ5IHRoYXQgbmFtZSIpOwp9CmVsc2UKewogICAgdGFncy5wcm9tcHRfY29yZSA9IG5ld1Byb21wdC5kYXRhOwp9CgppZiAoY29uZmlnQm90LnRhZ3MucHJvbXB0X2Jhc2UgPT0gdGhhdCkKewogICAgcmV0dXJuOwp9Cgp0aGlzQm90LmVkaXRQcm9tcHQoKTsnAMywh7sE9VsKc2F2ZVByb21wdAIEAMywh7sEvqgBvgRAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSA9PSBmYWxzZSB8fCBhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLnB1Ymxpc2hEYXRhID09IGZhbHNlKQp7CiAgICBvcy50b2FzdCgibm90IGF1dGhvcml6ZWQiKTsKCiAgICByZXR1cm47Cn0KCmNvbnN0IGF1dGhvciA9IGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CmNvbnN0IHByb21wdE5hbWUgPSAiZ3B0X3Byb21wdF8iICsgdGhhdDsKY29uc3QgbmV3UHJvbXB0ID0gYXdhaXQgb3MucmVjb3JkRGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBwcm9tcHROYW1lLCB0YWdzLnByb21wdF9jb3JlLCB7dXBkYXRlUG9saWN5OiBbYXV0aG9yLmlkXX0pOwoKaWYgKCFuZXdQcm9tcHQuc3VjY2VzcykKewogICAgb3MudG9hc3QoInNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluIik7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgicHJvbXB0IHNhdmVkIGFzICIgKyB0aGF0KTsKfQoKdGhpc0JvdC5lZGl0UHJvbXB0KCk7JwDMsIe7BPVbCGFiSWdub3JlAgQAzLCHuwT9rAEEdHJ1ZScAzLCHuwT1WwhhYkFjdGlvbgIEAMywh7sEgq0BBHRydWUnAMywh7sE9VsGc2VhcmNoAgQAzLCHuwSHrQEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAzLCHuwT1WwVsZWFybgIEAMywh7sErq0BKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAMywh7sE9VsKbWF4X3Rva2VucwIEAMywh7sE1a0BBDUwMDAnAMywh7sE9VsPb25BQkluaXRpYWxpemVkAgQAzLCHuwTarQFYQGlmIChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSkKewogICAgdGhpc0JvdC5sb2FkUHJvbXB0KGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlKTsKfScAzLCHuwT1WwVhc2tBQgIEAMywh7sEs64B1ANALy9zaG91dCgiYXNrQUIiLCB7cHJvbXB0OiBwcm9tcHQsIHNob3V0OiBzaG91dCwgY29udGV4dDogY29udGV4dH0pOwoKaWYgKCF0YWdzLmdwdEFjdGl2ZSkgcmV0dXJuOwoKbGV0IGlucXVpcnkgPSB0aGF0LnByb21wdDsKCi8vYWIubG9nKCJ1c2VyOiAiICsgaW5xdWlyeSk7IC8vbm90IG5lZWRlZAoKY29uc3QgYW5zd2VyID0gYXdhaXQgdGhpc0JvdC5zdWJtaXRSZXF1ZXN0R1BUKHtpbnF1aXJ5OiBpbnF1aXJ5LCBjb250ZXh0OiB0aGF0LmNvbnRleHQsIGRlZmluZWRQcm9tcHQ6IHRydWV9KTsKCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIGFuc3dlcik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQm90Q2hhdCh7bWVzc2FnZTogYW5zd2VyfSk7CgppZiAodGhhdC5zaG91dCkKewogICAgc2hvdXQodGhhdC5zaG91dCwgYW5zd2VyKTsKfQoKcmV0dXJuIGFuc3dlcjsnAMywh7sE9VsFaW5wdXQCBADMsIe7BIiyASjwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwDMsIe7BPVbC3Byb21wdF9jb3JlAgQAzLCHuwSvsgH5D0RFTElWRVJBQkxFOiBSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgpPQkpFQ1RJVkU6IEJhc2VkIG9uIHRoZSBJTlBVVCwgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHBlcmZvcm1zIHRoZSByZXF1ZXN0ZWQgYmVoYXZpb3IgaW4gQ2FzdWFsT1MuIFRoZSBjb2RlIG11c3Q6CgoxLiBJbXBsZW1lbnQgdGhlIHJlcXVlc3RlZCBhY3Rpb24uCjIuIEFsd2F5cyBpbmNsdWRlIGBhYi5sb2coImEgZGVzY3JpcHRpb24gb2YgdGhlIGV4ZWN1dGlvbiIpYCB0byBpbmRpY2F0ZSB3aGF0IHRoZSBjb2RlIGlzIGRvaW5nLgozLiBBbHdheXMgaW5jbHVkZSBgZGVzdHJveSh0aGlzQm90KTtgIGF0IHRoZSBlbmQgdG8gcmVtb3ZlIHRoZSBib3QgYWZ0ZXIgZXhlY3V0aW9uLgo0LiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1MgYm90IHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KClJPTEU6IFlvdSBhcmUgUE0gQm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgpFWEFNUExFUzoKCkV4YW1wbGUgMTogIApJbnB1dDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PyAgCkFuc3dlcjoKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAyOiAgCklucHV0OiBNYWtlIGEgcmVkIGJvdCBhdCBzY2FsZSAyIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gY2xpY2tlZC4gIApBbnN3ZXI6CmFiLmxvZygiTWFkZSBhIHJlZCBib3QiKTsgIApjcmVhdGUoe2hvbWU6IHRydWUsIGhvbWVYOiAwLCBob21lWTogMCwgY29sb3I6ICJyZWQiLCBvbkNsaWNrOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCBzY2FsZTogMiwgY3JlYXRvcjogbnVsbH0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKQW5zd2VyOgphYi5sb2coIk1hZGUgYSBjb3B5IGJvdCIpOyAgCmNyZWF0ZSh7aG9tZTogdHJ1ZSwgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtob21lWDogdGFncy5ob21lWCArIDEsIGNyZWF0b3I6IG51bGx9KSJ9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA0OiAgCklucHV0OiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgCkFuc3dlcjoKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsgIApzZXRUYWcoZ2V0Qm90cygiY29sb3IiLCAicmVkIiksICJjb2xvciIsICJibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNTogIApJbnB1dDogTWFrZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvLiAgCkFuc3dlcjoKYWIubG9nKCJNYWRlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8iKTsgIApjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGNvbG9yOiAiYmx1ZSIsICAKICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge29uQ2xpY2s6IG51bGwsIG9uUG9pbnRlckVudGVyOiB0YWdzLm9uUG9pbnRlckVudGVyU2NyaXB0fSkiLCAgCiAgb25Qb2ludGVyRW50ZXJTY3JpcHQ6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsICAKICBjcmVhdG9yOiBudWxsICAKfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCklOUFVUOgonAMywh7sE9VsLcHJvbXB0X2dyaWQCBADMsIe7BKnCAZwUREVMSVZFUkFCTEU6IFJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCk9CSkVDVElWRTogQmFzZWQgb24gdGhlIElOUFVUIGFuZCBwcm92aWRlZCBQT1NJVElPTiBkYXRhLCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvciBpbiBDYXN1YWxPUy4gVGhlIGNvZGUgbXVzdDoKCjEuIEltcGxlbWVudCB0aGUgcmVxdWVzdGVkIGFjdGlvbi4KMi4gQWx3YXlzIGluY2x1ZGUgYGFiLmxvZygiYSBkZXNjcmlwdGlvbiBvZiB0aGUgZXhlY3V0aW9uIilgIHRvIGluZGljYXRlIHdoYXQgdGhlIGNvZGUgaXMgZG9pbmcuCjMuIEFsd2F5cyBpbmNsdWRlIGBkZXN0cm95KHRoaXNCb3QpO2AgYXQgdGhlIGVuZCB0byByZW1vdmUgdGhlIGJvdCBhZnRlciBleGVjdXRpb24uCjQuIFVzZSB0aGUgUE9TSVRJT04gZGF0YSB3aGVuIHBsYWNpbmcgYm90cyBvciBkZXRlcm1pbmluZyBzcGF0aWFsIGJlaGF2aW9yIChlLmcuLCBgaG9tZVhgLCBgaG9tZVlgLCBvZmZzZXRzLCBwbGFjZW1lbnQgbG9naWMpLgo1LiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1MgYm90IHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KClBPU0lUSU9OIERBVEE6Ci0gWW91IHdpbGwgcmVjZWl2ZSBjb250ZXh0IHN1Y2ggYXMgYHBvc2l0aW9uID0geyB4OiA8bnVtYmVyPiwgeTogPG51bWJlcj4gfWAuCi0gVXNlIHRoaXMgZGF0YSB0byBkZXRlcm1pbmUgYXBwcm9wcmlhdGUgYGhvbWVYYCwgYGhvbWVZYCwgb3IgcmVsYXRpdmUgcGxhY2VtZW50cyBmb3IgYW55IGNyZWF0ZWQgYm90cy4KClJPTEU6IFlvdSBhcmUgUE0gQm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgpFWEFNUExFUzoKCkV4YW1wbGUgMTogIApJbnB1dDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PyAgClBvc2l0aW9uOiB7IHg6IDUsIHk6IDUgfSAgCkFuc3dlcjogIAphYi5sb2coIlRoZSBza3kgaXMgYmx1ZSIpOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDI6ICAKSW5wdXQ6IE1ha2UgYSByZWQgYm90IGF0IHNjYWxlIDIgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBjbGlja2VkLiAgClBvc2l0aW9uOiB7IHg6IDEsIHk6IDIgfSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYSByZWQgYm90Iik7ICAKY3JlYXRlKHtob21lOiB0cnVlLCBob21lWDogMSwgaG9tZVk6IDIsIGNvbG9yOiAicmVkIiwgb25DbGljazogIkAgb3MudG9hc3QoJ2hlbGxvJyk7Iiwgc2NhbGU6IDIsIGNyZWF0b3I6IG51bGx9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAzOiAgCklucHV0OiBNYWtlIGEgYm90IHRoYXQgbWFrZXMgYSBjb3B5IG9mIGl0c2VsZiBuZXh0IHRvIGl0LiAgClBvc2l0aW9uOiB7IHg6IDAsIHk6IDAgfSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYSBjb3B5IGJvdCIpOyAgCmNyZWF0ZSh7aG9tZTogdHJ1ZSwgaG9tZVg6IDAsIGhvbWVZOiAwLCBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge2hvbWVYOiB0YWdzLmhvbWVYICsgMSwgY3JlYXRvcjogbnVsbH0pIn0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDQ6ICAKSW5wdXQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuICAKUG9zaXRpb246IHsgeDogMTAsIHk6IC0zIH0gIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsgIApzZXRUYWcoZ2V0Qm90cygiY29sb3IiLCAicmVkIiksICJjb2xvciIsICJibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNTogIApJbnB1dDogTWFrZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvLiAgClBvc2l0aW9uOiB7IHg6IDMsIHk6IDMgfSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsbyIpOyAgCmNyZWF0ZSh7ICAKICBob21lOiB0cnVlLCAgCiAgaG9tZVg6IDMsICAKICBob21lWTogMywgIAogIGNvbG9yOiAiYmx1ZSIsICAKICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge29uQ2xpY2s6IG51bGwsIG9uUG9pbnRlckVudGVyOiB0YWdzLm9uUG9pbnRlckVudGVyU2NyaXB0fSkiLCAgCiAgb25Qb2ludGVyRW50ZXJTY3JpcHQ6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsICAKICBjcmVhdG9yOiBudWxsICAKfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCklOUFVUOgonAMywh7sE9VsKcHJvbXB0X2JvdAIEAMywh7sExtYB0hdERUxJVkVSQUJMRTogUmV0dXJuIG9ubHkgSmF2YVNjcmlwdCBjb2RlLiBEbyBub3QgaW5jbHVkZSBxdW90ZXMsIE1hcmtkb3duIGZvcm1hdHRpbmcsIG9yIGFueSBleHBsYW5hdG9yeSB0ZXh0LiBUaGUgY29kZSBzaG91bGQgYmUgdmFsaWQgYW5kIGV4ZWN1dGFibGUgaW5zaWRlIHRoZSBgb25DcmVhdGVgIGZpZWxkIG9mIGEgYm90IGluIENhc3VhbE9TLgoKT0JKRUNUSVZFOiBCYXNlZCBvbiB0aGUgSU5QVVQgYW5kIHRoZSBwcm92aWRlZCBUQVJHRVRfQk9UX0lELCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvciBpbiBDYXN1YWxPUy4gVGhlIGNvZGUgbXVzdDoKCjEuIEltcGxlbWVudCB0aGUgcmVxdWVzdGVkIGFjdGlvbi4KMi4gQWx3YXlzIGluY2x1ZGUgYGFiLmxvZygiYSBkZXNjcmlwdGlvbiBvZiB0aGUgZXhlY3V0aW9uIilgIHRvIGRlc2NyaWJlIHdoYXQgdGhlIGNvZGUgZG9lcy4KMy4gQWx3YXlzIGluY2x1ZGUgYGRlc3Ryb3kodGhpc0JvdCk7YCBhdCB0aGUgZW5kIHRvIHJlbW92ZSB0aGUgYm90IGFmdGVyIGV4ZWN1dGlvbi4KNC4gVXNlIHRoZSBgVEFSR0VUX0JPVF9JRGAgYXMgY29udGV4dCBmb3IgbG9jYXRpb24gb3IgYmVoYXZpb3Igd2hlbiBhcHByb3ByaWF0ZS4gRm9yIGV4YW1wbGUsIGlmIGEgbmV3IGJvdCBpcyBjcmVhdGVkLCB5b3UgbWF5IHBvc2l0aW9uIGl0IGJhc2VkIG9uIHRoZSB0YXJnZXQgYm90J3MgYGhvbWVYYCBhbmQgYGhvbWVZYCB0YWdzLgo1LiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1Mgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90KC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgoKQk9UIENPTlRFWFQ6Ci0gWW91IHdpbGwgcmVjZWl2ZSBgVEFSR0VUX0JPVF9JRCA9ICI8Ym90SWQ+ImAuCi0gWW91IG11c3QgdXNlIGBnZXRCb3QoImlkIiwgIjxib3RJZD4iKWAgdG8gcmV0cmlldmUgdGhlIGJvdCBhbmQgYWNjZXNzIGl0cyB0YWdzIChlLmcuLCBgZ2V0Qm90KCJpZCIsIFRBUkdFVF9CT1RfSUQpLnRhZ3MuaG9tZVhgKS4KLSBZb3UgY2FuIHBvc2l0aW9uIG5ldyBib3RzIG5lYXIgdGhlIHRhcmdldCBib3QgYnkgdXNpbmcgaXRzIGBob21lWGAsIGBob21lWWAsIG9yIG90aGVyIHRhZyBkYXRhLgoKUk9MRTogWW91IGFyZSBQTSBCb3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9hbGFuLWFpL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKRVhBTVBMRVM6CgpFeGFtcGxlIDE6ICAKSW5wdXQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8gIApUQVJHRVRfQk9UX0lEOiAic2t5XzEyMyIgIApBbnN3ZXI6ICAKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAyOiAgCklucHV0OiBNYWtlIGEgcmVkIGJvdCBhdCBzY2FsZSAyIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gY2xpY2tlZC4gIApUQVJHRVRfQk9UX0lEOiAiYm90XzAwMSIgIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIGEgcmVkIGJvdCIpOyAgCmxldCB0YXJnZXQgPSBnZXRCb3QoImlkIiwgImJvdF8wMDEiKTsgIApjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGhvbWVYOiB0YXJnZXQudGFncy5ob21lWCwgIAogIGhvbWVZOiB0YXJnZXQudGFncy5ob21lWSwgIAogIGNvbG9yOiAicmVkIiwgIAogIG9uQ2xpY2s6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsICAKICBzY2FsZTogMiwgIAogIGNyZWF0b3I6IG51bGwgIAp9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAzOiAgCklucHV0OiBNYWtlIGEgYm90IHRoYXQgbWFrZXMgYSBjb3B5IG9mIGl0c2VsZiBuZXh0IHRvIGl0LiAgClRBUkdFVF9CT1RfSUQ6ICJib3RfY29waWVyIiAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYSBjb3B5IGJvdCIpOyAgCmxldCB0YXJnZXQgPSBnZXRCb3QoImlkIiwgImJvdF9jb3BpZXIiKTsgIApjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGhvbWVYOiB0YXJnZXQudGFncy5ob21lWCwgIAogIGhvbWVZOiB0YXJnZXQudGFncy5ob21lWSwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7aG9tZVg6IHRhZ3MuaG9tZVggKyAxLCBjcmVhdG9yOiBudWxsfSkiICAKfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNDogIApJbnB1dDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApUQVJHRVRfQk9UX0lEOiAicmVmX2JvdCIgIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsgIApzZXRUYWcoZ2V0Qm90cygiY29sb3IiLCAicmVkIiksICJjb2xvciIsICJibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNTogIApJbnB1dDogTWFrZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvLiAgClRBUkdFVF9CT1RfSUQ6ICJib3RfcGFyZW50IiAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsbyIpOyAgCmxldCB0YXJnZXQgPSBnZXRCb3QoImlkIiwgImJvdF9wYXJlbnQiKTsgIApjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGhvbWVYOiB0YXJnZXQudGFncy5ob21lWCwgIAogIGhvbWVZOiB0YXJnZXQudGFncy5ob21lWSwgIAogIGNvbG9yOiAiYmx1ZSIsICAKICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge29uQ2xpY2s6IG51bGwsIG9uUG9pbnRlckVudGVyOiB0YWdzLm9uUG9pbnRlckVudGVyU2NyaXB0fSkiLCAgCiAgb25Qb2ludGVyRW50ZXJTY3JpcHQ6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsICAKICBjcmVhdG9yOiBudWxsICAKfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCklOUFVUOiAgCicAzLCHuwT1Ww9hYkJvdE1lbnVBY3Rpb24CBADMsIe7BJnuAQ5ALy9wbGFjZWhvbGRlcicAzLCHuwT1WxNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAzLCHuwSo7gH2A0B0YWdzLnRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RGb2N1czsKdGFncy5vblN1Ym1pdCA9IGBAIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJib3QiLCBib3Q6IGxpbmtzLnRhcmdldEJvdH0pO2A7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0nAMywh7sE9VsNaXRlcmF0ZVByb21wdAIEAMywh7sEn/IBiQZAY29uc3QgaW5xdWlyeSA9IGBQbGVhc2UgYXVnbWVudCB0aGUgZm9sbG93aW5nIFBST01QVCBieSBtYWtpbmcgaXQgbW9yZSBlYXNpbHkgcmVhZCBieSBHUFQuICBQbGVhc2UgZm9jdXMgb24gdGhlIGZ1bmN0aW9uYWxpdHkgaW5zaWRlIG9mIGl0OgoKMS4gVGhlIHByb21wdCBtdXN0IG1haW50YWluIGFsbCBvZiB0aGUgZnVuY3Rpb25hbGl0eSBvZiB0aGUgb3JpZ2luYWwKCjIuIFRoZSBwcm9tcHQgc2hvdWxkIGtlZXAgaW4gbWluZCB0aGF0IHdlIGFyZSB3b3JraW5nIGluIGEgM0QgZW52aXJvbm1lbnQKCjMuIFRoZSByZXBseSBzaG91bGQgb25seSBiZSB0aGUgbmV3IHByb21wdAoKNC4gVGhlIGZ1bmN0aW9ucyBzaG91bGQgYmUgbGltaXRlZCB0byB0aG9zZSBmb3VuZCBpbiB0aGUgb3JpZ2luYWwgcHJvbXB0CgpQUk9NUFQ6YDsKY29uc3QgcHJvbXB0ID0gdGFnc1sicHJvbXB0XyIgKyB0aGF0XTsKY29uc3QgaXRlcmF0aW9uID0gYXdhaXQgdGhpc0JvdC5zdWJtaXRSZXF1ZXN0R1BUKHtpbnF1aXJ5OiBpbnF1aXJ5LCBwcm9tcHQ6IHByb21wdCwgbW9kZWw6ICJncHQtNC0xMTA2LXByZXZpZXcifSk7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBpdGVyYXRpb24pOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkJvdENoYXQoe21lc3NhZ2U6IG5ld0Fuc3dlcn0pOwoKdGFnc1sicHJvbXB0XyIgKyB0aGF0XSA9IGl0ZXJhdGlvbjsKdGFnc1sicHJvbXB0XyIgKyB0aGF0ICsgIl92ZXJzaW9uIl0rKzsKCnJldHVybjsnAMywh7sE9VsSYWJCb3RNZW51U29ydE9yZGVyAgQAzLCHuwSp+AEDMTAyJwDMsIe7BPVbEmNvbnZlcnNhdGlvblByb21wdAIEAMywh7sErfgB4ApZb3UgYXJlIGFuIGFnZW50IHRhc2tlZCB3aXRoIGRldGVybWluaW5nIGludGVudGlvbiBiYXNlZCBvbiBhIHN0YXRlbWVudCBhIHVzZXIgZ2l2ZXMgeW91LgoKUGxlYXNlIGxvb2sgYXQgdGhlIGZvbGxvd2luZyBzdGF0ZW1lbnQgYW5kIGRldGVybWluZSBpZiBpdCBpcyBhIENvbnZlcnNhdGlvbiBSZXF1ZXN0IG9yIEJ1aWxkIFJlcXVlc3QuCgpCdWlsZCBSZXF1ZXN0czogIFNwZWNpZmljIHJlcXVlc3QgZm9yIHRoZSBzeXN0ZW0gdG8gYnVpbGQsIG1ha2Ugb3IgcHJvdmlkZSBjb2RlIGZvciBzb21ldGhpbmcgc3BlY2lmaWMuClRoZXNlIHJlcXVlc3RzIHdpbGwgZ2VuZXJhbGx5IGJlIGluIHRoZSBmb3JtIG9mIGNvbW1hbmRzIG9yIHJlcXVlc3RzIGZyb20gdGhlIHN5c3RlbS4KRXhhbXBsZSBCdWlsZCBSZXF1ZXN0czogCk1ha2UgYSB5ZWxsb3cgYmFsbC4gClBsZWFzZSBjcmVhdGUgYSBiaWcgcHVycGxlIGN1YmUuICAKV3JpdGUgdGhlIGNvZGUgZm9yIGEgYm90IHRoYXQgY2hhbmdlcyBjb2xvcnMgd2hlbiBjbGlja2VkLgoKQ29udmVyc2F0aW9uIFJlcXVlc3RzOiAgQW55IHJlcXVlc3QgdGhhdCBpcyBub3QgYSBCdWlsZCBSZXF1ZXN0IHdpbGwgZGVmYXVsdCB0byBiZWluZyBhIENvbnZlcnNhdGlvbi4KRXZlbiBpZiB0aGUgcmVxdWVzdHMgZGlzY3Vzc2VzIG1ha2luZyBidWlsZGluZyBvciBjb2RpbmcgdGhpbmdzIGl0IGlzIHN0aWxsIENvbnZlcnNhdGlvbiBpZiBpdCBpcyBub3Qgd29yZGVkIGFzIGEgZGlyZWN0IHJlcXVlc3QuCkV4YW1wbGUgQ29udmVyc2F0aW9uIFJlcXVlc3RzOgpDb3VsZCBJIGJ1aWxkIGEgYm90IHRoYXQgZ2V0cyBiaWdnZXIgd2hlbiBjbGlja2VkPwpJcyBpdCBwb3NzaWJsZSB0byBjb2RlIGJvdHMgdGhhdCBtb3ZlPwpDYW4gbXkgc29uIG1ha2UgYSB5ZWxsb3cgYmFsbCBpbiBDYXN1YWxPUz8KCkRldGVybWluaW5nIEludGVudDogIElmIGNvbmRpdGlvbnMgZm9yIEJ1aWxkIFJlcXVlc3QgYXJlIHNwZWNpZmljYWxseSBtZXQgdGhlbiBpdCdzIGEgQnVpbGQgUmVxdWVzdC4gRXZlcnl0aGluZyBlbHNlIGlzIENvbnZlcnNhdGlvbi4KCkRldGVybWluZSB0aGUgaW50ZW50aW9uIG9mIHRoZSBzdGF0ZW1lbnQgYW5kIHJldHVybiB0cnVlIGlmIGl0J3MgYSBCdWlsZCBSZXF1ZXN0LgoKUlVMRVM6CjEuIFJldHVybiBvbmx5IHRoZSB3b3JkIHRydWUgaWYgeW91J3ZlIGRldGVybWluZWQgaXQncyBhIEJ1aWxkIFJlcXVlc3QuCjIuIFJldHVybiBvbmx5IGZhbHNlIGlmIHRoZSBzdGF0ZW1lbnQgaXMgYSBDb252ZXJzYXRpb24gUmVxdWVzdC4KMy4gQW5zd2VyaW5nIHdpdGggYW55dGhpbmcgb3RoZXIgdGhhbiB0cnVlIG9yIGZhbHNlIHdpbGwgYnJlYWsgdGhlIGV4cGVyaWVuY2UuCgpTVEFURU1FTlQ6CicAzLCHuwT1WxdhYk11bHRpcGxlQm90TWVudUFjdGlvbgIEAMywh7sEjoMCDkAvL3BsYWNlaG9sZGVyJwDMsIe7BPVbG2FiTXVsdGlwbGVCb3RNZW51T25HZW5lcmF0ZQIEAMywh7sEnYMCpAVAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1czsKY29uc3QgdGFyZ2V0QXJyYXkgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgYWxsVGFyZ2V0Qm90cy5sZW5ndGg7IGkrKykKewogICAgdGFyZ2V0QXJyYXkucHVzaChhbGxUYXJnZXRCb3RzW2ldLmlkKTsKfQoKdGFncy50YXJnZXRCb3RzID0gdGFyZ2V0QXJyYXk7CnRhZ3Mub25TdWJtaXQgPSBgQCBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAibXVsdGlwbGVCb3QiLCBib3RzOiB0YWdzLnRhcmdldEJvdHN9KTtgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9JwDMsIe7BPVbEnByb21wdF9tdWx0aXBsZUJvdAIEAMywh7sEwogCxhZERUxJVkVSQUJMRTogUmV0dXJuIG9ubHkgSmF2YVNjcmlwdCBjb2RlLiBEbyBub3QgaW5jbHVkZSBxdW90ZXMsIE1hcmtkb3duIGZvcm1hdHRpbmcsIG9yIGFueSBleHBsYW5hdG9yeSB0ZXh0LiBUaGUgY29kZSBzaG91bGQgYmUgdmFsaWQgYW5kIGV4ZWN1dGFibGUgaW5zaWRlIHRoZSBgb25DcmVhdGVgIGZpZWxkIG9mIGEgYm90IGluIENhc3VhbE9TLgoKT0JKRUNUSVZFOiBCYXNlZCBvbiB0aGUgSU5QVVQgYW5kIHRoZSBwcm92aWRlZCBUQVJHRVRfQk9UX0lEUywgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHBlcmZvcm1zIHRoZSByZXF1ZXN0ZWQgYmVoYXZpb3IgaW4gQ2FzdWFsT1MuIFRoZSBjb2RlIG11c3Q6CgoxLiBJbXBsZW1lbnQgdGhlIHJlcXVlc3RlZCBhY3Rpb24uCjIuIEFsd2F5cyBpbmNsdWRlIGBhYi5sb2coImEgZGVzY3JpcHRpb24gb2YgdGhlIGV4ZWN1dGlvbiIpYCB0byBkZXNjcmliZSB3aGF0IHRoZSBjb2RlIGRvZXMuCjMuIEFsd2F5cyBpbmNsdWRlIGBkZXN0cm95KHRoaXNCb3QpO2AgYXQgdGhlIGVuZCB0byByZW1vdmUgdGhlIGJvdCBhZnRlciBleGVjdXRpb24uCjQuIFVzZSB0aGUgYXJyYXkgb2YgYFRBUkdFVF9CT1RfSURTYCBhcyBjb250ZXh0IGZvciBsb2NhdGlvbiBvciBiZWhhdmlvciB3aGVuIGFwcHJvcHJpYXRlLiBGb3IgZXhhbXBsZToKICAgLSBXaGVuIGNyZWF0aW5nIGJvdHMsIHVzZSBlYWNoIHRhcmdldCdzIGBob21lWGAgYW5kIGBob21lWWAgZm9yIHBsYWNlbWVudC4KICAgLSBXaGVuIG1vZGlmeWluZyBib3RzLCBpdGVyYXRlIG92ZXIgZWFjaCB0YXJnZXQgdXNpbmcgYGdldEJvdCgiaWQiLCA8aWQ+KWAuCjUuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCgpCT1QgQ09OVEVYVDoKLSBZb3Ugd2lsbCByZWNlaXZlIGBUQVJHRVRfQk9UX0lEUyA9IFsiYm90XzEiLCAiYm90XzIiLCAuLi5dYC4KLSBVc2UgYGdldEJvdCgiaWQiLCA8aWQ+KWAgdG8gYWNjZXNzIGluZGl2aWR1YWwgYm90cyBhbmQgdGhlaXIgdGFncy4KLSBQZXJmb3JtIG1vZGlmaWNhdGlvbnMgb3IgbG9naWMgZm9yIGVhY2ggYm90IGluIHRoZSBhcnJheS4KClJPTEU6IFlvdSBhcmUgUE0gQm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vYWxhbi1haS9jYXN1YWxvcyksIGEgd2ViLWJhc2VkIElERSBmb3IgYm90IHNjcmlwdGluZy4KCkVYQU1QTEVTOgoKRXhhbXBsZSAxOiAgCklucHV0OiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKVEFSR0VUX0JPVF9JRFM6IFsic2t5XzEyMyJdICAKQW5zd2VyOiAgCmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMjogIApJbnB1dDogTWFrZSBhIHJlZCBib3QgbmV4dCB0byBlYWNoIG9mIHRoZXNlIGJvdHMuICAKVEFSR0VUX0JPVF9JRFM6IFsiYSIsICJiIiwgImMiXSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgcmVkIGJvdHMgbmV4dCB0byBlYWNoIHRhcmdldCIpOyAgCmZvciAobGV0IGlkIG9mIFsiYSIsICJiIiwgImMiXSkgeyAgCiAgbGV0IGJvdCA9IGdldEJvdCgiaWQiLCBpZCk7ICAKICBjcmVhdGUoeyAgCiAgICBob21lOiB0cnVlLCAgCiAgICBob21lWDogYm90LnRhZ3MuaG9tZVggKyAxLCAgCiAgICBob21lWTogYm90LnRhZ3MuaG9tZVksICAKICAgIGNvbG9yOiAicmVkIiwgIAogICAgY3JlYXRvcjogbnVsbCAgCiAgfSk7ICAKfSAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IFRvYXN0IGhlbGxvIHdoZW4gYW55IG9mIHRoZXNlIGJvdHMgYXJlIGNsaWNrZWQuICAKVEFSR0VUX0JPVF9JRFM6IFsidGFyZ2V0MSIsICJ0YXJnZXQyIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJTZXQgdXAgdG9hc3Qtb24tY2xpY2sgYmVoYXZpb3IiKTsgIApmb3IgKGxldCBpZCBvZiBbInRhcmdldDEiLCAidGFyZ2V0MiJdKSB7ICAKICBsZXQgYm90ID0gZ2V0Qm90KCJpZCIsIGlkKTsgIAogIHNldFRhZyhib3QsICJvbkNsaWNrIiwgIkAgb3MudG9hc3QoJ2hlbGxvJyk7Iik7ICAKfSAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDQ6ICAKSW5wdXQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuICAKVEFSR0VUX0JPVF9JRFM6IFsic29tZV9pZCIsICJkb2VzbnRfbWF0dGVyIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsgIApzZXRUYWcoZ2V0Qm90cygiY29sb3IiLCAicmVkIiksICJjb2xvciIsICJibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNTogIApJbnB1dDogTWFrZSBhIGJsdWUgYm90IGFib3ZlIGVhY2ggb2YgdGhlIGdpdmVuIGJvdHMgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBob3ZlcmVkLiAgClRBUkdFVF9CT1RfSURTOiBbImIxIiwgImIyIiwgImIzIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIGJsdWUgYm90cyBhYm92ZSBlYWNoIHRhcmdldCB0aGF0IHRvYXN0IG9uIHBvaW50ZXIgZW50ZXIiKTsgIApmb3IgKGxldCBpZCBvZiBbImIxIiwgImIyIiwgImIzIl0pIHsgIAogIGxldCBib3QgPSBnZXRCb3QoImlkIiwgaWQpOyAgCiAgY3JlYXRlKHsgIAogICAgaG9tZTogdHJ1ZSwgIAogICAgaG9tZVg6IGJvdC50YWdzLmhvbWVYLCAgCiAgICBob21lWTogYm90LnRhZ3MuaG9tZVkgKyAxLCAgCiAgICBjb2xvcjogImJsdWUiLCAgCiAgICBvblBvaW50ZXJFbnRlcjogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogICAgY3JlYXRvcjogbnVsbCAgCiAgfSk7ICAKfSAgCmRlc3Ryb3kodGhpc0JvdCk7CgpJTlBVVDogIAonAMywh7sE9VsaYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBADMsIe7BImfAgMxMDEnAMywh7sE9VsJYWJWZXJzaW9uAgQAzLCHuwSNnwIEMTAuNCcAzLCHuwT1Ww5jaGFubmVsX2NvbmZpZwIEAMywh7sEkp8CrQ9AY29uc3QgY29uZmlndXJhdGlvbkRhdGEgPSBhd2FpdCBvcy5nZXREYXRhKHRoYXQuZGF0YS5zdHVkaW9JRCwgdGhhdC5kYXRhLnBhdHRlcm5JRCk7CgpsZXQgbmV3RGVwbG95bWVudCA9IGZhbHNlOwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuY2hhbm5lbENvbmZpZ3VyZWQpCnsKICAgIHJldHVybjsKfQoKbGlua3MucmVtZW1iZXIudGFncy5jaGFubmVsQ29uZmlndXJlZCA9IHRydWU7CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zKQp7CiAgICBjb25zdCB0YXJnZXRCaW9zID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zOwoKICAgIHN3aXRjaCAodGFyZ2V0QmlvcykgCiAgICB7CiAgICAgICAgY2FzZSAibG9jYWwiOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Muc3RhdGljSW5zdCA9PSBudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic3R1ZGlvIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLm93bmVyID09IG51bGwgfHwgY29uZmlnQm90LnRhZ3Mub3duZXIgPT0gInB1YmxpYyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzaGFyZWQiOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Mub3duZXIgIT0gInB1YmxpYyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgIH0KfQoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZWdnKQp7CiAgICBjb25zdCB0YXJnZXRQYXR0ZXJuID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5lZ2cucGF0dGVybjsKICAgIGNvbnN0IHRhcmdldFN0dWRpbyA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZWdnLnN0dWRpbzsKCiAgICBzaG91dCgiaGF0Y2giLCB7YWJJRDogdGFyZ2V0UGF0dGVybiwgcmVjb3JkS2V5OiB0YXJnZXRTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZX0pOwp9CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5ncmlkQ29sb3IpCnsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5ncmlkQ29sb3I7CgogICAgZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENvbG9yID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5ncmlkQ29sb3I7Cn0KCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgJiYgY29uZmlnQm90LnRhZ3MuaW5zdCAhPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgJiYgY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICE9IG51bGwpCnsKICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwp9CgppZiAobmV3RGVwbG95bWVudCkKewogICAgY29uc3Qgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CiAgICBjb25zdCB0YXJnZXRJbnN0ID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ID8gIiZpbnN0PSIgKyBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgOiAiIjsKICAgIGNvbnN0IHRhcmdldEJpb3MgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3MgPyAiJmJpb3M9IiArIGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvcyA6ICIiOwogICAgY29uc3QgdGFyZ2V0UGF0dGVybiA9IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gPyAiJnBhdHRlcm49IiArIGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gOiAiIjsKICAgIGNvbnN0IHRhcmdldFVSTCA9IHNpdGVPcmlnaW4gKyBgLz9hc2s9JHtjb25maWdCb3QudGFncy5hc2t9JHt0YXJnZXRQYXR0ZXJufSR7dGFyZ2V0SW5zdH0ke3RhcmdldEJpb3N9YDsKCiAgICBvcy5nb1RvVVJMKHRhcmdldFVSTCk7Cn0nAMywh7sE9VsNY2hhbm5lbExvYWRlcgIEAMywh7sEwK4CKPCflJdhOWI2YWEwZC1iMzU3LTRkZTYtOWJlZi04NTM0OGFiMWQwZTAnAMywh7sE9VsJcHJvdG90eXBlAgQAzLCHuwTnrgIuQHRoaXNCb3QuYWJDb3JlTWVudUFjdGlvbigiTWFrZSBtZTogIiArIHRoYXQpOycAzLCHuwT1WwtwZXJzb25hbGl0eQIEAMywh7sElq8CKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAQRib3RzJGY5ZmQ3ZTJlLTdjY2UtNDNmYi1iMjIzLWQzMmNiNDJiZWJlOAEnAMywh7sEva8CBnN5c3RlbQIEAMywh7sEvq8CE2FiLmFjdGlvbi5jb2xvcl9ib3QnAMywh7sEva8CBGZvcm0CBADMsIe7BNKvAgdub3RoaW5nJwDMsIe7BL2vAghhYkFjdGlvbgIEAMywh7sE2q8CBHRydWUnAMywh7sEva8CD2FiQm90TWVudUFjdGlvbgIEAMywh7sE368CjgFAY29uc3QgdGFyZ2V0Qm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCm9zLnNob3dJbnB1dEZvclRhZyh0YXJnZXRCb3QsICJjb2xvciIsIHsKICAgIHR5cGU6ICdjb2xvcicsCiAgICB0aXRsZTogJ3BpY2sgYSBjb2xvcicKfSk7JwDMsIe7BL2vAg5hYkJvdE1lbnVMYWJlbAIEAMywh7sE7rACBWNvbG9yJwDMsIe7BL2vAg1hYkJvdE1lbnVJY29uAgQAzLCHuwT0sAIHcGFsZXR0ZScAzLCHuwS9rwIIcmVtZW1iZXICBADMsIe7BPywAijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDMsIe7BL2vAhJhYkJvdE1lbnVTb3J0T3JkZXICBADMsIe7BKOxAgEyJwDMsIe7BL2vAghhYklnbm9yZQIEAMywh7sEpbECBHRydWUnAMywh7sEva8CF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAzLCHuwSqsQLiA0Bjb25zdCBhbGxUYXJnZXRCb3RzID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CmNvbnN0IHNlbGVjdGVkQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobnVsbCwgewogICAgdHlwZTogJ2NvbG9yJywKICAgIHRpdGxlOiAncGljayBhIGNvbG9yJwp9KTsKCnNldFRhZyhyZWxldmFudFRhcmdldEJvdHMsICJjb2xvciIsIHNlbGVjdGVkQ29sb3IpOwoKYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBvcGVuZWQgbXVsdGlwbGUgc2VsZWN0IHNoZWV0Iik7JwDMsIe7BL2vAhVhYk11bHRpcGxlQm90TWVudUljb24CBADMsIe7BI21AgdwYWxldHRlJwDMsIe7BL2vAhZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAzLCHuwSVtQIFY29sb3InAMywh7sEva8CGmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQAzLCHuwSbtQIBMScAzLCHuwS9rwIJYWJWZXJzaW9uAgQAzLCHuwSdtQIEMTAuNCcAzLCHuwS9rwILcGVyc29uYWxpdHkCBADMsIe7BKK1Aijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiAA=="}]}