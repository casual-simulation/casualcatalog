{"version":2,"updates":[{"id":0,"timestamp":1758340851368,"update":"AeoC7e3+oQcAJwEEYm90cyQzOTg4MDFmZS00YjM1LTRjZTQtODI2Zi0yMzgzNWMxYjlhYzUBJwDt7f6hBwAGc3lzdGVtAgQA7e3+oQcBFGFiLmFjdGlvbi5jcmVhdGVfYm90JwDt7f6hBwAIYWJBY3Rpb24CBADt7f6hBxYEdHJ1ZScA7e3+oQcABGZvcm0CBADt7f6hBxsHbm90aGluZycA7e3+oQcAC2Rlc2NyaXB0aW9uAgQA7e3+oQcjDUNyZWF0ZXMgYm90cy4nAO3t/qEHABBhYkdyaWRNZW51QWN0aW9uAgQA7e3+oQcxsQVAY29uc3QgZ3JpZEluZm9ybWF0aW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKY29uc3QgbmV3Qm90ID0ge307CgpuZXdCb3QuY3JlYXRvciA9IG51bGw7Cm5ld0JvdFtncmlkSW5mb3JtYXRpb24uZGltZW5zaW9uXSA9IHRydWU7Cm5ld0JvdFtncmlkSW5mb3JtYXRpb24uZGltZW5zaW9uICsgIlgiXSA9IGdyaWRJbmZvcm1hdGlvbi5wb3NpdGlvbi54OwpuZXdCb3RbZ3JpZEluZm9ybWF0aW9uLmRpbWVuc2lvbiArICJZIl0gPSBncmlkSW5mb3JtYXRpb24ucG9zaXRpb24ueTsKbmV3Qm90LmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKCmxldCBjcmVhdGVkQm90ID0gY3JlYXRlKG5ld0JvdCk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90Lm1hc2tzLmxpbmVDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QubWFza3MubGluZVRvID0gY3JlYXRlZEJvdC5pZDsKCmxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQm90Rm9jdXMgPSAi8J+UlyIgKyBjcmVhdGVkQm90LmlkOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHttZW51OiAiYm90In0pOycA7e3+oQcAD2FiR3JpZE1lbnVMYWJlbAIEAO3t/qEH4QUDYm90JwDt7f6hBwAOYWJHcmlkTWVudUljb24CBADt7f6hB+UFB2FkZF9ib3gnAO3t/qEHAAhyZW1lbWJlcgIEAO3t/qEH7QUo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA7e3+oQcADW1hbmlmZXN0YXRpb24CBADt7f6hB5QGKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAO3t/qEHAAhhYklnbm9yZQIEAO3t/qEHuwYEdHJ1ZScA7e3+oQcAE2FiR3JpZE1lbnVTb3J0T3JkZXICBADt7f6hB8AGATEnAO3t/qEHAAlhYlZlcnNpb24CBADt7f6hB8IGBTEwLjEwJwDt7f6hBwALcGVyc29uYWxpdHkCBADt7f6hB8gGKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAQRib3RzJDU4NDlhZjU1LTVlOGEtNDhkNi05MTA2LTE5OTQ5OGU5ZWMwOAEnAO3t/qEH7wYGc3lzdGVtAgQA7e3+oQfwBhFhYi5hY3Rpb24uZGVzdHJveScA7e3+oQfvBghhYkFjdGlvbgIEAO3t/qEHggcEdHJ1ZScA7e3+oQfvBgRmb3JtAgQA7e3+oQeHBwdub3RoaW5nJwDt7f6hB+8GD2FiQm90TWVudUFjdGlvbgIEAO3t/qEHjwfAAkBjb25zdCB0YXJnZXRCb3QgPSB0aGF0LmJvdC5saW5rcy50YXJnZXRCb3Q7CgppZiAodGhhdC5ib3QubGlua3MudGFyZ2V0T3JpZ2luQm90cykgewogICAgLy8gRGVzdHJveSBib3RzIGJlbG9uZ2luZyB0byBhYklET3JpZ2luLgogICAgZGVzdHJveSh0aGF0LmJvdC5saW5rcy50YXJnZXRPcmlnaW5Cb3RzKTsKfSBlbHNlIHsKICAgIC8vIERlc3Ryb3kgdGhlIHNpbmdsZSB0YXJnZXQgYm90LgogICAgZGVzdHJveSh0YXJnZXRCb3QpOwp9CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7JwDt7f6hB+8GDmFiQm90TWVudUxhYmVsAgQA7e3+oQfQCQdkZXN0cm95JwDt7f6hB+8GDWFiQm90TWVudUljb24CBADt7f6hB9gJDmRlbGV0ZV9mb3JldmVyJwDt7f6hB+8GEmFiQm90TWVudVNvcnRPcmRlcgIEAO3t/qEH5wkDMTAwJwDt7f6hB+8GCHJlbWVtYmVyAgQA7e3+oQfrCSjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDt7f6hB+8GDW1hbmlmZXN0YXRpb24CBADt7f6hB5IKKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAO3t/qEH7wYIYWJJZ25vcmUCBADt7f6hB7kKBHRydWUnAO3t/qEH7wYOYWJCb3RNZW51Q29sb3ICBADt7f6hB74KByNEOTMwMzAnAO3t/qEH7wYXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBADt7f6hB8YKwANAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgpkZXN0cm95KHJlbGV2YW50VGFyZ2V0Qm90cyk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7JwDt7f6hB+8GFWFiTXVsdGlwbGVCb3RNZW51SWNvbgIEAO3t/qEHhw4OZGVsZXRlX2ZvcmV2ZXInAO3t/qEH7wYWYWJNdWx0aXBsZUJvdE1lbnVMYWJlbAIEAO3t/qEHlg4HZGVzdHJveScA7e3+oQfvBhphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAO3t/qEHng4DMTAwJwDt7f6hB+8GFmFiTXVsdGlwbGVCb3RNZW51Q29sb3ICBADt7f6hB6IOByNEOTMwMzAnAO3t/qEH7wYJYWJWZXJzaW9uAgQA7e3+oQeqDgUxMC4xMCcA7e3+oQfvBhNhYkJvdE1lbnVPbkdlbmVyYXRlAgQA7e3+oQewDq0HQGNvbnN0IHRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgppZiAodGFyZ2V0Qm90KSB7CiAgICB0YWdzLmxhYmVsID0gJ2Rlc3Ryb3knOwogICAgdGFncy50YXJnZXRCb3QgPSBnZXRMaW5rKHRhcmdldEJvdCk7CiAgICB0YWdzLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygiU2hpZnQiKSkgewogICAgICAgICAgICBpZiAobGlua3MudGFyZ2V0Qm90ICYmIGxpbmtzLnRhcmdldEJvdC50YWdzLmFiSURPcmlnaW4pIHsKICAgICAgICAgICAgICAgIC8vIENoYW5nZSBidXR0b24gdG8gZGVzdHJveSBhbGwgYm90cyB3aXRoIHNhbWUgYWJJRE9yaWdpbi4KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE9yaWdpbkJvdHMgPSBnZXRCb3RzKGIgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnRhZ3MuYWJJRE9yaWdpbiA9PT0gbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbjsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbWFza3MubGFiZWwgPSAnZGVzdHJveSAnICsgbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbiArICcgKCcgKyB0YXJnZXRPcmlnaW5Cb3RzLmxlbmd0aCArICcgYm90cyknOwogICAgICAgICAgICAgICAgdGFncy50YXJnZXRPcmlnaW5Cb3RzID0gZ2V0TGluayh0YXJnZXRPcmlnaW5Cb3RzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGA7CiAgICB0YWdzLm9uS2V5VXAgPSBgQAogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoIlNoaWZ0IikpIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSBudWxsOwogICAgICAgICAgICB0YWdzLnRhcmdldE9yaWdpbkJvdHMgPSBudWxsOwogICAgICAgIH0KICAgIGA7Cn0gZWxzZSB7CiAgICAvLyBObyBib3QgdG8gZGVzdHJveS4KICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAO3t/qEH7wYbYWJNdWx0aXBsZUJvdE1lbnVPbkdlbmVyYXRlAgQA7e3+oQfeFe8EQGNvbnN0IGFsbFRhcmdldEJvdHMgPSBBcnJheS5pc0FycmF5KGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cykgPyBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMgOiBbbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzXTsKY29uc3QgYnVpbGRlciA9IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QgPyBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90LmlkIDogbnVsbDsKY29uc3QgcmVsZXZhbnRUYXJnZXRCb3RzID0gYWxsVGFyZ2V0Qm90cy5maWx0ZXIoKHRhcmdldCkgPT4gdGFyZ2V0LmlkICE9IGJ1aWxkZXIpOwoKaWYgKHJlbGV2YW50VGFyZ2V0Qm90cy5sZW5ndGggPiAxKSB7CiAgICAvLyBNdWx0aXBsZSBib3RzLgogICAgdGFncy5sYWJlbCA9IGBkZXN0cm95ICgke3JlbGV2YW50VGFyZ2V0Qm90cy5sZW5ndGh9IGJvdHMpYDsKfSBlbHNlIGlmIChyZWxldmFudFRhcmdldEJvdHMubGVuZ3RoID09PSAxKSB7CiAgICAvLyBTaW5nbGUgYm90LgogICAgdGFncy5sYWJlbCA9IGBkZXN0cm95YDsKfSBlbHNlIHsKICAgIC8vIE5vIGJvdHMgdG8gZGVzdHJveS4KICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAQRib3RzJDZiM2Q5NzQ0LTQ0NDgtNGVmNS05NmEyLTcxMjgxYzQyYWY2YwEnAO3t/qEHzhoJYWJWZXJzaW9uAgQA7e3+oQfPGgUxMC4xMCcA7e3+oQfOGgZzeXN0ZW0CBADt7f6hB9UaEWFiLmFjdGlvbi52ZXJzaW9uJwDt7f6hB84aFGFiQWN0aW9uTWFqb3JWZXJzaW9uAgQA7e3+oQfnGgExJwDt7f6hB84aFGFiQWN0aW9uTWlub3JWZXJzaW9uAgQA7e3+oQfpGgE5JwDt7f6hB84aDW9uU2tpbGxVcGRhdGUCBADt7f6hB+samQFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJBY3Rpb25NYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiQWN0aW9uTWlub3JWZXJzaW9uOwoKY29uc29sZS5sb2coIltBQkFjdGlvbl0gTG9hZGVkIEFCIEFjdGlvbiB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAO3t/qEHzhoIYWJJZ25vcmUCBADt7f6hB4UcBHRydWUnAO3t/qEHzhoIYWJBY3Rpb24CBADt7f6hB4ocBHRydWUnAO3t/qEHzhoEZm9ybQIEAO3t/qEHjxwHbm90aGluZycBBGJvdHMkNzE3NTY0NWMtNGI1My00NDU0LTg3MTYtZmMwZTY4ZGIyNjY1AScA7e3+oQeXHAZzeXN0ZW0CBADt7f6hB5gcD2FiLmFjdGlvbi5sb2dpbicA7e3+oQeXHAhhYkFjdGlvbgIEAO3t/qEHqBwEdHJ1ZScA7e3+oQeXHAhhYklnbm9yZQIEAO3t/qEHrRwEdHJ1ZScA7e3+oQeXHARmb3JtAgQA7e3+oQeyHAdub3RoaW5nJwDt7f6hB5ccD2FiQ29yZU1lbnVDb2xvcgIEAO3t/qEHuhwHI0YyQjcwNScA7e3+oQeXHBNhYkNvcmVNZW51U29ydE9yZGVyAgQA7e3+oQfCHAItNScA7e3+oQeXHBBhYkNvcmVNZW51QWN0aW9uAgQA7e3+oQfFHBtAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsnAO3t/qEHlxwUYWJDb3JlTWVudU9uR2VuZXJhdGUCBADt7f6hB+Ec6wFAdGFncy5hYk1lbnUgPSBmYWxzZTsgLy8gS2VlcCBidXR0b24gaGlkZGVuIHVudGlsIGF1dGggY2hlY2sgaXMgY29tcGxldGUuCmF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfSBlbHNlIHsKICAgIHRhZ3MuYWJNZW51ID0gdHJ1ZTsKICAgIHRhZ3Mub25BQkF1dGhCb3RBZGRlZCA9IGBAZGVzdHJveSh0aGlzQm90KTtgOwp9JwDt7f6hB5ccDmFiQ29yZU1lbnVJY29uAgQA7e3+oQfNHgVsb2dpbicA7e3+oQeXHAhyZW1lbWJlcgIEAO3t/qEH0x4o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA7e3+oQeXHAlhYlZlcnNpb24CBADt7f6hB/oeBTEwLjEwJwDt7f6hB5ccC3BlcnNvbmFsaXR5AgQA7e3+oQeAHyjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwDt7f6hB5ccD2FiQ29yZU1lbnVMYWJlbAIEAO3t/qEHpx8Hc2lnbiBpbicA7e3+oQeXHA5hYkNvcmVNZW51SGlkZQIEAO3t/qEHrx8EdHJ1ZScA7e3+oQeXHA5vbkFueUJvdHNBZGRlZAIEAO3t/qEHtB/+AkBpZiAodGhhdC5ib3RzKSB7CiAgICBjb25zdCBhZGRlZEF1dGhCb3QgPSB0aGF0LmJvdHMuZmluZChiID0+IGIgPT09IGdsb2JhbFRoaXMuYXV0aEJvdCk7CgogICAgaWYgKGFkZGVkQXV0aEJvdCkgewogICAgICAgIHRoaXNCb3QudmFycy5hdXRoQm90SWQgPSBhZGRlZEF1dGhCb3QuaWQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXV0aCBib3QgYWRkZWQuIGF1dGhCb3QgaWQ6ICR7dGhpc0JvdC52YXJzLmF1dGhCb3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCQXV0aEJvdEFkZGVkJywgeyBhdXRoQm90OiBhZGRlZEF1dGhCb3QgfSk7CiAgICB9Cn0nAO3t/qEHlxwFZGVidWcCBADt7f6hB7MiBWZhbHNlJwDt7f6hB5ccEG9uQW55Qm90c1JlbW92ZWQCBADt7f6hB7kiowNAaWYgKHRoYXQuYm90SURzICYmIHRoaXNCb3QudmFycy5hdXRoQm90SWQpIHsKICAgIGNvbnN0IHJlbW92ZWRBdXRoQm90SWQgPSB0aGF0LmJvdElEcy5zb21lKGlkID0+IGlkID09PSB0aGlzQm90LnZhcnMuYXV0aEJvdElkKTsKCiAgICBpZiAocmVtb3ZlZEF1dGhCb3RJZCkgewogICAgICAgIHRoaXNCb3QudmFycy5hdXRoQm90SWQgPSBudWxsOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGF1dGggYm90IHJlbW92ZWQuIGF1dGhCb3QgaWQ6ICR7cmVtb3ZlZEF1dGhCb3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCQXV0aEJvdFJlbW92ZWQnLCB7IGF1dGhCb3RJZDogcmVtb3ZlZEF1dGhCb3RJZCB9KTsKICAgIH0KfScBBGJvdHMkYjMzOWMxMTgtNDg5YS00NjZiLWJhOWYtYjA3YTVmOWI2NjRmAScA7e3+oQfdJQZzeXN0ZW0CBADt7f6hB94lD2FiLmFjdGlvbi5wYXN0ZSgA7e3+oQfdJQhhYkFjdGlvbgF4JwDt7f6hB90lBGZvcm0CBADt7f6hB+8lB25vdGhpbmcnAO3t/qEH3SULZGVzY3JpcHRpb24CBADt7f6hB/clK2FiIHNraWxsIHVzZWQgZm9yIGNvcHlpbmcgYW5kIHBhc3RpbmcgYm90cy4nAO3t/qEH3SUHb25QYXN0ZQIEAO3t/qEHoyb/B0BpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IE1BQ1JPUyA9IFsKICAgIHsKICAgICAgICB0ZXN0OiAvKD86W+KAnOKAnV0pL2csCiAgICAgICAgcmVwbGFjZW1lbnQ6ICh2YWwpID0+ICciJywKICAgIH0sCiAgICB7CiAgICAgICAgdGVzdDogLyg/OlvigJjigJldKS9nLAogICAgICAgIHJlcGxhY2VtZW50OiAodmFsKSA9PiAiJyIsCiAgICB9LApdOwoKbGV0IGZvcm1hdHRlZENvcHkgPSByZXBsYWNlTWFjcm9zKHRoYXQudGV4dCk7CmxldCBjb3B5Qm90ID0gSlNPTi5wYXJzZShmb3JtYXR0ZWRDb3B5KTsKbGV0IHBhc3RlZERhdGEgPSAhY29weUJvdC5zdGF0ZSA/IHtbY29weUJvdC5pZF06IGNvcHlCb3R9IDogY29weUJvdC5zdGF0ZTsKbGV0IGRpbU1vZCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJGb2N1c0RhdGE7CgppZiAoT2JqZWN0LmtleXMocGFzdGVkRGF0YSkubGVuZ3RoID09IDEgJiYgZGltTW9kKQp7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb25dID0gdHJ1ZTsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbisiWCJdID0gZGltTW9kLng7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb24rIlkiXSA9IGRpbU1vZC55OwoKICAgIG9zLnRvYXN0KCJib3QgYWRkZWQgdG8gaW5zdCIpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImJvdHMgYWRkZWQgdG8gaW5zdCIpOwp9CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHBhc3RlZCBkYXRhIik7CgpsaW5rcy5jcmVhdGUuYWJDcmVhdGVCb3RzKHtib3RzOiBwYXN0ZWREYXRhLCBzb3VyY2VFdmVudDogJ3Bhc3RlJ30pOwoKZnVuY3Rpb24gcmVwbGFjZU1hY3Jvcyh0ZXh0KSB7CiAgICBpZiAoIXRleHQpIHsKICAgICAgICByZXR1cm4gdGV4dDsKICAgIH0KCiAgICBmb3IgKGxldCBtIG9mIE1BQ1JPUykgewogICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UobS50ZXN0LCBtLnJlcGxhY2VtZW50KTsKICAgIH0KCiAgICByZXR1cm4gdGV4dDsKfScA7e3+oQfdJQhyZW1lbWJlcgIEAO3t/qEHmy4o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA7e3+oQfdJQZjcmVhdGUCBADt7f6hB8IuKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAO3t/qEH3SUIYWJJZ25vcmUCBADt7f6hB+kuBHRydWUnAO3t/qEH3SUJb25LZXlEb3duAgQA7e3+oQfuLroJQGlmICghYnVpbGRlclZlcnNpb24gfHwgKCFsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzICYmICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpKQp7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LmtleXMgPT0gImMiKQp7CiAgICBsZXQgbWV0YUlucHV0ID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiTWV0YSIpOwoKICAgIGlmICghbWV0YUlucHV0KQogICAgewogICAgICAgIG1ldGFJbnB1dCA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIkNvbnRyb2wiKTsKICAgIH0KICAgIAogICAgaWYgKCFtZXRhSW5wdXQpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBmb3JtYXR0ZWRGaWxlOwogICAgbGV0IHN0YXRlID0ge307CgogICAgaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpCiAgICB7CiAgICAgICAgbGV0IHNlbGVjdGVkQm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCiAgICAgICAgc3RhdGVbc2VsZWN0ZWRCb3QuaWRdID0gc2VsZWN0ZWRCb3Q7CgogICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogY29waWVkIGEgYm90IHRvIGNsaXBib2FyZCIpOwogICAgfQogICAgZWxzZSBpZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKQogICAgewogICAgICAgIGxldCBzZWxlY3RlZEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0ZWRCb3RzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgc3RhdGVbc2VsZWN0ZWRCb3RzW2ldLmlkXSA9IHNlbGVjdGVkQm90c1tpXTsKICAgICAgICB9CgogICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogY29waWVkIG11bHRpcGxlIGJvdHMgdG8gY2xpcGJvYXJkIik7CiAgICB9CgogICAgbGV0IG5ld0ZpbGUgPSB7fTsKICAgIG5ld0ZpbGUudmVyc2lvbiA9IDE7CiAgICBuZXdGaWxlLnN0YXRlID0gc3RhdGU7CgogICAgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKfScA7e3+oQfdJQlhYlZlcnNpb24CBADt7f6hB6k4BTEwLjEwJwDt7f6hB90lC3BlcnNvbmFsaXR5AgQA7e3+oQevOCjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwEEYm90cyRiZGFiZDZjMC04OWY5LTRmNzUtYjM1Yy0yNmY0ZWM1MjA3ZDYBJwDt7f6hB9Y4BnN5c3RlbQIEAO3t/qEH1zgQYWIuYWN0aW9uLnJlcG9ydCcA7e3+oQfWOARmb3JtAgQA7e3+oQfoOAdub3RoaW5nJwDt7f6hB9Y4EGFiQ29yZU1lbnVBY3Rpb24CBADt7f6hB/A4EUBvcy5yZXBvcnRJbnN0KCk7JwDt7f6hB9Y4E2FiQ29yZU1lbnVTb3J0T3JkZXICBADt7f6hB4I5AzEwMScA7e3+oQfWOA5hYkNvcmVNZW51SWNvbgIEAO3t/qEHhjkEZmxhZycA7e3+oQfWOA9hYkNvcmVNZW51TGFiZWwCBADt7f6hB4s5BnJlcG9ydCcA7e3+oQfWOAhhYkFjdGlvbgIEAO3t/qEHkjkEdHJ1ZScA7e3+oQfWOAhhYklnbm9yZQIEAO3t/qEHlzkEdHJ1ZScA7e3+oQfWOBRhYkNvcmVNZW51T25HZW5lcmF0ZQIEAO3t/qEHnDlGQGlmIChjb25maWdCb3QudGFncy5zdGF0aWNJbnN0ICE9IHVuZGVmaW5lZCkKewogICAgZGVzdHJveSh0aGlzQm90KTsKfScA7e3+oQfWOAlhYlZlcnNpb24CBADt7f6hB+M5BTEwLjEwJwEEYm90cyRjNjhjNWI4Mi1jMGE3LTRhNWEtOTEwNC01ZGQ4ZTMyYWU0ZTIBJwDt7f6hB+k5BnN5c3RlbQIEAO3t/qEH6jkQYWIuYWN0aW9uLnBvcnRhbCcA7e3+oQfpOQtkZXNjcmlwdGlvbgIEAO3t/qEH+zkUU2tpbGwgdG8gb3BlbiBzaGVldC4nAO3t/qEH6TkIYWJBY3Rpb24CBADt7f6hB5A6BHRydWUnAO3t/qEH6TkEZm9ybQIEAO3t/qEHlToHbm90aGluZycA7e3+oQfpORBhYkNvcmVNZW51QWN0aW9uAgQA7e3+oQedOgNALy8nAO3t/qEH6TkIcmVtZW1iZXICBADt7f6hB6E6KPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAO3t/qEH6TkPYWJDb3JlTWVudUxhYmVsAgQA7e3+oQfIOhBjdXJyZW50IHBvcnRhbDogJwDt7f6hB+k5D2FiQm90TWVudUFjdGlvbgIEAO3t/qEH2Tr4AkBjb25zdCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CmNvbnN0IGN1cnJlbnREaW0gPSBsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90LnRhZ3MubGluZVRvOwpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZiAoc3RhdGUpIAp7CiAgICBvcy5vcGVuVVJMKGNvbmZpZ0JvdC50YWdzLnBlcm1hbGluayArIGAmc2hlZXRQb3J0YWw9JHtjdXJyZW50RGltfWApOwp9CmVsc2UKewogICAgY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgPSBjdXJyZW50RGltOwp9CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBib3Qgc2hlZXQiKTsnAO3t/qEH6TkOYWJCb3RNZW51TGFiZWwCBADt7f6hB9I9Dm9wZW4gYm90IHNoZWV0JwDt7f6hB+k5DW1hbmlmZXN0YXRpb24CBADt7f6hB+E9KPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAO3t/qEH6TkNYWJCb3RNZW51SWNvbgIEAO3t/qEHiD4KdGFibGVfdmlldycA7e3+oQfpOQ5hYkNvcmVNZW51SWNvbgIEAO3t/qEHkz4LYXJyb3dfcmlnaHQnAO3t/qEH6TkSYWJCb3RNZW51U29ydE9yZGVyAgQA7e3+oQefPgExJwDt7f6hB+k5CGFiSWdub3JlAgQA7e3+oQehPgR0cnVlJwDt7f6hB+k5F2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQA7e3+oQemPpsEQGNvbnN0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKY29uc3QgY3VycmVudERpbSA9ICJhYk11bHRpcGxlU2VsZWN0IjsKCmNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY3VycmVudERpbTsKCnNldFRhZ01hc2sobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzLCBjdXJyZW50RGltLCB0cnVlLCAidGVtcExvY2FsIik7CgptYXNrcy5jdXJyZW50U2hlZXRCb3RzID0gbGlua3MucmVtZW1iZXIudGFncy5hYk11bHRpcGxlQm90Rm9jdXM7Cm1hc2tzLm9uUG9ydGFsQ2hhbmdlZCA9IGBAIGlmICh0aGF0LmRpbWVuc2lvbiAhPSAiYWJNdWx0aXBsZVNlbGVjdCIgJiYgdGhhdC5wb3J0YWwgPT0gInNoZWV0UG9ydGFsIikKewogICAgY2xlYXJUYWdNYXNrcyhsaW5rcy5jdXJyZW50U2hlZXRCb3RzKTsKCiAgICBjbGVhclRhZ01hc2tzKHRoaXNCb3QpOwp9IGA7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQiKTsnAO3t/qEH6TkWYWJNdWx0aXBsZUJvdE1lbnVMYWJlbAIEAO3t/qEHwkIab3BlbiBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQnAO3t/qEH6TkVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQA7e3+oQfdQgp0YWJsZV92aWV3JwDt7f6hB+k5E2FiQm90TWVudU9uR2VuZXJhdGUCBADt7f6hB+hCmAJAbGV0IHNlbGVjdGVkQm90ID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC50YWdzLmxpbmVUbzsKCnRhZ3MubGFiZWwgPSAic2hlZXRQb3J0YWw9IiArIHNlbGVjdGVkQm90LnN1YnN0cmluZygwLCA0KTsKCnRhZ3Mub25LZXlEb3duID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gdGFncy5sYWJlbCArICIgaW4gbmV3IHRhYiI7fWA7CnRhZ3Mub25LZXlVcCA9IGBAIGlmKHRoYXQua2V5cyA9PSAiU2hpZnQiKXttYXNrcy5sYWJlbCA9IG51bGw7fWA7JwDt7f6hB+k5GmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQA7e3+oQeBRQEwJwDt7f6hB+k5BG1lbnUCBADt7f6hB4NFKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAO3t/qEH6TkJYWJWZXJzaW9uAgQA7e3+oQeqRQUxMC4xMCcA7e3+oQfpOQthYkJsdWVwcmludAIEAO3t/qEHsEX7A0Bjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSBsaW5rcy5yZW1lbWJlcj8udGFncy5hYkJsdWVwcmludENvbG9yID8/ICIjMTc4NUI1IjsKCmlmIChiYWNrZ3JvdW5kQ29sb3IgPT0gZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDb2xvcikKewogICAgcmV0dXJuOwp9CgpncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yID0gYmFja2dyb3VuZENvbG9yOwoKbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gYEAgaWYgKHRoYXQucG9ydGFsID09ICJncmlkUG9ydGFsIiAmJiB0aGF0LmRpbWVuc2lvbiAhPSAiYmx1ZXByaW50Iil7CiAgICAvLyBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJhc2VDb2xvciA9IG51bGw7CiAgICAvLyBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJhc2VTdHJva2VDb2xvciA9IG51bGw7CgogICAgZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDb2xvciA9IG51bGw7CgogICAgbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gbnVsbDsKfWA7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOycA7e3+oQfpOQtvbkFueUNyZWF0ZQIEAO3t/qEHrEl2QGlmICh0aGF0LmJvdC50YWdzLmJsdWVwcmludCkKewogICAgdGhhdC5ib3QudGFncy5zdHJva2VDb2xvciA9ICIjZmZmZmZmIjsKICAgIHRoYXQuYm90LnRhZ3MubGFiZWxDb2xvciA9ICIjZmZmZmZmIjsKfScA7e3+oQfpOQ9vblBvcnRhbENoYW5nZWQCBADt7f6hB6NKYUBpZiAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIHRoYXQuZGltZW5zaW9uID09ICJibHVlcHJpbnQiKQp7CiAgICB0aGlzQm90LmFiQmx1ZXByaW50KCk7Cn0nAO3t/qEH6TkLcGVyc29uYWxpdHkCBADt7f6hB4VLKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAO3t/qEH6TkSYWJDb3JlTWVudUl0ZW1UeXBlAgQA7e3+oQesSwhkcm9wZG93bicA7e3+oQfpORFkcm9wZG93blNvcnRPcmRlcgIEAO3t/qEHtUsBMScA7e3+oQfpOQ9kcm9wZG93bk9wdGlvbnMCBADt7f6hB7dLBvCfp6xbXScA7e3+oQfpORhhYkNvcmVNZW51T25CZWZvcmVDcmVhdGUCBADt7f6hB7xL4h5AY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IGN1cnJlbnREaW0gPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uOw0KY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCmNvbnN0IHBlcm1hbGlua1VSTCA9IGNvbmZpZ0JvdC50YWdzLnBlcm1hbGluazsNCmNvbnN0IGFjdGl2ZUluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOw0KY29uc3QgYWN0aXZlQmlvcyA9IGNvbmZpZ0JvdC50YWdzLm93bmVyID8gIiZvd25lcj0iICsgY29uZmlnQm90LnRhZ3Mub3duZXIgOiBmYWxzZTsNCmNvbnN0IGZpcnN0SW5kZXggPSBwZXJtYWxpbmtVUkwuaW5kZXhPZigiJiIpOw0KY29uc3QgaW5pdGlhbFVSTCA9IHBlcm1hbGlua1VSTC5zdWJzdHJpbmcoMCwgZmlyc3RJbmRleCk7DQpjb25zdCB1cGRhdGVkVVJMID0gYWN0aXZlQmlvcyAhPSBmYWxzZSA/IGluaXRpYWxVUkwgKyAiJmluc3Q9IiArIGFjdGl2ZUluc3QgOiBpbml0aWFsVVJMOw0KDQpzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkNvcmVNZW51TGFiZWwiLGBtb2RlOiAke2N1cnJlbnRQb3J0YWx9IHBvcnRhbGApOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAiY3VycmVudERpbWVuc2lvbiIsIGN1cnJlbnREaW0pOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAiY3VycmVudFBvcnRhbCIsIGN1cnJlbnRQb3J0YWwpOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAiZHJvcGRvd25Tb3J0T3JkZXIiLCAxKTsNCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiUG9ydGFsTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMub25LZXlEb3duID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gdGFncy5sYWJlbCArICIgaW4gbmV3IHRhYiI7fWA7DQptZW51T3B0aW9ucy5vbktleVVwID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gbnVsbDt9YDsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCm1lbnVPcHRpb25zLnRhcmdldFVSTCA9IHVwZGF0ZWRVUkw7DQoNCmNvbnN0IG1hcE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQoNCm1hcE1lbnVCb3QubGFiZWwgPSAibWFwIHBvcnRhbCI7DQptYXBNZW51Qm90LmZvcm1BZGRyZXNzID0gInB1YmxpYyI7DQptYXBNZW51Qm90Lm9uQ2xpY2sgPSBgQCANCmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsNCg0KaWYoc3RhdGUpDQp7DQogICAgb3Mub3BlblVSTCh0YWdzLnRhcmdldFVSTCArICImbWFwUG9ydGFsPSR7Y3VycmVudERpbSA9PSAiYmx1ZXByaW50IiA/ICJob21lIiA6IGN1cnJlbnREaW19Iik7DQp9DQplbHNlDQp7DQogICAgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gIiR7Y3VycmVudERpbSA9PSAiYmx1ZXByaW50IiA/ICJob21lIiA6IGN1cnJlbnREaW19IjsNCiAgICBjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsID0gbnVsbDsNCn1gOw0KDQppZiAoY3VycmVudFBvcnRhbCAhPSAibWFwIikNCnsNCiAgICAvL21hcCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2gobWFwTWVudUJvdCk7DQp9DQoNCmNvbnN0IGdyaWRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KZ3JpZE1lbnVCb3QubGFiZWwgPSAiZ3JpZCBwb3J0YWwiOw0KZ3JpZE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiY3ViZSI7DQpncmlkTWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZncmlkUG9ydGFsPSR7Y3VycmVudERpbSA9PSAiYmx1ZXByaW50IiA/ICJob21lIiA6IGN1cnJlbnREaW19Iik7DQp9IA0KZWxzZQ0Kew0KICAgIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAiJHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iOyBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSBudWxsOw0KfWA7DQoNCmlmIChjdXJyZW50UG9ydGFsICE9ICJncmlkIiB8fCBjdXJyZW50RGltID09ICJibHVlcHJpbnQiKQ0Kew0KICAgIC8vZ3JpZCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goZ3JpZE1lbnVCb3QpOw0KfQ0KDQpjb25zdCBibHVlcHJpbnRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KDQpibHVlcHJpbnRNZW51Qm90LmxhYmVsID0gImJsdWVwcmludCBwb3J0YWwiOw0KYmx1ZXByaW50TWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhcmNoaXRlY3R1cmUiOw0KYmx1ZXByaW50TWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZncmlkUG9ydGFsPWJsdWVwcmludCIpOw0KfSANCmVsc2UNCnsNCiAgICBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gImJsdWVwcmludCI7IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IG51bGw7DQp9DQoNCmxpbmtzLnNraWxsQm90LmFiQmx1ZXByaW50KCk7YDsNCg0KaWYgKGN1cnJlbnREaW0gIT0gImJsdWVwcmludCIpDQp7DQogICAgLy9ibHVlcHJpbnQgcG9ydGFsIGJ1dHRvbg0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGJsdWVwcmludE1lbnVCb3QpOw0KfQ0KDQoNCmNvbnN0IHNoZWV0TWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCnNoZWV0TWVudUJvdC5sYWJlbCA9ICJzaGVldCBwb3J0YWwiOw0Kc2hlZXRNZW51Qm90LmZvcm1BZGRyZXNzID0gInRhYmxlX3ZpZXciOw0Kc2hlZXRNZW51Qm90Lm9uQ2xpY2sgPSBgQCANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZzaGVldFBvcnRhbD0ke2N1cnJlbnREaW19Iik7DQp9IA0KZWxzZQ0KeyANCiAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9ICIke2N1cnJlbnREaW19IjsNCn1gOw0KDQovL3NoZWV0IHBvcnRhbCBidXR0b24NCmRyb3Bkb3duT3B0aW9ucy5wdXNoKHNoZWV0TWVudUJvdCk7DQoNCg0KY29uc3Qgc3lzdGVtTWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCg0Kc3lzdGVtTWVudUJvdC5sYWJlbCA9ICJzeXN0ZW0gcG9ydGFsIjsNCnN5c3RlbU1lbnVCb3QuZm9ybUFkZHJlc3MgPSAic2V0dGluZ3NfYXBwbGljYXRpb25zIjsNCnN5c3RlbU1lbnVCb3Qub25DbGljayA9IGBADQoNCmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsNCg0KaWYoc3RhdGUpDQp7DQogICAgb3Mub3BlblVSTCh0YWdzLnRhcmdldFVSTCArICImc3lzdGVtUG9ydGFsPXRydWUiKTsNCn0gDQplbHNlDQp7IA0KICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7DQp9YDsNCg0KLy9zeXN0ZW0gcG9ydGFsIGJ1dHRvbg0KZHJvcGRvd25PcHRpb25zLnB1c2goc3lzdGVtTWVudUJvdCk7DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycBBGJvdHMkZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3AScA7e3+oQefagZzeXN0ZW0CBADt7f6hB6BqDWFiLmFjdGlvbi5hc2snAO3t/qEHn2oEZm9ybQIEAO3t/qEHrmoHbm90aGluZycA7e3+oQefagZhc2tHUFQCBADt7f6hB7Zq7wpAaWYgKCF0YWdzLmdwdEFjdGl2ZSB8fCBhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93QUkgPT0gZmFsc2UpIHsKICAgIGNvbnN0IGFpTWVzc2FnZSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWlfcmVqZWN0aW9uX21lc3NhZ2UgPz8gIkFJIG5vdCBhdXRob3JpemVkIGZvciB0aGlzIGFjY291bnQiOwogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6IGFpTWVzc2FnZSB9KTsKICAgIG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7CiAgICBjb25maWdCb3QudGFncy5hYlNjYW4gPSB0cnVlOwogICAgcmV0dXJuOwp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9CgpsZXQgaW5xdWlyeSA9IHRoYXQuaW5xdWlyeSA/PyB0aGF0OwoKY29uc3QgcHJvbXB0ID0gIXRoYXQucHJvbXB0ID8gdGFncy5wcm9tcHRfY29yZSA6IHRhZ3NbInByb21wdF8iICsgdGhhdC5wcm9tcHRdOwoKbGlua3MudXRpbHMuYWJMb2coeyBtZXNzYWdlOiBgdGhpbmtpbmcgYWJvdXQ6ICIke2lucXVpcnl9ImAgfSk7CmxpbmtzLm1hbmlmZXN0YXRpb24uYWJCb3RDaGF0KHsgbWVzc2FnZTogYHRoaW5raW5nIGFib3V0OiAiJHtpbnF1aXJ5fSJgIH0pOwoKaWYgKHRoYXQucHJvbXB0ID09ICJncmlkIikgewogICAgaW5xdWlyeSA9IGlucXVpcnkgKyBgIFBPU0lUSU9OOiB7JHt0aGF0LmRhdGEuZGltZW5zaW9ufTogdHJ1ZSwgJHt0aGF0LmRhdGEuZGltZW5zaW9ufVg6ICR7dGhhdC5kYXRhLmRpbWVuc2lvblh9LCAke3RoYXQuZGF0YS5kaW1lbnNpb259WToke3RoYXQuZGF0YS5kaW1lbnNpb25ZfX0uYAp9CmVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJib3QiKSB7CiAgICBpbnF1aXJ5ID0gaW5xdWlyeSArIGAgVEFSR0VUX0JPVF9JRDogYCArIHRoYXQuZGF0YS5ib3QuaWQ7Cn0KZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gIm11bHRpcGxlQm90IikgewogICAgaW5xdWlyeSA9IGlucXVpcnkgKyBgIFRBUkdFVF9CT1RfSURTOiBgICsgdGhhdC5kYXRhLmJvdHM7Cn0KZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gImNvcmUiKSB7CiAgICAvLyBEbyBub3RoaW5nIGV4dHJhLgp9Cgpjb25zdCBhbnN3ZXIgPSBhd2FpdCB0aGlzQm90LnN1Ym1pdFJlcXVlc3RHUFQoeyBpbnF1aXJ5OiBpbnF1aXJ5LCBwcm9tcHQ6IHByb21wdCwgbW9kZWw6IHRoYXQubW9kZWwgfSk7CgppZiAoYW5zd2VyKSB7CiAgICBsaW5rcy51dGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBbZ2VuZXJhdGVkIGNvZGVdOlxuJHthbnN3ZXJ9YCB9KTsKCiAgICBjcmVhdGUoeyBob21lOiB0cnVlLCBvbkNyZWF0ZTogYEAgJHthbnN3ZXJ9YCB9KTsKCiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKfScA7e3+oQefaglncHRBY3RpdmUCBADt7f6hB6Z1BWZhbHNlJwDt7f6hB59qEHN1Ym1pdFJlcXVlc3RHUFQCBADt7f6hB6x1lQ1AaW1wb3J0IHsgQUlDaGF0T3B0aW9ucyB9IGZyb20gJ2Nhc3VhbG9zJzsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXRgLCB0aGF0KTsKfQoKbGV0IHN5c3RlbVByb21wdCA9IHRoYXQucHJvbXB0ID8gdGhhdC5wcm9tcHQgOiB0YWdzLnByb21wdF9jb3JlOwoKc3lzdGVtUHJvbXB0ID0gc3lzdGVtUHJvbXB0ICsgdGhhdC5pbnF1aXJ5OwoKaWYgKGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dBSSA9PSBmYWxzZSkKewogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6ICJBSSBub3QgYXV0aG9yaXplZCBvbiB0aGlzIGFjY291bnQiLCBsb2dUeXBlOiAnbG9nJyB9KTsKICAgIHJldHVybiBudWxsOwp9CgpsZXQgY3VycmVudEV4cGVyaWVuY2VCb3RzID0gZ2V0Qm90cyhiID0+IGIuc3BhY2UgPT09ICdzaGFyZWQnICYmICFiLnRhZ3MuYWJJZ25vcmUpOwoKaWYgKGN1cnJlbnRFeHBlcmllbmNlQm90cy5sZW5ndGggPiAwKQp7CiAgICBzeXN0ZW1Qcm9tcHQgPSBzeXN0ZW1Qcm9tcHQgKyAiIFRoZXNlIGFyZSB0aGUgYm90cyB0aGF0IGN1cnJlbnRseSBleGlzdCBpbiB0aGUgZXhwZXJpZW5jZTogIiArIGN1cnJlbnRFeHBlcmllbmNlQm90czsKfQoKaWYgKCFsaW5rcy5tZW51KSB7CiAgICBhd2FpdCBsaW5rcy5sZWFybi5hYkFkYXB0KCdhYkludGVyZmFjZScpOwp9Cgpjb25zdCBidXN5SW5kaWNhdG9yID0gYXdhaXQgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yKHsgYWJNZW51OiB0cnVlLCBsYWJlbDogYGFza2luZyAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9YCB9KTsKCmNvbnN0IGFpQ2hhdE9wdGlvbnM6IEFJQ2hhdE9wdGlvbnMgPSB7CiAgICBwcmVmZXJyZWRNb2RlbDogdGhhdC5tb2RlbCA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCwKICAgIHRlbXBlcmF0dXJlOiAwLAogICAgdG9wUDogMSwKICAgIHByZXNlbmNlUGVuYWx0eTogMC42LAogICAgZnJlcXVlbmN5UGVuYWx0eTogMCwKfQoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2VuZGluZyB0byBhaTpgLCB7IHN5c3RlbVByb21wdCwgYWlDaGF0T3B0aW9ucyB9KTsKfQoKbGV0IGFpUmVzcG9uc2U6IHN0cmluZzsKCnRyeSB7CiAgICBhaVJlc3BvbnNlID0gYXdhaXQgYWkuY2hhdChzeXN0ZW1Qcm9tcHQsIGFpQ2hhdE9wdGlvbnMpOwoKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhaSByZXNwb25zZTpgLCBhaVJlc3BvbnNlKTsKICAgIH0KfSBjYXRjaChlKSB7CiAgICBhaVJlc3BvbnNlID0gbnVsbDsKCiAgICAvLyBTaG93IHRvYXN0IHdpdGggZXJyb3IuCiAgICBsaW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KHsgbWVzc2FnZTogYEFJIHJlcXVlc3QgZmFpbGVkIC0gJHtsaW5rcy51dGlscy5nZXRFcnJvck1lc3NhZ2UoZSl9YCwgbG9nVHlwZTogJ2Vycm9yJyB9KTsKCiAgICAvLyBSZXRocm93IHNvIGNhbGxlcnMgY2FuIGNhdGNoLgogICAgdGhyb3cgZTsKfSBmaW5hbGx5IHsKICAgIGRlc3Ryb3koYnVzeUluZGljYXRvcik7Cn0KCnJldHVybiBhaVJlc3BvbnNlOycA7e3+oQefaghyZW1lbWJlcgIEAO3t/qEHwoIBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAO3t/qEHn2oQYWJDb3JlTWVudUFjdGlvbgIEAO3t/qEH6YIBnxtAY29uc3QgaW5xdWlyeSA9IHRoYXQ/Lm1lc3NhZ2UgPz8gdGhhdDsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0Py5pbml0aWFsQm9vdCA/PyBmYWxzZTsKY29uc3QgYXV0b0hhdGNoID0gdGhhdD8uYXV0b0hhdGNoID8/IGZhbHNlOwpjb25zdCBtZW51ID0gdGhhdD8ubWVudSA/PyAiY29yZSI7CmNvbnN0IGlucXVpcnlIYXNTcGFjZSA9IGlucXVpcnkuaW5kZXhPZigiICIpICE9PSAtMTsKY29uc3QgbWVudUJvdHMgPSBnZXRCb3RzKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwsIHRydWUpOwpjb25zdCBpc0NoYW5uZWwgPSB0aGF0LmlzQ2hhbm5lbCA/PyBmYWxzZTsKCndoaXNwZXIobWVudUJvdHMsICJhYk1lbnVSZWZyZXNoIik7CgpsZXQgdXNlcm5hbWUgPSAidXNlciI7CmlmIChhdXRoQm90ICYmIGF1dGhCb3QudGFncy5uYW1lKSB7CiAgICB1c2VybmFtZSA9IGF1dGhCb3QudGFncy5uYW1lOwp9IGVsc2UgaWYgKGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZSkgewogICAgdXNlcm5hbWUgPSBhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWU7Cn0KCmFiLmxvZyh7IG1lc3NhZ2U6IGlucXVpcnksIG5hbWU6IHVzZXJuYW1lIH0pOwoKaWYgKCFjb25maWdCb3QudGFncy50YWdQb3J0YWwgJiYgbGlua3MubWFuaWZlc3RhdGlvbi50YWdzLmFiQXdha2UgJiYgaW5xdWlyeSAhPSAiLmxvZyIpIHsKICAgIHNob3V0KCJzaG93Q29uc29sZSIpOwp9CgppZiAoaXNDaGFubmVsKSB7CiAgICBsaW5rcy5jaGFubmVsTG9hZGVyPy5sb2FkQ2hhbm5lbChpbnF1aXJ5KTsKfQplbHNlIGlmICghaW5xdWlyeUhhc1NwYWNlKSB7CiAgICBjb25zdCBpc0RpcmVjdFNlYXJjaCA9IGlucXVpcnkuc3RhcnRzV2l0aChgImApICYmIGlucXVpcnkuZW5kc1dpdGgoYCJgKTsKCiAgICBjb25zdCBhc2s6IEFCTG9va3VwQXNrSURSZXN1bHQgfCBmYWxzZSA9ICFpc0RpcmVjdFNlYXJjaCA/IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsgYXNrSUQ6IGlucXVpcnksIGF1dG9IYXRjaDogdHJ1ZSwgc291cmNlRXZlbnQ6ICdhc2snIH0pIDogZmFsc2U7CgogICAgaWYgKGFzaz8uc3VjY2VzcyAmJiBhc2s/LmRhdGE/LnVybCAhPSB1bmRlZmluZWQgJiYgIWlzRGlyZWN0U2VhcmNoICYmICFpc0NoYW5uZWwpIHsKICAgICAgICBsaW5rcy5sZWFybi5hYkpvaW5Ib3N0KHsgZGF0YTogYXNrLmRhdGEgfSk7CiAgICB9IGVsc2UgaWYgKCFhc2s/LnN1Y2Nlc3MpIHsKICAgICAgICBsZXQgZWdnOiBBQkxvb2t1cEVnZ1Jlc3VsdDsKICAgICAgICBjb25zdCBwZXJpb2RJbmRleCA9IGlucXVpcnkuaW5kZXhPZigiLiIpOwogICAgICAgIGxldCBhYklEID0gaW5xdWlyeTsKCiAgICAgICAgaWYgKGlzRGlyZWN0U2VhcmNoKSB7CiAgICAgICAgICAgIGFiSUQgPSBpbnF1aXJ5LnN1YnN0cmluZygxLCBpbnF1aXJ5Lmxlbmd0aCAtIDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHBlcmlvZEluZGV4ID09IC0xIHx8IGlzRGlyZWN0U2VhcmNoKSB7CiAgICAgICAgICAgIGVnZyA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7IGFiSUQ6IGFiSUQsIGluaXRpYWxCb290LCBhdXRvSGF0Y2gsIHNvdXJjZUV2ZW50OiAnYXNrJyB9KTsKICAgICAgICB9IGVsc2UgaWYgKHBlcmlvZEluZGV4ID4gMCkgewogICAgICAgICAgICBjb25zdCByZWNvcmRLZXkgPSBpbnF1aXJ5LnN1YnN0cmluZygwLCBwZXJpb2RJbmRleCk7CgogICAgICAgICAgICBhYklEID0gaW5xdWlyeS5zdWJzdHJpbmcocGVyaW9kSW5kZXggKyAxKTsKCiAgICAgICAgICAgIGVnZyA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7IHJlY29yZEtleTogcmVjb3JkS2V5LCBhYklEOiBhYklELCBpbml0aWFsQm9vdCwgYXV0b0hhdGNoLCBzb3VyY2VFdmVudDogJ2FzaycsIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxpbmtzLmlucHV0Lm9uQ2hhdCh7IG1lc3NhZ2U6IGlucXVpcnkgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWVnZz8uc3VjY2VzcyAmJiBsaW5rcy5tZW51KSB7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgogICAgICAgICAgICBjb25zdCBzdHVkaW9CdXR0b24gPSB7fTsKCiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ubGFiZWwgPSBhYklEICsgIiBub3QgZm91bmQgaW4gYWN0aXZlIHN0dWRpbywgZW50ZXIgYWx0ZXJuYXRlIHN0dWRpb0lEIjsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgICAgICAgICBzdHVkaW9CdXR0b24uYWJJRCA9IGFiSUQ7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5mb3JtQWRkcmVzcyA9IHRhZ3MuYWJDb3JlTWVudUljb247CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5vblN1Ym1pdCA9IGBAIGxpbmtzLm1hbmFnZXIuYWJDb3JlTWVudUFjdGlvbih0aGF0LnRleHQgKyAiLiIgKyB0YWdzLmFiSUQpO2A7CgogICAgICAgICAgICBjb25zdCBjcmVhdGVCdXR0b24gPSB7fTsKCiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgICAgICAgICBjcmVhdGVCdXR0b24ubGFiZWwgPSAiZ2l2ZSBtZSBhIHByb3RvdHlwZSI7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYklEID0gYWJJRDsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnByb3RvdHlwZSh0YWdzLmFiSUQpO2A7CgogICAgICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihjcmVhdGVCdXR0b24pOwogICAgICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihzdHVkaW9CdXR0b24pOwoKICAgICAgICAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IjsKICAgICAgICB9CiAgICB9Cn0gZWxzZSB7CiAgICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKICAgIGlmICghYXV0aEJvdCkgewogICAgICAgIG9zLnRvYXN0KCJwbGVhc2Ugc2lnbiBpbiB0byBhY2Nlc3MgYWR2YW5jZWQgQUkgZmVhdHVyZXMiKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICB9IGVsc2UgewogICAgICAgIG1hc2tzLmdwdEFjdGl2ZSA9IHRydWU7CgogICAgICAgIGF3YWl0IHRoaXNCb3QuYXNrR1BUKHsgaW5xdWlyeTogaW5xdWlyeSwgcHJvbXB0OiBtZW51LCBkYXRhOiB0aGF0IH0pOwogICAgfQp9JwDt7f6hB59qFGFiQ29yZU1lbnVPbkdlbmVyYXRlAgQA7e3+oQeJngHyCEB0YWdzLm9uU3VibWl0ID0gYEAKICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJjb3JlIn0pOwogICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyU3VibWl0dGVkQ29yZVRleHQnLCB0cnVlLCAnbG9jYWwnKTsKYDsKdGFncy5vbklucHV0VHlwaW5nID0gYEAKICAgIGlmICghdGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCkgewogICAgICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclR5cGVkQ29yZVRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIH0KYDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfQoKaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCAmJiAhbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclN1Ym1pdHRlZENvcmVUZXh0KSB7CiAgICBhd2FpdCBvcy5zbGVlcChsaW5rcy5iYXNlU2tpbGwudGFncy5pbnB1dFN1Z2dlc3Rpb25XYWl0TVMpOwoKICAgIGlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQpIHsKICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gZnJvbSBidWlsdC1pbiBzdWdnZXN0aW9ucy4KICAgICAgICBsZXQgdGV4dCA9IGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQ29yZVttYXRoLnJhbmRvbUludCgwLCBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0NvcmUubGVuZ3RoIC0gMSldOwoKICAgICAgICBsaW5rcy5iYXNlU2tpbGwuaW5wdXRTdWdnZXN0aW9uKHsgaW5wdXRCb3Q6IHRoaXNCb3QsIHRleHQgfSk7CiAgICB9Cn0nAO3t/qEHn2oTYWJDb3JlTWVudVNvcnRPcmRlcgIEAO3t/qEH/KYBAzEwMicA7e3+oQefahBhYkdyaWRNZW51QWN0aW9uAgQA7e3+oQeApwEOQC8vcGxhY2Vob2xkZXInAO3t/qEHn2oUYWJHcmlkTWVudU9uR2VuZXJhdGUCBADt7f6hB4+nAf8KQHRhZ3MuZGltZW5zaW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cy5kaW1lbnNpb247CnRhZ3MuZGltZW5zaW9uWCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMucG9zaXRpb24ueDsKdGFncy5kaW1lbnNpb25ZID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cy5wb3NpdGlvbi55Owp0YWdzLm9uU3VibWl0ID0gYEAKICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJncmlkIiwgZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgZGltZW5zaW9uWDogdGFncy5kaW1lbnNpb25YLCBkaW1lbnNpb25ZOiB0YWdzLmRpbWVuc2lvbll9KTsKICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclN1Ym1pdHRlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCmlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGZyb20gYnVpbHQtaW4gc3VnZ2VzdGlvbnMuCiAgICAgICAgbGV0IHRleHQgPSBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0NvcmVbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNDb3JlLmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwDt7f6hB59qDW1hbmlmZXN0YXRpb24CBADt7f6hB4+yASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDt7f6hB59qE2FiR3JpZE1lbnVTb3J0T3JkZXICBADt7f6hB7ayAQMxMDInAO3t/qEHn2oPYWJHcmlkTWVudUxhYmVsAgQA7e3+oQe6sgEGYXNrIGFiJwDt7f6hB59qD2FiQ29yZU1lbnVMYWJlbAIEAO3t/qEHwbIBBmFzayBhYicA7e3+oQefag5hYkNvcmVNZW51SWNvbgIEAO3t/qEHyLIBBGN1YmUnAO3t/qEHn2oOYWJHcmlkTWVudUljb24CBADt7f6hB82yAQRjdWJlJwDt7f6hB59qCmVkaXRQcm9tcHQCBADt7f6hB9KyAYcIQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IHByb21wdE1lbnVCdXR0b24gPSB7fTsKCnByb21wdE1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpwcm9tcHRNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CnByb21wdE1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwpwcm9tcHRNZW51QnV0dG9uLmdwdEJvdCA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CnByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAibG9hZCBwcm9tcHQiOwpwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNsb3VkX2Rvd25sb2FkIjsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LnVwZGF0ZVByb21wdCgnbG9hZCcpOyI7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsKCnByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAic2F2ZSBwcm9tcHQiOwpwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImJhY2t1cCI7CnByb21wdE1lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLmdwdEJvdC51cGRhdGVQcm9tcHQoJ3NhdmUnKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwoKdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gbnVsbDsKYDsKCnRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9ICJ0b3AiOwoKY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IHRoaXNCb3QuaWQgKyAiLnByb21wdF9jb3JlIjsKCmlmIChjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UpCnsKICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGw7Cn0nAO3t/qEHn2oEbWVudQIEAO3t/qEH2LoBKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAO3t/qEHn2oMdXBkYXRlUHJvbXB0AgQA7e3+oQf/ugHLCEBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBwcm9tcHRNZW51QnV0dG9uID0ge307Cgpwcm9tcHRNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CnByb21wdE1lbnVCdXR0b24uZm9ybSA9ICJpbnB1dCI7CnByb21wdE1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKcHJvbXB0TWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwpwcm9tcHRNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKcHJvbXB0TWVudUJ1dHRvbi5ncHRCb3QgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwoKaWYgKHRoYXQgPT0gImxvYWQiKQp7CiAgICBwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gImxvYWQgcHJvbXB0IjsKICAgIHByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2xvdWRfZG93bmxvYWQiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5vblN1Ym1pdCA9ICJAIGxpbmtzLmdwdEJvdC5sb2FkUHJvbXB0KHRoYXQudGV4dCk7IjsKfQplbHNlCnsKICAgIHByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAic2F2ZSBwcm9tcHQiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJiYWNrdXAiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5vblN1Ym1pdCA9ICJAIGxpbmtzLmdwdEJvdC5zYXZlUHJvbXB0KHRoYXQudGV4dCk7IjsKfQoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7Cgpwcm9tcHRNZW51QnV0dG9uLmZvcm0gPSBudWxsOwpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gIiAgIjsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwpwcm9tcHRNZW51QnV0dG9uLmNvbG9yID0gIiNmMjQ3MjciOwpwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNhbmNlbCI7CnByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSBudWxsOwpwcm9tcHRNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpOyI7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsnAO3t/qEHn2oKbG9hZFByb21wdAIEAO3t/qEHycMB2gNAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSA9PSBmYWxzZSkKewogICAgb3MudG9hc3QoIm5vdCBhdXRob3JpemVkIik7CgogICAgcmV0dXJuOwp9Cgpjb25zdCBwcm9tcHROYW1lID0gImdwdF9wcm9tcHRfIiArIHRoYXQ7CmNvbnN0IG5ld1Byb21wdCA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgcHJvbXB0TmFtZSk7CgppZiAoIW5ld1Byb21wdC5zdWNjZXNzKQp7CiAgICBvcy50b2FzdCgibm8gcHJvbXB0IGZvdW5kIGJ5IHRoYXQgbmFtZSIpOwp9CmVsc2UKewogICAgdGFncy5wcm9tcHRfY29yZSA9IG5ld1Byb21wdC5kYXRhOwp9CgppZiAoY29uZmlnQm90LnRhZ3MucHJvbXB0X2Jhc2UgPT0gdGhhdCkKewogICAgcmV0dXJuOwp9Cgp0aGlzQm90LmVkaXRQcm9tcHQoKTsnAO3t/qEHn2oKc2F2ZVByb21wdAIEAO3t/qEHpMcBvgRAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSA9PSBmYWxzZSB8fCBhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLnB1Ymxpc2hEYXRhID09IGZhbHNlKQp7CiAgICBvcy50b2FzdCgibm90IGF1dGhvcml6ZWQiKTsKCiAgICByZXR1cm47Cn0KCmNvbnN0IGF1dGhvciA9IGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CmNvbnN0IHByb21wdE5hbWUgPSAiZ3B0X3Byb21wdF8iICsgdGhhdDsKY29uc3QgbmV3UHJvbXB0ID0gYXdhaXQgb3MucmVjb3JkRGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBwcm9tcHROYW1lLCB0YWdzLnByb21wdF9jb3JlLCB7dXBkYXRlUG9saWN5OiBbYXV0aG9yLmlkXX0pOwoKaWYgKCFuZXdQcm9tcHQuc3VjY2VzcykKewogICAgb3MudG9hc3QoInNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluIik7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgicHJvbXB0IHNhdmVkIGFzICIgKyB0aGF0KTsKfQoKdGhpc0JvdC5lZGl0UHJvbXB0KCk7JwDt7f6hB59qCGFiSWdub3JlAgQA7e3+oQfjywEEdHJ1ZScA7e3+oQefaghhYkFjdGlvbgIEAO3t/qEH6MsBBHRydWUnAO3t/qEHn2oGc2VhcmNoAgQA7e3+oQftywEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScA7e3+oQefagVsZWFybgIEAO3t/qEHlMwBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAO3t/qEHn2oKbWF4X3Rva2VucwIEAO3t/qEHu8wBBDUwMDAnAO3t/qEHn2oPb25BQkluaXRpYWxpemVkAgQA7e3+oQfAzAFYQGlmIChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSkKewogICAgdGhpc0JvdC5sb2FkUHJvbXB0KGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlKTsKfScA7e3+oQefagVhc2tBQgIEAO3t/qEHmc0B1ANALy9zaG91dCgiYXNrQUIiLCB7cHJvbXB0OiBwcm9tcHQsIHNob3V0OiBzaG91dCwgY29udGV4dDogY29udGV4dH0pOwoKaWYgKCF0YWdzLmdwdEFjdGl2ZSkgcmV0dXJuOwoKbGV0IGlucXVpcnkgPSB0aGF0LnByb21wdDsKCi8vYWIubG9nKCJ1c2VyOiAiICsgaW5xdWlyeSk7IC8vbm90IG5lZWRlZAoKY29uc3QgYW5zd2VyID0gYXdhaXQgdGhpc0JvdC5zdWJtaXRSZXF1ZXN0R1BUKHtpbnF1aXJ5OiBpbnF1aXJ5LCBjb250ZXh0OiB0aGF0LmNvbnRleHQsIGRlZmluZWRQcm9tcHQ6IHRydWV9KTsKCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIGFuc3dlcik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQm90Q2hhdCh7bWVzc2FnZTogYW5zd2VyfSk7CgppZiAodGhhdC5zaG91dCkKewogICAgc2hvdXQodGhhdC5zaG91dCwgYW5zd2VyKTsKfQoKcmV0dXJuIGFuc3dlcjsnAO3t/qEHn2oFaW5wdXQCBADt7f6hB+7QASjwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwDt7f6hB59qC3Byb21wdF9jb3JlAgQA7e3+oQeV0QHDEkRFTElWRVJBQkxFOiBSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgpPQkpFQ1RJVkU6IFVzaW5nIElOUFVULCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLiAKCkhBUkQgUkVRVUlSRU1FTlRTIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpOgoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYWIubG9nKCIuLi4iKSBzdW1tYXJpemluZyB3aGF0IHRoZSBjb2RlIGRvZXMuCjIuIEFsd2F5cyBlbmQgd2l0aCBkZXN0cm95KHRoaXNCb3QpOyBhcyB0aGUgZmluYWwgc3RhdGVtZW50LgozLiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1Mgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90KC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgo0LiBOZXZlciB1c2UgYW55IG9uQW55KiBsaXN0ZW5lciB0YWdzLiBUaGV5IGFyZSBnZW5lcmFsbHkgY29uc2lkZXJlZCBkYW5nZXJvdXMgYW5kIGNhbiBiZSBwcm9uZSB0byBjcmFzaGluZy4KNS4gSWYgSU5QVVQgaXMgYSBxdWVzdGlvbiB0aGF0IG9ubHkgcmVxdWlyZXMgYSBzaW1wbGUgdGV4dCByZXNwb25zZSwganVzdCBsb2cgdGhlIGFuc3dlciB3aXRoIGFiLmxvZyBhbmQgdGhlbiBkZXN0cm95KHRoaXNCb3QpLgoKUk9MRTogWW91IGFyZSBQTSBCb3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9jYXN1YWwtc2ltdWxhdGlvbi9jYXN1YWxvcyksIGEgd2ViLWJhc2VkIElERSBmb3IgYm90IHNjcmlwdGluZy4KCkRPQ1VNRU5UQVRJT046IFN1cHBvcnRpbmcgZG9jdW1lbnRhdGlvbiBmb3IgQ2FzdWFsT1MgbWF5IGJlIGZvdW5kIGhlcmU6IGh0dHBzOi8vZG9jcy5jYXN1YWxvcy5jb20vCgpFWEFNUExFUzoKCkV4YW1wbGUgMTogIApJbnB1dDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PyAgCkFuc3dlcjoKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAyOiAgCklucHV0OiBNYWtlIGEgcmVkIGJvdCBhdCBzY2FsZSAyIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gY2xpY2tlZC4gIApBbnN3ZXI6CmFiLmxvZygiTWFkZSBhIHJlZCBib3QiKTsgIApjcmVhdGUoe2hvbWU6IHRydWUsIGhvbWVYOiAwLCBob21lWTogMCwgY29sb3I6ICJyZWQiLCBvbkNsaWNrOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCBzY2FsZTogMiwgY3JlYXRvcjogbnVsbH0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKQW5zd2VyOgphYi5sb2coIk1hZGUgYSBjb3B5IGJvdCIpOyAgCmNyZWF0ZSh7aG9tZTogdHJ1ZSwgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtob21lWDogdGFncy5ob21lWCArIDEsIGNyZWF0b3I6IG51bGx9KSJ9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA0OiAgCklucHV0OiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgCkFuc3dlcjoKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsgIApzZXRUYWcoZ2V0Qm90cygiY29sb3IiLCAicmVkIiksICJjb2xvciIsICJibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNTogIApJbnB1dDogTWFrZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvLiAgCkFuc3dlcjoKYWIubG9nKCJNYWRlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8iKTsgIApjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGNvbG9yOiAiYmx1ZSIsICAKICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge29uQ2xpY2s6IG51bGwsIG9uUG9pbnRlckVudGVyOiB0YWdzLm9uUG9pbnRlckVudGVyU2NyaXB0fSkiLCAgCiAgb25Qb2ludGVyRW50ZXJTY3JpcHQ6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsICAKICBjcmVhdG9yOiBudWxsICAKfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCklOUFVUOgonAO3t/qEHn2oLcHJvbXB0X2dyaWQCBADt7f6hB9njAd0VREVMSVZFUkFCTEU6IFJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCk9CSkVDVElWRTogVXNpbmcgSU5QVVQgYW5kIFBPU0lUSU9OIGRhdGEsIGdlbmVyYXRlIEphdmFTY3JpcHQgdGhhdCBydW5zIGluc2lkZSB0aGUgb25DcmVhdGUgZmllbGQgb2YgYSBDYXN1YWxPUyBib3QgYW5kIHBlcmZvcm1zIHRoZSByZXF1ZXN0ZWQgYmVoYXZpb3IuCgpIQVJEIFJFUVVJUkVNRU5UUyAobXVzdCBhbGwgYmUgc2F0aXNmaWVkKToKCjEuIEFsd2F5cyBpbmNsdWRlIGEgc2luZ2xlIGFiLmxvZygiLi4uIikgc3VtbWFyaXppbmcgd2hhdCB0aGUgY29kZSBkb2VzLgoyLiBBbHdheXMgZW5kIHdpdGggZGVzdHJveSh0aGlzQm90KTsgYXMgdGhlIGZpbmFsIHN0YXRlbWVudC4KMy4gVXNlIHN0YW5kYXJkIENhc3VhbE9TIHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdCguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KNC4gTmV2ZXIgdXNlIGFueSBvbkFueSogbGlzdGVuZXIgdGFncy4gVGhleSBhcmUgZ2VuZXJhbGx5IGNvbnNpZGVyZWQgZGFuZ2Vyb3VzIGFuZCBjYW4gYmUgcHJvbmUgdG8gY3Jhc2hpbmcuCjUuIElmIElOUFVUIGlzIGEgcXVlc3Rpb24gdGhhdCBvbmx5IHJlcXVpcmVzIGEgc2ltcGxlIHRleHQgcmVzcG9uc2UsIGp1c3QgbG9nIHRoZSBhbnN3ZXIgd2l0aCBhYi5sb2cgYW5kIHRoZW4gZGVzdHJveSh0aGlzQm90KS4KClBPU0lUSU9OIERBVEE6Ci0gWW91IHdpbGwgcmVjZWl2ZSBjb250ZXh0IHN1Y2ggYXMgYHBvc2l0aW9uID0geyB4OiA8bnVtYmVyPiwgeTogPG51bWJlcj4gfWAuCi0gVXNlIHRoaXMgZGF0YSB0byBkZXRlcm1pbmUgYXBwcm9wcmlhdGUgYGhvbWVYYCwgYGhvbWVZYCwgb3IgcmVsYXRpdmUgcGxhY2VtZW50cyBmb3IgYW55IGNyZWF0ZWQgYm90cy4KClJPTEU6IFlvdSBhcmUgUE0gQm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgpET0NVTUVOVEFUSU9OOiBTdXBwb3J0aW5nIGRvY3VtZW50YXRpb24gZm9yIENhc3VhbE9TIG1heSBiZSBmb3VuZCBoZXJlOiBodHRwczovL2RvY3MuY2FzdWFsb3MuY29tLwoKRVhBTVBMRVM6CgpFeGFtcGxlIDE6ICAKSW5wdXQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8gIApQb3NpdGlvbjogeyB4OiA1LCB5OiA1IH0gIApBbnN3ZXI6ICAKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAyOiAgCklucHV0OiBNYWtlIGEgcmVkIGJvdCBhdCBzY2FsZSAyIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gY2xpY2tlZC4gIApQb3NpdGlvbjogeyB4OiAxLCB5OiAyIH0gIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIGEgcmVkIGJvdCIpOyAgCmNyZWF0ZSh7aG9tZTogdHJ1ZSwgaG9tZVg6IDEsIGhvbWVZOiAyLCBjb2xvcjogInJlZCIsIG9uQ2xpY2s6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsIHNjYWxlOiAyLCBjcmVhdG9yOiBudWxsfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMzogIApJbnB1dDogTWFrZSBhIGJvdCB0aGF0IG1ha2VzIGEgY29weSBvZiBpdHNlbGYgbmV4dCB0byBpdC4gIApQb3NpdGlvbjogeyB4OiAwLCB5OiAwIH0gIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIGEgY29weSBib3QiKTsgIApjcmVhdGUoe2hvbWU6IHRydWUsIGhvbWVYOiAwLCBob21lWTogMCwgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtob21lWDogdGFncy5ob21lWCArIDEsIGNyZWF0b3I6IG51bGx9KSJ9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA0OiAgCklucHV0OiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgClBvc2l0aW9uOiB7IHg6IDEwLCB5OiAtMyB9ICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSByZWQgYm90cyBibHVlIik7ICAKc2V0VGFnKGdldEJvdHMoImNvbG9yIiwgInJlZCIpLCAiY29sb3IiLCAiYmx1ZSIpOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDU6ICAKSW5wdXQ6IE1ha2UgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsby4gIApQb3NpdGlvbjogeyB4OiAzLCB5OiAzIH0gIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8iKTsgIApjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGhvbWVYOiAzLCAgCiAgaG9tZVk6IDMsICAKICBjb2xvcjogImJsdWUiLCAgCiAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtvbkNsaWNrOiBudWxsLCBvblBvaW50ZXJFbnRlcjogdGFncy5vblBvaW50ZXJFbnRlclNjcmlwdH0pIiwgIAogIG9uUG9pbnRlckVudGVyU2NyaXB0OiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCAgCiAgY3JlYXRvcjogbnVsbCAgCn0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpJTlBVVDoKJwDt7f6hB59qCnByb21wdF9ib3QCBADt7f6hB7f5AZIaREVMSVZFUkFCTEU6IFJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCk9CSkVDVElWRTogVXNpbmcgSU5QVVQgYW5kIFRBUkdFVF9CT1RfSUQsIGdlbmVyYXRlIEphdmFTY3JpcHQgdGhhdCBydW5zIGluc2lkZSB0aGUgb25DcmVhdGUgZmllbGQgb2YgYSBDYXN1YWxPUyBib3QgYW5kIHBlcmZvcm1zIHRoZSByZXF1ZXN0ZWQgYmVoYXZpb3IuIAoKSEFSRCBSRVFVSVJFTUVOVFMgKG11c3QgYWxsIGJlIHNhdGlzZmllZCk6CgoxLiBBbHdheXMgaW5jbHVkZSBhIHNpbmdsZSBhYi5sb2coIi4uLiIpIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gQWx3YXlzIGVuZCB3aXRoIGRlc3Ryb3kodGhpc0JvdCk7IGFzIHRoZSBmaW5hbCBzdGF0ZW1lbnQuCjMuIFVzZSB0aGUgYFRBUkdFVF9CT1RfSURgIGFzIGNvbnRleHQgZm9yIGxvY2F0aW9uIG9yIGJlaGF2aW9yIHdoZW4gYXBwcm9wcmlhdGUuIEZvciBleGFtcGxlLCBpZiBhIG5ldyBib3QgaXMgY3JlYXRlZCwgeW91IG1heSBwb3NpdGlvbiBpdCBiYXNlZCBvbiB0aGUgdGFyZ2V0IGJvdCdzIGBob21lWGAgYW5kIGBob21lWWAgdGFncy4KNC4gVXNlIHN0YW5kYXJkIENhc3VhbE9TIHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdCguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KNS4gTmV2ZXIgdXNlIGFueSBvbkFueSogbGlzdGVuZXIgdGFncy4gVGhleSBhcmUgZ2VuZXJhbGx5IGNvbnNpZGVyZWQgZGFuZ2Vyb3VzIGFuZCBjYW4gYmUgcHJvbmUgdG8gY3Jhc2hpbmcuCjYuIElmIElOUFVUIGlzIGEgcXVlc3Rpb24gdGhhdCBvbmx5IHJlcXVpcmVzIGEgc2ltcGxlIHRleHQgcmVzcG9uc2UsIGp1c3QgbG9nIHRoZSBhbnN3ZXIgd2l0aCBhYi5sb2cgYW5kIHRoZW4gZGVzdHJveSh0aGlzQm90KS4KCkJPVCBDT05URVhUOgotIFlvdSB3aWxsIHJlY2VpdmUgYFRBUkdFVF9CT1RfSUQgPSAiPGJvdElkPiJgLgotIFlvdSBtdXN0IHVzZSBgZ2V0Qm90KCJpZCIsICI8Ym90SWQ+IilgIHRvIHJldHJpZXZlIHRoZSBib3QgYW5kIGFjY2VzcyBpdHMgdGFncyAoZS5nLiwgYGdldEJvdCgiaWQiLCBUQVJHRVRfQk9UX0lEKS50YWdzLmhvbWVYYCkuCi0gWW91IGNhbiBwb3NpdGlvbiBuZXcgYm90cyBuZWFyIHRoZSB0YXJnZXQgYm90IGJ5IHVzaW5nIGl0cyBgaG9tZVhgLCBgaG9tZVlgLCBvciBvdGhlciB0YWcgZGF0YS4KClJPTEU6IFlvdSBhcmUgUE0gQm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgpET0NVTUVOVEFUSU9OOiBTdXBwb3J0aW5nIGRvY3VtZW50YXRpb24gZm9yIENhc3VhbE9TIG1heSBiZSBmb3VuZCBoZXJlOiBodHRwczovL2RvY3MuY2FzdWFsb3MuY29tLwoKRVhBTVBMRVM6CgpFeGFtcGxlIDE6ICAKSW5wdXQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8gIApUQVJHRVRfQk9UX0lEOiAic2t5XzEyMyIgIApBbnN3ZXI6ICAKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAyOiAgCklucHV0OiBNYWtlIGEgcmVkIGJvdCBhdCBzY2FsZSAyIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gY2xpY2tlZC4gIApUQVJHRVRfQk9UX0lEOiAiYm90XzAwMSIgIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIGEgcmVkIGJvdCIpOyAgCmxldCB0YXJnZXQgPSBnZXRCb3QoImlkIiwgImJvdF8wMDEiKTsgIApjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGhvbWVYOiB0YXJnZXQudGFncy5ob21lWCwgIAogIGhvbWVZOiB0YXJnZXQudGFncy5ob21lWSwgIAogIGNvbG9yOiAicmVkIiwgIAogIG9uQ2xpY2s6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsICAKICBzY2FsZTogMiwgIAogIGNyZWF0b3I6IG51bGwgIAp9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAzOiAgCklucHV0OiBNYWtlIGEgYm90IHRoYXQgbWFrZXMgYSBjb3B5IG9mIGl0c2VsZiBuZXh0IHRvIGl0LiAgClRBUkdFVF9CT1RfSUQ6ICJib3RfY29waWVyIiAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYSBjb3B5IGJvdCIpOyAgCmxldCB0YXJnZXQgPSBnZXRCb3QoImlkIiwgImJvdF9jb3BpZXIiKTsgIApjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGhvbWVYOiB0YXJnZXQudGFncy5ob21lWCwgIAogIGhvbWVZOiB0YXJnZXQudGFncy5ob21lWSwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7aG9tZVg6IHRhZ3MuaG9tZVggKyAxLCBjcmVhdG9yOiBudWxsfSkiICAKfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNDogIApJbnB1dDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApUQVJHRVRfQk9UX0lEOiAicmVmX2JvdCIgIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsgIApzZXRUYWcoZ2V0Qm90cygiY29sb3IiLCAicmVkIiksICJjb2xvciIsICJibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNTogIApJbnB1dDogTWFrZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvLiAgClRBUkdFVF9CT1RfSUQ6ICJib3RfcGFyZW50IiAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsbyIpOyAgCmxldCB0YXJnZXQgPSBnZXRCb3QoImlkIiwgImJvdF9wYXJlbnQiKTsgIApjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGhvbWVYOiB0YXJnZXQudGFncy5ob21lWCwgIAogIGhvbWVZOiB0YXJnZXQudGFncy5ob21lWSwgIAogIGNvbG9yOiAiYmx1ZSIsICAKICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge29uQ2xpY2s6IG51bGwsIG9uUG9pbnRlckVudGVyOiB0YWdzLm9uUG9pbnRlckVudGVyU2NyaXB0fSkiLCAgCiAgb25Qb2ludGVyRW50ZXJTY3JpcHQ6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsICAKICBjcmVhdG9yOiBudWxsICAKfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCklOUFVUOiAgCicA7e3+oQefag9hYkJvdE1lbnVBY3Rpb24CBADt7f6hB8qTAg5ALy9wbGFjZWhvbGRlcicA7e3+oQefahNhYkJvdE1lbnVPbkdlbmVyYXRlAgQA7e3+oQfZkwKxCUB0YWdzLnRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RGb2N1czsKdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiYm90IiwgYm90OiBsaW5rcy50YXJnZXRCb3R9KTsKICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclN1Ym1pdHRlZEJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKYDsKdGFncy5vbklucHV0VHlwaW5nID0gYEAKICAgIGlmICghdGFncy5oYXNVc2VyVHlwZWRCb3RUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZEJvdFRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRCb3RUZXh0KSB7CiAgICBhd2FpdCBvcy5zbGVlcChsaW5rcy5iYXNlU2tpbGwudGFncy5pbnB1dFN1Z2dlc3Rpb25XYWl0TVMpOwoKICAgIGlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQm90VGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNCb3RbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNCb3QubGVuZ3RoIC0gMSldOwoKICAgICAgICBsaW5rcy5iYXNlU2tpbGwuaW5wdXRTdWdnZXN0aW9uKHsgaW5wdXRCb3Q6IHRoaXNCb3QsIHRleHQgfSk7CiAgICB9Cn0nAO3t/qEHn2oNaXRlcmF0ZVByb21wdAIEAO3t/qEHi50C7AVAY29uc3QgaW5xdWlyeSA9IGBQbGVhc2UgYXVnbWVudCB0aGUgZm9sbG93aW5nIFBST01QVCBieSBtYWtpbmcgaXQgbW9yZSBlYXNpbHkgcmVhZCBieSBHUFQuICBQbGVhc2UgZm9jdXMgb24gdGhlIGZ1bmN0aW9uYWxpdHkgaW5zaWRlIG9mIGl0OgoKMS4gVGhlIHByb21wdCBtdXN0IG1haW50YWluIGFsbCBvZiB0aGUgZnVuY3Rpb25hbGl0eSBvZiB0aGUgb3JpZ2luYWwKCjIuIFRoZSBwcm9tcHQgc2hvdWxkIGtlZXAgaW4gbWluZCB0aGF0IHdlIGFyZSB3b3JraW5nIGluIGEgM0QgZW52aXJvbm1lbnQKCjMuIFRoZSByZXBseSBzaG91bGQgb25seSBiZSB0aGUgbmV3IHByb21wdAoKNC4gVGhlIGZ1bmN0aW9ucyBzaG91bGQgYmUgbGltaXRlZCB0byB0aG9zZSBmb3VuZCBpbiB0aGUgb3JpZ2luYWwgcHJvbXB0CgpQUk9NUFQ6YDsKY29uc3QgcHJvbXB0ID0gdGFnc1sicHJvbXB0XyIgKyB0aGF0XTsKY29uc3QgaXRlcmF0aW9uID0gYXdhaXQgdGhpc0JvdC5zdWJtaXRSZXF1ZXN0R1BUKHtpbnF1aXJ5OiBpbnF1aXJ5LCBwcm9tcHQ6IHByb21wdH0pOwoKYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgaXRlcmF0aW9uKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJCb3RDaGF0KHttZXNzYWdlOiBuZXdBbnN3ZXJ9KTsKCnRhZ3NbInByb21wdF8iICsgdGhhdF0gPSBpdGVyYXRpb247CnRhZ3NbInByb21wdF8iICsgdGhhdCArICJfdmVyc2lvbiJdKys7CgpyZXR1cm47JwDt7f6hB59qEmFiQm90TWVudVNvcnRPcmRlcgIEAO3t/qEH+KICAzEwMicA7e3+oQefahJjb252ZXJzYXRpb25Qcm9tcHQCBADt7f6hB/yiAuAKWW91IGFyZSBhbiBhZ2VudCB0YXNrZWQgd2l0aCBkZXRlcm1pbmluZyBpbnRlbnRpb24gYmFzZWQgb24gYSBzdGF0ZW1lbnQgYSB1c2VyIGdpdmVzIHlvdS4KClBsZWFzZSBsb29rIGF0IHRoZSBmb2xsb3dpbmcgc3RhdGVtZW50IGFuZCBkZXRlcm1pbmUgaWYgaXQgaXMgYSBDb252ZXJzYXRpb24gUmVxdWVzdCBvciBCdWlsZCBSZXF1ZXN0LgoKQnVpbGQgUmVxdWVzdHM6ICBTcGVjaWZpYyByZXF1ZXN0IGZvciB0aGUgc3lzdGVtIHRvIGJ1aWxkLCBtYWtlIG9yIHByb3ZpZGUgY29kZSBmb3Igc29tZXRoaW5nIHNwZWNpZmljLgpUaGVzZSByZXF1ZXN0cyB3aWxsIGdlbmVyYWxseSBiZSBpbiB0aGUgZm9ybSBvZiBjb21tYW5kcyBvciByZXF1ZXN0cyBmcm9tIHRoZSBzeXN0ZW0uCkV4YW1wbGUgQnVpbGQgUmVxdWVzdHM6IApNYWtlIGEgeWVsbG93IGJhbGwuIApQbGVhc2UgY3JlYXRlIGEgYmlnIHB1cnBsZSBjdWJlLiAgCldyaXRlIHRoZSBjb2RlIGZvciBhIGJvdCB0aGF0IGNoYW5nZXMgY29sb3JzIHdoZW4gY2xpY2tlZC4KCkNvbnZlcnNhdGlvbiBSZXF1ZXN0czogIEFueSByZXF1ZXN0IHRoYXQgaXMgbm90IGEgQnVpbGQgUmVxdWVzdCB3aWxsIGRlZmF1bHQgdG8gYmVpbmcgYSBDb252ZXJzYXRpb24uCkV2ZW4gaWYgdGhlIHJlcXVlc3RzIGRpc2N1c3NlcyBtYWtpbmcgYnVpbGRpbmcgb3IgY29kaW5nIHRoaW5ncyBpdCBpcyBzdGlsbCBDb252ZXJzYXRpb24gaWYgaXQgaXMgbm90IHdvcmRlZCBhcyBhIGRpcmVjdCByZXF1ZXN0LgpFeGFtcGxlIENvbnZlcnNhdGlvbiBSZXF1ZXN0czoKQ291bGQgSSBidWlsZCBhIGJvdCB0aGF0IGdldHMgYmlnZ2VyIHdoZW4gY2xpY2tlZD8KSXMgaXQgcG9zc2libGUgdG8gY29kZSBib3RzIHRoYXQgbW92ZT8KQ2FuIG15IHNvbiBtYWtlIGEgeWVsbG93IGJhbGwgaW4gQ2FzdWFsT1M/CgpEZXRlcm1pbmluZyBJbnRlbnQ6ICBJZiBjb25kaXRpb25zIGZvciBCdWlsZCBSZXF1ZXN0IGFyZSBzcGVjaWZpY2FsbHkgbWV0IHRoZW4gaXQncyBhIEJ1aWxkIFJlcXVlc3QuIEV2ZXJ5dGhpbmcgZWxzZSBpcyBDb252ZXJzYXRpb24uCgpEZXRlcm1pbmUgdGhlIGludGVudGlvbiBvZiB0aGUgc3RhdGVtZW50IGFuZCByZXR1cm4gdHJ1ZSBpZiBpdCdzIGEgQnVpbGQgUmVxdWVzdC4KClJVTEVTOgoxLiBSZXR1cm4gb25seSB0aGUgd29yZCB0cnVlIGlmIHlvdSd2ZSBkZXRlcm1pbmVkIGl0J3MgYSBCdWlsZCBSZXF1ZXN0LgoyLiBSZXR1cm4gb25seSBmYWxzZSBpZiB0aGUgc3RhdGVtZW50IGlzIGEgQ29udmVyc2F0aW9uIFJlcXVlc3QuCjMuIEFuc3dlcmluZyB3aXRoIGFueXRoaW5nIG90aGVyIHRoYW4gdHJ1ZSBvciBmYWxzZSB3aWxsIGJyZWFrIHRoZSBleHBlcmllbmNlLgoKU1RBVEVNRU5UOgonAO3t/qEHn2oXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBADt7f6hB92tAg5ALy9wbGFjZWhvbGRlcicA7e3+oQefahthYk11bHRpcGxlQm90TWVudU9uR2VuZXJhdGUCBADt7f6hB+ytAqALQGNvbnN0IGFsbFRhcmdldEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CmNvbnN0IHRhcmdldEFycmF5ID0gW107Cgpmb3IgKGxldCBpID0gMDsgaSA8IGFsbFRhcmdldEJvdHMubGVuZ3RoOyBpKyspCnsKICAgIHRhcmdldEFycmF5LnB1c2goYWxsVGFyZ2V0Qm90c1tpXS5pZCk7Cn0KCnRhZ3MudGFyZ2V0Qm90cyA9IHRhcmdldEFycmF5Owp0YWdzLm9uU3VibWl0ID0gYEAKICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJtdWx0aXBsZUJvdCIsIGJvdHM6IHRhZ3MudGFyZ2V0Qm90c30pOwogICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyU3VibWl0dGVkTXVsdGlwbGVCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkTXVsdGlwbGVCb3RUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIH0KYDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfQoKaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRNdWx0aXBsZUJvdFRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQpIHsKICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gZnJvbSBidWlsdC1pbiBzdWdnZXN0aW9ucy4KICAgICAgICBsZXQgdGV4dCA9IGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zTXVsdGlwbGVCb3RzW21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zTXVsdGlwbGVCb3RzLmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwDt7f6hB59qEnByb21wdF9tdWx0aXBsZUJvdAIEAO3t/qEHjbkChhlERUxJVkVSQUJMRTogUmV0dXJuIG9ubHkgSmF2YVNjcmlwdCBjb2RlLiBEbyBub3QgaW5jbHVkZSBxdW90ZXMsIE1hcmtkb3duIGZvcm1hdHRpbmcsIG9yIGFueSBleHBsYW5hdG9yeSB0ZXh0LiBUaGUgY29kZSBzaG91bGQgYmUgdmFsaWQgYW5kIGV4ZWN1dGFibGUgaW5zaWRlIHRoZSBgb25DcmVhdGVgIGZpZWxkIG9mIGEgYm90IGluIENhc3VhbE9TLgoKT0JKRUNUSVZFOiBVc2luZyBJTlBVVCBhbmQgVEFSR0VUX0JPVF9JRFMsICBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLgoKSEFSRCBSRVFVSVJFTUVOVFMgKG11c3QgYWxsIGJlIHNhdGlzZmllZCk6CgoxLiBBbHdheXMgaW5jbHVkZSBhIHNpbmdsZSBhYi5sb2coIi4uLiIpIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gQWx3YXlzIGVuZCB3aXRoIGRlc3Ryb3kodGhpc0JvdCk7IGFzIHRoZSBmaW5hbCBzdGF0ZW1lbnQuCjMuIFVzZSB0aGUgYXJyYXkgb2YgYFRBUkdFVF9CT1RfSURTYCBhcyBjb250ZXh0IGZvciBsb2NhdGlvbiBvciBiZWhhdmlvciB3aGVuIGFwcHJvcHJpYXRlLiBGb3IgZXhhbXBsZToKICAgLSBXaGVuIGNyZWF0aW5nIGJvdHMsIHVzZSBlYWNoIHRhcmdldCdzIGBob21lWGAgYW5kIGBob21lWWAgZm9yIHBsYWNlbWVudC4KICAgLSBXaGVuIG1vZGlmeWluZyBib3RzLCBpdGVyYXRlIG92ZXIgZWFjaCB0YXJnZXQgdXNpbmcgYGdldEJvdCgiaWQiLCA8aWQ+KWAuCjQuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCjUuIE5ldmVyIHVzZSBhbnkgb25BbnkqIGxpc3RlbmVyIHRhZ3MuIFRoZXkgYXJlIGdlbmVyYWxseSBjb25zaWRlcmVkIGRhbmdlcm91cyBhbmQgY2FuIGJlIHByb25lIHRvIGNyYXNoaW5nLgo2LiBJZiBJTlBVVCBpcyBhIHF1ZXN0aW9uIHRoYXQgb25seSByZXF1aXJlcyBhIHNpbXBsZSB0ZXh0IHJlc3BvbnNlLCBqdXN0IGxvZyB0aGUgYW5zd2VyIHdpdGggYWIubG9nIGFuZCB0aGVuIGRlc3Ryb3kodGhpc0JvdCkuCgpCT1QgQ09OVEVYVDoKLSBZb3Ugd2lsbCByZWNlaXZlIGBUQVJHRVRfQk9UX0lEUyA9IFsiYm90XzEiLCAiYm90XzIiLCAuLi5dYC4KLSBVc2UgYGdldEJvdCgiaWQiLCA8aWQ+KWAgdG8gYWNjZXNzIGluZGl2aWR1YWwgYm90cyBhbmQgdGhlaXIgdGFncy4KLSBQZXJmb3JtIG1vZGlmaWNhdGlvbnMgb3IgbG9naWMgZm9yIGVhY2ggYm90IGluIHRoZSBhcnJheS4KClJPTEU6IFlvdSBhcmUgUE0gQm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgpET0NVTUVOVEFUSU9OOiBTdXBwb3J0aW5nIGRvY3VtZW50YXRpb24gZm9yIENhc3VhbE9TIG1heSBiZSBmb3VuZCBoZXJlOiBodHRwczovL2RvY3MuY2FzdWFsb3MuY29tLwoKRVhBTVBMRVM6CgpFeGFtcGxlIDE6ICAKSW5wdXQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8gIApUQVJHRVRfQk9UX0lEUzogWyJza3lfMTIzIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAyOiAgCklucHV0OiBNYWtlIGEgcmVkIGJvdCBuZXh0IHRvIGVhY2ggb2YgdGhlc2UgYm90cy4gIApUQVJHRVRfQk9UX0lEUzogWyJhIiwgImIiLCAiYyJdICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSByZWQgYm90cyBuZXh0IHRvIGVhY2ggdGFyZ2V0Iik7ICAKZm9yIChsZXQgaWQgb2YgWyJhIiwgImIiLCAiYyJdKSB7ICAKICBsZXQgYm90ID0gZ2V0Qm90KCJpZCIsIGlkKTsgIAogIGNyZWF0ZSh7ICAKICAgIGhvbWU6IHRydWUsICAKICAgIGhvbWVYOiBib3QudGFncy5ob21lWCArIDEsICAKICAgIGhvbWVZOiBib3QudGFncy5ob21lWSwgIAogICAgY29sb3I6ICJyZWQiLCAgCiAgICBjcmVhdG9yOiBudWxsICAKICB9KTsgIAp9ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMzogIApJbnB1dDogVG9hc3QgaGVsbG8gd2hlbiBhbnkgb2YgdGhlc2UgYm90cyBhcmUgY2xpY2tlZC4gIApUQVJHRVRfQk9UX0lEUzogWyJ0YXJnZXQxIiwgInRhcmdldDIiXSAgCkFuc3dlcjogIAphYi5sb2coIlNldCB1cCB0b2FzdC1vbi1jbGljayBiZWhhdmlvciIpOyAgCmZvciAobGV0IGlkIG9mIFsidGFyZ2V0MSIsICJ0YXJnZXQyIl0pIHsgIAogIGxldCBib3QgPSBnZXRCb3QoImlkIiwgaWQpOyAgCiAgc2V0VGFnKGJvdCwgIm9uQ2xpY2siLCAiQCBvcy50b2FzdCgnaGVsbG8nKTsiKTsgIAp9ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNDogIApJbnB1dDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApUQVJHRVRfQk9UX0lEUzogWyJzb21lX2lkIiwgImRvZXNudF9tYXR0ZXIiXSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOyAgCnNldFRhZyhnZXRCb3RzKCJjb2xvciIsICJyZWQiKSwgImNvbG9yIiwgImJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA1OiAgCklucHV0OiBNYWtlIGEgYmx1ZSBib3QgYWJvdmUgZWFjaCBvZiB0aGUgZ2l2ZW4gYm90cyB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGhvdmVyZWQuICAKVEFSR0VUX0JPVF9JRFM6IFsiYjEiLCAiYjIiLCAiYjMiXSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYmx1ZSBib3RzIGFib3ZlIGVhY2ggdGFyZ2V0IHRoYXQgdG9hc3Qgb24gcG9pbnRlciBlbnRlciIpOyAgCmZvciAobGV0IGlkIG9mIFsiYjEiLCAiYjIiLCAiYjMiXSkgeyAgCiAgbGV0IGJvdCA9IGdldEJvdCgiaWQiLCBpZCk7ICAKICBjcmVhdGUoeyAgCiAgICBob21lOiB0cnVlLCAgCiAgICBob21lWDogYm90LnRhZ3MuaG9tZVgsICAKICAgIGhvbWVZOiBib3QudGFncy5ob21lWSArIDEsICAKICAgIGNvbG9yOiAiYmx1ZSIsICAKICAgIG9uUG9pbnRlckVudGVyOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCAgCiAgICBjcmVhdG9yOiBudWxsICAKICB9KTsgIAp9ICAKZGVzdHJveSh0aGlzQm90KTsKCklOUFVUOiAgCicA7e3+oQefahphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAO3t/qEHlNICAzEwMScA7e3+oQefaglhYlZlcnNpb24CBADt7f6hB5jSAgUxMC4xMCcA7e3+oQefag5jaGFubmVsX2NvbmZpZwIEAO3t/qEHntICrQ9AY29uc3QgY29uZmlndXJhdGlvbkRhdGEgPSBhd2FpdCBvcy5nZXREYXRhKHRoYXQuZGF0YS5zdHVkaW9JRCwgdGhhdC5kYXRhLnBhdHRlcm5JRCk7CgpsZXQgbmV3RGVwbG95bWVudCA9IGZhbHNlOwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuY2hhbm5lbENvbmZpZ3VyZWQpCnsKICAgIHJldHVybjsKfQoKbGlua3MucmVtZW1iZXIudGFncy5jaGFubmVsQ29uZmlndXJlZCA9IHRydWU7CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zKQp7CiAgICBjb25zdCB0YXJnZXRCaW9zID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zOwoKICAgIHN3aXRjaCAodGFyZ2V0QmlvcykgCiAgICB7CiAgICAgICAgY2FzZSAibG9jYWwiOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Muc3RhdGljSW5zdCA9PSBudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic3R1ZGlvIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLm93bmVyID09IG51bGwgfHwgY29uZmlnQm90LnRhZ3Mub3duZXIgPT0gInB1YmxpYyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzaGFyZWQiOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Mub3duZXIgIT0gInB1YmxpYyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgIH0KfQoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZWdnKQp7CiAgICBjb25zdCB0YXJnZXRQYXR0ZXJuID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5lZ2cucGF0dGVybjsKICAgIGNvbnN0IHRhcmdldFN0dWRpbyA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZWdnLnN0dWRpbzsKCiAgICBzaG91dCgiaGF0Y2giLCB7YWJJRDogdGFyZ2V0UGF0dGVybiwgcmVjb3JkS2V5OiB0YXJnZXRTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZX0pOwp9CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5ncmlkQ29sb3IpCnsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5ncmlkQ29sb3I7CgogICAgZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENvbG9yID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5ncmlkQ29sb3I7Cn0KCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgJiYgY29uZmlnQm90LnRhZ3MuaW5zdCAhPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgJiYgY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICE9IG51bGwpCnsKICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwp9CgppZiAobmV3RGVwbG95bWVudCkKewogICAgY29uc3Qgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CiAgICBjb25zdCB0YXJnZXRJbnN0ID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ID8gIiZpbnN0PSIgKyBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgOiAiIjsKICAgIGNvbnN0IHRhcmdldEJpb3MgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3MgPyAiJmJpb3M9IiArIGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvcyA6ICIiOwogICAgY29uc3QgdGFyZ2V0UGF0dGVybiA9IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gPyAiJnBhdHRlcm49IiArIGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gOiAiIjsKICAgIGNvbnN0IHRhcmdldFVSTCA9IHNpdGVPcmlnaW4gKyBgLz9hc2s9JHtjb25maWdCb3QudGFncy5hc2t9JHt0YXJnZXRQYXR0ZXJufSR7dGFyZ2V0SW5zdH0ke3RhcmdldEJpb3N9YDsKCiAgICBvcy5nb1RvVVJMKHRhcmdldFVSTCk7Cn0nAO3t/qEHn2oNY2hhbm5lbExvYWRlcgIEAO3t/qEHzOECKPCflJdhOWI2YWEwZC1iMzU3LTRkZTYtOWJlZi04NTM0OGFiMWQwZTAnAO3t/qEHn2oJcHJvdG90eXBlAgQA7e3+oQfz4QIuQHRoaXNCb3QuYWJDb3JlTWVudUFjdGlvbigiTWFrZSBtZTogIiArIHRoYXQpOycA7e3+oQefagtwZXJzb25hbGl0eQIEAO3t/qEHouICKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAO3t/qEHn2oFdXRpbHMCBADt7f6hB8niAijwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwDt7f6hB59qBmNyZWF0ZQIEAO3t/qEH8OICKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAO3t/qEHn2oFZGVidWcCBADt7f6hB5fjAgVmYWxzZScA7e3+oQefag9pbnB1dFN1Z2dlc3Rpb24CBADt7f6hB53jAvgDQGNvbnN0IGlucHV0Qm90ID0gdGhhdD8uaW5wdXRCb3Q7CmNvbnN0IHRleHQgPSB0aGF0Py50ZXh0Owpjb25zdCBhbmltYXRlID0gdGhhdD8uYW5pbWF0ZSA/PyB0cnVlOwoKYXNzZXJ0KGlucHV0Qm90LCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlucHV0Qm90IGlzIGEgcmVxdWlyZWQgcGFyYW1lbXRlci5gKTsKYXNzZXJ0KHRleHQsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGV4dCBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKCmlmIChhbmltYXRlKSB7CiAgICBjb25zdCBjaGFycyA9IFsuLi50ZXh0XTsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGF3YWl0IG9zLnNsZWVwKG1hdGgucmFuZG9tKDI1LCAxMDApKTsKICAgICAgICBpbnB1dEJvdC50YWdzLm1lbnVJdGVtVGV4dCA9IGNoYXJzLnNsaWNlKDAsIGkpLmpvaW4oJycpOwogICAgfQp9CgppbnB1dEJvdC50YWdzLm1lbnVJdGVtVGV4dCA9IHRleHQ7JwDt7f6hB59qFWlucHV0U3VnZ2VzdGlvbldhaXRNUwIEAO3t/qEHlucCBDMwMDAnAO3t/qEHn2oPc3VnZ2VzdGlvbnNDb3JlAgQA7e3+oQeb5wLrAfCfp6xbCiAgICAibWFrZSBtZSBhIHJlZCBib3QgdGhhdCB3aGVuIGNsaWNrZWQgdHVybnMgYmx1ZSIsCiAgICAibWFrZSBtZSBhIGJvdCB0aGF0IHdoZW4gY2xpY2tlZCBtYWtlcyBmaXJld29ya3MiLAogICAgIm1ha2UgbWUgYSBib3QgdGhhdCB0b2FzdHMgJ2hlbGxvLCB3b3JsZCEnIHdoZW4gY2xpY2tlZCIsCiAgICAibWFrZSBtZSAzIGJvdHMsIGEgcmVkIG9uZSwgYmx1ZSBvbmUsIGFuZCBncmVlbiBvbmUiCl0nAO3t/qEHn2oOc3VnZ2VzdGlvbnNCb3QCBADt7f6hB4XpAnvwn6esWwogICAgImNoYW5nZSB0aGUgY29sb3Igb2YgdGhpcyBib3QgdG8gcHVycGxlIiwKICAgICJ0dXJuIHRoaXMgYm90IGludG8gYSBzcGhlcmUiLAogICAgImRvdWJsZSB0aGUgc2NhbGUgb2YgdGhpcyBib3QiCl0nAO3t/qEHn2oXc3VnZ2VzdGlvbnNNdWx0aXBsZUJvdHMCBADt7f6hB//pAo4B8J+nrFsKICAgICJjaGFuZ2UgYWxsIG9mIHRoZXNlIGJvdHMgY29sb3IgdG8gcHVycGxlIiwKICAgICJ0dXJuIGFsbCBvZiB0aGVzZSBib3RzIGludG8gc3BoZXJlcyIsCiAgICAiZG91YmxlIHRoZSBzY2FsZSBvZiBhbGwgb2YgdGhlc2UgYm90cyIKXScBBGJvdHMkZjlmZDdlMmUtN2NjZS00M2ZiLWIyMjMtZDMyY2I0MmJlYmU4AScA7e3+oQeM6wIGc3lzdGVtAgQA7e3+oQeN6wITYWIuYWN0aW9uLmNvbG9yX2JvdCcA7e3+oQeM6wIEZm9ybQIEAO3t/qEHoesCB25vdGhpbmcnAO3t/qEHjOsCCGFiQWN0aW9uAgQA7e3+oQep6wIEdHJ1ZScA7e3+oQeM6wIPYWJCb3RNZW51QWN0aW9uAgQA7e3+oQeu6wKOAUBjb25zdCB0YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzOwoKb3Muc2hvd0lucHV0Rm9yVGFnKHRhcmdldEJvdCwgImNvbG9yIiwgewogICAgdHlwZTogJ2NvbG9yJywKICAgIHRpdGxlOiAncGljayBhIGNvbG9yJwp9KTsnAO3t/qEHjOsCDmFiQm90TWVudUxhYmVsAgQA7e3+oQe97AIFY29sb3InAO3t/qEHjOsCDWFiQm90TWVudUljb24CBADt7f6hB8PsAgdwYWxldHRlJwDt7f6hB4zrAghyZW1lbWJlcgIEAO3t/qEHy+wCKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAO3t/qEHjOsCEmFiQm90TWVudVNvcnRPcmRlcgIEAO3t/qEH8uwCATInAO3t/qEHjOsCCGFiSWdub3JlAgQA7e3+oQf07AIEdHJ1ZScA7e3+oQeM6wIXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBADt7f6hB/nsAuIDQGNvbnN0IGFsbFRhcmdldEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CmNvbnN0IGJ1aWxkZXIgPSBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90ID8gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC5pZCA6IG51bGw7CmNvbnN0IHJlbGV2YW50VGFyZ2V0Qm90cyA9IGFsbFRhcmdldEJvdHMuZmlsdGVyKCh0YXJnZXQpID0+IHRhcmdldC5pZCAhPSBidWlsZGVyKTsKY29uc3Qgc2VsZWN0ZWRDb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChudWxsLCB7CiAgICB0eXBlOiAnY29sb3InLAogICAgdGl0bGU6ICdwaWNrIGEgY29sb3InCn0pOwoKc2V0VGFnKHJlbGV2YW50VGFyZ2V0Qm90cywgImNvbG9yIiwgc2VsZWN0ZWRDb2xvcik7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQiKTsnAO3t/qEHjOsCFWFiTXVsdGlwbGVCb3RNZW51SWNvbgIEAO3t/qEH3PACB3BhbGV0dGUnAO3t/qEHjOsCFmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBADt7f6hB+TwAgVjb2xvcicA7e3+oQeM6wIaYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBADt7f6hB+rwAgExJwDt7f6hB4zrAglhYlZlcnNpb24CBADt7f6hB+zwAgUxMC4xMCcA7e3+oQeM6wILcGVyc29uYWxpdHkCBADt7f6hB/LwAijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiAA=="}]}