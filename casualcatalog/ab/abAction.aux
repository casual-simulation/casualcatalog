{"version":2,"updates":[{"id":0,"timestamp":1761683462271,"update":"AeYCv+uX/wgAJwEEYm90cyQ1ODQ5YWY1NS01ZThhLTQ4ZDYtOTEwNi0xOTk0OThlOWVjMDgBJwC/65f/CAAGc3lzdGVtAgQAv+uX/wgBEWFiLmFjdGlvbi5kZXN0cm95JwC/65f/CAAIYWJBY3Rpb24CBAC/65f/CBMEdHJ1ZScAv+uX/wgABGZvcm0CBAC/65f/CBgHbm90aGluZycAv+uX/wgAD2FiQm90TWVudUFjdGlvbgIEAL/rl/8IIMACQGNvbnN0IHRhcmdldEJvdCA9IHRoYXQuYm90LmxpbmtzLnRhcmdldEJvdDsKCmlmICh0aGF0LmJvdC5saW5rcy50YXJnZXRPcmlnaW5Cb3RzKSB7CiAgICAvLyBEZXN0cm95IGJvdHMgYmVsb25naW5nIHRvIGFiSURPcmlnaW4uCiAgICBkZXN0cm95KHRoYXQuYm90LmxpbmtzLnRhcmdldE9yaWdpbkJvdHMpOwp9IGVsc2UgewogICAgLy8gRGVzdHJveSB0aGUgc2luZ2xlIHRhcmdldCBib3QuCiAgICBkZXN0cm95KHRhcmdldEJvdCk7Cn0KCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsnAL/rl/8IAA5hYkJvdE1lbnVMYWJlbAIEAL/rl/8I4QIHZGVzdHJveScAv+uX/wgADWFiQm90TWVudUljb24CBAC/65f/COkCDmRlbGV0ZV9mb3JldmVyJwC/65f/CAASYWJCb3RNZW51U29ydE9yZGVyAgQAv+uX/wj4AgMxMDAnAL/rl/8IAAhyZW1lbWJlcgIEAL/rl/8I/AIo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAv+uX/wgADW1hbmlmZXN0YXRpb24CBAC/65f/CKMDKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAL/rl/8IAAhhYklnbm9yZQIEAL/rl/8IygMEdHJ1ZScAv+uX/wgADmFiQm90TWVudUNvbG9yAgQAv+uX/wjPAwcjRDkzMDMwJwC/65f/CAAXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBAC/65f/CNcDwANAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgpkZXN0cm95KHJlbGV2YW50VGFyZ2V0Qm90cyk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7JwC/65f/CAAVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAv+uX/wiYBw5kZWxldGVfZm9yZXZlcicAv+uX/wgAFmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBAC/65f/CKcHB2Rlc3Ryb3knAL/rl/8IABphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAL/rl/8IrwcDMTAwJwC/65f/CAAWYWJNdWx0aXBsZUJvdE1lbnVDb2xvcgIEAL/rl/8IswcHI0Q5MzAzMCcAv+uX/wgACWFiVmVyc2lvbgIEAL/rl/8IuwcFMTAuMjknAL/rl/8IABNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAv+uX/wjBB60HQGNvbnN0IHRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgppZiAodGFyZ2V0Qm90KSB7CiAgICB0YWdzLmxhYmVsID0gJ2Rlc3Ryb3knOwogICAgdGFncy50YXJnZXRCb3QgPSBnZXRMaW5rKHRhcmdldEJvdCk7CiAgICB0YWdzLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygiU2hpZnQiKSkgewogICAgICAgICAgICBpZiAobGlua3MudGFyZ2V0Qm90ICYmIGxpbmtzLnRhcmdldEJvdC50YWdzLmFiSURPcmlnaW4pIHsKICAgICAgICAgICAgICAgIC8vIENoYW5nZSBidXR0b24gdG8gZGVzdHJveSBhbGwgYm90cyB3aXRoIHNhbWUgYWJJRE9yaWdpbi4KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE9yaWdpbkJvdHMgPSBnZXRCb3RzKGIgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnRhZ3MuYWJJRE9yaWdpbiA9PT0gbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbjsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbWFza3MubGFiZWwgPSAnZGVzdHJveSAnICsgbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbiArICcgKCcgKyB0YXJnZXRPcmlnaW5Cb3RzLmxlbmd0aCArICcgYm90cyknOwogICAgICAgICAgICAgICAgdGFncy50YXJnZXRPcmlnaW5Cb3RzID0gZ2V0TGluayh0YXJnZXRPcmlnaW5Cb3RzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGA7CiAgICB0YWdzLm9uS2V5VXAgPSBgQAogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoIlNoaWZ0IikpIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSBudWxsOwogICAgICAgICAgICB0YWdzLnRhcmdldE9yaWdpbkJvdHMgPSBudWxsOwogICAgICAgIH0KICAgIGA7Cn0gZWxzZSB7CiAgICAvLyBObyBib3QgdG8gZGVzdHJveS4KICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAL/rl/8IABthYk11bHRpcGxlQm90TWVudU9uR2VuZXJhdGUCBAC/65f/CO8O7wRAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgppZiAocmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aCA+IDEpIHsKICAgIC8vIE11bHRpcGxlIGJvdHMuCiAgICB0YWdzLmxhYmVsID0gYGRlc3Ryb3kgKCR7cmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aH0gYm90cylgOwp9IGVsc2UgaWYgKHJlbGV2YW50VGFyZ2V0Qm90cy5sZW5ndGggPT09IDEpIHsKICAgIC8vIFNpbmdsZSBib3QuCiAgICB0YWdzLmxhYmVsID0gYGRlc3Ryb3lgOwp9IGVsc2UgewogICAgLy8gTm8gYm90cyB0byBkZXN0cm95LgogICAgZGVzdHJveSh0aGlzQm90KTsKfScBBGJvdHMkNWFlYzUwMWMtMzM4YS00MmNjLTlmZGQtOWExZWVhOTUzYTA2AScAv+uX/wjfEwZzeXN0ZW0CBAC/65f/COATEGFiLmFjdGlvbi51cGRhdGUnAL/rl/8I3xMIYWJBY3Rpb24CBAC/65f/CPETBHRydWUnAL/rl/8I3xMQYWJDb3JlTWVudUFjdGlvbgIEAL/rl/8I9hPdBEBpZiAoIWFiVXBkYXRlQ2hlY2tlci50YWdzLmNoZWNraW5nKSB7CiAgICBpZiAoYWJVcGRhdGVDaGVja2VyLnRhZ3MudXBkYXRlQXZhaWxhYmxlKSB7CiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ0luc3RhbGwgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgdXBkYXRlcz8nLAogICAgICAgICAgICBjb250ZW50OiAnV291bGQgeW91IGxpa2UgdG8gaW5zdGFsbCB0aGUgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgdXBkYXRlcz8gWW91IGFuZCBhbnkgY29ubmVjdGVkIHVzZXJzIHdpbGwgYXV0b21hdGljYWxseSByZWZyZXNoIHRoZSBwYWdlIGFmdGVyIHRoZSB1cGRhdGUgaXMgY29tcGxldGUuJywKICAgICAgICAgICAgY2FuY2VsVGV4dDogJ05vdCBub3cnLAogICAgICAgICAgICBjb25maXJtVGV4dDogJ1llcycKICAgICAgICB9KQoKICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgIGFiLnVwZGF0ZUFCKCk7CiAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfQogICAgfQp9JwC/65f/CN8TBGZvcm0CBAC/65f/CNQYB25vdGhpbmcnAL/rl/8I3xMIYWJJZ25vcmUCBAC/65f/CNwYBHRydWUnAL/rl/8I3xMTYWJDb3JlTWVudVNvcnRPcmRlcgIEAL/rl/8I4RgDMTAyJwC/65f/CN8TDmFiQ29yZU1lbnVJY29uAgQAv+uX/wjlGAZ1cGRhdGUnAL/rl/8I3xMPYWJDb3JlTWVudUxhYmVsAgQAv+uX/wjsGAZ1cGRhdGUnAL/rl/8I3xMUYWJDb3JlTWVudU9uR2VuZXJhdGUCBAC/65f/CPMY/A1AaWYgKCFnbG9iYWxUaGlzLmFiVXBkYXRlQ2hlY2tlcikgewogICAgZGVzdHJveSh0aGlzQm90KTsKICAgIHJldHVybjsKfQoKdGFncy5yZWZyZXNoRGlzcGxheSA9IGBACiAgICBpZiAodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpIHsKICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IG51bGw7CiAgICB9CgogICAgLy8gQ2xlYXIgdGFnIG1hc2tzLgogICAgbWFza3MuYWJNZW51ID0gbnVsbDsKICAgIG1hc2tzLmxhYmVsID0gbnVsbDsKICAgIG1hc2tzLmNvbG9yID0gbnVsbDsKICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gbnVsbDsKICAgIAogICAgaWYgKGFiVXBkYXRlQ2hlY2tlci50YWdzLnVwZGF0ZUF2YWlsYWJsZSkgewogICAgICAgIG1hc2tzLmxhYmVsID0gJ3VwZGF0ZSAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwogICAgICAgIG1hc2tzLmNvbG9yID0gJyNBNEREMDAnOwogICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gJ3VwZGF0ZSc7CiAgICB9IGVsc2UgewogICAgICAgIGlmIChhYlVwZGF0ZUNoZWNrZXIudGFncy5jaGVja2luZykgewogICAgICAgICAgICAvLyBUZW1wb3JhcmlseSByZXBsYWNlIHdpdGggYnVzeSBpbmRpY2F0b3Igd2hpbGUgY2hlY2tpbmcgZm9yIHVwZGF0ZXMuCiAgICAgICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gYWIubGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yKHsKICAgICAgICAgICAgICAgIGFiTWVudTogdHJ1ZSwKICAgICAgICAgICAgICAgIGxhYmVsOiAnY2hlY2tpbmcgZm9yIHVwZGF0ZXMgdG8gJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgICAgIGFiTWVudVNvcnRPcmRlcjogdGFncy5hYk1lbnVTb3J0T3JkZXIsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgbWFza3MuYWJNZW51ID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQUIgaXMgdXAtdG8tZGF0ZS4KICAgICAgICAgICAgbWFza3MuYWJNZW51ID0gZmFsc2U7CiAgICAgICAgfQogICAgfQpgOwoKdGFncy5vbkRlc3Ryb3kgPSBgQAogICAgaWYgKHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKSB7CiAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgdGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IgPSBudWxsOwogICAgfQoKICAgIGlmICh0aGlzQm90LnZhcnMub25BQlVwZGF0ZUNoZWNrZXJCb3RDaGFuZ2VkKSB7CiAgICAgICAgb3MucmVtb3ZlQm90TGlzdGVuZXIoYWJVcGRhdGVDaGVja2VyLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uQUJVcGRhdGVDaGVja2VyQm90Q2hhbmdlZCk7CiAgICB9CmAKCnRoaXNCb3QudmFycy5vbkFCVXBkYXRlQ2hlY2tlckJvdENoYW5nZWQgPSAobGlzdGVuZXJUaGF0KSA9PiB7CiAgICBjb25zdCBuZWVkUmVmcmVzaERpc3BsYXkgPSBsaXN0ZW5lclRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2NoZWNraW5nJyB8fCB0ID09PSAndXBkYXRlQXZhaWxhYmxlJyk7CiAgICBpZiAobmVlZFJlZnJlc2hEaXNwbGF5KSB7CiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgfQp9Cgpvcy5hZGRCb3RMaXN0ZW5lcihhYlVwZGF0ZUNoZWNrZXIsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25BQlVwZGF0ZUNoZWNrZXJCb3RDaGFuZ2VkKTsKCnRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsnAL/rl/8I3xMJYWJWZXJzaW9uAgQAv+uX/wjwJgUxMC4yOScBBGJvdHMkNmIzZDk3NDQtNDQ0OC00ZWY1LTk2YTItNzEyODFjNDJhZjZjAScAv+uX/wj2JglhYlZlcnNpb24CBAC/65f/CPcmBTEwLjI5JwC/65f/CPYmBnN5c3RlbQIEAL/rl/8I/SYRYWIuYWN0aW9uLnZlcnNpb24nAL/rl/8I9iYUYWJBY3Rpb25NYWpvclZlcnNpb24CBAC/65f/CI8nATEnAL/rl/8I9iYUYWJBY3Rpb25NaW5vclZlcnNpb24CBAC/65f/CJEnAjE4JwC/65f/CPYmDW9uU2tpbGxVcGRhdGUCBAC/65f/CJQnmQFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJBY3Rpb25NYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiQWN0aW9uTWlub3JWZXJzaW9uOwoKY29uc29sZS5sb2coIltBQkFjdGlvbl0gTG9hZGVkIEFCIEFjdGlvbiB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAL/rl/8I9iYIYWJJZ25vcmUCBAC/65f/CK4oBHRydWUnAL/rl/8I9iYIYWJBY3Rpb24CBAC/65f/CLMoBHRydWUnAL/rl/8I9iYEZm9ybQIEAL/rl/8IuCgHbm90aGluZycBBGJvdHMkNzE3NTY0NWMtNGI1My00NDU0LTg3MTYtZmMwZTY4ZGIyNjY1AScAv+uX/wjAKAZzeXN0ZW0CBAC/65f/CMEoD2FiLmFjdGlvbi5sb2dpbicAv+uX/wjAKAhhYkFjdGlvbgIEAL/rl/8I0SgEdHJ1ZScAv+uX/wjAKAhhYklnbm9yZQIEAL/rl/8I1igEdHJ1ZScAv+uX/wjAKARmb3JtAgQAv+uX/wjbKAdub3RoaW5nJwC/65f/CMAoD2FiQ29yZU1lbnVDb2xvcgIEAL/rl/8I4ygHI0YyQjcwNScAv+uX/wjAKBNhYkNvcmVNZW51U29ydE9yZGVyAgQAv+uX/wjrKAItNScAv+uX/wjAKBBhYkNvcmVNZW51QWN0aW9uAgQAv+uX/wjuKBtAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsnAL/rl/8IwCgUYWJDb3JlTWVudU9uR2VuZXJhdGUCBAC/65f/CIop6wFAdGFncy5hYk1lbnUgPSBmYWxzZTsgLy8gS2VlcCBidXR0b24gaGlkZGVuIHVudGlsIGF1dGggY2hlY2sgaXMgY29tcGxldGUuCmF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfSBlbHNlIHsKICAgIHRhZ3MuYWJNZW51ID0gdHJ1ZTsKICAgIHRhZ3Mub25BQkF1dGhCb3RBZGRlZCA9IGBAZGVzdHJveSh0aGlzQm90KTtgOwp9JwC/65f/CMAoDmFiQ29yZU1lbnVJY29uAgQAv+uX/wj2KgVsb2dpbicAv+uX/wjAKAhyZW1lbWJlcgIEAL/rl/8I/Coo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAv+uX/wjAKAlhYlZlcnNpb24CBAC/65f/CKMrBTEwLjI5JwC/65f/CMAoC3BlcnNvbmFsaXR5AgQAv+uX/wipKyjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwC/65f/CMAoD2FiQ29yZU1lbnVMYWJlbAIEAL/rl/8I0CsHc2lnbiBpbicAv+uX/wjAKA5hYkNvcmVNZW51SGlkZQIEAL/rl/8I2CsEdHJ1ZScAv+uX/wjAKA5vbkFueUJvdHNBZGRlZAIEAL/rl/8I3Sv+AkBpZiAodGhhdC5ib3RzKSB7CiAgICBjb25zdCBhZGRlZEF1dGhCb3QgPSB0aGF0LmJvdHMuZmluZChiID0+IGIgPT09IGdsb2JhbFRoaXMuYXV0aEJvdCk7CgogICAgaWYgKGFkZGVkQXV0aEJvdCkgewogICAgICAgIHRoaXNCb3QudmFycy5hdXRoQm90SWQgPSBhZGRlZEF1dGhCb3QuaWQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXV0aCBib3QgYWRkZWQuIGF1dGhCb3QgaWQ6ICR7dGhpc0JvdC52YXJzLmF1dGhCb3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCQXV0aEJvdEFkZGVkJywgeyBhdXRoQm90OiBhZGRlZEF1dGhCb3QgfSk7CiAgICB9Cn0nAL/rl/8IwCgFZGVidWcCBAC/65f/CNwuBWZhbHNlJwC/65f/CMAoEG9uQW55Qm90c1JlbW92ZWQCBAC/65f/COIuowNAaWYgKHRoYXQuYm90SURzICYmIHRoaXNCb3QudmFycy5hdXRoQm90SWQpIHsKICAgIGNvbnN0IHJlbW92ZWRBdXRoQm90SWQgPSB0aGF0LmJvdElEcy5zb21lKGlkID0+IGlkID09PSB0aGlzQm90LnZhcnMuYXV0aEJvdElkKTsKCiAgICBpZiAocmVtb3ZlZEF1dGhCb3RJZCkgewogICAgICAgIHRoaXNCb3QudmFycy5hdXRoQm90SWQgPSBudWxsOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGF1dGggYm90IHJlbW92ZWQuIGF1dGhCb3QgaWQ6ICR7cmVtb3ZlZEF1dGhCb3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCQXV0aEJvdFJlbW92ZWQnLCB7IGF1dGhCb3RJZDogcmVtb3ZlZEF1dGhCb3RJZCB9KTsKICAgIH0KfScBBGJvdHMkYjMzOWMxMTgtNDg5YS00NjZiLWJhOWYtYjA3YTVmOWI2NjRmAScAv+uX/wiGMgZzeXN0ZW0CBAC/65f/CIcyD2FiLmFjdGlvbi5wYXN0ZSgAv+uX/wiGMghhYkFjdGlvbgF4JwC/65f/CIYyBGZvcm0CBAC/65f/CJgyB25vdGhpbmcnAL/rl/8IhjILZGVzY3JpcHRpb24CBAC/65f/CKAyK2FiIHNraWxsIHVzZWQgZm9yIGNvcHlpbmcgYW5kIHBhc3RpbmcgYm90cy4nAL/rl/8IhjIHb25QYXN0ZQIEAL/rl/8IzDL/B0BpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IE1BQ1JPUyA9IFsKICAgIHsKICAgICAgICB0ZXN0OiAvKD86W+KAnOKAnV0pL2csCiAgICAgICAgcmVwbGFjZW1lbnQ6ICh2YWwpID0+ICciJywKICAgIH0sCiAgICB7CiAgICAgICAgdGVzdDogLyg/OlvigJjigJldKS9nLAogICAgICAgIHJlcGxhY2VtZW50OiAodmFsKSA9PiAiJyIsCiAgICB9LApdOwoKbGV0IGZvcm1hdHRlZENvcHkgPSByZXBsYWNlTWFjcm9zKHRoYXQudGV4dCk7CmxldCBjb3B5Qm90ID0gSlNPTi5wYXJzZShmb3JtYXR0ZWRDb3B5KTsKbGV0IHBhc3RlZERhdGEgPSAhY29weUJvdC5zdGF0ZSA/IHtbY29weUJvdC5pZF06IGNvcHlCb3R9IDogY29weUJvdC5zdGF0ZTsKbGV0IGRpbU1vZCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJGb2N1c0RhdGE7CgppZiAoT2JqZWN0LmtleXMocGFzdGVkRGF0YSkubGVuZ3RoID09IDEgJiYgZGltTW9kKQp7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb25dID0gdHJ1ZTsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbisiWCJdID0gZGltTW9kLng7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb24rIlkiXSA9IGRpbU1vZC55OwoKICAgIG9zLnRvYXN0KCJib3QgYWRkZWQgdG8gaW5zdCIpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImJvdHMgYWRkZWQgdG8gaW5zdCIpOwp9CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHBhc3RlZCBkYXRhIik7CgpsaW5rcy5jcmVhdGUuYWJDcmVhdGVCb3RzKHtib3RzOiBwYXN0ZWREYXRhLCBzb3VyY2VFdmVudDogJ3Bhc3RlJ30pOwoKZnVuY3Rpb24gcmVwbGFjZU1hY3Jvcyh0ZXh0KSB7CiAgICBpZiAoIXRleHQpIHsKICAgICAgICByZXR1cm4gdGV4dDsKICAgIH0KCiAgICBmb3IgKGxldCBtIG9mIE1BQ1JPUykgewogICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UobS50ZXN0LCBtLnJlcGxhY2VtZW50KTsKICAgIH0KCiAgICByZXR1cm4gdGV4dDsKfScAv+uX/wiGMghyZW1lbWJlcgIEAL/rl/8IxDoo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAv+uX/wiGMgZjcmVhdGUCBAC/65f/COs6KPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAL/rl/8IhjIIYWJJZ25vcmUCBAC/65f/CJI7BHRydWUnAL/rl/8IhjIJb25LZXlEb3duAgQAv+uX/wiXO4MGQGlmICghYnVpbGRlclZlcnNpb24gfHwgKCFsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzICYmICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpKSB7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LmtleXMgPT0gImMiKSB7CiAgICBsZXQgbWV0YUlucHV0ID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiTWV0YSIpOwoKICAgIGlmICghbWV0YUlucHV0KSB7CiAgICAgICAgbWV0YUlucHV0ID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiQ29udHJvbCIpOwogICAgfQoKICAgIGlmICghbWV0YUlucHV0KSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBzZWxlY3RlZEJvdHMgPSBbXTsKCiAgICBpZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykgewogICAgICAgIHNlbGVjdGVkQm90cy5wdXNoKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpOwogICAgfQogICAgZWxzZSBpZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5rcy5yZW1lbWJlci5saW5rcyAgICAuYWJNdWx0aXBsZUJvdEZvY3VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHNlbGVjdGVkQm90cy5wdXNoKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1c1tpXSk7CiAgICAgICB9CiAgICB9CiAKICAgIHRoaXNCb3QuYWJDb3B5Qm90c1RvQ2xpcGJvYXJkKHsgYm90czogc2VsZWN0ZWRCb3RzIH0pOwp9JwC/65f/CIYyCWFiVmVyc2lvbgIEAL/rl/8Im0EFMTAuMjknAL/rl/8IhjILcGVyc29uYWxpdHkCBAC/65f/CKFBKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAL/rl/8IhjIVYWJDb3B5Qm90c1RvQ2xpcGJvYXJkAgQAv+uX/wjIQZAKQGxldCBib3RzID0gdGhhdC5ib3RzOwpsZXQgb25QcmVwcm9jZXNzQmVmb3JlQ29weSA9IHRoYXQub25QcmVwcm9jZXNzQmVmb3JlQ29weTsKbGV0IHNvdXJjZUV2ZW50ID0gdGhhdC5zb3VyY2VFdmVudDsKCmxldCBib3RzVG9Db3B5ID0gW107CgppZiAoQXJyYXkuaXNBcnJheShib3RzKSkgewogICAgZm9yIChjb25zdCBib3Qgb2YgYm90cykgewogICAgICAgIGlmIChhYi5saW5rcy51dGlscy5pc0JvdChib3QpKSB7CiAgICAgICAgICAgIGJvdHNUb0NvcHkucHVzaChib3QpOwogICAgICAgIH0KICAgIH0KfSBlbHNlIHsKICAgIGlmIChhYi5saW5rcy51dGlscy5pc0JvdChib3RzKSkgewogICAgICAgIGJvdHNUb0NvcHkucHVzaChib3RzKTsKICAgIH0KfQoKaWYgKGJvdHNUb0NvcHkubGVuZ3RoID4gMCkgewogICAgLy8gTGV0IGFsbCBib3RzIGtub3cgdGhhdCBhYiBpcyBhYm91dCB0byBjb3B5IHNvbWUgYm90cy4KICAgIGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChzaG91dCgnb25BQkJlZm9yZUNvcHlCb3RzVG9DbGlwYm9hcmQnLCB7IGJvdHM6IGJvdHNUb0NvcHksIHNvdXJjZUV2ZW50IH0pKTsKICAgIAogICAgY29uc3Qgc3RhdGUgPSB7fTsKCiAgICBmb3IgKGNvbnN0IGJvdCBvZiBib3RzVG9Db3B5KSB7CiAgICAgICAgc3RhdGVbYm90LmlkXSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYm90KSk7CiAgICB9CgogICAgLy8gRG8gYSBwcmVwcm9jZXNzaW5nIHBhc3MgdGhhdCBhbGxvd3MgbGlzdGVuZXJzIHRvIHByZXByb2Nlc3MgdGhlIGJvdCBkYXRhIGJlZm9yZSBpdCBpcyBjb3BpZWQuCiAgICBjb25zdCBwcmVwcm9jZXNzQXJnID0geyBib3REYXRhOiBzdGF0ZSwgc291cmNlRXZlbnQgfTsKCiAgICBpZiAob25QcmVwcm9jZXNzQmVmb3JlQ29weSkgewogICAgICAgIGF3YWl0IG9uUHJlcHJvY2Vzc0JlZm9yZUNvcHkocHJlcHJvY2Vzc0FyZyk7CiAgICB9CgogICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHNob3V0KCdvbkFCUHJlcHJvY2Vzc0JlZm9yZUNvcHlCb3RzVG9DbGlwYm9hcmQnLCBwcmVwcm9jZXNzQXJnKSk7CiAgICAKICAgIC8vIFNlcmlhbGl6ZSB0byB2MSBhdXggZmlsZSwgYW5kIHRoZW4gY29weSB0byBjbGlwYm9hcmQuCiAgICBjb25zdCBhdXggPSBKU09OLnN0cmluZ2lmeSh7IHZlcnNpb246IDEsIHN0YXRlIH0pOwogICAgb3Muc2V0Q2xpcGJvYXJkKGF1eCk7CgogICAgYWIubGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdChgY29waWVkICR7Ym90c1RvQ29weS5sZW5ndGggPiAxID8gJ2JvdHMnIDogJ2JvdCd9IHRvIGNsaXBib2FyZGApOwp9JwEEYm90cyRiZGFiZDZjMC04OWY5LTRmNzUtYjM1Yy0yNmY0ZWM1MjA3ZDYBJwC/65f/CNlLBnN5c3RlbQIEAL/rl/8I2ksQYWIuYWN0aW9uLnJlcG9ydCcAv+uX/wjZSwRmb3JtAgQAv+uX/wjrSwdub3RoaW5nJwC/65f/CNlLEGFiQ29yZU1lbnVBY3Rpb24CBAC/65f/CPNLEUBvcy5yZXBvcnRJbnN0KCk7JwC/65f/CNlLE2FiQ29yZU1lbnVTb3J0T3JkZXICBAC/65f/CIVMAzEwMScAv+uX/wjZSw5hYkNvcmVNZW51SWNvbgIEAL/rl/8IiUwEZmxhZycAv+uX/wjZSw9hYkNvcmVNZW51TGFiZWwCBAC/65f/CI5MBnJlcG9ydCcAv+uX/wjZSwhhYkFjdGlvbgIEAL/rl/8IlUwEdHJ1ZScAv+uX/wjZSwhhYklnbm9yZQIEAL/rl/8ImkwEdHJ1ZScAv+uX/wjZSxRhYkNvcmVNZW51T25HZW5lcmF0ZQIEAL/rl/8In0xGQGlmIChjb25maWdCb3QudGFncy5zdGF0aWNJbnN0ICE9IHVuZGVmaW5lZCkKewogICAgZGVzdHJveSh0aGlzQm90KTsKfScAv+uX/wjZSwlhYlZlcnNpb24CBAC/65f/COZMBTEwLjI5JwEEYm90cyRjNjhjNWI4Mi1jMGE3LTRhNWEtOTEwNC01ZGQ4ZTMyYWU0ZTIBJwC/65f/COxMBnN5c3RlbQIEAL/rl/8I7UwQYWIuYWN0aW9uLnBvcnRhbCcAv+uX/wjsTAtkZXNjcmlwdGlvbgIEAL/rl/8I/kwUU2tpbGwgdG8gb3BlbiBzaGVldC4nAL/rl/8I7EwIYWJBY3Rpb24CBAC/65f/CJNNBHRydWUnAL/rl/8I7EwEZm9ybQIEAL/rl/8ImE0Hbm90aGluZycAv+uX/wjsTBBhYkNvcmVNZW51QWN0aW9uAgQAv+uX/wigTQNALy8nAL/rl/8I7EwIcmVtZW1iZXICBAC/65f/CKRNKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAL/rl/8I7EwPYWJDb3JlTWVudUxhYmVsAgQAv+uX/wjLTRBjdXJyZW50IHBvcnRhbDogJwC/65f/COxMD2FiQm90TWVudUFjdGlvbgIEAL/rl/8I3E34AkBjb25zdCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CmNvbnN0IGN1cnJlbnREaW0gPSBsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90LnRhZ3MubGluZVRvOwpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZiAoc3RhdGUpIAp7CiAgICBvcy5vcGVuVVJMKGNvbmZpZ0JvdC50YWdzLnBlcm1hbGluayArIGAmc2hlZXRQb3J0YWw9JHtjdXJyZW50RGltfWApOwp9CmVsc2UKewogICAgY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgPSBjdXJyZW50RGltOwp9CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBib3Qgc2hlZXQiKTsnAL/rl/8I7EwOYWJCb3RNZW51TGFiZWwCBAC/65f/CNVQDm9wZW4gYm90IHNoZWV0JwC/65f/COxMDW1hbmlmZXN0YXRpb24CBAC/65f/CORQKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAL/rl/8I7EwNYWJCb3RNZW51SWNvbgIEAL/rl/8Ii1EKdGFibGVfdmlldycAv+uX/wjsTA5hYkNvcmVNZW51SWNvbgIEAL/rl/8IllELYXJyb3dfcmlnaHQnAL/rl/8I7EwSYWJCb3RNZW51U29ydE9yZGVyAgQAv+uX/wiiUQExJwC/65f/COxMCGFiSWdub3JlAgQAv+uX/wikUQR0cnVlJwC/65f/COxMF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAv+uX/wipUZsEQGNvbnN0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKY29uc3QgY3VycmVudERpbSA9ICJhYk11bHRpcGxlU2VsZWN0IjsKCmNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY3VycmVudERpbTsKCnNldFRhZ01hc2sobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzLCBjdXJyZW50RGltLCB0cnVlLCAidGVtcExvY2FsIik7CgptYXNrcy5jdXJyZW50U2hlZXRCb3RzID0gbGlua3MucmVtZW1iZXIudGFncy5hYk11bHRpcGxlQm90Rm9jdXM7Cm1hc2tzLm9uUG9ydGFsQ2hhbmdlZCA9IGBAIGlmICh0aGF0LmRpbWVuc2lvbiAhPSAiYWJNdWx0aXBsZVNlbGVjdCIgJiYgdGhhdC5wb3J0YWwgPT0gInNoZWV0UG9ydGFsIikKewogICAgY2xlYXJUYWdNYXNrcyhsaW5rcy5jdXJyZW50U2hlZXRCb3RzKTsKCiAgICBjbGVhclRhZ01hc2tzKHRoaXNCb3QpOwp9IGA7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQiKTsnAL/rl/8I7EwWYWJNdWx0aXBsZUJvdE1lbnVMYWJlbAIEAL/rl/8IxVUab3BlbiBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQnAL/rl/8I7EwVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAv+uX/wjgVQp0YWJsZV92aWV3JwC/65f/COxME2FiQm90TWVudU9uR2VuZXJhdGUCBAC/65f/COtVmAJAbGV0IHNlbGVjdGVkQm90ID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC50YWdzLmxpbmVUbzsKCnRhZ3MubGFiZWwgPSAic2hlZXRQb3J0YWw9IiArIHNlbGVjdGVkQm90LnN1YnN0cmluZygwLCA0KTsKCnRhZ3Mub25LZXlEb3duID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gdGFncy5sYWJlbCArICIgaW4gbmV3IHRhYiI7fWA7CnRhZ3Mub25LZXlVcCA9IGBAIGlmKHRoYXQua2V5cyA9PSAiU2hpZnQiKXttYXNrcy5sYWJlbCA9IG51bGw7fWA7JwC/65f/COxMGmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQAv+uX/wiEWAEwJwC/65f/COxMBG1lbnUCBAC/65f/CIZYKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAL/rl/8I7EwJYWJWZXJzaW9uAgQAv+uX/witWAUxMC4yOScAv+uX/wjsTAthYkJsdWVwcmludAIEAL/rl/8Is1j7A0Bjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSBsaW5rcy5yZW1lbWJlcj8udGFncy5hYkJsdWVwcmludENvbG9yID8/ICIjMTc4NUI1IjsKCmlmIChiYWNrZ3JvdW5kQ29sb3IgPT0gZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDb2xvcikKewogICAgcmV0dXJuOwp9CgpncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yID0gYmFja2dyb3VuZENvbG9yOwoKbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gYEAgaWYgKHRoYXQucG9ydGFsID09ICJncmlkUG9ydGFsIiAmJiB0aGF0LmRpbWVuc2lvbiAhPSAiYmx1ZXByaW50Iil7CiAgICAvLyBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJhc2VDb2xvciA9IG51bGw7CiAgICAvLyBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJhc2VTdHJva2VDb2xvciA9IG51bGw7CgogICAgZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDb2xvciA9IG51bGw7CgogICAgbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gbnVsbDsKfWA7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOycAv+uX/wjsTAtvbkFueUNyZWF0ZQIEAL/rl/8Ir1x2QGlmICh0aGF0LmJvdC50YWdzLmJsdWVwcmludCkKewogICAgdGhhdC5ib3QudGFncy5zdHJva2VDb2xvciA9ICIjZmZmZmZmIjsKICAgIHRoYXQuYm90LnRhZ3MubGFiZWxDb2xvciA9ICIjZmZmZmZmIjsKfScAv+uX/wjsTA9vblBvcnRhbENoYW5nZWQCBAC/65f/CKZdYUBpZiAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIHRoYXQuZGltZW5zaW9uID09ICJibHVlcHJpbnQiKQp7CiAgICB0aGlzQm90LmFiQmx1ZXByaW50KCk7Cn0nAL/rl/8I7EwLcGVyc29uYWxpdHkCBAC/65f/CIheKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAL/rl/8I7EwSYWJDb3JlTWVudUl0ZW1UeXBlAgQAv+uX/wivXghkcm9wZG93bicAv+uX/wjsTBFkcm9wZG93blNvcnRPcmRlcgIEAL/rl/8IuF4BMScAv+uX/wjsTA9kcm9wZG93bk9wdGlvbnMCBAC/65f/CLpeBvCfp6xbXScAv+uX/wjsTBhhYkNvcmVNZW51T25CZWZvcmVDcmVhdGUCBAC/65f/CL9e4h5AY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IGN1cnJlbnREaW0gPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uOw0KY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCmNvbnN0IHBlcm1hbGlua1VSTCA9IGNvbmZpZ0JvdC50YWdzLnBlcm1hbGluazsNCmNvbnN0IGFjdGl2ZUluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOw0KY29uc3QgYWN0aXZlQmlvcyA9IGNvbmZpZ0JvdC50YWdzLm93bmVyID8gIiZvd25lcj0iICsgY29uZmlnQm90LnRhZ3Mub3duZXIgOiBmYWxzZTsNCmNvbnN0IGZpcnN0SW5kZXggPSBwZXJtYWxpbmtVUkwuaW5kZXhPZigiJiIpOw0KY29uc3QgaW5pdGlhbFVSTCA9IHBlcm1hbGlua1VSTC5zdWJzdHJpbmcoMCwgZmlyc3RJbmRleCk7DQpjb25zdCB1cGRhdGVkVVJMID0gYWN0aXZlQmlvcyAhPSBmYWxzZSA/IGluaXRpYWxVUkwgKyAiJmluc3Q9IiArIGFjdGl2ZUluc3QgOiBpbml0aWFsVVJMOw0KDQpzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkNvcmVNZW51TGFiZWwiLGBtb2RlOiAke2N1cnJlbnRQb3J0YWx9IHBvcnRhbGApOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAiY3VycmVudERpbWVuc2lvbiIsIGN1cnJlbnREaW0pOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAiY3VycmVudFBvcnRhbCIsIGN1cnJlbnRQb3J0YWwpOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAiZHJvcGRvd25Tb3J0T3JkZXIiLCAxKTsNCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiUG9ydGFsTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMub25LZXlEb3duID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gdGFncy5sYWJlbCArICIgaW4gbmV3IHRhYiI7fWA7DQptZW51T3B0aW9ucy5vbktleVVwID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gbnVsbDt9YDsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCm1lbnVPcHRpb25zLnRhcmdldFVSTCA9IHVwZGF0ZWRVUkw7DQoNCmNvbnN0IG1hcE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQoNCm1hcE1lbnVCb3QubGFiZWwgPSAibWFwIHBvcnRhbCI7DQptYXBNZW51Qm90LmZvcm1BZGRyZXNzID0gInB1YmxpYyI7DQptYXBNZW51Qm90Lm9uQ2xpY2sgPSBgQCANCmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsNCg0KaWYoc3RhdGUpDQp7DQogICAgb3Mub3BlblVSTCh0YWdzLnRhcmdldFVSTCArICImbWFwUG9ydGFsPSR7Y3VycmVudERpbSA9PSAiYmx1ZXByaW50IiA/ICJob21lIiA6IGN1cnJlbnREaW19Iik7DQp9DQplbHNlDQp7DQogICAgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gIiR7Y3VycmVudERpbSA9PSAiYmx1ZXByaW50IiA/ICJob21lIiA6IGN1cnJlbnREaW19IjsNCiAgICBjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsID0gbnVsbDsNCn1gOw0KDQppZiAoY3VycmVudFBvcnRhbCAhPSAibWFwIikNCnsNCiAgICAvL21hcCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2gobWFwTWVudUJvdCk7DQp9DQoNCmNvbnN0IGdyaWRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KZ3JpZE1lbnVCb3QubGFiZWwgPSAiZ3JpZCBwb3J0YWwiOw0KZ3JpZE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiY3ViZSI7DQpncmlkTWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZncmlkUG9ydGFsPSR7Y3VycmVudERpbSA9PSAiYmx1ZXByaW50IiA/ICJob21lIiA6IGN1cnJlbnREaW19Iik7DQp9IA0KZWxzZQ0Kew0KICAgIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAiJHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iOyBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSBudWxsOw0KfWA7DQoNCmlmIChjdXJyZW50UG9ydGFsICE9ICJncmlkIiB8fCBjdXJyZW50RGltID09ICJibHVlcHJpbnQiKQ0Kew0KICAgIC8vZ3JpZCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goZ3JpZE1lbnVCb3QpOw0KfQ0KDQpjb25zdCBibHVlcHJpbnRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KDQpibHVlcHJpbnRNZW51Qm90LmxhYmVsID0gImJsdWVwcmludCBwb3J0YWwiOw0KYmx1ZXByaW50TWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhcmNoaXRlY3R1cmUiOw0KYmx1ZXByaW50TWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZncmlkUG9ydGFsPWJsdWVwcmludCIpOw0KfSANCmVsc2UNCnsNCiAgICBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gImJsdWVwcmludCI7IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IG51bGw7DQp9DQoNCmxpbmtzLnNraWxsQm90LmFiQmx1ZXByaW50KCk7YDsNCg0KaWYgKGN1cnJlbnREaW0gIT0gImJsdWVwcmludCIpDQp7DQogICAgLy9ibHVlcHJpbnQgcG9ydGFsIGJ1dHRvbg0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGJsdWVwcmludE1lbnVCb3QpOw0KfQ0KDQoNCmNvbnN0IHNoZWV0TWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCnNoZWV0TWVudUJvdC5sYWJlbCA9ICJzaGVldCBwb3J0YWwiOw0Kc2hlZXRNZW51Qm90LmZvcm1BZGRyZXNzID0gInRhYmxlX3ZpZXciOw0Kc2hlZXRNZW51Qm90Lm9uQ2xpY2sgPSBgQCANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZzaGVldFBvcnRhbD0ke2N1cnJlbnREaW19Iik7DQp9IA0KZWxzZQ0KeyANCiAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9ICIke2N1cnJlbnREaW19IjsNCn1gOw0KDQovL3NoZWV0IHBvcnRhbCBidXR0b24NCmRyb3Bkb3duT3B0aW9ucy5wdXNoKHNoZWV0TWVudUJvdCk7DQoNCg0KY29uc3Qgc3lzdGVtTWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCg0Kc3lzdGVtTWVudUJvdC5sYWJlbCA9ICJzeXN0ZW0gcG9ydGFsIjsNCnN5c3RlbU1lbnVCb3QuZm9ybUFkZHJlc3MgPSAic2V0dGluZ3NfYXBwbGljYXRpb25zIjsNCnN5c3RlbU1lbnVCb3Qub25DbGljayA9IGBADQoNCmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsNCg0KaWYoc3RhdGUpDQp7DQogICAgb3Mub3BlblVSTCh0YWdzLnRhcmdldFVSTCArICImc3lzdGVtUG9ydGFsPXRydWUiKTsNCn0gDQplbHNlDQp7IA0KICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7DQp9YDsNCg0KLy9zeXN0ZW0gcG9ydGFsIGJ1dHRvbg0KZHJvcGRvd25PcHRpb25zLnB1c2goc3lzdGVtTWVudUJvdCk7DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycBBGJvdHMkZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3AScAv+uX/wiifQZzeXN0ZW0CBAC/65f/CKN9DWFiLmFjdGlvbi5hc2snAL/rl/8Ion0EZm9ybQIEAL/rl/8IsX0Hbm90aGluZycAv+uX/wiifQZhc2tHUFQCBAC/65f/CLl93BxAaWYgKCF0YWdzLmdwdEFjdGl2ZSB8fCBhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93QUkgPT0gZmFsc2UpIHsKICAgIGNvbnN0IGFpTWVzc2FnZSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWlfcmVqZWN0aW9uX21lc3NhZ2UgPz8gIkFJIG5vdCBhdXRob3JpemVkIGZvciB0aGlzIGFjY291bnQiOwogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6IGFpTWVzc2FnZSB9KTsKICAgIG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7CiAgICBjb25maWdCb3QudGFncy5hYlNjYW4gPSB0cnVlOwogICAgY29uZmlnQm90LnRhZ3MucmVxdWVzdGluZ0FJID0gdHJ1ZTsKICAgIHJldHVybjsKfQoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKbGV0IGlucXVpcnkgPSB0aGF0LmlucXVpcnkgPz8gdGhhdDsKY29uc3QgcHJvbXB0ID0gIXRoYXQucHJvbXB0ID8gdGFncy5wcm9tcHRfY29yZSA6IHRhZ3NbInByb21wdF8iICsgdGhhdC5wcm9tcHRdOwpjb25zdCBhYkJvdCA9IHRoYXQuYWJCb3QgPz8gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdDsgLy8gQWxsb3cgY3VzdG9tIGFiIGJvdCB0byBiZSBwYXNzZWQuCmNvbnN0IGFiRGltZW5zaW9uID0gdGhhdC5hYkRpbWVuc2lvbiA/PyBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uOyAvLyBBbGxvdyBjdXN0b20gYWIgZGltZW5zaW9uIHRvIGJlIHBhc3NlZC4KY29uc3QgYWJQb3NpdGlvbiA9IHRoYXQuYWJQb3NpdGlvbiA/PyBhYi5saW5rcy5yZW1lbWJlci50YWdzW2FiRGltZW5zaW9uICsgJ0FCTGFzdFBvc2l0aW9uJ107IC8vIEFsbG93IGN1c3RvbSBhYiBwb3NpdGlvbiB0byBiZSBwYXNzZWQuCmNvbnN0IHBhdGNoQm90RGltZW5zaW9uID0gdGhhdC5hYkRpbWVuc2lvbiA/PyBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uOwpjb25zdCBwYXRjaEJvdFBvc2l0aW9uID0geyB4OiBhYlBvc2l0aW9uPy54ID8/IDAsIHk6IGFiUG9zaXRpb24/LnkgPz8gMCwgejogMCB9OwoKbGlua3MudXRpbHMuYWJMb2coeyBtZXNzYWdlOiBgdGhpbmtpbmcgYWJvdXQ6ICIke2lucXVpcnl9ImAgfSk7CmxpbmtzLm1hbmlmZXN0YXRpb24uYWJCb3RDaGF0KHsgYm90OiBhYkJvdCwgbWVzc2FnZTogYHRoaW5raW5nIGFib3V0OiAiJHtpbnF1aXJ5fSJgIH0pOwoKaW5xdWlyeSA9IGBJTlBVVDogJHtpbnF1aXJ5fWA7CgppZiAodGhhdC5wcm9tcHQgPT0gImdyaWQiKSB7CiAgICBpbnF1aXJ5ICs9IGBcblBPU0lUSU9OOiB7IGRpbWVuc2lvbjogIiR7dGhhdC5kYXRhLmRpbWVuc2lvbn0iLCB4OiAke3RoYXQuZGF0YS5kaW1lbnNpb25YfSwgeTogJHt0aGF0LmRhdGEuZGltZW5zaW9uWX0gfWA7Cgp9IGVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJib3QiKSB7CiAgICBjb25zdCBpZCA9IHR5cGVvZiB0aGF0LmRhdGEuYm90ID09PSAnc3RyaW5nJyA/IHRoYXQuZGF0YS5ib3QgOiB0aGF0LmRhdGEuYm90LmlkOwogICAgY29uc3QgdGFyZ2V0Qm90ID0geyBpZCwgZGltZW5zaW9uOiBhYkRpbWVuc2lvbiB9OwogICAgaW5xdWlyeSArPSBgXG5UQVJHRVRfQk9UOiAke0pTT04uc3RyaW5naWZ5KHRhcmdldEJvdCwgdW5kZWZpbmVkLCAyKX1gOwoKfSBlbHNlIGlmICh0aGF0LnByb21wdCA9PSAibXVsdGlwbGVCb3QiKSB7CiAgICBjb25zdCB0YXJnZXRCb3RzID0gW107CiAgICBmb3IgKGxldCBlbnRyeSBvZiB0aGF0LmRhdGEuYm90cykgewogICAgICAgIGNvbnN0IGlkID0gdHlwZW9mIGVudHJ5ID09PSAnc3RyaW5nJyA/IGVudHJ5IDogZW50cnkuaWQ7CiAgICAgICAgaWYgKGlkKSB7CiAgICAgICAgICAgIHRhcmdldEJvdHMucHVzaCh7IGlkLCBkaW1lbnNpb246IGFiRGltZW5zaW9uIH0pCiAgICAgICAgfQogICAgfQogICAgaW5xdWlyeSArPSBgXG5UQVJHRVRfQk9UUzogJHtKU09OLnN0cmluZ2lmeSh0YXJnZXRCb3RzLCB1bmRlZmluZWQsIDIpfWA7Cgp9IGVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJjb3JlIikgewogICAgaW5xdWlyeSArPSBgXG5UQVJHRVRfRElNRU5TSU9OOiAke2FiRGltZW5zaW9ufWA7Cn0KCmNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpc0JvdC5zdWJtaXRSZXF1ZXN0R1BUKHsgaW5xdWlyeTogaW5xdWlyeSwgcHJvbXB0OiBwcm9tcHQsIG1vZGVsOiB0aGF0Lm1vZGVsIH0pOwoKaWYgKHJlc3BvbnNlKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gcmF3IHN1Ym1pdFJlcXVlc3RHUFQgcmVzcG9uc2U6XG5gLCByZXNwb25zZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyaXBNYXJrZG93bkZlbmNlcyhzKSB7CiAgICAgICAgLy8gcmVtb3ZlIGxlYWRpbmcgYGBgbGFuZ1xuIGFuZCB0cmFpbGluZyBgYGAKICAgICAgICBzID0gcy5yZXBsYWNlKC9eYGBgW2EtekEtWl0qXG4vLCAnJyk7CiAgICAgICAgcyA9IHMucmVwbGFjZSgvXG5gYGAkLywgJycpOwogICAgICAgIHJldHVybiBzOwogICAgfQoKICAgIGxldCBzYW5pdGl6ZWRSZXNwb25zZSA9IHN0cmlwTWFya2Rvd25GZW5jZXMocmVzcG9uc2UpOwogICAgCiAgICBsaW5rcy51dGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBbZ2VuZXJhdGVkIGNvZGVdOlxuJHtzYW5pdGl6ZWRSZXNwb25zZX1gIH0pOwoKICAgIGNvbnN0IGVnZ1BhcmFtZXRlcnMgPSB7CiAgICAgICAgcGF0Y2hDb2RlOiBzYW5pdGl6ZWRSZXNwb25zZSwKICAgICAgICBhc2tJbnB1dDogdGhhdC5kYXRhLAogICAgICAgIGRpbWVuc2lvbjogcGF0Y2hCb3REaW1lbnNpb24sCiAgICAgICAgcG9zaXRpb246IHBhdGNoQm90UG9zaXRpb24sCiAgICAgICAgYWx3YXlzQXBwcm92ZTogZmFsc2UsCiAgICB9CgogICAgY29uc3QgcGF0Y2hCb3RUZW1wbGF0ZSA9IGdldEJvdChiID0+IGIudGFncy5hYlBhdGNoQm90ICYmICFiLnRhZ3MuYWJQYXRjaEJvdEludGFuY2UgJiYgIWIudGFncy5hYklnbm9yZSk7CiAgICAKICAgIGlmIChwYXRjaEJvdFRlbXBsYXRlKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjbG9uaW5nIHBhdGNoIGJvdCAke3BhdGNoQm90VGVtcGxhdGUuaWR9IGZyb20gdGVtcGxhdGUgYm90IHRoYXQgd2FzIGZvdW5kYCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBib3REYXRhID0gZ2V0U25hcHNob3QocGF0Y2hCb3RUZW1wbGF0ZSk7CiAgICAgICAgYXdhaXQgYWIubGlua3MuY3JlYXRlLmFiQ3JlYXRlQm90cyh7CiAgICAgICAgICAgIGJvdERhdGEsCiAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnMsCiAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAnYXNrX2dwdCcsCiAgICAgICAgfSkKICAgIH0gZWxzZSB7CiAgICAgICAgYXdhaXQgYWIubGlua3Muc2VhcmNoLm9uTG9va3VwQXNrSUQoewogICAgICAgICAgICBhc2tJRDogJ2FiUGF0Y2hCb3QnLAogICAgICAgICAgICBzaG93SW5kaWNhdG9yOiBmYWxzZSwKICAgICAgICAgICAgYXV0b0hhdGNoOiB0cnVlLAogICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzLAogICAgICAgICAgICBzb3VyY2VFdmVudDogJ2Fza19ncHQnLAogICAgICAgICAgICBpZ25vcmVSZXNlcnZlZDogdHJ1ZSwKICAgICAgICB9KQogICAgfQp9JwC/65f/CKJ9CWdwdEFjdGl2ZQIEAL/rl/8IlpoBBWZhbHNlJwC/65f/CKJ9EHN1Ym1pdFJlcXVlc3RHUFQCBAC/65f/CJyaAfMRQGltcG9ydCB7IEFJQ2hhdE9wdGlvbnMsIEFJQ2hhdE1lc3NhZ2UgfSBmcm9tICdjYXN1YWxvcyc7Cgpjb25zdCB7CiAgICBwcm9tcHQsCiAgICBpbnF1aXJ5LAogICAgbW9kZWwsCn0gPSB0aGF0ID8/IHt9OwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdGAsIHRoYXQpOwp9CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd0FJID09IGZhbHNlKQp7CiAgICBsaW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KHsgbWVzc2FnZTogIkFJIG5vdCBhdXRob3JpemVkIG9uIHRoaXMgYWNjb3VudCIsIGxvZ1R5cGU6ICdsb2cnIH0pOwogICAgcmV0dXJuIG51bGw7Cn0KCmNvbnN0IGJ1c3lJbmRpY2F0b3IgPSBhd2FpdCBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3IoeyBhYk1lbnU6IHRydWUsIGxhYmVsOiBgYXNraW5nICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX1gIH0pOwoKY29uc3QgYWlDaGF0T3B0aW9uczogQUlDaGF0T3B0aW9ucyA9IHsgCiAgICBwcmVmZXJyZWRNb2RlbDogbW9kZWwgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwKfQoKY29uc3QgYWlDaGF0TWVzc2FnZXM6IEFJQ2hhdE1lc3NhZ2VbXSA9IFtdOwoKYWlDaGF0TWVzc2FnZXMucHVzaCh7CiAgICByb2xlOiAnc3lzdGVtJywKICAgIGNvbnRlbnQ6IFsKICAgICAgICB7IHRleHQ6IHByb21wdCA/IHByb21wdCA6IHRhZ3MucHJvbXB0X2NvcmUgfQogICAgXQp9KQoKLy8gVGhlIGZvbGxvd2luZyBhc3Npc3RhbnQgbWVzc2FnZSBpcyBhIGhhcmQgcmVxdWlyZW1lbnQgZm9yIEdvb2dsZSBHZW1pbmkgbW9kZWxzIC0gdGhhdCB0aGUgIm1vZGVsIiAvICJhc3Npc3RhbnQiIGhhdmUgYSBtZXNzYWdlIGJlZm9yZSB0aGUgInVzZXIiIGRvZXMuCi8vIEl0IGRvZXNudCByZWFsbHkgaHVydCB0byBkbyB0aGlzIGZvciBhbGwgdGhlIGFpIG1vZGVscyB0aG91Z2guCmFpQ2hhdE1lc3NhZ2VzLnB1c2goewogICAgcm9sZTogJ2Fzc2lzdGFudCcsCiAgICBjb250ZW50OiBbCiAgICAgICAgeyB0ZXh0OiBgVGhhbmsgeW91IGZvciB0aGF0IHZlcnkgZGV0YWlsZWQgYW5kIGNsZWFyIGV4cGxhbmF0aW9uIG9mIHRoZSByZXF1aXJlZCBkZWxpdmVyYWJsZS4gSSB3aWxsIG1ha2Ugc3VyZSB0byBnaXZlIHlvdSBjb2RlIHRoYXQgbWVldHMgeW91ciBleHBlY3RhdGlvbiB3aGlsZSBtYWtpbmcgc3VyZSB0aGF0IHRoZSBIYXJkIFJlcXVpcmVtZW50cyBhcmUgZnVsZmlsbGVkIHRoZSBIYXJkIFJlcXVpcmVtZW50cyEgV2hhdCB3b3VsZCB5b3UgbGlrZSB0byBhc2sgbWU/YCB9CiAgICBdCn0pCgphaUNoYXRNZXNzYWdlcy5wdXNoKHsKICAgIHJvbGU6ICd1c2VyJywKICAgIGNvbnRlbnQ6IFsKICAgICAgICB7IHRleHQ6IGlucXVpcnkgfQogICAgXQp9KQoKaWYgKCFsaW5rcy5tZW51KSB7CiAgICBhd2FpdCBsaW5rcy5sZWFybi5hYkFkYXB0KCdhYkludGVyZmFjZScpOwp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzZW5kaW5nIHRvIGFpOmAsIHsgYWlDaGF0TWVzc2FnZXMsIGFpQ2hhdE9wdGlvbnMgfSk7Cn0KCmxldCBhaVJlc3BvbnNlOiBBSUNoYXRNZXNzYWdlOwoKdHJ5IHsKICAgIGFpUmVzcG9uc2UgPSBhd2FpdCBhaS5jaGF0KGFpQ2hhdE1lc3NhZ2VzLCBhaUNoYXRPcHRpb25zKTsKCiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWkgcmVzcG9uc2U6YCwgYWlSZXNwb25zZSk7CiAgICB9CgogICAgYXNzZXJ0KHR5cGVvZiBhaVJlc3BvbnNlLmNvbnRlbnQgPT09ICdzdHJpbmcnLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIFVuYWJsZSB0byBleHRyYWN0IHN0cmluZyByZXNwb25zZSBmcm9tIEFJIHJlc3BvbnNlLmApOwp9IGNhdGNoKGUpIHsKICAgIGFpUmVzcG9uc2UgPSBudWxsOwoKICAgIC8vIFNob3cgdG9hc3Qgd2l0aCBlcnJvci4KICAgIGxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoeyBtZXNzYWdlOiBgQUkgcmVxdWVzdCBmYWlsZWQgLSAke2xpbmtzLnV0aWxzLmdldEVycm9yTWVzc2FnZShlKX1gLCBsb2dUeXBlOiAnZXJyb3InIH0pOwoKICAgIC8vIFJldGhyb3cgc28gY2FsbGVycyBjYW4gY2F0Y2guCiAgICB0aHJvdyBlOwp9IGZpbmFsbHkgewogICAgZGVzdHJveShidXN5SW5kaWNhdG9yKTsKfQoKcmV0dXJuIGFpUmVzcG9uc2UuY29udGVudDsnAL/rl/8Ion0IcmVtZW1iZXICBAC/65f/CJCsASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC/65f/CKJ9EGFiQ29yZU1lbnVBY3Rpb24CBAC/65f/CLesAYIcQGNvbnN0IGlucXVpcnkgPSB0aGF0Py5tZXNzYWdlID8/IHRoYXQ7CmNvbnN0IGluaXRpYWxCb290ID0gdGhhdD8uaW5pdGlhbEJvb3QgPz8gZmFsc2U7CmNvbnN0IGF1dG9IYXRjaCA9IHRoYXQ/LmF1dG9IYXRjaCA/PyBmYWxzZTsKY29uc3QgbWVudSA9IHRoYXQ/Lm1lbnUgPz8gImNvcmUiOwpjb25zdCBpbnF1aXJ5SGFzU3BhY2UgPSBpbnF1aXJ5LmluZGV4T2YoIiAiKSAhPT0gLTE7CmNvbnN0IG1lbnVCb3RzID0gZ2V0Qm90cyhjb25maWdCb3QudGFncy5tZW51UG9ydGFsLCB0cnVlKTsKY29uc3QgaXNDaGFubmVsID0gdGhhdC5pc0NoYW5uZWwgPz8gZmFsc2U7CmNvbnN0IGlzVVVBQiA9IHRoYXQuaXNVVUFCID8/IGZhbHNlOwoKd2hpc3BlcihtZW51Qm90cywgImFiTWVudVJlZnJlc2giKTsKCmxldCB1c2VybmFtZSA9ICJ1c2VyIjsKaWYgKGF1dGhCb3QgJiYgYXV0aEJvdC50YWdzLm5hbWUpIHsKICAgIHVzZXJuYW1lID0gYXV0aEJvdC50YWdzLm5hbWU7Cn0gZWxzZSBpZiAoYWIubGlua3MuY29uc29sZS5tYXNrcy5wcmVmZXJyZWROYW1lKSB7CiAgICB1c2VybmFtZSA9IGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZTsKfQoKYWIubG9nKHsgbWVzc2FnZTogaW5xdWlyeSwgbmFtZTogdXNlcm5hbWUgfSk7CgppZiAoIWNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbCAmJiBsaW5rcy5tYW5pZmVzdGF0aW9uLnRhZ3MuYWJBd2FrZSAmJiBpbnF1aXJ5ICE9ICIubG9nIikgewogICAgc2hvdXQoInNob3dDb25zb2xlIik7Cn0KCmlmIChpc1VVQUIpIHsKICAgIGxpbmtzLnV1YWJMb2FkZXI/LmxvYWRVVUFCKGlucXVpcnkpOwp9CmVsc2UgaWYgKGlzQ2hhbm5lbCkgewogICAgbGlua3MuY2hhbm5lbExvYWRlcj8ubG9hZENoYW5uZWwoaW5xdWlyeSk7Cn0KZWxzZSBpZiAoIWlucXVpcnlIYXNTcGFjZSkgewogICAgY29uc3QgaXNEaXJlY3RTZWFyY2ggPSBpbnF1aXJ5LnN0YXJ0c1dpdGgoYCJgKSAmJiBpbnF1aXJ5LmVuZHNXaXRoKGAiYCk7CgogICAgY29uc3QgYXNrOiBBQkxvb2t1cEFza0lEUmVzdWx0IHwgZmFsc2UgPSAhaXNEaXJlY3RTZWFyY2ggPyBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7IGFza0lEOiBpbnF1aXJ5LCBhdXRvSGF0Y2g6IHRydWUsIHNvdXJjZUV2ZW50OiAnYXNrJyB9KSA6IGZhbHNlOwoKICAgIGlmIChhc2s/LnN1Y2Nlc3MgJiYgYXNrPy5kYXRhPy51cmwgIT0gdW5kZWZpbmVkICYmICFpc0RpcmVjdFNlYXJjaCAmJiAhaXNDaGFubmVsKSB7CiAgICAgICAgbGlua3MubGVhcm4uYWJKb2luSG9zdCh7IGRhdGE6IGFzay5kYXRhIH0pOwogICAgfSBlbHNlIGlmICghYXNrPy5zdWNjZXNzKSB7CiAgICAgICAgbGV0IGVnZzogQUJMb29rdXBFZ2dSZXN1bHQ7CiAgICAgICAgY29uc3QgcGVyaW9kSW5kZXggPSBpbnF1aXJ5LmluZGV4T2YoIi4iKTsKICAgICAgICBsZXQgYWJJRCA9IGlucXVpcnk7CgogICAgICAgIGlmIChpc0RpcmVjdFNlYXJjaCkgewogICAgICAgICAgICBhYklEID0gaW5xdWlyeS5zdWJzdHJpbmcoMSwgaW5xdWlyeS5sZW5ndGggLSAxKTsKICAgICAgICB9CgogICAgICAgIGlmIChwZXJpb2RJbmRleCA9PSAtMSB8fCBpc0RpcmVjdFNlYXJjaCkgewogICAgICAgICAgICBlZ2cgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3MoeyBhYklEOiBhYklELCBpbml0aWFsQm9vdCwgYXV0b0hhdGNoLCBzb3VyY2VFdmVudDogJ2FzaycgfSk7CiAgICAgICAgfSBlbHNlIGlmIChwZXJpb2RJbmRleCA+IDApIHsKICAgICAgICAgICAgY29uc3QgcmVjb3JkS2V5ID0gaW5xdWlyeS5zdWJzdHJpbmcoMCwgcGVyaW9kSW5kZXgpOwoKICAgICAgICAgICAgYWJJRCA9IGlucXVpcnkuc3Vic3RyaW5nKHBlcmlvZEluZGV4ICsgMSk7CgogICAgICAgICAgICBlZ2cgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3MoeyByZWNvcmRLZXk6IHJlY29yZEtleSwgYWJJRDogYWJJRCwgaW5pdGlhbEJvb3QsIGF1dG9IYXRjaCwgc291cmNlRXZlbnQ6ICdhc2snLCB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaW5rcy5pbnB1dC5vbkNoYXQoeyBtZXNzYWdlOiBpbnF1aXJ5IH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFlZ2c/LnN1Y2Nlc3MgJiYgbGlua3MubWVudSkgewogICAgICAgICAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKICAgICAgICAgICAgY29uc3Qgc3R1ZGlvQnV0dG9uID0ge307CgogICAgICAgICAgICBzdHVkaW9CdXR0b24uYWJNZW51ID0gdHJ1ZTsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmxhYmVsID0gYWJJRCArICIgbm90IGZvdW5kIGluIGFjdGl2ZSBzdHVkaW8sIGVudGVyIGFsdGVybmF0ZSBzdHVkaW9JRCI7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5mb3JtID0gImlucHV0IjsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmFiSUQgPSBhYklEOwogICAgICAgICAgICBzdHVkaW9CdXR0b24uZm9ybUFkZHJlc3MgPSB0YWdzLmFiQ29yZU1lbnVJY29uOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ub25TdWJtaXQgPSBgQCBsaW5rcy5tYW5hZ2VyLmFiQ29yZU1lbnVBY3Rpb24odGhhdC50ZXh0ICsgIi4iICsgdGFncy5hYklEKTtgOwoKICAgICAgICAgICAgY29uc3QgY3JlYXRlQnV0dG9uID0ge307CgogICAgICAgICAgICBjcmVhdGVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLmxhYmVsID0gImdpdmUgbWUgYSBwcm90b3R5cGUiOwogICAgICAgICAgICBjcmVhdGVCdXR0b24ubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgICAgICAgICBjcmVhdGVCdXR0b24uYWJJRCA9IGFiSUQ7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5wcm90b3R5cGUodGFncy5hYklEKTtgOwoKICAgICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oY3JlYXRlQnV0dG9uKTsKICAgICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oc3R1ZGlvQnV0dG9uKTsKCiAgICAgICAgICAgIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyI7CiAgICAgICAgfQogICAgfQp9IGVsc2UgewogICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCiAgICBpZiAoIWF1dGhCb3QpIHsKICAgICAgICBvcy50b2FzdCgicGxlYXNlIHNpZ24gaW4gdG8gYWNjZXNzIGFkdmFuY2VkIEFJIGZlYXR1cmVzIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgfSBlbHNlIHsKICAgICAgICBtYXNrcy5ncHRBY3RpdmUgPSB0cnVlOwoKICAgICAgICBhd2FpdCB0aGlzQm90LmFza0dQVCh7IGlucXVpcnk6IGlucXVpcnksIHByb21wdDogbWVudSwgZGF0YTogdGhhdCB9KTsKICAgIH0KfScAv+uX/wiifRRhYkNvcmVNZW51T25HZW5lcmF0ZQIEAL/rl/8IusgB8ghAdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiY29yZSJ9KTsKICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclN1Ym1pdHRlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCmlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGZyb20gYnVpbHQtaW4gc3VnZ2VzdGlvbnMuCiAgICAgICAgbGV0IHRleHQgPSBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0NvcmVbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNDb3JlLmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwC/65f/CKJ9E2FiQ29yZU1lbnVTb3J0T3JkZXICBAC/65f/CK3RAQMyMDAnAL/rl/8Ion0QYWJHcmlkTWVudUFjdGlvbgIEAL/rl/8IsdEBDkAvL3BsYWNlaG9sZGVyJwC/65f/CKJ9FGFiR3JpZE1lbnVPbkdlbmVyYXRlAgQAv+uX/wjA0QH/CkB0YWdzLmRpbWVuc2lvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMuZGltZW5zaW9uOwp0YWdzLmRpbWVuc2lvblggPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzLnBvc2l0aW9uLng7CnRhZ3MuZGltZW5zaW9uWSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMucG9zaXRpb24ueTsKdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiZ3JpZCIsIGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24sIGRpbWVuc2lvblg6IHRhZ3MuZGltZW5zaW9uWCwgZGltZW5zaW9uWTogdGFncy5kaW1lbnNpb25ZfSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwpgOwp0YWdzLm9uSW5wdXRUeXBpbmcgPSBgQAogICAgaWYgKCF0YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkQ29yZVRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNHcmlkW21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zR3JpZC5sZW5ndGggLSAxKV07CgogICAgICAgIGxpbmtzLmJhc2VTa2lsbC5pbnB1dFN1Z2dlc3Rpb24oeyBpbnB1dEJvdDogdGhpc0JvdCwgdGV4dCB9KTsKICAgIH0KfScAv+uX/wiifQ1tYW5pZmVzdGF0aW9uAgQAv+uX/wjA3AEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAv+uX/wiifRNhYkdyaWRNZW51U29ydE9yZGVyAgQAv+uX/wjn3AEDMjAwJwC/65f/CKJ9D2FiR3JpZE1lbnVMYWJlbAIEAL/rl/8I69wBBmFzayBhYicAv+uX/wiifQ9hYkNvcmVNZW51TGFiZWwCBAC/65f/CPLcAQZhc2sgYWInAL/rl/8Ion0OYWJDb3JlTWVudUljb24CBAC/65f/CPncAQRjdWJlJwC/65f/CKJ9DmFiR3JpZE1lbnVJY29uAgQAv+uX/wj+3AEEY3ViZScAv+uX/wiifQplZGl0UHJvbXB0AgQAv+uX/wiD3QGHCEBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBwcm9tcHRNZW51QnV0dG9uID0ge307Cgpwcm9tcHRNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CnByb21wdE1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKcHJvbXB0TWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwpwcm9tcHRNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKcHJvbXB0TWVudUJ1dHRvbi5ncHRCb3QgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gImxvYWQgcHJvbXB0IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjbG91ZF9kb3dubG9hZCI7CnByb21wdE1lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLmdwdEJvdC51cGRhdGVQcm9tcHQoJ2xvYWQnKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7Cgpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gInNhdmUgcHJvbXB0IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJiYWNrdXAiOwpwcm9tcHRNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5ncHRCb3QudXBkYXRlUHJvbXB0KCdzYXZlJyk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBgQCBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbDsKCnRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CmA7Cgp0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSAidG9wIjsKCmNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSB0aGlzQm90LmlkICsgIi5wcm9tcHRfY29yZSI7CgppZiAoY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlKQp7CiAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwp9JwC/65f/CKJ9BG1lbnUCBAC/65f/CInlASjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwC/65f/CKJ9DHVwZGF0ZVByb21wdAIEAL/rl/8IsOUBywhAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgcHJvbXB0TWVudUJ1dHRvbiA9IHt9OwoKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwpwcm9tcHRNZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwpwcm9tcHRNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CnByb21wdE1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKcHJvbXB0TWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CnByb21wdE1lbnVCdXR0b24uZ3B0Qm90ID0gIvCflJciICsgdGhpc0JvdC5pZDsKCmlmICh0aGF0ID09ICJsb2FkIikKewogICAgcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJsb2FkIHByb21wdCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNsb3VkX2Rvd25sb2FkIjsKICAgIHByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSAiQCBsaW5rcy5ncHRCb3QubG9hZFByb21wdCh0aGF0LnRleHQpOyI7Cn0KZWxzZQp7CiAgICBwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gInNhdmUgcHJvbXB0IjsKICAgIHByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiYmFja3VwIjsKICAgIHByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSAiQCBsaW5rcy5ncHRCb3Quc2F2ZVByb21wdCh0aGF0LnRleHQpOyI7Cn0KCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKcHJvbXB0TWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICIgICI7CnByb21wdE1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKcHJvbXB0TWVudUJ1dHRvbi5jb2xvciA9ICIjZjI0NzI3IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjYW5jZWwiOwpwcm9tcHRNZW51QnV0dG9uLm9uU3VibWl0ID0gbnVsbDsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7JwC/65f/CKJ9CmxvYWRQcm9tcHQCBAC/65f/CPrtAdoDQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEgPT0gZmFsc2UpCnsKICAgIG9zLnRvYXN0KCJub3QgYXV0aG9yaXplZCIpOwoKICAgIHJldHVybjsKfQoKY29uc3QgcHJvbXB0TmFtZSA9ICJncHRfcHJvbXB0XyIgKyB0aGF0Owpjb25zdCBuZXdQcm9tcHQgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIHByb21wdE5hbWUpOwoKaWYgKCFuZXdQcm9tcHQuc3VjY2VzcykKewogICAgb3MudG9hc3QoIm5vIHByb21wdCBmb3VuZCBieSB0aGF0IG5hbWUiKTsKfQplbHNlCnsKICAgIHRhZ3MucHJvbXB0X2NvcmUgPSBuZXdQcm9tcHQuZGF0YTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlID09IHRoYXQpCnsKICAgIHJldHVybjsKfQoKdGhpc0JvdC5lZGl0UHJvbXB0KCk7JwC/65f/CKJ9CnNhdmVQcm9tcHQCBAC/65f/CNXxAb4EQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEgPT0gZmFsc2UgfHwgYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5wdWJsaXNoRGF0YSA9PSBmYWxzZSkKewogICAgb3MudG9hc3QoIm5vdCBhdXRob3JpemVkIik7CgogICAgcmV0dXJuOwp9Cgpjb25zdCBhdXRob3IgPSBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwpjb25zdCBwcm9tcHROYW1lID0gImdwdF9wcm9tcHRfIiArIHRoYXQ7CmNvbnN0IG5ld1Byb21wdCA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgcHJvbXB0TmFtZSwgdGFncy5wcm9tcHRfY29yZSwge3VwZGF0ZVBvbGljeTogW2F1dGhvci5pZF19KTsKCmlmICghbmV3UHJvbXB0LnN1Y2Nlc3MpCnsKICAgIG9zLnRvYXN0KCJzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2FpbiIpOwp9CmVsc2UKewogICAgb3MudG9hc3QoInByb21wdCBzYXZlZCBhcyAiICsgdGhhdCk7Cn0KCnRoaXNCb3QuZWRpdFByb21wdCgpOycAv+uX/wiifQhhYklnbm9yZQIEAL/rl/8IlPYBBHRydWUnAL/rl/8Ion0IYWJBY3Rpb24CBAC/65f/CJn2AQR0cnVlJwC/65f/CKJ9BnNlYXJjaAIEAL/rl/8InvYBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAL/rl/8Ion0FbGVhcm4CBAC/65f/CMX2ASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwC/65f/CKJ9Cm1heF90b2tlbnMCBAC/65f/COz2AQQ1MDAwJwC/65f/CKJ9D29uQUJJbml0aWFsaXplZAIEAL/rl/8I8fYBWEBpZiAoY29uZmlnQm90LnRhZ3MucHJvbXB0X2Jhc2UpCnsKICAgIHRoaXNCb3QubG9hZFByb21wdChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSk7Cn0nAL/rl/8Ion0FaW5wdXQCBAC/65f/CMr3ASjwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwC/65f/CKJ9C3Byb21wdF9jb3JlAgQAv+uX/wjx9wHrIyMgRGVsaXZlcmFibGUKClJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCiMjIFJvbGUKCllvdSBhcmUgYW4gYWdlbnQgYm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgojIyBPYmplY3RpdmUKClVzaW5nIElOUFVUIGFzIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLgoKIyMjIENyaXRpY2FsIFJ1bGVzIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpOgoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYGFiLmxvZygiLi4uIilgIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gVXNlIHRoZSBgVEFSR0VUX0RJTUVOU0lPTmAgYXMgY29udGV4dCBmb3IgbG9jYXRpb24uIEZvciBleGFtcGxlLCBpZiBhIG5ldyBib3QgaXMgYmVpbmcgY3JlYXRlZCwgeW91IHdvdWxkIHBsYWNlIGl0IGluIHRoZSBnaXZlbiBgVEFSR0VUX0RJTUVOU0lPTmAuCjMuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCjQuIEFsd2F5cyByZXR1cm4gYW4gQXJyYXkgb2YgYEFCUGF0Y2hSZXN1bHRgIG9iamVjdHMgZm9yIGVhY2ggYm90IHRoYXQgaXMgY3JlYXRlZCBvciBtb2RpZmllZCBieSB0aGUgY29kZS4gVGhpcyBkYXRhIGlzIGNyaXRpY2FsIHRvIHRoZSB1c2VyIGZvciB0aGUgcGF0Y2hpbmcgcHJvY2VzcyBhcyBpdCB3aWxsIGFsbG93IHVzZXJzIHRvIHVuZG8gdGhlIHBhdGNoIGlmIHRoZXkgZGVzaXJlLgoKICAgIGBgYHR5cGVzY3JpcHQKICAgIGludGVyZmFjZSBBQlBhdGNoUmVzdWx0IHsKICAgICAgICAvKiogVGhlIGlkIG9mIHRoZSBib3QgdGhhdCB3YXMgY3JlYXRlZCAvIG1vZGlmaWVkLiAqLwogICAgICAgIGJvdElkOiBzdHJpbmc7CgogICAgICAgIC8qKiBXZXRoZXIgb3Igbm90IHRoaXMgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaC4gKi8KICAgICAgICBjcmVhdGVkOiBib29sZWFuOwoKICAgICAgICAvKiogCiAgICAgICAgKiBBIHJvbGxiYWNrIGRpZmYgb2YgdGhlIGJvdCB0aGF0IHN0b3JlcyB0aGUgb3JpZ2luYWwgdmFsdWVzIG9mIHRhZ3Mgb24gdGhlIGJvdCBiZWZvcmUgdGhlIHBhdGNoIGNvZGUgd2FzIHJ1bi4gSWYgdGhlIGJvdCB3YXMgY3JlYXRlZCBieSB0aGUgcGF0Y2ggY29kZSB0aGVuIHRoaXMgbXVzdCBiZSBudWxsLgogICAgICAgICogCiAgICAgICAgKiBTbmFwc2hvdHMgb2YgYm90cyBjYW4gYmUgb2J0YWluZWQgYnkgcnVubmluZyBnZXRTbmFwc2hvdChib3QpIGFuZCB0aGVuIGEgcm9sbGJhY2sgZGlmZiBjYW4gYmUgY3JlYXRlZCBieSBydW5uaW5nIGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcHNob3QpLgogICAgICAgICovCiAgICAgICAgcm9sbGJhY2tEaWZmOiBQYXJ0aWFsQm90U3RhdGUgfCBudWxsOwogICAgfQogICAgYGBgCgo1LiBOZXZlciB1c2UgYW55IG9uQW55XCogbGlzdGVuZXIgdGFncy4gVGhleSBhcmUgZ2VuZXJhbGx5IGNvbnNpZGVyZWQgZGFuZ2Vyb3VzIGFuZCBjYW4gYmUgcHJvbmUgdG8gY3Jhc2hpbmcuCjYuIEFsd2F5cyByZXNwb25kIHdpdGggcHVyZSBqYXZhc2NyaXB0IG9ubHkhIERvICoqTk9UKiogd3JhcCB0aGUgY29kZSBpbiBhbnkgTWFya2Rvd24gc3ludGF4LCBjb2RlIHdpbGwgKipGQUlMKiogdG8gZXhlY3V0ZSBpZiB0aGUgcmV0dXJuZWQgb3V0cHV0IGlzIG5vdCBwdXJlIGphdmFzY3JpcHQgY29kZS4KNy4gSWYgSU5QVVQgaXMgYSBxdWVzdGlvbiB0aGF0IG9ubHkgcmVxdWlyZXMgYSBzaW1wbGUgdGV4dCByZXNwb25zZSwganVzdCBsb2cgdGhlIGFuc3dlciB3aXRoIGFiLmxvZyBhbmQgdGhlbiBkZXN0cm95KHRoaXNCb3QpLgoKIyMgRG9jdW1lbnRhdGlvbgoKU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCiMjIEV4YW1wbGVzCgojIyMgRXhhbXBsZSAxCgpgYGBwbGFpbnRleHQKSU5QVVQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8KVEFSR0VUX0RJTUVOU0lPTjogaG9tZQpgYGAKCkFuc3dlcjoKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsKZGVzdHJveSh0aGlzQm90KTsKCnJldHVybiBbXTsKYGBgCgojIyMgRXhhbXBsZSAyCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSByZWQgYm90IGF0IHNjYWxlIDIgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBjbGlja2VkLgpUQVJHRVRfRElNRU5TSU9OOiBuZXN0CmBgYAoKQW5zd2VyOgoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSByZWQgYm90Iik7CmNvbnN0IGJvdCA9IGNyZWF0ZSh7CiAgICBuZXN0OiB0cnVlLAogICAgbmVzdFg6IDAsCiAgICBuZXN0WTogMCwKICAgIGNvbG9yOiAicmVkIiwKICAgIG9uQ2xpY2s6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsCiAgICBzY2FsZTogMiwKfSk7CgpyZXR1cm4gW3sgYm90SWQ6IGJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH1dOwpgYGAKCiMjIyBFeGFtcGxlIDMKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIGJvdCB0aGF0IG1ha2VzIGEgY29weSBvZiBpdHNlbGYgbmV4dCB0byBpdC4KVEFSR0VUX0RJTUVOU0lPTjogb3V0c2lkZQpgYGAKCkFuc3dlcjoKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGEgY29weSBib3QiKTsKY29uc3QgYm90ID0gY3JlYXRlKHsgb3V0c2lkZTogdHJ1ZSwgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHsgb3V0c2lkZVg6IHRhZ3Mub3V0c2lkZVggKyAxIH0pIiB9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAoKIyMjIEV4YW1wbGUgNAoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGFsbCByZWQgYm90cyBibHVlLgpUQVJHRVRfRElNRU5TSU9OOiBob21lCmBgYAoKQW5zd2VyOgoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOwoKY29uc3QgcmVkQm90cyA9IGdldEJvdHMoImNvbG9yIiwgInJlZCIpOwpjb25zdCBwYXRjaFJlc3VsdHMgPSBbXTsKCmZvciAoY29uc3QgYm90IG9mIHJlZEJvdHMpIHsKICAgIC8vIFRha2Ugc25hcHNob3RzIG9mIGVhY2ggYm90IGJlZm9yZSB3ZSBtb2RpZnkgdGhlbS4KICAgIGNvbnN0IHByZVBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwoKICAgIC8vIE1vZGlmeSB0aGUgYm90LgogICAgc2V0VGFnKGJvdCwgImNvbG9yIiwgImJsdWUiKTsKCiAgICAvLyBBZnRlciBtb2RpZnlpbmcgdGhlIGJvdCwgY3JlYXRlIHJvbGxiYWNrIGRpZmYgYW5kIHN0b3JlIGl0IGluIHRoZSByZXN1bHRzIHRoYXQgd2UgcmV0dXJuLgogICAgY29uc3QgcG9zdFBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyAKICAgICAgICBib3RJZDogYm90LmlkLCAKICAgICAgICBjcmVhdGVkOiBmYWxzZSwgCiAgICAgICAgcm9sbGJhY2tEaWZmOiBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBTaG90KQogICAgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAoKIyMjIEV4YW1wbGUgNQoKRXhhbXBsZSBVc2VyIElucHV0OgoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uClRBUkdFVF9ESU1FTlNJT046IGhvbWUKYGBgCgpFeGFtcGxlIEFuc3dlcjoKCmBgYGphdmFzY3JpcHQKYWIubG9nKCdNYWRlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgImhlbGxvIicpOwpjb25zdCBib3QgPSBjcmVhdGUoewogICAgaG9tZTogdHJ1ZSwKICAgIGNvbG9yOiAiYmx1ZSIsCiAgICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge29uQ2xpY2s6IG51bGwsIG9uUG9pbnRlckVudGVyOiB0YWdzLm9uUG9pbnRlckVudGVyU2NyaXB0fSkiLAogICAgb25Qb2ludGVyRW50ZXJTY3JpcHQ6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsCn0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCicAv+uX/wiifQtwcm9tcHRfZ3JpZAIEAL/rl/8I3ZsC+SUjIERlbGl2ZXJhYmxlCgpSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgojIyBSb2xlCgpZb3UgYXJlIGFuIGFnZW50IGJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKIyMgT2JqZWN0aXZlCgpVc2luZyBJTlBVVCBhbmQgUE9TSVRJT04gZGF0YSBhcyBwcm92aWRlZCBieSB0aGUgdXNlciwgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHJ1bnMgaW5zaWRlIHRoZSBvbkNyZWF0ZSBmaWVsZCBvZiBhIENhc3VhbE9TIGJvdCBhbmQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvci4KCiMjIyBIYXJkIFJlcXVpcmVtZW50cyAobXVzdCBhbGwgYmUgc2F0aXNmaWVkKQoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYGFiLmxvZygiLi4uIilgIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gVXNlIHN0YW5kYXJkIENhc3VhbE9TIHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdCguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KMy4gQWx3YXlzIHJldHVybiBhbiBBcnJheSBvZiBgQUJQYXRjaFJlc3VsdGAgb2JqZWN0cyBmb3IgZWFjaCBib3QgdGhhdCBpcyBjcmVhdGVkIG9yIG1vZGlmaWVkIGJ5IHRoZSBjb2RlLiBUaGlzIGRhdGEgaXMgY3JpdGljYWwgdG8gdGhlIHVzZXIgZm9yIHRoZSBwYXRjaGluZyBwcm9jZXNzIGFzIGl0IHdpbGwgYWxsb3cgdXNlcnMgdG8gdW5kbyB0aGUgcGF0Y2ggaWYgdGhleSBkZXNpcmUuCgogICAgYGBgdHlwZXNjcmlwdAogICAgaW50ZXJmYWNlIEFCUGF0Y2hSZXN1bHQgewogICAgICAgIC8qKiBUaGUgaWQgb2YgdGhlIGJvdCB0aGF0IHdhcyBjcmVhdGVkIC8gbW9kaWZpZWQuICovCiAgICAgICAgYm90SWQ6IHN0cmluZzsKCiAgICAgICAgLyoqIFdldGhlciBvciBub3QgdGhpcyBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoLiAqLwogICAgICAgIGNyZWF0ZWQ6IGJvb2xlYW47CgogICAgICAgIC8qKiAKICAgICAgICAqIEEgcm9sbGJhY2sgZGlmZiBvZiB0aGUgYm90IHRoYXQgc3RvcmVzIHRoZSBvcmlnaW5hbCB2YWx1ZXMgb2YgdGFncyBvbiB0aGUgYm90IGJlZm9yZSB0aGUgcGF0Y2ggY29kZSB3YXMgcnVuLiBJZiB0aGUgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaCBjb2RlIHRoZW4gdGhpcyBtdXN0IGJlIG51bGwuCiAgICAgICAgKiAKICAgICAgICAqIFNuYXBzaG90cyBvZiBib3RzIGNhbiBiZSBvYnRhaW5lZCBieSBydW5uaW5nIGdldFNuYXBzaG90KGJvdCkgYW5kIHRoZW4gYSByb2xsYmFjayBkaWZmIGNhbiBiZSBjcmVhdGVkIGJ5IHJ1bm5pbmcgZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwc2hvdCkuCiAgICAgICAgKi8KICAgICAgICByb2xsYmFja0RpZmY6IFBhcnRpYWxCb3RTdGF0ZSB8IG51bGw7CiAgICB9CiAgICBgYGAKCjQuIE5ldmVyIHVzZSBhbnkgb25BbnkqIGxpc3RlbmVyIHRhZ3MuIFRoZXkgYXJlIGdlbmVyYWxseSBjb25zaWRlcmVkIGRhbmdlcm91cyBhbmQgY2FuIGJlIHByb25lIHRvIGNyYXNoaW5nLgo1LiBBbHdheXMgcmVzcG9uZCB3aXRoIHB1cmUgamF2YXNjcmlwdCBvbmx5ISBEbyAqKk5PVCoqIHdyYXAgdGhlIGNvZGUgaW4gYW55IE1hcmtkb3duIHN5bnRheCwgY29kZSB3aWxsICoqRkFJTCoqIHRvIGV4ZWN1dGUgaWYgdGhlIHJldHVybmVkIG91dHB1dCBpcyBub3QgcHVyZSBqYXZhc2NyaXB0IGNvZGUuCjYuIElmIElOUFVUIGlzIGEgcXVlc3Rpb24gdGhhdCBvbmx5IHJlcXVpcmVzIGEgc2ltcGxlIHRleHQgcmVzcG9uc2UsIGp1c3QgbG9nIHRoZSBhbnN3ZXIgd2l0aCBgYWIubG9nKC4uLilgIGFuZCB0aGVuIGBkZXN0cm95KHRoaXNCb3QpYC4KCiMjIyBQb3NpdGlvbiBEYXRhCgotIFlvdSB3aWxsIHJlY2VpdmUgY29udGV4dCBzdWNoIGFzIGBQT1NJVElPTjogeyBkaW1lbnNpb246IHN0cmluZywgeDogbnVtYmVyLCB5OiBudW1iZXIgfWAuCi0gVXNlIHRoaXMgZGF0YSB0byBkZXRlcm1pbmUgYXBwcm9wcmlhdGUgZGltZW5zaW9uIGFuZCBwb3NpdGlvbiB3aXRoaW4gaXQsIG9yIHJlbGF0aXZlIHBsYWNlbWVudHMgZm9yIGFueSBjcmVhdGVkIGJvdHMuCgojIyBEb2N1bWVudGF0aW9uCgpTdXBwb3J0aW5nIGRvY3VtZW50YXRpb24gZm9yIENhc3VhbE9TIG1heSBiZSBmb3VuZCBoZXJlOiBodHRwczovL2RvY3MuY2FzdWFsb3MuY29tLwoKIyMgRXhhbXBsZXMKCiMjIyBFeGFtcGxlIDEKCmBgYHBsYWludGV4dApJTlBVVDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PyAgClBPU0lUSU9OOiB7IGRpbWVuc2lvbjogImhvbWUiLCB4OiA1LCB5OiA1IH0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKcmV0dXJuIFtdOwpgYGAKCiMjIyBFeGFtcGxlIDIKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIHJlZCBib3QgYXQgc2NhbGUgMiB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGNsaWNrZWQuICAKUE9TSVRJT046IHsgZGltZW5zaW9uOiAibmVzdCIsIHg6IDEsIHk6IDIgfSAgCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIHJlZCBib3QiKTsgIAoKY29uc3QgYm90ID0gY3JlYXRlKHsgbmVzdDogdHJ1ZSwgbmVzdFg6IDEsIG5lc3RZOiAyLCBjb2xvcjogInJlZCIsIG9uQ2xpY2s6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsIHNjYWxlOiAyIH0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCgojIyMgRXhhbXBsZSAzCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKUE9TSVRJT046IHsgZGltZW5zaW9uOiAib3V0c2lkZSIsIHg6IDAsIHk6IDAgfSAgCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIGNvcHkgYm90Iik7ICAKCmNvbnN0IGJvdCA9IGNyZWF0ZSh7IG91dHNpZGU6IHRydWUsIG91dHNpZGVYOiAwLCBvdXRzaWRlWTogMCwgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHsgb3V0c2lkZVg6IHRhZ3Mub3V0c2lkZVggKyAxIH0pIiB9KTsgIAoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCgojIyMgRXhhbXBsZSA0CgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuICAKUE9TSVRJT046IHsgZGltZW5zaW9uOiAiaG9tZSIsIHg6IDEwLCB5OiAtMyB9ICAKYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsKCmNvbnN0IHJlZEJvdHMgPSBnZXRCb3RzKCJjb2xvciIsICJyZWQiKTsKY29uc3QgcGF0Y2hSZXN1bHRzID0gW107Cgpmb3IgKGNvbnN0IGJvdCBvZiByZWRCb3RzKSB7CiAgICAvLyBUYWtlIHNuYXBzaG90cyBvZiBlYWNoIGJvdCBiZWZvcmUgd2UgbW9kaWZ5IHRoZW0uCiAgICBjb25zdCBwcmVQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QoYm90KTsKCiAgICAvLyBNb2RpZnkgdGhlIGJvdC4KICAgIHNldFRhZyhib3QsICJjb2xvciIsICJibHVlIik7CgogICAgLy8gQWZ0ZXIgbW9kaWZ5aW5nIHRoZSBib3QsIGNyZWF0ZSBkaWZmIHNuYXBzaG90cyBhbmQgc3RvcmUgdGhlbSBpbiB0aGUgcmVzdWx0cyB0aGF0IHdlIHJldHVybi4KICAgIGNvbnN0IHBvc3RQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QoYm90KTsKICAgIHBhdGNoUmVzdWx0cy5wdXNoKHsgCiAgICAgICAgYm90SWQ6IGJvdC5pZCwgCiAgICAgICAgY3JlYXRlZDogZmFsc2UsIAogICAgICAgIHJvbGxiYWNrRGlmZjogZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwU2hvdCkKICAgIH0pOwp9CgpyZXR1cm4gcGF0Y2hSZXN1bHRzOwpgYGAKCiMjIyBFeGFtcGxlIDUKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvLiAgClBPU0lUSU9OOiB7IGRpbWVuc2lvbjogImhvbWUiLCB4OiAzLCB5OiAzIH0gIApgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsbyIpOyAgCmNvbnN0IGJvdCA9IGNyZWF0ZSh7ICAKICAgIGhvbWU6IHRydWUsICAKICAgIGhvbWVYOiAzLCAgCiAgICBob21lWTogMywgIAogICAgY29sb3I6ICJibHVlIiwgIAogICAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHsgb25DbGljazogbnVsbCwgb25Qb2ludGVyRW50ZXI6IHRhZ3Mub25Qb2ludGVyRW50ZXJTY3JpcHQgfSkiLCAgCiAgICBvblBvaW50ZXJFbnRlclNjcmlwdDogIkAgb3MudG9hc3QoJ2hlbGxvJyk7Igp9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAonAL/rl/8Ion0KcHJvbXB0X2JvdAIEAL/rl/8I18EChS0jIERlbGl2ZXJhYmxlCgpSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgojIyBSb2xlCgpZb3UgYXJlIGFuIGFnZW50IGJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKIyMgT2JqZWN0aXZlCgpVc2luZyBJTlBVVCBhbmQgVEFSR0VUX0JPVCBkYXRhIGFzIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLgoKIyMjIEhhcmQgUmVxdWlyZW1lbnRzIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpCgoxLiBBbHdheXMgaW5jbHVkZSBhIHNpbmdsZSBgYWIubG9nKCIuLi4iKWAgc3VtbWFyaXppbmcgd2hhdCB0aGUgY29kZSBkb2VzLgoyLiBVc2UgdGhlIGBUQVJHRVRfQk9UYCBhcyBjb250ZXh0IGZvciBsb2NhdGlvbiBvciBiZWhhdmlvciB3aGVuIGFwcHJvcHJpYXRlLiBGb3IgZXhhbXBsZSwgaWYgYSBuZXcgYm90IGlzIGNyZWF0ZWQsIHlvdSBtYXkgcG9zaXRpb24gaXQgYmFzZWQgb24gdGhlIHRhcmdldCBib3QncyBwb3NpdGlvbiBpbiB0aGUgZ2l2ZW4gImRpbWVuc2lvbiIuCjMuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCjQuIEFsd2F5cyByZXR1cm4gYW4gQXJyYXkgb2YgYEFCUGF0Y2hSZXN1bHRgIG9iamVjdHMgZm9yIGVhY2ggYm90IHRoYXQgaXMgY3JlYXRlZCBvciBtb2RpZmllZCBieSB0aGUgY29kZS4gVGhpcyBkYXRhIGlzIGNyaXRpY2FsIHRvIHRoZSB1c2VyIGZvciB0aGUgcGF0Y2hpbmcgcHJvY2VzcyBhcyBpdCB3aWxsIGFsbG93IHVzZXJzIHRvIHVuZG8gdGhlIHBhdGNoIGlmIHRoZXkgZGVzaXJlLgoKICAgIGBgYHR5cGVzY3JpcHQKICAgIGludGVyZmFjZSBBQlBhdGNoUmVzdWx0IHsKICAgICAgICAvKiogVGhlIGlkIG9mIHRoZSBib3QgdGhhdCB3YXMgY3JlYXRlZCAvIG1vZGlmaWVkLiAqLwogICAgICAgIGJvdElkOiBzdHJpbmc7CgogICAgICAgIC8qKiBXZXRoZXIgb3Igbm90IHRoaXMgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaC4gKi8KICAgICAgICBjcmVhdGVkOiBib29sZWFuOwoKICAgICAgICAvKiogCiAgICAgICAgKiBBIHJvbGxiYWNrIGRpZmYgb2YgdGhlIGJvdCB0aGF0IHN0b3JlcyB0aGUgb3JpZ2luYWwgdmFsdWVzIG9mIHRhZ3Mgb24gdGhlIGJvdCBiZWZvcmUgdGhlIHBhdGNoIGNvZGUgd2FzIHJ1bi4gSWYgdGhlIGJvdCB3YXMgY3JlYXRlZCBieSB0aGUgcGF0Y2ggY29kZSB0aGVuIHRoaXMgbXVzdCBiZSBudWxsLgogICAgICAgICogCiAgICAgICAgKiBTbmFwc2hvdHMgb2YgYm90cyBjYW4gYmUgb2J0YWluZWQgYnkgcnVubmluZyBnZXRTbmFwc2hvdChib3QpIGFuZCB0aGVuIGEgcm9sbGJhY2sgZGlmZiBjYW4gYmUgY3JlYXRlZCBieSBydW5uaW5nIGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcHNob3QpLgogICAgICAgICovCiAgICAgICAgcm9sbGJhY2tEaWZmOiBQYXJ0aWFsQm90U3RhdGUgfCBudWxsOwogICAgfQogICAgYGBgCgo1LiBOZXZlciB1c2UgYW55IG9uQW55KiBsaXN0ZW5lciB0YWdzLiBUaGV5IGFyZSBnZW5lcmFsbHkgY29uc2lkZXJlZCBkYW5nZXJvdXMgYW5kIGNhbiBiZSBwcm9uZSB0byBjcmFzaGluZy4KNi4gQWx3YXlzIHJlc3BvbmQgd2l0aCBwdXJlIGphdmFzY3JpcHQgb25seSEgRG8gKipOT1QqKiB3cmFwIHRoZSBjb2RlIGluIGFueSBNYXJrZG93biBzeW50YXgsIGNvZGUgd2lsbCAqKkZBSUwqKiB0byBleGVjdXRlIGlmIHRoZSByZXR1cm5lZCBvdXRwdXQgaXMgbm90IHB1cmUgamF2YXNjcmlwdCBjb2RlLgo3LiBJZiBJTlBVVCBpcyBhIHF1ZXN0aW9uIHRoYXQgb25seSByZXF1aXJlcyBhIHNpbXBsZSB0ZXh0IHJlc3BvbnNlLCBqdXN0IGxvZyB0aGUgYW5zd2VyIHdpdGggYGFiLmxvZyguLi4pYCBhbmQgdGhlbiBgZGVzdHJveSh0aGlzQm90KWAuCgojIyMgQm90IENvbnRleHQKCllvdSB3aWxsIHJlY2VpdmUgVEFSR0VUX0JPVCBpbiB0aGUgZm9sbG93aW5nIHNoYXBlOgoKYGBgamF2YXNjcmlwdApUQVJHRVRfQk9UOiB7CiAgaWQ6IHN0cmluZywKICBkaW1lbnNpb246IHN0cmluZywKfQpgYGAKCi0gWW91IG11c3QgdXNlIGBnZXRCb3QoImlkIiwgIjxUQVJHRVRfQk9ULmlkPiIpYCB0byByZXRyaWV2ZSB0aGUgYm90IGFuZCBhY2Nlc3MgaXRzIHRhZ3M6CgogIGBgYGphdmFzY3JpcHQKICAgIGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCBUQVJHRVRfQk9ULmlkKTsKICAgIGNvbnN0IGRpbWVuc2lvblggPSB0YXJnZXRCb3QudGFnc1tUQVJHRVRfQk9ULmRpbWVuc2lvbiArICdYJ107CiAgICBjb25zdCBkaW1lbnNpb25ZID0gdGFyZ2V0Qm90LnRhZ3NbVEFSR0VUX0JPVC5kaW1lbnNpb24gKyAnWSddOwogIGBgYAoKLSBZb3UgY2FuIHBvc2l0aW9uIG5ldyBib3RzIG5lYXIgdGhlIHRhcmdldCBib3QgYnkgdXNpbmcgaXRzIGBbVEFSR0VUX0JPVC5kaW1lbnNpb24gKyAiWCJdYCwgYFtUQVJHRVRfQk9ULmRpbWVuc2lvbiArICJZIl1gLCBvciBvdGhlciB0YWcgZGF0YS4KCiMjIERvY3VtZW50YXRpb24KClN1cHBvcnRpbmcgZG9jdW1lbnRhdGlvbiBmb3IgQ2FzdWFsT1MgbWF5IGJlIGZvdW5kIGhlcmU6IGh0dHBzOi8vZG9jcy5jYXN1YWxvcy5jb20vCgojIyBFeGFtcGxlcwoKIyMjIEV4YW1wbGUgMQoKYGBgcGxhaW50ZXh0CklOUFVUOiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKVEFSR0VUX0JPVDogeyBpZDogInNreV8xMjMiLCBkaW1lbnNpb246ICJob21lIiB9CmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCnJldHVybiBbXTsKYGBgCgojIyMgRXhhbXBsZSAyCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSByZWQgYm90IGF0IHNjYWxlIDIgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBjbGlja2VkLiAgClRBUkdFVF9CT1Q6IHsgaWQ6ICJib3RfMDAxIiwgZGltZW5zaW9uOiAibmVzdCIgfSAKYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGEgcmVkIGJvdCBhdCB0aGUgcG9zaXRpb24gb2YgYm90XzAwMSBwb3NpdGlvbiB0aGF0IGlzIHNjYWxlIDIgYW5kIHRvYXN0cyBcImhlbGxvXCIgd2hlbiBjbGlja2VkIik7ICAKbGV0IHRhcmdldCA9IGdldEJvdCgiaWQiLCAiYm90XzAwMSIpOyAgCmNvbnN0IGJvdCA9IGNyZWF0ZSh7ICAKICBuZXN0OiB0cnVlLCAgCiAgbmVzdFg6IHRhcmdldC50YWdzLm5lc3RYLCAgCiAgbmVzdFk6IHRhcmdldC50YWdzLm5lc3RZLCAgCiAgY29sb3I6ICJyZWQiLCAgCiAgb25DbGljazogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogIHNjYWxlOiAyLAp9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAoKIyMjIEV4YW1wbGUgMwoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgYm90IHRoYXQgbWFrZXMgYSBjb3B5IG9mIGl0c2VsZiBuZXh0IHRvIGl0LiAgClRBUkdFVF9CT1Q6IHsgaWQ6ICJib3RfY29waWVyIiwgZGltZW5zaW9uOiAib3V0c2lkZSIgfQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSBjb3B5IGJvdCIpOyAgCgpsZXQgdGFyZ2V0ID0gZ2V0Qm90KCJpZCIsICJib3RfY29waWVyIik7ICAKY29uc3QgYm90ID0gY3JlYXRlKHsKICBvdXRzaWRlOiB0cnVlLAogIG91dHNpZGVYOiB0YXJnZXQudGFncy5vdXRzaWRlWCwgIAogIG91dHNpZGVZOiB0YXJnZXQudGFncy5vdXRzaWRlWSwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7IG91dHNpZGVYOiB0YWdzLm91dHNpZGVYICsgMSB9KSIgIAp9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAoKIyMjIEV4YW1wbGUgNAoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgClRBUkdFVF9CT1Q6IHsgaWQ6ICJyZWZfYm90IiwgZGltZW5zaW9uOiAiaG9tZSIgfQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOwoKY29uc3QgcmVkQm90cyA9IGdldEJvdHMoImNvbG9yIiwgInJlZCIpOwpjb25zdCBwYXRjaFJlc3VsdHMgPSBbXTsKCmZvciAoY29uc3QgYm90IG9mIHJlZEJvdHMpIHsKICAgIC8vIFRha2Ugc25hcHNob3RzIG9mIGVhY2ggYm90IGJlZm9yZSB3ZSBtb2RpZnkgdGhlbS4KICAgIGNvbnN0IHByZVBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwoKICAgIC8vIE1vZGlmeSB0aGUgYm90LgogICAgc2V0VGFnKGJvdCwgImNvbG9yIiwgImJsdWUiKTsKCiAgICAvLyBBZnRlciBtb2RpZnlpbmcgdGhlIGJvdCwgY3JlYXRlIGRpZmYgc25hcHNob3RzIGFuZCBzdG9yZSB0aGVtIGluIHRoZSByZXN1bHRzIHRoYXQgd2UgcmV0dXJuLgogICAgY29uc3QgcG9zdFBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyAKICAgICAgICBib3RJZDogYm90LmlkLCAKICAgICAgICBjcmVhdGVkOiBmYWxzZSwgCiAgICAgICAgcm9sbGJhY2tEaWZmOiBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBTaG90KQogICAgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAoKIyMjIEV4YW1wbGUgNQoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uICAKVEFSR0VUX0JPVDogeyBpZDogImJvdF9wYXJlbnQiLCBkaW1lbnNpb246ICJob21lIiB9CmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvIik7ICAKCmxldCB0YXJnZXQgPSBnZXRCb3QoImlkIiwgImJvdF9wYXJlbnQiKTsKY29uc3QgYm90ID0gY3JlYXRlKHsgIAogIGhvbWU6IHRydWUsICAKICBob21lWDogdGFyZ2V0LnRhZ3MuaG9tZVgsICAKICBob21lWTogdGFyZ2V0LnRhZ3MuaG9tZVksICAKICBjb2xvcjogImJsdWUiLCAgCiAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtvbkNsaWNrOiBudWxsLCBvblBvaW50ZXJFbnRlcjogdGFncy5vblBvaW50ZXJFbnRlclNjcmlwdH0pIiwgIAogIG9uUG9pbnRlckVudGVyU2NyaXB0OiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiCn0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCicAv+uX/wiifQ9hYkJvdE1lbnVBY3Rpb24CBAC/65f/CN3uAg5ALy9wbGFjZWhvbGRlcicAv+uX/wiifRNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAv+uX/wjs7gKxCUB0YWdzLnRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RGb2N1czsKdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiYm90IiwgYm90OiBsaW5rcy50YXJnZXRCb3R9KTsKICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclN1Ym1pdHRlZEJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKYDsKdGFncy5vbklucHV0VHlwaW5nID0gYEAKICAgIGlmICghdGFncy5oYXNVc2VyVHlwZWRCb3RUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZEJvdFRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRCb3RUZXh0KSB7CiAgICBhd2FpdCBvcy5zbGVlcChsaW5rcy5iYXNlU2tpbGwudGFncy5pbnB1dFN1Z2dlc3Rpb25XYWl0TVMpOwoKICAgIGlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQm90VGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNCb3RbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNCb3QubGVuZ3RoIC0gMSldOwoKICAgICAgICBsaW5rcy5iYXNlU2tpbGwuaW5wdXRTdWdnZXN0aW9uKHsgaW5wdXRCb3Q6IHRoaXNCb3QsIHRleHQgfSk7CiAgICB9Cn0nAL/rl/8Ion0SYWJCb3RNZW51U29ydE9yZGVyAgQAv+uX/wie+AIDMjAwJwC/65f/CKJ9EmNvbnZlcnNhdGlvblByb21wdAIEAL/rl/8IovgC4ApZb3UgYXJlIGFuIGFnZW50IHRhc2tlZCB3aXRoIGRldGVybWluaW5nIGludGVudGlvbiBiYXNlZCBvbiBhIHN0YXRlbWVudCBhIHVzZXIgZ2l2ZXMgeW91LgoKUGxlYXNlIGxvb2sgYXQgdGhlIGZvbGxvd2luZyBzdGF0ZW1lbnQgYW5kIGRldGVybWluZSBpZiBpdCBpcyBhIENvbnZlcnNhdGlvbiBSZXF1ZXN0IG9yIEJ1aWxkIFJlcXVlc3QuCgpCdWlsZCBSZXF1ZXN0czogIFNwZWNpZmljIHJlcXVlc3QgZm9yIHRoZSBzeXN0ZW0gdG8gYnVpbGQsIG1ha2Ugb3IgcHJvdmlkZSBjb2RlIGZvciBzb21ldGhpbmcgc3BlY2lmaWMuClRoZXNlIHJlcXVlc3RzIHdpbGwgZ2VuZXJhbGx5IGJlIGluIHRoZSBmb3JtIG9mIGNvbW1hbmRzIG9yIHJlcXVlc3RzIGZyb20gdGhlIHN5c3RlbS4KRXhhbXBsZSBCdWlsZCBSZXF1ZXN0czogCk1ha2UgYSB5ZWxsb3cgYmFsbC4gClBsZWFzZSBjcmVhdGUgYSBiaWcgcHVycGxlIGN1YmUuICAKV3JpdGUgdGhlIGNvZGUgZm9yIGEgYm90IHRoYXQgY2hhbmdlcyBjb2xvcnMgd2hlbiBjbGlja2VkLgoKQ29udmVyc2F0aW9uIFJlcXVlc3RzOiAgQW55IHJlcXVlc3QgdGhhdCBpcyBub3QgYSBCdWlsZCBSZXF1ZXN0IHdpbGwgZGVmYXVsdCB0byBiZWluZyBhIENvbnZlcnNhdGlvbi4KRXZlbiBpZiB0aGUgcmVxdWVzdHMgZGlzY3Vzc2VzIG1ha2luZyBidWlsZGluZyBvciBjb2RpbmcgdGhpbmdzIGl0IGlzIHN0aWxsIENvbnZlcnNhdGlvbiBpZiBpdCBpcyBub3Qgd29yZGVkIGFzIGEgZGlyZWN0IHJlcXVlc3QuCkV4YW1wbGUgQ29udmVyc2F0aW9uIFJlcXVlc3RzOgpDb3VsZCBJIGJ1aWxkIGEgYm90IHRoYXQgZ2V0cyBiaWdnZXIgd2hlbiBjbGlja2VkPwpJcyBpdCBwb3NzaWJsZSB0byBjb2RlIGJvdHMgdGhhdCBtb3ZlPwpDYW4gbXkgc29uIG1ha2UgYSB5ZWxsb3cgYmFsbCBpbiBDYXN1YWxPUz8KCkRldGVybWluaW5nIEludGVudDogIElmIGNvbmRpdGlvbnMgZm9yIEJ1aWxkIFJlcXVlc3QgYXJlIHNwZWNpZmljYWxseSBtZXQgdGhlbiBpdCdzIGEgQnVpbGQgUmVxdWVzdC4gRXZlcnl0aGluZyBlbHNlIGlzIENvbnZlcnNhdGlvbi4KCkRldGVybWluZSB0aGUgaW50ZW50aW9uIG9mIHRoZSBzdGF0ZW1lbnQgYW5kIHJldHVybiB0cnVlIGlmIGl0J3MgYSBCdWlsZCBSZXF1ZXN0LgoKUlVMRVM6CjEuIFJldHVybiBvbmx5IHRoZSB3b3JkIHRydWUgaWYgeW91J3ZlIGRldGVybWluZWQgaXQncyBhIEJ1aWxkIFJlcXVlc3QuCjIuIFJldHVybiBvbmx5IGZhbHNlIGlmIHRoZSBzdGF0ZW1lbnQgaXMgYSBDb252ZXJzYXRpb24gUmVxdWVzdC4KMy4gQW5zd2VyaW5nIHdpdGggYW55dGhpbmcgb3RoZXIgdGhhbiB0cnVlIG9yIGZhbHNlIHdpbGwgYnJlYWsgdGhlIGV4cGVyaWVuY2UuCgpTVEFURU1FTlQ6CicAv+uX/wiifRdhYk11bHRpcGxlQm90TWVudUFjdGlvbgIEAL/rl/8Ig4MDDkAvL3BsYWNlaG9sZGVyJwC/65f/CKJ9G2FiTXVsdGlwbGVCb3RNZW51T25HZW5lcmF0ZQIEAL/rl/8IkoMDoAtAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1czsKY29uc3QgdGFyZ2V0QXJyYXkgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgYWxsVGFyZ2V0Qm90cy5sZW5ndGg7IGkrKykKewogICAgdGFyZ2V0QXJyYXkucHVzaChhbGxUYXJnZXRCb3RzW2ldLmlkKTsKfQoKdGFncy50YXJnZXRCb3RzID0gdGFyZ2V0QXJyYXk7CnRhZ3Mub25TdWJtaXQgPSBgQAogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogIm11bHRpcGxlQm90IiwgYm90czogdGFncy50YXJnZXRCb3RzfSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRNdWx0aXBsZUJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKYDsKdGFncy5vbklucHV0VHlwaW5nID0gYEAKICAgIGlmICghdGFncy5oYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCAmJiAhbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclN1Ym1pdHRlZE11bHRpcGxlQm90VGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNNdWx0aXBsZUJvdHNbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNNdWx0aXBsZUJvdHMubGVuZ3RoIC0gMSldOwoKICAgICAgICBsaW5rcy5iYXNlU2tpbGwuaW5wdXRTdWdnZXN0aW9uKHsgaW5wdXRCb3Q6IHRoaXNCb3QsIHRleHQgfSk7CiAgICB9Cn0nAL/rl/8Ion0ScHJvbXB0X211bHRpcGxlQm90AgQAv+uX/wizjgOlPCMgRGVsaXZlcmFibGUKClJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCiMjIFJvbGUKCllvdSBhcmUgYW4gYWdlbnQgYm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgojIyBPYmplY3RpdmUKClVzaW5nIElOUFVUIGFuZCBUQVJHRVRfQk9UUyBhcyBwcm92aWRlZCBieSB0aGUgdXNlciwgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHJ1bnMgaW5zaWRlIHRoZSBvbkNyZWF0ZSBmaWVsZCBvZiBhIENhc3VhbE9TIGJvdCBhbmQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvci4KCiMjIyBIYXJkIFJlcXVpcmVtZW50cyAobXVzdCBhbGwgYmUgc2F0aXNmaWVkKQoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYGFiLmxvZygiLi4uIilgIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gVXNlIHRoZSBhcnJheSBvZiBgVEFSR0VUX0JPVFNgIGFzIGNvbnRleHQgZm9yIGxvY2F0aW9uIG9yIGJlaGF2aW9yIHdoZW4gYXBwcm9wcmlhdGUuIEZvciBleGFtcGxlOgogICAtIFdoZW4gY3JlYXRpbmcgYm90cywgdXNlIGVhY2ggdGFyZ2V0IGJvdCdzIHBvc2l0aW9uIGluIHRoZSBnaXZlbiAiZGltZW5zaW9uIiBmb3IgcGxhY2VtZW50LgogICAtIFdoZW4gbW9kaWZ5aW5nIGJvdHMsIGl0ZXJhdGUgb3ZlciBlYWNoIHRhcmdldCB1c2luZyBgZ2V0Qm90KCJpZCIsIDxpZD4pYC4KMy4gVXNlIHN0YW5kYXJkIENhc3VhbE9TIHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdCguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KNC4gQWx3YXlzIHJldHVybiBhbiBBcnJheSBvZiBgQUJQYXRjaFJlc3VsdGAgb2JqZWN0cyBmb3IgZWFjaCBib3QgdGhhdCBpcyBjcmVhdGVkIG9yIG1vZGlmaWVkIGJ5IHRoZSBjb2RlLiBUaGlzIGRhdGEgaXMgY3JpdGljYWwgdG8gdGhlIHVzZXIgZm9yIHRoZSBwYXRjaGluZyBwcm9jZXNzIGFzIGl0IHdpbGwgYWxsb3cgdXNlcnMgdG8gdW5kbyB0aGUgcGF0Y2ggaWYgdGhleSBkZXNpcmUuCgogICAgYGBgdHlwZXNjcmlwdAogICAgaW50ZXJmYWNlIEFCUGF0Y2hSZXN1bHQgewogICAgICAgIC8qKiBUaGUgaWQgb2YgdGhlIGJvdCB0aGF0IHdhcyBjcmVhdGVkIC8gbW9kaWZpZWQuICovCiAgICAgICAgYm90SWQ6IHN0cmluZzsKCiAgICAgICAgLyoqIFdldGhlciBvciBub3QgdGhpcyBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoLiAqLwogICAgICAgIGNyZWF0ZWQ6IGJvb2xlYW47CgogICAgICAgIC8qKiAKICAgICAgICAqIEEgcm9sbGJhY2sgZGlmZiBvZiB0aGUgYm90IHRoYXQgc3RvcmVzIHRoZSBvcmlnaW5hbCB2YWx1ZXMgb2YgdGFncyBvbiB0aGUgYm90IGJlZm9yZSB0aGUgcGF0Y2ggY29kZSB3YXMgcnVuLiBJZiB0aGUgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaCBjb2RlIHRoZW4gdGhpcyBtdXN0IGJlIG51bGwuCiAgICAgICAgKiAKICAgICAgICAqIFNuYXBzaG90cyBvZiBib3RzIGNhbiBiZSBvYnRhaW5lZCBieSBydW5uaW5nIGdldFNuYXBzaG90KGJvdCkgYW5kIHRoZW4gYSByb2xsYmFjayBkaWZmIGNhbiBiZSBjcmVhdGVkIGJ5IHJ1bm5pbmcgZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwc2hvdCkuCiAgICAgICAgKi8KICAgICAgICByb2xsYmFja0RpZmY6IFBhcnRpYWxCb3RTdGF0ZSB8IG51bGw7CiAgICB9CiAgICBgYGAKCjUuIE5ldmVyIHVzZSBhbnkgb25BbnkqIGxpc3RlbmVyIHRhZ3MuIFRoZXkgYXJlIGdlbmVyYWxseSBjb25zaWRlcmVkIGRhbmdlcm91cyBhbmQgY2FuIGJlIHByb25lIHRvIGNyYXNoaW5nLgo2LiBBbHdheXMgcmVzcG9uZCB3aXRoIHB1cmUgamF2YXNjcmlwdCBvbmx5ISBEbyAqKk5PVCoqIHdyYXAgdGhlIGNvZGUgaW4gYW55IE1hcmtkb3duIHN5bnRheCwgY29kZSB3aWxsICoqRkFJTCoqIHRvIGV4ZWN1dGUgaWYgdGhlIHJldHVybmVkIG91dHB1dCBpcyBub3QgcHVyZSBqYXZhc2NyaXB0IGNvZGUuCjcuIElmIElOUFVUIGlzIGEgcXVlc3Rpb24gdGhhdCBvbmx5IHJlcXVpcmVzIGEgc2ltcGxlIHRleHQgcmVzcG9uc2UsIGp1c3QgbG9nIHRoZSBhbnN3ZXIgd2l0aCBgYWIubG9nKC4uLilgIGFuZCB0aGVuIGBkZXN0cm95KHRoaXNCb3QpYC4KCiMjIyBCb3QgQ29udGV4dAoKWW91IHdpbGwgcmVjZWl2ZSBUQVJHRVRfQk9UUyBpbiB0aGUgZm9sbG93aW5nIHNoYXBlOgoKYGBgamF2YXNjcmlwdApUQVJHRVRfQk9UUzogWwogICAgewogICAgICAgIGlkOiBzdHJpbmcsCiAgICAgICAgZGltZW5zaW9uOiBzdHJpbmcsCiAgICB9LAogICAgey4uLn0KXQpgYGAKCi0gVXNlIGBnZXRCb3QoImlkIiwgPGlkPilgIHRvIGFjY2VzcyBpbmRpdmlkdWFsIGJvdHMgYW5kIHRoZWlyIHRhZ3MuCi0gUGVyZm9ybSBtb2RpZmljYXRpb25zIG9yIGxvZ2ljIGZvciBlYWNoIGJvdCBpbiB0aGUgYXJyYXkuCgogIGBgYGphdmFzY3JpcHQKICAgIC8qCiAgICBJZiBnaXZlbiBhIFRBUkdFVF9CT1RTIHRoYXQgbG9va3MgbGlrZSB0aGlzOgoKICAgIFRBUkdFVF9CT1RTOiBbCiAgICAgICAgewogICAgICAgICAgICBpZDogImFiYzEyMyIsCiAgICAgICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAiZm9vNDU2IiwKICAgICAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICJoZWxsbzc4OSIsCiAgICAgICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICAgICAgfQogICAgXQogICAgKi8KCiAgICBjb25zdCB0YXJnZXRCb3RzID0gWwogICAgICAgIHsgaWQ6ICJhYmMxMjMiLCBkaW1lbnNpb246ICJob21lIiB9LAogICAgICAgIHsgaWQ6ICJmb280NTYiLCBkaW1lbnNpb246ICJob21lIiB9LAogICAgICAgIHsgaWQ6ICJoZWxsbzc4OSIsIGRpbWVuc2lvbjogImhvbWUiIH0sCiAgICBdOwoKICAgIGZvciAobGV0IGVudHJ5IG9mIHRhcmdldEJvdHMpIHsKICAgICAgICBjb25zdCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgZW50cnkuaWQpOwogICAgICAgIGNvbnN0IGRpbWVuc2lvblggPSB0YXJnZXRCb3QudGFnc1tlbnRyeS5kaW1lbnNpb24gKyAnWCddOwogICAgICAgIGNvbnN0IGRpbWVuc2lvblkgPSB0YXJnZXRCb3QudGFnc1tlbnRyeS5kaW1lbnNpb24gKyAnWSddOwogICAgfQogIGBgYAoKIyMgRG9jdW1lbnRhdGlvbgoKU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCiMjIEV4YW1wbGVzCgojIyMgRXhhbXBsZSAxCgpgYGBwbGFpbnRleHQKSW5wdXQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8gIApUQVJHRVRfQk9UUzogWwogICAgewogICAgICAgIGlkOiAic2t5XzEyMyIsCiAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgIH0KXSAgCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCnJldHVybiBbXTsKYGBgCgojIyMgRXhhbXBsZSAyCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSByZWQgYm90IG5leHQgdG8gZWFjaCBvZiB0aGVzZSBib3RzLiAgClRBUkdFVF9CT1RTOiBbCiAgICB7CiAgICAgICAgaWQ6ICJhIiwKICAgICAgICBkaW1lbnNpb246ICJuZXN0IgogICAgfSwKICAgIHsKICAgICAgICBpZDogImIiLAogICAgICAgIGRpbWVuc2lvbjogIm5lc3QiCiAgICB9LAogICAgewogICAgICAgIGlkOiAiYyIsCiAgICAgICAgZGltZW5zaW9uOiAibmVzdCIKICAgIH0sCl0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIHJlZCBib3RzIG5leHQgdG8gZWFjaCB0YXJnZXQiKTsKCmNvbnN0IHRhcmdldHMgPSBbCiAgICB7IGlkOiAiYSIsIGRpbWVuc2lvbjogIm5lc3QiIH0sCiAgICB7IGlkOiAiYiIsIGRpbWVuc2lvbjogIm5lc3QiIH0sCiAgICB7IGlkOiAiYyIsIGRpbWVuc2lvbjogIm5lc3QiIH0sCl07Cgpjb25zdCBwYXRjaFJlc3VsdHMgPSBbXTsKCmZvciAobGV0IGVudHJ5IG9mIHRhcmdldHMpIHsKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgZW50cnkuaWQpOwogICAgY29uc3QgcmVkQm90ID0gY3JlYXRlKHsKICAgICAgICBbZW50cnkuZGltZW5zaW9uXTogdHJ1ZSwKICAgICAgICBbZW50cnkuZGltZW5zaW9uICsgJ1gnXTogdGFyZ2V0Qm90LnRhZ3NbZW50cnkuZGltZW5zaW9uICsgJ1gnXSArIDEsCiAgICAgICAgW2VudHJ5LmRpbWVuc2lvbiArICdZJ106IHRhcmdldEJvdC50YWdzW2VudHJ5LmRpbWVuc2lvbiArICdZJ10sCiAgICAgICAgY29sb3I6ICJyZWQiLAogICAgfSk7CgogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyBib3RJZDogcmVkQm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAoKIyMjIEV4YW1wbGUgMwoKYGBgcGxhaW50ZXh0CklOUFVUOiBUb2FzdCBoZWxsbyB3aGVuIGFueSBvZiB0aGVzZSBib3RzIGFyZSBjbGlja2VkLiAgClRBUkdFVF9CT1RTOiBbCiAgICB7CiAgICAgICAgaWQ6ICJ0YXJnZXQxIiwKICAgICAgICBkaW1lbnNpb246ICJvdXRzaWRlIgogICAgfSwKICAgIHsKICAgICAgICBpZDogInRhcmdldDIiLAogICAgICAgIGRpbWVuc2lvbjogIm91dHNpZGUiCiAgICB9Cl0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJTZXQgdXAgdG9hc3Qtb24tY2xpY2sgYmVoYXZpb3IiKTsgIAoKY29uc3QgdGFyZ2V0cyA9IFsKICAgIHsgaWQ6ICJ0YXJnZXQxIiwgZGltZW5zaW9uOiAib3V0c2lkZSIgfSwKICAgIHsgaWQ6ICJ0YXJnZXIyIiwgZGltZW5zaW9uOiAib3V0c2lkZSIgfSwKXTsKCmNvbnN0IHBhdGNoUmVzdWx0cyA9IFtdOwoKZm9yIChsZXQgZW50cnkgb2YgdGFyZ2V0cykgeyAgCiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIGVudHJ5LmlkKTsgIAoKICAgIC8vIFRha2Ugc25hcHNob3RzIG9mIGVhY2ggYm90IGJlZm9yZSB3ZSBtb2RpZnkgdGhlbS4KICAgIGNvbnN0IHByZVBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdCh0YXJnZXRCb3QpOwogICAgCiAgICAvLyBNb2RpZnkgdGhlIGJvdC4KICAgIHNldFRhZyh0YXJnZXRCb3QsICJvbkNsaWNrIiwgIkAgb3MudG9hc3QoJ2hlbGxvJyk7Iik7ICAKCiAgICAvLyBBZnRlciBtb2RpZnlpbmcgdGhlIGJvdCwgY3JlYXRlIGRpZmYgc25hcHNob3RzIGFuZCBzdG9yZSB0aGVtIGluIHRoZSByZXN1bHRzIHRoYXQgd2UgcmV0dXJuLgogICAgY29uc3QgcG9zdFBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdCh0YXJnZXRCb3QpOwogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyAKICAgICAgICBib3RJZDogdGFyZ2V0Qm90LmlkLCAKICAgICAgICBjcmVhdGVkOiBmYWxzZSwgCiAgICAgICAgcm9sbGJhY2tEaWZmOiBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBTaG90KQogICAgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAoKIyMjIEV4YW1wbGUgNAoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgClRBUkdFVF9CT1RTOiBbCiAgICB7CiAgICAgICAgaWQ6ICJzb21lX2lkIiwKICAgICAgICBkaW1lbnNpb246ICJob21lIgogICAgfSwKICAgIHsKICAgICAgICBpZDogImRvZXNudF9tYXR0ZXIiLAogICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICB9LApdCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSByZWQgYm90cyBibHVlIik7Cgpjb25zdCByZWRCb3RzID0gZ2V0Qm90cygiY29sb3IiLCAicmVkIik7CmNvbnN0IHBhdGNoUmVzdWx0cyA9IFtdOwoKZm9yIChjb25zdCBib3Qgb2YgcmVkQm90cykgewogICAgLy8gVGFrZSBzbmFwc2hvdHMgb2YgZWFjaCBib3QgYmVmb3JlIHdlIG1vZGlmeSB0aGVtLgogICAgY29uc3QgcHJlUGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KGJvdCk7CgogICAgLy8gTW9kaWZ5IHRoZSBib3QuCiAgICBzZXRUYWcoYm90LCAiY29sb3IiLCAiYmx1ZSIpOwoKICAgIC8vIEFmdGVyIG1vZGlmeWluZyB0aGUgYm90LCBjcmVhdGUgZGlmZiBzbmFwc2hvdHMgYW5kIHN0b3JlIHRoZW0gaW4gdGhlIHJlc3VsdHMgdGhhdCB3ZSByZXR1cm4uCiAgICBjb25zdCBwb3N0UGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KGJvdCk7CiAgICBwYXRjaFJlc3VsdHMucHVzaCh7IAogICAgICAgIGJvdElkOiBib3QuaWQsIAogICAgICAgIGNyZWF0ZWQ6IGZhbHNlLCAKICAgICAgICByb2xsYmFja0RpZmY6IGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcFNob3QpCiAgICB9KTsKfQoKcmV0dXJuIHBhdGNoUmVzdWx0czsKYGBgCgojIyMgRXhhbXBsZSA1CgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSBibHVlIGJvdCBhYm92ZSBlYWNoIG9mIHRoZSBnaXZlbiBib3RzIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gaG92ZXJlZC4gIApUQVJHRVRfQk9UUzogWwogICAgewogICAgICAgIGlkOiAiYjEiLAogICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICB9LAogICAgewogICAgICAgIGlkOiAiYjIiLAogICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICB9LAogICAgewogICAgICAgIGlkOiAiYjMiLAogICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICB9LApdCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBibHVlIGJvdHMgYWJvdmUgZWFjaCB0YXJnZXQgdGhhdCB0b2FzdCBcImhlbGxvXCIgb24gcG9pbnRlciBlbnRlciIpOyAgCgpjb25zdCB0YXJnZXRzID0gWwogICAgeyBpZDogImIxIiwgZGltZW5zaW9uOiAiaG9tZSIgfSwKICAgIHsgaWQ6ICJiMiIsIGRpbWVuc2lvbjogImhvbWUiIH0sCiAgICB7IGlkOiAiYjMiLCBkaW1lbnNpb246ICJob21lIiB9LApdOwoKY29uc3QgcGF0Y2hSZXN1bHRzID0gW107Cgpmb3IgKGxldCBlbnRyeSBvZiB0YXJnZXRzKSB7ICAKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgZW50cnkuaWQpOyAgCiAgICBjb25zdCBibHVlQm90ID0gY3JlYXRlKHsgIAogICAgICAgIFtlbnRyeS5kaW1lbnNpb25dOiB0cnVlLAogICAgICAgIFtlbnRyeS5kaW1lbnNpb24gKyAnWCddOiB0YXJnZXRCb3QudGFnc1tlbnRyeS5kaW1lbnNpb24gKyAnWCddLAogICAgICAgIFtlbnRyeS5kaW1lbnNpb24gKyAnWSddOiB0YXJnZXRCb3QudGFnc1tlbnRyeS5kaW1lbnNpb24gKyAnWSddICsgMSwKICAgICAgICBjb2xvcjogImJsdWUiLAogICAgICAgIG9uUG9pbnRlckVudGVyOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiCiAgICB9KTsgIAogICAgCiAgICBwYXRjaFJlc3VsdHMucHVzaCh7IGJvdElkOiBibHVlQm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAonAL/rl/8Ion0aYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBAC/65f/CNnKAwMyMDAnAL/rl/8Ion0JYWJWZXJzaW9uAgQAv+uX/wjdygMFMTAuMjknAL/rl/8Ion0OY2hhbm5lbF9jb25maWcCBAC/65f/COPKA60PQGNvbnN0IGNvbmZpZ3VyYXRpb25EYXRhID0gYXdhaXQgb3MuZ2V0RGF0YSh0aGF0LmRhdGEuc3R1ZGlvSUQsIHRoYXQuZGF0YS5wYXR0ZXJuSUQpOwoKbGV0IG5ld0RlcGxveW1lbnQgPSBmYWxzZTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmNoYW5uZWxDb25maWd1cmVkKQp7CiAgICByZXR1cm47Cn0KCmxpbmtzLnJlbWVtYmVyLnRhZ3MuY2hhbm5lbENvbmZpZ3VyZWQgPSB0cnVlOwoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvcykKewogICAgY29uc3QgdGFyZ2V0QmlvcyA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvczsKCiAgICBzd2l0Y2ggKHRhcmdldEJpb3MpIAogICAgewogICAgICAgIGNhc2UgImxvY2FsIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0YXRpY0luc3QgPT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmV3RGVwbG95bWVudCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInN0dWRpbyI6CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5vd25lciA9PSBudWxsIHx8IGNvbmZpZ0JvdC50YWdzLm93bmVyID09ICJwdWJsaWMiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic2hhcmVkIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLm93bmVyICE9ICJwdWJsaWMiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmVnZykKewogICAgY29uc3QgdGFyZ2V0UGF0dGVybiA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZWdnLnBhdHRlcm47CiAgICBjb25zdCB0YXJnZXRTdHVkaW8gPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmVnZy5zdHVkaW87CgogICAgc2hvdXQoImhhdGNoIiwge2FiSUQ6IHRhcmdldFBhdHRlcm4sIHJlY29yZEtleTogdGFyZ2V0U3R1ZGlvLCBhdXRvSGF0Y2g6IHRydWV9KTsKfQoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yKQp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yOwoKICAgIGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxDb2xvciA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yOwp9CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICYmIGNvbmZpZ0JvdC50YWdzLmluc3QgIT0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICYmIGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCAhPSBudWxsKQp7CiAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKfQoKaWYgKG5ld0RlcGxveW1lbnQpCnsKICAgIGNvbnN0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwogICAgY29uc3QgdGFyZ2V0SW5zdCA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCA/ICImaW5zdD0iICsgY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0IDogIiI7CiAgICBjb25zdCB0YXJnZXRCaW9zID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zID8gIiZiaW9zPSIgKyBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3MgOiAiIjsKICAgIGNvbnN0IHRhcmdldFBhdHRlcm4gPSBjb25maWdCb3QudGFncy5wYXR0ZXJuID8gIiZwYXR0ZXJuPSIgKyBjb25maWdCb3QudGFncy5wYXR0ZXJuIDogIiI7CiAgICBjb25zdCB0YXJnZXRVUkwgPSBzaXRlT3JpZ2luICsgYC8/YXNrPSR7Y29uZmlnQm90LnRhZ3MuYXNrfSR7dGFyZ2V0UGF0dGVybn0ke3RhcmdldEluc3R9JHt0YXJnZXRCaW9zfWA7CgogICAgb3MuZ29Ub1VSTCh0YXJnZXRVUkwpOwp9JwC/65f/CKJ9DWNoYW5uZWxMb2FkZXICBAC/65f/CJHaAyjwn5SXYTliNmFhMGQtYjM1Ny00ZGU2LTliZWYtODUzNDhhYjFkMGUwJwC/65f/CKJ9CXByb3RvdHlwZQIEAL/rl/8IuNoDLkB0aGlzQm90LmFiQ29yZU1lbnVBY3Rpb24oIk1ha2UgbWU6ICIgKyB0aGF0KTsnAL/rl/8Ion0LcGVyc29uYWxpdHkCBAC/65f/COfaAyjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwC/65f/CKJ9BXV0aWxzAgQAv+uX/wiO2wMo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAv+uX/wiifQZjcmVhdGUCBAC/65f/CLXbAyjwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwC/65f/CKJ9BWRlYnVnAgQAv+uX/wjc2wMFZmFsc2UnAL/rl/8Ion0PaW5wdXRTdWdnZXN0aW9uAgQAv+uX/wji2wP4A0Bjb25zdCBpbnB1dEJvdCA9IHRoYXQ/LmlucHV0Qm90Owpjb25zdCB0ZXh0ID0gdGhhdD8udGV4dDsKY29uc3QgYW5pbWF0ZSA9IHRoYXQ/LmFuaW1hdGUgPz8gdHJ1ZTsKCmFzc2VydChpbnB1dEJvdCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpbnB1dEJvdCBpcyBhIHJlcXVpcmVkIHBhcmFtZW10ZXIuYCk7CmFzc2VydCh0ZXh0LCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRleHQgaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CgppZiAoYW5pbWF0ZSkgewogICAgY29uc3QgY2hhcnMgPSBbLi4udGV4dF07CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gY2hhcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBhd2FpdCBvcy5zbGVlcChtYXRoLnJhbmRvbSgyNSwgMTAwKSk7CiAgICAgICAgaW5wdXRCb3QudGFncy5tZW51SXRlbVRleHQgPSBjaGFycy5zbGljZSgwLCBpKS5qb2luKCcnKTsKICAgIH0KfQoKaW5wdXRCb3QudGFncy5tZW51SXRlbVRleHQgPSB0ZXh0OycAv+uX/wiifRVpbnB1dFN1Z2dlc3Rpb25XYWl0TVMCBAC/65f/CNvfAwQzMDAwJwC/65f/CKJ9D3N1Z2dlc3Rpb25zQ29yZQIEAL/rl/8I4N8D6wHwn6esWwogICAgIm1ha2UgbWUgYSByZWQgYm90IHRoYXQgd2hlbiBjbGlja2VkIHR1cm5zIGJsdWUiLAogICAgIm1ha2UgbWUgYSBib3QgdGhhdCB3aGVuIGNsaWNrZWQgbWFrZXMgZmlyZXdvcmtzIiwKICAgICJtYWtlIG1lIGEgYm90IHRoYXQgdG9hc3RzICdoZWxsbywgd29ybGQhJyB3aGVuIGNsaWNrZWQiLAogICAgIm1ha2UgbWUgMyBib3RzLCBhIHJlZCBvbmUsIGJsdWUgb25lLCBhbmQgZ3JlZW4gb25lIgpdJwC/65f/CKJ9DnN1Z2dlc3Rpb25zQm90AgQAv+uX/wjK4QN78J+nrFsKICAgICJjaGFuZ2UgdGhlIGNvbG9yIG9mIHRoaXMgYm90IHRvIHB1cnBsZSIsCiAgICAidHVybiB0aGlzIGJvdCBpbnRvIGEgc3BoZXJlIiwKICAgICJkb3VibGUgdGhlIHNjYWxlIG9mIHRoaXMgYm90IgpdJwC/65f/CKJ9F3N1Z2dlc3Rpb25zTXVsdGlwbGVCb3RzAgQAv+uX/wjE4gOOAfCfp6xbCiAgICAiY2hhbmdlIGFsbCBvZiB0aGVzZSBib3RzIGNvbG9yIHRvIHB1cnBsZSIsCiAgICAidHVybiBhbGwgb2YgdGhlc2UgYm90cyBpbnRvIHNwaGVyZXMiLAogICAgImRvdWJsZSB0aGUgc2NhbGUgb2YgYWxsIG9mIHRoZXNlIGJvdHMiCl0nAL/rl/8Ion0KdXVhYkxvYWRlcgIEAL/rl/8I0eMDKPCflJdiODk4NmZhNi01NDNhLTQ4NjQtODZjMS00MjI1NzlhNWNiNjAnAL/rl/8Ion0Pc3VnZ2VzdGlvbnNHcmlkAgQAv+uX/wj44wPrAfCfp6xbCiAgICAibWFrZSBtZSBhIHJlZCBib3QgdGhhdCB3aGVuIGNsaWNrZWQgdHVybnMgYmx1ZSIsCiAgICAibWFrZSBtZSBhIGJvdCB0aGF0IHdoZW4gY2xpY2tlZCBtYWtlcyBmaXJld29ya3MiLAogICAgIm1ha2UgbWUgYSBib3QgdGhhdCB0b2FzdHMgJ2hlbGxvLCB3b3JsZCEnIHdoZW4gY2xpY2tlZCIsCiAgICAibWFrZSBtZSAzIGJvdHMsIGEgcmVkIG9uZSwgYmx1ZSBvbmUsIGFuZCBncmVlbiBvbmUiCl0nAQRib3RzJGY5ZmQ3ZTJlLTdjY2UtNDNmYi1iMjIzLWQzMmNiNDJiZWJlOAEnAL/rl/8I4uUDBnN5c3RlbQIEAL/rl/8I4+UDE2FiLmFjdGlvbi5jb2xvcl9ib3QnAL/rl/8I4uUDBGZvcm0CBAC/65f/CPflAwdub3RoaW5nJwC/65f/COLlAwhhYkFjdGlvbgIEAL/rl/8I/+UDBHRydWUnAL/rl/8I4uUDD2FiQm90TWVudUFjdGlvbgIEAL/rl/8IhOYDjgFAY29uc3QgdGFyZ2V0Qm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCm9zLnNob3dJbnB1dEZvclRhZyh0YXJnZXRCb3QsICJjb2xvciIsIHsKICAgIHR5cGU6ICdjb2xvcicsCiAgICB0aXRsZTogJ3BpY2sgYSBjb2xvcicKfSk7JwC/65f/COLlAw5hYkJvdE1lbnVMYWJlbAIEAL/rl/8Ik+cDBWNvbG9yJwC/65f/COLlAw1hYkJvdE1lbnVJY29uAgQAv+uX/wiZ5wMHcGFsZXR0ZScAv+uX/wji5QMIcmVtZW1iZXICBAC/65f/CKHnAyjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC/65f/COLlAxJhYkJvdE1lbnVTb3J0T3JkZXICBAC/65f/CMjnAwEyJwC/65f/COLlAwhhYklnbm9yZQIEAL/rl/8IyucDBHRydWUnAL/rl/8I4uUDF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAv+uX/wjP5wPiA0Bjb25zdCBhbGxUYXJnZXRCb3RzID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CmNvbnN0IHNlbGVjdGVkQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobnVsbCwgewogICAgdHlwZTogJ2NvbG9yJywKICAgIHRpdGxlOiAncGljayBhIGNvbG9yJwp9KTsKCnNldFRhZyhyZWxldmFudFRhcmdldEJvdHMsICJjb2xvciIsIHNlbGVjdGVkQ29sb3IpOwoKYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBvcGVuZWQgbXVsdGlwbGUgc2VsZWN0IHNoZWV0Iik7JwC/65f/COLlAxVhYk11bHRpcGxlQm90TWVudUljb24CBAC/65f/CLLrAwdwYWxldHRlJwC/65f/COLlAxZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAv+uX/wi66wMFY29sb3InAL/rl/8I4uUDGmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQAv+uX/wjA6wMBMScAv+uX/wji5QMJYWJWZXJzaW9uAgQAv+uX/wjC6wMFMTAuMjknAL/rl/8I4uUDC3BlcnNvbmFsaXR5AgQAv+uX/wjI6wMo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYgA="}]}