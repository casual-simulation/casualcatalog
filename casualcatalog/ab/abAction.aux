{"version":2,"updates":[{"id":0,"timestamp":1771885283413,"update":"Ae4CsauZyQEAJwEEYm90cyQ1ODQ5YWY1NS01ZThhLTQ4ZDYtOTEwNi0xOTk0OThlOWVjMDgBJwCxq5nJAQAGc3lzdGVtAgQAsauZyQEBEWFiLmFjdGlvbi5kZXN0cm95JwCxq5nJAQAIYWJBY3Rpb24CBACxq5nJARMEdHJ1ZScAsauZyQEABGZvcm0CBACxq5nJARgHbm90aGluZycAsauZyQEAD2FiQm90TWVudUFjdGlvbgIEALGrmckBIJEDQGNvbnN0IHRhcmdldEJvdCA9IHRoYXQuYm90LmxpbmtzLnRhcmdldEJvdDsKCmlmICh0aGF0LmJvdC5saW5rcy50YXJnZXRPcmlnaW5Cb3RzKSB7CiAgICAvLyBEZXN0cm95IGJvdHMgYmVsb25naW5nIHRvIGFiSURPcmlnaW4uCiAgICBkZXN0cm95KHRoYXQuYm90LmxpbmtzLnRhcmdldE9yaWdpbkJvdHMpOwp9IGVsc2UgewogICAgLy8gRGVzdHJveSB0aGUgc2luZ2xlIHRhcmdldCBib3QuCiAgICBkZXN0cm95KHRhcmdldEJvdCk7Cn0KCmFiLmxpbmtzLnNvdW5kLmFiUGxheVNvdW5kKHsgdmFsdWU6IGFiLmxpbmtzLnNvdW5kLnRhZ3MuZGVmYXVsdERlc3Ryb3lTb3VuZCB9KTsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsnALGrmckBAA5hYkJvdE1lbnVMYWJlbAIEALGrmckBsgMHZGVzdHJveScAsauZyQEADWFiQm90TWVudUljb24CBACxq5nJAboDDmRlbGV0ZV9mb3JldmVyJwCxq5nJAQASYWJCb3RNZW51U29ydE9yZGVyAgQAsauZyQHJAwMxMDAnALGrmckBAAhyZW1lbWJlcgIEALGrmckBzQMo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAsauZyQEADW1hbmlmZXN0YXRpb24CBACxq5nJAfQDKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnALGrmckBAAhhYklnbm9yZQIEALGrmckBmwQEdHJ1ZScAsauZyQEADmFiQm90TWVudUNvbG9yAgQAsauZyQGgBAcjRDkzMDMwJwCxq5nJAQAXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBACxq5nJAagEkQRAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgpkZXN0cm95KHJlbGV2YW50VGFyZ2V0Qm90cyk7CgphYi5saW5rcy5zb3VuZC5hYlBsYXlTb3VuZCh7IHZhbHVlOiBhYi5saW5rcy5zb3VuZC50YWdzLmRlZmF1bHREZXN0cm95U291bmQgfSk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7JwCxq5nJAQAVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAsauZyQG6CA5kZWxldGVfZm9yZXZlcicAsauZyQEAFmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBACxq5nJAckIB2Rlc3Ryb3knALGrmckBABphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEALGrmckB0QgDMTAwJwCxq5nJAQAWYWJNdWx0aXBsZUJvdE1lbnVDb2xvcgIEALGrmckB1QgHI0Q5MzAzMCcAsauZyQEACWFiVmVyc2lvbgIEALGrmckB3QgFMTAuNDInALGrmckBABNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAsauZyQHjCK0HQGNvbnN0IHRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgppZiAodGFyZ2V0Qm90KSB7CiAgICB0YWdzLmxhYmVsID0gJ2Rlc3Ryb3knOwogICAgdGFncy50YXJnZXRCb3QgPSBnZXRMaW5rKHRhcmdldEJvdCk7CiAgICB0YWdzLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygiU2hpZnQiKSkgewogICAgICAgICAgICBpZiAobGlua3MudGFyZ2V0Qm90ICYmIGxpbmtzLnRhcmdldEJvdC50YWdzLmFiSURPcmlnaW4pIHsKICAgICAgICAgICAgICAgIC8vIENoYW5nZSBidXR0b24gdG8gZGVzdHJveSBhbGwgYm90cyB3aXRoIHNhbWUgYWJJRE9yaWdpbi4KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE9yaWdpbkJvdHMgPSBnZXRCb3RzKGIgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnRhZ3MuYWJJRE9yaWdpbiA9PT0gbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbjsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbWFza3MubGFiZWwgPSAnZGVzdHJveSAnICsgbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbiArICcgKCcgKyB0YXJnZXRPcmlnaW5Cb3RzLmxlbmd0aCArICcgYm90cyknOwogICAgICAgICAgICAgICAgdGFncy50YXJnZXRPcmlnaW5Cb3RzID0gZ2V0TGluayh0YXJnZXRPcmlnaW5Cb3RzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGA7CiAgICB0YWdzLm9uS2V5VXAgPSBgQAogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoIlNoaWZ0IikpIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSBudWxsOwogICAgICAgICAgICB0YWdzLnRhcmdldE9yaWdpbkJvdHMgPSBudWxsOwogICAgICAgIH0KICAgIGA7Cn0gZWxzZSB7CiAgICAvLyBObyBib3QgdG8gZGVzdHJveS4KICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nALGrmckBABthYk11bHRpcGxlQm90TWVudU9uR2VuZXJhdGUCBACxq5nJAZEQ7wRAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgppZiAocmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aCA+IDEpIHsKICAgIC8vIE11bHRpcGxlIGJvdHMuCiAgICB0YWdzLmxhYmVsID0gYGRlc3Ryb3kgKCR7cmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aH0gYm90cylgOwp9IGVsc2UgaWYgKHJlbGV2YW50VGFyZ2V0Qm90cy5sZW5ndGggPT09IDEpIHsKICAgIC8vIFNpbmdsZSBib3QuCiAgICB0YWdzLmxhYmVsID0gYGRlc3Ryb3lgOwp9IGVsc2UgewogICAgLy8gTm8gYm90cyB0byBkZXN0cm95LgogICAgZGVzdHJveSh0aGlzQm90KTsKfScBBGJvdHMkNWFlYzUwMWMtMzM4YS00MmNjLTlmZGQtOWExZWVhOTUzYTA2AScAsauZyQGBFQZzeXN0ZW0CBACxq5nJAYIVEGFiLmFjdGlvbi51cGRhdGUnALGrmckBgRUIYWJBY3Rpb24CBACxq5nJAZMVBHRydWUnALGrmckBgRUQYWJDb3JlTWVudUFjdGlvbgIEALGrmckBmBXdBEBpZiAoIWFiVXBkYXRlQ2hlY2tlci50YWdzLmNoZWNraW5nKSB7CiAgICBpZiAoYWJVcGRhdGVDaGVja2VyLnRhZ3MudXBkYXRlQXZhaWxhYmxlKSB7CiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ0luc3RhbGwgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgdXBkYXRlcz8nLAogICAgICAgICAgICBjb250ZW50OiAnV291bGQgeW91IGxpa2UgdG8gaW5zdGFsbCB0aGUgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgdXBkYXRlcz8gWW91IGFuZCBhbnkgY29ubmVjdGVkIHVzZXJzIHdpbGwgYXV0b21hdGljYWxseSByZWZyZXNoIHRoZSBwYWdlIGFmdGVyIHRoZSB1cGRhdGUgaXMgY29tcGxldGUuJywKICAgICAgICAgICAgY2FuY2VsVGV4dDogJ05vdCBub3cnLAogICAgICAgICAgICBjb25maXJtVGV4dDogJ1llcycKICAgICAgICB9KQoKICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgIGFiLnVwZGF0ZUFCKCk7CiAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfQogICAgfQp9JwCxq5nJAYEVBGZvcm0CBACxq5nJAfYZB25vdGhpbmcnALGrmckBgRUIYWJJZ25vcmUCBACxq5nJAf4ZBHRydWUnALGrmckBgRUTYWJDb3JlTWVudVNvcnRPcmRlcgIEALGrmckBgxoDMTAyJwCxq5nJAYEVDmFiQ29yZU1lbnVJY29uAgQAsauZyQGHGgZ1cGRhdGUnALGrmckBgRUPYWJDb3JlTWVudUxhYmVsAgQAsauZyQGOGgZ1cGRhdGUnALGrmckBgRUUYWJDb3JlTWVudU9uR2VuZXJhdGUCBACxq5nJAZUa/A1AaWYgKCFnbG9iYWxUaGlzLmFiVXBkYXRlQ2hlY2tlcikgewogICAgZGVzdHJveSh0aGlzQm90KTsKICAgIHJldHVybjsKfQoKdGFncy5yZWZyZXNoRGlzcGxheSA9IGBACiAgICBpZiAodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpIHsKICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IG51bGw7CiAgICB9CgogICAgLy8gQ2xlYXIgdGFnIG1hc2tzLgogICAgbWFza3MuYWJNZW51ID0gbnVsbDsKICAgIG1hc2tzLmxhYmVsID0gbnVsbDsKICAgIG1hc2tzLmNvbG9yID0gbnVsbDsKICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gbnVsbDsKICAgIAogICAgaWYgKGFiVXBkYXRlQ2hlY2tlci50YWdzLnVwZGF0ZUF2YWlsYWJsZSkgewogICAgICAgIG1hc2tzLmxhYmVsID0gJ3VwZGF0ZSAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwogICAgICAgIG1hc2tzLmNvbG9yID0gJyNBNEREMDAnOwogICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gJ3VwZGF0ZSc7CiAgICB9IGVsc2UgewogICAgICAgIGlmIChhYlVwZGF0ZUNoZWNrZXIudGFncy5jaGVja2luZykgewogICAgICAgICAgICAvLyBUZW1wb3JhcmlseSByZXBsYWNlIHdpdGggYnVzeSBpbmRpY2F0b3Igd2hpbGUgY2hlY2tpbmcgZm9yIHVwZGF0ZXMuCiAgICAgICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gYWIubGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yKHsKICAgICAgICAgICAgICAgIGFiTWVudTogdHJ1ZSwKICAgICAgICAgICAgICAgIGxhYmVsOiAnY2hlY2tpbmcgZm9yIHVwZGF0ZXMgdG8gJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgICAgIGFiTWVudVNvcnRPcmRlcjogdGFncy5hYk1lbnVTb3J0T3JkZXIsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgbWFza3MuYWJNZW51ID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQUIgaXMgdXAtdG8tZGF0ZS4KICAgICAgICAgICAgbWFza3MuYWJNZW51ID0gZmFsc2U7CiAgICAgICAgfQogICAgfQpgOwoKdGFncy5vbkRlc3Ryb3kgPSBgQAogICAgaWYgKHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKSB7CiAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgdGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IgPSBudWxsOwogICAgfQoKICAgIGlmICh0aGlzQm90LnZhcnMub25BQlVwZGF0ZUNoZWNrZXJCb3RDaGFuZ2VkKSB7CiAgICAgICAgb3MucmVtb3ZlQm90TGlzdGVuZXIoYWJVcGRhdGVDaGVja2VyLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uQUJVcGRhdGVDaGVja2VyQm90Q2hhbmdlZCk7CiAgICB9CmAKCnRoaXNCb3QudmFycy5vbkFCVXBkYXRlQ2hlY2tlckJvdENoYW5nZWQgPSAobGlzdGVuZXJUaGF0KSA9PiB7CiAgICBjb25zdCBuZWVkUmVmcmVzaERpc3BsYXkgPSBsaXN0ZW5lclRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2NoZWNraW5nJyB8fCB0ID09PSAndXBkYXRlQXZhaWxhYmxlJyk7CiAgICBpZiAobmVlZFJlZnJlc2hEaXNwbGF5KSB7CiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgfQp9Cgpvcy5hZGRCb3RMaXN0ZW5lcihhYlVwZGF0ZUNoZWNrZXIsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25BQlVwZGF0ZUNoZWNrZXJCb3RDaGFuZ2VkKTsKCnRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsnALGrmckBgRUJYWJWZXJzaW9uAgQAsauZyQGSKAUxMC40MicBBGJvdHMkNmIzZDk3NDQtNDQ0OC00ZWY1LTk2YTItNzEyODFjNDJhZjZjAScAsauZyQGYKAlhYlZlcnNpb24CBACxq5nJAZkoBTEwLjQyJwCxq5nJAZgoBnN5c3RlbQIEALGrmckBnygRYWIuYWN0aW9uLnZlcnNpb24nALGrmckBmCgUYWJBY3Rpb25NYWpvclZlcnNpb24CBACxq5nJAbEoATInALGrmckBmCgNb25Ta2lsbFVwZGF0ZQIEALGrmckBsyiZAUBjb25zdCB2ZXJzaW9uU3RyaW5nID0gdGFncy5hYkFjdGlvbk1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJBY3Rpb25NaW5vclZlcnNpb247Cgpjb25zb2xlLmxvZygiW0FCQWN0aW9uXSBMb2FkZWQgQUIgQWN0aW9uIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAsauZyQGYKAhhYklnbm9yZQIEALGrmckBzSkEdHJ1ZScAsauZyQGYKAhhYkFjdGlvbgIEALGrmckB0ikEdHJ1ZScAsauZyQGYKARmb3JtAgQAsauZyQHXKQdub3RoaW5nJwCxq5nJAZgoFGFiQWN0aW9uTWlub3JWZXJzaW9uAgQAsauZyQHfKQE3JwEEYm90cyQ3MTc1NjQ1Yy00YjUzLTQ0NTQtODcxNi1mYzBlNjhkYjI2NjUBJwCxq5nJAeEpBnN5c3RlbQIEALGrmckB4ikPYWIuYWN0aW9uLmxvZ2luJwCxq5nJAeEpCGFiQWN0aW9uAgQAsauZyQHyKQR0cnVlJwCxq5nJAeEpCGFiSWdub3JlAgQAsauZyQH3KQR0cnVlJwCxq5nJAeEpBGZvcm0CBACxq5nJAfwpB25vdGhpbmcnALGrmckB4SkPYWJDb3JlTWVudUNvbG9yAgQAsauZyQGEKgcjRjJCNzA1JwCxq5nJAeEpE2FiQ29yZU1lbnVTb3J0T3JkZXICBACxq5nJAYwqAi01JwCxq5nJAeEpEGFiQ29yZU1lbnVBY3Rpb24CBACxq5nJAY8qG0Bhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOycAsauZyQHhKRRhYkNvcmVNZW51T25HZW5lcmF0ZQIEALGrmckBqyrrAUB0YWdzLmFiTWVudSA9IGZhbHNlOyAvLyBLZWVwIGJ1dHRvbiBoaWRkZW4gdW50aWwgYXV0aCBjaGVjayBpcyBjb21wbGV0ZS4KYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmIChhdXRoQm90KSB7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9IGVsc2UgewogICAgdGFncy5hYk1lbnUgPSB0cnVlOwogICAgdGFncy5vbkFCQXV0aEJvdEFkZGVkID0gYEBkZXN0cm95KHRoaXNCb3QpO2A7Cn0nALGrmckB4SkOYWJDb3JlTWVudUljb24CBACxq5nJAZcsBWxvZ2luJwCxq5nJAeEpCHJlbWVtYmVyAgQAsauZyQGdLCjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCxq5nJAeEpCWFiVmVyc2lvbgIEALGrmckBxCwFMTAuNDInALGrmckB4SkLcGVyc29uYWxpdHkCBACxq5nJAcosKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInALGrmckB4SkPYWJDb3JlTWVudUxhYmVsAgQAsauZyQHxLAdzaWduIGluJwCxq5nJAeEpDmFiQ29yZU1lbnVIaWRlAgQAsauZyQH5LAR0cnVlJwCxq5nJAeEpDm9uQW55Qm90c0FkZGVkAgQAsauZyQH+LP4CQGlmICh0aGF0LmJvdHMpIHsKICAgIGNvbnN0IGFkZGVkQXV0aEJvdCA9IHRoYXQuYm90cy5maW5kKGIgPT4gYiA9PT0gZ2xvYmFsVGhpcy5hdXRoQm90KTsKCiAgICBpZiAoYWRkZWRBdXRoQm90KSB7CiAgICAgICAgdGhpc0JvdC52YXJzLmF1dGhCb3RJZCA9IGFkZGVkQXV0aEJvdC5pZDsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhdXRoIGJvdCBhZGRlZC4gYXV0aEJvdCBpZDogJHt0aGlzQm90LnZhcnMuYXV0aEJvdElkfWApOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoJ29uQUJBdXRoQm90QWRkZWQnLCB7IGF1dGhCb3Q6IGFkZGVkQXV0aEJvdCB9KTsKICAgIH0KfScAsauZyQHhKQVkZWJ1ZwIEALGrmckB/S8FZmFsc2UnALGrmckB4SkQb25BbnlCb3RzUmVtb3ZlZAIEALGrmckBgzCjA0BpZiAodGhhdC5ib3RJRHMgJiYgdGhpc0JvdC52YXJzLmF1dGhCb3RJZCkgewogICAgY29uc3QgcmVtb3ZlZEF1dGhCb3RJZCA9IHRoYXQuYm90SURzLnNvbWUoaWQgPT4gaWQgPT09IHRoaXNCb3QudmFycy5hdXRoQm90SWQpOwoKICAgIGlmIChyZW1vdmVkQXV0aEJvdElkKSB7CiAgICAgICAgdGhpc0JvdC52YXJzLmF1dGhCb3RJZCA9IG51bGw7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXV0aCBib3QgcmVtb3ZlZC4gYXV0aEJvdCBpZDogJHtyZW1vdmVkQXV0aEJvdElkfWApOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoJ29uQUJBdXRoQm90UmVtb3ZlZCcsIHsgYXV0aEJvdElkOiByZW1vdmVkQXV0aEJvdElkIH0pOwogICAgfQp9JwEEYm90cyRiMzM5YzExOC00ODlhLTQ2NmItYmE5Zi1iMDdhNWY5YjY2NGYBJwCxq5nJAaczBnN5c3RlbQIEALGrmckBqDMPYWIuYWN0aW9uLnBhc3RlKACxq5nJAaczCGFiQWN0aW9uAXgnALGrmckBpzMEZm9ybQIEALGrmckBuTMHbm90aGluZycAsauZyQGnMwtkZXNjcmlwdGlvbgIEALGrmckBwTMrYWIgc2tpbGwgdXNlZCBmb3IgY29weWluZyBhbmQgcGFzdGluZyBib3RzLicAsauZyQGnMwdvblBhc3RlAgQAsauZyQHtM/8HQGlmICghYnVpbGRlclZlcnNpb24pCnsKICAgIHJldHVybjsKfQoKY29uc3QgTUFDUk9TID0gWwogICAgewogICAgICAgIHRlc3Q6IC8oPzpb4oCc4oCdXSkvZywKICAgICAgICByZXBsYWNlbWVudDogKHZhbCkgPT4gJyInLAogICAgfSwKICAgIHsKICAgICAgICB0ZXN0OiAvKD86W+KAmOKAmV0pL2csCiAgICAgICAgcmVwbGFjZW1lbnQ6ICh2YWwpID0+ICInIiwKICAgIH0sCl07CgpsZXQgZm9ybWF0dGVkQ29weSA9IHJlcGxhY2VNYWNyb3ModGhhdC50ZXh0KTsKbGV0IGNvcHlCb3QgPSBKU09OLnBhcnNlKGZvcm1hdHRlZENvcHkpOwpsZXQgcGFzdGVkRGF0YSA9ICFjb3B5Qm90LnN0YXRlID8ge1tjb3B5Qm90LmlkXTogY29weUJvdH0gOiBjb3B5Qm90LnN0YXRlOwpsZXQgZGltTW9kID0gbGlua3MucmVtZW1iZXIudGFncy5hYkZvY3VzRGF0YTsKCmlmIChPYmplY3Qua2V5cyhwYXN0ZWREYXRhKS5sZW5ndGggPT0gMSAmJiBkaW1Nb2QpCnsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgcGFzdGVkRGF0YVtkaW1Nb2QuZGltZW5zaW9uKyJYIl0gPSBkaW1Nb2QueDsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbisiWSJdID0gZGltTW9kLnk7CgogICAgb3MudG9hc3QoImJvdCBhZGRlZCB0byBpbnN0Iik7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgiYm90cyBhZGRlZCB0byBpbnN0Iik7Cn0KCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogcGFzdGVkIGRhdGEiKTsKCmxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IHBhc3RlZERhdGEsIHNvdXJjZUV2ZW50OiAncGFzdGUnfSk7CgpmdW5jdGlvbiByZXBsYWNlTWFjcm9zKHRleHQpIHsKICAgIGlmICghdGV4dCkgewogICAgICAgIHJldHVybiB0ZXh0OwogICAgfQoKICAgIGZvciAobGV0IG0gb2YgTUFDUk9TKSB7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShtLnRlc3QsIG0ucmVwbGFjZW1lbnQpOwogICAgfQoKICAgIHJldHVybiB0ZXh0Owp9JwCxq5nJAaczCHJlbWVtYmVyAgQAsauZyQHlOyjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCxq5nJAaczBmNyZWF0ZQIEALGrmckBjDwo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycAsauZyQGnMwhhYklnbm9yZQIEALGrmckBszwEdHJ1ZScAsauZyQGnMwlvbktleURvd24CBACxq5nJAbg8gwZAaWYgKCFidWlsZGVyVmVyc2lvbiB8fCAoIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMgJiYgIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cykpIHsKICAgIHJldHVybjsKfQoKaWYgKHRoYXQua2V5cyA9PSAiYyIpIHsKICAgIGxldCBtZXRhSW5wdXQgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJNZXRhIik7CgogICAgaWYgKCFtZXRhSW5wdXQpIHsKICAgICAgICBtZXRhSW5wdXQgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJDb250cm9sIik7CiAgICB9CgogICAgaWYgKCFtZXRhSW5wdXQpIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IHNlbGVjdGVkQm90cyA9IFtdOwoKICAgIGlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzKSB7CiAgICAgICAgc2VsZWN0ZWRCb3RzLnB1c2gobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cyk7CiAgICB9CiAgICBlbHNlIGlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmtzLnJlbWVtYmVyLmxpbmtzICAgIC5hYk11bHRpcGxlQm90Rm9jdXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc2VsZWN0ZWRCb3RzLnB1c2gobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzW2ldKTsKICAgICAgIH0KICAgIH0KIAogICAgdGhpc0JvdC5hYkNvcHlCb3RzVG9DbGlwYm9hcmQoeyBib3RzOiBzZWxlY3RlZEJvdHMgfSk7Cn0nALGrmckBpzMJYWJWZXJzaW9uAgQAsauZyQG8QgUxMC40MicAsauZyQGnMwtwZXJzb25hbGl0eQIEALGrmckBwkIo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAsauZyQGnMxVhYkNvcHlCb3RzVG9DbGlwYm9hcmQCBACxq5nJAelCkApAbGV0IGJvdHMgPSB0aGF0LmJvdHM7CmxldCBvblByZXByb2Nlc3NCZWZvcmVDb3B5ID0gdGhhdC5vblByZXByb2Nlc3NCZWZvcmVDb3B5OwpsZXQgc291cmNlRXZlbnQgPSB0aGF0LnNvdXJjZUV2ZW50OwoKbGV0IGJvdHNUb0NvcHkgPSBbXTsKCmlmIChBcnJheS5pc0FycmF5KGJvdHMpKSB7CiAgICBmb3IgKGNvbnN0IGJvdCBvZiBib3RzKSB7CiAgICAgICAgaWYgKGFiLmxpbmtzLnV0aWxzLmlzQm90KGJvdCkpIHsKICAgICAgICAgICAgYm90c1RvQ29weS5wdXNoKGJvdCk7CiAgICAgICAgfQogICAgfQp9IGVsc2UgewogICAgaWYgKGFiLmxpbmtzLnV0aWxzLmlzQm90KGJvdHMpKSB7CiAgICAgICAgYm90c1RvQ29weS5wdXNoKGJvdHMpOwogICAgfQp9CgppZiAoYm90c1RvQ29weS5sZW5ndGggPiAwKSB7CiAgICAvLyBMZXQgYWxsIGJvdHMga25vdyB0aGF0IGFiIGlzIGFib3V0IHRvIGNvcHkgc29tZSBib3RzLgogICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHNob3V0KCdvbkFCQmVmb3JlQ29weUJvdHNUb0NsaXBib2FyZCcsIHsgYm90czogYm90c1RvQ29weSwgc291cmNlRXZlbnQgfSkpOwogICAgCiAgICBjb25zdCBzdGF0ZSA9IHt9OwoKICAgIGZvciAoY29uc3QgYm90IG9mIGJvdHNUb0NvcHkpIHsKICAgICAgICBzdGF0ZVtib3QuaWRdID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShib3QpKTsKICAgIH0KCiAgICAvLyBEbyBhIHByZXByb2Nlc3NpbmcgcGFzcyB0aGF0IGFsbG93cyBsaXN0ZW5lcnMgdG8gcHJlcHJvY2VzcyB0aGUgYm90IGRhdGEgYmVmb3JlIGl0IGlzIGNvcGllZC4KICAgIGNvbnN0IHByZXByb2Nlc3NBcmcgPSB7IGJvdERhdGE6IHN0YXRlLCBzb3VyY2VFdmVudCB9OwoKICAgIGlmIChvblByZXByb2Nlc3NCZWZvcmVDb3B5KSB7CiAgICAgICAgYXdhaXQgb25QcmVwcm9jZXNzQmVmb3JlQ29weShwcmVwcm9jZXNzQXJnKTsKICAgIH0KCiAgICBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoc2hvdXQoJ29uQUJQcmVwcm9jZXNzQmVmb3JlQ29weUJvdHNUb0NsaXBib2FyZCcsIHByZXByb2Nlc3NBcmcpKTsKICAgIAogICAgLy8gU2VyaWFsaXplIHRvIHYxIGF1eCBmaWxlLCBhbmQgdGhlbiBjb3B5IHRvIGNsaXBib2FyZC4KICAgIGNvbnN0IGF1eCA9IEpTT04uc3RyaW5naWZ5KHsgdmVyc2lvbjogMSwgc3RhdGUgfSk7CiAgICBvcy5zZXRDbGlwYm9hcmQoYXV4KTsKCiAgICBhYi5saW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KGBjb3BpZWQgJHtib3RzVG9Db3B5Lmxlbmd0aCA+IDEgPyAnYm90cycgOiAnYm90J30gdG8gY2xpcGJvYXJkYCk7Cn0nAQRib3RzJGJkYWJkNmMwLTg5ZjktNGY3NS1iMzVjLTI2ZjRlYzUyMDdkNgEnALGrmckB+kwGc3lzdGVtAgQAsauZyQH7TBBhYi5hY3Rpb24ucmVwb3J0JwCxq5nJAfpMBGZvcm0CBACxq5nJAYxNB25vdGhpbmcnALGrmckB+kwQYWJDb3JlTWVudUFjdGlvbgIEALGrmckBlE0RQG9zLnJlcG9ydEluc3QoKTsnALGrmckB+kwTYWJDb3JlTWVudVNvcnRPcmRlcgIEALGrmckBpk0DMTAxJwCxq5nJAfpMDmFiQ29yZU1lbnVJY29uAgQAsauZyQGqTQRmbGFnJwCxq5nJAfpMD2FiQ29yZU1lbnVMYWJlbAIEALGrmckBr00GcmVwb3J0JwCxq5nJAfpMCGFiQWN0aW9uAgQAsauZyQG2TQR0cnVlJwCxq5nJAfpMCGFiSWdub3JlAgQAsauZyQG7TQR0cnVlJwCxq5nJAfpMFGFiQ29yZU1lbnVPbkdlbmVyYXRlAgQAsauZyQHATUZAaWYgKGNvbmZpZ0JvdC50YWdzLnN0YXRpY0luc3QgIT0gdW5kZWZpbmVkKQp7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwCxq5nJAfpMCWFiVmVyc2lvbgIEALGrmckBh04FMTAuNDInAQRib3RzJGM2OGM1YjgyLWMwYTctNGE1YS05MTA0LTVkZDhlMzJhZTRlMgEnALGrmckBjU4Gc3lzdGVtAgQAsauZyQGOThBhYi5hY3Rpb24ucG9ydGFsJwCxq5nJAY1OC2Rlc2NyaXB0aW9uAgQAsauZyQGfThRTa2lsbCB0byBvcGVuIHNoZWV0LicAsauZyQGNTghhYkFjdGlvbgIEALGrmckBtE4EdHJ1ZScAsauZyQGNTgRmb3JtAgQAsauZyQG5Tgdub3RoaW5nJwCxq5nJAY1OEGFiQ29yZU1lbnVBY3Rpb24CBACxq5nJAcFOA0AvLycAsauZyQGNTghyZW1lbWJlcgIEALGrmckBxU4o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAsauZyQGNTg9hYkNvcmVNZW51TGFiZWwCBACxq5nJAexOEGN1cnJlbnQgcG9ydGFsOiAnALGrmckBjU4PYWJCb3RNZW51QWN0aW9uAgQAsauZyQH9TqgDQApjb25zdCBzZWxlY3RlZEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgppZiAoc2VsZWN0ZWRCb3QpIHsKICAgIGNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCiAgICBpZiAoc3RhdGUpIHsKICAgICAgICAvLyBPcGVuIHNoZWV0IHBvcnRhbCBpbiBuZXcgdGFiLgogICAgICAgIG9zLm9wZW5VUkwoY29uZmlnQm90LnRhZ3MucGVybWFsaW5rICsgYCZzaGVldFBvcnRhbD0ke3NlbGVjdGVkQm90LmlkfWApOwogICAgfSBlbHNlIHsKICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9IHNlbGVjdGVkQm90LmlkOwogICAgfQoKICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogb3BlbmVkIGJvdCBzaGVldCIpOwp9CicAsauZyQGNTg5hYkJvdE1lbnVMYWJlbAIEALGrmckBplIOb3BlbiBib3Qgc2hlZXQnALGrmckBjU4NbWFuaWZlc3RhdGlvbgIEALGrmckBtVIo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAsauZyQGNTg1hYkJvdE1lbnVJY29uAgQAsauZyQHcUgp0YWJsZV92aWV3JwCxq5nJAY1ODmFiQ29yZU1lbnVJY29uAgQAsauZyQHnUgthcnJvd19yaWdodCcAsauZyQGNThJhYkJvdE1lbnVTb3J0T3JkZXICBACxq5nJAfNSATEnALGrmckBjU4IYWJJZ25vcmUCBACxq5nJAfVSBHRydWUnALGrmckBjU4XYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBACxq5nJAfpS1ARAY29uc3QgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwpjb25zdCBtdWx0aXBsZVNlbGVjdERpbSA9ICJhYk11bHRpcGxlU2VsZWN0IjsKCmNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gbXVsdGlwbGVTZWxlY3REaW07CgpzZXRUYWdNYXNrKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cywgbXVsdGlwbGVTZWxlY3REaW0sIHRydWUsICJ0ZW1wTG9jYWwiKTsKCm1hc2tzLmN1cnJlbnRTaGVldEJvdHMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiTXVsdGlwbGVCb3RGb2N1czsKbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgaWYgKHRoYXQuZGltZW5zaW9uICE9ICJhYk11bHRpcGxlU2VsZWN0IiAmJiB0aGF0LnBvcnRhbCA9PSAic2hlZXRQb3J0YWwiKSB7CiAgICAgICAgY2xlYXJUYWdNYXNrcyhsaW5rcy5jdXJyZW50U2hlZXRCb3RzKTsKICAgICAgICBjbGVhclRhZ01hc2tzKHRoaXNCb3QpOwogICAgfQp9KTsKCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogb3BlbmVkIG11bHRpcGxlIHNlbGVjdCBzaGVldCIpOycAsauZyQGNThZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAsauZyQHPVwpvcGVuIHNoZWV0JwCxq5nJAY1OFWFiTXVsdGlwbGVCb3RNZW51SWNvbgIEALGrmckB2lcKdGFibGVfdmlldycAsauZyQGNThNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAsauZyQHlV+wBQGxldCBzZWxlY3RlZEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7Cgp0YWdzLmxhYmVsID0gYG9wZW4gc2hlZXRgOwoKdGFncy5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsKdGFncy5vbktleVVwID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gbnVsbDt9YDsnALGrmckBjU4aYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBACxq5nJAdJZATAnALGrmckBjU4EbWVudQIEALGrmckB1Fko8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAsauZyQGNTglhYlZlcnNpb24CBACxq5nJAftZBTEwLjQyJwCxq5nJAY1OC2FiQmx1ZXByaW50AgQAsauZyQGBWvsDQGNvbnN0IGJhY2tncm91bmRDb2xvciA9IGxpbmtzLnJlbWVtYmVyPy50YWdzLmFiQmx1ZXByaW50Q29sb3IgPz8gIiMxNzg1QjUiOwoKaWYgKGJhY2tncm91bmRDb2xvciA9PSBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yKQp7CiAgICByZXR1cm47Cn0KCmdyaWRQb3J0YWxCb3QubWFza3MucG9ydGFsQ29sb3IgPSBiYWNrZ3JvdW5kQ29sb3I7CgptYXNrcy5vblBvcnRhbENoYW5nZWQgPSBgQCBpZiAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIHRoYXQuZGltZW5zaW9uICE9ICJibHVlcHJpbnQiKXsKICAgIC8vIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQmFzZUNvbG9yID0gbnVsbDsKICAgIC8vIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQmFzZVN0cm9rZUNvbG9yID0gbnVsbDsKCiAgICBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yID0gbnVsbDsKCiAgICBtYXNrcy5vblBvcnRhbENoYW5nZWQgPSBudWxsOwp9YDsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7JwCxq5nJAY1OC29uQW55Q3JlYXRlAgQAsauZyQH9XaUBQGlmICh0aGF0LmJvdC50YWdzLmJsdWVwcmludCkKewogICAgaWYgKCF0aGF0LmJvdC50YWdzLmFiQm90KSB7CiAgICAgICAgdGhhdC5ib3QudGFncy5zdHJva2VDb2xvciA9ICIjZmZmZmZmIjsKICAgIH0KICAgIAogICAgdGhhdC5ib3QudGFncy5sYWJlbENvbG9yID0gIiNmZmZmZmYiOwp9JwCxq5nJAY1OD29uUG9ydGFsQ2hhbmdlZAIEALGrmckBo19hQGlmICh0aGF0LnBvcnRhbCA9PSAiZ3JpZFBvcnRhbCIgJiYgdGhhdC5kaW1lbnNpb24gPT0gImJsdWVwcmludCIpCnsKICAgIHRoaXNCb3QuYWJCbHVlcHJpbnQoKTsKfScAsauZyQGNTgtwZXJzb25hbGl0eQIEALGrmckBhWAo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAsauZyQGNThJhYkNvcmVNZW51SXRlbVR5cGUCBACxq5nJAaxgCGRyb3Bkb3duJwCxq5nJAY1OEWRyb3Bkb3duU29ydE9yZGVyAgQAsauZyQG1YAExJwCxq5nJAY1OD2Ryb3Bkb3duT3B0aW9ucwIEALGrmckBt2AG8J+nrFtdJwCxq5nJAY1OGGFiQ29yZU1lbnVPbkJlZm9yZUNyZWF0ZQIEALGrmckBvGDiHkBjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgY3VycmVudERpbSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQpjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KY29uc3QgcGVybWFsaW5rVVJMID0gY29uZmlnQm90LnRhZ3MucGVybWFsaW5rOw0KY29uc3QgYWN0aXZlSW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7DQpjb25zdCBhY3RpdmVCaW9zID0gY29uZmlnQm90LnRhZ3Mub3duZXIgPyAiJm93bmVyPSIgKyBjb25maWdCb3QudGFncy5vd25lciA6IGZhbHNlOw0KY29uc3QgZmlyc3RJbmRleCA9IHBlcm1hbGlua1VSTC5pbmRleE9mKCImIik7DQpjb25zdCBpbml0aWFsVVJMID0gcGVybWFsaW5rVVJMLnN1YnN0cmluZygwLCBmaXJzdEluZGV4KTsNCmNvbnN0IHVwZGF0ZWRVUkwgPSBhY3RpdmVCaW9zICE9IGZhbHNlID8gaW5pdGlhbFVSTCArICImaW5zdD0iICsgYWN0aXZlSW5zdCA6IGluaXRpYWxVUkw7DQoNCnNldFRhZ01hc2sodGhpc0JvdCwgImFiQ29yZU1lbnVMYWJlbCIsYG1vZGU6ICR7Y3VycmVudFBvcnRhbH0gcG9ydGFsYCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJjdXJyZW50RGltZW5zaW9uIiwgY3VycmVudERpbSk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJjdXJyZW50UG9ydGFsIiwgY3VycmVudFBvcnRhbCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJkcm9wZG93blNvcnRPcmRlciIsIDEpOw0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJQb3J0YWxNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsNCm1lbnVPcHRpb25zLm9uS2V5VXAgPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSBudWxsO31gOw0KbWVudU9wdGlvbnMuc2tpbGxCb3QgPSBnZXRMaW5rKHRoaXNCb3QpOw0KbWVudU9wdGlvbnMudGFyZ2V0VVJMID0gdXBkYXRlZFVSTDsNCg0KY29uc3QgbWFwTWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCg0KbWFwTWVudUJvdC5sYWJlbCA9ICJtYXAgcG9ydGFsIjsNCm1hcE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAicHVibGljIjsNCm1hcE1lbnVCb3Qub25DbGljayA9IGBAIA0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZtYXBQb3J0YWw9JHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iKTsNCn0NCmVsc2UNCnsNCiAgICBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSAiJHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iOw0KICAgIGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPSBudWxsOw0KfWA7DQoNCmlmIChjdXJyZW50UG9ydGFsICE9ICJtYXAiKQ0Kew0KICAgIC8vbWFwIHBvcnRhbCBidXR0b24NCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtYXBNZW51Qm90KTsNCn0NCg0KY29uc3QgZ3JpZE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQpncmlkTWVudUJvdC5sYWJlbCA9ICJncmlkIHBvcnRhbCI7DQpncmlkTWVudUJvdC5mb3JtQWRkcmVzcyA9ICJjdWJlIjsNCmdyaWRNZW51Qm90Lm9uQ2xpY2sgPSBgQA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9JHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iKTsNCn0gDQplbHNlDQp7DQogICAgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9ICIke2N1cnJlbnREaW0gPT0gImJsdWVwcmludCIgPyAiaG9tZSIgOiBjdXJyZW50RGltfSI7IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IG51bGw7DQp9YDsNCg0KaWYgKGN1cnJlbnRQb3J0YWwgIT0gImdyaWQiIHx8IGN1cnJlbnREaW0gPT0gImJsdWVwcmludCIpDQp7DQogICAgLy9ncmlkIHBvcnRhbCBidXR0b24NCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChncmlkTWVudUJvdCk7DQp9DQoNCmNvbnN0IGJsdWVwcmludE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQoNCmJsdWVwcmludE1lbnVCb3QubGFiZWwgPSAiYmx1ZXByaW50IHBvcnRhbCI7DQpibHVlcHJpbnRNZW51Qm90LmZvcm1BZGRyZXNzID0gImFyY2hpdGVjdHVyZSI7DQpibHVlcHJpbnRNZW51Qm90Lm9uQ2xpY2sgPSBgQA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9Ymx1ZXByaW50Iik7DQp9IA0KZWxzZQ0Kew0KICAgIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAiYmx1ZXByaW50IjsgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gbnVsbDsNCn0NCg0KbGlua3Muc2tpbGxCb3QuYWJCbHVlcHJpbnQoKTtgOw0KDQppZiAoY3VycmVudERpbSAhPSAiYmx1ZXByaW50IikNCnsNCiAgICAvL2JsdWVwcmludCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goYmx1ZXByaW50TWVudUJvdCk7DQp9DQoNCg0KY29uc3Qgc2hlZXRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0Kc2hlZXRNZW51Qm90LmxhYmVsID0gInNoZWV0IHBvcnRhbCI7DQpzaGVldE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAidGFibGVfdmlldyI7DQpzaGVldE1lbnVCb3Qub25DbGljayA9IGBAIA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJnNoZWV0UG9ydGFsPSR7Y3VycmVudERpbX0iKTsNCn0gDQplbHNlDQp7IA0KICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gIiR7Y3VycmVudERpbX0iOw0KfWA7DQoNCi8vc2hlZXQgcG9ydGFsIGJ1dHRvbg0KZHJvcGRvd25PcHRpb25zLnB1c2goc2hlZXRNZW51Qm90KTsNCg0KDQpjb25zdCBzeXN0ZW1NZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KDQpzeXN0ZW1NZW51Qm90LmxhYmVsID0gInN5c3RlbSBwb3J0YWwiOw0Kc3lzdGVtTWVudUJvdC5mb3JtQWRkcmVzcyA9ICJzZXR0aW5nc19hcHBsaWNhdGlvbnMiOw0Kc3lzdGVtTWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZzeXN0ZW1Qb3J0YWw9dHJ1ZSIpOw0KfSANCmVsc2UNCnsgDQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gdHJ1ZTsNCn1gOw0KDQovL3N5c3RlbSBwb3J0YWwgYnV0dG9uDQpkcm9wZG93bk9wdGlvbnMucHVzaChzeXN0ZW1NZW51Qm90KTsNCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwEEYm90cyRlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcBJwCxq5nJAZ9/BnN5c3RlbQIEALGrmckBoH8NYWIuYWN0aW9uLmFzaycAsauZyQGffwRmb3JtAgQAsauZyQGufwdub3RoaW5nJwCxq5nJAZ9/BmFza0dQVAIEALGrmckBtn/FJkBpZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd0FJID09IGZhbHNlKSB7CiAgICBjb25zdCBhaU1lc3NhZ2UgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFpX3JlamVjdGlvbl9tZXNzYWdlID8/ICJBSSBub3QgYXV0aG9yaXplZCBmb3IgdGhpcyBhY2NvdW50IjsKICAgIGxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoeyBtZXNzYWdlOiBhaU1lc3NhZ2UgfSk7CiAgICBvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gdHJ1ZTsKICAgIGNvbmZpZ0JvdC50YWdzLnJlcXVlc3RpbmdBSSA9IHRydWU7CiAgICByZXR1cm47Cn0KCi8qKgogKiBTYW5pdGl6ZXMgYW4gb2JqZWN0IGluIHBsYWNlIGJ5IHJlcGxhY2luZyBhbnkgYm90IG9iamVjdHMgd2l0aCB0aGVpciBpZHMuCiAqIEEgYm90IGlzIGlkZW50aWZpZWQgYnkgaGF2aW5nIGBpZGAsIGB0YWdzYCwgYW5kIGBzcGFjZWAgcHJvcGVydGllcy4KICogUmVjdXJzaXZlbHkgcHJvY2Vzc2VzIG5lc3RlZCBvYmplY3RzIGFuZCBhcnJheXMuCiAqLwpmdW5jdGlvbiBzYW5pdGl6ZUJvdFJlZmVyZW5jZXMob2JqKSB7CiAgaWYgKG9iaiA9PSBudWxsIHx8IHR5cGVvZiBvYmogIT09ICdvYmplY3QnKSByZXR1cm47CgogIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKG9iaikpIHsKICAgIGlmIChpc0JvdCh2YWx1ZSkpIHsKICAgICAgb2JqW2tleV0gPSB2YWx1ZS5pZDsKICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChpc0JvdCh2YWx1ZVtpXSkpIHsKICAgICAgICAgIHZhbHVlW2ldID0gdmFsdWVbaV0uaWQ7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZVtpXSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZVtpXSA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkodmFsdWVbaV0pKSB7CiAgICAgICAgICBzYW5pdGl6ZUJvdFJlZmVyZW5jZXModmFsdWVbaV0pOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsKSB7CiAgICAgIHNhbml0aXplQm90UmVmZXJlbmNlcyh2YWx1ZSk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBpc0JvdCh2YWx1ZSkgewogIHJldHVybiAoCiAgICB2YWx1ZSAhPSBudWxsICYmCiAgICB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmCiAgICAhQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYKICAgICdpZCcgaW4gdmFsdWUgJiYKICAgICd0YWdzJyBpbiB2YWx1ZSAmJgogICAgJ3NwYWNlJyBpbiB2YWx1ZQogICk7Cn0KCnNhbml0aXplQm90UmVmZXJlbmNlcyh0aGF0KTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7Cn0KCmNvbnN0IG9yaWdpbmFsVXNlcklucXVpcnkgPSB0aGF0LmlucXVpcnkgPz8gdGhhdDsKY29uc3QgcHJvbXB0ID0gIXRoYXQucHJvbXB0ID8gdGFncy5wcm9tcHRfY29yZSA6IHRhZ3NbInByb21wdF8iICsgdGhhdC5wcm9tcHRdOwpjb25zdCBhYkJvdCA9IHRoYXQuYWJCb3QgPyBnZXRCb3QoJ2lkJywgdGhhdC5hYkJvdCkgOiBsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90OyAvLyBBbGxvdyBjdXN0b20gYWIgYm90IHRvIGJlIHBhc3NlZC4KY29uc3Qgc291cmNlSWQgPSB0aGF0LnNvdXJjZUlkID8/IHV1aWQoKTsKY29uc3QgYWJEaW1lbnNpb24gPSB0aGF0LmFiRGltZW5zaW9uID8/IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247IC8vIEFsbG93IGN1c3RvbSBhYiBkaW1lbnNpb24gdG8gYmUgcGFzc2VkLgpjb25zdCBhYlBvc2l0aW9uID0gdGhhdC5hYlBvc2l0aW9uID8/IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3NbYWJEaW1lbnNpb24gKyAnQUJMYXN0UG9zaXRpb24nXTsgLy8gQWxsb3cgY3VzdG9tIGFiIHBvc2l0aW9uIHRvIGJlIHBhc3NlZC4KY29uc3QgcGF0Y2hCb3REaW1lbnNpb24gPSB0aGF0LmFiRGltZW5zaW9uID8/IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247CmNvbnN0IHBhdGNoQm90UG9zaXRpb24gPSB7IHg6IGFiUG9zaXRpb24/LnggPz8gMCwgeTogYWJQb3NpdGlvbj8ueSA/PyAwLCB6OiAyIH07CgpsaW5rcy51dGlscy5hYkxvZyh7IG1lc3NhZ2U6IGB0aGlua2luZyBhYm91dDogIiR7b3JpZ2luYWxVc2VySW5xdWlyeX0iYCB9KTsKbGlua3MubWFuaWZlc3RhdGlvbi5hYkJvdENoYXQoeyBib3Q6IGFiQm90LCBtZXNzYWdlOiBgdGhpbmtpbmcgYWJvdXQ6ICIke29yaWdpbmFsVXNlcklucXVpcnl9ImAgfSk7CgpsZXQgaW5xdWlyeSA9IGBJTlBVVDogJHtvcmlnaW5hbFVzZXJJbnF1aXJ5fWA7CgppZiAodGhhdC5wcm9tcHQgPT0gImdyaWQiKSB7CiAgICBpbnF1aXJ5ICs9IGBcblBPU0lUSU9OOiB7IGRpbWVuc2lvbjogIiR7dGhhdC5kYXRhLmRpbWVuc2lvbn0iLCB4OiAke3RoYXQuZGF0YS5kaW1lbnNpb25YfSwgeTogJHt0aGF0LmRhdGEuZGltZW5zaW9uWX0gfWA7Cgp9IGVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJib3QiKSB7CiAgICBjb25zdCB0YXJnZXRCb3QgPSB7IGlkOiB0aGF0LmRhdGEuYm90LCBkaW1lbnNpb246IGFiRGltZW5zaW9uIH07CiAgICBpbnF1aXJ5ICs9IGBcblRBUkdFVF9CT1Q6ICR7SlNPTi5zdHJpbmdpZnkodGFyZ2V0Qm90LCB1bmRlZmluZWQsIDIpfWA7Cgp9IGVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJtdWx0aXBsZUJvdCIpIHsKICAgIGNvbnN0IHRhcmdldEJvdHMgPSBbXTsKICAgIGZvciAobGV0IGlkIG9mIHRoYXQuZGF0YS5ib3RzKSB7CiAgICAgICAgaWYgKGlkKSB7CiAgICAgICAgICAgIHRhcmdldEJvdHMucHVzaCh7IGlkLCBkaW1lbnNpb246IGFiRGltZW5zaW9uIH0pCiAgICAgICAgfQogICAgfQogICAgaW5xdWlyeSArPSBgXG5UQVJHRVRfQk9UUzogJHtKU09OLnN0cmluZ2lmeSh0YXJnZXRCb3RzLCB1bmRlZmluZWQsIDIpfWA7Cgp9IGVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJjb3JlIikgewogICAgaW5xdWlyeSArPSBgXG5UQVJHRVRfRElNRU5TSU9OOiAke2FiRGltZW5zaW9ufWA7Cn0KCi8vIENyZWF0ZSBhIGJvdCB0aGF0IHNpZ25hbHMgKGxvY2FsbHkpIHdoZW4gY2FsbHMgdG8gYWkgaGF2ZSBiZWd1biBhbmQgZW5kZWQuCgpjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXNCb3Quc3VibWl0UmVxdWVzdEdQVCh7IGlucXVpcnk6IGlucXVpcnksIHByb21wdDogcHJvbXB0LCBtb2RlbDogdGhhdC5tb2RlbCwgc291cmNlSWQgfSk7CgppZiAocmVzcG9uc2UpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSByYXcgc3VibWl0UmVxdWVzdEdQVCByZXNwb25zZTpcbmAsIHJlc3BvbnNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dHJhY3RzIGNvZGUgY29udGVudCBmcm9tIGFuIExMTSByZXNwb25zZSwgc3RyaXBwaW5nIG1hcmtkb3duCiAgICAgKiBjb2RlIGZlbmNlcyBhbmQgbGFuZ3VhZ2UgdGFncyBpZiBwcmVzZW50LiBJZiBubyBmZW5jZWQgY29kZSBibG9jawogICAgICogaXMgZm91bmQsIHJldHVybnMgdGhlIHRyaW1tZWQgcmVzcG9uc2UgYXMtaXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGV4dHJhY3RDb2RlKHJlc3BvbnNlKSB7CiAgICAgIGNvbnN0IG1hdGNoID0gcmVzcG9uc2UubWF0Y2goL2BgYCg/Olx3KilccypcbihbXHNcU10qPylgYGAvKTsKICAgICAgcmV0dXJuIG1hdGNoID8gbWF0Y2hbMV0udHJpbSgpIDogcmVzcG9uc2UudHJpbSgpOwogICAgfQoKICAgIGxldCBleHRyYWN0ZWRDb2RlID0gZXh0cmFjdENvZGUocmVzcG9uc2UpOwogICAgCiAgICBsaW5rcy51dGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBbZ2VuZXJhdGVkIGNvZGVdOlxuJHtleHRyYWN0ZWRDb2RlfWAgfSk7CgogICAgY29uc3QgZWdnUGFyYW1ldGVycyA9IHsKICAgICAgICBwYXRjaENvZGU6IGV4dHJhY3RlZENvZGUsCiAgICAgICAgYXNrSW5wdXQ6IHRoYXQsCiAgICAgICAgZGltZW5zaW9uOiBwYXRjaEJvdERpbWVuc2lvbiwKICAgICAgICBwb3NpdGlvbjogcGF0Y2hCb3RQb3NpdGlvbiwKICAgICAgICBhbHdheXNBcHByb3ZlOiBmYWxzZSwKICAgIH0KCiAgICBjb25zdCBwYXRjaEJvdFRlbXBsYXRlID0gZ2V0Qm90KGIgPT4gYi50YWdzLmFiUGF0Y2hCb3QgJiYgIWIudGFncy5hYlBhdGNoQm90SW50YW5jZSAmJiAhYi50YWdzLmFiSWdub3JlKTsKICAgIAogICAgaWYgKHBhdGNoQm90VGVtcGxhdGUpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNsb25pbmcgcGF0Y2ggYm90ICR7cGF0Y2hCb3RUZW1wbGF0ZS5pZH0gZnJvbSB0ZW1wbGF0ZSBib3QgdGhhdCB3YXMgZm91bmRgKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGJvdERhdGEgPSBnZXRTbmFwc2hvdChwYXRjaEJvdFRlbXBsYXRlKTsKICAgICAgICBhd2FpdCBhYi5saW5rcy5jcmVhdGUuYWJDcmVhdGVCb3RzKHsKICAgICAgICAgICAgYm90RGF0YSwKICAgICAgICAgICAgZWdnUGFyYW1ldGVycywKICAgICAgICAgICAgc291cmNlRXZlbnQ6ICdhc2tfZ3B0JywKICAgICAgICB9KQogICAgfSBlbHNlIHsKICAgICAgICBhd2FpdCBhYi5saW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7CiAgICAgICAgICAgIGFza0lEOiAnYWJQYXRjaEJvdCcsCiAgICAgICAgICAgIHNob3dJbmRpY2F0b3I6IGZhbHNlLAogICAgICAgICAgICBhdXRvSGF0Y2g6IHRydWUsCiAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnMsCiAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAnYXNrX2dwdCcsCiAgICAgICAgICAgIGlnbm9yZVJlc2VydmVkOiB0cnVlLAogICAgICAgIH0pCiAgICB9Cn0nALGrmckBn38JZ3B0QWN0aXZlAgQAsauZyQH8pQEFZmFsc2UnALGrmckBn38Qc3VibWl0UmVxdWVzdEdQVAIEALGrmckBgqYBpB9AaW1wb3J0IHsgQUlDaGF0T3B0aW9ucywgQUlDaGF0TWVzc2FnZSB9IGZyb20gJ2Nhc3VhbG9zJzsKCmNvbnN0IHsKICAgIHByb21wdCwKICAgIGlucXVpcnksCiAgICBtb2RlbCwKICAgIHNvdXJjZUlkLAp9ID0gdGhhdCA/PyB7fTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXRgLCB0aGF0KTsKfQoKaWYgKGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dBSSA9PSBmYWxzZSkgewogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6ICJBSSBub3QgYXV0aG9yaXplZCBvbiB0aGlzIGFjY291bnQiLCBsb2dUeXBlOiAnbG9nJyB9KTsKICAgIHJldHVybiBudWxsOwp9Cgpjb25zdCBhY3RpdmVSZXF1ZXN0U2lnbmFsID0gY3JlYXRlKHsKICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgIGFiQWN0aXZlUmVxdWVzdEdQVDogdHJ1ZSwKICAgIGlucHV0OiAn8J+nrCcgKyBKU09OLnN0cmluZ2lmeSh0aGF0KSwKICAgIHN1Y2Nlc3M6IG51bGwsIC8vIFdpbGwgYmUgc2V0IHdoZW4gZ3B0IHJlcXVlc3QgZmluaXNoZXMuCiAgICBlcnJvck1lc3NhZ2U6IG51bGwsIC8vIFdpbGwgYmUgc2V0IGlmIGdwdCByZXF1ZXN0IGZhaWxzLgogICAgcmVzcG9uc2U6IG51bGwsIC8vIFdpbGwgYmUgc2V0IGlmIGdwdCByZXF1ZXN0IHN1Y2NlZWRzLgogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBzaG91dCgnb25BQlJlcXVlc3RHUFRTdGFydGVkJywgeyBpbnB1dDogdGFncy5pbnB1dCB9KTsKICAgIH0pLAogICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRhZ3Muc3VjY2VzcykgewogICAgICAgICAgICBzaG91dCgnb25BQlJlcXVlc3RHUFRTdWNjZXNzJywgeyBpbnB1dDogdGFncy5pbnB1dCwgcmVzcG9uc2U6IHRhZ3MucmVzcG9uc2UgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzaG91dCgnb25BQlJlcXVlc3RHUFRGYWlsdXJlJywgeyBpbnB1dDogdGFncy5pbnB1dCwgc3VjY2VzczogdGFncy5zdWNjZXNzLCBlcnJvck1lc3NhZ2U6IHRhZ3MuZXJyb3JNZXNzYWdlIH0pCiAgICAgICAgfQogICAgfSkKfSkKCmNvbnN0IGJ1c3lJbmRpY2F0b3IgPSBhd2FpdCBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3Ioe2FiTWVudTogdHJ1ZSwgbGFiZWw6IGBhc2tpbmcgJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWAgfSk7Cgpjb25zdCBhaUNoYXRPcHRpb25zOiBBSUNoYXRPcHRpb25zID0geyAKICAgIHByZWZlcnJlZE1vZGVsOiBtb2RlbCA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbAp9Cgpjb25zdCBhaUNoYXRNZXNzYWdlczogQUlDaGF0TWVzc2FnZVtdID0gW107CgphaUNoYXRNZXNzYWdlcy5wdXNoKHsKICAgIHJvbGU6ICdzeXN0ZW0nLAogICAgY29udGVudDogWwogICAgICAgIHsgdGV4dDogcHJvbXB0ID8gcHJvbXB0IDogdGFncy5wcm9tcHRfY29yZSB9CiAgICBdCn0pCgovLyBUaGUgZm9sbG93aW5nIGFzc2lzdGFudCBtZXNzYWdlIGlzIGEgaGFyZCByZXF1aXJlbWVudCBmb3IgR29vZ2xlIEdlbWluaSBtb2RlbHMgLSB0aGF0IHRoZSAibW9kZWwiIC8gImFzc2lzdGFudCIgaGF2ZSBhIG1lc3NhZ2UgYmVmb3JlIHRoZSAidXNlciIgZG9lcy4KLy8gSXQgZG9lc250IHJlYWxseSBodXJ0IHRvIGRvIHRoaXMgZm9yIGFsbCB0aGUgYWkgbW9kZWxzIHRob3VnaC4KYWlDaGF0TWVzc2FnZXMucHVzaCh7CiAgICByb2xlOiAnYXNzaXN0YW50JywKICAgIGNvbnRlbnQ6IFsKICAgICAgICB7IHRleHQ6IGBUaGFuayB5b3UgZm9yIHRoYXQgdmVyeSBkZXRhaWxlZCBhbmQgY2xlYXIgZXhwbGFuYXRpb24gb2YgdGhlIHJlcXVpcmVkIGRlbGl2ZXJhYmxlLiBJIHdpbGwgbWFrZSBzdXJlIHRvIGdpdmUgeW91IGNvZGUgdGhhdCBtZWV0cyB5b3VyIGV4cGVjdGF0aW9uIHdoaWxlIG1ha2luZyBzdXJlIHRoYXQgdGhlIEhhcmQgUmVxdWlyZW1lbnRzIGFyZSBmdWxmaWxsZWQgdGhlIEhhcmQgUmVxdWlyZW1lbnRzISBXaGF0IHdvdWxkIHlvdSBsaWtlIHRvIGFzayBtZT9gIH0KICAgIF0KfSkKCmFpQ2hhdE1lc3NhZ2VzLnB1c2goewogICAgcm9sZTogJ3VzZXInLAogICAgY29udGVudDogWwogICAgICAgIHsgdGV4dDogaW5xdWlyeSB9CiAgICBdCn0pCgppZiAoIWxpbmtzLm1lbnUpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiSW50ZXJmYWNlJyk7Cn0KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNlbmRpbmcgdG8gYWk6YCwgeyBhaUNoYXRNZXNzYWdlcywgYWlDaGF0T3B0aW9ucyB9KTsKfQoKbGV0IGFpUmVzcG9uc2U6IEFJQ2hhdE1lc3NhZ2U7Cgp0cnkgewogICAgYWlSZXNwb25zZSA9IGF3YWl0IGFpLmNoYXQoYWlDaGF0TWVzc2FnZXMsIGFpQ2hhdE9wdGlvbnMpOwoKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhaSByZXNwb25zZTpgLCBhaVJlc3BvbnNlKTsKICAgIH0KCiAgICBhc3NlcnQodHlwZW9mIGFpUmVzcG9uc2UuY29udGVudCA9PT0gJ3N0cmluZycsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gVW5hYmxlIHRvIGV4dHJhY3Qgc3RyaW5nIHJlc3BvbnNlIGZyb20gQUkgcmVzcG9uc2UuYCk7CgogICAgaWYgKGFpUmVzcG9uc2Uucm9sZSA9PT0gJ3N5c3RlbScpIHsKICAgICAgICAvLyBDYXN1YWxPUyB3aWxsIHJldHVybiBwcm92aWRlciBlcnJvcnMgYXMgYSBzeXN0ZW0gcmVzcG9uc2Ugd2l0aCB0aGUgZXJyb3IgZW5jb2RlZCBhcyBhIHN0cmluZyBwcmVmaXhlZCB3aXRoICJFcnJvcjogIi4KICAgICAgICAvLyBUaGlzIHNlY3Rpb24gdHJpZXMgdG8gZGV0ZWN0IHRoYXQgYW5kIHRocm93IGl0IGFzIGEgcHJvcGVyIEVycm9yIGlmIGRldGVjdGVkLgogICAgICAgIGlmIChhaVJlc3BvbnNlLmNvbnRlbnQuc3RhcnRzV2l0aCgnRXJyb3I6ICcpKSB7CiAgICAgICAgICAgIGFjdGl2ZVJlcXVlc3RTaWduYWwudGFncy5zdWNjZXNzID0gZmFsc2U7CiAgICAgICAgICAgIGFjdGl2ZVJlcXVlc3RTaWduYWwudGFncy5lcnJvck1lc3NhZ2UgPSBhaVJlc3BvbnNlLmNvbnRlbnQ7CgogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYWlSZXNwb25zZS5jb250ZW50KTsKICAgICAgICB9CiAgICB9CgogICAgYWN0aXZlUmVxdWVzdFNpZ25hbC50YWdzLnN1Y2Nlc3MgPSB0cnVlOwogICAgYWN0aXZlUmVxdWVzdFNpZ25hbC50YWdzLnJlc3BvbnNlID0gYWlSZXNwb25zZS5jb250ZW50OwoKICAgIGlmIChnbG9iYWxUaGlzLmFiWFBFKSB7CiAgICAgICAgLy8gTU9DSzogZGVkdWN0IGNyZWRpdHMgZm9yIGFpIGNhbGwuCiAgICAgICAgY29uc3QgcmVzdWx0OiBBQlhQRVBheW91dFJlc3VsdCA9IGF3YWl0IGFiWFBFLnBheW91dCh7IGFtb3VudDogMSwgc291cmNlSWQgfSk7CiAgICB9Cn0gY2F0Y2goZSkgewogICAgYWlSZXNwb25zZSA9IG51bGw7CgogICAgY29uc3QgZXJyb3JNZXNzYWdlID0gbGlua3MudXRpbHMuZ2V0RXJyb3JNZXNzYWdlKGUpOwoKICAgIGFjdGl2ZVJlcXVlc3RTaWduYWwudGFncy5zdWNjZXNzID0gZmFsc2U7CiAgICBhY3RpdmVSZXF1ZXN0U2lnbmFsLnRhZ3MuZXJyb3JNZXNzYWdlID0gZXJyb3JNZXNzYWdlOwoKICAgIC8vIFNob3cgdG9hc3Qgd2l0aCBlcnJvci4KICAgIGxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoeyBtZXNzYWdlOiBgQUkgcmVxdWVzdCBmYWlsZWQgLSAke2Vycm9yTWVzc2FnZX1gLCBsb2dUeXBlOiAnZXJyb3InIH0pOwoKICAgIC8vIFJldGhyb3cgc28gY2FsbGVycyBjYW4gY2F0Y2guCiAgICB0aHJvdyBlOwp9IGZpbmFsbHkgewogICAgZGVzdHJveShidXN5SW5kaWNhdG9yKTsKICAgIGRlc3Ryb3koYWN0aXZlUmVxdWVzdFNpZ25hbCk7Cn0KCnJldHVybiBhaVJlc3BvbnNlPy5jb250ZW50OycAsauZyQGffwhyZW1lbWJlcgIEALGrmckBpcUBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnALGrmckBn38QYWJDb3JlTWVudUFjdGlvbgIEALGrmckBzMUBqR9AY29uc3QgaW5xdWlyeSA9IHRoYXQ/Lm1lc3NhZ2UgPz8gdGhhdDsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0Py5pbml0aWFsQm9vdCA/PyBmYWxzZTsKY29uc3QgYXV0b0hhdGNoID0gdGhhdD8uYXV0b0hhdGNoID8/IGZhbHNlOwpjb25zdCBtZW51ID0gdGhhdD8ubWVudSA/PyAiY29yZSI7CmNvbnN0IGlucXVpcnlIYXNTcGFjZSA9IGlucXVpcnkuaW5kZXhPZigiICIpICE9PSAtMTsKY29uc3QgbWVudUJvdHMgPSBnZXRCb3RzKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwsIHRydWUpOwpjb25zdCBpc0NoYW5uZWwgPSB0aGF0LmlzQ2hhbm5lbCA/PyBmYWxzZTsKY29uc3QgaXNVVUFCID0gdGhhdC5pc1VVQUIgPz8gZmFsc2U7Cgp3aGlzcGVyKG1lbnVCb3RzLCAiYWJNZW51UmVmcmVzaCIpOwoKbGV0IHVzZXJuYW1lID0gInVzZXIiOwppZiAoYXV0aEJvdCAmJiBhdXRoQm90LnRhZ3MubmFtZSkgewogICAgdXNlcm5hbWUgPSBhdXRoQm90LnRhZ3MubmFtZTsKfSBlbHNlIGlmIChhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWUpIHsKICAgIHVzZXJuYW1lID0gYWIubGlua3MuY29uc29sZS5tYXNrcy5wcmVmZXJyZWROYW1lOwp9CgphYi5sb2coeyBtZXNzYWdlOiBpbnF1aXJ5LCBuYW1lOiB1c2VybmFtZSB9KTsKCmlmICghY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsICYmIGxpbmtzLm1hbmlmZXN0YXRpb24udGFncy5hYkF3YWtlICYmIGlucXVpcnkgIT0gIi5sb2ciKSB7CiAgICBzaG91dCgic2hvd0NvbnNvbGUiKTsKfQoKaWYgKGlzVVVBQikgewogICAgbGlua3MudXVhYkxvYWRlcj8ubG9hZFVVQUIoaW5xdWlyeSk7Cn0KZWxzZSBpZiAoaXNDaGFubmVsKSB7CiAgICBsaW5rcy5jaGFubmVsTG9hZGVyPy5sb2FkQ2hhbm5lbChpbnF1aXJ5KTsKfQplbHNlIGlmICghaW5xdWlyeUhhc1NwYWNlKSB7CiAgICBjb25zdCBpc0RpcmVjdFNlYXJjaCA9IGlucXVpcnkuc3RhcnRzV2l0aChgImApICYmIGlucXVpcnkuZW5kc1dpdGgoYCJgKTsKCiAgICBjb25zdCBlZ2dQYXJhbWV0ZXJzID0ge307CiAgICBpZiAodGhhdC5kaW1lbnNpb24pIHsKICAgICAgICBlZ2dQYXJhbWV0ZXJzLmdyaWRJbmZvcm1hdGlvbiA9IHsKICAgICAgICAgICAgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwKICAgICAgICAgICAgcG9zaXRpb246IHsgeDogdGhhdC5kaW1lbnNpb25YID8/IDAsIHk6IHRoYXQuZGltZW5zaW9uWSA/PyAwIH0KICAgICAgICB9CiAgICB9CgogICAgY29uc3QgYXNrOiBBQkxvb2t1cEFza0lEUmVzdWx0IHwgZmFsc2UgPSAhaXNEaXJlY3RTZWFyY2ggPyBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7IGFza0lEOiBpbnF1aXJ5LCBhdXRvSGF0Y2g6IHRydWUsIGVnZ1BhcmFtZXRlcnMsIHNvdXJjZUV2ZW50OiAnYXNrJyB9KSA6IGZhbHNlOwoKICAgIGlmIChhc2s/LnN1Y2Nlc3MgJiYgYXNrPy5kYXRhPy51cmwgIT0gdW5kZWZpbmVkICYmICFpc0RpcmVjdFNlYXJjaCAmJiAhaXNDaGFubmVsKSB7CiAgICAgICAgbGlua3MubGVhcm4uYWJKb2luSG9zdCh7IGRhdGE6IGFzay5kYXRhIH0pOwogICAgfSBlbHNlIGlmICghYXNrPy5zdWNjZXNzKSB7CiAgICAgICAgbGV0IGVnZzogQUJMb29rdXBFZ2dSZXN1bHQ7CiAgICAgICAgY29uc3QgcGVyaW9kSW5kZXggPSBpbnF1aXJ5LmluZGV4T2YoIi4iKTsKICAgICAgICBsZXQgYWJJRCA9IGlucXVpcnk7CgogICAgICAgIGlmIChpc0RpcmVjdFNlYXJjaCkgewogICAgICAgICAgICBhYklEID0gaW5xdWlyeS5zdWJzdHJpbmcoMSwgaW5xdWlyeS5sZW5ndGggLSAxKTsKICAgICAgICB9CgogICAgICAgIGlmIChwZXJpb2RJbmRleCA9PSAtMSB8fCBpc0RpcmVjdFNlYXJjaCkgewogICAgICAgICAgICBlZ2cgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3MoeyBhYklEOiBhYklELCBpbml0aWFsQm9vdCwgYXV0b0hhdGNoLCBlZ2dQYXJhbWV0ZXJzLCBzb3VyY2VFdmVudDogJ2FzaycgfSk7CiAgICAgICAgfSBlbHNlIGlmIChwZXJpb2RJbmRleCA+IDApIHsKICAgICAgICAgICAgY29uc3QgcmVjb3JkS2V5ID0gaW5xdWlyeS5zdWJzdHJpbmcoMCwgcGVyaW9kSW5kZXgpOwoKICAgICAgICAgICAgYWJJRCA9IGlucXVpcnkuc3Vic3RyaW5nKHBlcmlvZEluZGV4ICsgMSk7CgogICAgICAgICAgICBlZ2cgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3MoeyByZWNvcmRLZXk6IHJlY29yZEtleSwgYWJJRDogYWJJRCwgaW5pdGlhbEJvb3QsIGF1dG9IYXRjaCwgZWdnUGFyYW1ldGVycywgc291cmNlRXZlbnQ6ICdhc2snLCB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaW5rcy5pbnB1dC5vbkNoYXQoeyBtZXNzYWdlOiBpbnF1aXJ5IH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFlZ2c/LnN1Y2Nlc3MgJiYgbGlua3MubWVudSkgewogICAgICAgICAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKICAgICAgICAgICAgY29uc3Qgc3R1ZGlvQnV0dG9uID0ge307CgogICAgICAgICAgICBzdHVkaW9CdXR0b24uYWJNZW51ID0gdHJ1ZTsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmxhYmVsID0gYWJJRCArICIgbm90IGZvdW5kIGluIGFjdGl2ZSBzdHVkaW8sIGVudGVyIGFsdGVybmF0ZSBzdHVkaW9JRCI7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5mb3JtID0gImlucHV0IjsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmFiSUQgPSBhYklEOwogICAgICAgICAgICBzdHVkaW9CdXR0b24uZm9ybUFkZHJlc3MgPSB0YWdzLmFiQ29yZU1lbnVJY29uOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ub25TdWJtaXQgPSBgQCBsaW5rcy5tYW5hZ2VyLmFiQ29yZU1lbnVBY3Rpb24odGhhdC50ZXh0ICsgIi4iICsgdGFncy5hYklEKTtgOwoKICAgICAgICAgICAgY29uc3QgY3JlYXRlQnV0dG9uID0ge307CgogICAgICAgICAgICBjcmVhdGVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLmxhYmVsID0gImdpdmUgbWUgYSBwcm90b3R5cGUiOwogICAgICAgICAgICBjcmVhdGVCdXR0b24ubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgICAgICAgICBjcmVhdGVCdXR0b24uYWJJRCA9IGFiSUQ7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5wcm90b3R5cGUodGFncy5hYklEKTtgOwoKICAgICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oY3JlYXRlQnV0dG9uKTsKICAgICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oc3R1ZGlvQnV0dG9uKTsKCiAgICAgICAgICAgIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyI7CiAgICAgICAgfQogICAgfQp9IGVsc2UgewogICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCiAgICBpZiAoIWF1dGhCb3QpIHsKICAgICAgICBvcy50b2FzdCgicGxlYXNlIHNpZ24gaW4gdG8gYWNjZXNzIGFkdmFuY2VkIEFJIGZlYXR1cmVzIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoYWIubGlua3MucmVtZW1iZXIudGFncy5hYlRoaW5raW5nU291bmQpIHsKICAgICAgICAgICAgYWIubGlua3Muc291bmQuYWJQbGF5U291bmQoeyB2YWx1ZTogYWIubGlua3MucmVtZW1iZXIudGFncy5hYlRoaW5raW5nU291bmR9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYXdhaXQgdGhpc0JvdC5hc2tHUFQoeyBpbnF1aXJ5OiBpbnF1aXJ5LCBwcm9tcHQ6IG1lbnUsIGRhdGE6IHRoYXQsIHNvdXJjZUlkOiAnYWJCb3QnIH0pOwogICAgfQp9JwCxq5nJAZ9/FGFiQ29yZU1lbnVPbkdlbmVyYXRlAgQAsauZyQH25AHBCUB0YWdzLm9uU3VibWl0ID0gYEAKICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJjb3JlIn0pOwogICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyU3VibWl0dGVkQ29yZVRleHQnLCB0cnVlLCAnbG9jYWwnKTsKYDsKdGFncy5vbklucHV0VHlwaW5nID0gYEAKICAgIGlmICghdGFncy5zdG9wU3VnZ2VzdGlvbikgewogICAgICAgIHRhZ3Muc3RvcFN1Z2dlc3Rpb24gPSB0cnVlOwogICAgfQogICAgCiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCmlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGZyb20gYnVpbHQtaW4gc3VnZ2VzdGlvbnMuCiAgICAgICAgbGV0IHRleHQgPSBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0NvcmVbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNDb3JlLmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwCxq5nJAZ9/E2FiQ29yZU1lbnVTb3J0T3JkZXICBACxq5nJAbjuAQMyMDAnALGrmckBn38QYWJHcmlkTWVudUFjdGlvbgIEALGrmckBvO4BDkAvL3BsYWNlaG9sZGVyJwCxq5nJAZ9/FGFiR3JpZE1lbnVPbkdlbmVyYXRlAgQAsauZyQHL7gHOC0B0YWdzLmRpbWVuc2lvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMuZGltZW5zaW9uOwp0YWdzLmRpbWVuc2lvblggPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzLnBvc2l0aW9uLng7CnRhZ3MuZGltZW5zaW9uWSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMucG9zaXRpb24ueTsKdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiZ3JpZCIsIGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24sIGRpbWVuc2lvblg6IHRhZ3MuZGltZW5zaW9uWCwgZGltZW5zaW9uWTogdGFncy5kaW1lbnNpb25ZfSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwpgOwp0YWdzLm9uSW5wdXRUeXBpbmcgPSBgQAogICAgaWYgKCF0YWdzLnN0b3BTdWdnZXN0aW9uKSB7CiAgICAgICAgdGFncy5zdG9wU3VnZ2VzdGlvbiA9IHRydWU7CiAgICB9CiAgICAKICAgIGlmICghdGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCkgewogICAgICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclR5cGVkQ29yZVRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIH0KYDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfQoKaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCAmJiAhbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclN1Ym1pdHRlZENvcmVUZXh0KSB7CiAgICBhd2FpdCBvcy5zbGVlcChsaW5rcy5iYXNlU2tpbGwudGFncy5pbnB1dFN1Z2dlc3Rpb25XYWl0TVMpOwoKICAgIGlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQpIHsKICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gZnJvbSBidWlsdC1pbiBzdWdnZXN0aW9ucy4KICAgICAgICBsZXQgdGV4dCA9IGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zR3JpZFttYXRoLnJhbmRvbUludCgwLCBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0dyaWQubGVuZ3RoIC0gMSldOwoKICAgICAgICBsaW5rcy5iYXNlU2tpbGwuaW5wdXRTdWdnZXN0aW9uKHsgaW5wdXRCb3Q6IHRoaXNCb3QsIHRleHQgfSk7CiAgICB9Cn0nALGrmckBn38NbWFuaWZlc3RhdGlvbgIEALGrmckBmvoBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnALGrmckBn38TYWJHcmlkTWVudVNvcnRPcmRlcgIEALGrmckBwfoBAzIwMCcAsauZyQGffw9hYkdyaWRNZW51TGFiZWwCBACxq5nJAcX6AQZhc2sgYWInALGrmckBn38PYWJDb3JlTWVudUxhYmVsAgQAsauZyQHM+gEGYXNrIGFiJwCxq5nJAZ9/DmFiQ29yZU1lbnVJY29uAgQAsauZyQHT+gEEY3ViZScAsauZyQGffw5hYkdyaWRNZW51SWNvbgIEALGrmckB2PoBBGN1YmUnALGrmckBn38KZWRpdFByb21wdAIEALGrmckB3foBhwhAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgcHJvbXB0TWVudUJ1dHRvbiA9IHt9OwoKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwpwcm9tcHRNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CnByb21wdE1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKcHJvbXB0TWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CnByb21wdE1lbnVCdXR0b24uZ3B0Qm90ID0gIvCflJciICsgdGhpc0JvdC5pZDsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJsb2FkIHByb21wdCI7CnByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2xvdWRfZG93bmxvYWQiOwpwcm9tcHRNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5ncHRCb3QudXBkYXRlUHJvbXB0KCdsb2FkJyk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJzYXZlIHByb21wdCI7CnByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiYmFja3VwIjsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LnVwZGF0ZVByb21wdCgnc2F2ZScpOyI7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsKCm1hc2tzLm9uR3JpZENsaWNrID0gYEAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7Cgp0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwpgOwoKdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gInRvcCI7Cgpjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gdGhpc0JvdC5pZCArICIucHJvbXB0X2NvcmUiOwoKaWYgKGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSkKewogICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKfScAsauZyQGffwRtZW51AgQAsauZyQHjggIo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAsauZyQGffwx1cGRhdGVQcm9tcHQCBACxq5nJAYqDAssIQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IHByb21wdE1lbnVCdXR0b24gPSB7fTsKCnByb21wdE1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtID0gImlucHV0IjsKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpwcm9tcHRNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CnByb21wdE1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwpwcm9tcHRNZW51QnV0dG9uLmdwdEJvdCA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CgppZiAodGhhdCA9PSAibG9hZCIpCnsKICAgIHByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAibG9hZCBwcm9tcHQiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjbG91ZF9kb3dubG9hZCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLm9uU3VibWl0ID0gIkAgbGlua3MuZ3B0Qm90LmxvYWRQcm9tcHQodGhhdC50ZXh0KTsiOwp9CmVsc2UKewogICAgcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJzYXZlIHByb21wdCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImJhY2t1cCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLm9uU3VibWl0ID0gIkAgbGlua3MuZ3B0Qm90LnNhdmVQcm9tcHQodGhhdC50ZXh0KTsiOwp9CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsKCnByb21wdE1lbnVCdXR0b24uZm9ybSA9IG51bGw7CnByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAiICAiOwpwcm9tcHRNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CnByb21wdE1lbnVCdXR0b24uY29sb3IgPSAiI2YyNDcyNyI7CnByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2FuY2VsIjsKcHJvbXB0TWVudUJ1dHRvbi5vblN1Ym1pdCA9IG51bGw7CnByb21wdE1lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLmdwdEJvdC5lZGl0UHJvbXB0KCk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOycAsauZyQGffwpsb2FkUHJvbXB0AgQAsauZyQHUiwLaA0Bhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKaWYgKGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dQdWJsaWNEYXRhID09IGZhbHNlKQp7CiAgICBvcy50b2FzdCgibm90IGF1dGhvcml6ZWQiKTsKCiAgICByZXR1cm47Cn0KCmNvbnN0IHByb21wdE5hbWUgPSAiZ3B0X3Byb21wdF8iICsgdGhhdDsKY29uc3QgbmV3UHJvbXB0ID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBwcm9tcHROYW1lKTsKCmlmICghbmV3UHJvbXB0LnN1Y2Nlc3MpCnsKICAgIG9zLnRvYXN0KCJubyBwcm9tcHQgZm91bmQgYnkgdGhhdCBuYW1lIik7Cn0KZWxzZQp7CiAgICB0YWdzLnByb21wdF9jb3JlID0gbmV3UHJvbXB0LmRhdGE7Cn0KCmlmIChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSA9PSB0aGF0KQp7CiAgICByZXR1cm47Cn0KCnRoaXNCb3QuZWRpdFByb21wdCgpOycAsauZyQGffwpzYXZlUHJvbXB0AgQAsauZyQGvjwK+BEBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKaWYgKGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dQdWJsaWNEYXRhID09IGZhbHNlIHx8IGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMucHVibGlzaERhdGEgPT0gZmFsc2UpCnsKICAgIG9zLnRvYXN0KCJub3QgYXV0aG9yaXplZCIpOwoKICAgIHJldHVybjsKfQoKY29uc3QgYXV0aG9yID0gYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKY29uc3QgcHJvbXB0TmFtZSA9ICJncHRfcHJvbXB0XyIgKyB0aGF0Owpjb25zdCBuZXdQcm9tcHQgPSBhd2FpdCBvcy5yZWNvcmREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIHByb21wdE5hbWUsIHRhZ3MucHJvbXB0X2NvcmUsIHt1cGRhdGVQb2xpY3k6IFthdXRob3IuaWRdfSk7CgppZiAoIW5ld1Byb21wdC5zdWNjZXNzKQp7CiAgICBvcy50b2FzdCgic29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4iKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJwcm9tcHQgc2F2ZWQgYXMgIiArIHRoYXQpOwp9Cgp0aGlzQm90LmVkaXRQcm9tcHQoKTsnALGrmckBn38IYWJJZ25vcmUCBACxq5nJAe6TAgR0cnVlJwCxq5nJAZ9/CGFiQWN0aW9uAgQAsauZyQHzkwIEdHJ1ZScAsauZyQGffwZzZWFyY2gCBACxq5nJAfiTAijwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCxq5nJAZ9/BWxlYXJuAgQAsauZyQGflAIo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAsauZyQGffwptYXhfdG9rZW5zAgQAsauZyQHGlAIENTAwMCcAsauZyQGffw9vbkFCSW5pdGlhbGl6ZWQCBACxq5nJAcuUAlhAaWYgKGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlKQp7CiAgICB0aGlzQm90LmxvYWRQcm9tcHQoY29uZmlnQm90LnRhZ3MucHJvbXB0X2Jhc2UpOwp9JwCxq5nJAZ9/BWlucHV0AgQAsauZyQGklQIo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcAsauZyQGffwtwcm9tcHRfY29yZQIEALGrmckBy5UC6yMjIERlbGl2ZXJhYmxlCgpSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgojIyBSb2xlCgpZb3UgYXJlIGFuIGFnZW50IGJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKIyMgT2JqZWN0aXZlCgpVc2luZyBJTlBVVCBhcyBwcm92aWRlZCBieSB0aGUgdXNlciwgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHJ1bnMgaW5zaWRlIHRoZSBvbkNyZWF0ZSBmaWVsZCBvZiBhIENhc3VhbE9TIGJvdCBhbmQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvci4KCiMjIyBDcml0aWNhbCBSdWxlcyAobXVzdCBhbGwgYmUgc2F0aXNmaWVkKToKCjEuIEFsd2F5cyBpbmNsdWRlIGEgc2luZ2xlIGBhYi5sb2coIi4uLiIpYCBzdW1tYXJpemluZyB3aGF0IHRoZSBjb2RlIGRvZXMuCjIuIFVzZSB0aGUgYFRBUkdFVF9ESU1FTlNJT05gIGFzIGNvbnRleHQgZm9yIGxvY2F0aW9uLiBGb3IgZXhhbXBsZSwgaWYgYSBuZXcgYm90IGlzIGJlaW5nIGNyZWF0ZWQsIHlvdSB3b3VsZCBwbGFjZSBpdCBpbiB0aGUgZ2l2ZW4gYFRBUkdFVF9ESU1FTlNJT05gLgozLiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1Mgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90KC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgo0LiBBbHdheXMgcmV0dXJuIGFuIEFycmF5IG9mIGBBQlBhdGNoUmVzdWx0YCBvYmplY3RzIGZvciBlYWNoIGJvdCB0aGF0IGlzIGNyZWF0ZWQgb3IgbW9kaWZpZWQgYnkgdGhlIGNvZGUuIFRoaXMgZGF0YSBpcyBjcml0aWNhbCB0byB0aGUgdXNlciBmb3IgdGhlIHBhdGNoaW5nIHByb2Nlc3MgYXMgaXQgd2lsbCBhbGxvdyB1c2VycyB0byB1bmRvIHRoZSBwYXRjaCBpZiB0aGV5IGRlc2lyZS4KCiAgICBgYGB0eXBlc2NyaXB0CiAgICBpbnRlcmZhY2UgQUJQYXRjaFJlc3VsdCB7CiAgICAgICAgLyoqIFRoZSBpZCBvZiB0aGUgYm90IHRoYXQgd2FzIGNyZWF0ZWQgLyBtb2RpZmllZC4gKi8KICAgICAgICBib3RJZDogc3RyaW5nOwoKICAgICAgICAvKiogV2V0aGVyIG9yIG5vdCB0aGlzIGJvdCB3YXMgY3JlYXRlZCBieSB0aGUgcGF0Y2guICovCiAgICAgICAgY3JlYXRlZDogYm9vbGVhbjsKCiAgICAgICAgLyoqIAogICAgICAgICogQSByb2xsYmFjayBkaWZmIG9mIHRoZSBib3QgdGhhdCBzdG9yZXMgdGhlIG9yaWdpbmFsIHZhbHVlcyBvZiB0YWdzIG9uIHRoZSBib3QgYmVmb3JlIHRoZSBwYXRjaCBjb2RlIHdhcyBydW4uIElmIHRoZSBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoIGNvZGUgdGhlbiB0aGlzIG11c3QgYmUgbnVsbC4KICAgICAgICAqIAogICAgICAgICogU25hcHNob3RzIG9mIGJvdHMgY2FuIGJlIG9idGFpbmVkIGJ5IHJ1bm5pbmcgZ2V0U25hcHNob3QoYm90KSBhbmQgdGhlbiBhIHJvbGxiYWNrIGRpZmYgY2FuIGJlIGNyZWF0ZWQgYnkgcnVubmluZyBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBzaG90KS4KICAgICAgICAqLwogICAgICAgIHJvbGxiYWNrRGlmZjogUGFydGlhbEJvdFN0YXRlIHwgbnVsbDsKICAgIH0KICAgIGBgYAoKNS4gTmV2ZXIgdXNlIGFueSBvbkFueVwqIGxpc3RlbmVyIHRhZ3MuIFRoZXkgYXJlIGdlbmVyYWxseSBjb25zaWRlcmVkIGRhbmdlcm91cyBhbmQgY2FuIGJlIHByb25lIHRvIGNyYXNoaW5nLgo2LiBBbHdheXMgcmVzcG9uZCB3aXRoIHB1cmUgamF2YXNjcmlwdCBvbmx5ISBEbyAqKk5PVCoqIHdyYXAgdGhlIGNvZGUgaW4gYW55IE1hcmtkb3duIHN5bnRheCwgY29kZSB3aWxsICoqRkFJTCoqIHRvIGV4ZWN1dGUgaWYgdGhlIHJldHVybmVkIG91dHB1dCBpcyBub3QgcHVyZSBqYXZhc2NyaXB0IGNvZGUuCjcuIElmIElOUFVUIGlzIGEgcXVlc3Rpb24gdGhhdCBvbmx5IHJlcXVpcmVzIGEgc2ltcGxlIHRleHQgcmVzcG9uc2UsIGp1c3QgbG9nIHRoZSBhbnN3ZXIgd2l0aCBhYi5sb2cgYW5kIHRoZW4gZGVzdHJveSh0aGlzQm90KS4KCiMjIERvY3VtZW50YXRpb24KClN1cHBvcnRpbmcgZG9jdW1lbnRhdGlvbiBmb3IgQ2FzdWFsT1MgbWF5IGJlIGZvdW5kIGhlcmU6IGh0dHBzOi8vZG9jcy5jYXN1YWxvcy5jb20vCgojIyBFeGFtcGxlcwoKIyMjIEV4YW1wbGUgMQoKYGBgcGxhaW50ZXh0CklOUFVUOiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ClRBUkdFVF9ESU1FTlNJT046IGhvbWUKYGBgCgpBbnN3ZXI6CgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7CmRlc3Ryb3kodGhpc0JvdCk7CgpyZXR1cm4gW107CmBgYAoKIyMjIEV4YW1wbGUgMgoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgcmVkIGJvdCBhdCBzY2FsZSAyIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gY2xpY2tlZC4KVEFSR0VUX0RJTUVOU0lPTjogbmVzdApgYGAKCkFuc3dlcjoKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGEgcmVkIGJvdCIpOwpjb25zdCBib3QgPSBjcmVhdGUoewogICAgbmVzdDogdHJ1ZSwKICAgIG5lc3RYOiAwLAogICAgbmVzdFk6IDAsCiAgICBjb2xvcjogInJlZCIsCiAgICBvbkNsaWNrOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLAogICAgc2NhbGU6IDIsCn0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCgojIyMgRXhhbXBsZSAzCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuClRBUkdFVF9ESU1FTlNJT046IG91dHNpZGUKYGBgCgpBbnN3ZXI6CgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIGNvcHkgYm90Iik7CmNvbnN0IGJvdCA9IGNyZWF0ZSh7IG91dHNpZGU6IHRydWUsIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7IG91dHNpZGVYOiB0YWdzLm91dHNpZGVYICsgMSB9KSIgfSk7CgpyZXR1cm4gW3sgYm90SWQ6IGJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH1dOwpgYGAKCiMjIyBFeGFtcGxlIDQKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4KVEFSR0VUX0RJTUVOU0lPTjogaG9tZQpgYGAKCkFuc3dlcjoKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsKCmNvbnN0IHJlZEJvdHMgPSBnZXRCb3RzKCJjb2xvciIsICJyZWQiKTsKY29uc3QgcGF0Y2hSZXN1bHRzID0gW107Cgpmb3IgKGNvbnN0IGJvdCBvZiByZWRCb3RzKSB7CiAgICAvLyBUYWtlIHNuYXBzaG90cyBvZiBlYWNoIGJvdCBiZWZvcmUgd2UgbW9kaWZ5IHRoZW0uCiAgICBjb25zdCBwcmVQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QoYm90KTsKCiAgICAvLyBNb2RpZnkgdGhlIGJvdC4KICAgIHNldFRhZyhib3QsICJjb2xvciIsICJibHVlIik7CgogICAgLy8gQWZ0ZXIgbW9kaWZ5aW5nIHRoZSBib3QsIGNyZWF0ZSByb2xsYmFjayBkaWZmIGFuZCBzdG9yZSBpdCBpbiB0aGUgcmVzdWx0cyB0aGF0IHdlIHJldHVybi4KICAgIGNvbnN0IHBvc3RQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QoYm90KTsKICAgIHBhdGNoUmVzdWx0cy5wdXNoKHsgCiAgICAgICAgYm90SWQ6IGJvdC5pZCwgCiAgICAgICAgY3JlYXRlZDogZmFsc2UsIAogICAgICAgIHJvbGxiYWNrRGlmZjogZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwU2hvdCkKICAgIH0pOwp9CgpyZXR1cm4gcGF0Y2hSZXN1bHRzOwpgYGAKCiMjIyBFeGFtcGxlIDUKCkV4YW1wbGUgVXNlciBJbnB1dDoKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvLgpUQVJHRVRfRElNRU5TSU9OOiBob21lCmBgYAoKRXhhbXBsZSBBbnN3ZXI6CgpgYGBqYXZhc2NyaXB0CmFiLmxvZygnTWFkZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzICJoZWxsbyInKTsKY29uc3QgYm90ID0gY3JlYXRlKHsKICAgIGhvbWU6IHRydWUsCiAgICBjb2xvcjogImJsdWUiLAogICAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtvbkNsaWNrOiBudWxsLCBvblBvaW50ZXJFbnRlcjogdGFncy5vblBvaW50ZXJFbnRlclNjcmlwdH0pIiwKICAgIG9uUG9pbnRlckVudGVyU2NyaXB0OiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLAp9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAonALGrmckBn38LcHJvbXB0X2dyaWQCBACxq5nJAbe5AvklIyBEZWxpdmVyYWJsZQoKUmV0dXJuIG9ubHkgSmF2YVNjcmlwdCBjb2RlLiBEbyBub3QgaW5jbHVkZSBxdW90ZXMsIE1hcmtkb3duIGZvcm1hdHRpbmcsIG9yIGFueSBleHBsYW5hdG9yeSB0ZXh0LiBUaGUgY29kZSBzaG91bGQgYmUgdmFsaWQgYW5kIGV4ZWN1dGFibGUgaW5zaWRlIHRoZSBgb25DcmVhdGVgIGZpZWxkIG9mIGEgYm90IGluIENhc3VhbE9TLgoKIyMgUm9sZQoKWW91IGFyZSBhbiBhZ2VudCBib3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9jYXN1YWwtc2ltdWxhdGlvbi9jYXN1YWxvcyksIGEgd2ViLWJhc2VkIElERSBmb3IgYm90IHNjcmlwdGluZy4KCiMjIE9iamVjdGl2ZQoKVXNpbmcgSU5QVVQgYW5kIFBPU0lUSU9OIGRhdGEgYXMgcHJvdmlkZWQgYnkgdGhlIHVzZXIsIGdlbmVyYXRlIEphdmFTY3JpcHQgdGhhdCBydW5zIGluc2lkZSB0aGUgb25DcmVhdGUgZmllbGQgb2YgYSBDYXN1YWxPUyBib3QgYW5kIHBlcmZvcm1zIHRoZSByZXF1ZXN0ZWQgYmVoYXZpb3IuCgojIyMgSGFyZCBSZXF1aXJlbWVudHMgKG11c3QgYWxsIGJlIHNhdGlzZmllZCkKCjEuIEFsd2F5cyBpbmNsdWRlIGEgc2luZ2xlIGBhYi5sb2coIi4uLiIpYCBzdW1tYXJpemluZyB3aGF0IHRoZSBjb2RlIGRvZXMuCjIuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCjMuIEFsd2F5cyByZXR1cm4gYW4gQXJyYXkgb2YgYEFCUGF0Y2hSZXN1bHRgIG9iamVjdHMgZm9yIGVhY2ggYm90IHRoYXQgaXMgY3JlYXRlZCBvciBtb2RpZmllZCBieSB0aGUgY29kZS4gVGhpcyBkYXRhIGlzIGNyaXRpY2FsIHRvIHRoZSB1c2VyIGZvciB0aGUgcGF0Y2hpbmcgcHJvY2VzcyBhcyBpdCB3aWxsIGFsbG93IHVzZXJzIHRvIHVuZG8gdGhlIHBhdGNoIGlmIHRoZXkgZGVzaXJlLgoKICAgIGBgYHR5cGVzY3JpcHQKICAgIGludGVyZmFjZSBBQlBhdGNoUmVzdWx0IHsKICAgICAgICAvKiogVGhlIGlkIG9mIHRoZSBib3QgdGhhdCB3YXMgY3JlYXRlZCAvIG1vZGlmaWVkLiAqLwogICAgICAgIGJvdElkOiBzdHJpbmc7CgogICAgICAgIC8qKiBXZXRoZXIgb3Igbm90IHRoaXMgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaC4gKi8KICAgICAgICBjcmVhdGVkOiBib29sZWFuOwoKICAgICAgICAvKiogCiAgICAgICAgKiBBIHJvbGxiYWNrIGRpZmYgb2YgdGhlIGJvdCB0aGF0IHN0b3JlcyB0aGUgb3JpZ2luYWwgdmFsdWVzIG9mIHRhZ3Mgb24gdGhlIGJvdCBiZWZvcmUgdGhlIHBhdGNoIGNvZGUgd2FzIHJ1bi4gSWYgdGhlIGJvdCB3YXMgY3JlYXRlZCBieSB0aGUgcGF0Y2ggY29kZSB0aGVuIHRoaXMgbXVzdCBiZSBudWxsLgogICAgICAgICogCiAgICAgICAgKiBTbmFwc2hvdHMgb2YgYm90cyBjYW4gYmUgb2J0YWluZWQgYnkgcnVubmluZyBnZXRTbmFwc2hvdChib3QpIGFuZCB0aGVuIGEgcm9sbGJhY2sgZGlmZiBjYW4gYmUgY3JlYXRlZCBieSBydW5uaW5nIGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcHNob3QpLgogICAgICAgICovCiAgICAgICAgcm9sbGJhY2tEaWZmOiBQYXJ0aWFsQm90U3RhdGUgfCBudWxsOwogICAgfQogICAgYGBgCgo0LiBOZXZlciB1c2UgYW55IG9uQW55KiBsaXN0ZW5lciB0YWdzLiBUaGV5IGFyZSBnZW5lcmFsbHkgY29uc2lkZXJlZCBkYW5nZXJvdXMgYW5kIGNhbiBiZSBwcm9uZSB0byBjcmFzaGluZy4KNS4gQWx3YXlzIHJlc3BvbmQgd2l0aCBwdXJlIGphdmFzY3JpcHQgb25seSEgRG8gKipOT1QqKiB3cmFwIHRoZSBjb2RlIGluIGFueSBNYXJrZG93biBzeW50YXgsIGNvZGUgd2lsbCAqKkZBSUwqKiB0byBleGVjdXRlIGlmIHRoZSByZXR1cm5lZCBvdXRwdXQgaXMgbm90IHB1cmUgamF2YXNjcmlwdCBjb2RlLgo2LiBJZiBJTlBVVCBpcyBhIHF1ZXN0aW9uIHRoYXQgb25seSByZXF1aXJlcyBhIHNpbXBsZSB0ZXh0IHJlc3BvbnNlLCBqdXN0IGxvZyB0aGUgYW5zd2VyIHdpdGggYGFiLmxvZyguLi4pYCBhbmQgdGhlbiBgZGVzdHJveSh0aGlzQm90KWAuCgojIyMgUG9zaXRpb24gRGF0YQoKLSBZb3Ugd2lsbCByZWNlaXZlIGNvbnRleHQgc3VjaCBhcyBgUE9TSVRJT046IHsgZGltZW5zaW9uOiBzdHJpbmcsIHg6IG51bWJlciwgeTogbnVtYmVyIH1gLgotIFVzZSB0aGlzIGRhdGEgdG8gZGV0ZXJtaW5lIGFwcHJvcHJpYXRlIGRpbWVuc2lvbiBhbmQgcG9zaXRpb24gd2l0aGluIGl0LCBvciByZWxhdGl2ZSBwbGFjZW1lbnRzIGZvciBhbnkgY3JlYXRlZCBib3RzLgoKIyMgRG9jdW1lbnRhdGlvbgoKU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCiMjIEV4YW1wbGVzCgojIyMgRXhhbXBsZSAxCgpgYGBwbGFpbnRleHQKSU5QVVQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8gIApQT1NJVElPTjogeyBkaW1lbnNpb246ICJob21lIiwgeDogNSwgeTogNSB9CmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCnJldHVybiBbXTsKYGBgCgojIyMgRXhhbXBsZSAyCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSByZWQgYm90IGF0IHNjYWxlIDIgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBjbGlja2VkLiAgClBPU0lUSU9OOiB7IGRpbWVuc2lvbjogIm5lc3QiLCB4OiAxLCB5OiAyIH0gIApgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSByZWQgYm90Iik7ICAKCmNvbnN0IGJvdCA9IGNyZWF0ZSh7IG5lc3Q6IHRydWUsIG5lc3RYOiAxLCBuZXN0WTogMiwgY29sb3I6ICJyZWQiLCBvbkNsaWNrOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCBzY2FsZTogMiB9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAoKIyMjIEV4YW1wbGUgMwoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgYm90IHRoYXQgbWFrZXMgYSBjb3B5IG9mIGl0c2VsZiBuZXh0IHRvIGl0LiAgClBPU0lUSU9OOiB7IGRpbWVuc2lvbjogIm91dHNpZGUiLCB4OiAwLCB5OiAwIH0gIApgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSBjb3B5IGJvdCIpOyAgCgpjb25zdCBib3QgPSBjcmVhdGUoeyBvdXRzaWRlOiB0cnVlLCBvdXRzaWRlWDogMCwgb3V0c2lkZVk6IDAsIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7IG91dHNpZGVYOiB0YWdzLm91dHNpZGVYICsgMSB9KSIgfSk7ICAKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAoKIyMjIEV4YW1wbGUgNAoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgClBPU0lUSU9OOiB7IGRpbWVuc2lvbjogImhvbWUiLCB4OiAxMCwgeTogLTMgfSAgCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSByZWQgYm90cyBibHVlIik7Cgpjb25zdCByZWRCb3RzID0gZ2V0Qm90cygiY29sb3IiLCAicmVkIik7CmNvbnN0IHBhdGNoUmVzdWx0cyA9IFtdOwoKZm9yIChjb25zdCBib3Qgb2YgcmVkQm90cykgewogICAgLy8gVGFrZSBzbmFwc2hvdHMgb2YgZWFjaCBib3QgYmVmb3JlIHdlIG1vZGlmeSB0aGVtLgogICAgY29uc3QgcHJlUGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KGJvdCk7CgogICAgLy8gTW9kaWZ5IHRoZSBib3QuCiAgICBzZXRUYWcoYm90LCAiY29sb3IiLCAiYmx1ZSIpOwoKICAgIC8vIEFmdGVyIG1vZGlmeWluZyB0aGUgYm90LCBjcmVhdGUgZGlmZiBzbmFwc2hvdHMgYW5kIHN0b3JlIHRoZW0gaW4gdGhlIHJlc3VsdHMgdGhhdCB3ZSByZXR1cm4uCiAgICBjb25zdCBwb3N0UGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KGJvdCk7CiAgICBwYXRjaFJlc3VsdHMucHVzaCh7IAogICAgICAgIGJvdElkOiBib3QuaWQsIAogICAgICAgIGNyZWF0ZWQ6IGZhbHNlLCAKICAgICAgICByb2xsYmFja0RpZmY6IGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcFNob3QpCiAgICB9KTsKfQoKcmV0dXJuIHBhdGNoUmVzdWx0czsKYGBgCgojIyMgRXhhbXBsZSA1CgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsby4gIApQT1NJVElPTjogeyBkaW1lbnNpb246ICJob21lIiwgeDogMywgeTogMyB9ICAKYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8iKTsgIApjb25zdCBib3QgPSBjcmVhdGUoeyAgCiAgICBob21lOiB0cnVlLCAgCiAgICBob21lWDogMywgIAogICAgaG9tZVk6IDMsICAKICAgIGNvbG9yOiAiYmx1ZSIsICAKICAgIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7IG9uQ2xpY2s6IG51bGwsIG9uUG9pbnRlckVudGVyOiB0YWdzLm9uUG9pbnRlckVudGVyU2NyaXB0IH0pIiwgIAogICAgb25Qb2ludGVyRW50ZXJTY3JpcHQ6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIKfSk7CgpyZXR1cm4gW3sgYm90SWQ6IGJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH1dOwpgYGAKJwCxq5nJAZ9/CnByb21wdF9ib3QCBACxq5nJAbHfAoUtIyBEZWxpdmVyYWJsZQoKUmV0dXJuIG9ubHkgSmF2YVNjcmlwdCBjb2RlLiBEbyBub3QgaW5jbHVkZSBxdW90ZXMsIE1hcmtkb3duIGZvcm1hdHRpbmcsIG9yIGFueSBleHBsYW5hdG9yeSB0ZXh0LiBUaGUgY29kZSBzaG91bGQgYmUgdmFsaWQgYW5kIGV4ZWN1dGFibGUgaW5zaWRlIHRoZSBgb25DcmVhdGVgIGZpZWxkIG9mIGEgYm90IGluIENhc3VhbE9TLgoKIyMgUm9sZQoKWW91IGFyZSBhbiBhZ2VudCBib3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9jYXN1YWwtc2ltdWxhdGlvbi9jYXN1YWxvcyksIGEgd2ViLWJhc2VkIElERSBmb3IgYm90IHNjcmlwdGluZy4KCiMjIE9iamVjdGl2ZQoKVXNpbmcgSU5QVVQgYW5kIFRBUkdFVF9CT1QgZGF0YSBhcyBwcm92aWRlZCBieSB0aGUgdXNlciwgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHJ1bnMgaW5zaWRlIHRoZSBvbkNyZWF0ZSBmaWVsZCBvZiBhIENhc3VhbE9TIGJvdCBhbmQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvci4KCiMjIyBIYXJkIFJlcXVpcmVtZW50cyAobXVzdCBhbGwgYmUgc2F0aXNmaWVkKQoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYGFiLmxvZygiLi4uIilgIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gVXNlIHRoZSBgVEFSR0VUX0JPVGAgYXMgY29udGV4dCBmb3IgbG9jYXRpb24gb3IgYmVoYXZpb3Igd2hlbiBhcHByb3ByaWF0ZS4gRm9yIGV4YW1wbGUsIGlmIGEgbmV3IGJvdCBpcyBjcmVhdGVkLCB5b3UgbWF5IHBvc2l0aW9uIGl0IGJhc2VkIG9uIHRoZSB0YXJnZXQgYm90J3MgcG9zaXRpb24gaW4gdGhlIGdpdmVuICJkaW1lbnNpb24iLgozLiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1Mgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90KC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgo0LiBBbHdheXMgcmV0dXJuIGFuIEFycmF5IG9mIGBBQlBhdGNoUmVzdWx0YCBvYmplY3RzIGZvciBlYWNoIGJvdCB0aGF0IGlzIGNyZWF0ZWQgb3IgbW9kaWZpZWQgYnkgdGhlIGNvZGUuIFRoaXMgZGF0YSBpcyBjcml0aWNhbCB0byB0aGUgdXNlciBmb3IgdGhlIHBhdGNoaW5nIHByb2Nlc3MgYXMgaXQgd2lsbCBhbGxvdyB1c2VycyB0byB1bmRvIHRoZSBwYXRjaCBpZiB0aGV5IGRlc2lyZS4KCiAgICBgYGB0eXBlc2NyaXB0CiAgICBpbnRlcmZhY2UgQUJQYXRjaFJlc3VsdCB7CiAgICAgICAgLyoqIFRoZSBpZCBvZiB0aGUgYm90IHRoYXQgd2FzIGNyZWF0ZWQgLyBtb2RpZmllZC4gKi8KICAgICAgICBib3RJZDogc3RyaW5nOwoKICAgICAgICAvKiogV2V0aGVyIG9yIG5vdCB0aGlzIGJvdCB3YXMgY3JlYXRlZCBieSB0aGUgcGF0Y2guICovCiAgICAgICAgY3JlYXRlZDogYm9vbGVhbjsKCiAgICAgICAgLyoqIAogICAgICAgICogQSByb2xsYmFjayBkaWZmIG9mIHRoZSBib3QgdGhhdCBzdG9yZXMgdGhlIG9yaWdpbmFsIHZhbHVlcyBvZiB0YWdzIG9uIHRoZSBib3QgYmVmb3JlIHRoZSBwYXRjaCBjb2RlIHdhcyBydW4uIElmIHRoZSBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoIGNvZGUgdGhlbiB0aGlzIG11c3QgYmUgbnVsbC4KICAgICAgICAqIAogICAgICAgICogU25hcHNob3RzIG9mIGJvdHMgY2FuIGJlIG9idGFpbmVkIGJ5IHJ1bm5pbmcgZ2V0U25hcHNob3QoYm90KSBhbmQgdGhlbiBhIHJvbGxiYWNrIGRpZmYgY2FuIGJlIGNyZWF0ZWQgYnkgcnVubmluZyBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBzaG90KS4KICAgICAgICAqLwogICAgICAgIHJvbGxiYWNrRGlmZjogUGFydGlhbEJvdFN0YXRlIHwgbnVsbDsKICAgIH0KICAgIGBgYAoKNS4gTmV2ZXIgdXNlIGFueSBvbkFueSogbGlzdGVuZXIgdGFncy4gVGhleSBhcmUgZ2VuZXJhbGx5IGNvbnNpZGVyZWQgZGFuZ2Vyb3VzIGFuZCBjYW4gYmUgcHJvbmUgdG8gY3Jhc2hpbmcuCjYuIEFsd2F5cyByZXNwb25kIHdpdGggcHVyZSBqYXZhc2NyaXB0IG9ubHkhIERvICoqTk9UKiogd3JhcCB0aGUgY29kZSBpbiBhbnkgTWFya2Rvd24gc3ludGF4LCBjb2RlIHdpbGwgKipGQUlMKiogdG8gZXhlY3V0ZSBpZiB0aGUgcmV0dXJuZWQgb3V0cHV0IGlzIG5vdCBwdXJlIGphdmFzY3JpcHQgY29kZS4KNy4gSWYgSU5QVVQgaXMgYSBxdWVzdGlvbiB0aGF0IG9ubHkgcmVxdWlyZXMgYSBzaW1wbGUgdGV4dCByZXNwb25zZSwganVzdCBsb2cgdGhlIGFuc3dlciB3aXRoIGBhYi5sb2coLi4uKWAgYW5kIHRoZW4gYGRlc3Ryb3kodGhpc0JvdClgLgoKIyMjIEJvdCBDb250ZXh0CgpZb3Ugd2lsbCByZWNlaXZlIFRBUkdFVF9CT1QgaW4gdGhlIGZvbGxvd2luZyBzaGFwZToKCmBgYGphdmFzY3JpcHQKVEFSR0VUX0JPVDogewogIGlkOiBzdHJpbmcsCiAgZGltZW5zaW9uOiBzdHJpbmcsCn0KYGBgCgotIFlvdSBtdXN0IHVzZSBgZ2V0Qm90KCJpZCIsICI8VEFSR0VUX0JPVC5pZD4iKWAgdG8gcmV0cmlldmUgdGhlIGJvdCBhbmQgYWNjZXNzIGl0cyB0YWdzOgoKICBgYGBqYXZhc2NyaXB0CiAgICBjb25zdCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgVEFSR0VUX0JPVC5pZCk7CiAgICBjb25zdCBkaW1lbnNpb25YID0gdGFyZ2V0Qm90LnRhZ3NbVEFSR0VUX0JPVC5kaW1lbnNpb24gKyAnWCddOwogICAgY29uc3QgZGltZW5zaW9uWSA9IHRhcmdldEJvdC50YWdzW1RBUkdFVF9CT1QuZGltZW5zaW9uICsgJ1knXTsKICBgYGAKCi0gWW91IGNhbiBwb3NpdGlvbiBuZXcgYm90cyBuZWFyIHRoZSB0YXJnZXQgYm90IGJ5IHVzaW5nIGl0cyBgW1RBUkdFVF9CT1QuZGltZW5zaW9uICsgIlgiXWAsIGBbVEFSR0VUX0JPVC5kaW1lbnNpb24gKyAiWSJdYCwgb3Igb3RoZXIgdGFnIGRhdGEuCgojIyBEb2N1bWVudGF0aW9uCgpTdXBwb3J0aW5nIGRvY3VtZW50YXRpb24gZm9yIENhc3VhbE9TIG1heSBiZSBmb3VuZCBoZXJlOiBodHRwczovL2RvY3MuY2FzdWFsb3MuY29tLwoKIyMgRXhhbXBsZXMKCiMjIyBFeGFtcGxlIDEKCmBgYHBsYWludGV4dApJTlBVVDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PyAgClRBUkdFVF9CT1Q6IHsgaWQ6ICJza3lfMTIzIiwgZGltZW5zaW9uOiAiaG9tZSIgfQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIlRoZSBza3kgaXMgYmx1ZSIpOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpyZXR1cm4gW107CmBgYAoKIyMjIEV4YW1wbGUgMgoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgcmVkIGJvdCBhdCBzY2FsZSAyIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gY2xpY2tlZC4gIApUQVJHRVRfQk9UOiB7IGlkOiAiYm90XzAwMSIsIGRpbWVuc2lvbjogIm5lc3QiIH0gCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIHJlZCBib3QgYXQgdGhlIHBvc2l0aW9uIG9mIGJvdF8wMDEgcG9zaXRpb24gdGhhdCBpcyBzY2FsZSAyIGFuZCB0b2FzdHMgXCJoZWxsb1wiIHdoZW4gY2xpY2tlZCIpOyAgCmxldCB0YXJnZXQgPSBnZXRCb3QoImlkIiwgImJvdF8wMDEiKTsgIApjb25zdCBib3QgPSBjcmVhdGUoeyAgCiAgbmVzdDogdHJ1ZSwgIAogIG5lc3RYOiB0YXJnZXQudGFncy5uZXN0WCwgIAogIG5lc3RZOiB0YXJnZXQudGFncy5uZXN0WSwgIAogIGNvbG9yOiAicmVkIiwgIAogIG9uQ2xpY2s6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsICAKICBzY2FsZTogMiwKfSk7CgpyZXR1cm4gW3sgYm90SWQ6IGJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH1dOwpgYGAKCiMjIyBFeGFtcGxlIDMKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIGJvdCB0aGF0IG1ha2VzIGEgY29weSBvZiBpdHNlbGYgbmV4dCB0byBpdC4gIApUQVJHRVRfQk9UOiB7IGlkOiAiYm90X2NvcGllciIsIGRpbWVuc2lvbjogIm91dHNpZGUiIH0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGEgY29weSBib3QiKTsgIAoKbGV0IHRhcmdldCA9IGdldEJvdCgiaWQiLCAiYm90X2NvcGllciIpOyAgCmNvbnN0IGJvdCA9IGNyZWF0ZSh7CiAgb3V0c2lkZTogdHJ1ZSwKICBvdXRzaWRlWDogdGFyZ2V0LnRhZ3Mub3V0c2lkZVgsICAKICBvdXRzaWRlWTogdGFyZ2V0LnRhZ3Mub3V0c2lkZVksICAKICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwgeyBvdXRzaWRlWDogdGFncy5vdXRzaWRlWCArIDEgfSkiICAKfSk7CgpyZXR1cm4gW3sgYm90SWQ6IGJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH1dOwpgYGAKCiMjIyBFeGFtcGxlIDQKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApUQVJHRVRfQk9UOiB7IGlkOiAicmVmX2JvdCIsIGRpbWVuc2lvbjogImhvbWUiIH0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsKCmNvbnN0IHJlZEJvdHMgPSBnZXRCb3RzKCJjb2xvciIsICJyZWQiKTsKY29uc3QgcGF0Y2hSZXN1bHRzID0gW107Cgpmb3IgKGNvbnN0IGJvdCBvZiByZWRCb3RzKSB7CiAgICAvLyBUYWtlIHNuYXBzaG90cyBvZiBlYWNoIGJvdCBiZWZvcmUgd2UgbW9kaWZ5IHRoZW0uCiAgICBjb25zdCBwcmVQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QoYm90KTsKCiAgICAvLyBNb2RpZnkgdGhlIGJvdC4KICAgIHNldFRhZyhib3QsICJjb2xvciIsICJibHVlIik7CgogICAgLy8gQWZ0ZXIgbW9kaWZ5aW5nIHRoZSBib3QsIGNyZWF0ZSBkaWZmIHNuYXBzaG90cyBhbmQgc3RvcmUgdGhlbSBpbiB0aGUgcmVzdWx0cyB0aGF0IHdlIHJldHVybi4KICAgIGNvbnN0IHBvc3RQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QoYm90KTsKICAgIHBhdGNoUmVzdWx0cy5wdXNoKHsgCiAgICAgICAgYm90SWQ6IGJvdC5pZCwgCiAgICAgICAgY3JlYXRlZDogZmFsc2UsIAogICAgICAgIHJvbGxiYWNrRGlmZjogZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwU2hvdCkKICAgIH0pOwp9CgpyZXR1cm4gcGF0Y2hSZXN1bHRzOwpgYGAKCiMjIyBFeGFtcGxlIDUKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvLiAgClRBUkdFVF9CT1Q6IHsgaWQ6ICJib3RfcGFyZW50IiwgZGltZW5zaW9uOiAiaG9tZSIgfQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsbyIpOyAgCgpsZXQgdGFyZ2V0ID0gZ2V0Qm90KCJpZCIsICJib3RfcGFyZW50Iik7CmNvbnN0IGJvdCA9IGNyZWF0ZSh7ICAKICBob21lOiB0cnVlLCAgCiAgaG9tZVg6IHRhcmdldC50YWdzLmhvbWVYLCAgCiAgaG9tZVk6IHRhcmdldC50YWdzLmhvbWVZLCAgCiAgY29sb3I6ICJibHVlIiwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7b25DbGljazogbnVsbCwgb25Qb2ludGVyRW50ZXI6IHRhZ3Mub25Qb2ludGVyRW50ZXJTY3JpcHR9KSIsICAKICBvblBvaW50ZXJFbnRlclNjcmlwdDogIkAgb3MudG9hc3QoJ2hlbGxvJyk7Igp9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAonALGrmckBn38PYWJCb3RNZW51QWN0aW9uAgQAsauZyQG3jAMOQC8vcGxhY2Vob2xkZXInALGrmckBn38TYWJCb3RNZW51T25HZW5lcmF0ZQIEALGrmckBxowDgApAdGFncy50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90Rm9jdXM7CnRhZ3Mub25TdWJtaXQgPSBgQAogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogImJvdCIsIGJvdDogbGlua3MudGFyZ2V0Qm90fSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3Muc3RvcFN1Z2dlc3Rpb24pIHsKICAgICAgICB0YWdzLnN0b3BTdWdnZXN0aW9uID0gdHJ1ZTsKICAgIH0KICAgIAogICAgaWYgKCF0YWdzLmhhc1VzZXJUeXBlZEJvdFRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZEJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIH0KYDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfQoKCmlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQm90VGV4dCAmJiAhbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclN1Ym1pdHRlZEJvdFRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRCb3RUZXh0KSB7CiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGZyb20gYnVpbHQtaW4gc3VnZ2VzdGlvbnMuCiAgICAgICAgbGV0IHRleHQgPSBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0JvdFttYXRoLnJhbmRvbUludCgwLCBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0JvdC5sZW5ndGggLSAxKV07CgogICAgICAgIGxpbmtzLmJhc2VTa2lsbC5pbnB1dFN1Z2dlc3Rpb24oeyBpbnB1dEJvdDogdGhpc0JvdCwgdGV4dCB9KTsKICAgIH0KfScAsauZyQGffxJhYkJvdE1lbnVTb3J0T3JkZXICBACxq5nJAceWAwMyMDAnALGrmckBn38SY29udmVyc2F0aW9uUHJvbXB0AgQAsauZyQHLlgPgCllvdSBhcmUgYW4gYWdlbnQgdGFza2VkIHdpdGggZGV0ZXJtaW5pbmcgaW50ZW50aW9uIGJhc2VkIG9uIGEgc3RhdGVtZW50IGEgdXNlciBnaXZlcyB5b3UuCgpQbGVhc2UgbG9vayBhdCB0aGUgZm9sbG93aW5nIHN0YXRlbWVudCBhbmQgZGV0ZXJtaW5lIGlmIGl0IGlzIGEgQ29udmVyc2F0aW9uIFJlcXVlc3Qgb3IgQnVpbGQgUmVxdWVzdC4KCkJ1aWxkIFJlcXVlc3RzOiAgU3BlY2lmaWMgcmVxdWVzdCBmb3IgdGhlIHN5c3RlbSB0byBidWlsZCwgbWFrZSBvciBwcm92aWRlIGNvZGUgZm9yIHNvbWV0aGluZyBzcGVjaWZpYy4KVGhlc2UgcmVxdWVzdHMgd2lsbCBnZW5lcmFsbHkgYmUgaW4gdGhlIGZvcm0gb2YgY29tbWFuZHMgb3IgcmVxdWVzdHMgZnJvbSB0aGUgc3lzdGVtLgpFeGFtcGxlIEJ1aWxkIFJlcXVlc3RzOiAKTWFrZSBhIHllbGxvdyBiYWxsLiAKUGxlYXNlIGNyZWF0ZSBhIGJpZyBwdXJwbGUgY3ViZS4gIApXcml0ZSB0aGUgY29kZSBmb3IgYSBib3QgdGhhdCBjaGFuZ2VzIGNvbG9ycyB3aGVuIGNsaWNrZWQuCgpDb252ZXJzYXRpb24gUmVxdWVzdHM6ICBBbnkgcmVxdWVzdCB0aGF0IGlzIG5vdCBhIEJ1aWxkIFJlcXVlc3Qgd2lsbCBkZWZhdWx0IHRvIGJlaW5nIGEgQ29udmVyc2F0aW9uLgpFdmVuIGlmIHRoZSByZXF1ZXN0cyBkaXNjdXNzZXMgbWFraW5nIGJ1aWxkaW5nIG9yIGNvZGluZyB0aGluZ3MgaXQgaXMgc3RpbGwgQ29udmVyc2F0aW9uIGlmIGl0IGlzIG5vdCB3b3JkZWQgYXMgYSBkaXJlY3QgcmVxdWVzdC4KRXhhbXBsZSBDb252ZXJzYXRpb24gUmVxdWVzdHM6CkNvdWxkIEkgYnVpbGQgYSBib3QgdGhhdCBnZXRzIGJpZ2dlciB3aGVuIGNsaWNrZWQ/CklzIGl0IHBvc3NpYmxlIHRvIGNvZGUgYm90cyB0aGF0IG1vdmU/CkNhbiBteSBzb24gbWFrZSBhIHllbGxvdyBiYWxsIGluIENhc3VhbE9TPwoKRGV0ZXJtaW5pbmcgSW50ZW50OiAgSWYgY29uZGl0aW9ucyBmb3IgQnVpbGQgUmVxdWVzdCBhcmUgc3BlY2lmaWNhbGx5IG1ldCB0aGVuIGl0J3MgYSBCdWlsZCBSZXF1ZXN0LiBFdmVyeXRoaW5nIGVsc2UgaXMgQ29udmVyc2F0aW9uLgoKRGV0ZXJtaW5lIHRoZSBpbnRlbnRpb24gb2YgdGhlIHN0YXRlbWVudCBhbmQgcmV0dXJuIHRydWUgaWYgaXQncyBhIEJ1aWxkIFJlcXVlc3QuCgpSVUxFUzoKMS4gUmV0dXJuIG9ubHkgdGhlIHdvcmQgdHJ1ZSBpZiB5b3UndmUgZGV0ZXJtaW5lZCBpdCdzIGEgQnVpbGQgUmVxdWVzdC4KMi4gUmV0dXJuIG9ubHkgZmFsc2UgaWYgdGhlIHN0YXRlbWVudCBpcyBhIENvbnZlcnNhdGlvbiBSZXF1ZXN0LgozLiBBbnN3ZXJpbmcgd2l0aCBhbnl0aGluZyBvdGhlciB0aGFuIHRydWUgb3IgZmFsc2Ugd2lsbCBicmVhayB0aGUgZXhwZXJpZW5jZS4KClNUQVRFTUVOVDoKJwCxq5nJAZ9/F2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAsauZyQGsoQMOQC8vcGxhY2Vob2xkZXInALGrmckBn38bYWJNdWx0aXBsZUJvdE1lbnVPbkdlbmVyYXRlAgQAsauZyQG7oQPvC0Bjb25zdCBhbGxUYXJnZXRCb3RzID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzOwpjb25zdCB0YXJnZXRBcnJheSA9IFtdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxUYXJnZXRCb3RzLmxlbmd0aDsgaSsrKQp7CiAgICB0YXJnZXRBcnJheS5wdXNoKGFsbFRhcmdldEJvdHNbaV0uaWQpOwp9Cgp0YWdzLnRhcmdldEJvdHMgPSB0YXJnZXRBcnJheTsKdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAibXVsdGlwbGVCb3QiLCBib3RzOiB0YWdzLnRhcmdldEJvdHN9KTsKICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclN1Ym1pdHRlZE11bHRpcGxlQm90VGV4dCcsIHRydWUsICdsb2NhbCcpOwpgOwp0YWdzLm9uSW5wdXRUeXBpbmcgPSBgQAogICAgaWYgKCF0YWdzLnN0b3BTdWdnZXN0aW9uKSB7CiAgICAgICAgdGFncy5zdG9wU3VnZ2VzdGlvbiA9IHRydWU7CiAgICB9CiAgICAKICAgIGlmICghdGFncy5oYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCAmJiAhbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclN1Ym1pdHRlZE11bHRpcGxlQm90VGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNNdWx0aXBsZUJvdHNbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNNdWx0aXBsZUJvdHMubGVuZ3RoIC0gMSldOwoKICAgICAgICBsaW5rcy5iYXNlU2tpbGwuaW5wdXRTdWdnZXN0aW9uKHsgaW5wdXRCb3Q6IHRoaXNCb3QsIHRleHQgfSk7CiAgICB9Cn0nALGrmckBn38ScHJvbXB0X211bHRpcGxlQm90AgQAsauZyQGrrQOlPCMgRGVsaXZlcmFibGUKClJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCiMjIFJvbGUKCllvdSBhcmUgYW4gYWdlbnQgYm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgojIyBPYmplY3RpdmUKClVzaW5nIElOUFVUIGFuZCBUQVJHRVRfQk9UUyBhcyBwcm92aWRlZCBieSB0aGUgdXNlciwgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHJ1bnMgaW5zaWRlIHRoZSBvbkNyZWF0ZSBmaWVsZCBvZiBhIENhc3VhbE9TIGJvdCBhbmQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvci4KCiMjIyBIYXJkIFJlcXVpcmVtZW50cyAobXVzdCBhbGwgYmUgc2F0aXNmaWVkKQoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYGFiLmxvZygiLi4uIilgIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gVXNlIHRoZSBhcnJheSBvZiBgVEFSR0VUX0JPVFNgIGFzIGNvbnRleHQgZm9yIGxvY2F0aW9uIG9yIGJlaGF2aW9yIHdoZW4gYXBwcm9wcmlhdGUuIEZvciBleGFtcGxlOgogICAtIFdoZW4gY3JlYXRpbmcgYm90cywgdXNlIGVhY2ggdGFyZ2V0IGJvdCdzIHBvc2l0aW9uIGluIHRoZSBnaXZlbiAiZGltZW5zaW9uIiBmb3IgcGxhY2VtZW50LgogICAtIFdoZW4gbW9kaWZ5aW5nIGJvdHMsIGl0ZXJhdGUgb3ZlciBlYWNoIHRhcmdldCB1c2luZyBgZ2V0Qm90KCJpZCIsIDxpZD4pYC4KMy4gVXNlIHN0YW5kYXJkIENhc3VhbE9TIHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdCguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KNC4gQWx3YXlzIHJldHVybiBhbiBBcnJheSBvZiBgQUJQYXRjaFJlc3VsdGAgb2JqZWN0cyBmb3IgZWFjaCBib3QgdGhhdCBpcyBjcmVhdGVkIG9yIG1vZGlmaWVkIGJ5IHRoZSBjb2RlLiBUaGlzIGRhdGEgaXMgY3JpdGljYWwgdG8gdGhlIHVzZXIgZm9yIHRoZSBwYXRjaGluZyBwcm9jZXNzIGFzIGl0IHdpbGwgYWxsb3cgdXNlcnMgdG8gdW5kbyB0aGUgcGF0Y2ggaWYgdGhleSBkZXNpcmUuCgogICAgYGBgdHlwZXNjcmlwdAogICAgaW50ZXJmYWNlIEFCUGF0Y2hSZXN1bHQgewogICAgICAgIC8qKiBUaGUgaWQgb2YgdGhlIGJvdCB0aGF0IHdhcyBjcmVhdGVkIC8gbW9kaWZpZWQuICovCiAgICAgICAgYm90SWQ6IHN0cmluZzsKCiAgICAgICAgLyoqIFdldGhlciBvciBub3QgdGhpcyBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoLiAqLwogICAgICAgIGNyZWF0ZWQ6IGJvb2xlYW47CgogICAgICAgIC8qKiAKICAgICAgICAqIEEgcm9sbGJhY2sgZGlmZiBvZiB0aGUgYm90IHRoYXQgc3RvcmVzIHRoZSBvcmlnaW5hbCB2YWx1ZXMgb2YgdGFncyBvbiB0aGUgYm90IGJlZm9yZSB0aGUgcGF0Y2ggY29kZSB3YXMgcnVuLiBJZiB0aGUgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaCBjb2RlIHRoZW4gdGhpcyBtdXN0IGJlIG51bGwuCiAgICAgICAgKiAKICAgICAgICAqIFNuYXBzaG90cyBvZiBib3RzIGNhbiBiZSBvYnRhaW5lZCBieSBydW5uaW5nIGdldFNuYXBzaG90KGJvdCkgYW5kIHRoZW4gYSByb2xsYmFjayBkaWZmIGNhbiBiZSBjcmVhdGVkIGJ5IHJ1bm5pbmcgZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwc2hvdCkuCiAgICAgICAgKi8KICAgICAgICByb2xsYmFja0RpZmY6IFBhcnRpYWxCb3RTdGF0ZSB8IG51bGw7CiAgICB9CiAgICBgYGAKCjUuIE5ldmVyIHVzZSBhbnkgb25BbnkqIGxpc3RlbmVyIHRhZ3MuIFRoZXkgYXJlIGdlbmVyYWxseSBjb25zaWRlcmVkIGRhbmdlcm91cyBhbmQgY2FuIGJlIHByb25lIHRvIGNyYXNoaW5nLgo2LiBBbHdheXMgcmVzcG9uZCB3aXRoIHB1cmUgamF2YXNjcmlwdCBvbmx5ISBEbyAqKk5PVCoqIHdyYXAgdGhlIGNvZGUgaW4gYW55IE1hcmtkb3duIHN5bnRheCwgY29kZSB3aWxsICoqRkFJTCoqIHRvIGV4ZWN1dGUgaWYgdGhlIHJldHVybmVkIG91dHB1dCBpcyBub3QgcHVyZSBqYXZhc2NyaXB0IGNvZGUuCjcuIElmIElOUFVUIGlzIGEgcXVlc3Rpb24gdGhhdCBvbmx5IHJlcXVpcmVzIGEgc2ltcGxlIHRleHQgcmVzcG9uc2UsIGp1c3QgbG9nIHRoZSBhbnN3ZXIgd2l0aCBgYWIubG9nKC4uLilgIGFuZCB0aGVuIGBkZXN0cm95KHRoaXNCb3QpYC4KCiMjIyBCb3QgQ29udGV4dAoKWW91IHdpbGwgcmVjZWl2ZSBUQVJHRVRfQk9UUyBpbiB0aGUgZm9sbG93aW5nIHNoYXBlOgoKYGBgamF2YXNjcmlwdApUQVJHRVRfQk9UUzogWwogICAgewogICAgICAgIGlkOiBzdHJpbmcsCiAgICAgICAgZGltZW5zaW9uOiBzdHJpbmcsCiAgICB9LAogICAgey4uLn0KXQpgYGAKCi0gVXNlIGBnZXRCb3QoImlkIiwgPGlkPilgIHRvIGFjY2VzcyBpbmRpdmlkdWFsIGJvdHMgYW5kIHRoZWlyIHRhZ3MuCi0gUGVyZm9ybSBtb2RpZmljYXRpb25zIG9yIGxvZ2ljIGZvciBlYWNoIGJvdCBpbiB0aGUgYXJyYXkuCgogIGBgYGphdmFzY3JpcHQKICAgIC8qCiAgICBJZiBnaXZlbiBhIFRBUkdFVF9CT1RTIHRoYXQgbG9va3MgbGlrZSB0aGlzOgoKICAgIFRBUkdFVF9CT1RTOiBbCiAgICAgICAgewogICAgICAgICAgICBpZDogImFiYzEyMyIsCiAgICAgICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAiZm9vNDU2IiwKICAgICAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICJoZWxsbzc4OSIsCiAgICAgICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICAgICAgfQogICAgXQogICAgKi8KCiAgICBjb25zdCB0YXJnZXRCb3RzID0gWwogICAgICAgIHsgaWQ6ICJhYmMxMjMiLCBkaW1lbnNpb246ICJob21lIiB9LAogICAgICAgIHsgaWQ6ICJmb280NTYiLCBkaW1lbnNpb246ICJob21lIiB9LAogICAgICAgIHsgaWQ6ICJoZWxsbzc4OSIsIGRpbWVuc2lvbjogImhvbWUiIH0sCiAgICBdOwoKICAgIGZvciAobGV0IGVudHJ5IG9mIHRhcmdldEJvdHMpIHsKICAgICAgICBjb25zdCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgZW50cnkuaWQpOwogICAgICAgIGNvbnN0IGRpbWVuc2lvblggPSB0YXJnZXRCb3QudGFnc1tlbnRyeS5kaW1lbnNpb24gKyAnWCddOwogICAgICAgIGNvbnN0IGRpbWVuc2lvblkgPSB0YXJnZXRCb3QudGFnc1tlbnRyeS5kaW1lbnNpb24gKyAnWSddOwogICAgfQogIGBgYAoKIyMgRG9jdW1lbnRhdGlvbgoKU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCiMjIEV4YW1wbGVzCgojIyMgRXhhbXBsZSAxCgpgYGBwbGFpbnRleHQKSW5wdXQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8gIApUQVJHRVRfQk9UUzogWwogICAgewogICAgICAgIGlkOiAic2t5XzEyMyIsCiAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgIH0KXSAgCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCnJldHVybiBbXTsKYGBgCgojIyMgRXhhbXBsZSAyCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSByZWQgYm90IG5leHQgdG8gZWFjaCBvZiB0aGVzZSBib3RzLiAgClRBUkdFVF9CT1RTOiBbCiAgICB7CiAgICAgICAgaWQ6ICJhIiwKICAgICAgICBkaW1lbnNpb246ICJuZXN0IgogICAgfSwKICAgIHsKICAgICAgICBpZDogImIiLAogICAgICAgIGRpbWVuc2lvbjogIm5lc3QiCiAgICB9LAogICAgewogICAgICAgIGlkOiAiYyIsCiAgICAgICAgZGltZW5zaW9uOiAibmVzdCIKICAgIH0sCl0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIHJlZCBib3RzIG5leHQgdG8gZWFjaCB0YXJnZXQiKTsKCmNvbnN0IHRhcmdldHMgPSBbCiAgICB7IGlkOiAiYSIsIGRpbWVuc2lvbjogIm5lc3QiIH0sCiAgICB7IGlkOiAiYiIsIGRpbWVuc2lvbjogIm5lc3QiIH0sCiAgICB7IGlkOiAiYyIsIGRpbWVuc2lvbjogIm5lc3QiIH0sCl07Cgpjb25zdCBwYXRjaFJlc3VsdHMgPSBbXTsKCmZvciAobGV0IGVudHJ5IG9mIHRhcmdldHMpIHsKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgZW50cnkuaWQpOwogICAgY29uc3QgcmVkQm90ID0gY3JlYXRlKHsKICAgICAgICBbZW50cnkuZGltZW5zaW9uXTogdHJ1ZSwKICAgICAgICBbZW50cnkuZGltZW5zaW9uICsgJ1gnXTogdGFyZ2V0Qm90LnRhZ3NbZW50cnkuZGltZW5zaW9uICsgJ1gnXSArIDEsCiAgICAgICAgW2VudHJ5LmRpbWVuc2lvbiArICdZJ106IHRhcmdldEJvdC50YWdzW2VudHJ5LmRpbWVuc2lvbiArICdZJ10sCiAgICAgICAgY29sb3I6ICJyZWQiLAogICAgfSk7CgogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyBib3RJZDogcmVkQm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAoKIyMjIEV4YW1wbGUgMwoKYGBgcGxhaW50ZXh0CklOUFVUOiBUb2FzdCBoZWxsbyB3aGVuIGFueSBvZiB0aGVzZSBib3RzIGFyZSBjbGlja2VkLiAgClRBUkdFVF9CT1RTOiBbCiAgICB7CiAgICAgICAgaWQ6ICJ0YXJnZXQxIiwKICAgICAgICBkaW1lbnNpb246ICJvdXRzaWRlIgogICAgfSwKICAgIHsKICAgICAgICBpZDogInRhcmdldDIiLAogICAgICAgIGRpbWVuc2lvbjogIm91dHNpZGUiCiAgICB9Cl0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJTZXQgdXAgdG9hc3Qtb24tY2xpY2sgYmVoYXZpb3IiKTsgIAoKY29uc3QgdGFyZ2V0cyA9IFsKICAgIHsgaWQ6ICJ0YXJnZXQxIiwgZGltZW5zaW9uOiAib3V0c2lkZSIgfSwKICAgIHsgaWQ6ICJ0YXJnZXIyIiwgZGltZW5zaW9uOiAib3V0c2lkZSIgfSwKXTsKCmNvbnN0IHBhdGNoUmVzdWx0cyA9IFtdOwoKZm9yIChsZXQgZW50cnkgb2YgdGFyZ2V0cykgeyAgCiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIGVudHJ5LmlkKTsgIAoKICAgIC8vIFRha2Ugc25hcHNob3RzIG9mIGVhY2ggYm90IGJlZm9yZSB3ZSBtb2RpZnkgdGhlbS4KICAgIGNvbnN0IHByZVBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdCh0YXJnZXRCb3QpOwogICAgCiAgICAvLyBNb2RpZnkgdGhlIGJvdC4KICAgIHNldFRhZyh0YXJnZXRCb3QsICJvbkNsaWNrIiwgIkAgb3MudG9hc3QoJ2hlbGxvJyk7Iik7ICAKCiAgICAvLyBBZnRlciBtb2RpZnlpbmcgdGhlIGJvdCwgY3JlYXRlIGRpZmYgc25hcHNob3RzIGFuZCBzdG9yZSB0aGVtIGluIHRoZSByZXN1bHRzIHRoYXQgd2UgcmV0dXJuLgogICAgY29uc3QgcG9zdFBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdCh0YXJnZXRCb3QpOwogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyAKICAgICAgICBib3RJZDogdGFyZ2V0Qm90LmlkLCAKICAgICAgICBjcmVhdGVkOiBmYWxzZSwgCiAgICAgICAgcm9sbGJhY2tEaWZmOiBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBTaG90KQogICAgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAoKIyMjIEV4YW1wbGUgNAoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgClRBUkdFVF9CT1RTOiBbCiAgICB7CiAgICAgICAgaWQ6ICJzb21lX2lkIiwKICAgICAgICBkaW1lbnNpb246ICJob21lIgogICAgfSwKICAgIHsKICAgICAgICBpZDogImRvZXNudF9tYXR0ZXIiLAogICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICB9LApdCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSByZWQgYm90cyBibHVlIik7Cgpjb25zdCByZWRCb3RzID0gZ2V0Qm90cygiY29sb3IiLCAicmVkIik7CmNvbnN0IHBhdGNoUmVzdWx0cyA9IFtdOwoKZm9yIChjb25zdCBib3Qgb2YgcmVkQm90cykgewogICAgLy8gVGFrZSBzbmFwc2hvdHMgb2YgZWFjaCBib3QgYmVmb3JlIHdlIG1vZGlmeSB0aGVtLgogICAgY29uc3QgcHJlUGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KGJvdCk7CgogICAgLy8gTW9kaWZ5IHRoZSBib3QuCiAgICBzZXRUYWcoYm90LCAiY29sb3IiLCAiYmx1ZSIpOwoKICAgIC8vIEFmdGVyIG1vZGlmeWluZyB0aGUgYm90LCBjcmVhdGUgZGlmZiBzbmFwc2hvdHMgYW5kIHN0b3JlIHRoZW0gaW4gdGhlIHJlc3VsdHMgdGhhdCB3ZSByZXR1cm4uCiAgICBjb25zdCBwb3N0UGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KGJvdCk7CiAgICBwYXRjaFJlc3VsdHMucHVzaCh7IAogICAgICAgIGJvdElkOiBib3QuaWQsIAogICAgICAgIGNyZWF0ZWQ6IGZhbHNlLCAKICAgICAgICByb2xsYmFja0RpZmY6IGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcFNob3QpCiAgICB9KTsKfQoKcmV0dXJuIHBhdGNoUmVzdWx0czsKYGBgCgojIyMgRXhhbXBsZSA1CgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSBibHVlIGJvdCBhYm92ZSBlYWNoIG9mIHRoZSBnaXZlbiBib3RzIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gaG92ZXJlZC4gIApUQVJHRVRfQk9UUzogWwogICAgewogICAgICAgIGlkOiAiYjEiLAogICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICB9LAogICAgewogICAgICAgIGlkOiAiYjIiLAogICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICB9LAogICAgewogICAgICAgIGlkOiAiYjMiLAogICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICB9LApdCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBibHVlIGJvdHMgYWJvdmUgZWFjaCB0YXJnZXQgdGhhdCB0b2FzdCBcImhlbGxvXCIgb24gcG9pbnRlciBlbnRlciIpOyAgCgpjb25zdCB0YXJnZXRzID0gWwogICAgeyBpZDogImIxIiwgZGltZW5zaW9uOiAiaG9tZSIgfSwKICAgIHsgaWQ6ICJiMiIsIGRpbWVuc2lvbjogImhvbWUiIH0sCiAgICB7IGlkOiAiYjMiLCBkaW1lbnNpb246ICJob21lIiB9LApdOwoKY29uc3QgcGF0Y2hSZXN1bHRzID0gW107Cgpmb3IgKGxldCBlbnRyeSBvZiB0YXJnZXRzKSB7ICAKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgZW50cnkuaWQpOyAgCiAgICBjb25zdCBibHVlQm90ID0gY3JlYXRlKHsgIAogICAgICAgIFtlbnRyeS5kaW1lbnNpb25dOiB0cnVlLAogICAgICAgIFtlbnRyeS5kaW1lbnNpb24gKyAnWCddOiB0YXJnZXRCb3QudGFnc1tlbnRyeS5kaW1lbnNpb24gKyAnWCddLAogICAgICAgIFtlbnRyeS5kaW1lbnNpb24gKyAnWSddOiB0YXJnZXRCb3QudGFnc1tlbnRyeS5kaW1lbnNpb24gKyAnWSddICsgMSwKICAgICAgICBjb2xvcjogImJsdWUiLAogICAgICAgIG9uUG9pbnRlckVudGVyOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiCiAgICB9KTsgIAogICAgCiAgICBwYXRjaFJlc3VsdHMucHVzaCh7IGJvdElkOiBibHVlQm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAonALGrmckBn38aYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBACxq5nJAdHpAwMyMDAnALGrmckBn38JYWJWZXJzaW9uAgQAsauZyQHV6QMFMTAuNDInALGrmckBn38OY2hhbm5lbF9jb25maWcCBACxq5nJAdvpA60PQGNvbnN0IGNvbmZpZ3VyYXRpb25EYXRhID0gYXdhaXQgb3MuZ2V0RGF0YSh0aGF0LmRhdGEuc3R1ZGlvSUQsIHRoYXQuZGF0YS5wYXR0ZXJuSUQpOwoKbGV0IG5ld0RlcGxveW1lbnQgPSBmYWxzZTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmNoYW5uZWxDb25maWd1cmVkKQp7CiAgICByZXR1cm47Cn0KCmxpbmtzLnJlbWVtYmVyLnRhZ3MuY2hhbm5lbENvbmZpZ3VyZWQgPSB0cnVlOwoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvcykKewogICAgY29uc3QgdGFyZ2V0QmlvcyA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvczsKCiAgICBzd2l0Y2ggKHRhcmdldEJpb3MpIAogICAgewogICAgICAgIGNhc2UgImxvY2FsIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0YXRpY0luc3QgPT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmV3RGVwbG95bWVudCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInN0dWRpbyI6CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5vd25lciA9PSBudWxsIHx8IGNvbmZpZ0JvdC50YWdzLm93bmVyID09ICJwdWJsaWMiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic2hhcmVkIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLm93bmVyICE9ICJwdWJsaWMiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmVnZykKewogICAgY29uc3QgdGFyZ2V0UGF0dGVybiA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZWdnLnBhdHRlcm47CiAgICBjb25zdCB0YXJnZXRTdHVkaW8gPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmVnZy5zdHVkaW87CgogICAgc2hvdXQoImhhdGNoIiwge2FiSUQ6IHRhcmdldFBhdHRlcm4sIHJlY29yZEtleTogdGFyZ2V0U3R1ZGlvLCBhdXRvSGF0Y2g6IHRydWV9KTsKfQoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yKQp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yOwoKICAgIGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxDb2xvciA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yOwp9CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICYmIGNvbmZpZ0JvdC50YWdzLmluc3QgIT0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICYmIGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCAhPSBudWxsKQp7CiAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKfQoKaWYgKG5ld0RlcGxveW1lbnQpCnsKICAgIGNvbnN0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwogICAgY29uc3QgdGFyZ2V0SW5zdCA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCA/ICImaW5zdD0iICsgY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0IDogIiI7CiAgICBjb25zdCB0YXJnZXRCaW9zID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zID8gIiZiaW9zPSIgKyBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3MgOiAiIjsKICAgIGNvbnN0IHRhcmdldFBhdHRlcm4gPSBjb25maWdCb3QudGFncy5wYXR0ZXJuID8gIiZwYXR0ZXJuPSIgKyBjb25maWdCb3QudGFncy5wYXR0ZXJuIDogIiI7CiAgICBjb25zdCB0YXJnZXRVUkwgPSBzaXRlT3JpZ2luICsgYC8/YXNrPSR7Y29uZmlnQm90LnRhZ3MuYXNrfSR7dGFyZ2V0UGF0dGVybn0ke3RhcmdldEluc3R9JHt0YXJnZXRCaW9zfWA7CgogICAgb3MuZ29Ub1VSTCh0YXJnZXRVUkwpOwp9JwCxq5nJAZ9/DWNoYW5uZWxMb2FkZXICBACxq5nJAYn5Ayjwn5SXYTliNmFhMGQtYjM1Ny00ZGU2LTliZWYtODUzNDhhYjFkMGUwJwCxq5nJAZ9/CXByb3RvdHlwZQIEALGrmckBsPkDLkB0aGlzQm90LmFiQ29yZU1lbnVBY3Rpb24oIk1ha2UgbWU6ICIgKyB0aGF0KTsnALGrmckBn38LcGVyc29uYWxpdHkCBACxq5nJAd/5Ayjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwCxq5nJAZ9/BXV0aWxzAgQAsauZyQGG+gMo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAsauZyQGffwZjcmVhdGUCBACxq5nJAa36Ayjwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwCxq5nJAZ9/D2lucHV0U3VnZ2VzdGlvbgIEALGrmckB1PoD8gVAaWYgKCF0YWdzLmlucHV0U3VnZ2VzdGlvbkVuYWJsZWQpIHsKICAgIHJldHVybjsKfQoKY29uc3QgaW5wdXRCb3QgPSB0aGF0Py5pbnB1dEJvdDsKY29uc3QgdGV4dCA9IHRoYXQ/LnRleHQ7CmNvbnN0IGFuaW1hdGUgPSB0aGF0Py5hbmltYXRlID8/IHRydWU7Cgphc3NlcnQoaW5wdXRCb3QsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaW5wdXRCb3QgaXMgYSByZXF1aXJlZCBwYXJhbWVtdGVyLmApOwphc3NlcnQodGV4dCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0ZXh0IGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyLmApOwoKbGV0IHN0b3BwZWQgPSBmYWxzZTsKCmlmIChhbmltYXRlKSB7CiAgICBjb25zdCBjaGFycyA9IFsuLi50ZXh0XTsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChpbnB1dEJvdC50YWdzLnN0b3BTdWdnZXN0aW9uKSB7CiAgICAgICAgICAgIHN0b3BwZWQgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYXdhaXQgb3Muc2xlZXAobWF0aC5yYW5kb20oMjUsIDEwMCkpOwogICAgICAgIGlucHV0Qm90LnRhZ3MubWVudUl0ZW1UZXh0ID0gY2hhcnMuc2xpY2UoMCwgaSkuam9pbignJyk7CiAgICB9Cn0KCmlmIChzdG9wcGVkKSB7CiAgICBpbnB1dEJvdC50YWdzLm1lbnVJdGVtVGV4dCA9ICcnOwp9IGVsc2UgewogICAgaW5wdXRCb3QudGFncy5tZW51SXRlbVRleHQgPSB0ZXh0Owp9JwCxq5nJAZ9/FWlucHV0U3VnZ2VzdGlvbldhaXRNUwIEALGrmckBx4AEBDMwMDAnALGrmckBn38Pc3VnZ2VzdGlvbnNDb3JlAgQAsauZyQHMgATrAfCfp6xbCiAgICAibWFrZSBtZSBhIHJlZCBib3QgdGhhdCB3aGVuIGNsaWNrZWQgdHVybnMgYmx1ZSIsCiAgICAibWFrZSBtZSBhIGJvdCB0aGF0IHdoZW4gY2xpY2tlZCBtYWtlcyBmaXJld29ya3MiLAogICAgIm1ha2UgbWUgYSBib3QgdGhhdCB0b2FzdHMgJ2hlbGxvLCB3b3JsZCEnIHdoZW4gY2xpY2tlZCIsCiAgICAibWFrZSBtZSAzIGJvdHMsIGEgcmVkIG9uZSwgYmx1ZSBvbmUsIGFuZCBncmVlbiBvbmUiCl0nALGrmckBn38Oc3VnZ2VzdGlvbnNCb3QCBACxq5nJAbaCBHvwn6esWwogICAgImNoYW5nZSB0aGUgY29sb3Igb2YgdGhpcyBib3QgdG8gcHVycGxlIiwKICAgICJ0dXJuIHRoaXMgYm90IGludG8gYSBzcGhlcmUiLAogICAgImRvdWJsZSB0aGUgc2NhbGUgb2YgdGhpcyBib3QiCl0nALGrmckBn38Xc3VnZ2VzdGlvbnNNdWx0aXBsZUJvdHMCBACxq5nJAbCDBI4B8J+nrFsKICAgICJjaGFuZ2UgYWxsIG9mIHRoZXNlIGJvdHMgY29sb3IgdG8gcHVycGxlIiwKICAgICJ0dXJuIGFsbCBvZiB0aGVzZSBib3RzIGludG8gc3BoZXJlcyIsCiAgICAiZG91YmxlIHRoZSBzY2FsZSBvZiBhbGwgb2YgdGhlc2UgYm90cyIKXScAsauZyQGffwp1dWFiTG9hZGVyAgQAsauZyQG9hAQo8J+Ul2I4OTg2ZmE2LTU0M2EtNDg2NC04NmMxLTQyMjU3OWE1Y2I2MCcAsauZyQGffw9zdWdnZXN0aW9uc0dyaWQCBACxq5nJAeSEBOsB8J+nrFsKICAgICJtYWtlIG1lIGEgcmVkIGJvdCB0aGF0IHdoZW4gY2xpY2tlZCB0dXJucyBibHVlIiwKICAgICJtYWtlIG1lIGEgYm90IHRoYXQgd2hlbiBjbGlja2VkIG1ha2VzIGZpcmV3b3JrcyIsCiAgICAibWFrZSBtZSBhIGJvdCB0aGF0IHRvYXN0cyAnaGVsbG8sIHdvcmxkIScgd2hlbiBjbGlja2VkIiwKICAgICJtYWtlIG1lIDMgYm90cywgYSByZWQgb25lLCBibHVlIG9uZSwgYW5kIGdyZWVuIG9uZSIKXScAsauZyQGffwVkZWJ1ZwIEALGrmckBzoYEBWZhbHNlJwCxq5nJAZ9/DmFiQ29yZU1lbnVIaWRlAgQAsauZyQHUhgQEdHJ1ZScAsauZyQGffxZpbnB1dFN1Z2dlc3Rpb25FbmFibGVkAgQAsauZyQHZhgQFZmFsc2UnAQRib3RzJGY5ZmQ3ZTJlLTdjY2UtNDNmYi1iMjIzLWQzMmNiNDJiZWJlOAEnALGrmckB34YEBnN5c3RlbQIEALGrmckB4IYEE2FiLmFjdGlvbi5jb2xvcl9ib3QnALGrmckB34YEBGZvcm0CBACxq5nJAfSGBAdub3RoaW5nJwCxq5nJAd+GBAhhYkFjdGlvbgIEALGrmckB/IYEBHRydWUnALGrmckB34YED2FiQm90TWVudUFjdGlvbgIEALGrmckBgYcE2gJAY29uc3QgdGFyZ2V0Qm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCmNvbnN0IHNlbGVjdGVkQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQodGFyZ2V0Qm90LnRhZ3MuY29sb3IsIHsKICAgIHR5cGU6ICdjb2xvcicsCiAgICB0aXRsZTogJ3BpY2sgYSBjb2xvcicKfSk7CgppZiAoc2VsZWN0ZWRDb2xvciAmJiB0YXJnZXRCb3QudGFncy5jb2xvciAhPT0gc2VsZWN0ZWRDb2xvcikgewogICAgdGFyZ2V0Qm90LnRhZ3MuY29sb3IgPSBzZWxlY3RlZENvbG9yOwogICAgYWIubGlua3Muc291bmQuYWJQbGF5U291bmQoeyB2YWx1ZTogJ2FiL2F1ZGlvL3BhaW50IHNwcmF5Lm1wMycgfSk7Cn0KJwCxq5nJAd+GBA5hYkJvdE1lbnVMYWJlbAIEALGrmckB3IkEBWNvbG9yJwCxq5nJAd+GBA1hYkJvdE1lbnVJY29uAgQAsauZyQHiiQQHcGFsZXR0ZScAsauZyQHfhgQIcmVtZW1iZXICBACxq5nJAeqJBCjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCxq5nJAd+GBBJhYkJvdE1lbnVTb3J0T3JkZXICBACxq5nJAZGKBAEyJwCxq5nJAd+GBAhhYklnbm9yZQIEALGrmckBk4oEBHRydWUnALGrmckB34YEF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAsauZyQGYigTwA0Bjb25zdCBhbGxUYXJnZXRCb3RzID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7Cgpjb25zdCBzZWxlY3RlZENvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KG51bGwsIHsKICAgIHR5cGU6ICdjb2xvcicsCiAgICB0aXRsZTogJ3BpY2sgYSBjb2xvcicKfSk7CgppZiAoc2VsZWN0ZWRDb2xvcikgewogICAgc2V0VGFnKHJlbGV2YW50VGFyZ2V0Qm90cywgImNvbG9yIiwgc2VsZWN0ZWRDb2xvcik7CgogICAgYWIubGlua3Muc291bmQuYWJQbGF5U291bmQoeyB2YWx1ZTogJ2FiL2F1ZGlvL3BhaW50IHNwcmF5Lm1wMycgfSk7Cn0nALGrmckB34YEFWFiTXVsdGlwbGVCb3RNZW51SWNvbgIEALGrmckBiY4EB3BhbGV0dGUnALGrmckB34YEFmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBACxq5nJAZGOBAVjb2xvcicAsauZyQHfhgQaYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBACxq5nJAZeOBAExJwCxq5nJAd+GBAlhYlZlcnNpb24CBACxq5nJAZmOBAUxMC40MicAsauZyQHfhgQLcGVyc29uYWxpdHkCBACxq5nJAZ+OBCjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwCxq5nJAd+GBBNhYkJvdE1lbnVDbGlja1NvdW5kAgQAsauZyQHGjgQiYWIvYXVkaW8vcGFpbnQgc3ByYXkgY2FuIHNoYWtlLm1wMycAsauZyQHfhgQbYWJNdWx0aXBsZUJvdE1lbnVDbGlja1NvdW5kAgQAsauZyQHpjgQiYWIvYXVkaW8vcGFpbnQgc3ByYXkgY2FuIHNoYWtlLm1wMwA="}]}