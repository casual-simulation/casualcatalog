{"version":2,"updates":[{"id":0,"timestamp":1756136579028,"update":"AeACjK6ZrgYAJwEEYm90cyQzOTg4MDFmZS00YjM1LTRjZTQtODI2Zi0yMzgzNWMxYjlhYzUBJwCMrpmuBgAGc3lzdGVtAgQAjK6ZrgYBFGFiLmFjdGlvbi5jcmVhdGVfYm90JwCMrpmuBgAIYWJBY3Rpb24CBACMrpmuBhYEdHJ1ZScAjK6ZrgYABGZvcm0CBACMrpmuBhsHbm90aGluZycAjK6ZrgYAC2Rlc2NyaXB0aW9uAgQAjK6ZrgYjDUNyZWF0ZXMgYm90cy4nAIyuma4GABBhYkdyaWRNZW51QWN0aW9uAgQAjK6ZrgYxsQVAY29uc3QgZ3JpZEluZm9ybWF0aW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKY29uc3QgbmV3Qm90ID0ge307CgpuZXdCb3QuY3JlYXRvciA9IG51bGw7Cm5ld0JvdFtncmlkSW5mb3JtYXRpb24uZGltZW5zaW9uXSA9IHRydWU7Cm5ld0JvdFtncmlkSW5mb3JtYXRpb24uZGltZW5zaW9uICsgIlgiXSA9IGdyaWRJbmZvcm1hdGlvbi5wb3NpdGlvbi54OwpuZXdCb3RbZ3JpZEluZm9ybWF0aW9uLmRpbWVuc2lvbiArICJZIl0gPSBncmlkSW5mb3JtYXRpb24ucG9zaXRpb24ueTsKbmV3Qm90LmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKCmxldCBjcmVhdGVkQm90ID0gY3JlYXRlKG5ld0JvdCk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90Lm1hc2tzLmxpbmVDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QubWFza3MubGluZVRvID0gY3JlYXRlZEJvdC5pZDsKCmxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQm90Rm9jdXMgPSAi8J+UlyIgKyBjcmVhdGVkQm90LmlkOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHttZW51OiAiYm90In0pOycAjK6ZrgYAD2FiR3JpZE1lbnVMYWJlbAIEAIyuma4G4QUDYm90JwCMrpmuBgAOYWJHcmlkTWVudUljb24CBACMrpmuBuUFB2FkZF9ib3gnAIyuma4GAAhyZW1lbWJlcgIEAIyuma4G7QUo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAjK6ZrgYADW1hbmlmZXN0YXRpb24CBACMrpmuBpQGKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAIyuma4GAAhhYklnbm9yZQIEAIyuma4GuwYEdHJ1ZScAjK6ZrgYAE2FiR3JpZE1lbnVTb3J0T3JkZXICBACMrpmuBsAGATEnAIyuma4GAAlhYlZlcnNpb24CBACMrpmuBsIGBDEwLjYnAIyuma4GAAtwZXJzb25hbGl0eQIEAIyuma4GxwYo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicBBGJvdHMkNTg0OWFmNTUtNWU4YS00OGQ2LTkxMDYtMTk5NDk4ZTllYzA4AScAjK6ZrgbuBgZzeXN0ZW0CBACMrpmuBu8GEWFiLmFjdGlvbi5kZXN0cm95JwCMrpmuBu4GCGFiQWN0aW9uAgQAjK6ZrgaBBwR0cnVlJwCMrpmuBu4GBGZvcm0CBACMrpmuBoYHB25vdGhpbmcnAIyuma4G7gYPYWJCb3RNZW51QWN0aW9uAgQAjK6ZrgaOB8ACQGNvbnN0IHRhcmdldEJvdCA9IHRoYXQuYm90LmxpbmtzLnRhcmdldEJvdDsKCmlmICh0aGF0LmJvdC5saW5rcy50YXJnZXRPcmlnaW5Cb3RzKSB7CiAgICAvLyBEZXN0cm95IGJvdHMgYmVsb25naW5nIHRvIGFiSURPcmlnaW4uCiAgICBkZXN0cm95KHRoYXQuYm90LmxpbmtzLnRhcmdldE9yaWdpbkJvdHMpOwp9IGVsc2UgewogICAgLy8gRGVzdHJveSB0aGUgc2luZ2xlIHRhcmdldCBib3QuCiAgICBkZXN0cm95KHRhcmdldEJvdCk7Cn0KCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsnAIyuma4G7gYOYWJCb3RNZW51TGFiZWwCBACMrpmuBs8JB2Rlc3Ryb3knAIyuma4G7gYNYWJCb3RNZW51SWNvbgIEAIyuma4G1wkOZGVsZXRlX2ZvcmV2ZXInAIyuma4G7gYSYWJCb3RNZW51U29ydE9yZGVyAgQAjK6ZrgbmCQMxMDAnAIyuma4G7gYIcmVtZW1iZXICBACMrpmuBuoJKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIyuma4G7gYNbWFuaWZlc3RhdGlvbgIEAIyuma4GkQoo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAjK6ZrgbuBghhYklnbm9yZQIEAIyuma4GuAoEdHJ1ZScAjK6ZrgbuBg5hYkJvdE1lbnVDb2xvcgIEAIyuma4GvQoHI0Q5MzAzMCcAjK6ZrgbuBhdhYk11bHRpcGxlQm90TWVudUFjdGlvbgIEAIyuma4GxQrAA0Bjb25zdCBhbGxUYXJnZXRCb3RzID0gQXJyYXkuaXNBcnJheShsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpID8gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzIDogW2xpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1c107CmNvbnN0IGJ1aWxkZXIgPSBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90ID8gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC5pZCA6IG51bGw7CmNvbnN0IHJlbGV2YW50VGFyZ2V0Qm90cyA9IGFsbFRhcmdldEJvdHMuZmlsdGVyKCh0YXJnZXQpID0+IHRhcmdldC5pZCAhPSBidWlsZGVyKTsKCmRlc3Ryb3kocmVsZXZhbnRUYXJnZXRCb3RzKTsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsnAIyuma4G7gYVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAjK6ZrgaGDg5kZWxldGVfZm9yZXZlcicAjK6ZrgbuBhZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAjK6ZrgaVDgdkZXN0cm95JwCMrpmuBu4GGmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQAjK6ZrgadDgMxMDAnAIyuma4G7gYWYWJNdWx0aXBsZUJvdE1lbnVDb2xvcgIEAIyuma4GoQ4HI0Q5MzAzMCcAjK6ZrgbuBglhYlZlcnNpb24CBACMrpmuBqkOBDEwLjYnAIyuma4G7gYTYWJCb3RNZW51T25HZW5lcmF0ZQIEAIyuma4Grg6tB0Bjb25zdCB0YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzOwoKaWYgKHRhcmdldEJvdCkgewogICAgdGFncy5sYWJlbCA9ICdkZXN0cm95JzsKICAgIHRhZ3MudGFyZ2V0Qm90ID0gZ2V0TGluayh0YXJnZXRCb3QpOwogICAgdGFncy5vbktleURvd24gPSBgQAogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoIlNoaWZ0IikpIHsKICAgICAgICAgICAgaWYgKGxpbmtzLnRhcmdldEJvdCAmJiBsaW5rcy50YXJnZXRCb3QudGFncy5hYklET3JpZ2luKSB7CiAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgYnV0dG9uIHRvIGRlc3Ryb3kgYWxsIGJvdHMgd2l0aCBzYW1lIGFiSURPcmlnaW4uCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRPcmlnaW5Cb3RzID0gZ2V0Qm90cyhiID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYi50YWdzLmFiSURPcmlnaW4gPT09IGxpbmtzLnRhcmdldEJvdC50YWdzLmFiSURPcmlnaW47CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIG1hc2tzLmxhYmVsID0gJ2Rlc3Ryb3kgJyArIGxpbmtzLnRhcmdldEJvdC50YWdzLmFiSURPcmlnaW4gKyAnICgnICsgdGFyZ2V0T3JpZ2luQm90cy5sZW5ndGggKyAnIGJvdHMpJzsKICAgICAgICAgICAgICAgIHRhZ3MudGFyZ2V0T3JpZ2luQm90cyA9IGdldExpbmsodGFyZ2V0T3JpZ2luQm90cyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICBgOwogICAgdGFncy5vbktleVVwID0gYEAKICAgICAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCJTaGlmdCIpKSB7CiAgICAgICAgICAgIG1hc2tzLmxhYmVsID0gbnVsbDsKICAgICAgICAgICAgdGFncy50YXJnZXRPcmlnaW5Cb3RzID0gbnVsbDsKICAgICAgICB9CiAgICBgOwp9IGVsc2UgewogICAgLy8gTm8gYm90IHRvIGRlc3Ryb3kuCiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwCMrpmuBu4GG2FiTXVsdGlwbGVCb3RNZW51T25HZW5lcmF0ZQIEAIyuma4G3BXvBEBjb25zdCBhbGxUYXJnZXRCb3RzID0gQXJyYXkuaXNBcnJheShsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpID8gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzIDogW2xpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1c107CmNvbnN0IGJ1aWxkZXIgPSBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90ID8gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC5pZCA6IG51bGw7CmNvbnN0IHJlbGV2YW50VGFyZ2V0Qm90cyA9IGFsbFRhcmdldEJvdHMuZmlsdGVyKCh0YXJnZXQpID0+IHRhcmdldC5pZCAhPSBidWlsZGVyKTsKCmlmIChyZWxldmFudFRhcmdldEJvdHMubGVuZ3RoID4gMSkgewogICAgLy8gTXVsdGlwbGUgYm90cy4KICAgIHRhZ3MubGFiZWwgPSBgZGVzdHJveSAoJHtyZWxldmFudFRhcmdldEJvdHMubGVuZ3RofSBib3RzKWA7Cn0gZWxzZSBpZiAocmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aCA9PT0gMSkgewogICAgLy8gU2luZ2xlIGJvdC4KICAgIHRhZ3MubGFiZWwgPSBgZGVzdHJveWA7Cn0gZWxzZSB7CiAgICAvLyBObyBib3RzIHRvIGRlc3Ryb3kuCiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwEEYm90cyQ2YjNkOTc0NC00NDQ4LTRlZjUtOTZhMi03MTI4MWM0MmFmNmMBJwCMrpmuBswaCWFiVmVyc2lvbgIEAIyuma4GzRoEMTAuNicAjK6ZrgbMGgZzeXN0ZW0CBACMrpmuBtIaEWFiLmFjdGlvbi52ZXJzaW9uJwCMrpmuBswaFGFiQWN0aW9uTWFqb3JWZXJzaW9uAgQAjK6ZrgbkGgExJwCMrpmuBswaFGFiQWN0aW9uTWlub3JWZXJzaW9uAgQAjK6ZrgbmGgE2JwCMrpmuBswaDW9uU2tpbGxVcGRhdGUCBACMrpmuBugamQFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJBY3Rpb25NYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiQWN0aW9uTWlub3JWZXJzaW9uOwoKY29uc29sZS5sb2coIltBQkFjdGlvbl0gTG9hZGVkIEFCIEFjdGlvbiB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAIyuma4GzBoIYWJJZ25vcmUCBACMrpmuBoIcBHRydWUnAIyuma4GzBoIYWJBY3Rpb24CBACMrpmuBoccBHRydWUnAIyuma4GzBoEZm9ybQIEAIyuma4GjBwHbm90aGluZycBBGJvdHMkNzE3NTY0NWMtNGI1My00NDU0LTg3MTYtZmMwZTY4ZGIyNjY1AScAjK6ZrgaUHAZzeXN0ZW0CBACMrpmuBpUcD2FiLmFjdGlvbi5sb2dpbicAjK6ZrgaUHAhhYkFjdGlvbgIEAIyuma4GpRwEdHJ1ZScAjK6ZrgaUHAhhYklnbm9yZQIEAIyuma4GqhwEdHJ1ZScAjK6ZrgaUHARmb3JtAgQAjK6ZrgavHAdub3RoaW5nJwCMrpmuBpQcD2FiQ29yZU1lbnVDb2xvcgIEAIyuma4GtxwHI0YyQjcwNScAjK6ZrgaUHBNhYkNvcmVNZW51U29ydE9yZGVyAgQAjK6Zrga/HAItNScAjK6ZrgaUHBBhYkNvcmVNZW51QWN0aW9uAgQAjK6ZrgbCHCxAb3MuZ29Ub1VSTChsaW5rcy5yZW1lbWJlci50YWdzLmFiQXV0aFNpdGUpOycAjK6ZrgaUHBRhYkNvcmVNZW51T25HZW5lcmF0ZQIEAIyuma4G7xygAkBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiQXV0aFNpdGUpCnsKICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0KCnRhZ3MubGFiZWwgPSAiYnV5ICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwoKaWYgKCFhdXRoQm90KQp7CiAgICByZXR1cm47Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgcmV0dXJuOwp9CgpkZXN0cm95KHRoaXNCb3QpOycAjK6ZrgaUHA5hYkNvcmVNZW51SWNvbgIEAIyuma4GkB8OYWNjb3VudF9jaXJjbGUnAIyuma4GlBwIcmVtZW1iZXICBACMrpmuBp8fKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIyuma4GlBwJYWJWZXJzaW9uAgQAjK6ZrgbGHwQxMC42JwCMrpmuBpQcC3BlcnNvbmFsaXR5AgQAjK6ZrgbLHyjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwEEYm90cyRiMzM5YzExOC00ODlhLTQ2NmItYmE5Zi1iMDdhNWY5YjY2NGYBJwCMrpmuBvIfBnN5c3RlbQIEAIyuma4G8x8PYWIuYWN0aW9uLnBhc3RlKACMrpmuBvIfCGFiQWN0aW9uAXgnAIyuma4G8h8EZm9ybQIEAIyuma4GhCAHbm90aGluZycAjK6ZrgbyHwtkZXNjcmlwdGlvbgIEAIyuma4GjCArYWIgc2tpbGwgdXNlZCBmb3IgY29weWluZyBhbmQgcGFzdGluZyBib3RzLicAjK6ZrgbyHwdvblBhc3RlAgQAjK6Zrga4IP8HQGlmICghYnVpbGRlclZlcnNpb24pCnsKICAgIHJldHVybjsKfQoKY29uc3QgTUFDUk9TID0gWwogICAgewogICAgICAgIHRlc3Q6IC8oPzpb4oCc4oCdXSkvZywKICAgICAgICByZXBsYWNlbWVudDogKHZhbCkgPT4gJyInLAogICAgfSwKICAgIHsKICAgICAgICB0ZXN0OiAvKD86W+KAmOKAmV0pL2csCiAgICAgICAgcmVwbGFjZW1lbnQ6ICh2YWwpID0+ICInIiwKICAgIH0sCl07CgpsZXQgZm9ybWF0dGVkQ29weSA9IHJlcGxhY2VNYWNyb3ModGhhdC50ZXh0KTsKbGV0IGNvcHlCb3QgPSBKU09OLnBhcnNlKGZvcm1hdHRlZENvcHkpOwpsZXQgcGFzdGVkRGF0YSA9ICFjb3B5Qm90LnN0YXRlID8ge1tjb3B5Qm90LmlkXTogY29weUJvdH0gOiBjb3B5Qm90LnN0YXRlOwpsZXQgZGltTW9kID0gbGlua3MucmVtZW1iZXIudGFncy5hYkZvY3VzRGF0YTsKCmlmIChPYmplY3Qua2V5cyhwYXN0ZWREYXRhKS5sZW5ndGggPT0gMSAmJiBkaW1Nb2QpCnsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgcGFzdGVkRGF0YVtkaW1Nb2QuZGltZW5zaW9uKyJYIl0gPSBkaW1Nb2QueDsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbisiWSJdID0gZGltTW9kLnk7CgogICAgb3MudG9hc3QoImJvdCBhZGRlZCB0byBpbnN0Iik7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgiYm90cyBhZGRlZCB0byBpbnN0Iik7Cn0KCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogcGFzdGVkIGRhdGEiKTsKCmxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IHBhc3RlZERhdGEsIHNvdXJjZUV2ZW50OiAncGFzdGUnfSk7CgpmdW5jdGlvbiByZXBsYWNlTWFjcm9zKHRleHQpIHsKICAgIGlmICghdGV4dCkgewogICAgICAgIHJldHVybiB0ZXh0OwogICAgfQoKICAgIGZvciAobGV0IG0gb2YgTUFDUk9TKSB7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShtLnRlc3QsIG0ucmVwbGFjZW1lbnQpOwogICAgfQoKICAgIHJldHVybiB0ZXh0Owp9JwCMrpmuBvIfCHJlbWVtYmVyAgQAjK6ZrgawKCjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCMrpmuBvIfBmNyZWF0ZQIEAIyuma4G1ygo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycAjK6ZrgbyHwhhYklnbm9yZQIEAIyuma4G/igEdHJ1ZScAjK6ZrgbyHwlvbktleURvd24CBACMrpmuBoMpuglAaWYgKCFidWlsZGVyVmVyc2lvbiB8fCAoIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMgJiYgIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cykpCnsKICAgIHJldHVybjsKfQoKaWYgKHRoYXQua2V5cyA9PSAiYyIpCnsKICAgIGxldCBtZXRhSW5wdXQgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJNZXRhIik7CgogICAgaWYgKCFtZXRhSW5wdXQpCiAgICB7CiAgICAgICAgbWV0YUlucHV0ID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiQ29udHJvbCIpOwogICAgfQogICAgCiAgICBpZiAoIW1ldGFJbnB1dCkKICAgIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IGZvcm1hdHRlZEZpbGU7CiAgICBsZXQgc3RhdGUgPSB7fTsKCiAgICBpZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykKICAgIHsKICAgICAgICBsZXQgc2VsZWN0ZWRCb3QgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzOwoKICAgICAgICBzdGF0ZVtzZWxlY3RlZEJvdC5pZF0gPSBzZWxlY3RlZEJvdDsKCiAgICAgICAgYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBjb3BpZWQgYSBib3QgdG8gY2xpcGJvYXJkIik7CiAgICB9CiAgICBlbHNlIGlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpCiAgICB7CiAgICAgICAgbGV0IHNlbGVjdGVkQm90cyA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1czsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3RlZEJvdHMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBzdGF0ZVtzZWxlY3RlZEJvdHNbaV0uaWRdID0gc2VsZWN0ZWRCb3RzW2ldOwogICAgICAgIH0KCiAgICAgICAgYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBjb3BpZWQgbXVsdGlwbGUgYm90cyB0byBjbGlwYm9hcmQiKTsKICAgIH0KCiAgICBsZXQgbmV3RmlsZSA9IHt9OwogICAgbmV3RmlsZS52ZXJzaW9uID0gMTsKICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkobmV3RmlsZSk7CgogICAgb3Muc2V0Q2xpcGJvYXJkKGZvcm1hdHRlZEZpbGUpOwoKICAgIG9zLnRvYXN0KCJib3QgY29waWVkIHRvIGNsaXBib2FyZCIpOwp9JwCMrpmuBvIfCWFiVmVyc2lvbgIEAIyuma4GvjIEMTAuNicAjK6ZrgbyHwtwZXJzb25hbGl0eQIEAIyuma4GwzIo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicBBGJvdHMkYmRhYmQ2YzAtODlmOS00Zjc1LWIzNWMtMjZmNGVjNTIwN2Q2AScAjK6ZrgbqMgZzeXN0ZW0CBACMrpmuBusyEGFiLmFjdGlvbi5yZXBvcnQnAIyuma4G6jIEZm9ybQIEAIyuma4G/DIHbm90aGluZycAjK6ZrgbqMhBhYkNvcmVNZW51QWN0aW9uAgQAjK6ZrgaEMxFAb3MucmVwb3J0SW5zdCgpOycAjK6ZrgbqMhNhYkNvcmVNZW51U29ydE9yZGVyAgQAjK6ZrgaWMwMxMDEnAIyuma4G6jIOYWJDb3JlTWVudUljb24CBACMrpmuBpozBGZsYWcnAIyuma4G6jIPYWJDb3JlTWVudUxhYmVsAgQAjK6ZrgafMwZyZXBvcnQnAIyuma4G6jIIYWJBY3Rpb24CBACMrpmuBqYzBHRydWUnAIyuma4G6jIIYWJJZ25vcmUCBACMrpmuBqszBHRydWUnAIyuma4G6jIUYWJDb3JlTWVudU9uR2VuZXJhdGUCBACMrpmuBrAzRkBpZiAoY29uZmlnQm90LnRhZ3Muc3RhdGljSW5zdCAhPSB1bmRlZmluZWQpCnsKICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAIyuma4G6jIJYWJWZXJzaW9uAgQAjK6Zrgb3MwQxMC42JwEEYm90cyRjNjhjNWI4Mi1jMGE3LTRhNWEtOTEwNC01ZGQ4ZTMyYWU0ZTIBJwCMrpmuBvwzBnN5c3RlbQIEAIyuma4G/TMQYWIuYWN0aW9uLnBvcnRhbCcAjK6Zrgb8MwtkZXNjcmlwdGlvbgIEAIyuma4GjjQUU2tpbGwgdG8gb3BlbiBzaGVldC4nAIyuma4G/DMIYWJBY3Rpb24CBACMrpmuBqM0BHRydWUnAIyuma4G/DMEZm9ybQIEAIyuma4GqDQHbm90aGluZycAjK6Zrgb8MxBhYkNvcmVNZW51QWN0aW9uAgQAjK6ZrgawNANALy8nAIyuma4G/DMIcmVtZW1iZXICBACMrpmuBrQ0KPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIyuma4G/DMPYWJDb3JlTWVudUxhYmVsAgQAjK6ZrgbbNBBjdXJyZW50IHBvcnRhbDogJwCMrpmuBvwzD2FiQm90TWVudUFjdGlvbgIEAIyuma4G7DT4AkBjb25zdCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CmNvbnN0IGN1cnJlbnREaW0gPSBsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90LnRhZ3MubGluZVRvOwpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZiAoc3RhdGUpIAp7CiAgICBvcy5vcGVuVVJMKGNvbmZpZ0JvdC50YWdzLnBlcm1hbGluayArIGAmc2hlZXRQb3J0YWw9JHtjdXJyZW50RGltfWApOwp9CmVsc2UKewogICAgY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgPSBjdXJyZW50RGltOwp9CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBib3Qgc2hlZXQiKTsnAIyuma4G/DMOYWJCb3RNZW51TGFiZWwCBACMrpmuBuU3Dm9wZW4gYm90IHNoZWV0JwCMrpmuBvwzDW1hbmlmZXN0YXRpb24CBACMrpmuBvQ3KPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAIyuma4G/DMNYWJCb3RNZW51SWNvbgIEAIyuma4GmzgKdGFibGVfdmlldycAjK6Zrgb8Mw5hYkNvcmVNZW51SWNvbgIEAIyuma4GpjgLYXJyb3dfcmlnaHQnAIyuma4G/DMSYWJCb3RNZW51U29ydE9yZGVyAgQAjK6ZrgayOAExJwCMrpmuBvwzCGFiSWdub3JlAgQAjK6Zrga0OAR0cnVlJwCMrpmuBvwzF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAjK6Zrga5OJsEQGNvbnN0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKY29uc3QgY3VycmVudERpbSA9ICJhYk11bHRpcGxlU2VsZWN0IjsKCmNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY3VycmVudERpbTsKCnNldFRhZ01hc2sobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzLCBjdXJyZW50RGltLCB0cnVlLCAidGVtcExvY2FsIik7CgptYXNrcy5jdXJyZW50U2hlZXRCb3RzID0gbGlua3MucmVtZW1iZXIudGFncy5hYk11bHRpcGxlQm90Rm9jdXM7Cm1hc2tzLm9uUG9ydGFsQ2hhbmdlZCA9IGBAIGlmICh0aGF0LmRpbWVuc2lvbiAhPSAiYWJNdWx0aXBsZVNlbGVjdCIgJiYgdGhhdC5wb3J0YWwgPT0gInNoZWV0UG9ydGFsIikKewogICAgY2xlYXJUYWdNYXNrcyhsaW5rcy5jdXJyZW50U2hlZXRCb3RzKTsKCiAgICBjbGVhclRhZ01hc2tzKHRoaXNCb3QpOwp9IGA7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQiKTsnAIyuma4G/DMWYWJNdWx0aXBsZUJvdE1lbnVMYWJlbAIEAIyuma4G1Twab3BlbiBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQnAIyuma4G/DMVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAjK6ZrgbwPAp0YWJsZV92aWV3JwCMrpmuBvwzE2FiQm90TWVudU9uR2VuZXJhdGUCBACMrpmuBvs8mAJAbGV0IHNlbGVjdGVkQm90ID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC50YWdzLmxpbmVUbzsKCnRhZ3MubGFiZWwgPSAic2hlZXRQb3J0YWw9IiArIHNlbGVjdGVkQm90LnN1YnN0cmluZygwLCA0KTsKCnRhZ3Mub25LZXlEb3duID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gdGFncy5sYWJlbCArICIgaW4gbmV3IHRhYiI7fWA7CnRhZ3Mub25LZXlVcCA9IGBAIGlmKHRoYXQua2V5cyA9PSAiU2hpZnQiKXttYXNrcy5sYWJlbCA9IG51bGw7fWA7JwCMrpmuBvwzGmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQAjK6ZrgaUPwEwJwCMrpmuBvwzBG1lbnUCBACMrpmuBpY/KPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAIyuma4G/DMJYWJWZXJzaW9uAgQAjK6Zrga9PwQxMC42JwCMrpmuBvwzC2FiQmx1ZXByaW50AgQAjK6ZrgbCP/sDQGNvbnN0IGJhY2tncm91bmRDb2xvciA9IGxpbmtzLnJlbWVtYmVyPy50YWdzLmFiQmx1ZXByaW50Q29sb3IgPz8gIiMxNzg1QjUiOwoKaWYgKGJhY2tncm91bmRDb2xvciA9PSBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yKQp7CiAgICByZXR1cm47Cn0KCmdyaWRQb3J0YWxCb3QubWFza3MucG9ydGFsQ29sb3IgPSBiYWNrZ3JvdW5kQ29sb3I7CgptYXNrcy5vblBvcnRhbENoYW5nZWQgPSBgQCBpZiAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIHRoYXQuZGltZW5zaW9uICE9ICJibHVlcHJpbnQiKXsKICAgIC8vIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQmFzZUNvbG9yID0gbnVsbDsKICAgIC8vIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQmFzZVN0cm9rZUNvbG9yID0gbnVsbDsKCiAgICBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yID0gbnVsbDsKCiAgICBtYXNrcy5vblBvcnRhbENoYW5nZWQgPSBudWxsOwp9YDsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7JwCMrpmuBvwzC29uQW55Q3JlYXRlAgQAjK6Zrga+Q3ZAaWYgKHRoYXQuYm90LnRhZ3MuYmx1ZXByaW50KQp7CiAgICB0aGF0LmJvdC50YWdzLnN0cm9rZUNvbG9yID0gIiNmZmZmZmYiOwogICAgdGhhdC5ib3QudGFncy5sYWJlbENvbG9yID0gIiNmZmZmZmYiOwp9JwCMrpmuBvwzD29uUG9ydGFsQ2hhbmdlZAIEAIyuma4GtURhQGlmICh0aGF0LnBvcnRhbCA9PSAiZ3JpZFBvcnRhbCIgJiYgdGhhdC5kaW1lbnNpb24gPT0gImJsdWVwcmludCIpCnsKICAgIHRoaXNCb3QuYWJCbHVlcHJpbnQoKTsKfScAjK6Zrgb8MwtwZXJzb25hbGl0eQIEAIyuma4Gl0Uo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAjK6Zrgb8MxJhYkNvcmVNZW51SXRlbVR5cGUCBACMrpmuBr5FCGRyb3Bkb3duJwCMrpmuBvwzEWRyb3Bkb3duU29ydE9yZGVyAgQAjK6ZrgbHRQExJwCMrpmuBvwzD2Ryb3Bkb3duT3B0aW9ucwIEAIyuma4GyUUG8J+nrFtdJwCMrpmuBvwzGGFiQ29yZU1lbnVPbkJlZm9yZUNyZWF0ZQIEAIyuma4GzkW4HkBjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgY3VycmVudERpbSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQpjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KY29uc3QgcGVybWFsaW5rVVJMID0gY29uZmlnQm90LnRhZ3MucGVybWFsaW5rOw0KY29uc3QgYWN0aXZlSW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7DQpjb25zdCBhY3RpdmVCaW9zID0gY29uZmlnQm90LnRhZ3Mub3duZXIgPyAiJm93bmVyPSIgKyBjb25maWdCb3QudGFncy5vd25lciA6IGZhbHNlOw0KY29uc3QgZmlyc3RJbmRleCA9IHBlcm1hbGlua1VSTC5pbmRleE9mKCImIik7DQpjb25zdCBpbml0aWFsVVJMID0gcGVybWFsaW5rVVJMLnN1YnN0cmluZygwLCBmaXJzdEluZGV4KTsNCmNvbnN0IHVwZGF0ZWRVUkwgPSBhY3RpdmVCaW9zICE9IGZhbHNlID8gaW5pdGlhbFVSTCArICImaW5zdD0iICsgYWN0aXZlSW5zdCA6IGluaXRpYWxVUkw7DQoNCnNldFRhZ01hc2sodGhpc0JvdCwgImFiQ29yZU1lbnVMYWJlbCIsYG1vZGU6ICR7Y3VycmVudFBvcnRhbH0gcG9ydGFsYCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJjdXJyZW50RGltZW5zaW9uIiwgY3VycmVudERpbSk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJjdXJyZW50UG9ydGFsIiwgY3VycmVudFBvcnRhbCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJkcm9wZG93blNvcnRPcmRlciIsIDEpOw0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJQb3J0YWxNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsNCm1lbnVPcHRpb25zLm9uS2V5VXAgPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSBudWxsO31gOw0KbWVudU9wdGlvbnMuc2tpbGxCb3QgPSBnZXRMaW5rKHRoaXNCb3QpOw0KbWVudU9wdGlvbnMudGFyZ2V0VVJMID0gdXBkYXRlZFVSTDsNCg0KY29uc3QgbWFwTWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCg0KbWFwTWVudUJvdC5sYWJlbCA9ICJtYXAgcG9ydGFsIjsNCm1hcE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAicHVibGljIjsNCm1hcE1lbnVCb3Qub25DbGljayA9IGBAIA0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZtYXBQb3J0YWw9JHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iKTsNCn0NCmVsc2UNCnsNCiAgICBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSAiJHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iOw0KfWA7DQoNCmlmIChjdXJyZW50UG9ydGFsICE9ICJtYXAiKQ0Kew0KICAgIC8vbWFwIHBvcnRhbCBidXR0b24NCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtYXBNZW51Qm90KTsNCn0NCg0KY29uc3QgZ3JpZE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQpncmlkTWVudUJvdC5sYWJlbCA9ICJncmlkIHBvcnRhbCI7DQpncmlkTWVudUJvdC5mb3JtQWRkcmVzcyA9ICJjdWJlIjsNCmdyaWRNZW51Qm90Lm9uQ2xpY2sgPSBgQA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9JHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iKTsNCn0gDQplbHNlDQp7DQogICAgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9ICIke2N1cnJlbnREaW0gPT0gImJsdWVwcmludCIgPyAiaG9tZSIgOiBjdXJyZW50RGltfSI7IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IG51bGw7DQp9YDsNCg0KaWYgKGN1cnJlbnRQb3J0YWwgIT0gImdyaWQiIHx8IGN1cnJlbnREaW0gPT0gImJsdWVwcmludCIpDQp7DQogICAgLy9ncmlkIHBvcnRhbCBidXR0b24NCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChncmlkTWVudUJvdCk7DQp9DQoNCmNvbnN0IGJsdWVwcmludE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQoNCmJsdWVwcmludE1lbnVCb3QubGFiZWwgPSAiYmx1ZXByaW50IHBvcnRhbCI7DQpibHVlcHJpbnRNZW51Qm90LmZvcm1BZGRyZXNzID0gImFyY2hpdGVjdHVyZSI7DQpibHVlcHJpbnRNZW51Qm90Lm9uQ2xpY2sgPSBgQA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9Ymx1ZXByaW50Iik7DQp9IA0KZWxzZQ0Kew0KICAgIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAiYmx1ZXByaW50IjsgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gbnVsbDsNCn0NCg0KbGlua3Muc2tpbGxCb3QuYWJCbHVlcHJpbnQoKTtgOw0KDQppZiAoY3VycmVudERpbSAhPSAiYmx1ZXByaW50IikNCnsNCiAgICAvL2JsdWVwcmludCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goYmx1ZXByaW50TWVudUJvdCk7DQp9DQoNCg0KY29uc3Qgc2hlZXRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0Kc2hlZXRNZW51Qm90LmxhYmVsID0gInNoZWV0IHBvcnRhbCI7DQpzaGVldE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAidGFibGVfdmlldyI7DQpzaGVldE1lbnVCb3Qub25DbGljayA9IGBAIA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJnNoZWV0UG9ydGFsPSR7Y3VycmVudERpbX0iKTsNCn0gDQplbHNlDQp7IA0KICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gIiR7Y3VycmVudERpbX0iOw0KfWA7DQoNCi8vc2hlZXQgcG9ydGFsIGJ1dHRvbg0KZHJvcGRvd25PcHRpb25zLnB1c2goc2hlZXRNZW51Qm90KTsNCg0KDQpjb25zdCBzeXN0ZW1NZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KDQpzeXN0ZW1NZW51Qm90LmxhYmVsID0gInN5c3RlbSBwb3J0YWwiOw0Kc3lzdGVtTWVudUJvdC5mb3JtQWRkcmVzcyA9ICJzZXR0aW5nc19hcHBsaWNhdGlvbnMiOw0Kc3lzdGVtTWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZzeXN0ZW1Qb3J0YWw9dHJ1ZSIpOw0KfSANCmVsc2UNCnsgDQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gdHJ1ZTsNCn1gOw0KDQovL3N5c3RlbSBwb3J0YWwgYnV0dG9uDQpkcm9wZG93bk9wdGlvbnMucHVzaChzeXN0ZW1NZW51Qm90KTsNCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwEEYm90cyRlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcBJwCMrpmuBodkBnN5c3RlbQIEAIyuma4GiGQNYWIuYWN0aW9uLmFzaycAjK6ZrgaHZARmb3JtAgQAjK6ZrgaWZAdub3RoaW5nJwCMrpmuBodkBmFza0dQVAIEAIyuma4GnmSpCkBpZiAoIXRhZ3MuZ3B0QWN0aXZlIHx8IGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dBSSA9PSBmYWxzZSkKewogICAgY29uc3QgYWlNZXNzYWdlID0gbGlua3MucmVtZW1iZXIudGFncy5haV9yZWplY3Rpb25fbWVzc2FnZSA/PyAiQUkgbm90IGF1dGhvcml6ZWQgZm9yIHRoaXMgYWNjb3VudCI7CgogICAgb3MudG9hc3QoYWlNZXNzYWdlLCA3KTsKCiAgICBhYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICAiOiAiICsgYWlNZXNzYWdlKTsKICAgIAogICAgcmV0dXJuOwp9IAoKLy8gY29uc29sZS5sb2coIkFTSyIsIHRoYXQpOwoKbGV0IGlucXVpcnkgPSB0aGF0LmlucXVpcnkgPz8gdGhhdDsKCmNvbnN0IHByb21wdCA9ICF0aGF0LnByb21wdCA/IHRhZ3MucHJvbXB0X2NvcmUgOiB0YWdzWyJwcm9tcHRfIiArIHRoYXQucHJvbXB0XTsKCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogdGhpbmtpbmcgYWJvdXQgIiArIGlucXVpcnkpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkJvdENoYXQoe21lc3NhZ2U6ICJ0aGlua2luZyBhYm91dCAiICsgaW5xdWlyeX0pOwoKaWYgKHRoYXQucHJvbXB0ID09ICJncmlkIikKewogICAgaW5xdWlyeSA9IGlucXVpcnkgKyBgIFBPU0lUSU9OOiB7JHt0aGF0LmRhdGEuZGltZW5zaW9ufTogdHJ1ZSwgJHt0aGF0LmRhdGEuZGltZW5zaW9ufVg6ICR7dGhhdC5kYXRhLmRpbWVuc2lvblh9LCAke3RoYXQuZGF0YS5kaW1lbnNpb259WToke3RoYXQuZGF0YS5kaW1lbnNpb25ZfX0uYAp9CmVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJib3QiKQp7CiAgICBpbnF1aXJ5ID0gaW5xdWlyeSArIGAgVEFSR0VUX0JPVF9JRDogYCArIHRoYXQuZGF0YS5ib3QuaWQ7Cn0KZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gIm11bHRpcGxlQm90IikKewogICAgaW5xdWlyeSA9IGlucXVpcnkgKyBgIFRBUkdFVF9CT1RfSURTOiBgICsgdGhhdC5kYXRhLmJvdHM7Cn0KZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gImNvcmUiKQp7Cgp9Cgpjb25zdCBhbnN3ZXIgPSBhd2FpdCB0aGlzQm90LnN1Ym1pdFJlcXVlc3RHUFQoe2lucXVpcnk6IGlucXVpcnksIHByb21wdDogcHJvbXB0LCBtb2RlbDogdGhhdC5tb2RlbH0pOwoKaWYgKGFuc3dlcikgewogICAgYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgYW5zd2VyKTsKCiAgICBjcmVhdGUoe2hvbWU6IHRydWUsIG9uQ3JlYXRlOiBgQCAke2Fuc3dlcn1gfSk7CgogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7Cn0nAIyuma4Gh2QJZ3B0QWN0aXZlAgQAjK6ZrgbIbgVmYWxzZScAjK6ZrgaHZBBzdWJtaXRSZXF1ZXN0R1BUAgQAjK6ZrgbObpUNQGltcG9ydCB7IEFJQ2hhdE9wdGlvbnMgfSBmcm9tICdjYXN1YWxvcyc7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0YCwgdGhhdCk7Cn0KCmxldCBzeXN0ZW1Qcm9tcHQgPSB0aGF0LnByb21wdCA/IHRoYXQucHJvbXB0IDogdGFncy5wcm9tcHRfY29yZTsKCnN5c3RlbVByb21wdCA9IHN5c3RlbVByb21wdCArIHRoYXQuaW5xdWlyeTsKCmlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93QUkgPT0gZmFsc2UpCnsKICAgIGxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoeyBtZXNzYWdlOiAiQUkgbm90IGF1dGhvcml6ZWQgb24gdGhpcyBhY2NvdW50IiwgbG9nVHlwZTogJ2xvZycgfSk7CiAgICByZXR1cm4gbnVsbDsKfQoKbGV0IGN1cnJlbnRFeHBlcmllbmNlQm90cyA9IGdldEJvdHMoYiA9PiBiLnNwYWNlID09PSAnc2hhcmVkJyAmJiAhYi50YWdzLmFiSWdub3JlKTsKCmlmIChjdXJyZW50RXhwZXJpZW5jZUJvdHMubGVuZ3RoID4gMCkKewogICAgc3lzdGVtUHJvbXB0ID0gc3lzdGVtUHJvbXB0ICsgIiBUaGVzZSBhcmUgdGhlIGJvdHMgdGhhdCBjdXJyZW50bHkgZXhpc3QgaW4gdGhlIGV4cGVyaWVuY2U6ICIgKyBjdXJyZW50RXhwZXJpZW5jZUJvdHM7Cn0KCmlmICghbGlua3MubWVudSkgewogICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdCgnYWJJbnRlcmZhY2UnKTsKfQoKY29uc3QgYnVzeUluZGljYXRvciA9IGF3YWl0IGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcih7IGFiTWVudTogdHJ1ZSwgbGFiZWw6IGBhc2tpbmcgJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWAgfSk7Cgpjb25zdCBhaUNoYXRPcHRpb25zOiBBSUNoYXRPcHRpb25zID0gewogICAgcHJlZmVycmVkTW9kZWw6IHRoYXQubW9kZWwgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwsCiAgICB0ZW1wZXJhdHVyZTogMCwKICAgIHRvcFA6IDEsCiAgICBwcmVzZW5jZVBlbmFsdHk6IDAuNiwKICAgIGZyZXF1ZW5jeVBlbmFsdHk6IDAsCn0KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNlbmRpbmcgdG8gYWk6YCwgeyBzeXN0ZW1Qcm9tcHQsIGFpQ2hhdE9wdGlvbnMgfSk7Cn0KCmxldCBhaVJlc3BvbnNlOiBzdHJpbmc7Cgp0cnkgewogICAgYWlSZXNwb25zZSA9IGF3YWl0IGFpLmNoYXQoc3lzdGVtUHJvbXB0LCBhaUNoYXRPcHRpb25zKTsKCiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWkgcmVzcG9uc2U6YCwgYWlSZXNwb25zZSk7CiAgICB9Cn0gY2F0Y2goZSkgewogICAgYWlSZXNwb25zZSA9IG51bGw7CgogICAgLy8gU2hvdyB0b2FzdCB3aXRoIGVycm9yLgogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6IGBBSSByZXF1ZXN0IGZhaWxlZCAtICR7bGlua3MudXRpbHMuZ2V0RXJyb3JNZXNzYWdlKGUpfWAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CgogICAgLy8gUmV0aHJvdyBzbyBjYWxsZXJzIGNhbiBjYXRjaC4KICAgIHRocm93IGU7Cn0gZmluYWxseSB7CiAgICBkZXN0cm95KGJ1c3lJbmRpY2F0b3IpOwp9CgpyZXR1cm4gYWlSZXNwb25zZTsnAIyuma4Gh2QIcmVtZW1iZXICBACMrpmuBuR7KPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIyuma4Gh2QQYWJDb3JlTWVudUFjdGlvbgIEAIyuma4Gi3ykHUBjb25zdCBpbnF1aXJ5ID0gdGhhdD8ubWVzc2FnZSA/PyB0aGF0Owpjb25zdCBpbml0aWFsQm9vdCA9IHRoYXQ/LmluaXRpYWxCb290ID8/IGZhbHNlOwpjb25zdCBhdXRvSGF0Y2ggPSB0aGF0Py5hdXRvSGF0Y2ggPz8gZmFsc2U7CmNvbnN0IG1lbnUgPSB0aGF0Py5tZW51ID8/ICJjb3JlIjsKY29uc3QgaW5xdWlyeUhhc1NwYWNlID0gaW5xdWlyeS5pbmRleE9mKCIgIikgIT09IC0xOwpjb25zdCBtZW51Qm90cyA9IGdldEJvdHMoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCwgdHJ1ZSk7Cgp3aGlzcGVyKG1lbnVCb3RzLCAiYWJNZW51UmVmcmVzaCIpOwoKbGV0IHVzZXJuYW1lID0gInVzZXIiOwppZiAoYXV0aEJvdCAmJiBhdXRoQm90LnRhZ3MubmFtZSkgewogICAgdXNlcm5hbWUgPSBhdXRoQm90LnRhZ3MubmFtZTsKfSBlbHNlIGlmIChhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWUpIHsKICAgIHVzZXJuYW1lID0gYWIubGlua3MuY29uc29sZS5tYXNrcy5wcmVmZXJyZWROYW1lOwp9CmFiLmxvZyh7IG1lc3NhZ2U6IGlucXVpcnksIG5hbWU6IHVzZXJuYW1lIH0pOwoKaWYgKCFjb25maWdCb3QudGFncy50YWdQb3J0YWwgJiYgbGlua3MucmVtZW1iZXIudGFncy5hYkF3YWtlU3RhdGUgJiYgaW5xdWlyeSAhPSAiLmxvZyIpIHsKICAgIHNob3V0KCJzaG93Q29uc29sZSIpOwp9CgppZiAoIWlucXVpcnlIYXNTcGFjZSkgewogICAgY29uc3QgaXNEaXJlY3RTZWFyY2ggPSBpbnF1aXJ5LnN0YXJ0c1dpdGgoYCJgKSAmJiBpbnF1aXJ5LmVuZHNXaXRoKGAiYCk7CiAgICBjb25zdCBpc0NoYW5uZWxTZWFyY2ggPSBpbnF1aXJ5WzBdID09ICJAIjsKCiAgICBjb25zdCBhc2s6IEFCTG9va3VwQXNrSURSZXN1bHQgfCBmYWxzZSA9ICFpc0RpcmVjdFNlYXJjaCA/IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsgYXNrSUQ6IGlucXVpcnksIGNoYW5uZWxDb25maWc6IGlzQ2hhbm5lbFNlYXJjaCwgYXV0b0hhdGNoOiB0cnVlLCBzb3VyY2VFdmVudDogJ2FzaycgfSkgOiBmYWxzZTsKCiAgICBpZiAoYXNrPy5zdWNjZXNzICYmIGFzaz8uZGF0YT8udXJsICE9IHVuZGVmaW5lZCAmJiAhaXNEaXJlY3RTZWFyY2ggJiYgIWlzQ2hhbm5lbFNlYXJjaCkgewogICAgICAgIGxpbmtzLmxlYXJuLmFiSm9pbkhvc3QoeyBkYXRhOiBhc2suZGF0YSB9KTsKICAgIH0gZWxzZSBpZiAoYXNrPy5zdWNjZXNzICYmIGlzQ2hhbm5lbFNlYXJjaCkgewogICAgICAgIGxpbmtzLmNoYW5uZWxMb2FkZXI/LmxvYWRDaGFubmVsKGFzayk7CiAgICB9IGVsc2UgaWYgKCFhc2s/LnN1Y2Nlc3MpIHsKICAgICAgICBsZXQgZWdnOiBBQkxvb2t1cEVnZ1Jlc3VsdDsKICAgICAgICBjb25zdCBwZXJpb2RJbmRleCA9IGlucXVpcnkuaW5kZXhPZigiLiIpOwogICAgICAgIGxldCBhYklEID0gaW5xdWlyeTsKCiAgICAgICAgaWYgKGlzRGlyZWN0U2VhcmNoKSB7CiAgICAgICAgICAgIGFiSUQgPSBpbnF1aXJ5LnN1YnN0cmluZygxLCBpbnF1aXJ5Lmxlbmd0aCAtIDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHBlcmlvZEluZGV4ID09IC0xIHx8IGlzRGlyZWN0U2VhcmNoKSB7CiAgICAgICAgICAgIGVnZyA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7IGFiSUQ6IGFiSUQsIGluaXRpYWxCb290LCBhdXRvSGF0Y2gsIHNvdXJjZUV2ZW50OiAnYXNrJyB9KTsKICAgICAgICB9IGVsc2UgaWYgKHBlcmlvZEluZGV4ID4gMCkgewogICAgICAgICAgICBjb25zdCByZWNvcmRLZXkgPSBpbnF1aXJ5LnN1YnN0cmluZygwLCBwZXJpb2RJbmRleCk7CgogICAgICAgICAgICBhYklEID0gaW5xdWlyeS5zdWJzdHJpbmcocGVyaW9kSW5kZXggKyAxKTsKCiAgICAgICAgICAgIGVnZyA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7IHJlY29yZEtleTogcmVjb3JkS2V5LCBhYklEOiBhYklELCBpbml0aWFsQm9vdCwgYXV0b0hhdGNoLCBzb3VyY2VFdmVudDogJ2FzaycsIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxpbmtzLmlucHV0Lm9uQ2hhdCh7IG1lc3NhZ2U6IGlucXVpcnkgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWVnZz8uc3VjY2VzcyAmJiBsaW5rcy5tZW51KSB7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgogICAgICAgICAgICBjb25zdCBzdHVkaW9CdXR0b24gPSB7fTsKCiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ubGFiZWwgPSBhYklEICsgIiBub3QgZm91bmQgaW4gYWN0aXZlIHN0dWRpbywgZW50ZXIgYWx0ZXJuYXRlIHN0dWRpb0lEIjsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgICAgICAgICBzdHVkaW9CdXR0b24uYWJJRCA9IGFiSUQ7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5mb3JtQWRkcmVzcyA9IHRhZ3MuYWJDb3JlTWVudUljb247CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5vblN1Ym1pdCA9IGBAIGxpbmtzLm1hbmFnZXIuYWJDb3JlTWVudUFjdGlvbih0aGF0LnRleHQgKyAiLiIgKyB0YWdzLmFiSUQpO2A7CgogICAgICAgICAgICBjb25zdCBjcmVhdGVCdXR0b24gPSB7fTsKCiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgICAgICAgICBjcmVhdGVCdXR0b24ubGFiZWwgPSAiZ2l2ZSBtZSBhIHByb3RvdHlwZSI7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYklEID0gYWJJRDsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnByb3RvdHlwZSh0YWdzLmFiSUQpO2A7CgogICAgICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihjcmVhdGVCdXR0b24pOwogICAgICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihzdHVkaW9CdXR0b24pOwoKICAgICAgICAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IjsKICAgICAgICB9CiAgICB9Cn0gZWxzZSB7CiAgICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKICAgIGlmICghYXV0aEJvdCkgewogICAgICAgIG9zLnRvYXN0KCJwbGVhc2Ugc2lnbiBpbiB0byBhY2Nlc3MgYWR2YW5jZWQgQUkgZmVhdHVyZXMiKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICB9IGVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpIHsKICAgICAgICBvcy50b2FzdCgicGxlYXNlIGNoZWNrIHlvdXIgc3Vic2NyaXB0aW9uIGluIG9yZGVyIHRvIGFjY2VzcyBhZHZhbmNlZCBBSSBmZWF0dXJlcyIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKICAgIH0gZWxzZSB7CiAgICAgICAgbWFza3MuZ3B0QWN0aXZlID0gdHJ1ZTsKCiAgICAgICAgYXdhaXQgdGhpc0JvdC5hc2tHUFQoeyBpbnF1aXJ5OiBpbnF1aXJ5LCBwcm9tcHQ6IG1lbnUsIGRhdGE6IHRoYXQgfSk7CiAgICB9Cn0nAIyuma4Gh2QUYWJDb3JlTWVudU9uR2VuZXJhdGUCBACMrpmuBrCZAfIIQHRhZ3Mub25TdWJtaXQgPSBgQAogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogImNvcmUifSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwpgOwp0YWdzLm9uSW5wdXRUeXBpbmcgPSBgQAogICAgaWYgKCF0YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkQ29yZVRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNDb3JlW21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQ29yZS5sZW5ndGggLSAxKV07CgogICAgICAgIGxpbmtzLmJhc2VTa2lsbC5pbnB1dFN1Z2dlc3Rpb24oeyBpbnB1dEJvdDogdGhpc0JvdCwgdGV4dCB9KTsKICAgIH0KfScAjK6ZrgaHZBNhYkNvcmVNZW51U29ydE9yZGVyAgQAjK6ZrgajogEDMTAyJwCMrpmuBodkEGFiR3JpZE1lbnVBY3Rpb24CBACMrpmuBqeiAQ5ALy9wbGFjZWhvbGRlcicAjK6ZrgaHZBRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAIyuma4GtqIB/wpAdGFncy5kaW1lbnNpb24gPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzLmRpbWVuc2lvbjsKdGFncy5kaW1lbnNpb25YID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cy5wb3NpdGlvbi54Owp0YWdzLmRpbWVuc2lvblkgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzLnBvc2l0aW9uLnk7CnRhZ3Mub25TdWJtaXQgPSBgQAogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogImdyaWQiLCBkaW1lbnNpb246IHRhZ3MuZGltZW5zaW9uLCBkaW1lbnNpb25YOiB0YWdzLmRpbWVuc2lvblgsIGRpbWVuc2lvblk6IHRhZ3MuZGltZW5zaW9uWX0pOwogICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyU3VibWl0dGVkQ29yZVRleHQnLCB0cnVlLCAnbG9jYWwnKTsKYDsKdGFncy5vbklucHV0VHlwaW5nID0gYEAKICAgIGlmICghdGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCkgewogICAgICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclR5cGVkQ29yZVRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIH0KYDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfQoKaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCAmJiAhbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclN1Ym1pdHRlZENvcmVUZXh0KSB7CiAgICBhd2FpdCBvcy5zbGVlcChsaW5rcy5iYXNlU2tpbGwudGFncy5pbnB1dFN1Z2dlc3Rpb25XYWl0TVMpOwoKICAgIGlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQpIHsKICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gZnJvbSBidWlsdC1pbiBzdWdnZXN0aW9ucy4KICAgICAgICBsZXQgdGV4dCA9IGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQ29yZVttYXRoLnJhbmRvbUludCgwLCBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0NvcmUubGVuZ3RoIC0gMSldOwoKICAgICAgICBsaW5rcy5iYXNlU2tpbGwuaW5wdXRTdWdnZXN0aW9uKHsgaW5wdXRCb3Q6IHRoaXNCb3QsIHRleHQgfSk7CiAgICB9Cn0nAIyuma4Gh2QNbWFuaWZlc3RhdGlvbgIEAIyuma4Gtq0BKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAIyuma4Gh2QTYWJHcmlkTWVudVNvcnRPcmRlcgIEAIyuma4G3a0BAzEwMicAjK6ZrgaHZA9hYkdyaWRNZW51TGFiZWwCBACMrpmuBuGtAQZhc2sgYWInAIyuma4Gh2QPYWJDb3JlTWVudUxhYmVsAgQAjK6ZrgborQEGYXNrIGFiJwCMrpmuBodkDmFiQ29yZU1lbnVJY29uAgQAjK6ZrgbvrQEEY3ViZScAjK6ZrgaHZA5hYkdyaWRNZW51SWNvbgIEAIyuma4G9K0BBGN1YmUnAIyuma4Gh2QKZWRpdFByb21wdAIEAIyuma4G+a0BhwhAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgcHJvbXB0TWVudUJ1dHRvbiA9IHt9OwoKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwpwcm9tcHRNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CnByb21wdE1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKcHJvbXB0TWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CnByb21wdE1lbnVCdXR0b24uZ3B0Qm90ID0gIvCflJciICsgdGhpc0JvdC5pZDsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJsb2FkIHByb21wdCI7CnByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2xvdWRfZG93bmxvYWQiOwpwcm9tcHRNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5ncHRCb3QudXBkYXRlUHJvbXB0KCdsb2FkJyk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJzYXZlIHByb21wdCI7CnByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiYmFja3VwIjsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LnVwZGF0ZVByb21wdCgnc2F2ZScpOyI7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsKCm1hc2tzLm9uR3JpZENsaWNrID0gYEAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7Cgp0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwpgOwoKdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gInRvcCI7Cgpjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gdGhpc0JvdC5pZCArICIucHJvbXB0X2NvcmUiOwoKaWYgKGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSkKewogICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKfScAjK6ZrgaHZARtZW51AgQAjK6Zrgb/tQEo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAjK6ZrgaHZAx1cGRhdGVQcm9tcHQCBACMrpmuBqa2AcsIQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IHByb21wdE1lbnVCdXR0b24gPSB7fTsKCnByb21wdE1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtID0gImlucHV0IjsKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpwcm9tcHRNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CnByb21wdE1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwpwcm9tcHRNZW51QnV0dG9uLmdwdEJvdCA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CgppZiAodGhhdCA9PSAibG9hZCIpCnsKICAgIHByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAibG9hZCBwcm9tcHQiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjbG91ZF9kb3dubG9hZCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLm9uU3VibWl0ID0gIkAgbGlua3MuZ3B0Qm90LmxvYWRQcm9tcHQodGhhdC50ZXh0KTsiOwp9CmVsc2UKewogICAgcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJzYXZlIHByb21wdCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImJhY2t1cCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLm9uU3VibWl0ID0gIkAgbGlua3MuZ3B0Qm90LnNhdmVQcm9tcHQodGhhdC50ZXh0KTsiOwp9CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsKCnByb21wdE1lbnVCdXR0b24uZm9ybSA9IG51bGw7CnByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAiICAiOwpwcm9tcHRNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CnByb21wdE1lbnVCdXR0b24uY29sb3IgPSAiI2YyNDcyNyI7CnByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2FuY2VsIjsKcHJvbXB0TWVudUJ1dHRvbi5vblN1Ym1pdCA9IG51bGw7CnByb21wdE1lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLmdwdEJvdC5lZGl0UHJvbXB0KCk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOycAjK6ZrgaHZApsb2FkUHJvbXB0AgQAjK6ZrgbwvgHaA0Bhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKaWYgKGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dQdWJsaWNEYXRhID09IGZhbHNlKQp7CiAgICBvcy50b2FzdCgibm90IGF1dGhvcml6ZWQiKTsKCiAgICByZXR1cm47Cn0KCmNvbnN0IHByb21wdE5hbWUgPSAiZ3B0X3Byb21wdF8iICsgdGhhdDsKY29uc3QgbmV3UHJvbXB0ID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBwcm9tcHROYW1lKTsKCmlmICghbmV3UHJvbXB0LnN1Y2Nlc3MpCnsKICAgIG9zLnRvYXN0KCJubyBwcm9tcHQgZm91bmQgYnkgdGhhdCBuYW1lIik7Cn0KZWxzZQp7CiAgICB0YWdzLnByb21wdF9jb3JlID0gbmV3UHJvbXB0LmRhdGE7Cn0KCmlmIChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSA9PSB0aGF0KQp7CiAgICByZXR1cm47Cn0KCnRoaXNCb3QuZWRpdFByb21wdCgpOycAjK6ZrgaHZApzYXZlUHJvbXB0AgQAjK6ZrgbLwgG+BEBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKaWYgKGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dQdWJsaWNEYXRhID09IGZhbHNlIHx8IGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMucHVibGlzaERhdGEgPT0gZmFsc2UpCnsKICAgIG9zLnRvYXN0KCJub3QgYXV0aG9yaXplZCIpOwoKICAgIHJldHVybjsKfQoKY29uc3QgYXV0aG9yID0gYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKY29uc3QgcHJvbXB0TmFtZSA9ICJncHRfcHJvbXB0XyIgKyB0aGF0Owpjb25zdCBuZXdQcm9tcHQgPSBhd2FpdCBvcy5yZWNvcmREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIHByb21wdE5hbWUsIHRhZ3MucHJvbXB0X2NvcmUsIHt1cGRhdGVQb2xpY3k6IFthdXRob3IuaWRdfSk7CgppZiAoIW5ld1Byb21wdC5zdWNjZXNzKQp7CiAgICBvcy50b2FzdCgic29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4iKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJwcm9tcHQgc2F2ZWQgYXMgIiArIHRoYXQpOwp9Cgp0aGlzQm90LmVkaXRQcm9tcHQoKTsnAIyuma4Gh2QIYWJJZ25vcmUCBACMrpmuBorHAQR0cnVlJwCMrpmuBodkCGFiQWN0aW9uAgQAjK6ZrgaPxwEEdHJ1ZScAjK6ZrgaHZAZzZWFyY2gCBACMrpmuBpTHASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCMrpmuBodkBWxlYXJuAgQAjK6Zrga7xwEo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAjK6ZrgaHZAptYXhfdG9rZW5zAgQAjK6ZrgbixwEENTAwMCcAjK6ZrgaHZA9vbkFCSW5pdGlhbGl6ZWQCBACMrpmuBufHAVhAaWYgKGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlKQp7CiAgICB0aGlzQm90LmxvYWRQcm9tcHQoY29uZmlnQm90LnRhZ3MucHJvbXB0X2Jhc2UpOwp9JwCMrpmuBodkBWFza0FCAgQAjK6ZrgbAyAHUA0AvL3Nob3V0KCJhc2tBQiIsIHtwcm9tcHQ6IHByb21wdCwgc2hvdXQ6IHNob3V0LCBjb250ZXh0OiBjb250ZXh0fSk7CgppZiAoIXRhZ3MuZ3B0QWN0aXZlKSByZXR1cm47CgpsZXQgaW5xdWlyeSA9IHRoYXQucHJvbXB0OwoKLy9hYi5sb2coInVzZXI6ICIgKyBpbnF1aXJ5KTsgLy9ub3QgbmVlZGVkCgpjb25zdCBhbnN3ZXIgPSBhd2FpdCB0aGlzQm90LnN1Ym1pdFJlcXVlc3RHUFQoe2lucXVpcnk6IGlucXVpcnksIGNvbnRleHQ6IHRoYXQuY29udGV4dCwgZGVmaW5lZFByb21wdDogdHJ1ZX0pOwoKYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgYW5zd2VyKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJCb3RDaGF0KHttZXNzYWdlOiBhbnN3ZXJ9KTsKCmlmICh0aGF0LnNob3V0KQp7CiAgICBzaG91dCh0aGF0LnNob3V0LCBhbnN3ZXIpOwp9CgpyZXR1cm4gYW5zd2VyOycAjK6ZrgaHZAVpbnB1dAIEAIyuma4GlcwBKPCflJdmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjAnAIyuma4Gh2QLcHJvbXB0X2NvcmUCBACMrpmuBrzMAfkPREVMSVZFUkFCTEU6IFJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCk9CSkVDVElWRTogQmFzZWQgb24gdGhlIElOUFVULCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvciBpbiBDYXN1YWxPUy4gVGhlIGNvZGUgbXVzdDoKCjEuIEltcGxlbWVudCB0aGUgcmVxdWVzdGVkIGFjdGlvbi4KMi4gQWx3YXlzIGluY2x1ZGUgYGFiLmxvZygiYSBkZXNjcmlwdGlvbiBvZiB0aGUgZXhlY3V0aW9uIilgIHRvIGluZGljYXRlIHdoYXQgdGhlIGNvZGUgaXMgZG9pbmcuCjMuIEFsd2F5cyBpbmNsdWRlIGBkZXN0cm95KHRoaXNCb3QpO2AgYXQgdGhlIGVuZCB0byByZW1vdmUgdGhlIGJvdCBhZnRlciBleGVjdXRpb24uCjQuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBib3Qgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgoKUk9MRTogWW91IGFyZSBQTSBCb3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9jYXN1YWwtc2ltdWxhdGlvbi9jYXN1YWxvcyksIGEgd2ViLWJhc2VkIElERSBmb3IgYm90IHNjcmlwdGluZy4KCkVYQU1QTEVTOgoKRXhhbXBsZSAxOiAgCklucHV0OiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKQW5zd2VyOgphYi5sb2coIlRoZSBza3kgaXMgYmx1ZSIpOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDI6ICAKSW5wdXQ6IE1ha2UgYSByZWQgYm90IGF0IHNjYWxlIDIgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBjbGlja2VkLiAgCkFuc3dlcjoKYWIubG9nKCJNYWRlIGEgcmVkIGJvdCIpOyAgCmNyZWF0ZSh7aG9tZTogdHJ1ZSwgaG9tZVg6IDAsIGhvbWVZOiAwLCBjb2xvcjogInJlZCIsIG9uQ2xpY2s6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsIHNjYWxlOiAyLCBjcmVhdG9yOiBudWxsfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMzogIApJbnB1dDogTWFrZSBhIGJvdCB0aGF0IG1ha2VzIGEgY29weSBvZiBpdHNlbGYgbmV4dCB0byBpdC4gIApBbnN3ZXI6CmFiLmxvZygiTWFkZSBhIGNvcHkgYm90Iik7ICAKY3JlYXRlKHtob21lOiB0cnVlLCBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge2hvbWVYOiB0YWdzLmhvbWVYICsgMSwgY3JlYXRvcjogbnVsbH0pIn0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDQ6ICAKSW5wdXQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuICAKQW5zd2VyOgphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOyAgCnNldFRhZyhnZXRCb3RzKCJjb2xvciIsICJyZWQiKSwgImNvbG9yIiwgImJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA1OiAgCklucHV0OiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uICAKQW5zd2VyOgphYi5sb2coIk1hZGUgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsbyIpOyAgCmNyZWF0ZSh7ICAKICBob21lOiB0cnVlLCAgCiAgY29sb3I6ICJibHVlIiwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7b25DbGljazogbnVsbCwgb25Qb2ludGVyRW50ZXI6IHRhZ3Mub25Qb2ludGVyRW50ZXJTY3JpcHR9KSIsICAKICBvblBvaW50ZXJFbnRlclNjcmlwdDogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogIGNyZWF0b3I6IG51bGwgIAp9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKSU5QVVQ6CicAjK6ZrgaHZAtwcm9tcHRfZ3JpZAIEAIyuma4GttwBnBRERUxJVkVSQUJMRTogUmV0dXJuIG9ubHkgSmF2YVNjcmlwdCBjb2RlLiBEbyBub3QgaW5jbHVkZSBxdW90ZXMsIE1hcmtkb3duIGZvcm1hdHRpbmcsIG9yIGFueSBleHBsYW5hdG9yeSB0ZXh0LiBUaGUgY29kZSBzaG91bGQgYmUgdmFsaWQgYW5kIGV4ZWN1dGFibGUgaW5zaWRlIHRoZSBgb25DcmVhdGVgIGZpZWxkIG9mIGEgYm90IGluIENhc3VhbE9TLgoKT0JKRUNUSVZFOiBCYXNlZCBvbiB0aGUgSU5QVVQgYW5kIHByb3ZpZGVkIFBPU0lUSU9OIGRhdGEsIGdlbmVyYXRlIEphdmFTY3JpcHQgdGhhdCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yIGluIENhc3VhbE9TLiBUaGUgY29kZSBtdXN0OgoKMS4gSW1wbGVtZW50IHRoZSByZXF1ZXN0ZWQgYWN0aW9uLgoyLiBBbHdheXMgaW5jbHVkZSBgYWIubG9nKCJhIGRlc2NyaXB0aW9uIG9mIHRoZSBleGVjdXRpb24iKWAgdG8gaW5kaWNhdGUgd2hhdCB0aGUgY29kZSBpcyBkb2luZy4KMy4gQWx3YXlzIGluY2x1ZGUgYGRlc3Ryb3kodGhpc0JvdCk7YCBhdCB0aGUgZW5kIHRvIHJlbW92ZSB0aGUgYm90IGFmdGVyIGV4ZWN1dGlvbi4KNC4gVXNlIHRoZSBQT1NJVElPTiBkYXRhIHdoZW4gcGxhY2luZyBib3RzIG9yIGRldGVybWluaW5nIHNwYXRpYWwgYmVoYXZpb3IgKGUuZy4sIGBob21lWGAsIGBob21lWWAsIG9mZnNldHMsIHBsYWNlbWVudCBsb2dpYykuCjUuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBib3Qgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgoKUE9TSVRJT04gREFUQToKLSBZb3Ugd2lsbCByZWNlaXZlIGNvbnRleHQgc3VjaCBhcyBgcG9zaXRpb24gPSB7IHg6IDxudW1iZXI+LCB5OiA8bnVtYmVyPiB9YC4KLSBVc2UgdGhpcyBkYXRhIHRvIGRldGVybWluZSBhcHByb3ByaWF0ZSBgaG9tZVhgLCBgaG9tZVlgLCBvciByZWxhdGl2ZSBwbGFjZW1lbnRzIGZvciBhbnkgY3JlYXRlZCBib3RzLgoKUk9MRTogWW91IGFyZSBQTSBCb3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9jYXN1YWwtc2ltdWxhdGlvbi9jYXN1YWxvcyksIGEgd2ViLWJhc2VkIElERSBmb3IgYm90IHNjcmlwdGluZy4KCkVYQU1QTEVTOgoKRXhhbXBsZSAxOiAgCklucHV0OiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKUG9zaXRpb246IHsgeDogNSwgeTogNSB9ICAKQW5zd2VyOiAgCmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMjogIApJbnB1dDogTWFrZSBhIHJlZCBib3QgYXQgc2NhbGUgMiB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGNsaWNrZWQuICAKUG9zaXRpb246IHsgeDogMSwgeTogMiB9ICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIHJlZCBib3QiKTsgIApjcmVhdGUoe2hvbWU6IHRydWUsIGhvbWVYOiAxLCBob21lWTogMiwgY29sb3I6ICJyZWQiLCBvbkNsaWNrOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCBzY2FsZTogMiwgY3JlYXRvcjogbnVsbH0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKUG9zaXRpb246IHsgeDogMCwgeTogMCB9ICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIGNvcHkgYm90Iik7ICAKY3JlYXRlKHtob21lOiB0cnVlLCBob21lWDogMCwgaG9tZVk6IDAsIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7aG9tZVg6IHRhZ3MuaG9tZVggKyAxLCBjcmVhdG9yOiBudWxsfSkifSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNDogIApJbnB1dDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApQb3NpdGlvbjogeyB4OiAxMCwgeTogLTMgfSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOyAgCnNldFRhZyhnZXRCb3RzKCJjb2xvciIsICJyZWQiKSwgImNvbG9yIiwgImJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA1OiAgCklucHV0OiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uICAKUG9zaXRpb246IHsgeDogMywgeTogMyB9ICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvIik7ICAKY3JlYXRlKHsgIAogIGhvbWU6IHRydWUsICAKICBob21lWDogMywgIAogIGhvbWVZOiAzLCAgCiAgY29sb3I6ICJibHVlIiwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7b25DbGljazogbnVsbCwgb25Qb2ludGVyRW50ZXI6IHRhZ3Mub25Qb2ludGVyRW50ZXJTY3JpcHR9KSIsICAKICBvblBvaW50ZXJFbnRlclNjcmlwdDogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogIGNyZWF0b3I6IG51bGwgIAp9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKSU5QVVQ6CicAjK6ZrgaHZApwcm9tcHRfYm90AgQAjK6ZrgbT8AHSF0RFTElWRVJBQkxFOiBSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgpPQkpFQ1RJVkU6IEJhc2VkIG9uIHRoZSBJTlBVVCBhbmQgdGhlIHByb3ZpZGVkIFRBUkdFVF9CT1RfSUQsIGdlbmVyYXRlIEphdmFTY3JpcHQgdGhhdCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yIGluIENhc3VhbE9TLiBUaGUgY29kZSBtdXN0OgoKMS4gSW1wbGVtZW50IHRoZSByZXF1ZXN0ZWQgYWN0aW9uLgoyLiBBbHdheXMgaW5jbHVkZSBgYWIubG9nKCJhIGRlc2NyaXB0aW9uIG9mIHRoZSBleGVjdXRpb24iKWAgdG8gZGVzY3JpYmUgd2hhdCB0aGUgY29kZSBkb2VzLgozLiBBbHdheXMgaW5jbHVkZSBgZGVzdHJveSh0aGlzQm90KTtgIGF0IHRoZSBlbmQgdG8gcmVtb3ZlIHRoZSBib3QgYWZ0ZXIgZXhlY3V0aW9uLgo0LiBVc2UgdGhlIGBUQVJHRVRfQk9UX0lEYCBhcyBjb250ZXh0IGZvciBsb2NhdGlvbiBvciBiZWhhdmlvciB3aGVuIGFwcHJvcHJpYXRlLiBGb3IgZXhhbXBsZSwgaWYgYSBuZXcgYm90IGlzIGNyZWF0ZWQsIHlvdSBtYXkgcG9zaXRpb24gaXQgYmFzZWQgb24gdGhlIHRhcmdldCBib3QncyBgaG9tZVhgIGFuZCBgaG9tZVlgIHRhZ3MuCjUuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCgpCT1QgQ09OVEVYVDoKLSBZb3Ugd2lsbCByZWNlaXZlIGBUQVJHRVRfQk9UX0lEID0gIjxib3RJZD4iYC4KLSBZb3UgbXVzdCB1c2UgYGdldEJvdCgiaWQiLCAiPGJvdElkPiIpYCB0byByZXRyaWV2ZSB0aGUgYm90IGFuZCBhY2Nlc3MgaXRzIHRhZ3MgKGUuZy4sIGBnZXRCb3QoImlkIiwgVEFSR0VUX0JPVF9JRCkudGFncy5ob21lWGApLgotIFlvdSBjYW4gcG9zaXRpb24gbmV3IGJvdHMgbmVhciB0aGUgdGFyZ2V0IGJvdCBieSB1c2luZyBpdHMgYGhvbWVYYCwgYGhvbWVZYCwgb3Igb3RoZXIgdGFnIGRhdGEuCgpST0xFOiBZb3UgYXJlIFBNIEJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2FsYW4tYWkvY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgpFWEFNUExFUzoKCkV4YW1wbGUgMTogIApJbnB1dDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PyAgClRBUkdFVF9CT1RfSUQ6ICJza3lfMTIzIiAgCkFuc3dlcjogIAphYi5sb2coIlRoZSBza3kgaXMgYmx1ZSIpOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDI6ICAKSW5wdXQ6IE1ha2UgYSByZWQgYm90IGF0IHNjYWxlIDIgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBjbGlja2VkLiAgClRBUkdFVF9CT1RfSUQ6ICJib3RfMDAxIiAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYSByZWQgYm90Iik7ICAKbGV0IHRhcmdldCA9IGdldEJvdCgiaWQiLCAiYm90XzAwMSIpOyAgCmNyZWF0ZSh7ICAKICBob21lOiB0cnVlLCAgCiAgaG9tZVg6IHRhcmdldC50YWdzLmhvbWVYLCAgCiAgaG9tZVk6IHRhcmdldC50YWdzLmhvbWVZLCAgCiAgY29sb3I6ICJyZWQiLCAgCiAgb25DbGljazogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogIHNjYWxlOiAyLCAgCiAgY3JlYXRvcjogbnVsbCAgCn0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKVEFSR0VUX0JPVF9JRDogImJvdF9jb3BpZXIiICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIGNvcHkgYm90Iik7ICAKbGV0IHRhcmdldCA9IGdldEJvdCgiaWQiLCAiYm90X2NvcGllciIpOyAgCmNyZWF0ZSh7ICAKICBob21lOiB0cnVlLCAgCiAgaG9tZVg6IHRhcmdldC50YWdzLmhvbWVYLCAgCiAgaG9tZVk6IHRhcmdldC50YWdzLmhvbWVZLCAgCiAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtob21lWDogdGFncy5ob21lWCArIDEsIGNyZWF0b3I6IG51bGx9KSIgIAp9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA0OiAgCklucHV0OiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgClRBUkdFVF9CT1RfSUQ6ICJyZWZfYm90IiAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOyAgCnNldFRhZyhnZXRCb3RzKCJjb2xvciIsICJyZWQiKSwgImNvbG9yIiwgImJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA1OiAgCklucHV0OiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uICAKVEFSR0VUX0JPVF9JRDogImJvdF9wYXJlbnQiICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvIik7ICAKbGV0IHRhcmdldCA9IGdldEJvdCgiaWQiLCAiYm90X3BhcmVudCIpOyAgCmNyZWF0ZSh7ICAKICBob21lOiB0cnVlLCAgCiAgaG9tZVg6IHRhcmdldC50YWdzLmhvbWVYLCAgCiAgaG9tZVk6IHRhcmdldC50YWdzLmhvbWVZLCAgCiAgY29sb3I6ICJibHVlIiwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7b25DbGljazogbnVsbCwgb25Qb2ludGVyRW50ZXI6IHRhZ3Mub25Qb2ludGVyRW50ZXJTY3JpcHR9KSIsICAKICBvblBvaW50ZXJFbnRlclNjcmlwdDogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogIGNyZWF0b3I6IG51bGwgIAp9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKSU5QVVQ6ICAKJwCMrpmuBodkD2FiQm90TWVudUFjdGlvbgIEAIyuma4GpogCDkAvL3BsYWNlaG9sZGVyJwCMrpmuBodkE2FiQm90TWVudU9uR2VuZXJhdGUCBACMrpmuBrWIArEJQHRhZ3MudGFyZ2V0Qm90ID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdEZvY3VzOwp0YWdzLm9uU3VibWl0ID0gYEAKICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJib3QiLCBib3Q6IGxpbmtzLnRhcmdldEJvdH0pOwogICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyU3VibWl0dGVkQm90VGV4dCcsIHRydWUsICdsb2NhbCcpOwpgOwp0YWdzLm9uSW5wdXRUeXBpbmcgPSBgQAogICAgaWYgKCF0YWdzLmhhc1VzZXJUeXBlZEJvdFRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZEJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIH0KYDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfQoKCmlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQm90VGV4dCAmJiAhbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclN1Ym1pdHRlZEJvdFRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRCb3RUZXh0KSB7CiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGZyb20gYnVpbHQtaW4gc3VnZ2VzdGlvbnMuCiAgICAgICAgbGV0IHRleHQgPSBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0JvdFttYXRoLnJhbmRvbUludCgwLCBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0JvdC5sZW5ndGggLSAxKV07CgogICAgICAgIGxpbmtzLmJhc2VTa2lsbC5pbnB1dFN1Z2dlc3Rpb24oeyBpbnB1dEJvdDogdGhpc0JvdCwgdGV4dCB9KTsKICAgIH0KfScAjK6ZrgaHZA1pdGVyYXRlUHJvbXB0AgQAjK6ZrgbnkQLsBUBjb25zdCBpbnF1aXJ5ID0gYFBsZWFzZSBhdWdtZW50IHRoZSBmb2xsb3dpbmcgUFJPTVBUIGJ5IG1ha2luZyBpdCBtb3JlIGVhc2lseSByZWFkIGJ5IEdQVC4gIFBsZWFzZSBmb2N1cyBvbiB0aGUgZnVuY3Rpb25hbGl0eSBpbnNpZGUgb2YgaXQ6CgoxLiBUaGUgcHJvbXB0IG11c3QgbWFpbnRhaW4gYWxsIG9mIHRoZSBmdW5jdGlvbmFsaXR5IG9mIHRoZSBvcmlnaW5hbAoKMi4gVGhlIHByb21wdCBzaG91bGQga2VlcCBpbiBtaW5kIHRoYXQgd2UgYXJlIHdvcmtpbmcgaW4gYSAzRCBlbnZpcm9ubWVudAoKMy4gVGhlIHJlcGx5IHNob3VsZCBvbmx5IGJlIHRoZSBuZXcgcHJvbXB0Cgo0LiBUaGUgZnVuY3Rpb25zIHNob3VsZCBiZSBsaW1pdGVkIHRvIHRob3NlIGZvdW5kIGluIHRoZSBvcmlnaW5hbCBwcm9tcHQKClBST01QVDpgOwpjb25zdCBwcm9tcHQgPSB0YWdzWyJwcm9tcHRfIiArIHRoYXRdOwpjb25zdCBpdGVyYXRpb24gPSBhd2FpdCB0aGlzQm90LnN1Ym1pdFJlcXVlc3RHUFQoe2lucXVpcnk6IGlucXVpcnksIHByb21wdDogcHJvbXB0fSk7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBpdGVyYXRpb24pOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkJvdENoYXQoe21lc3NhZ2U6IG5ld0Fuc3dlcn0pOwoKdGFnc1sicHJvbXB0XyIgKyB0aGF0XSA9IGl0ZXJhdGlvbjsKdGFnc1sicHJvbXB0XyIgKyB0aGF0ICsgIl92ZXJzaW9uIl0rKzsKCnJldHVybjsnAIyuma4Gh2QSYWJCb3RNZW51U29ydE9yZGVyAgQAjK6ZrgbUlwIDMTAyJwCMrpmuBodkEmNvbnZlcnNhdGlvblByb21wdAIEAIyuma4G2JcC4ApZb3UgYXJlIGFuIGFnZW50IHRhc2tlZCB3aXRoIGRldGVybWluaW5nIGludGVudGlvbiBiYXNlZCBvbiBhIHN0YXRlbWVudCBhIHVzZXIgZ2l2ZXMgeW91LgoKUGxlYXNlIGxvb2sgYXQgdGhlIGZvbGxvd2luZyBzdGF0ZW1lbnQgYW5kIGRldGVybWluZSBpZiBpdCBpcyBhIENvbnZlcnNhdGlvbiBSZXF1ZXN0IG9yIEJ1aWxkIFJlcXVlc3QuCgpCdWlsZCBSZXF1ZXN0czogIFNwZWNpZmljIHJlcXVlc3QgZm9yIHRoZSBzeXN0ZW0gdG8gYnVpbGQsIG1ha2Ugb3IgcHJvdmlkZSBjb2RlIGZvciBzb21ldGhpbmcgc3BlY2lmaWMuClRoZXNlIHJlcXVlc3RzIHdpbGwgZ2VuZXJhbGx5IGJlIGluIHRoZSBmb3JtIG9mIGNvbW1hbmRzIG9yIHJlcXVlc3RzIGZyb20gdGhlIHN5c3RlbS4KRXhhbXBsZSBCdWlsZCBSZXF1ZXN0czogCk1ha2UgYSB5ZWxsb3cgYmFsbC4gClBsZWFzZSBjcmVhdGUgYSBiaWcgcHVycGxlIGN1YmUuICAKV3JpdGUgdGhlIGNvZGUgZm9yIGEgYm90IHRoYXQgY2hhbmdlcyBjb2xvcnMgd2hlbiBjbGlja2VkLgoKQ29udmVyc2F0aW9uIFJlcXVlc3RzOiAgQW55IHJlcXVlc3QgdGhhdCBpcyBub3QgYSBCdWlsZCBSZXF1ZXN0IHdpbGwgZGVmYXVsdCB0byBiZWluZyBhIENvbnZlcnNhdGlvbi4KRXZlbiBpZiB0aGUgcmVxdWVzdHMgZGlzY3Vzc2VzIG1ha2luZyBidWlsZGluZyBvciBjb2RpbmcgdGhpbmdzIGl0IGlzIHN0aWxsIENvbnZlcnNhdGlvbiBpZiBpdCBpcyBub3Qgd29yZGVkIGFzIGEgZGlyZWN0IHJlcXVlc3QuCkV4YW1wbGUgQ29udmVyc2F0aW9uIFJlcXVlc3RzOgpDb3VsZCBJIGJ1aWxkIGEgYm90IHRoYXQgZ2V0cyBiaWdnZXIgd2hlbiBjbGlja2VkPwpJcyBpdCBwb3NzaWJsZSB0byBjb2RlIGJvdHMgdGhhdCBtb3ZlPwpDYW4gbXkgc29uIG1ha2UgYSB5ZWxsb3cgYmFsbCBpbiBDYXN1YWxPUz8KCkRldGVybWluaW5nIEludGVudDogIElmIGNvbmRpdGlvbnMgZm9yIEJ1aWxkIFJlcXVlc3QgYXJlIHNwZWNpZmljYWxseSBtZXQgdGhlbiBpdCdzIGEgQnVpbGQgUmVxdWVzdC4gRXZlcnl0aGluZyBlbHNlIGlzIENvbnZlcnNhdGlvbi4KCkRldGVybWluZSB0aGUgaW50ZW50aW9uIG9mIHRoZSBzdGF0ZW1lbnQgYW5kIHJldHVybiB0cnVlIGlmIGl0J3MgYSBCdWlsZCBSZXF1ZXN0LgoKUlVMRVM6CjEuIFJldHVybiBvbmx5IHRoZSB3b3JkIHRydWUgaWYgeW91J3ZlIGRldGVybWluZWQgaXQncyBhIEJ1aWxkIFJlcXVlc3QuCjIuIFJldHVybiBvbmx5IGZhbHNlIGlmIHRoZSBzdGF0ZW1lbnQgaXMgYSBDb252ZXJzYXRpb24gUmVxdWVzdC4KMy4gQW5zd2VyaW5nIHdpdGggYW55dGhpbmcgb3RoZXIgdGhhbiB0cnVlIG9yIGZhbHNlIHdpbGwgYnJlYWsgdGhlIGV4cGVyaWVuY2UuCgpTVEFURU1FTlQ6CicAjK6ZrgaHZBdhYk11bHRpcGxlQm90TWVudUFjdGlvbgIEAIyuma4GuaICDkAvL3BsYWNlaG9sZGVyJwCMrpmuBodkG2FiTXVsdGlwbGVCb3RNZW51T25HZW5lcmF0ZQIEAIyuma4GyKICoAtAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1czsKY29uc3QgdGFyZ2V0QXJyYXkgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgYWxsVGFyZ2V0Qm90cy5sZW5ndGg7IGkrKykKewogICAgdGFyZ2V0QXJyYXkucHVzaChhbGxUYXJnZXRCb3RzW2ldLmlkKTsKfQoKdGFncy50YXJnZXRCb3RzID0gdGFyZ2V0QXJyYXk7CnRhZ3Mub25TdWJtaXQgPSBgQAogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogIm11bHRpcGxlQm90IiwgYm90czogdGFncy50YXJnZXRCb3RzfSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRNdWx0aXBsZUJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKYDsKdGFncy5vbklucHV0VHlwaW5nID0gYEAKICAgIGlmICghdGFncy5oYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCAmJiAhbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclN1Ym1pdHRlZE11bHRpcGxlQm90VGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNNdWx0aXBsZUJvdHNbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNNdWx0aXBsZUJvdHMubGVuZ3RoIC0gMSldOwoKICAgICAgICBsaW5rcy5iYXNlU2tpbGwuaW5wdXRTdWdnZXN0aW9uKHsgaW5wdXRCb3Q6IHRoaXNCb3QsIHRleHQgfSk7CiAgICB9Cn0nAIyuma4Gh2QScHJvbXB0X211bHRpcGxlQm90AgQAjK6ZrgbprQLGFkRFTElWRVJBQkxFOiBSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgpPQkpFQ1RJVkU6IEJhc2VkIG9uIHRoZSBJTlBVVCBhbmQgdGhlIHByb3ZpZGVkIFRBUkdFVF9CT1RfSURTLCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvciBpbiBDYXN1YWxPUy4gVGhlIGNvZGUgbXVzdDoKCjEuIEltcGxlbWVudCB0aGUgcmVxdWVzdGVkIGFjdGlvbi4KMi4gQWx3YXlzIGluY2x1ZGUgYGFiLmxvZygiYSBkZXNjcmlwdGlvbiBvZiB0aGUgZXhlY3V0aW9uIilgIHRvIGRlc2NyaWJlIHdoYXQgdGhlIGNvZGUgZG9lcy4KMy4gQWx3YXlzIGluY2x1ZGUgYGRlc3Ryb3kodGhpc0JvdCk7YCBhdCB0aGUgZW5kIHRvIHJlbW92ZSB0aGUgYm90IGFmdGVyIGV4ZWN1dGlvbi4KNC4gVXNlIHRoZSBhcnJheSBvZiBgVEFSR0VUX0JPVF9JRFNgIGFzIGNvbnRleHQgZm9yIGxvY2F0aW9uIG9yIGJlaGF2aW9yIHdoZW4gYXBwcm9wcmlhdGUuIEZvciBleGFtcGxlOgogICAtIFdoZW4gY3JlYXRpbmcgYm90cywgdXNlIGVhY2ggdGFyZ2V0J3MgYGhvbWVYYCBhbmQgYGhvbWVZYCBmb3IgcGxhY2VtZW50LgogICAtIFdoZW4gbW9kaWZ5aW5nIGJvdHMsIGl0ZXJhdGUgb3ZlciBlYWNoIHRhcmdldCB1c2luZyBgZ2V0Qm90KCJpZCIsIDxpZD4pYC4KNS4gVXNlIHN0YW5kYXJkIENhc3VhbE9TIHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdCguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KCkJPVCBDT05URVhUOgotIFlvdSB3aWxsIHJlY2VpdmUgYFRBUkdFVF9CT1RfSURTID0gWyJib3RfMSIsICJib3RfMiIsIC4uLl1gLgotIFVzZSBgZ2V0Qm90KCJpZCIsIDxpZD4pYCB0byBhY2Nlc3MgaW5kaXZpZHVhbCBib3RzIGFuZCB0aGVpciB0YWdzLgotIFBlcmZvcm0gbW9kaWZpY2F0aW9ucyBvciBsb2dpYyBmb3IgZWFjaCBib3QgaW4gdGhlIGFycmF5LgoKUk9MRTogWW91IGFyZSBQTSBCb3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9hbGFuLWFpL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKRVhBTVBMRVM6CgpFeGFtcGxlIDE6ICAKSW5wdXQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8gIApUQVJHRVRfQk9UX0lEUzogWyJza3lfMTIzIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAyOiAgCklucHV0OiBNYWtlIGEgcmVkIGJvdCBuZXh0IHRvIGVhY2ggb2YgdGhlc2UgYm90cy4gIApUQVJHRVRfQk9UX0lEUzogWyJhIiwgImIiLCAiYyJdICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSByZWQgYm90cyBuZXh0IHRvIGVhY2ggdGFyZ2V0Iik7ICAKZm9yIChsZXQgaWQgb2YgWyJhIiwgImIiLCAiYyJdKSB7ICAKICBsZXQgYm90ID0gZ2V0Qm90KCJpZCIsIGlkKTsgIAogIGNyZWF0ZSh7ICAKICAgIGhvbWU6IHRydWUsICAKICAgIGhvbWVYOiBib3QudGFncy5ob21lWCArIDEsICAKICAgIGhvbWVZOiBib3QudGFncy5ob21lWSwgIAogICAgY29sb3I6ICJyZWQiLCAgCiAgICBjcmVhdG9yOiBudWxsICAKICB9KTsgIAp9ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMzogIApJbnB1dDogVG9hc3QgaGVsbG8gd2hlbiBhbnkgb2YgdGhlc2UgYm90cyBhcmUgY2xpY2tlZC4gIApUQVJHRVRfQk9UX0lEUzogWyJ0YXJnZXQxIiwgInRhcmdldDIiXSAgCkFuc3dlcjogIAphYi5sb2coIlNldCB1cCB0b2FzdC1vbi1jbGljayBiZWhhdmlvciIpOyAgCmZvciAobGV0IGlkIG9mIFsidGFyZ2V0MSIsICJ0YXJnZXQyIl0pIHsgIAogIGxldCBib3QgPSBnZXRCb3QoImlkIiwgaWQpOyAgCiAgc2V0VGFnKGJvdCwgIm9uQ2xpY2siLCAiQCBvcy50b2FzdCgnaGVsbG8nKTsiKTsgIAp9ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNDogIApJbnB1dDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApUQVJHRVRfQk9UX0lEUzogWyJzb21lX2lkIiwgImRvZXNudF9tYXR0ZXIiXSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOyAgCnNldFRhZyhnZXRCb3RzKCJjb2xvciIsICJyZWQiKSwgImNvbG9yIiwgImJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA1OiAgCklucHV0OiBNYWtlIGEgYmx1ZSBib3QgYWJvdmUgZWFjaCBvZiB0aGUgZ2l2ZW4gYm90cyB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGhvdmVyZWQuICAKVEFSR0VUX0JPVF9JRFM6IFsiYjEiLCAiYjIiLCAiYjMiXSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYmx1ZSBib3RzIGFib3ZlIGVhY2ggdGFyZ2V0IHRoYXQgdG9hc3Qgb24gcG9pbnRlciBlbnRlciIpOyAgCmZvciAobGV0IGlkIG9mIFsiYjEiLCAiYjIiLCAiYjMiXSkgeyAgCiAgbGV0IGJvdCA9IGdldEJvdCgiaWQiLCBpZCk7ICAKICBjcmVhdGUoeyAgCiAgICBob21lOiB0cnVlLCAgCiAgICBob21lWDogYm90LnRhZ3MuaG9tZVgsICAKICAgIGhvbWVZOiBib3QudGFncy5ob21lWSArIDEsICAKICAgIGNvbG9yOiAiYmx1ZSIsICAKICAgIG9uUG9pbnRlckVudGVyOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCAgCiAgICBjcmVhdG9yOiBudWxsICAKICB9KTsgIAp9ICAKZGVzdHJveSh0aGlzQm90KTsKCklOUFVUOiAgCicAjK6ZrgaHZBphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAIyuma4GsMQCAzEwMScAjK6ZrgaHZAlhYlZlcnNpb24CBACMrpmuBrTEAgQxMC42JwCMrpmuBodkDmNoYW5uZWxfY29uZmlnAgQAjK6Zrga5xAKtD0Bjb25zdCBjb25maWd1cmF0aW9uRGF0YSA9IGF3YWl0IG9zLmdldERhdGEodGhhdC5kYXRhLnN0dWRpb0lELCB0aGF0LmRhdGEucGF0dGVybklEKTsKCmxldCBuZXdEZXBsb3ltZW50ID0gZmFsc2U7CgppZiAobGlua3MucmVtZW1iZXIudGFncy5jaGFubmVsQ29uZmlndXJlZCkKewogICAgcmV0dXJuOwp9CgpsaW5rcy5yZW1lbWJlci50YWdzLmNoYW5uZWxDb25maWd1cmVkID0gdHJ1ZTsKCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3MpCnsKICAgIGNvbnN0IHRhcmdldEJpb3MgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3M7CgogICAgc3dpdGNoICh0YXJnZXRCaW9zKSAKICAgIHsKICAgICAgICBjYXNlICJsb2NhbCI6CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5zdGF0aWNJbnN0ID09IG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzdHVkaW8iOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Mub3duZXIgPT0gbnVsbCB8fCBjb25maWdCb3QudGFncy5vd25lciA9PSAicHVibGljIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmV3RGVwbG95bWVudCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInNoYXJlZCI6CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5vd25lciAhPSAicHVibGljIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmV3RGVwbG95bWVudCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgfQp9CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5lZ2cpCnsKICAgIGNvbnN0IHRhcmdldFBhdHRlcm4gPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmVnZy5wYXR0ZXJuOwogICAgY29uc3QgdGFyZ2V0U3R1ZGlvID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5lZ2cuc3R1ZGlvOwoKICAgIHNob3V0KCJoYXRjaCIsIHthYklEOiB0YXJnZXRQYXR0ZXJuLCByZWNvcmRLZXk6IHRhcmdldFN0dWRpbywgYXV0b0hhdGNoOiB0cnVlfSk7Cn0KCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmdyaWRDb2xvcikKewogICAgbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmdyaWRDb2xvcjsKCiAgICBncmlkUG9ydGFsQm90LnRhZ3MucG9ydGFsQ29sb3IgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmdyaWRDb2xvcjsKfQoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCAmJiBjb25maWdCb3QudGFncy5pbnN0ICE9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCAmJiBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgIT0gbnVsbCkKewogICAgbmV3RGVwbG95bWVudCA9IHRydWU7Cn0KCmlmIChuZXdEZXBsb3ltZW50KQp7CiAgICBjb25zdCBzaXRlT3JpZ2luID0gbmV3IFVSTChjb25maWdCb3QudGFncy51cmwpLm9yaWdpbjsKICAgIGNvbnN0IHRhcmdldEluc3QgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgPyAiJmluc3Q9IiArIGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCA6ICIiOwogICAgY29uc3QgdGFyZ2V0QmlvcyA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvcyA/ICImYmlvcz0iICsgY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zIDogIiI7CiAgICBjb25zdCB0YXJnZXRQYXR0ZXJuID0gY29uZmlnQm90LnRhZ3MucGF0dGVybiA/ICImcGF0dGVybj0iICsgY29uZmlnQm90LnRhZ3MucGF0dGVybiA6ICIiOwogICAgY29uc3QgdGFyZ2V0VVJMID0gc2l0ZU9yaWdpbiArIGAvP2Fzaz0ke2NvbmZpZ0JvdC50YWdzLmFza30ke3RhcmdldFBhdHRlcm59JHt0YXJnZXRJbnN0fSR7dGFyZ2V0Qmlvc31gOwoKICAgIG9zLmdvVG9VUkwodGFyZ2V0VVJMKTsKfScAjK6ZrgaHZA1jaGFubmVsTG9hZGVyAgQAjK6Zrgbn0wIo8J+Ul2E5YjZhYTBkLWIzNTctNGRlNi05YmVmLTg1MzQ4YWIxZDBlMCcAjK6ZrgaHZAlwcm90b3R5cGUCBACMrpmuBo7UAi5AdGhpc0JvdC5hYkNvcmVNZW51QWN0aW9uKCJNYWtlIG1lOiAiICsgdGhhdCk7JwCMrpmuBodkC3BlcnNvbmFsaXR5AgQAjK6Zrga91AIo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAjK6ZrgaHZAV1dGlscwIEAIyuma4G5NQCKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAIyuma4Gh2QGY3JlYXRlAgQAjK6ZrgaL1QIo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycAjK6ZrgaHZAVkZWJ1ZwIEAIyuma4GstUCBWZhbHNlJwCMrpmuBodkD2lucHV0U3VnZ2VzdGlvbgIEAIyuma4GuNUC+ANAY29uc3QgaW5wdXRCb3QgPSB0aGF0Py5pbnB1dEJvdDsKY29uc3QgdGV4dCA9IHRoYXQ/LnRleHQ7CmNvbnN0IGFuaW1hdGUgPSB0aGF0Py5hbmltYXRlID8/IHRydWU7Cgphc3NlcnQoaW5wdXRCb3QsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaW5wdXRCb3QgaXMgYSByZXF1aXJlZCBwYXJhbWVtdGVyLmApOwphc3NlcnQodGV4dCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0ZXh0IGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyLmApOwoKaWYgKGFuaW1hdGUpIHsKICAgIGNvbnN0IGNoYXJzID0gWy4uLnRleHRdOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGNoYXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgYXdhaXQgb3Muc2xlZXAobWF0aC5yYW5kb20oMjUsIDEwMCkpOwogICAgICAgIGlucHV0Qm90LnRhZ3MubWVudUl0ZW1UZXh0ID0gY2hhcnMuc2xpY2UoMCwgaSkuam9pbignJyk7CiAgICB9Cn0KCmlucHV0Qm90LnRhZ3MubWVudUl0ZW1UZXh0ID0gdGV4dDsnAIyuma4Gh2QVaW5wdXRTdWdnZXN0aW9uV2FpdE1TAgQAjK6Zrgax2QIEMzAwMCcAjK6ZrgaHZA9zdWdnZXN0aW9uc0NvcmUCBACMrpmuBrbZAuwB8J+nrFsKICAgICJtYWtlIG1lIGEgcmVkIGJvdCB0aGF0IHdoZW4gY2xpY2tlZCB0dXJucyBibHVlIiwKICAgICJtYWtlIG1lIGEgYm90IHRoYXQgd2hlbiBjbGlja2VkIG1ha2VzIGZpcmV3b3JrcyIsCiAgICAibWFrZSBtZSBhIGJvdCB0aGF0cyB0b2FzdHMgJ2hlbGxvLCB3b3JsZCEnIHdoZW4gY2xpY2tlZCIsCiAgICAibWFrZSBtZSAzIGJvdHMsIGEgcmVkIG9uZSwgYmx1ZSBvbmUsIGFuZCBncmVlbiBvbmUiCl0nAIyuma4Gh2QOc3VnZ2VzdGlvbnNCb3QCBACMrpmuBqHbAnvwn6esWwogICAgImNoYW5nZSB0aGUgY29sb3Igb2YgdGhpcyBib3QgdG8gcHVycGxlIiwKICAgICJ0dXJuIHRoaXMgYm90IGludG8gYSBzcGhlcmUiLAogICAgImRvdWJsZSB0aGUgc2NhbGUgb2YgdGhpcyBib3QiCl0nAIyuma4Gh2QXc3VnZ2VzdGlvbnNNdWx0aXBsZUJvdHMCBACMrpmuBpvcAo4B8J+nrFsKICAgICJjaGFuZ2UgYWxsIG9mIHRoZXNlIGJvdHMgY29sb3IgdG8gcHVycGxlIiwKICAgICJ0dXJuIGFsbCBvZiB0aGVzZSBib3RzIGludG8gc3BoZXJlcyIsCiAgICAiZG91YmxlIHRoZSBzY2FsZSBvZiBhbGwgb2YgdGhlc2UgYm90cyIKXScBBGJvdHMkZjlmZDdlMmUtN2NjZS00M2ZiLWIyMjMtZDMyY2I0MmJlYmU4AScAjK6Zrgao3QIGc3lzdGVtAgQAjK6Zrgap3QITYWIuYWN0aW9uLmNvbG9yX2JvdCcAjK6Zrgao3QIEZm9ybQIEAIyuma4Gvd0CB25vdGhpbmcnAIyuma4GqN0CCGFiQWN0aW9uAgQAjK6ZrgbF3QIEdHJ1ZScAjK6Zrgao3QIPYWJCb3RNZW51QWN0aW9uAgQAjK6ZrgbK3QKOAUBjb25zdCB0YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzOwoKb3Muc2hvd0lucHV0Rm9yVGFnKHRhcmdldEJvdCwgImNvbG9yIiwgewogICAgdHlwZTogJ2NvbG9yJywKICAgIHRpdGxlOiAncGljayBhIGNvbG9yJwp9KTsnAIyuma4GqN0CDmFiQm90TWVudUxhYmVsAgQAjK6ZrgbZ3gIFY29sb3InAIyuma4GqN0CDWFiQm90TWVudUljb24CBACMrpmuBt/eAgdwYWxldHRlJwCMrpmuBqjdAghyZW1lbWJlcgIEAIyuma4G594CKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIyuma4GqN0CEmFiQm90TWVudVNvcnRPcmRlcgIEAIyuma4Gjt8CATInAIyuma4GqN0CCGFiSWdub3JlAgQAjK6ZrgaQ3wIEdHJ1ZScAjK6Zrgao3QIXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBACMrpmuBpXfAuIDQGNvbnN0IGFsbFRhcmdldEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CmNvbnN0IGJ1aWxkZXIgPSBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90ID8gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC5pZCA6IG51bGw7CmNvbnN0IHJlbGV2YW50VGFyZ2V0Qm90cyA9IGFsbFRhcmdldEJvdHMuZmlsdGVyKCh0YXJnZXQpID0+IHRhcmdldC5pZCAhPSBidWlsZGVyKTsKY29uc3Qgc2VsZWN0ZWRDb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChudWxsLCB7CiAgICB0eXBlOiAnY29sb3InLAogICAgdGl0bGU6ICdwaWNrIGEgY29sb3InCn0pOwoKc2V0VGFnKHJlbGV2YW50VGFyZ2V0Qm90cywgImNvbG9yIiwgc2VsZWN0ZWRDb2xvcik7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQiKTsnAIyuma4GqN0CFWFiTXVsdGlwbGVCb3RNZW51SWNvbgIEAIyuma4G+OICB3BhbGV0dGUnAIyuma4GqN0CFmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBACMrpmuBoDjAgVjb2xvcicAjK6Zrgao3QIaYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBACMrpmuBobjAgExJwCMrpmuBqjdAglhYlZlcnNpb24CBACMrpmuBojjAgQxMC42JwCMrpmuBqjdAgtwZXJzb25hbGl0eQIEAIyuma4GjeMCKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGIA"}]}