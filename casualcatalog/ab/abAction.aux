{"version":2,"updates":[{"id":0,"timestamp":1759421551576,"update":"AeoCyMKyaAAnAQRib3RzJDM5ODgwMWZlLTRiMzUtNGNlNC04MjZmLTIzODM1YzFiOWFjNQEnAMjCsmgABnN5c3RlbQIEAMjCsmgBFGFiLmFjdGlvbi5jcmVhdGVfYm90JwDIwrJoAAhhYkFjdGlvbgIEAMjCsmgWBHRydWUnAMjCsmgABGZvcm0CBADIwrJoGwdub3RoaW5nJwDIwrJoAAtkZXNjcmlwdGlvbgIEAMjCsmgjDUNyZWF0ZXMgYm90cy4nAMjCsmgAEGFiR3JpZE1lbnVBY3Rpb24CBADIwrJoMbEFQGNvbnN0IGdyaWRJbmZvcm1hdGlvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7CmNvbnN0IG5ld0JvdCA9IHt9OwoKbmV3Qm90LmNyZWF0b3IgPSBudWxsOwpuZXdCb3RbZ3JpZEluZm9ybWF0aW9uLmRpbWVuc2lvbl0gPSB0cnVlOwpuZXdCb3RbZ3JpZEluZm9ybWF0aW9uLmRpbWVuc2lvbiArICJYIl0gPSBncmlkSW5mb3JtYXRpb24ucG9zaXRpb24ueDsKbmV3Qm90W2dyaWRJbmZvcm1hdGlvbi5kaW1lbnNpb24gKyAiWSJdID0gZ3JpZEluZm9ybWF0aW9uLnBvc2l0aW9uLnk7Cm5ld0JvdC5jb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CgpsZXQgY3JlYXRlZEJvdCA9IGNyZWF0ZShuZXdCb3QpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC5tYXNrcy5saW5lQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwpsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IGNyZWF0ZWRCb3QuaWQ7CgpsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJvdEZvY3VzID0gIvCflJciICsgY3JlYXRlZEJvdC5pZDsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7bWVudTogImJvdCJ9KTsnAMjCsmgAD2FiR3JpZE1lbnVMYWJlbAIEAMjCsmjhBQNib3QnAMjCsmgADmFiR3JpZE1lbnVJY29uAgQAyMKyaOUFB2FkZF9ib3gnAMjCsmgACHJlbWVtYmVyAgQAyMKyaO0FKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAMjCsmgADW1hbmlmZXN0YXRpb24CBADIwrJolAYo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAyMKyaAAIYWJJZ25vcmUCBADIwrJouwYEdHJ1ZScAyMKyaAATYWJHcmlkTWVudVNvcnRPcmRlcgIEAMjCsmjABgExJwDIwrJoAAlhYlZlcnNpb24CBADIwrJowgYFMTAuMTMnAMjCsmgAC3BlcnNvbmFsaXR5AgQAyMKyaMgGKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAQRib3RzJDU4NDlhZjU1LTVlOGEtNDhkNi05MTA2LTE5OTQ5OGU5ZWMwOAEnAMjCsmjvBgZzeXN0ZW0CBADIwrJo8AYRYWIuYWN0aW9uLmRlc3Ryb3knAMjCsmjvBghhYkFjdGlvbgIEAMjCsmiCBwR0cnVlJwDIwrJo7wYEZm9ybQIEAMjCsmiHBwdub3RoaW5nJwDIwrJo7wYPYWJCb3RNZW51QWN0aW9uAgQAyMKyaI8HwAJAY29uc3QgdGFyZ2V0Qm90ID0gdGhhdC5ib3QubGlua3MudGFyZ2V0Qm90OwoKaWYgKHRoYXQuYm90LmxpbmtzLnRhcmdldE9yaWdpbkJvdHMpIHsKICAgIC8vIERlc3Ryb3kgYm90cyBiZWxvbmdpbmcgdG8gYWJJRE9yaWdpbi4KICAgIGRlc3Ryb3kodGhhdC5ib3QubGlua3MudGFyZ2V0T3JpZ2luQm90cyk7Cn0gZWxzZSB7CiAgICAvLyBEZXN0cm95IHRoZSBzaW5nbGUgdGFyZ2V0IGJvdC4KICAgIGRlc3Ryb3kodGFyZ2V0Qm90KTsKfQoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOycAyMKyaO8GDmFiQm90TWVudUxhYmVsAgQAyMKyaNAJB2Rlc3Ryb3knAMjCsmjvBg1hYkJvdE1lbnVJY29uAgQAyMKyaNgJDmRlbGV0ZV9mb3JldmVyJwDIwrJo7wYSYWJCb3RNZW51U29ydE9yZGVyAgQAyMKyaOcJAzEwMCcAyMKyaO8GCHJlbWVtYmVyAgQAyMKyaOsJKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAMjCsmjvBg1tYW5pZmVzdGF0aW9uAgQAyMKyaJIKKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAMjCsmjvBghhYklnbm9yZQIEAMjCsmi5CgR0cnVlJwDIwrJo7wYOYWJCb3RNZW51Q29sb3ICBADIwrJovgoHI0Q5MzAzMCcAyMKyaO8GF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQAyMKyaMYKwANAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgpkZXN0cm95KHJlbGV2YW50VGFyZ2V0Qm90cyk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7JwDIwrJo7wYVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAyMKyaIcODmRlbGV0ZV9mb3JldmVyJwDIwrJo7wYWYWJNdWx0aXBsZUJvdE1lbnVMYWJlbAIEAMjCsmiWDgdkZXN0cm95JwDIwrJo7wYaYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBADIwrJong4DMTAwJwDIwrJo7wYWYWJNdWx0aXBsZUJvdE1lbnVDb2xvcgIEAMjCsmiiDgcjRDkzMDMwJwDIwrJo7wYJYWJWZXJzaW9uAgQAyMKyaKoOBTEwLjEzJwDIwrJo7wYTYWJCb3RNZW51T25HZW5lcmF0ZQIEAMjCsmiwDq0HQGNvbnN0IHRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgppZiAodGFyZ2V0Qm90KSB7CiAgICB0YWdzLmxhYmVsID0gJ2Rlc3Ryb3knOwogICAgdGFncy50YXJnZXRCb3QgPSBnZXRMaW5rKHRhcmdldEJvdCk7CiAgICB0YWdzLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygiU2hpZnQiKSkgewogICAgICAgICAgICBpZiAobGlua3MudGFyZ2V0Qm90ICYmIGxpbmtzLnRhcmdldEJvdC50YWdzLmFiSURPcmlnaW4pIHsKICAgICAgICAgICAgICAgIC8vIENoYW5nZSBidXR0b24gdG8gZGVzdHJveSBhbGwgYm90cyB3aXRoIHNhbWUgYWJJRE9yaWdpbi4KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE9yaWdpbkJvdHMgPSBnZXRCb3RzKGIgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnRhZ3MuYWJJRE9yaWdpbiA9PT0gbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbjsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbWFza3MubGFiZWwgPSAnZGVzdHJveSAnICsgbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbiArICcgKCcgKyB0YXJnZXRPcmlnaW5Cb3RzLmxlbmd0aCArICcgYm90cyknOwogICAgICAgICAgICAgICAgdGFncy50YXJnZXRPcmlnaW5Cb3RzID0gZ2V0TGluayh0YXJnZXRPcmlnaW5Cb3RzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGA7CiAgICB0YWdzLm9uS2V5VXAgPSBgQAogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoIlNoaWZ0IikpIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSBudWxsOwogICAgICAgICAgICB0YWdzLnRhcmdldE9yaWdpbkJvdHMgPSBudWxsOwogICAgICAgIH0KICAgIGA7Cn0gZWxzZSB7CiAgICAvLyBObyBib3QgdG8gZGVzdHJveS4KICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAMjCsmjvBhthYk11bHRpcGxlQm90TWVudU9uR2VuZXJhdGUCBADIwrJo3hXvBEBjb25zdCBhbGxUYXJnZXRCb3RzID0gQXJyYXkuaXNBcnJheShsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpID8gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzIDogW2xpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1c107CmNvbnN0IGJ1aWxkZXIgPSBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90ID8gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC5pZCA6IG51bGw7CmNvbnN0IHJlbGV2YW50VGFyZ2V0Qm90cyA9IGFsbFRhcmdldEJvdHMuZmlsdGVyKCh0YXJnZXQpID0+IHRhcmdldC5pZCAhPSBidWlsZGVyKTsKCmlmIChyZWxldmFudFRhcmdldEJvdHMubGVuZ3RoID4gMSkgewogICAgLy8gTXVsdGlwbGUgYm90cy4KICAgIHRhZ3MubGFiZWwgPSBgZGVzdHJveSAoJHtyZWxldmFudFRhcmdldEJvdHMubGVuZ3RofSBib3RzKWA7Cn0gZWxzZSBpZiAocmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aCA9PT0gMSkgewogICAgLy8gU2luZ2xlIGJvdC4KICAgIHRhZ3MubGFiZWwgPSBgZGVzdHJveWA7Cn0gZWxzZSB7CiAgICAvLyBObyBib3RzIHRvIGRlc3Ryb3kuCiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwEEYm90cyQ2YjNkOTc0NC00NDQ4LTRlZjUtOTZhMi03MTI4MWM0MmFmNmMBJwDIwrJozhoJYWJWZXJzaW9uAgQAyMKyaM8aBTEwLjEzJwDIwrJozhoGc3lzdGVtAgQAyMKyaNUaEWFiLmFjdGlvbi52ZXJzaW9uJwDIwrJozhoUYWJBY3Rpb25NYWpvclZlcnNpb24CBADIwrJo5xoBMScAyMKyaM4aFGFiQWN0aW9uTWlub3JWZXJzaW9uAgQAyMKyaOkaATknAMjCsmjOGg1vblNraWxsVXBkYXRlAgQAyMKyaOsamQFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJBY3Rpb25NYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiQWN0aW9uTWlub3JWZXJzaW9uOwoKY29uc29sZS5sb2coIltBQkFjdGlvbl0gTG9hZGVkIEFCIEFjdGlvbiB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAMjCsmjOGghhYklnbm9yZQIEAMjCsmiFHAR0cnVlJwDIwrJozhoIYWJBY3Rpb24CBADIwrJoihwEdHJ1ZScAyMKyaM4aBGZvcm0CBADIwrJojxwHbm90aGluZycBBGJvdHMkNzE3NTY0NWMtNGI1My00NDU0LTg3MTYtZmMwZTY4ZGIyNjY1AScAyMKyaJccBnN5c3RlbQIEAMjCsmiYHA9hYi5hY3Rpb24ubG9naW4nAMjCsmiXHAhhYkFjdGlvbgIEAMjCsmioHAR0cnVlJwDIwrJolxwIYWJJZ25vcmUCBADIwrJorRwEdHJ1ZScAyMKyaJccBGZvcm0CBADIwrJoshwHbm90aGluZycAyMKyaJccD2FiQ29yZU1lbnVDb2xvcgIEAMjCsmi6HAcjRjJCNzA1JwDIwrJolxwTYWJDb3JlTWVudVNvcnRPcmRlcgIEAMjCsmjCHAItNScAyMKyaJccEGFiQ29yZU1lbnVBY3Rpb24CBADIwrJoxRwbQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7JwDIwrJolxwUYWJDb3JlTWVudU9uR2VuZXJhdGUCBADIwrJo4RzrAUB0YWdzLmFiTWVudSA9IGZhbHNlOyAvLyBLZWVwIGJ1dHRvbiBoaWRkZW4gdW50aWwgYXV0aCBjaGVjayBpcyBjb21wbGV0ZS4KYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmIChhdXRoQm90KSB7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9IGVsc2UgewogICAgdGFncy5hYk1lbnUgPSB0cnVlOwogICAgdGFncy5vbkFCQXV0aEJvdEFkZGVkID0gYEBkZXN0cm95KHRoaXNCb3QpO2A7Cn0nAMjCsmiXHA5hYkNvcmVNZW51SWNvbgIEAMjCsmjNHgVsb2dpbicAyMKyaJccCHJlbWVtYmVyAgQAyMKyaNMeKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAMjCsmiXHAlhYlZlcnNpb24CBADIwrJo+h4FMTAuMTMnAMjCsmiXHAtwZXJzb25hbGl0eQIEAMjCsmiAHyjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwDIwrJolxwPYWJDb3JlTWVudUxhYmVsAgQAyMKyaKcfB3NpZ24gaW4nAMjCsmiXHA5hYkNvcmVNZW51SGlkZQIEAMjCsmivHwR0cnVlJwDIwrJolxwOb25BbnlCb3RzQWRkZWQCBADIwrJotB/+AkBpZiAodGhhdC5ib3RzKSB7CiAgICBjb25zdCBhZGRlZEF1dGhCb3QgPSB0aGF0LmJvdHMuZmluZChiID0+IGIgPT09IGdsb2JhbFRoaXMuYXV0aEJvdCk7CgogICAgaWYgKGFkZGVkQXV0aEJvdCkgewogICAgICAgIHRoaXNCb3QudmFycy5hdXRoQm90SWQgPSBhZGRlZEF1dGhCb3QuaWQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXV0aCBib3QgYWRkZWQuIGF1dGhCb3QgaWQ6ICR7dGhpc0JvdC52YXJzLmF1dGhCb3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCQXV0aEJvdEFkZGVkJywgeyBhdXRoQm90OiBhZGRlZEF1dGhCb3QgfSk7CiAgICB9Cn0nAMjCsmiXHAVkZWJ1ZwIEAMjCsmizIgVmYWxzZScAyMKyaJccEG9uQW55Qm90c1JlbW92ZWQCBADIwrJouSKjA0BpZiAodGhhdC5ib3RJRHMgJiYgdGhpc0JvdC52YXJzLmF1dGhCb3RJZCkgewogICAgY29uc3QgcmVtb3ZlZEF1dGhCb3RJZCA9IHRoYXQuYm90SURzLnNvbWUoaWQgPT4gaWQgPT09IHRoaXNCb3QudmFycy5hdXRoQm90SWQpOwoKICAgIGlmIChyZW1vdmVkQXV0aEJvdElkKSB7CiAgICAgICAgdGhpc0JvdC52YXJzLmF1dGhCb3RJZCA9IG51bGw7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXV0aCBib3QgcmVtb3ZlZC4gYXV0aEJvdCBpZDogJHtyZW1vdmVkQXV0aEJvdElkfWApOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoJ29uQUJBdXRoQm90UmVtb3ZlZCcsIHsgYXV0aEJvdElkOiByZW1vdmVkQXV0aEJvdElkIH0pOwogICAgfQp9JwEEYm90cyRiMzM5YzExOC00ODlhLTQ2NmItYmE5Zi1iMDdhNWY5YjY2NGYBJwDIwrJo3SUGc3lzdGVtAgQAyMKyaN4lD2FiLmFjdGlvbi5wYXN0ZSgAyMKyaN0lCGFiQWN0aW9uAXgnAMjCsmjdJQRmb3JtAgQAyMKyaO8lB25vdGhpbmcnAMjCsmjdJQtkZXNjcmlwdGlvbgIEAMjCsmj3JSthYiBza2lsbCB1c2VkIGZvciBjb3B5aW5nIGFuZCBwYXN0aW5nIGJvdHMuJwDIwrJo3SUHb25QYXN0ZQIEAMjCsmijJv8HQGlmICghYnVpbGRlclZlcnNpb24pCnsKICAgIHJldHVybjsKfQoKY29uc3QgTUFDUk9TID0gWwogICAgewogICAgICAgIHRlc3Q6IC8oPzpb4oCc4oCdXSkvZywKICAgICAgICByZXBsYWNlbWVudDogKHZhbCkgPT4gJyInLAogICAgfSwKICAgIHsKICAgICAgICB0ZXN0OiAvKD86W+KAmOKAmV0pL2csCiAgICAgICAgcmVwbGFjZW1lbnQ6ICh2YWwpID0+ICInIiwKICAgIH0sCl07CgpsZXQgZm9ybWF0dGVkQ29weSA9IHJlcGxhY2VNYWNyb3ModGhhdC50ZXh0KTsKbGV0IGNvcHlCb3QgPSBKU09OLnBhcnNlKGZvcm1hdHRlZENvcHkpOwpsZXQgcGFzdGVkRGF0YSA9ICFjb3B5Qm90LnN0YXRlID8ge1tjb3B5Qm90LmlkXTogY29weUJvdH0gOiBjb3B5Qm90LnN0YXRlOwpsZXQgZGltTW9kID0gbGlua3MucmVtZW1iZXIudGFncy5hYkZvY3VzRGF0YTsKCmlmIChPYmplY3Qua2V5cyhwYXN0ZWREYXRhKS5sZW5ndGggPT0gMSAmJiBkaW1Nb2QpCnsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgcGFzdGVkRGF0YVtkaW1Nb2QuZGltZW5zaW9uKyJYIl0gPSBkaW1Nb2QueDsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbisiWSJdID0gZGltTW9kLnk7CgogICAgb3MudG9hc3QoImJvdCBhZGRlZCB0byBpbnN0Iik7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgiYm90cyBhZGRlZCB0byBpbnN0Iik7Cn0KCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogcGFzdGVkIGRhdGEiKTsKCmxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IHBhc3RlZERhdGEsIHNvdXJjZUV2ZW50OiAncGFzdGUnfSk7CgpmdW5jdGlvbiByZXBsYWNlTWFjcm9zKHRleHQpIHsKICAgIGlmICghdGV4dCkgewogICAgICAgIHJldHVybiB0ZXh0OwogICAgfQoKICAgIGZvciAobGV0IG0gb2YgTUFDUk9TKSB7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShtLnRlc3QsIG0ucmVwbGFjZW1lbnQpOwogICAgfQoKICAgIHJldHVybiB0ZXh0Owp9JwDIwrJo3SUIcmVtZW1iZXICBADIwrJomy4o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAyMKyaN0lBmNyZWF0ZQIEAMjCsmjCLijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwDIwrJo3SUIYWJJZ25vcmUCBADIwrJo6S4EdHJ1ZScAyMKyaN0lCW9uS2V5RG93bgIEAMjCsmjuLroJQGlmICghYnVpbGRlclZlcnNpb24gfHwgKCFsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzICYmICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpKQp7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LmtleXMgPT0gImMiKQp7CiAgICBsZXQgbWV0YUlucHV0ID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiTWV0YSIpOwoKICAgIGlmICghbWV0YUlucHV0KQogICAgewogICAgICAgIG1ldGFJbnB1dCA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIkNvbnRyb2wiKTsKICAgIH0KICAgIAogICAgaWYgKCFtZXRhSW5wdXQpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBmb3JtYXR0ZWRGaWxlOwogICAgbGV0IHN0YXRlID0ge307CgogICAgaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpCiAgICB7CiAgICAgICAgbGV0IHNlbGVjdGVkQm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCiAgICAgICAgc3RhdGVbc2VsZWN0ZWRCb3QuaWRdID0gc2VsZWN0ZWRCb3Q7CgogICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogY29waWVkIGEgYm90IHRvIGNsaXBib2FyZCIpOwogICAgfQogICAgZWxzZSBpZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKQogICAgewogICAgICAgIGxldCBzZWxlY3RlZEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0ZWRCb3RzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgc3RhdGVbc2VsZWN0ZWRCb3RzW2ldLmlkXSA9IHNlbGVjdGVkQm90c1tpXTsKICAgICAgICB9CgogICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogY29waWVkIG11bHRpcGxlIGJvdHMgdG8gY2xpcGJvYXJkIik7CiAgICB9CgogICAgbGV0IG5ld0ZpbGUgPSB7fTsKICAgIG5ld0ZpbGUudmVyc2lvbiA9IDE7CiAgICBuZXdGaWxlLnN0YXRlID0gc3RhdGU7CgogICAgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKfScAyMKyaN0lCWFiVmVyc2lvbgIEAMjCsmipOAUxMC4xMycAyMKyaN0lC3BlcnNvbmFsaXR5AgQAyMKyaK84KPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAQRib3RzJGJkYWJkNmMwLTg5ZjktNGY3NS1iMzVjLTI2ZjRlYzUyMDdkNgEnAMjCsmjWOAZzeXN0ZW0CBADIwrJo1zgQYWIuYWN0aW9uLnJlcG9ydCcAyMKyaNY4BGZvcm0CBADIwrJo6DgHbm90aGluZycAyMKyaNY4EGFiQ29yZU1lbnVBY3Rpb24CBADIwrJo8DgRQG9zLnJlcG9ydEluc3QoKTsnAMjCsmjWOBNhYkNvcmVNZW51U29ydE9yZGVyAgQAyMKyaII5AzEwMScAyMKyaNY4DmFiQ29yZU1lbnVJY29uAgQAyMKyaIY5BGZsYWcnAMjCsmjWOA9hYkNvcmVNZW51TGFiZWwCBADIwrJoizkGcmVwb3J0JwDIwrJo1jgIYWJBY3Rpb24CBADIwrJokjkEdHJ1ZScAyMKyaNY4CGFiSWdub3JlAgQAyMKyaJc5BHRydWUnAMjCsmjWOBRhYkNvcmVNZW51T25HZW5lcmF0ZQIEAMjCsmicOUZAaWYgKGNvbmZpZ0JvdC50YWdzLnN0YXRpY0luc3QgIT0gdW5kZWZpbmVkKQp7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwDIwrJo1jgJYWJWZXJzaW9uAgQAyMKyaOM5BTEwLjEzJwEEYm90cyRjNjhjNWI4Mi1jMGE3LTRhNWEtOTEwNC01ZGQ4ZTMyYWU0ZTIBJwDIwrJo6TkGc3lzdGVtAgQAyMKyaOo5EGFiLmFjdGlvbi5wb3J0YWwnAMjCsmjpOQtkZXNjcmlwdGlvbgIEAMjCsmj7ORRTa2lsbCB0byBvcGVuIHNoZWV0LicAyMKyaOk5CGFiQWN0aW9uAgQAyMKyaJA6BHRydWUnAMjCsmjpOQRmb3JtAgQAyMKyaJU6B25vdGhpbmcnAMjCsmjpORBhYkNvcmVNZW51QWN0aW9uAgQAyMKyaJ06A0AvLycAyMKyaOk5CHJlbWVtYmVyAgQAyMKyaKE6KPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAMjCsmjpOQ9hYkNvcmVNZW51TGFiZWwCBADIwrJoyDoQY3VycmVudCBwb3J0YWw6ICcAyMKyaOk5D2FiQm90TWVudUFjdGlvbgIEAMjCsmjZOvgCQGNvbnN0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKY29uc3QgY3VycmVudERpbSA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QudGFncy5saW5lVG87CmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCmlmIChzdGF0ZSkgCnsKICAgIG9zLm9wZW5VUkwoY29uZmlnQm90LnRhZ3MucGVybWFsaW5rICsgYCZzaGVldFBvcnRhbD0ke2N1cnJlbnREaW19YCk7Cn0KZWxzZQp7CiAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9IGN1cnJlbnREaW07Cn0KCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogb3BlbmVkIGJvdCBzaGVldCIpOycAyMKyaOk5DmFiQm90TWVudUxhYmVsAgQAyMKyaNI9Dm9wZW4gYm90IHNoZWV0JwDIwrJo6TkNbWFuaWZlc3RhdGlvbgIEAMjCsmjhPSjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDIwrJo6TkNYWJCb3RNZW51SWNvbgIEAMjCsmiIPgp0YWJsZV92aWV3JwDIwrJo6TkOYWJDb3JlTWVudUljb24CBADIwrJokz4LYXJyb3dfcmlnaHQnAMjCsmjpORJhYkJvdE1lbnVTb3J0T3JkZXICBADIwrJonz4BMScAyMKyaOk5CGFiSWdub3JlAgQAyMKyaKE+BHRydWUnAMjCsmjpORdhYk11bHRpcGxlQm90TWVudUFjdGlvbgIEAMjCsmimPpsEQGNvbnN0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKY29uc3QgY3VycmVudERpbSA9ICJhYk11bHRpcGxlU2VsZWN0IjsKCmNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY3VycmVudERpbTsKCnNldFRhZ01hc2sobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzLCBjdXJyZW50RGltLCB0cnVlLCAidGVtcExvY2FsIik7CgptYXNrcy5jdXJyZW50U2hlZXRCb3RzID0gbGlua3MucmVtZW1iZXIudGFncy5hYk11bHRpcGxlQm90Rm9jdXM7Cm1hc2tzLm9uUG9ydGFsQ2hhbmdlZCA9IGBAIGlmICh0aGF0LmRpbWVuc2lvbiAhPSAiYWJNdWx0aXBsZVNlbGVjdCIgJiYgdGhhdC5wb3J0YWwgPT0gInNoZWV0UG9ydGFsIikKewogICAgY2xlYXJUYWdNYXNrcyhsaW5rcy5jdXJyZW50U2hlZXRCb3RzKTsKCiAgICBjbGVhclRhZ01hc2tzKHRoaXNCb3QpOwp9IGA7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IG9wZW5lZCBtdWx0aXBsZSBzZWxlY3Qgc2hlZXQiKTsnAMjCsmjpORZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAyMKyaMJCGm9wZW4gbXVsdGlwbGUgc2VsZWN0IHNoZWV0JwDIwrJo6TkVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAyMKyaN1CCnRhYmxlX3ZpZXcnAMjCsmjpORNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAyMKyaOhCmAJAbGV0IHNlbGVjdGVkQm90ID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC50YWdzLmxpbmVUbzsKCnRhZ3MubGFiZWwgPSAic2hlZXRQb3J0YWw9IiArIHNlbGVjdGVkQm90LnN1YnN0cmluZygwLCA0KTsKCnRhZ3Mub25LZXlEb3duID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gdGFncy5sYWJlbCArICIgaW4gbmV3IHRhYiI7fWA7CnRhZ3Mub25LZXlVcCA9IGBAIGlmKHRoYXQua2V5cyA9PSAiU2hpZnQiKXttYXNrcy5sYWJlbCA9IG51bGw7fWA7JwDIwrJo6TkaYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBADIwrJogUUBMCcAyMKyaOk5BG1lbnUCBADIwrJog0Uo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAyMKyaOk5CWFiVmVyc2lvbgIEAMjCsmiqRQUxMC4xMycAyMKyaOk5C2FiQmx1ZXByaW50AgQAyMKyaLBF+wNAY29uc3QgYmFja2dyb3VuZENvbG9yID0gbGlua3MucmVtZW1iZXI/LnRhZ3MuYWJCbHVlcHJpbnRDb2xvciA/PyAiIzE3ODVCNSI7CgppZiAoYmFja2dyb3VuZENvbG9yID09IGdyaWRQb3J0YWxCb3QubWFza3MucG9ydGFsQ29sb3IpCnsKICAgIHJldHVybjsKfQoKZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDb2xvciA9IGJhY2tncm91bmRDb2xvcjsKCm1hc2tzLm9uUG9ydGFsQ2hhbmdlZCA9IGBAIGlmICh0aGF0LnBvcnRhbCA9PSAiZ3JpZFBvcnRhbCIgJiYgdGhhdC5kaW1lbnNpb24gIT0gImJsdWVwcmludCIpewogICAgLy8gbGlua3MucmVtZW1iZXIubWFza3MuYWJCYXNlQ29sb3IgPSBudWxsOwogICAgLy8gbGlua3MucmVtZW1iZXIubWFza3MuYWJCYXNlU3Ryb2tlQ29sb3IgPSBudWxsOwoKICAgIGdyaWRQb3J0YWxCb3QubWFza3MucG9ydGFsQ29sb3IgPSBudWxsOwoKICAgIG1hc2tzLm9uUG9ydGFsQ2hhbmdlZCA9IG51bGw7Cn1gOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsnAMjCsmjpOQtvbkFueUNyZWF0ZQIEAMjCsmisSXZAaWYgKHRoYXQuYm90LnRhZ3MuYmx1ZXByaW50KQp7CiAgICB0aGF0LmJvdC50YWdzLnN0cm9rZUNvbG9yID0gIiNmZmZmZmYiOwogICAgdGhhdC5ib3QudGFncy5sYWJlbENvbG9yID0gIiNmZmZmZmYiOwp9JwDIwrJo6TkPb25Qb3J0YWxDaGFuZ2VkAgQAyMKyaKNKYUBpZiAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIHRoYXQuZGltZW5zaW9uID09ICJibHVlcHJpbnQiKQp7CiAgICB0aGlzQm90LmFiQmx1ZXByaW50KCk7Cn0nAMjCsmjpOQtwZXJzb25hbGl0eQIEAMjCsmiFSyjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwDIwrJo6TkSYWJDb3JlTWVudUl0ZW1UeXBlAgQAyMKyaKxLCGRyb3Bkb3duJwDIwrJo6TkRZHJvcGRvd25Tb3J0T3JkZXICBADIwrJotUsBMScAyMKyaOk5D2Ryb3Bkb3duT3B0aW9ucwIEAMjCsmi3Swbwn6esW10nAMjCsmjpORhhYkNvcmVNZW51T25CZWZvcmVDcmVhdGUCBADIwrJovEviHkBjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgY3VycmVudERpbSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQpjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KY29uc3QgcGVybWFsaW5rVVJMID0gY29uZmlnQm90LnRhZ3MucGVybWFsaW5rOw0KY29uc3QgYWN0aXZlSW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7DQpjb25zdCBhY3RpdmVCaW9zID0gY29uZmlnQm90LnRhZ3Mub3duZXIgPyAiJm93bmVyPSIgKyBjb25maWdCb3QudGFncy5vd25lciA6IGZhbHNlOw0KY29uc3QgZmlyc3RJbmRleCA9IHBlcm1hbGlua1VSTC5pbmRleE9mKCImIik7DQpjb25zdCBpbml0aWFsVVJMID0gcGVybWFsaW5rVVJMLnN1YnN0cmluZygwLCBmaXJzdEluZGV4KTsNCmNvbnN0IHVwZGF0ZWRVUkwgPSBhY3RpdmVCaW9zICE9IGZhbHNlID8gaW5pdGlhbFVSTCArICImaW5zdD0iICsgYWN0aXZlSW5zdCA6IGluaXRpYWxVUkw7DQoNCnNldFRhZ01hc2sodGhpc0JvdCwgImFiQ29yZU1lbnVMYWJlbCIsYG1vZGU6ICR7Y3VycmVudFBvcnRhbH0gcG9ydGFsYCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJjdXJyZW50RGltZW5zaW9uIiwgY3VycmVudERpbSk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJjdXJyZW50UG9ydGFsIiwgY3VycmVudFBvcnRhbCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJkcm9wZG93blNvcnRPcmRlciIsIDEpOw0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJQb3J0YWxNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsNCm1lbnVPcHRpb25zLm9uS2V5VXAgPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSBudWxsO31gOw0KbWVudU9wdGlvbnMuc2tpbGxCb3QgPSBnZXRMaW5rKHRoaXNCb3QpOw0KbWVudU9wdGlvbnMudGFyZ2V0VVJMID0gdXBkYXRlZFVSTDsNCg0KY29uc3QgbWFwTWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCg0KbWFwTWVudUJvdC5sYWJlbCA9ICJtYXAgcG9ydGFsIjsNCm1hcE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAicHVibGljIjsNCm1hcE1lbnVCb3Qub25DbGljayA9IGBAIA0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZtYXBQb3J0YWw9JHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iKTsNCn0NCmVsc2UNCnsNCiAgICBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSAiJHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iOw0KICAgIGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPSBudWxsOw0KfWA7DQoNCmlmIChjdXJyZW50UG9ydGFsICE9ICJtYXAiKQ0Kew0KICAgIC8vbWFwIHBvcnRhbCBidXR0b24NCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtYXBNZW51Qm90KTsNCn0NCg0KY29uc3QgZ3JpZE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQpncmlkTWVudUJvdC5sYWJlbCA9ICJncmlkIHBvcnRhbCI7DQpncmlkTWVudUJvdC5mb3JtQWRkcmVzcyA9ICJjdWJlIjsNCmdyaWRNZW51Qm90Lm9uQ2xpY2sgPSBgQA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9JHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iKTsNCn0gDQplbHNlDQp7DQogICAgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9ICIke2N1cnJlbnREaW0gPT0gImJsdWVwcmludCIgPyAiaG9tZSIgOiBjdXJyZW50RGltfSI7IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IG51bGw7DQp9YDsNCg0KaWYgKGN1cnJlbnRQb3J0YWwgIT0gImdyaWQiIHx8IGN1cnJlbnREaW0gPT0gImJsdWVwcmludCIpDQp7DQogICAgLy9ncmlkIHBvcnRhbCBidXR0b24NCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChncmlkTWVudUJvdCk7DQp9DQoNCmNvbnN0IGJsdWVwcmludE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQoNCmJsdWVwcmludE1lbnVCb3QubGFiZWwgPSAiYmx1ZXByaW50IHBvcnRhbCI7DQpibHVlcHJpbnRNZW51Qm90LmZvcm1BZGRyZXNzID0gImFyY2hpdGVjdHVyZSI7DQpibHVlcHJpbnRNZW51Qm90Lm9uQ2xpY2sgPSBgQA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9Ymx1ZXByaW50Iik7DQp9IA0KZWxzZQ0Kew0KICAgIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAiYmx1ZXByaW50IjsgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gbnVsbDsNCn0NCg0KbGlua3Muc2tpbGxCb3QuYWJCbHVlcHJpbnQoKTtgOw0KDQppZiAoY3VycmVudERpbSAhPSAiYmx1ZXByaW50IikNCnsNCiAgICAvL2JsdWVwcmludCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goYmx1ZXByaW50TWVudUJvdCk7DQp9DQoNCg0KY29uc3Qgc2hlZXRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0Kc2hlZXRNZW51Qm90LmxhYmVsID0gInNoZWV0IHBvcnRhbCI7DQpzaGVldE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAidGFibGVfdmlldyI7DQpzaGVldE1lbnVCb3Qub25DbGljayA9IGBAIA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJnNoZWV0UG9ydGFsPSR7Y3VycmVudERpbX0iKTsNCn0gDQplbHNlDQp7IA0KICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gIiR7Y3VycmVudERpbX0iOw0KfWA7DQoNCi8vc2hlZXQgcG9ydGFsIGJ1dHRvbg0KZHJvcGRvd25PcHRpb25zLnB1c2goc2hlZXRNZW51Qm90KTsNCg0KDQpjb25zdCBzeXN0ZW1NZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KDQpzeXN0ZW1NZW51Qm90LmxhYmVsID0gInN5c3RlbSBwb3J0YWwiOw0Kc3lzdGVtTWVudUJvdC5mb3JtQWRkcmVzcyA9ICJzZXR0aW5nc19hcHBsaWNhdGlvbnMiOw0Kc3lzdGVtTWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZzeXN0ZW1Qb3J0YWw9dHJ1ZSIpOw0KfSANCmVsc2UNCnsgDQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gdHJ1ZTsNCn1gOw0KDQovL3N5c3RlbSBwb3J0YWwgYnV0dG9uDQpkcm9wZG93bk9wdGlvbnMucHVzaChzeXN0ZW1NZW51Qm90KTsNCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwEEYm90cyRlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcBJwDIwrJon2oGc3lzdGVtAgQAyMKyaKBqDWFiLmFjdGlvbi5hc2snAMjCsmifagRmb3JtAgQAyMKyaK5qB25vdGhpbmcnAMjCsmifagZhc2tHUFQCBADIwrJotmrvCkBpZiAoIXRhZ3MuZ3B0QWN0aXZlIHx8IGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dBSSA9PSBmYWxzZSkgewogICAgY29uc3QgYWlNZXNzYWdlID0gbGlua3MucmVtZW1iZXIudGFncy5haV9yZWplY3Rpb25fbWVzc2FnZSA/PyAiQUkgbm90IGF1dGhvcml6ZWQgZm9yIHRoaXMgYWNjb3VudCI7CiAgICBsaW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KHsgbWVzc2FnZTogYWlNZXNzYWdlIH0pOwogICAgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKICAgIGNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7CiAgICByZXR1cm47Cn0KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7Cn0KCmxldCBpbnF1aXJ5ID0gdGhhdC5pbnF1aXJ5ID8/IHRoYXQ7Cgpjb25zdCBwcm9tcHQgPSAhdGhhdC5wcm9tcHQgPyB0YWdzLnByb21wdF9jb3JlIDogdGFnc1sicHJvbXB0XyIgKyB0aGF0LnByb21wdF07CgpsaW5rcy51dGlscy5hYkxvZyh7IG1lc3NhZ2U6IGB0aGlua2luZyBhYm91dDogIiR7aW5xdWlyeX0iYCB9KTsKbGlua3MubWFuaWZlc3RhdGlvbi5hYkJvdENoYXQoeyBtZXNzYWdlOiBgdGhpbmtpbmcgYWJvdXQ6ICIke2lucXVpcnl9ImAgfSk7CgppZiAodGhhdC5wcm9tcHQgPT0gImdyaWQiKSB7CiAgICBpbnF1aXJ5ID0gaW5xdWlyeSArIGAgUE9TSVRJT046IHske3RoYXQuZGF0YS5kaW1lbnNpb259OiB0cnVlLCAke3RoYXQuZGF0YS5kaW1lbnNpb259WDogJHt0aGF0LmRhdGEuZGltZW5zaW9uWH0sICR7dGhhdC5kYXRhLmRpbWVuc2lvbn1ZOiR7dGhhdC5kYXRhLmRpbWVuc2lvbll9fS5gCn0KZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gImJvdCIpIHsKICAgIGlucXVpcnkgPSBpbnF1aXJ5ICsgYCBUQVJHRVRfQk9UX0lEOiBgICsgdGhhdC5kYXRhLmJvdC5pZDsKfQplbHNlIGlmICh0aGF0LnByb21wdCA9PSAibXVsdGlwbGVCb3QiKSB7CiAgICBpbnF1aXJ5ID0gaW5xdWlyeSArIGAgVEFSR0VUX0JPVF9JRFM6IGAgKyB0aGF0LmRhdGEuYm90czsKfQplbHNlIGlmICh0aGF0LnByb21wdCA9PSAiY29yZSIpIHsKICAgIC8vIERvIG5vdGhpbmcgZXh0cmEuCn0KCmNvbnN0IGFuc3dlciA9IGF3YWl0IHRoaXNCb3Quc3VibWl0UmVxdWVzdEdQVCh7IGlucXVpcnk6IGlucXVpcnksIHByb21wdDogcHJvbXB0LCBtb2RlbDogdGhhdC5tb2RlbCB9KTsKCmlmIChhbnN3ZXIpIHsKICAgIGxpbmtzLnV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYFtnZW5lcmF0ZWQgY29kZV06XG4ke2Fuc3dlcn1gIH0pOwoKICAgIGNyZWF0ZSh7IGhvbWU6IHRydWUsIG9uQ3JlYXRlOiBgQCAke2Fuc3dlcn1gIH0pOwoKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwp9JwDIwrJon2oJZ3B0QWN0aXZlAgQAyMKyaKZ1BWZhbHNlJwDIwrJon2oQc3VibWl0UmVxdWVzdEdQVAIEAMjCsmisdZUNQGltcG9ydCB7IEFJQ2hhdE9wdGlvbnMgfSBmcm9tICdjYXN1YWxvcyc7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0YCwgdGhhdCk7Cn0KCmxldCBzeXN0ZW1Qcm9tcHQgPSB0aGF0LnByb21wdCA/IHRoYXQucHJvbXB0IDogdGFncy5wcm9tcHRfY29yZTsKCnN5c3RlbVByb21wdCA9IHN5c3RlbVByb21wdCArIHRoYXQuaW5xdWlyeTsKCmlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93QUkgPT0gZmFsc2UpCnsKICAgIGxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoeyBtZXNzYWdlOiAiQUkgbm90IGF1dGhvcml6ZWQgb24gdGhpcyBhY2NvdW50IiwgbG9nVHlwZTogJ2xvZycgfSk7CiAgICByZXR1cm4gbnVsbDsKfQoKbGV0IGN1cnJlbnRFeHBlcmllbmNlQm90cyA9IGdldEJvdHMoYiA9PiBiLnNwYWNlID09PSAnc2hhcmVkJyAmJiAhYi50YWdzLmFiSWdub3JlKTsKCmlmIChjdXJyZW50RXhwZXJpZW5jZUJvdHMubGVuZ3RoID4gMCkKewogICAgc3lzdGVtUHJvbXB0ID0gc3lzdGVtUHJvbXB0ICsgIiBUaGVzZSBhcmUgdGhlIGJvdHMgdGhhdCBjdXJyZW50bHkgZXhpc3QgaW4gdGhlIGV4cGVyaWVuY2U6ICIgKyBjdXJyZW50RXhwZXJpZW5jZUJvdHM7Cn0KCmlmICghbGlua3MubWVudSkgewogICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdCgnYWJJbnRlcmZhY2UnKTsKfQoKY29uc3QgYnVzeUluZGljYXRvciA9IGF3YWl0IGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcih7IGFiTWVudTogdHJ1ZSwgbGFiZWw6IGBhc2tpbmcgJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWAgfSk7Cgpjb25zdCBhaUNoYXRPcHRpb25zOiBBSUNoYXRPcHRpb25zID0gewogICAgcHJlZmVycmVkTW9kZWw6IHRoYXQubW9kZWwgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwsCiAgICB0ZW1wZXJhdHVyZTogMCwKICAgIHRvcFA6IDEsCiAgICBwcmVzZW5jZVBlbmFsdHk6IDAuNiwKICAgIGZyZXF1ZW5jeVBlbmFsdHk6IDAsCn0KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNlbmRpbmcgdG8gYWk6YCwgeyBzeXN0ZW1Qcm9tcHQsIGFpQ2hhdE9wdGlvbnMgfSk7Cn0KCmxldCBhaVJlc3BvbnNlOiBzdHJpbmc7Cgp0cnkgewogICAgYWlSZXNwb25zZSA9IGF3YWl0IGFpLmNoYXQoc3lzdGVtUHJvbXB0LCBhaUNoYXRPcHRpb25zKTsKCiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWkgcmVzcG9uc2U6YCwgYWlSZXNwb25zZSk7CiAgICB9Cn0gY2F0Y2goZSkgewogICAgYWlSZXNwb25zZSA9IG51bGw7CgogICAgLy8gU2hvdyB0b2FzdCB3aXRoIGVycm9yLgogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6IGBBSSByZXF1ZXN0IGZhaWxlZCAtICR7bGlua3MudXRpbHMuZ2V0RXJyb3JNZXNzYWdlKGUpfWAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CgogICAgLy8gUmV0aHJvdyBzbyBjYWxsZXJzIGNhbiBjYXRjaC4KICAgIHRocm93IGU7Cn0gZmluYWxseSB7CiAgICBkZXN0cm95KGJ1c3lJbmRpY2F0b3IpOwp9CgpyZXR1cm4gYWlSZXNwb25zZTsnAMjCsmifaghyZW1lbWJlcgIEAMjCsmjCggEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAyMKyaJ9qEGFiQ29yZU1lbnVBY3Rpb24CBADIwrJo6YIBnxtAY29uc3QgaW5xdWlyeSA9IHRoYXQ/Lm1lc3NhZ2UgPz8gdGhhdDsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0Py5pbml0aWFsQm9vdCA/PyBmYWxzZTsKY29uc3QgYXV0b0hhdGNoID0gdGhhdD8uYXV0b0hhdGNoID8/IGZhbHNlOwpjb25zdCBtZW51ID0gdGhhdD8ubWVudSA/PyAiY29yZSI7CmNvbnN0IGlucXVpcnlIYXNTcGFjZSA9IGlucXVpcnkuaW5kZXhPZigiICIpICE9PSAtMTsKY29uc3QgbWVudUJvdHMgPSBnZXRCb3RzKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwsIHRydWUpOwpjb25zdCBpc0NoYW5uZWwgPSB0aGF0LmlzQ2hhbm5lbCA/PyBmYWxzZTsKCndoaXNwZXIobWVudUJvdHMsICJhYk1lbnVSZWZyZXNoIik7CgpsZXQgdXNlcm5hbWUgPSAidXNlciI7CmlmIChhdXRoQm90ICYmIGF1dGhCb3QudGFncy5uYW1lKSB7CiAgICB1c2VybmFtZSA9IGF1dGhCb3QudGFncy5uYW1lOwp9IGVsc2UgaWYgKGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZSkgewogICAgdXNlcm5hbWUgPSBhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWU7Cn0KCmFiLmxvZyh7IG1lc3NhZ2U6IGlucXVpcnksIG5hbWU6IHVzZXJuYW1lIH0pOwoKaWYgKCFjb25maWdCb3QudGFncy50YWdQb3J0YWwgJiYgbGlua3MubWFuaWZlc3RhdGlvbi50YWdzLmFiQXdha2UgJiYgaW5xdWlyeSAhPSAiLmxvZyIpIHsKICAgIHNob3V0KCJzaG93Q29uc29sZSIpOwp9CgppZiAoaXNDaGFubmVsKSB7CiAgICBsaW5rcy5jaGFubmVsTG9hZGVyPy5sb2FkQ2hhbm5lbChpbnF1aXJ5KTsKfQplbHNlIGlmICghaW5xdWlyeUhhc1NwYWNlKSB7CiAgICBjb25zdCBpc0RpcmVjdFNlYXJjaCA9IGlucXVpcnkuc3RhcnRzV2l0aChgImApICYmIGlucXVpcnkuZW5kc1dpdGgoYCJgKTsKCiAgICBjb25zdCBhc2s6IEFCTG9va3VwQXNrSURSZXN1bHQgfCBmYWxzZSA9ICFpc0RpcmVjdFNlYXJjaCA/IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsgYXNrSUQ6IGlucXVpcnksIGF1dG9IYXRjaDogdHJ1ZSwgc291cmNlRXZlbnQ6ICdhc2snIH0pIDogZmFsc2U7CgogICAgaWYgKGFzaz8uc3VjY2VzcyAmJiBhc2s/LmRhdGE/LnVybCAhPSB1bmRlZmluZWQgJiYgIWlzRGlyZWN0U2VhcmNoICYmICFpc0NoYW5uZWwpIHsKICAgICAgICBsaW5rcy5sZWFybi5hYkpvaW5Ib3N0KHsgZGF0YTogYXNrLmRhdGEgfSk7CiAgICB9IGVsc2UgaWYgKCFhc2s/LnN1Y2Nlc3MpIHsKICAgICAgICBsZXQgZWdnOiBBQkxvb2t1cEVnZ1Jlc3VsdDsKICAgICAgICBjb25zdCBwZXJpb2RJbmRleCA9IGlucXVpcnkuaW5kZXhPZigiLiIpOwogICAgICAgIGxldCBhYklEID0gaW5xdWlyeTsKCiAgICAgICAgaWYgKGlzRGlyZWN0U2VhcmNoKSB7CiAgICAgICAgICAgIGFiSUQgPSBpbnF1aXJ5LnN1YnN0cmluZygxLCBpbnF1aXJ5Lmxlbmd0aCAtIDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHBlcmlvZEluZGV4ID09IC0xIHx8IGlzRGlyZWN0U2VhcmNoKSB7CiAgICAgICAgICAgIGVnZyA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7IGFiSUQ6IGFiSUQsIGluaXRpYWxCb290LCBhdXRvSGF0Y2gsIHNvdXJjZUV2ZW50OiAnYXNrJyB9KTsKICAgICAgICB9IGVsc2UgaWYgKHBlcmlvZEluZGV4ID4gMCkgewogICAgICAgICAgICBjb25zdCByZWNvcmRLZXkgPSBpbnF1aXJ5LnN1YnN0cmluZygwLCBwZXJpb2RJbmRleCk7CgogICAgICAgICAgICBhYklEID0gaW5xdWlyeS5zdWJzdHJpbmcocGVyaW9kSW5kZXggKyAxKTsKCiAgICAgICAgICAgIGVnZyA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7IHJlY29yZEtleTogcmVjb3JkS2V5LCBhYklEOiBhYklELCBpbml0aWFsQm9vdCwgYXV0b0hhdGNoLCBzb3VyY2VFdmVudDogJ2FzaycsIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxpbmtzLmlucHV0Lm9uQ2hhdCh7IG1lc3NhZ2U6IGlucXVpcnkgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWVnZz8uc3VjY2VzcyAmJiBsaW5rcy5tZW51KSB7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgogICAgICAgICAgICBjb25zdCBzdHVkaW9CdXR0b24gPSB7fTsKCiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ubGFiZWwgPSBhYklEICsgIiBub3QgZm91bmQgaW4gYWN0aXZlIHN0dWRpbywgZW50ZXIgYWx0ZXJuYXRlIHN0dWRpb0lEIjsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgICAgICAgICBzdHVkaW9CdXR0b24uYWJJRCA9IGFiSUQ7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5mb3JtQWRkcmVzcyA9IHRhZ3MuYWJDb3JlTWVudUljb247CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5vblN1Ym1pdCA9IGBAIGxpbmtzLm1hbmFnZXIuYWJDb3JlTWVudUFjdGlvbih0aGF0LnRleHQgKyAiLiIgKyB0YWdzLmFiSUQpO2A7CgogICAgICAgICAgICBjb25zdCBjcmVhdGVCdXR0b24gPSB7fTsKCiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgICAgICAgICBjcmVhdGVCdXR0b24ubGFiZWwgPSAiZ2l2ZSBtZSBhIHByb3RvdHlwZSI7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYklEID0gYWJJRDsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnByb3RvdHlwZSh0YWdzLmFiSUQpO2A7CgogICAgICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihjcmVhdGVCdXR0b24pOwogICAgICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihzdHVkaW9CdXR0b24pOwoKICAgICAgICAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IjsKICAgICAgICB9CiAgICB9Cn0gZWxzZSB7CiAgICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKICAgIGlmICghYXV0aEJvdCkgewogICAgICAgIG9zLnRvYXN0KCJwbGVhc2Ugc2lnbiBpbiB0byBhY2Nlc3MgYWR2YW5jZWQgQUkgZmVhdHVyZXMiKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICB9IGVsc2UgewogICAgICAgIG1hc2tzLmdwdEFjdGl2ZSA9IHRydWU7CgogICAgICAgIGF3YWl0IHRoaXNCb3QuYXNrR1BUKHsgaW5xdWlyeTogaW5xdWlyeSwgcHJvbXB0OiBtZW51LCBkYXRhOiB0aGF0IH0pOwogICAgfQp9JwDIwrJon2oUYWJDb3JlTWVudU9uR2VuZXJhdGUCBADIwrJoiZ4B8ghAdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiY29yZSJ9KTsKICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclN1Ym1pdHRlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCmlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGZyb20gYnVpbHQtaW4gc3VnZ2VzdGlvbnMuCiAgICAgICAgbGV0IHRleHQgPSBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0NvcmVbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNDb3JlLmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwDIwrJon2oTYWJDb3JlTWVudVNvcnRPcmRlcgIEAMjCsmj8pgEDMTAyJwDIwrJon2oQYWJHcmlkTWVudUFjdGlvbgIEAMjCsmiApwEOQC8vcGxhY2Vob2xkZXInAMjCsmifahRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAMjCsmiPpwH/CkB0YWdzLmRpbWVuc2lvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMuZGltZW5zaW9uOwp0YWdzLmRpbWVuc2lvblggPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzLnBvc2l0aW9uLng7CnRhZ3MuZGltZW5zaW9uWSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMucG9zaXRpb24ueTsKdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiZ3JpZCIsIGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24sIGRpbWVuc2lvblg6IHRhZ3MuZGltZW5zaW9uWCwgZGltZW5zaW9uWTogdGFncy5kaW1lbnNpb25ZfSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwpgOwp0YWdzLm9uSW5wdXRUeXBpbmcgPSBgQAogICAgaWYgKCF0YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkQ29yZVRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNDb3JlW21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQ29yZS5sZW5ndGggLSAxKV07CgogICAgICAgIGxpbmtzLmJhc2VTa2lsbC5pbnB1dFN1Z2dlc3Rpb24oeyBpbnB1dEJvdDogdGhpc0JvdCwgdGV4dCB9KTsKICAgIH0KfScAyMKyaJ9qDW1hbmlmZXN0YXRpb24CBADIwrJoj7IBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAMjCsmifahNhYkdyaWRNZW51U29ydE9yZGVyAgQAyMKyaLayAQMxMDInAMjCsmifag9hYkdyaWRNZW51TGFiZWwCBADIwrJourIBBmFzayBhYicAyMKyaJ9qD2FiQ29yZU1lbnVMYWJlbAIEAMjCsmjBsgEGYXNrIGFiJwDIwrJon2oOYWJDb3JlTWVudUljb24CBADIwrJoyLIBBGN1YmUnAMjCsmifag5hYkdyaWRNZW51SWNvbgIEAMjCsmjNsgEEY3ViZScAyMKyaJ9qCmVkaXRQcm9tcHQCBADIwrJo0rIBhwhAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgcHJvbXB0TWVudUJ1dHRvbiA9IHt9OwoKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwpwcm9tcHRNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CnByb21wdE1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKcHJvbXB0TWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CnByb21wdE1lbnVCdXR0b24uZ3B0Qm90ID0gIvCflJciICsgdGhpc0JvdC5pZDsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJsb2FkIHByb21wdCI7CnByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2xvdWRfZG93bmxvYWQiOwpwcm9tcHRNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5ncHRCb3QudXBkYXRlUHJvbXB0KCdsb2FkJyk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJzYXZlIHByb21wdCI7CnByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiYmFja3VwIjsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LnVwZGF0ZVByb21wdCgnc2F2ZScpOyI7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsKCm1hc2tzLm9uR3JpZENsaWNrID0gYEAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7Cgp0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwpgOwoKdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gInRvcCI7Cgpjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gdGhpc0JvdC5pZCArICIucHJvbXB0X2NvcmUiOwoKaWYgKGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSkKewogICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKfScAyMKyaJ9qBG1lbnUCBADIwrJo2LoBKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAMjCsmifagx1cGRhdGVQcm9tcHQCBADIwrJo/7oBywhAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgcHJvbXB0TWVudUJ1dHRvbiA9IHt9OwoKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwpwcm9tcHRNZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwpwcm9tcHRNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CnByb21wdE1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKcHJvbXB0TWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CnByb21wdE1lbnVCdXR0b24uZ3B0Qm90ID0gIvCflJciICsgdGhpc0JvdC5pZDsKCmlmICh0aGF0ID09ICJsb2FkIikKewogICAgcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJsb2FkIHByb21wdCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNsb3VkX2Rvd25sb2FkIjsKICAgIHByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSAiQCBsaW5rcy5ncHRCb3QubG9hZFByb21wdCh0aGF0LnRleHQpOyI7Cn0KZWxzZQp7CiAgICBwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gInNhdmUgcHJvbXB0IjsKICAgIHByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiYmFja3VwIjsKICAgIHByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSAiQCBsaW5rcy5ncHRCb3Quc2F2ZVByb21wdCh0aGF0LnRleHQpOyI7Cn0KCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKcHJvbXB0TWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICIgICI7CnByb21wdE1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKcHJvbXB0TWVudUJ1dHRvbi5jb2xvciA9ICIjZjI0NzI3IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjYW5jZWwiOwpwcm9tcHRNZW51QnV0dG9uLm9uU3VibWl0ID0gbnVsbDsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7JwDIwrJon2oKbG9hZFByb21wdAIEAMjCsmjJwwHaA0Bhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKaWYgKGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dQdWJsaWNEYXRhID09IGZhbHNlKQp7CiAgICBvcy50b2FzdCgibm90IGF1dGhvcml6ZWQiKTsKCiAgICByZXR1cm47Cn0KCmNvbnN0IHByb21wdE5hbWUgPSAiZ3B0X3Byb21wdF8iICsgdGhhdDsKY29uc3QgbmV3UHJvbXB0ID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBwcm9tcHROYW1lKTsKCmlmICghbmV3UHJvbXB0LnN1Y2Nlc3MpCnsKICAgIG9zLnRvYXN0KCJubyBwcm9tcHQgZm91bmQgYnkgdGhhdCBuYW1lIik7Cn0KZWxzZQp7CiAgICB0YWdzLnByb21wdF9jb3JlID0gbmV3UHJvbXB0LmRhdGE7Cn0KCmlmIChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSA9PSB0aGF0KQp7CiAgICByZXR1cm47Cn0KCnRoaXNCb3QuZWRpdFByb21wdCgpOycAyMKyaJ9qCnNhdmVQcm9tcHQCBADIwrJopMcBvgRAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSA9PSBmYWxzZSB8fCBhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLnB1Ymxpc2hEYXRhID09IGZhbHNlKQp7CiAgICBvcy50b2FzdCgibm90IGF1dGhvcml6ZWQiKTsKCiAgICByZXR1cm47Cn0KCmNvbnN0IGF1dGhvciA9IGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CmNvbnN0IHByb21wdE5hbWUgPSAiZ3B0X3Byb21wdF8iICsgdGhhdDsKY29uc3QgbmV3UHJvbXB0ID0gYXdhaXQgb3MucmVjb3JkRGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBwcm9tcHROYW1lLCB0YWdzLnByb21wdF9jb3JlLCB7dXBkYXRlUG9saWN5OiBbYXV0aG9yLmlkXX0pOwoKaWYgKCFuZXdQcm9tcHQuc3VjY2VzcykKewogICAgb3MudG9hc3QoInNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluIik7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgicHJvbXB0IHNhdmVkIGFzICIgKyB0aGF0KTsKfQoKdGhpc0JvdC5lZGl0UHJvbXB0KCk7JwDIwrJon2oIYWJJZ25vcmUCBADIwrJo48sBBHRydWUnAMjCsmifaghhYkFjdGlvbgIEAMjCsmjoywEEdHJ1ZScAyMKyaJ9qBnNlYXJjaAIEAMjCsmjtywEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAyMKyaJ9qBWxlYXJuAgQAyMKyaJTMASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDIwrJon2oKbWF4X3Rva2VucwIEAMjCsmi7zAEENTAwMCcAyMKyaJ9qD29uQUJJbml0aWFsaXplZAIEAMjCsmjAzAFYQGlmIChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSkKewogICAgdGhpc0JvdC5sb2FkUHJvbXB0KGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlKTsKfScAyMKyaJ9qBWFza0FCAgQAyMKyaJnNAdQDQC8vc2hvdXQoImFza0FCIiwge3Byb21wdDogcHJvbXB0LCBzaG91dDogc2hvdXQsIGNvbnRleHQ6IGNvbnRleHR9KTsKCmlmICghdGFncy5ncHRBY3RpdmUpIHJldHVybjsKCmxldCBpbnF1aXJ5ID0gdGhhdC5wcm9tcHQ7CgovL2FiLmxvZygidXNlcjogIiArIGlucXVpcnkpOyAvL25vdCBuZWVkZWQKCmNvbnN0IGFuc3dlciA9IGF3YWl0IHRoaXNCb3Quc3VibWl0UmVxdWVzdEdQVCh7aW5xdWlyeTogaW5xdWlyeSwgY29udGV4dDogdGhhdC5jb250ZXh0LCBkZWZpbmVkUHJvbXB0OiB0cnVlfSk7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBhbnN3ZXIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkJvdENoYXQoe21lc3NhZ2U6IGFuc3dlcn0pOwoKaWYgKHRoYXQuc2hvdXQpCnsKICAgIHNob3V0KHRoYXQuc2hvdXQsIGFuc3dlcik7Cn0KCnJldHVybiBhbnN3ZXI7JwDIwrJon2oFaW5wdXQCBADIwrJo7tABKPCflJdmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjAnAMjCsmifagtwcm9tcHRfY29yZQIEAMjCsmiV0QHDEkRFTElWRVJBQkxFOiBSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgpPQkpFQ1RJVkU6IFVzaW5nIElOUFVULCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLiAKCkhBUkQgUkVRVUlSRU1FTlRTIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpOgoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYWIubG9nKCIuLi4iKSBzdW1tYXJpemluZyB3aGF0IHRoZSBjb2RlIGRvZXMuCjIuIEFsd2F5cyBlbmQgd2l0aCBkZXN0cm95KHRoaXNCb3QpOyBhcyB0aGUgZmluYWwgc3RhdGVtZW50LgozLiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1Mgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90KC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgo0LiBOZXZlciB1c2UgYW55IG9uQW55KiBsaXN0ZW5lciB0YWdzLiBUaGV5IGFyZSBnZW5lcmFsbHkgY29uc2lkZXJlZCBkYW5nZXJvdXMgYW5kIGNhbiBiZSBwcm9uZSB0byBjcmFzaGluZy4KNS4gSWYgSU5QVVQgaXMgYSBxdWVzdGlvbiB0aGF0IG9ubHkgcmVxdWlyZXMgYSBzaW1wbGUgdGV4dCByZXNwb25zZSwganVzdCBsb2cgdGhlIGFuc3dlciB3aXRoIGFiLmxvZyBhbmQgdGhlbiBkZXN0cm95KHRoaXNCb3QpLgoKUk9MRTogWW91IGFyZSBQTSBCb3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9jYXN1YWwtc2ltdWxhdGlvbi9jYXN1YWxvcyksIGEgd2ViLWJhc2VkIElERSBmb3IgYm90IHNjcmlwdGluZy4KCkRPQ1VNRU5UQVRJT046IFN1cHBvcnRpbmcgZG9jdW1lbnRhdGlvbiBmb3IgQ2FzdWFsT1MgbWF5IGJlIGZvdW5kIGhlcmU6IGh0dHBzOi8vZG9jcy5jYXN1YWxvcy5jb20vCgpFWEFNUExFUzoKCkV4YW1wbGUgMTogIApJbnB1dDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PyAgCkFuc3dlcjoKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSAyOiAgCklucHV0OiBNYWtlIGEgcmVkIGJvdCBhdCBzY2FsZSAyIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gY2xpY2tlZC4gIApBbnN3ZXI6CmFiLmxvZygiTWFkZSBhIHJlZCBib3QiKTsgIApjcmVhdGUoe2hvbWU6IHRydWUsIGhvbWVYOiAwLCBob21lWTogMCwgY29sb3I6ICJyZWQiLCBvbkNsaWNrOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCBzY2FsZTogMiwgY3JlYXRvcjogbnVsbH0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKQW5zd2VyOgphYi5sb2coIk1hZGUgYSBjb3B5IGJvdCIpOyAgCmNyZWF0ZSh7aG9tZTogdHJ1ZSwgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtob21lWDogdGFncy5ob21lWCArIDEsIGNyZWF0b3I6IG51bGx9KSJ9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA0OiAgCklucHV0OiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgCkFuc3dlcjoKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsgIApzZXRUYWcoZ2V0Qm90cygiY29sb3IiLCAicmVkIiksICJjb2xvciIsICJibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNTogIApJbnB1dDogTWFrZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvLiAgCkFuc3dlcjoKYWIubG9nKCJNYWRlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8iKTsgIApjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGNvbG9yOiAiYmx1ZSIsICAKICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge29uQ2xpY2s6IG51bGwsIG9uUG9pbnRlckVudGVyOiB0YWdzLm9uUG9pbnRlckVudGVyU2NyaXB0fSkiLCAgCiAgb25Qb2ludGVyRW50ZXJTY3JpcHQ6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsICAKICBjcmVhdG9yOiBudWxsICAKfSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCklOUFVUOgonAMjCsmifagtwcm9tcHRfZ3JpZAIEAMjCsmjZ4wHdFURFTElWRVJBQkxFOiBSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgpPQkpFQ1RJVkU6IFVzaW5nIElOUFVUIGFuZCBQT1NJVElPTiBkYXRhLCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLgoKSEFSRCBSRVFVSVJFTUVOVFMgKG11c3QgYWxsIGJlIHNhdGlzZmllZCk6CgoxLiBBbHdheXMgaW5jbHVkZSBhIHNpbmdsZSBhYi5sb2coIi4uLiIpIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gQWx3YXlzIGVuZCB3aXRoIGRlc3Ryb3kodGhpc0JvdCk7IGFzIHRoZSBmaW5hbCBzdGF0ZW1lbnQuCjMuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCjQuIE5ldmVyIHVzZSBhbnkgb25BbnkqIGxpc3RlbmVyIHRhZ3MuIFRoZXkgYXJlIGdlbmVyYWxseSBjb25zaWRlcmVkIGRhbmdlcm91cyBhbmQgY2FuIGJlIHByb25lIHRvIGNyYXNoaW5nLgo1LiBJZiBJTlBVVCBpcyBhIHF1ZXN0aW9uIHRoYXQgb25seSByZXF1aXJlcyBhIHNpbXBsZSB0ZXh0IHJlc3BvbnNlLCBqdXN0IGxvZyB0aGUgYW5zd2VyIHdpdGggYWIubG9nIGFuZCB0aGVuIGRlc3Ryb3kodGhpc0JvdCkuCgpQT1NJVElPTiBEQVRBOgotIFlvdSB3aWxsIHJlY2VpdmUgY29udGV4dCBzdWNoIGFzIGBwb3NpdGlvbiA9IHsgeDogPG51bWJlcj4sIHk6IDxudW1iZXI+IH1gLgotIFVzZSB0aGlzIGRhdGEgdG8gZGV0ZXJtaW5lIGFwcHJvcHJpYXRlIGBob21lWGAsIGBob21lWWAsIG9yIHJlbGF0aXZlIHBsYWNlbWVudHMgZm9yIGFueSBjcmVhdGVkIGJvdHMuCgpST0xFOiBZb3UgYXJlIFBNIEJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKRE9DVU1FTlRBVElPTjogU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCkVYQU1QTEVTOgoKRXhhbXBsZSAxOiAgCklucHV0OiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKUG9zaXRpb246IHsgeDogNSwgeTogNSB9ICAKQW5zd2VyOiAgCmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMjogIApJbnB1dDogTWFrZSBhIHJlZCBib3QgYXQgc2NhbGUgMiB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGNsaWNrZWQuICAKUG9zaXRpb246IHsgeDogMSwgeTogMiB9ICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIHJlZCBib3QiKTsgIApjcmVhdGUoe2hvbWU6IHRydWUsIGhvbWVYOiAxLCBob21lWTogMiwgY29sb3I6ICJyZWQiLCBvbkNsaWNrOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCBzY2FsZTogMiwgY3JlYXRvcjogbnVsbH0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKUG9zaXRpb246IHsgeDogMCwgeTogMCB9ICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIGNvcHkgYm90Iik7ICAKY3JlYXRlKHtob21lOiB0cnVlLCBob21lWDogMCwgaG9tZVk6IDAsIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7aG9tZVg6IHRhZ3MuaG9tZVggKyAxLCBjcmVhdG9yOiBudWxsfSkifSk7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNDogIApJbnB1dDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApQb3NpdGlvbjogeyB4OiAxMCwgeTogLTMgfSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOyAgCnNldFRhZyhnZXRCb3RzKCJjb2xvciIsICJyZWQiKSwgImNvbG9yIiwgImJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA1OiAgCklucHV0OiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uICAKUG9zaXRpb246IHsgeDogMywgeTogMyB9ICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvIik7ICAKY3JlYXRlKHsgIAogIGhvbWU6IHRydWUsICAKICBob21lWDogMywgIAogIGhvbWVZOiAzLCAgCiAgY29sb3I6ICJibHVlIiwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7b25DbGljazogbnVsbCwgb25Qb2ludGVyRW50ZXI6IHRhZ3Mub25Qb2ludGVyRW50ZXJTY3JpcHR9KSIsICAKICBvblBvaW50ZXJFbnRlclNjcmlwdDogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogIGNyZWF0b3I6IG51bGwgIAp9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKSU5QVVQ6CicAyMKyaJ9qCnByb21wdF9ib3QCBADIwrJot/kBkhpERUxJVkVSQUJMRTogUmV0dXJuIG9ubHkgSmF2YVNjcmlwdCBjb2RlLiBEbyBub3QgaW5jbHVkZSBxdW90ZXMsIE1hcmtkb3duIGZvcm1hdHRpbmcsIG9yIGFueSBleHBsYW5hdG9yeSB0ZXh0LiBUaGUgY29kZSBzaG91bGQgYmUgdmFsaWQgYW5kIGV4ZWN1dGFibGUgaW5zaWRlIHRoZSBgb25DcmVhdGVgIGZpZWxkIG9mIGEgYm90IGluIENhc3VhbE9TLgoKT0JKRUNUSVZFOiBVc2luZyBJTlBVVCBhbmQgVEFSR0VUX0JPVF9JRCwgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHJ1bnMgaW5zaWRlIHRoZSBvbkNyZWF0ZSBmaWVsZCBvZiBhIENhc3VhbE9TIGJvdCBhbmQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvci4gCgpIQVJEIFJFUVVJUkVNRU5UUyAobXVzdCBhbGwgYmUgc2F0aXNmaWVkKToKCjEuIEFsd2F5cyBpbmNsdWRlIGEgc2luZ2xlIGFiLmxvZygiLi4uIikgc3VtbWFyaXppbmcgd2hhdCB0aGUgY29kZSBkb2VzLgoyLiBBbHdheXMgZW5kIHdpdGggZGVzdHJveSh0aGlzQm90KTsgYXMgdGhlIGZpbmFsIHN0YXRlbWVudC4KMy4gVXNlIHRoZSBgVEFSR0VUX0JPVF9JRGAgYXMgY29udGV4dCBmb3IgbG9jYXRpb24gb3IgYmVoYXZpb3Igd2hlbiBhcHByb3ByaWF0ZS4gRm9yIGV4YW1wbGUsIGlmIGEgbmV3IGJvdCBpcyBjcmVhdGVkLCB5b3UgbWF5IHBvc2l0aW9uIGl0IGJhc2VkIG9uIHRoZSB0YXJnZXQgYm90J3MgYGhvbWVYYCBhbmQgYGhvbWVZYCB0YWdzLgo0LiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1Mgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90KC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgo1LiBOZXZlciB1c2UgYW55IG9uQW55KiBsaXN0ZW5lciB0YWdzLiBUaGV5IGFyZSBnZW5lcmFsbHkgY29uc2lkZXJlZCBkYW5nZXJvdXMgYW5kIGNhbiBiZSBwcm9uZSB0byBjcmFzaGluZy4KNi4gSWYgSU5QVVQgaXMgYSBxdWVzdGlvbiB0aGF0IG9ubHkgcmVxdWlyZXMgYSBzaW1wbGUgdGV4dCByZXNwb25zZSwganVzdCBsb2cgdGhlIGFuc3dlciB3aXRoIGFiLmxvZyBhbmQgdGhlbiBkZXN0cm95KHRoaXNCb3QpLgoKQk9UIENPTlRFWFQ6Ci0gWW91IHdpbGwgcmVjZWl2ZSBgVEFSR0VUX0JPVF9JRCA9ICI8Ym90SWQ+ImAuCi0gWW91IG11c3QgdXNlIGBnZXRCb3QoImlkIiwgIjxib3RJZD4iKWAgdG8gcmV0cmlldmUgdGhlIGJvdCBhbmQgYWNjZXNzIGl0cyB0YWdzIChlLmcuLCBgZ2V0Qm90KCJpZCIsIFRBUkdFVF9CT1RfSUQpLnRhZ3MuaG9tZVhgKS4KLSBZb3UgY2FuIHBvc2l0aW9uIG5ldyBib3RzIG5lYXIgdGhlIHRhcmdldCBib3QgYnkgdXNpbmcgaXRzIGBob21lWGAsIGBob21lWWAsIG9yIG90aGVyIHRhZyBkYXRhLgoKUk9MRTogWW91IGFyZSBQTSBCb3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9jYXN1YWwtc2ltdWxhdGlvbi9jYXN1YWxvcyksIGEgd2ViLWJhc2VkIElERSBmb3IgYm90IHNjcmlwdGluZy4KCkRPQ1VNRU5UQVRJT046IFN1cHBvcnRpbmcgZG9jdW1lbnRhdGlvbiBmb3IgQ2FzdWFsT1MgbWF5IGJlIGZvdW5kIGhlcmU6IGh0dHBzOi8vZG9jcy5jYXN1YWxvcy5jb20vCgpFWEFNUExFUzoKCkV4YW1wbGUgMTogIApJbnB1dDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PyAgClRBUkdFVF9CT1RfSUQ6ICJza3lfMTIzIiAgCkFuc3dlcjogIAphYi5sb2coIlRoZSBza3kgaXMgYmx1ZSIpOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDI6ICAKSW5wdXQ6IE1ha2UgYSByZWQgYm90IGF0IHNjYWxlIDIgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBjbGlja2VkLiAgClRBUkdFVF9CT1RfSUQ6ICJib3RfMDAxIiAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgYSByZWQgYm90Iik7ICAKbGV0IHRhcmdldCA9IGdldEJvdCgiaWQiLCAiYm90XzAwMSIpOyAgCmNyZWF0ZSh7ICAKICBob21lOiB0cnVlLCAgCiAgaG9tZVg6IHRhcmdldC50YWdzLmhvbWVYLCAgCiAgaG9tZVk6IHRhcmdldC50YWdzLmhvbWVZLCAgCiAgY29sb3I6ICJyZWQiLCAgCiAgb25DbGljazogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogIHNjYWxlOiAyLCAgCiAgY3JlYXRvcjogbnVsbCAgCn0pOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKVEFSR0VUX0JPVF9JRDogImJvdF9jb3BpZXIiICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIGNvcHkgYm90Iik7ICAKbGV0IHRhcmdldCA9IGdldEJvdCgiaWQiLCAiYm90X2NvcGllciIpOyAgCmNyZWF0ZSh7ICAKICBob21lOiB0cnVlLCAgCiAgaG9tZVg6IHRhcmdldC50YWdzLmhvbWVYLCAgCiAgaG9tZVk6IHRhcmdldC50YWdzLmhvbWVZLCAgCiAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtob21lWDogdGFncy5ob21lWCArIDEsIGNyZWF0b3I6IG51bGx9KSIgIAp9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA0OiAgCklucHV0OiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgClRBUkdFVF9CT1RfSUQ6ICJyZWZfYm90IiAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOyAgCnNldFRhZyhnZXRCb3RzKCJjb2xvciIsICJyZWQiKSwgImNvbG9yIiwgImJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKRXhhbXBsZSA1OiAgCklucHV0OiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uICAKVEFSR0VUX0JPVF9JRDogImJvdF9wYXJlbnQiICAKQW5zd2VyOiAgCmFiLmxvZygiTWFkZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvIik7ICAKbGV0IHRhcmdldCA9IGdldEJvdCgiaWQiLCAiYm90X3BhcmVudCIpOyAgCmNyZWF0ZSh7ICAKICBob21lOiB0cnVlLCAgCiAgaG9tZVg6IHRhcmdldC50YWdzLmhvbWVYLCAgCiAgaG9tZVk6IHRhcmdldC50YWdzLmhvbWVZLCAgCiAgY29sb3I6ICJibHVlIiwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7b25DbGljazogbnVsbCwgb25Qb2ludGVyRW50ZXI6IHRhZ3Mub25Qb2ludGVyRW50ZXJTY3JpcHR9KSIsICAKICBvblBvaW50ZXJFbnRlclNjcmlwdDogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogIGNyZWF0b3I6IG51bGwgIAp9KTsgIApkZXN0cm95KHRoaXNCb3QpOwoKSU5QVVQ6ICAKJwDIwrJon2oPYWJCb3RNZW51QWN0aW9uAgQAyMKyaMqTAg5ALy9wbGFjZWhvbGRlcicAyMKyaJ9qE2FiQm90TWVudU9uR2VuZXJhdGUCBADIwrJo2ZMCsQlAdGFncy50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90Rm9jdXM7CnRhZ3Mub25TdWJtaXQgPSBgQAogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogImJvdCIsIGJvdDogbGlua3MudGFyZ2V0Qm90fSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkQm90VGV4dCkgewogICAgICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclR5cGVkQm90VGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgoKaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRCb3RUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkQm90VGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZEJvdFRleHQpIHsKICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gZnJvbSBidWlsdC1pbiBzdWdnZXN0aW9ucy4KICAgICAgICBsZXQgdGV4dCA9IGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQm90W21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQm90Lmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwDIwrJon2oNaXRlcmF0ZVByb21wdAIEAMjCsmiLnQLsBUBjb25zdCBpbnF1aXJ5ID0gYFBsZWFzZSBhdWdtZW50IHRoZSBmb2xsb3dpbmcgUFJPTVBUIGJ5IG1ha2luZyBpdCBtb3JlIGVhc2lseSByZWFkIGJ5IEdQVC4gIFBsZWFzZSBmb2N1cyBvbiB0aGUgZnVuY3Rpb25hbGl0eSBpbnNpZGUgb2YgaXQ6CgoxLiBUaGUgcHJvbXB0IG11c3QgbWFpbnRhaW4gYWxsIG9mIHRoZSBmdW5jdGlvbmFsaXR5IG9mIHRoZSBvcmlnaW5hbAoKMi4gVGhlIHByb21wdCBzaG91bGQga2VlcCBpbiBtaW5kIHRoYXQgd2UgYXJlIHdvcmtpbmcgaW4gYSAzRCBlbnZpcm9ubWVudAoKMy4gVGhlIHJlcGx5IHNob3VsZCBvbmx5IGJlIHRoZSBuZXcgcHJvbXB0Cgo0LiBUaGUgZnVuY3Rpb25zIHNob3VsZCBiZSBsaW1pdGVkIHRvIHRob3NlIGZvdW5kIGluIHRoZSBvcmlnaW5hbCBwcm9tcHQKClBST01QVDpgOwpjb25zdCBwcm9tcHQgPSB0YWdzWyJwcm9tcHRfIiArIHRoYXRdOwpjb25zdCBpdGVyYXRpb24gPSBhd2FpdCB0aGlzQm90LnN1Ym1pdFJlcXVlc3RHUFQoe2lucXVpcnk6IGlucXVpcnksIHByb21wdDogcHJvbXB0fSk7CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBpdGVyYXRpb24pOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkJvdENoYXQoe21lc3NhZ2U6IG5ld0Fuc3dlcn0pOwoKdGFnc1sicHJvbXB0XyIgKyB0aGF0XSA9IGl0ZXJhdGlvbjsKdGFnc1sicHJvbXB0XyIgKyB0aGF0ICsgIl92ZXJzaW9uIl0rKzsKCnJldHVybjsnAMjCsmifahJhYkJvdE1lbnVTb3J0T3JkZXICBADIwrJo+KICAzEwMicAyMKyaJ9qEmNvbnZlcnNhdGlvblByb21wdAIEAMjCsmj8ogLgCllvdSBhcmUgYW4gYWdlbnQgdGFza2VkIHdpdGggZGV0ZXJtaW5pbmcgaW50ZW50aW9uIGJhc2VkIG9uIGEgc3RhdGVtZW50IGEgdXNlciBnaXZlcyB5b3UuCgpQbGVhc2UgbG9vayBhdCB0aGUgZm9sbG93aW5nIHN0YXRlbWVudCBhbmQgZGV0ZXJtaW5lIGlmIGl0IGlzIGEgQ29udmVyc2F0aW9uIFJlcXVlc3Qgb3IgQnVpbGQgUmVxdWVzdC4KCkJ1aWxkIFJlcXVlc3RzOiAgU3BlY2lmaWMgcmVxdWVzdCBmb3IgdGhlIHN5c3RlbSB0byBidWlsZCwgbWFrZSBvciBwcm92aWRlIGNvZGUgZm9yIHNvbWV0aGluZyBzcGVjaWZpYy4KVGhlc2UgcmVxdWVzdHMgd2lsbCBnZW5lcmFsbHkgYmUgaW4gdGhlIGZvcm0gb2YgY29tbWFuZHMgb3IgcmVxdWVzdHMgZnJvbSB0aGUgc3lzdGVtLgpFeGFtcGxlIEJ1aWxkIFJlcXVlc3RzOiAKTWFrZSBhIHllbGxvdyBiYWxsLiAKUGxlYXNlIGNyZWF0ZSBhIGJpZyBwdXJwbGUgY3ViZS4gIApXcml0ZSB0aGUgY29kZSBmb3IgYSBib3QgdGhhdCBjaGFuZ2VzIGNvbG9ycyB3aGVuIGNsaWNrZWQuCgpDb252ZXJzYXRpb24gUmVxdWVzdHM6ICBBbnkgcmVxdWVzdCB0aGF0IGlzIG5vdCBhIEJ1aWxkIFJlcXVlc3Qgd2lsbCBkZWZhdWx0IHRvIGJlaW5nIGEgQ29udmVyc2F0aW9uLgpFdmVuIGlmIHRoZSByZXF1ZXN0cyBkaXNjdXNzZXMgbWFraW5nIGJ1aWxkaW5nIG9yIGNvZGluZyB0aGluZ3MgaXQgaXMgc3RpbGwgQ29udmVyc2F0aW9uIGlmIGl0IGlzIG5vdCB3b3JkZWQgYXMgYSBkaXJlY3QgcmVxdWVzdC4KRXhhbXBsZSBDb252ZXJzYXRpb24gUmVxdWVzdHM6CkNvdWxkIEkgYnVpbGQgYSBib3QgdGhhdCBnZXRzIGJpZ2dlciB3aGVuIGNsaWNrZWQ/CklzIGl0IHBvc3NpYmxlIHRvIGNvZGUgYm90cyB0aGF0IG1vdmU/CkNhbiBteSBzb24gbWFrZSBhIHllbGxvdyBiYWxsIGluIENhc3VhbE9TPwoKRGV0ZXJtaW5pbmcgSW50ZW50OiAgSWYgY29uZGl0aW9ucyBmb3IgQnVpbGQgUmVxdWVzdCBhcmUgc3BlY2lmaWNhbGx5IG1ldCB0aGVuIGl0J3MgYSBCdWlsZCBSZXF1ZXN0LiBFdmVyeXRoaW5nIGVsc2UgaXMgQ29udmVyc2F0aW9uLgoKRGV0ZXJtaW5lIHRoZSBpbnRlbnRpb24gb2YgdGhlIHN0YXRlbWVudCBhbmQgcmV0dXJuIHRydWUgaWYgaXQncyBhIEJ1aWxkIFJlcXVlc3QuCgpSVUxFUzoKMS4gUmV0dXJuIG9ubHkgdGhlIHdvcmQgdHJ1ZSBpZiB5b3UndmUgZGV0ZXJtaW5lZCBpdCdzIGEgQnVpbGQgUmVxdWVzdC4KMi4gUmV0dXJuIG9ubHkgZmFsc2UgaWYgdGhlIHN0YXRlbWVudCBpcyBhIENvbnZlcnNhdGlvbiBSZXF1ZXN0LgozLiBBbnN3ZXJpbmcgd2l0aCBhbnl0aGluZyBvdGhlciB0aGFuIHRydWUgb3IgZmFsc2Ugd2lsbCBicmVhayB0aGUgZXhwZXJpZW5jZS4KClNUQVRFTUVOVDoKJwDIwrJon2oXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBADIwrJo3a0CDkAvL3BsYWNlaG9sZGVyJwDIwrJon2obYWJNdWx0aXBsZUJvdE1lbnVPbkdlbmVyYXRlAgQAyMKyaOytAqALQGNvbnN0IGFsbFRhcmdldEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CmNvbnN0IHRhcmdldEFycmF5ID0gW107Cgpmb3IgKGxldCBpID0gMDsgaSA8IGFsbFRhcmdldEJvdHMubGVuZ3RoOyBpKyspCnsKICAgIHRhcmdldEFycmF5LnB1c2goYWxsVGFyZ2V0Qm90c1tpXS5pZCk7Cn0KCnRhZ3MudGFyZ2V0Qm90cyA9IHRhcmdldEFycmF5Owp0YWdzLm9uU3VibWl0ID0gYEAKICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJtdWx0aXBsZUJvdCIsIGJvdHM6IHRhZ3MudGFyZ2V0Qm90c30pOwogICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyU3VibWl0dGVkTXVsdGlwbGVCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkTXVsdGlwbGVCb3RUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIH0KYDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfQoKaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRNdWx0aXBsZUJvdFRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQpIHsKICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gZnJvbSBidWlsdC1pbiBzdWdnZXN0aW9ucy4KICAgICAgICBsZXQgdGV4dCA9IGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zTXVsdGlwbGVCb3RzW21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zTXVsdGlwbGVCb3RzLmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwDIwrJon2oScHJvbXB0X211bHRpcGxlQm90AgQAyMKyaI25AoYZREVMSVZFUkFCTEU6IFJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCk9CSkVDVElWRTogVXNpbmcgSU5QVVQgYW5kIFRBUkdFVF9CT1RfSURTLCAgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHJ1bnMgaW5zaWRlIHRoZSBvbkNyZWF0ZSBmaWVsZCBvZiBhIENhc3VhbE9TIGJvdCBhbmQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvci4KCkhBUkQgUkVRVUlSRU1FTlRTIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpOgoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYWIubG9nKCIuLi4iKSBzdW1tYXJpemluZyB3aGF0IHRoZSBjb2RlIGRvZXMuCjIuIEFsd2F5cyBlbmQgd2l0aCBkZXN0cm95KHRoaXNCb3QpOyBhcyB0aGUgZmluYWwgc3RhdGVtZW50LgozLiBVc2UgdGhlIGFycmF5IG9mIGBUQVJHRVRfQk9UX0lEU2AgYXMgY29udGV4dCBmb3IgbG9jYXRpb24gb3IgYmVoYXZpb3Igd2hlbiBhcHByb3ByaWF0ZS4gRm9yIGV4YW1wbGU6CiAgIC0gV2hlbiBjcmVhdGluZyBib3RzLCB1c2UgZWFjaCB0YXJnZXQncyBgaG9tZVhgIGFuZCBgaG9tZVlgIGZvciBwbGFjZW1lbnQuCiAgIC0gV2hlbiBtb2RpZnlpbmcgYm90cywgaXRlcmF0ZSBvdmVyIGVhY2ggdGFyZ2V0IHVzaW5nIGBnZXRCb3QoImlkIiwgPGlkPilgLgo0LiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1Mgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90KC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgo1LiBOZXZlciB1c2UgYW55IG9uQW55KiBsaXN0ZW5lciB0YWdzLiBUaGV5IGFyZSBnZW5lcmFsbHkgY29uc2lkZXJlZCBkYW5nZXJvdXMgYW5kIGNhbiBiZSBwcm9uZSB0byBjcmFzaGluZy4KNi4gSWYgSU5QVVQgaXMgYSBxdWVzdGlvbiB0aGF0IG9ubHkgcmVxdWlyZXMgYSBzaW1wbGUgdGV4dCByZXNwb25zZSwganVzdCBsb2cgdGhlIGFuc3dlciB3aXRoIGFiLmxvZyBhbmQgdGhlbiBkZXN0cm95KHRoaXNCb3QpLgoKQk9UIENPTlRFWFQ6Ci0gWW91IHdpbGwgcmVjZWl2ZSBgVEFSR0VUX0JPVF9JRFMgPSBbImJvdF8xIiwgImJvdF8yIiwgLi4uXWAuCi0gVXNlIGBnZXRCb3QoImlkIiwgPGlkPilgIHRvIGFjY2VzcyBpbmRpdmlkdWFsIGJvdHMgYW5kIHRoZWlyIHRhZ3MuCi0gUGVyZm9ybSBtb2RpZmljYXRpb25zIG9yIGxvZ2ljIGZvciBlYWNoIGJvdCBpbiB0aGUgYXJyYXkuCgpST0xFOiBZb3UgYXJlIFBNIEJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKRE9DVU1FTlRBVElPTjogU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCkVYQU1QTEVTOgoKRXhhbXBsZSAxOiAgCklucHV0OiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKVEFSR0VUX0JPVF9JRFM6IFsic2t5XzEyMyJdICAKQW5zd2VyOiAgCmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgMjogIApJbnB1dDogTWFrZSBhIHJlZCBib3QgbmV4dCB0byBlYWNoIG9mIHRoZXNlIGJvdHMuICAKVEFSR0VUX0JPVF9JRFM6IFsiYSIsICJiIiwgImMiXSAgCkFuc3dlcjogIAphYi5sb2coIk1hZGUgcmVkIGJvdHMgbmV4dCB0byBlYWNoIHRhcmdldCIpOyAgCmZvciAobGV0IGlkIG9mIFsiYSIsICJiIiwgImMiXSkgeyAgCiAgbGV0IGJvdCA9IGdldEJvdCgiaWQiLCBpZCk7ICAKICBjcmVhdGUoeyAgCiAgICBob21lOiB0cnVlLCAgCiAgICBob21lWDogYm90LnRhZ3MuaG9tZVggKyAxLCAgCiAgICBob21lWTogYm90LnRhZ3MuaG9tZVksICAKICAgIGNvbG9yOiAicmVkIiwgIAogICAgY3JlYXRvcjogbnVsbCAgCiAgfSk7ICAKfSAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDM6ICAKSW5wdXQ6IFRvYXN0IGhlbGxvIHdoZW4gYW55IG9mIHRoZXNlIGJvdHMgYXJlIGNsaWNrZWQuICAKVEFSR0VUX0JPVF9JRFM6IFsidGFyZ2V0MSIsICJ0YXJnZXQyIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJTZXQgdXAgdG9hc3Qtb24tY2xpY2sgYmVoYXZpb3IiKTsgIApmb3IgKGxldCBpZCBvZiBbInRhcmdldDEiLCAidGFyZ2V0MiJdKSB7ICAKICBsZXQgYm90ID0gZ2V0Qm90KCJpZCIsIGlkKTsgIAogIHNldFRhZyhib3QsICJvbkNsaWNrIiwgIkAgb3MudG9hc3QoJ2hlbGxvJyk7Iik7ICAKfSAgCmRlc3Ryb3kodGhpc0JvdCk7CgpFeGFtcGxlIDQ6ICAKSW5wdXQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuICAKVEFSR0VUX0JPVF9JRFM6IFsic29tZV9pZCIsICJkb2VzbnRfbWF0dGVyIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsgIApzZXRUYWcoZ2V0Qm90cygiY29sb3IiLCAicmVkIiksICJjb2xvciIsICJibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCkV4YW1wbGUgNTogIApJbnB1dDogTWFrZSBhIGJsdWUgYm90IGFib3ZlIGVhY2ggb2YgdGhlIGdpdmVuIGJvdHMgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBob3ZlcmVkLiAgClRBUkdFVF9CT1RfSURTOiBbImIxIiwgImIyIiwgImIzIl0gIApBbnN3ZXI6ICAKYWIubG9nKCJNYWRlIGJsdWUgYm90cyBhYm92ZSBlYWNoIHRhcmdldCB0aGF0IHRvYXN0IG9uIHBvaW50ZXIgZW50ZXIiKTsgIApmb3IgKGxldCBpZCBvZiBbImIxIiwgImIyIiwgImIzIl0pIHsgIAogIGxldCBib3QgPSBnZXRCb3QoImlkIiwgaWQpOyAgCiAgY3JlYXRlKHsgIAogICAgaG9tZTogdHJ1ZSwgIAogICAgaG9tZVg6IGJvdC50YWdzLmhvbWVYLCAgCiAgICBob21lWTogYm90LnRhZ3MuaG9tZVkgKyAxLCAgCiAgICBjb2xvcjogImJsdWUiLCAgCiAgICBvblBvaW50ZXJFbnRlcjogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogICAgY3JlYXRvcjogbnVsbCAgCiAgfSk7ICAKfSAgCmRlc3Ryb3kodGhpc0JvdCk7CgpJTlBVVDogIAonAMjCsmifahphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAMjCsmiU0gIDMTAxJwDIwrJon2oJYWJWZXJzaW9uAgQAyMKyaJjSAgUxMC4xMycAyMKyaJ9qDmNoYW5uZWxfY29uZmlnAgQAyMKyaJ7SAq0PQGNvbnN0IGNvbmZpZ3VyYXRpb25EYXRhID0gYXdhaXQgb3MuZ2V0RGF0YSh0aGF0LmRhdGEuc3R1ZGlvSUQsIHRoYXQuZGF0YS5wYXR0ZXJuSUQpOwoKbGV0IG5ld0RlcGxveW1lbnQgPSBmYWxzZTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmNoYW5uZWxDb25maWd1cmVkKQp7CiAgICByZXR1cm47Cn0KCmxpbmtzLnJlbWVtYmVyLnRhZ3MuY2hhbm5lbENvbmZpZ3VyZWQgPSB0cnVlOwoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvcykKewogICAgY29uc3QgdGFyZ2V0QmlvcyA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvczsKCiAgICBzd2l0Y2ggKHRhcmdldEJpb3MpIAogICAgewogICAgICAgIGNhc2UgImxvY2FsIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0YXRpY0luc3QgPT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmV3RGVwbG95bWVudCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInN0dWRpbyI6CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5vd25lciA9PSBudWxsIHx8IGNvbmZpZ0JvdC50YWdzLm93bmVyID09ICJwdWJsaWMiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic2hhcmVkIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLm93bmVyICE9ICJwdWJsaWMiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmVnZykKewogICAgY29uc3QgdGFyZ2V0UGF0dGVybiA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZWdnLnBhdHRlcm47CiAgICBjb25zdCB0YXJnZXRTdHVkaW8gPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmVnZy5zdHVkaW87CgogICAgc2hvdXQoImhhdGNoIiwge2FiSUQ6IHRhcmdldFBhdHRlcm4sIHJlY29yZEtleTogdGFyZ2V0U3R1ZGlvLCBhdXRvSGF0Y2g6IHRydWV9KTsKfQoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yKQp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yOwoKICAgIGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxDb2xvciA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZ3JpZENvbG9yOwp9CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICYmIGNvbmZpZ0JvdC50YWdzLmluc3QgIT0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICYmIGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCAhPSBudWxsKQp7CiAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKfQoKaWYgKG5ld0RlcGxveW1lbnQpCnsKICAgIGNvbnN0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwogICAgY29uc3QgdGFyZ2V0SW5zdCA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCA/ICImaW5zdD0iICsgY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0IDogIiI7CiAgICBjb25zdCB0YXJnZXRCaW9zID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zID8gIiZiaW9zPSIgKyBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3MgOiAiIjsKICAgIGNvbnN0IHRhcmdldFBhdHRlcm4gPSBjb25maWdCb3QudGFncy5wYXR0ZXJuID8gIiZwYXR0ZXJuPSIgKyBjb25maWdCb3QudGFncy5wYXR0ZXJuIDogIiI7CiAgICBjb25zdCB0YXJnZXRVUkwgPSBzaXRlT3JpZ2luICsgYC8/YXNrPSR7Y29uZmlnQm90LnRhZ3MuYXNrfSR7dGFyZ2V0UGF0dGVybn0ke3RhcmdldEluc3R9JHt0YXJnZXRCaW9zfWA7CgogICAgb3MuZ29Ub1VSTCh0YXJnZXRVUkwpOwp9JwDIwrJon2oNY2hhbm5lbExvYWRlcgIEAMjCsmjM4QIo8J+Ul2E5YjZhYTBkLWIzNTctNGRlNi05YmVmLTg1MzQ4YWIxZDBlMCcAyMKyaJ9qCXByb3RvdHlwZQIEAMjCsmjz4QIuQHRoaXNCb3QuYWJDb3JlTWVudUFjdGlvbigiTWFrZSBtZTogIiArIHRoYXQpOycAyMKyaJ9qC3BlcnNvbmFsaXR5AgQAyMKyaKLiAijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwDIwrJon2oFdXRpbHMCBADIwrJoyeICKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAMjCsmifagZjcmVhdGUCBADIwrJo8OICKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAMjCsmifagVkZWJ1ZwIEAMjCsmiX4wIFZmFsc2UnAMjCsmifag9pbnB1dFN1Z2dlc3Rpb24CBADIwrJoneMC+ANAY29uc3QgaW5wdXRCb3QgPSB0aGF0Py5pbnB1dEJvdDsKY29uc3QgdGV4dCA9IHRoYXQ/LnRleHQ7CmNvbnN0IGFuaW1hdGUgPSB0aGF0Py5hbmltYXRlID8/IHRydWU7Cgphc3NlcnQoaW5wdXRCb3QsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaW5wdXRCb3QgaXMgYSByZXF1aXJlZCBwYXJhbWVtdGVyLmApOwphc3NlcnQodGV4dCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0ZXh0IGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyLmApOwoKaWYgKGFuaW1hdGUpIHsKICAgIGNvbnN0IGNoYXJzID0gWy4uLnRleHRdOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGNoYXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgYXdhaXQgb3Muc2xlZXAobWF0aC5yYW5kb20oMjUsIDEwMCkpOwogICAgICAgIGlucHV0Qm90LnRhZ3MubWVudUl0ZW1UZXh0ID0gY2hhcnMuc2xpY2UoMCwgaSkuam9pbignJyk7CiAgICB9Cn0KCmlucHV0Qm90LnRhZ3MubWVudUl0ZW1UZXh0ID0gdGV4dDsnAMjCsmifahVpbnB1dFN1Z2dlc3Rpb25XYWl0TVMCBADIwrJolucCBDMwMDAnAMjCsmifag9zdWdnZXN0aW9uc0NvcmUCBADIwrJom+cC6wHwn6esWwogICAgIm1ha2UgbWUgYSByZWQgYm90IHRoYXQgd2hlbiBjbGlja2VkIHR1cm5zIGJsdWUiLAogICAgIm1ha2UgbWUgYSBib3QgdGhhdCB3aGVuIGNsaWNrZWQgbWFrZXMgZmlyZXdvcmtzIiwKICAgICJtYWtlIG1lIGEgYm90IHRoYXQgdG9hc3RzICdoZWxsbywgd29ybGQhJyB3aGVuIGNsaWNrZWQiLAogICAgIm1ha2UgbWUgMyBib3RzLCBhIHJlZCBvbmUsIGJsdWUgb25lLCBhbmQgZ3JlZW4gb25lIgpdJwDIwrJon2oOc3VnZ2VzdGlvbnNCb3QCBADIwrJohekCe/Cfp6xbCiAgICAiY2hhbmdlIHRoZSBjb2xvciBvZiB0aGlzIGJvdCB0byBwdXJwbGUiLAogICAgInR1cm4gdGhpcyBib3QgaW50byBhIHNwaGVyZSIsCiAgICAiZG91YmxlIHRoZSBzY2FsZSBvZiB0aGlzIGJvdCIKXScAyMKyaJ9qF3N1Z2dlc3Rpb25zTXVsdGlwbGVCb3RzAgQAyMKyaP/pAo4B8J+nrFsKICAgICJjaGFuZ2UgYWxsIG9mIHRoZXNlIGJvdHMgY29sb3IgdG8gcHVycGxlIiwKICAgICJ0dXJuIGFsbCBvZiB0aGVzZSBib3RzIGludG8gc3BoZXJlcyIsCiAgICAiZG91YmxlIHRoZSBzY2FsZSBvZiBhbGwgb2YgdGhlc2UgYm90cyIKXScBBGJvdHMkZjlmZDdlMmUtN2NjZS00M2ZiLWIyMjMtZDMyY2I0MmJlYmU4AScAyMKyaIzrAgZzeXN0ZW0CBADIwrJojesCE2FiLmFjdGlvbi5jb2xvcl9ib3QnAMjCsmiM6wIEZm9ybQIEAMjCsmih6wIHbm90aGluZycAyMKyaIzrAghhYkFjdGlvbgIEAMjCsmip6wIEdHJ1ZScAyMKyaIzrAg9hYkJvdE1lbnVBY3Rpb24CBADIwrJorusCjgFAY29uc3QgdGFyZ2V0Qm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCm9zLnNob3dJbnB1dEZvclRhZyh0YXJnZXRCb3QsICJjb2xvciIsIHsKICAgIHR5cGU6ICdjb2xvcicsCiAgICB0aXRsZTogJ3BpY2sgYSBjb2xvcicKfSk7JwDIwrJojOsCDmFiQm90TWVudUxhYmVsAgQAyMKyaL3sAgVjb2xvcicAyMKyaIzrAg1hYkJvdE1lbnVJY29uAgQAyMKyaMPsAgdwYWxldHRlJwDIwrJojOsCCHJlbWVtYmVyAgQAyMKyaMvsAijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDIwrJojOsCEmFiQm90TWVudVNvcnRPcmRlcgIEAMjCsmjy7AIBMicAyMKyaIzrAghhYklnbm9yZQIEAMjCsmj07AIEdHJ1ZScAyMKyaIzrAhdhYk11bHRpcGxlQm90TWVudUFjdGlvbgIEAMjCsmj57ALiA0Bjb25zdCBhbGxUYXJnZXRCb3RzID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CmNvbnN0IHNlbGVjdGVkQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobnVsbCwgewogICAgdHlwZTogJ2NvbG9yJywKICAgIHRpdGxlOiAncGljayBhIGNvbG9yJwp9KTsKCnNldFRhZyhyZWxldmFudFRhcmdldEJvdHMsICJjb2xvciIsIHNlbGVjdGVkQ29sb3IpOwoKYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBvcGVuZWQgbXVsdGlwbGUgc2VsZWN0IHNoZWV0Iik7JwDIwrJojOsCFWFiTXVsdGlwbGVCb3RNZW51SWNvbgIEAMjCsmjc8AIHcGFsZXR0ZScAyMKyaIzrAhZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAyMKyaOTwAgVjb2xvcicAyMKyaIzrAhphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAMjCsmjq8AIBMScAyMKyaIzrAglhYlZlcnNpb24CBADIwrJo7PACBTEwLjEzJwDIwrJojOsCC3BlcnNvbmFsaXR5AgQAyMKyaPLwAijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiAA=="}]}