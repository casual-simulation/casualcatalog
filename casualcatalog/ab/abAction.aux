{"version":2,"updates":[{"id":0,"timestamp":1770758930775,"update":"Ae4CqcuevA8AJwEEYm90cyQ1ODQ5YWY1NS01ZThhLTQ4ZDYtOTEwNi0xOTk0OThlOWVjMDgBJwCpy568DwAGc3lzdGVtAgQAqcuevA8BEWFiLmFjdGlvbi5kZXN0cm95JwCpy568DwAIYWJBY3Rpb24CBACpy568DxMEdHJ1ZScAqcuevA8ABGZvcm0CBACpy568DxgHbm90aGluZycAqcuevA8AD2FiQm90TWVudUFjdGlvbgIEAKnLnrwPIJEDQGNvbnN0IHRhcmdldEJvdCA9IHRoYXQuYm90LmxpbmtzLnRhcmdldEJvdDsKCmlmICh0aGF0LmJvdC5saW5rcy50YXJnZXRPcmlnaW5Cb3RzKSB7CiAgICAvLyBEZXN0cm95IGJvdHMgYmVsb25naW5nIHRvIGFiSURPcmlnaW4uCiAgICBkZXN0cm95KHRoYXQuYm90LmxpbmtzLnRhcmdldE9yaWdpbkJvdHMpOwp9IGVsc2UgewogICAgLy8gRGVzdHJveSB0aGUgc2luZ2xlIHRhcmdldCBib3QuCiAgICBkZXN0cm95KHRhcmdldEJvdCk7Cn0KCmFiLmxpbmtzLnNvdW5kLmFiUGxheVNvdW5kKHsgdmFsdWU6IGFiLmxpbmtzLnNvdW5kLnRhZ3MuZGVmYXVsdERlc3Ryb3lTb3VuZCB9KTsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsnAKnLnrwPAA5hYkJvdE1lbnVMYWJlbAIEAKnLnrwPsgMHZGVzdHJveScAqcuevA8ADWFiQm90TWVudUljb24CBACpy568D7oDDmRlbGV0ZV9mb3JldmVyJwCpy568DwASYWJCb3RNZW51U29ydE9yZGVyAgQAqcuevA/JAwMxMDAnAKnLnrwPAAhyZW1lbWJlcgIEAKnLnrwPzQMo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAqcuevA8ADW1hbmlmZXN0YXRpb24CBACpy568D/QDKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAKnLnrwPAAhhYklnbm9yZQIEAKnLnrwPmwQEdHJ1ZScAqcuevA8ADmFiQm90TWVudUNvbG9yAgQAqcuevA+gBAcjRDkzMDMwJwCpy568DwAXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBACpy568D6gEkQRAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgpkZXN0cm95KHJlbGV2YW50VGFyZ2V0Qm90cyk7CgphYi5saW5rcy5zb3VuZC5hYlBsYXlTb3VuZCh7IHZhbHVlOiBhYi5saW5rcy5zb3VuZC50YWdzLmRlZmF1bHREZXN0cm95U291bmQgfSk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7JwCpy568DwAVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAqcuevA+6CA5kZWxldGVfZm9yZXZlcicAqcuevA8AFmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBACpy568D8kIB2Rlc3Ryb3knAKnLnrwPABphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAKnLnrwP0QgDMTAwJwCpy568DwAWYWJNdWx0aXBsZUJvdE1lbnVDb2xvcgIEAKnLnrwP1QgHI0Q5MzAzMCcAqcuevA8ACWFiVmVyc2lvbgIEAKnLnrwP3QgFMTAuMzgnAKnLnrwPABNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAqcuevA/jCK0HQGNvbnN0IHRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgppZiAodGFyZ2V0Qm90KSB7CiAgICB0YWdzLmxhYmVsID0gJ2Rlc3Ryb3knOwogICAgdGFncy50YXJnZXRCb3QgPSBnZXRMaW5rKHRhcmdldEJvdCk7CiAgICB0YWdzLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygiU2hpZnQiKSkgewogICAgICAgICAgICBpZiAobGlua3MudGFyZ2V0Qm90ICYmIGxpbmtzLnRhcmdldEJvdC50YWdzLmFiSURPcmlnaW4pIHsKICAgICAgICAgICAgICAgIC8vIENoYW5nZSBidXR0b24gdG8gZGVzdHJveSBhbGwgYm90cyB3aXRoIHNhbWUgYWJJRE9yaWdpbi4KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE9yaWdpbkJvdHMgPSBnZXRCb3RzKGIgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnRhZ3MuYWJJRE9yaWdpbiA9PT0gbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbjsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbWFza3MubGFiZWwgPSAnZGVzdHJveSAnICsgbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbiArICcgKCcgKyB0YXJnZXRPcmlnaW5Cb3RzLmxlbmd0aCArICcgYm90cyknOwogICAgICAgICAgICAgICAgdGFncy50YXJnZXRPcmlnaW5Cb3RzID0gZ2V0TGluayh0YXJnZXRPcmlnaW5Cb3RzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGA7CiAgICB0YWdzLm9uS2V5VXAgPSBgQAogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoIlNoaWZ0IikpIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSBudWxsOwogICAgICAgICAgICB0YWdzLnRhcmdldE9yaWdpbkJvdHMgPSBudWxsOwogICAgICAgIH0KICAgIGA7Cn0gZWxzZSB7CiAgICAvLyBObyBib3QgdG8gZGVzdHJveS4KICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAKnLnrwPABthYk11bHRpcGxlQm90TWVudU9uR2VuZXJhdGUCBACpy568D5EQ7wRAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgppZiAocmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aCA+IDEpIHsKICAgIC8vIE11bHRpcGxlIGJvdHMuCiAgICB0YWdzLmxhYmVsID0gYGRlc3Ryb3kgKCR7cmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aH0gYm90cylgOwp9IGVsc2UgaWYgKHJlbGV2YW50VGFyZ2V0Qm90cy5sZW5ndGggPT09IDEpIHsKICAgIC8vIFNpbmdsZSBib3QuCiAgICB0YWdzLmxhYmVsID0gYGRlc3Ryb3lgOwp9IGVsc2UgewogICAgLy8gTm8gYm90cyB0byBkZXN0cm95LgogICAgZGVzdHJveSh0aGlzQm90KTsKfScBBGJvdHMkNWFlYzUwMWMtMzM4YS00MmNjLTlmZGQtOWExZWVhOTUzYTA2AScAqcuevA+BFQZzeXN0ZW0CBACpy568D4IVEGFiLmFjdGlvbi51cGRhdGUnAKnLnrwPgRUIYWJBY3Rpb24CBACpy568D5MVBHRydWUnAKnLnrwPgRUQYWJDb3JlTWVudUFjdGlvbgIEAKnLnrwPmBXdBEBpZiAoIWFiVXBkYXRlQ2hlY2tlci50YWdzLmNoZWNraW5nKSB7CiAgICBpZiAoYWJVcGRhdGVDaGVja2VyLnRhZ3MudXBkYXRlQXZhaWxhYmxlKSB7CiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ0luc3RhbGwgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgdXBkYXRlcz8nLAogICAgICAgICAgICBjb250ZW50OiAnV291bGQgeW91IGxpa2UgdG8gaW5zdGFsbCB0aGUgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgdXBkYXRlcz8gWW91IGFuZCBhbnkgY29ubmVjdGVkIHVzZXJzIHdpbGwgYXV0b21hdGljYWxseSByZWZyZXNoIHRoZSBwYWdlIGFmdGVyIHRoZSB1cGRhdGUgaXMgY29tcGxldGUuJywKICAgICAgICAgICAgY2FuY2VsVGV4dDogJ05vdCBub3cnLAogICAgICAgICAgICBjb25maXJtVGV4dDogJ1llcycKICAgICAgICB9KQoKICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgIGFiLnVwZGF0ZUFCKCk7CiAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfQogICAgfQp9JwCpy568D4EVBGZvcm0CBACpy568D/YZB25vdGhpbmcnAKnLnrwPgRUIYWJJZ25vcmUCBACpy568D/4ZBHRydWUnAKnLnrwPgRUTYWJDb3JlTWVudVNvcnRPcmRlcgIEAKnLnrwPgxoDMTAyJwCpy568D4EVDmFiQ29yZU1lbnVJY29uAgQAqcuevA+HGgZ1cGRhdGUnAKnLnrwPgRUPYWJDb3JlTWVudUxhYmVsAgQAqcuevA+OGgZ1cGRhdGUnAKnLnrwPgRUUYWJDb3JlTWVudU9uR2VuZXJhdGUCBACpy568D5Ua/A1AaWYgKCFnbG9iYWxUaGlzLmFiVXBkYXRlQ2hlY2tlcikgewogICAgZGVzdHJveSh0aGlzQm90KTsKICAgIHJldHVybjsKfQoKdGFncy5yZWZyZXNoRGlzcGxheSA9IGBACiAgICBpZiAodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpIHsKICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IG51bGw7CiAgICB9CgogICAgLy8gQ2xlYXIgdGFnIG1hc2tzLgogICAgbWFza3MuYWJNZW51ID0gbnVsbDsKICAgIG1hc2tzLmxhYmVsID0gbnVsbDsKICAgIG1hc2tzLmNvbG9yID0gbnVsbDsKICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gbnVsbDsKICAgIAogICAgaWYgKGFiVXBkYXRlQ2hlY2tlci50YWdzLnVwZGF0ZUF2YWlsYWJsZSkgewogICAgICAgIG1hc2tzLmxhYmVsID0gJ3VwZGF0ZSAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwogICAgICAgIG1hc2tzLmNvbG9yID0gJyNBNEREMDAnOwogICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gJ3VwZGF0ZSc7CiAgICB9IGVsc2UgewogICAgICAgIGlmIChhYlVwZGF0ZUNoZWNrZXIudGFncy5jaGVja2luZykgewogICAgICAgICAgICAvLyBUZW1wb3JhcmlseSByZXBsYWNlIHdpdGggYnVzeSBpbmRpY2F0b3Igd2hpbGUgY2hlY2tpbmcgZm9yIHVwZGF0ZXMuCiAgICAgICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gYWIubGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yKHsKICAgICAgICAgICAgICAgIGFiTWVudTogdHJ1ZSwKICAgICAgICAgICAgICAgIGxhYmVsOiAnY2hlY2tpbmcgZm9yIHVwZGF0ZXMgdG8gJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgICAgIGFiTWVudVNvcnRPcmRlcjogdGFncy5hYk1lbnVTb3J0T3JkZXIsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgbWFza3MuYWJNZW51ID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQUIgaXMgdXAtdG8tZGF0ZS4KICAgICAgICAgICAgbWFza3MuYWJNZW51ID0gZmFsc2U7CiAgICAgICAgfQogICAgfQpgOwoKdGFncy5vbkRlc3Ryb3kgPSBgQAogICAgaWYgKHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKSB7CiAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgdGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IgPSBudWxsOwogICAgfQoKICAgIGlmICh0aGlzQm90LnZhcnMub25BQlVwZGF0ZUNoZWNrZXJCb3RDaGFuZ2VkKSB7CiAgICAgICAgb3MucmVtb3ZlQm90TGlzdGVuZXIoYWJVcGRhdGVDaGVja2VyLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uQUJVcGRhdGVDaGVja2VyQm90Q2hhbmdlZCk7CiAgICB9CmAKCnRoaXNCb3QudmFycy5vbkFCVXBkYXRlQ2hlY2tlckJvdENoYW5nZWQgPSAobGlzdGVuZXJUaGF0KSA9PiB7CiAgICBjb25zdCBuZWVkUmVmcmVzaERpc3BsYXkgPSBsaXN0ZW5lclRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2NoZWNraW5nJyB8fCB0ID09PSAndXBkYXRlQXZhaWxhYmxlJyk7CiAgICBpZiAobmVlZFJlZnJlc2hEaXNwbGF5KSB7CiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgfQp9Cgpvcy5hZGRCb3RMaXN0ZW5lcihhYlVwZGF0ZUNoZWNrZXIsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25BQlVwZGF0ZUNoZWNrZXJCb3RDaGFuZ2VkKTsKCnRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsnAKnLnrwPgRUJYWJWZXJzaW9uAgQAqcuevA+SKAUxMC4zOCcBBGJvdHMkNmIzZDk3NDQtNDQ0OC00ZWY1LTk2YTItNzEyODFjNDJhZjZjAScAqcuevA+YKAlhYlZlcnNpb24CBACpy568D5koBTEwLjM4JwCpy568D5goBnN5c3RlbQIEAKnLnrwPnygRYWIuYWN0aW9uLnZlcnNpb24nAKnLnrwPmCgUYWJBY3Rpb25NYWpvclZlcnNpb24CBACpy568D7EoATEnAKnLnrwPmCgUYWJBY3Rpb25NaW5vclZlcnNpb24CBACpy568D7MoAjMwJwCpy568D5goDW9uU2tpbGxVcGRhdGUCBACpy568D7YomQFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJBY3Rpb25NYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiQWN0aW9uTWlub3JWZXJzaW9uOwoKY29uc29sZS5sb2coIltBQkFjdGlvbl0gTG9hZGVkIEFCIEFjdGlvbiB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAKnLnrwPmCgIYWJJZ25vcmUCBACpy568D9ApBHRydWUnAKnLnrwPmCgIYWJBY3Rpb24CBACpy568D9UpBHRydWUnAKnLnrwPmCgEZm9ybQIEAKnLnrwP2ikHbm90aGluZycBBGJvdHMkNzE3NTY0NWMtNGI1My00NDU0LTg3MTYtZmMwZTY4ZGIyNjY1AScAqcuevA/iKQZzeXN0ZW0CBACpy568D+MpD2FiLmFjdGlvbi5sb2dpbicAqcuevA/iKQhhYkFjdGlvbgIEAKnLnrwP8ykEdHJ1ZScAqcuevA/iKQhhYklnbm9yZQIEAKnLnrwP+CkEdHJ1ZScAqcuevA/iKQRmb3JtAgQAqcuevA/9KQdub3RoaW5nJwCpy568D+IpD2FiQ29yZU1lbnVDb2xvcgIEAKnLnrwPhSoHI0YyQjcwNScAqcuevA/iKRNhYkNvcmVNZW51U29ydE9yZGVyAgQAqcuevA+NKgItNScAqcuevA/iKRBhYkNvcmVNZW51QWN0aW9uAgQAqcuevA+QKhtAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsnAKnLnrwP4ikUYWJDb3JlTWVudU9uR2VuZXJhdGUCBACpy568D6wq6wFAdGFncy5hYk1lbnUgPSBmYWxzZTsgLy8gS2VlcCBidXR0b24gaGlkZGVuIHVudGlsIGF1dGggY2hlY2sgaXMgY29tcGxldGUuCmF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfSBlbHNlIHsKICAgIHRhZ3MuYWJNZW51ID0gdHJ1ZTsKICAgIHRhZ3Mub25BQkF1dGhCb3RBZGRlZCA9IGBAZGVzdHJveSh0aGlzQm90KTtgOwp9JwCpy568D+IpDmFiQ29yZU1lbnVJY29uAgQAqcuevA+YLAVsb2dpbicAqcuevA/iKQhyZW1lbWJlcgIEAKnLnrwPniwo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAqcuevA/iKQlhYlZlcnNpb24CBACpy568D8UsBTEwLjM4JwCpy568D+IpC3BlcnNvbmFsaXR5AgQAqcuevA/LLCjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwCpy568D+IpD2FiQ29yZU1lbnVMYWJlbAIEAKnLnrwP8iwHc2lnbiBpbicAqcuevA/iKQ5hYkNvcmVNZW51SGlkZQIEAKnLnrwP+iwEdHJ1ZScAqcuevA/iKQ5vbkFueUJvdHNBZGRlZAIEAKnLnrwP/yz+AkBpZiAodGhhdC5ib3RzKSB7CiAgICBjb25zdCBhZGRlZEF1dGhCb3QgPSB0aGF0LmJvdHMuZmluZChiID0+IGIgPT09IGdsb2JhbFRoaXMuYXV0aEJvdCk7CgogICAgaWYgKGFkZGVkQXV0aEJvdCkgewogICAgICAgIHRoaXNCb3QudmFycy5hdXRoQm90SWQgPSBhZGRlZEF1dGhCb3QuaWQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXV0aCBib3QgYWRkZWQuIGF1dGhCb3QgaWQ6ICR7dGhpc0JvdC52YXJzLmF1dGhCb3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCQXV0aEJvdEFkZGVkJywgeyBhdXRoQm90OiBhZGRlZEF1dGhCb3QgfSk7CiAgICB9Cn0nAKnLnrwP4ikFZGVidWcCBACpy568D/4vBWZhbHNlJwCpy568D+IpEG9uQW55Qm90c1JlbW92ZWQCBACpy568D4QwowNAaWYgKHRoYXQuYm90SURzICYmIHRoaXNCb3QudmFycy5hdXRoQm90SWQpIHsKICAgIGNvbnN0IHJlbW92ZWRBdXRoQm90SWQgPSB0aGF0LmJvdElEcy5zb21lKGlkID0+IGlkID09PSB0aGlzQm90LnZhcnMuYXV0aEJvdElkKTsKCiAgICBpZiAocmVtb3ZlZEF1dGhCb3RJZCkgewogICAgICAgIHRoaXNCb3QudmFycy5hdXRoQm90SWQgPSBudWxsOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGF1dGggYm90IHJlbW92ZWQuIGF1dGhCb3QgaWQ6ICR7cmVtb3ZlZEF1dGhCb3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCQXV0aEJvdFJlbW92ZWQnLCB7IGF1dGhCb3RJZDogcmVtb3ZlZEF1dGhCb3RJZCB9KTsKICAgIH0KfScBBGJvdHMkYjMzOWMxMTgtNDg5YS00NjZiLWJhOWYtYjA3YTVmOWI2NjRmAScAqcuevA+oMwZzeXN0ZW0CBACpy568D6kzD2FiLmFjdGlvbi5wYXN0ZSgAqcuevA+oMwhhYkFjdGlvbgF4JwCpy568D6gzBGZvcm0CBACpy568D7ozB25vdGhpbmcnAKnLnrwPqDMLZGVzY3JpcHRpb24CBACpy568D8IzK2FiIHNraWxsIHVzZWQgZm9yIGNvcHlpbmcgYW5kIHBhc3RpbmcgYm90cy4nAKnLnrwPqDMHb25QYXN0ZQIEAKnLnrwP7jP/B0BpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IE1BQ1JPUyA9IFsKICAgIHsKICAgICAgICB0ZXN0OiAvKD86W+KAnOKAnV0pL2csCiAgICAgICAgcmVwbGFjZW1lbnQ6ICh2YWwpID0+ICciJywKICAgIH0sCiAgICB7CiAgICAgICAgdGVzdDogLyg/OlvigJjigJldKS9nLAogICAgICAgIHJlcGxhY2VtZW50OiAodmFsKSA9PiAiJyIsCiAgICB9LApdOwoKbGV0IGZvcm1hdHRlZENvcHkgPSByZXBsYWNlTWFjcm9zKHRoYXQudGV4dCk7CmxldCBjb3B5Qm90ID0gSlNPTi5wYXJzZShmb3JtYXR0ZWRDb3B5KTsKbGV0IHBhc3RlZERhdGEgPSAhY29weUJvdC5zdGF0ZSA/IHtbY29weUJvdC5pZF06IGNvcHlCb3R9IDogY29weUJvdC5zdGF0ZTsKbGV0IGRpbU1vZCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJGb2N1c0RhdGE7CgppZiAoT2JqZWN0LmtleXMocGFzdGVkRGF0YSkubGVuZ3RoID09IDEgJiYgZGltTW9kKQp7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb25dID0gdHJ1ZTsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbisiWCJdID0gZGltTW9kLng7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb24rIlkiXSA9IGRpbU1vZC55OwoKICAgIG9zLnRvYXN0KCJib3QgYWRkZWQgdG8gaW5zdCIpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImJvdHMgYWRkZWQgdG8gaW5zdCIpOwp9CgphYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHBhc3RlZCBkYXRhIik7CgpsaW5rcy5jcmVhdGUuYWJDcmVhdGVCb3RzKHtib3RzOiBwYXN0ZWREYXRhLCBzb3VyY2VFdmVudDogJ3Bhc3RlJ30pOwoKZnVuY3Rpb24gcmVwbGFjZU1hY3Jvcyh0ZXh0KSB7CiAgICBpZiAoIXRleHQpIHsKICAgICAgICByZXR1cm4gdGV4dDsKICAgIH0KCiAgICBmb3IgKGxldCBtIG9mIE1BQ1JPUykgewogICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UobS50ZXN0LCBtLnJlcGxhY2VtZW50KTsKICAgIH0KCiAgICByZXR1cm4gdGV4dDsKfScAqcuevA+oMwhyZW1lbWJlcgIEAKnLnrwP5jso8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAqcuevA+oMwZjcmVhdGUCBACpy568D408KPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAKnLnrwPqDMIYWJJZ25vcmUCBACpy568D7Q8BHRydWUnAKnLnrwPqDMJb25LZXlEb3duAgQAqcuevA+5PIMGQGlmICghYnVpbGRlclZlcnNpb24gfHwgKCFsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzICYmICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpKSB7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LmtleXMgPT0gImMiKSB7CiAgICBsZXQgbWV0YUlucHV0ID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiTWV0YSIpOwoKICAgIGlmICghbWV0YUlucHV0KSB7CiAgICAgICAgbWV0YUlucHV0ID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiQ29udHJvbCIpOwogICAgfQoKICAgIGlmICghbWV0YUlucHV0KSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBzZWxlY3RlZEJvdHMgPSBbXTsKCiAgICBpZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykgewogICAgICAgIHNlbGVjdGVkQm90cy5wdXNoKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpOwogICAgfQogICAgZWxzZSBpZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5rcy5yZW1lbWJlci5saW5rcyAgICAuYWJNdWx0aXBsZUJvdEZvY3VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHNlbGVjdGVkQm90cy5wdXNoKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1c1tpXSk7CiAgICAgICB9CiAgICB9CiAKICAgIHRoaXNCb3QuYWJDb3B5Qm90c1RvQ2xpcGJvYXJkKHsgYm90czogc2VsZWN0ZWRCb3RzIH0pOwp9JwCpy568D6gzCWFiVmVyc2lvbgIEAKnLnrwPvUIFMTAuMzgnAKnLnrwPqDMLcGVyc29uYWxpdHkCBACpy568D8NCKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAKnLnrwPqDMVYWJDb3B5Qm90c1RvQ2xpcGJvYXJkAgQAqcuevA/qQpAKQGxldCBib3RzID0gdGhhdC5ib3RzOwpsZXQgb25QcmVwcm9jZXNzQmVmb3JlQ29weSA9IHRoYXQub25QcmVwcm9jZXNzQmVmb3JlQ29weTsKbGV0IHNvdXJjZUV2ZW50ID0gdGhhdC5zb3VyY2VFdmVudDsKCmxldCBib3RzVG9Db3B5ID0gW107CgppZiAoQXJyYXkuaXNBcnJheShib3RzKSkgewogICAgZm9yIChjb25zdCBib3Qgb2YgYm90cykgewogICAgICAgIGlmIChhYi5saW5rcy51dGlscy5pc0JvdChib3QpKSB7CiAgICAgICAgICAgIGJvdHNUb0NvcHkucHVzaChib3QpOwogICAgICAgIH0KICAgIH0KfSBlbHNlIHsKICAgIGlmIChhYi5saW5rcy51dGlscy5pc0JvdChib3RzKSkgewogICAgICAgIGJvdHNUb0NvcHkucHVzaChib3RzKTsKICAgIH0KfQoKaWYgKGJvdHNUb0NvcHkubGVuZ3RoID4gMCkgewogICAgLy8gTGV0IGFsbCBib3RzIGtub3cgdGhhdCBhYiBpcyBhYm91dCB0byBjb3B5IHNvbWUgYm90cy4KICAgIGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChzaG91dCgnb25BQkJlZm9yZUNvcHlCb3RzVG9DbGlwYm9hcmQnLCB7IGJvdHM6IGJvdHNUb0NvcHksIHNvdXJjZUV2ZW50IH0pKTsKICAgIAogICAgY29uc3Qgc3RhdGUgPSB7fTsKCiAgICBmb3IgKGNvbnN0IGJvdCBvZiBib3RzVG9Db3B5KSB7CiAgICAgICAgc3RhdGVbYm90LmlkXSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYm90KSk7CiAgICB9CgogICAgLy8gRG8gYSBwcmVwcm9jZXNzaW5nIHBhc3MgdGhhdCBhbGxvd3MgbGlzdGVuZXJzIHRvIHByZXByb2Nlc3MgdGhlIGJvdCBkYXRhIGJlZm9yZSBpdCBpcyBjb3BpZWQuCiAgICBjb25zdCBwcmVwcm9jZXNzQXJnID0geyBib3REYXRhOiBzdGF0ZSwgc291cmNlRXZlbnQgfTsKCiAgICBpZiAob25QcmVwcm9jZXNzQmVmb3JlQ29weSkgewogICAgICAgIGF3YWl0IG9uUHJlcHJvY2Vzc0JlZm9yZUNvcHkocHJlcHJvY2Vzc0FyZyk7CiAgICB9CgogICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHNob3V0KCdvbkFCUHJlcHJvY2Vzc0JlZm9yZUNvcHlCb3RzVG9DbGlwYm9hcmQnLCBwcmVwcm9jZXNzQXJnKSk7CiAgICAKICAgIC8vIFNlcmlhbGl6ZSB0byB2MSBhdXggZmlsZSwgYW5kIHRoZW4gY29weSB0byBjbGlwYm9hcmQuCiAgICBjb25zdCBhdXggPSBKU09OLnN0cmluZ2lmeSh7IHZlcnNpb246IDEsIHN0YXRlIH0pOwogICAgb3Muc2V0Q2xpcGJvYXJkKGF1eCk7CgogICAgYWIubGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdChgY29waWVkICR7Ym90c1RvQ29weS5sZW5ndGggPiAxID8gJ2JvdHMnIDogJ2JvdCd9IHRvIGNsaXBib2FyZGApOwp9JwEEYm90cyRiZGFiZDZjMC04OWY5LTRmNzUtYjM1Yy0yNmY0ZWM1MjA3ZDYBJwCpy568D/tMBnN5c3RlbQIEAKnLnrwP/EwQYWIuYWN0aW9uLnJlcG9ydCcAqcuevA/7TARmb3JtAgQAqcuevA+NTQdub3RoaW5nJwCpy568D/tMEGFiQ29yZU1lbnVBY3Rpb24CBACpy568D5VNEUBvcy5yZXBvcnRJbnN0KCk7JwCpy568D/tME2FiQ29yZU1lbnVTb3J0T3JkZXICBACpy568D6dNAzEwMScAqcuevA/7TA5hYkNvcmVNZW51SWNvbgIEAKnLnrwPq00EZmxhZycAqcuevA/7TA9hYkNvcmVNZW51TGFiZWwCBACpy568D7BNBnJlcG9ydCcAqcuevA/7TAhhYkFjdGlvbgIEAKnLnrwPt00EdHJ1ZScAqcuevA/7TAhhYklnbm9yZQIEAKnLnrwPvE0EdHJ1ZScAqcuevA/7TBRhYkNvcmVNZW51T25HZW5lcmF0ZQIEAKnLnrwPwU1GQGlmIChjb25maWdCb3QudGFncy5zdGF0aWNJbnN0ICE9IHVuZGVmaW5lZCkKewogICAgZGVzdHJveSh0aGlzQm90KTsKfScAqcuevA/7TAlhYlZlcnNpb24CBACpy568D4hOBTEwLjM4JwEEYm90cyRjNjhjNWI4Mi1jMGE3LTRhNWEtOTEwNC01ZGQ4ZTMyYWU0ZTIBJwCpy568D45OBnN5c3RlbQIEAKnLnrwPj04QYWIuYWN0aW9uLnBvcnRhbCcAqcuevA+OTgtkZXNjcmlwdGlvbgIEAKnLnrwPoE4UU2tpbGwgdG8gb3BlbiBzaGVldC4nAKnLnrwPjk4IYWJBY3Rpb24CBACpy568D7VOBHRydWUnAKnLnrwPjk4EZm9ybQIEAKnLnrwPuk4Hbm90aGluZycAqcuevA+OThBhYkNvcmVNZW51QWN0aW9uAgQAqcuevA/CTgNALy8nAKnLnrwPjk4IcmVtZW1iZXICBACpy568D8ZOKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAKnLnrwPjk4PYWJDb3JlTWVudUxhYmVsAgQAqcuevA/tThBjdXJyZW50IHBvcnRhbDogJwCpy568D45OD2FiQm90TWVudUFjdGlvbgIEAKnLnrwP/k6kA0AKY29uc3Qgc2VsZWN0ZWRCb3QgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzOwoKaWYgKHNlbGVjdGVkQm90KSB7CiAgICBjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgogICAgaWYgKHN0YXRlKSB7CiAgICAgICAgLy8gT3BlbiBzaGVldCBwb3J0YWwgaW4gbmV3IHRhYi4KICAgICAgICBvcy5vcGVuVVJMKGNvbmZpZ0JvdC50YWdzLnBlcm1hbGluayArIGAmc2hlZXRQb3J0YWw9JHtjdXJyZW50RGltfWApOwogICAgfSBlbHNlIHsKICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9IHNlbGVjdGVkQm90LmlkOwogICAgfQoKICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogb3BlbmVkIGJvdCBzaGVldCIpOwp9CicAqcuevA+OTg5hYkJvdE1lbnVMYWJlbAIEAKnLnrwPo1IOb3BlbiBib3Qgc2hlZXQnAKnLnrwPjk4NbWFuaWZlc3RhdGlvbgIEAKnLnrwPslIo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAqcuevA+OTg1hYkJvdE1lbnVJY29uAgQAqcuevA/ZUgp0YWJsZV92aWV3JwCpy568D45ODmFiQ29yZU1lbnVJY29uAgQAqcuevA/kUgthcnJvd19yaWdodCcAqcuevA+OThJhYkJvdE1lbnVTb3J0T3JkZXICBACpy568D/BSATEnAKnLnrwPjk4IYWJJZ25vcmUCBACpy568D/JSBHRydWUnAKnLnrwPjk4XYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBACpy568D/dS1ARAY29uc3QgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwpjb25zdCBtdWx0aXBsZVNlbGVjdERpbSA9ICJhYk11bHRpcGxlU2VsZWN0IjsKCmNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gbXVsdGlwbGVTZWxlY3REaW07CgpzZXRUYWdNYXNrKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cywgbXVsdGlwbGVTZWxlY3REaW0sIHRydWUsICJ0ZW1wTG9jYWwiKTsKCm1hc2tzLmN1cnJlbnRTaGVldEJvdHMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiTXVsdGlwbGVCb3RGb2N1czsKbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgaWYgKHRoYXQuZGltZW5zaW9uICE9ICJhYk11bHRpcGxlU2VsZWN0IiAmJiB0aGF0LnBvcnRhbCA9PSAic2hlZXRQb3J0YWwiKSB7CiAgICAgICAgY2xlYXJUYWdNYXNrcyhsaW5rcy5jdXJyZW50U2hlZXRCb3RzKTsKICAgICAgICBjbGVhclRhZ01hc2tzKHRoaXNCb3QpOwogICAgfQp9KTsKCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogb3BlbmVkIG11bHRpcGxlIHNlbGVjdCBzaGVldCIpOycAqcuevA+OThZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAqcuevA/MVwpvcGVuIHNoZWV0JwCpy568D45OFWFiTXVsdGlwbGVCb3RNZW51SWNvbgIEAKnLnrwP11cKdGFibGVfdmlldycAqcuevA+OThNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAqcuevA/iV+wBQGxldCBzZWxlY3RlZEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7Cgp0YWdzLmxhYmVsID0gYG9wZW4gc2hlZXRgOwoKdGFncy5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsKdGFncy5vbktleVVwID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gbnVsbDt9YDsnAKnLnrwPjk4aYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBACpy568D89ZATAnAKnLnrwPjk4EbWVudQIEAKnLnrwP0Vko8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAqcuevA+OTglhYlZlcnNpb24CBACpy568D/hZBTEwLjM4JwCpy568D45OC2FiQmx1ZXByaW50AgQAqcuevA/+WfsDQGNvbnN0IGJhY2tncm91bmRDb2xvciA9IGxpbmtzLnJlbWVtYmVyPy50YWdzLmFiQmx1ZXByaW50Q29sb3IgPz8gIiMxNzg1QjUiOwoKaWYgKGJhY2tncm91bmRDb2xvciA9PSBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yKQp7CiAgICByZXR1cm47Cn0KCmdyaWRQb3J0YWxCb3QubWFza3MucG9ydGFsQ29sb3IgPSBiYWNrZ3JvdW5kQ29sb3I7CgptYXNrcy5vblBvcnRhbENoYW5nZWQgPSBgQCBpZiAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIHRoYXQuZGltZW5zaW9uICE9ICJibHVlcHJpbnQiKXsKICAgIC8vIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQmFzZUNvbG9yID0gbnVsbDsKICAgIC8vIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQmFzZVN0cm9rZUNvbG9yID0gbnVsbDsKCiAgICBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yID0gbnVsbDsKCiAgICBtYXNrcy5vblBvcnRhbENoYW5nZWQgPSBudWxsOwp9YDsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7JwCpy568D45OC29uQW55Q3JlYXRlAgQAqcuevA/6XaUBQGlmICh0aGF0LmJvdC50YWdzLmJsdWVwcmludCkKewogICAgaWYgKCF0aGF0LmJvdC50YWdzLmFiQm90KSB7CiAgICAgICAgdGhhdC5ib3QudGFncy5zdHJva2VDb2xvciA9ICIjZmZmZmZmIjsKICAgIH0KICAgIAogICAgdGhhdC5ib3QudGFncy5sYWJlbENvbG9yID0gIiNmZmZmZmYiOwp9JwCpy568D45OD29uUG9ydGFsQ2hhbmdlZAIEAKnLnrwPoF9hQGlmICh0aGF0LnBvcnRhbCA9PSAiZ3JpZFBvcnRhbCIgJiYgdGhhdC5kaW1lbnNpb24gPT0gImJsdWVwcmludCIpCnsKICAgIHRoaXNCb3QuYWJCbHVlcHJpbnQoKTsKfScAqcuevA+OTgtwZXJzb25hbGl0eQIEAKnLnrwPgmAo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAqcuevA+OThJhYkNvcmVNZW51SXRlbVR5cGUCBACpy568D6lgCGRyb3Bkb3duJwCpy568D45OEWRyb3Bkb3duU29ydE9yZGVyAgQAqcuevA+yYAExJwCpy568D45OD2Ryb3Bkb3duT3B0aW9ucwIEAKnLnrwPtGAG8J+nrFtdJwCpy568D45OGGFiQ29yZU1lbnVPbkJlZm9yZUNyZWF0ZQIEAKnLnrwPuWDiHkBjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgY3VycmVudERpbSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQpjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KY29uc3QgcGVybWFsaW5rVVJMID0gY29uZmlnQm90LnRhZ3MucGVybWFsaW5rOw0KY29uc3QgYWN0aXZlSW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7DQpjb25zdCBhY3RpdmVCaW9zID0gY29uZmlnQm90LnRhZ3Mub3duZXIgPyAiJm93bmVyPSIgKyBjb25maWdCb3QudGFncy5vd25lciA6IGZhbHNlOw0KY29uc3QgZmlyc3RJbmRleCA9IHBlcm1hbGlua1VSTC5pbmRleE9mKCImIik7DQpjb25zdCBpbml0aWFsVVJMID0gcGVybWFsaW5rVVJMLnN1YnN0cmluZygwLCBmaXJzdEluZGV4KTsNCmNvbnN0IHVwZGF0ZWRVUkwgPSBhY3RpdmVCaW9zICE9IGZhbHNlID8gaW5pdGlhbFVSTCArICImaW5zdD0iICsgYWN0aXZlSW5zdCA6IGluaXRpYWxVUkw7DQoNCnNldFRhZ01hc2sodGhpc0JvdCwgImFiQ29yZU1lbnVMYWJlbCIsYG1vZGU6ICR7Y3VycmVudFBvcnRhbH0gcG9ydGFsYCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJjdXJyZW50RGltZW5zaW9uIiwgY3VycmVudERpbSk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJjdXJyZW50UG9ydGFsIiwgY3VycmVudFBvcnRhbCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJkcm9wZG93blNvcnRPcmRlciIsIDEpOw0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJQb3J0YWxNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsNCm1lbnVPcHRpb25zLm9uS2V5VXAgPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSBudWxsO31gOw0KbWVudU9wdGlvbnMuc2tpbGxCb3QgPSBnZXRMaW5rKHRoaXNCb3QpOw0KbWVudU9wdGlvbnMudGFyZ2V0VVJMID0gdXBkYXRlZFVSTDsNCg0KY29uc3QgbWFwTWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCg0KbWFwTWVudUJvdC5sYWJlbCA9ICJtYXAgcG9ydGFsIjsNCm1hcE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAicHVibGljIjsNCm1hcE1lbnVCb3Qub25DbGljayA9IGBAIA0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZtYXBQb3J0YWw9JHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iKTsNCn0NCmVsc2UNCnsNCiAgICBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSAiJHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iOw0KICAgIGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPSBudWxsOw0KfWA7DQoNCmlmIChjdXJyZW50UG9ydGFsICE9ICJtYXAiKQ0Kew0KICAgIC8vbWFwIHBvcnRhbCBidXR0b24NCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtYXBNZW51Qm90KTsNCn0NCg0KY29uc3QgZ3JpZE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQpncmlkTWVudUJvdC5sYWJlbCA9ICJncmlkIHBvcnRhbCI7DQpncmlkTWVudUJvdC5mb3JtQWRkcmVzcyA9ICJjdWJlIjsNCmdyaWRNZW51Qm90Lm9uQ2xpY2sgPSBgQA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9JHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iKTsNCn0gDQplbHNlDQp7DQogICAgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9ICIke2N1cnJlbnREaW0gPT0gImJsdWVwcmludCIgPyAiaG9tZSIgOiBjdXJyZW50RGltfSI7IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IG51bGw7DQp9YDsNCg0KaWYgKGN1cnJlbnRQb3J0YWwgIT0gImdyaWQiIHx8IGN1cnJlbnREaW0gPT0gImJsdWVwcmludCIpDQp7DQogICAgLy9ncmlkIHBvcnRhbCBidXR0b24NCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChncmlkTWVudUJvdCk7DQp9DQoNCmNvbnN0IGJsdWVwcmludE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQoNCmJsdWVwcmludE1lbnVCb3QubGFiZWwgPSAiYmx1ZXByaW50IHBvcnRhbCI7DQpibHVlcHJpbnRNZW51Qm90LmZvcm1BZGRyZXNzID0gImFyY2hpdGVjdHVyZSI7DQpibHVlcHJpbnRNZW51Qm90Lm9uQ2xpY2sgPSBgQA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9Ymx1ZXByaW50Iik7DQp9IA0KZWxzZQ0Kew0KICAgIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAiYmx1ZXByaW50IjsgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gbnVsbDsNCn0NCg0KbGlua3Muc2tpbGxCb3QuYWJCbHVlcHJpbnQoKTtgOw0KDQppZiAoY3VycmVudERpbSAhPSAiYmx1ZXByaW50IikNCnsNCiAgICAvL2JsdWVwcmludCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goYmx1ZXByaW50TWVudUJvdCk7DQp9DQoNCg0KY29uc3Qgc2hlZXRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0Kc2hlZXRNZW51Qm90LmxhYmVsID0gInNoZWV0IHBvcnRhbCI7DQpzaGVldE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAidGFibGVfdmlldyI7DQpzaGVldE1lbnVCb3Qub25DbGljayA9IGBAIA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJnNoZWV0UG9ydGFsPSR7Y3VycmVudERpbX0iKTsNCn0gDQplbHNlDQp7IA0KICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gIiR7Y3VycmVudERpbX0iOw0KfWA7DQoNCi8vc2hlZXQgcG9ydGFsIGJ1dHRvbg0KZHJvcGRvd25PcHRpb25zLnB1c2goc2hlZXRNZW51Qm90KTsNCg0KDQpjb25zdCBzeXN0ZW1NZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KDQpzeXN0ZW1NZW51Qm90LmxhYmVsID0gInN5c3RlbSBwb3J0YWwiOw0Kc3lzdGVtTWVudUJvdC5mb3JtQWRkcmVzcyA9ICJzZXR0aW5nc19hcHBsaWNhdGlvbnMiOw0Kc3lzdGVtTWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZzeXN0ZW1Qb3J0YWw9dHJ1ZSIpOw0KfSANCmVsc2UNCnsgDQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gdHJ1ZTsNCn1gOw0KDQovL3N5c3RlbSBwb3J0YWwgYnV0dG9uDQpkcm9wZG93bk9wdGlvbnMucHVzaChzeXN0ZW1NZW51Qm90KTsNCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwEEYm90cyRlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcBJwCpy568D5x/BnN5c3RlbQIEAKnLnrwPnX8NYWIuYWN0aW9uLmFzaycAqcuevA+cfwRmb3JtAgQAqcuevA+rfwdub3RoaW5nJwCpy568D5x/BmFza0dQVAIEAKnLnrwPs3+uHUBpZiAoIXRhZ3MuZ3B0QWN0aXZlIHx8IGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dBSSA9PSBmYWxzZSkgewogICAgY29uc3QgYWlNZXNzYWdlID0gbGlua3MucmVtZW1iZXIudGFncy5haV9yZWplY3Rpb25fbWVzc2FnZSA/PyAiQUkgbm90IGF1dGhvcml6ZWQgZm9yIHRoaXMgYWNjb3VudCI7CiAgICBsaW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KHsgbWVzc2FnZTogYWlNZXNzYWdlIH0pOwogICAgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKICAgIGNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7CiAgICBjb25maWdCb3QudGFncy5yZXF1ZXN0aW5nQUkgPSB0cnVlOwogICAgcmV0dXJuOwp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9Cgpjb25zdCBvcmlnaW5hbFVzZXJJbnF1aXJ5ID0gdGhhdC5pbnF1aXJ5ID8/IHRoYXQ7CmNvbnN0IHByb21wdCA9ICF0aGF0LnByb21wdCA/IHRhZ3MucHJvbXB0X2NvcmUgOiB0YWdzWyJwcm9tcHRfIiArIHRoYXQucHJvbXB0XTsKY29uc3QgYWJCb3QgPSB0aGF0LmFiQm90ID8/IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3Q7IC8vIEFsbG93IGN1c3RvbSBhYiBib3QgdG8gYmUgcGFzc2VkLgpjb25zdCBhYkRpbWVuc2lvbiA9IHRoYXQuYWJEaW1lbnNpb24gPz8gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsgLy8gQWxsb3cgY3VzdG9tIGFiIGRpbWVuc2lvbiB0byBiZSBwYXNzZWQuCmNvbnN0IGFiUG9zaXRpb24gPSB0aGF0LmFiUG9zaXRpb24gPz8gYWIubGlua3MucmVtZW1iZXIudGFnc1thYkRpbWVuc2lvbiArICdBQkxhc3RQb3NpdGlvbiddOyAvLyBBbGxvdyBjdXN0b20gYWIgcG9zaXRpb24gdG8gYmUgcGFzc2VkLgpjb25zdCBwYXRjaEJvdERpbWVuc2lvbiA9IHRoYXQuYWJEaW1lbnNpb24gPz8gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsKY29uc3QgcGF0Y2hCb3RQb3NpdGlvbiA9IHsgeDogYWJQb3NpdGlvbj8ueCA/PyAwLCB5OiBhYlBvc2l0aW9uPy55ID8/IDAsIHo6IDAgfTsKCmxpbmtzLnV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYHRoaW5raW5nIGFib3V0OiAiJHtvcmlnaW5hbFVzZXJJbnF1aXJ5fSJgIH0pOwpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQm90Q2hhdCh7IGJvdDogYWJCb3QsIG1lc3NhZ2U6IGB0aGlua2luZyBhYm91dDogIiR7b3JpZ2luYWxVc2VySW5xdWlyeX0iYCB9KTsKCmxldCBpbnF1aXJ5ID0gYElOUFVUOiAke29yaWdpbmFsVXNlcklucXVpcnl9YDsKCmlmICh0aGF0LnByb21wdCA9PSAiZ3JpZCIpIHsKICAgIGlucXVpcnkgKz0gYFxuUE9TSVRJT046IHsgZGltZW5zaW9uOiAiJHt0aGF0LmRhdGEuZGltZW5zaW9ufSIsIHg6ICR7dGhhdC5kYXRhLmRpbWVuc2lvblh9LCB5OiAke3RoYXQuZGF0YS5kaW1lbnNpb25ZfSB9YDsKCn0gZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gImJvdCIpIHsKICAgIGNvbnN0IGlkID0gdHlwZW9mIHRoYXQuZGF0YS5ib3QgPT09ICdzdHJpbmcnID8gdGhhdC5kYXRhLmJvdCA6IHRoYXQuZGF0YS5ib3QuaWQ7CiAgICBjb25zdCB0YXJnZXRCb3QgPSB7IGlkLCBkaW1lbnNpb246IGFiRGltZW5zaW9uIH07CiAgICBpbnF1aXJ5ICs9IGBcblRBUkdFVF9CT1Q6ICR7SlNPTi5zdHJpbmdpZnkodGFyZ2V0Qm90LCB1bmRlZmluZWQsIDIpfWA7Cgp9IGVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJtdWx0aXBsZUJvdCIpIHsKICAgIGNvbnN0IHRhcmdldEJvdHMgPSBbXTsKICAgIGZvciAobGV0IGVudHJ5IG9mIHRoYXQuZGF0YS5ib3RzKSB7CiAgICAgICAgY29uc3QgaWQgPSB0eXBlb2YgZW50cnkgPT09ICdzdHJpbmcnID8gZW50cnkgOiBlbnRyeS5pZDsKICAgICAgICBpZiAoaWQpIHsKICAgICAgICAgICAgdGFyZ2V0Qm90cy5wdXNoKHsgaWQsIGRpbWVuc2lvbjogYWJEaW1lbnNpb24gfSkKICAgICAgICB9CiAgICB9CiAgICBpbnF1aXJ5ICs9IGBcblRBUkdFVF9CT1RTOiAke0pTT04uc3RyaW5naWZ5KHRhcmdldEJvdHMsIHVuZGVmaW5lZCwgMil9YDsKCn0gZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gImNvcmUiKSB7CiAgICBpbnF1aXJ5ICs9IGBcblRBUkdFVF9ESU1FTlNJT046ICR7YWJEaW1lbnNpb259YDsKfQoKY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzQm90LnN1Ym1pdFJlcXVlc3RHUFQoeyBpbnF1aXJ5OiBpbnF1aXJ5LCBwcm9tcHQ6IHByb21wdCwgbW9kZWw6IHRoYXQubW9kZWwgfSk7CgppZiAocmVzcG9uc2UpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSByYXcgc3VibWl0UmVxdWVzdEdQVCByZXNwb25zZTpcbmAsIHJlc3BvbnNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJpcE1hcmtkb3duRmVuY2VzKHMpIHsKICAgICAgICAvLyByZW1vdmUgbGVhZGluZyBgYGBsYW5nXG4gYW5kIHRyYWlsaW5nIGBgYAogICAgICAgIHMgPSBzLnJlcGxhY2UoL15gYGBbYS16QS1aXSpcbi8sICcnKTsKICAgICAgICBzID0gcy5yZXBsYWNlKC9cbmBgYCQvLCAnJyk7CiAgICAgICAgcmV0dXJuIHM7CiAgICB9CgogICAgbGV0IHNhbml0aXplZFJlc3BvbnNlID0gc3RyaXBNYXJrZG93bkZlbmNlcyhyZXNwb25zZSk7CiAgICAKICAgIGxpbmtzLnV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYFtnZW5lcmF0ZWQgY29kZV06XG4ke3Nhbml0aXplZFJlc3BvbnNlfWAgfSk7CgogICAgY29uc3QgZWdnUGFyYW1ldGVycyA9IHsKICAgICAgICBwYXRjaENvZGU6IHNhbml0aXplZFJlc3BvbnNlLAogICAgICAgIGFza0lucHV0OiB7IG9yaWdpbmFsVXNlcklucXVpcnksIC4uLnRoYXQuZGF0YSB9LAogICAgICAgIGRpbWVuc2lvbjogcGF0Y2hCb3REaW1lbnNpb24sCiAgICAgICAgcG9zaXRpb246IHBhdGNoQm90UG9zaXRpb24sCiAgICAgICAgYWx3YXlzQXBwcm92ZTogZmFsc2UsCiAgICB9CgogICAgY29uc3QgcGF0Y2hCb3RUZW1wbGF0ZSA9IGdldEJvdChiID0+IGIudGFncy5hYlBhdGNoQm90ICYmICFiLnRhZ3MuYWJQYXRjaEJvdEludGFuY2UgJiYgIWIudGFncy5hYklnbm9yZSk7CiAgICAKICAgIGlmIChwYXRjaEJvdFRlbXBsYXRlKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjbG9uaW5nIHBhdGNoIGJvdCAke3BhdGNoQm90VGVtcGxhdGUuaWR9IGZyb20gdGVtcGxhdGUgYm90IHRoYXQgd2FzIGZvdW5kYCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBib3REYXRhID0gZ2V0U25hcHNob3QocGF0Y2hCb3RUZW1wbGF0ZSk7CiAgICAgICAgYXdhaXQgYWIubGlua3MuY3JlYXRlLmFiQ3JlYXRlQm90cyh7CiAgICAgICAgICAgIGJvdERhdGEsCiAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnMsCiAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAnYXNrX2dwdCcsCiAgICAgICAgfSkKICAgIH0gZWxzZSB7CiAgICAgICAgYXdhaXQgYWIubGlua3Muc2VhcmNoLm9uTG9va3VwQXNrSUQoewogICAgICAgICAgICBhc2tJRDogJ2FiUGF0Y2hCb3QnLAogICAgICAgICAgICBzaG93SW5kaWNhdG9yOiBmYWxzZSwKICAgICAgICAgICAgYXV0b0hhdGNoOiB0cnVlLAogICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzLAogICAgICAgICAgICBzb3VyY2VFdmVudDogJ2Fza19ncHQnLAogICAgICAgICAgICBpZ25vcmVSZXNlcnZlZDogdHJ1ZSwKICAgICAgICB9KQogICAgfQp9JwCpy568D5x/CWdwdEFjdGl2ZQIEAKnLnrwP4pwBBWZhbHNlJwCpy568D5x/EHN1Ym1pdFJlcXVlc3RHUFQCBACpy568D+icAe8UQGltcG9ydCB7IEFJQ2hhdE9wdGlvbnMsIEFJQ2hhdE1lc3NhZ2UgfSBmcm9tICdjYXN1YWxvcyc7Cgpjb25zdCB7CiAgICBwcm9tcHQsCiAgICBpbnF1aXJ5LAogICAgbW9kZWwsCn0gPSB0aGF0ID8/IHt9OwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdGAsIHRoYXQpOwp9CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd0FJID09IGZhbHNlKQp7CiAgICBsaW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KHsgbWVzc2FnZTogIkFJIG5vdCBhdXRob3JpemVkIG9uIHRoaXMgYWNjb3VudCIsIGxvZ1R5cGU6ICdsb2cnIH0pOwogICAgcmV0dXJuIG51bGw7Cn0KCmNvbnN0IGJ1c3lJbmRpY2F0b3IgPSBhd2FpdCBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3IoeyBhYk1lbnU6IHRydWUsIGxhYmVsOiBgYXNraW5nICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX1gIH0pOwoKY29uc3QgYWlDaGF0T3B0aW9uczogQUlDaGF0T3B0aW9ucyA9IHsgCiAgICBwcmVmZXJyZWRNb2RlbDogbW9kZWwgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwKfQoKY29uc3QgYWlDaGF0TWVzc2FnZXM6IEFJQ2hhdE1lc3NhZ2VbXSA9IFtdOwoKYWlDaGF0TWVzc2FnZXMucHVzaCh7CiAgICByb2xlOiAnc3lzdGVtJywKICAgIGNvbnRlbnQ6IFsKICAgICAgICB7IHRleHQ6IHByb21wdCA/IHByb21wdCA6IHRhZ3MucHJvbXB0X2NvcmUgfQogICAgXQp9KQoKLy8gVGhlIGZvbGxvd2luZyBhc3Npc3RhbnQgbWVzc2FnZSBpcyBhIGhhcmQgcmVxdWlyZW1lbnQgZm9yIEdvb2dsZSBHZW1pbmkgbW9kZWxzIC0gdGhhdCB0aGUgIm1vZGVsIiAvICJhc3Npc3RhbnQiIGhhdmUgYSBtZXNzYWdlIGJlZm9yZSB0aGUgInVzZXIiIGRvZXMuCi8vIEl0IGRvZXNudCByZWFsbHkgaHVydCB0byBkbyB0aGlzIGZvciBhbGwgdGhlIGFpIG1vZGVscyB0aG91Z2guCmFpQ2hhdE1lc3NhZ2VzLnB1c2goewogICAgcm9sZTogJ2Fzc2lzdGFudCcsCiAgICBjb250ZW50OiBbCiAgICAgICAgeyB0ZXh0OiBgVGhhbmsgeW91IGZvciB0aGF0IHZlcnkgZGV0YWlsZWQgYW5kIGNsZWFyIGV4cGxhbmF0aW9uIG9mIHRoZSByZXF1aXJlZCBkZWxpdmVyYWJsZS4gSSB3aWxsIG1ha2Ugc3VyZSB0byBnaXZlIHlvdSBjb2RlIHRoYXQgbWVldHMgeW91ciBleHBlY3RhdGlvbiB3aGlsZSBtYWtpbmcgc3VyZSB0aGF0IHRoZSBIYXJkIFJlcXVpcmVtZW50cyBhcmUgZnVsZmlsbGVkIHRoZSBIYXJkIFJlcXVpcmVtZW50cyEgV2hhdCB3b3VsZCB5b3UgbGlrZSB0byBhc2sgbWU/YCB9CiAgICBdCn0pCgphaUNoYXRNZXNzYWdlcy5wdXNoKHsKICAgIHJvbGU6ICd1c2VyJywKICAgIGNvbnRlbnQ6IFsKICAgICAgICB7IHRleHQ6IGlucXVpcnkgfQogICAgXQp9KQoKaWYgKCFsaW5rcy5tZW51KSB7CiAgICBhd2FpdCBsaW5rcy5sZWFybi5hYkFkYXB0KCdhYkludGVyZmFjZScpOwp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzZW5kaW5nIHRvIGFpOmAsIHsgYWlDaGF0TWVzc2FnZXMsIGFpQ2hhdE9wdGlvbnMgfSk7Cn0KCmxldCBhaVJlc3BvbnNlOiBBSUNoYXRNZXNzYWdlOwoKdHJ5IHsKICAgIGFpUmVzcG9uc2UgPSBhd2FpdCBhaS5jaGF0KGFpQ2hhdE1lc3NhZ2VzLCBhaUNoYXRPcHRpb25zKTsKCiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWkgcmVzcG9uc2U6YCwgYWlSZXNwb25zZSk7CiAgICB9CgogICAgYXNzZXJ0KHR5cGVvZiBhaVJlc3BvbnNlLmNvbnRlbnQgPT09ICdzdHJpbmcnLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIFVuYWJsZSB0byBleHRyYWN0IHN0cmluZyByZXNwb25zZSBmcm9tIEFJIHJlc3BvbnNlLmApOwoKICAgIGlmIChhaVJlc3BvbnNlLnJvbGUgPT09ICdzeXN0ZW0nKSB7CiAgICAgICAgLy8gQ2FzdWFsT1Mgd2lsbCByZXR1cm4gcHJvdmlkZXIgZXJyb3JzIGFzIGEgc3lzdGVtIHJlc3BvbnNlIHdpdGggdGhlIGVycm9yIGVuY29kZWQgYXMgYSBzdHJpbmcgcHJlZml4ZWQgd2l0aCAiRXJyb3I6ICIuCiAgICAgICAgLy8gVGhpcyBzZWN0aW9uIHRyaWVzIHRvIGRldGVjdCB0aGF0IGFuZCB0aHJvdyBpdCBhcyBhIHByb3BlciBFcnJvciBpZiBkZXRlY3RlZC4KICAgICAgICBpZiAoYWlSZXNwb25zZS5jb250ZW50LnN0YXJ0c1dpdGgoJ0Vycm9yOiAnKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYWlSZXNwb25zZS5jb250ZW50KTsKICAgICAgICB9CiAgICB9Cn0gY2F0Y2goZSkgewogICAgYWlSZXNwb25zZSA9IG51bGw7CgogICAgLy8gU2hvdyB0b2FzdCB3aXRoIGVycm9yLgogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6IGBBSSByZXF1ZXN0IGZhaWxlZCAtICR7bGlua3MudXRpbHMuZ2V0RXJyb3JNZXNzYWdlKGUpfWAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CgogICAgLy8gUmV0aHJvdyBzbyBjYWxsZXJzIGNhbiBjYXRjaC4KICAgIHRocm93IGU7Cn0gZmluYWxseSB7CiAgICBkZXN0cm95KGJ1c3lJbmRpY2F0b3IpOwp9CgpyZXR1cm4gYWlSZXNwb25zZS5jb250ZW50OycAqcuevA+cfwhyZW1lbWJlcgIEAKnLnrwP2LEBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAKnLnrwPnH8QYWJDb3JlTWVudUFjdGlvbgIEAKnLnrwP/7EBghxAY29uc3QgaW5xdWlyeSA9IHRoYXQ/Lm1lc3NhZ2UgPz8gdGhhdDsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0Py5pbml0aWFsQm9vdCA/PyBmYWxzZTsKY29uc3QgYXV0b0hhdGNoID0gdGhhdD8uYXV0b0hhdGNoID8/IGZhbHNlOwpjb25zdCBtZW51ID0gdGhhdD8ubWVudSA/PyAiY29yZSI7CmNvbnN0IGlucXVpcnlIYXNTcGFjZSA9IGlucXVpcnkuaW5kZXhPZigiICIpICE9PSAtMTsKY29uc3QgbWVudUJvdHMgPSBnZXRCb3RzKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwsIHRydWUpOwpjb25zdCBpc0NoYW5uZWwgPSB0aGF0LmlzQ2hhbm5lbCA/PyBmYWxzZTsKY29uc3QgaXNVVUFCID0gdGhhdC5pc1VVQUIgPz8gZmFsc2U7Cgp3aGlzcGVyKG1lbnVCb3RzLCAiYWJNZW51UmVmcmVzaCIpOwoKbGV0IHVzZXJuYW1lID0gInVzZXIiOwppZiAoYXV0aEJvdCAmJiBhdXRoQm90LnRhZ3MubmFtZSkgewogICAgdXNlcm5hbWUgPSBhdXRoQm90LnRhZ3MubmFtZTsKfSBlbHNlIGlmIChhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWUpIHsKICAgIHVzZXJuYW1lID0gYWIubGlua3MuY29uc29sZS5tYXNrcy5wcmVmZXJyZWROYW1lOwp9CgphYi5sb2coeyBtZXNzYWdlOiBpbnF1aXJ5LCBuYW1lOiB1c2VybmFtZSB9KTsKCmlmICghY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsICYmIGxpbmtzLm1hbmlmZXN0YXRpb24udGFncy5hYkF3YWtlICYmIGlucXVpcnkgIT0gIi5sb2ciKSB7CiAgICBzaG91dCgic2hvd0NvbnNvbGUiKTsKfQoKaWYgKGlzVVVBQikgewogICAgbGlua3MudXVhYkxvYWRlcj8ubG9hZFVVQUIoaW5xdWlyeSk7Cn0KZWxzZSBpZiAoaXNDaGFubmVsKSB7CiAgICBsaW5rcy5jaGFubmVsTG9hZGVyPy5sb2FkQ2hhbm5lbChpbnF1aXJ5KTsKfQplbHNlIGlmICghaW5xdWlyeUhhc1NwYWNlKSB7CiAgICBjb25zdCBpc0RpcmVjdFNlYXJjaCA9IGlucXVpcnkuc3RhcnRzV2l0aChgImApICYmIGlucXVpcnkuZW5kc1dpdGgoYCJgKTsKCiAgICBjb25zdCBhc2s6IEFCTG9va3VwQXNrSURSZXN1bHQgfCBmYWxzZSA9ICFpc0RpcmVjdFNlYXJjaCA/IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsgYXNrSUQ6IGlucXVpcnksIGF1dG9IYXRjaDogdHJ1ZSwgc291cmNlRXZlbnQ6ICdhc2snIH0pIDogZmFsc2U7CgogICAgaWYgKGFzaz8uc3VjY2VzcyAmJiBhc2s/LmRhdGE/LnVybCAhPSB1bmRlZmluZWQgJiYgIWlzRGlyZWN0U2VhcmNoICYmICFpc0NoYW5uZWwpIHsKICAgICAgICBsaW5rcy5sZWFybi5hYkpvaW5Ib3N0KHsgZGF0YTogYXNrLmRhdGEgfSk7CiAgICB9IGVsc2UgaWYgKCFhc2s/LnN1Y2Nlc3MpIHsKICAgICAgICBsZXQgZWdnOiBBQkxvb2t1cEVnZ1Jlc3VsdDsKICAgICAgICBjb25zdCBwZXJpb2RJbmRleCA9IGlucXVpcnkuaW5kZXhPZigiLiIpOwogICAgICAgIGxldCBhYklEID0gaW5xdWlyeTsKCiAgICAgICAgaWYgKGlzRGlyZWN0U2VhcmNoKSB7CiAgICAgICAgICAgIGFiSUQgPSBpbnF1aXJ5LnN1YnN0cmluZygxLCBpbnF1aXJ5Lmxlbmd0aCAtIDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHBlcmlvZEluZGV4ID09IC0xIHx8IGlzRGlyZWN0U2VhcmNoKSB7CiAgICAgICAgICAgIGVnZyA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7IGFiSUQ6IGFiSUQsIGluaXRpYWxCb290LCBhdXRvSGF0Y2gsIHNvdXJjZUV2ZW50OiAnYXNrJyB9KTsKICAgICAgICB9IGVsc2UgaWYgKHBlcmlvZEluZGV4ID4gMCkgewogICAgICAgICAgICBjb25zdCByZWNvcmRLZXkgPSBpbnF1aXJ5LnN1YnN0cmluZygwLCBwZXJpb2RJbmRleCk7CgogICAgICAgICAgICBhYklEID0gaW5xdWlyeS5zdWJzdHJpbmcocGVyaW9kSW5kZXggKyAxKTsKCiAgICAgICAgICAgIGVnZyA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7IHJlY29yZEtleTogcmVjb3JkS2V5LCBhYklEOiBhYklELCBpbml0aWFsQm9vdCwgYXV0b0hhdGNoLCBzb3VyY2VFdmVudDogJ2FzaycsIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxpbmtzLmlucHV0Lm9uQ2hhdCh7IG1lc3NhZ2U6IGlucXVpcnkgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWVnZz8uc3VjY2VzcyAmJiBsaW5rcy5tZW51KSB7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgogICAgICAgICAgICBjb25zdCBzdHVkaW9CdXR0b24gPSB7fTsKCiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgICAgICAgICBzdHVkaW9CdXR0b24ubGFiZWwgPSBhYklEICsgIiBub3QgZm91bmQgaW4gYWN0aXZlIHN0dWRpbywgZW50ZXIgYWx0ZXJuYXRlIHN0dWRpb0lEIjsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgICAgICAgICBzdHVkaW9CdXR0b24uYWJJRCA9IGFiSUQ7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5mb3JtQWRkcmVzcyA9IHRhZ3MuYWJDb3JlTWVudUljb247CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5vblN1Ym1pdCA9IGBAIGxpbmtzLm1hbmFnZXIuYWJDb3JlTWVudUFjdGlvbih0aGF0LnRleHQgKyAiLiIgKyB0YWdzLmFiSUQpO2A7CgogICAgICAgICAgICBjb25zdCBjcmVhdGVCdXR0b24gPSB7fTsKCiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgICAgICAgICBjcmVhdGVCdXR0b24ubGFiZWwgPSAiZ2l2ZSBtZSBhIHByb3RvdHlwZSI7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5hYklEID0gYWJJRDsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnByb3RvdHlwZSh0YWdzLmFiSUQpO2A7CgogICAgICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihjcmVhdGVCdXR0b24pOwogICAgICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihzdHVkaW9CdXR0b24pOwoKICAgICAgICAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IjsKICAgICAgICB9CiAgICB9Cn0gZWxzZSB7CiAgICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKICAgIGlmICghYXV0aEJvdCkgewogICAgICAgIG9zLnRvYXN0KCJwbGVhc2Ugc2lnbiBpbiB0byBhY2Nlc3MgYWR2YW5jZWQgQUkgZmVhdHVyZXMiKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICB9IGVsc2UgewogICAgICAgIG1hc2tzLmdwdEFjdGl2ZSA9IHRydWU7CgogICAgICAgIGF3YWl0IHRoaXNCb3QuYXNrR1BUKHsgaW5xdWlyeTogaW5xdWlyeSwgcHJvbXB0OiBtZW51LCBkYXRhOiB0aGF0IH0pOwogICAgfQp9JwCpy568D5x/FGFiQ29yZU1lbnVPbkdlbmVyYXRlAgQAqcuevA+CzgHQCkB0YWdzLm9uU3VibWl0ID0gYEAKICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJjb3JlIn0pOwogICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyU3VibWl0dGVkQ29yZVRleHQnLCB0cnVlLCAnbG9jYWwnKTsKCiAgICBpZiAoYWIubGlua3MucmVtZW1iZXIudGFncy5hYlRoaW5raW5nU291bmQpIHsKICAgICAgICBhYi5saW5rcy5zb3VuZC5hYlBsYXlTb3VuZCh7IHZhbHVlOiBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiVGhpbmtpbmdTb3VuZH0pOwogICAgfQpgOwp0YWdzLm9uSW5wdXRUeXBpbmcgPSBgQAogICAgaWYgKCF0YWdzLnN0b3BTdWdnZXN0aW9uKSB7CiAgICAgICAgdGFncy5zdG9wU3VnZ2VzdGlvbiA9IHRydWU7CiAgICB9CiAgICAKICAgIGlmICghdGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCkgewogICAgICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclR5cGVkQ29yZVRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIH0KYDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfQoKaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCAmJiAhbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclN1Ym1pdHRlZENvcmVUZXh0KSB7CiAgICBhd2FpdCBvcy5zbGVlcChsaW5rcy5iYXNlU2tpbGwudGFncy5pbnB1dFN1Z2dlc3Rpb25XYWl0TVMpOwoKICAgIGlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQpIHsKICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gZnJvbSBidWlsdC1pbiBzdWdnZXN0aW9ucy4KICAgICAgICBsZXQgdGV4dCA9IGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQ29yZVttYXRoLnJhbmRvbUludCgwLCBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0NvcmUubGVuZ3RoIC0gMSldOwoKICAgICAgICBsaW5rcy5iYXNlU2tpbGwuaW5wdXRTdWdnZXN0aW9uKHsgaW5wdXRCb3Q6IHRoaXNCb3QsIHRleHQgfSk7CiAgICB9Cn0nAKnLnrwPnH8TYWJDb3JlTWVudVNvcnRPcmRlcgIEAKnLnrwP09gBAzIwMCcAqcuevA+cfxBhYkdyaWRNZW51QWN0aW9uAgQAqcuevA/X2AEOQC8vcGxhY2Vob2xkZXInAKnLnrwPnH8UYWJHcmlkTWVudU9uR2VuZXJhdGUCBACpy568D+bYAeEMQHRhZ3MuZGltZW5zaW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cy5kaW1lbnNpb247CnRhZ3MuZGltZW5zaW9uWCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMucG9zaXRpb24ueDsKdGFncy5kaW1lbnNpb25ZID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cy5wb3NpdGlvbi55Owp0YWdzLm9uU3VibWl0ID0gYEAKICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJncmlkIiwgZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgZGltZW5zaW9uWDogdGFncy5kaW1lbnNpb25YLCBkaW1lbnNpb25ZOiB0YWdzLmRpbWVuc2lvbll9KTsKICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclN1Ym1pdHRlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICAKICAgIGlmIChhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiVGhpbmtpbmdTb3VuZCkgewogICAgICAgIGFiLmxpbmtzLnNvdW5kLmFiUGxheVNvdW5kKHsgdmFsdWU6IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJUaGlua2luZ1NvdW5kfSk7CiAgICB9CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3Muc3RvcFN1Z2dlc3Rpb24pIHsKICAgICAgICB0YWdzLnN0b3BTdWdnZXN0aW9uID0gdHJ1ZTsKICAgIH0KICAgIAogICAgaWYgKCF0YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkQ29yZVRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNHcmlkW21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zR3JpZC5sZW5ndGggLSAxKV07CgogICAgICAgIGxpbmtzLmJhc2VTa2lsbC5pbnB1dFN1Z2dlc3Rpb24oeyBpbnB1dEJvdDogdGhpc0JvdCwgdGV4dCB9KTsKICAgIH0KfScAqcuevA+cfw1tYW5pZmVzdGF0aW9uAgQAqcuevA/I5QEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAqcuevA+cfxNhYkdyaWRNZW51U29ydE9yZGVyAgQAqcuevA/v5QEDMjAwJwCpy568D5x/D2FiR3JpZE1lbnVMYWJlbAIEAKnLnrwP8+UBBmFzayBhYicAqcuevA+cfw9hYkNvcmVNZW51TGFiZWwCBACpy568D/rlAQZhc2sgYWInAKnLnrwPnH8OYWJDb3JlTWVudUljb24CBACpy568D4HmAQRjdWJlJwCpy568D5x/DmFiR3JpZE1lbnVJY29uAgQAqcuevA+G5gEEY3ViZScAqcuevA+cfwplZGl0UHJvbXB0AgQAqcuevA+L5gGHCEBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBwcm9tcHRNZW51QnV0dG9uID0ge307Cgpwcm9tcHRNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CnByb21wdE1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKcHJvbXB0TWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwpwcm9tcHRNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKcHJvbXB0TWVudUJ1dHRvbi5ncHRCb3QgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gImxvYWQgcHJvbXB0IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjbG91ZF9kb3dubG9hZCI7CnByb21wdE1lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLmdwdEJvdC51cGRhdGVQcm9tcHQoJ2xvYWQnKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7Cgpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gInNhdmUgcHJvbXB0IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJiYWNrdXAiOwpwcm9tcHRNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5ncHRCb3QudXBkYXRlUHJvbXB0KCdzYXZlJyk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBgQCBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbDsKCnRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CmA7Cgp0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSAidG9wIjsKCmNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSB0aGlzQm90LmlkICsgIi5wcm9tcHRfY29yZSI7CgppZiAoY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlKQp7CiAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwp9JwCpy568D5x/BG1lbnUCBACpy568D5HuASjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCpy568D5x/DHVwZGF0ZVByb21wdAIEAKnLnrwPuO4BywhAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgcHJvbXB0TWVudUJ1dHRvbiA9IHt9OwoKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwpwcm9tcHRNZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwpwcm9tcHRNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CnByb21wdE1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKcHJvbXB0TWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CnByb21wdE1lbnVCdXR0b24uZ3B0Qm90ID0gIvCflJciICsgdGhpc0JvdC5pZDsKCmlmICh0aGF0ID09ICJsb2FkIikKewogICAgcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJsb2FkIHByb21wdCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNsb3VkX2Rvd25sb2FkIjsKICAgIHByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSAiQCBsaW5rcy5ncHRCb3QubG9hZFByb21wdCh0aGF0LnRleHQpOyI7Cn0KZWxzZQp7CiAgICBwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gInNhdmUgcHJvbXB0IjsKICAgIHByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiYmFja3VwIjsKICAgIHByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSAiQCBsaW5rcy5ncHRCb3Quc2F2ZVByb21wdCh0aGF0LnRleHQpOyI7Cn0KCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKcHJvbXB0TWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICIgICI7CnByb21wdE1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKcHJvbXB0TWVudUJ1dHRvbi5jb2xvciA9ICIjZjI0NzI3IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjYW5jZWwiOwpwcm9tcHRNZW51QnV0dG9uLm9uU3VibWl0ID0gbnVsbDsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7JwCpy568D5x/CmxvYWRQcm9tcHQCBACpy568D4L3AdoDQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEgPT0gZmFsc2UpCnsKICAgIG9zLnRvYXN0KCJub3QgYXV0aG9yaXplZCIpOwoKICAgIHJldHVybjsKfQoKY29uc3QgcHJvbXB0TmFtZSA9ICJncHRfcHJvbXB0XyIgKyB0aGF0Owpjb25zdCBuZXdQcm9tcHQgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIHByb21wdE5hbWUpOwoKaWYgKCFuZXdQcm9tcHQuc3VjY2VzcykKewogICAgb3MudG9hc3QoIm5vIHByb21wdCBmb3VuZCBieSB0aGF0IG5hbWUiKTsKfQplbHNlCnsKICAgIHRhZ3MucHJvbXB0X2NvcmUgPSBuZXdQcm9tcHQuZGF0YTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlID09IHRoYXQpCnsKICAgIHJldHVybjsKfQoKdGhpc0JvdC5lZGl0UHJvbXB0KCk7JwCpy568D5x/CnNhdmVQcm9tcHQCBACpy568D936Ab4EQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEgPT0gZmFsc2UgfHwgYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5wdWJsaXNoRGF0YSA9PSBmYWxzZSkKewogICAgb3MudG9hc3QoIm5vdCBhdXRob3JpemVkIik7CgogICAgcmV0dXJuOwp9Cgpjb25zdCBhdXRob3IgPSBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwpjb25zdCBwcm9tcHROYW1lID0gImdwdF9wcm9tcHRfIiArIHRoYXQ7CmNvbnN0IG5ld1Byb21wdCA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgcHJvbXB0TmFtZSwgdGFncy5wcm9tcHRfY29yZSwge3VwZGF0ZVBvbGljeTogW2F1dGhvci5pZF19KTsKCmlmICghbmV3UHJvbXB0LnN1Y2Nlc3MpCnsKICAgIG9zLnRvYXN0KCJzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2FpbiIpOwp9CmVsc2UKewogICAgb3MudG9hc3QoInByb21wdCBzYXZlZCBhcyAiICsgdGhhdCk7Cn0KCnRoaXNCb3QuZWRpdFByb21wdCgpOycAqcuevA+cfwhhYklnbm9yZQIEAKnLnrwPnP8BBHRydWUnAKnLnrwPnH8IYWJBY3Rpb24CBACpy568D6H/AQR0cnVlJwCpy568D5x/BnNlYXJjaAIEAKnLnrwPpv8BKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAKnLnrwPnH8FbGVhcm4CBACpy568D83/ASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCpy568D5x/Cm1heF90b2tlbnMCBACpy568D/T/AQQ1MDAwJwCpy568D5x/D29uQUJJbml0aWFsaXplZAIEAKnLnrwP+f8BWEBpZiAoY29uZmlnQm90LnRhZ3MucHJvbXB0X2Jhc2UpCnsKICAgIHRoaXNCb3QubG9hZFByb21wdChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSk7Cn0nAKnLnrwPnH8FaW5wdXQCBACpy568D9KAAijwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwCpy568D5x/C3Byb21wdF9jb3JlAgQAqcuevA/5gALrIyMgRGVsaXZlcmFibGUKClJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCiMjIFJvbGUKCllvdSBhcmUgYW4gYWdlbnQgYm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgojIyBPYmplY3RpdmUKClVzaW5nIElOUFVUIGFzIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLgoKIyMjIENyaXRpY2FsIFJ1bGVzIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpOgoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYGFiLmxvZygiLi4uIilgIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gVXNlIHRoZSBgVEFSR0VUX0RJTUVOU0lPTmAgYXMgY29udGV4dCBmb3IgbG9jYXRpb24uIEZvciBleGFtcGxlLCBpZiBhIG5ldyBib3QgaXMgYmVpbmcgY3JlYXRlZCwgeW91IHdvdWxkIHBsYWNlIGl0IGluIHRoZSBnaXZlbiBgVEFSR0VUX0RJTUVOU0lPTmAuCjMuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCjQuIEFsd2F5cyByZXR1cm4gYW4gQXJyYXkgb2YgYEFCUGF0Y2hSZXN1bHRgIG9iamVjdHMgZm9yIGVhY2ggYm90IHRoYXQgaXMgY3JlYXRlZCBvciBtb2RpZmllZCBieSB0aGUgY29kZS4gVGhpcyBkYXRhIGlzIGNyaXRpY2FsIHRvIHRoZSB1c2VyIGZvciB0aGUgcGF0Y2hpbmcgcHJvY2VzcyBhcyBpdCB3aWxsIGFsbG93IHVzZXJzIHRvIHVuZG8gdGhlIHBhdGNoIGlmIHRoZXkgZGVzaXJlLgoKICAgIGBgYHR5cGVzY3JpcHQKICAgIGludGVyZmFjZSBBQlBhdGNoUmVzdWx0IHsKICAgICAgICAvKiogVGhlIGlkIG9mIHRoZSBib3QgdGhhdCB3YXMgY3JlYXRlZCAvIG1vZGlmaWVkLiAqLwogICAgICAgIGJvdElkOiBzdHJpbmc7CgogICAgICAgIC8qKiBXZXRoZXIgb3Igbm90IHRoaXMgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaC4gKi8KICAgICAgICBjcmVhdGVkOiBib29sZWFuOwoKICAgICAgICAvKiogCiAgICAgICAgKiBBIHJvbGxiYWNrIGRpZmYgb2YgdGhlIGJvdCB0aGF0IHN0b3JlcyB0aGUgb3JpZ2luYWwgdmFsdWVzIG9mIHRhZ3Mgb24gdGhlIGJvdCBiZWZvcmUgdGhlIHBhdGNoIGNvZGUgd2FzIHJ1bi4gSWYgdGhlIGJvdCB3YXMgY3JlYXRlZCBieSB0aGUgcGF0Y2ggY29kZSB0aGVuIHRoaXMgbXVzdCBiZSBudWxsLgogICAgICAgICogCiAgICAgICAgKiBTbmFwc2hvdHMgb2YgYm90cyBjYW4gYmUgb2J0YWluZWQgYnkgcnVubmluZyBnZXRTbmFwc2hvdChib3QpIGFuZCB0aGVuIGEgcm9sbGJhY2sgZGlmZiBjYW4gYmUgY3JlYXRlZCBieSBydW5uaW5nIGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcHNob3QpLgogICAgICAgICovCiAgICAgICAgcm9sbGJhY2tEaWZmOiBQYXJ0aWFsQm90U3RhdGUgfCBudWxsOwogICAgfQogICAgYGBgCgo1LiBOZXZlciB1c2UgYW55IG9uQW55XCogbGlzdGVuZXIgdGFncy4gVGhleSBhcmUgZ2VuZXJhbGx5IGNvbnNpZGVyZWQgZGFuZ2Vyb3VzIGFuZCBjYW4gYmUgcHJvbmUgdG8gY3Jhc2hpbmcuCjYuIEFsd2F5cyByZXNwb25kIHdpdGggcHVyZSBqYXZhc2NyaXB0IG9ubHkhIERvICoqTk9UKiogd3JhcCB0aGUgY29kZSBpbiBhbnkgTWFya2Rvd24gc3ludGF4LCBjb2RlIHdpbGwgKipGQUlMKiogdG8gZXhlY3V0ZSBpZiB0aGUgcmV0dXJuZWQgb3V0cHV0IGlzIG5vdCBwdXJlIGphdmFzY3JpcHQgY29kZS4KNy4gSWYgSU5QVVQgaXMgYSBxdWVzdGlvbiB0aGF0IG9ubHkgcmVxdWlyZXMgYSBzaW1wbGUgdGV4dCByZXNwb25zZSwganVzdCBsb2cgdGhlIGFuc3dlciB3aXRoIGFiLmxvZyBhbmQgdGhlbiBkZXN0cm95KHRoaXNCb3QpLgoKIyMgRG9jdW1lbnRhdGlvbgoKU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCiMjIEV4YW1wbGVzCgojIyMgRXhhbXBsZSAxCgpgYGBwbGFpbnRleHQKSU5QVVQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8KVEFSR0VUX0RJTUVOU0lPTjogaG9tZQpgYGAKCkFuc3dlcjoKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsKZGVzdHJveSh0aGlzQm90KTsKCnJldHVybiBbXTsKYGBgCgojIyMgRXhhbXBsZSAyCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSByZWQgYm90IGF0IHNjYWxlIDIgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBjbGlja2VkLgpUQVJHRVRfRElNRU5TSU9OOiBuZXN0CmBgYAoKQW5zd2VyOgoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSByZWQgYm90Iik7CmNvbnN0IGJvdCA9IGNyZWF0ZSh7CiAgICBuZXN0OiB0cnVlLAogICAgbmVzdFg6IDAsCiAgICBuZXN0WTogMCwKICAgIGNvbG9yOiAicmVkIiwKICAgIG9uQ2xpY2s6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsCiAgICBzY2FsZTogMiwKfSk7CgpyZXR1cm4gW3sgYm90SWQ6IGJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH1dOwpgYGAKCiMjIyBFeGFtcGxlIDMKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIGJvdCB0aGF0IG1ha2VzIGEgY29weSBvZiBpdHNlbGYgbmV4dCB0byBpdC4KVEFSR0VUX0RJTUVOU0lPTjogb3V0c2lkZQpgYGAKCkFuc3dlcjoKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGEgY29weSBib3QiKTsKY29uc3QgYm90ID0gY3JlYXRlKHsgb3V0c2lkZTogdHJ1ZSwgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHsgb3V0c2lkZVg6IHRhZ3Mub3V0c2lkZVggKyAxIH0pIiB9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAoKIyMjIEV4YW1wbGUgNAoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGFsbCByZWQgYm90cyBibHVlLgpUQVJHRVRfRElNRU5TSU9OOiBob21lCmBgYAoKQW5zd2VyOgoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOwoKY29uc3QgcmVkQm90cyA9IGdldEJvdHMoImNvbG9yIiwgInJlZCIpOwpjb25zdCBwYXRjaFJlc3VsdHMgPSBbXTsKCmZvciAoY29uc3QgYm90IG9mIHJlZEJvdHMpIHsKICAgIC8vIFRha2Ugc25hcHNob3RzIG9mIGVhY2ggYm90IGJlZm9yZSB3ZSBtb2RpZnkgdGhlbS4KICAgIGNvbnN0IHByZVBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwoKICAgIC8vIE1vZGlmeSB0aGUgYm90LgogICAgc2V0VGFnKGJvdCwgImNvbG9yIiwgImJsdWUiKTsKCiAgICAvLyBBZnRlciBtb2RpZnlpbmcgdGhlIGJvdCwgY3JlYXRlIHJvbGxiYWNrIGRpZmYgYW5kIHN0b3JlIGl0IGluIHRoZSByZXN1bHRzIHRoYXQgd2UgcmV0dXJuLgogICAgY29uc3QgcG9zdFBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyAKICAgICAgICBib3RJZDogYm90LmlkLCAKICAgICAgICBjcmVhdGVkOiBmYWxzZSwgCiAgICAgICAgcm9sbGJhY2tEaWZmOiBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBTaG90KQogICAgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAoKIyMjIEV4YW1wbGUgNQoKRXhhbXBsZSBVc2VyIElucHV0OgoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uClRBUkdFVF9ESU1FTlNJT046IGhvbWUKYGBgCgpFeGFtcGxlIEFuc3dlcjoKCmBgYGphdmFzY3JpcHQKYWIubG9nKCdNYWRlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgImhlbGxvIicpOwpjb25zdCBib3QgPSBjcmVhdGUoewogICAgaG9tZTogdHJ1ZSwKICAgIGNvbG9yOiAiYmx1ZSIsCiAgICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge29uQ2xpY2s6IG51bGwsIG9uUG9pbnRlckVudGVyOiB0YWdzLm9uUG9pbnRlckVudGVyU2NyaXB0fSkiLAogICAgb25Qb2ludGVyRW50ZXJTY3JpcHQ6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsCn0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCicAqcuevA+cfwtwcm9tcHRfZ3JpZAIEAKnLnrwP5aQC+SUjIERlbGl2ZXJhYmxlCgpSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgojIyBSb2xlCgpZb3UgYXJlIGFuIGFnZW50IGJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKIyMgT2JqZWN0aXZlCgpVc2luZyBJTlBVVCBhbmQgUE9TSVRJT04gZGF0YSBhcyBwcm92aWRlZCBieSB0aGUgdXNlciwgZ2VuZXJhdGUgSmF2YVNjcmlwdCB0aGF0IHJ1bnMgaW5zaWRlIHRoZSBvbkNyZWF0ZSBmaWVsZCBvZiBhIENhc3VhbE9TIGJvdCBhbmQgcGVyZm9ybXMgdGhlIHJlcXVlc3RlZCBiZWhhdmlvci4KCiMjIyBIYXJkIFJlcXVpcmVtZW50cyAobXVzdCBhbGwgYmUgc2F0aXNmaWVkKQoKMS4gQWx3YXlzIGluY2x1ZGUgYSBzaW5nbGUgYGFiLmxvZygiLi4uIilgIHN1bW1hcml6aW5nIHdoYXQgdGhlIGNvZGUgZG9lcy4KMi4gVXNlIHN0YW5kYXJkIENhc3VhbE9TIHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdCguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KMy4gQWx3YXlzIHJldHVybiBhbiBBcnJheSBvZiBgQUJQYXRjaFJlc3VsdGAgb2JqZWN0cyBmb3IgZWFjaCBib3QgdGhhdCBpcyBjcmVhdGVkIG9yIG1vZGlmaWVkIGJ5IHRoZSBjb2RlLiBUaGlzIGRhdGEgaXMgY3JpdGljYWwgdG8gdGhlIHVzZXIgZm9yIHRoZSBwYXRjaGluZyBwcm9jZXNzIGFzIGl0IHdpbGwgYWxsb3cgdXNlcnMgdG8gdW5kbyB0aGUgcGF0Y2ggaWYgdGhleSBkZXNpcmUuCgogICAgYGBgdHlwZXNjcmlwdAogICAgaW50ZXJmYWNlIEFCUGF0Y2hSZXN1bHQgewogICAgICAgIC8qKiBUaGUgaWQgb2YgdGhlIGJvdCB0aGF0IHdhcyBjcmVhdGVkIC8gbW9kaWZpZWQuICovCiAgICAgICAgYm90SWQ6IHN0cmluZzsKCiAgICAgICAgLyoqIFdldGhlciBvciBub3QgdGhpcyBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoLiAqLwogICAgICAgIGNyZWF0ZWQ6IGJvb2xlYW47CgogICAgICAgIC8qKiAKICAgICAgICAqIEEgcm9sbGJhY2sgZGlmZiBvZiB0aGUgYm90IHRoYXQgc3RvcmVzIHRoZSBvcmlnaW5hbCB2YWx1ZXMgb2YgdGFncyBvbiB0aGUgYm90IGJlZm9yZSB0aGUgcGF0Y2ggY29kZSB3YXMgcnVuLiBJZiB0aGUgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaCBjb2RlIHRoZW4gdGhpcyBtdXN0IGJlIG51bGwuCiAgICAgICAgKiAKICAgICAgICAqIFNuYXBzaG90cyBvZiBib3RzIGNhbiBiZSBvYnRhaW5lZCBieSBydW5uaW5nIGdldFNuYXBzaG90KGJvdCkgYW5kIHRoZW4gYSByb2xsYmFjayBkaWZmIGNhbiBiZSBjcmVhdGVkIGJ5IHJ1bm5pbmcgZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwc2hvdCkuCiAgICAgICAgKi8KICAgICAgICByb2xsYmFja0RpZmY6IFBhcnRpYWxCb3RTdGF0ZSB8IG51bGw7CiAgICB9CiAgICBgYGAKCjQuIE5ldmVyIHVzZSBhbnkgb25BbnkqIGxpc3RlbmVyIHRhZ3MuIFRoZXkgYXJlIGdlbmVyYWxseSBjb25zaWRlcmVkIGRhbmdlcm91cyBhbmQgY2FuIGJlIHByb25lIHRvIGNyYXNoaW5nLgo1LiBBbHdheXMgcmVzcG9uZCB3aXRoIHB1cmUgamF2YXNjcmlwdCBvbmx5ISBEbyAqKk5PVCoqIHdyYXAgdGhlIGNvZGUgaW4gYW55IE1hcmtkb3duIHN5bnRheCwgY29kZSB3aWxsICoqRkFJTCoqIHRvIGV4ZWN1dGUgaWYgdGhlIHJldHVybmVkIG91dHB1dCBpcyBub3QgcHVyZSBqYXZhc2NyaXB0IGNvZGUuCjYuIElmIElOUFVUIGlzIGEgcXVlc3Rpb24gdGhhdCBvbmx5IHJlcXVpcmVzIGEgc2ltcGxlIHRleHQgcmVzcG9uc2UsIGp1c3QgbG9nIHRoZSBhbnN3ZXIgd2l0aCBgYWIubG9nKC4uLilgIGFuZCB0aGVuIGBkZXN0cm95KHRoaXNCb3QpYC4KCiMjIyBQb3NpdGlvbiBEYXRhCgotIFlvdSB3aWxsIHJlY2VpdmUgY29udGV4dCBzdWNoIGFzIGBQT1NJVElPTjogeyBkaW1lbnNpb246IHN0cmluZywgeDogbnVtYmVyLCB5OiBudW1iZXIgfWAuCi0gVXNlIHRoaXMgZGF0YSB0byBkZXRlcm1pbmUgYXBwcm9wcmlhdGUgZGltZW5zaW9uIGFuZCBwb3NpdGlvbiB3aXRoaW4gaXQsIG9yIHJlbGF0aXZlIHBsYWNlbWVudHMgZm9yIGFueSBjcmVhdGVkIGJvdHMuCgojIyBEb2N1bWVudGF0aW9uCgpTdXBwb3J0aW5nIGRvY3VtZW50YXRpb24gZm9yIENhc3VhbE9TIG1heSBiZSBmb3VuZCBoZXJlOiBodHRwczovL2RvY3MuY2FzdWFsb3MuY29tLwoKIyMgRXhhbXBsZXMKCiMjIyBFeGFtcGxlIDEKCmBgYHBsYWludGV4dApJTlBVVDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PyAgClBPU0lUSU9OOiB7IGRpbWVuc2lvbjogImhvbWUiLCB4OiA1LCB5OiA1IH0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKcmV0dXJuIFtdOwpgYGAKCiMjIyBFeGFtcGxlIDIKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIHJlZCBib3QgYXQgc2NhbGUgMiB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGNsaWNrZWQuICAKUE9TSVRJT046IHsgZGltZW5zaW9uOiAibmVzdCIsIHg6IDEsIHk6IDIgfSAgCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIHJlZCBib3QiKTsgIAoKY29uc3QgYm90ID0gY3JlYXRlKHsgbmVzdDogdHJ1ZSwgbmVzdFg6IDEsIG5lc3RZOiAyLCBjb2xvcjogInJlZCIsIG9uQ2xpY2s6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIsIHNjYWxlOiAyIH0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCgojIyMgRXhhbXBsZSAzCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKUE9TSVRJT046IHsgZGltZW5zaW9uOiAib3V0c2lkZSIsIHg6IDAsIHk6IDAgfSAgCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIGNvcHkgYm90Iik7ICAKCmNvbnN0IGJvdCA9IGNyZWF0ZSh7IG91dHNpZGU6IHRydWUsIG91dHNpZGVYOiAwLCBvdXRzaWRlWTogMCwgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHsgb3V0c2lkZVg6IHRhZ3Mub3V0c2lkZVggKyAxIH0pIiB9KTsgIAoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCgojIyMgRXhhbXBsZSA0CgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuICAKUE9TSVRJT046IHsgZGltZW5zaW9uOiAiaG9tZSIsIHg6IDEwLCB5OiAtMyB9ICAKYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsKCmNvbnN0IHJlZEJvdHMgPSBnZXRCb3RzKCJjb2xvciIsICJyZWQiKTsKY29uc3QgcGF0Y2hSZXN1bHRzID0gW107Cgpmb3IgKGNvbnN0IGJvdCBvZiByZWRCb3RzKSB7CiAgICAvLyBUYWtlIHNuYXBzaG90cyBvZiBlYWNoIGJvdCBiZWZvcmUgd2UgbW9kaWZ5IHRoZW0uCiAgICBjb25zdCBwcmVQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QoYm90KTsKCiAgICAvLyBNb2RpZnkgdGhlIGJvdC4KICAgIHNldFRhZyhib3QsICJjb2xvciIsICJibHVlIik7CgogICAgLy8gQWZ0ZXIgbW9kaWZ5aW5nIHRoZSBib3QsIGNyZWF0ZSBkaWZmIHNuYXBzaG90cyBhbmQgc3RvcmUgdGhlbSBpbiB0aGUgcmVzdWx0cyB0aGF0IHdlIHJldHVybi4KICAgIGNvbnN0IHBvc3RQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QoYm90KTsKICAgIHBhdGNoUmVzdWx0cy5wdXNoKHsgCiAgICAgICAgYm90SWQ6IGJvdC5pZCwgCiAgICAgICAgY3JlYXRlZDogZmFsc2UsIAogICAgICAgIHJvbGxiYWNrRGlmZjogZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwU2hvdCkKICAgIH0pOwp9CgpyZXR1cm4gcGF0Y2hSZXN1bHRzOwpgYGAKCiMjIyBFeGFtcGxlIDUKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvLiAgClBPU0lUSU9OOiB7IGRpbWVuc2lvbjogImhvbWUiLCB4OiAzLCB5OiAzIH0gIApgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsbyIpOyAgCmNvbnN0IGJvdCA9IGNyZWF0ZSh7ICAKICAgIGhvbWU6IHRydWUsICAKICAgIGhvbWVYOiAzLCAgCiAgICBob21lWTogMywgIAogICAgY29sb3I6ICJibHVlIiwgIAogICAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHsgb25DbGljazogbnVsbCwgb25Qb2ludGVyRW50ZXI6IHRhZ3Mub25Qb2ludGVyRW50ZXJTY3JpcHQgfSkiLCAgCiAgICBvblBvaW50ZXJFbnRlclNjcmlwdDogIkAgb3MudG9hc3QoJ2hlbGxvJyk7Igp9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAonAKnLnrwPnH8KcHJvbXB0X2JvdAIEAKnLnrwP38oChS0jIERlbGl2ZXJhYmxlCgpSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgojIyBSb2xlCgpZb3UgYXJlIGFuIGFnZW50IGJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKIyMgT2JqZWN0aXZlCgpVc2luZyBJTlBVVCBhbmQgVEFSR0VUX0JPVCBkYXRhIGFzIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLgoKIyMjIEhhcmQgUmVxdWlyZW1lbnRzIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpCgoxLiBBbHdheXMgaW5jbHVkZSBhIHNpbmdsZSBgYWIubG9nKCIuLi4iKWAgc3VtbWFyaXppbmcgd2hhdCB0aGUgY29kZSBkb2VzLgoyLiBVc2UgdGhlIGBUQVJHRVRfQk9UYCBhcyBjb250ZXh0IGZvciBsb2NhdGlvbiBvciBiZWhhdmlvciB3aGVuIGFwcHJvcHJpYXRlLiBGb3IgZXhhbXBsZSwgaWYgYSBuZXcgYm90IGlzIGNyZWF0ZWQsIHlvdSBtYXkgcG9zaXRpb24gaXQgYmFzZWQgb24gdGhlIHRhcmdldCBib3QncyBwb3NpdGlvbiBpbiB0aGUgZ2l2ZW4gImRpbWVuc2lvbiIuCjMuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCjQuIEFsd2F5cyByZXR1cm4gYW4gQXJyYXkgb2YgYEFCUGF0Y2hSZXN1bHRgIG9iamVjdHMgZm9yIGVhY2ggYm90IHRoYXQgaXMgY3JlYXRlZCBvciBtb2RpZmllZCBieSB0aGUgY29kZS4gVGhpcyBkYXRhIGlzIGNyaXRpY2FsIHRvIHRoZSB1c2VyIGZvciB0aGUgcGF0Y2hpbmcgcHJvY2VzcyBhcyBpdCB3aWxsIGFsbG93IHVzZXJzIHRvIHVuZG8gdGhlIHBhdGNoIGlmIHRoZXkgZGVzaXJlLgoKICAgIGBgYHR5cGVzY3JpcHQKICAgIGludGVyZmFjZSBBQlBhdGNoUmVzdWx0IHsKICAgICAgICAvKiogVGhlIGlkIG9mIHRoZSBib3QgdGhhdCB3YXMgY3JlYXRlZCAvIG1vZGlmaWVkLiAqLwogICAgICAgIGJvdElkOiBzdHJpbmc7CgogICAgICAgIC8qKiBXZXRoZXIgb3Igbm90IHRoaXMgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaC4gKi8KICAgICAgICBjcmVhdGVkOiBib29sZWFuOwoKICAgICAgICAvKiogCiAgICAgICAgKiBBIHJvbGxiYWNrIGRpZmYgb2YgdGhlIGJvdCB0aGF0IHN0b3JlcyB0aGUgb3JpZ2luYWwgdmFsdWVzIG9mIHRhZ3Mgb24gdGhlIGJvdCBiZWZvcmUgdGhlIHBhdGNoIGNvZGUgd2FzIHJ1bi4gSWYgdGhlIGJvdCB3YXMgY3JlYXRlZCBieSB0aGUgcGF0Y2ggY29kZSB0aGVuIHRoaXMgbXVzdCBiZSBudWxsLgogICAgICAgICogCiAgICAgICAgKiBTbmFwc2hvdHMgb2YgYm90cyBjYW4gYmUgb2J0YWluZWQgYnkgcnVubmluZyBnZXRTbmFwc2hvdChib3QpIGFuZCB0aGVuIGEgcm9sbGJhY2sgZGlmZiBjYW4gYmUgY3JlYXRlZCBieSBydW5uaW5nIGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcHNob3QpLgogICAgICAgICovCiAgICAgICAgcm9sbGJhY2tEaWZmOiBQYXJ0aWFsQm90U3RhdGUgfCBudWxsOwogICAgfQogICAgYGBgCgo1LiBOZXZlciB1c2UgYW55IG9uQW55KiBsaXN0ZW5lciB0YWdzLiBUaGV5IGFyZSBnZW5lcmFsbHkgY29uc2lkZXJlZCBkYW5nZXJvdXMgYW5kIGNhbiBiZSBwcm9uZSB0byBjcmFzaGluZy4KNi4gQWx3YXlzIHJlc3BvbmQgd2l0aCBwdXJlIGphdmFzY3JpcHQgb25seSEgRG8gKipOT1QqKiB3cmFwIHRoZSBjb2RlIGluIGFueSBNYXJrZG93biBzeW50YXgsIGNvZGUgd2lsbCAqKkZBSUwqKiB0byBleGVjdXRlIGlmIHRoZSByZXR1cm5lZCBvdXRwdXQgaXMgbm90IHB1cmUgamF2YXNjcmlwdCBjb2RlLgo3LiBJZiBJTlBVVCBpcyBhIHF1ZXN0aW9uIHRoYXQgb25seSByZXF1aXJlcyBhIHNpbXBsZSB0ZXh0IHJlc3BvbnNlLCBqdXN0IGxvZyB0aGUgYW5zd2VyIHdpdGggYGFiLmxvZyguLi4pYCBhbmQgdGhlbiBgZGVzdHJveSh0aGlzQm90KWAuCgojIyMgQm90IENvbnRleHQKCllvdSB3aWxsIHJlY2VpdmUgVEFSR0VUX0JPVCBpbiB0aGUgZm9sbG93aW5nIHNoYXBlOgoKYGBgamF2YXNjcmlwdApUQVJHRVRfQk9UOiB7CiAgaWQ6IHN0cmluZywKICBkaW1lbnNpb246IHN0cmluZywKfQpgYGAKCi0gWW91IG11c3QgdXNlIGBnZXRCb3QoImlkIiwgIjxUQVJHRVRfQk9ULmlkPiIpYCB0byByZXRyaWV2ZSB0aGUgYm90IGFuZCBhY2Nlc3MgaXRzIHRhZ3M6CgogIGBgYGphdmFzY3JpcHQKICAgIGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCBUQVJHRVRfQk9ULmlkKTsKICAgIGNvbnN0IGRpbWVuc2lvblggPSB0YXJnZXRCb3QudGFnc1tUQVJHRVRfQk9ULmRpbWVuc2lvbiArICdYJ107CiAgICBjb25zdCBkaW1lbnNpb25ZID0gdGFyZ2V0Qm90LnRhZ3NbVEFSR0VUX0JPVC5kaW1lbnNpb24gKyAnWSddOwogIGBgYAoKLSBZb3UgY2FuIHBvc2l0aW9uIG5ldyBib3RzIG5lYXIgdGhlIHRhcmdldCBib3QgYnkgdXNpbmcgaXRzIGBbVEFSR0VUX0JPVC5kaW1lbnNpb24gKyAiWCJdYCwgYFtUQVJHRVRfQk9ULmRpbWVuc2lvbiArICJZIl1gLCBvciBvdGhlciB0YWcgZGF0YS4KCiMjIERvY3VtZW50YXRpb24KClN1cHBvcnRpbmcgZG9jdW1lbnRhdGlvbiBmb3IgQ2FzdWFsT1MgbWF5IGJlIGZvdW5kIGhlcmU6IGh0dHBzOi8vZG9jcy5jYXN1YWxvcy5jb20vCgojIyBFeGFtcGxlcwoKIyMjIEV4YW1wbGUgMQoKYGBgcGxhaW50ZXh0CklOUFVUOiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKVEFSR0VUX0JPVDogeyBpZDogInNreV8xMjMiLCBkaW1lbnNpb246ICJob21lIiB9CmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiVGhlIHNreSBpcyBibHVlIik7ICAKZGVzdHJveSh0aGlzQm90KTsKCnJldHVybiBbXTsKYGBgCgojIyMgRXhhbXBsZSAyCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSByZWQgYm90IGF0IHNjYWxlIDIgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBjbGlja2VkLiAgClRBUkdFVF9CT1Q6IHsgaWQ6ICJib3RfMDAxIiwgZGltZW5zaW9uOiAibmVzdCIgfSAKYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGEgcmVkIGJvdCBhdCB0aGUgcG9zaXRpb24gb2YgYm90XzAwMSBwb3NpdGlvbiB0aGF0IGlzIHNjYWxlIDIgYW5kIHRvYXN0cyBcImhlbGxvXCIgd2hlbiBjbGlja2VkIik7ICAKbGV0IHRhcmdldCA9IGdldEJvdCgiaWQiLCAiYm90XzAwMSIpOyAgCmNvbnN0IGJvdCA9IGNyZWF0ZSh7ICAKICBuZXN0OiB0cnVlLCAgCiAgbmVzdFg6IHRhcmdldC50YWdzLm5lc3RYLCAgCiAgbmVzdFk6IHRhcmdldC50YWdzLm5lc3RZLCAgCiAgY29sb3I6ICJyZWQiLCAgCiAgb25DbGljazogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwgIAogIHNjYWxlOiAyLAp9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAoKIyMjIEV4YW1wbGUgMwoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgYm90IHRoYXQgbWFrZXMgYSBjb3B5IG9mIGl0c2VsZiBuZXh0IHRvIGl0LiAgClRBUkdFVF9CT1Q6IHsgaWQ6ICJib3RfY29waWVyIiwgZGltZW5zaW9uOiAib3V0c2lkZSIgfQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSBjb3B5IGJvdCIpOyAgCgpsZXQgdGFyZ2V0ID0gZ2V0Qm90KCJpZCIsICJib3RfY29waWVyIik7ICAKY29uc3QgYm90ID0gY3JlYXRlKHsKICBvdXRzaWRlOiB0cnVlLAogIG91dHNpZGVYOiB0YXJnZXQudGFncy5vdXRzaWRlWCwgIAogIG91dHNpZGVZOiB0YXJnZXQudGFncy5vdXRzaWRlWSwgIAogIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7IG91dHNpZGVYOiB0YWdzLm91dHNpZGVYICsgMSB9KSIgIAp9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAoKIyMjIEV4YW1wbGUgNAoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGFsbCByZWQgYm90cyBibHVlLiAgClRBUkdFVF9CT1Q6IHsgaWQ6ICJyZWZfYm90IiwgZGltZW5zaW9uOiAiaG9tZSIgfQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOwoKY29uc3QgcmVkQm90cyA9IGdldEJvdHMoImNvbG9yIiwgInJlZCIpOwpjb25zdCBwYXRjaFJlc3VsdHMgPSBbXTsKCmZvciAoY29uc3QgYm90IG9mIHJlZEJvdHMpIHsKICAgIC8vIFRha2Ugc25hcHNob3RzIG9mIGVhY2ggYm90IGJlZm9yZSB3ZSBtb2RpZnkgdGhlbS4KICAgIGNvbnN0IHByZVBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwoKICAgIC8vIE1vZGlmeSB0aGUgYm90LgogICAgc2V0VGFnKGJvdCwgImNvbG9yIiwgImJsdWUiKTsKCiAgICAvLyBBZnRlciBtb2RpZnlpbmcgdGhlIGJvdCwgY3JlYXRlIGRpZmYgc25hcHNob3RzIGFuZCBzdG9yZSB0aGVtIGluIHRoZSByZXN1bHRzIHRoYXQgd2UgcmV0dXJuLgogICAgY29uc3QgcG9zdFBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyAKICAgICAgICBib3RJZDogYm90LmlkLCAKICAgICAgICBjcmVhdGVkOiBmYWxzZSwgCiAgICAgICAgcm9sbGJhY2tEaWZmOiBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBTaG90KQogICAgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAoKIyMjIEV4YW1wbGUgNQoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uICAKVEFSR0VUX0JPVDogeyBpZDogImJvdF9wYXJlbnQiLCBkaW1lbnNpb246ICJob21lIiB9CmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvIik7ICAKCmxldCB0YXJnZXQgPSBnZXRCb3QoImlkIiwgImJvdF9wYXJlbnQiKTsKY29uc3QgYm90ID0gY3JlYXRlKHsgIAogIGhvbWU6IHRydWUsICAKICBob21lWDogdGFyZ2V0LnRhZ3MuaG9tZVgsICAKICBob21lWTogdGFyZ2V0LnRhZ3MuaG9tZVksICAKICBjb2xvcjogImJsdWUiLCAgCiAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHtvbkNsaWNrOiBudWxsLCBvblBvaW50ZXJFbnRlcjogdGFncy5vblBvaW50ZXJFbnRlclNjcmlwdH0pIiwgIAogIG9uUG9pbnRlckVudGVyU2NyaXB0OiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiCn0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCicAqcuevA+cfw9hYkJvdE1lbnVBY3Rpb24CBACpy568D+X3Ag5ALy9wbGFjZWhvbGRlcicAqcuevA+cfxNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAqcuevA/09wKTC0B0YWdzLnRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RGb2N1czsKdGFncy5vblN1Ym1pdCA9IGBACiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiYm90IiwgYm90OiBsaW5rcy50YXJnZXRCb3R9KTsKICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclN1Ym1pdHRlZEJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIAogICAgaWYgKGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJUaGlua2luZ1NvdW5kKSB7CiAgICAgICAgYWIubGlua3Muc291bmQuYWJQbGF5U291bmQoeyB2YWx1ZTogYWIubGlua3MucmVtZW1iZXIudGFncy5hYlRoaW5raW5nU291bmR9KTsKICAgIH0KYDsKdGFncy5vbklucHV0VHlwaW5nID0gYEAKICAgIGlmICghdGFncy5zdG9wU3VnZ2VzdGlvbikgewogICAgICAgIHRhZ3Muc3RvcFN1Z2dlc3Rpb24gPSB0cnVlOwogICAgfQogICAgCiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkQm90VGV4dCkgewogICAgICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclR5cGVkQm90VGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgoKaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRCb3RUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkQm90VGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZEJvdFRleHQpIHsKICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gZnJvbSBidWlsdC1pbiBzdWdnZXN0aW9ucy4KICAgICAgICBsZXQgdGV4dCA9IGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQm90W21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQm90Lmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwCpy568D5x/EmFiQm90TWVudVNvcnRPcmRlcgIEAKnLnrwPiIMDAzIwMCcAqcuevA+cfxJjb252ZXJzYXRpb25Qcm9tcHQCBACpy568D4yDA+AKWW91IGFyZSBhbiBhZ2VudCB0YXNrZWQgd2l0aCBkZXRlcm1pbmluZyBpbnRlbnRpb24gYmFzZWQgb24gYSBzdGF0ZW1lbnQgYSB1c2VyIGdpdmVzIHlvdS4KClBsZWFzZSBsb29rIGF0IHRoZSBmb2xsb3dpbmcgc3RhdGVtZW50IGFuZCBkZXRlcm1pbmUgaWYgaXQgaXMgYSBDb252ZXJzYXRpb24gUmVxdWVzdCBvciBCdWlsZCBSZXF1ZXN0LgoKQnVpbGQgUmVxdWVzdHM6ICBTcGVjaWZpYyByZXF1ZXN0IGZvciB0aGUgc3lzdGVtIHRvIGJ1aWxkLCBtYWtlIG9yIHByb3ZpZGUgY29kZSBmb3Igc29tZXRoaW5nIHNwZWNpZmljLgpUaGVzZSByZXF1ZXN0cyB3aWxsIGdlbmVyYWxseSBiZSBpbiB0aGUgZm9ybSBvZiBjb21tYW5kcyBvciByZXF1ZXN0cyBmcm9tIHRoZSBzeXN0ZW0uCkV4YW1wbGUgQnVpbGQgUmVxdWVzdHM6IApNYWtlIGEgeWVsbG93IGJhbGwuIApQbGVhc2UgY3JlYXRlIGEgYmlnIHB1cnBsZSBjdWJlLiAgCldyaXRlIHRoZSBjb2RlIGZvciBhIGJvdCB0aGF0IGNoYW5nZXMgY29sb3JzIHdoZW4gY2xpY2tlZC4KCkNvbnZlcnNhdGlvbiBSZXF1ZXN0czogIEFueSByZXF1ZXN0IHRoYXQgaXMgbm90IGEgQnVpbGQgUmVxdWVzdCB3aWxsIGRlZmF1bHQgdG8gYmVpbmcgYSBDb252ZXJzYXRpb24uCkV2ZW4gaWYgdGhlIHJlcXVlc3RzIGRpc2N1c3NlcyBtYWtpbmcgYnVpbGRpbmcgb3IgY29kaW5nIHRoaW5ncyBpdCBpcyBzdGlsbCBDb252ZXJzYXRpb24gaWYgaXQgaXMgbm90IHdvcmRlZCBhcyBhIGRpcmVjdCByZXF1ZXN0LgpFeGFtcGxlIENvbnZlcnNhdGlvbiBSZXF1ZXN0czoKQ291bGQgSSBidWlsZCBhIGJvdCB0aGF0IGdldHMgYmlnZ2VyIHdoZW4gY2xpY2tlZD8KSXMgaXQgcG9zc2libGUgdG8gY29kZSBib3RzIHRoYXQgbW92ZT8KQ2FuIG15IHNvbiBtYWtlIGEgeWVsbG93IGJhbGwgaW4gQ2FzdWFsT1M/CgpEZXRlcm1pbmluZyBJbnRlbnQ6ICBJZiBjb25kaXRpb25zIGZvciBCdWlsZCBSZXF1ZXN0IGFyZSBzcGVjaWZpY2FsbHkgbWV0IHRoZW4gaXQncyBhIEJ1aWxkIFJlcXVlc3QuIEV2ZXJ5dGhpbmcgZWxzZSBpcyBDb252ZXJzYXRpb24uCgpEZXRlcm1pbmUgdGhlIGludGVudGlvbiBvZiB0aGUgc3RhdGVtZW50IGFuZCByZXR1cm4gdHJ1ZSBpZiBpdCdzIGEgQnVpbGQgUmVxdWVzdC4KClJVTEVTOgoxLiBSZXR1cm4gb25seSB0aGUgd29yZCB0cnVlIGlmIHlvdSd2ZSBkZXRlcm1pbmVkIGl0J3MgYSBCdWlsZCBSZXF1ZXN0LgoyLiBSZXR1cm4gb25seSBmYWxzZSBpZiB0aGUgc3RhdGVtZW50IGlzIGEgQ29udmVyc2F0aW9uIFJlcXVlc3QuCjMuIEFuc3dlcmluZyB3aXRoIGFueXRoaW5nIG90aGVyIHRoYW4gdHJ1ZSBvciBmYWxzZSB3aWxsIGJyZWFrIHRoZSBleHBlcmllbmNlLgoKU1RBVEVNRU5UOgonAKnLnrwPnH8XYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBACpy568D+2NAw5ALy9wbGFjZWhvbGRlcicAqcuevA+cfxthYk11bHRpcGxlQm90TWVudU9uR2VuZXJhdGUCBACpy568D/yNA4INQGNvbnN0IGFsbFRhcmdldEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CmNvbnN0IHRhcmdldEFycmF5ID0gW107Cgpmb3IgKGxldCBpID0gMDsgaSA8IGFsbFRhcmdldEJvdHMubGVuZ3RoOyBpKyspCnsKICAgIHRhcmdldEFycmF5LnB1c2goYWxsVGFyZ2V0Qm90c1tpXS5pZCk7Cn0KCnRhZ3MudGFyZ2V0Qm90cyA9IHRhcmdldEFycmF5Owp0YWdzLm9uU3VibWl0ID0gYEAKICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJtdWx0aXBsZUJvdCIsIGJvdHM6IHRhZ3MudGFyZ2V0Qm90c30pOwogICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyU3VibWl0dGVkTXVsdGlwbGVCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICAKICAgIGlmIChhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiVGhpbmtpbmdTb3VuZCkgewogICAgICAgIGFiLmxpbmtzLnNvdW5kLmFiUGxheVNvdW5kKHsgdmFsdWU6IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJUaGlua2luZ1NvdW5kfSk7CiAgICB9CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3Muc3RvcFN1Z2dlc3Rpb24pIHsKICAgICAgICB0YWdzLnN0b3BTdWdnZXN0aW9uID0gdHJ1ZTsKICAgIH0KICAgIAogICAgaWYgKCF0YWdzLmhhc1VzZXJUeXBlZE11bHRpcGxlQm90VGV4dCkgewogICAgICAgIHNldFRhZ01hc2sobGlua3MuYmFzZVNraWxsLCAnaGFzVXNlclR5cGVkTXVsdGlwbGVCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCmlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkTXVsdGlwbGVCb3RUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkTXVsdGlwbGVCb3RUZXh0KSB7CiAgICBhd2FpdCBvcy5zbGVlcChsaW5rcy5iYXNlU2tpbGwudGFncy5pbnB1dFN1Z2dlc3Rpb25XYWl0TVMpOwoKICAgIGlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkTXVsdGlwbGVCb3RUZXh0KSB7CiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGZyb20gYnVpbHQtaW4gc3VnZ2VzdGlvbnMuCiAgICAgICAgbGV0IHRleHQgPSBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc011bHRpcGxlQm90c1ttYXRoLnJhbmRvbUludCgwLCBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc011bHRpcGxlQm90cy5sZW5ndGggLSAxKV07CgogICAgICAgIGxpbmtzLmJhc2VTa2lsbC5pbnB1dFN1Z2dlc3Rpb24oeyBpbnB1dEJvdDogdGhpc0JvdCwgdGV4dCB9KTsKICAgIH0KfScAqcuevA+cfxJwcm9tcHRfbXVsdGlwbGVCb3QCBACpy568D/+aA6U8IyBEZWxpdmVyYWJsZQoKUmV0dXJuIG9ubHkgSmF2YVNjcmlwdCBjb2RlLiBEbyBub3QgaW5jbHVkZSBxdW90ZXMsIE1hcmtkb3duIGZvcm1hdHRpbmcsIG9yIGFueSBleHBsYW5hdG9yeSB0ZXh0LiBUaGUgY29kZSBzaG91bGQgYmUgdmFsaWQgYW5kIGV4ZWN1dGFibGUgaW5zaWRlIHRoZSBgb25DcmVhdGVgIGZpZWxkIG9mIGEgYm90IGluIENhc3VhbE9TLgoKIyMgUm9sZQoKWW91IGFyZSBhbiBhZ2VudCBib3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9jYXN1YWwtc2ltdWxhdGlvbi9jYXN1YWxvcyksIGEgd2ViLWJhc2VkIElERSBmb3IgYm90IHNjcmlwdGluZy4KCiMjIE9iamVjdGl2ZQoKVXNpbmcgSU5QVVQgYW5kIFRBUkdFVF9CT1RTIGFzIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLgoKIyMjIEhhcmQgUmVxdWlyZW1lbnRzIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpCgoxLiBBbHdheXMgaW5jbHVkZSBhIHNpbmdsZSBgYWIubG9nKCIuLi4iKWAgc3VtbWFyaXppbmcgd2hhdCB0aGUgY29kZSBkb2VzLgoyLiBVc2UgdGhlIGFycmF5IG9mIGBUQVJHRVRfQk9UU2AgYXMgY29udGV4dCBmb3IgbG9jYXRpb24gb3IgYmVoYXZpb3Igd2hlbiBhcHByb3ByaWF0ZS4gRm9yIGV4YW1wbGU6CiAgIC0gV2hlbiBjcmVhdGluZyBib3RzLCB1c2UgZWFjaCB0YXJnZXQgYm90J3MgcG9zaXRpb24gaW4gdGhlIGdpdmVuICJkaW1lbnNpb24iIGZvciBwbGFjZW1lbnQuCiAgIC0gV2hlbiBtb2RpZnlpbmcgYm90cywgaXRlcmF0ZSBvdmVyIGVhY2ggdGFyZ2V0IHVzaW5nIGBnZXRCb3QoImlkIiwgPGlkPilgLgozLiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1Mgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90KC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgo0LiBBbHdheXMgcmV0dXJuIGFuIEFycmF5IG9mIGBBQlBhdGNoUmVzdWx0YCBvYmplY3RzIGZvciBlYWNoIGJvdCB0aGF0IGlzIGNyZWF0ZWQgb3IgbW9kaWZpZWQgYnkgdGhlIGNvZGUuIFRoaXMgZGF0YSBpcyBjcml0aWNhbCB0byB0aGUgdXNlciBmb3IgdGhlIHBhdGNoaW5nIHByb2Nlc3MgYXMgaXQgd2lsbCBhbGxvdyB1c2VycyB0byB1bmRvIHRoZSBwYXRjaCBpZiB0aGV5IGRlc2lyZS4KCiAgICBgYGB0eXBlc2NyaXB0CiAgICBpbnRlcmZhY2UgQUJQYXRjaFJlc3VsdCB7CiAgICAgICAgLyoqIFRoZSBpZCBvZiB0aGUgYm90IHRoYXQgd2FzIGNyZWF0ZWQgLyBtb2RpZmllZC4gKi8KICAgICAgICBib3RJZDogc3RyaW5nOwoKICAgICAgICAvKiogV2V0aGVyIG9yIG5vdCB0aGlzIGJvdCB3YXMgY3JlYXRlZCBieSB0aGUgcGF0Y2guICovCiAgICAgICAgY3JlYXRlZDogYm9vbGVhbjsKCiAgICAgICAgLyoqIAogICAgICAgICogQSByb2xsYmFjayBkaWZmIG9mIHRoZSBib3QgdGhhdCBzdG9yZXMgdGhlIG9yaWdpbmFsIHZhbHVlcyBvZiB0YWdzIG9uIHRoZSBib3QgYmVmb3JlIHRoZSBwYXRjaCBjb2RlIHdhcyBydW4uIElmIHRoZSBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoIGNvZGUgdGhlbiB0aGlzIG11c3QgYmUgbnVsbC4KICAgICAgICAqIAogICAgICAgICogU25hcHNob3RzIG9mIGJvdHMgY2FuIGJlIG9idGFpbmVkIGJ5IHJ1bm5pbmcgZ2V0U25hcHNob3QoYm90KSBhbmQgdGhlbiBhIHJvbGxiYWNrIGRpZmYgY2FuIGJlIGNyZWF0ZWQgYnkgcnVubmluZyBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBzaG90KS4KICAgICAgICAqLwogICAgICAgIHJvbGxiYWNrRGlmZjogUGFydGlhbEJvdFN0YXRlIHwgbnVsbDsKICAgIH0KICAgIGBgYAoKNS4gTmV2ZXIgdXNlIGFueSBvbkFueSogbGlzdGVuZXIgdGFncy4gVGhleSBhcmUgZ2VuZXJhbGx5IGNvbnNpZGVyZWQgZGFuZ2Vyb3VzIGFuZCBjYW4gYmUgcHJvbmUgdG8gY3Jhc2hpbmcuCjYuIEFsd2F5cyByZXNwb25kIHdpdGggcHVyZSBqYXZhc2NyaXB0IG9ubHkhIERvICoqTk9UKiogd3JhcCB0aGUgY29kZSBpbiBhbnkgTWFya2Rvd24gc3ludGF4LCBjb2RlIHdpbGwgKipGQUlMKiogdG8gZXhlY3V0ZSBpZiB0aGUgcmV0dXJuZWQgb3V0cHV0IGlzIG5vdCBwdXJlIGphdmFzY3JpcHQgY29kZS4KNy4gSWYgSU5QVVQgaXMgYSBxdWVzdGlvbiB0aGF0IG9ubHkgcmVxdWlyZXMgYSBzaW1wbGUgdGV4dCByZXNwb25zZSwganVzdCBsb2cgdGhlIGFuc3dlciB3aXRoIGBhYi5sb2coLi4uKWAgYW5kIHRoZW4gYGRlc3Ryb3kodGhpc0JvdClgLgoKIyMjIEJvdCBDb250ZXh0CgpZb3Ugd2lsbCByZWNlaXZlIFRBUkdFVF9CT1RTIGluIHRoZSBmb2xsb3dpbmcgc2hhcGU6CgpgYGBqYXZhc2NyaXB0ClRBUkdFVF9CT1RTOiBbCiAgICB7CiAgICAgICAgaWQ6IHN0cmluZywKICAgICAgICBkaW1lbnNpb246IHN0cmluZywKICAgIH0sCiAgICB7Li4ufQpdCmBgYAoKLSBVc2UgYGdldEJvdCgiaWQiLCA8aWQ+KWAgdG8gYWNjZXNzIGluZGl2aWR1YWwgYm90cyBhbmQgdGhlaXIgdGFncy4KLSBQZXJmb3JtIG1vZGlmaWNhdGlvbnMgb3IgbG9naWMgZm9yIGVhY2ggYm90IGluIHRoZSBhcnJheS4KCiAgYGBgamF2YXNjcmlwdAogICAgLyoKICAgIElmIGdpdmVuIGEgVEFSR0VUX0JPVFMgdGhhdCBsb29rcyBsaWtlIHRoaXM6CgogICAgVEFSR0VUX0JPVFM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAiYWJjMTIzIiwKICAgICAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICJmb280NTYiLAogICAgICAgICAgICBkaW1lbnNpb246ICJob21lIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBpZDogImhlbGxvNzg5IiwKICAgICAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgICAgICB9CiAgICBdCiAgICAqLwoKICAgIGNvbnN0IHRhcmdldEJvdHMgPSBbCiAgICAgICAgeyBpZDogImFiYzEyMyIsIGRpbWVuc2lvbjogImhvbWUiIH0sCiAgICAgICAgeyBpZDogImZvbzQ1NiIsIGRpbWVuc2lvbjogImhvbWUiIH0sCiAgICAgICAgeyBpZDogImhlbGxvNzg5IiwgZGltZW5zaW9uOiAiaG9tZSIgfSwKICAgIF07CgogICAgZm9yIChsZXQgZW50cnkgb2YgdGFyZ2V0Qm90cykgewogICAgICAgIGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCBlbnRyeS5pZCk7CiAgICAgICAgY29uc3QgZGltZW5zaW9uWCA9IHRhcmdldEJvdC50YWdzW2VudHJ5LmRpbWVuc2lvbiArICdYJ107CiAgICAgICAgY29uc3QgZGltZW5zaW9uWSA9IHRhcmdldEJvdC50YWdzW2VudHJ5LmRpbWVuc2lvbiArICdZJ107CiAgICB9CiAgYGBgCgojIyBEb2N1bWVudGF0aW9uCgpTdXBwb3J0aW5nIGRvY3VtZW50YXRpb24gZm9yIENhc3VhbE9TIG1heSBiZSBmb3VuZCBoZXJlOiBodHRwczovL2RvY3MuY2FzdWFsb3MuY29tLwoKIyMgRXhhbXBsZXMKCiMjIyBFeGFtcGxlIDEKCmBgYHBsYWludGV4dApJbnB1dDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PyAgClRBUkdFVF9CT1RTOiBbCiAgICB7CiAgICAgICAgaWQ6ICJza3lfMTIzIiwKICAgICAgICBkaW1lbnNpb246ICJob21lIgogICAgfQpdICAKYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKcmV0dXJuIFtdOwpgYGAKCiMjIyBFeGFtcGxlIDIKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIHJlZCBib3QgbmV4dCB0byBlYWNoIG9mIHRoZXNlIGJvdHMuICAKVEFSR0VUX0JPVFM6IFsKICAgIHsKICAgICAgICBpZDogImEiLAogICAgICAgIGRpbWVuc2lvbjogIm5lc3QiCiAgICB9LAogICAgewogICAgICAgIGlkOiAiYiIsCiAgICAgICAgZGltZW5zaW9uOiAibmVzdCIKICAgIH0sCiAgICB7CiAgICAgICAgaWQ6ICJjIiwKICAgICAgICBkaW1lbnNpb246ICJuZXN0IgogICAgfSwKXQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgcmVkIGJvdHMgbmV4dCB0byBlYWNoIHRhcmdldCIpOwoKY29uc3QgdGFyZ2V0cyA9IFsKICAgIHsgaWQ6ICJhIiwgZGltZW5zaW9uOiAibmVzdCIgfSwKICAgIHsgaWQ6ICJiIiwgZGltZW5zaW9uOiAibmVzdCIgfSwKICAgIHsgaWQ6ICJjIiwgZGltZW5zaW9uOiAibmVzdCIgfSwKXTsKCmNvbnN0IHBhdGNoUmVzdWx0cyA9IFtdOwoKZm9yIChsZXQgZW50cnkgb2YgdGFyZ2V0cykgewogICAgbGV0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCBlbnRyeS5pZCk7CiAgICBjb25zdCByZWRCb3QgPSBjcmVhdGUoewogICAgICAgIFtlbnRyeS5kaW1lbnNpb25dOiB0cnVlLAogICAgICAgIFtlbnRyeS5kaW1lbnNpb24gKyAnWCddOiB0YXJnZXRCb3QudGFnc1tlbnRyeS5kaW1lbnNpb24gKyAnWCddICsgMSwKICAgICAgICBbZW50cnkuZGltZW5zaW9uICsgJ1knXTogdGFyZ2V0Qm90LnRhZ3NbZW50cnkuZGltZW5zaW9uICsgJ1knXSwKICAgICAgICBjb2xvcjogInJlZCIsCiAgICB9KTsKCiAgICBwYXRjaFJlc3VsdHMucHVzaCh7IGJvdElkOiByZWRCb3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9KTsKfQoKcmV0dXJuIHBhdGNoUmVzdWx0czsKYGBgCgojIyMgRXhhbXBsZSAzCgpgYGBwbGFpbnRleHQKSU5QVVQ6IFRvYXN0IGhlbGxvIHdoZW4gYW55IG9mIHRoZXNlIGJvdHMgYXJlIGNsaWNrZWQuICAKVEFSR0VUX0JPVFM6IFsKICAgIHsKICAgICAgICBpZDogInRhcmdldDEiLAogICAgICAgIGRpbWVuc2lvbjogIm91dHNpZGUiCiAgICB9LAogICAgewogICAgICAgIGlkOiAidGFyZ2V0MiIsCiAgICAgICAgZGltZW5zaW9uOiAib3V0c2lkZSIKICAgIH0KXQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIlNldCB1cCB0b2FzdC1vbi1jbGljayBiZWhhdmlvciIpOyAgCgpjb25zdCB0YXJnZXRzID0gWwogICAgeyBpZDogInRhcmdldDEiLCBkaW1lbnNpb246ICJvdXRzaWRlIiB9LAogICAgeyBpZDogInRhcmdlcjIiLCBkaW1lbnNpb246ICJvdXRzaWRlIiB9LApdOwoKY29uc3QgcGF0Y2hSZXN1bHRzID0gW107Cgpmb3IgKGxldCBlbnRyeSBvZiB0YXJnZXRzKSB7ICAKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgZW50cnkuaWQpOyAgCgogICAgLy8gVGFrZSBzbmFwc2hvdHMgb2YgZWFjaCBib3QgYmVmb3JlIHdlIG1vZGlmeSB0aGVtLgogICAgY29uc3QgcHJlUGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KHRhcmdldEJvdCk7CiAgICAKICAgIC8vIE1vZGlmeSB0aGUgYm90LgogICAgc2V0VGFnKHRhcmdldEJvdCwgIm9uQ2xpY2siLCAiQCBvcy50b2FzdCgnaGVsbG8nKTsiKTsgIAoKICAgIC8vIEFmdGVyIG1vZGlmeWluZyB0aGUgYm90LCBjcmVhdGUgZGlmZiBzbmFwc2hvdHMgYW5kIHN0b3JlIHRoZW0gaW4gdGhlIHJlc3VsdHMgdGhhdCB3ZSByZXR1cm4uCiAgICBjb25zdCBwb3N0UGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KHRhcmdldEJvdCk7CiAgICBwYXRjaFJlc3VsdHMucHVzaCh7IAogICAgICAgIGJvdElkOiB0YXJnZXRCb3QuaWQsIAogICAgICAgIGNyZWF0ZWQ6IGZhbHNlLCAKICAgICAgICByb2xsYmFja0RpZmY6IGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcFNob3QpCiAgICB9KTsKfQoKcmV0dXJuIHBhdGNoUmVzdWx0czsKYGBgCgojIyMgRXhhbXBsZSA0CgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuICAKVEFSR0VUX0JPVFM6IFsKICAgIHsKICAgICAgICBpZDogInNvbWVfaWQiLAogICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICB9LAogICAgewogICAgICAgIGlkOiAiZG9lc250X21hdHRlciIsCiAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgIH0sCl0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIHJlZCBib3RzIGJsdWUiKTsKCmNvbnN0IHJlZEJvdHMgPSBnZXRCb3RzKCJjb2xvciIsICJyZWQiKTsKY29uc3QgcGF0Y2hSZXN1bHRzID0gW107Cgpmb3IgKGNvbnN0IGJvdCBvZiByZWRCb3RzKSB7CiAgICAvLyBUYWtlIHNuYXBzaG90cyBvZiBlYWNoIGJvdCBiZWZvcmUgd2UgbW9kaWZ5IHRoZW0uCiAgICBjb25zdCBwcmVQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QoYm90KTsKCiAgICAvLyBNb2RpZnkgdGhlIGJvdC4KICAgIHNldFRhZyhib3QsICJjb2xvciIsICJibHVlIik7CgogICAgLy8gQWZ0ZXIgbW9kaWZ5aW5nIHRoZSBib3QsIGNyZWF0ZSBkaWZmIHNuYXBzaG90cyBhbmQgc3RvcmUgdGhlbSBpbiB0aGUgcmVzdWx0cyB0aGF0IHdlIHJldHVybi4KICAgIGNvbnN0IHBvc3RQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QoYm90KTsKICAgIHBhdGNoUmVzdWx0cy5wdXNoKHsgCiAgICAgICAgYm90SWQ6IGJvdC5pZCwgCiAgICAgICAgY3JlYXRlZDogZmFsc2UsIAogICAgICAgIHJvbGxiYWNrRGlmZjogZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwU2hvdCkKICAgIH0pOwp9CgpyZXR1cm4gcGF0Y2hSZXN1bHRzOwpgYGAKCiMjIyBFeGFtcGxlIDUKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIGJsdWUgYm90IGFib3ZlIGVhY2ggb2YgdGhlIGdpdmVuIGJvdHMgdGhhdCB0b2FzdHMgaGVsbG8gd2hlbiBob3ZlcmVkLiAgClRBUkdFVF9CT1RTOiBbCiAgICB7CiAgICAgICAgaWQ6ICJiMSIsCiAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgIH0sCiAgICB7CiAgICAgICAgaWQ6ICJiMiIsCiAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgIH0sCiAgICB7CiAgICAgICAgaWQ6ICJiMyIsCiAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgIH0sCl0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGJsdWUgYm90cyBhYm92ZSBlYWNoIHRhcmdldCB0aGF0IHRvYXN0IFwiaGVsbG9cIiBvbiBwb2ludGVyIGVudGVyIik7ICAKCmNvbnN0IHRhcmdldHMgPSBbCiAgICB7IGlkOiAiYjEiLCBkaW1lbnNpb246ICJob21lIiB9LAogICAgeyBpZDogImIyIiwgZGltZW5zaW9uOiAiaG9tZSIgfSwKICAgIHsgaWQ6ICJiMyIsIGRpbWVuc2lvbjogImhvbWUiIH0sCl07Cgpjb25zdCBwYXRjaFJlc3VsdHMgPSBbXTsKCmZvciAobGV0IGVudHJ5IG9mIHRhcmdldHMpIHsgIAogICAgbGV0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCBlbnRyeS5pZCk7ICAKICAgIGNvbnN0IGJsdWVCb3QgPSBjcmVhdGUoeyAgCiAgICAgICAgW2VudHJ5LmRpbWVuc2lvbl06IHRydWUsCiAgICAgICAgW2VudHJ5LmRpbWVuc2lvbiArICdYJ106IHRhcmdldEJvdC50YWdzW2VudHJ5LmRpbWVuc2lvbiArICdYJ10sCiAgICAgICAgW2VudHJ5LmRpbWVuc2lvbiArICdZJ106IHRhcmdldEJvdC50YWdzW2VudHJ5LmRpbWVuc2lvbiArICdZJ10gKyAxLAogICAgICAgIGNvbG9yOiAiYmx1ZSIsCiAgICAgICAgb25Qb2ludGVyRW50ZXI6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIKICAgIH0pOyAgCiAgICAKICAgIHBhdGNoUmVzdWx0cy5wdXNoKHsgYm90SWQ6IGJsdWVCb3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9KTsKfQoKcmV0dXJuIHBhdGNoUmVzdWx0czsKYGBgCicAqcuevA+cfxphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAKnLnrwPpdcDAzIwMCcAqcuevA+cfwlhYlZlcnNpb24CBACpy568D6nXAwUxMC4zOCcAqcuevA+cfw5jaGFubmVsX2NvbmZpZwIEAKnLnrwPr9cDrQ9AY29uc3QgY29uZmlndXJhdGlvbkRhdGEgPSBhd2FpdCBvcy5nZXREYXRhKHRoYXQuZGF0YS5zdHVkaW9JRCwgdGhhdC5kYXRhLnBhdHRlcm5JRCk7CgpsZXQgbmV3RGVwbG95bWVudCA9IGZhbHNlOwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuY2hhbm5lbENvbmZpZ3VyZWQpCnsKICAgIHJldHVybjsKfQoKbGlua3MucmVtZW1iZXIudGFncy5jaGFubmVsQ29uZmlndXJlZCA9IHRydWU7CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zKQp7CiAgICBjb25zdCB0YXJnZXRCaW9zID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zOwoKICAgIHN3aXRjaCAodGFyZ2V0QmlvcykgCiAgICB7CiAgICAgICAgY2FzZSAibG9jYWwiOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Muc3RhdGljSW5zdCA9PSBudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXdEZXBsb3ltZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic3R1ZGlvIjoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLm93bmVyID09IG51bGwgfHwgY29uZmlnQm90LnRhZ3Mub3duZXIgPT0gInB1YmxpYyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzaGFyZWQiOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Mub3duZXIgIT0gInB1YmxpYyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgIH0KfQoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZWdnKQp7CiAgICBjb25zdCB0YXJnZXRQYXR0ZXJuID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5lZ2cucGF0dGVybjsKICAgIGNvbnN0IHRhcmdldFN0dWRpbyA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuZWdnLnN0dWRpbzsKCiAgICBzaG91dCgiaGF0Y2giLCB7YWJJRDogdGFyZ2V0UGF0dGVybiwgcmVjb3JkS2V5OiB0YXJnZXRTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZX0pOwp9CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5ncmlkQ29sb3IpCnsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5ncmlkQ29sb3I7CgogICAgZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENvbG9yID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5ncmlkQ29sb3I7Cn0KCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgJiYgY29uZmlnQm90LnRhZ3MuaW5zdCAhPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgJiYgY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ICE9IG51bGwpCnsKICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwp9CgppZiAobmV3RGVwbG95bWVudCkKewogICAgY29uc3Qgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CiAgICBjb25zdCB0YXJnZXRJbnN0ID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5pbnN0ID8gIiZpbnN0PSIgKyBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgOiAiIjsKICAgIGNvbnN0IHRhcmdldEJpb3MgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3MgPyAiJmJpb3M9IiArIGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvcyA6ICIiOwogICAgY29uc3QgdGFyZ2V0UGF0dGVybiA9IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gPyAiJnBhdHRlcm49IiArIGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gOiAiIjsKICAgIGNvbnN0IHRhcmdldFVSTCA9IHNpdGVPcmlnaW4gKyBgLz9hc2s9JHtjb25maWdCb3QudGFncy5hc2t9JHt0YXJnZXRQYXR0ZXJufSR7dGFyZ2V0SW5zdH0ke3RhcmdldEJpb3N9YDsKCiAgICBvcy5nb1RvVVJMKHRhcmdldFVSTCk7Cn0nAKnLnrwPnH8NY2hhbm5lbExvYWRlcgIEAKnLnrwP3eYDKPCflJdhOWI2YWEwZC1iMzU3LTRkZTYtOWJlZi04NTM0OGFiMWQwZTAnAKnLnrwPnH8JcHJvdG90eXBlAgQAqcuevA+E5wMuQHRoaXNCb3QuYWJDb3JlTWVudUFjdGlvbigiTWFrZSBtZTogIiArIHRoYXQpOycAqcuevA+cfwtwZXJzb25hbGl0eQIEAKnLnrwPs+cDKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAKnLnrwPnH8FdXRpbHMCBACpy568D9rnAyjwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwCpy568D5x/BmNyZWF0ZQIEAKnLnrwPgegDKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAKnLnrwPnH8PaW5wdXRTdWdnZXN0aW9uAgQAqcuevA+o6APyBUBpZiAoIXRhZ3MuaW5wdXRTdWdnZXN0aW9uRW5hYmxlZCkgewogICAgcmV0dXJuOwp9Cgpjb25zdCBpbnB1dEJvdCA9IHRoYXQ/LmlucHV0Qm90Owpjb25zdCB0ZXh0ID0gdGhhdD8udGV4dDsKY29uc3QgYW5pbWF0ZSA9IHRoYXQ/LmFuaW1hdGUgPz8gdHJ1ZTsKCmFzc2VydChpbnB1dEJvdCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpbnB1dEJvdCBpcyBhIHJlcXVpcmVkIHBhcmFtZW10ZXIuYCk7CmFzc2VydCh0ZXh0LCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRleHQgaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CgpsZXQgc3RvcHBlZCA9IGZhbHNlOwoKaWYgKGFuaW1hdGUpIHsKICAgIGNvbnN0IGNoYXJzID0gWy4uLnRleHRdOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGNoYXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGlucHV0Qm90LnRhZ3Muc3RvcFN1Z2dlc3Rpb24pIHsKICAgICAgICAgICAgc3RvcHBlZCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBhd2FpdCBvcy5zbGVlcChtYXRoLnJhbmRvbSgyNSwgMTAwKSk7CiAgICAgICAgaW5wdXRCb3QudGFncy5tZW51SXRlbVRleHQgPSBjaGFycy5zbGljZSgwLCBpKS5qb2luKCcnKTsKICAgIH0KfQoKaWYgKHN0b3BwZWQpIHsKICAgIGlucHV0Qm90LnRhZ3MubWVudUl0ZW1UZXh0ID0gJyc7Cn0gZWxzZSB7CiAgICBpbnB1dEJvdC50YWdzLm1lbnVJdGVtVGV4dCA9IHRleHQ7Cn0nAKnLnrwPnH8VaW5wdXRTdWdnZXN0aW9uV2FpdE1TAgQAqcuevA+b7gMEMzAwMCcAqcuevA+cfw9zdWdnZXN0aW9uc0NvcmUCBACpy568D6DuA+sB8J+nrFsKICAgICJtYWtlIG1lIGEgcmVkIGJvdCB0aGF0IHdoZW4gY2xpY2tlZCB0dXJucyBibHVlIiwKICAgICJtYWtlIG1lIGEgYm90IHRoYXQgd2hlbiBjbGlja2VkIG1ha2VzIGZpcmV3b3JrcyIsCiAgICAibWFrZSBtZSBhIGJvdCB0aGF0IHRvYXN0cyAnaGVsbG8sIHdvcmxkIScgd2hlbiBjbGlja2VkIiwKICAgICJtYWtlIG1lIDMgYm90cywgYSByZWQgb25lLCBibHVlIG9uZSwgYW5kIGdyZWVuIG9uZSIKXScAqcuevA+cfw5zdWdnZXN0aW9uc0JvdAIEAKnLnrwPivADe/Cfp6xbCiAgICAiY2hhbmdlIHRoZSBjb2xvciBvZiB0aGlzIGJvdCB0byBwdXJwbGUiLAogICAgInR1cm4gdGhpcyBib3QgaW50byBhIHNwaGVyZSIsCiAgICAiZG91YmxlIHRoZSBzY2FsZSBvZiB0aGlzIGJvdCIKXScAqcuevA+cfxdzdWdnZXN0aW9uc011bHRpcGxlQm90cwIEAKnLnrwPhPEDjgHwn6esWwogICAgImNoYW5nZSBhbGwgb2YgdGhlc2UgYm90cyBjb2xvciB0byBwdXJwbGUiLAogICAgInR1cm4gYWxsIG9mIHRoZXNlIGJvdHMgaW50byBzcGhlcmVzIiwKICAgICJkb3VibGUgdGhlIHNjYWxlIG9mIGFsbCBvZiB0aGVzZSBib3RzIgpdJwCpy568D5x/CnV1YWJMb2FkZXICBACpy568D5HyAyjwn5SXYjg5ODZmYTYtNTQzYS00ODY0LTg2YzEtNDIyNTc5YTVjYjYwJwCpy568D5x/D3N1Z2dlc3Rpb25zR3JpZAIEAKnLnrwPuPID6wHwn6esWwogICAgIm1ha2UgbWUgYSByZWQgYm90IHRoYXQgd2hlbiBjbGlja2VkIHR1cm5zIGJsdWUiLAogICAgIm1ha2UgbWUgYSBib3QgdGhhdCB3aGVuIGNsaWNrZWQgbWFrZXMgZmlyZXdvcmtzIiwKICAgICJtYWtlIG1lIGEgYm90IHRoYXQgdG9hc3RzICdoZWxsbywgd29ybGQhJyB3aGVuIGNsaWNrZWQiLAogICAgIm1ha2UgbWUgMyBib3RzLCBhIHJlZCBvbmUsIGJsdWUgb25lLCBhbmQgZ3JlZW4gb25lIgpdJwCpy568D5x/BWRlYnVnAgQAqcuevA+i9AMFZmFsc2UnAKnLnrwPnH8OYWJDb3JlTWVudUhpZGUCBACpy568D6j0AwR0cnVlJwCpy568D5x/FmlucHV0U3VnZ2VzdGlvbkVuYWJsZWQCBACpy568D630AwVmYWxzZScBBGJvdHMkZjlmZDdlMmUtN2NjZS00M2ZiLWIyMjMtZDMyY2I0MmJlYmU4AScAqcuevA+z9AMGc3lzdGVtAgQAqcuevA+09AMTYWIuYWN0aW9uLmNvbG9yX2JvdCcAqcuevA+z9AMEZm9ybQIEAKnLnrwPyPQDB25vdGhpbmcnAKnLnrwPs/QDCGFiQWN0aW9uAgQAqcuevA/Q9AMEdHJ1ZScAqcuevA+z9AMPYWJCb3RNZW51QWN0aW9uAgQAqcuevA/V9APaAkBjb25zdCB0YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzOwoKY29uc3Qgc2VsZWN0ZWRDb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dCh0YXJnZXRCb3QudGFncy5jb2xvciwgewogICAgdHlwZTogJ2NvbG9yJywKICAgIHRpdGxlOiAncGljayBhIGNvbG9yJwp9KTsKCmlmIChzZWxlY3RlZENvbG9yICYmIHRhcmdldEJvdC50YWdzLmNvbG9yICE9PSBzZWxlY3RlZENvbG9yKSB7CiAgICB0YXJnZXRCb3QudGFncy5jb2xvciA9IHNlbGVjdGVkQ29sb3I7CiAgICBhYi5saW5rcy5zb3VuZC5hYlBsYXlTb3VuZCh7IHZhbHVlOiAnYWIvYXVkaW8vcGFpbnQgc3ByYXkubXAzJyB9KTsKfQonAKnLnrwPs/QDDmFiQm90TWVudUxhYmVsAgQAqcuevA+w9wMFY29sb3InAKnLnrwPs/QDDWFiQm90TWVudUljb24CBACpy568D7b3AwdwYWxldHRlJwCpy568D7P0AwhyZW1lbWJlcgIEAKnLnrwPvvcDKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAKnLnrwPs/QDEmFiQm90TWVudVNvcnRPcmRlcgIEAKnLnrwP5fcDATInAKnLnrwPs/QDCGFiSWdub3JlAgQAqcuevA/n9wMEdHJ1ZScAqcuevA+z9AMXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBACpy568D+z3A/ADQGNvbnN0IGFsbFRhcmdldEJvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CmNvbnN0IGJ1aWxkZXIgPSBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90ID8gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC5pZCA6IG51bGw7CmNvbnN0IHJlbGV2YW50VGFyZ2V0Qm90cyA9IGFsbFRhcmdldEJvdHMuZmlsdGVyKCh0YXJnZXQpID0+IHRhcmdldC5pZCAhPSBidWlsZGVyKTsKCmNvbnN0IHNlbGVjdGVkQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobnVsbCwgewogICAgdHlwZTogJ2NvbG9yJywKICAgIHRpdGxlOiAncGljayBhIGNvbG9yJwp9KTsKCmlmIChzZWxlY3RlZENvbG9yKSB7CiAgICBzZXRUYWcocmVsZXZhbnRUYXJnZXRCb3RzLCAiY29sb3IiLCBzZWxlY3RlZENvbG9yKTsKCiAgICBhYi5saW5rcy5zb3VuZC5hYlBsYXlTb3VuZCh7IHZhbHVlOiAnYWIvYXVkaW8vcGFpbnQgc3ByYXkubXAzJyB9KTsKfScAqcuevA+z9AMVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAqcuevA/d+wMHcGFsZXR0ZScAqcuevA+z9AMWYWJNdWx0aXBsZUJvdE1lbnVMYWJlbAIEAKnLnrwP5fsDBWNvbG9yJwCpy568D7P0AxphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEAKnLnrwP6/sDATEnAKnLnrwPs/QDCWFiVmVyc2lvbgIEAKnLnrwP7fsDBTEwLjM4JwCpy568D7P0AwtwZXJzb25hbGl0eQIEAKnLnrwP8/sDKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAKnLnrwPs/QDE2FiQm90TWVudUNsaWNrU291bmQCBACpy568D5r8AyJhYi9hdWRpby9wYWludCBzcHJheSBjYW4gc2hha2UubXAzJwCpy568D7P0AxthYk11bHRpcGxlQm90TWVudUNsaWNrU291bmQCBACpy568D738AyJhYi9hdWRpby9wYWludCBzcHJheSBjYW4gc2hha2UubXAzAA=="}]}