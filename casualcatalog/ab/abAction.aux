{"version":2,"updates":[{"id":0,"timestamp":1771613733896,"update":"Ae4CuPSn1QEAJwEEYm90cyQ1ODQ5YWY1NS01ZThhLTQ4ZDYtOTEwNi0xOTk0OThlOWVjMDgBJwC49KfVAQAGc3lzdGVtAgQAuPSn1QEBEWFiLmFjdGlvbi5kZXN0cm95JwC49KfVAQAIYWJBY3Rpb24CBAC49KfVARMEdHJ1ZScAuPSn1QEABGZvcm0CBAC49KfVARgHbm90aGluZycAuPSn1QEAD2FiQm90TWVudUFjdGlvbgIEALj0p9UBIJEDQGNvbnN0IHRhcmdldEJvdCA9IHRoYXQuYm90LmxpbmtzLnRhcmdldEJvdDsKCmlmICh0aGF0LmJvdC5saW5rcy50YXJnZXRPcmlnaW5Cb3RzKSB7CiAgICAvLyBEZXN0cm95IGJvdHMgYmVsb25naW5nIHRvIGFiSURPcmlnaW4uCiAgICBkZXN0cm95KHRoYXQuYm90LmxpbmtzLnRhcmdldE9yaWdpbkJvdHMpOwp9IGVsc2UgewogICAgLy8gRGVzdHJveSB0aGUgc2luZ2xlIHRhcmdldCBib3QuCiAgICBkZXN0cm95KHRhcmdldEJvdCk7Cn0KCmFiLmxpbmtzLnNvdW5kLmFiUGxheVNvdW5kKHsgdmFsdWU6IGFiLmxpbmtzLnNvdW5kLnRhZ3MuZGVmYXVsdERlc3Ryb3lTb3VuZCB9KTsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsnALj0p9UBAA5hYkJvdE1lbnVMYWJlbAIEALj0p9UBsgMHZGVzdHJveScAuPSn1QEADWFiQm90TWVudUljb24CBAC49KfVAboDDmRlbGV0ZV9mb3JldmVyJwC49KfVAQASYWJCb3RNZW51U29ydE9yZGVyAgQAuPSn1QHJAwMxMDAnALj0p9UBAAhyZW1lbWJlcgIEALj0p9UBzQMo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAuPSn1QEADW1hbmlmZXN0YXRpb24CBAC49KfVAfQDKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnALj0p9UBAAhhYklnbm9yZQIEALj0p9UBmwQEdHJ1ZScAuPSn1QEADmFiQm90TWVudUNvbG9yAgQAuPSn1QGgBAcjRDkzMDMwJwC49KfVAQAXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBAC49KfVAagEkQRAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgpkZXN0cm95KHJlbGV2YW50VGFyZ2V0Qm90cyk7CgphYi5saW5rcy5zb3VuZC5hYlBsYXlTb3VuZCh7IHZhbHVlOiBhYi5saW5rcy5zb3VuZC50YWdzLmRlZmF1bHREZXN0cm95U291bmQgfSk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7JwC49KfVAQAVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQAuPSn1QG6CA5kZWxldGVfZm9yZXZlcicAuPSn1QEAFmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBAC49KfVAckIB2Rlc3Ryb3knALj0p9UBABphYk11bHRpcGxlQm90TWVudVNvcnRPcmRlcgIEALj0p9UB0QgDMTAwJwC49KfVAQAWYWJNdWx0aXBsZUJvdE1lbnVDb2xvcgIEALj0p9UB1QgHI0Q5MzAzMCcAuPSn1QEACWFiVmVyc2lvbgIEALj0p9UB3QgFMTAuNDAnALj0p9UBABNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAuPSn1QHjCK0HQGNvbnN0IHRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgppZiAodGFyZ2V0Qm90KSB7CiAgICB0YWdzLmxhYmVsID0gJ2Rlc3Ryb3knOwogICAgdGFncy50YXJnZXRCb3QgPSBnZXRMaW5rKHRhcmdldEJvdCk7CiAgICB0YWdzLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygiU2hpZnQiKSkgewogICAgICAgICAgICBpZiAobGlua3MudGFyZ2V0Qm90ICYmIGxpbmtzLnRhcmdldEJvdC50YWdzLmFiSURPcmlnaW4pIHsKICAgICAgICAgICAgICAgIC8vIENoYW5nZSBidXR0b24gdG8gZGVzdHJveSBhbGwgYm90cyB3aXRoIHNhbWUgYWJJRE9yaWdpbi4KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE9yaWdpbkJvdHMgPSBnZXRCb3RzKGIgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnRhZ3MuYWJJRE9yaWdpbiA9PT0gbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbjsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbWFza3MubGFiZWwgPSAnZGVzdHJveSAnICsgbGlua3MudGFyZ2V0Qm90LnRhZ3MuYWJJRE9yaWdpbiArICcgKCcgKyB0YXJnZXRPcmlnaW5Cb3RzLmxlbmd0aCArICcgYm90cyknOwogICAgICAgICAgICAgICAgdGFncy50YXJnZXRPcmlnaW5Cb3RzID0gZ2V0TGluayh0YXJnZXRPcmlnaW5Cb3RzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGA7CiAgICB0YWdzLm9uS2V5VXAgPSBgQAogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoIlNoaWZ0IikpIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSBudWxsOwogICAgICAgICAgICB0YWdzLnRhcmdldE9yaWdpbkJvdHMgPSBudWxsOwogICAgICAgIH0KICAgIGA7Cn0gZWxzZSB7CiAgICAvLyBObyBib3QgdG8gZGVzdHJveS4KICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nALj0p9UBABthYk11bHRpcGxlQm90TWVudU9uR2VuZXJhdGUCBAC49KfVAZEQ7wRAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKSA/IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA6IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXNdOwpjb25zdCBidWlsZGVyID0gYWIubGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCA/IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QuaWQgOiBudWxsOwpjb25zdCByZWxldmFudFRhcmdldEJvdHMgPSBhbGxUYXJnZXRCb3RzLmZpbHRlcigodGFyZ2V0KSA9PiB0YXJnZXQuaWQgIT0gYnVpbGRlcik7CgppZiAocmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aCA+IDEpIHsKICAgIC8vIE11bHRpcGxlIGJvdHMuCiAgICB0YWdzLmxhYmVsID0gYGRlc3Ryb3kgKCR7cmVsZXZhbnRUYXJnZXRCb3RzLmxlbmd0aH0gYm90cylgOwp9IGVsc2UgaWYgKHJlbGV2YW50VGFyZ2V0Qm90cy5sZW5ndGggPT09IDEpIHsKICAgIC8vIFNpbmdsZSBib3QuCiAgICB0YWdzLmxhYmVsID0gYGRlc3Ryb3lgOwp9IGVsc2UgewogICAgLy8gTm8gYm90cyB0byBkZXN0cm95LgogICAgZGVzdHJveSh0aGlzQm90KTsKfScBBGJvdHMkNWFlYzUwMWMtMzM4YS00MmNjLTlmZGQtOWExZWVhOTUzYTA2AScAuPSn1QGBFQZzeXN0ZW0CBAC49KfVAYIVEGFiLmFjdGlvbi51cGRhdGUnALj0p9UBgRUIYWJBY3Rpb24CBAC49KfVAZMVBHRydWUnALj0p9UBgRUQYWJDb3JlTWVudUFjdGlvbgIEALj0p9UBmBXdBEBpZiAoIWFiVXBkYXRlQ2hlY2tlci50YWdzLmNoZWNraW5nKSB7CiAgICBpZiAoYWJVcGRhdGVDaGVja2VyLnRhZ3MudXBkYXRlQXZhaWxhYmxlKSB7CiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ0luc3RhbGwgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgdXBkYXRlcz8nLAogICAgICAgICAgICBjb250ZW50OiAnV291bGQgeW91IGxpa2UgdG8gaW5zdGFsbCB0aGUgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgdXBkYXRlcz8gWW91IGFuZCBhbnkgY29ubmVjdGVkIHVzZXJzIHdpbGwgYXV0b21hdGljYWxseSByZWZyZXNoIHRoZSBwYWdlIGFmdGVyIHRoZSB1cGRhdGUgaXMgY29tcGxldGUuJywKICAgICAgICAgICAgY2FuY2VsVGV4dDogJ05vdCBub3cnLAogICAgICAgICAgICBjb25maXJtVGV4dDogJ1llcycKICAgICAgICB9KQoKICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgIGFiLnVwZGF0ZUFCKCk7CiAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfQogICAgfQp9JwC49KfVAYEVBGZvcm0CBAC49KfVAfYZB25vdGhpbmcnALj0p9UBgRUIYWJJZ25vcmUCBAC49KfVAf4ZBHRydWUnALj0p9UBgRUTYWJDb3JlTWVudVNvcnRPcmRlcgIEALj0p9UBgxoDMTAyJwC49KfVAYEVDmFiQ29yZU1lbnVJY29uAgQAuPSn1QGHGgZ1cGRhdGUnALj0p9UBgRUPYWJDb3JlTWVudUxhYmVsAgQAuPSn1QGOGgZ1cGRhdGUnALj0p9UBgRUUYWJDb3JlTWVudU9uR2VuZXJhdGUCBAC49KfVAZUa/A1AaWYgKCFnbG9iYWxUaGlzLmFiVXBkYXRlQ2hlY2tlcikgewogICAgZGVzdHJveSh0aGlzQm90KTsKICAgIHJldHVybjsKfQoKdGFncy5yZWZyZXNoRGlzcGxheSA9IGBACiAgICBpZiAodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpIHsKICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IG51bGw7CiAgICB9CgogICAgLy8gQ2xlYXIgdGFnIG1hc2tzLgogICAgbWFza3MuYWJNZW51ID0gbnVsbDsKICAgIG1hc2tzLmxhYmVsID0gbnVsbDsKICAgIG1hc2tzLmNvbG9yID0gbnVsbDsKICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gbnVsbDsKICAgIAogICAgaWYgKGFiVXBkYXRlQ2hlY2tlci50YWdzLnVwZGF0ZUF2YWlsYWJsZSkgewogICAgICAgIG1hc2tzLmxhYmVsID0gJ3VwZGF0ZSAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwogICAgICAgIG1hc2tzLmNvbG9yID0gJyNBNEREMDAnOwogICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gJ3VwZGF0ZSc7CiAgICB9IGVsc2UgewogICAgICAgIGlmIChhYlVwZGF0ZUNoZWNrZXIudGFncy5jaGVja2luZykgewogICAgICAgICAgICAvLyBUZW1wb3JhcmlseSByZXBsYWNlIHdpdGggYnVzeSBpbmRpY2F0b3Igd2hpbGUgY2hlY2tpbmcgZm9yIHVwZGF0ZXMuCiAgICAgICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gYWIubGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yKHsKICAgICAgICAgICAgICAgIGFiTWVudTogdHJ1ZSwKICAgICAgICAgICAgICAgIGxhYmVsOiAnY2hlY2tpbmcgZm9yIHVwZGF0ZXMgdG8gJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgICAgIGFiTWVudVNvcnRPcmRlcjogdGFncy5hYk1lbnVTb3J0T3JkZXIsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgbWFza3MuYWJNZW51ID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQUIgaXMgdXAtdG8tZGF0ZS4KICAgICAgICAgICAgbWFza3MuYWJNZW51ID0gZmFsc2U7CiAgICAgICAgfQogICAgfQpgOwoKdGFncy5vbkRlc3Ryb3kgPSBgQAogICAgaWYgKHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKSB7CiAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgdGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IgPSBudWxsOwogICAgfQoKICAgIGlmICh0aGlzQm90LnZhcnMub25BQlVwZGF0ZUNoZWNrZXJCb3RDaGFuZ2VkKSB7CiAgICAgICAgb3MucmVtb3ZlQm90TGlzdGVuZXIoYWJVcGRhdGVDaGVja2VyLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uQUJVcGRhdGVDaGVja2VyQm90Q2hhbmdlZCk7CiAgICB9CmAKCnRoaXNCb3QudmFycy5vbkFCVXBkYXRlQ2hlY2tlckJvdENoYW5nZWQgPSAobGlzdGVuZXJUaGF0KSA9PiB7CiAgICBjb25zdCBuZWVkUmVmcmVzaERpc3BsYXkgPSBsaXN0ZW5lclRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2NoZWNraW5nJyB8fCB0ID09PSAndXBkYXRlQXZhaWxhYmxlJyk7CiAgICBpZiAobmVlZFJlZnJlc2hEaXNwbGF5KSB7CiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgfQp9Cgpvcy5hZGRCb3RMaXN0ZW5lcihhYlVwZGF0ZUNoZWNrZXIsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25BQlVwZGF0ZUNoZWNrZXJCb3RDaGFuZ2VkKTsKCnRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsnALj0p9UBgRUJYWJWZXJzaW9uAgQAuPSn1QGSKAUxMC40MCcBBGJvdHMkNmIzZDk3NDQtNDQ0OC00ZWY1LTk2YTItNzEyODFjNDJhZjZjAScAuPSn1QGYKAlhYlZlcnNpb24CBAC49KfVAZkoBTEwLjQwJwC49KfVAZgoBnN5c3RlbQIEALj0p9UBnygRYWIuYWN0aW9uLnZlcnNpb24nALj0p9UBmCgUYWJBY3Rpb25NYWpvclZlcnNpb24CBAC49KfVAbEoATInALj0p9UBmCgNb25Ta2lsbFVwZGF0ZQIEALj0p9UBsyiZAUBjb25zdCB2ZXJzaW9uU3RyaW5nID0gdGFncy5hYkFjdGlvbk1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJBY3Rpb25NaW5vclZlcnNpb247Cgpjb25zb2xlLmxvZygiW0FCQWN0aW9uXSBMb2FkZWQgQUIgQWN0aW9uIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAuPSn1QGYKAhhYklnbm9yZQIEALj0p9UBzSkEdHJ1ZScAuPSn1QGYKAhhYkFjdGlvbgIEALj0p9UB0ikEdHJ1ZScAuPSn1QGYKARmb3JtAgQAuPSn1QHXKQdub3RoaW5nJwC49KfVAZgoFGFiQWN0aW9uTWlub3JWZXJzaW9uAgQAuPSn1QHfKQEzJwEEYm90cyQ3MTc1NjQ1Yy00YjUzLTQ0NTQtODcxNi1mYzBlNjhkYjI2NjUBJwC49KfVAeEpBnN5c3RlbQIEALj0p9UB4ikPYWIuYWN0aW9uLmxvZ2luJwC49KfVAeEpCGFiQWN0aW9uAgQAuPSn1QHyKQR0cnVlJwC49KfVAeEpCGFiSWdub3JlAgQAuPSn1QH3KQR0cnVlJwC49KfVAeEpBGZvcm0CBAC49KfVAfwpB25vdGhpbmcnALj0p9UB4SkPYWJDb3JlTWVudUNvbG9yAgQAuPSn1QGEKgcjRjJCNzA1JwC49KfVAeEpE2FiQ29yZU1lbnVTb3J0T3JkZXICBAC49KfVAYwqAi01JwC49KfVAeEpEGFiQ29yZU1lbnVBY3Rpb24CBAC49KfVAY8qG0Bhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOycAuPSn1QHhKRRhYkNvcmVNZW51T25HZW5lcmF0ZQIEALj0p9UBqyrrAUB0YWdzLmFiTWVudSA9IGZhbHNlOyAvLyBLZWVwIGJ1dHRvbiBoaWRkZW4gdW50aWwgYXV0aCBjaGVjayBpcyBjb21wbGV0ZS4KYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmIChhdXRoQm90KSB7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9IGVsc2UgewogICAgdGFncy5hYk1lbnUgPSB0cnVlOwogICAgdGFncy5vbkFCQXV0aEJvdEFkZGVkID0gYEBkZXN0cm95KHRoaXNCb3QpO2A7Cn0nALj0p9UB4SkOYWJDb3JlTWVudUljb24CBAC49KfVAZcsBWxvZ2luJwC49KfVAeEpCHJlbWVtYmVyAgQAuPSn1QGdLCjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC49KfVAeEpCWFiVmVyc2lvbgIEALj0p9UBxCwFMTAuNDAnALj0p9UB4SkLcGVyc29uYWxpdHkCBAC49KfVAcosKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInALj0p9UB4SkPYWJDb3JlTWVudUxhYmVsAgQAuPSn1QHxLAdzaWduIGluJwC49KfVAeEpDmFiQ29yZU1lbnVIaWRlAgQAuPSn1QH5LAR0cnVlJwC49KfVAeEpDm9uQW55Qm90c0FkZGVkAgQAuPSn1QH+LP4CQGlmICh0aGF0LmJvdHMpIHsKICAgIGNvbnN0IGFkZGVkQXV0aEJvdCA9IHRoYXQuYm90cy5maW5kKGIgPT4gYiA9PT0gZ2xvYmFsVGhpcy5hdXRoQm90KTsKCiAgICBpZiAoYWRkZWRBdXRoQm90KSB7CiAgICAgICAgdGhpc0JvdC52YXJzLmF1dGhCb3RJZCA9IGFkZGVkQXV0aEJvdC5pZDsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhdXRoIGJvdCBhZGRlZC4gYXV0aEJvdCBpZDogJHt0aGlzQm90LnZhcnMuYXV0aEJvdElkfWApOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoJ29uQUJBdXRoQm90QWRkZWQnLCB7IGF1dGhCb3Q6IGFkZGVkQXV0aEJvdCB9KTsKICAgIH0KfScAuPSn1QHhKQVkZWJ1ZwIEALj0p9UB/S8FZmFsc2UnALj0p9UB4SkQb25BbnlCb3RzUmVtb3ZlZAIEALj0p9UBgzCjA0BpZiAodGhhdC5ib3RJRHMgJiYgdGhpc0JvdC52YXJzLmF1dGhCb3RJZCkgewogICAgY29uc3QgcmVtb3ZlZEF1dGhCb3RJZCA9IHRoYXQuYm90SURzLnNvbWUoaWQgPT4gaWQgPT09IHRoaXNCb3QudmFycy5hdXRoQm90SWQpOwoKICAgIGlmIChyZW1vdmVkQXV0aEJvdElkKSB7CiAgICAgICAgdGhpc0JvdC52YXJzLmF1dGhCb3RJZCA9IG51bGw7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXV0aCBib3QgcmVtb3ZlZC4gYXV0aEJvdCBpZDogJHtyZW1vdmVkQXV0aEJvdElkfWApOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoJ29uQUJBdXRoQm90UmVtb3ZlZCcsIHsgYXV0aEJvdElkOiByZW1vdmVkQXV0aEJvdElkIH0pOwogICAgfQp9JwEEYm90cyRiMzM5YzExOC00ODlhLTQ2NmItYmE5Zi1iMDdhNWY5YjY2NGYBJwC49KfVAaczBnN5c3RlbQIEALj0p9UBqDMPYWIuYWN0aW9uLnBhc3RlKAC49KfVAaczCGFiQWN0aW9uAXgnALj0p9UBpzMEZm9ybQIEALj0p9UBuTMHbm90aGluZycAuPSn1QGnMwtkZXNjcmlwdGlvbgIEALj0p9UBwTMrYWIgc2tpbGwgdXNlZCBmb3IgY29weWluZyBhbmQgcGFzdGluZyBib3RzLicAuPSn1QGnMwdvblBhc3RlAgQAuPSn1QHtM/8HQGlmICghYnVpbGRlclZlcnNpb24pCnsKICAgIHJldHVybjsKfQoKY29uc3QgTUFDUk9TID0gWwogICAgewogICAgICAgIHRlc3Q6IC8oPzpb4oCc4oCdXSkvZywKICAgICAgICByZXBsYWNlbWVudDogKHZhbCkgPT4gJyInLAogICAgfSwKICAgIHsKICAgICAgICB0ZXN0OiAvKD86W+KAmOKAmV0pL2csCiAgICAgICAgcmVwbGFjZW1lbnQ6ICh2YWwpID0+ICInIiwKICAgIH0sCl07CgpsZXQgZm9ybWF0dGVkQ29weSA9IHJlcGxhY2VNYWNyb3ModGhhdC50ZXh0KTsKbGV0IGNvcHlCb3QgPSBKU09OLnBhcnNlKGZvcm1hdHRlZENvcHkpOwpsZXQgcGFzdGVkRGF0YSA9ICFjb3B5Qm90LnN0YXRlID8ge1tjb3B5Qm90LmlkXTogY29weUJvdH0gOiBjb3B5Qm90LnN0YXRlOwpsZXQgZGltTW9kID0gbGlua3MucmVtZW1iZXIudGFncy5hYkZvY3VzRGF0YTsKCmlmIChPYmplY3Qua2V5cyhwYXN0ZWREYXRhKS5sZW5ndGggPT0gMSAmJiBkaW1Nb2QpCnsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgcGFzdGVkRGF0YVtkaW1Nb2QuZGltZW5zaW9uKyJYIl0gPSBkaW1Nb2QueDsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbisiWSJdID0gZGltTW9kLnk7CgogICAgb3MudG9hc3QoImJvdCBhZGRlZCB0byBpbnN0Iik7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgiYm90cyBhZGRlZCB0byBpbnN0Iik7Cn0KCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogcGFzdGVkIGRhdGEiKTsKCmxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IHBhc3RlZERhdGEsIHNvdXJjZUV2ZW50OiAncGFzdGUnfSk7CgpmdW5jdGlvbiByZXBsYWNlTWFjcm9zKHRleHQpIHsKICAgIGlmICghdGV4dCkgewogICAgICAgIHJldHVybiB0ZXh0OwogICAgfQoKICAgIGZvciAobGV0IG0gb2YgTUFDUk9TKSB7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShtLnRlc3QsIG0ucmVwbGFjZW1lbnQpOwogICAgfQoKICAgIHJldHVybiB0ZXh0Owp9JwC49KfVAaczCHJlbWVtYmVyAgQAuPSn1QHlOyjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC49KfVAaczBmNyZWF0ZQIEALj0p9UBjDwo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycAuPSn1QGnMwhhYklnbm9yZQIEALj0p9UBszwEdHJ1ZScAuPSn1QGnMwlvbktleURvd24CBAC49KfVAbg8gwZAaWYgKCFidWlsZGVyVmVyc2lvbiB8fCAoIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMgJiYgIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cykpIHsKICAgIHJldHVybjsKfQoKaWYgKHRoYXQua2V5cyA9PSAiYyIpIHsKICAgIGxldCBtZXRhSW5wdXQgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJNZXRhIik7CgogICAgaWYgKCFtZXRhSW5wdXQpIHsKICAgICAgICBtZXRhSW5wdXQgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJDb250cm9sIik7CiAgICB9CgogICAgaWYgKCFtZXRhSW5wdXQpIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IHNlbGVjdGVkQm90cyA9IFtdOwoKICAgIGlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzKSB7CiAgICAgICAgc2VsZWN0ZWRCb3RzLnB1c2gobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cyk7CiAgICB9CiAgICBlbHNlIGlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmtzLnJlbWVtYmVyLmxpbmtzICAgIC5hYk11bHRpcGxlQm90Rm9jdXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc2VsZWN0ZWRCb3RzLnB1c2gobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzW2ldKTsKICAgICAgIH0KICAgIH0KIAogICAgdGhpc0JvdC5hYkNvcHlCb3RzVG9DbGlwYm9hcmQoeyBib3RzOiBzZWxlY3RlZEJvdHMgfSk7Cn0nALj0p9UBpzMJYWJWZXJzaW9uAgQAuPSn1QG8QgUxMC40MCcAuPSn1QGnMwtwZXJzb25hbGl0eQIEALj0p9UBwkIo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAuPSn1QGnMxVhYkNvcHlCb3RzVG9DbGlwYm9hcmQCBAC49KfVAelCkApAbGV0IGJvdHMgPSB0aGF0LmJvdHM7CmxldCBvblByZXByb2Nlc3NCZWZvcmVDb3B5ID0gdGhhdC5vblByZXByb2Nlc3NCZWZvcmVDb3B5OwpsZXQgc291cmNlRXZlbnQgPSB0aGF0LnNvdXJjZUV2ZW50OwoKbGV0IGJvdHNUb0NvcHkgPSBbXTsKCmlmIChBcnJheS5pc0FycmF5KGJvdHMpKSB7CiAgICBmb3IgKGNvbnN0IGJvdCBvZiBib3RzKSB7CiAgICAgICAgaWYgKGFiLmxpbmtzLnV0aWxzLmlzQm90KGJvdCkpIHsKICAgICAgICAgICAgYm90c1RvQ29weS5wdXNoKGJvdCk7CiAgICAgICAgfQogICAgfQp9IGVsc2UgewogICAgaWYgKGFiLmxpbmtzLnV0aWxzLmlzQm90KGJvdHMpKSB7CiAgICAgICAgYm90c1RvQ29weS5wdXNoKGJvdHMpOwogICAgfQp9CgppZiAoYm90c1RvQ29weS5sZW5ndGggPiAwKSB7CiAgICAvLyBMZXQgYWxsIGJvdHMga25vdyB0aGF0IGFiIGlzIGFib3V0IHRvIGNvcHkgc29tZSBib3RzLgogICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHNob3V0KCdvbkFCQmVmb3JlQ29weUJvdHNUb0NsaXBib2FyZCcsIHsgYm90czogYm90c1RvQ29weSwgc291cmNlRXZlbnQgfSkpOwogICAgCiAgICBjb25zdCBzdGF0ZSA9IHt9OwoKICAgIGZvciAoY29uc3QgYm90IG9mIGJvdHNUb0NvcHkpIHsKICAgICAgICBzdGF0ZVtib3QuaWRdID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShib3QpKTsKICAgIH0KCiAgICAvLyBEbyBhIHByZXByb2Nlc3NpbmcgcGFzcyB0aGF0IGFsbG93cyBsaXN0ZW5lcnMgdG8gcHJlcHJvY2VzcyB0aGUgYm90IGRhdGEgYmVmb3JlIGl0IGlzIGNvcGllZC4KICAgIGNvbnN0IHByZXByb2Nlc3NBcmcgPSB7IGJvdERhdGE6IHN0YXRlLCBzb3VyY2VFdmVudCB9OwoKICAgIGlmIChvblByZXByb2Nlc3NCZWZvcmVDb3B5KSB7CiAgICAgICAgYXdhaXQgb25QcmVwcm9jZXNzQmVmb3JlQ29weShwcmVwcm9jZXNzQXJnKTsKICAgIH0KCiAgICBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoc2hvdXQoJ29uQUJQcmVwcm9jZXNzQmVmb3JlQ29weUJvdHNUb0NsaXBib2FyZCcsIHByZXByb2Nlc3NBcmcpKTsKICAgIAogICAgLy8gU2VyaWFsaXplIHRvIHYxIGF1eCBmaWxlLCBhbmQgdGhlbiBjb3B5IHRvIGNsaXBib2FyZC4KICAgIGNvbnN0IGF1eCA9IEpTT04uc3RyaW5naWZ5KHsgdmVyc2lvbjogMSwgc3RhdGUgfSk7CiAgICBvcy5zZXRDbGlwYm9hcmQoYXV4KTsKCiAgICBhYi5saW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KGBjb3BpZWQgJHtib3RzVG9Db3B5Lmxlbmd0aCA+IDEgPyAnYm90cycgOiAnYm90J30gdG8gY2xpcGJvYXJkYCk7Cn0nAQRib3RzJGJkYWJkNmMwLTg5ZjktNGY3NS1iMzVjLTI2ZjRlYzUyMDdkNgEnALj0p9UB+kwGc3lzdGVtAgQAuPSn1QH7TBBhYi5hY3Rpb24ucmVwb3J0JwC49KfVAfpMBGZvcm0CBAC49KfVAYxNB25vdGhpbmcnALj0p9UB+kwQYWJDb3JlTWVudUFjdGlvbgIEALj0p9UBlE0RQG9zLnJlcG9ydEluc3QoKTsnALj0p9UB+kwTYWJDb3JlTWVudVNvcnRPcmRlcgIEALj0p9UBpk0DMTAxJwC49KfVAfpMDmFiQ29yZU1lbnVJY29uAgQAuPSn1QGqTQRmbGFnJwC49KfVAfpMD2FiQ29yZU1lbnVMYWJlbAIEALj0p9UBr00GcmVwb3J0JwC49KfVAfpMCGFiQWN0aW9uAgQAuPSn1QG2TQR0cnVlJwC49KfVAfpMCGFiSWdub3JlAgQAuPSn1QG7TQR0cnVlJwC49KfVAfpMFGFiQ29yZU1lbnVPbkdlbmVyYXRlAgQAuPSn1QHATUZAaWYgKGNvbmZpZ0JvdC50YWdzLnN0YXRpY0luc3QgIT0gdW5kZWZpbmVkKQp7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwC49KfVAfpMCWFiVmVyc2lvbgIEALj0p9UBh04FMTAuNDAnAQRib3RzJGM2OGM1YjgyLWMwYTctNGE1YS05MTA0LTVkZDhlMzJhZTRlMgEnALj0p9UBjU4Gc3lzdGVtAgQAuPSn1QGOThBhYi5hY3Rpb24ucG9ydGFsJwC49KfVAY1OC2Rlc2NyaXB0aW9uAgQAuPSn1QGfThRTa2lsbCB0byBvcGVuIHNoZWV0LicAuPSn1QGNTghhYkFjdGlvbgIEALj0p9UBtE4EdHJ1ZScAuPSn1QGNTgRmb3JtAgQAuPSn1QG5Tgdub3RoaW5nJwC49KfVAY1OEGFiQ29yZU1lbnVBY3Rpb24CBAC49KfVAcFOA0AvLycAuPSn1QGNTghyZW1lbWJlcgIEALj0p9UBxU4o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAuPSn1QGNTg9hYkNvcmVNZW51TGFiZWwCBAC49KfVAexOEGN1cnJlbnQgcG9ydGFsOiAnALj0p9UBjU4PYWJCb3RNZW51QWN0aW9uAgQAuPSn1QH9TqgDQApjb25zdCBzZWxlY3RlZEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgppZiAoc2VsZWN0ZWRCb3QpIHsKICAgIGNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCiAgICBpZiAoc3RhdGUpIHsKICAgICAgICAvLyBPcGVuIHNoZWV0IHBvcnRhbCBpbiBuZXcgdGFiLgogICAgICAgIG9zLm9wZW5VUkwoY29uZmlnQm90LnRhZ3MucGVybWFsaW5rICsgYCZzaGVldFBvcnRhbD0ke3NlbGVjdGVkQm90LmlkfWApOwogICAgfSBlbHNlIHsKICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9IHNlbGVjdGVkQm90LmlkOwogICAgfQoKICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogb3BlbmVkIGJvdCBzaGVldCIpOwp9CicAuPSn1QGNTg5hYkJvdE1lbnVMYWJlbAIEALj0p9UBplIOb3BlbiBib3Qgc2hlZXQnALj0p9UBjU4NbWFuaWZlc3RhdGlvbgIEALj0p9UBtVIo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAuPSn1QGNTg1hYkJvdE1lbnVJY29uAgQAuPSn1QHcUgp0YWJsZV92aWV3JwC49KfVAY1ODmFiQ29yZU1lbnVJY29uAgQAuPSn1QHnUgthcnJvd19yaWdodCcAuPSn1QGNThJhYkJvdE1lbnVTb3J0T3JkZXICBAC49KfVAfNSATEnALj0p9UBjU4IYWJJZ25vcmUCBAC49KfVAfVSBHRydWUnALj0p9UBjU4XYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBAC49KfVAfpS1ARAY29uc3QgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwpjb25zdCBtdWx0aXBsZVNlbGVjdERpbSA9ICJhYk11bHRpcGxlU2VsZWN0IjsKCmNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gbXVsdGlwbGVTZWxlY3REaW07CgpzZXRUYWdNYXNrKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cywgbXVsdGlwbGVTZWxlY3REaW0sIHRydWUsICJ0ZW1wTG9jYWwiKTsKCm1hc2tzLmN1cnJlbnRTaGVldEJvdHMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiTXVsdGlwbGVCb3RGb2N1czsKbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgaWYgKHRoYXQuZGltZW5zaW9uICE9ICJhYk11bHRpcGxlU2VsZWN0IiAmJiB0aGF0LnBvcnRhbCA9PSAic2hlZXRQb3J0YWwiKSB7CiAgICAgICAgY2xlYXJUYWdNYXNrcyhsaW5rcy5jdXJyZW50U2hlZXRCb3RzKTsKICAgICAgICBjbGVhclRhZ01hc2tzKHRoaXNCb3QpOwogICAgfQp9KTsKCmFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogb3BlbmVkIG11bHRpcGxlIHNlbGVjdCBzaGVldCIpOycAuPSn1QGNThZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAuPSn1QHPVwpvcGVuIHNoZWV0JwC49KfVAY1OFWFiTXVsdGlwbGVCb3RNZW51SWNvbgIEALj0p9UB2lcKdGFibGVfdmlldycAuPSn1QGNThNhYkJvdE1lbnVPbkdlbmVyYXRlAgQAuPSn1QHlV+wBQGxldCBzZWxlY3RlZEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7Cgp0YWdzLmxhYmVsID0gYG9wZW4gc2hlZXRgOwoKdGFncy5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsKdGFncy5vbktleVVwID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gbnVsbDt9YDsnALj0p9UBjU4aYWJNdWx0aXBsZUJvdE1lbnVTb3J0T3JkZXICBAC49KfVAdJZATAnALj0p9UBjU4EbWVudQIEALj0p9UB1Fko8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAuPSn1QGNTglhYlZlcnNpb24CBAC49KfVAftZBTEwLjQwJwC49KfVAY1OC2FiQmx1ZXByaW50AgQAuPSn1QGBWvsDQGNvbnN0IGJhY2tncm91bmRDb2xvciA9IGxpbmtzLnJlbWVtYmVyPy50YWdzLmFiQmx1ZXByaW50Q29sb3IgPz8gIiMxNzg1QjUiOwoKaWYgKGJhY2tncm91bmRDb2xvciA9PSBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yKQp7CiAgICByZXR1cm47Cn0KCmdyaWRQb3J0YWxCb3QubWFza3MucG9ydGFsQ29sb3IgPSBiYWNrZ3JvdW5kQ29sb3I7CgptYXNrcy5vblBvcnRhbENoYW5nZWQgPSBgQCBpZiAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIHRoYXQuZGltZW5zaW9uICE9ICJibHVlcHJpbnQiKXsKICAgIC8vIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQmFzZUNvbG9yID0gbnVsbDsKICAgIC8vIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQmFzZVN0cm9rZUNvbG9yID0gbnVsbDsKCiAgICBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbENvbG9yID0gbnVsbDsKCiAgICBtYXNrcy5vblBvcnRhbENoYW5nZWQgPSBudWxsOwp9YDsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7JwC49KfVAY1OC29uQW55Q3JlYXRlAgQAuPSn1QH9XaUBQGlmICh0aGF0LmJvdC50YWdzLmJsdWVwcmludCkKewogICAgaWYgKCF0aGF0LmJvdC50YWdzLmFiQm90KSB7CiAgICAgICAgdGhhdC5ib3QudGFncy5zdHJva2VDb2xvciA9ICIjZmZmZmZmIjsKICAgIH0KICAgIAogICAgdGhhdC5ib3QudGFncy5sYWJlbENvbG9yID0gIiNmZmZmZmYiOwp9JwC49KfVAY1OD29uUG9ydGFsQ2hhbmdlZAIEALj0p9UBo19hQGlmICh0aGF0LnBvcnRhbCA9PSAiZ3JpZFBvcnRhbCIgJiYgdGhhdC5kaW1lbnNpb24gPT0gImJsdWVwcmludCIpCnsKICAgIHRoaXNCb3QuYWJCbHVlcHJpbnQoKTsKfScAuPSn1QGNTgtwZXJzb25hbGl0eQIEALj0p9UBhWAo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAuPSn1QGNThJhYkNvcmVNZW51SXRlbVR5cGUCBAC49KfVAaxgCGRyb3Bkb3duJwC49KfVAY1OEWRyb3Bkb3duU29ydE9yZGVyAgQAuPSn1QG1YAExJwC49KfVAY1OD2Ryb3Bkb3duT3B0aW9ucwIEALj0p9UBt2AG8J+nrFtdJwC49KfVAY1OGGFiQ29yZU1lbnVPbkJlZm9yZUNyZWF0ZQIEALj0p9UBvGDiHkBjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgY3VycmVudERpbSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQpjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KY29uc3QgcGVybWFsaW5rVVJMID0gY29uZmlnQm90LnRhZ3MucGVybWFsaW5rOw0KY29uc3QgYWN0aXZlSW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7DQpjb25zdCBhY3RpdmVCaW9zID0gY29uZmlnQm90LnRhZ3Mub3duZXIgPyAiJm93bmVyPSIgKyBjb25maWdCb3QudGFncy5vd25lciA6IGZhbHNlOw0KY29uc3QgZmlyc3RJbmRleCA9IHBlcm1hbGlua1VSTC5pbmRleE9mKCImIik7DQpjb25zdCBpbml0aWFsVVJMID0gcGVybWFsaW5rVVJMLnN1YnN0cmluZygwLCBmaXJzdEluZGV4KTsNCmNvbnN0IHVwZGF0ZWRVUkwgPSBhY3RpdmVCaW9zICE9IGZhbHNlID8gaW5pdGlhbFVSTCArICImaW5zdD0iICsgYWN0aXZlSW5zdCA6IGluaXRpYWxVUkw7DQoNCnNldFRhZ01hc2sodGhpc0JvdCwgImFiQ29yZU1lbnVMYWJlbCIsYG1vZGU6ICR7Y3VycmVudFBvcnRhbH0gcG9ydGFsYCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJjdXJyZW50RGltZW5zaW9uIiwgY3VycmVudERpbSk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJjdXJyZW50UG9ydGFsIiwgY3VycmVudFBvcnRhbCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJkcm9wZG93blNvcnRPcmRlciIsIDEpOw0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJQb3J0YWxNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsNCm1lbnVPcHRpb25zLm9uS2V5VXAgPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSBudWxsO31gOw0KbWVudU9wdGlvbnMuc2tpbGxCb3QgPSBnZXRMaW5rKHRoaXNCb3QpOw0KbWVudU9wdGlvbnMudGFyZ2V0VVJMID0gdXBkYXRlZFVSTDsNCg0KY29uc3QgbWFwTWVudUJvdCA9IHsNCiAgICAuLi5tZW51T3B0aW9ucw0KfTsNCg0KbWFwTWVudUJvdC5sYWJlbCA9ICJtYXAgcG9ydGFsIjsNCm1hcE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAicHVibGljIjsNCm1hcE1lbnVCb3Qub25DbGljayA9IGBAIA0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZtYXBQb3J0YWw9JHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iKTsNCn0NCmVsc2UNCnsNCiAgICBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSAiJHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iOw0KICAgIGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPSBudWxsOw0KfWA7DQoNCmlmIChjdXJyZW50UG9ydGFsICE9ICJtYXAiKQ0Kew0KICAgIC8vbWFwIHBvcnRhbCBidXR0b24NCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtYXBNZW51Qm90KTsNCn0NCg0KY29uc3QgZ3JpZE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQpncmlkTWVudUJvdC5sYWJlbCA9ICJncmlkIHBvcnRhbCI7DQpncmlkTWVudUJvdC5mb3JtQWRkcmVzcyA9ICJjdWJlIjsNCmdyaWRNZW51Qm90Lm9uQ2xpY2sgPSBgQA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9JHtjdXJyZW50RGltID09ICJibHVlcHJpbnQiID8gImhvbWUiIDogY3VycmVudERpbX0iKTsNCn0gDQplbHNlDQp7DQogICAgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9ICIke2N1cnJlbnREaW0gPT0gImJsdWVwcmludCIgPyAiaG9tZSIgOiBjdXJyZW50RGltfSI7IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IG51bGw7DQp9YDsNCg0KaWYgKGN1cnJlbnRQb3J0YWwgIT0gImdyaWQiIHx8IGN1cnJlbnREaW0gPT0gImJsdWVwcmludCIpDQp7DQogICAgLy9ncmlkIHBvcnRhbCBidXR0b24NCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChncmlkTWVudUJvdCk7DQp9DQoNCmNvbnN0IGJsdWVwcmludE1lbnVCb3QgPSB7DQogICAgLi4ubWVudU9wdGlvbnMNCn07DQoNCmJsdWVwcmludE1lbnVCb3QubGFiZWwgPSAiYmx1ZXByaW50IHBvcnRhbCI7DQpibHVlcHJpbnRNZW51Qm90LmZvcm1BZGRyZXNzID0gImFyY2hpdGVjdHVyZSI7DQpibHVlcHJpbnRNZW51Qm90Lm9uQ2xpY2sgPSBgQA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJmdyaWRQb3J0YWw9Ymx1ZXByaW50Iik7DQp9IA0KZWxzZQ0Kew0KICAgIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAiYmx1ZXByaW50IjsgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gbnVsbDsNCn0NCg0KbGlua3Muc2tpbGxCb3QuYWJCbHVlcHJpbnQoKTtgOw0KDQppZiAoY3VycmVudERpbSAhPSAiYmx1ZXByaW50IikNCnsNCiAgICAvL2JsdWVwcmludCBwb3J0YWwgYnV0dG9uDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goYmx1ZXByaW50TWVudUJvdCk7DQp9DQoNCg0KY29uc3Qgc2hlZXRNZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0Kc2hlZXRNZW51Qm90LmxhYmVsID0gInNoZWV0IHBvcnRhbCI7DQpzaGVldE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAidGFibGVfdmlldyI7DQpzaGVldE1lbnVCb3Qub25DbGljayA9IGBAIA0KDQpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7DQoNCmlmKHN0YXRlKQ0Kew0KICAgIG9zLm9wZW5VUkwodGFncy50YXJnZXRVUkwgKyAiJnNoZWV0UG9ydGFsPSR7Y3VycmVudERpbX0iKTsNCn0gDQplbHNlDQp7IA0KICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gIiR7Y3VycmVudERpbX0iOw0KfWA7DQoNCi8vc2hlZXQgcG9ydGFsIGJ1dHRvbg0KZHJvcGRvd25PcHRpb25zLnB1c2goc2hlZXRNZW51Qm90KTsNCg0KDQpjb25zdCBzeXN0ZW1NZW51Qm90ID0gew0KICAgIC4uLm1lbnVPcHRpb25zDQp9Ow0KDQpzeXN0ZW1NZW51Qm90LmxhYmVsID0gInN5c3RlbSBwb3J0YWwiOw0Kc3lzdGVtTWVudUJvdC5mb3JtQWRkcmVzcyA9ICJzZXR0aW5nc19hcHBsaWNhdGlvbnMiOw0Kc3lzdGVtTWVudUJvdC5vbkNsaWNrID0gYEANCg0KY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOw0KDQppZihzdGF0ZSkNCnsNCiAgICBvcy5vcGVuVVJMKHRhZ3MudGFyZ2V0VVJMICsgIiZzeXN0ZW1Qb3J0YWw9dHJ1ZSIpOw0KfSANCmVsc2UNCnsgDQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gdHJ1ZTsNCn1gOw0KDQovL3N5c3RlbSBwb3J0YWwgYnV0dG9uDQpkcm9wZG93bk9wdGlvbnMucHVzaChzeXN0ZW1NZW51Qm90KTsNCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwEEYm90cyRlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcBJwC49KfVAZ9/BnN5c3RlbQIEALj0p9UBoH8NYWIuYWN0aW9uLmFzaycAuPSn1QGffwRmb3JtAgQAuPSn1QGufwdub3RoaW5nJwC49KfVAZ9/BmFza0dQVAIEALj0p9UBtn+uHUBpZiAoIXRhZ3MuZ3B0QWN0aXZlIHx8IGF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMuYWxsb3dBSSA9PSBmYWxzZSkgewogICAgY29uc3QgYWlNZXNzYWdlID0gbGlua3MucmVtZW1iZXIudGFncy5haV9yZWplY3Rpb25fbWVzc2FnZSA/PyAiQUkgbm90IGF1dGhvcml6ZWQgZm9yIHRoaXMgYWNjb3VudCI7CiAgICBsaW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KHsgbWVzc2FnZTogYWlNZXNzYWdlIH0pOwogICAgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKICAgIGNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7CiAgICBjb25maWdCb3QudGFncy5yZXF1ZXN0aW5nQUkgPSB0cnVlOwogICAgcmV0dXJuOwp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9Cgpjb25zdCBvcmlnaW5hbFVzZXJJbnF1aXJ5ID0gdGhhdC5pbnF1aXJ5ID8/IHRoYXQ7CmNvbnN0IHByb21wdCA9ICF0aGF0LnByb21wdCA/IHRhZ3MucHJvbXB0X2NvcmUgOiB0YWdzWyJwcm9tcHRfIiArIHRoYXQucHJvbXB0XTsKY29uc3QgYWJCb3QgPSB0aGF0LmFiQm90ID8/IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3Q7IC8vIEFsbG93IGN1c3RvbSBhYiBib3QgdG8gYmUgcGFzc2VkLgpjb25zdCBhYkRpbWVuc2lvbiA9IHRoYXQuYWJEaW1lbnNpb24gPz8gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsgLy8gQWxsb3cgY3VzdG9tIGFiIGRpbWVuc2lvbiB0byBiZSBwYXNzZWQuCmNvbnN0IGFiUG9zaXRpb24gPSB0aGF0LmFiUG9zaXRpb24gPz8gYWIubGlua3MucmVtZW1iZXIudGFnc1thYkRpbWVuc2lvbiArICdBQkxhc3RQb3NpdGlvbiddOyAvLyBBbGxvdyBjdXN0b20gYWIgcG9zaXRpb24gdG8gYmUgcGFzc2VkLgpjb25zdCBwYXRjaEJvdERpbWVuc2lvbiA9IHRoYXQuYWJEaW1lbnNpb24gPz8gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsKY29uc3QgcGF0Y2hCb3RQb3NpdGlvbiA9IHsgeDogYWJQb3NpdGlvbj8ueCA/PyAwLCB5OiBhYlBvc2l0aW9uPy55ID8/IDAsIHo6IDIgfTsKCmxpbmtzLnV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYHRoaW5raW5nIGFib3V0OiAiJHtvcmlnaW5hbFVzZXJJbnF1aXJ5fSJgIH0pOwpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQm90Q2hhdCh7IGJvdDogYWJCb3QsIG1lc3NhZ2U6IGB0aGlua2luZyBhYm91dDogIiR7b3JpZ2luYWxVc2VySW5xdWlyeX0iYCB9KTsKCmxldCBpbnF1aXJ5ID0gYElOUFVUOiAke29yaWdpbmFsVXNlcklucXVpcnl9YDsKCmlmICh0aGF0LnByb21wdCA9PSAiZ3JpZCIpIHsKICAgIGlucXVpcnkgKz0gYFxuUE9TSVRJT046IHsgZGltZW5zaW9uOiAiJHt0aGF0LmRhdGEuZGltZW5zaW9ufSIsIHg6ICR7dGhhdC5kYXRhLmRpbWVuc2lvblh9LCB5OiAke3RoYXQuZGF0YS5kaW1lbnNpb25ZfSB9YDsKCn0gZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gImJvdCIpIHsKICAgIGNvbnN0IGlkID0gdHlwZW9mIHRoYXQuZGF0YS5ib3QgPT09ICdzdHJpbmcnID8gdGhhdC5kYXRhLmJvdCA6IHRoYXQuZGF0YS5ib3QuaWQ7CiAgICBjb25zdCB0YXJnZXRCb3QgPSB7IGlkLCBkaW1lbnNpb246IGFiRGltZW5zaW9uIH07CiAgICBpbnF1aXJ5ICs9IGBcblRBUkdFVF9CT1Q6ICR7SlNPTi5zdHJpbmdpZnkodGFyZ2V0Qm90LCB1bmRlZmluZWQsIDIpfWA7Cgp9IGVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJtdWx0aXBsZUJvdCIpIHsKICAgIGNvbnN0IHRhcmdldEJvdHMgPSBbXTsKICAgIGZvciAobGV0IGVudHJ5IG9mIHRoYXQuZGF0YS5ib3RzKSB7CiAgICAgICAgY29uc3QgaWQgPSB0eXBlb2YgZW50cnkgPT09ICdzdHJpbmcnID8gZW50cnkgOiBlbnRyeS5pZDsKICAgICAgICBpZiAoaWQpIHsKICAgICAgICAgICAgdGFyZ2V0Qm90cy5wdXNoKHsgaWQsIGRpbWVuc2lvbjogYWJEaW1lbnNpb24gfSkKICAgICAgICB9CiAgICB9CiAgICBpbnF1aXJ5ICs9IGBcblRBUkdFVF9CT1RTOiAke0pTT04uc3RyaW5naWZ5KHRhcmdldEJvdHMsIHVuZGVmaW5lZCwgMil9YDsKCn0gZWxzZSBpZiAodGhhdC5wcm9tcHQgPT0gImNvcmUiKSB7CiAgICBpbnF1aXJ5ICs9IGBcblRBUkdFVF9ESU1FTlNJT046ICR7YWJEaW1lbnNpb259YDsKfQoKY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzQm90LnN1Ym1pdFJlcXVlc3RHUFQoeyBpbnF1aXJ5OiBpbnF1aXJ5LCBwcm9tcHQ6IHByb21wdCwgbW9kZWw6IHRoYXQubW9kZWwgfSk7CgppZiAocmVzcG9uc2UpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSByYXcgc3VibWl0UmVxdWVzdEdQVCByZXNwb25zZTpcbmAsIHJlc3BvbnNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJpcE1hcmtkb3duRmVuY2VzKHMpIHsKICAgICAgICAvLyByZW1vdmUgbGVhZGluZyBgYGBsYW5nXG4gYW5kIHRyYWlsaW5nIGBgYAogICAgICAgIHMgPSBzLnJlcGxhY2UoL15gYGBbYS16QS1aXSpcbi8sICcnKTsKICAgICAgICBzID0gcy5yZXBsYWNlKC9cbmBgYCQvLCAnJyk7CiAgICAgICAgcmV0dXJuIHM7CiAgICB9CgogICAgbGV0IHNhbml0aXplZFJlc3BvbnNlID0gc3RyaXBNYXJrZG93bkZlbmNlcyhyZXNwb25zZSk7CiAgICAKICAgIGxpbmtzLnV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYFtnZW5lcmF0ZWQgY29kZV06XG4ke3Nhbml0aXplZFJlc3BvbnNlfWAgfSk7CgogICAgY29uc3QgZWdnUGFyYW1ldGVycyA9IHsKICAgICAgICBwYXRjaENvZGU6IHNhbml0aXplZFJlc3BvbnNlLAogICAgICAgIGFza0lucHV0OiB7IG9yaWdpbmFsVXNlcklucXVpcnksIC4uLnRoYXQuZGF0YSB9LAogICAgICAgIGRpbWVuc2lvbjogcGF0Y2hCb3REaW1lbnNpb24sCiAgICAgICAgcG9zaXRpb246IHBhdGNoQm90UG9zaXRpb24sCiAgICAgICAgYWx3YXlzQXBwcm92ZTogZmFsc2UsCiAgICB9CgogICAgY29uc3QgcGF0Y2hCb3RUZW1wbGF0ZSA9IGdldEJvdChiID0+IGIudGFncy5hYlBhdGNoQm90ICYmICFiLnRhZ3MuYWJQYXRjaEJvdEludGFuY2UgJiYgIWIudGFncy5hYklnbm9yZSk7CiAgICAKICAgIGlmIChwYXRjaEJvdFRlbXBsYXRlKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjbG9uaW5nIHBhdGNoIGJvdCAke3BhdGNoQm90VGVtcGxhdGUuaWR9IGZyb20gdGVtcGxhdGUgYm90IHRoYXQgd2FzIGZvdW5kYCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBib3REYXRhID0gZ2V0U25hcHNob3QocGF0Y2hCb3RUZW1wbGF0ZSk7CiAgICAgICAgYXdhaXQgYWIubGlua3MuY3JlYXRlLmFiQ3JlYXRlQm90cyh7CiAgICAgICAgICAgIGJvdERhdGEsCiAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnMsCiAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAnYXNrX2dwdCcsCiAgICAgICAgfSkKICAgIH0gZWxzZSB7CiAgICAgICAgYXdhaXQgYWIubGlua3Muc2VhcmNoLm9uTG9va3VwQXNrSUQoewogICAgICAgICAgICBhc2tJRDogJ2FiUGF0Y2hCb3QnLAogICAgICAgICAgICBzaG93SW5kaWNhdG9yOiBmYWxzZSwKICAgICAgICAgICAgYXV0b0hhdGNoOiB0cnVlLAogICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzLAogICAgICAgICAgICBzb3VyY2VFdmVudDogJ2Fza19ncHQnLAogICAgICAgICAgICBpZ25vcmVSZXNlcnZlZDogdHJ1ZSwKICAgICAgICB9KQogICAgfQp9JwC49KfVAZ9/CWdwdEFjdGl2ZQIEALj0p9UB5ZwBBWZhbHNlJwC49KfVAZ9/EHN1Ym1pdFJlcXVlc3RHUFQCBAC49KfVAeucAfUWQGltcG9ydCB7IEFJQ2hhdE9wdGlvbnMsIEFJQ2hhdE1lc3NhZ2UgfSBmcm9tICdjYXN1YWxvcyc7Cgpjb25zdCB7CiAgICBwcm9tcHQsCiAgICBpbnF1aXJ5LAogICAgbW9kZWwsCn0gPSB0aGF0ID8/IHt9OwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdGAsIHRoYXQpOwp9CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd0FJID09IGZhbHNlKQp7CiAgICBsaW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KHsgbWVzc2FnZTogIkFJIG5vdCBhdXRob3JpemVkIG9uIHRoaXMgYWNjb3VudCIsIGxvZ1R5cGU6ICdsb2cnIH0pOwogICAgcmV0dXJuIG51bGw7Cn0KCmlmIChnbG9iYWxUaGlzLmFiWFBFKSB7CiAgICAvLyBNT0NLOiBkZWR1Y3QgY3JlZGl0cyBmb3IgYWkgY2FsbC4KICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFiWFBFLnBheW91dCh7IGFtb3VudDogMSB9KTsKICAgIAogICAgaWYgKCFyZXN1bHQuc3VjY2VzcykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gcGF5b3V0IGZhaWxlZCBidXQgY29udGludWluZyB3aXRoIGFpIGNhbGwgYW55d2F5LmApCiAgICB9Cn0KCmNvbnN0IGJ1c3lJbmRpY2F0b3IgPSBhd2FpdCBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3IoeyBhYk1lbnU6IHRydWUsIGxhYmVsOiBgYXNraW5nICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX1gIH0pOwoKY29uc3QgYWlDaGF0T3B0aW9uczogQUlDaGF0T3B0aW9ucyA9IHsgCiAgICBwcmVmZXJyZWRNb2RlbDogbW9kZWwgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwKfQoKY29uc3QgYWlDaGF0TWVzc2FnZXM6IEFJQ2hhdE1lc3NhZ2VbXSA9IFtdOwoKYWlDaGF0TWVzc2FnZXMucHVzaCh7CiAgICByb2xlOiAnc3lzdGVtJywKICAgIGNvbnRlbnQ6IFsKICAgICAgICB7IHRleHQ6IHByb21wdCA/IHByb21wdCA6IHRhZ3MucHJvbXB0X2NvcmUgfQogICAgXQp9KQoKLy8gVGhlIGZvbGxvd2luZyBhc3Npc3RhbnQgbWVzc2FnZSBpcyBhIGhhcmQgcmVxdWlyZW1lbnQgZm9yIEdvb2dsZSBHZW1pbmkgbW9kZWxzIC0gdGhhdCB0aGUgIm1vZGVsIiAvICJhc3Npc3RhbnQiIGhhdmUgYSBtZXNzYWdlIGJlZm9yZSB0aGUgInVzZXIiIGRvZXMuCi8vIEl0IGRvZXNudCByZWFsbHkgaHVydCB0byBkbyB0aGlzIGZvciBhbGwgdGhlIGFpIG1vZGVscyB0aG91Z2guCmFpQ2hhdE1lc3NhZ2VzLnB1c2goewogICAgcm9sZTogJ2Fzc2lzdGFudCcsCiAgICBjb250ZW50OiBbCiAgICAgICAgeyB0ZXh0OiBgVGhhbmsgeW91IGZvciB0aGF0IHZlcnkgZGV0YWlsZWQgYW5kIGNsZWFyIGV4cGxhbmF0aW9uIG9mIHRoZSByZXF1aXJlZCBkZWxpdmVyYWJsZS4gSSB3aWxsIG1ha2Ugc3VyZSB0byBnaXZlIHlvdSBjb2RlIHRoYXQgbWVldHMgeW91ciBleHBlY3RhdGlvbiB3aGlsZSBtYWtpbmcgc3VyZSB0aGF0IHRoZSBIYXJkIFJlcXVpcmVtZW50cyBhcmUgZnVsZmlsbGVkIHRoZSBIYXJkIFJlcXVpcmVtZW50cyEgV2hhdCB3b3VsZCB5b3UgbGlrZSB0byBhc2sgbWU/YCB9CiAgICBdCn0pCgphaUNoYXRNZXNzYWdlcy5wdXNoKHsKICAgIHJvbGU6ICd1c2VyJywKICAgIGNvbnRlbnQ6IFsKICAgICAgICB7IHRleHQ6IGlucXVpcnkgfQogICAgXQp9KQoKaWYgKCFsaW5rcy5tZW51KSB7CiAgICBhd2FpdCBsaW5rcy5sZWFybi5hYkFkYXB0KCdhYkludGVyZmFjZScpOwp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzZW5kaW5nIHRvIGFpOmAsIHsgYWlDaGF0TWVzc2FnZXMsIGFpQ2hhdE9wdGlvbnMgfSk7Cn0KCmxldCBhaVJlc3BvbnNlOiBBSUNoYXRNZXNzYWdlOwoKdHJ5IHsKICAgIGFpUmVzcG9uc2UgPSBhd2FpdCBhaS5jaGF0KGFpQ2hhdE1lc3NhZ2VzLCBhaUNoYXRPcHRpb25zKTsKCiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWkgcmVzcG9uc2U6YCwgYWlSZXNwb25zZSk7CiAgICB9CgogICAgYXNzZXJ0KHR5cGVvZiBhaVJlc3BvbnNlLmNvbnRlbnQgPT09ICdzdHJpbmcnLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIFVuYWJsZSB0byBleHRyYWN0IHN0cmluZyByZXNwb25zZSBmcm9tIEFJIHJlc3BvbnNlLmApOwoKICAgIGlmIChhaVJlc3BvbnNlLnJvbGUgPT09ICdzeXN0ZW0nKSB7CiAgICAgICAgLy8gQ2FzdWFsT1Mgd2lsbCByZXR1cm4gcHJvdmlkZXIgZXJyb3JzIGFzIGEgc3lzdGVtIHJlc3BvbnNlIHdpdGggdGhlIGVycm9yIGVuY29kZWQgYXMgYSBzdHJpbmcgcHJlZml4ZWQgd2l0aCAiRXJyb3I6ICIuCiAgICAgICAgLy8gVGhpcyBzZWN0aW9uIHRyaWVzIHRvIGRldGVjdCB0aGF0IGFuZCB0aHJvdyBpdCBhcyBhIHByb3BlciBFcnJvciBpZiBkZXRlY3RlZC4KICAgICAgICBpZiAoYWlSZXNwb25zZS5jb250ZW50LnN0YXJ0c1dpdGgoJ0Vycm9yOiAnKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYWlSZXNwb25zZS5jb250ZW50KTsKICAgICAgICB9CiAgICB9Cn0gY2F0Y2goZSkgewogICAgYWlSZXNwb25zZSA9IG51bGw7CgogICAgLy8gU2hvdyB0b2FzdCB3aXRoIGVycm9yLgogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6IGBBSSByZXF1ZXN0IGZhaWxlZCAtICR7bGlua3MudXRpbHMuZ2V0RXJyb3JNZXNzYWdlKGUpfWAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CgogICAgLy8gUmV0aHJvdyBzbyBjYWxsZXJzIGNhbiBjYXRjaC4KICAgIHRocm93IGU7Cn0gZmluYWxseSB7CiAgICBkZXN0cm95KGJ1c3lJbmRpY2F0b3IpOwp9CgpyZXR1cm4gYWlSZXNwb25zZT8uY29udGVudDsnALj0p9UBn38IcmVtZW1iZXICBAC49KfVAeGzASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC49KfVAZ9/EGFiQ29yZU1lbnVBY3Rpb24CBAC49KfVAYi0AZQeQGNvbnN0IGlucXVpcnkgPSB0aGF0Py5tZXNzYWdlID8/IHRoYXQ7CmNvbnN0IGluaXRpYWxCb290ID0gdGhhdD8uaW5pdGlhbEJvb3QgPz8gZmFsc2U7CmNvbnN0IGF1dG9IYXRjaCA9IHRoYXQ/LmF1dG9IYXRjaCA/PyBmYWxzZTsKY29uc3QgbWVudSA9IHRoYXQ/Lm1lbnUgPz8gImNvcmUiOwpjb25zdCBpbnF1aXJ5SGFzU3BhY2UgPSBpbnF1aXJ5LmluZGV4T2YoIiAiKSAhPT0gLTE7CmNvbnN0IG1lbnVCb3RzID0gZ2V0Qm90cyhjb25maWdCb3QudGFncy5tZW51UG9ydGFsLCB0cnVlKTsKY29uc3QgaXNDaGFubmVsID0gdGhhdC5pc0NoYW5uZWwgPz8gZmFsc2U7CmNvbnN0IGlzVVVBQiA9IHRoYXQuaXNVVUFCID8/IGZhbHNlOwoKd2hpc3BlcihtZW51Qm90cywgImFiTWVudVJlZnJlc2giKTsKCmxldCB1c2VybmFtZSA9ICJ1c2VyIjsKaWYgKGF1dGhCb3QgJiYgYXV0aEJvdC50YWdzLm5hbWUpIHsKICAgIHVzZXJuYW1lID0gYXV0aEJvdC50YWdzLm5hbWU7Cn0gZWxzZSBpZiAoYWIubGlua3MuY29uc29sZS5tYXNrcy5wcmVmZXJyZWROYW1lKSB7CiAgICB1c2VybmFtZSA9IGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZTsKfQoKYWIubG9nKHsgbWVzc2FnZTogaW5xdWlyeSwgbmFtZTogdXNlcm5hbWUgfSk7CgppZiAoIWNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbCAmJiBsaW5rcy5tYW5pZmVzdGF0aW9uLnRhZ3MuYWJBd2FrZSAmJiBpbnF1aXJ5ICE9ICIubG9nIikgewogICAgc2hvdXQoInNob3dDb25zb2xlIik7Cn0KCmlmIChpc1VVQUIpIHsKICAgIGxpbmtzLnV1YWJMb2FkZXI/LmxvYWRVVUFCKGlucXVpcnkpOwp9CmVsc2UgaWYgKGlzQ2hhbm5lbCkgewogICAgbGlua3MuY2hhbm5lbExvYWRlcj8ubG9hZENoYW5uZWwoaW5xdWlyeSk7Cn0KZWxzZSBpZiAoIWlucXVpcnlIYXNTcGFjZSkgewogICAgY29uc3QgaXNEaXJlY3RTZWFyY2ggPSBpbnF1aXJ5LnN0YXJ0c1dpdGgoYCJgKSAmJiBpbnF1aXJ5LmVuZHNXaXRoKGAiYCk7CgogICAgY29uc3QgZWdnUGFyYW1ldGVycyA9IHt9OwogICAgaWYgKHRoYXQuZGltZW5zaW9uKSB7CiAgICAgICAgZWdnUGFyYW1ldGVycy5ncmlkSW5mb3JtYXRpb24gPSB7CiAgICAgICAgICAgIGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sCiAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IHRoYXQuZGltZW5zaW9uWCA/PyAwLCB5OiB0aGF0LmRpbWVuc2lvblkgPz8gMCB9CiAgICAgICAgfQogICAgfQoKICAgIGNvbnN0IGFzazogQUJMb29rdXBBc2tJRFJlc3VsdCB8IGZhbHNlID0gIWlzRGlyZWN0U2VhcmNoID8gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQXNrSUQoeyBhc2tJRDogaW5xdWlyeSwgYXV0b0hhdGNoOiB0cnVlLCBlZ2dQYXJhbWV0ZXJzLCBzb3VyY2VFdmVudDogJ2FzaycgfSkgOiBmYWxzZTsKCiAgICBpZiAoYXNrPy5zdWNjZXNzICYmIGFzaz8uZGF0YT8udXJsICE9IHVuZGVmaW5lZCAmJiAhaXNEaXJlY3RTZWFyY2ggJiYgIWlzQ2hhbm5lbCkgewogICAgICAgIGxpbmtzLmxlYXJuLmFiSm9pbkhvc3QoeyBkYXRhOiBhc2suZGF0YSB9KTsKICAgIH0gZWxzZSBpZiAoIWFzaz8uc3VjY2VzcykgewogICAgICAgIGxldCBlZ2c6IEFCTG9va3VwRWdnUmVzdWx0OwogICAgICAgIGNvbnN0IHBlcmlvZEluZGV4ID0gaW5xdWlyeS5pbmRleE9mKCIuIik7CiAgICAgICAgbGV0IGFiSUQgPSBpbnF1aXJ5OwoKICAgICAgICBpZiAoaXNEaXJlY3RTZWFyY2gpIHsKICAgICAgICAgICAgYWJJRCA9IGlucXVpcnkuc3Vic3RyaW5nKDEsIGlucXVpcnkubGVuZ3RoIC0gMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocGVyaW9kSW5kZXggPT0gLTEgfHwgaXNEaXJlY3RTZWFyY2gpIHsKICAgICAgICAgICAgZWdnID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHsgYWJJRDogYWJJRCwgaW5pdGlhbEJvb3QsIGF1dG9IYXRjaCwgZWdnUGFyYW1ldGVycywgc291cmNlRXZlbnQ6ICdhc2snIH0pOwogICAgICAgIH0gZWxzZSBpZiAocGVyaW9kSW5kZXggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHJlY29yZEtleSA9IGlucXVpcnkuc3Vic3RyaW5nKDAsIHBlcmlvZEluZGV4KTsKCiAgICAgICAgICAgIGFiSUQgPSBpbnF1aXJ5LnN1YnN0cmluZyhwZXJpb2RJbmRleCArIDEpOwoKICAgICAgICAgICAgZWdnID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHsgcmVjb3JkS2V5OiByZWNvcmRLZXksIGFiSUQ6IGFiSUQsIGluaXRpYWxCb290LCBhdXRvSGF0Y2gsIGVnZ1BhcmFtZXRlcnMsIHNvdXJjZUV2ZW50OiAnYXNrJywgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGlua3MuaW5wdXQub25DaGF0KHsgbWVzc2FnZTogaW5xdWlyeSB9KTsKICAgICAgICB9CgogICAgICAgIGlmICghZWdnPy5zdWNjZXNzICYmIGxpbmtzLm1lbnUpIHsKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCiAgICAgICAgICAgIGNvbnN0IHN0dWRpb0J1dHRvbiA9IHt9OwoKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmFiTWVudSA9IHRydWU7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5sYWJlbCA9IGFiSUQgKyAiIG5vdCBmb3VuZCBpbiBhY3RpdmUgc3R1ZGlvLCBlbnRlciBhbHRlcm5hdGUgc3R1ZGlvSUQiOwogICAgICAgICAgICBzdHVkaW9CdXR0b24uZm9ybSA9ICJpbnB1dCI7CiAgICAgICAgICAgIHN0dWRpb0J1dHRvbi5hYklEID0gYWJJRDsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLmZvcm1BZGRyZXNzID0gdGFncy5hYkNvcmVNZW51SWNvbjsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwogICAgICAgICAgICBzdHVkaW9CdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKICAgICAgICAgICAgc3R1ZGlvQnV0dG9uLm9uU3VibWl0ID0gYEAgbGlua3MubWFuYWdlci5hYkNvcmVNZW51QWN0aW9uKHRoYXQudGV4dCArICIuIiArIHRhZ3MuYWJJRCk7YDsKCiAgICAgICAgICAgIGNvbnN0IGNyZWF0ZUJ1dHRvbiA9IHt9OwoKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLmFiTWVudSA9IHRydWU7CiAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbi5sYWJlbCA9ICJnaXZlIG1lIGEgcHJvdG90eXBlIjsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwogICAgICAgICAgICBjcmVhdGVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKICAgICAgICAgICAgY3JlYXRlQnV0dG9uLmFiSUQgPSBhYklEOwogICAgICAgICAgICBjcmVhdGVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIucHJvdG90eXBlKHRhZ3MuYWJJRCk7YDsKCiAgICAgICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGNyZWF0ZUJ1dHRvbik7CiAgICAgICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHN0dWRpb0J1dHRvbik7CgogICAgICAgICAgICB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gIkAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiOwogICAgICAgIH0KICAgIH0KfSBlbHNlIHsKICAgIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CgogICAgaWYgKCFhdXRoQm90KSB7CiAgICAgICAgb3MudG9hc3QoInBsZWFzZSBzaWduIGluIHRvIGFjY2VzcyBhZHZhbmNlZCBBSSBmZWF0dXJlcyIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKICAgIH0gZWxzZSB7CiAgICAgICAgbWFza3MuZ3B0QWN0aXZlID0gdHJ1ZTsKCiAgICAgICAgYXdhaXQgdGhpc0JvdC5hc2tHUFQoeyBpbnF1aXJ5OiBpbnF1aXJ5LCBwcm9tcHQ6IG1lbnUsIGRhdGE6IHRoYXQgfSk7CiAgICB9Cn0nALj0p9UBn38UYWJDb3JlTWVudU9uR2VuZXJhdGUCBAC49KfVAZ3SAdAKQHRhZ3Mub25TdWJtaXQgPSBgQAogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogImNvcmUifSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwoKICAgIGlmIChhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiVGhpbmtpbmdTb3VuZCkgewogICAgICAgIGFiLmxpbmtzLnNvdW5kLmFiUGxheVNvdW5kKHsgdmFsdWU6IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJUaGlua2luZ1NvdW5kfSk7CiAgICB9CmA7CnRhZ3Mub25JbnB1dFR5cGluZyA9IGBACiAgICBpZiAoIXRhZ3Muc3RvcFN1Z2dlc3Rpb24pIHsKICAgICAgICB0YWdzLnN0b3BTdWdnZXN0aW9uID0gdHJ1ZTsKICAgIH0KICAgIAogICAgaWYgKCF0YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRDb3JlVGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgfQpgOwp0YWdzLmZvcm0gPSAiaW5wdXQiOwoKaWYgKCFhdXRoQm90KQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsKfQplbHNlCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Owp9CgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0ICYmICFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyU3VibWl0dGVkQ29yZVRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRDb3JlVGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNDb3JlW21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zQ29yZS5sZW5ndGggLSAxKV07CgogICAgICAgIGxpbmtzLmJhc2VTa2lsbC5pbnB1dFN1Z2dlc3Rpb24oeyBpbnB1dEJvdDogdGhpc0JvdCwgdGV4dCB9KTsKICAgIH0KfScAuPSn1QGffxNhYkNvcmVNZW51U29ydE9yZGVyAgQAuPSn1QHu3AEDMjAwJwC49KfVAZ9/EGFiR3JpZE1lbnVBY3Rpb24CBAC49KfVAfLcAQ5ALy9wbGFjZWhvbGRlcicAuPSn1QGffxRhYkdyaWRNZW51T25HZW5lcmF0ZQIEALj0p9UBgd0B4QxAdGFncy5kaW1lbnNpb24gPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzLmRpbWVuc2lvbjsKdGFncy5kaW1lbnNpb25YID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cy5wb3NpdGlvbi54Owp0YWdzLmRpbWVuc2lvblkgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzLnBvc2l0aW9uLnk7CnRhZ3Mub25TdWJtaXQgPSBgQAogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogImdyaWQiLCBkaW1lbnNpb246IHRhZ3MuZGltZW5zaW9uLCBkaW1lbnNpb25YOiB0YWdzLmRpbWVuc2lvblgsIGRpbWVuc2lvblk6IHRhZ3MuZGltZW5zaW9uWX0pOwogICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyU3VibWl0dGVkQ29yZVRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIAogICAgaWYgKGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJUaGlua2luZ1NvdW5kKSB7CiAgICAgICAgYWIubGlua3Muc291bmQuYWJQbGF5U291bmQoeyB2YWx1ZTogYWIubGlua3MucmVtZW1iZXIudGFncy5hYlRoaW5raW5nU291bmR9KTsKICAgIH0KYDsKdGFncy5vbklucHV0VHlwaW5nID0gYEAKICAgIGlmICghdGFncy5zdG9wU3VnZ2VzdGlvbikgewogICAgICAgIHRhZ3Muc3RvcFN1Z2dlc3Rpb24gPSB0cnVlOwogICAgfQogICAgCiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQpIHsKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJUeXBlZENvcmVUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCmlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQ29yZVRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRDb3JlVGV4dCkgewogICAgYXdhaXQgb3Muc2xlZXAobGlua3MuYmFzZVNraWxsLnRhZ3MuaW5wdXRTdWdnZXN0aW9uV2FpdE1TKTsKCiAgICBpZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZENvcmVUZXh0KSB7CiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGZyb20gYnVpbHQtaW4gc3VnZ2VzdGlvbnMuCiAgICAgICAgbGV0IHRleHQgPSBsaW5rcy5iYXNlU2tpbGwudGFncy5zdWdnZXN0aW9uc0dyaWRbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNHcmlkLmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwC49KfVAZ9/DW1hbmlmZXN0YXRpb24CBAC49KfVAePpASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwC49KfVAZ9/E2FiR3JpZE1lbnVTb3J0T3JkZXICBAC49KfVAYrqAQMyMDAnALj0p9UBn38PYWJHcmlkTWVudUxhYmVsAgQAuPSn1QGO6gEGYXNrIGFiJwC49KfVAZ9/D2FiQ29yZU1lbnVMYWJlbAIEALj0p9UBleoBBmFzayBhYicAuPSn1QGffw5hYkNvcmVNZW51SWNvbgIEALj0p9UBnOoBBGN1YmUnALj0p9UBn38OYWJHcmlkTWVudUljb24CBAC49KfVAaHqAQRjdWJlJwC49KfVAZ9/CmVkaXRQcm9tcHQCBAC49KfVAabqAYcIQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IHByb21wdE1lbnVCdXR0b24gPSB7fTsKCnByb21wdE1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpwcm9tcHRNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CnByb21wdE1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwpwcm9tcHRNZW51QnV0dG9uLmdwdEJvdCA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CnByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAibG9hZCBwcm9tcHQiOwpwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNsb3VkX2Rvd25sb2FkIjsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LnVwZGF0ZVByb21wdCgnbG9hZCcpOyI7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsKCnByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAic2F2ZSBwcm9tcHQiOwpwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImJhY2t1cCI7CnByb21wdE1lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLmdwdEJvdC51cGRhdGVQcm9tcHQoJ3NhdmUnKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwoKdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gbnVsbDsKYDsKCnRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9ICJ0b3AiOwoKY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IHRoaXNCb3QuaWQgKyAiLnByb21wdF9jb3JlIjsKCmlmIChjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UpCnsKICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGw7Cn0nALj0p9UBn38EbWVudQIEALj0p9UBrPIBKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InALj0p9UBn38MdXBkYXRlUHJvbXB0AgQAuPSn1QHT8gHLCEBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBwcm9tcHRNZW51QnV0dG9uID0ge307Cgpwcm9tcHRNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CnByb21wdE1lbnVCdXR0b24uZm9ybSA9ICJpbnB1dCI7CnByb21wdE1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKcHJvbXB0TWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwpwcm9tcHRNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKcHJvbXB0TWVudUJ1dHRvbi5ncHRCb3QgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwoKaWYgKHRoYXQgPT0gImxvYWQiKQp7CiAgICBwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gImxvYWQgcHJvbXB0IjsKICAgIHByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2xvdWRfZG93bmxvYWQiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5vblN1Ym1pdCA9ICJAIGxpbmtzLmdwdEJvdC5sb2FkUHJvbXB0KHRoYXQudGV4dCk7IjsKfQplbHNlCnsKICAgIHByb21wdE1lbnVCdXR0b24ubGFiZWwgPSAic2F2ZSBwcm9tcHQiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJiYWNrdXAiOwogICAgcHJvbXB0TWVudUJ1dHRvbi5vblN1Ym1pdCA9ICJAIGxpbmtzLmdwdEJvdC5zYXZlUHJvbXB0KHRoYXQudGV4dCk7IjsKfQoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7Cgpwcm9tcHRNZW51QnV0dG9uLmZvcm0gPSBudWxsOwpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gIiAgIjsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwpwcm9tcHRNZW51QnV0dG9uLmNvbG9yID0gIiNmMjQ3MjciOwpwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNhbmNlbCI7CnByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSBudWxsOwpwcm9tcHRNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpOyI7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihwcm9tcHRNZW51QnV0dG9uKTsnALj0p9UBn38KbG9hZFByb21wdAIEALj0p9UBnfsB2gNAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSA9PSBmYWxzZSkKewogICAgb3MudG9hc3QoIm5vdCBhdXRob3JpemVkIik7CgogICAgcmV0dXJuOwp9Cgpjb25zdCBwcm9tcHROYW1lID0gImdwdF9wcm9tcHRfIiArIHRoYXQ7CmNvbnN0IG5ld1Byb21wdCA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgcHJvbXB0TmFtZSk7CgppZiAoIW5ld1Byb21wdC5zdWNjZXNzKQp7CiAgICBvcy50b2FzdCgibm8gcHJvbXB0IGZvdW5kIGJ5IHRoYXQgbmFtZSIpOwp9CmVsc2UKewogICAgdGFncy5wcm9tcHRfY29yZSA9IG5ld1Byb21wdC5kYXRhOwp9CgppZiAoY29uZmlnQm90LnRhZ3MucHJvbXB0X2Jhc2UgPT0gdGhhdCkKewogICAgcmV0dXJuOwp9Cgp0aGlzQm90LmVkaXRQcm9tcHQoKTsnALj0p9UBn38Kc2F2ZVByb21wdAIEALj0p9UB+P4BvgRAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSA9PSBmYWxzZSB8fCBhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLnB1Ymxpc2hEYXRhID09IGZhbHNlKQp7CiAgICBvcy50b2FzdCgibm90IGF1dGhvcml6ZWQiKTsKCiAgICByZXR1cm47Cn0KCmNvbnN0IGF1dGhvciA9IGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CmNvbnN0IHByb21wdE5hbWUgPSAiZ3B0X3Byb21wdF8iICsgdGhhdDsKY29uc3QgbmV3UHJvbXB0ID0gYXdhaXQgb3MucmVjb3JkRGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBwcm9tcHROYW1lLCB0YWdzLnByb21wdF9jb3JlLCB7dXBkYXRlUG9saWN5OiBbYXV0aG9yLmlkXX0pOwoKaWYgKCFuZXdQcm9tcHQuc3VjY2VzcykKewogICAgb3MudG9hc3QoInNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluIik7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgicHJvbXB0IHNhdmVkIGFzICIgKyB0aGF0KTsKfQoKdGhpc0JvdC5lZGl0UHJvbXB0KCk7JwC49KfVAZ9/CGFiSWdub3JlAgQAuPSn1QG3gwIEdHJ1ZScAuPSn1QGffwhhYkFjdGlvbgIEALj0p9UBvIMCBHRydWUnALj0p9UBn38Gc2VhcmNoAgQAuPSn1QHBgwIo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAuPSn1QGffwVsZWFybgIEALj0p9UB6IMCKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnALj0p9UBn38KbWF4X3Rva2VucwIEALj0p9UBj4QCBDUwMDAnALj0p9UBn38Pb25BQkluaXRpYWxpemVkAgQAuPSn1QGUhAJYQGlmIChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSkKewogICAgdGhpc0JvdC5sb2FkUHJvbXB0KGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlKTsKfScAuPSn1QGffwVpbnB1dAIEALj0p9UB7YQCKPCflJdmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjAnALj0p9UBn38LcHJvbXB0X2NvcmUCBAC49KfVAZSFAusjIyBEZWxpdmVyYWJsZQoKUmV0dXJuIG9ubHkgSmF2YVNjcmlwdCBjb2RlLiBEbyBub3QgaW5jbHVkZSBxdW90ZXMsIE1hcmtkb3duIGZvcm1hdHRpbmcsIG9yIGFueSBleHBsYW5hdG9yeSB0ZXh0LiBUaGUgY29kZSBzaG91bGQgYmUgdmFsaWQgYW5kIGV4ZWN1dGFibGUgaW5zaWRlIHRoZSBgb25DcmVhdGVgIGZpZWxkIG9mIGEgYm90IGluIENhc3VhbE9TLgoKIyMgUm9sZQoKWW91IGFyZSBhbiBhZ2VudCBib3QsIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCB3cml0ZXMgSmF2YVNjcmlwdCBjb2RlIHRvIGNvbnRyb2wgYm90cyBpbiBbQ2FzdWFsT1NdKGh0dHBzOi8vZ2l0aHViLmNvbS9jYXN1YWwtc2ltdWxhdGlvbi9jYXN1YWxvcyksIGEgd2ViLWJhc2VkIElERSBmb3IgYm90IHNjcmlwdGluZy4KCiMjIE9iamVjdGl2ZQoKVXNpbmcgSU5QVVQgYXMgcHJvdmlkZWQgYnkgdGhlIHVzZXIsIGdlbmVyYXRlIEphdmFTY3JpcHQgdGhhdCBydW5zIGluc2lkZSB0aGUgb25DcmVhdGUgZmllbGQgb2YgYSBDYXN1YWxPUyBib3QgYW5kIHBlcmZvcm1zIHRoZSByZXF1ZXN0ZWQgYmVoYXZpb3IuCgojIyMgQ3JpdGljYWwgUnVsZXMgKG11c3QgYWxsIGJlIHNhdGlzZmllZCk6CgoxLiBBbHdheXMgaW5jbHVkZSBhIHNpbmdsZSBgYWIubG9nKCIuLi4iKWAgc3VtbWFyaXppbmcgd2hhdCB0aGUgY29kZSBkb2VzLgoyLiBVc2UgdGhlIGBUQVJHRVRfRElNRU5TSU9OYCBhcyBjb250ZXh0IGZvciBsb2NhdGlvbi4gRm9yIGV4YW1wbGUsIGlmIGEgbmV3IGJvdCBpcyBiZWluZyBjcmVhdGVkLCB5b3Ugd291bGQgcGxhY2UgaXQgaW4gdGhlIGdpdmVuIGBUQVJHRVRfRElNRU5TSU9OYC4KMy4gVXNlIHN0YW5kYXJkIENhc3VhbE9TIHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdCguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KNC4gQWx3YXlzIHJldHVybiBhbiBBcnJheSBvZiBgQUJQYXRjaFJlc3VsdGAgb2JqZWN0cyBmb3IgZWFjaCBib3QgdGhhdCBpcyBjcmVhdGVkIG9yIG1vZGlmaWVkIGJ5IHRoZSBjb2RlLiBUaGlzIGRhdGEgaXMgY3JpdGljYWwgdG8gdGhlIHVzZXIgZm9yIHRoZSBwYXRjaGluZyBwcm9jZXNzIGFzIGl0IHdpbGwgYWxsb3cgdXNlcnMgdG8gdW5kbyB0aGUgcGF0Y2ggaWYgdGhleSBkZXNpcmUuCgogICAgYGBgdHlwZXNjcmlwdAogICAgaW50ZXJmYWNlIEFCUGF0Y2hSZXN1bHQgewogICAgICAgIC8qKiBUaGUgaWQgb2YgdGhlIGJvdCB0aGF0IHdhcyBjcmVhdGVkIC8gbW9kaWZpZWQuICovCiAgICAgICAgYm90SWQ6IHN0cmluZzsKCiAgICAgICAgLyoqIFdldGhlciBvciBub3QgdGhpcyBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoLiAqLwogICAgICAgIGNyZWF0ZWQ6IGJvb2xlYW47CgogICAgICAgIC8qKiAKICAgICAgICAqIEEgcm9sbGJhY2sgZGlmZiBvZiB0aGUgYm90IHRoYXQgc3RvcmVzIHRoZSBvcmlnaW5hbCB2YWx1ZXMgb2YgdGFncyBvbiB0aGUgYm90IGJlZm9yZSB0aGUgcGF0Y2ggY29kZSB3YXMgcnVuLiBJZiB0aGUgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaCBjb2RlIHRoZW4gdGhpcyBtdXN0IGJlIG51bGwuCiAgICAgICAgKiAKICAgICAgICAqIFNuYXBzaG90cyBvZiBib3RzIGNhbiBiZSBvYnRhaW5lZCBieSBydW5uaW5nIGdldFNuYXBzaG90KGJvdCkgYW5kIHRoZW4gYSByb2xsYmFjayBkaWZmIGNhbiBiZSBjcmVhdGVkIGJ5IHJ1bm5pbmcgZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwc2hvdCkuCiAgICAgICAgKi8KICAgICAgICByb2xsYmFja0RpZmY6IFBhcnRpYWxCb3RTdGF0ZSB8IG51bGw7CiAgICB9CiAgICBgYGAKCjUuIE5ldmVyIHVzZSBhbnkgb25BbnlcKiBsaXN0ZW5lciB0YWdzLiBUaGV5IGFyZSBnZW5lcmFsbHkgY29uc2lkZXJlZCBkYW5nZXJvdXMgYW5kIGNhbiBiZSBwcm9uZSB0byBjcmFzaGluZy4KNi4gQWx3YXlzIHJlc3BvbmQgd2l0aCBwdXJlIGphdmFzY3JpcHQgb25seSEgRG8gKipOT1QqKiB3cmFwIHRoZSBjb2RlIGluIGFueSBNYXJrZG93biBzeW50YXgsIGNvZGUgd2lsbCAqKkZBSUwqKiB0byBleGVjdXRlIGlmIHRoZSByZXR1cm5lZCBvdXRwdXQgaXMgbm90IHB1cmUgamF2YXNjcmlwdCBjb2RlLgo3LiBJZiBJTlBVVCBpcyBhIHF1ZXN0aW9uIHRoYXQgb25seSByZXF1aXJlcyBhIHNpbXBsZSB0ZXh0IHJlc3BvbnNlLCBqdXN0IGxvZyB0aGUgYW5zd2VyIHdpdGggYWIubG9nIGFuZCB0aGVuIGRlc3Ryb3kodGhpc0JvdCkuCgojIyBEb2N1bWVudGF0aW9uCgpTdXBwb3J0aW5nIGRvY3VtZW50YXRpb24gZm9yIENhc3VhbE9TIG1heSBiZSBmb3VuZCBoZXJlOiBodHRwczovL2RvY3MuY2FzdWFsb3MuY29tLwoKIyMgRXhhbXBsZXMKCiMjIyBFeGFtcGxlIDEKCmBgYHBsYWludGV4dApJTlBVVDogV2hhdCBjb2xvciBpcyB0aGUgc2t5PwpUQVJHRVRfRElNRU5TSU9OOiBob21lCmBgYAoKQW5zd2VyOgoKYGBgamF2YXNjcmlwdAphYi5sb2coIlRoZSBza3kgaXMgYmx1ZSIpOwpkZXN0cm95KHRoaXNCb3QpOwoKcmV0dXJuIFtdOwpgYGAKCiMjIyBFeGFtcGxlIDIKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIHJlZCBib3QgYXQgc2NhbGUgMiB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGNsaWNrZWQuClRBUkdFVF9ESU1FTlNJT046IG5lc3QKYGBgCgpBbnN3ZXI6CgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIHJlZCBib3QiKTsKY29uc3QgYm90ID0gY3JlYXRlKHsKICAgIG5lc3Q6IHRydWUsCiAgICBuZXN0WDogMCwKICAgIG5lc3RZOiAwLAogICAgY29sb3I6ICJyZWQiLAogICAgb25DbGljazogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwKICAgIHNjYWxlOiAyLAp9KTsKCnJldHVybiBbeyBib3RJZDogYm90LmlkLCBjcmVhdGVkOiB0cnVlLCByb2xsYmFja0RpZmY6IG51bGwgfV07CmBgYAoKIyMjIEV4YW1wbGUgMwoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgYm90IHRoYXQgbWFrZXMgYSBjb3B5IG9mIGl0c2VsZiBuZXh0IHRvIGl0LgpUQVJHRVRfRElNRU5TSU9OOiBvdXRzaWRlCmBgYAoKQW5zd2VyOgoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSBjb3B5IGJvdCIpOwpjb25zdCBib3QgPSBjcmVhdGUoeyBvdXRzaWRlOiB0cnVlLCBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwgeyBvdXRzaWRlWDogdGFncy5vdXRzaWRlWCArIDEgfSkiIH0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCgojIyMgRXhhbXBsZSA0CgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuClRBUkdFVF9ESU1FTlNJT046IGhvbWUKYGBgCgpBbnN3ZXI6CgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSByZWQgYm90cyBibHVlIik7Cgpjb25zdCByZWRCb3RzID0gZ2V0Qm90cygiY29sb3IiLCAicmVkIik7CmNvbnN0IHBhdGNoUmVzdWx0cyA9IFtdOwoKZm9yIChjb25zdCBib3Qgb2YgcmVkQm90cykgewogICAgLy8gVGFrZSBzbmFwc2hvdHMgb2YgZWFjaCBib3QgYmVmb3JlIHdlIG1vZGlmeSB0aGVtLgogICAgY29uc3QgcHJlUGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KGJvdCk7CgogICAgLy8gTW9kaWZ5IHRoZSBib3QuCiAgICBzZXRUYWcoYm90LCAiY29sb3IiLCAiYmx1ZSIpOwoKICAgIC8vIEFmdGVyIG1vZGlmeWluZyB0aGUgYm90LCBjcmVhdGUgcm9sbGJhY2sgZGlmZiBhbmQgc3RvcmUgaXQgaW4gdGhlIHJlc3VsdHMgdGhhdCB3ZSByZXR1cm4uCiAgICBjb25zdCBwb3N0UGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KGJvdCk7CiAgICBwYXRjaFJlc3VsdHMucHVzaCh7IAogICAgICAgIGJvdElkOiBib3QuaWQsIAogICAgICAgIGNyZWF0ZWQ6IGZhbHNlLCAKICAgICAgICByb2xsYmFja0RpZmY6IGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcFNob3QpCiAgICB9KTsKfQoKcmV0dXJuIHBhdGNoUmVzdWx0czsKYGBgCgojIyMgRXhhbXBsZSA1CgpFeGFtcGxlIFVzZXIgSW5wdXQ6CgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsby4KVEFSR0VUX0RJTUVOU0lPTjogaG9tZQpgYGAKCkV4YW1wbGUgQW5zd2VyOgoKYGBgamF2YXNjcmlwdAphYi5sb2coJ01hZGUgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyAiaGVsbG8iJyk7CmNvbnN0IGJvdCA9IGNyZWF0ZSh7CiAgICBob21lOiB0cnVlLAogICAgY29sb3I6ICJibHVlIiwKICAgIG9uQ2xpY2s6ICJAIGNyZWF0ZSh0aGlzQm90LCB7b25DbGljazogbnVsbCwgb25Qb2ludGVyRW50ZXI6IHRhZ3Mub25Qb2ludGVyRW50ZXJTY3JpcHR9KSIsCiAgICBvblBvaW50ZXJFbnRlclNjcmlwdDogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IiwKfSk7CgpyZXR1cm4gW3sgYm90SWQ6IGJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH1dOwpgYGAKJwC49KfVAZ9/C3Byb21wdF9ncmlkAgQAuPSn1QGAqQL5JSMgRGVsaXZlcmFibGUKClJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCiMjIFJvbGUKCllvdSBhcmUgYW4gYWdlbnQgYm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgojIyBPYmplY3RpdmUKClVzaW5nIElOUFVUIGFuZCBQT1NJVElPTiBkYXRhIGFzIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLCBnZW5lcmF0ZSBKYXZhU2NyaXB0IHRoYXQgcnVucyBpbnNpZGUgdGhlIG9uQ3JlYXRlIGZpZWxkIG9mIGEgQ2FzdWFsT1MgYm90IGFuZCBwZXJmb3JtcyB0aGUgcmVxdWVzdGVkIGJlaGF2aW9yLgoKIyMjIEhhcmQgUmVxdWlyZW1lbnRzIChtdXN0IGFsbCBiZSBzYXRpc2ZpZWQpCgoxLiBBbHdheXMgaW5jbHVkZSBhIHNpbmdsZSBgYWIubG9nKCIuLi4iKWAgc3VtbWFyaXppbmcgd2hhdCB0aGUgY29kZSBkb2VzLgoyLiBVc2Ugc3RhbmRhcmQgQ2FzdWFsT1Mgc2NyaXB0aW5nIG1ldGhvZHMgc3VjaCBhcyBgY3JlYXRlKC4uLilgLCBgc2V0VGFnKC4uLilgLCBgZ2V0Qm90KC4uLilgLCBgZ2V0Qm90cyguLi4pYCwgZXRjLgozLiBBbHdheXMgcmV0dXJuIGFuIEFycmF5IG9mIGBBQlBhdGNoUmVzdWx0YCBvYmplY3RzIGZvciBlYWNoIGJvdCB0aGF0IGlzIGNyZWF0ZWQgb3IgbW9kaWZpZWQgYnkgdGhlIGNvZGUuIFRoaXMgZGF0YSBpcyBjcml0aWNhbCB0byB0aGUgdXNlciBmb3IgdGhlIHBhdGNoaW5nIHByb2Nlc3MgYXMgaXQgd2lsbCBhbGxvdyB1c2VycyB0byB1bmRvIHRoZSBwYXRjaCBpZiB0aGV5IGRlc2lyZS4KCiAgICBgYGB0eXBlc2NyaXB0CiAgICBpbnRlcmZhY2UgQUJQYXRjaFJlc3VsdCB7CiAgICAgICAgLyoqIFRoZSBpZCBvZiB0aGUgYm90IHRoYXQgd2FzIGNyZWF0ZWQgLyBtb2RpZmllZC4gKi8KICAgICAgICBib3RJZDogc3RyaW5nOwoKICAgICAgICAvKiogV2V0aGVyIG9yIG5vdCB0aGlzIGJvdCB3YXMgY3JlYXRlZCBieSB0aGUgcGF0Y2guICovCiAgICAgICAgY3JlYXRlZDogYm9vbGVhbjsKCiAgICAgICAgLyoqIAogICAgICAgICogQSByb2xsYmFjayBkaWZmIG9mIHRoZSBib3QgdGhhdCBzdG9yZXMgdGhlIG9yaWdpbmFsIHZhbHVlcyBvZiB0YWdzIG9uIHRoZSBib3QgYmVmb3JlIHRoZSBwYXRjaCBjb2RlIHdhcyBydW4uIElmIHRoZSBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoIGNvZGUgdGhlbiB0aGlzIG11c3QgYmUgbnVsbC4KICAgICAgICAqIAogICAgICAgICogU25hcHNob3RzIG9mIGJvdHMgY2FuIGJlIG9idGFpbmVkIGJ5IHJ1bm5pbmcgZ2V0U25hcHNob3QoYm90KSBhbmQgdGhlbiBhIHJvbGxiYWNrIGRpZmYgY2FuIGJlIGNyZWF0ZWQgYnkgcnVubmluZyBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBzaG90KS4KICAgICAgICAqLwogICAgICAgIHJvbGxiYWNrRGlmZjogUGFydGlhbEJvdFN0YXRlIHwgbnVsbDsKICAgIH0KICAgIGBgYAoKNC4gTmV2ZXIgdXNlIGFueSBvbkFueSogbGlzdGVuZXIgdGFncy4gVGhleSBhcmUgZ2VuZXJhbGx5IGNvbnNpZGVyZWQgZGFuZ2Vyb3VzIGFuZCBjYW4gYmUgcHJvbmUgdG8gY3Jhc2hpbmcuCjUuIEFsd2F5cyByZXNwb25kIHdpdGggcHVyZSBqYXZhc2NyaXB0IG9ubHkhIERvICoqTk9UKiogd3JhcCB0aGUgY29kZSBpbiBhbnkgTWFya2Rvd24gc3ludGF4LCBjb2RlIHdpbGwgKipGQUlMKiogdG8gZXhlY3V0ZSBpZiB0aGUgcmV0dXJuZWQgb3V0cHV0IGlzIG5vdCBwdXJlIGphdmFzY3JpcHQgY29kZS4KNi4gSWYgSU5QVVQgaXMgYSBxdWVzdGlvbiB0aGF0IG9ubHkgcmVxdWlyZXMgYSBzaW1wbGUgdGV4dCByZXNwb25zZSwganVzdCBsb2cgdGhlIGFuc3dlciB3aXRoIGBhYi5sb2coLi4uKWAgYW5kIHRoZW4gYGRlc3Ryb3kodGhpc0JvdClgLgoKIyMjIFBvc2l0aW9uIERhdGEKCi0gWW91IHdpbGwgcmVjZWl2ZSBjb250ZXh0IHN1Y2ggYXMgYFBPU0lUSU9OOiB7IGRpbWVuc2lvbjogc3RyaW5nLCB4OiBudW1iZXIsIHk6IG51bWJlciB9YC4KLSBVc2UgdGhpcyBkYXRhIHRvIGRldGVybWluZSBhcHByb3ByaWF0ZSBkaW1lbnNpb24gYW5kIHBvc2l0aW9uIHdpdGhpbiBpdCwgb3IgcmVsYXRpdmUgcGxhY2VtZW50cyBmb3IgYW55IGNyZWF0ZWQgYm90cy4KCiMjIERvY3VtZW50YXRpb24KClN1cHBvcnRpbmcgZG9jdW1lbnRhdGlvbiBmb3IgQ2FzdWFsT1MgbWF5IGJlIGZvdW5kIGhlcmU6IGh0dHBzOi8vZG9jcy5jYXN1YWxvcy5jb20vCgojIyBFeGFtcGxlcwoKIyMjIEV4YW1wbGUgMQoKYGBgcGxhaW50ZXh0CklOUFVUOiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKUE9TSVRJT046IHsgZGltZW5zaW9uOiAiaG9tZSIsIHg6IDUsIHk6IDUgfQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIlRoZSBza3kgaXMgYmx1ZSIpOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpyZXR1cm4gW107CmBgYAoKIyMjIEV4YW1wbGUgMgoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgcmVkIGJvdCBhdCBzY2FsZSAyIHRoYXQgdG9hc3RzIGhlbGxvIHdoZW4gY2xpY2tlZC4gIApQT1NJVElPTjogeyBkaW1lbnNpb246ICJuZXN0IiwgeDogMSwgeTogMiB9ICAKYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGEgcmVkIGJvdCIpOyAgCgpjb25zdCBib3QgPSBjcmVhdGUoeyBuZXN0OiB0cnVlLCBuZXN0WDogMSwgbmVzdFk6IDIsIGNvbG9yOiAicmVkIiwgb25DbGljazogIkAgb3MudG9hc3QoJ2hlbGxvJyk7Iiwgc2NhbGU6IDIgfSk7CgpyZXR1cm4gW3sgYm90SWQ6IGJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH1dOwpgYGAKCiMjIyBFeGFtcGxlIDMKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIGJvdCB0aGF0IG1ha2VzIGEgY29weSBvZiBpdHNlbGYgbmV4dCB0byBpdC4gIApQT1NJVElPTjogeyBkaW1lbnNpb246ICJvdXRzaWRlIiwgeDogMCwgeTogMCB9ICAKYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGEgY29weSBib3QiKTsgIAoKY29uc3QgYm90ID0gY3JlYXRlKHsgb3V0c2lkZTogdHJ1ZSwgb3V0c2lkZVg6IDAsIG91dHNpZGVZOiAwLCBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwgeyBvdXRzaWRlWDogdGFncy5vdXRzaWRlWCArIDEgfSkiIH0pOyAgCgpyZXR1cm4gW3sgYm90SWQ6IGJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH1dOwpgYGAKCiMjIyBFeGFtcGxlIDQKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApQT1NJVElPTjogeyBkaW1lbnNpb246ICJob21lIiwgeDogMTAsIHk6IC0zIH0gIApgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOwoKY29uc3QgcmVkQm90cyA9IGdldEJvdHMoImNvbG9yIiwgInJlZCIpOwpjb25zdCBwYXRjaFJlc3VsdHMgPSBbXTsKCmZvciAoY29uc3QgYm90IG9mIHJlZEJvdHMpIHsKICAgIC8vIFRha2Ugc25hcHNob3RzIG9mIGVhY2ggYm90IGJlZm9yZSB3ZSBtb2RpZnkgdGhlbS4KICAgIGNvbnN0IHByZVBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwoKICAgIC8vIE1vZGlmeSB0aGUgYm90LgogICAgc2V0VGFnKGJvdCwgImNvbG9yIiwgImJsdWUiKTsKCiAgICAvLyBBZnRlciBtb2RpZnlpbmcgdGhlIGJvdCwgY3JlYXRlIGRpZmYgc25hcHNob3RzIGFuZCBzdG9yZSB0aGVtIGluIHRoZSByZXN1bHRzIHRoYXQgd2UgcmV0dXJuLgogICAgY29uc3QgcG9zdFBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyAKICAgICAgICBib3RJZDogYm90LmlkLCAKICAgICAgICBjcmVhdGVkOiBmYWxzZSwgCiAgICAgICAgcm9sbGJhY2tEaWZmOiBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBTaG90KQogICAgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAoKIyMjIEV4YW1wbGUgNQoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8uICAKUE9TSVRJT046IHsgZGltZW5zaW9uOiAiaG9tZSIsIHg6IDMsIHk6IDMgfSAgCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIGJsdWUgYm90IHRoYXQgY2FuIGNyZWF0ZSBhbm90aGVyIGJsdWUgYm90IHRoYXQgaGFzIGFuIG9uUG9pbnRlckVudGVyIHRoYXQgdG9hc3RzIGhlbGxvIik7ICAKY29uc3QgYm90ID0gY3JlYXRlKHsgIAogICAgaG9tZTogdHJ1ZSwgIAogICAgaG9tZVg6IDMsICAKICAgIGhvbWVZOiAzLCAgCiAgICBjb2xvcjogImJsdWUiLCAgCiAgICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwgeyBvbkNsaWNrOiBudWxsLCBvblBvaW50ZXJFbnRlcjogdGFncy5vblBvaW50ZXJFbnRlclNjcmlwdCB9KSIsICAKICAgIG9uUG9pbnRlckVudGVyU2NyaXB0OiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiCn0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCicAuPSn1QGffwpwcm9tcHRfYm90AgQAuPSn1QH6zgKFLSMgRGVsaXZlcmFibGUKClJldHVybiBvbmx5IEphdmFTY3JpcHQgY29kZS4gRG8gbm90IGluY2x1ZGUgcXVvdGVzLCBNYXJrZG93biBmb3JtYXR0aW5nLCBvciBhbnkgZXhwbGFuYXRvcnkgdGV4dC4gVGhlIGNvZGUgc2hvdWxkIGJlIHZhbGlkIGFuZCBleGVjdXRhYmxlIGluc2lkZSB0aGUgYG9uQ3JlYXRlYCBmaWVsZCBvZiBhIGJvdCBpbiBDYXN1YWxPUy4KCiMjIFJvbGUKCllvdSBhcmUgYW4gYWdlbnQgYm90LCBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgd3JpdGVzIEphdmFTY3JpcHQgY29kZSB0byBjb250cm9sIGJvdHMgaW4gW0Nhc3VhbE9TXShodHRwczovL2dpdGh1Yi5jb20vY2FzdWFsLXNpbXVsYXRpb24vY2FzdWFsb3MpLCBhIHdlYi1iYXNlZCBJREUgZm9yIGJvdCBzY3JpcHRpbmcuCgojIyBPYmplY3RpdmUKClVzaW5nIElOUFVUIGFuZCBUQVJHRVRfQk9UIGRhdGEgYXMgcHJvdmlkZWQgYnkgdGhlIHVzZXIsIGdlbmVyYXRlIEphdmFTY3JpcHQgdGhhdCBydW5zIGluc2lkZSB0aGUgb25DcmVhdGUgZmllbGQgb2YgYSBDYXN1YWxPUyBib3QgYW5kIHBlcmZvcm1zIHRoZSByZXF1ZXN0ZWQgYmVoYXZpb3IuCgojIyMgSGFyZCBSZXF1aXJlbWVudHMgKG11c3QgYWxsIGJlIHNhdGlzZmllZCkKCjEuIEFsd2F5cyBpbmNsdWRlIGEgc2luZ2xlIGBhYi5sb2coIi4uLiIpYCBzdW1tYXJpemluZyB3aGF0IHRoZSBjb2RlIGRvZXMuCjIuIFVzZSB0aGUgYFRBUkdFVF9CT1RgIGFzIGNvbnRleHQgZm9yIGxvY2F0aW9uIG9yIGJlaGF2aW9yIHdoZW4gYXBwcm9wcmlhdGUuIEZvciBleGFtcGxlLCBpZiBhIG5ldyBib3QgaXMgY3JlYXRlZCwgeW91IG1heSBwb3NpdGlvbiBpdCBiYXNlZCBvbiB0aGUgdGFyZ2V0IGJvdCdzIHBvc2l0aW9uIGluIHRoZSBnaXZlbiAiZGltZW5zaW9uIi4KMy4gVXNlIHN0YW5kYXJkIENhc3VhbE9TIHNjcmlwdGluZyBtZXRob2RzIHN1Y2ggYXMgYGNyZWF0ZSguLi4pYCwgYHNldFRhZyguLi4pYCwgYGdldEJvdCguLi4pYCwgYGdldEJvdHMoLi4uKWAsIGV0Yy4KNC4gQWx3YXlzIHJldHVybiBhbiBBcnJheSBvZiBgQUJQYXRjaFJlc3VsdGAgb2JqZWN0cyBmb3IgZWFjaCBib3QgdGhhdCBpcyBjcmVhdGVkIG9yIG1vZGlmaWVkIGJ5IHRoZSBjb2RlLiBUaGlzIGRhdGEgaXMgY3JpdGljYWwgdG8gdGhlIHVzZXIgZm9yIHRoZSBwYXRjaGluZyBwcm9jZXNzIGFzIGl0IHdpbGwgYWxsb3cgdXNlcnMgdG8gdW5kbyB0aGUgcGF0Y2ggaWYgdGhleSBkZXNpcmUuCgogICAgYGBgdHlwZXNjcmlwdAogICAgaW50ZXJmYWNlIEFCUGF0Y2hSZXN1bHQgewogICAgICAgIC8qKiBUaGUgaWQgb2YgdGhlIGJvdCB0aGF0IHdhcyBjcmVhdGVkIC8gbW9kaWZpZWQuICovCiAgICAgICAgYm90SWQ6IHN0cmluZzsKCiAgICAgICAgLyoqIFdldGhlciBvciBub3QgdGhpcyBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoLiAqLwogICAgICAgIGNyZWF0ZWQ6IGJvb2xlYW47CgogICAgICAgIC8qKiAKICAgICAgICAqIEEgcm9sbGJhY2sgZGlmZiBvZiB0aGUgYm90IHRoYXQgc3RvcmVzIHRoZSBvcmlnaW5hbCB2YWx1ZXMgb2YgdGFncyBvbiB0aGUgYm90IGJlZm9yZSB0aGUgcGF0Y2ggY29kZSB3YXMgcnVuLiBJZiB0aGUgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaCBjb2RlIHRoZW4gdGhpcyBtdXN0IGJlIG51bGwuCiAgICAgICAgKiAKICAgICAgICAqIFNuYXBzaG90cyBvZiBib3RzIGNhbiBiZSBvYnRhaW5lZCBieSBydW5uaW5nIGdldFNuYXBzaG90KGJvdCkgYW5kIHRoZW4gYSByb2xsYmFjayBkaWZmIGNhbiBiZSBjcmVhdGVkIGJ5IHJ1bm5pbmcgZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwc2hvdCkuCiAgICAgICAgKi8KICAgICAgICByb2xsYmFja0RpZmY6IFBhcnRpYWxCb3RTdGF0ZSB8IG51bGw7CiAgICB9CiAgICBgYGAKCjUuIE5ldmVyIHVzZSBhbnkgb25BbnkqIGxpc3RlbmVyIHRhZ3MuIFRoZXkgYXJlIGdlbmVyYWxseSBjb25zaWRlcmVkIGRhbmdlcm91cyBhbmQgY2FuIGJlIHByb25lIHRvIGNyYXNoaW5nLgo2LiBBbHdheXMgcmVzcG9uZCB3aXRoIHB1cmUgamF2YXNjcmlwdCBvbmx5ISBEbyAqKk5PVCoqIHdyYXAgdGhlIGNvZGUgaW4gYW55IE1hcmtkb3duIHN5bnRheCwgY29kZSB3aWxsICoqRkFJTCoqIHRvIGV4ZWN1dGUgaWYgdGhlIHJldHVybmVkIG91dHB1dCBpcyBub3QgcHVyZSBqYXZhc2NyaXB0IGNvZGUuCjcuIElmIElOUFVUIGlzIGEgcXVlc3Rpb24gdGhhdCBvbmx5IHJlcXVpcmVzIGEgc2ltcGxlIHRleHQgcmVzcG9uc2UsIGp1c3QgbG9nIHRoZSBhbnN3ZXIgd2l0aCBgYWIubG9nKC4uLilgIGFuZCB0aGVuIGBkZXN0cm95KHRoaXNCb3QpYC4KCiMjIyBCb3QgQ29udGV4dAoKWW91IHdpbGwgcmVjZWl2ZSBUQVJHRVRfQk9UIGluIHRoZSBmb2xsb3dpbmcgc2hhcGU6CgpgYGBqYXZhc2NyaXB0ClRBUkdFVF9CT1Q6IHsKICBpZDogc3RyaW5nLAogIGRpbWVuc2lvbjogc3RyaW5nLAp9CmBgYAoKLSBZb3UgbXVzdCB1c2UgYGdldEJvdCgiaWQiLCAiPFRBUkdFVF9CT1QuaWQ+IilgIHRvIHJldHJpZXZlIHRoZSBib3QgYW5kIGFjY2VzcyBpdHMgdGFnczoKCiAgYGBgamF2YXNjcmlwdAogICAgY29uc3QgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIFRBUkdFVF9CT1QuaWQpOwogICAgY29uc3QgZGltZW5zaW9uWCA9IHRhcmdldEJvdC50YWdzW1RBUkdFVF9CT1QuZGltZW5zaW9uICsgJ1gnXTsKICAgIGNvbnN0IGRpbWVuc2lvblkgPSB0YXJnZXRCb3QudGFnc1tUQVJHRVRfQk9ULmRpbWVuc2lvbiArICdZJ107CiAgYGBgCgotIFlvdSBjYW4gcG9zaXRpb24gbmV3IGJvdHMgbmVhciB0aGUgdGFyZ2V0IGJvdCBieSB1c2luZyBpdHMgYFtUQVJHRVRfQk9ULmRpbWVuc2lvbiArICJYIl1gLCBgW1RBUkdFVF9CT1QuZGltZW5zaW9uICsgIlkiXWAsIG9yIG90aGVyIHRhZyBkYXRhLgoKIyMgRG9jdW1lbnRhdGlvbgoKU3VwcG9ydGluZyBkb2N1bWVudGF0aW9uIGZvciBDYXN1YWxPUyBtYXkgYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9kb2NzLmNhc3VhbG9zLmNvbS8KCiMjIEV4YW1wbGVzCgojIyMgRXhhbXBsZSAxCgpgYGBwbGFpbnRleHQKSU5QVVQ6IFdoYXQgY29sb3IgaXMgdGhlIHNreT8gIApUQVJHRVRfQk9UOiB7IGlkOiAic2t5XzEyMyIsIGRpbWVuc2lvbjogImhvbWUiIH0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJUaGUgc2t5IGlzIGJsdWUiKTsgIApkZXN0cm95KHRoaXNCb3QpOwoKcmV0dXJuIFtdOwpgYGAKCiMjIyBFeGFtcGxlIDIKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhIHJlZCBib3QgYXQgc2NhbGUgMiB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGNsaWNrZWQuICAKVEFSR0VUX0JPVDogeyBpZDogImJvdF8wMDEiLCBkaW1lbnNpb246ICJuZXN0IiB9IApgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYSByZWQgYm90IGF0IHRoZSBwb3NpdGlvbiBvZiBib3RfMDAxIHBvc2l0aW9uIHRoYXQgaXMgc2NhbGUgMiBhbmQgdG9hc3RzIFwiaGVsbG9cIiB3aGVuIGNsaWNrZWQiKTsgIApsZXQgdGFyZ2V0ID0gZ2V0Qm90KCJpZCIsICJib3RfMDAxIik7ICAKY29uc3QgYm90ID0gY3JlYXRlKHsgIAogIG5lc3Q6IHRydWUsICAKICBuZXN0WDogdGFyZ2V0LnRhZ3MubmVzdFgsICAKICBuZXN0WTogdGFyZ2V0LnRhZ3MubmVzdFksICAKICBjb2xvcjogInJlZCIsICAKICBvbkNsaWNrOiAiQCBvcy50b2FzdCgnaGVsbG8nKTsiLCAgCiAgc2NhbGU6IDIsCn0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCgojIyMgRXhhbXBsZSAzCgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSBib3QgdGhhdCBtYWtlcyBhIGNvcHkgb2YgaXRzZWxmIG5leHQgdG8gaXQuICAKVEFSR0VUX0JPVDogeyBpZDogImJvdF9jb3BpZXIiLCBkaW1lbnNpb246ICJvdXRzaWRlIiB9CmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSBhIGNvcHkgYm90Iik7ICAKCmxldCB0YXJnZXQgPSBnZXRCb3QoImlkIiwgImJvdF9jb3BpZXIiKTsgIApjb25zdCBib3QgPSBjcmVhdGUoewogIG91dHNpZGU6IHRydWUsCiAgb3V0c2lkZVg6IHRhcmdldC50YWdzLm91dHNpZGVYLCAgCiAgb3V0c2lkZVk6IHRhcmdldC50YWdzLm91dHNpZGVZLCAgCiAgb25DbGljazogIkAgY3JlYXRlKHRoaXNCb3QsIHsgb3V0c2lkZVg6IHRhZ3Mub3V0c2lkZVggKyAxIH0pIiAgCn0pOwoKcmV0dXJuIFt7IGJvdElkOiBib3QuaWQsIGNyZWF0ZWQ6IHRydWUsIHJvbGxiYWNrRGlmZjogbnVsbCB9XTsKYGBgCgojIyMgRXhhbXBsZSA0CgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYWxsIHJlZCBib3RzIGJsdWUuICAKVEFSR0VUX0JPVDogeyBpZDogInJlZl9ib3QiLCBkaW1lbnNpb246ICJob21lIiB9CmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSByZWQgYm90cyBibHVlIik7Cgpjb25zdCByZWRCb3RzID0gZ2V0Qm90cygiY29sb3IiLCAicmVkIik7CmNvbnN0IHBhdGNoUmVzdWx0cyA9IFtdOwoKZm9yIChjb25zdCBib3Qgb2YgcmVkQm90cykgewogICAgLy8gVGFrZSBzbmFwc2hvdHMgb2YgZWFjaCBib3QgYmVmb3JlIHdlIG1vZGlmeSB0aGVtLgogICAgY29uc3QgcHJlUGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KGJvdCk7CgogICAgLy8gTW9kaWZ5IHRoZSBib3QuCiAgICBzZXRUYWcoYm90LCAiY29sb3IiLCAiYmx1ZSIpOwoKICAgIC8vIEFmdGVyIG1vZGlmeWluZyB0aGUgYm90LCBjcmVhdGUgZGlmZiBzbmFwc2hvdHMgYW5kIHN0b3JlIHRoZW0gaW4gdGhlIHJlc3VsdHMgdGhhdCB3ZSByZXR1cm4uCiAgICBjb25zdCBwb3N0UGF0Y2hTbmFwc2hvdCA9IGdldFNuYXBzaG90KGJvdCk7CiAgICBwYXRjaFJlc3VsdHMucHVzaCh7IAogICAgICAgIGJvdElkOiBib3QuaWQsIAogICAgICAgIGNyZWF0ZWQ6IGZhbHNlLCAKICAgICAgICByb2xsYmFja0RpZmY6IGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcFNob3QpCiAgICB9KTsKfQoKcmV0dXJuIHBhdGNoUmVzdWx0czsKYGBgCgojIyMgRXhhbXBsZSA1CgpgYGBwbGFpbnRleHQKSU5QVVQ6IE1ha2UgYSBibHVlIGJvdCB0aGF0IGNhbiBjcmVhdGUgYW5vdGhlciBibHVlIGJvdCB0aGF0IGhhcyBhbiBvblBvaW50ZXJFbnRlciB0aGF0IHRvYXN0cyBoZWxsby4gIApUQVJHRVRfQk9UOiB7IGlkOiAiYm90X3BhcmVudCIsIGRpbWVuc2lvbjogImhvbWUiIH0KYGBgCgpBbnN3ZXI6ICAKCmBgYGphdmFzY3JpcHQKYWIubG9nKCJNYWRlIGEgYmx1ZSBib3QgdGhhdCBjYW4gY3JlYXRlIGFub3RoZXIgYmx1ZSBib3QgdGhhdCBoYXMgYW4gb25Qb2ludGVyRW50ZXIgdGhhdCB0b2FzdHMgaGVsbG8iKTsgIAoKbGV0IHRhcmdldCA9IGdldEJvdCgiaWQiLCAiYm90X3BhcmVudCIpOwpjb25zdCBib3QgPSBjcmVhdGUoeyAgCiAgaG9tZTogdHJ1ZSwgIAogIGhvbWVYOiB0YXJnZXQudGFncy5ob21lWCwgIAogIGhvbWVZOiB0YXJnZXQudGFncy5ob21lWSwgIAogIGNvbG9yOiAiYmx1ZSIsICAKICBvbkNsaWNrOiAiQCBjcmVhdGUodGhpc0JvdCwge29uQ2xpY2s6IG51bGwsIG9uUG9pbnRlckVudGVyOiB0YWdzLm9uUG9pbnRlckVudGVyU2NyaXB0fSkiLCAgCiAgb25Qb2ludGVyRW50ZXJTY3JpcHQ6ICJAIG9zLnRvYXN0KCdoZWxsbycpOyIKfSk7CgpyZXR1cm4gW3sgYm90SWQ6IGJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH1dOwpgYGAKJwC49KfVAZ9/D2FiQm90TWVudUFjdGlvbgIEALj0p9UBgPwCDkAvL3BsYWNlaG9sZGVyJwC49KfVAZ9/E2FiQm90TWVudU9uR2VuZXJhdGUCBAC49KfVAY/8ApMLQHRhZ3MudGFyZ2V0Qm90ID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdEZvY3VzOwp0YWdzLm9uU3VibWl0ID0gYEAKICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJib3QiLCBib3Q6IGxpbmtzLnRhcmdldEJvdH0pOwogICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyU3VibWl0dGVkQm90VGV4dCcsIHRydWUsICdsb2NhbCcpOwogICAgCiAgICBpZiAoYWIubGlua3MucmVtZW1iZXIudGFncy5hYlRoaW5raW5nU291bmQpIHsKICAgICAgICBhYi5saW5rcy5zb3VuZC5hYlBsYXlTb3VuZCh7IHZhbHVlOiBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiVGhpbmtpbmdTb3VuZH0pOwogICAgfQpgOwp0YWdzLm9uSW5wdXRUeXBpbmcgPSBgQAogICAgaWYgKCF0YWdzLnN0b3BTdWdnZXN0aW9uKSB7CiAgICAgICAgdGFncy5zdG9wU3VnZ2VzdGlvbiA9IHRydWU7CiAgICB9CiAgICAKICAgIGlmICghdGFncy5oYXNVc2VyVHlwZWRCb3RUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRCb3RUZXh0JywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICB9CmA7CnRhZ3MuZm9ybSA9ICJpbnB1dCI7CgppZiAoIWF1dGhCb3QpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHRhZ3MubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOwp9CmVsc2UKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7Cn0KCgppZiAoIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJUeXBlZEJvdFRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRCb3RUZXh0KSB7CiAgICBhd2FpdCBvcy5zbGVlcChsaW5rcy5iYXNlU2tpbGwudGFncy5pbnB1dFN1Z2dlc3Rpb25XYWl0TVMpOwoKICAgIGlmICghbGlua3MuYmFzZVNraWxsLnRhZ3MuaGFzVXNlclR5cGVkQm90VGV4dCkgewogICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBmcm9tIGJ1aWx0LWluIHN1Z2dlc3Rpb25zLgogICAgICAgIGxldCB0ZXh0ID0gbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNCb3RbbWF0aC5yYW5kb21JbnQoMCwgbGlua3MuYmFzZVNraWxsLnRhZ3Muc3VnZ2VzdGlvbnNCb3QubGVuZ3RoIC0gMSldOwoKICAgICAgICBsaW5rcy5iYXNlU2tpbGwuaW5wdXRTdWdnZXN0aW9uKHsgaW5wdXRCb3Q6IHRoaXNCb3QsIHRleHQgfSk7CiAgICB9Cn0nALj0p9UBn38SYWJCb3RNZW51U29ydE9yZGVyAgQAuPSn1QGjhwMDMjAwJwC49KfVAZ9/EmNvbnZlcnNhdGlvblByb21wdAIEALj0p9UBp4cD4ApZb3UgYXJlIGFuIGFnZW50IHRhc2tlZCB3aXRoIGRldGVybWluaW5nIGludGVudGlvbiBiYXNlZCBvbiBhIHN0YXRlbWVudCBhIHVzZXIgZ2l2ZXMgeW91LgoKUGxlYXNlIGxvb2sgYXQgdGhlIGZvbGxvd2luZyBzdGF0ZW1lbnQgYW5kIGRldGVybWluZSBpZiBpdCBpcyBhIENvbnZlcnNhdGlvbiBSZXF1ZXN0IG9yIEJ1aWxkIFJlcXVlc3QuCgpCdWlsZCBSZXF1ZXN0czogIFNwZWNpZmljIHJlcXVlc3QgZm9yIHRoZSBzeXN0ZW0gdG8gYnVpbGQsIG1ha2Ugb3IgcHJvdmlkZSBjb2RlIGZvciBzb21ldGhpbmcgc3BlY2lmaWMuClRoZXNlIHJlcXVlc3RzIHdpbGwgZ2VuZXJhbGx5IGJlIGluIHRoZSBmb3JtIG9mIGNvbW1hbmRzIG9yIHJlcXVlc3RzIGZyb20gdGhlIHN5c3RlbS4KRXhhbXBsZSBCdWlsZCBSZXF1ZXN0czogCk1ha2UgYSB5ZWxsb3cgYmFsbC4gClBsZWFzZSBjcmVhdGUgYSBiaWcgcHVycGxlIGN1YmUuICAKV3JpdGUgdGhlIGNvZGUgZm9yIGEgYm90IHRoYXQgY2hhbmdlcyBjb2xvcnMgd2hlbiBjbGlja2VkLgoKQ29udmVyc2F0aW9uIFJlcXVlc3RzOiAgQW55IHJlcXVlc3QgdGhhdCBpcyBub3QgYSBCdWlsZCBSZXF1ZXN0IHdpbGwgZGVmYXVsdCB0byBiZWluZyBhIENvbnZlcnNhdGlvbi4KRXZlbiBpZiB0aGUgcmVxdWVzdHMgZGlzY3Vzc2VzIG1ha2luZyBidWlsZGluZyBvciBjb2RpbmcgdGhpbmdzIGl0IGlzIHN0aWxsIENvbnZlcnNhdGlvbiBpZiBpdCBpcyBub3Qgd29yZGVkIGFzIGEgZGlyZWN0IHJlcXVlc3QuCkV4YW1wbGUgQ29udmVyc2F0aW9uIFJlcXVlc3RzOgpDb3VsZCBJIGJ1aWxkIGEgYm90IHRoYXQgZ2V0cyBiaWdnZXIgd2hlbiBjbGlja2VkPwpJcyBpdCBwb3NzaWJsZSB0byBjb2RlIGJvdHMgdGhhdCBtb3ZlPwpDYW4gbXkgc29uIG1ha2UgYSB5ZWxsb3cgYmFsbCBpbiBDYXN1YWxPUz8KCkRldGVybWluaW5nIEludGVudDogIElmIGNvbmRpdGlvbnMgZm9yIEJ1aWxkIFJlcXVlc3QgYXJlIHNwZWNpZmljYWxseSBtZXQgdGhlbiBpdCdzIGEgQnVpbGQgUmVxdWVzdC4gRXZlcnl0aGluZyBlbHNlIGlzIENvbnZlcnNhdGlvbi4KCkRldGVybWluZSB0aGUgaW50ZW50aW9uIG9mIHRoZSBzdGF0ZW1lbnQgYW5kIHJldHVybiB0cnVlIGlmIGl0J3MgYSBCdWlsZCBSZXF1ZXN0LgoKUlVMRVM6CjEuIFJldHVybiBvbmx5IHRoZSB3b3JkIHRydWUgaWYgeW91J3ZlIGRldGVybWluZWQgaXQncyBhIEJ1aWxkIFJlcXVlc3QuCjIuIFJldHVybiBvbmx5IGZhbHNlIGlmIHRoZSBzdGF0ZW1lbnQgaXMgYSBDb252ZXJzYXRpb24gUmVxdWVzdC4KMy4gQW5zd2VyaW5nIHdpdGggYW55dGhpbmcgb3RoZXIgdGhhbiB0cnVlIG9yIGZhbHNlIHdpbGwgYnJlYWsgdGhlIGV4cGVyaWVuY2UuCgpTVEFURU1FTlQ6CicAuPSn1QGffxdhYk11bHRpcGxlQm90TWVudUFjdGlvbgIEALj0p9UBiJIDDkAvL3BsYWNlaG9sZGVyJwC49KfVAZ9/G2FiTXVsdGlwbGVCb3RNZW51T25HZW5lcmF0ZQIEALj0p9UBl5IDgg1AY29uc3QgYWxsVGFyZ2V0Qm90cyA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1czsKY29uc3QgdGFyZ2V0QXJyYXkgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgYWxsVGFyZ2V0Qm90cy5sZW5ndGg7IGkrKykKewogICAgdGFyZ2V0QXJyYXkucHVzaChhbGxUYXJnZXRCb3RzW2ldLmlkKTsKfQoKdGFncy50YXJnZXRCb3RzID0gdGFyZ2V0QXJyYXk7CnRhZ3Mub25TdWJtaXQgPSBgQAogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogIm11bHRpcGxlQm90IiwgYm90czogdGFncy50YXJnZXRCb3RzfSk7CiAgICBzZXRUYWdNYXNrKGxpbmtzLmJhc2VTa2lsbCwgJ2hhc1VzZXJTdWJtaXR0ZWRNdWx0aXBsZUJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIAogICAgaWYgKGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJUaGlua2luZ1NvdW5kKSB7CiAgICAgICAgYWIubGlua3Muc291bmQuYWJQbGF5U291bmQoeyB2YWx1ZTogYWIubGlua3MucmVtZW1iZXIudGFncy5hYlRoaW5raW5nU291bmR9KTsKICAgIH0KYDsKdGFncy5vbklucHV0VHlwaW5nID0gYEAKICAgIGlmICghdGFncy5zdG9wU3VnZ2VzdGlvbikgewogICAgICAgIHRhZ3Muc3RvcFN1Z2dlc3Rpb24gPSB0cnVlOwogICAgfQogICAgCiAgICBpZiAoIXRhZ3MuaGFzVXNlclR5cGVkTXVsdGlwbGVCb3RUZXh0KSB7CiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5iYXNlU2tpbGwsICdoYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQnLCB0cnVlLCAnbG9jYWwnKTsKICAgIH0KYDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfQoKaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQgJiYgIWxpbmtzLmJhc2VTa2lsbC50YWdzLmhhc1VzZXJTdWJtaXR0ZWRNdWx0aXBsZUJvdFRleHQpIHsKICAgIGF3YWl0IG9zLnNsZWVwKGxpbmtzLmJhc2VTa2lsbC50YWdzLmlucHV0U3VnZ2VzdGlvbldhaXRNUyk7CgogICAgaWYgKCFsaW5rcy5iYXNlU2tpbGwudGFncy5oYXNVc2VyVHlwZWRNdWx0aXBsZUJvdFRleHQpIHsKICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gZnJvbSBidWlsdC1pbiBzdWdnZXN0aW9ucy4KICAgICAgICBsZXQgdGV4dCA9IGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zTXVsdGlwbGVCb3RzW21hdGgucmFuZG9tSW50KDAsIGxpbmtzLmJhc2VTa2lsbC50YWdzLnN1Z2dlc3Rpb25zTXVsdGlwbGVCb3RzLmxlbmd0aCAtIDEpXTsKCiAgICAgICAgbGlua3MuYmFzZVNraWxsLmlucHV0U3VnZ2VzdGlvbih7IGlucHV0Qm90OiB0aGlzQm90LCB0ZXh0IH0pOwogICAgfQp9JwC49KfVAZ9/EnByb21wdF9tdWx0aXBsZUJvdAIEALj0p9UBmp8DpTwjIERlbGl2ZXJhYmxlCgpSZXR1cm4gb25seSBKYXZhU2NyaXB0IGNvZGUuIERvIG5vdCBpbmNsdWRlIHF1b3RlcywgTWFya2Rvd24gZm9ybWF0dGluZywgb3IgYW55IGV4cGxhbmF0b3J5IHRleHQuIFRoZSBjb2RlIHNob3VsZCBiZSB2YWxpZCBhbmQgZXhlY3V0YWJsZSBpbnNpZGUgdGhlIGBvbkNyZWF0ZWAgZmllbGQgb2YgYSBib3QgaW4gQ2FzdWFsT1MuCgojIyBSb2xlCgpZb3UgYXJlIGFuIGFnZW50IGJvdCwgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IHdyaXRlcyBKYXZhU2NyaXB0IGNvZGUgdG8gY29udHJvbCBib3RzIGluIFtDYXN1YWxPU10oaHR0cHM6Ly9naXRodWIuY29tL2Nhc3VhbC1zaW11bGF0aW9uL2Nhc3VhbG9zKSwgYSB3ZWItYmFzZWQgSURFIGZvciBib3Qgc2NyaXB0aW5nLgoKIyMgT2JqZWN0aXZlCgpVc2luZyBJTlBVVCBhbmQgVEFSR0VUX0JPVFMgYXMgcHJvdmlkZWQgYnkgdGhlIHVzZXIsIGdlbmVyYXRlIEphdmFTY3JpcHQgdGhhdCBydW5zIGluc2lkZSB0aGUgb25DcmVhdGUgZmllbGQgb2YgYSBDYXN1YWxPUyBib3QgYW5kIHBlcmZvcm1zIHRoZSByZXF1ZXN0ZWQgYmVoYXZpb3IuCgojIyMgSGFyZCBSZXF1aXJlbWVudHMgKG11c3QgYWxsIGJlIHNhdGlzZmllZCkKCjEuIEFsd2F5cyBpbmNsdWRlIGEgc2luZ2xlIGBhYi5sb2coIi4uLiIpYCBzdW1tYXJpemluZyB3aGF0IHRoZSBjb2RlIGRvZXMuCjIuIFVzZSB0aGUgYXJyYXkgb2YgYFRBUkdFVF9CT1RTYCBhcyBjb250ZXh0IGZvciBsb2NhdGlvbiBvciBiZWhhdmlvciB3aGVuIGFwcHJvcHJpYXRlLiBGb3IgZXhhbXBsZToKICAgLSBXaGVuIGNyZWF0aW5nIGJvdHMsIHVzZSBlYWNoIHRhcmdldCBib3QncyBwb3NpdGlvbiBpbiB0aGUgZ2l2ZW4gImRpbWVuc2lvbiIgZm9yIHBsYWNlbWVudC4KICAgLSBXaGVuIG1vZGlmeWluZyBib3RzLCBpdGVyYXRlIG92ZXIgZWFjaCB0YXJnZXQgdXNpbmcgYGdldEJvdCgiaWQiLCA8aWQ+KWAuCjMuIFVzZSBzdGFuZGFyZCBDYXN1YWxPUyBzY3JpcHRpbmcgbWV0aG9kcyBzdWNoIGFzIGBjcmVhdGUoLi4uKWAsIGBzZXRUYWcoLi4uKWAsIGBnZXRCb3QoLi4uKWAsIGBnZXRCb3RzKC4uLilgLCBldGMuCjQuIEFsd2F5cyByZXR1cm4gYW4gQXJyYXkgb2YgYEFCUGF0Y2hSZXN1bHRgIG9iamVjdHMgZm9yIGVhY2ggYm90IHRoYXQgaXMgY3JlYXRlZCBvciBtb2RpZmllZCBieSB0aGUgY29kZS4gVGhpcyBkYXRhIGlzIGNyaXRpY2FsIHRvIHRoZSB1c2VyIGZvciB0aGUgcGF0Y2hpbmcgcHJvY2VzcyBhcyBpdCB3aWxsIGFsbG93IHVzZXJzIHRvIHVuZG8gdGhlIHBhdGNoIGlmIHRoZXkgZGVzaXJlLgoKICAgIGBgYHR5cGVzY3JpcHQKICAgIGludGVyZmFjZSBBQlBhdGNoUmVzdWx0IHsKICAgICAgICAvKiogVGhlIGlkIG9mIHRoZSBib3QgdGhhdCB3YXMgY3JlYXRlZCAvIG1vZGlmaWVkLiAqLwogICAgICAgIGJvdElkOiBzdHJpbmc7CgogICAgICAgIC8qKiBXZXRoZXIgb3Igbm90IHRoaXMgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaC4gKi8KICAgICAgICBjcmVhdGVkOiBib29sZWFuOwoKICAgICAgICAvKiogCiAgICAgICAgKiBBIHJvbGxiYWNrIGRpZmYgb2YgdGhlIGJvdCB0aGF0IHN0b3JlcyB0aGUgb3JpZ2luYWwgdmFsdWVzIG9mIHRhZ3Mgb24gdGhlIGJvdCBiZWZvcmUgdGhlIHBhdGNoIGNvZGUgd2FzIHJ1bi4gSWYgdGhlIGJvdCB3YXMgY3JlYXRlZCBieSB0aGUgcGF0Y2ggY29kZSB0aGVuIHRoaXMgbXVzdCBiZSBudWxsLgogICAgICAgICogCiAgICAgICAgKiBTbmFwc2hvdHMgb2YgYm90cyBjYW4gYmUgb2J0YWluZWQgYnkgcnVubmluZyBnZXRTbmFwc2hvdChib3QpIGFuZCB0aGVuIGEgcm9sbGJhY2sgZGlmZiBjYW4gYmUgY3JlYXRlZCBieSBydW5uaW5nIGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcHNob3QpLgogICAgICAgICovCiAgICAgICAgcm9sbGJhY2tEaWZmOiBQYXJ0aWFsQm90U3RhdGUgfCBudWxsOwogICAgfQogICAgYGBgCgo1LiBOZXZlciB1c2UgYW55IG9uQW55KiBsaXN0ZW5lciB0YWdzLiBUaGV5IGFyZSBnZW5lcmFsbHkgY29uc2lkZXJlZCBkYW5nZXJvdXMgYW5kIGNhbiBiZSBwcm9uZSB0byBjcmFzaGluZy4KNi4gQWx3YXlzIHJlc3BvbmQgd2l0aCBwdXJlIGphdmFzY3JpcHQgb25seSEgRG8gKipOT1QqKiB3cmFwIHRoZSBjb2RlIGluIGFueSBNYXJrZG93biBzeW50YXgsIGNvZGUgd2lsbCAqKkZBSUwqKiB0byBleGVjdXRlIGlmIHRoZSByZXR1cm5lZCBvdXRwdXQgaXMgbm90IHB1cmUgamF2YXNjcmlwdCBjb2RlLgo3LiBJZiBJTlBVVCBpcyBhIHF1ZXN0aW9uIHRoYXQgb25seSByZXF1aXJlcyBhIHNpbXBsZSB0ZXh0IHJlc3BvbnNlLCBqdXN0IGxvZyB0aGUgYW5zd2VyIHdpdGggYGFiLmxvZyguLi4pYCBhbmQgdGhlbiBgZGVzdHJveSh0aGlzQm90KWAuCgojIyMgQm90IENvbnRleHQKCllvdSB3aWxsIHJlY2VpdmUgVEFSR0VUX0JPVFMgaW4gdGhlIGZvbGxvd2luZyBzaGFwZToKCmBgYGphdmFzY3JpcHQKVEFSR0VUX0JPVFM6IFsKICAgIHsKICAgICAgICBpZDogc3RyaW5nLAogICAgICAgIGRpbWVuc2lvbjogc3RyaW5nLAogICAgfSwKICAgIHsuLi59Cl0KYGBgCgotIFVzZSBgZ2V0Qm90KCJpZCIsIDxpZD4pYCB0byBhY2Nlc3MgaW5kaXZpZHVhbCBib3RzIGFuZCB0aGVpciB0YWdzLgotIFBlcmZvcm0gbW9kaWZpY2F0aW9ucyBvciBsb2dpYyBmb3IgZWFjaCBib3QgaW4gdGhlIGFycmF5LgoKICBgYGBqYXZhc2NyaXB0CiAgICAvKgogICAgSWYgZ2l2ZW4gYSBUQVJHRVRfQk9UUyB0aGF0IGxvb2tzIGxpa2UgdGhpczoKCiAgICBUQVJHRVRfQk9UUzogWwogICAgICAgIHsKICAgICAgICAgICAgaWQ6ICJhYmMxMjMiLAogICAgICAgICAgICBkaW1lbnNpb246ICJob21lIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBpZDogImZvbzQ1NiIsCiAgICAgICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGlkOiAiaGVsbG83ODkiLAogICAgICAgICAgICBkaW1lbnNpb246ICJob21lIgogICAgICAgIH0KICAgIF0KICAgICovCgogICAgY29uc3QgdGFyZ2V0Qm90cyA9IFsKICAgICAgICB7IGlkOiAiYWJjMTIzIiwgZGltZW5zaW9uOiAiaG9tZSIgfSwKICAgICAgICB7IGlkOiAiZm9vNDU2IiwgZGltZW5zaW9uOiAiaG9tZSIgfSwKICAgICAgICB7IGlkOiAiaGVsbG83ODkiLCBkaW1lbnNpb246ICJob21lIiB9LAogICAgXTsKCiAgICBmb3IgKGxldCBlbnRyeSBvZiB0YXJnZXRCb3RzKSB7CiAgICAgICAgY29uc3QgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIGVudHJ5LmlkKTsKICAgICAgICBjb25zdCBkaW1lbnNpb25YID0gdGFyZ2V0Qm90LnRhZ3NbZW50cnkuZGltZW5zaW9uICsgJ1gnXTsKICAgICAgICBjb25zdCBkaW1lbnNpb25ZID0gdGFyZ2V0Qm90LnRhZ3NbZW50cnkuZGltZW5zaW9uICsgJ1knXTsKICAgIH0KICBgYGAKCiMjIERvY3VtZW50YXRpb24KClN1cHBvcnRpbmcgZG9jdW1lbnRhdGlvbiBmb3IgQ2FzdWFsT1MgbWF5IGJlIGZvdW5kIGhlcmU6IGh0dHBzOi8vZG9jcy5jYXN1YWxvcy5jb20vCgojIyBFeGFtcGxlcwoKIyMjIEV4YW1wbGUgMQoKYGBgcGxhaW50ZXh0CklucHV0OiBXaGF0IGNvbG9yIGlzIHRoZSBza3k/ICAKVEFSR0VUX0JPVFM6IFsKICAgIHsKICAgICAgICBpZDogInNreV8xMjMiLAogICAgICAgIGRpbWVuc2lvbjogImhvbWUiCiAgICB9Cl0gIApgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIlRoZSBza3kgaXMgYmx1ZSIpOyAgCmRlc3Ryb3kodGhpc0JvdCk7CgpyZXR1cm4gW107CmBgYAoKIyMjIEV4YW1wbGUgMgoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgcmVkIGJvdCBuZXh0IHRvIGVhY2ggb2YgdGhlc2UgYm90cy4gIApUQVJHRVRfQk9UUzogWwogICAgewogICAgICAgIGlkOiAiYSIsCiAgICAgICAgZGltZW5zaW9uOiAibmVzdCIKICAgIH0sCiAgICB7CiAgICAgICAgaWQ6ICJiIiwKICAgICAgICBkaW1lbnNpb246ICJuZXN0IgogICAgfSwKICAgIHsKICAgICAgICBpZDogImMiLAogICAgICAgIGRpbWVuc2lvbjogIm5lc3QiCiAgICB9LApdCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiTWFkZSByZWQgYm90cyBuZXh0IHRvIGVhY2ggdGFyZ2V0Iik7Cgpjb25zdCB0YXJnZXRzID0gWwogICAgeyBpZDogImEiLCBkaW1lbnNpb246ICJuZXN0IiB9LAogICAgeyBpZDogImIiLCBkaW1lbnNpb246ICJuZXN0IiB9LAogICAgeyBpZDogImMiLCBkaW1lbnNpb246ICJuZXN0IiB9LApdOwoKY29uc3QgcGF0Y2hSZXN1bHRzID0gW107Cgpmb3IgKGxldCBlbnRyeSBvZiB0YXJnZXRzKSB7CiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIGVudHJ5LmlkKTsKICAgIGNvbnN0IHJlZEJvdCA9IGNyZWF0ZSh7CiAgICAgICAgW2VudHJ5LmRpbWVuc2lvbl06IHRydWUsCiAgICAgICAgW2VudHJ5LmRpbWVuc2lvbiArICdYJ106IHRhcmdldEJvdC50YWdzW2VudHJ5LmRpbWVuc2lvbiArICdYJ10gKyAxLAogICAgICAgIFtlbnRyeS5kaW1lbnNpb24gKyAnWSddOiB0YXJnZXRCb3QudGFnc1tlbnRyeS5kaW1lbnNpb24gKyAnWSddLAogICAgICAgIGNvbG9yOiAicmVkIiwKICAgIH0pOwoKICAgIHBhdGNoUmVzdWx0cy5wdXNoKHsgYm90SWQ6IHJlZEJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH0pOwp9CgpyZXR1cm4gcGF0Y2hSZXN1bHRzOwpgYGAKCiMjIyBFeGFtcGxlIDMKCmBgYHBsYWludGV4dApJTlBVVDogVG9hc3QgaGVsbG8gd2hlbiBhbnkgb2YgdGhlc2UgYm90cyBhcmUgY2xpY2tlZC4gIApUQVJHRVRfQk9UUzogWwogICAgewogICAgICAgIGlkOiAidGFyZ2V0MSIsCiAgICAgICAgZGltZW5zaW9uOiAib3V0c2lkZSIKICAgIH0sCiAgICB7CiAgICAgICAgaWQ6ICJ0YXJnZXQyIiwKICAgICAgICBkaW1lbnNpb246ICJvdXRzaWRlIgogICAgfQpdCmBgYAoKQW5zd2VyOiAgCgpgYGBqYXZhc2NyaXB0CmFiLmxvZygiU2V0IHVwIHRvYXN0LW9uLWNsaWNrIGJlaGF2aW9yIik7ICAKCmNvbnN0IHRhcmdldHMgPSBbCiAgICB7IGlkOiAidGFyZ2V0MSIsIGRpbWVuc2lvbjogIm91dHNpZGUiIH0sCiAgICB7IGlkOiAidGFyZ2VyMiIsIGRpbWVuc2lvbjogIm91dHNpZGUiIH0sCl07Cgpjb25zdCBwYXRjaFJlc3VsdHMgPSBbXTsKCmZvciAobGV0IGVudHJ5IG9mIHRhcmdldHMpIHsgIAogICAgbGV0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCBlbnRyeS5pZCk7ICAKCiAgICAvLyBUYWtlIHNuYXBzaG90cyBvZiBlYWNoIGJvdCBiZWZvcmUgd2UgbW9kaWZ5IHRoZW0uCiAgICBjb25zdCBwcmVQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QodGFyZ2V0Qm90KTsKICAgIAogICAgLy8gTW9kaWZ5IHRoZSBib3QuCiAgICBzZXRUYWcodGFyZ2V0Qm90LCAib25DbGljayIsICJAIG9zLnRvYXN0KCdoZWxsbycpOyIpOyAgCgogICAgLy8gQWZ0ZXIgbW9kaWZ5aW5nIHRoZSBib3QsIGNyZWF0ZSBkaWZmIHNuYXBzaG90cyBhbmQgc3RvcmUgdGhlbSBpbiB0aGUgcmVzdWx0cyB0aGF0IHdlIHJldHVybi4KICAgIGNvbnN0IHBvc3RQYXRjaFNuYXBzaG90ID0gZ2V0U25hcHNob3QodGFyZ2V0Qm90KTsKICAgIHBhdGNoUmVzdWx0cy5wdXNoKHsgCiAgICAgICAgYm90SWQ6IHRhcmdldEJvdC5pZCwgCiAgICAgICAgY3JlYXRlZDogZmFsc2UsIAogICAgICAgIHJvbGxiYWNrRGlmZjogZGlmZlNuYXBzaG90cyhwb3N0UGF0Y2hTbmFwc2hvdCwgcHJlUGF0Y2hTbmFwU2hvdCkKICAgIH0pOwp9CgpyZXR1cm4gcGF0Y2hSZXN1bHRzOwpgYGAKCiMjIyBFeGFtcGxlIDQKCmBgYHBsYWludGV4dApJTlBVVDogTWFrZSBhbGwgcmVkIGJvdHMgYmx1ZS4gIApUQVJHRVRfQk9UUzogWwogICAgewogICAgICAgIGlkOiAic29tZV9pZCIsCiAgICAgICAgZGltZW5zaW9uOiAiaG9tZSIKICAgIH0sCiAgICB7CiAgICAgICAgaWQ6ICJkb2VzbnRfbWF0dGVyIiwKICAgICAgICBkaW1lbnNpb246ICJob21lIgogICAgfSwKXQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgcmVkIGJvdHMgYmx1ZSIpOwoKY29uc3QgcmVkQm90cyA9IGdldEJvdHMoImNvbG9yIiwgInJlZCIpOwpjb25zdCBwYXRjaFJlc3VsdHMgPSBbXTsKCmZvciAoY29uc3QgYm90IG9mIHJlZEJvdHMpIHsKICAgIC8vIFRha2Ugc25hcHNob3RzIG9mIGVhY2ggYm90IGJlZm9yZSB3ZSBtb2RpZnkgdGhlbS4KICAgIGNvbnN0IHByZVBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwoKICAgIC8vIE1vZGlmeSB0aGUgYm90LgogICAgc2V0VGFnKGJvdCwgImNvbG9yIiwgImJsdWUiKTsKCiAgICAvLyBBZnRlciBtb2RpZnlpbmcgdGhlIGJvdCwgY3JlYXRlIGRpZmYgc25hcHNob3RzIGFuZCBzdG9yZSB0aGVtIGluIHRoZSByZXN1bHRzIHRoYXQgd2UgcmV0dXJuLgogICAgY29uc3QgcG9zdFBhdGNoU25hcHNob3QgPSBnZXRTbmFwc2hvdChib3QpOwogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyAKICAgICAgICBib3RJZDogYm90LmlkLCAKICAgICAgICBjcmVhdGVkOiBmYWxzZSwgCiAgICAgICAgcm9sbGJhY2tEaWZmOiBkaWZmU25hcHNob3RzKHBvc3RQYXRjaFNuYXBzaG90LCBwcmVQYXRjaFNuYXBTaG90KQogICAgfSk7Cn0KCnJldHVybiBwYXRjaFJlc3VsdHM7CmBgYAoKIyMjIEV4YW1wbGUgNQoKYGBgcGxhaW50ZXh0CklOUFVUOiBNYWtlIGEgYmx1ZSBib3QgYWJvdmUgZWFjaCBvZiB0aGUgZ2l2ZW4gYm90cyB0aGF0IHRvYXN0cyBoZWxsbyB3aGVuIGhvdmVyZWQuICAKVEFSR0VUX0JPVFM6IFsKICAgIHsKICAgICAgICBpZDogImIxIiwKICAgICAgICBkaW1lbnNpb246ICJob21lIgogICAgfSwKICAgIHsKICAgICAgICBpZDogImIyIiwKICAgICAgICBkaW1lbnNpb246ICJob21lIgogICAgfSwKICAgIHsKICAgICAgICBpZDogImIzIiwKICAgICAgICBkaW1lbnNpb246ICJob21lIgogICAgfSwKXQpgYGAKCkFuc3dlcjogIAoKYGBgamF2YXNjcmlwdAphYi5sb2coIk1hZGUgYmx1ZSBib3RzIGFib3ZlIGVhY2ggdGFyZ2V0IHRoYXQgdG9hc3QgXCJoZWxsb1wiIG9uIHBvaW50ZXIgZW50ZXIiKTsgIAoKY29uc3QgdGFyZ2V0cyA9IFsKICAgIHsgaWQ6ICJiMSIsIGRpbWVuc2lvbjogImhvbWUiIH0sCiAgICB7IGlkOiAiYjIiLCBkaW1lbnNpb246ICJob21lIiB9LAogICAgeyBpZDogImIzIiwgZGltZW5zaW9uOiAiaG9tZSIgfSwKXTsKCmNvbnN0IHBhdGNoUmVzdWx0cyA9IFtdOwoKZm9yIChsZXQgZW50cnkgb2YgdGFyZ2V0cykgeyAgCiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIGVudHJ5LmlkKTsgIAogICAgY29uc3QgYmx1ZUJvdCA9IGNyZWF0ZSh7ICAKICAgICAgICBbZW50cnkuZGltZW5zaW9uXTogdHJ1ZSwKICAgICAgICBbZW50cnkuZGltZW5zaW9uICsgJ1gnXTogdGFyZ2V0Qm90LnRhZ3NbZW50cnkuZGltZW5zaW9uICsgJ1gnXSwKICAgICAgICBbZW50cnkuZGltZW5zaW9uICsgJ1knXTogdGFyZ2V0Qm90LnRhZ3NbZW50cnkuZGltZW5zaW9uICsgJ1knXSArIDEsCiAgICAgICAgY29sb3I6ICJibHVlIiwKICAgICAgICBvblBvaW50ZXJFbnRlcjogIkAgb3MudG9hc3QoJ2hlbGxvJyk7IgogICAgfSk7ICAKICAgIAogICAgcGF0Y2hSZXN1bHRzLnB1c2goeyBib3RJZDogYmx1ZUJvdC5pZCwgY3JlYXRlZDogdHJ1ZSwgcm9sbGJhY2tEaWZmOiBudWxsIH0pOwp9CgpyZXR1cm4gcGF0Y2hSZXN1bHRzOwpgYGAKJwC49KfVAZ9/GmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQAuPSn1QHA2wMDMjAwJwC49KfVAZ9/CWFiVmVyc2lvbgIEALj0p9UBxNsDBTEwLjQwJwC49KfVAZ9/DmNoYW5uZWxfY29uZmlnAgQAuPSn1QHK2wOtD0Bjb25zdCBjb25maWd1cmF0aW9uRGF0YSA9IGF3YWl0IG9zLmdldERhdGEodGhhdC5kYXRhLnN0dWRpb0lELCB0aGF0LmRhdGEucGF0dGVybklEKTsKCmxldCBuZXdEZXBsb3ltZW50ID0gZmFsc2U7CgppZiAobGlua3MucmVtZW1iZXIudGFncy5jaGFubmVsQ29uZmlndXJlZCkKewogICAgcmV0dXJuOwp9CgpsaW5rcy5yZW1lbWJlci50YWdzLmNoYW5uZWxDb25maWd1cmVkID0gdHJ1ZTsKCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3MpCnsKICAgIGNvbnN0IHRhcmdldEJpb3MgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmJpb3M7CgogICAgc3dpdGNoICh0YXJnZXRCaW9zKSAKICAgIHsKICAgICAgICBjYXNlICJsb2NhbCI6CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5zdGF0aWNJbnN0ID09IG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5ld0RlcGxveW1lbnQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzdHVkaW8iOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Mub3duZXIgPT0gbnVsbCB8fCBjb25maWdCb3QudGFncy5vd25lciA9PSAicHVibGljIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmV3RGVwbG95bWVudCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInNoYXJlZCI6CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5vd25lciAhPSAicHVibGljIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmV3RGVwbG95bWVudCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgfQp9CgppZiAoY29uZmlndXJhdGlvbkRhdGEuZGF0YS5lZ2cpCnsKICAgIGNvbnN0IHRhcmdldFBhdHRlcm4gPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmVnZy5wYXR0ZXJuOwogICAgY29uc3QgdGFyZ2V0U3R1ZGlvID0gY29uZmlndXJhdGlvbkRhdGEuZGF0YS5lZ2cuc3R1ZGlvOwoKICAgIHNob3V0KCJoYXRjaCIsIHthYklEOiB0YXJnZXRQYXR0ZXJuLCByZWNvcmRLZXk6IHRhcmdldFN0dWRpbywgYXV0b0hhdGNoOiB0cnVlfSk7Cn0KCmlmIChjb25maWd1cmF0aW9uRGF0YS5kYXRhLmdyaWRDb2xvcikKewogICAgbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmdyaWRDb2xvcjsKCiAgICBncmlkUG9ydGFsQm90LnRhZ3MucG9ydGFsQ29sb3IgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmdyaWRDb2xvcjsKfQoKaWYgKGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCAmJiBjb25maWdCb3QudGFncy5pbnN0ICE9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCAmJiBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgIT0gbnVsbCkKewogICAgbmV3RGVwbG95bWVudCA9IHRydWU7Cn0KCmlmIChuZXdEZXBsb3ltZW50KQp7CiAgICBjb25zdCBzaXRlT3JpZ2luID0gbmV3IFVSTChjb25maWdCb3QudGFncy51cmwpLm9yaWdpbjsKICAgIGNvbnN0IHRhcmdldEluc3QgPSBjb25maWd1cmF0aW9uRGF0YS5kYXRhLmluc3QgPyAiJmluc3Q9IiArIGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuaW5zdCA6ICIiOwogICAgY29uc3QgdGFyZ2V0QmlvcyA9IGNvbmZpZ3VyYXRpb25EYXRhLmRhdGEuYmlvcyA/ICImYmlvcz0iICsgY29uZmlndXJhdGlvbkRhdGEuZGF0YS5iaW9zIDogIiI7CiAgICBjb25zdCB0YXJnZXRQYXR0ZXJuID0gY29uZmlnQm90LnRhZ3MucGF0dGVybiA/ICImcGF0dGVybj0iICsgY29uZmlnQm90LnRhZ3MucGF0dGVybiA6ICIiOwogICAgY29uc3QgdGFyZ2V0VVJMID0gc2l0ZU9yaWdpbiArIGAvP2Fzaz0ke2NvbmZpZ0JvdC50YWdzLmFza30ke3RhcmdldFBhdHRlcm59JHt0YXJnZXRJbnN0fSR7dGFyZ2V0Qmlvc31gOwoKICAgIG9zLmdvVG9VUkwodGFyZ2V0VVJMKTsKfScAuPSn1QGffw1jaGFubmVsTG9hZGVyAgQAuPSn1QH46gMo8J+Ul2E5YjZhYTBkLWIzNTctNGRlNi05YmVmLTg1MzQ4YWIxZDBlMCcAuPSn1QGffwlwcm90b3R5cGUCBAC49KfVAZ/rAy5AdGhpc0JvdC5hYkNvcmVNZW51QWN0aW9uKCJNYWtlIG1lOiAiICsgdGhhdCk7JwC49KfVAZ9/C3BlcnNvbmFsaXR5AgQAuPSn1QHO6wMo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAuPSn1QGffwV1dGlscwIEALj0p9UB9esDKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnALj0p9UBn38GY3JlYXRlAgQAuPSn1QGc7AMo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycAuPSn1QGffw9pbnB1dFN1Z2dlc3Rpb24CBAC49KfVAcPsA/IFQGlmICghdGFncy5pbnB1dFN1Z2dlc3Rpb25FbmFibGVkKSB7CiAgICByZXR1cm47Cn0KCmNvbnN0IGlucHV0Qm90ID0gdGhhdD8uaW5wdXRCb3Q7CmNvbnN0IHRleHQgPSB0aGF0Py50ZXh0Owpjb25zdCBhbmltYXRlID0gdGhhdD8uYW5pbWF0ZSA/PyB0cnVlOwoKYXNzZXJ0KGlucHV0Qm90LCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlucHV0Qm90IGlzIGEgcmVxdWlyZWQgcGFyYW1lbXRlci5gKTsKYXNzZXJ0KHRleHQsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGV4dCBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKCmxldCBzdG9wcGVkID0gZmFsc2U7CgppZiAoYW5pbWF0ZSkgewogICAgY29uc3QgY2hhcnMgPSBbLi4udGV4dF07CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gY2hhcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaW5wdXRCb3QudGFncy5zdG9wU3VnZ2VzdGlvbikgewogICAgICAgICAgICBzdG9wcGVkID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGF3YWl0IG9zLnNsZWVwKG1hdGgucmFuZG9tKDI1LCAxMDApKTsKICAgICAgICBpbnB1dEJvdC50YWdzLm1lbnVJdGVtVGV4dCA9IGNoYXJzLnNsaWNlKDAsIGkpLmpvaW4oJycpOwogICAgfQp9CgppZiAoc3RvcHBlZCkgewogICAgaW5wdXRCb3QudGFncy5tZW51SXRlbVRleHQgPSAnJzsKfSBlbHNlIHsKICAgIGlucHV0Qm90LnRhZ3MubWVudUl0ZW1UZXh0ID0gdGV4dDsKfScAuPSn1QGffxVpbnB1dFN1Z2dlc3Rpb25XYWl0TVMCBAC49KfVAbbyAwQzMDAwJwC49KfVAZ9/D3N1Z2dlc3Rpb25zQ29yZQIEALj0p9UBu/ID6wHwn6esWwogICAgIm1ha2UgbWUgYSByZWQgYm90IHRoYXQgd2hlbiBjbGlja2VkIHR1cm5zIGJsdWUiLAogICAgIm1ha2UgbWUgYSBib3QgdGhhdCB3aGVuIGNsaWNrZWQgbWFrZXMgZmlyZXdvcmtzIiwKICAgICJtYWtlIG1lIGEgYm90IHRoYXQgdG9hc3RzICdoZWxsbywgd29ybGQhJyB3aGVuIGNsaWNrZWQiLAogICAgIm1ha2UgbWUgMyBib3RzLCBhIHJlZCBvbmUsIGJsdWUgb25lLCBhbmQgZ3JlZW4gb25lIgpdJwC49KfVAZ9/DnN1Z2dlc3Rpb25zQm90AgQAuPSn1QGl9AN78J+nrFsKICAgICJjaGFuZ2UgdGhlIGNvbG9yIG9mIHRoaXMgYm90IHRvIHB1cnBsZSIsCiAgICAidHVybiB0aGlzIGJvdCBpbnRvIGEgc3BoZXJlIiwKICAgICJkb3VibGUgdGhlIHNjYWxlIG9mIHRoaXMgYm90IgpdJwC49KfVAZ9/F3N1Z2dlc3Rpb25zTXVsdGlwbGVCb3RzAgQAuPSn1QGf9QOOAfCfp6xbCiAgICAiY2hhbmdlIGFsbCBvZiB0aGVzZSBib3RzIGNvbG9yIHRvIHB1cnBsZSIsCiAgICAidHVybiBhbGwgb2YgdGhlc2UgYm90cyBpbnRvIHNwaGVyZXMiLAogICAgImRvdWJsZSB0aGUgc2NhbGUgb2YgYWxsIG9mIHRoZXNlIGJvdHMiCl0nALj0p9UBn38KdXVhYkxvYWRlcgIEALj0p9UBrPYDKPCflJdiODk4NmZhNi01NDNhLTQ4NjQtODZjMS00MjI1NzlhNWNiNjAnALj0p9UBn38Pc3VnZ2VzdGlvbnNHcmlkAgQAuPSn1QHT9gPrAfCfp6xbCiAgICAibWFrZSBtZSBhIHJlZCBib3QgdGhhdCB3aGVuIGNsaWNrZWQgdHVybnMgYmx1ZSIsCiAgICAibWFrZSBtZSBhIGJvdCB0aGF0IHdoZW4gY2xpY2tlZCBtYWtlcyBmaXJld29ya3MiLAogICAgIm1ha2UgbWUgYSBib3QgdGhhdCB0b2FzdHMgJ2hlbGxvLCB3b3JsZCEnIHdoZW4gY2xpY2tlZCIsCiAgICAibWFrZSBtZSAzIGJvdHMsIGEgcmVkIG9uZSwgYmx1ZSBvbmUsIGFuZCBncmVlbiBvbmUiCl0nALj0p9UBn38FZGVidWcCBAC49KfVAb34AwVmYWxzZScAuPSn1QGffw5hYkNvcmVNZW51SGlkZQIEALj0p9UBw/gDBHRydWUnALj0p9UBn38WaW5wdXRTdWdnZXN0aW9uRW5hYmxlZAIEALj0p9UByPgDBWZhbHNlJwEEYm90cyRmOWZkN2UyZS03Y2NlLTQzZmItYjIyMy1kMzJjYjQyYmViZTgBJwC49KfVAc74AwZzeXN0ZW0CBAC49KfVAc/4AxNhYi5hY3Rpb24uY29sb3JfYm90JwC49KfVAc74AwRmb3JtAgQAuPSn1QHj+AMHbm90aGluZycAuPSn1QHO+AMIYWJBY3Rpb24CBAC49KfVAev4AwR0cnVlJwC49KfVAc74Aw9hYkJvdE1lbnVBY3Rpb24CBAC49KfVAfD4A9oCQGNvbnN0IHRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7Cgpjb25zdCBzZWxlY3RlZENvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KHRhcmdldEJvdC50YWdzLmNvbG9yLCB7CiAgICB0eXBlOiAnY29sb3InLAogICAgdGl0bGU6ICdwaWNrIGEgY29sb3InCn0pOwoKaWYgKHNlbGVjdGVkQ29sb3IgJiYgdGFyZ2V0Qm90LnRhZ3MuY29sb3IgIT09IHNlbGVjdGVkQ29sb3IpIHsKICAgIHRhcmdldEJvdC50YWdzLmNvbG9yID0gc2VsZWN0ZWRDb2xvcjsKICAgIGFiLmxpbmtzLnNvdW5kLmFiUGxheVNvdW5kKHsgdmFsdWU6ICdhYi9hdWRpby9wYWludCBzcHJheS5tcDMnIH0pOwp9CicAuPSn1QHO+AMOYWJCb3RNZW51TGFiZWwCBAC49KfVAcv7AwVjb2xvcicAuPSn1QHO+AMNYWJCb3RNZW51SWNvbgIEALj0p9UB0fsDB3BhbGV0dGUnALj0p9UBzvgDCHJlbWVtYmVyAgQAuPSn1QHZ+wMo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAuPSn1QHO+AMSYWJCb3RNZW51U29ydE9yZGVyAgQAuPSn1QGA/AMBMicAuPSn1QHO+AMIYWJJZ25vcmUCBAC49KfVAYL8AwR0cnVlJwC49KfVAc74AxdhYk11bHRpcGxlQm90TWVudUFjdGlvbgIEALj0p9UBh/wD8ANAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1czsKY29uc3QgYnVpbGRlciA9IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QgPyBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90LmlkIDogbnVsbDsKY29uc3QgcmVsZXZhbnRUYXJnZXRCb3RzID0gYWxsVGFyZ2V0Qm90cy5maWx0ZXIoKHRhcmdldCkgPT4gdGFyZ2V0LmlkICE9IGJ1aWxkZXIpOwoKY29uc3Qgc2VsZWN0ZWRDb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChudWxsLCB7CiAgICB0eXBlOiAnY29sb3InLAogICAgdGl0bGU6ICdwaWNrIGEgY29sb3InCn0pOwoKaWYgKHNlbGVjdGVkQ29sb3IpIHsKICAgIHNldFRhZyhyZWxldmFudFRhcmdldEJvdHMsICJjb2xvciIsIHNlbGVjdGVkQ29sb3IpOwoKICAgIGFiLmxpbmtzLnNvdW5kLmFiUGxheVNvdW5kKHsgdmFsdWU6ICdhYi9hdWRpby9wYWludCBzcHJheS5tcDMnIH0pOwp9JwC49KfVAc74AxVhYk11bHRpcGxlQm90TWVudUljb24CBAC49KfVAfj/AwdwYWxldHRlJwC49KfVAc74AxZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAuPSn1QGAgAQFY29sb3InALj0p9UBzvgDGmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQAuPSn1QGGgAQBMScAuPSn1QHO+AMJYWJWZXJzaW9uAgQAuPSn1QGIgAQFMTAuNDAnALj0p9UBzvgDC3BlcnNvbmFsaXR5AgQAuPSn1QGOgAQo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAuPSn1QHO+AMTYWJCb3RNZW51Q2xpY2tTb3VuZAIEALj0p9UBtYAEImFiL2F1ZGlvL3BhaW50IHNwcmF5IGNhbiBzaGFrZS5tcDMnALj0p9UBzvgDG2FiTXVsdGlwbGVCb3RNZW51Q2xpY2tTb3VuZAIEALj0p9UB2IAEImFiL2F1ZGlvL3BhaW50IHNwcmF5IGNhbiBzaGFrZS5tcDMA"}]}