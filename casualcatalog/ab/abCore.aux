{"version":2,"updates":[{"id":0,"timestamp":1772033235642,"update":"AXzcjaXPBgAnAQRib3RzJDY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNwEnANyNpc8GABhhYkNoZWNrQUJVcGRhdGVBdmFpbGFibGUCBADcjaXPBgGVLEBjb25zdCBkZXRhaWxlZCA9IHRoYXQ/LmRldGFpbGVkID8/IGZhbHNlOwpjb25zdCBoYXNoQWxnb3JpdGhtID0gdGhhdD8uaGFzaEFsZ29yaXRobSA/PyAnc2hhMSc7CmNvbnN0IGhhc2hGb3JtYXQgPSB0aGF0Py5oYXNoRm9ybWF0ID8/ICdoZXgnOwoKaW50ZXJmYWNlIEFCRmlsZVVwZGF0ZUNoZWNrIHsKICAgIGZpbGVOYW1lOiBzdHJpbmc7CiAgICB1cGRhdGVBdmFpbGFibGU6IGJvb2xlYW47CiAgICBjdXJyZW50SGFzaDogc3RyaW5nOwogICAgbGF0ZXN0SGFzaDogc3RyaW5nOwogICAgcmVtb3ZlZDogYm9vbGVhbjsKfQoKLy8gVGhpcyBsaXN0IG9mIGFiIGZpbGUgY2hlY2tzLCB0aGlzIHdpbGwgb25seSBiZSBwb3B1bGF0ZWQgaWYgJ2RldGFpbGVkJyBpcyB0cnVlLgpjb25zdCBhYkZpbGVDaGVja3M6IEFCRmlsZVVwZGF0ZUNoZWNrW10gPSBbXTsKCmFzeW5jIGZ1bmN0aW9uIGNoZWNrU2tpbGxPdXRkYXRlZChza2lsbE5hbWU6IHN0cmluZywgY3VycmVudEhhc2g6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4gewogICAgY29uc3Qgc2tpbGxVUkwgPSB0aGlzQm90LmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKGAvYWIvJHtza2lsbE5hbWV9LmF1eGApOyAgICAgICAgCiAgICBsZXQgc2tpbGxSZW1vdmVkID0gZmFsc2U7CiAgICBsZXQgc2tpbGxSZXNwb25zZTsKCiAgICB0cnkgewogICAgICAgIHNraWxsUmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKHsgbWV0aG9kOiAiR0VUIiwgdXJsOiBza2lsbFVSTCB9KTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBza2lsbFJlc3BvbnNlOmAsIHNraWxsUmVzcG9uc2UpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBhc3NlcnQoc2tpbGxSZXNwb25zZS5kYXRhLnZlcnNpb24gPT09IDIsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gJHtza2lsbE5hbWV9IG11c3QgYmUgaW4gYXV4IGZpbGUgZm9ybWF0IHYyLiBBY3R1YWwgYXV4IGZpbGUgZm9ybWF0IHZlcnNpb246ICR7c2tpbGxSZXNwb25zZS5kYXRhLnZlcnNpb259YCk7CgogICAgICAgIGlmIChza2lsbFJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgIGlmIChza2lsbFJlc3BvbnNlLnN0YXR1cyA9PT0gNDAzIHx8IHNraWxsUmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgICAgIHNraWxsUmVtb3ZlZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgJHtza2lsbE5hbWV9LiBSZXNwb25zZTogJHtza2lsbFJlc3BvbnNlLnN0YXR1c1RleHR9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhdWdodCBlcnJvciB3aGlsZSBkb3dubG9hZGluZyBza2lsbDpgLCBlKTsKICAgICAgICAKICAgICAgICBpZiAoZS5yZXNwb25zZT8uc3RhdHVzID09PSA0MDMgfHwgZS5yZXNwb25zZT8uc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgLy8gRmlsZSBkb2VzbnQgZXhpc3QgYW55bW9yZSwgdGhlIHNraWxsIGhhcyBiZWVuIHJlbW92ZWQuCiAgICAgICAgICAgIHNraWxsUmVtb3ZlZCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHNraWxsUmVtb3ZlZCkgewogICAgICAgIGlmIChkZXRhaWxlZCkgewogICAgICAgICAgICBhYkZpbGVDaGVja3MucHVzaCh7CiAgICAgICAgICAgICAgICBmaWxlTmFtZTogc2tpbGxOYW1lLAogICAgICAgICAgICAgICAgY3VycmVudEhhc2gsCiAgICAgICAgICAgICAgICBsYXRlc3RIYXNoOiBudWxsLAogICAgICAgICAgICAgICAgcmVtb3ZlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIHVwZGF0ZUF2YWlsYWJsZTogdHJ1ZSwKICAgICAgICAgICAgfSkKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBDYWxjdWxhdGUgaGFzaCBvZiBhYiBmaWxlIHN0YXRlIHRvIGNvbXBhcmUgYWdhaW5zdC4KICAgICAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IG9zLmdldEluc3RTdGF0ZUZyb21VcGRhdGVzKHNraWxsUmVzcG9uc2UuZGF0YS51cGRhdGVzKTsKICAgICAgICBjb25zdCBsYXRlc3RIYXNoID0gY3J5cHRvLmhhc2goaGFzaEFsZ29yaXRobSwgaGFzaEZvcm1hdCwgc3RhdGUpOwogICAgICAgIAogICAgICAgIGlmIChkZXRhaWxlZCkgewogICAgICAgICAgICBhYkZpbGVDaGVja3MucHVzaCh7CiAgICAgICAgICAgICAgICBmaWxlTmFtZTogc2tpbGxOYW1lLAogICAgICAgICAgICAgICAgY3VycmVudEhhc2gsCiAgICAgICAgICAgICAgICBsYXRlc3RIYXNoLAogICAgICAgICAgICAgICAgcmVtb3ZlZDogZmFsc2UsCiAgICAgICAgICAgICAgICB1cGRhdGVBdmFpbGFibGU6IGN1cnJlbnRIYXNoICE9PSBsYXRlc3RIYXNoLAogICAgICAgICAgICAgICAgbGF0ZXN0VXBkYXRlczogc2tpbGxSZXNwb25zZS5kYXRhLnVwZGF0ZXMsCiAgICAgICAgICAgICAgICBsYXRlc3RTdGF0ZTogc3RhdGUsCiAgICAgICAgICAgIH0pCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY3VycmVudEhhc2ggIT09IGxhdGVzdEhhc2g7CiAgICB9Cn0KCi8vIDEuIENoZWNrIGlmIGFiQ29uZmlnIGlzIG91dGRhdGVkLgpjb25zdCBhYkNvbmZpZ1VSTCA9IG9zLmdldEFCMUJvb3RzdHJhcFVSTCgpOwpjb25zdCBhYkNvbmZpZ1Jlc3BvbnNlID0gYXdhaXQgd2ViaG9vayh7IG1ldGhvZDogIkdFVCIsIHVybDogYWJDb25maWdVUkwgfSk7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvbmZpZ1Jlc3BvbnNlOmAsIGFiQ29uZmlnUmVzcG9uc2UpOwp9Cgphc3NlcnQoYWJDb25maWdSZXNwb25zZS5zdGF0dXMgPT09IDIwMCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgYWJDb25maWcuIFJlc3BvbnNlOiAke2FiQ29uZmlnUmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsKYXNzZXJ0KGFiQ29uZmlnUmVzcG9uc2UuZGF0YS52ZXJzaW9uID09PSAyLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFiQ29uZmlnIG11c3QgYmUgaW4gYXV4IGZpbGUgZm9ybWF0IHYyLiBBY3R1YWwgYXV4IGZpbGUgZm9ybWF0IHZlcnNpb246ICR7YWJDb25maWdSZXNwb25zZS5kYXRhLnZlcnNpb259YCk7Cgpjb25zdCBhYkNvbmZpZ0N1cnJlbnRIYXNoID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkNvbmZpZ1NvdXJjZUhhc2g7CmNvbnN0IGFiQ29uZmlnTGF0ZXN0U3RhdGUgPSBhd2FpdCBvcy5nZXRJbnN0U3RhdGVGcm9tVXBkYXRlcyhhYkNvbmZpZ1Jlc3BvbnNlLmRhdGEudXBkYXRlcyk7CmZvciAobGV0IGlkIGluIGFiQ29uZmlnTGF0ZXN0U3RhdGUpIHsKICAgIGRlbGV0ZSBhYkNvbmZpZ0xhdGVzdFN0YXRlW2lkXS50YWdzLmJhc2VBQjsgLy8gYmFzZUFCIGlzIGFuIGFubm95aW5nIHRhZyB0aGF0IHNob3VsZCBub3QgYmUgY29tcHV0ZWQgYXMgcGFydCBvZiBoYXNoIHN0YXRlLgp9CmNvbnN0IGFiQ29uZmlnTGF0ZXN0SGFzaCA9IGNyeXB0by5oYXNoKGhhc2hBbGdvcml0aG0sIGhhc2hGb3JtYXQsIGFiQ29uZmlnTGF0ZXN0U3RhdGUpOwoKaWYgKGRldGFpbGVkKSB7CiAgICBhYkZpbGVDaGVja3MucHVzaCh7CiAgICAgICAgZmlsZU5hbWU6ICdhYkNvbmZpZycsCiAgICAgICAgY3VycmVudEhhc2g6IGFiQ29uZmlnQ3VycmVudEhhc2gsCiAgICAgICAgbGF0ZXN0SGFzaDogYWJDb25maWdMYXRlc3RIYXNoLAogICAgICAgIHJlbW92ZWQ6IGZhbHNlLAogICAgICAgIHVwZGF0ZUF2YWlsYWJsZTogYWJDb25maWdDdXJyZW50SGFzaCAhPT0gYWJDb25maWdMYXRlc3RIYXNoLAogICAgICAgIGxhdGVzdFVwZGF0ZXM6IGFiQ29uZmlnUmVzcG9uc2UuZGF0YS51cGRhdGVzLAogICAgICAgIGxhdGVzdFN0YXRlOiBhYkNvbmZpZ0xhdGVzdFN0YXRlLAogICAgfSkKfQoKaWYgKCFkZXRhaWxlZCAmJiAoYWJDb25maWdDdXJyZW50SGFzaCAhPT0gYWJDb25maWdMYXRlc3RIYXNoKSkgewogICAgLy8gSWYgd2UgYXJlIHJ1bm5pbmcgaW4gc2ltcGxlIG1vZGUsIHJldHVybiByaWdodCBhd2F5IG9uIHRoZSBmaXJzdCBvdXRkYXRlZCBmaWxlIGRpc2NvdmVyeS4KICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHVwZGF0ZUF2YWlsYWJsZTogdHJ1ZSB9Cn0KCi8vIDIuIENoZWNrIGlmIGFiIHNraWxscyBhcmUgb3V0ZGF0ZWQuCmNvbnN0IGFiU2tpbGxOYW1lcyA9IFsgJ2FiQ29yZScsIC4uLnRoaXNCb3QuYWJMb2FkZWRTa2lsbHMoKSBdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBhYlNraWxsTmFtZXMubGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IHNraWxsTmFtZSA9IGFiU2tpbGxOYW1lc1tpXTsKCiAgICBsZXQgc2tpbGxDdXJyZW50SGFzaDsKICAgIGlmIChza2lsbE5hbWUgPT09ICdhYkNvcmUnKSB7CiAgICAgICAgc2tpbGxDdXJyZW50SGFzaCA9IGFiLnRhZ3MuYWJDb3JlU291cmNlSGFzaDsKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgbG9hZGVkU2tpbGxCb3QgPSBnZXRCb3QoYiA9PiBiLnRhZ3MuYWJMb2FkZWRTa2lsbCA9PT0gc2tpbGxOYW1lICYmIGIuc3BhY2UgPT09ICdzaGFyZWQnKTsKICAgICAgICBhc3NlcnQobG9hZGVkU2tpbGxCb3QsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY291bGQgbm90IGZpbmQgbG9hZGVkIHNraWxsIGJvdCBmb3IgJHtza2lsbE5hbWV9LmApOwoKICAgICAgICBza2lsbEN1cnJlbnRIYXNoID0gbG9hZGVkU2tpbGxCb3QudGFncy5hYkxvYWRlZFNraWxsU291cmNlSGFzaDsKICAgIH0KICAgIAogICAgdHJ5IHsKICAgICAgICBjb25zdCBza2lsbE91dGRhdGVkID0gYXdhaXQgY2hlY2tTa2lsbE91dGRhdGVkKHNraWxsTmFtZSwgc2tpbGxDdXJyZW50SGFzaCk7CgogICAgICAgIGlmICghZGV0YWlsZWQgJiYgc2tpbGxPdXRkYXRlZCkgewogICAgICAgICAgICAvLyBJZiB3ZSBhcmUgcnVubmluZyBpbiBzaW1wbGUgbW9kZSwgcmV0dXJuIHJpZ2h0IGF3YXkgb24gdGhlIGZpcnN0IG91dGRhdGVkIGZpbGUgZGlzY292ZXJ5LgogICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1cGRhdGVBdmFpbGFibGU6IHRydWUgfQogICAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ2F1Z2ggYW4gZXJyb3IuYCwgZSk7CiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfQogICAgfQp9CgppZiAoZGV0YWlsZWQpIHsKICAgIHJldHVybiB7CiAgICAgICAgc3VjY2VzczogdHJ1ZSwKICAgICAgICB1cGRhdGVBdmFpbGFibGU6IGFiRmlsZUNoZWNrcy5zb21lKGYgPT4gZi51cGRhdGVBdmFpbGFibGUpLAogICAgICAgIGFiRmlsZUNoZWNrcywKICAgIH0KfSBlbHNlIHsKICAgIC8vIElmIHdlIG1hZGUgaXQgYWxsIHRoZSB3YXkgaGVyZSBpbiBzaW1wbGUgbW9kZSwgdGhlcmUgYXJlIG5vIG91dGRhdGVkIGZpbGVzLgogICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXBkYXRlQXZhaWxhYmxlOiBmYWxzZSB9Cn0nANyNpc8GAARncmlkAgQA3I2lzwaXLCjwn5SXMDI4MzY1YTQtMDM2Zi00MWQwLTlhZjEtNzE1YWQ0ZjJhYTdhJwDcjaXPBgASYWJDb3JlTWFqb3JWZXJzaW9uAgQA3I2lzwa+LAIxMCcA3I2lzwYAEmFiQ29yZU1pbm9yVmVyc2lvbgIEANyNpc8GwSwCNDMnANyNpc8GAAZzeXN0ZW0CBADcjaXPBsQsDWFiLmNvcmUubGVhcm4nANyNpc8GAARhYklEAgQA3I2lzwbSLAVsZWFybicA3I2lzwYABGZvcm0CBADcjaXPBtgsB25vdGhpbmcnANyNpc8GAAZhYkJvb3QCBADcjaXPBuAskCtALyoqCiogTUlUIExpY2Vuc2UKKgoqIENvcHlyaWdodCAoYykgMjAxOSBDYXN1YWwgU2ltdWxhdGlvbiwgSW5jLgoqCiogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQoqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCiogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwoqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoqCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsCiogY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKgoqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCiogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCiogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgoqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCiogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUKKiBTT0ZUV0FSRS4KKiBAbGljZW5zZSBNSVQKKi8KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGJvb3RpbmcgYWJgKTsKfQoKLy9jaGVjayBzZWxmIGZvciBpbml0aWFsIGJvb3QgZGF0YQpsZXQgaW5pdGlhbEJvb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID8gdHJ1ZSA6IGZhbHNlOwoKaWYgKGluaXRpYWxCb290KSB7CiAgICB0aGlzQm90LmFiQm9vdFN0YXR1c1Nob3coeyBsYWJlbDogYHN0YXJ0aW5nIHVwICR7bGlua3MucmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eX1gfSk7Cn0KCi8vaW5zdCBtb2RlIChwbGF5ZXIgb3IgYnVpbGRlcikKbGV0IGluc3RNb2RlQ2hlY2sgPSBhd2FpdCBvcy52ZXJzaW9uKCkucGxheWVyTW9kZTsKLy9jaGVjayB1cmwgZm9yIHBvc3NpYmxlIGFiJ3MgdG8gbG9hZApsZXQgYm9vdEZsYWcgPSBjb25maWdCb3QudGFncy5wYXR0ZXJuID8gY29uZmlnQm90LnRhZ3MucGF0dGVybiA6IGNvbmZpZ0JvdC50YWdzLmFiOwovL2NoZWNrIGZvciBhc2sKbGV0IGFzayA9IGNvbmZpZ0JvdC50YWdzLmFzazsKLy9zZWVkIChub3QgYWN0aXZlbHkgdXNlZCBoZXJlKQpsZXQgc2VlZCA9IGNvbmZpZ0JvdC50YWdzLnNlZWQ7Ci8vcHJvbXB0CmxldCBwcm9tcHQgPSBjb25maWdCb3QudGFncy5wcm9tcHQ7Ci8vY2hhbm5lbApsZXQgY2hhbm5lbCA9IGNvbmZpZ0JvdC50YWdzLmNoYW5uZWw7Ci8vdXVhYgpsZXQgdXVhYiA9IGNvbmZpZ0JvdC50YWdzLmF1eGxpbmsgPT0gInV1YWIiOwovL3ZlcnNpb24KbGV0IHZlcnNpb24gPSBjb25maWdCb3QudGFncy5wYXR0ZXJuVmVyc2lvbiA/PyBjb25maWdCb3QudGFncy5hYlZlcnNpb247Ci8vcmVxdWVzdCBhdXRoIGJvdAphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKLy9yZWRpcmVjdCBpZiBpbiBVUkwKaWYgKGNvbmZpZ0JvdC50YWdzLmpvaW5Db2RlKSB7CiAgICB0aGlzQm90LmFiSm9pbkhvc3QoeyB0ZXh0OiBjb25maWdCb3QudGFncy5qb2luQ29kZSB9KTsKfQoKLy9jaGVjayB0aW1lIGlmIG5lZWRlZAppZiAobGlua3MucmVtZW1iZXIudGFncy5hYkNvbmRpdGlvbikgewogICAgYXdhaXQgbGlua3MucmVtZW1iZXIuYWJDb25kaXRpb24oKTsKfQoKLy9pZiBubyBzdHVkaW8sIHNldCBzdHVkaW8KaWYgKGF1dGhCb3QgJiYgIWNvbmZpZ0JvdC50YWdzLnN0dWRpbykgewogICAgY29uZmlnQm90LnRhZ3Muc3R1ZGlvID0gYXV0aEJvdC5pZDsKfQoKdGhpc0JvdC5hYlJlZnJlc2hTdHVkaW9zKCk7CnRoaXNCb3QuYWJSZWZyZXNoQUlNb2RlbHMoKTsKCmlmICghbGlua3MucGVyc29uYWxpdHkpIHsgCiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiUGVyc29uYWxpdHkiKTsKfQoKLy9pbml0aWFsaXplIHNvbWUgYWIgZ2xvYmFscy4KZ2xvYmFsVGhpcy5hYiA9IHRoaXNCb3Q7Cmdsb2JhbFRoaXMuYWJJbnN0TWVtb3J5ID0gbGlua3MucmVtZW1iZXI7Cmdsb2JhbFRoaXMuYWJSZW1lbWJlciA9IGxpbmtzLnJlbWVtYmVyOwpnbG9iYWxUaGlzLmFiUGVyc29uYWxpdHkgPSBsaW5rcy5wZXJzb25hbGl0eTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvcikgewogICAgZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3I7Cn0KCi8vVGhpcyBjaGVja3MgZm9yIHRoZSBhcHByb3ByaWF0ZSBhcnJheSBvZiBza2lsbHMgYW5kIGluaXRpYWxpemVzIHRoZW0KYXdhaXQgdGhpc0JvdC5hYlNraWxsSW5pdGlhbGl6YXRpb24oaW5zdE1vZGVDaGVjayk7CgovLyBpbml0aWFsaXppbmcgb2Ygc29tZSBjb21tb24gc2tpbGwgZ2xvYmFscy4KZ2xvYmFsVGhpcy5idWlsZGVyVmVyc2lvbiA9IGluc3RNb2RlQ2hlY2sgPT0gImJ1aWxkZXIiID8gdHJ1ZSA6IGZhbHNlOwpnbG9iYWxUaGlzLmFiTG9uZ1Rlcm1NZW1vcnlTZWFyY2ggPSBsaW5rcy5zZWFyY2g7Cmdsb2JhbFRoaXMuYWJTZWFyY2ggPSBsaW5rcy5zZWFyY2g7Cmdsb2JhbFRoaXMuYWJQdWJsaXNoID0gbGlua3Muc3RvcmU7Cmdsb2JhbFRoaXMuYWJTdG9yZSA9IGxpbmtzLnN0b3JlOwoKLy9jaGVjayBmb3IgdXVhYnMKaWYgKHV1YWIpIHsKICAgIGF3YWl0IHRoaXNCb3QuYWJBZGFwdCgiYWJBY3Rpb24iKTsKCiAgICBsaW5rcy5hc2suYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogY29uZmlnQm90LnRhZ3MudXVhYiwgaXNVVUFCOiB0cnVlfSk7Cn0KLy9jaGVjayBmb3IgY2hhbm5lbCBpZiBjaGFubmVscyBhbGxvd2VkCmVsc2UgaWYgKGNoYW5uZWwgJiYgbGlua3MucmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7CiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiQWN0aW9uIik7CgogICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IGNoYW5uZWwsIGlzQ2hhbm5lbDogdHJ1ZX0pOwp9IGVsc2UgewogICAgLy9wb3B1bGF0ZSBib290ZmxhZyBhYgogICAgaWYgKGluaXRpYWxCb290ICYmIGJvb3RGbGFnKSB7CiAgICAgICAgYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHsgYWJJRDogYm9vdEZsYWcsIGluaXRpYWxCb290OiB0cnVlLCBhdXRvSGF0Y2g6IHRydWUsIHNvdXJjZUV2ZW50OiAnYm9vdCcsIGFiVmVyc2lvbjogdmVyc2lvbn0pOwogICAgfQoKICAgIC8vbG9va3VwIGFza0lEIGlmIGF2YWlsYWJsZQogICAgaWYgKGluaXRpYWxCb290ICYmIGFzaykgewogICAgICAgIGlmIChhc2sgPT0gImVnZ0NhcnRvbiIgfHwgYXNrID09ICJjYXN1YWxUdXRvcmlhbCIpIHsKICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KGFzayk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiQWN0aW9uIik7CgogICAgICAgICAgICBsaW5rcy5hc2suYWJDb3JlTWVudUFjdGlvbihhc2spOwogICAgICAgIH0KICAgIH0KfQoKLy9jaGVjayBmb3IgYXJ0aWZhY3QgRklYCmlmIChjb25maWdCb3QudGFncy5hcnRpZmFjdCAmJiBpbml0aWFsQm9vdCAmJiAhYXNrICYmICFib290RmxhZykgewogICAgY29uc3QgYXJ0aWZhY3QgPSBjb25maWdCb3QudGFncy5hcnRpZmFjdDsKICAgIGNvbnN0IGFydEluZGV4ID0gYXJ0aWZhY3QuaW5kZXhPZigiX2FydF8iKTsKICAgIGNvbnN0IHN0dWRpbyA9IGFydGlmYWN0LnN1YnN0cmluZygwLCBhcnRJbmRleCk7CiAgICBjb25zdCByZWNvcmRBZGRyZXNzID0gYXJ0aWZhY3Quc3Vic3RyaW5nKGFydEluZGV4KTsKICAgIGNvbnN0IHJlY29yZERhdGEgPSBhd2FpdCBvcy5nZXREYXRhKHN0dWRpbywgcmVjb3JkQWRkcmVzcyk7CiAgICBjb25zdCBhc2tJRCA9IHJlY29yZERhdGEuZGF0YS5wYXR0ZXJuOwoKICAgIGF3YWl0IHRoaXNCb3QuYWJBZGFwdCgiYWJBY3Rpb24iKTsKCiAgICBsaW5rcy5hc2suYWJDb3JlTWVudUFjdGlvbihhc2tJRCk7Cn0KCi8vIENoZWNrIGlmIHdlIGNhbiB3YWtlIHVwIGFiLCBhbmQgdGhlbiBkbyBzby4KaWYgKCFjb25maWdCb3QudGFncy5hYlNsZWVwKSB7CiAgICBpZiAoKGluaXRpYWxCb290ICYmICFib290RmxhZyAmJiAhYXNrKSB8fCBsaW5rcy5yZW1lbWJlci50YWdzLmFiQWx3YXlzU3RhcnRBd2FrZSB8fCBjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgICAgIGF3YWl0IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJTZXRBd2FrZSh7IGF3YWtlOiB0cnVlLCBpbml0aWFsOiBpbml0aWFsQm9vdCB9KTsKICAgIH0KfQoKLy9zZXQgaW5pdGlhbCBib290IGRhdGEKaWYgKGluaXRpYWxCb290KSB7CiAgICBzZXRUYWdNYXNrKGxpbmtzLnJlbWVtYmVyLCAnaW5pdGlhbEJvb3QnLCBmYWxzZSwgJ3NoYXJlZCcpOwoKICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbGl6YXRpb25Db25maWd1cmF0aW9uKSB7CiAgICAgICAgbGlua3MucmVtZW1iZXIuYWJJbml0aWFsaXphdGlvbkNvbmZpZ3VyYXRpb24oKTsKICAgIH0KfQoKLy9jbGVhbiB1cCBVUkwgd2l0aCB0YWdQb3J0YWwKaWYgKGNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbCAmJiAhY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgJiYgYnVpbGRlclZlcnNpb24pIHsKICAgIGNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICBjb25maWdCb3QudGFncy50YWdQb3J0YWxTcGFjZSA9IG51bGw7Cn0KCi8vcGF1c2UgZm9yIGFiIGxvYWRpbmcuCmF3YWl0IG9zLnNsZWVwKDUwMCk7CgovL2luaXRpYWxpemUgdGltZSBib3QKdGhpc0JvdC5hYlRpbWVyKCk7Cgp0aGlzQm90LmFiQ3JlYXRlVXBkYXRlQ2hlY2tlcigpOwp0aGlzQm90LmFiQm9vdFN0YXR1c0NsZWFyKCk7CgovL2luaXRpYWxpemF0aW9uIHNob3V0CnN1cGVyU2hvdXQoIm9uQUJJbml0aWFsaXplZCIsIHRhZ3MuYWJJbnN0KTsnANyNpc8GABBvbkFCQXV0aEJvdEFkZGVkAgQA3I2lzwbxVzlAdGhpc0JvdC5hYlJlZnJlc2hTdHVkaW9zKCk7CnRoaXNCb3QuYWJSZWZyZXNoQUlNb2RlbHMoKTsnANyNpc8GABJvbkFCQXV0aEJvdFJlbW92ZWQCBADcjaXPBqtYOUB0aGlzQm90LmFiUmVmcmVzaFN0dWRpb3MoKTsKdGhpc0JvdC5hYlJlZnJlc2hBSU1vZGVscygpOycA3I2lzwYAEGFiUmVmcmVzaFN0dWRpb3MCBADcjaXPBuVYpQFAaWYgKGF1dGhCb3QpIHsKICAgIGNvbnN0IHVzZXJTdHVkaW9zID0gYXdhaXQgb3MubGlzdFVzZXJTdHVkaW9zKCk7CiAgICBjb25maWdCb3QudGFncy51c2VyX3N0dWRpb3MgPSB1c2VyU3R1ZGlvczsKfSBlbHNlIHsKICAgIGNvbmZpZ0JvdC50YWdzLnVzZXJfc3R1ZGlvcyA9IG51bGw7Cn0nANyNpc8GABFhYlJlZnJlc2hBSU1vZGVscwIEANyNpc8Gi1qaAUBpZiAoYXV0aEJvdCkgewogICAgY29uc3QgbW9kZWxzID0gYXdhaXQgYWkubGlzdENoYXRNb2RlbHMoKTsKICAgIGNvbmZpZ0JvdC50YWdzLmFpQ2hhdE1vZGVscyA9IG1vZGVsczsKfSBlbHNlIHsKICAgIGNvbmZpZ0JvdC50YWdzLmFpQ2hhdE1vZGVscyA9IG51bGw7Cn0oANyNpc8GAAZhYkNvcmUBeCcA3I2lzwYAB2FiQWRhcHQCBADcjaXPBqdbvhRAbGV0IHNraWxsTmFtZTsKbGV0IHNraWxsRGF0YTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7Cn0KCmlmICh0eXBlb2YgdGhhdCA9PT0gJ3N0cmluZycpIHsKICAgIHNraWxsTmFtZSA9IHRoYXQ7CiAgICBza2lsbERhdGEgPSBudWxsOwp9IGVsc2UgaWYgKHR5cGVvZiB0aGF0ID09PSAnb2JqZWN0JykgewogICAgc2tpbGxOYW1lID0gdGhhdC5zeXN0ZW1JRCA/PyB0aGF0LnNraWxsTmFtZTsKICAgIHNraWxsRGF0YSA9IHRoYXQuZGF0YSA/PyBudWxsOwp9CgppZiAoIXNraWxsTmFtZSkgewogICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNraWxsTmFtZSBpcyByZXF1aXJlZC5gKTsKICAgIHJldHVybiBmYWxzZTsKfQoKaWYgKHNraWxsTmFtZSA9PT0gJ2FiQ29yZScpIHsKICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9fV0gYWJDb25maWcgY2Fubm90IGJlIGxvYWRlZCB1c2luZyBhYkFkYXB0LmApOwogICAgcmV0dXJuOwp9Cgp0cnkgewogICAgY29uc3QgbG9hZGVkU2tpbGxzID0gdGhpc0JvdC5hYkxvYWRlZFNraWxscygpOwoKICAgIGlmICghbG9hZGVkU2tpbGxzLmluY2x1ZGVzKHNraWxsTmFtZSkpIHsKICAgICAgICBjb25zdCB1cmwgPSB0aGlzQm90LmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKGAvYWIvJHtza2lsbE5hbWV9LmF1eGApOwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgd2ViLmhvb2soeyBtZXRob2Q6ICJHRVQiLCB1cmwgfSk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWIgc2tpbGwgR0VUIHJlc3BvbnNlOmAsIHJlc3BvbnNlKTsKICAgICAgICB9CgogICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIENvdWxkIG5vdCBkb3dubG9hZCAke3NraWxsTmFtZX0uIFJlc3BvbnNlOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS52ZXJzaW9uID09PSAyKSB7CiAgICAgICAgICAgIC8vIEFVWCBGb3JtYXQgVmVyc2lvbiAyLgogICAgICAgICAgICBjb25zdCB1cGRhdGVzID0gcmVzcG9uc2UuZGF0YS51cGRhdGVzOwogICAgICAgICAgICBhd2FpdCBvcy5hcHBseVVwZGF0ZXNUb0luc3QodXBkYXRlcyk7CiAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgb3MuZ2V0SW5zdFN0YXRlRnJvbVVwZGF0ZXModXBkYXRlcyk7CiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUhhc2ggPSBjcnlwdG8uaGFzaCgnc2hhMScsICdoZXgnLCBzdGF0ZSk7CgogICAgICAgICAgICAvLyBMb2FkZWQgc2tpbGxzIGFyZSBzdG9yZWQgYXMgc2hhcmVkIGJvdHMgdGhhdCBhbnlvbmUgaW4gdGhlIGluc3QgY2FuIHJlYWQuCiAgICAgICAgICAgIGNyZWF0ZSh7CiAgICAgICAgICAgICAgICBzcGFjZTogJ3NoYXJlZCcsCiAgICAgICAgICAgICAgICBhYklnbm9yZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGFiTG9hZGVkU2tpbGw6IHNraWxsTmFtZSwKICAgICAgICAgICAgICAgIGFiTG9hZGVkU2tpbGxTb3VyY2VIYXNoOiBzb3VyY2VIYXNoLAogICAgICAgICAgICAgICAgZm9ybTogJ25vdGhpbmcnLAogICAgICAgICAgICB9KQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBBVVggZm9ybWF0IHZlcnNpb24gJHtyZXNwb25zZS5kYXRhLnZlcnNpb259IGlzIG5vdCBzdXBwb3J0ZWQuYCk7CiAgICAgICAgfQoKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYiBza2lsbCAke3NraWxsTmFtZX0gaXMgYWxyZWFkeSBsb2FkZWQuYCkKICAgICAgICB9CiAgICB9CgogICAgY29uc3Qgc2tpbGxCb3RzID0gZ2V0Qm90cyhiID0+IGIudGFnc1tza2lsbE5hbWVdID09PSB0cnVlKTsKICAgIGlmIChza2lsbEJvdHMgJiYgc2tpbGxCb3RzLmxlbmd0aCA+IDApIHsKICAgICAgICB3aGlzcGVyKHNraWxsQm90cywgdGFnTmFtZSwgY29uZmlnQm90LnRhZ3MuaW5zdCk7CiAgICAgICAgd2hpc3Blcihza2lsbEJvdHMsICJvblNraWxsVXBkYXRlIiwgeyBkYXRhOiBza2lsbERhdGEgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBObyBib3RzIGFwcGVhciB0byBoYXZlIGJlZW4gbG9hZGVkIHdpdGggJHtza2lsbE5hbWV9LmApOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcihlKTsKICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBGYWlsZWQgdG8gZG93bmxvYWQgJHtza2lsbE5hbWV9LiBTZWUgYWJvdmUgZXJyb3IuYCk7CiAgICByZXR1cm4gZmFsc2U7Cn0nANyNpc8GAAtkZXNjcmlwdGlvbgIEANyNpc8G5m9PVGhpcyBza2lsbCBpcyBkZXNpZ25lZCB0byBoYW5kbGUgYm90aCByZWNvbmZpZ3VyYXRpb24gb2YgYWIgYW5kIGluaXRpYWxpemF0aW9uLicA3I2lzwYACm9uQm90QWRkZWQCBADcjaXPBrZw8QFAY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvcmUgU1RBUlQgVVBgKTsKCnRoaXNCb3QuYWJJbnN0VXBkYXRlKCk7CgppZiAoIWxpbmtzLnJlbWVtYmVyKSB7CiAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGZpbmQgYWJDb25maWcgcmVtZW1iZXIgYm90LmApOwp9CgpzZXRUaW1lb3V0KCgpID0+IHRoaXNCb3QuYWJCb290KCksIDUwMCk7JwDcjaXPBgAIcmVtZW1iZXICBADcjaXPBqhyKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnANyNpc8GAANsb2cCBADcjaXPBs9ybEAvL3Bhc3MgdGhyb3VnaCBsb2cgZGF0YQppZiAobGlua3MuY29uc29sZSkgewogICAgbGlua3MuY29uc29sZS5sb2codGhhdCk7Cn0KZWxzZSB7CiAgICBjb25zb2xlLmxvZyh0aGF0KTsKfScA3I2lzwYADW1hbmlmZXN0YXRpb24CBADcjaXPBrxzKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnANyNpc8GAAxhYkNyZWF0ZUhvc3QCBADcjaXPBuNz1A1AY29uc3Qgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CgovL3RoaXMgZnVuY3Rpb24gaGFuZGxlcyBjcmVhdGluZyBhIGZpbGUgZm9yIGpvaW4gY29kZXMKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKSB7CiAgICBjb25zdCBqb2luVVJMID0gc2l0ZU9yaWdpbiArICIvP2pvaW5Db2RlPSIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRDsKICAgIG9zLnNldENsaXBib2FyZChqb2luVVJMKTsKICAgIG9zLnNob3dRUkNvZGUoam9pblVSTCk7CiAgICBhYi5saW5rcy51dGlscy5hYlRvYXN0KGB1cmwgY29waWVkIHRvIGNsaXBib2FyZGApOwogICAgcmV0dXJuOwp9CgppZiAoIWF1dGhCb3QpIHsKICAgIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7Cn0KCmlmICghYXV0aEJvdCkgewogICAgYWIubGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdChgcGxlYXNlIGxvZyBpbiB0byBnZW5lcmF0ZSBhIGpvaW4gY29kZWApOwogICAgcmV0dXJuOwp9CgpmdW5jdGlvbiBnZW5lcmF0ZUpvaW5Db2RlKCkgewogICAgY29uc3QgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVoxMjM0NTY3ODknOwogICAgbGV0IGNvZGUgPSAnJzsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjaGFycy5sZW5ndGgpOwogICAgICAgIGNvZGUgKz0gY2hhcnNbcmFuZG9tSW5kZXhdOwogICAgfQogICAgcmV0dXJuIGNvZGU7Cn0KCmNvbnN0IG5ld0pvaW5Db2RlID0gZ2VuZXJhdGVKb2luQ29kZSgpOwpjb25zdCBkYXRlID0gb3MuaXNDb2xsYWJvcmF0aXZlKCkgPyBvcy5hZ3JlZWRVcG9uVGltZSA6IG9zLmxvY2FsVGltZTsKY29uc3QgcmVjb3JkS2V5ID0gbGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleTsKCi8vIFtSeWFuIENvb2tdOiBUaGlzIGlzIGEgbmFpdmUgcm9vbSBjb2RlIGdlbmVyYXRvci4gSXQgZG9lcyBub3QgY2hlY2sgaWYgdGhlIHJvb20gY29kZSBpcyBhbHJlYWR5IHRha2VuIC8gYWN0aXZlLgpjb25zdCByZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YShyZWNvcmRLZXksIGBhYkpvaW5Db2RlXyR7bmV3Sm9pbkNvZGV9YCwgeyB1cmw6IGNvbmZpZ0JvdC50YWdzLnVybCwgZGF0ZSB9LCB7IG1hcmtlcnM6IFsicHVibGljUmVhZCJdIH0pOwoKaWYgKHJlY29yZERhdGEuc3VjY2VzcykgewogICAgc2V0VGFnTWFzayhsaW5rcy5yZW1lbWJlciwgJ2hvc3RJRCcsIG5ld0pvaW5Db2RlLCAnc2hhcmVkJyk7CgogICAgY29uc3Qgam9pblVSTCA9IHNpdGVPcmlnaW4gKyAiLz9qb2luQ29kZT0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQ7CgogICAgb3Muc2V0Q2xpcGJvYXJkKGpvaW5VUkwpOwoKICAgIGlmICh0aGF0ICYmIHRoYXQudGFncykgewogICAgICAgIHRoYXQudGFncy5sYWJlbCA9ICJqb2luIGNvZGU6ICIgKyBuZXdKb2luQ29kZTsKICAgIAogICAgfQogICAgb3Muc2hvd1FSQ29kZShqb2luVVJMKTsKCiAgICBhYi5saW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KGBqb2luIGNvZGUgZ2VuZXJhdGVkOiAke25ld0pvaW5Db2RlfS4gdXJsIGNvcGllZCB0byBjbGlwYm9hcmQuYCk7Cn0KZWxzZSB7CiAgICBhYi5saW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KGBmYWlsZWQgdG8gZ2VuZXJhdGUgam9pbiBjb2RlLCBwbGVhc2UgdHJ5IGFnYWluLmApOwogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfScA3I2lzwYACmFiSm9pbkhvc3QCBADcjaXPBriBAawKQC8vbG9naWMgZm9yIHVzaW5nIGEgam9pbiBjb2RlIChjaGVja3MgZm9yIGV4aXN0aW5nIGZpbGVzKQpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGV0IGdldFJlY29yZDsKCmlmICh0aGF0LmRhdGEpIHsKICAgIGdldFJlY29yZCA9IHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogdGhhdC5kYXRhIH07Cn0gZWxzZSB7CiAgICBjb25zdCBqb2luQ29kZSA9IHRoYXQudGV4dC50b1VwcGVyQ2FzZSgpOwogICAgY29uc3QgcmVjb3JkS2V5ID0gbGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleTsKCiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gam9pbiBjb2RlOmAsIGpvaW5Db2RlKQogICAgfQoKICAgIGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCBgYWJKb2luQ29kZV8ke2pvaW5Db2RlfWApOwp9CgppZiAoZ2V0UmVjb3JkICYmIGdldFJlY29yZC5zdWNjZXNzKSB7CiAgICBjb25zdCBub3dUaW1lID0gb3MuaXNDb2xsYWJvcmF0aXZlKCkgPyBvcy5hZ3JlZWRVcG9uVGltZSA6IG9zLmxvY2FsVGltZTsKICAgIGNvbnN0IG5vd0RhdGUgPSBEYXRlVGltZS5mcm9tTWlsbGlzKG5vd1RpbWUpOwogICAgY29uc3QgY3JlYXRlRGF0ZSA9IERhdGVUaW1lLmZyb21NaWxsaXMoZ2V0UmVjb3JkLmRhdGEuZGF0ZSk7CgogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG5vd1RpbWU6YCwgbm93VGltZSwgYG5vd0RhdGU6YCwgbm93RGF0ZSwgYGNyZWF0ZURhdGU6YCwgY3JlYXRlRGF0ZSk7CiAgICB9CgogICAgbGV0IGRpZmZlcmVuY2UgPSBub3dEYXRlLmRpZmYoY3JlYXRlRGF0ZSwgImRheXMiKS50b09iamVjdCgpOwogICAgZGlmZmVyZW5jZSA9IE1hdGguZmxvb3IoZGlmZmVyZW5jZS5kYXlzKTsKCiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGlmZmVyZW5jZSAoZGF5cyk6YCwgZGlmZmVyZW5jZSk7CiAgICB9CiAgICAKICAgIGlmIChkaWZmZXJlbmNlIDwgOCkgewogICAgICAgIG9zLnRvYXN0KCJqb2luaW5nIGhvc3Qgbm93Iik7CiAgICAgICAgb3MuZ29Ub1VSTChnZXRSZWNvcmQuZGF0YS51cmwpOwogICAgfSBlbHNlIHsKICAgICAgICBvcy50b2FzdCgiam9pbiBjb2RlIG91dCBvZiBkYXRlLCBwbGVhc2UgZ2VuZXJhdGUgYSBuZXcgam9pbiBjb2RlIik7CiAgICB9Cn0gZWxzZSB7CiAgICBvcy50b2FzdCgiam9pbiBjb2RlIGludmFsaWQsIHBsZWFzZSB0cnkgYWdhaW4iKTsKfScA3I2lzwYABnNlYXJjaAIEANyNpc8G5YsBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnANyNpc8GAAhhYklnbm9yZQIEANyNpc8GjIwBBHRydWUnANyNpc8GAARtZW51AgQA3I2lzwaRjAEo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicA3I2lzwYAFWFiU2tpbGxJbml0aWFsaXphdGlvbgIEANyNpc8GuIwBowJALy9GaW5kIHRoZSBhcHByb3ByaWF0ZSBhcnJheSBhbmQgcG9wdWxhdGUgc2tpbGxzCmxldCBza2lsbEFycmF5ID0gbGlua3MucmVtZW1iZXIudGFnc1t0aGF0ICsgIlNraWxsQXJyYXkiXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgc2tpbGxBcnJheS5sZW5ndGg7IGkrKykgewogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KHNraWxsQXJyYXlbaV0pOwp9CgppZiAoY29uZmlnQm90LnRhZ3MuZW1iZWQgPT09ICdpb3MnKSB7CiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoJ2FiSU9TQnJpZGdlJyk7Cn0KCnJldHVybjsnANyNpc8GAAZiYW5uZXICBADcjaXPBtyOASjwn5SXYjU1MmVhZjktYTlkNi00MWM4LTg1MTUtY2JkMmFiZWFhZTczJwDcjaXPBgAFaW5wdXQCBADcjaXPBoOPASjwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwDcjaXPBgADYXNrAgQA3I2lzwaqjwEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycA3I2lzwYAB2FiVGltZXICBADcjaXPBtGPAcEGQGlmIChnZXRCb3QoImFiVGltZXIiLCB0cnVlKSkgewogICAgcmV0dXJuOwp9CgppZiAoIXRhZ3MuYWJYUCkgewogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJYUCIsICIwIiwgImxvY2FsIik7Cn0KCmxldCB0aW1lckJvdCA9IHt9OwoKdGltZXJCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKdGltZXJCb3QubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7CnRpbWVyQm90Lm9uQ3JlYXRlID0gYEAKICAgIG1hc2tzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpc0JvdC5vblRpbWVDaGVjaygpLCA2MDAwMCk7CmA7CnRpbWVyQm90LmFiVGltZXIgPSB0cnVlOwp0aW1lckJvdC5vblRpbWVDaGVjayA9IGBACiAgICBpZiAodGFncy5ub3RJZGxlKSB7CiAgICAgICAgdGFncy5ub3RJZGxlID0gZmFsc2U7CgogICAgICAgIC8vY29uc29sZS5sb2coIlhQIiwgbGlua3MubWFuYWdlci50YWdzLmFiWFApOwoKICAgICAgICBjb25zdCB0b3RhbFhQID0gbGlua3MubWFuYWdlci50YWdzLmFiWFAgKyAxOwoKICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLm1hbmFnZXIsICJhYlhQIiwgdG90YWxYUCwgImxvY2FsIik7CiAgICB9CmA7CnRpbWVyQm90Lm5vdElkbGUgPSBmYWxzZTsKdGltZXJCb3Qub25BbnlBY3Rpb24gPSBgQAogICAgaWYgKCF0YWdzLm5vdElkbGUpIHsKICAgICAgICBpZiAodGhhdC5hY3Rpb24uaWQgPT0gZ3JpZFBvcnRhbEJvdC5pZCkKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3Mubm90SWRsZSA9IHRydWU7CiAgICAgICAgfQogICAgfQpgOwoKbGV0IGFiVGltZXIgPSBjcmVhdGUodGltZXJCb3QpOwoKZ2xvYmFsVGhpcy5hYlRpbWVyID0gYWJUaW1lcjsnANyNpc8GAAVzdG9yZQIEANyNpc8Gk5YBKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnANyNpc8GAAdjb25zb2xlAgQA3I2lzwa6lgEo8J+UlzI0YjdlNjZmLTBkNWItNDA2NC1iZjQ4LWI1NjJiOWU2ZTNlYicA3I2lzwYACWFiVmVyc2lvbgIEANyNpc8G4ZYBBTEwLjQzJwDcjaXPBgAXYWJCdWlsZENhc3VhbENhdGFsb2dVUkwCBADcjaXPBueWAf8BQGNvbnN0IHJlbGF0aXZlUGF0aCA9IHRoYXQ7Cgpjb25zdCB1cmwgPSBuZXcgVVJMKGxpbmtzLnJlbWVtYmVyLnRhZ3MuY2FzdWFsQ2F0YWxvZ1VSTCk7CmNvbnN0IGVudiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuY2FzdWFsQ2F0YWxvZ0VudjsKCnVybC5wYXRobmFtZSA9IHJlbGF0aXZlUGF0aDsKCmlmIChlbnYgJiYgZW52ICE9PSAncHJvZCcpIHsKICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCdlbnYnLCBlbnYpOwp9CgpyZXR1cm4gdXJsLmhyZWY7JwDcjaXPBgAHY2hhbm5lbAIEANyNpc8G55gBKPCflJdhOWI2YWEwZC1iMzU3LTRkZTYtOWJlZi04NTM0OGFiMWQwZTAnANyNpc8GAAtwZXJzb25hbGl0eQIEANyNpc8GjpkBKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInANyNpc8GAAxhYkluc3RVcGRhdGUCBADcjaXPBrWZAaIBQC8vIFVwZGF0ZSB0aGUgYWJJbnN0IHRhZyB3aGljaCByZXByZXNlbnRzIHRoZSBpbnN0IHRoYXQgdGhpcyBhYiBleGlzdHMgaW4uCmNvbnN0IGN1ckluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwpzZXRUYWdNYXNrKHRoaXNCb3QsICdhYkluc3QnLCBjdXJJbnN0LCAnc2hhcmVkJyk7JwDcjaXPBgAMb25JbnN0Sm9pbmVkAgQA3I2lzwbYmgEYQHRoaXNCb3QuYWJJbnN0VXBkYXRlKCk7JwDcjaXPBgALb25JbnN0TGVhdmUCBADcjaXPBvGaARhAdGhpc0JvdC5hYkluc3RVcGRhdGUoKTsnANyNpc8GAAxyZXNlcnZlZEFza3MCBADcjaXPBoqbAQzwn6esWyJob21lIl0nANyNpc8GAAhhcnRpZmFjdAIEANyNpc8GlZsBKPCflJc3OGU0MTUwMy1jOTMzLTRmOGEtODE3YS1iYTk3YmY4ZDVkMjcnANyNpc8GAAtib3RfZmFjdG9yeQIEANyNpc8GvJsBKPCflJdjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcnANyNpc8GAAV1dGlscwIEANyNpc8G45sBKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnANyNpc8GAAh1cGRhdGVBQgIEANyNpc8GipwB4SpAY29uc3QgcmVsb2FkUGFnZSA9IHRoYXQ/LnJlbG9hZFBhZ2UgPz8gdHJ1ZTsNCmNvbnN0IHNob3dJbmRpY2F0b3IgPSB0aGF0Py5zaG93SW5kaWNhdG9yID8/IHRydWU7DQpjb25zdCBkcnlSdW4gPSB0aGF0Py5kcnlSdW4gPz8gZmFsc2U7DQoNCmxldCBidXN5SW5kaWNhdG9yOw0KDQppZiAoc2hvd0luZGljYXRvcikgew0KICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gJ3VwZGF0ZUFCTWVudSc7DQogICAgYnVzeUluZGljYXRvciA9IGF3YWl0IGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcih7IHVwZGF0ZUFCTWVudTogdHJ1ZSwgbGFiZWw6IGB1cGRhdGluZyAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9YCB9KTsNCn0NCg0KLy8gTGV0IGFsbCBib3RzIGtub3cgdGhhdCBhYiBpcyBhYm91dCB0byB1cGRhdGUgaXRzZWxmLg0KYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHNob3V0KCdvbkFCQmVmb3JlVXBkYXRlJykpOw0KDQpsZXQgb3ZlcndyaXRlUmVzdWx0Ow0KDQp0cnkgew0KICAgIC8vIFVwZGF0ZSBhYkNvbmZpZy4NCiAgICBjb25zdCBhYkNvbmZpZ1VSTCA9IG9zLmdldEFCMUJvb3RzdHJhcFVSTCgpOw0KICAgIGNvbnN0IGFiQ29uZmlnUmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKHsgbWV0aG9kOiAiR0VUIiwgdXJsOiBhYkNvbmZpZ1VSTCB9KTsNCg0KICAgIGFzc2VydChhYkNvbmZpZ1Jlc3BvbnNlLnN0YXR1cyA9PT0gMjAwLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIENvdWxkIG5vdCBkb3dubG9hZCBhYkNvbmZpZy4gUmVzcG9uc2U6ICR7YWJDb25maWdSZXNwb25zZS5zdGF0dXNUZXh0fWApOw0KICAgIGFzc2VydChhYkNvbmZpZ1Jlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvbmZpZyBtdXN0IGJlIGluIGF1eCBmaWxlIGZvcm1hdCB2Mi4gQWN0dWFsIGF1eCBmaWxlIGZvcm1hdCB2ZXJzaW9uOiAke2FiQ29uZmlnUmVzcG9uc2UuZGF0YS52ZXJzaW9ufWApOw0KDQogICAgb3ZlcndyaXRlUmVzdWx0ID0gYXdhaXQgdGhpc0JvdC5hdXhWMk92ZXJ3cml0ZSh7IGF1eDogYWJDb25maWdSZXNwb25zZS5kYXRhLCBncm91cFRhZzogJ2FiQ29uZmlnJywgZHJ5UnVuIH0pOw0KICAgIHNldFRhZ01hc2soYWIubGlua3MucmVtZW1iZXIsICdhYkNvbmZpZ1NvdXJjZUhhc2gnLCBvdmVyd3JpdGVSZXN1bHQuc291cmNlSGFzaCwgJ3NoYXJlZCcpOw0KDQogICAgLy8gVXBkYXRlIGFiIHNraWxscy4NCiAgICBjb25zdCBsb2FkZWRTa2lsbHMgPSB0aGlzQm90LmFiTG9hZGVkU2tpbGxzKCk7DQoNCiAgICBmb3IgKGxldCBza2lsbE5hbWUgb2YgbG9hZGVkU2tpbGxzKSB7DQogICAgICAgIGNvbnN0IHNraWxsVVJMID0gdGhpc0JvdC5hYkJ1aWxkQ2FzdWFsQ2F0YWxvZ1VSTChgL2FiLyR7c2tpbGxOYW1lfS5hdXhgKTsNCg0KICAgICAgICAvLyBTa2lsbHMgY2FuIGJlIHJlc3RydWN0dXJlZCwgbWVhbmluZyB0aGF0IHRoZXkgY291bGQgYmUgcmVtb3ZlZCBlbnRpcmVseSBpbiB0aGUgZnV0dXJlLg0KICAgICAgICAvLyBJZiBhIGZpbGUgZmFpbHMgdG8gYmUgcmV0cmlldmVkLCB0aGVuIHJlbW92ZSBhbGwgdGhlIGJvdHMgaW4gdGhlIGdyb3VwIGluIHRoZSBpbnN0Lg0KICAgICAgICBsZXQgcmVtb3ZlU2tpbGwgPSBmYWxzZTsNCiAgICAgICAgbGV0IHNraWxsUmVzcG9uc2U7DQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHNraWxsUmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKHsgbWV0aG9kOiAiR0VUIiwgdXJsOiBza2lsbFVSTCB9KTsNCg0KICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNraWxsUmVzcG9uc2U6YCwgc2tpbGxSZXNwb25zZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGFzc2VydChza2lsbFJlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSAke3NraWxsTmFtZX0gbXVzdCBiZSBpbiBhdXggZmlsZSBmb3JtYXQgdjIuIEFjdHVhbCBhdXggZmlsZSBmb3JtYXQgdmVyc2lvbjogJHtza2lsbFJlc3BvbnNlLmRhdGEudmVyc2lvbn1gKTsNCg0KICAgICAgICAgICAgaWYgKHNraWxsUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsNCiAgICAgICAgICAgICAgICBpZiAoc2tpbGxSZXNwb25zZS5zdGF0dXMgPT09IDQwMyB8fCBza2lsbFJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7DQogICAgICAgICAgICAgICAgICAgIHJlbW92ZVNraWxsID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgJHtza2lsbE5hbWV9LiBSZXNwb25zZTogJHtza2lsbFJlc3BvbnNlLnN0YXR1c1RleHR9YCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2F1Z2h0IGVycm9yIHdoaWxlIGRvd25sb2FkaW5nIHNraWxsOmAsIGUpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoZS5yZXNwb25zZT8uc3RhdHVzID09PSA0MDMgfHwgZS5yZXNwb25zZT8uc3RhdHVzID09PSA0MDQpIHsNCiAgICAgICAgICAgICAgICAvLyBGaWxlIGRvZXNudCBleGlzdCBhbnltb3JlLCB0aGUgc2tpbGwgaGFzIGJlZW4gcmVtb3ZlZC4NCiAgICAgICAgICAgICAgICByZW1vdmVTa2lsbCA9IHRydWU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHRocm93IGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmIChza2lsbFJlc3BvbnNlICYmICFyZW1vdmVTa2lsbCkgew0KICAgICAgICAgICAgb3ZlcndyaXRlUmVzdWx0ID0gYXdhaXQgdGhpc0JvdC5hdXhWMk92ZXJ3cml0ZSh7IGF1eDogc2tpbGxSZXNwb25zZS5kYXRhLCBncm91cFRhZzogc2tpbGxOYW1lLCBkcnlSdW4gfSk7DQoNCiAgICAgICAgICAgIGNvbnN0IGxvYWRlZFNraWxsQm90ID0gZ2V0Qm90KGIgPT4gYi50YWdzLmFiTG9hZGVkU2tpbGwgPT09IHNraWxsTmFtZSAmJiBiLnNwYWNlID09PSAnc2hhcmVkJyk7DQogICAgICAgICAgICBhc3NlcnQobG9hZGVkU2tpbGxCb3QsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY291bGQgbm90IGZpbmQgbG9hZGVkIHNraWxsIGJvdCBmb3IgJHtza2lsbE5hbWV9LmApOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZXRUYWdNYXNrKGxvYWRlZFNraWxsQm90LCAnYWJMb2FkZWRTa2lsbFNvdXJjZUhhc2gnLCBvdmVyd3JpdGVSZXN1bHQuc291cmNlSGFzaCwgJ3NoYXJlZCcpOw0KICAgICAgICB9IGVsc2UgaWYgKHJlbW92ZVNraWxsKSB7DQogICAgICAgICAgICBjb25zdCBza2lsbEJvdHMgPSBnZXRCb3RzKGIgPT4gYi50YWdzW3NraWxsTmFtZV0gPT09IHRydWUpOw0KDQogICAgICAgICAgICBpZiAoZHJ5UnVuKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBkZWxldGUgJHtza2lsbEJvdHMubGVuZ3RofSAke3NraWxsTmFtZX0gYm90KHMpIGJlY2F1c2UgJHtza2lsbE5hbWV9IGlzIG5vIGxvbmdlciBpbiB0aGUgY2FzdWFsIGNhdGFsb2cuYCkNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICBpZiAodGFncy5kZWJ1Zykgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gU2tpbGwgJHtza2lsbE5hbWV9IGlzIG5vIGxvbmdlciBpbiB0aGUgY2FzdWFsIGNhdGFsb2cuIFJlbW92ZSAke3NraWxsQm90cy5sZW5ndGh9ICR7c2tpbGxOYW1lfSBib3QocykgZnJvbSBpbnN0LmApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBkZXN0cm95KHNraWxsQm90cyk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBVcGRhdGUgYWJDb3JlIChkbyB0aGlzIG9uZSBsYXN0ISkNCiAgICBjb25zdCBhYkNvcmVVUkwgPSB0aGlzQm90LmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKCcvYWIvYWJDb3JlLmF1eCcpOw0KICAgIGNvbnN0IGFiQ29yZVJlc3BvbnNlID0gYXdhaXQgd2ViLmhvb2soeyBtZXRob2Q6ICJHRVQiLCB1cmw6IGFiQ29yZVVSTCB9KTsNCg0KICAgIGFzc2VydChhYkNvcmVSZXNwb25zZS5zdGF0dXMgPT09IDIwMCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgYWJDb3JlLiBSZXNwb25zZTogJHthYkNvcmVSZXNwb25zZS5zdGF0dXNUZXh0fWApOw0KICAgIGFzc2VydChhYkNvcmVSZXNwb25zZS5kYXRhLnZlcnNpb24gPT09IDIsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWJDb3JlIG11c3QgYmUgaW4gYXV4IGZpbGUgZm9ybWF0IHYyLiBBY3R1YWwgYXV4IGZpbGUgZm9ybWF0IHZlcnNpb246ICR7YWJDb3JlUmVzcG9uc2UuZGF0YS52ZXJzaW9ufWApOw0KDQogICAgb3ZlcndyaXRlUmVzdWx0ID0gYXdhaXQgdGhpc0JvdC5hdXhWMk92ZXJ3cml0ZSh7IGF1eDogYWJDb3JlUmVzcG9uc2UuZGF0YSwgZ3JvdXBUYWc6ICdhYkNvcmUnLCBkcnlSdW4gfSk7DQogICAgc2V0VGFnTWFzayhhYiwgJ2FiQ29yZVNvdXJjZUhhc2gnLCBvdmVyd3JpdGVSZXN1bHQuc291cmNlSGFzaCwgJ3NoYXJlZCcpOw0KICAgIA0KICAgIC8vIExldCBhbGwgYm90cyBrbm93IHRoYXQgYWIgaXMgZmluaXNoZWQgdXBkYXRpbmcuDQogICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHNob3V0KCdvbkFCVXBkYXRlZCcpKTsNCg0KICAgIGlmIChyZWxvYWRQYWdlKSB7DQogICAgICAgIGNvbnN0IHJlbW90ZURhdGFFdmVudCA9ICd1cGRhdGVfYWJfcmVsb2FkX3BhZ2UnOw0KICAgICAgICBjb25zdCByZW1vdGVEYXRhQXJnID0geyByZWxvYWRQYWdlLCBkcnlSdW4gfTsNCg0KICAgICAgICBpZiAob3MuaXNDb2xsYWJvcmF0aXZlKCkpIHsNCiAgICAgICAgICAgIGNvbnN0IHJlbW90ZXMgPSBhd2FpdCBvcy5yZW1vdGVzKCk7DQogICAgICAgICAgICBzZW5kUmVtb3RlRGF0YShyZW1vdGVzLCByZW1vdGVEYXRhRXZlbnQsIHJlbW90ZURhdGFBcmcpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpc0JvdC5vblJlbW90ZURhdGEoeyBuYW1lOiByZW1vdGVEYXRhRXZlbnQsIHRoYXQ6IHJlbW90ZURhdGFBcmcsIHJlbW90ZUlkOiBjb25maWdCb3QuaWQgfSk7DQogICAgICAgIH0NCiAgICB9DQp9IGZpbmFsbHkgew0KICAgIGlmIChidXN5SW5kaWNhdG9yKSB7DQogICAgICAgIGRlc3Ryb3koYnVzeUluZGljYXRvcik7DQogICAgICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsNCiAgICB9DQp9JwDcjaXPBgAFZGVidWcCBADcjaXPBuzGAQVmYWxzZScA3I2lzwYAFWFiQ3JlYXRlVXBkYXRlQ2hlY2tlcgIEANyNpc8G8sYBvRNAbGV0IGFiVXBkYXRlQ2hlY2tlciA9IGdldEJvdCgnYWJVcGRhdGVDaGVja2VyJywgdHJ1ZSk7CgppZiAoYWJVcGRhdGVDaGVja2VyKSB7CiAgICBnbG9iYWxUaGlzLmFiVXBkYXRlQ2hlY2tlciA9IGFiVXBkYXRlQ2hlY2tlcjsKICAgIHJldHVybiBhYlVwZGF0ZUNoZWNrZXI7Cn0KCmxldCBtb2QgPSB7CiAgICBzcGFjZTogJ3RlbXBMb2NhbCcsCiAgICBhYlVwZGF0ZUNoZWNrZXI6IHRydWUsCiAgICBhYklnbm9yZTogdHJ1ZSwKICAgIGNoZWNraW5nOiBmYWxzZSwKICAgIHVwZGF0ZUF2YWlsYWJsZTogZmFsc2UsCiAgICBkZWJ1ZzogZmFsc2UsCiAgICBvbkNyZWF0ZTogYEAKICAgICAgICB0aGlzQm90LnN0YXJ0SW50ZXJ2YWwoKTsKICAgICAgICB0aGlzQm90Lm9uVXBkYXRlQ2hlY2soKTsKICAgIGAsCiAgICBzdGFydEludGVydmFsOiBgQAogICAgICAgIGlmICghdGFncy5pbnRlcnZhbCkgewogICAgICAgICAgICBjb25zdCBVUERBVEVfQ0hFQ0tfSU5URVJWQUxfTUlOVVRFUyA9IDU7CiAgICAgICAgICAgIGNvbnN0IGludGVydmFsTVMgPSBVUERBVEVfQ0hFQ0tfSU5URVJWQUxfTUlOVVRFUyAqIDYwICogMTAwMDsKICAgICAgICAgICAgdGFncy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHRoaXNCb3Qub25VcGRhdGVDaGVjaygpLCBpbnRlcnZhbE1TKTsKCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiVXBkYXRlQ2hlY2tlcl0gc3RhcnQgdXBkYXRlIGNoZWNrIGludGVydmFsIG1zOicsIGludGVydmFsTVMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgYCwKICAgIHN0b3BJbnRlcnZhbDogYEAKICAgICAgICBpZiAodGFncy5pbnRlcnZhbCkgewogICAgICAgICAgICBjbGVhckludGVydmFsKHRhZ3MuaW50ZXJ2YWwpOwogICAgICAgICAgICB0YWdzLmludGVydmFsID0gbnVsbDsKCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiVXBkYXRlQ2hlY2tlcl0gc3RvcCB1cGRhdGUgY2hlY2sgaW50ZXJ2YWwuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICBgLAogICAgZm9yY2VVcGRhdGVDaGVjazogYEAKICAgICAgICB0aGlzQm90LnN0b3BJbnRlcnZhbCgpOwogICAgICAgIHRoaXNCb3Quc3RhcnRJbnRlcnZhbCgpOwogICAgICAgIHRoaXNCb3Qub25VcGRhdGVDaGVjayh7IGZvcmNlOiB0cnVlIH0pOwogICAgYCwKICAgIG9uVXBkYXRlQ2hlY2s6IGBACiAgICAgICAgY29uc3QgZm9yY2UgPSB0aGF0Py5mb3JjZSA/PyBmYWxzZTsKCiAgICAgICAgaWYgKCF0YWdzLmNoZWNraW5nKSB7CiAgICAgICAgICAgIGlmICghdGFncy51cGRhdGVBdmFpbGFibGUgfHwgZm9yY2UpIHsKICAgICAgICAgICAgICAgIHRhZ3MuY2hlY2tpbmcgPSB0cnVlOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWIuYWJDaGVja0FCVXBkYXRlQXZhaWxhYmxlKCk7CgogICAgICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJVcGRhdGVDaGVja2VyXSB1cGRhdGUgY2hlY2sgcmVzdWx0OicsIHJlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy51cGRhdGVBdmFpbGFibGUgPSByZXN1bHQudXBkYXRlQXZhaWxhYmxlOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC51cGRhdGVBdmFpbGFibGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3V0KCdvbkFCVXBkYXRlQXZhaWxhYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIHRhZ3MuY2hlY2tpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYlVwZGF0ZUNoZWNrZXJdIHNraXAgdXBkYXRlIGNoZWNrIOKAlCB1cGRhdGUgaXMgYWxyZWFkeSBrbm93biB0byBiZSBhdmFpbGFibGUuJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYlVwZGF0ZUNoZWNrZXJdIHVwZGF0ZSBjaGVjayBhbHJlYWR5IGluIHByb2dyZXNzLicpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIGAsCn0KCmFiVXBkYXRlQ2hlY2tlciA9IGNyZWF0ZShtb2QpOwpnbG9iYWxUaGlzLmFiVXBkYXRlQ2hlY2tlciA9IGFiVXBkYXRlQ2hlY2tlcgoKcmV0dXJuIGFiVXBkYXRlQ2hlY2tlcjsnANyNpc8GAA5hdXhWMk92ZXJ3cml0ZQIEANyNpc8GrtoBkSpAY29uc3QgYXV4ID0gdGhhdD8uYXV4Owpjb25zdCBncm91cFRhZyA9IHRoYXQ/Lmdyb3VwVGFnOwpjb25zdCBkcnlSdW4gPSB0aGF0Py5kcnlSdW4gPz8gZmFsc2U7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9Cgphc3NlcnQoYXV4Py52ZXJzaW9uID09PSAyLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGF1eCBwYXJhbWV0ZXIgaXMgcmVxdWlyZWQgdG8gYmUgYSB2MiBhdXggZmlsZS5gKTsKYXNzZXJ0KGdyb3VwVGFnID09IG51bGwgfHwgdHlwZW9mIGdyb3VwVGFnID09PSAnc3RyaW5nJywgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBncm91cFRhZyBwYXJhbWV0ZXIgaWYgcHJvdmlkZWQsIG11c3QgYmUgYSBzdHJpbmcuYCk7Cgpjb25zdCBzdGF0ZSA9IGF3YWl0IG9zLmdldEluc3RTdGF0ZUZyb21VcGRhdGVzKGF1eC51cGRhdGVzKTsKCi8vIFN1cGVyIGhhcmRjb2RlZCBtZXNzeSBmaXggZm9yIGNvbXB1dGluZyBhYkNvbmZpZyBzb3VyY2UgaGFzaC4KaWYgKGdyb3VwVGFnID09PSAnYWJDb25maWcnKSB7IAogICAgZm9yIChsZXQgaWQgaW4gc3RhdGUpIHsKICAgICAgICBkZWxldGUgc3RhdGVbaWRdLnRhZ3MuYmFzZUFCOyAvLyBiYXNlQUIgaXMgYW4gYW5ub3lpbmcgdGFnIHRoYXQgc2hvdWxkIG5vdCBiZSBjb21wdXRlZCBhcyBwYXJ0IG9mIGhhc2ggc3RhdGUuCiAgICB9Cn0KCmxldCBzb3VyY2VIYXNoID0gY3J5cHRvLmhhc2goJ3NoYTEnLCAnaGV4Jywgc3RhdGUpOwpsZXQgcHJldkdyb3VwQm90cyA9IGdldEJvdHMoYiA9PiBiLnRhZ3NbZ3JvdXBUYWddID09PSB0cnVlKTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHN0YXRlOmAsIHN0YXRlKTsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gcHJldkdyb3VwQm90czpgLCBwcmV2R3JvdXBCb3RzKTsKfQoKLy8gU3RlcCAxOiBBcHBseSB1cGRhdGVzIGRpcmVjdGx5IHRvIHRoZSBpbnN0IGFzLWlzLgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBTdGVwIDE6IEFwcGx5IHVwZGF0ZXMgZGlyZWN0bHkgdG8gdGhlIGluc3QgYXMtaXMuYCk7Cn0KCmlmICghZHJ5UnVuKSB7CiAgICBhd2FpdCBvcy5hcHBseVVwZGF0ZXNUb0luc3QoYXV4LnVwZGF0ZXMpOwp9IGVsc2UgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBhcHBseSB1cGRhdGVzIHRvIGluc3QuYCkKfQoKLy8gU3RlcCAyOiBEZWxldGUgcHJldmlvdXMgZ3JvdXAgYm90cyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIHVwZGF0ZSBzdGF0ZS4KaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gU3RlcCAyOiBEZWxldGUgcHJldmlvdXMgZ3JvdXAgYm90cyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIHVwZGF0ZSBzdGF0ZS5gKTsKfQoKZm9yIChjb25zdCBwcmV2R3JvdXBCb3Qgb2YgcHJldkdyb3VwQm90cykgewogICAgaWYgKHN0YXRlW3ByZXZHcm91cEJvdC5pZF0gPT0gbnVsbCkgewogICAgICAgIGlmIChkcnlSdW4pIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBkZWxldGUgYm90ICR7cHJldkdyb3VwQm90LmlkfSBwcmV2aW91c2x5IGJlbG9uZ2luZyB0byBncm91cCAke2dyb3VwVGFnfWApOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGVzdHJveWluZyBwcmV2aW91cyBncm91cCBib3QgJHtwcmV2R3JvdXBCb3QuaWR9IHRoYXQgaXMgbm8gbG9uZ2VyIGluIHRoZSB1cGRhdGUgc3RhdGUuYCk7CiAgICAgICAgfQoKICAgICAgICBkZXN0cm95KHByZXZHcm91cEJvdCk7CiAgICB9Cn0KCi8vIFN0ZXAgMzogRm9yIGVhY2ggYm90IGluIHRoZSB1cGRhdGUgc3RhdGUsIGNyZWF0ZSwgdXBkYXRlLCBhbmQgZGVsZXRlIHRhZ3Mgb24gdGhlIGV4aXN0aW5nIGJvdHMgaW4gdGhlIGluc3QuCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIFN0ZXAgMzogRm9yIGVhY2ggYm90IGluIHRoZSB1cGRhdGUgc3RhdGUsIGNyZWF0ZSwgdXBkYXRlLCBhbmQgZGVsZXRlIHRhZ3Mgb24gdGhlIGV4aXN0aW5nIGJvdHMgaW4gdGhlIGluc3QuYCk7Cn0KCmZvciAoY29uc3QgYm90SWQgaW4gc3RhdGUpIHsKICAgIGNvbnN0IGJvdCA9IGdldEJvdCgnaWQnLCBib3RJZCk7CiAgICBjb25zdCBib3RTdGF0ZSA9IHN0YXRlW2JvdElkXTsKCiAgICBpZiAoYm90KSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBmb3VuZCBleGlzdGluZyBib3QgJHtib3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIC8vIEhhbmRsZXMgdGFnIGNyZWF0ZSAvIHVwZGF0ZS4KICAgICAgICBmb3IgKGNvbnN0IHN0YXRlVGFnTmFtZSBpbiBib3RTdGF0ZS50YWdzKSB7CiAgICAgICAgICAgIGlmIChib3QucmF3W3N0YXRlVGFnTmFtZV0gIT0gYm90U3RhdGUudGFnc1tzdGF0ZVRhZ05hbWVdKSB7CiAgICAgICAgICAgICAgICBpZiAoZHJ5UnVuKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBzZXQgdGFnICcke3N0YXRlVGFnTmFtZX0nIG9uIGJvdCAke2JvdElkfSB0byB2YWx1ZTpgLCBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV0pOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzZXQgdGFnICcke3N0YXRlVGFnTmFtZX0nIG9uIGJvdCAke2JvdElkfSB0bzpgLCBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJvdC50YWdzW3N0YXRlVGFnTmFtZV0gPSBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV07CgogICAgICAgICAgICAgICAgaWYgKGJvdFN0YXRlLnRhZ3Nbc3RhdGVUYWdOYW1lXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0YWcgJyR7c3RhdGVUYWdOYW1lfScgZm9yIGJvdCAke2JvdElkfSBpcyBudWxsLCBjbGVhcmluZyBhbnkgdGFnIG1hc2tzIGFzIHdlbGwuYCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBDbGVhciBhbGwgcG9zc2libGUgbWFza3MgZm9yIHRoaXMgdGFnIGFzIHdlbGwuCiAgICAgICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIHN0YXRlVGFnTmFtZSwgbnVsbCwgJ2xvY2FsJyk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIHN0YXRlVGFnTmFtZSwgbnVsbCwgJ3RlbXBMb2NhbCcpOwogICAgICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYm90LCBzdGF0ZVRhZ05hbWUsIG51bGwsICdzaGFyZWQnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgc3RhdGVUYWdOYW1lLCBudWxsLCAndGVtcFNoYXJlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRhZyAnJHtzdGF0ZVRhZ05hbWV9JyBmb3IgYm90ICR7Ym90SWR9IGlzIGFscmVhZHkgdXAtdG8tZGF0ZS5gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gRGVsZXRlIHRhZ3MgKGFuZCBtYXNrcyBmb3IgdGhvc2UgdGFncykgb24gZXhpc3RpbmcgYm90IHRoYXQgYXJlIG5vdCBpbiB1cGRhdGUgc3RhdGUuCiAgICAgICAgY29uc3QgYm90VGFncyA9IE9iamVjdC5rZXlzKGJvdC50YWdzKTsKCiAgICAgICAgZm9yIChjb25zdCBib3RUYWdOYW1lIG9mIGJvdFRhZ3MpIHsKICAgICAgICAgICAgaWYgKGJvdFN0YXRlLnRhZ3NbYm90VGFnTmFtZV0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGRyeVJ1bikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZHJ5IHJ1bjogd291bGQgZGVsZXRlIHRhZyAnJHtib3RUYWdOYW1lfScgb24gYm90ICR7Ym90SWR9LmApOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkZWxldGUgdGFnIChhbmQgbWFza3MpICcke2JvdFRhZ05hbWV9JyBvbiBib3QgJHtib3RJZH0uYCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYm90LnRhZ3NbYm90VGFnTmFtZV0gPSBudWxsOwogICAgICAgICAgICAgICAgLy8gQ2xlYXIgYWxsIHBvc3NpYmxlIG1hc2tzIGZvciB0aGlzIHRhZyBhcyB3ZWxsLgogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIGJvdFRhZ05hbWUsIG51bGwsICdsb2NhbCcpOwogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIGJvdFRhZ05hbWUsIG51bGwsICd0ZW1wTG9jYWwnKTsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYm90LCBib3RUYWdOYW1lLCBudWxsLCAnc2hhcmVkJyk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgYm90VGFnTmFtZSwgbnVsbCwgJ3RlbXBTaGFyZWQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNvdWxkIG5vdCBmaW5kIGJvdCAke2JvdElkfSBpbiBpbnN0LmApOwogICAgfQp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkb25lLmApOwp9Cgpjb25zdCBib3RJZHMgPSBPYmplY3Qua2V5cyhzdGF0ZSk7CgpyZXR1cm4gewogICAgZ3JvdXBUYWcsCiAgICBib3RJZHMsCiAgICBzb3VyY2VIYXNoLAp9OycA3I2lzwYADmFiTG9hZGVkU2tpbGxzAgQA3I2lzwbAhAK2AUBjb25zdCBsb2FkZWRTa2lsbHMgPSBuZXcgU2V0KCk7CgpnZXRCb3RzKChiKSA9PiB7CiAgICBpZiAoYi50YWdzLmFiTG9hZGVkU2tpbGwgIT0gbnVsbCkgewogICAgICAgIGxvYWRlZFNraWxscy5hZGQoYi50YWdzLmFiTG9hZGVkU2tpbGwpOwogICAgfQp9KTsKCnJldHVybiBBcnJheS5mcm9tKGxvYWRlZFNraWxscyk7JwDcjaXPBgAMb25SZW1vdGVEYXRhAgQA3I2lzwb3hQKnBUBpZiAodGhhdC5uYW1lID09PSAndXBkYXRlX2FiX3JlbG9hZF9wYWdlJykgewogICAgY29uc3QgeyByZWxvYWRQYWdlLCBkcnlSdW4gfSA9IHRoYXQudGhhdDsKCiAgICBpZiAodGhhdC5yZW1vdGVJZCA9PT0gY29uZmlnQm90LmlkKSB7CiAgICAgICAgLy8gV2FpdCBhIG1vbWVudCBiZWZvcmUgcmVsb2FkaW5nIHRoZSBwYWdlIGlmIHdlIGFyZSB0aGUgb25lcyB0aGF0IHNlbnQgb3V0IHRoZSBtZXNzYWdlLgogICAgICAgIGF3YWl0IG9zLnNsZWVwKDEwMDApOwogICAgfQoKICAgIGxldCBpc1VSTCA9IGZhbHNlOwoKICAgIGlmICh0eXBlb2YgcmVsb2FkUGFnZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBuZXcgVVJMKHJlbG9hZFBhZ2UpOwogICAgICAgICAgICBpc1VSTCA9IHRydWU7CiAgICAgICAgfSBjYXRjaCAoZSkge30KICAgIH0KCiAgICBsZXQgdXJsID0gaXNVUkwgPyByZWxvYWRQYWdlIDogY29uZmlnQm90LnRhZ3MudXJsOwoKICAgIGlmIChkcnlSdW4pIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRyeSBydW46IHdvdWxkIGdvIHRvIHVybGAsIHVybCk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgCiAgICBvcy5nb1RvVVJMKGlzVVJMID8gcmVsb2FkUGFnZSA6IGNvbmZpZ0JvdC50YWdzLnVybCk7Cn0nANyNpc8GAAlvbkVudGVyQVICBADcjaXPBp+LAhNAbWFza3MuaW5BUiA9IHRydWU7JwDcjaXPBgAIb25FeGl0QVICBADcjaXPBrOLAhNAbWFza3MuaW5BUiA9IG51bGw7JwDcjaXPBgAJb25FbnRlclZSAgQA3I2lzwbHiwITQG1hc2tzLmluVlIgPSB0cnVlOycA3I2lzwYACG9uRXhpdFZSAgQA3I2lzwbbiwITQG1hc2tzLmluVlIgPSBudWxsOycA3I2lzwYABmNyZWF0ZQIEANyNpc8G74sCKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnANyNpc8GAAVwYXN0ZQIEANyNpc8GlowCKPCflJdiMzM5YzExOC00ODlhLTQ2NmItYmE5Zi1iMDdhNWY5YjY2NGYnANyNpc8GAAhhcm1fdG9vbAIEANyNpc8GvYwCKPCflJczYzc0YzlmMS04MmRjLTQ2NTUtOGIzOC1lN2YxMWRlODk3OGUnANyNpc8GAANjdWUCBADcjaXPBuSMApEMQC8vdGhhdA0KLy9ib3Q/DQovL3Bvc2l0aW9uPw0KLy90ZXh0DQovL2RpbWVuc2lvbj8NCi8vc2NhbGU/DQovL2NvbG9yPw0KLy9zcGFjZT8NCi8vZm9udFNpemU/DQovL3dyYXBNb2RlPw0KDQpjb25zdCBjdXJyZW50RGltID0gdGhhdC5kaW1lbnNpb24gPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbiA/PyAnaG9tZSc7DQoNCmxldCBwb3NYOw0KbGV0IHBvc1k7DQpsZXQgcG9zWjsNCg0KDQoNCmlmICh0aGF0LmJvdCkgew0KICAgIHBvc1ggPSB0aGF0LmJvdC50YWdzW2N1cnJlbnREaW0gKyAnWCddOw0KICAgIHBvc1kgPSB0aGF0LmJvdC50YWdzW2N1cnJlbnREaW0gKyAnWSddOw0KICAgIHBvc1ogPSB0aGF0LmJvdC50YWdzW2N1cnJlbnREaW0gKyAnWiddID8/IDA7DQp9IGVsc2UgaWYgKHRoYXQucG9zaXRpb24pIHsNCiAgICBwb3NYID0gdGhhdC5wb3NpdGlvbi54Ow0KICAgIHBvc1kgPSB0aGF0LnBvc2l0aW9uLnk7DQogICAgcG9zWiA9IHRoYXQucG9zaXRpb24ueiA/PyAxOw0KfQ0KDQppZiAoKCFwb3NYICYmIHBvc1ggIT0gMCkgfHwgKCFwb3NZICYmIHBvc1kgIT0gMCkpIHsNCiAgICByZXR1cm47DQp9DQoNCmNvbnN0IGN1ZUJvdCA9IGF3YWl0IGNyZWF0ZSh7DQogICAgc3BhY2U6IHRoYXQuc3BhY2UgPz8gJ3RlbXBMb2NhbCcsDQogICAgbGFiZWw6IHRoYXQudGV4dCA/PyAnJywNCiAgICBsYWJlbENvbG9yOiB0aGF0LmNvbG9yID8/ICJ3aGl0ZSIsDQogICAgc2NhbGU6IHRoYXQuc2NhbGUgPz8gJy41JywNCiAgICBbY3VycmVudERpbV06IHRydWUsDQogICAgW2N1cnJlbnREaW0gKyAnWCddOiBwb3NYLA0KICAgIFtjdXJyZW50RGltICsgJ1knXTogcG9zWSwNCiAgICBbY3VycmVudERpbSArICdaJ106IHBvc1osDQogICAgY29sb3I6ICdjbGVhcicsDQogICAgbGFiZWxPcGFjaXR5OiAxLA0KICAgIGxhYmVsV29yZFdyYXBNb2RlOiB0aGF0LndyYXBNb2RlID8/ICdicmVha1dvcmRzJywNCiAgICBsYWJlbEZvbnRTaXplOiB0aGF0LmZvbnRTaXplID8/IHVuZGVmaW5lZCwNCiAgICBsYWJlbFBvc2l0aW9uOiAnZmxvYXRpbmdCaWxsYm9hcmQnLA0KICAgIGxhYmVsRmxvYXRpbmdCYWNrZ3JvdW5kQ29sb3I6ICdjbGVhcicsDQogICAgcG9pbnRhYmxlOiBmYWxzZSwNCiAgICBvbkJvdEFkZGVkOiBgQA0KICAgICAgICBhd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsIHsNCiAgICAgICAgICAgIGZyb21WYWx1ZTogew0KICAgICAgICAgICAgICAgIFsnJHtjdXJyZW50RGltfScgKyAnWiddOiAke3Bvc1p9LA0KICAgICAgICAgICAgICAgIGxhYmVsT3BhY2l0eTogMQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHRvVmFsdWU6IHsNCiAgICAgICAgICAgICAgICBbJyR7Y3VycmVudERpbX0nICsgJ1onXTogJHtwb3NafSArIDMsDQogICAgICAgICAgICAgICAgbGFiZWxPcGFjaXR5OiAwDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZHVyYXRpb246IDIsDQogICAgICAgICAgICB0YWdNYXNrU3BhY2U6IGZhbHNlDQogICAgICAgIH0pDQogICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7DQogICAgYA0KfSknANyNpc8GAAtvbkFueUNyZWF0ZQIEANyNpc8G9pgC8QRAY29uc3QgeyBib3QgfSA9IHRoYXQ7CgppZiAoYm90KSB7CiAgICAvLyBbUnlhbl0gSSdtIG5vdCBzdXJlIHdoeSB3ZSBuZWVkIHRvIGRvIHRoaXMsIGJ1dCB3aXRob3V0IGF3YWl0aW5nIGhlcmUgd2UgYXJlIHNlZWluZyBzdHJhbmdlCiAgICAvLyBhcnRpZmFjdHMgd2l0aCBuZXcgYm90cyBjcmVhdGVkIHZpYSBhYi4gTXVsdGlwbGUgbGluZXMgZ2V0IGRyYXduIGluc3RlYWQgb2YganVzdCBvbmUgdG8gdGhlIHNlbGVjdGVkIGJvdCBhbmQgdGhlIGFybQogICAgLy8gZG9lc250IGdldCB1cGRhdGVkIHByb3Blcmx5IHRvIGhpZGUuIEl0cyBhcyBpZiBib3QgdXBkYXRlcyBnZXQgbWVzc2VkIHVwIG9yIHBlcmhhcHMgbG9zdCB3aXRob3V0IHRoaXMgYXdhaXQuCiAgICBhd2FpdCBvcy5zbGVlcCgwKTsKICAgIAogICAgLy8gQXNzaWduIGEgY3JlYXRpb24gdGltZXN0YW1wIGZvciB0aGUgYm90LgogICAgbGV0IHRpbWVzdGFtcCA9IG9zLmFncmVlZFVwb25UaW1lOwoKICAgIGlmIChOdW1iZXIuaXNOYU4odGltZXN0YW1wKSkgewogICAgICAgIHRpbWVzdGFtcCA9IG9zLmxvY2FsVGltZTsKICAgIH0KCiAgICBzZXRUYWdNYXNrKGJvdCwgJ2FiQ3JlYXRlVGltZScsIHRpbWVzdGFtcCwgJ3NoYXJlZCcpOwp9JwDcjaXPBgAFc291bmQCBADcjaXPBuidAijwn5SXMTM2NzIyNTMtMjUzNi00MDg2LTk1Y2YtZWIxNmZmY2NlNGRkJwDcjaXPBgANYWJQcmltYXJ5SW5zdAIEANyNpc8Gj54CwQJAaWYgKGNvbmZpZ0JvdCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCk7CgogICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHVybC5zZWFyY2hQYXJhbXMpIHsKICAgICAgICAgICAgaWYgKGtleSA9PT0gJ2luc3QnIHx8IGtleSA9PT0gJ3N0YXRpY0luc3QnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGNhdGNoIHsKICAgICAgICAvLyBCYWQgdXJsLgogICAgICAgIHJldHVybiBudWxsOwogICAgfQp9CgpyZXR1cm4gbnVsbDsnANyNpc8GAAthYklzUHJpbWFyeQIEANyNpc8G0aACc0Bjb25zdCBjdXJJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKY29uc3QgcHJpbWFyeUluc3QgPSB0aGlzQm90LmFiUHJpbWFyeUluc3QoKTsKCnJldHVybiBjdXJJbnN0ID09PSBwcmltYXJ5SW5zdDsnANyNpc8GABBhYkJvb3RTdGF0dXNTaG93AgQA3I2lzwbFoQKMFUBjb25zdCB7CiAgICBsYWJlbCA9IGBib290aW5nIHVwYCwKfSA9IHRoYXQgPz8ge30KCmlmIChjb25maWdCb3QudGFncy5tZW51UG9ydGFsICE9PSAnYWJCb290U3RhdHVzJykgewogICAgY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCA9ICdhYkJvb3RTdGF0dXMnOwp9Cgpjb25zdCBhY3RpdmVCb290U3RhdHVzQm90ID0gdGhpc0JvdC52YXJzLmJvb3RTdGF0dXNCb3RJZCA/IGdldEJvdCgnaWQnLCB0aGlzQm90LnZhcnMuYm9vdFN0YXR1c0JvdElkKSA6IG51bGw7CgppZiAoYWN0aXZlQm9vdFN0YXR1c0JvdCkgewogICAgYWN0aXZlQm9vdFN0YXR1c0JvdC50YWdzLmJ1c3lMYWJlbCA9IGxhYmVsOwogICAgcmV0dXJuOwp9CgoKLy8gTk9URTogVGhlIHN0eWxpbmcgb2YgdGhpcyBtZW51Qm90IGlzIHRha2VuIGZyb20gYWIuaW50ZXJmYWNlLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uLCBhbmQgbXVjaCAKLy8gb2YgdGhlIGxvZ2ljIGlzIHRha2VuIGZyb21hYi5pbnRlcmZhY2UubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yLgpjb25zdCBzaGFkb3dDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU2hhZG93Q29sb3IgPz8gIiMwMDAiOwoKY29uc3QgYm9vdFN0YXR1c01vZCA9IHsKICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgIGFiQm9vdFN0YXR1czogdHJ1ZSwKICAgIGJ1c3lMYWJlbDogbGFiZWwsCiAgICBjb2xvcjogbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VNZW51Q29sb3IsCiAgICBsYWJlbENvbG9yOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZU1lbnVMYWJlbENvbG9yID8/ICcjMDAwJywKICAgIGxhYmVsQWxpZ25tZW50OiAnbGVmdCcsCiAgICBzaGFkb3dDb2xvcjogbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTaGFkb3dDb2xvciA/PyAiIzAwMCIsCiAgICB0cmFja051bTogMCwKICAgIHNjYWxlWTogMSwKICAgIHN0YXRlOiAwLAogICAgYW5pbVJhdGU6IDUwMCwKICAgIGFuaW1TdGF0ZXM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgXSwKICAgIG1lbnVJdGVtU3R5bGU6IHsKICAgICAgICAnYm9yZGVyLXJhZGl1cyc6ICc4cHgnLAogICAgICAgICdtYXJnaW4tdG9wJzogJzhweCcsCiAgICAgICAgJ2JveC1zaGFkb3cnOiBgM3B4IDRweCAke3NoYWRvd0NvbG9yfWAsCiAgICAgICAgJ21pbi1oZWlnaHQnOiAnNDRweCcsCiAgICAgICAgJ2JvcmRlcic6IGAycHggc29saWQgJHtzaGFkb3dDb2xvcn1gLAogICAgICAgICd3aWR0aCc6ICdjYWxjKDEwMCUgLSA1cHgpJwogICAgfSwKICAgIG9uQm90QWRkZWQ6IGBACiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIG9uQm90Q2hhbmdlZDogYEAKICAgICAgICBjb25zdCBuZWVkUmVmcmVzaCA9IHRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2J1c3lMYWJlbCcgfHwgdCA9PT0gJ3N0YXRlJyB8fCB0ID09PSAnYW5pbVN0YXRlcycpOwogICAgICAgIGlmIChuZWVkUmVmcmVzaCkgewogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfQogICAgYCwKICAgIHJlZnJlc2hEaXNwbGF5OiBgQAogICAgICAgIGlmICh0YWdzLmFuaW1TdGF0ZXMgJiYgdGFncy5hbmltU3RhdGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgYW5pbVN0YXRlID0gdGFncy5hbmltU3RhdGVzW3RhZ3Muc3RhdGVdOwoKICAgICAgICAgICAgdGFncy5sYWJlbCA9IHRhZ3MuYnVzeUxhYmVsLnRyaW0oKSArIGFuaW1TdGF0ZS5lbGxpcHNpczsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGFuaW1TdGF0ZS5mb3JtQWRkcmVzczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLmxhYmVsIAogICAgICAgIH0KICAgIGAsCiAgICBhbmltYXRlOiBgQAogICAgICAgIGlmICh0YWdzLnN0YXRlID49IHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgKz0gMTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLnNsZWVwKHRhZ3MuYW5pbVJhdGUpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIG9uRGVzdHJveTogYEAKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCA9PT0gJ2FiQm9vdFN0YXR1cycpIHsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCA9IG51bGw7CiAgICAgICAgfQogICAgYCwKfTsKCmNvbnN0IGJvb3RTdGF0dXNCb3QgPSBjcmVhdGUoYm9vdFN0YXR1c01vZCk7CnRoaXNCb3QudmFycy5ib290U3RhdHVzQm90SWQgPSBib290U3RhdHVzQm90LmlkOycA3I2lzwYAEWFiQm9vdFN0YXR1c0NsZWFyAgQA3I2lzwbStgJ6QGlmICh0aGlzQm90LnZhcnMuYm9vdFN0YXR1c0JvdElkKSB7CiAgICBkZXN0cm95KHRoaXNCb3QudmFycy5ib290U3RhdHVzQm90SWQpOwogICAgdGhpc0JvdC52YXJzLmJvb3RTdGF0dXNCb3RJZCA9IG51bGw7Cn0A"}]}