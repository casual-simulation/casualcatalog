{"version":2,"updates":[{"id":0,"timestamp":1759353028057,"update":"AVaax7TOCgAnAQRib3RzJDY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNwEnAJrHtM4KABJhYkNvcmVNYWpvclZlcnNpb24CBACax7TOCgECMTAnAJrHtM4KABJhYkNvcmVNaW5vclZlcnNpb24CBACax7TOCgQCMTEnAJrHtM4KAAZzeXN0ZW0CBACax7TOCgcNYWIuY29yZS5sZWFybicAmse0zgoABGFiSUQCBACax7TOChUFbGVhcm4nAJrHtM4KAARmb3JtAgQAmse0zgobB25vdGhpbmcnAJrHtM4KAAZhYkJvb3QCBACax7TOCiPDKEAvKioKKiBNSVQgTGljZW5zZQoqCiogQ29weXJpZ2h0IChjKSAyMDE5IENhc3VhbCBTaW11bGF0aW9uLCBJbmMuCioKKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Ciogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAoqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwoqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CioKKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwKKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoqCiogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRQoqIFNPRlRXQVJFLgoqIEBsaWNlbnNlIE1JVAoqLwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm9vdGluZyBhYmApOwp9CgovL2luc3QgbW9kZSAocGxheWVyIG9yIGJ1aWxkZXIpCmxldCBpbnN0TW9kZUNoZWNrID0gYXdhaXQgb3MudmVyc2lvbigpLnBsYXllck1vZGU7Ci8vY2hlY2sgc2VsZiBmb3IgaW5pdGlhbCBib290IGRhdGEKbGV0IGluaXRpYWxCb290ID0gbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA/IHRydWUgOiBmYWxzZTsKLy9jaGVjayB1cmwgZm9yIHBvc3NpYmxlIGFiJ3MgdG8gbG9hZApsZXQgYm9vdEZsYWcgPSBjb25maWdCb3QudGFncy5wYXR0ZXJuID8gY29uZmlnQm90LnRhZ3MucGF0dGVybiA6IGNvbmZpZ0JvdC50YWdzLmFiOwovL2NoZWNrIGZvciBhc2sKbGV0IGFzayA9IGNvbmZpZ0JvdC50YWdzLmFzazsKLy9sb2dpbgpsZXQgc3RhdHVzID0gYXdhaXQgdGhpc0JvdC5sb2FkaW5nU3RhdHVzKCk7Ci8vc2VlZCAobm90IGFjdGl2ZWx5IHVzZWQgaGVyZSkKbGV0IHNlZWQgPSBjb25maWdCb3QudGFncy5zZWVkOwovL3Byb21wdApsZXQgcHJvbXB0ID0gY29uZmlnQm90LnRhZ3MucHJvbXB0OwovL2NoYW5uZWwKbGV0IGNoYW5uZWwgPSBjb25maWdCb3QudGFncy5jaGFubmVsOwovL3ZlcnNpb24KbGV0IHZlcnNpb24gPSBjb25maWdCb3QudGFncy5wYXR0ZXJuVmVyc2lvbiA/PyBjb25maWdCb3QudGFncy5hYlZlcnNpb247Ci8vcmVxdWVzdCBhdXRoIGJvdAphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKLy9yZWRpcmVjdCBpZiBpbiBVUkwKaWYgKGNvbmZpZ0JvdC50YWdzLmpvaW5Db2RlKSB7CiAgICB0aGlzQm90LmFiSm9pbkhvc3QoeyB0ZXh0OiBjb25maWdCb3QudGFncy5qb2luQ29kZSB9KTsKfQoKLy9zdGF0dXMgY2xlYW4gdXAKZGVzdHJveShzdGF0dXMpOwoKLy9jaGVjayB0aW1lIGlmIG5lZWRlZAppZiAobGlua3MucmVtZW1iZXIudGFncy5hYkNvbmRpdGlvbikgewogICAgYXdhaXQgbGlua3MucmVtZW1iZXIuYWJDb25kaXRpb24oKTsKfQoKLy9pZiBubyBzdHVkaW8sIHNldCBzdHVkaW8KaWYgKGF1dGhCb3QgJiYgIWNvbmZpZ0JvdC50YWdzLnN0dWRpbykgewogICAgY29uZmlnQm90LnRhZ3Muc3R1ZGlvID0gYXV0aEJvdC5pZDsKfQoKaWYgKGF1dGhCb3QpIHsKICAgIHRoaXNCb3QuYWJMb2FkU3R1ZGlvcygpOwp9CgppZiAoIWxpbmtzLnBlcnNvbmFsaXR5KSB7IAogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYlBlcnNvbmFsaXR5Iik7Cn0KCi8vaW5pdGlhbGl6ZSByZW1lbWJlciBnbG9iYWxzCmdsb2JhbFRoaXMuYWJJbnN0TWVtb3J5ID0gbGlua3MucmVtZW1iZXI7Cmdsb2JhbFRoaXMuYWJSZW1lbWJlciA9IGxpbmtzLnJlbWVtYmVyOwpnbG9iYWxUaGlzLmFiUGVyc29uYWxpdHkgPSBsaW5rcy5wZXJzb25hbGl0eTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvcikgewogICAgZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3I7Cn0KCi8vVGhpcyBjaGVja3MgZm9yIHRoZSBhcHByb3ByaWF0ZSBhcnJheSBvZiBza2lsbHMgYW5kIGluaXRpYWxpemVzIHRoZW0KYXdhaXQgdGhpc0JvdC5hYlNraWxsSW5pdGlhbGl6YXRpb24oaW5zdE1vZGVDaGVjayk7CgovL2luaXRpYWxpemluZyBvZiBnbG9iYWwgdmFyaWFibGVzCmdsb2JhbFRoaXMuYnVpbGRlclZlcnNpb24gPSBpbnN0TW9kZUNoZWNrID09ICJidWlsZGVyIiA/IHRydWUgOiBmYWxzZTsKZ2xvYmFsVGhpcy5hYkxvbmdUZXJtTWVtb3J5U2VhcmNoID0gbGlua3Muc2VhcmNoOwpnbG9iYWxUaGlzLmFiU2VhcmNoID0gbGlua3Muc2VhcmNoOwpnbG9iYWxUaGlzLmFiUHVibGlzaCA9IGxpbmtzLnN0b3JlOwpnbG9iYWxUaGlzLmFiU3RvcmUgPSBsaW5rcy5zdG9yZTsKZ2xvYmFsVGhpcy5hYiA9IHRoaXNCb3Q7CgovL3BvcHVsYXRlIGJvb3RmbGFnIGFiCmlmIChpbml0aWFsQm9vdCAmJiBib290RmxhZykgewogICAgYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHsgYWJJRDogYm9vdEZsYWcsIGluaXRpYWxCb290OiB0cnVlLCBhdXRvSGF0Y2g6IHRydWUsIHNvdXJjZUV2ZW50OiAnYm9vdCcsIGFiVmVyc2lvbjogdmVyc2lvbn0pOwp9CgovL2xvb2t1cCBhc2tJRCBpZiBhdmFpbGFibGUKaWYgKGluaXRpYWxCb290ICYmIGFzaykgewogICAgaWYgKGFzayA9PSAiZWdnQ2FydG9uIiB8fCBhc2sgPT0gImNhc3VhbFR1dG9yaWFsIikgewogICAgICAgIGF3YWl0IHRoaXNCb3QuYWJBZGFwdChhc2spOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYkFjdGlvbiIpOwoKICAgICAgICBsaW5rcy5hc2suYWJDb3JlTWVudUFjdGlvbihhc2spOwogICAgfQp9CgovL2NoZWNrIGZvciBjaGFubmVsIGlmIGNoYW5uZWxzIGFsbG93ZWQKaWYgKGluaXRpYWxCb290ICYmIGNoYW5uZWwgJiYgbGlua3MucmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7CiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiQWN0aW9uIik7CgogICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IGNoYW5uZWwsIGlzQ2hhbm5lbDogdHJ1ZX0pOwp9CgovL2NoZWNrIGZvciBhcnRpZmFjdCBGSVgKaWYgKGNvbmZpZ0JvdC50YWdzLmFydGlmYWN0ICYmIGluaXRpYWxCb290ICYmICFhc2sgJiYgIWJvb3RGbGFnKSB7CiAgICBjb25zdCBhcnRpZmFjdCA9IGNvbmZpZ0JvdC50YWdzLmFydGlmYWN0OwogICAgY29uc3QgYXJ0SW5kZXggPSBhcnRpZmFjdC5pbmRleE9mKCJfYXJ0XyIpOwogICAgY29uc3Qgc3R1ZGlvID0gYXJ0aWZhY3Quc3Vic3RyaW5nKDAsIGFydEluZGV4KTsKICAgIGNvbnN0IHJlY29yZEFkZHJlc3MgPSBhcnRpZmFjdC5zdWJzdHJpbmcoYXJ0SW5kZXgpOwogICAgY29uc3QgcmVjb3JkRGF0YSA9IGF3YWl0IG9zLmdldERhdGEoc3R1ZGlvLCByZWNvcmRBZGRyZXNzKTsKICAgIGNvbnN0IGFza0lEID0gcmVjb3JkRGF0YS5kYXRhLnBhdHRlcm47CgogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYkFjdGlvbiIpOwoKICAgIGxpbmtzLmFzay5hYkNvcmVNZW51QWN0aW9uKGFza0lEKTsKfQoKLy8gQ2hlY2sgaWYgd2UgY2FuIHdha2UgdXAgYWIsIGFuZCB0aGVuIGRvIHNvLgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU2xlZXApIHsKICAgIGlmICgoaW5pdGlhbEJvb3QgJiYgIWJvb3RGbGFnICYmICFhc2spIHx8IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBbHdheXNTdGFydEF3YWtlIHx8IGNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICAgICAgYXdhaXQgbGlua3MubWFuaWZlc3RhdGlvbi5hYlNldEF3YWtlKHsgYXdha2U6IHRydWUsIGluaXRpYWw6IGluaXRpYWxCb290IH0pOwogICAgfQp9CgovL3NldCBpbml0aWFsIGJvb3QgZGF0YQppZiAoaW5pdGlhbEJvb3QpIHsKICAgIHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICdpbml0aWFsQm9vdCcsIGZhbHNlLCAnc2hhcmVkJyk7CgogICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsaXphdGlvbkNvbmZpZ3VyYXRpb24pIHsKICAgICAgICBsaW5rcy5yZW1lbWJlci5hYkluaXRpYWxpemF0aW9uQ29uZmlndXJhdGlvbigpOwogICAgfQp9CgovL2NsZWFuIHVwIFVSTCB3aXRoIHRhZ1BvcnRhbAppZiAoY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsICYmICFjb25maWdCb3QudGFncy50YWdQb3J0YWxBbmNob3JQb2ludCAmJiBidWlsZGVyVmVyc2lvbikgewogICAgY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsID0gbnVsbDsKICAgIGNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKfQoKLy9wYXVzZSBmb3IgYWIgbG9hZGluZwphd2FpdCBvcy5zbGVlcCg1MDApOwoKLy9pbml0aWFsaXplIHRpbWUgYm90CnRoaXNCb3QuYWJUaW1lcigpOwoKbGlua3MucGVyc29uYWxpdHkudXBkYXRlUGVyc29uYWxpdHkoKTsKCi8vaW5pdGlhbGl6YXRpb24gc2hvdXQKc3VwZXJTaG91dCgib25BQkluaXRpYWxpemVkIiwgdGFncy5hYkluc3QpOygAmse0zgoABmFiQ29yZQF4JwCax7TOCgAHYWJBZGFwdAIEAJrHtM4K6CjhEkBsZXQgc2tpbGxOYW1lOwpsZXQgc2tpbGxEYXRhOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKaWYgKHR5cGVvZiB0aGF0ID09PSAnc3RyaW5nJykgewogICAgc2tpbGxOYW1lID0gdGhhdDsKICAgIHNraWxsRGF0YSA9IG51bGw7Cn0gZWxzZSBpZiAodHlwZW9mIHRoYXQgPT09ICdvYmplY3QnKSB7CiAgICBza2lsbE5hbWUgPSB0aGF0LnN5c3RlbUlEID8/IHRoYXQuc2tpbGxOYW1lOwogICAgc2tpbGxEYXRhID0gdGhhdC5kYXRhID8/IG51bGw7Cn0KCmlmICghc2tpbGxOYW1lKSB7CiAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2tpbGxOYW1lIGlzIHJlcXVpcmVkLmApOwogICAgcmV0dXJuIGZhbHNlOwp9CgppZiAoc2tpbGxOYW1lID09PSAnYWJDb3JlJykgewogICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX19XSBhYkNvbmZpZyBjYW5ub3QgYmUgbG9hZGVkIHVzaW5nIGFiQWRhcHQuYCk7CiAgICByZXR1cm47Cn0KCnRyeSB7CiAgICBjb25zdCBsb2FkZWRTa2lsbHMgPSB0aGlzQm90LmFiTG9hZGVkU2tpbGxzKCk7CgogICAgaWYgKCFsb2FkZWRTa2lsbHMuaW5jbHVkZXMoc2tpbGxOYW1lKSkgewogICAgICAgIGNvbnN0IHVybCA9IHRoaXNCb3QuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwoYC9hYi8ke3NraWxsTmFtZX0uYXV4YCk7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB3ZWIuaG9vayh7IG1ldGhvZDogIkdFVCIsIHVybCB9KTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYiBza2lsbCBHRVQgcmVzcG9uc2U6YCwgcmVzcG9uc2UpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGRvd25sb2FkICR7c2tpbGxOYW1lfS4gUmVzcG9uc2U6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMikgewogICAgICAgICAgICAvLyBBVVggRm9ybWF0IFZlcnNpb24gMi4KICAgICAgICAgICAgY29uc3QgdXBkYXRlcyA9IHJlc3BvbnNlLmRhdGEudXBkYXRlczsKICAgICAgICAgICAgYXdhaXQgb3MuYXBwbHlVcGRhdGVzVG9JbnN0KHVwZGF0ZXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBBVVggZm9ybWF0IHZlcnNpb24gJHtyZXNwb25zZS5kYXRhLnZlcnNpb259IGlzIG5vdCBzdXBwb3J0ZWQuYCk7CiAgICAgICAgfQoKICAgICAgICAvLyBMb2FkZWQgc2tpbGxzIGFyZSBzdG9yZWQgYXMgc2hhcmVkIGJvdHMgdGhhdCBhbnlvbmUgaW4gdGhlIGluc3QgY2FuIHJlYWQuCiAgICAgICAgY3JlYXRlKHsKICAgICAgICAgICAgc3BhY2U6ICdzaGFyZWQnLAogICAgICAgICAgICBhYklnbm9yZTogdHJ1ZSwKICAgICAgICAgICAgYWJMb2FkZWRTa2lsbDogc2tpbGxOYW1lLAogICAgICAgICAgICBmb3JtOiAnbm90aGluZycsCiAgICAgICAgfSkKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYiBza2lsbCAke3NraWxsTmFtZX0gaXMgYWxyZWFkeSBsb2FkZWQuYCkKICAgICAgICB9CiAgICB9CgogICAgY29uc3Qgc2tpbGxCb3RzID0gZ2V0Qm90cyhiID0+IGIudGFnc1tza2lsbE5hbWVdID09PSB0cnVlKTsKICAgIGlmIChza2lsbEJvdHMgJiYgc2tpbGxCb3RzLmxlbmd0aCA+IDApIHsKICAgICAgICB3aGlzcGVyKHNraWxsQm90cywgdGFnTmFtZSwgY29uZmlnQm90LnRhZ3MuaW5zdCk7CiAgICAgICAgd2hpc3Blcihza2lsbEJvdHMsICJvblNraWxsVXBkYXRlIiwgeyBkYXRhOiBza2lsbERhdGEgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBObyBib3RzIGFwcGVhciB0byBoYXZlIGJlZW4gbG9hZGVkIHdpdGggJHtza2lsbE5hbWV9LmApOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcihlKTsKICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBGYWlsZWQgdG8gZG93bmxvYWQgJHtza2lsbE5hbWV9LiBTZWUgYWJvdmUgZXJyb3IuYCk7CiAgICByZXR1cm4gZmFsc2U7Cn0nAJrHtM4KAAtkZXNjcmlwdGlvbgIEAJrHtM4KyjtPVGhpcyBza2lsbCBpcyBkZXNpZ25lZCB0byBoYW5kbGUgYm90aCByZWNvbmZpZ3VyYXRpb24gb2YgYWIgYW5kIGluaXRpYWxpemF0aW9uLicAmse0zgoACm9uQm90QWRkZWQCBACax7TOCpo88QFAY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvcmUgU1RBUlQgVVBgKTsKCnRoaXNCb3QuYWJJbnN0VXBkYXRlKCk7CgppZiAoIWxpbmtzLnJlbWVtYmVyKSB7CiAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGZpbmQgYWJDb25maWcgcmVtZW1iZXIgYm90LmApOwp9CgpzZXRUaW1lb3V0KCgpID0+IHRoaXNCb3QuYWJCb290KCksIDUwMCk7JwCax7TOCgAIcmVtZW1iZXICBACax7TOCow+KPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJrHtM4KAANsb2cCBACax7TOCrM+bEAvL3Bhc3MgdGhyb3VnaCBsb2cgZGF0YQppZiAobGlua3MuY29uc29sZSkgewogICAgbGlua3MuY29uc29sZS5sb2codGhhdCk7Cn0KZWxzZSB7CiAgICBjb25zb2xlLmxvZyh0aGF0KTsKfScAmse0zgoADW1hbmlmZXN0YXRpb24CBACax7TOCqA/KPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAJrHtM4KAAxhYkNyZWF0ZUhvc3QCBACax7TOCsc/lgpAY29uc3Qgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CgovL3RoaXMgZnVuY3Rpb24gaGFuZGxlcyBjcmVhdGluZyBhIGZpbGUgZm9yIGpvaW4gY29kZXMKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKSB7CiAgICBvcy50b2FzdCgidXJsIGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP2pvaW5Db2RlPSIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMCwgMykgKyAiLSIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMykpOwoKICAgIHJldHVybjsKfQoKaWYgKCFhdXRoQm90KSB7CiAgICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwp9CgppZiAoIWF1dGhCb3QpIHsKICAgIG9zLnRvYXN0KCJwbGVhc2UgbG9nIGluIHRvIGdlbmVyYXRlIGEgam9pbiBjb2RlIik7CiAgICByZXR1cm47Cn0KCmNvbnN0IG5ld0hvc3RJRCA9IHV1aWQoKS5yZXBsYWNlQWxsKCItIiwgIiIpLnN1YnN0cmluZygwLCA2KTsKY29uc3QgZGF0ZSA9IERhdGVUaW1lLm5vdygpLnRvTWlsbGlzKCk7CmNvbnN0IHJlY29yZEtleSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXk7CmNvbnN0IHJlY29yZERhdGEgPSBhd2FpdCBvcy5yZWNvcmREYXRhKHJlY29yZEtleSwgbmV3SG9zdElELCB7IHVybDogY29uZmlnQm90LnRhZ3MudXJsLCBkYXRlOiBkYXRlLCBtYXJrZXJzOiBbInB1YmxpY1JlYWQiXSB9KTsKCmlmIChyZWNvcmREYXRhLnN1Y2Nlc3MpIHsKICAgIHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICdob3N0SUQnLCBuZXdIb3N0SUQuc3Vic3RyaW5nKDAsIDMpICsgIi0iICsgbmV3SG9zdElELnN1YnN0cmluZygzKSwgJ3NoYXJlZCcpOwoKICAgIGNvbnN0IGpvaW5VUkwgPSBzaXRlT3JpZ2luICsgIi8/am9pbkNvZGU9IiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEOwoKICAgIG9zLnNldENsaXBib2FyZChqb2luVVJMKTsKCiAgICB0aGF0LnRhZ3MubGFiZWwgPSAiam9pbiBjb2RlOiAiICsgbmV3SG9zdElELnN1YnN0cmluZygwLCAzKSArICItIiArIG5ld0hvc3RJRC5zdWJzdHJpbmcoMyk7CgogICAgb3Muc2hvd1FSQ29kZShqb2luVVJMKTsKCiAgICBvcy50b2FzdCgiaG9zdCBnZW5lcmF0ZWQsIHVybCBjb3BpZWQgdG8gY2xpcGJvYXJkOiAiICsgbmV3SG9zdElEKTsKfQplbHNlIHsKICAgIG9zLnRvYXN0KCJzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2FpbiIpOwoKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cn0nAJrHtM4KAAphYkpvaW5Ib3N0AgQAmse0zgreSe4GQC8vbG9naWMgZm9yIHVzaW5nIGEgam9pbiBjb2RlIChjaGVja3MgZm9yIGV4aXN0aW5nIGZpbGVzKQpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGV0IGdldFJlY29yZDsKCmlmICh0aGF0LmRhdGEpIHsKICAgIGdldFJlY29yZCA9IHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogdGhhdC5kYXRhIH07Cn0KZWxzZSB7CiAgICBjb25zdCBqb2luQ29kZSA9IHRoYXQudGV4dC5yZXBsYWNlQWxsKCItIiwgIiIpOwogICAgY29uc3QgcmVjb3JkS2V5ID0gbGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleTsKICAgIGNvbnNvbGUubG9nKCJKT0lOQ09ERSIsIGpvaW5Db2RlKQogICAgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShyZWNvcmRLZXksIGpvaW5Db2RlKTsKfQoKaWYgKGdldFJlY29yZC5zdWNjZXNzKSB7CiAgICBjb25zdCBkYXRlID0gRGF0ZVRpbWUubm93KCk7CiAgICBsZXQgY3JlYXRlRGF0ZSA9IERhdGVUaW1lLmZyb21NaWxsaXMoZ2V0UmVjb3JkLmRhdGEuZGF0ZSk7CiAgICBsZXQgZGlmZmVyZW5jZSA9IGRhdGUuZGlmZihjcmVhdGVEYXRlLCAiZGF5cyIpLnRvT2JqZWN0KCk7CgogICAgZGlmZmVyZW5jZSA9IE1hdGguZmxvb3IoZGlmZmVyZW5jZS5kYXlzKTsKCiAgICBpZiAoZGlmZmVyZW5jZSA8IDgpIHsKICAgICAgICBvcy50b2FzdCgiam9pbmluZyBob3N0IG5vdyIpOwoKICAgICAgICBvcy5nb1RvVVJMKGdldFJlY29yZC5kYXRhLnVybCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBvcy50b2FzdCgiam9pbiBjb2RlIG91dCBvZiBkYXRlLCBwbGVhc2UgZ2VuZXJhdGUgYSBuZXcgam9pbiBjb2RlIik7CiAgICB9Cn0KZWxzZSB7CiAgICBvcy50b2FzdCgiY29kZS9hYiBpbnZhbGlkLCBwbGVhc2UgdHJ5IGFnYWluIik7Cn0nAJrHtM4KAAZzZWFyY2gCBACax7TOCs1QKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAJrHtM4KAAhhYklnbm9yZQIEAJrHtM4K9FAEdHJ1ZScAmse0zgoABG1lbnUCBACax7TOCvlQKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAJrHtM4KABVhYlNraWxsSW5pdGlhbGl6YXRpb24CBACax7TOCqBRowJALy9GaW5kIHRoZSBhcHByb3ByaWF0ZSBhcnJheSBhbmQgcG9wdWxhdGUgc2tpbGxzCmxldCBza2lsbEFycmF5ID0gbGlua3MucmVtZW1iZXIudGFnc1t0aGF0ICsgIlNraWxsQXJyYXkiXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgc2tpbGxBcnJheS5sZW5ndGg7IGkrKykgewogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KHNraWxsQXJyYXlbaV0pOwp9CgppZiAoY29uZmlnQm90LnRhZ3MuZW1iZWQgPT09ICdpb3MnKSB7CiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoJ2FiSU9TQnJpZGdlJyk7Cn0KCnJldHVybjsnAJrHtM4KAAZiYW5uZXICBACax7TOCsRTKPCflJdiNTUyZWFmOS1hOWQ2LTQxYzgtODUxNS1jYmQyYWJlYWFlNzMnAJrHtM4KAAVpbnB1dAIEAJrHtM4K61Mo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcAmse0zgoADWxvYWRpbmdTdGF0dXMCBACax7TOCpJUxgdAY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJMb2FkU3RhdHVzIjsKCmxldCBzdGF0dXNCb3QgPSB7fTsKCnN0YXR1c0JvdC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpzdGF0dXNCb3QubGFiZWwgPSAidmVyaWZ5aW5nIGF1dGhCb3QiOwpzdGF0dXNCb3QubGFiZWxDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CnN0YXR1c0JvdC5hYkxvYWRTdGF0dXMgPSB0cnVlOwpzdGF0dXNCb3QubWVudUl0ZW1TdHlsZSA9IHsgImJhY2tncm91bmQiOiAibm9uZSIgfTsKc3RhdHVzQm90LnRyYWNrTnVtID0gMDsKc3RhdHVzQm90Lm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpIHsKICAgICAgICB0YWdzLnRyYWNrTnVtID0gMDsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHRhZ3MudHJhY2tOdW0rKzsKICAgIH0KCiAgICB0YWdzLmxhYmVsID0gdGFnc1sibGFiZWwiK3RhZ3MudHJhY2tOdW1dOwogICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3NbImZvcm0iK3RhZ3MudHJhY2tOdW1dOwoKICAgIHNldFRpbWVvdXQoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAib25DcmVhdGUiKSwgNTAwKTtgOwpzdGF0dXNCb3QubGFiZWwwID0gInZlcmlmeWluZyBhdXRoQm90LiI7CnN0YXR1c0JvdC5sYWJlbDEgPSAidmVyaWZ5aW5nIGF1dGhCb3QuLiI7CnN0YXR1c0JvdC5sYWJlbDIgPSAidmVyaWZ5aW5nIGF1dGhCb3QuLi4iOwpzdGF0dXNCb3QuZm9ybTAgPSAiaG91cmdsYXNzX2JvdHRvbSI7CnN0YXR1c0JvdC5mb3JtMSA9ICJob3VyZ2xhc3NfdG9wIjsKc3RhdHVzQm90LmZvcm0yID0gImhvdXJnbGFzc19ib3R0b20iOwpzdGF0dXNCb3Qub25EZXN0cm95ID0gYEAKICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKYDsKCmxldCBjcmVhdGVkU3RhdHVzQm90ID0gY3JlYXRlKHN0YXR1c0JvdCk7CgpyZXR1cm4gY3JlYXRlZFN0YXR1c0JvdDsnAJrHtM4KAANhc2sCBACax7TOCtlbKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAJrHtM4KAA1hYkxvYWRTdHVkaW9zAgQAmse0zgqAXFtAY29uc3QgdXNlclN0dWRpb3MgPSBhd2FpdCBvcy5saXN0VXNlclN0dWRpb3MoKTsKY29uZmlnQm90LnRhZ3MudXNlcl9zdHVkaW9zID0gdXNlclN0dWRpb3M7JwCax7TOCgAHYWJUaW1lcgIEAJrHtM4K3FzBBkBpZiAoZ2V0Qm90KCJhYlRpbWVyIiwgdHJ1ZSkpIHsKICAgIHJldHVybjsKfQoKaWYgKCF0YWdzLmFiWFApIHsKICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiWFAiLCAiMCIsICJsb2NhbCIpOwp9CgpsZXQgdGltZXJCb3QgPSB7fTsKCnRpbWVyQm90LnNwYWNlID0gInRlbXBMb2NhbCI7CnRpbWVyQm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwp0aW1lckJvdC5vbkNyZWF0ZSA9IGBACiAgICBtYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHRoaXNCb3Qub25UaW1lQ2hlY2soKSwgNjAwMDApOwpgOwp0aW1lckJvdC5hYlRpbWVyID0gdHJ1ZTsKdGltZXJCb3Qub25UaW1lQ2hlY2sgPSBgQAogICAgaWYgKHRhZ3Mubm90SWRsZSkgewogICAgICAgIHRhZ3Mubm90SWRsZSA9IGZhbHNlOwoKICAgICAgICAvL2NvbnNvbGUubG9nKCJYUCIsIGxpbmtzLm1hbmFnZXIudGFncy5hYlhQKTsKCiAgICAgICAgY29uc3QgdG90YWxYUCA9IGxpbmtzLm1hbmFnZXIudGFncy5hYlhQICsgMTsKCiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5tYW5hZ2VyLCAiYWJYUCIsIHRvdGFsWFAsICJsb2NhbCIpOwogICAgfQpgOwp0aW1lckJvdC5ub3RJZGxlID0gZmFsc2U7CnRpbWVyQm90Lm9uQW55QWN0aW9uID0gYEAKICAgIGlmICghdGFncy5ub3RJZGxlKSB7CiAgICAgICAgaWYgKHRoYXQuYWN0aW9uLmlkID09IGdyaWRQb3J0YWxCb3QuaWQpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLm5vdElkbGUgPSB0cnVlOwogICAgICAgIH0KICAgIH0KYDsKCmxldCBhYlRpbWVyID0gY3JlYXRlKHRpbWVyQm90KTsKCmdsb2JhbFRoaXMuYWJUaW1lciA9IGFiVGltZXI7JwCax7TOCgAFc3RvcmUCBACax7TOCp5jKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAJrHtM4KAAdjb25zb2xlAgQAmse0zgrFYyjwn5SXMjRiN2U2NmYtMGQ1Yi00MDY0LWJmNDgtYjU2MmI5ZTZlM2ViJwCax7TOCgAJYWJWZXJzaW9uAgQAmse0zgrsYwUxMC4xMScAmse0zgoADGFiTG9hZENvbmZpZwIEAJrHtM4K8mOaBkBjb25zdCB1cmwgPSBuZXcgVVJMKG9zLmdldEFCMUJvb3RzdHJhcFVSTCgpKTsKdXJsLnBhdGhuYW1lID0gdXJsLnBhdGhuYW1lLnJlcGxhY2UoJ2FiMS5hdXgnLCAnYWJDb25maWcuYXV4Jyk7Cgp0cnkgewogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB3ZWIuaG9vayh7IG1ldGhvZDogIkdFVCIsIHVybDogdXJsLmhyZWYgfSk7CgogICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgYWJDb25maWcuIFJlc3BvbnNlOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHVwZGF0ZXMgPSByZXNwb25zZS5kYXRhLnVwZGF0ZXM7CiAgICBhd2FpdCBvcy5hcHBseVVwZGF0ZXNUb0luc3QodXBkYXRlcyk7CgogICAgaWYgKGxpbmtzLnJlbWVtYmVyKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBMb2FkZWQgYWJDb25maWcgYXV4IGJ1dCBjb3VsZCBub3QgZmluZCByZW1lbWJlciBib3QuYCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9IGNhdGNoIChlKSB7CiAgICBjb25zb2xlLmVycm9yKGUpOwogICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIEZhaWxlZCB0byBkb3dubG9hZCBhYkNvbmZpZy4gU2VlIGFib3ZlIGVycm9yLmApOwogICAgcmV0dXJuIGZhbHNlOwp9JwCax7TOCgAXYWJCdWlsZENhc3VhbENhdGFsb2dVUkwCBACax7TOCo1q/wFAY29uc3QgcmVsYXRpdmVQYXRoID0gdGhhdDsKCmNvbnN0IHVybCA9IG5ldyBVUkwobGlua3MucmVtZW1iZXIudGFncy5jYXN1YWxDYXRhbG9nVVJMKTsKY29uc3QgZW52ID0gbGlua3MucmVtZW1iZXIudGFncy5jYXN1YWxDYXRhbG9nRW52OwoKdXJsLnBhdGhuYW1lID0gcmVsYXRpdmVQYXRoOwoKaWYgKGVudiAmJiBlbnYgIT09ICdwcm9kJykgewogICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ2VudicsIGVudik7Cn0KCnJldHVybiB1cmwuaHJlZjsnAJrHtM4KAAdjaGFubmVsAgQAmse0zgqNbCjwn5SXYTliNmFhMGQtYjM1Ny00ZGU2LTliZWYtODUzNDhhYjFkMGUwJwCax7TOCgALcGVyc29uYWxpdHkCBACax7TOCrRsKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAJrHtM4KAAxhYkluc3RVcGRhdGUCBACax7TOCttsogFALy8gVXBkYXRlIHRoZSBhYkluc3QgdGFnIHdoaWNoIHJlcHJlc2VudHMgdGhlIGluc3QgdGhhdCB0aGlzIGFiIGV4aXN0cyBpbi4KY29uc3QgY3VySW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CnNldFRhZ01hc2sodGhpc0JvdCwgJ2FiSW5zdCcsIGN1ckluc3QsICdzaGFyZWQnKTsnAJrHtM4KAAxvbkluc3RKb2luZWQCBACax7TOCv5tGEB0aGlzQm90LmFiSW5zdFVwZGF0ZSgpOycAmse0zgoAC29uSW5zdExlYXZlAgQAmse0zgqXbhhAdGhpc0JvdC5hYkluc3RVcGRhdGUoKTsnAJrHtM4KAAxyZXNlcnZlZEFza3MCBACax7TOCrBuDPCfp6xbImhvbWUiXScAmse0zgoACGFydGlmYWN0AgQAmse0zgq7bijwn5SXNzhlNDE1MDMtYzkzMy00ZjhhLTgxN2EtYmE5N2JmOGQ1ZDI3JwCax7TOCgALYm90X2ZhY3RvcnkCBACax7TOCuJuKPCflJdjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcnAJrHtM4KAAV1dGlscwIEAJrHtM4KiW8o8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAmse0zgoACHVwZGF0ZUFCAgQAmse0zgqwb+URQC8vIFtSeWFuXSBEbyBub3RoaW5nIGZvciBub3cgd2hpbGUgdGhpcyBpcyBzdGlsbCBpbiBkZXZlbG9wbWVudC4NCmNvbnNvbGUud2FybihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGN1cnJlbnRseSBkaXNhYmxlZCwgd29yayBpbiBwcm9ncmVzcy5gKQ0KcmV0dXJuOw0KDQpjb25zdCBhdXRvUmVmcmVzaCA9IHRoYXQ/LmF1dG9SZWZyZXNoID8/IHRydWU7DQoNCmNvbnN0IERSWV9SVU4gPSB0cnVlOw0KDQovLyBVcGRhdGUgYWJDb25maWcuDQpjb25zdCBhYkNvbmZpZ1VSTCA9IG9zLmdldEFCMUJvb3RzdHJhcFVSTCgpOw0KY29uc3QgYWJDb25maWdSZXNwb25zZSA9IGF3YWl0IHdlYmhvb2soeyBtZXRob2Q6ICJHRVQiLCB1cmw6IGFiQ29uZmlnVVJMIH0pOw0KDQphc3NlcnQoYWJDb25maWdSZXNwb25zZS5zdGF0dXMgPT09IDIwMCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgYWJDb25maWcuIFJlc3BvbnNlOiAke2FiQ29uZmlnUmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsNCmFzc2VydChhYkNvbmZpZ1Jlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvbmZpZyBtdXN0IGJlIGluIGF1eCBmaWxlIGZvcm1hdCB2Mi4gQWN0dWFsIGF1eCBmaWxlIGZvcm1hdCB2ZXJzaW9uOiAke2FiQ29uZmlnUmVzcG9uc2UuZGF0YS52ZXJzaW9ufWApOw0KDQphd2FpdCB0aGlzQm90LmF1eFYyT3ZlcndyaXRlKHsgYXV4OiBhYkNvbmZpZ1Jlc3BvbnNlLmRhdGEsIGdyb3VwVGFnOiAnYWJDb25maWcnLCBkcnlSdW46IERSWV9SVU4gfSk7DQoNCi8vIFVwZGF0ZSBhYiBza2lsbHMuDQpjb25zdCBsb2FkZWRTa2lsbHMgPSB0aGlzQm90LmFiTG9hZGVkU2tpbGxzKCk7DQoNCmZvciAobGV0IHNraWxsTmFtZSBvZiBsb2FkZWRTa2lsbHMpIHsNCiAgICBjb25zdCBza2lsbFVSTCA9IHRoaXNCb3QuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwoYC9hYi8ke3NraWxsTmFtZX0uYXV4YCk7DQogICAgY29uc3Qgc2tpbGxSZXNwb25zZSA9IGF3YWl0IHdlYmhvb2soeyBtZXRob2Q6ICJHRVQiLCB1cmw6IHNraWxsVVJMIH0pOw0KDQogICAgYXNzZXJ0KHNraWxsUmVzcG9uc2Uuc3RhdHVzID09PSAyMDAsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGRvd25sb2FkICR7c2tpbGxOYW1lfS4gUmVzcG9uc2U6ICR7c2tpbGxSZXNwb25zZS5zdGF0dXNUZXh0fWApOw0KICAgIGFzc2VydChza2lsbFJlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSAke3NraWxsTmFtZX0gbXVzdCBiZSBpbiBhdXggZmlsZSBmb3JtYXQgdjIuIEFjdHVhbCBhdXggZmlsZSBmb3JtYXQgdmVyc2lvbjogJHtza2lsbFJlc3BvbnNlLmRhdGEudmVyc2lvbn1gKTsNCiAgICANCiAgICBhd2FpdCB0aGlzQm90LmF1eFYyT3ZlcndyaXRlKHsgYXV4OiBza2lsbFJlc3BvbnNlLmRhdGEsIGdyb3VwVGFnOiBza2lsbE5hbWUsIGRyeVJ1bjogRFJZX1JVTiB9KTsNCn0NCg0KDQovLyBVcGRhdGUgYWJDb3JlIChkbyB0aGlzIG9uZSBsYXN0ISkNCmNvbnN0IGFiQ29yZVVSTCA9IHRoaXNCb3QuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwoJy9hYi9hYkNvcmUuYXV4Jyk7DQpjb25zdCBhYkNvcmVSZXNwb25zZSA9IGF3YWl0IHdlYi5ob29rKHsgbWV0aG9kOiAiR0VUIiwgdXJsOiBhYkNvcmVVUkwgfSk7DQoNCmFzc2VydChhYkNvcmVSZXNwb25zZS5zdGF0dXMgPT09IDIwMCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgYWJDb3JlLiBSZXNwb25zZTogJHthYkNvcmVSZXNwb25zZS5zdGF0dXNUZXh0fWApOw0KYXNzZXJ0KGFiQ29yZVJlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvcmUgbXVzdCBiZSBpbiBhdXggZmlsZSBmb3JtYXQgdjIuIEFjdHVhbCBhdXggZmlsZSBmb3JtYXQgdmVyc2lvbjogJHthYkNvcmVSZXNwb25zZS5kYXRhLnZlcnNpb259YCk7DQoNCmF3YWl0IHRoaXNCb3QuYXV4VjJPdmVyd3JpdGUoeyBhdXg6IGFiQ29yZVJlc3BvbnNlLmRhdGEsIGdyb3VwVGFnOiAnYWJDb3JlJywgZHJ5UnVuOiBEUllfUlVOIH0pOw0KDQoNCmlmIChhdXRvUmVmcmVzaCAmJiAhRFJZX1JVTikgew0KICAgIC8vIFRPRE86IHJlbW90ZSBzaG91dCB0byBhbGwgY3VycmVudGx5IGNvbm5lY3RlZCByZW1vdGVzIHRvIGFsc28gcmVmcmVzaC4NCiAgICBvcy5nb1RvVVJMKGNvbmZpZ0JvdC50YWdzLnVybCk7DQp9JwCax7TOCgAFZGVidWcCBACax7TOCpaBAQR0cnVlJwCax7TOCgAOYXV4VjJPdmVyd3JpdGUCBACax7TOCpuBAbwnQGNvbnN0IGF1eCA9IHRoYXQ/LmF1eDsKY29uc3QgZ3JvdXBUYWcgPSB0aGF0Py5ncm91cFRhZzsKY29uc3QgZHJ5UnVuID0gdGhhdD8uZHJ5UnVuID8/IGZhbHNlOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKYXNzZXJ0KGF1eD8udmVyc2lvbiA9PT0gMiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhdXggcGFyYW1ldGVyIGlzIHJlcXVpcmVkIHRvIGJlIGEgdjIgYXV4IGZpbGUuYCk7CmFzc2VydChncm91cFRhZyA9PSBudWxsIHx8IHR5cGVvZiBncm91cFRhZyA9PT0gJ3N0cmluZycsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZ3JvdXBUYWcgcGFyYW1ldGVyIGlmIHByb3ZpZGVkLCBtdXN0IGJlIGEgc3RyaW5nLmApOwoKY29uc3Qgc3RhdGUgPSBhd2FpdCBvcy5nZXRJbnN0U3RhdGVGcm9tVXBkYXRlcyhhdXgudXBkYXRlcyk7CmxldCBwcmV2R3JvdXBCb3RzID0gZ2V0Qm90cyhiID0+IGIudGFnc1tncm91cFRhZ10gPT09IHRydWUpOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc3RhdGU6YCwgc3RhdGUpOwogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBwcmV2R3JvdXBCb3RzOmAsIHByZXZHcm91cEJvdHMpOwp9CgovLyBTdGVwIDE6IEFwcGx5IHVwZGF0ZXMgZGlyZWN0bHkgdG8gdGhlIGluc3QgYXMtaXMuCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIFN0ZXAgMTogQXBwbHkgdXBkYXRlcyBkaXJlY3RseSB0byB0aGUgaW5zdCBhcy1pcy5gKTsKfQoKaWYgKCFkcnlSdW4pIHsKICAgIGF3YWl0IG9zLmFwcGx5VXBkYXRlc1RvSW5zdChhdXgudXBkYXRlcyk7Cn0gZWxzZSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRyeSBydW46IHdvdWxkIGFwcGx5IHVwZGF0ZXMgdG8gaW5zdC5gKQp9CgovLyBTdGVwIDI6IERlbGV0ZSBwcmV2aW91cyBncm91cCBib3RzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgdXBkYXRlIHN0YXRlLgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBTdGVwIDI6IERlbGV0ZSBwcmV2aW91cyBncm91cCBib3RzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgdXBkYXRlIHN0YXRlLmApOwp9Cgpmb3IgKGNvbnN0IHByZXZHcm91cEJvdCBvZiBwcmV2R3JvdXBCb3RzKSB7CiAgICBpZiAoc3RhdGVbcHJldkdyb3VwQm90LmlkXSA9PSBudWxsKSB7CiAgICAgICAgaWYgKGRyeVJ1bikgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRyeSBydW46IHdvdWxkIGRlbGV0ZSBib3QgJHtwcmV2R3JvdXBCb3QuaWR9IHByZXZpb3VzbHkgYmVsb25naW5nIHRvIGdyb3VwICR7Z3JvdXBUYWd9YCk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkZXN0cm95aW5nIHByZXZpb3VzIGdyb3VwIGJvdCAke3ByZXZHcm91cEJvdC5pZH0gdGhhdCBpcyBubyBsb25nZXIgaW4gdGhlIHVwZGF0ZSBzdGF0ZS5gKTsKICAgICAgICB9CgogICAgICAgIGRlc3Ryb3kocHJldkdyb3VwQm90KTsKICAgIH0KfQoKLy8gU3RlcCAzOiBGb3IgZWFjaCBib3QgaW4gdGhlIHVwZGF0ZSBzdGF0ZSwgY3JlYXRlLCB1cGRhdGUsIGFuZCBkZWxldGUgdGFncyBvbiB0aGUgZXhpc3RpbmcgYm90cyBpbiB0aGUgaW5zdC4KaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gU3RlcCAzOiBGb3IgZWFjaCBib3QgaW4gdGhlIHVwZGF0ZSBzdGF0ZSwgY3JlYXRlLCB1cGRhdGUsIGFuZCBkZWxldGUgdGFncyBvbiB0aGUgZXhpc3RpbmcgYm90cyBpbiB0aGUgaW5zdC5gKTsKfQoKZm9yIChjb25zdCBib3RJZCBpbiBzdGF0ZSkgewogICAgY29uc3QgYm90ID0gZ2V0Qm90KCdpZCcsIGJvdElkKTsKICAgIGNvbnN0IGJvdFN0YXRlID0gc3RhdGVbYm90SWRdOwoKICAgIGlmIChib3QpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGZvdW5kIGV4aXN0aW5nIGJvdCAke2JvdElkfWApOwogICAgICAgIH0KCiAgICAgICAgLy8gSGFuZGxlcyB0YWcgY3JlYXRlIC8gdXBkYXRlLgogICAgICAgIGZvciAoY29uc3Qgc3RhdGVUYWdOYW1lIGluIGJvdFN0YXRlLnRhZ3MpIHsKICAgICAgICAgICAgaWYgKGJvdC5yYXdbc3RhdGVUYWdOYW1lXSAhPSBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV0pIHsKICAgICAgICAgICAgICAgIGlmIChkcnlSdW4pIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRyeSBydW46IHdvdWxkIHNldCB0YWcgJyR7c3RhdGVUYWdOYW1lfScgb24gYm90ICR7Ym90SWR9IHRvIHZhbHVlOmAsIGJvdFN0YXRlLnRhZ3Nbc3RhdGVUYWdOYW1lXSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNldCB0YWcgJyR7c3RhdGVUYWdOYW1lfScgb24gYm90ICR7Ym90SWR9IHRvOmAsIGJvdFN0YXRlLnRhZ3Nbc3RhdGVUYWdOYW1lXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYm90LnRhZ3Nbc3RhdGVUYWdOYW1lXSA9IGJvdFN0YXRlLnRhZ3Nbc3RhdGVUYWdOYW1lXTsKCiAgICAgICAgICAgICAgICBpZiAoYm90U3RhdGUudGFnc1tzdGF0ZVRhZ05hbWVdID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRhZyAnJHtzdGF0ZVRhZ05hbWV9JyBmb3IgYm90ICR7Ym90SWR9IGlzIG51bGwsIGNsZWFyaW5nIGFueSB0YWcgbWFza3MgYXMgd2VsbC5gKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIENsZWFyIGFsbCBwb3NzaWJsZSBtYXNrcyBmb3IgdGhpcyB0YWcgYXMgd2VsbC4KICAgICAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgc3RhdGVUYWdOYW1lLCBudWxsLCAnbG9jYWwnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgc3RhdGVUYWdOYW1lLCBudWxsLCAndGVtcExvY2FsJyk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIHN0YXRlVGFnTmFtZSwgbnVsbCwgJ3NoYXJlZCcpOwogICAgICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYm90LCBzdGF0ZVRhZ05hbWUsIG51bGwsICd0ZW1wU2hhcmVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGFnICcke3N0YXRlVGFnTmFtZX0nIGZvciBib3QgJHtib3RJZH0gaXMgYWxyZWFkeSB1cC10by1kYXRlLmApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBEZWxldGUgdGFncyAoYW5kIG1hc2tzIGZvciB0aG9zZSB0YWdzKSBvbiBleGlzdGluZyBib3QgdGhhdCBhcmUgbm90IGluIHVwZGF0ZSBzdGF0ZS4KICAgICAgICBjb25zdCBib3RUYWdzID0gT2JqZWN0LmtleXMoYm90LnRhZ3MpOwoKICAgICAgICBmb3IgKGNvbnN0IGJvdFRhZ05hbWUgb2YgYm90VGFncykgewogICAgICAgICAgICBpZiAoYm90U3RhdGUudGFnc1tib3RUYWdOYW1lXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZHJ5UnVuKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBkZWxldGUgdGFnICcke2JvdFRhZ05hbWV9JyBvbiBib3QgJHtib3RJZH0uYCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRlbGV0ZSB0YWcgKGFuZCBtYXNrcykgJyR7Ym90VGFnTmFtZX0nIG9uIGJvdCAke2JvdElkfS5gKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBib3QudGFnc1tib3RUYWdOYW1lXSA9IG51bGw7CiAgICAgICAgICAgICAgICAvLyBDbGVhciBhbGwgcG9zc2libGUgbWFza3MgZm9yIHRoaXMgdGFnIGFzIHdlbGwuCiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgYm90VGFnTmFtZSwgbnVsbCwgJ2xvY2FsJyk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgYm90VGFnTmFtZSwgbnVsbCwgJ3RlbXBMb2NhbCcpOwogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIGJvdFRhZ05hbWUsIG51bGwsICdzaGFyZWQnKTsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYm90LCBib3RUYWdOYW1lLCBudWxsLCAndGVtcFNoYXJlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY291bGQgbm90IGZpbmQgYm90ICR7Ym90SWR9IGluIGluc3QuYCk7CiAgICB9Cn0KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRvbmUuYCk7Cn0KCmNvbnN0IGJvdElkcyA9IE9iamVjdC5rZXlzKHN0YXRlKTsKCnJldHVybiBib3RJZHM7JwCax7TOCgAOYWJMb2FkZWRTa2lsbHMCBACax7TOCtioAbYBQGNvbnN0IGxvYWRlZFNraWxscyA9IG5ldyBTZXQoKTsKCmdldEJvdHMoKGIpID0+IHsKICAgIGlmIChiLnRhZ3MuYWJMb2FkZWRTa2lsbCAhPSBudWxsKSB7CiAgICAgICAgbG9hZGVkU2tpbGxzLmFkZChiLnRhZ3MuYWJMb2FkZWRTa2lsbCk7CiAgICB9Cn0pOwoKcmV0dXJuIEFycmF5LmZyb20obG9hZGVkU2tpbGxzKTsA"}]}