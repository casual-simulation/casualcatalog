{"version":2,"updates":[{"id":0,"timestamp":1759422048790,"update":"AWC11oi2AQAnAQRib3RzJDY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNwEnALXWiLYBABJhYkNvcmVNYWpvclZlcnNpb24CBAC11oi2AQECMTAnALXWiLYBABJhYkNvcmVNaW5vclZlcnNpb24CBAC11oi2AQQCMTQnALXWiLYBAAZzeXN0ZW0CBAC11oi2AQcNYWIuY29yZS5sZWFybicAtdaItgEABGFiSUQCBAC11oi2ARUFbGVhcm4nALXWiLYBAARmb3JtAgQAtdaItgEbB25vdGhpbmcnALXWiLYBAAZhYkJvb3QCBAC11oi2ASPDKEAvKioKKiBNSVQgTGljZW5zZQoqCiogQ29weXJpZ2h0IChjKSAyMDE5IENhc3VhbCBTaW11bGF0aW9uLCBJbmMuCioKKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Ciogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAoqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwoqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CioKKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwKKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoqCiogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRQoqIFNPRlRXQVJFLgoqIEBsaWNlbnNlIE1JVAoqLwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm9vdGluZyBhYmApOwp9CgovL2luc3QgbW9kZSAocGxheWVyIG9yIGJ1aWxkZXIpCmxldCBpbnN0TW9kZUNoZWNrID0gYXdhaXQgb3MudmVyc2lvbigpLnBsYXllck1vZGU7Ci8vY2hlY2sgc2VsZiBmb3IgaW5pdGlhbCBib290IGRhdGEKbGV0IGluaXRpYWxCb290ID0gbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA/IHRydWUgOiBmYWxzZTsKLy9jaGVjayB1cmwgZm9yIHBvc3NpYmxlIGFiJ3MgdG8gbG9hZApsZXQgYm9vdEZsYWcgPSBjb25maWdCb3QudGFncy5wYXR0ZXJuID8gY29uZmlnQm90LnRhZ3MucGF0dGVybiA6IGNvbmZpZ0JvdC50YWdzLmFiOwovL2NoZWNrIGZvciBhc2sKbGV0IGFzayA9IGNvbmZpZ0JvdC50YWdzLmFzazsKLy9sb2dpbgpsZXQgc3RhdHVzID0gYXdhaXQgdGhpc0JvdC5sb2FkaW5nU3RhdHVzKCk7Ci8vc2VlZCAobm90IGFjdGl2ZWx5IHVzZWQgaGVyZSkKbGV0IHNlZWQgPSBjb25maWdCb3QudGFncy5zZWVkOwovL3Byb21wdApsZXQgcHJvbXB0ID0gY29uZmlnQm90LnRhZ3MucHJvbXB0OwovL2NoYW5uZWwKbGV0IGNoYW5uZWwgPSBjb25maWdCb3QudGFncy5jaGFubmVsOwovL3ZlcnNpb24KbGV0IHZlcnNpb24gPSBjb25maWdCb3QudGFncy5wYXR0ZXJuVmVyc2lvbiA/PyBjb25maWdCb3QudGFncy5hYlZlcnNpb247Ci8vcmVxdWVzdCBhdXRoIGJvdAphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKLy9yZWRpcmVjdCBpZiBpbiBVUkwKaWYgKGNvbmZpZ0JvdC50YWdzLmpvaW5Db2RlKSB7CiAgICB0aGlzQm90LmFiSm9pbkhvc3QoeyB0ZXh0OiBjb25maWdCb3QudGFncy5qb2luQ29kZSB9KTsKfQoKLy9zdGF0dXMgY2xlYW4gdXAKZGVzdHJveShzdGF0dXMpOwoKLy9jaGVjayB0aW1lIGlmIG5lZWRlZAppZiAobGlua3MucmVtZW1iZXIudGFncy5hYkNvbmRpdGlvbikgewogICAgYXdhaXQgbGlua3MucmVtZW1iZXIuYWJDb25kaXRpb24oKTsKfQoKLy9pZiBubyBzdHVkaW8sIHNldCBzdHVkaW8KaWYgKGF1dGhCb3QgJiYgIWNvbmZpZ0JvdC50YWdzLnN0dWRpbykgewogICAgY29uZmlnQm90LnRhZ3Muc3R1ZGlvID0gYXV0aEJvdC5pZDsKfQoKaWYgKGF1dGhCb3QpIHsKICAgIHRoaXNCb3QuYWJMb2FkU3R1ZGlvcygpOwp9CgppZiAoIWxpbmtzLnBlcnNvbmFsaXR5KSB7IAogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYlBlcnNvbmFsaXR5Iik7Cn0KCi8vaW5pdGlhbGl6ZSByZW1lbWJlciBnbG9iYWxzCmdsb2JhbFRoaXMuYWJJbnN0TWVtb3J5ID0gbGlua3MucmVtZW1iZXI7Cmdsb2JhbFRoaXMuYWJSZW1lbWJlciA9IGxpbmtzLnJlbWVtYmVyOwpnbG9iYWxUaGlzLmFiUGVyc29uYWxpdHkgPSBsaW5rcy5wZXJzb25hbGl0eTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvcikgewogICAgZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3I7Cn0KCi8vVGhpcyBjaGVja3MgZm9yIHRoZSBhcHByb3ByaWF0ZSBhcnJheSBvZiBza2lsbHMgYW5kIGluaXRpYWxpemVzIHRoZW0KYXdhaXQgdGhpc0JvdC5hYlNraWxsSW5pdGlhbGl6YXRpb24oaW5zdE1vZGVDaGVjayk7CgovL2luaXRpYWxpemluZyBvZiBnbG9iYWwgdmFyaWFibGVzCmdsb2JhbFRoaXMuYnVpbGRlclZlcnNpb24gPSBpbnN0TW9kZUNoZWNrID09ICJidWlsZGVyIiA/IHRydWUgOiBmYWxzZTsKZ2xvYmFsVGhpcy5hYkxvbmdUZXJtTWVtb3J5U2VhcmNoID0gbGlua3Muc2VhcmNoOwpnbG9iYWxUaGlzLmFiU2VhcmNoID0gbGlua3Muc2VhcmNoOwpnbG9iYWxUaGlzLmFiUHVibGlzaCA9IGxpbmtzLnN0b3JlOwpnbG9iYWxUaGlzLmFiU3RvcmUgPSBsaW5rcy5zdG9yZTsKZ2xvYmFsVGhpcy5hYiA9IHRoaXNCb3Q7CgovL3BvcHVsYXRlIGJvb3RmbGFnIGFiCmlmIChpbml0aWFsQm9vdCAmJiBib290RmxhZykgewogICAgYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHsgYWJJRDogYm9vdEZsYWcsIGluaXRpYWxCb290OiB0cnVlLCBhdXRvSGF0Y2g6IHRydWUsIHNvdXJjZUV2ZW50OiAnYm9vdCcsIGFiVmVyc2lvbjogdmVyc2lvbn0pOwp9CgovL2xvb2t1cCBhc2tJRCBpZiBhdmFpbGFibGUKaWYgKGluaXRpYWxCb290ICYmIGFzaykgewogICAgaWYgKGFzayA9PSAiZWdnQ2FydG9uIiB8fCBhc2sgPT0gImNhc3VhbFR1dG9yaWFsIikgewogICAgICAgIGF3YWl0IHRoaXNCb3QuYWJBZGFwdChhc2spOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYkFjdGlvbiIpOwoKICAgICAgICBsaW5rcy5hc2suYWJDb3JlTWVudUFjdGlvbihhc2spOwogICAgfQp9CgovL2NoZWNrIGZvciBjaGFubmVsIGlmIGNoYW5uZWxzIGFsbG93ZWQKaWYgKGluaXRpYWxCb290ICYmIGNoYW5uZWwgJiYgbGlua3MucmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7CiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiQWN0aW9uIik7CgogICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IGNoYW5uZWwsIGlzQ2hhbm5lbDogdHJ1ZX0pOwp9CgovL2NoZWNrIGZvciBhcnRpZmFjdCBGSVgKaWYgKGNvbmZpZ0JvdC50YWdzLmFydGlmYWN0ICYmIGluaXRpYWxCb290ICYmICFhc2sgJiYgIWJvb3RGbGFnKSB7CiAgICBjb25zdCBhcnRpZmFjdCA9IGNvbmZpZ0JvdC50YWdzLmFydGlmYWN0OwogICAgY29uc3QgYXJ0SW5kZXggPSBhcnRpZmFjdC5pbmRleE9mKCJfYXJ0XyIpOwogICAgY29uc3Qgc3R1ZGlvID0gYXJ0aWZhY3Quc3Vic3RyaW5nKDAsIGFydEluZGV4KTsKICAgIGNvbnN0IHJlY29yZEFkZHJlc3MgPSBhcnRpZmFjdC5zdWJzdHJpbmcoYXJ0SW5kZXgpOwogICAgY29uc3QgcmVjb3JkRGF0YSA9IGF3YWl0IG9zLmdldERhdGEoc3R1ZGlvLCByZWNvcmRBZGRyZXNzKTsKICAgIGNvbnN0IGFza0lEID0gcmVjb3JkRGF0YS5kYXRhLnBhdHRlcm47CgogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYkFjdGlvbiIpOwoKICAgIGxpbmtzLmFzay5hYkNvcmVNZW51QWN0aW9uKGFza0lEKTsKfQoKLy8gQ2hlY2sgaWYgd2UgY2FuIHdha2UgdXAgYWIsIGFuZCB0aGVuIGRvIHNvLgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU2xlZXApIHsKICAgIGlmICgoaW5pdGlhbEJvb3QgJiYgIWJvb3RGbGFnICYmICFhc2spIHx8IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBbHdheXNTdGFydEF3YWtlIHx8IGNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICAgICAgYXdhaXQgbGlua3MubWFuaWZlc3RhdGlvbi5hYlNldEF3YWtlKHsgYXdha2U6IHRydWUsIGluaXRpYWw6IGluaXRpYWxCb290IH0pOwogICAgfQp9CgovL3NldCBpbml0aWFsIGJvb3QgZGF0YQppZiAoaW5pdGlhbEJvb3QpIHsKICAgIHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICdpbml0aWFsQm9vdCcsIGZhbHNlLCAnc2hhcmVkJyk7CgogICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsaXphdGlvbkNvbmZpZ3VyYXRpb24pIHsKICAgICAgICBsaW5rcy5yZW1lbWJlci5hYkluaXRpYWxpemF0aW9uQ29uZmlndXJhdGlvbigpOwogICAgfQp9CgovL2NsZWFuIHVwIFVSTCB3aXRoIHRhZ1BvcnRhbAppZiAoY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsICYmICFjb25maWdCb3QudGFncy50YWdQb3J0YWxBbmNob3JQb2ludCAmJiBidWlsZGVyVmVyc2lvbikgewogICAgY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsID0gbnVsbDsKICAgIGNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKfQoKLy9wYXVzZSBmb3IgYWIgbG9hZGluZwphd2FpdCBvcy5zbGVlcCg1MDApOwoKLy9pbml0aWFsaXplIHRpbWUgYm90CnRoaXNCb3QuYWJUaW1lcigpOwoKbGlua3MucGVyc29uYWxpdHkudXBkYXRlUGVyc29uYWxpdHkoKTsKCi8vaW5pdGlhbGl6YXRpb24gc2hvdXQKc3VwZXJTaG91dCgib25BQkluaXRpYWxpemVkIiwgdGFncy5hYkluc3QpOygAtdaItgEABmFiQ29yZQF4JwC11oi2AQAHYWJBZGFwdAIEALXWiLYB6CjhEkBsZXQgc2tpbGxOYW1lOwpsZXQgc2tpbGxEYXRhOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKaWYgKHR5cGVvZiB0aGF0ID09PSAnc3RyaW5nJykgewogICAgc2tpbGxOYW1lID0gdGhhdDsKICAgIHNraWxsRGF0YSA9IG51bGw7Cn0gZWxzZSBpZiAodHlwZW9mIHRoYXQgPT09ICdvYmplY3QnKSB7CiAgICBza2lsbE5hbWUgPSB0aGF0LnN5c3RlbUlEID8/IHRoYXQuc2tpbGxOYW1lOwogICAgc2tpbGxEYXRhID0gdGhhdC5kYXRhID8/IG51bGw7Cn0KCmlmICghc2tpbGxOYW1lKSB7CiAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2tpbGxOYW1lIGlzIHJlcXVpcmVkLmApOwogICAgcmV0dXJuIGZhbHNlOwp9CgppZiAoc2tpbGxOYW1lID09PSAnYWJDb3JlJykgewogICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX19XSBhYkNvbmZpZyBjYW5ub3QgYmUgbG9hZGVkIHVzaW5nIGFiQWRhcHQuYCk7CiAgICByZXR1cm47Cn0KCnRyeSB7CiAgICBjb25zdCBsb2FkZWRTa2lsbHMgPSB0aGlzQm90LmFiTG9hZGVkU2tpbGxzKCk7CgogICAgaWYgKCFsb2FkZWRTa2lsbHMuaW5jbHVkZXMoc2tpbGxOYW1lKSkgewogICAgICAgIGNvbnN0IHVybCA9IHRoaXNCb3QuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwoYC9hYi8ke3NraWxsTmFtZX0uYXV4YCk7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB3ZWIuaG9vayh7IG1ldGhvZDogIkdFVCIsIHVybCB9KTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYiBza2lsbCBHRVQgcmVzcG9uc2U6YCwgcmVzcG9uc2UpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGRvd25sb2FkICR7c2tpbGxOYW1lfS4gUmVzcG9uc2U6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMikgewogICAgICAgICAgICAvLyBBVVggRm9ybWF0IFZlcnNpb24gMi4KICAgICAgICAgICAgY29uc3QgdXBkYXRlcyA9IHJlc3BvbnNlLmRhdGEudXBkYXRlczsKICAgICAgICAgICAgYXdhaXQgb3MuYXBwbHlVcGRhdGVzVG9JbnN0KHVwZGF0ZXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBBVVggZm9ybWF0IHZlcnNpb24gJHtyZXNwb25zZS5kYXRhLnZlcnNpb259IGlzIG5vdCBzdXBwb3J0ZWQuYCk7CiAgICAgICAgfQoKICAgICAgICAvLyBMb2FkZWQgc2tpbGxzIGFyZSBzdG9yZWQgYXMgc2hhcmVkIGJvdHMgdGhhdCBhbnlvbmUgaW4gdGhlIGluc3QgY2FuIHJlYWQuCiAgICAgICAgY3JlYXRlKHsKICAgICAgICAgICAgc3BhY2U6ICdzaGFyZWQnLAogICAgICAgICAgICBhYklnbm9yZTogdHJ1ZSwKICAgICAgICAgICAgYWJMb2FkZWRTa2lsbDogc2tpbGxOYW1lLAogICAgICAgICAgICBmb3JtOiAnbm90aGluZycsCiAgICAgICAgfSkKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYiBza2lsbCAke3NraWxsTmFtZX0gaXMgYWxyZWFkeSBsb2FkZWQuYCkKICAgICAgICB9CiAgICB9CgogICAgY29uc3Qgc2tpbGxCb3RzID0gZ2V0Qm90cyhiID0+IGIudGFnc1tza2lsbE5hbWVdID09PSB0cnVlKTsKICAgIGlmIChza2lsbEJvdHMgJiYgc2tpbGxCb3RzLmxlbmd0aCA+IDApIHsKICAgICAgICB3aGlzcGVyKHNraWxsQm90cywgdGFnTmFtZSwgY29uZmlnQm90LnRhZ3MuaW5zdCk7CiAgICAgICAgd2hpc3Blcihza2lsbEJvdHMsICJvblNraWxsVXBkYXRlIiwgeyBkYXRhOiBza2lsbERhdGEgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBObyBib3RzIGFwcGVhciB0byBoYXZlIGJlZW4gbG9hZGVkIHdpdGggJHtza2lsbE5hbWV9LmApOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcihlKTsKICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBGYWlsZWQgdG8gZG93bmxvYWQgJHtza2lsbE5hbWV9LiBTZWUgYWJvdmUgZXJyb3IuYCk7CiAgICByZXR1cm4gZmFsc2U7Cn0nALXWiLYBAAtkZXNjcmlwdGlvbgIEALXWiLYByjtPVGhpcyBza2lsbCBpcyBkZXNpZ25lZCB0byBoYW5kbGUgYm90aCByZWNvbmZpZ3VyYXRpb24gb2YgYWIgYW5kIGluaXRpYWxpemF0aW9uLicAtdaItgEACm9uQm90QWRkZWQCBAC11oi2AZo88QFAY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvcmUgU1RBUlQgVVBgKTsKCnRoaXNCb3QuYWJJbnN0VXBkYXRlKCk7CgppZiAoIWxpbmtzLnJlbWVtYmVyKSB7CiAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGZpbmQgYWJDb25maWcgcmVtZW1iZXIgYm90LmApOwp9CgpzZXRUaW1lb3V0KCgpID0+IHRoaXNCb3QuYWJCb290KCksIDUwMCk7JwC11oi2AQAIcmVtZW1iZXICBAC11oi2AYw+KPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnALXWiLYBAANsb2cCBAC11oi2AbM+bEAvL3Bhc3MgdGhyb3VnaCBsb2cgZGF0YQppZiAobGlua3MuY29uc29sZSkgewogICAgbGlua3MuY29uc29sZS5sb2codGhhdCk7Cn0KZWxzZSB7CiAgICBjb25zb2xlLmxvZyh0aGF0KTsKfScAtdaItgEADW1hbmlmZXN0YXRpb24CBAC11oi2AaA/KPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnALXWiLYBAAxhYkNyZWF0ZUhvc3QCBAC11oi2Acc/lgpAY29uc3Qgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CgovL3RoaXMgZnVuY3Rpb24gaGFuZGxlcyBjcmVhdGluZyBhIGZpbGUgZm9yIGpvaW4gY29kZXMKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKSB7CiAgICBvcy50b2FzdCgidXJsIGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP2pvaW5Db2RlPSIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMCwgMykgKyAiLSIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMykpOwoKICAgIHJldHVybjsKfQoKaWYgKCFhdXRoQm90KSB7CiAgICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwp9CgppZiAoIWF1dGhCb3QpIHsKICAgIG9zLnRvYXN0KCJwbGVhc2UgbG9nIGluIHRvIGdlbmVyYXRlIGEgam9pbiBjb2RlIik7CiAgICByZXR1cm47Cn0KCmNvbnN0IG5ld0hvc3RJRCA9IHV1aWQoKS5yZXBsYWNlQWxsKCItIiwgIiIpLnN1YnN0cmluZygwLCA2KTsKY29uc3QgZGF0ZSA9IERhdGVUaW1lLm5vdygpLnRvTWlsbGlzKCk7CmNvbnN0IHJlY29yZEtleSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXk7CmNvbnN0IHJlY29yZERhdGEgPSBhd2FpdCBvcy5yZWNvcmREYXRhKHJlY29yZEtleSwgbmV3SG9zdElELCB7IHVybDogY29uZmlnQm90LnRhZ3MudXJsLCBkYXRlOiBkYXRlLCBtYXJrZXJzOiBbInB1YmxpY1JlYWQiXSB9KTsKCmlmIChyZWNvcmREYXRhLnN1Y2Nlc3MpIHsKICAgIHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICdob3N0SUQnLCBuZXdIb3N0SUQuc3Vic3RyaW5nKDAsIDMpICsgIi0iICsgbmV3SG9zdElELnN1YnN0cmluZygzKSwgJ3NoYXJlZCcpOwoKICAgIGNvbnN0IGpvaW5VUkwgPSBzaXRlT3JpZ2luICsgIi8/am9pbkNvZGU9IiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEOwoKICAgIG9zLnNldENsaXBib2FyZChqb2luVVJMKTsKCiAgICB0aGF0LnRhZ3MubGFiZWwgPSAiam9pbiBjb2RlOiAiICsgbmV3SG9zdElELnN1YnN0cmluZygwLCAzKSArICItIiArIG5ld0hvc3RJRC5zdWJzdHJpbmcoMyk7CgogICAgb3Muc2hvd1FSQ29kZShqb2luVVJMKTsKCiAgICBvcy50b2FzdCgiaG9zdCBnZW5lcmF0ZWQsIHVybCBjb3BpZWQgdG8gY2xpcGJvYXJkOiAiICsgbmV3SG9zdElEKTsKfQplbHNlIHsKICAgIG9zLnRvYXN0KCJzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2FpbiIpOwoKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cn0nALXWiLYBAAphYkpvaW5Ib3N0AgQAtdaItgHeSe4GQC8vbG9naWMgZm9yIHVzaW5nIGEgam9pbiBjb2RlIChjaGVja3MgZm9yIGV4aXN0aW5nIGZpbGVzKQpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGV0IGdldFJlY29yZDsKCmlmICh0aGF0LmRhdGEpIHsKICAgIGdldFJlY29yZCA9IHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogdGhhdC5kYXRhIH07Cn0KZWxzZSB7CiAgICBjb25zdCBqb2luQ29kZSA9IHRoYXQudGV4dC5yZXBsYWNlQWxsKCItIiwgIiIpOwogICAgY29uc3QgcmVjb3JkS2V5ID0gbGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleTsKICAgIGNvbnNvbGUubG9nKCJKT0lOQ09ERSIsIGpvaW5Db2RlKQogICAgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShyZWNvcmRLZXksIGpvaW5Db2RlKTsKfQoKaWYgKGdldFJlY29yZC5zdWNjZXNzKSB7CiAgICBjb25zdCBkYXRlID0gRGF0ZVRpbWUubm93KCk7CiAgICBsZXQgY3JlYXRlRGF0ZSA9IERhdGVUaW1lLmZyb21NaWxsaXMoZ2V0UmVjb3JkLmRhdGEuZGF0ZSk7CiAgICBsZXQgZGlmZmVyZW5jZSA9IGRhdGUuZGlmZihjcmVhdGVEYXRlLCAiZGF5cyIpLnRvT2JqZWN0KCk7CgogICAgZGlmZmVyZW5jZSA9IE1hdGguZmxvb3IoZGlmZmVyZW5jZS5kYXlzKTsKCiAgICBpZiAoZGlmZmVyZW5jZSA8IDgpIHsKICAgICAgICBvcy50b2FzdCgiam9pbmluZyBob3N0IG5vdyIpOwoKICAgICAgICBvcy5nb1RvVVJMKGdldFJlY29yZC5kYXRhLnVybCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBvcy50b2FzdCgiam9pbiBjb2RlIG91dCBvZiBkYXRlLCBwbGVhc2UgZ2VuZXJhdGUgYSBuZXcgam9pbiBjb2RlIik7CiAgICB9Cn0KZWxzZSB7CiAgICBvcy50b2FzdCgiY29kZS9hYiBpbnZhbGlkLCBwbGVhc2UgdHJ5IGFnYWluIik7Cn0nALXWiLYBAAZzZWFyY2gCBAC11oi2Ac1QKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnALXWiLYBAAhhYklnbm9yZQIEALXWiLYB9FAEdHJ1ZScAtdaItgEABG1lbnUCBAC11oi2AflQKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InALXWiLYBABVhYlNraWxsSW5pdGlhbGl6YXRpb24CBAC11oi2AaBRowJALy9GaW5kIHRoZSBhcHByb3ByaWF0ZSBhcnJheSBhbmQgcG9wdWxhdGUgc2tpbGxzCmxldCBza2lsbEFycmF5ID0gbGlua3MucmVtZW1iZXIudGFnc1t0aGF0ICsgIlNraWxsQXJyYXkiXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgc2tpbGxBcnJheS5sZW5ndGg7IGkrKykgewogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KHNraWxsQXJyYXlbaV0pOwp9CgppZiAoY29uZmlnQm90LnRhZ3MuZW1iZWQgPT09ICdpb3MnKSB7CiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoJ2FiSU9TQnJpZGdlJyk7Cn0KCnJldHVybjsnALXWiLYBAAZiYW5uZXICBAC11oi2AcRTKPCflJdiNTUyZWFmOS1hOWQ2LTQxYzgtODUxNS1jYmQyYWJlYWFlNzMnALXWiLYBAAVpbnB1dAIEALXWiLYB61Mo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcAtdaItgEADWxvYWRpbmdTdGF0dXMCBAC11oi2AZJUxgdAY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJMb2FkU3RhdHVzIjsKCmxldCBzdGF0dXNCb3QgPSB7fTsKCnN0YXR1c0JvdC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpzdGF0dXNCb3QubGFiZWwgPSAidmVyaWZ5aW5nIGF1dGhCb3QiOwpzdGF0dXNCb3QubGFiZWxDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CnN0YXR1c0JvdC5hYkxvYWRTdGF0dXMgPSB0cnVlOwpzdGF0dXNCb3QubWVudUl0ZW1TdHlsZSA9IHsgImJhY2tncm91bmQiOiAibm9uZSIgfTsKc3RhdHVzQm90LnRyYWNrTnVtID0gMDsKc3RhdHVzQm90Lm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpIHsKICAgICAgICB0YWdzLnRyYWNrTnVtID0gMDsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHRhZ3MudHJhY2tOdW0rKzsKICAgIH0KCiAgICB0YWdzLmxhYmVsID0gdGFnc1sibGFiZWwiK3RhZ3MudHJhY2tOdW1dOwogICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3NbImZvcm0iK3RhZ3MudHJhY2tOdW1dOwoKICAgIHNldFRpbWVvdXQoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAib25DcmVhdGUiKSwgNTAwKTtgOwpzdGF0dXNCb3QubGFiZWwwID0gInZlcmlmeWluZyBhdXRoQm90LiI7CnN0YXR1c0JvdC5sYWJlbDEgPSAidmVyaWZ5aW5nIGF1dGhCb3QuLiI7CnN0YXR1c0JvdC5sYWJlbDIgPSAidmVyaWZ5aW5nIGF1dGhCb3QuLi4iOwpzdGF0dXNCb3QuZm9ybTAgPSAiaG91cmdsYXNzX2JvdHRvbSI7CnN0YXR1c0JvdC5mb3JtMSA9ICJob3VyZ2xhc3NfdG9wIjsKc3RhdHVzQm90LmZvcm0yID0gImhvdXJnbGFzc19ib3R0b20iOwpzdGF0dXNCb3Qub25EZXN0cm95ID0gYEAKICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKYDsKCmxldCBjcmVhdGVkU3RhdHVzQm90ID0gY3JlYXRlKHN0YXR1c0JvdCk7CgpyZXR1cm4gY3JlYXRlZFN0YXR1c0JvdDsnALXWiLYBAANhc2sCBAC11oi2AdlbKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnALXWiLYBAA1hYkxvYWRTdHVkaW9zAgQAtdaItgGAXFtAY29uc3QgdXNlclN0dWRpb3MgPSBhd2FpdCBvcy5saXN0VXNlclN0dWRpb3MoKTsKY29uZmlnQm90LnRhZ3MudXNlcl9zdHVkaW9zID0gdXNlclN0dWRpb3M7JwC11oi2AQAHYWJUaW1lcgIEALXWiLYB3FzBBkBpZiAoZ2V0Qm90KCJhYlRpbWVyIiwgdHJ1ZSkpIHsKICAgIHJldHVybjsKfQoKaWYgKCF0YWdzLmFiWFApIHsKICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiWFAiLCAiMCIsICJsb2NhbCIpOwp9CgpsZXQgdGltZXJCb3QgPSB7fTsKCnRpbWVyQm90LnNwYWNlID0gInRlbXBMb2NhbCI7CnRpbWVyQm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwp0aW1lckJvdC5vbkNyZWF0ZSA9IGBACiAgICBtYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHRoaXNCb3Qub25UaW1lQ2hlY2soKSwgNjAwMDApOwpgOwp0aW1lckJvdC5hYlRpbWVyID0gdHJ1ZTsKdGltZXJCb3Qub25UaW1lQ2hlY2sgPSBgQAogICAgaWYgKHRhZ3Mubm90SWRsZSkgewogICAgICAgIHRhZ3Mubm90SWRsZSA9IGZhbHNlOwoKICAgICAgICAvL2NvbnNvbGUubG9nKCJYUCIsIGxpbmtzLm1hbmFnZXIudGFncy5hYlhQKTsKCiAgICAgICAgY29uc3QgdG90YWxYUCA9IGxpbmtzLm1hbmFnZXIudGFncy5hYlhQICsgMTsKCiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5tYW5hZ2VyLCAiYWJYUCIsIHRvdGFsWFAsICJsb2NhbCIpOwogICAgfQpgOwp0aW1lckJvdC5ub3RJZGxlID0gZmFsc2U7CnRpbWVyQm90Lm9uQW55QWN0aW9uID0gYEAKICAgIGlmICghdGFncy5ub3RJZGxlKSB7CiAgICAgICAgaWYgKHRoYXQuYWN0aW9uLmlkID09IGdyaWRQb3J0YWxCb3QuaWQpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLm5vdElkbGUgPSB0cnVlOwogICAgICAgIH0KICAgIH0KYDsKCmxldCBhYlRpbWVyID0gY3JlYXRlKHRpbWVyQm90KTsKCmdsb2JhbFRoaXMuYWJUaW1lciA9IGFiVGltZXI7JwC11oi2AQAFc3RvcmUCBAC11oi2AZ5jKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnALXWiLYBAAdjb25zb2xlAgQAtdaItgHFYyjwn5SXMjRiN2U2NmYtMGQ1Yi00MDY0LWJmNDgtYjU2MmI5ZTZlM2ViJwC11oi2AQAJYWJWZXJzaW9uAgQAtdaItgHsYwUxMC4xNCcAtdaItgEADGFiTG9hZENvbmZpZwIEALXWiLYB8mOaBkBjb25zdCB1cmwgPSBuZXcgVVJMKG9zLmdldEFCMUJvb3RzdHJhcFVSTCgpKTsKdXJsLnBhdGhuYW1lID0gdXJsLnBhdGhuYW1lLnJlcGxhY2UoJ2FiMS5hdXgnLCAnYWJDb25maWcuYXV4Jyk7Cgp0cnkgewogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB3ZWIuaG9vayh7IG1ldGhvZDogIkdFVCIsIHVybDogdXJsLmhyZWYgfSk7CgogICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgYWJDb25maWcuIFJlc3BvbnNlOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHVwZGF0ZXMgPSByZXNwb25zZS5kYXRhLnVwZGF0ZXM7CiAgICBhd2FpdCBvcy5hcHBseVVwZGF0ZXNUb0luc3QodXBkYXRlcyk7CgogICAgaWYgKGxpbmtzLnJlbWVtYmVyKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBMb2FkZWQgYWJDb25maWcgYXV4IGJ1dCBjb3VsZCBub3QgZmluZCByZW1lbWJlciBib3QuYCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9IGNhdGNoIChlKSB7CiAgICBjb25zb2xlLmVycm9yKGUpOwogICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIEZhaWxlZCB0byBkb3dubG9hZCBhYkNvbmZpZy4gU2VlIGFib3ZlIGVycm9yLmApOwogICAgcmV0dXJuIGZhbHNlOwp9JwC11oi2AQAXYWJCdWlsZENhc3VhbENhdGFsb2dVUkwCBAC11oi2AY1q/wFAY29uc3QgcmVsYXRpdmVQYXRoID0gdGhhdDsKCmNvbnN0IHVybCA9IG5ldyBVUkwobGlua3MucmVtZW1iZXIudGFncy5jYXN1YWxDYXRhbG9nVVJMKTsKY29uc3QgZW52ID0gbGlua3MucmVtZW1iZXIudGFncy5jYXN1YWxDYXRhbG9nRW52OwoKdXJsLnBhdGhuYW1lID0gcmVsYXRpdmVQYXRoOwoKaWYgKGVudiAmJiBlbnYgIT09ICdwcm9kJykgewogICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ2VudicsIGVudik7Cn0KCnJldHVybiB1cmwuaHJlZjsnALXWiLYBAAdjaGFubmVsAgQAtdaItgGNbCjwn5SXYTliNmFhMGQtYjM1Ny00ZGU2LTliZWYtODUzNDhhYjFkMGUwJwC11oi2AQALcGVyc29uYWxpdHkCBAC11oi2AbRsKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInALXWiLYBAAxhYkluc3RVcGRhdGUCBAC11oi2AdtsogFALy8gVXBkYXRlIHRoZSBhYkluc3QgdGFnIHdoaWNoIHJlcHJlc2VudHMgdGhlIGluc3QgdGhhdCB0aGlzIGFiIGV4aXN0cyBpbi4KY29uc3QgY3VySW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CnNldFRhZ01hc2sodGhpc0JvdCwgJ2FiSW5zdCcsIGN1ckluc3QsICdzaGFyZWQnKTsnALXWiLYBAAxvbkluc3RKb2luZWQCBAC11oi2Af5tGEB0aGlzQm90LmFiSW5zdFVwZGF0ZSgpOycAtdaItgEAC29uSW5zdExlYXZlAgQAtdaItgGXbhhAdGhpc0JvdC5hYkluc3RVcGRhdGUoKTsnALXWiLYBAAxyZXNlcnZlZEFza3MCBAC11oi2AbBuDPCfp6xbImhvbWUiXScAtdaItgEACGFydGlmYWN0AgQAtdaItgG7bijwn5SXNzhlNDE1MDMtYzkzMy00ZjhhLTgxN2EtYmE5N2JmOGQ1ZDI3JwC11oi2AQALYm90X2ZhY3RvcnkCBAC11oi2AeJuKPCflJdjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcnALXWiLYBAAV1dGlscwIEALXWiLYBiW8o8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAtdaItgEACHVwZGF0ZUFCAgQAtdaItgGwb7okQGNvbnN0IHJlbG9hZFBhZ2UgPSB0aGF0Py5yZWxvYWRQYWdlID8/IHRydWU7DQpjb25zdCBzaG93SW5kaWNhdG9yID0gdGhhdD8uc2hvd0luZGljYXRvciA/PyB0cnVlOw0KDQpjb25zdCBEUllfUlVOID0gdHJ1ZTsNCg0KbGV0IGJ1c3lJbmRpY2F0b3I7DQoNCmlmIChzaG93SW5kaWNhdG9yKSB7DQogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAndXBkYXRlQUJNZW51JzsNCiAgICBidXN5SW5kaWNhdG9yID0gYXdhaXQgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yKHsgdXBkYXRlQUJNZW51OiB0cnVlLCBsYWJlbDogYHVwZGF0aW5nICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX1gIH0pOw0KfQ0KDQp0cnkgew0KICAgIC8vIFVwZGF0ZSBhYkNvbmZpZy4NCiAgICBjb25zdCBhYkNvbmZpZ1VSTCA9IG9zLmdldEFCMUJvb3RzdHJhcFVSTCgpOw0KICAgIGNvbnN0IGFiQ29uZmlnUmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKHsgbWV0aG9kOiAiR0VUIiwgdXJsOiBhYkNvbmZpZ1VSTCB9KTsNCg0KICAgIGFzc2VydChhYkNvbmZpZ1Jlc3BvbnNlLnN0YXR1cyA9PT0gMjAwLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIENvdWxkIG5vdCBkb3dubG9hZCBhYkNvbmZpZy4gUmVzcG9uc2U6ICR7YWJDb25maWdSZXNwb25zZS5zdGF0dXNUZXh0fWApOw0KICAgIGFzc2VydChhYkNvbmZpZ1Jlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvbmZpZyBtdXN0IGJlIGluIGF1eCBmaWxlIGZvcm1hdCB2Mi4gQWN0dWFsIGF1eCBmaWxlIGZvcm1hdCB2ZXJzaW9uOiAke2FiQ29uZmlnUmVzcG9uc2UuZGF0YS52ZXJzaW9ufWApOw0KDQogICAgYXdhaXQgdGhpc0JvdC5hdXhWMk92ZXJ3cml0ZSh7IGF1eDogYWJDb25maWdSZXNwb25zZS5kYXRhLCBncm91cFRhZzogJ2FiQ29uZmlnJywgZHJ5UnVuOiBEUllfUlVOIH0pOw0KDQogICAgLy8gVXBkYXRlIGFiIHNraWxscy4NCiAgICBjb25zdCBsb2FkZWRTa2lsbHMgPSB0aGlzQm90LmFiTG9hZGVkU2tpbGxzKCk7DQoNCiAgICBmb3IgKGxldCBza2lsbE5hbWUgb2YgbG9hZGVkU2tpbGxzKSB7DQogICAgICAgIGNvbnN0IHNraWxsVVJMID0gdGhpc0JvdC5hYkJ1aWxkQ2FzdWFsQ2F0YWxvZ1VSTChgL2FiLyR7c2tpbGxOYW1lfS5hdXhgKTsNCg0KICAgICAgICAvLyBTa2lsbHMgY2FuIGJlIHJlc3RydWN0dXJlZCwgbWVhbmluZyB0aGF0IHRoZXkgY291bGQgYmUgcmVtb3ZlZCBlbnRpcmVseSBpbiB0aGUgZnV0dXJlLg0KICAgICAgICAvLyBJZiBhIGZpbGUgZmFpbHMgdG8gYmUgcmV0cmlldmVkLCB0aGVuIHJlbW92ZSBhbGwgdGhlIGJvdHMgaW4gdGhlIGdyb3VwIGluIHRoZSBpbnN0Lg0KICAgICAgICBsZXQgcmVtb3ZlU2tpbGwgPSBmYWxzZTsNCiAgICAgICAgbGV0IHNraWxsUmVzcG9uc2U7DQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHNraWxsUmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKHsgbWV0aG9kOiAiR0VUIiwgdXJsOiBza2lsbFVSTCB9KTsNCg0KICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNraWxsUmVzcG9uc2U6YCwgc2tpbGxSZXNwb25zZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGFzc2VydChza2lsbFJlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSAke3NraWxsTmFtZX0gbXVzdCBiZSBpbiBhdXggZmlsZSBmb3JtYXQgdjIuIEFjdHVhbCBhdXggZmlsZSBmb3JtYXQgdmVyc2lvbjogJHtza2lsbFJlc3BvbnNlLmRhdGEudmVyc2lvbn1gKTsNCg0KICAgICAgICAgICAgaWYgKHNraWxsUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsNCiAgICAgICAgICAgICAgICBpZiAoc2tpbGxSZXNwb25zZS5zdGF0dXMgPT09IDQwMyB8fCBza2lsbFJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7DQogICAgICAgICAgICAgICAgICAgIHJlbW92ZVNraWxsID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgJHtza2lsbE5hbWV9LiBSZXNwb25zZTogJHtza2lsbFJlc3BvbnNlLnN0YXR1c1RleHR9YCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2F1Z2h0IGVycm9yIHdoaWxlIGRvd25sb2FkaW5nIHNraWxsOmAsIGUpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoZS5yZXNwb25zZT8uc3RhdHVzID09PSA0MDMgfHwgZS5yZXNwb25zZT8uc3RhdHVzID09PSA0MDQpIHsNCiAgICAgICAgICAgICAgICAvLyBGaWxlIGRvZXNudCBleGlzdCBhbnltb3JlLCB0aGUgc2tpbGwgaGFzIGJlZW4gcmVtb3ZlZC4NCiAgICAgICAgICAgICAgICByZW1vdmVTa2lsbCA9IHRydWU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHRocm93IGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmIChza2lsbFJlc3BvbnNlICYmICFyZW1vdmVTa2lsbCkgew0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hdXhWMk92ZXJ3cml0ZSh7IGF1eDogc2tpbGxSZXNwb25zZS5kYXRhLCBncm91cFRhZzogc2tpbGxOYW1lLCBkcnlSdW46IERSWV9SVU4gfSk7DQogICAgICAgIH0gZWxzZSBpZiAocmVtb3ZlU2tpbGwpIHsNCiAgICAgICAgICAgIGNvbnN0IHNraWxsQm90cyA9IGdldEJvdHMoYiA9PiBiLnRhZ3Nbc2tpbGxOYW1lXSA9PT0gdHJ1ZSk7DQoNCiAgICAgICAgICAgIGlmIChEUllfUlVOKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBkZWxldGUgJHtza2lsbEJvdHMubGVuZ3RofSAke3NraWxsTmFtZX0gYm90KHMpIGJlY2F1c2UgJHtza2lsbE5hbWV9IGlzIG5vIGxvbmdlciBpbiB0aGUgY2FzdWFsIGNhdGFsb2cuYCkNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICBpZiAodGFncy5kZWJ1Zykgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gU2tpbGwgJHtza2lsbE5hbWV9IGlzIG5vIGxvbmdlciBpbiB0aGUgY2FzdWFsIGNhdGFsb2cuIFJlbW92ZSAke3NraWxsQm90cy5sZW5ndGh9ICR7c2tpbGxOYW1lfSBib3QocykgZnJvbSBpbnN0LmApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBkZXN0cm95KHNraWxsQm90cyk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBVcGRhdGUgYWJDb3JlIChkbyB0aGlzIG9uZSBsYXN0ISkNCiAgICBjb25zdCBhYkNvcmVVUkwgPSB0aGlzQm90LmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKCcvYWIvYWJDb3JlLmF1eCcpOw0KICAgIGNvbnN0IGFiQ29yZVJlc3BvbnNlID0gYXdhaXQgd2ViLmhvb2soeyBtZXRob2Q6ICJHRVQiLCB1cmw6IGFiQ29yZVVSTCB9KTsNCg0KICAgIGFzc2VydChhYkNvcmVSZXNwb25zZS5zdGF0dXMgPT09IDIwMCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgYWJDb3JlLiBSZXNwb25zZTogJHthYkNvcmVSZXNwb25zZS5zdGF0dXNUZXh0fWApOw0KICAgIGFzc2VydChhYkNvcmVSZXNwb25zZS5kYXRhLnZlcnNpb24gPT09IDIsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWJDb3JlIG11c3QgYmUgaW4gYXV4IGZpbGUgZm9ybWF0IHYyLiBBY3R1YWwgYXV4IGZpbGUgZm9ybWF0IHZlcnNpb246ICR7YWJDb3JlUmVzcG9uc2UuZGF0YS52ZXJzaW9ufWApOw0KDQogICAgYXdhaXQgdGhpc0JvdC5hdXhWMk92ZXJ3cml0ZSh7IGF1eDogYWJDb3JlUmVzcG9uc2UuZGF0YSwgZ3JvdXBUYWc6ICdhYkNvcmUnLCBkcnlSdW46IERSWV9SVU4gfSk7DQoNCiAgICBpZiAocmVsb2FkUGFnZSkgew0KICAgICAgICBjb25zdCByZW1vdGVEYXRhRXZlbnQgPSAndXBkYXRlX2FiX3JlbG9hZF9wYWdlJzsNCiAgICAgICAgY29uc3QgcmVtb3RlRGF0YUFyZyA9IHsgcmVsb2FkUGFnZSwgZHJ5UnVuOiBEUllfUlVOIH07DQoNCiAgICAgICAgaWYgKG9zLmlzQ29sbGFib3JhdGl2ZSgpKSB7DQogICAgICAgICAgICBjb25zdCByZW1vdGVzID0gYXdhaXQgb3MucmVtb3RlcygpOw0KICAgICAgICAgICAgc2VuZFJlbW90ZURhdGEocmVtb3RlcywgcmVtb3RlRGF0YUV2ZW50LCByZW1vdGVEYXRhQXJnKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXNCb3Qub25SZW1vdGVEYXRhKHsgbmFtZTogcmVtb3RlRGF0YUV2ZW50LCB0aGF0OiByZW1vdGVEYXRhQXJnLCByZW1vdGVJZDogY29uZmlnQm90LmlkIH0pOw0KICAgICAgICB9DQogICAgfQ0KfSBmaW5hbGx5IHsNCiAgICBpZiAoYnVzeUluZGljYXRvcikgew0KICAgICAgICBkZXN0cm95KGJ1c3lJbmRpY2F0b3IpOw0KICAgICAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7DQogICAgfQ0KfScAtdaItgEABWRlYnVnAgQAtdaItgHrkwEEdHJ1ZScAtdaItgEADmF1eFYyT3ZlcndyaXRlAgQAtdaItgHwkwG5J0Bjb25zdCBhdXggPSB0aGF0Py5hdXg7CmNvbnN0IGdyb3VwVGFnID0gdGhhdD8uZ3JvdXBUYWc7CmNvbnN0IGRyeVJ1biA9IHRoYXQ/LmRyeVJ1biA/PyBmYWxzZTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7Cn0KCmFzc2VydChhdXg/LnZlcnNpb24gPT09IDIsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXV4IHBhcmFtZXRlciBpcyByZXF1aXJlZCB0byBiZSBhIHYyIGF1eCBmaWxlLmApOwphc3NlcnQoZ3JvdXBUYWcgPT0gbnVsbCB8fCB0eXBlb2YgZ3JvdXBUYWcgPT09ICdzdHJpbmcnLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGdyb3VwVGFnIHBhcmFtZXRlciBpZiBwcm92aWRlZCwgbXVzdCBiZSBhIHN0cmluZy5gKTsKCmNvbnN0IHN0YXRlID0gYXdhaXQgb3MuZ2V0SW5zdFN0YXRlRnJvbVVwZGF0ZXMoYXV4LnVwZGF0ZXMpOwpsZXQgcHJldkdyb3VwQm90cyA9IGdldEJvdHMoYiA9PiBiLnRhZ3NbZ3JvdXBUYWddID09PSB0cnVlKTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHN0YXRlOmAsIHN0YXRlKTsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gcHJldkdyb3VwQm90czpgLCBwcmV2R3JvdXBCb3RzKTsKfQoKLy8gU3RlcCAxOiBBcHBseSB1cGRhdGVzIGRpcmVjdGx5IHRvIHRoZSBpbnN0IGFzLWlzLgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBTdGVwIDE6IEFwcGx5IHVwZGF0ZXMgZGlyZWN0bHkgdG8gdGhlIGluc3QgYXMtaXMuYCk7Cn0KCmlmICghZHJ5UnVuKSB7CiAgICBhd2FpdCBvcy5hcHBseVVwZGF0ZXNUb0luc3QoYXV4LnVwZGF0ZXMpOwp9IGVsc2UgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBhcHBseSB1cGRhdGVzIHRvIGluc3QuYCkKfQoKLy8gU3RlcCAyOiBEZWxldGUgcHJldmlvdXMgZ3JvdXAgYm90cyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIHVwZGF0ZSBzdGF0ZS4KaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gU3RlcCAyOiBEZWxldGUgcHJldmlvdXMgZ3JvdXAgYm90cyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIHVwZGF0ZSBzdGF0ZS5gKTsKfQoKZm9yIChjb25zdCBwcmV2R3JvdXBCb3Qgb2YgcHJldkdyb3VwQm90cykgewogICAgaWYgKHN0YXRlW3ByZXZHcm91cEJvdC5pZF0gPT0gbnVsbCkgewogICAgICAgIGlmIChkcnlSdW4pIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBkZWxldGUgYm90ICR7cHJldkdyb3VwQm90LmlkfSBwcmV2aW91c2x5IGJlbG9uZ2luZyB0byBncm91cCAke2dyb3VwVGFnfWApOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGVzdHJveWluZyBwcmV2aW91cyBncm91cCBib3QgJHtwcmV2R3JvdXBCb3QuaWR9IHRoYXQgaXMgbm8gbG9uZ2VyIGluIHRoZSB1cGRhdGUgc3RhdGUuYCk7CiAgICAgICAgfQoKICAgICAgICBkZXN0cm95KHByZXZHcm91cEJvdCk7CiAgICB9Cn0KCi8vIFN0ZXAgMzogRm9yIGVhY2ggYm90IGluIHRoZSB1cGRhdGUgc3RhdGUsIGNyZWF0ZSwgdXBkYXRlLCBhbmQgZGVsZXRlIHRhZ3Mgb24gdGhlIGV4aXN0aW5nIGJvdHMgaW4gdGhlIGluc3QuCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIFN0ZXAgMzogRm9yIGVhY2ggYm90IGluIHRoZSB1cGRhdGUgc3RhdGUsIGNyZWF0ZSwgdXBkYXRlLCBhbmQgZGVsZXRlIHRhZ3Mgb24gdGhlIGV4aXN0aW5nIGJvdHMgaW4gdGhlIGluc3QuYCk7Cn0KCmZvciAoY29uc3QgYm90SWQgaW4gc3RhdGUpIHsKICAgIGNvbnN0IGJvdCA9IGdldEJvdCgnaWQnLCBib3RJZCk7CiAgICBjb25zdCBib3RTdGF0ZSA9IHN0YXRlW2JvdElkXTsKCiAgICBpZiAoYm90KSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBmb3VuZCBleGlzdGluZyBib3QgJHtib3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIC8vIEhhbmRsZXMgdGFnIGNyZWF0ZSAvIHVwZGF0ZS4KICAgICAgICBmb3IgKGNvbnN0IHN0YXRlVGFnTmFtZSBpbiBib3RTdGF0ZS50YWdzKSB7CiAgICAgICAgICAgIGlmIChib3QucmF3W3N0YXRlVGFnTmFtZV0gIT0gYm90U3RhdGUudGFnc1tzdGF0ZVRhZ05hbWVdKSB7CiAgICAgICAgICAgICAgICBpZiAoZHJ5UnVuKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBzZXQgdGFnICcke3N0YXRlVGFnTmFtZX0nIG9uIGJvdCAke2JvdElkfSB0byB2YWx1ZTpgLCBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV0pOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzZXQgdGFnICcke3N0YXRlVGFnTmFtZX0nIG9uIGJvdCAke2JvdElkfSB0bzpgLCBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJvdC50YWdzW3N0YXRlVGFnTmFtZV0gPSBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV07CgogICAgICAgICAgICAgICAgaWYgKGJvdFN0YXRlLnRhZ3Nbc3RhdGVUYWdOYW1lXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0YWcgJyR7c3RhdGVUYWdOYW1lfScgZm9yIGJvdCAke2JvdElkfSBpcyBudWxsLCBjbGVhcmluZyBhbnkgdGFnIG1hc2tzIGFzIHdlbGwuYCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBDbGVhciBhbGwgcG9zc2libGUgbWFza3MgZm9yIHRoaXMgdGFnIGFzIHdlbGwuCiAgICAgICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIHN0YXRlVGFnTmFtZSwgbnVsbCwgJ2xvY2FsJyk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIHN0YXRlVGFnTmFtZSwgbnVsbCwgJ3RlbXBMb2NhbCcpOwogICAgICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYm90LCBzdGF0ZVRhZ05hbWUsIG51bGwsICdzaGFyZWQnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgc3RhdGVUYWdOYW1lLCBudWxsLCAndGVtcFNoYXJlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRhZyAnJHtzdGF0ZVRhZ05hbWV9JyBmb3IgYm90ICR7Ym90SWR9IGlzIGFscmVhZHkgdXAtdG8tZGF0ZS5gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gRGVsZXRlIHRhZ3MgKGFuZCBtYXNrcyBmb3IgdGhvc2UgdGFncykgb24gZXhpc3RpbmcgYm90IHRoYXQgYXJlIG5vdCBpbiB1cGRhdGUgc3RhdGUuCiAgICAgICAgY29uc3QgYm90VGFncyA9IE9iamVjdC5rZXlzKGJvdC50YWdzKTsKCiAgICAgICAgZm9yIChjb25zdCBib3RUYWdOYW1lIG9mIGJvdFRhZ3MpIHsKICAgICAgICAgICAgaWYgKGJvdFN0YXRlLnRhZ3NbYm90VGFnTmFtZV0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGRyeVJ1bikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZHJ5IHJ1bjogd291bGQgZGVsZXRlIHRhZyAnJHtib3RUYWdOYW1lfScgb24gYm90ICR7Ym90SWR9LmApOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkZWxldGUgdGFnIChhbmQgbWFza3MpICcke2JvdFRhZ05hbWV9JyBvbiBib3QgJHtib3RJZH0uYCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYm90LnRhZ3NbYm90VGFnTmFtZV0gPSBudWxsOwogICAgICAgICAgICAgICAgLy8gQ2xlYXIgYWxsIHBvc3NpYmxlIG1hc2tzIGZvciB0aGlzIHRhZyBhcyB3ZWxsLgogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIGJvdFRhZ05hbWUsIG51bGwsICdsb2NhbCcpOwogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIGJvdFRhZ05hbWUsIG51bGwsICd0ZW1wTG9jYWwnKTsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYm90LCBib3RUYWdOYW1lLCBudWxsLCAnc2hhcmVkJyk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgYm90VGFnTmFtZSwgbnVsbCwgJ3RlbXBTaGFyZWQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNvdWxkIG5vdCBmaW5kIGJvdCAke2JvdElkfSBpbiBpbnN0LmApOwogICAgfQp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkb25lLmApOwp9Cgpjb25zdCBib3RJZHMgPSBPYmplY3Qua2V5cyhzdGF0ZSk7CgpyZXR1cm4gYm90SWRzOycAtdaItgEADmFiTG9hZGVkU2tpbGxzAgQAtdaItgGquwG2AUBjb25zdCBsb2FkZWRTa2lsbHMgPSBuZXcgU2V0KCk7CgpnZXRCb3RzKChiKSA9PiB7CiAgICBpZiAoYi50YWdzLmFiTG9hZGVkU2tpbGwgIT0gbnVsbCkgewogICAgICAgIGxvYWRlZFNraWxscy5hZGQoYi50YWdzLmFiTG9hZGVkU2tpbGwpOwogICAgfQp9KTsKCnJldHVybiBBcnJheS5mcm9tKGxvYWRlZFNraWxscyk7JwC11oi2AQAMb25SZW1vdGVEYXRhAgQAtdaItgHhvAH3A0BpZiAodGhhdC5uYW1lID09PSAndXBkYXRlX2FiX3JlbG9hZF9wYWdlJykgewogICAgY29uc3QgeyByZWxvYWRQYWdlLCBkcnlSdW4gfSA9IHRoYXQudGhhdDsKCiAgICBsZXQgaXNVUkwgPSBmYWxzZTsKCiAgICBpZiAodHlwZW9mIHJlbG9hZFBhZ2UgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbmV3IFVSTChyZWxvYWRQYWdlKTsKICAgICAgICAgICAgaXNVUkwgPSB0cnVlOwogICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICB9CgogICAgbGV0IHVybCA9IGlzVVJMID8gcmVsb2FkUGFnZSA6IGNvbmZpZ0JvdC50YWdzLnVybDsKCiAgICBpZiAoZHJ5UnVuKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBnbyB0byB1cmxgLCB1cmwpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIAogICAgb3MuZ29Ub1VSTChpc1VSTCA/IHJlbG9hZFBhZ2UgOiBjb25maWdCb3QudGFncy51cmwpOwp9JwC11oi2AQAJb25FbnRlckFSAgQAtdaItgHZwAETQG1hc2tzLmluQVIgPSB0cnVlOycAtdaItgEACG9uRXhpdEFSAgQAtdaItgHtwAETQG1hc2tzLmluQVIgPSBudWxsOycAtdaItgEACW9uRW50ZXJWUgIEALXWiLYBgcEBE0BtYXNrcy5pblZSID0gdHJ1ZTsnALXWiLYBAAhvbkV4aXRWUgIEALXWiLYBlcEBE0BtYXNrcy5pblZSID0gbnVsbDsA"}]}