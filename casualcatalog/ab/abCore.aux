{"version":2,"updates":[{"id":0,"timestamp":1760544315853,"update":"AWKO09+rBgAnAQRib3RzJDY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNwEnAI7T36sGABhhYkNoZWNrQUJVcGRhdGVBdmFpbGFibGUCBACO09+rBgHBLEBjb25zdCBkZXRhaWxlZCA9IHRoYXQ/LmRldGFpbGVkID8/IGZhbHNlOwpjb25zdCBoYXNoQWxnb3JpdGhtID0gdGhhdD8uaGFzaEFsZ29yaXRobSA/PyAnc2hhMSc7CmNvbnN0IGhhc2hGb3JtYXQgPSB0aGF0Py5oYXNoRm9ybWF0ID8/ICdoZXgnOwoKaW50ZXJmYWNlIEFCRmlsZVVwZGF0ZUNoZWNrIHsKICAgIGZpbGVOYW1lOiBzdHJpbmc7CiAgICB1cGRhdGVBdmFpbGFibGU6IGJvb2xlYW47CiAgICBjdXJyZW50SGFzaDogc3RyaW5nOwogICAgbGF0ZXN0SGFzaDogc3RyaW5nOwogICAgcmVtb3ZlZDogYm9vbGVhbjsKfQoKLy8gVGhpcyBsaXN0IG9mIGFiIGZpbGUgY2hlY2tzLCB0aGlzIHdpbGwgb25seSBiZSBwb3B1bGF0ZWQgaWYgJ2RldGFpbGVkJyBpcyB0cnVlLgpjb25zdCBhYkZpbGVDaGVja3M6IEFCRmlsZVVwZGF0ZUNoZWNrW10gPSBbXTsKCmFzeW5jIGZ1bmN0aW9uIGNoZWNrU2tpbGxPdXRkYXRlZChza2lsbE5hbWU6IHN0cmluZywgY3VycmVudEhhc2g6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4gewogICAgY29uc3Qgc2tpbGxVUkwgPSB0aGlzQm90LmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKGAvYWIvJHtza2lsbE5hbWV9LmF1eGApOyAgICAgICAgCiAgICBsZXQgc2tpbGxSZW1vdmVkID0gZmFsc2U7CiAgICBsZXQgc2tpbGxSZXNwb25zZTsKCiAgICB0cnkgewogICAgICAgIHNraWxsUmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKHsgbWV0aG9kOiAiR0VUIiwgdXJsOiBza2lsbFVSTCB9KTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBza2lsbFJlc3BvbnNlOmAsIHNraWxsUmVzcG9uc2UpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBhc3NlcnQoc2tpbGxSZXNwb25zZS5kYXRhLnZlcnNpb24gPT09IDIsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gJHtza2lsbE5hbWV9IG11c3QgYmUgaW4gYXV4IGZpbGUgZm9ybWF0IHYyLiBBY3R1YWwgYXV4IGZpbGUgZm9ybWF0IHZlcnNpb246ICR7c2tpbGxSZXNwb25zZS5kYXRhLnZlcnNpb259YCk7CgogICAgICAgIGlmIChza2lsbFJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgIGlmIChza2lsbFJlc3BvbnNlLnN0YXR1cyA9PT0gNDAzIHx8IHNraWxsUmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgICAgIHNraWxsUmVtb3ZlZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgJHtza2lsbE5hbWV9LiBSZXNwb25zZTogJHtza2lsbFJlc3BvbnNlLnN0YXR1c1RleHR9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhdWdodCBlcnJvciB3aGlsZSBkb3dubG9hZGluZyBza2lsbDpgLCBlKTsKICAgICAgICAKICAgICAgICBpZiAoZS5yZXNwb25zZT8uc3RhdHVzID09PSA0MDMgfHwgZS5yZXNwb25zZT8uc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgLy8gRmlsZSBkb2VzbnQgZXhpc3QgYW55bW9yZSwgdGhlIHNraWxsIGhhcyBiZWVuIHJlbW92ZWQuCiAgICAgICAgICAgIHNraWxsUmVtb3ZlZCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHNraWxsUmVtb3ZlZCkgewogICAgICAgIGlmIChkZXRhaWxlZCkgewogICAgICAgICAgICBhYkZpbGVDaGVja3MucHVzaCh7CiAgICAgICAgICAgICAgICBmaWxlTmFtZTogc2tpbGxOYW1lLAogICAgICAgICAgICAgICAgY3VycmVudEhhc2gsCiAgICAgICAgICAgICAgICBsYXRlc3RIYXNoOiBudWxsLAogICAgICAgICAgICAgICAgcmVtb3ZlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIHVwZGF0ZUF2YWlsYWJsZTogdHJ1ZSwKICAgICAgICAgICAgfSkKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBDYWxjdWxhdGUgaGFzaCBvZiBhYiBmaWxlIHN0YXRlIHRvIGNvbXBhcmUgYWdhaW5zdC4KICAgICAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IG9zLmdldEluc3RTdGF0ZUZyb21VcGRhdGVzKHNraWxsUmVzcG9uc2UuZGF0YS51cGRhdGVzKTsKICAgICAgICBjb25zdCBsYXRlc3RIYXNoID0gY3J5cHRvLmhhc2goaGFzaEFsZ29yaXRobSwgaGFzaEZvcm1hdCwgc3RhdGUpOwogICAgICAgIAogICAgICAgIGlmIChkZXRhaWxlZCkgewogICAgICAgICAgICBhYkZpbGVDaGVja3MucHVzaCh7CiAgICAgICAgICAgICAgICBmaWxlTmFtZTogc2tpbGxOYW1lLAogICAgICAgICAgICAgICAgY3VycmVudEhhc2gsCiAgICAgICAgICAgICAgICBsYXRlc3RIYXNoLAogICAgICAgICAgICAgICAgcmVtb3ZlZDogZmFsc2UsCiAgICAgICAgICAgICAgICB1cGRhdGVBdmFpbGFibGU6IGN1cnJlbnRIYXNoICE9PSBsYXRlc3RIYXNoLAogICAgICAgICAgICAgICAgbGF0ZXN0VXBkYXRlczogc2tpbGxSZXNwb25zZS5kYXRhLnVwZGF0ZXMsCiAgICAgICAgICAgICAgICBsYXRlc3RTdGF0ZTogc3RhdGUsCiAgICAgICAgICAgIH0pCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY3VycmVudEhhc2ggIT09IGxhdGVzdEhhc2g7CiAgICB9Cn0KCi8vIDEuIENoZWNrIGlmIGFiQ29uZmlnIGlzIG91dGRhdGVkLgpjb25zdCBhYkNvbmZpZ1VSTCA9IG9zLmdldEFCMUJvb3RzdHJhcFVSTCgpOwpjb25zdCBhYkNvbmZpZ1Jlc3BvbnNlID0gYXdhaXQgd2ViaG9vayh7IG1ldGhvZDogIkdFVCIsIHVybDogYWJDb25maWdVUkwgfSk7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvbmZpZ1Jlc3BvbnNlOmAsIGFiQ29uZmlnUmVzcG9uc2UpOwp9Cgphc3NlcnQoYWJDb25maWdSZXNwb25zZS5zdGF0dXMgPT09IDIwMCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgYWJDb25maWcuIFJlc3BvbnNlOiAke2FiQ29uZmlnUmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsKYXNzZXJ0KGFiQ29uZmlnUmVzcG9uc2UuZGF0YS52ZXJzaW9uID09PSAyLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFiQ29uZmlnIG11c3QgYmUgaW4gYXV4IGZpbGUgZm9ybWF0IHYyLiBBY3R1YWwgYXV4IGZpbGUgZm9ybWF0IHZlcnNpb246ICR7YWJDb25maWdSZXNwb25zZS5kYXRhLnZlcnNpb259YCk7Cgpjb25zdCBhYkNvbmZpZ0N1cnJlbnRIYXNoID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkNvbmZpZ1NvdXJjZUhhc2g7CmNvbnN0IGFiQ29uZmlnTGF0ZXN0U3RhdGUgPSBhd2FpdCBvcy5nZXRJbnN0U3RhdGVGcm9tVXBkYXRlcyhhYkNvbmZpZ1Jlc3BvbnNlLmRhdGEudXBkYXRlcyk7CmZvciAobGV0IGlkIGluIGFiQ29uZmlnTGF0ZXN0U3RhdGUpIHsKICAgIGRlbGV0ZSBhYkNvbmZpZ0xhdGVzdFN0YXRlW2lkXS50YWdzLmJhc2VBQjsgLy8gYmFzZUFCIGlzIGFuIGFubm95aW5nIHRhZyB0aGF0IHNob3VsZCBub3QgYmUgY29tcHV0ZWQgYXMgcGFydCBvZiBoYXNoIHN0YXRlLgp9CmNvbnN0IGFiQ29uZmlnTGF0ZXN0SGFzaCA9IGNyeXB0by5oYXNoKGhhc2hBbGdvcml0aG0sIGhhc2hGb3JtYXQsIGFiQ29uZmlnTGF0ZXN0U3RhdGUpOwoKaWYgKGRldGFpbGVkKSB7CiAgICBhYkZpbGVDaGVja3MucHVzaCh7CiAgICAgICAgZmlsZU5hbWU6ICdhYkNvbmZpZycsCiAgICAgICAgY3VycmVudEhhc2g6IGFiQ29uZmlnQ3VycmVudEhhc2gsCiAgICAgICAgbGF0ZXN0SGFzaDogYWJDb25maWdMYXRlc3RIYXNoLAogICAgICAgIHJlbW92ZWQ6IGZhbHNlLAogICAgICAgIHVwZGF0ZUF2YWlsYWJsZTogYWJDb25maWdDdXJyZW50SGFzaCAhPT0gYWJDb25maWdMYXRlc3RIYXNoLAogICAgICAgIGxhdGVzdFVwZGF0ZXM6IGFiQ29uZmlnUmVzcG9uc2UuZGF0YS51cGRhdGVzLAogICAgICAgIGxhdGVzdFN0YXRlOiBhYkNvbmZpZ0xhdGVzdFN0YXRlLAogICAgfSkKfQoKaWYgKCFkZXRhaWxlZCAmJiAoYWJDb25maWdDdXJyZW50SGFzaCAhPT0gYWJDb25maWdMYXRlc3RIYXNoKSkgewogICAgLy8gSWYgd2UgYXJlIHJ1bm5pbmcgaW4gc2ltcGxlIG1vZGUsIHJldHVybiByaWdodCBhd2F5IG9uIHRoZSBmaXJzdCBvdXRkYXRlZCBmaWxlIGRpc2NvdmVyeS4KICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHVwZGF0ZUF2YWlsYWJsZTogdHJ1ZSB9Cn0KCi8vIDIuIENoZWNrIGlmIGFiIHNraWxscyBhcmUgb3V0ZGF0ZWQuCmNvbnN0IGFiU2tpbGxOYW1lcyA9IFsgJ2FiQ29yZScsIC4uLnRoaXNCb3QuYWJMb2FkZWRTa2lsbHMoKSBdOwpjb25zb2xlLmxvZyhgYWJTa2lsbE5hbWVzOmAsIGFiU2tpbGxOYW1lcyk7Cgpmb3IgKGxldCBpID0gMDsgaSA8IGFiU2tpbGxOYW1lcy5sZW5ndGg7IGkrKykgewogICAgY29uc3Qgc2tpbGxOYW1lID0gYWJTa2lsbE5hbWVzW2ldOwoKICAgIGxldCBza2lsbEN1cnJlbnRIYXNoOwogICAgaWYgKHNraWxsTmFtZSA9PT0gJ2FiQ29yZScpIHsKICAgICAgICBza2lsbEN1cnJlbnRIYXNoID0gYWIudGFncy5hYkNvcmVTb3VyY2VIYXNoOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBsb2FkZWRTa2lsbEJvdCA9IGdldEJvdChiID0+IGIudGFncy5hYkxvYWRlZFNraWxsID09PSBza2lsbE5hbWUgJiYgYi5zcGFjZSA9PT0gJ3NoYXJlZCcpOwogICAgICAgIGFzc2VydChsb2FkZWRTa2lsbEJvdCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjb3VsZCBub3QgZmluZCBsb2FkZWQgc2tpbGwgYm90IGZvciAke3NraWxsTmFtZX0uYCk7CgogICAgICAgIHNraWxsQ3VycmVudEhhc2ggPSBsb2FkZWRTa2lsbEJvdC50YWdzLmFiTG9hZGVkU2tpbGxTb3VyY2VIYXNoOwogICAgfQogICAgCiAgICB0cnkgewogICAgICAgIGNvbnN0IHNraWxsT3V0ZGF0ZWQgPSBhd2FpdCBjaGVja1NraWxsT3V0ZGF0ZWQoc2tpbGxOYW1lLCBza2lsbEN1cnJlbnRIYXNoKTsKCiAgICAgICAgaWYgKCFkZXRhaWxlZCAmJiBza2lsbE91dGRhdGVkKSB7CiAgICAgICAgICAgIC8vIElmIHdlIGFyZSBydW5uaW5nIGluIHNpbXBsZSBtb2RlLCByZXR1cm4gcmlnaHQgYXdheSBvbiB0aGUgZmlyc3Qgb3V0ZGF0ZWQgZmlsZSBkaXNjb3ZlcnkuCiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHVwZGF0ZUF2YWlsYWJsZTogdHJ1ZSB9CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDYXVnaCBhbiBlcnJvci5gLCBlKTsKICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9CiAgICB9Cn0KCmlmIChkZXRhaWxlZCkgewogICAgcmV0dXJuIHsKICAgICAgICBzdWNjZXNzOiB0cnVlLAogICAgICAgIHVwZGF0ZUF2YWlsYWJsZTogYWJGaWxlQ2hlY2tzLnNvbWUoZiA9PiBmLnVwZGF0ZUF2YWlsYWJsZSksCiAgICAgICAgYWJGaWxlQ2hlY2tzLAogICAgfQp9IGVsc2UgewogICAgLy8gSWYgd2UgbWFkZSBpdCBhbGwgdGhlIHdheSBoZXJlIGluIHNpbXBsZSBtb2RlLCB0aGVyZSBhcmUgbm8gb3V0ZGF0ZWQgZmlsZXMuCiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1cGRhdGVBdmFpbGFibGU6IGZhbHNlIH0KfScAjtPfqwYAEmFiQ29yZU1ham9yVmVyc2lvbgIEAI7T36sGwywCMTAnAI7T36sGABJhYkNvcmVNaW5vclZlcnNpb24CBACO09+rBsYsAjI1JwCO09+rBgAGc3lzdGVtAgQAjtPfqwbJLA1hYi5jb3JlLmxlYXJuJwCO09+rBgAEYWJJRAIEAI7T36sG1ywFbGVhcm4nAI7T36sGAARmb3JtAgQAjtPfqwbdLAdub3RoaW5nJwCO09+rBgAGYWJCb290AgQAjtPfqwblLMMqQC8qKgoqIE1JVCBMaWNlbnNlCioKKiBDb3B5cmlnaHQgKGMpIDIwMTkgQ2FzdWFsIFNpbXVsYXRpb24sIEluYy4KKgoqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAoqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCiogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKKgoqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbAoqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCioKKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgoqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAoqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQoqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLAoqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFCiogU09GVFdBUkUuCiogQGxpY2Vuc2UgTUlUCiovCgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib290aW5nIGFiYCk7Cn0KCi8vaW5zdCBtb2RlIChwbGF5ZXIgb3IgYnVpbGRlcikKbGV0IGluc3RNb2RlQ2hlY2sgPSBhd2FpdCBvcy52ZXJzaW9uKCkucGxheWVyTW9kZTsKLy9jaGVjayBzZWxmIGZvciBpbml0aWFsIGJvb3QgZGF0YQpsZXQgaW5pdGlhbEJvb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID8gdHJ1ZSA6IGZhbHNlOwovL2NoZWNrIHVybCBmb3IgcG9zc2libGUgYWIncyB0byBsb2FkCmxldCBib290RmxhZyA9IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gPyBjb25maWdCb3QudGFncy5wYXR0ZXJuIDogY29uZmlnQm90LnRhZ3MuYWI7Ci8vY2hlY2sgZm9yIGFzawpsZXQgYXNrID0gY29uZmlnQm90LnRhZ3MuYXNrOwovL2xvZ2luCmxldCBzdGF0dXMgPSBhd2FpdCB0aGlzQm90LmxvYWRpbmdTdGF0dXMoKTsKLy9zZWVkIChub3QgYWN0aXZlbHkgdXNlZCBoZXJlKQpsZXQgc2VlZCA9IGNvbmZpZ0JvdC50YWdzLnNlZWQ7Ci8vcHJvbXB0CmxldCBwcm9tcHQgPSBjb25maWdCb3QudGFncy5wcm9tcHQ7Ci8vY2hhbm5lbApsZXQgY2hhbm5lbCA9IGNvbmZpZ0JvdC50YWdzLmNoYW5uZWw7Ci8vdXVhYgpsZXQgdXVhYiA9IGNvbmZpZ0JvdC50YWdzLmF1eGxpbmsgPT0gInV1YWIiOwovL3ZlcnNpb24KbGV0IHZlcnNpb24gPSBjb25maWdCb3QudGFncy5wYXR0ZXJuVmVyc2lvbiA/PyBjb25maWdCb3QudGFncy5hYlZlcnNpb247Ci8vcmVxdWVzdCBhdXRoIGJvdAphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKLy9yZWRpcmVjdCBpZiBpbiBVUkwKaWYgKGNvbmZpZ0JvdC50YWdzLmpvaW5Db2RlKSB7CiAgICB0aGlzQm90LmFiSm9pbkhvc3QoeyB0ZXh0OiBjb25maWdCb3QudGFncy5qb2luQ29kZSB9KTsKfQoKLy9zdGF0dXMgY2xlYW4gdXAKZGVzdHJveShzdGF0dXMpOwoKLy9jaGVjayB0aW1lIGlmIG5lZWRlZAppZiAobGlua3MucmVtZW1iZXIudGFncy5hYkNvbmRpdGlvbikgewogICAgYXdhaXQgbGlua3MucmVtZW1iZXIuYWJDb25kaXRpb24oKTsKfQoKLy9pZiBubyBzdHVkaW8sIHNldCBzdHVkaW8KaWYgKGF1dGhCb3QgJiYgIWNvbmZpZ0JvdC50YWdzLnN0dWRpbykgewogICAgY29uZmlnQm90LnRhZ3Muc3R1ZGlvID0gYXV0aEJvdC5pZDsKfQoKaWYgKGF1dGhCb3QpIHsKICAgIHRoaXNCb3QuYWJMb2FkU3R1ZGlvcygpOwp9CgppZiAoIWxpbmtzLnBlcnNvbmFsaXR5KSB7IAogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYlBlcnNvbmFsaXR5Iik7Cn0KCi8vaW5pdGlhbGl6ZSByZW1lbWJlciBnbG9iYWxzCmdsb2JhbFRoaXMuYWJJbnN0TWVtb3J5ID0gbGlua3MucmVtZW1iZXI7Cmdsb2JhbFRoaXMuYWJSZW1lbWJlciA9IGxpbmtzLnJlbWVtYmVyOwpnbG9iYWxUaGlzLmFiUGVyc29uYWxpdHkgPSBsaW5rcy5wZXJzb25hbGl0eTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvcikgewogICAgZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3I7Cn0KCi8vVGhpcyBjaGVja3MgZm9yIHRoZSBhcHByb3ByaWF0ZSBhcnJheSBvZiBza2lsbHMgYW5kIGluaXRpYWxpemVzIHRoZW0KYXdhaXQgdGhpc0JvdC5hYlNraWxsSW5pdGlhbGl6YXRpb24oaW5zdE1vZGVDaGVjayk7CgovL2luaXRpYWxpemluZyBvZiBnbG9iYWwgdmFyaWFibGVzCmdsb2JhbFRoaXMuYnVpbGRlclZlcnNpb24gPSBpbnN0TW9kZUNoZWNrID09ICJidWlsZGVyIiA/IHRydWUgOiBmYWxzZTsKZ2xvYmFsVGhpcy5hYkxvbmdUZXJtTWVtb3J5U2VhcmNoID0gbGlua3Muc2VhcmNoOwpnbG9iYWxUaGlzLmFiU2VhcmNoID0gbGlua3Muc2VhcmNoOwpnbG9iYWxUaGlzLmFiUHVibGlzaCA9IGxpbmtzLnN0b3JlOwpnbG9iYWxUaGlzLmFiU3RvcmUgPSBsaW5rcy5zdG9yZTsKZ2xvYmFsVGhpcy5hYiA9IHRoaXNCb3Q7CgovL2NoZWNrIGZvciB1dWFicwppZiAodXVhYikgewogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYkFjdGlvbiIpOwoKICAgIGxpbmtzLmFzay5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiBjb25maWdCb3QudGFncy51dWFiLCBpc1VVQUI6IHRydWV9KTsKfQovL2NoZWNrIGZvciBjaGFubmVsIGlmIGNoYW5uZWxzIGFsbG93ZWQKZWxzZSBpZiAoY2hhbm5lbCAmJiBsaW5rcy5yZW1lbWJlci50YWdzLmFsbG93Q2hhbm5lbHMpIHsKICAgIGF3YWl0IHRoaXNCb3QuYWJBZGFwdCgiYWJBY3Rpb24iKTsKCiAgICBsaW5rcy5hc2suYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogY2hhbm5lbCwgaXNDaGFubmVsOiB0cnVlfSk7Cn0gZWxzZSB7CiAgICAvL3BvcHVsYXRlIGJvb3RmbGFnIGFiCiAgICBpZiAoaW5pdGlhbEJvb3QgJiYgYm9vdEZsYWcpIHsKICAgICAgICBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3MoeyBhYklEOiBib290RmxhZywgaW5pdGlhbEJvb3Q6IHRydWUsIGF1dG9IYXRjaDogdHJ1ZSwgc291cmNlRXZlbnQ6ICdib290JywgYWJWZXJzaW9uOiB2ZXJzaW9ufSk7CiAgICB9CgogICAgLy9sb29rdXAgYXNrSUQgaWYgYXZhaWxhYmxlCiAgICBpZiAoaW5pdGlhbEJvb3QgJiYgYXNrKSB7CiAgICAgICAgaWYgKGFzayA9PSAiZWdnQ2FydG9uIiB8fCBhc2sgPT0gImNhc3VhbFR1dG9yaWFsIikgewogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoYXNrKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJBZGFwdCgiYWJBY3Rpb24iKTsKCiAgICAgICAgICAgIGxpbmtzLmFzay5hYkNvcmVNZW51QWN0aW9uKGFzayk7CiAgICAgICAgfQogICAgfQp9CgovL2NoZWNrIGZvciBhcnRpZmFjdCBGSVgKaWYgKGNvbmZpZ0JvdC50YWdzLmFydGlmYWN0ICYmIGluaXRpYWxCb290ICYmICFhc2sgJiYgIWJvb3RGbGFnKSB7CiAgICBjb25zdCBhcnRpZmFjdCA9IGNvbmZpZ0JvdC50YWdzLmFydGlmYWN0OwogICAgY29uc3QgYXJ0SW5kZXggPSBhcnRpZmFjdC5pbmRleE9mKCJfYXJ0XyIpOwogICAgY29uc3Qgc3R1ZGlvID0gYXJ0aWZhY3Quc3Vic3RyaW5nKDAsIGFydEluZGV4KTsKICAgIGNvbnN0IHJlY29yZEFkZHJlc3MgPSBhcnRpZmFjdC5zdWJzdHJpbmcoYXJ0SW5kZXgpOwogICAgY29uc3QgcmVjb3JkRGF0YSA9IGF3YWl0IG9zLmdldERhdGEoc3R1ZGlvLCByZWNvcmRBZGRyZXNzKTsKICAgIGNvbnN0IGFza0lEID0gcmVjb3JkRGF0YS5kYXRhLnBhdHRlcm47CgogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYkFjdGlvbiIpOwoKICAgIGxpbmtzLmFzay5hYkNvcmVNZW51QWN0aW9uKGFza0lEKTsKfQoKLy8gQ2hlY2sgaWYgd2UgY2FuIHdha2UgdXAgYWIsIGFuZCB0aGVuIGRvIHNvLgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU2xlZXApIHsKICAgIGlmICgoaW5pdGlhbEJvb3QgJiYgIWJvb3RGbGFnICYmICFhc2spIHx8IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBbHdheXNTdGFydEF3YWtlIHx8IGNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICAgICAgYXdhaXQgbGlua3MubWFuaWZlc3RhdGlvbi5hYlNldEF3YWtlKHsgYXdha2U6IHRydWUsIGluaXRpYWw6IGluaXRpYWxCb290IH0pOwogICAgfQp9CgovL3NldCBpbml0aWFsIGJvb3QgZGF0YQppZiAoaW5pdGlhbEJvb3QpIHsKICAgIHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICdpbml0aWFsQm9vdCcsIGZhbHNlLCAnc2hhcmVkJyk7CgogICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsaXphdGlvbkNvbmZpZ3VyYXRpb24pIHsKICAgICAgICBsaW5rcy5yZW1lbWJlci5hYkluaXRpYWxpemF0aW9uQ29uZmlndXJhdGlvbigpOwogICAgfQp9CgovL2NsZWFuIHVwIFVSTCB3aXRoIHRhZ1BvcnRhbAppZiAoY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsICYmICFjb25maWdCb3QudGFncy50YWdQb3J0YWxBbmNob3JQb2ludCAmJiBidWlsZGVyVmVyc2lvbikgewogICAgY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsID0gbnVsbDsKICAgIGNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKfQoKLy9wYXVzZSBmb3IgYWIgbG9hZGluZwphd2FpdCBvcy5zbGVlcCg1MDApOwoKLy9pbml0aWFsaXplIHRpbWUgYm90CnRoaXNCb3QuYWJUaW1lcigpOwoKbGlua3MucGVyc29uYWxpdHkudXBkYXRlUGVyc29uYWxpdHkoKTsKCi8vaW5pdGlhbGl6YXRpb24gc2hvdXQKc3VwZXJTaG91dCgib25BQkluaXRpYWxpemVkIiwgdGFncy5hYkluc3QpOygAjtPfqwYABmFiQ29yZQF4JwCO09+rBgAHYWJBZGFwdAIEAI7T36sGqle+FEBsZXQgc2tpbGxOYW1lOwpsZXQgc2tpbGxEYXRhOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKaWYgKHR5cGVvZiB0aGF0ID09PSAnc3RyaW5nJykgewogICAgc2tpbGxOYW1lID0gdGhhdDsKICAgIHNraWxsRGF0YSA9IG51bGw7Cn0gZWxzZSBpZiAodHlwZW9mIHRoYXQgPT09ICdvYmplY3QnKSB7CiAgICBza2lsbE5hbWUgPSB0aGF0LnN5c3RlbUlEID8/IHRoYXQuc2tpbGxOYW1lOwogICAgc2tpbGxEYXRhID0gdGhhdC5kYXRhID8/IG51bGw7Cn0KCmlmICghc2tpbGxOYW1lKSB7CiAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2tpbGxOYW1lIGlzIHJlcXVpcmVkLmApOwogICAgcmV0dXJuIGZhbHNlOwp9CgppZiAoc2tpbGxOYW1lID09PSAnYWJDb3JlJykgewogICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX19XSBhYkNvbmZpZyBjYW5ub3QgYmUgbG9hZGVkIHVzaW5nIGFiQWRhcHQuYCk7CiAgICByZXR1cm47Cn0KCnRyeSB7CiAgICBjb25zdCBsb2FkZWRTa2lsbHMgPSB0aGlzQm90LmFiTG9hZGVkU2tpbGxzKCk7CgogICAgaWYgKCFsb2FkZWRTa2lsbHMuaW5jbHVkZXMoc2tpbGxOYW1lKSkgewogICAgICAgIGNvbnN0IHVybCA9IHRoaXNCb3QuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwoYC9hYi8ke3NraWxsTmFtZX0uYXV4YCk7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB3ZWIuaG9vayh7IG1ldGhvZDogIkdFVCIsIHVybCB9KTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYiBza2lsbCBHRVQgcmVzcG9uc2U6YCwgcmVzcG9uc2UpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGRvd25sb2FkICR7c2tpbGxOYW1lfS4gUmVzcG9uc2U6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIAogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnZlcnNpb24gPT09IDIpIHsKICAgICAgICAgICAgLy8gQVVYIEZvcm1hdCBWZXJzaW9uIDIuCiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZXMgPSByZXNwb25zZS5kYXRhLnVwZGF0ZXM7CiAgICAgICAgICAgIGF3YWl0IG9zLmFwcGx5VXBkYXRlc1RvSW5zdCh1cGRhdGVzKTsKICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSBhd2FpdCBvcy5nZXRJbnN0U3RhdGVGcm9tVXBkYXRlcyh1cGRhdGVzKTsKICAgICAgICAgICAgY29uc3Qgc291cmNlSGFzaCA9IGNyeXB0by5oYXNoKCdzaGExJywgJ2hleCcsIHN0YXRlKTsKCiAgICAgICAgICAgIC8vIExvYWRlZCBza2lsbHMgYXJlIHN0b3JlZCBhcyBzaGFyZWQgYm90cyB0aGF0IGFueW9uZSBpbiB0aGUgaW5zdCBjYW4gcmVhZC4KICAgICAgICAgICAgY3JlYXRlKHsKICAgICAgICAgICAgICAgIHNwYWNlOiAnc2hhcmVkJywKICAgICAgICAgICAgICAgIGFiSWdub3JlOiB0cnVlLAogICAgICAgICAgICAgICAgYWJMb2FkZWRTa2lsbDogc2tpbGxOYW1lLAogICAgICAgICAgICAgICAgYWJMb2FkZWRTa2lsbFNvdXJjZUhhc2g6IHNvdXJjZUhhc2gsCiAgICAgICAgICAgICAgICBmb3JtOiAnbm90aGluZycsCiAgICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIEFVWCBmb3JtYXQgdmVyc2lvbiAke3Jlc3BvbnNlLmRhdGEudmVyc2lvbn0gaXMgbm90IHN1cHBvcnRlZC5gKTsKICAgICAgICB9CgogICAgfSBlbHNlIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFiIHNraWxsICR7c2tpbGxOYW1lfSBpcyBhbHJlYWR5IGxvYWRlZC5gKQogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBza2lsbEJvdHMgPSBnZXRCb3RzKGIgPT4gYi50YWdzW3NraWxsTmFtZV0gPT09IHRydWUpOwogICAgaWYgKHNraWxsQm90cyAmJiBza2lsbEJvdHMubGVuZ3RoID4gMCkgewogICAgICAgIHdoaXNwZXIoc2tpbGxCb3RzLCB0YWdOYW1lLCBjb25maWdCb3QudGFncy5pbnN0KTsKICAgICAgICB3aGlzcGVyKHNraWxsQm90cywgIm9uU2tpbGxVcGRhdGUiLCB7IGRhdGE6IHNraWxsRGF0YSB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIE5vIGJvdHMgYXBwZWFyIHRvIGhhdmUgYmVlbiBsb2FkZWQgd2l0aCAke3NraWxsTmFtZX0uYCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJldHVybiB0cnVlOwp9IGNhdGNoIChlKSB7CiAgICBjb25zb2xlLmVycm9yKGUpOwogICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIEZhaWxlZCB0byBkb3dubG9hZCAke3NraWxsTmFtZX0uIFNlZSBhYm92ZSBlcnJvci5gKTsKICAgIHJldHVybiBmYWxzZTsKfScAjtPfqwYAC2Rlc2NyaXB0aW9uAgQAjtPfqwbpa09UaGlzIHNraWxsIGlzIGRlc2lnbmVkIHRvIGhhbmRsZSBib3RoIHJlY29uZmlndXJhdGlvbiBvZiBhYiBhbmQgaW5pdGlhbGl6YXRpb24uJwCO09+rBgAKb25Cb3RBZGRlZAIEAI7T36sGuWzxAUBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFiQ29yZSBTVEFSVCBVUGApOwoKdGhpc0JvdC5hYkluc3RVcGRhdGUoKTsKCmlmICghbGlua3MucmVtZW1iZXIpIHsKICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZmluZCBhYkNvbmZpZyByZW1lbWJlciBib3QuYCk7Cn0KCnNldFRpbWVvdXQoKCkgPT4gdGhpc0JvdC5hYkJvb3QoKSwgNTAwKTsnAI7T36sGAAhyZW1lbWJlcgIEAI7T36sGq24o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAjtPfqwYAA2xvZwIEAI7T36sG0m5sQC8vcGFzcyB0aHJvdWdoIGxvZyBkYXRhCmlmIChsaW5rcy5jb25zb2xlKSB7CiAgICBsaW5rcy5jb25zb2xlLmxvZyh0aGF0KTsKfQplbHNlIHsKICAgIGNvbnNvbGUubG9nKHRoYXQpOwp9JwCO09+rBgANbWFuaWZlc3RhdGlvbgIEAI7T36sGv28o8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAjtPfqwYADGFiQ3JlYXRlSG9zdAIEAI7T36sG5m+WCkBjb25zdCBzaXRlT3JpZ2luID0gbmV3IFVSTChjb25maWdCb3QudGFncy51cmwpLm9yaWdpbjsKCi8vdGhpcyBmdW5jdGlvbiBoYW5kbGVzIGNyZWF0aW5nIGEgZmlsZSBmb3Igam9pbiBjb2RlcwppZiAobGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQpIHsKICAgIG9zLnRvYXN0KCJ1cmwgY29waWVkIHRvIGNsaXBib2FyZCIpOwoKICAgIG9zLnNldENsaXBib2FyZChzaXRlT3JpZ2luICsgIi8/am9pbkNvZGU9IiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygwLCAzKSArICItIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygzKSk7CgogICAgcmV0dXJuOwp9CgppZiAoIWF1dGhCb3QpIHsKICAgIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7Cn0KCmlmICghYXV0aEJvdCkgewogICAgb3MudG9hc3QoInBsZWFzZSBsb2cgaW4gdG8gZ2VuZXJhdGUgYSBqb2luIGNvZGUiKTsKICAgIHJldHVybjsKfQoKY29uc3QgbmV3SG9zdElEID0gdXVpZCgpLnJlcGxhY2VBbGwoIi0iLCAiIikuc3Vic3RyaW5nKDAsIDYpOwpjb25zdCBkYXRlID0gRGF0ZVRpbWUubm93KCkudG9NaWxsaXMoKTsKY29uc3QgcmVjb3JkS2V5ID0gbGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleTsKY29uc3QgcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEocmVjb3JkS2V5LCBuZXdIb3N0SUQsIHsgdXJsOiBjb25maWdCb3QudGFncy51cmwsIGRhdGU6IGRhdGUsIG1hcmtlcnM6IFsicHVibGljUmVhZCJdIH0pOwoKaWYgKHJlY29yZERhdGEuc3VjY2VzcykgewogICAgc2V0VGFnTWFzayhsaW5rcy5yZW1lbWJlciwgJ2hvc3RJRCcsIG5ld0hvc3RJRC5zdWJzdHJpbmcoMCwgMykgKyAiLSIgKyBuZXdIb3N0SUQuc3Vic3RyaW5nKDMpLCAnc2hhcmVkJyk7CgogICAgY29uc3Qgam9pblVSTCA9IHNpdGVPcmlnaW4gKyAiLz9qb2luQ29kZT0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQ7CgogICAgb3Muc2V0Q2xpcGJvYXJkKGpvaW5VUkwpOwoKICAgIHRoYXQudGFncy5sYWJlbCA9ICJqb2luIGNvZGU6ICIgKyBuZXdIb3N0SUQuc3Vic3RyaW5nKDAsIDMpICsgIi0iICsgbmV3SG9zdElELnN1YnN0cmluZygzKTsKCiAgICBvcy5zaG93UVJDb2RlKGpvaW5VUkwpOwoKICAgIG9zLnRvYXN0KCJob3N0IGdlbmVyYXRlZCwgdXJsIGNvcGllZCB0byBjbGlwYm9hcmQ6ICIgKyBuZXdIb3N0SUQpOwp9CmVsc2UgewogICAgb3MudG9hc3QoInNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluIik7CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfScAjtPfqwYACmFiSm9pbkhvc3QCBACO09+rBv157gZALy9sb2dpYyBmb3IgdXNpbmcgYSBqb2luIGNvZGUgKGNoZWNrcyBmb3IgZXhpc3RpbmcgZmlsZXMpCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsZXQgZ2V0UmVjb3JkOwoKaWYgKHRoYXQuZGF0YSkgewogICAgZ2V0UmVjb3JkID0geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB0aGF0LmRhdGEgfTsKfQplbHNlIHsKICAgIGNvbnN0IGpvaW5Db2RlID0gdGhhdC50ZXh0LnJlcGxhY2VBbGwoIi0iLCAiIik7CiAgICBjb25zdCByZWNvcmRLZXkgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5OwogICAgY29uc29sZS5sb2coIkpPSU5DT0RFIiwgam9pbkNvZGUpCiAgICBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKHJlY29yZEtleSwgam9pbkNvZGUpOwp9CgppZiAoZ2V0UmVjb3JkLnN1Y2Nlc3MpIHsKICAgIGNvbnN0IGRhdGUgPSBEYXRlVGltZS5ub3coKTsKICAgIGxldCBjcmVhdGVEYXRlID0gRGF0ZVRpbWUuZnJvbU1pbGxpcyhnZXRSZWNvcmQuZGF0YS5kYXRlKTsKICAgIGxldCBkaWZmZXJlbmNlID0gZGF0ZS5kaWZmKGNyZWF0ZURhdGUsICJkYXlzIikudG9PYmplY3QoKTsKCiAgICBkaWZmZXJlbmNlID0gTWF0aC5mbG9vcihkaWZmZXJlbmNlLmRheXMpOwoKICAgIGlmIChkaWZmZXJlbmNlIDwgOCkgewogICAgICAgIG9zLnRvYXN0KCJqb2luaW5nIGhvc3Qgbm93Iik7CgogICAgICAgIG9zLmdvVG9VUkwoZ2V0UmVjb3JkLmRhdGEudXJsKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIG9zLnRvYXN0KCJqb2luIGNvZGUgb3V0IG9mIGRhdGUsIHBsZWFzZSBnZW5lcmF0ZSBhIG5ldyBqb2luIGNvZGUiKTsKICAgIH0KfQplbHNlIHsKICAgIG9zLnRvYXN0KCJjb2RlL2FiIGludmFsaWQsIHBsZWFzZSB0cnkgYWdhaW4iKTsKfScAjtPfqwYABnNlYXJjaAIEAI7T36sG7IABKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAI7T36sGAAhhYklnbm9yZQIEAI7T36sGk4EBBHRydWUnAI7T36sGAARtZW51AgQAjtPfqwaYgQEo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAjtPfqwYAFWFiU2tpbGxJbml0aWFsaXphdGlvbgIEAI7T36sGv4EBowJALy9GaW5kIHRoZSBhcHByb3ByaWF0ZSBhcnJheSBhbmQgcG9wdWxhdGUgc2tpbGxzCmxldCBza2lsbEFycmF5ID0gbGlua3MucmVtZW1iZXIudGFnc1t0aGF0ICsgIlNraWxsQXJyYXkiXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgc2tpbGxBcnJheS5sZW5ndGg7IGkrKykgewogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KHNraWxsQXJyYXlbaV0pOwp9CgppZiAoY29uZmlnQm90LnRhZ3MuZW1iZWQgPT09ICdpb3MnKSB7CiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoJ2FiSU9TQnJpZGdlJyk7Cn0KCnJldHVybjsnAI7T36sGAAZiYW5uZXICBACO09+rBuODASjwn5SXYjU1MmVhZjktYTlkNi00MWM4LTg1MTUtY2JkMmFiZWFhZTczJwCO09+rBgAFaW5wdXQCBACO09+rBoqEASjwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwCO09+rBgANbG9hZGluZ1N0YXR1cwIEAI7T36sGsYQBxgdAY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJMb2FkU3RhdHVzIjsKCmxldCBzdGF0dXNCb3QgPSB7fTsKCnN0YXR1c0JvdC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpzdGF0dXNCb3QubGFiZWwgPSAidmVyaWZ5aW5nIGF1dGhCb3QiOwpzdGF0dXNCb3QubGFiZWxDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CnN0YXR1c0JvdC5hYkxvYWRTdGF0dXMgPSB0cnVlOwpzdGF0dXNCb3QubWVudUl0ZW1TdHlsZSA9IHsgImJhY2tncm91bmQiOiAibm9uZSIgfTsKc3RhdHVzQm90LnRyYWNrTnVtID0gMDsKc3RhdHVzQm90Lm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpIHsKICAgICAgICB0YWdzLnRyYWNrTnVtID0gMDsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHRhZ3MudHJhY2tOdW0rKzsKICAgIH0KCiAgICB0YWdzLmxhYmVsID0gdGFnc1sibGFiZWwiK3RhZ3MudHJhY2tOdW1dOwogICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3NbImZvcm0iK3RhZ3MudHJhY2tOdW1dOwoKICAgIHNldFRpbWVvdXQoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAib25DcmVhdGUiKSwgNTAwKTtgOwpzdGF0dXNCb3QubGFiZWwwID0gInZlcmlmeWluZyBhdXRoQm90LiI7CnN0YXR1c0JvdC5sYWJlbDEgPSAidmVyaWZ5aW5nIGF1dGhCb3QuLiI7CnN0YXR1c0JvdC5sYWJlbDIgPSAidmVyaWZ5aW5nIGF1dGhCb3QuLi4iOwpzdGF0dXNCb3QuZm9ybTAgPSAiaG91cmdsYXNzX2JvdHRvbSI7CnN0YXR1c0JvdC5mb3JtMSA9ICJob3VyZ2xhc3NfdG9wIjsKc3RhdHVzQm90LmZvcm0yID0gImhvdXJnbGFzc19ib3R0b20iOwpzdGF0dXNCb3Qub25EZXN0cm95ID0gYEAKICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKYDsKCmxldCBjcmVhdGVkU3RhdHVzQm90ID0gY3JlYXRlKHN0YXR1c0JvdCk7CgpyZXR1cm4gY3JlYXRlZFN0YXR1c0JvdDsnAI7T36sGAANhc2sCBACO09+rBviLASjwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCO09+rBgANYWJMb2FkU3R1ZGlvcwIEAI7T36sGn4wBW0Bjb25zdCB1c2VyU3R1ZGlvcyA9IGF3YWl0IG9zLmxpc3RVc2VyU3R1ZGlvcygpOwpjb25maWdCb3QudGFncy51c2VyX3N0dWRpb3MgPSB1c2VyU3R1ZGlvczsnAI7T36sGAAdhYlRpbWVyAgQAjtPfqwb7jAHBBkBpZiAoZ2V0Qm90KCJhYlRpbWVyIiwgdHJ1ZSkpIHsKICAgIHJldHVybjsKfQoKaWYgKCF0YWdzLmFiWFApIHsKICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiWFAiLCAiMCIsICJsb2NhbCIpOwp9CgpsZXQgdGltZXJCb3QgPSB7fTsKCnRpbWVyQm90LnNwYWNlID0gInRlbXBMb2NhbCI7CnRpbWVyQm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwp0aW1lckJvdC5vbkNyZWF0ZSA9IGBACiAgICBtYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHRoaXNCb3Qub25UaW1lQ2hlY2soKSwgNjAwMDApOwpgOwp0aW1lckJvdC5hYlRpbWVyID0gdHJ1ZTsKdGltZXJCb3Qub25UaW1lQ2hlY2sgPSBgQAogICAgaWYgKHRhZ3Mubm90SWRsZSkgewogICAgICAgIHRhZ3Mubm90SWRsZSA9IGZhbHNlOwoKICAgICAgICAvL2NvbnNvbGUubG9nKCJYUCIsIGxpbmtzLm1hbmFnZXIudGFncy5hYlhQKTsKCiAgICAgICAgY29uc3QgdG90YWxYUCA9IGxpbmtzLm1hbmFnZXIudGFncy5hYlhQICsgMTsKCiAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5tYW5hZ2VyLCAiYWJYUCIsIHRvdGFsWFAsICJsb2NhbCIpOwogICAgfQpgOwp0aW1lckJvdC5ub3RJZGxlID0gZmFsc2U7CnRpbWVyQm90Lm9uQW55QWN0aW9uID0gYEAKICAgIGlmICghdGFncy5ub3RJZGxlKSB7CiAgICAgICAgaWYgKHRoYXQuYWN0aW9uLmlkID09IGdyaWRQb3J0YWxCb3QuaWQpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLm5vdElkbGUgPSB0cnVlOwogICAgICAgIH0KICAgIH0KYDsKCmxldCBhYlRpbWVyID0gY3JlYXRlKHRpbWVyQm90KTsKCmdsb2JhbFRoaXMuYWJUaW1lciA9IGFiVGltZXI7JwCO09+rBgAFc3RvcmUCBACO09+rBr2TASjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCO09+rBgAHY29uc29sZQIEAI7T36sG5JMBKPCflJcyNGI3ZTY2Zi0wZDViLTQwNjQtYmY0OC1iNTYyYjllNmUzZWInAI7T36sGAAlhYlZlcnNpb24CBACO09+rBouUAQUxMC4yNScAjtPfqwYADGFiTG9hZENvbmZpZwIEAI7T36sGkZQBmgZAY29uc3QgdXJsID0gbmV3IFVSTChvcy5nZXRBQjFCb290c3RyYXBVUkwoKSk7CnVybC5wYXRobmFtZSA9IHVybC5wYXRobmFtZS5yZXBsYWNlKCdhYjEuYXV4JywgJ2FiQ29uZmlnLmF1eCcpOwoKdHJ5IHsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgd2ViLmhvb2soeyBtZXRob2Q6ICJHRVQiLCB1cmw6IHVybC5ocmVmIH0pOwoKICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGRvd25sb2FkIGFiQ29uZmlnLiBSZXNwb25zZTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCB1cGRhdGVzID0gcmVzcG9uc2UuZGF0YS51cGRhdGVzOwogICAgYXdhaXQgb3MuYXBwbHlVcGRhdGVzVG9JbnN0KHVwZGF0ZXMpOwoKICAgIGlmIChsaW5rcy5yZW1lbWJlcikgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gTG9hZGVkIGFiQ29uZmlnIGF1eCBidXQgY291bGQgbm90IGZpbmQgcmVtZW1iZXIgYm90LmApOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcihlKTsKICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBGYWlsZWQgdG8gZG93bmxvYWQgYWJDb25maWcuIFNlZSBhYm92ZSBlcnJvci5gKTsKICAgIHJldHVybiBmYWxzZTsKfScAjtPfqwYAF2FiQnVpbGRDYXN1YWxDYXRhbG9nVVJMAgQAjtPfqwasmgH/AUBjb25zdCByZWxhdGl2ZVBhdGggPSB0aGF0OwoKY29uc3QgdXJsID0gbmV3IFVSTChsaW5rcy5yZW1lbWJlci50YWdzLmNhc3VhbENhdGFsb2dVUkwpOwpjb25zdCBlbnYgPSBsaW5rcy5yZW1lbWJlci50YWdzLmNhc3VhbENhdGFsb2dFbnY7Cgp1cmwucGF0aG5hbWUgPSByZWxhdGl2ZVBhdGg7CgppZiAoZW52ICYmIGVudiAhPT0gJ3Byb2QnKSB7CiAgICB1cmwuc2VhcmNoUGFyYW1zLnNldCgnZW52JywgZW52KTsKfQoKcmV0dXJuIHVybC5ocmVmOycAjtPfqwYAB2NoYW5uZWwCBACO09+rBqycASjwn5SXYTliNmFhMGQtYjM1Ny00ZGU2LTliZWYtODUzNDhhYjFkMGUwJwCO09+rBgALcGVyc29uYWxpdHkCBACO09+rBtOcASjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwCO09+rBgAMYWJJbnN0VXBkYXRlAgQAjtPfqwb6nAGiAUAvLyBVcGRhdGUgdGhlIGFiSW5zdCB0YWcgd2hpY2ggcmVwcmVzZW50cyB0aGUgaW5zdCB0aGF0IHRoaXMgYWIgZXhpc3RzIGluLgpjb25zdCBjdXJJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKc2V0VGFnTWFzayh0aGlzQm90LCAnYWJJbnN0JywgY3VySW5zdCwgJ3NoYXJlZCcpOycAjtPfqwYADG9uSW5zdEpvaW5lZAIEAI7T36sGnZ4BGEB0aGlzQm90LmFiSW5zdFVwZGF0ZSgpOycAjtPfqwYAC29uSW5zdExlYXZlAgQAjtPfqwa2ngEYQHRoaXNCb3QuYWJJbnN0VXBkYXRlKCk7JwCO09+rBgAMcmVzZXJ2ZWRBc2tzAgQAjtPfqwbPngEM8J+nrFsiaG9tZSJdJwCO09+rBgAIYXJ0aWZhY3QCBACO09+rBtqeASjwn5SXNzhlNDE1MDMtYzkzMy00ZjhhLTgxN2EtYmE5N2JmOGQ1ZDI3JwCO09+rBgALYm90X2ZhY3RvcnkCBACO09+rBoGfASjwn5SXYzc4YWE2NjMtZDA1Yy00ZWM0LWJjMmMtMjZmZDUxNTYwYjk3JwCO09+rBgAFdXRpbHMCBACO09+rBqifASjwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwCO09+rBgAIdXBkYXRlQUICBACO09+rBs+fAZUpQGNvbnN0IHJlbG9hZFBhZ2UgPSB0aGF0Py5yZWxvYWRQYWdlID8/IHRydWU7DQpjb25zdCBzaG93SW5kaWNhdG9yID0gdGhhdD8uc2hvd0luZGljYXRvciA/PyB0cnVlOw0KDQpjb25zdCBEUllfUlVOID0gZmFsc2U7DQoNCmxldCBidXN5SW5kaWNhdG9yOw0KDQppZiAoc2hvd0luZGljYXRvcikgew0KICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gJ3VwZGF0ZUFCTWVudSc7DQogICAgYnVzeUluZGljYXRvciA9IGF3YWl0IGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcih7IHVwZGF0ZUFCTWVudTogdHJ1ZSwgbGFiZWw6IGB1cGRhdGluZyAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9YCB9KTsNCn0NCg0KbGV0IG92ZXJ3cml0ZVJlc3VsdDsNCg0KdHJ5IHsNCiAgICAvLyBVcGRhdGUgYWJDb25maWcuDQogICAgY29uc3QgYWJDb25maWdVUkwgPSBvcy5nZXRBQjFCb290c3RyYXBVUkwoKTsNCiAgICBjb25zdCBhYkNvbmZpZ1Jlc3BvbnNlID0gYXdhaXQgd2ViaG9vayh7IG1ldGhvZDogIkdFVCIsIHVybDogYWJDb25maWdVUkwgfSk7DQoNCiAgICBhc3NlcnQoYWJDb25maWdSZXNwb25zZS5zdGF0dXMgPT09IDIwMCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgYWJDb25maWcuIFJlc3BvbnNlOiAke2FiQ29uZmlnUmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsNCiAgICBhc3NlcnQoYWJDb25maWdSZXNwb25zZS5kYXRhLnZlcnNpb24gPT09IDIsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWJDb25maWcgbXVzdCBiZSBpbiBhdXggZmlsZSBmb3JtYXQgdjIuIEFjdHVhbCBhdXggZmlsZSBmb3JtYXQgdmVyc2lvbjogJHthYkNvbmZpZ1Jlc3BvbnNlLmRhdGEudmVyc2lvbn1gKTsNCg0KICAgIG92ZXJ3cml0ZVJlc3VsdCA9IGF3YWl0IHRoaXNCb3QuYXV4VjJPdmVyd3JpdGUoeyBhdXg6IGFiQ29uZmlnUmVzcG9uc2UuZGF0YSwgZ3JvdXBUYWc6ICdhYkNvbmZpZycsIGRyeVJ1bjogRFJZX1JVTiB9KTsNCiAgICBzZXRUYWdNYXNrKGFiLmxpbmtzLnJlbWVtYmVyLCAnYWJDb25maWdTb3VyY2VIYXNoJywgb3ZlcndyaXRlUmVzdWx0LnNvdXJjZUhhc2gsICdzaGFyZWQnKTsNCg0KICAgIC8vIFVwZGF0ZSBhYiBza2lsbHMuDQogICAgY29uc3QgbG9hZGVkU2tpbGxzID0gdGhpc0JvdC5hYkxvYWRlZFNraWxscygpOw0KDQogICAgZm9yIChsZXQgc2tpbGxOYW1lIG9mIGxvYWRlZFNraWxscykgew0KICAgICAgICBjb25zdCBza2lsbFVSTCA9IHRoaXNCb3QuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwoYC9hYi8ke3NraWxsTmFtZX0uYXV4YCk7DQoNCiAgICAgICAgLy8gU2tpbGxzIGNhbiBiZSByZXN0cnVjdHVyZWQsIG1lYW5pbmcgdGhhdCB0aGV5IGNvdWxkIGJlIHJlbW92ZWQgZW50aXJlbHkgaW4gdGhlIGZ1dHVyZS4NCiAgICAgICAgLy8gSWYgYSBmaWxlIGZhaWxzIHRvIGJlIHJldHJpZXZlZCwgdGhlbiByZW1vdmUgYWxsIHRoZSBib3RzIGluIHRoZSBncm91cCBpbiB0aGUgaW5zdC4NCiAgICAgICAgbGV0IHJlbW92ZVNraWxsID0gZmFsc2U7DQogICAgICAgIGxldCBza2lsbFJlc3BvbnNlOw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBza2lsbFJlc3BvbnNlID0gYXdhaXQgd2ViaG9vayh7IG1ldGhvZDogIkdFVCIsIHVybDogc2tpbGxVUkwgfSk7DQoNCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBza2lsbFJlc3BvbnNlOmAsIHNraWxsUmVzcG9uc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBhc3NlcnQoc2tpbGxSZXNwb25zZS5kYXRhLnZlcnNpb24gPT09IDIsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gJHtza2lsbE5hbWV9IG11c3QgYmUgaW4gYXV4IGZpbGUgZm9ybWF0IHYyLiBBY3R1YWwgYXV4IGZpbGUgZm9ybWF0IHZlcnNpb246ICR7c2tpbGxSZXNwb25zZS5kYXRhLnZlcnNpb259YCk7DQoNCiAgICAgICAgICAgIGlmIChza2lsbFJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7DQogICAgICAgICAgICAgICAgaWYgKHNraWxsUmVzcG9uc2Uuc3RhdHVzID09PSA0MDMgfHwgc2tpbGxSZXNwb25zZS5zdGF0dXMgPT09IDQwNCkgew0KICAgICAgICAgICAgICAgICAgICByZW1vdmVTa2lsbCA9IHRydWU7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGRvd25sb2FkICR7c2tpbGxOYW1lfS4gUmVzcG9uc2U6ICR7c2tpbGxSZXNwb25zZS5zdGF0dXNUZXh0fWApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhdWdodCBlcnJvciB3aGlsZSBkb3dubG9hZGluZyBza2lsbDpgLCBlKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGUucmVzcG9uc2U/LnN0YXR1cyA9PT0gNDAzIHx8IGUucmVzcG9uc2U/LnN0YXR1cyA9PT0gNDA0KSB7DQogICAgICAgICAgICAgICAgLy8gRmlsZSBkb2VzbnQgZXhpc3QgYW55bW9yZSwgdGhlIHNraWxsIGhhcyBiZWVuIHJlbW92ZWQuDQogICAgICAgICAgICAgICAgcmVtb3ZlU2tpbGwgPSB0cnVlOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiAoc2tpbGxSZXNwb25zZSAmJiAhcmVtb3ZlU2tpbGwpIHsNCiAgICAgICAgICAgIG92ZXJ3cml0ZVJlc3VsdCA9IGF3YWl0IHRoaXNCb3QuYXV4VjJPdmVyd3JpdGUoeyBhdXg6IHNraWxsUmVzcG9uc2UuZGF0YSwgZ3JvdXBUYWc6IHNraWxsTmFtZSwgZHJ5UnVuOiBEUllfUlVOIH0pOw0KDQogICAgICAgICAgICBjb25zdCBsb2FkZWRTa2lsbEJvdCA9IGdldEJvdChiID0+IGIudGFncy5hYkxvYWRlZFNraWxsID09PSBza2lsbE5hbWUgJiYgYi5zcGFjZSA9PT0gJ3NoYXJlZCcpOw0KICAgICAgICAgICAgYXNzZXJ0KGxvYWRlZFNraWxsQm90LCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNvdWxkIG5vdCBmaW5kIGxvYWRlZCBza2lsbCBib3QgZm9yICR7c2tpbGxOYW1lfS5gKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgc2V0VGFnTWFzayhsb2FkZWRTa2lsbEJvdCwgJ2FiTG9hZGVkU2tpbGxTb3VyY2VIYXNoJywgb3ZlcndyaXRlUmVzdWx0LnNvdXJjZUhhc2gsICdzaGFyZWQnKTsNCiAgICAgICAgfSBlbHNlIGlmIChyZW1vdmVTa2lsbCkgew0KICAgICAgICAgICAgY29uc3Qgc2tpbGxCb3RzID0gZ2V0Qm90cyhiID0+IGIudGFnc1tza2lsbE5hbWVdID09PSB0cnVlKTsNCg0KICAgICAgICAgICAgaWYgKERSWV9SVU4pIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRyeSBydW46IHdvdWxkIGRlbGV0ZSAke3NraWxsQm90cy5sZW5ndGh9ICR7c2tpbGxOYW1lfSBib3QocykgYmVjYXVzZSAke3NraWxsTmFtZX0gaXMgbm8gbG9uZ2VyIGluIHRoZSBjYXN1YWwgY2F0YWxvZy5gKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBTa2lsbCAke3NraWxsTmFtZX0gaXMgbm8gbG9uZ2VyIGluIHRoZSBjYXN1YWwgY2F0YWxvZy4gUmVtb3ZlICR7c2tpbGxCb3RzLmxlbmd0aH0gJHtza2lsbE5hbWV9IGJvdChzKSBmcm9tIGluc3QuYCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGRlc3Ryb3koc2tpbGxCb3RzKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIFVwZGF0ZSBhYkNvcmUgKGRvIHRoaXMgb25lIGxhc3QhKQ0KICAgIGNvbnN0IGFiQ29yZVVSTCA9IHRoaXNCb3QuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwoJy9hYi9hYkNvcmUuYXV4Jyk7DQogICAgY29uc3QgYWJDb3JlUmVzcG9uc2UgPSBhd2FpdCB3ZWIuaG9vayh7IG1ldGhvZDogIkdFVCIsIHVybDogYWJDb3JlVVJMIH0pOw0KDQogICAgYXNzZXJ0KGFiQ29yZVJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIENvdWxkIG5vdCBkb3dubG9hZCBhYkNvcmUuIFJlc3BvbnNlOiAke2FiQ29yZVJlc3BvbnNlLnN0YXR1c1RleHR9YCk7DQogICAgYXNzZXJ0KGFiQ29yZVJlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvcmUgbXVzdCBiZSBpbiBhdXggZmlsZSBmb3JtYXQgdjIuIEFjdHVhbCBhdXggZmlsZSBmb3JtYXQgdmVyc2lvbjogJHthYkNvcmVSZXNwb25zZS5kYXRhLnZlcnNpb259YCk7DQoNCiAgICBvdmVyd3JpdGVSZXN1bHQgPSBhd2FpdCB0aGlzQm90LmF1eFYyT3ZlcndyaXRlKHsgYXV4OiBhYkNvcmVSZXNwb25zZS5kYXRhLCBncm91cFRhZzogJ2FiQ29yZScsIGRyeVJ1bjogRFJZX1JVTiB9KTsNCiAgICBzZXRUYWdNYXNrKGFiLCAnYWJDb3JlU291cmNlSGFzaCcsIG92ZXJ3cml0ZVJlc3VsdC5zb3VyY2VIYXNoLCAnc2hhcmVkJyk7DQoNCiAgICBpZiAocmVsb2FkUGFnZSkgew0KICAgICAgICBjb25zdCByZW1vdGVEYXRhRXZlbnQgPSAndXBkYXRlX2FiX3JlbG9hZF9wYWdlJzsNCiAgICAgICAgY29uc3QgcmVtb3RlRGF0YUFyZyA9IHsgcmVsb2FkUGFnZSwgZHJ5UnVuOiBEUllfUlVOIH07DQoNCiAgICAgICAgaWYgKG9zLmlzQ29sbGFib3JhdGl2ZSgpKSB7DQogICAgICAgICAgICBjb25zdCByZW1vdGVzID0gYXdhaXQgb3MucmVtb3RlcygpOw0KICAgICAgICAgICAgc2VuZFJlbW90ZURhdGEocmVtb3RlcywgcmVtb3RlRGF0YUV2ZW50LCByZW1vdGVEYXRhQXJnKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXNCb3Qub25SZW1vdGVEYXRhKHsgbmFtZTogcmVtb3RlRGF0YUV2ZW50LCB0aGF0OiByZW1vdGVEYXRhQXJnLCByZW1vdGVJZDogY29uZmlnQm90LmlkIH0pOw0KICAgICAgICB9DQogICAgfQ0KfSBmaW5hbGx5IHsNCiAgICBpZiAoYnVzeUluZGljYXRvcikgew0KICAgICAgICBkZXN0cm95KGJ1c3lJbmRpY2F0b3IpOw0KICAgICAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7DQogICAgfQ0KfScAjtPfqwYABWRlYnVnAgQAjtPfqwblyAEEdHJ1ZScAjtPfqwYADmF1eFYyT3ZlcndyaXRlAgQAjtPfqwbqyAGRKkBjb25zdCBhdXggPSB0aGF0Py5hdXg7CmNvbnN0IGdyb3VwVGFnID0gdGhhdD8uZ3JvdXBUYWc7CmNvbnN0IGRyeVJ1biA9IHRoYXQ/LmRyeVJ1biA/PyBmYWxzZTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7Cn0KCmFzc2VydChhdXg/LnZlcnNpb24gPT09IDIsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXV4IHBhcmFtZXRlciBpcyByZXF1aXJlZCB0byBiZSBhIHYyIGF1eCBmaWxlLmApOwphc3NlcnQoZ3JvdXBUYWcgPT0gbnVsbCB8fCB0eXBlb2YgZ3JvdXBUYWcgPT09ICdzdHJpbmcnLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGdyb3VwVGFnIHBhcmFtZXRlciBpZiBwcm92aWRlZCwgbXVzdCBiZSBhIHN0cmluZy5gKTsKCmNvbnN0IHN0YXRlID0gYXdhaXQgb3MuZ2V0SW5zdFN0YXRlRnJvbVVwZGF0ZXMoYXV4LnVwZGF0ZXMpOwoKLy8gU3VwZXIgaGFyZGNvZGVkIG1lc3N5IGZpeCBmb3IgY29tcHV0aW5nIGFiQ29uZmlnIHNvdXJjZSBoYXNoLgppZiAoZ3JvdXBUYWcgPT09ICdhYkNvbmZpZycpIHsgCiAgICBmb3IgKGxldCBpZCBpbiBzdGF0ZSkgewogICAgICAgIGRlbGV0ZSBzdGF0ZVtpZF0udGFncy5iYXNlQUI7IC8vIGJhc2VBQiBpcyBhbiBhbm5veWluZyB0YWcgdGhhdCBzaG91bGQgbm90IGJlIGNvbXB1dGVkIGFzIHBhcnQgb2YgaGFzaCBzdGF0ZS4KICAgIH0KfQoKbGV0IHNvdXJjZUhhc2ggPSBjcnlwdG8uaGFzaCgnc2hhMScsICdoZXgnLCBzdGF0ZSk7CmxldCBwcmV2R3JvdXBCb3RzID0gZ2V0Qm90cyhiID0+IGIudGFnc1tncm91cFRhZ10gPT09IHRydWUpOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc3RhdGU6YCwgc3RhdGUpOwogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBwcmV2R3JvdXBCb3RzOmAsIHByZXZHcm91cEJvdHMpOwp9CgovLyBTdGVwIDE6IEFwcGx5IHVwZGF0ZXMgZGlyZWN0bHkgdG8gdGhlIGluc3QgYXMtaXMuCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIFN0ZXAgMTogQXBwbHkgdXBkYXRlcyBkaXJlY3RseSB0byB0aGUgaW5zdCBhcy1pcy5gKTsKfQoKaWYgKCFkcnlSdW4pIHsKICAgIGF3YWl0IG9zLmFwcGx5VXBkYXRlc1RvSW5zdChhdXgudXBkYXRlcyk7Cn0gZWxzZSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRyeSBydW46IHdvdWxkIGFwcGx5IHVwZGF0ZXMgdG8gaW5zdC5gKQp9CgovLyBTdGVwIDI6IERlbGV0ZSBwcmV2aW91cyBncm91cCBib3RzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgdXBkYXRlIHN0YXRlLgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBTdGVwIDI6IERlbGV0ZSBwcmV2aW91cyBncm91cCBib3RzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgdXBkYXRlIHN0YXRlLmApOwp9Cgpmb3IgKGNvbnN0IHByZXZHcm91cEJvdCBvZiBwcmV2R3JvdXBCb3RzKSB7CiAgICBpZiAoc3RhdGVbcHJldkdyb3VwQm90LmlkXSA9PSBudWxsKSB7CiAgICAgICAgaWYgKGRyeVJ1bikgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRyeSBydW46IHdvdWxkIGRlbGV0ZSBib3QgJHtwcmV2R3JvdXBCb3QuaWR9IHByZXZpb3VzbHkgYmVsb25naW5nIHRvIGdyb3VwICR7Z3JvdXBUYWd9YCk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkZXN0cm95aW5nIHByZXZpb3VzIGdyb3VwIGJvdCAke3ByZXZHcm91cEJvdC5pZH0gdGhhdCBpcyBubyBsb25nZXIgaW4gdGhlIHVwZGF0ZSBzdGF0ZS5gKTsKICAgICAgICB9CgogICAgICAgIGRlc3Ryb3kocHJldkdyb3VwQm90KTsKICAgIH0KfQoKLy8gU3RlcCAzOiBGb3IgZWFjaCBib3QgaW4gdGhlIHVwZGF0ZSBzdGF0ZSwgY3JlYXRlLCB1cGRhdGUsIGFuZCBkZWxldGUgdGFncyBvbiB0aGUgZXhpc3RpbmcgYm90cyBpbiB0aGUgaW5zdC4KaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gU3RlcCAzOiBGb3IgZWFjaCBib3QgaW4gdGhlIHVwZGF0ZSBzdGF0ZSwgY3JlYXRlLCB1cGRhdGUsIGFuZCBkZWxldGUgdGFncyBvbiB0aGUgZXhpc3RpbmcgYm90cyBpbiB0aGUgaW5zdC5gKTsKfQoKZm9yIChjb25zdCBib3RJZCBpbiBzdGF0ZSkgewogICAgY29uc3QgYm90ID0gZ2V0Qm90KCdpZCcsIGJvdElkKTsKICAgIGNvbnN0IGJvdFN0YXRlID0gc3RhdGVbYm90SWRdOwoKICAgIGlmIChib3QpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGZvdW5kIGV4aXN0aW5nIGJvdCAke2JvdElkfWApOwogICAgICAgIH0KCiAgICAgICAgLy8gSGFuZGxlcyB0YWcgY3JlYXRlIC8gdXBkYXRlLgogICAgICAgIGZvciAoY29uc3Qgc3RhdGVUYWdOYW1lIGluIGJvdFN0YXRlLnRhZ3MpIHsKICAgICAgICAgICAgaWYgKGJvdC5yYXdbc3RhdGVUYWdOYW1lXSAhPSBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV0pIHsKICAgICAgICAgICAgICAgIGlmIChkcnlSdW4pIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRyeSBydW46IHdvdWxkIHNldCB0YWcgJyR7c3RhdGVUYWdOYW1lfScgb24gYm90ICR7Ym90SWR9IHRvIHZhbHVlOmAsIGJvdFN0YXRlLnRhZ3Nbc3RhdGVUYWdOYW1lXSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNldCB0YWcgJyR7c3RhdGVUYWdOYW1lfScgb24gYm90ICR7Ym90SWR9IHRvOmAsIGJvdFN0YXRlLnRhZ3Nbc3RhdGVUYWdOYW1lXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYm90LnRhZ3Nbc3RhdGVUYWdOYW1lXSA9IGJvdFN0YXRlLnRhZ3Nbc3RhdGVUYWdOYW1lXTsKCiAgICAgICAgICAgICAgICBpZiAoYm90U3RhdGUudGFnc1tzdGF0ZVRhZ05hbWVdID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRhZyAnJHtzdGF0ZVRhZ05hbWV9JyBmb3IgYm90ICR7Ym90SWR9IGlzIG51bGwsIGNsZWFyaW5nIGFueSB0YWcgbWFza3MgYXMgd2VsbC5gKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIENsZWFyIGFsbCBwb3NzaWJsZSBtYXNrcyBmb3IgdGhpcyB0YWcgYXMgd2VsbC4KICAgICAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgc3RhdGVUYWdOYW1lLCBudWxsLCAnbG9jYWwnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgc3RhdGVUYWdOYW1lLCBudWxsLCAndGVtcExvY2FsJyk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIHN0YXRlVGFnTmFtZSwgbnVsbCwgJ3NoYXJlZCcpOwogICAgICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYm90LCBzdGF0ZVRhZ05hbWUsIG51bGwsICd0ZW1wU2hhcmVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGFnICcke3N0YXRlVGFnTmFtZX0nIGZvciBib3QgJHtib3RJZH0gaXMgYWxyZWFkeSB1cC10by1kYXRlLmApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBEZWxldGUgdGFncyAoYW5kIG1hc2tzIGZvciB0aG9zZSB0YWdzKSBvbiBleGlzdGluZyBib3QgdGhhdCBhcmUgbm90IGluIHVwZGF0ZSBzdGF0ZS4KICAgICAgICBjb25zdCBib3RUYWdzID0gT2JqZWN0LmtleXMoYm90LnRhZ3MpOwoKICAgICAgICBmb3IgKGNvbnN0IGJvdFRhZ05hbWUgb2YgYm90VGFncykgewogICAgICAgICAgICBpZiAoYm90U3RhdGUudGFnc1tib3RUYWdOYW1lXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZHJ5UnVuKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBkZWxldGUgdGFnICcke2JvdFRhZ05hbWV9JyBvbiBib3QgJHtib3RJZH0uYCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRlbGV0ZSB0YWcgKGFuZCBtYXNrcykgJyR7Ym90VGFnTmFtZX0nIG9uIGJvdCAke2JvdElkfS5gKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBib3QudGFnc1tib3RUYWdOYW1lXSA9IG51bGw7CiAgICAgICAgICAgICAgICAvLyBDbGVhciBhbGwgcG9zc2libGUgbWFza3MgZm9yIHRoaXMgdGFnIGFzIHdlbGwuCiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgYm90VGFnTmFtZSwgbnVsbCwgJ2xvY2FsJyk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgYm90VGFnTmFtZSwgbnVsbCwgJ3RlbXBMb2NhbCcpOwogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIGJvdFRhZ05hbWUsIG51bGwsICdzaGFyZWQnKTsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYm90LCBib3RUYWdOYW1lLCBudWxsLCAndGVtcFNoYXJlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY291bGQgbm90IGZpbmQgYm90ICR7Ym90SWR9IGluIGluc3QuYCk7CiAgICB9Cn0KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRvbmUuYCk7Cn0KCmNvbnN0IGJvdElkcyA9IE9iamVjdC5rZXlzKHN0YXRlKTsKCnJldHVybiB7CiAgICBncm91cFRhZywKICAgIGJvdElkcywKICAgIHNvdXJjZUhhc2gsCn07JwCO09+rBgAOYWJMb2FkZWRTa2lsbHMCBACO09+rBvzyAbYBQGNvbnN0IGxvYWRlZFNraWxscyA9IG5ldyBTZXQoKTsKCmdldEJvdHMoKGIpID0+IHsKICAgIGlmIChiLnRhZ3MuYWJMb2FkZWRTa2lsbCAhPSBudWxsKSB7CiAgICAgICAgbG9hZGVkU2tpbGxzLmFkZChiLnRhZ3MuYWJMb2FkZWRTa2lsbCk7CiAgICB9Cn0pOwoKcmV0dXJuIEFycmF5LmZyb20obG9hZGVkU2tpbGxzKTsnAI7T36sGAAxvblJlbW90ZURhdGECBACO09+rBrP0AacFQGlmICh0aGF0Lm5hbWUgPT09ICd1cGRhdGVfYWJfcmVsb2FkX3BhZ2UnKSB7CiAgICBjb25zdCB7IHJlbG9hZFBhZ2UsIGRyeVJ1biB9ID0gdGhhdC50aGF0OwoKICAgIGlmICh0aGF0LnJlbW90ZUlkID09PSBjb25maWdCb3QuaWQpIHsKICAgICAgICAvLyBXYWl0IGEgbW9tZW50IGJlZm9yZSByZWxvYWRpbmcgdGhlIHBhZ2UgaWYgd2UgYXJlIHRoZSBvbmVzIHRoYXQgc2VudCBvdXQgdGhlIG1lc3NhZ2UuCiAgICAgICAgYXdhaXQgb3Muc2xlZXAoMTAwMCk7CiAgICB9CgogICAgbGV0IGlzVVJMID0gZmFsc2U7CgogICAgaWYgKHR5cGVvZiByZWxvYWRQYWdlID09PSAnc3RyaW5nJykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG5ldyBVUkwocmVsb2FkUGFnZSk7CiAgICAgICAgICAgIGlzVVJMID0gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgfQoKICAgIGxldCB1cmwgPSBpc1VSTCA/IHJlbG9hZFBhZ2UgOiBjb25maWdCb3QudGFncy51cmw7CgogICAgaWYgKGRyeVJ1bikgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZHJ5IHJ1bjogd291bGQgZ28gdG8gdXJsYCwgdXJsKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIG9zLmdvVG9VUkwoaXNVUkwgPyByZWxvYWRQYWdlIDogY29uZmlnQm90LnRhZ3MudXJsKTsKfScAjtPfqwYACW9uRW50ZXJBUgIEAI7T36sG2/kBE0BtYXNrcy5pbkFSID0gdHJ1ZTsnAI7T36sGAAhvbkV4aXRBUgIEAI7T36sG7/kBE0BtYXNrcy5pbkFSID0gbnVsbDsnAI7T36sGAAlvbkVudGVyVlICBACO09+rBoP6ARNAbWFza3MuaW5WUiA9IHRydWU7JwCO09+rBgAIb25FeGl0VlICBACO09+rBpf6ARNAbWFza3MuaW5WUiA9IG51bGw7AA=="}]}