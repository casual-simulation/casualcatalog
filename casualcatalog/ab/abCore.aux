{"version":2,"updates":[{"id":0,"timestamp":1759857779735,"update":"AWKAlY3eDwAnAQRib3RzJDY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNwEnAICVjd4PABhhYkNoZWNrQUJVcGRhdGVBdmFpbGFibGUCBACAlY3eDwGBK0Bjb25zdCBkZXRhaWxlZCA9IHRoYXQ/LmRldGFpbGVkID8/IGZhbHNlOwpjb25zdCBoYXNoQWxnb3JpdGhtID0gdGhhdD8uaGFzaEFsZ29yaXRobSA/PyAnc2hhMSc7CmNvbnN0IGhhc2hGb3JtYXQgPSB0aGF0Py5oYXNoRm9ybWF0ID8/ICdoZXgnOwoKaW50ZXJmYWNlIEFCRmlsZVVwZGF0ZUNoZWNrIHsKICAgIGZpbGVOYW1lOiBzdHJpbmc7CiAgICB1cGRhdGVBdmFpbGFibGU6IGJvb2xlYW47CiAgICBjdXJyZW50SGFzaDogc3RyaW5nOwogICAgbGF0ZXN0SGFzaDogc3RyaW5nOwogICAgcmVtb3ZlZDogYm9vbGVhbjsKfQoKLy8gVGhpcyBsaXN0IG9mIGFiIGZpbGUgY2hlY2tzLCB0aGlzIHdpbGwgb25seSBiZSBwb3B1bGF0ZWQgaWYgJ2RldGFpbGVkJyBpcyB0cnVlLgpjb25zdCBhYkZpbGVDaGVja3M6IEFCRmlsZVVwZGF0ZUNoZWNrW10gPSBbXTsKCmFzeW5jIGZ1bmN0aW9uIGNoZWNrU2tpbGxPdXRkYXRlZChza2lsbE5hbWU6IHN0cmluZywgY3VycmVudEhhc2g6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4gewogICAgY29uc3Qgc2tpbGxVUkwgPSB0aGlzQm90LmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKGAvYWIvJHtza2lsbE5hbWV9LmF1eGApOyAgICAgICAgCiAgICBsZXQgc2tpbGxSZW1vdmVkID0gZmFsc2U7CiAgICBsZXQgc2tpbGxSZXNwb25zZTsKCiAgICB0cnkgewogICAgICAgIHNraWxsUmVzcG9uc2UgPSBhd2FpdCB3ZWJob29rKHsgbWV0aG9kOiAiR0VUIiwgdXJsOiBza2lsbFVSTCB9KTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBza2lsbFJlc3BvbnNlOmAsIHNraWxsUmVzcG9uc2UpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBhc3NlcnQoc2tpbGxSZXNwb25zZS5kYXRhLnZlcnNpb24gPT09IDIsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gJHtza2lsbE5hbWV9IG11c3QgYmUgaW4gYXV4IGZpbGUgZm9ybWF0IHYyLiBBY3R1YWwgYXV4IGZpbGUgZm9ybWF0IHZlcnNpb246ICR7c2tpbGxSZXNwb25zZS5kYXRhLnZlcnNpb259YCk7CgogICAgICAgIGlmIChza2lsbFJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICAgIGlmIChza2lsbFJlc3BvbnNlLnN0YXR1cyA9PT0gNDAzIHx8IHNraWxsUmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgICAgIHNraWxsUmVtb3ZlZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgJHtza2lsbE5hbWV9LiBSZXNwb25zZTogJHtza2lsbFJlc3BvbnNlLnN0YXR1c1RleHR9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhdWdodCBlcnJvciB3aGlsZSBkb3dubG9hZGluZyBza2lsbDpgLCBlKTsKICAgICAgICAKICAgICAgICBpZiAoZS5yZXNwb25zZT8uc3RhdHVzID09PSA0MDMgfHwgZS5yZXNwb25zZT8uc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgLy8gRmlsZSBkb2VzbnQgZXhpc3QgYW55bW9yZSwgdGhlIHNraWxsIGhhcyBiZWVuIHJlbW92ZWQuCiAgICAgICAgICAgIHNraWxsUmVtb3ZlZCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHNraWxsUmVtb3ZlZCkgewogICAgICAgIGlmIChkZXRhaWxlZCkgewogICAgICAgICAgICBhYkZpbGVDaGVja3MucHVzaCh7CiAgICAgICAgICAgICAgICBmaWxlTmFtZTogc2tpbGxOYW1lLAogICAgICAgICAgICAgICAgY3VycmVudEhhc2gsCiAgICAgICAgICAgICAgICBsYXRlc3RIYXNoOiBudWxsLAogICAgICAgICAgICAgICAgcmVtb3ZlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIHVwZGF0ZUF2YWlsYWJsZTogdHJ1ZSwKICAgICAgICAgICAgfSkKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBDYWxjdWxhdGUgaGFzaCBvZiBhYiBmaWxlIHN0YXRlIHRvIGNvbXBhcmUgYWdhaW5zdC4KICAgICAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IG9zLmdldEluc3RTdGF0ZUZyb21VcGRhdGVzKHNraWxsUmVzcG9uc2UuZGF0YS51cGRhdGVzKTsKICAgICAgICBjb25zdCBsYXRlc3RIYXNoID0gY3J5cHRvLmhhc2goaGFzaEFsZ29yaXRobSwgaGFzaEZvcm1hdCwgc3RhdGUpOwogICAgICAgIAogICAgICAgIGlmIChkZXRhaWxlZCkgewogICAgICAgICAgICBhYkZpbGVDaGVja3MucHVzaCh7CiAgICAgICAgICAgICAgICBmaWxlTmFtZTogc2tpbGxOYW1lLAogICAgICAgICAgICAgICAgY3VycmVudEhhc2gsCiAgICAgICAgICAgICAgICBsYXRlc3RIYXNoLAogICAgICAgICAgICAgICAgcmVtb3ZlZDogZmFsc2UsCiAgICAgICAgICAgICAgICB1cGRhdGVBdmFpbGFibGU6IGN1cnJlbnRIYXNoICE9PSBsYXRlc3RIYXNoLAogICAgICAgICAgICB9KQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGN1cnJlbnRIYXNoICE9PSBsYXRlc3RIYXNoOwogICAgfQp9CgovLyAxLiBDaGVjayBpZiBhYkNvbmZpZyBpcyBvdXRkYXRlZC4KY29uc3QgYWJDb25maWdVUkwgPSBvcy5nZXRBQjFCb290c3RyYXBVUkwoKTsKY29uc3QgYWJDb25maWdSZXNwb25zZSA9IGF3YWl0IHdlYmhvb2soeyBtZXRob2Q6ICJHRVQiLCB1cmw6IGFiQ29uZmlnVVJMIH0pOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWJDb25maWdSZXNwb25zZTpgLCBhYkNvbmZpZ1Jlc3BvbnNlKTsKfQoKYXNzZXJ0KGFiQ29uZmlnUmVzcG9uc2Uuc3RhdHVzID09PSAyMDAsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGRvd25sb2FkIGFiQ29uZmlnLiBSZXNwb25zZTogJHthYkNvbmZpZ1Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7CmFzc2VydChhYkNvbmZpZ1Jlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYkNvbmZpZyBtdXN0IGJlIGluIGF1eCBmaWxlIGZvcm1hdCB2Mi4gQWN0dWFsIGF1eCBmaWxlIGZvcm1hdCB2ZXJzaW9uOiAke2FiQ29uZmlnUmVzcG9uc2UuZGF0YS52ZXJzaW9ufWApOwoKY29uc3QgYWJDb25maWdDdXJyZW50SGFzaCA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb25maWdTb3VyY2VIYXNoOwpjb25zdCBhYkNvbmZpZ0xhdGVzdFN0YXRlID0gYXdhaXQgb3MuZ2V0SW5zdFN0YXRlRnJvbVVwZGF0ZXMoYWJDb25maWdSZXNwb25zZS5kYXRhLnVwZGF0ZXMpOwpmb3IgKGxldCBpZCBpbiBhYkNvbmZpZ0xhdGVzdFN0YXRlKSB7CiAgICBkZWxldGUgYWJDb25maWdMYXRlc3RTdGF0ZVtpZF0udGFncy5iYXNlQUI7IC8vIGJhc2VBQiBpcyBhbiBhbm5veWluZyB0YWcgdGhhdCBzaG91bGQgbm90IGJlIGNvbXB1dGVkIGFzIHBhcnQgb2YgaGFzaCBzdGF0ZS4KfQpjb25zdCBhYkNvbmZpZ0xhdGVzdEhhc2ggPSBjcnlwdG8uaGFzaChoYXNoQWxnb3JpdGhtLCBoYXNoRm9ybWF0LCBhYkNvbmZpZ0xhdGVzdFN0YXRlKTsKCmlmIChkZXRhaWxlZCkgewogICAgYWJGaWxlQ2hlY2tzLnB1c2goewogICAgICAgIGZpbGVOYW1lOiAnYWJDb25maWcnLAogICAgICAgIGN1cnJlbnRIYXNoOiBhYkNvbmZpZ0N1cnJlbnRIYXNoLAogICAgICAgIGxhdGVzdEhhc2g6IGFiQ29uZmlnTGF0ZXN0SGFzaCwKICAgICAgICByZW1vdmVkOiBmYWxzZSwKICAgICAgICB1cGRhdGVBdmFpbGFibGU6IGFiQ29uZmlnQ3VycmVudEhhc2ggIT09IGFiQ29uZmlnTGF0ZXN0SGFzaAogICAgfSkKfQoKaWYgKCFkZXRhaWxlZCAmJiAoYWJDb25maWdDdXJyZW50SGFzaCAhPT0gYWJDb25maWdMYXRlc3RIYXNoKSkgewogICAgLy8gSWYgd2UgYXJlIHJ1bm5pbmcgaW4gc2ltcGxlIG1vZGUsIHJldHVybiByaWdodCBhd2F5IG9uIHRoZSBmaXJzdCBvdXRkYXRlZCBmaWxlIGRpc2NvdmVyeS4KICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHVwZGF0ZUF2YWlsYWJsZTogdHJ1ZSB9Cn0KCi8vIDIuIENoZWNrIGlmIGFiIHNraWxscyBhcmUgb3V0ZGF0ZWQuCmNvbnN0IGFiU2tpbGxOYW1lcyA9IFsgJ2FiQ29yZScsIC4uLnRoaXNCb3QuYWJMb2FkZWRTa2lsbHMoKSBdOwpjb25zb2xlLmxvZyhgYWJTa2lsbE5hbWVzOmAsIGFiU2tpbGxOYW1lcyk7Cgpmb3IgKGxldCBpID0gMDsgaSA8IGFiU2tpbGxOYW1lcy5sZW5ndGg7IGkrKykgewogICAgY29uc3Qgc2tpbGxOYW1lID0gYWJTa2lsbE5hbWVzW2ldOwoKICAgIGxldCBza2lsbEN1cnJlbnRIYXNoOwogICAgaWYgKHNraWxsTmFtZSA9PT0gJ2FiQ29yZScpIHsKICAgICAgICBza2lsbEN1cnJlbnRIYXNoID0gYWIudGFncy5hYkNvcmVTb3VyY2VIYXNoOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBsb2FkZWRTa2lsbEJvdCA9IGdldEJvdChiID0+IGIudGFncy5hYkxvYWRlZFNraWxsID09PSBza2lsbE5hbWUgJiYgYi5zcGFjZSA9PT0gJ3NoYXJlZCcpOwogICAgICAgIGFzc2VydChsb2FkZWRTa2lsbEJvdCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjb3VsZCBub3QgZmluZCBsb2FkZWQgc2tpbGwgYm90IGZvciAke3NraWxsTmFtZX0uYCk7CgogICAgICAgIHNraWxsQ3VycmVudEhhc2ggPSBsb2FkZWRTa2lsbEJvdC50YWdzLmFiTG9hZGVkU2tpbGxTb3VyY2VIYXNoOwogICAgfQogICAgCiAgICB0cnkgewogICAgICAgIGNvbnN0IHNraWxsT3V0ZGF0ZWQgPSBhd2FpdCBjaGVja1NraWxsT3V0ZGF0ZWQoc2tpbGxOYW1lLCBza2lsbEN1cnJlbnRIYXNoKTsKCiAgICAgICAgaWYgKCFkZXRhaWxlZCAmJiBza2lsbE91dGRhdGVkKSB7CiAgICAgICAgICAgIC8vIElmIHdlIGFyZSBydW5uaW5nIGluIHNpbXBsZSBtb2RlLCByZXR1cm4gcmlnaHQgYXdheSBvbiB0aGUgZmlyc3Qgb3V0ZGF0ZWQgZmlsZSBkaXNjb3ZlcnkuCiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHVwZGF0ZUF2YWlsYWJsZTogdHJ1ZSB9CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDYXVnaCBhbiBlcnJvci5gLCBlKTsKICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9CiAgICB9Cn0KCmlmIChkZXRhaWxlZCkgewogICAgcmV0dXJuIHsKICAgICAgICBzdWNjZXNzOiB0cnVlLAogICAgICAgIHVwZGF0ZUF2YWlsYWJsZTogYWJGaWxlQ2hlY2tzLnNvbWUoZiA9PiBmLnVwZGF0ZUF2YWlsYWJsZSksCiAgICAgICAgYWJGaWxlQ2hlY2tzLAogICAgfQp9IGVsc2UgewogICAgLy8gSWYgd2UgbWFkZSBpdCBhbGwgdGhlIHdheSBoZXJlIGluIHNpbXBsZSBtb2RlLCB0aGVyZSBhcmUgbm8gb3V0ZGF0ZWQgZmlsZXMuCiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1cGRhdGVBdmFpbGFibGU6IGZhbHNlIH0KfScAgJWN3g8AEmFiQ29yZU1ham9yVmVyc2lvbgIEAICVjd4PgysCMTAnAICVjd4PABJhYkNvcmVNaW5vclZlcnNpb24CBACAlY3eD4YrAjIzJwCAlY3eDwAGc3lzdGVtAgQAgJWN3g+JKw1hYi5jb3JlLmxlYXJuJwCAlY3eDwAEYWJJRAIEAICVjd4PlysFbGVhcm4nAICVjd4PAARmb3JtAgQAgJWN3g+dKwdub3RoaW5nJwCAlY3eDwAGYWJCb290AgQAgJWN3g+lK6cqQC8qKgoqIE1JVCBMaWNlbnNlCioKKiBDb3B5cmlnaHQgKGMpIDIwMTkgQ2FzdWFsIFNpbXVsYXRpb24sIEluYy4KKgoqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAoqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCiogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKKgoqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbAoqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCioKKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgoqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAoqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQoqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLAoqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFCiogU09GVFdBUkUuCiogQGxpY2Vuc2UgTUlUCiovCgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib290aW5nIGFiYCk7Cn0KCi8vaW5zdCBtb2RlIChwbGF5ZXIgb3IgYnVpbGRlcikKbGV0IGluc3RNb2RlQ2hlY2sgPSBhd2FpdCBvcy52ZXJzaW9uKCkucGxheWVyTW9kZTsKLy9jaGVjayBzZWxmIGZvciBpbml0aWFsIGJvb3QgZGF0YQpsZXQgaW5pdGlhbEJvb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmluaXRpYWxCb290ID8gdHJ1ZSA6IGZhbHNlOwovL2NoZWNrIHVybCBmb3IgcG9zc2libGUgYWIncyB0byBsb2FkCmxldCBib290RmxhZyA9IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gPyBjb25maWdCb3QudGFncy5wYXR0ZXJuIDogY29uZmlnQm90LnRhZ3MuYWI7Ci8vY2hlY2sgZm9yIGFzawpsZXQgYXNrID0gY29uZmlnQm90LnRhZ3MuYXNrOwovL2xvZ2luCmxldCBzdGF0dXMgPSBhd2FpdCB0aGlzQm90LmxvYWRpbmdTdGF0dXMoKTsKLy9zZWVkIChub3QgYWN0aXZlbHkgdXNlZCBoZXJlKQpsZXQgc2VlZCA9IGNvbmZpZ0JvdC50YWdzLnNlZWQ7Ci8vcHJvbXB0CmxldCBwcm9tcHQgPSBjb25maWdCb3QudGFncy5wcm9tcHQ7Ci8vY2hhbm5lbApsZXQgY2hhbm5lbCA9IGNvbmZpZ0JvdC50YWdzLmNoYW5uZWw7Ci8vdXVhYgpsZXQgdXVhYiA9IGNvbmZpZ0JvdC50YWdzLnV1YWI7Ci8vdmVyc2lvbgpsZXQgdmVyc2lvbiA9IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm5WZXJzaW9uID8/IGNvbmZpZ0JvdC50YWdzLmFiVmVyc2lvbjsKLy9yZXF1ZXN0IGF1dGggYm90CmF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgovL3JlZGlyZWN0IGlmIGluIFVSTAppZiAoY29uZmlnQm90LnRhZ3Muam9pbkNvZGUpIHsKICAgIHRoaXNCb3QuYWJKb2luSG9zdCh7IHRleHQ6IGNvbmZpZ0JvdC50YWdzLmpvaW5Db2RlIH0pOwp9CgovL3N0YXR1cyBjbGVhbiB1cApkZXN0cm95KHN0YXR1cyk7CgovL2NoZWNrIHRpbWUgaWYgbmVlZGVkCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29uZGl0aW9uKSB7CiAgICBhd2FpdCBsaW5rcy5yZW1lbWJlci5hYkNvbmRpdGlvbigpOwp9CgovL2lmIG5vIHN0dWRpbywgc2V0IHN0dWRpbwppZiAoYXV0aEJvdCAmJiAhY29uZmlnQm90LnRhZ3Muc3R1ZGlvKSB7CiAgICBjb25maWdCb3QudGFncy5zdHVkaW8gPSBhdXRoQm90LmlkOwp9CgppZiAoYXV0aEJvdCkgewogICAgdGhpc0JvdC5hYkxvYWRTdHVkaW9zKCk7Cn0KCmlmICghbGlua3MucGVyc29uYWxpdHkpIHsgCiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiUGVyc29uYWxpdHkiKTsKfQoKLy9pbml0aWFsaXplIHJlbWVtYmVyIGdsb2JhbHMKZ2xvYmFsVGhpcy5hYkluc3RNZW1vcnkgPSBsaW5rcy5yZW1lbWJlcjsKZ2xvYmFsVGhpcy5hYlJlbWVtYmVyID0gbGlua3MucmVtZW1iZXI7Cmdsb2JhbFRoaXMuYWJQZXJzb25hbGl0eSA9IGxpbmtzLnBlcnNvbmFsaXR5OwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yKSB7CiAgICBncmlkUG9ydGFsQm90LnRhZ3MucG9ydGFsQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvcjsKfQoKLy9UaGlzIGNoZWNrcyBmb3IgdGhlIGFwcHJvcHJpYXRlIGFycmF5IG9mIHNraWxscyBhbmQgaW5pdGlhbGl6ZXMgdGhlbQphd2FpdCB0aGlzQm90LmFiU2tpbGxJbml0aWFsaXphdGlvbihpbnN0TW9kZUNoZWNrKTsKCi8vaW5pdGlhbGl6aW5nIG9mIGdsb2JhbCB2YXJpYWJsZXMKZ2xvYmFsVGhpcy5idWlsZGVyVmVyc2lvbiA9IGluc3RNb2RlQ2hlY2sgPT0gImJ1aWxkZXIiID8gdHJ1ZSA6IGZhbHNlOwpnbG9iYWxUaGlzLmFiTG9uZ1Rlcm1NZW1vcnlTZWFyY2ggPSBsaW5rcy5zZWFyY2g7Cmdsb2JhbFRoaXMuYWJTZWFyY2ggPSBsaW5rcy5zZWFyY2g7Cmdsb2JhbFRoaXMuYWJQdWJsaXNoID0gbGlua3Muc3RvcmU7Cmdsb2JhbFRoaXMuYWJTdG9yZSA9IGxpbmtzLnN0b3JlOwpnbG9iYWxUaGlzLmFiID0gdGhpc0JvdDsKCi8vY2hlY2sgZm9yIHV1YWJzCmlmICh1dWFiKSB7CiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiQWN0aW9uIik7CgogICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHV1YWIsIGlzVVVBQjogdHJ1ZX0pOwp9Ci8vY2hlY2sgZm9yIGNoYW5uZWwgaWYgY2hhbm5lbHMgYWxsb3dlZAplbHNlIGlmIChjaGFubmVsICYmIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWxsb3dDaGFubmVscykgewogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYkFjdGlvbiIpOwoKICAgIGxpbmtzLmFzay5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiBjaGFubmVsLCBpc0NoYW5uZWw6IHRydWV9KTsKfSBlbHNlIHsKICAgIC8vcG9wdWxhdGUgYm9vdGZsYWcgYWIKICAgIGlmIChpbml0aWFsQm9vdCAmJiBib290RmxhZykgewogICAgICAgIGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7IGFiSUQ6IGJvb3RGbGFnLCBpbml0aWFsQm9vdDogdHJ1ZSwgYXV0b0hhdGNoOiB0cnVlLCBzb3VyY2VFdmVudDogJ2Jvb3QnLCBhYlZlcnNpb246IHZlcnNpb259KTsKICAgIH0KCiAgICAvL2xvb2t1cCBhc2tJRCBpZiBhdmFpbGFibGUKICAgIGlmIChpbml0aWFsQm9vdCAmJiBhc2spIHsKICAgICAgICBpZiAoYXNrID09ICJlZ2dDYXJ0b24iIHx8IGFzayA9PSAiY2FzdWFsVHV0b3JpYWwiKSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJBZGFwdChhc2spOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYkFjdGlvbiIpOwoKICAgICAgICAgICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24oYXNrKTsKICAgICAgICB9CiAgICB9Cn0KCi8vY2hlY2sgZm9yIGFydGlmYWN0IEZJWAppZiAoY29uZmlnQm90LnRhZ3MuYXJ0aWZhY3QgJiYgaW5pdGlhbEJvb3QgJiYgIWFzayAmJiAhYm9vdEZsYWcpIHsKICAgIGNvbnN0IGFydGlmYWN0ID0gY29uZmlnQm90LnRhZ3MuYXJ0aWZhY3Q7CiAgICBjb25zdCBhcnRJbmRleCA9IGFydGlmYWN0LmluZGV4T2YoIl9hcnRfIik7CiAgICBjb25zdCBzdHVkaW8gPSBhcnRpZmFjdC5zdWJzdHJpbmcoMCwgYXJ0SW5kZXgpOwogICAgY29uc3QgcmVjb3JkQWRkcmVzcyA9IGFydGlmYWN0LnN1YnN0cmluZyhhcnRJbmRleCk7CiAgICBjb25zdCByZWNvcmREYXRhID0gYXdhaXQgb3MuZ2V0RGF0YShzdHVkaW8sIHJlY29yZEFkZHJlc3MpOwogICAgY29uc3QgYXNrSUQgPSByZWNvcmREYXRhLmRhdGEucGF0dGVybjsKCiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiQWN0aW9uIik7CgogICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24oYXNrSUQpOwp9CgovLyBDaGVjayBpZiB3ZSBjYW4gd2FrZSB1cCBhYiwgYW5kIHRoZW4gZG8gc28uCmlmICghY29uZmlnQm90LnRhZ3MuYWJTbGVlcCkgewogICAgaWYgKChpbml0aWFsQm9vdCAmJiAhYm9vdEZsYWcgJiYgIWFzaykgfHwgbGlua3MucmVtZW1iZXIudGFncy5hYkFsd2F5c1N0YXJ0QXdha2UgfHwgY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgICAgICBhd2FpdCBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiU2V0QXdha2UoeyBhd2FrZTogdHJ1ZSwgaW5pdGlhbDogaW5pdGlhbEJvb3QgfSk7CiAgICB9Cn0KCi8vc2V0IGluaXRpYWwgYm9vdCBkYXRhCmlmIChpbml0aWFsQm9vdCkgewogICAgc2V0VGFnTWFzayhsaW5rcy5yZW1lbWJlciwgJ2luaXRpYWxCb290JywgZmFsc2UsICdzaGFyZWQnKTsKCiAgICBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxpemF0aW9uQ29uZmlndXJhdGlvbikgewogICAgICAgIGxpbmtzLnJlbWVtYmVyLmFiSW5pdGlhbGl6YXRpb25Db25maWd1cmF0aW9uKCk7CiAgICB9Cn0KCi8vY2xlYW4gdXAgVVJMIHdpdGggdGFnUG9ydGFsCmlmIChjb25maWdCb3QudGFncy50YWdQb3J0YWwgJiYgIWNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbEFuY2hvclBvaW50ICYmIGJ1aWxkZXJWZXJzaW9uKSB7CiAgICBjb25maWdCb3QudGFncy50YWdQb3J0YWwgPSBudWxsOwogICAgY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwp9CgovL3BhdXNlIGZvciBhYiBsb2FkaW5nCmF3YWl0IG9zLnNsZWVwKDUwMCk7CgovL2luaXRpYWxpemUgdGltZSBib3QKdGhpc0JvdC5hYlRpbWVyKCk7CgpsaW5rcy5wZXJzb25hbGl0eS51cGRhdGVQZXJzb25hbGl0eSgpOwoKLy9pbml0aWFsaXphdGlvbiBzaG91dApzdXBlclNob3V0KCJvbkFCSW5pdGlhbGl6ZWQiLCB0YWdzLmFiSW5zdCk7KACAlY3eDwAGYWJDb3JlAXgnAICVjd4PAAdhYkFkYXB0AgQAgJWN3g/OVb4UQGxldCBza2lsbE5hbWU7CmxldCBza2lsbERhdGE7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9CgppZiAodHlwZW9mIHRoYXQgPT09ICdzdHJpbmcnKSB7CiAgICBza2lsbE5hbWUgPSB0aGF0OwogICAgc2tpbGxEYXRhID0gbnVsbDsKfSBlbHNlIGlmICh0eXBlb2YgdGhhdCA9PT0gJ29iamVjdCcpIHsKICAgIHNraWxsTmFtZSA9IHRoYXQuc3lzdGVtSUQgPz8gdGhhdC5za2lsbE5hbWU7CiAgICBza2lsbERhdGEgPSB0aGF0LmRhdGEgPz8gbnVsbDsKfQoKaWYgKCFza2lsbE5hbWUpIHsKICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBza2lsbE5hbWUgaXMgcmVxdWlyZWQuYCk7CiAgICByZXR1cm4gZmFsc2U7Cn0KCmlmIChza2lsbE5hbWUgPT09ICdhYkNvcmUnKSB7CiAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfX1dIGFiQ29uZmlnIGNhbm5vdCBiZSBsb2FkZWQgdXNpbmcgYWJBZGFwdC5gKTsKICAgIHJldHVybjsKfQoKdHJ5IHsKICAgIGNvbnN0IGxvYWRlZFNraWxscyA9IHRoaXNCb3QuYWJMb2FkZWRTa2lsbHMoKTsKCiAgICBpZiAoIWxvYWRlZFNraWxscy5pbmNsdWRlcyhza2lsbE5hbWUpKSB7CiAgICAgICAgY29uc3QgdXJsID0gdGhpc0JvdC5hYkJ1aWxkQ2FzdWFsQ2F0YWxvZ1VSTChgL2FiLyR7c2tpbGxOYW1lfS5hdXhgKTsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHdlYi5ob29rKHsgbWV0aG9kOiAiR0VUIiwgdXJsIH0pOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFiIHNraWxsIEdFVCByZXNwb25zZTpgLCByZXNwb25zZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgJHtza2lsbE5hbWV9LiBSZXNwb25zZTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEudmVyc2lvbiA9PT0gMikgewogICAgICAgICAgICAvLyBBVVggRm9ybWF0IFZlcnNpb24gMi4KICAgICAgICAgICAgY29uc3QgdXBkYXRlcyA9IHJlc3BvbnNlLmRhdGEudXBkYXRlczsKICAgICAgICAgICAgYXdhaXQgb3MuYXBwbHlVcGRhdGVzVG9JbnN0KHVwZGF0ZXMpOwogICAgICAgICAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IG9zLmdldEluc3RTdGF0ZUZyb21VcGRhdGVzKHVwZGF0ZXMpOwogICAgICAgICAgICBjb25zdCBzb3VyY2VIYXNoID0gY3J5cHRvLmhhc2goJ3NoYTEnLCAnaGV4Jywgc3RhdGUpOwoKICAgICAgICAgICAgLy8gTG9hZGVkIHNraWxscyBhcmUgc3RvcmVkIGFzIHNoYXJlZCBib3RzIHRoYXQgYW55b25lIGluIHRoZSBpbnN0IGNhbiByZWFkLgogICAgICAgICAgICBjcmVhdGUoewogICAgICAgICAgICAgICAgc3BhY2U6ICdzaGFyZWQnLAogICAgICAgICAgICAgICAgYWJJZ25vcmU6IHRydWUsCiAgICAgICAgICAgICAgICBhYkxvYWRlZFNraWxsOiBza2lsbE5hbWUsCiAgICAgICAgICAgICAgICBhYkxvYWRlZFNraWxsU291cmNlSGFzaDogc291cmNlSGFzaCwKICAgICAgICAgICAgICAgIGZvcm06ICdub3RoaW5nJywKICAgICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQVVYIGZvcm1hdCB2ZXJzaW9uICR7cmVzcG9uc2UuZGF0YS52ZXJzaW9ufSBpcyBub3Qgc3VwcG9ydGVkLmApOwogICAgICAgIH0KCiAgICB9IGVsc2UgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWIgc2tpbGwgJHtza2lsbE5hbWV9IGlzIGFscmVhZHkgbG9hZGVkLmApCiAgICAgICAgfQogICAgfQoKICAgIGNvbnN0IHNraWxsQm90cyA9IGdldEJvdHMoYiA9PiBiLnRhZ3Nbc2tpbGxOYW1lXSA9PT0gdHJ1ZSk7CiAgICBpZiAoc2tpbGxCb3RzICYmIHNraWxsQm90cy5sZW5ndGggPiAwKSB7CiAgICAgICAgd2hpc3Blcihza2lsbEJvdHMsIHRhZ05hbWUsIGNvbmZpZ0JvdC50YWdzLmluc3QpOwogICAgICAgIHdoaXNwZXIoc2tpbGxCb3RzLCAib25Ta2lsbFVwZGF0ZSIsIHsgZGF0YTogc2tpbGxEYXRhIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gTm8gYm90cyBhcHBlYXIgdG8gaGF2ZSBiZWVuIGxvYWRlZCB3aXRoICR7c2tpbGxOYW1lfS5gKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRydWU7Cn0gY2F0Y2ggKGUpIHsKICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gRmFpbGVkIHRvIGRvd25sb2FkICR7c2tpbGxOYW1lfS4gU2VlIGFib3ZlIGVycm9yLmApOwogICAgcmV0dXJuIGZhbHNlOwp9JwCAlY3eDwALZGVzY3JpcHRpb24CBACAlY3eD41qT1RoaXMgc2tpbGwgaXMgZGVzaWduZWQgdG8gaGFuZGxlIGJvdGggcmVjb25maWd1cmF0aW9uIG9mIGFiIGFuZCBpbml0aWFsaXphdGlvbi4nAICVjd4PAApvbkJvdEFkZGVkAgQAgJWN3g/davEBQGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWJDb3JlIFNUQVJUIFVQYCk7Cgp0aGlzQm90LmFiSW5zdFVwZGF0ZSgpOwoKaWYgKCFsaW5rcy5yZW1lbWJlcikgewogICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIENvdWxkIG5vdCBmaW5kIGFiQ29uZmlnIHJlbWVtYmVyIGJvdC5gKTsKfQoKc2V0VGltZW91dCgoKSA9PiB0aGlzQm90LmFiQm9vdCgpLCA1MDApOycAgJWN3g8ACHJlbWVtYmVyAgQAgJWN3g/PbCjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCAlY3eDwADbG9nAgQAgJWN3g/2bGxALy9wYXNzIHRocm91Z2ggbG9nIGRhdGEKaWYgKGxpbmtzLmNvbnNvbGUpIHsKICAgIGxpbmtzLmNvbnNvbGUubG9nKHRoYXQpOwp9CmVsc2UgewogICAgY29uc29sZS5sb2codGhhdCk7Cn0nAICVjd4PAA1tYW5pZmVzdGF0aW9uAgQAgJWN3g/jbSjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCAlY3eDwAMYWJDcmVhdGVIb3N0AgQAgJWN3g+KbpYKQGNvbnN0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwoKLy90aGlzIGZ1bmN0aW9uIGhhbmRsZXMgY3JlYXRpbmcgYSBmaWxlIGZvciBqb2luIGNvZGVzCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCkgewogICAgb3MudG9hc3QoInVybCBjb3BpZWQgdG8gY2xpcGJvYXJkIik7CgogICAgb3Muc2V0Q2xpcGJvYXJkKHNpdGVPcmlnaW4gKyAiLz9qb2luQ29kZT0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDAsIDMpICsgIi0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDMpKTsKCiAgICByZXR1cm47Cn0KCmlmICghYXV0aEJvdCkgewogICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKfQoKaWYgKCFhdXRoQm90KSB7CiAgICBvcy50b2FzdCgicGxlYXNlIGxvZyBpbiB0byBnZW5lcmF0ZSBhIGpvaW4gY29kZSIpOwogICAgcmV0dXJuOwp9Cgpjb25zdCBuZXdIb3N0SUQgPSB1dWlkKCkucmVwbGFjZUFsbCgiLSIsICIiKS5zdWJzdHJpbmcoMCwgNik7CmNvbnN0IGRhdGUgPSBEYXRlVGltZS5ub3coKS50b01pbGxpcygpOwpjb25zdCByZWNvcmRLZXkgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5Owpjb25zdCByZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YShyZWNvcmRLZXksIG5ld0hvc3RJRCwgeyB1cmw6IGNvbmZpZ0JvdC50YWdzLnVybCwgZGF0ZTogZGF0ZSwgbWFya2VyczogWyJwdWJsaWNSZWFkIl0gfSk7CgppZiAocmVjb3JkRGF0YS5zdWNjZXNzKSB7CiAgICBzZXRUYWdNYXNrKGxpbmtzLnJlbWVtYmVyLCAnaG9zdElEJywgbmV3SG9zdElELnN1YnN0cmluZygwLCAzKSArICItIiArIG5ld0hvc3RJRC5zdWJzdHJpbmcoMyksICdzaGFyZWQnKTsKCiAgICBjb25zdCBqb2luVVJMID0gc2l0ZU9yaWdpbiArICIvP2pvaW5Db2RlPSIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRDsKCiAgICBvcy5zZXRDbGlwYm9hcmQoam9pblVSTCk7CgogICAgdGhhdC50YWdzLmxhYmVsID0gImpvaW4gY29kZTogIiArIG5ld0hvc3RJRC5zdWJzdHJpbmcoMCwgMykgKyAiLSIgKyBuZXdIb3N0SUQuc3Vic3RyaW5nKDMpOwoKICAgIG9zLnNob3dRUkNvZGUoam9pblVSTCk7CgogICAgb3MudG9hc3QoImhvc3QgZ2VuZXJhdGVkLCB1cmwgY29waWVkIHRvIGNsaXBib2FyZDogIiArIG5ld0hvc3RJRCk7Cn0KZWxzZSB7CiAgICBvcy50b2FzdCgic29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4iKTsKCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwp9JwCAlY3eDwAKYWJKb2luSG9zdAIEAICVjd4PoXjuBkAvL2xvZ2ljIGZvciB1c2luZyBhIGpvaW4gY29kZSAoY2hlY2tzIGZvciBleGlzdGluZyBmaWxlcykKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmxldCBnZXRSZWNvcmQ7CgppZiAodGhhdC5kYXRhKSB7CiAgICBnZXRSZWNvcmQgPSB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHRoYXQuZGF0YSB9Owp9CmVsc2UgewogICAgY29uc3Qgam9pbkNvZGUgPSB0aGF0LnRleHQucmVwbGFjZUFsbCgiLSIsICIiKTsKICAgIGNvbnN0IHJlY29yZEtleSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXk7CiAgICBjb25zb2xlLmxvZygiSk9JTkNPREUiLCBqb2luQ29kZSkKICAgIGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCBqb2luQ29kZSk7Cn0KCmlmIChnZXRSZWNvcmQuc3VjY2VzcykgewogICAgY29uc3QgZGF0ZSA9IERhdGVUaW1lLm5vdygpOwogICAgbGV0IGNyZWF0ZURhdGUgPSBEYXRlVGltZS5mcm9tTWlsbGlzKGdldFJlY29yZC5kYXRhLmRhdGUpOwogICAgbGV0IGRpZmZlcmVuY2UgPSBkYXRlLmRpZmYoY3JlYXRlRGF0ZSwgImRheXMiKS50b09iamVjdCgpOwoKICAgIGRpZmZlcmVuY2UgPSBNYXRoLmZsb29yKGRpZmZlcmVuY2UuZGF5cyk7CgogICAgaWYgKGRpZmZlcmVuY2UgPCA4KSB7CiAgICAgICAgb3MudG9hc3QoImpvaW5pbmcgaG9zdCBub3ciKTsKCiAgICAgICAgb3MuZ29Ub1VSTChnZXRSZWNvcmQuZGF0YS51cmwpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgb3MudG9hc3QoImpvaW4gY29kZSBvdXQgb2YgZGF0ZSwgcGxlYXNlIGdlbmVyYXRlIGEgbmV3IGpvaW4gY29kZSIpOwogICAgfQp9CmVsc2UgewogICAgb3MudG9hc3QoImNvZGUvYWIgaW52YWxpZCwgcGxlYXNlIHRyeSBhZ2FpbiIpOwp9JwCAlY3eDwAGc2VhcmNoAgQAgJWN3g+Qfyjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCAlY3eDwAIYWJJZ25vcmUCBACAlY3eD7d/BHRydWUnAICVjd4PAARtZW51AgQAgJWN3g+8fyjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCAlY3eDwAVYWJTa2lsbEluaXRpYWxpemF0aW9uAgQAgJWN3g/jf6MCQC8vRmluZCB0aGUgYXBwcm9wcmlhdGUgYXJyYXkgYW5kIHBvcHVsYXRlIHNraWxscwpsZXQgc2tpbGxBcnJheSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3NbdGhhdCArICJTa2lsbEFycmF5Il07Cgpmb3IgKGxldCBpID0gMDsgaSA8IHNraWxsQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgIGF3YWl0IHRoaXNCb3QuYWJBZGFwdChza2lsbEFycmF5W2ldKTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLmVtYmVkID09PSAnaW9zJykgewogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCdhYklPU0JyaWRnZScpOwp9CgpyZXR1cm47JwCAlY3eDwAGYmFubmVyAgQAgJWN3g+HggEo8J+Ul2I1NTJlYWY5LWE5ZDYtNDFjOC04NTE1LWNiZDJhYmVhYWU3MycAgJWN3g8ABWlucHV0AgQAgJWN3g+uggEo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcAgJWN3g8ADWxvYWRpbmdTdGF0dXMCBACAlY3eD9WCAcYHQGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTG9hZFN0YXR1cyI7CgpsZXQgc3RhdHVzQm90ID0ge307CgpzdGF0dXNCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKc3RhdHVzQm90LmxhYmVsID0gInZlcmlmeWluZyBhdXRoQm90IjsKc3RhdHVzQm90LmxhYmVsQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwpzdGF0dXNCb3QuYWJMb2FkU3RhdHVzID0gdHJ1ZTsKc3RhdHVzQm90Lm1lbnVJdGVtU3R5bGUgPSB7ICJiYWNrZ3JvdW5kIjogIm5vbmUiIH07CnN0YXR1c0JvdC50cmFja051bSA9IDA7CnN0YXR1c0JvdC5vbkNyZWF0ZSA9IGBACiAgICBpZiAodGFncy50cmFja051bSA9PSAyKSB7CiAgICAgICAgdGFncy50cmFja051bSA9IDA7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICB0YWdzLnRyYWNrTnVtKys7CiAgICB9CgogICAgdGFncy5sYWJlbCA9IHRhZ3NbImxhYmVsIit0YWdzLnRyYWNrTnVtXTsKICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSB0YWdzWyJmb3JtIit0YWdzLnRyYWNrTnVtXTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHdoaXNwZXIodGhpc0JvdCwgIm9uQ3JlYXRlIiksIDUwMCk7YDsKc3RhdHVzQm90LmxhYmVsMCA9ICJ2ZXJpZnlpbmcgYXV0aEJvdC4iOwpzdGF0dXNCb3QubGFiZWwxID0gInZlcmlmeWluZyBhdXRoQm90Li4iOwpzdGF0dXNCb3QubGFiZWwyID0gInZlcmlmeWluZyBhdXRoQm90Li4uIjsKc3RhdHVzQm90LmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwpzdGF0dXNCb3QuZm9ybTEgPSAiaG91cmdsYXNzX3RvcCI7CnN0YXR1c0JvdC5mb3JtMiA9ICJob3VyZ2xhc3NfYm90dG9tIjsKc3RhdHVzQm90Lm9uRGVzdHJveSA9IGBACiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CmA7CgpsZXQgY3JlYXRlZFN0YXR1c0JvdCA9IGNyZWF0ZShzdGF0dXNCb3QpOwoKcmV0dXJuIGNyZWF0ZWRTdGF0dXNCb3Q7JwCAlY3eDwADYXNrAgQAgJWN3g+cigEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAgJWN3g8ADWFiTG9hZFN0dWRpb3MCBACAlY3eD8OKAVtAY29uc3QgdXNlclN0dWRpb3MgPSBhd2FpdCBvcy5saXN0VXNlclN0dWRpb3MoKTsKY29uZmlnQm90LnRhZ3MudXNlcl9zdHVkaW9zID0gdXNlclN0dWRpb3M7JwCAlY3eDwAHYWJUaW1lcgIEAICVjd4Pn4sBwQZAaWYgKGdldEJvdCgiYWJUaW1lciIsIHRydWUpKSB7CiAgICByZXR1cm47Cn0KCmlmICghdGFncy5hYlhQKSB7CiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYlhQIiwgIjAiLCAibG9jYWwiKTsKfQoKbGV0IHRpbWVyQm90ID0ge307Cgp0aW1lckJvdC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwp0aW1lckJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKdGltZXJCb3Qub25DcmVhdGUgPSBgQAogICAgbWFza3MuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzQm90Lm9uVGltZUNoZWNrKCksIDYwMDAwKTsKYDsKdGltZXJCb3QuYWJUaW1lciA9IHRydWU7CnRpbWVyQm90Lm9uVGltZUNoZWNrID0gYEAKICAgIGlmICh0YWdzLm5vdElkbGUpIHsKICAgICAgICB0YWdzLm5vdElkbGUgPSBmYWxzZTsKCiAgICAgICAgLy9jb25zb2xlLmxvZygiWFAiLCBsaW5rcy5tYW5hZ2VyLnRhZ3MuYWJYUCk7CgogICAgICAgIGNvbnN0IHRvdGFsWFAgPSBsaW5rcy5tYW5hZ2VyLnRhZ3MuYWJYUCArIDE7CgogICAgICAgIHNldFRhZ01hc2sobGlua3MubWFuYWdlciwgImFiWFAiLCB0b3RhbFhQLCAibG9jYWwiKTsKICAgIH0KYDsKdGltZXJCb3Qubm90SWRsZSA9IGZhbHNlOwp0aW1lckJvdC5vbkFueUFjdGlvbiA9IGBACiAgICBpZiAoIXRhZ3Mubm90SWRsZSkgewogICAgICAgIGlmICh0aGF0LmFjdGlvbi5pZCA9PSBncmlkUG9ydGFsQm90LmlkKQogICAgICAgIHsKICAgICAgICAgICAgdGFncy5ub3RJZGxlID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CmA7CgpsZXQgYWJUaW1lciA9IGNyZWF0ZSh0aW1lckJvdCk7CgpnbG9iYWxUaGlzLmFiVGltZXIgPSBhYlRpbWVyOycAgJWN3g8ABXN0b3JlAgQAgJWN3g/hkQEo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAgJWN3g8AB2NvbnNvbGUCBACAlY3eD4iSASjwn5SXMjRiN2U2NmYtMGQ1Yi00MDY0LWJmNDgtYjU2MmI5ZTZlM2ViJwCAlY3eDwAJYWJWZXJzaW9uAgQAgJWN3g+vkgEFMTAuMjMnAICVjd4PAAxhYkxvYWRDb25maWcCBACAlY3eD7WSAZoGQGNvbnN0IHVybCA9IG5ldyBVUkwob3MuZ2V0QUIxQm9vdHN0cmFwVVJMKCkpOwp1cmwucGF0aG5hbWUgPSB1cmwucGF0aG5hbWUucmVwbGFjZSgnYWIxLmF1eCcsICdhYkNvbmZpZy5hdXgnKTsKCnRyeSB7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHdlYi5ob29rKHsgbWV0aG9kOiAiR0VUIiwgdXJsOiB1cmwuaHJlZiB9KTsKCiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIENvdWxkIG5vdCBkb3dubG9hZCBhYkNvbmZpZy4gUmVzcG9uc2U6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgdXBkYXRlcyA9IHJlc3BvbnNlLmRhdGEudXBkYXRlczsKICAgIGF3YWl0IG9zLmFwcGx5VXBkYXRlc1RvSW5zdCh1cGRhdGVzKTsKCiAgICBpZiAobGlua3MucmVtZW1iZXIpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIExvYWRlZCBhYkNvbmZpZyBhdXggYnV0IGNvdWxkIG5vdCBmaW5kIHJlbWVtYmVyIGJvdC5gKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0gY2F0Y2ggKGUpIHsKICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gRmFpbGVkIHRvIGRvd25sb2FkIGFiQ29uZmlnLiBTZWUgYWJvdmUgZXJyb3IuYCk7CiAgICByZXR1cm4gZmFsc2U7Cn0nAICVjd4PABdhYkJ1aWxkQ2FzdWFsQ2F0YWxvZ1VSTAIEAICVjd4P0JgB/wFAY29uc3QgcmVsYXRpdmVQYXRoID0gdGhhdDsKCmNvbnN0IHVybCA9IG5ldyBVUkwobGlua3MucmVtZW1iZXIudGFncy5jYXN1YWxDYXRhbG9nVVJMKTsKY29uc3QgZW52ID0gbGlua3MucmVtZW1iZXIudGFncy5jYXN1YWxDYXRhbG9nRW52OwoKdXJsLnBhdGhuYW1lID0gcmVsYXRpdmVQYXRoOwoKaWYgKGVudiAmJiBlbnYgIT09ICdwcm9kJykgewogICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ2VudicsIGVudik7Cn0KCnJldHVybiB1cmwuaHJlZjsnAICVjd4PAAdjaGFubmVsAgQAgJWN3g/QmgEo8J+Ul2E5YjZhYTBkLWIzNTctNGRlNi05YmVmLTg1MzQ4YWIxZDBlMCcAgJWN3g8AC3BlcnNvbmFsaXR5AgQAgJWN3g/3mgEo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAgJWN3g8ADGFiSW5zdFVwZGF0ZQIEAICVjd4PnpsBogFALy8gVXBkYXRlIHRoZSBhYkluc3QgdGFnIHdoaWNoIHJlcHJlc2VudHMgdGhlIGluc3QgdGhhdCB0aGlzIGFiIGV4aXN0cyBpbi4KY29uc3QgY3VySW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7CnNldFRhZ01hc2sodGhpc0JvdCwgJ2FiSW5zdCcsIGN1ckluc3QsICdzaGFyZWQnKTsnAICVjd4PAAxvbkluc3RKb2luZWQCBACAlY3eD8GcARhAdGhpc0JvdC5hYkluc3RVcGRhdGUoKTsnAICVjd4PAAtvbkluc3RMZWF2ZQIEAICVjd4P2pwBGEB0aGlzQm90LmFiSW5zdFVwZGF0ZSgpOycAgJWN3g8ADHJlc2VydmVkQXNrcwIEAICVjd4P85wBDPCfp6xbImhvbWUiXScAgJWN3g8ACGFydGlmYWN0AgQAgJWN3g/+nAEo8J+Ulzc4ZTQxNTAzLWM5MzMtNGY4YS04MTdhLWJhOTdiZjhkNWQyNycAgJWN3g8AC2JvdF9mYWN0b3J5AgQAgJWN3g+lnQEo8J+Ul2M3OGFhNjYzLWQwNWMtNGVjNC1iYzJjLTI2ZmQ1MTU2MGI5NycAgJWN3g8ABXV0aWxzAgQAgJWN3g/MnQEo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAgJWN3g8ACHVwZGF0ZUFCAgQAgJWN3g/znQGVKUBjb25zdCByZWxvYWRQYWdlID0gdGhhdD8ucmVsb2FkUGFnZSA/PyB0cnVlOw0KY29uc3Qgc2hvd0luZGljYXRvciA9IHRoYXQ/LnNob3dJbmRpY2F0b3IgPz8gdHJ1ZTsNCg0KY29uc3QgRFJZX1JVTiA9IGZhbHNlOw0KDQpsZXQgYnVzeUluZGljYXRvcjsNCg0KaWYgKHNob3dJbmRpY2F0b3IpIHsNCiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICd1cGRhdGVBQk1lbnUnOw0KICAgIGJ1c3lJbmRpY2F0b3IgPSBhd2FpdCBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3IoeyB1cGRhdGVBQk1lbnU6IHRydWUsIGxhYmVsOiBgdXBkYXRpbmcgJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWAgfSk7DQp9DQoNCmxldCBvdmVyd3JpdGVSZXN1bHQ7DQoNCnRyeSB7DQogICAgLy8gVXBkYXRlIGFiQ29uZmlnLg0KICAgIGNvbnN0IGFiQ29uZmlnVVJMID0gb3MuZ2V0QUIxQm9vdHN0cmFwVVJMKCk7DQogICAgY29uc3QgYWJDb25maWdSZXNwb25zZSA9IGF3YWl0IHdlYmhvb2soeyBtZXRob2Q6ICJHRVQiLCB1cmw6IGFiQ29uZmlnVVJMIH0pOw0KDQogICAgYXNzZXJ0KGFiQ29uZmlnUmVzcG9uc2Uuc3RhdHVzID09PSAyMDAsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gQ291bGQgbm90IGRvd25sb2FkIGFiQ29uZmlnLiBSZXNwb25zZTogJHthYkNvbmZpZ1Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7DQogICAgYXNzZXJ0KGFiQ29uZmlnUmVzcG9uc2UuZGF0YS52ZXJzaW9uID09PSAyLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFiQ29uZmlnIG11c3QgYmUgaW4gYXV4IGZpbGUgZm9ybWF0IHYyLiBBY3R1YWwgYXV4IGZpbGUgZm9ybWF0IHZlcnNpb246ICR7YWJDb25maWdSZXNwb25zZS5kYXRhLnZlcnNpb259YCk7DQoNCiAgICBvdmVyd3JpdGVSZXN1bHQgPSBhd2FpdCB0aGlzQm90LmF1eFYyT3ZlcndyaXRlKHsgYXV4OiBhYkNvbmZpZ1Jlc3BvbnNlLmRhdGEsIGdyb3VwVGFnOiAnYWJDb25maWcnLCBkcnlSdW46IERSWV9SVU4gfSk7DQogICAgc2V0VGFnTWFzayhhYi5saW5rcy5yZW1lbWJlciwgJ2FiQ29uZmlnU291cmNlSGFzaCcsIG92ZXJ3cml0ZVJlc3VsdC5zb3VyY2VIYXNoLCAnc2hhcmVkJyk7DQoNCiAgICAvLyBVcGRhdGUgYWIgc2tpbGxzLg0KICAgIGNvbnN0IGxvYWRlZFNraWxscyA9IHRoaXNCb3QuYWJMb2FkZWRTa2lsbHMoKTsNCg0KICAgIGZvciAobGV0IHNraWxsTmFtZSBvZiBsb2FkZWRTa2lsbHMpIHsNCiAgICAgICAgY29uc3Qgc2tpbGxVUkwgPSB0aGlzQm90LmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKGAvYWIvJHtza2lsbE5hbWV9LmF1eGApOw0KDQogICAgICAgIC8vIFNraWxscyBjYW4gYmUgcmVzdHJ1Y3R1cmVkLCBtZWFuaW5nIHRoYXQgdGhleSBjb3VsZCBiZSByZW1vdmVkIGVudGlyZWx5IGluIHRoZSBmdXR1cmUuDQogICAgICAgIC8vIElmIGEgZmlsZSBmYWlscyB0byBiZSByZXRyaWV2ZWQsIHRoZW4gcmVtb3ZlIGFsbCB0aGUgYm90cyBpbiB0aGUgZ3JvdXAgaW4gdGhlIGluc3QuDQogICAgICAgIGxldCByZW1vdmVTa2lsbCA9IGZhbHNlOw0KICAgICAgICBsZXQgc2tpbGxSZXNwb25zZTsNCg0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgc2tpbGxSZXNwb25zZSA9IGF3YWl0IHdlYmhvb2soeyBtZXRob2Q6ICJHRVQiLCB1cmw6IHNraWxsVVJMIH0pOw0KDQogICAgICAgICAgICBpZiAodGFncy5kZWJ1Zykgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2tpbGxSZXNwb25zZTpgLCBza2lsbFJlc3BvbnNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYXNzZXJ0KHNraWxsUmVzcG9uc2UuZGF0YS52ZXJzaW9uID09PSAyLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dICR7c2tpbGxOYW1lfSBtdXN0IGJlIGluIGF1eCBmaWxlIGZvcm1hdCB2Mi4gQWN0dWFsIGF1eCBmaWxlIGZvcm1hdCB2ZXJzaW9uOiAke3NraWxsUmVzcG9uc2UuZGF0YS52ZXJzaW9ufWApOw0KDQogICAgICAgICAgICBpZiAoc2tpbGxSZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgew0KICAgICAgICAgICAgICAgIGlmIChza2lsbFJlc3BvbnNlLnN0YXR1cyA9PT0gNDAzIHx8IHNraWxsUmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlU2tpbGwgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIENvdWxkIG5vdCBkb3dubG9hZCAke3NraWxsTmFtZX0uIFJlc3BvbnNlOiAke3NraWxsUmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYXVnaHQgZXJyb3Igd2hpbGUgZG93bmxvYWRpbmcgc2tpbGw6YCwgZSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlPy5zdGF0dXMgPT09IDQwMyB8fCBlLnJlc3BvbnNlPy5zdGF0dXMgPT09IDQwNCkgew0KICAgICAgICAgICAgICAgIC8vIEZpbGUgZG9lc250IGV4aXN0IGFueW1vcmUsIHRoZSBza2lsbCBoYXMgYmVlbiByZW1vdmVkLg0KICAgICAgICAgICAgICAgIHJlbW92ZVNraWxsID0gdHJ1ZTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhyb3cgZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYgKHNraWxsUmVzcG9uc2UgJiYgIXJlbW92ZVNraWxsKSB7DQogICAgICAgICAgICBvdmVyd3JpdGVSZXN1bHQgPSBhd2FpdCB0aGlzQm90LmF1eFYyT3ZlcndyaXRlKHsgYXV4OiBza2lsbFJlc3BvbnNlLmRhdGEsIGdyb3VwVGFnOiBza2lsbE5hbWUsIGRyeVJ1bjogRFJZX1JVTiB9KTsNCg0KICAgICAgICAgICAgY29uc3QgbG9hZGVkU2tpbGxCb3QgPSBnZXRCb3QoYiA9PiBiLnRhZ3MuYWJMb2FkZWRTa2lsbCA9PT0gc2tpbGxOYW1lICYmIGIuc3BhY2UgPT09ICdzaGFyZWQnKTsNCiAgICAgICAgICAgIGFzc2VydChsb2FkZWRTa2lsbEJvdCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjb3VsZCBub3QgZmluZCBsb2FkZWQgc2tpbGwgYm90IGZvciAke3NraWxsTmFtZX0uYCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHNldFRhZ01hc2sobG9hZGVkU2tpbGxCb3QsICdhYkxvYWRlZFNraWxsU291cmNlSGFzaCcsIG92ZXJ3cml0ZVJlc3VsdC5zb3VyY2VIYXNoLCAnc2hhcmVkJyk7DQogICAgICAgIH0gZWxzZSBpZiAocmVtb3ZlU2tpbGwpIHsNCiAgICAgICAgICAgIGNvbnN0IHNraWxsQm90cyA9IGdldEJvdHMoYiA9PiBiLnRhZ3Nbc2tpbGxOYW1lXSA9PT0gdHJ1ZSk7DQoNCiAgICAgICAgICAgIGlmIChEUllfUlVOKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBkZWxldGUgJHtza2lsbEJvdHMubGVuZ3RofSAke3NraWxsTmFtZX0gYm90KHMpIGJlY2F1c2UgJHtza2lsbE5hbWV9IGlzIG5vIGxvbmdlciBpbiB0aGUgY2FzdWFsIGNhdGFsb2cuYCkNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICBpZiAodGFncy5kZWJ1Zykgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gU2tpbGwgJHtza2lsbE5hbWV9IGlzIG5vIGxvbmdlciBpbiB0aGUgY2FzdWFsIGNhdGFsb2cuIFJlbW92ZSAke3NraWxsQm90cy5sZW5ndGh9ICR7c2tpbGxOYW1lfSBib3QocykgZnJvbSBpbnN0LmApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBkZXN0cm95KHNraWxsQm90cyk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBVcGRhdGUgYWJDb3JlIChkbyB0aGlzIG9uZSBsYXN0ISkNCiAgICBjb25zdCBhYkNvcmVVUkwgPSB0aGlzQm90LmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKCcvYWIvYWJDb3JlLmF1eCcpOw0KICAgIGNvbnN0IGFiQ29yZVJlc3BvbnNlID0gYXdhaXQgd2ViLmhvb2soeyBtZXRob2Q6ICJHRVQiLCB1cmw6IGFiQ29yZVVSTCB9KTsNCg0KICAgIGFzc2VydChhYkNvcmVSZXNwb25zZS5zdGF0dXMgPT09IDIwMCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBDb3VsZCBub3QgZG93bmxvYWQgYWJDb3JlLiBSZXNwb25zZTogJHthYkNvcmVSZXNwb25zZS5zdGF0dXNUZXh0fWApOw0KICAgIGFzc2VydChhYkNvcmVSZXNwb25zZS5kYXRhLnZlcnNpb24gPT09IDIsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWJDb3JlIG11c3QgYmUgaW4gYXV4IGZpbGUgZm9ybWF0IHYyLiBBY3R1YWwgYXV4IGZpbGUgZm9ybWF0IHZlcnNpb246ICR7YWJDb3JlUmVzcG9uc2UuZGF0YS52ZXJzaW9ufWApOw0KDQogICAgb3ZlcndyaXRlUmVzdWx0ID0gYXdhaXQgdGhpc0JvdC5hdXhWMk92ZXJ3cml0ZSh7IGF1eDogYWJDb3JlUmVzcG9uc2UuZGF0YSwgZ3JvdXBUYWc6ICdhYkNvcmUnLCBkcnlSdW46IERSWV9SVU4gfSk7DQogICAgc2V0VGFnTWFzayhhYiwgJ2FiQ29yZVNvdXJjZUhhc2gnLCBvdmVyd3JpdGVSZXN1bHQuc291cmNlSGFzaCwgJ3NoYXJlZCcpOw0KDQogICAgaWYgKHJlbG9hZFBhZ2UpIHsNCiAgICAgICAgY29uc3QgcmVtb3RlRGF0YUV2ZW50ID0gJ3VwZGF0ZV9hYl9yZWxvYWRfcGFnZSc7DQogICAgICAgIGNvbnN0IHJlbW90ZURhdGFBcmcgPSB7IHJlbG9hZFBhZ2UsIGRyeVJ1bjogRFJZX1JVTiB9Ow0KDQogICAgICAgIGlmIChvcy5pc0NvbGxhYm9yYXRpdmUoKSkgew0KICAgICAgICAgICAgY29uc3QgcmVtb3RlcyA9IGF3YWl0IG9zLnJlbW90ZXMoKTsNCiAgICAgICAgICAgIHNlbmRSZW1vdGVEYXRhKHJlbW90ZXMsIHJlbW90ZURhdGFFdmVudCwgcmVtb3RlRGF0YUFyZyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzQm90Lm9uUmVtb3RlRGF0YSh7IG5hbWU6IHJlbW90ZURhdGFFdmVudCwgdGhhdDogcmVtb3RlRGF0YUFyZywgcmVtb3RlSWQ6IGNvbmZpZ0JvdC5pZCB9KTsNCiAgICAgICAgfQ0KICAgIH0NCn0gZmluYWxseSB7DQogICAgaWYgKGJ1c3lJbmRpY2F0b3IpIHsNCiAgICAgICAgZGVzdHJveShidXN5SW5kaWNhdG9yKTsNCiAgICAgICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOw0KICAgIH0NCn0nAICVjd4PAAVkZWJ1ZwIEAICVjd4PiccBBHRydWUnAICVjd4PAA5hdXhWMk92ZXJ3cml0ZQIEAICVjd4PjscBkSpAY29uc3QgYXV4ID0gdGhhdD8uYXV4Owpjb25zdCBncm91cFRhZyA9IHRoYXQ/Lmdyb3VwVGFnOwpjb25zdCBkcnlSdW4gPSB0aGF0Py5kcnlSdW4gPz8gZmFsc2U7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9Cgphc3NlcnQoYXV4Py52ZXJzaW9uID09PSAyLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGF1eCBwYXJhbWV0ZXIgaXMgcmVxdWlyZWQgdG8gYmUgYSB2MiBhdXggZmlsZS5gKTsKYXNzZXJ0KGdyb3VwVGFnID09IG51bGwgfHwgdHlwZW9mIGdyb3VwVGFnID09PSAnc3RyaW5nJywgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBncm91cFRhZyBwYXJhbWV0ZXIgaWYgcHJvdmlkZWQsIG11c3QgYmUgYSBzdHJpbmcuYCk7Cgpjb25zdCBzdGF0ZSA9IGF3YWl0IG9zLmdldEluc3RTdGF0ZUZyb21VcGRhdGVzKGF1eC51cGRhdGVzKTsKCi8vIFN1cGVyIGhhcmRjb2RlZCBtZXNzeSBmaXggZm9yIGNvbXB1dGluZyBhYkNvbmZpZyBzb3VyY2UgaGFzaC4KaWYgKGdyb3VwVGFnID09PSAnYWJDb25maWcnKSB7IAogICAgZm9yIChsZXQgaWQgaW4gc3RhdGUpIHsKICAgICAgICBkZWxldGUgc3RhdGVbaWRdLnRhZ3MuYmFzZUFCOyAvLyBiYXNlQUIgaXMgYW4gYW5ub3lpbmcgdGFnIHRoYXQgc2hvdWxkIG5vdCBiZSBjb21wdXRlZCBhcyBwYXJ0IG9mIGhhc2ggc3RhdGUuCiAgICB9Cn0KCmxldCBzb3VyY2VIYXNoID0gY3J5cHRvLmhhc2goJ3NoYTEnLCAnaGV4Jywgc3RhdGUpOwpsZXQgcHJldkdyb3VwQm90cyA9IGdldEJvdHMoYiA9PiBiLnRhZ3NbZ3JvdXBUYWddID09PSB0cnVlKTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHN0YXRlOmAsIHN0YXRlKTsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gcHJldkdyb3VwQm90czpgLCBwcmV2R3JvdXBCb3RzKTsKfQoKLy8gU3RlcCAxOiBBcHBseSB1cGRhdGVzIGRpcmVjdGx5IHRvIHRoZSBpbnN0IGFzLWlzLgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBTdGVwIDE6IEFwcGx5IHVwZGF0ZXMgZGlyZWN0bHkgdG8gdGhlIGluc3QgYXMtaXMuYCk7Cn0KCmlmICghZHJ5UnVuKSB7CiAgICBhd2FpdCBvcy5hcHBseVVwZGF0ZXNUb0luc3QoYXV4LnVwZGF0ZXMpOwp9IGVsc2UgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBhcHBseSB1cGRhdGVzIHRvIGluc3QuYCkKfQoKLy8gU3RlcCAyOiBEZWxldGUgcHJldmlvdXMgZ3JvdXAgYm90cyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIHVwZGF0ZSBzdGF0ZS4KaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gU3RlcCAyOiBEZWxldGUgcHJldmlvdXMgZ3JvdXAgYm90cyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIHVwZGF0ZSBzdGF0ZS5gKTsKfQoKZm9yIChjb25zdCBwcmV2R3JvdXBCb3Qgb2YgcHJldkdyb3VwQm90cykgewogICAgaWYgKHN0YXRlW3ByZXZHcm91cEJvdC5pZF0gPT0gbnVsbCkgewogICAgICAgIGlmIChkcnlSdW4pIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBkZWxldGUgYm90ICR7cHJldkdyb3VwQm90LmlkfSBwcmV2aW91c2x5IGJlbG9uZ2luZyB0byBncm91cCAke2dyb3VwVGFnfWApOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGVzdHJveWluZyBwcmV2aW91cyBncm91cCBib3QgJHtwcmV2R3JvdXBCb3QuaWR9IHRoYXQgaXMgbm8gbG9uZ2VyIGluIHRoZSB1cGRhdGUgc3RhdGUuYCk7CiAgICAgICAgfQoKICAgICAgICBkZXN0cm95KHByZXZHcm91cEJvdCk7CiAgICB9Cn0KCi8vIFN0ZXAgMzogRm9yIGVhY2ggYm90IGluIHRoZSB1cGRhdGUgc3RhdGUsIGNyZWF0ZSwgdXBkYXRlLCBhbmQgZGVsZXRlIHRhZ3Mgb24gdGhlIGV4aXN0aW5nIGJvdHMgaW4gdGhlIGluc3QuCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIFN0ZXAgMzogRm9yIGVhY2ggYm90IGluIHRoZSB1cGRhdGUgc3RhdGUsIGNyZWF0ZSwgdXBkYXRlLCBhbmQgZGVsZXRlIHRhZ3Mgb24gdGhlIGV4aXN0aW5nIGJvdHMgaW4gdGhlIGluc3QuYCk7Cn0KCmZvciAoY29uc3QgYm90SWQgaW4gc3RhdGUpIHsKICAgIGNvbnN0IGJvdCA9IGdldEJvdCgnaWQnLCBib3RJZCk7CiAgICBjb25zdCBib3RTdGF0ZSA9IHN0YXRlW2JvdElkXTsKCiAgICBpZiAoYm90KSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBmb3VuZCBleGlzdGluZyBib3QgJHtib3RJZH1gKTsKICAgICAgICB9CgogICAgICAgIC8vIEhhbmRsZXMgdGFnIGNyZWF0ZSAvIHVwZGF0ZS4KICAgICAgICBmb3IgKGNvbnN0IHN0YXRlVGFnTmFtZSBpbiBib3RTdGF0ZS50YWdzKSB7CiAgICAgICAgICAgIGlmIChib3QucmF3W3N0YXRlVGFnTmFtZV0gIT0gYm90U3RhdGUudGFnc1tzdGF0ZVRhZ05hbWVdKSB7CiAgICAgICAgICAgICAgICBpZiAoZHJ5UnVuKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcnkgcnVuOiB3b3VsZCBzZXQgdGFnICcke3N0YXRlVGFnTmFtZX0nIG9uIGJvdCAke2JvdElkfSB0byB2YWx1ZTpgLCBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV0pOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzZXQgdGFnICcke3N0YXRlVGFnTmFtZX0nIG9uIGJvdCAke2JvdElkfSB0bzpgLCBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJvdC50YWdzW3N0YXRlVGFnTmFtZV0gPSBib3RTdGF0ZS50YWdzW3N0YXRlVGFnTmFtZV07CgogICAgICAgICAgICAgICAgaWYgKGJvdFN0YXRlLnRhZ3Nbc3RhdGVUYWdOYW1lXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0YWcgJyR7c3RhdGVUYWdOYW1lfScgZm9yIGJvdCAke2JvdElkfSBpcyBudWxsLCBjbGVhcmluZyBhbnkgdGFnIG1hc2tzIGFzIHdlbGwuYCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBDbGVhciBhbGwgcG9zc2libGUgbWFza3MgZm9yIHRoaXMgdGFnIGFzIHdlbGwuCiAgICAgICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIHN0YXRlVGFnTmFtZSwgbnVsbCwgJ2xvY2FsJyk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIHN0YXRlVGFnTmFtZSwgbnVsbCwgJ3RlbXBMb2NhbCcpOwogICAgICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYm90LCBzdGF0ZVRhZ05hbWUsIG51bGwsICdzaGFyZWQnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgc3RhdGVUYWdOYW1lLCBudWxsLCAndGVtcFNoYXJlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRhZyAnJHtzdGF0ZVRhZ05hbWV9JyBmb3IgYm90ICR7Ym90SWR9IGlzIGFscmVhZHkgdXAtdG8tZGF0ZS5gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gRGVsZXRlIHRhZ3MgKGFuZCBtYXNrcyBmb3IgdGhvc2UgdGFncykgb24gZXhpc3RpbmcgYm90IHRoYXQgYXJlIG5vdCBpbiB1cGRhdGUgc3RhdGUuCiAgICAgICAgY29uc3QgYm90VGFncyA9IE9iamVjdC5rZXlzKGJvdC50YWdzKTsKCiAgICAgICAgZm9yIChjb25zdCBib3RUYWdOYW1lIG9mIGJvdFRhZ3MpIHsKICAgICAgICAgICAgaWYgKGJvdFN0YXRlLnRhZ3NbYm90VGFnTmFtZV0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGRyeVJ1bikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZHJ5IHJ1bjogd291bGQgZGVsZXRlIHRhZyAnJHtib3RUYWdOYW1lfScgb24gYm90ICR7Ym90SWR9LmApOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkZWxldGUgdGFnIChhbmQgbWFza3MpICcke2JvdFRhZ05hbWV9JyBvbiBib3QgJHtib3RJZH0uYCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYm90LnRhZ3NbYm90VGFnTmFtZV0gPSBudWxsOwogICAgICAgICAgICAgICAgLy8gQ2xlYXIgYWxsIHBvc3NpYmxlIG1hc2tzIGZvciB0aGlzIHRhZyBhcyB3ZWxsLgogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIGJvdFRhZ05hbWUsIG51bGwsICdsb2NhbCcpOwogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhib3QsIGJvdFRhZ05hbWUsIG51bGwsICd0ZW1wTG9jYWwnKTsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYm90LCBib3RUYWdOYW1lLCBudWxsLCAnc2hhcmVkJyk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGJvdCwgYm90VGFnTmFtZSwgbnVsbCwgJ3RlbXBTaGFyZWQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNvdWxkIG5vdCBmaW5kIGJvdCAke2JvdElkfSBpbiBpbnN0LmApOwogICAgfQp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkb25lLmApOwp9Cgpjb25zdCBib3RJZHMgPSBPYmplY3Qua2V5cyhzdGF0ZSk7CgpyZXR1cm4gewogICAgZ3JvdXBUYWcsCiAgICBib3RJZHMsCiAgICBzb3VyY2VIYXNoLAp9OycAgJWN3g8ADmFiTG9hZGVkU2tpbGxzAgQAgJWN3g+g8QG2AUBjb25zdCBsb2FkZWRTa2lsbHMgPSBuZXcgU2V0KCk7CgpnZXRCb3RzKChiKSA9PiB7CiAgICBpZiAoYi50YWdzLmFiTG9hZGVkU2tpbGwgIT0gbnVsbCkgewogICAgICAgIGxvYWRlZFNraWxscy5hZGQoYi50YWdzLmFiTG9hZGVkU2tpbGwpOwogICAgfQp9KTsKCnJldHVybiBBcnJheS5mcm9tKGxvYWRlZFNraWxscyk7JwCAlY3eDwAMb25SZW1vdGVEYXRhAgQAgJWN3g/X8gGnBUBpZiAodGhhdC5uYW1lID09PSAndXBkYXRlX2FiX3JlbG9hZF9wYWdlJykgewogICAgY29uc3QgeyByZWxvYWRQYWdlLCBkcnlSdW4gfSA9IHRoYXQudGhhdDsKCiAgICBpZiAodGhhdC5yZW1vdGVJZCA9PT0gY29uZmlnQm90LmlkKSB7CiAgICAgICAgLy8gV2FpdCBhIG1vbWVudCBiZWZvcmUgcmVsb2FkaW5nIHRoZSBwYWdlIGlmIHdlIGFyZSB0aGUgb25lcyB0aGF0IHNlbnQgb3V0IHRoZSBtZXNzYWdlLgogICAgICAgIGF3YWl0IG9zLnNsZWVwKDEwMDApOwogICAgfQoKICAgIGxldCBpc1VSTCA9IGZhbHNlOwoKICAgIGlmICh0eXBlb2YgcmVsb2FkUGFnZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBuZXcgVVJMKHJlbG9hZFBhZ2UpOwogICAgICAgICAgICBpc1VSTCA9IHRydWU7CiAgICAgICAgfSBjYXRjaCAoZSkge30KICAgIH0KCiAgICBsZXQgdXJsID0gaXNVUkwgPyByZWxvYWRQYWdlIDogY29uZmlnQm90LnRhZ3MudXJsOwoKICAgIGlmIChkcnlSdW4pIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRyeSBydW46IHdvdWxkIGdvIHRvIHVybGAsIHVybCk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgCiAgICBvcy5nb1RvVVJMKGlzVVJMID8gcmVsb2FkUGFnZSA6IGNvbmZpZ0JvdC50YWdzLnVybCk7Cn0nAICVjd4PAAlvbkVudGVyQVICBACAlY3eD//3ARNAbWFza3MuaW5BUiA9IHRydWU7JwCAlY3eDwAIb25FeGl0QVICBACAlY3eD5P4ARNAbWFza3MuaW5BUiA9IG51bGw7JwCAlY3eDwAJb25FbnRlclZSAgQAgJWN3g+n+AETQG1hc2tzLmluVlIgPSB0cnVlOycAgJWN3g8ACG9uRXhpdFZSAgQAgJWN3g+7+AETQG1hc2tzLmluVlIgPSBudWxsOwA="}]}