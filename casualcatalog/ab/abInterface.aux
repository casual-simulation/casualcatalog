{"version":2,"updates":[{"id":0,"timestamp":1759421551579,"update":"AewBpKfEowQAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwCkp8SjBAAKYWJJRE9yaWdpbgIEAKSnxKMEAQ10b29sYm94X3NraWxsJwCkp8SjBAALYWJJbnRlcmZhY2UCBACkp8SjBA8EdHJ1ZScApKfEowQAC2Rlc2NyaXB0aW9uAgQApKfEowQUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwCkp8SjBAAEZm9ybQIEAKSnxKMEPgdub3RoaW5nJwCkp8SjBAAEbWVudQIEAKSnxKMERijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCkp8SjBAAGc3lzdGVtAgQApKfEowRtFGFiLmludGVyZmFjZS50b29sYm94JwCkp8SjBAAKYWJJRFN0dWRpbwIEAKSnxKMEggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwCkp8SjBAAIcmVtZW1iZXICBACkp8SjBKcBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAKSnxKMEAAt0b29sYm94X2FkZAIEAKSnxKMEzgHlC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgiYmFzZVNraWxsIiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIG1lbnVCb3Qub25Qb2ludGVyVXAoKTsKICAgICAgICBhd2FpdCBvcy5zbGVlcCgyMDApOwogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScApKfEowQABWxlYXJuAgQApKfEowS0DSjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCkp8SjBAAFc3RvcmUCBACkp8SjBNsNKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAKSnxKMEAAZzZWFyY2gCBACkp8SjBIIOKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAKSnxKMEAAhhYklnbm9yZQIEAKSnxKMEqQ4EdHJ1ZScApKfEowQACWFiVmVyc2lvbgIEAKSnxKMErg4FMTAuMTMnAKSnxKMEAA1tYW5pZmVzdGF0aW9uAgQApKfEowS0Dijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCkp8SjBAAQYWJHcmlkTWVudUFjdGlvbgIEAKSnxKME2w65C0AvLyBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKLy8gY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCi8vIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAovLyAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKLy8gICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyBgOwovLyB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACi8vICAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewovLyAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7Ci8vICAgICB9Ci8vIGA7Ci8vIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IGBACi8vICAgICB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKLy8gICAgIHRoaXNCb3QubWFza3Mub25LZXlEb3duID0gbnVsbDsKLy8gICAgIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IG51bGw7Ci8vIGA7CgovLyBjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKLy8gY29uc3QgbWVudUJvdCA9IHt9OwoKLy8gbWVudUJvdC5hYk1lbnUgPSB0cnVlOwovLyBtZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Ci8vIG1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwovLyBtZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwovLyBtZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOwovLyBtZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247Ci8vIG1lbnVCb3Qub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIudG9vbGJveF9hZGQoe3Rvb2xib3hEYXRhOiB0YWdzLnRvb2xib3hfZGF0YSwgZ3JpZERhdGE6IHRhZ3MuZ3JpZERhdGF9KTsgc2hvdXQoImFiTWVudVJlZnJlc2giKTtgOwoKLy8gZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykKLy8gewovLyAgICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOwovLyAgICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsKCi8vICAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7Ci8vICAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7CgovLyAgICAgaWYgKCFleHRhbnRCb3QpCi8vICAgICB7Ci8vICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJvdCk7Ci8vICAgICB9Ci8vIH0nAKSnxKMEABRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAKSnxKMElRriAkBjb25zdCB0b29sYm94QXJyYXkgPSBhYlJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKCmxldCBhbGxUb29sc0xvYWRlZCA9IHRydWU7Cgpmb3IgKGxldCBpID0gMDsgaSA8IHRvb2xib3hBcnJheS5sZW5ndGg7IGkrKykgewogICAgY29uc3QgY3VycmVudFRvb2wgPSB0b29sYm94QXJyYXlbaV0ubmFtZTsKCiAgICBpZiAoIWdldEJvdCgiYWJJRE9yaWdpbiIsIGN1cnJlbnRUb29sKSAmJiAhZ2V0Qm90KGN1cnJlbnRUb29sLCB0cnVlKSkgewogICAgICAgIGFsbFRvb2xzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChhbGxUb29sc0xvYWRlZCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfScApKfEowQADmFiR3JpZE1lbnVJY29uAgQApKfEowT4HApsb2NhbF9tYWxsJwCkp8SjBAAPYWJHcmlkTWVudUxhYmVsAgQApKfEowSDHQ5jYXN1YWwgY2F0YWxvZycApKfEowQAE2FiR3JpZE1lbnVTb3J0T3JkZXICBACkp8SjBJIdATMnAKSnxKMEAA9vbkFCSW5pdGlhbGl6ZWQCBACkp8SjBJQdKkAvLyBsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOycApKfEowQADW9uU2tpbGxVcGRhdGUCBACkp8SjBL8dV0BsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOw0KDQpjb25zb2xlLmxvZygiW1Rvb2xib3hdIExvYWRpbmcgY2FzdWFsIGtpdCIpOycApKfEowQACnNoZWxsVXRpbHMCBACkp8SjBJceKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAKSnxKMEABhhYkdyaWRNZW51T25CZWZvcmVDcmVhdGUCBACkp8SjBL4e/AhAaWYgKGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSkgew0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiR3JpZE1lbnVMYWJlbCIsIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSk7DQp9DQoNCg0KLy9ORVcNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsNCg0KZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykNCnsNCiAgICBjb25zdCBtZW51Qm90ID0ge307DQoNCiAgICBtZW51Qm90LmFiTWVudSA9IHRydWU7DQogICAgbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KICAgIG1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOw0KICAgIG1lbnVCb3QubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7DQogICAgbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsNCiAgICBtZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247DQogICAgbWVudUJvdC5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7DQogICAgDQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7DQogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOw0KDQogICAgaWYgKCFleHRhbnRCb3QpDQogICAgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtZW51Qm90KTsNCiAgICB9DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycApKfEowQAEmFiR3JpZE1lbnVJdGVtVHlwZQIEAKSnxKMEuycIZHJvcGRvd24nAKSnxKMEABFkcm9wZG93blNvcnRPcmRlcgIEAKSnxKMExCcBMycApKfEowQAD2Ryb3Bkb3duT3B0aW9ucwIEAKSnxKMExicG8J+nrFtdJwEEYm90cyQxNzQxMGQ4My03ZWVlLTRhMWUtYjYzOC02NTQ2Mzc0ZDE3YzMBJwCkp8SjBMsnBnN5c3RlbQIEAKSnxKMEzCcRYWIuaW50ZXJmYWNlLnNjYW4nAKSnxKMEyycEZm9ybQIEAKSnxKME3icHbm90aGluZycApKfEowTLJwthYkludGVyZmFjZQIEAKSnxKME5icEdHJ1ZScApKfEowTLJwhhYklnbm9yZQIEAKSnxKME6ycEdHJ1ZScApKfEowTLJw9vblFSQ29kZVNjYW5uZWQCBACkp8SjBPAngA5AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgppZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhc2siKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKHRoYXQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5hc2spIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hc2t9KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5wYXR0ZXJufSk7CiAgICAgICAgfQogICAgICAgIAogICAgfQp9JwCkp8SjBMsnBXN0b3JlAgQApKfEowTxNSjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCkp8SjBMsnBnNlYXJjaAIEAKSnxKMEmDYo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScApKfEowTLJxBhYkNvcmVNZW51QWN0aW9uAgQApKfEowS/NjdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwCkp8SjBMsnD2FiQ29yZU1lbnVMYWJlbAIEAKSnxKME9zYEc2NhbicApKfEowTLJw5hYkNvcmVNZW51SWNvbgIEAKSnxKME/DYPcXJfY29kZV9zY2FubmVyJwCkp8SjBMsnE2FiQ29yZU1lbnVTb3J0T3JkZXICBACkp8SjBIw3ATMnAKSnxKMEyycJYWJWZXJzaW9uAgQApKfEowSONwUxMC4xMycBBGJvdHMkM2E2Y2I5Y2EtYjNiNC00ZDc3LTgyZjYtZmE1OWI1Mjk2ZWM5AScApKfEowSUNwZzeXN0ZW0CBACkp8SjBJU3F2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwCkp8SjBJQ3CGFiSWdub3JlAgQApKfEowStNwR0cnVlJwCkp8SjBJQ3D2Ryb3Bkb3duT3B0aW9ucwIEAKSnxKMEsjcG8J+nrFtdJwCkp8SjBJQ3EmFiQ29yZU1lbnVJdGVtVHlwZQIEAKSnxKMEtzcIZHJvcGRvd24nAKSnxKMElDcRZHJvcGRvd25Tb3J0T3JkZXICBACkp8SjBMA3BGF1dG8nAKSnxKMElDcYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQApKfEowTFN/4gQGNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCmNvbnN0IGN1cnJlbnRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyAibWFwIiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT0gImJsdWVwcmludCIgPyAiYmx1ZXByaW50IiA6ImdyaWQiOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCi8vIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQovLyB9IGVsc2Ugew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCi8vIH0NCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTmF2aWdhdGlvbk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCg0KY29uc3QgaG9tZVdvcmxkQnV0dG9uID0gew0KICAgIC4uLm1lbnVPcHRpb25zLA0KICAgIGxhYmVsOiAiaG9tZSB3b3JsZCIsDQogICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvMzhhZThiNjk1N2Y0NDgzZDg3MTYxNDFkMWU5OGM5M2YwZTdkY2NlMTViYzVjMTIzYmQwZTllMWFiNjg3Y2MwNS5wbmcnLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIGNvbnN0IGN1cnJlbnRVUkwgPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCk7DQogICAgICAgIGNvbnN0IG9yaWdpbiA9IGN1cnJlbnRVUkwub3JpZ2luOw0KDQogICAgICAgIGxldCBuZXdVUkwgPSBuZXcgVVJMKG9yaWdpbik7DQoNCiAgICAgICAgaWYgKGFiUmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY2hhbm5lbCIsIGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb25maWdCb3QudGFncy5jb21JZCkgew0KICAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImNvbUlkIiwgY29uZmlnQm90LnRhZ3MuY29tSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm93bmVyIiwgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiAicGxheWVyIik7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJpbnN0IiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm1hcFBvcnRhbCIsICdob21lJyk7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJhc2siLCAnaG9tZScpOw0KICAgICAgICANCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgew0KICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgic3R1ZGlvIiwgdGhhdC5pZCk7IA0KICAgICAgICB9DQoNCiAgICAgICAgb3Mub3BlblVSTChuZXdVUkwuaHJlZik7DQogICAgYA0KfTsNCg0KaWYgKCFnZXRCb3QoImlzSG9tZVdvcmxkQ29yZSIsIHRydWUpICYmIGF1dGhCb3QpIHsNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lV29ybGRCdXR0b24pOw0KfQ0KDQppZiAoY3VycmVudFBvcnRhbCA9PSAnbWFwJykgew0KDQogICAgY29uc3QgaG9tZUJhc2VCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQoNCiAgICBpZiAoaG9tZUJhc2VCb3QpIHsNCiAgICAgICAgY29uc3QgaG9tZUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhvbWVCYXNlQm90LnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1L2NkMzhhZmZjMDYwNGJlYWE1ODhkYTIxYWExYmU3NTBiYjNlNzNiM2IzY2FlMjNlYjMwMzA3YzM0NDk0NDU5ZjMucG5nJywNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgY29uc3QgaG9tZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBpZiAoaG9tZUJvdCkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGhvbWVCb3QsIHsgem9vbTogMjAwMCB9KS5jYXRjaCgoKSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZUJ1dHRvbik7DQogICAgfQ0KDQogICAgY29uc3QgcGxhY2VzQXJyID0gW107DQogICAgY29uc3QgcGxhY2VzID0gZ2V0Qm90cygiaG9tZVBsYWNlIiwgdHJ1ZSk7DQogICAgZm9yIChjb25zdCBoUGxhY2Ugb2YgcGxhY2VzKSB7DQogICAgICAgIGlmIChoUGxhY2UudGFncy5ob21lQmFzZSA9PSB0cnVlKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBwbGFjZU9iaiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhQbGFjZS50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2xvY2F0aW9uX29uJywNCiAgICAgICAgICAgIHBsYWNlOiBnZXRMaW5rKGhQbGFjZSksDQogICAgICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgICAgIGlmIChsaW5rcy5wbGFjZSkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGxpbmtzLnBsYWNlLCB7IHpvb206IDIwMDAgfSkuY2F0Y2goZSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICAgICAgYA0KICAgICAgICB9DQoNCiAgICAgICAgcGxhY2VzQXJyLnB1c2gocGxhY2VPYmopOw0KICAgIH0NCg0KICAgIHBsYWNlc0Fyci5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgIGNvbnN0IG5hbWVBID0gYS5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KICAgICAgICBjb25zdCBuYW1lQiA9IGIubGFiZWwudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMDsNCiAgICB9KTsNCg0KICAgIGZvciAoY29uc3Qgc29ydGVkUGxhY2Ugb2YgcGxhY2VzQXJyKSB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHNvcnRlZFBsYWNlKTsNCiAgICB9DQoNCg0KICAgIGNvbnN0IGN1cnJlbnRMb2NhdGlvbkJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiAnY3VycmVudCBsb2NhdGlvbicsDQogICAgICAgIGZvcm1BZGRyZXNzOiAnbmVhcl9tZScsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5za2lsbEJvdC5nb1RvQ3VycmVudExvY2F0aW9uKCk7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goY3VycmVudExvY2F0aW9uQnV0dG9uKTsNCn0NCg0KaWYgKGRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPT0gMCkgew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KfSBlbHNlIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycApKfEowSUNxBhYkNvcmVNZW51QWN0aW9uAgQApKfEowTEWANALy8nAKSnxKMElDcLYWJJbnRlcmZhY2UCBACkp8SjBMhYBHRydWUnAKSnxKMElDcPYWJDb3JlTWVudUxhYmVsAgQApKfEowTNWAlwbGFjZSBuYXYnAKSnxKMElDcEZm9ybQIEAKSnxKME11gHbm90aGluZycApKfEowSUNxNnb1RvQ3VycmVudExvY2F0aW9uAgQApKfEowTfWIAEQGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgb3MuZ2V0R2VvbG9jYXRpb24oKTsNCg0KaWYgKGxvY2F0aW9uLnN1Y2Nlc3MpIHsNCiAgICBjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCiAgICBjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCg0KICAgIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IGN1cnJlbnREaW07DQogICAgfQ0KDQogICAgb3MuZm9jdXNPbih7eDogbG9jYXRpb24ubG9uZ2l0dWRlLCB5OiBsb2NhdGlvbi5sYXRpdHVkZX0sIHtwb3J0YWw6ICdtYXAnLCB6b29tOiAyMDAwfSk7DQp9IGVsc2Ugew0KICAgIG9zLnRvYXN0KCJMb2NhdGlvbiBzZXJ2aWNlcyBub3QgYXZhaWxhYmxlIikNCn0nAKSnxKMElDcJYWJWZXJzaW9uAgQApKfEowTgXAUxMC4xMycBBGJvdHMkNDkzZmZhNGQtNDZkNC00YTk4LWFlOWMtMTIxMmQ2NTExMzNmAScApKfEowTmXAZzeXN0ZW0CBACkp8SjBOdcFGFiLmludGVyZmFjZS52ZXJzaW9uJwCkp8SjBOZcDW9uU2tpbGxVcGRhdGUCBACkp8SjBPxcpwFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJJbnRlcmZhY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiSW50ZXJmYWNlTWlub3JWZXJzaW9uOw0KDQpjb25zb2xlLmxvZygiW0FCSW50ZXJmYWNlXSBMb2FkZWQgQUIgSW50ZXJmYWNlIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycApKfEowTmXBdhYkludGVyZmFjZU1ham9yVmVyc2lvbgIEAKSnxKMEpF4BMicApKfEowTmXBdhYkludGVyZmFjZU1pbm9yVmVyc2lvbgIEAKSnxKMEpl4BOCcApKfEowTmXAhhYklnbm9yZQIEAKSnxKMEqF4EdHJ1ZScApKfEowTmXARmb3JtAgQApKfEowStXgdub3RoaW5nJwCkp8SjBOZcC2FiSW50ZXJmYWNlAgQApKfEowS1XgR0cnVlJwCkp8SjBOZcCWFiVmVyc2lvbgIEAKSnxKMEul4FMTAuMTMnAQRib3RzJDRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZgEnAKSnxKMEwF4Gc3lzdGVtAgQApKfEowTBXhNhYi5pbnRlcmZhY2UubnVnZ2V0JwCkp8SjBMBeBGZvcm0CBACkp8SjBNVeB25vdGhpbmcnAKSnxKMEwF4LYWJJbnRlcmZhY2UCBACkp8SjBN1eBHRydWUnAKSnxKMEwF4IYWJJZ25vcmUCBACkp8SjBOJeBHRydWUnAKSnxKMEwF4MYWJMb2FkTnVnZ2V0AgQApKfEowTnXpgCQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXROYW1lOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrbnVnZ2V0TmFtZTsKbGV0IGxvYWRlZE51Z2dldCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogZm9ybWF0dGVkTnVnZ2V0QUIsIGFiVmVyc2lvbjogdGhhdC52ZXJzaW9uLCByZXR1cm5UeXBlOiAiZGF0YSJ9KTsKCmxvYWRlZE51Z2dldCA9IGxvYWRlZE51Z2dldC5zdGF0ZVtudWdnZXROYW1lXS5udWdnZXQ7CgpyZXR1cm4gbG9hZGVkTnVnZ2V0OycApKfEowTAXg9hYlB1Ymxpc2hOdWdnZXQCBACkp8SjBIBhjANALy9zaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogIm51Z05hbWUiLCBkYXRhOiBkYXRhfSk7ICBBREQgRUdHIElEIEVWRU5UVUFMTFkKbGV0IHRlc3ROdWdnZXQgPSB0aGF0LmRhdGE7CmxldCBmb3JtYXR0ZWROdWdnZXQgPSB7aWQ6IHRoYXQubnVnLCBudWdnZXQ6IHRlc3ROdWdnZXR9OwpsZXQgdGVzdE51Z2dldE5hbWUgPSB0aGF0Lm51ZzsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK3Rlc3ROdWdnZXROYW1lOwoKbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gZm9ybWF0dGVkTnVnZ2V0QUI7CgpsaW5rcy5zdG9yZS5hYlB1Ymxpc2hBQih7YWI6IGZvcm1hdHRlZE51Z2dldEFCLCB0YXJnZXQ6IGZvcm1hdHRlZE51Z2dldCwgc291cmNlRXZlbnQ6ICdwdWJsaXNoX251Z2dldCd9KTsnAKSnxKMEwF4PaW1wbGVtZW50TnVnZ2V0AgQApKfEowSNZLEHQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXQ7CmxldCBudWdnZXRWZXJzaW9uQ2hlY2sgPSBudWdnZXROYW1lLmluZGV4T2YoIi52Iik7CmxldCB2ZXJzaW9uOwoKaWYgKG51Z2dldFZlcnNpb25DaGVjayAhPSAtMSkKewogICAgbnVnZ2V0TmFtZSA9IG51Z2dldE5hbWUuc3Vic3RyaW5nKDAsIG51Z2dldFZlcnNpb25DaGVjayk7CgogICAgbGV0IHZlcnNpb25DaGVjayA9IHRoYXQubnVnZ2V0LnN1YnN0cmluZyhudWdnZXRWZXJzaW9uQ2hlY2sgKyAyKTsKCiAgICBpZiAoaXNOYU4odmVyc2lvbkNoZWNrKSkKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyh2ZXJzaW9uQ2hlY2ssICJ2ZXJzaW9uIGlzIG5vdCBhIG51bWJlciIpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHZlcnNpb24gPSBOdW1iZXIodmVyc2lvbkNoZWNrKTsKICAgIH0KfQpjb25zb2xlLmxvZyhudWdnZXROYW1lLCB2ZXJzaW9uKTsKbGV0IG51Z0RhdGEgPSBhd2FpdCB0aGlzQm90LmFiTG9hZE51Z2dldCh7bnVnZ2V0TmFtZTogbnVnZ2V0TmFtZSwgdmVyc2lvbjogdmVyc2lvbn0pOwoKaWYgKG51Z0RhdGEgPT0gImFiSUQgbm90IGZvdW5kIikKewogICAgb3MudG9hc3QoIm51Z2dldCBub3QgZm91bmQiKTsKfQplbHNlCnsKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwogICAgbGV0IHRhcmdldFRhZyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLnRvU3RyaW5nKCk7CiAgICBsZXQgdGFyZ2V0TnVnID0gInsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldFRhZy5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwogICAgaW5zZXJ0VGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIG51Z0RhdGEpOwp9JwCkp8SjBMBeDG51Z2dldEJ1dHRvbgIEAKSnxKMEv2v1DEBsZXQgdGFnVmFsdWUgPSB0aGF0LnRhZ1ZhbHVlOwpsZXQgcmVnZXggPSAvXG4vZ2k7CmxldCBicmVha0NoZWNrOwpsZXQgYnJlYWtBcnJheSA9IFswXTsKLy9sZXQgY3JlYXRlZEJ1dHRvbnMgPSBbXTsKCndoaWxlIChicmVha0NoZWNrID0gcmVnZXguZXhlYyh0YWdWYWx1ZSkpCnsKICAgIGJyZWFrQXJyYXkucHVzaChicmVha0NoZWNrLmluZGV4KTsKfQoKbGV0IG5ld051Z2dldEJ1dHRvbiA9IHt9OwoKbmV3TnVnZ2V0QnV0dG9uLnNwYWNlID0gInRlbXBMb2NhbCI7Cm5ld051Z2dldEJ1dHRvbi5mb3JtID0gImNvZGVCdXR0b24iOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0Qm90ID0gdGhhdC5ib3QuaWQ7Cm5ld051Z2dldEJ1dHRvbi50YXJnZXRUYWcgPSB0aGF0LnRhZzsKbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgbnVnZ2V0IjsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldFJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpuZXdOdWdnZXRCdXR0b25bdGhhdC5ib3QuaWQgKyAiLiIgKyB0aGF0LnRhZ10gPSB0cnVlOwpuZXdOdWdnZXRCdXR0b24ubnVnZ2V0TWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7Cm5ld051Z2dldEJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubnVnZ2V0TWFuYWdlci5pbXBsZW1lbnROdWdnZXQoe2JvdDogdGFncy50YXJnZXRCb3QsIG51Z2dldDogdGFncy50YXJnZXROdWdnZXQsIHRhZzogdGFncy50YXJnZXRUYWd9KTsKCmRlc3Ryb3kodGhpc0JvdCk7YDsKCmZvciAobGV0IG51Z3MgPSAwOyBudWdzIDwgdGhhdC5udWdnZXQubGVuZ3RoOyBudWdzKyspCnsKICAgIGxldCBjdXJyZW50TnVnZ2V0ID0gdGhhdC5udWdnZXRbbnVnc107CiAgICAvL2xldCBidXR0b25DaGVjayA9IGNyZWF0ZWRCdXR0b25zLmluZGV4T2YoY3VycmVudE51Z2dldC5udWdOYW1lKTsKCiAgICBpZiAoIWN1cnJlbnROdWdnZXQgfHwgY3VycmVudE51Z2dldCA9PSB1bmRlZmluZWQpIC8vfHwgYnV0dG9uQ2hlY2sgIT0gLTEKICAgIHsKICAgICAgICBjb250aW51ZTsKICAgIH0KCiAgICBpZiAoY3VycmVudE51Z2dldC5udWdQdWJsaXNoKQogICAgewogICAgICAgIG5ld051Z2dldEJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubnVnZ2V0TWFuYWdlci5wYWNrYWdlTnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgogICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7YDsKCiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAibG9hZCAiICsgY3VycmVudE51Z2dldC5udWdOYW1lICsgIiBudWdnZXQiOwogICAgfQoKICAgIG5ld051Z2dldEJ1dHRvbi50YXJnZXROdWdnZXQgPSBjdXJyZW50TnVnZ2V0Lm51Z05hbWU7CiAgICBuZXdOdWdnZXRCdXR0b25bdGhhdC5ib3QuaWQgKyAiLiIgKyB0aGF0LnRhZyArICJTdGFydCJdID0gY3VycmVudE51Z2dldC5udWdTdGFydDsKCiAgICBjcmVhdGUobmV3TnVnZ2V0QnV0dG9uKTsKCiAgICAvL2NyZWF0ZWRCdXR0b25zLnB1c2goY3VycmVudE51Z2dldC5udWdOYW1lKTsKfQoKcmV0dXJuOycApKfEowTAXgtudWdnZXRQYXJzZQIEAKSnxKMEs3inD0Bjb25zdCBvcmlnaW5hbFRhZ1ZhbHVlID0gdGhhdC5lZGl0ZWRCb3QucmF3W3RoYXQuZWRpdGVkVGFnXTsKbGV0IHRhZ1ZhbHVlID0gb3JpZ2luYWxUYWdWYWx1ZTsKCmlmICghdGFnVmFsdWUpIAp7CiAgICByZXR1cm47Cn0KZWxzZSBpZiAodHlwZW9mIHRhZ1ZhbHVlICE9PSAic3RyaW5nIikgCnsKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUudG9TdHJpbmcoKTsKfQoKbGV0IGluaXRpYWxQb3NzaWJsZU51Z1BvcyA9IDA7CgppZiAoaW5pdGlhbFBvc3NpYmxlTnVnUG9zID09IC0xKSAKewogICAgcmV0dXJuOwp9CmVsc2UKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbFBvc3NpYmxlTnVnUG9zKTsKfQoKbGV0IHBvc3NpYmxlTnVncyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW157XS9nLCAiIikubGVuZ3RoOwpsZXQgdG90YWxOdWdCcmVha3MgPSBvcmlnaW5hbFRhZ1ZhbHVlLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CmxldCBicmVha0xldmVsID0gMDsKbGV0IG51Z3NUb0NoZWNrID0gW107Cgpmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlTnVnczsgaSsrKQp7CiAgICBsZXQgaW5pdGlhbE51Z1BvcyA9IHRhZ1ZhbHVlLmluZGV4T2YoInsiKSArIDE7CiAgICBsZXQgcG9zc2libGVOdWdFbmQgPSB0YWdWYWx1ZS5pbmRleE9mKCJ9Iik7CiAgICBsZXQgcG9zc2libGVOdWcgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcywgcG9zc2libGVOdWdFbmQpOwoKICAgIGlmIChwb3NzaWJsZU51Zy5pbmRleE9mKCIgIikgPT0gLTEgJiYgL1xuL2cudGVzdChwb3NzaWJsZU51ZykgIT0gdHJ1ZSAmJiBwb3NzaWJsZU51Zy5sZW5ndGggPiAwICYmIHBvc3NpYmxlTnVnLmluZGV4T2YoIjoiKSA9PSAtMSkKICAgIHsKICAgICAgICBsZXQgbnVnQnJlYWtzID0gdGFnVmFsdWUuc3Vic3RyaW5nKDAsIHRhZ1ZhbHVlLmluZGV4T2YoInsiK3Bvc3NpYmxlTnVnKyJ9IikpLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CiAgICAgICAgbGV0IHB1Ymxpc2hDaGVjayA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zIC0gNiwgaW5pdGlhbE51Z1BvcyAtIDIpOwogICAgICAgIGxldCBudWdQdWJsaXNoID0gbnVsbDsKCiAgICAgICAgaWYgKHB1Ymxpc2hDaGVjayA9PSAiLm51ZyIpCiAgICAgICAgewogICAgICAgICAgICBudWdQdWJsaXNoID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJyZWFrTGV2ZWwgKz0gbnVnQnJlYWtzOwoKICAgICAgICBudWdCcmVha3MgPSB0b3RhbE51Z0JyZWFrcyAtICh0b3RhbE51Z0JyZWFrcyAtIGJyZWFrTGV2ZWwpOwogICAgICAgIAogICAgICAgIC8vQ0hFQ0sgSUYgJCBiZWZvcmUgbnVnZ2V0CiAgICAgICAgaWYgKHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zIC0gMiwgaW5pdGlhbE51Z1BvcyAtIDEpICE9ICIkIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z3NUb0NoZWNrLnB1c2goe251Z05hbWU6IHBvc3NpYmxlTnVnLCBudWdTdGFydDogbnVnQnJlYWtzICsgMSwgbnVnUHVibGlzaDogbnVnUHVibGlzaH0pOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBsZXQgbnVnQnJlYWtzID0gdGFnVmFsdWUuc3Vic3RyaW5nKDAsIHRhZ1ZhbHVlLmluZGV4T2YoIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICB9CgogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS5zdWJzdHJpbmcocG9zc2libGVOdWdFbmQgKyAxKTsKfQoKdGhpc0JvdC5udWdnZXRCdXR0b24oeyBudWdnZXQ6IG51Z3NUb0NoZWNrLCBib3Q6IHRoYXQuZWRpdGVkQm90LCB0YWc6IHRoYXQuZWRpdGVkVGFnLCB0YWdWYWx1ZTogb3JpZ2luYWxUYWdWYWx1ZX0pOycApKfEowTAXg1vbkFCUHVibGlzaGVkAgQApKfEowTbhwHBAUBjb25zb2xlLmxvZyh0aGF0LmFiLCB0YWdzLm51Z2dldFRvUHVibGlzaCkKCmlmICh0aGF0LmFiID09IHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IHB1Ymxpc2hlZCIpOwoKICAgIG1hc2tzLm51Z2dldFRvUHVibGlzaCA9IG51bGw7CgogICAgY29uZmlnQm90Lm1hc2tzLmFiVmVyc2lvbiA9IG51bGw7Cn0nAKSnxKMEwF4Qb25BbnlCb3RzQ2hhbmdlZAIEAKSnxKMEnYkBtwRAaWYgKGNvbmZpZ0JvdCAmJiB0aGF0WzBdLmJvdC5pZCAhPSB0aGlzQm90LmlkKSAKewogICAgaWYgKCFjb25maWdCb3QudGFncy5lZGl0aW5nQm90KSByZXR1cm47IC8vIElnbm9yZSBpZiB0aGUgY29uZmlnQm90IGlzbid0IHJlYWR5IHlldC4KCiAgICBjb25zdCBlZGl0ZWRCb3RJRCA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QucmVwbGFjZSgi8J+UlyIsICIiKTsKCiAgICBpZiAoIXRoYXQuZmluZCh4ID0+IHguYm90LmlkID09IGVkaXRlZEJvdElEKSkgcmV0dXJuOyAvLyBJZiB0aGUgYm90IGNoYW5nZWQgd2Fzbid0IGJlaW5nIGVkaXRlZCBieSB0aGUgdXNlciBpZ25vcmUgaXQuCgogICAgY29uc3QgZWRpdGVkVGFnID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ1RhZzsKICAgIGNvbnN0IGVkaXRlZEJvdCA9IGdldEJvdCgiaWQiLCBlZGl0ZWRCb3RJRCk7CgogICAgaWYgKGVkaXRlZEJvdCAmJiBlZGl0ZWRUYWcpIAogICAgewogICAgICAgIHNob3V0KCJudWdnZXRSZXNldCIpOwoKICAgICAgICB0aGlzQm90Lm51Z2dldFBhcnNlKHsgZWRpdGVkQm90LCBlZGl0ZWRUYWcgfSk7CiAgICB9Cn0nAKSnxKMEwF4Ib25DcmVhdGUCBACkp8SjBNONAUxAdGFncy5saXN0ZW5pbmcgPSBmYWxzZTsKCi8vc2V0VGFnTWFzayh0aGlzQm90LCAibGlzdGVuaW5nIiwgdHJ1ZSwgImxvY2FsIik7JwCkp8SjBMBeDXBhY2thZ2VOdWdnZXQCBACkp8SjBKCOAfgGQGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CmNvbnN0IHRhZ1RleHQgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXTsKCmlmIChjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4IHx8IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4KQp7CiAgICBsZXQgc3RhcnRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4OwogICAgbGV0IGVuZFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4OwoKICAgIGlmIChzdGFydFBvcyA9PSBlbmRQb3MpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoc3RhcnRQb3MgPiBlbmRQb3MpCiAgICB7CiAgICAgICAgbGV0IG5ld1N0YXJ0UG9zID0gZW5kUG9zOwogICAgICAgIGxldCBuZXdFbmRQb3MgPSBzdGFydFBvczsKCiAgICAgICAgc3RhcnRQb3MgPSBuZXdTdGFydFBvczsKICAgICAgICBlbmRQb3MgPSBuZXdFbmRQb3M7CiAgICB9CgogICAgbGV0IGRhdGEgPSB0YWdUZXh0LnN1YnN0cmluZyhzdGFydFBvcywgZW5kUG9zICsgMSk7CgogICAgc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6IHRoYXQubnVnZ2V0LCBkYXRhOiBkYXRhfSk7CgogICAgb3MudG9hc3QoIm51ZyBpcyBwdWJsaXNoaW5nIiwgMTApOwoKICAgIGxldCB0YXJnZXROdWcgPSAiLm51ZyB7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImNhbm5vdCByZWFkIG51Z2dldCB0byBiZSBwdWJsaXNoZWQiKQp9JwCkp8SjBMBeCHJlbWVtYmVyAgQApKfEowSZlQEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycApKfEowTAXgZzZWFyY2gCBACkp8SjBMCVASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCkp8SjBMBeBXN0b3JlAgQApKfEowTnlQEo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicApKfEowTAXglsaXN0ZW5pbmcCBACkp8SjBI6WAQVmYWxzZScApKfEowTAXglhYlZlcnNpb24CBACkp8SjBJSWAQUxMC4xMycBBGJvdHMkYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiAScApKfEowSalgEZYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcgIEAKSnxKMEm5YBzgxAY29uc3QgewogICAgbGFiZWwgPSBgJHthYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9IGlzIHdvcmtpbmdgLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fQoKbGV0IGJ1c3lJbmRpY2F0b3IgPSB7CiAgICBvblBvaW50ZXJVcDogbnVsbCwKICAgIG9uUG9pbnRlckRvd246IG51bGwsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgYnVzeUxhYmVsOiBsYWJlbCwKICAgIGxhYmVsQWxpZ25tZW50OiAnbGVmdCcsCiAgICBzdGF0ZTogMCwKICAgIGFuaW1TdGF0ZXM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgXSwKICAgIGFuaW1SYXRlOiA1MDAsCiAgICBvbkJvdEFkZGVkOiBgQAogICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICBvbkJvdENoYW5nZWQ6IGBACiAgICAgICAgY29uc3QgbmVlZFJlZnJlc2ggPSB0aGF0LnRhZ3Muc29tZSh0ID0+IHQgPT09ICdidXN5TGFiZWwnIHx8IHQgPT09ICdzdGF0ZScgfHwgdCA9PT0gJ2FuaW1TdGF0ZXMnKTsKICAgICAgICBpZiAobmVlZFJlZnJlc2gpIHsKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0KICAgIGAsCiAgICByZWZyZXNoRGlzcGxheTogYEAKICAgICAgICBpZiAodGFncy5hbmltU3RhdGVzICYmIHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IGFuaW1TdGF0ZSA9IHRhZ3MuYW5pbVN0YXRlc1t0YWdzLnN0YXRlXTsKCiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSB0YWdzLmJ1c3lMYWJlbC50cmltKCkgKyBhbmltU3RhdGUuZWxsaXBzaXM7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBhbmltU3RhdGUuZm9ybUFkZHJlc3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5sYWJlbCAKICAgICAgICB9CiAgICBgLAogICAgYW5pbWF0ZTogYEAKICAgICAgICBpZiAodGFncy5zdGF0ZSA+PSB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICB0YWdzLnN0YXRlID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLnN0YXRlICs9IDE7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBvcy5zbGVlcCh0YWdzLmFuaW1SYXRlKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICAuLi5yZXN0Cn07Cgpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYnVzeUluZGljYXRvcik7CgpyZXR1cm4gbWVudUJvdDsnAKSnxKMEmpYBBnN5c3RlbQIEAKSnxKME6qIBEWFiLmludGVyZmFjZS5tZW51JwCkp8SjBJqWAQRmb3JtAgQApKfEowT8ogEHbm90aGluZycApKfEowSalgELZGVzY3JpcHRpb24CBACkp8SjBISjASZUaGlzIHNraWxsIGlzIGRlc2lnbmVkIGZvciBtZW51IHN0dWZmLigApKfEowSalgELYWJJbnRlcmZhY2UBeCcApKfEowSalgEKYWJPcGVuTWVudQIEAKSnxKMErKMB/RpAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgbWVudVR5cGUgPSB0aGF0ID8gImFiIiArIHRoYXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGF0LnNsaWNlKDEpICsgIk1lbnUiOiAiYWJDb3JlTWVudSI7IC8vc2V0IHVwIGEgY2hlY2sgdG8gc2VlIHdoYXQgdHlwZSBvZiBtZW51IHNob3VsZCBiZSBvY2N1cmluZyBbY29yZSwgYm90LCBncmlkLCBpbnN0XQpsZXQgbWVudVNraWxscyA9IGdldEJvdHMobWVudVR5cGUgKyAiQWN0aW9uIik7CmxldCBtYXhPcHRpb25zID0gbWVudVR5cGUgPT0gImluc3QiID8gNyA6IDU7CmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5OwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MuYmFzZVNraWxsLiR7bWVudVR5cGUgKyAiQWN0aW9uIn0oe2JvdDogdGhpc0JvdH0pO2A7CgpsZXQgc29ydE9yZGVySW5kZXggPSBtZW51U2tpbGxzLmxlbmd0aDsKZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51U2tpbGxzLmxlbmd0aDsgaSsrKS8vQUREIExPR0lDIEZPUiBNT1JFIE9QVElPTlMgVEhBTiA1IDogbWF4T3B0aW9ucwp7CiAgICAvL0FsbG93cyBmb3IgY29kZSB0byBnZXQgY2FsbGVkIGJlZm9yZSB0aGUgbWVudSBnZW5lcmF0ZXMsIHVzZWZ1bCBmb3IgZHluYW1pY2FsbHkgc2V0IGdyb3VwcyBvciBkcm9wZG93bnMKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiXSkgewogICAgICAgIGF3YWl0IHdoaXNwZXIobWVudVNraWxsc1tpXSwgbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiKTsKICAgIH0gCgogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJIaWRlIl0pIHsKICAgICAgICBjb250aW51ZTsKICAgIH0KICAgIAogICAgbGV0IGN1cnJlbnRTa2lsbCA9IG1lbnVTa2lsbHNbaV07CgogICAgYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGN1cnJlbnRTa2lsbC5pZDsKICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkxhYmVsIl07CiAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJY29uIl07CiAgICBhYk1lbnVCdXR0b24ub25DcmVhdGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJPbkdlbmVyYXRlIl07CiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiU29ydE9yZGVyIl07CiAgICBhYk1lbnVCdXR0b24uY29sb3IgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdID8gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwoKICAgIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJkcm9wZG93biIpIHsKICAgICAgICBhYk1lbnVCdXR0b24uZHJvcGRvd25PcHRpb25zID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25PcHRpb25zOwoKICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImdyb3VwIikgewogICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhYk1lbnVCdXR0b24ubWVudUl0ZW1zID0gY3VycmVudFNraWxsLnRhZ3MubWVudUl0ZW1zOwogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiaW5wdXQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ0ZXh0IikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ0b29sIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ3aXphcmQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsKICAgIH0KfQoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCT3Blbk1lbnUnLCB7IG1lbnU6IHRoYXQsIG1lbnVUeXBlLCBtZW51UG9ydGFsOiBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCB9KTsnAKSnxKMEmpYBEmFiQ3JlYXRlTWVudUJ1dHRvbgIEAKSnxKMEqL4B+A1AbGV0IG5ld01lbnVCdXR0b24gPSB7fTsKCmxldCB7CiAgICBtZW51SXRlbVN0eWxlID0ge30sCiAgICAuLi5hZGRpdGlvbmFsVGFncwp9ID0gdGhhdCA/PyB7fQoKaWYgKHR5cGVvZiBtZW51SXRlbVN0eWxlID09ICdzdHJpbmcnKSB7CiAgICBtZW51SXRlbVN0eWxlID0gbWVudUl0ZW1TdHlsZS5yZXBsYWNlKC9cdXsxRjlFQ30vdSwgJycpOyAKICAgIG1lbnVJdGVtU3R5bGUgPSBKU09OLnBhcnNlKG1lbnVJdGVtU3R5bGUpOwp9CgpmdW5jdGlvbiBoYXNCb3JkZXJTdHlsZSgpIHsKICAgIGlmIChtZW51SXRlbVN0eWxlWyJib3JkZXItdG9wLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLWxlZnQtc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItYm90dG9tLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLXJpZ2h0LXN0eWxlIl0pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KCmlmIChhZGRpdGlvbmFsVGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSkgewogICAgaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiTWVudUdyb3VwIl0pIHsKCiAgICB9Cn0KCm5ld01lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwpuZXdNZW51QnV0dG9uLmxhYmVsQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwpuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yID0gdGhhdC5zaGFkb3dDb2xvciA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVNoYWRvd0NvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5zY2FsZVkgPSAxOwoKY29uc3QgbWVudVN0eWxpbmcgPSB7CiAgICAiYm9yZGVyLXJhZGl1cyI6IjhweCIsCiAgICAibWFyZ2luLXRvcCI6ICI4cHgiLAogICAgImJveC1zaGFkb3ciOiBgM3B4IDRweCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJtaW4taGVpZ2h0IjogIjQ0cHgiLAogICAgImJvcmRlciI6IGhhc0JvcmRlclN0eWxlKCkgPyAiIiA6IGAycHggc29saWQgJHtuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yfWAsCiAgICAid2lkdGgiOiAiY2FsYygxMDAlIC0gNXB4KSIsCiAgICAuLi5tZW51SXRlbVN0eWxlCn0KCm5ld01lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IG1lbnVTdHlsaW5nOwoKY29uc3QgY2xpY2tlZFN0eWxpbmcgPSB7CiAgICAuLi5tZW51U3R5bGluZywKICAgICJmaWx0ZXIiOiAiYnJpZ2h0bmVzcyg2MCUpIgp9CmNvbnN0IGJhc2VTdHlsZSA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSAn8J+nrCAke0pTT04uc3RyaW5naWZ5KGNsaWNrZWRTdHlsaW5nKX0nYAoKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJEb3duID0gbWVudUl0ZW1TdHlsZT8uWyJtYXJnaW4tdG9wIl0gIT0gIjBweCIgPyBiYXNlU3R5bGUgOiAiQCAvLyI7Cm5ld01lbnVCdXR0b24ub25Qb2ludGVyVXAgPSBgQCBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbGA7Cgpmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykKewogICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsKfQoKbmV3TWVudUJ1dHRvbiA9IGNyZWF0ZShuZXdNZW51QnV0dG9uKTsKCnJldHVybiBuZXdNZW51QnV0dG9uOycApKfEowSalgENYWJNZW51UmVmcmVzaAIEAKSnxKMEn8wBnQFAaWYgKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw/LnN1YnN0cmluZygwLDIpID09ICJhYiIpCnsKICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKCiAgICBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7CiAgICBtYXNrcy5vbktleURvd24gPSBudWxsOwp9JwCkp8SjBJqWAQhyZW1lbWJlcgIEAKSnxKMEvc0BKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAKSnxKMEmpYBDW1hbmlmZXN0YXRpb24CBACkp8SjBOTNASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCkp8SjBJqWARFhYkVudmlyb25tZW50TWVudQIEAKSnxKMEi84BujdAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5OwphYk1lbnVCdXR0b24ubGVhcm4gPSB0YWdzLmxlYXJuOwoKY29uc3QgYWJFbnZpcm9ubWVudE9wdGlvbnMgPSB0aGlzQm90LmFiR2V0RW52aXJvbm1lbnRPcHRpb25zKCk7CgpidXR0b25Mb29wOgpmb3IgKGxldCBpID0gMDsgaSA8IGFiRW52aXJvbm1lbnRPcHRpb25zLmxlbmd0aDsgaSsrKQp7CiAgICBsZXQgYWN0aXZlQnV0dG9uID0gYWJFbnZpcm9ubWVudE9wdGlvbnNbaV07CgogICAgYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGFjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjsKCiAgICBpZiAoYWN0aXZlQnV0dG9uLmFiRW52aXJvbm1lbnRHYXRlKQogICAgewogICAgICAgIGlmICghbGlua3NbYWN0aXZlQnV0dG9uLmFiRW52aXJvbm1lbnRHYXRlXSkKICAgICAgICB7CiAgICAgICAgICAgIGNvbnRpbnVlIGJ1dHRvbkxvb3A7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBuZXdCdXR0b25EYXRhID0gey4uLmFiTWVudUJ1dHRvbiwgLi4uYWN0aXZlQnV0dG9ufTsKCiAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdCdXR0b25EYXRhKTsKfQoKY29uc3QgYWJQZXJzb25hbGl0eUNvbmZpZ0J1dHRvbiA9IHsKICAgIGxhYmVsOiAiY3VzdG9taXplOiBhYiBwZXJzb25hbGl0eSIsCiAgICAuLi5hYk1lbnVCdXR0b24sCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEsCiAgICBkcm9wZG93blNvcnRPcmRlcjogMSwKICAgIGRyb3Bkb3duT3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBuYW1lOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwge3RpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB0byBjYWxsIG1lPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHtuYW1lOiBuYW1lfSk7IAogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBhaSBtb2RlbDogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbH1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBhaU1vZGVscyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWlNb2RlbHM7CgogICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IFtdOwoKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29tcGFueUdyb3VwIG9mIGFpTW9kZWxzKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBtb2RlbEVudHJ5IG9mIGNvbXBhbnlHcm91cC5tb2RlbHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKHsgbGFiZWw6IG1vZGVsRW50cnkubW9kZWwsIHZhbHVlOiBtb2RlbEVudHJ5Lm1vZGVsIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TW9kZWxJbmRleCA9IG9wdGlvbnMuZmluZEluZGV4KG8gPT4gby52YWx1ZSA9PT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpOwoKICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkT3B0aW9uID0gYXdhaXQgb3Muc2hvd0lucHV0KGN1cnJlbnRNb2RlbEluZGV4LCB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICd3aGF0IGFpIG1vZGVsIHdvdWxkIHlvdSBsaWtlIG1lIHRvIHVzZT8nLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaXN0JywKICAgICAgICAgICAgICAgICAgICBpdGVtczogb3B0aW9ucywKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE9wdGlvbiAmJiBzZWxlY3RlZE9wdGlvbi52YWx1ZSAhPT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7YWlNb2RlbDogc2VsZWN0ZWRPcHRpb24udmFsdWV9KTsgCiAgICAgICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbWUgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge2NvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51cyB0byBiZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bWVudUNvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICAgICAgICAgIC8vbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvciA9IGNvbG9yOyBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciAhPSAnY2xlYXInKXtsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yID0gY29sb3J9OyBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSB0ZXh0IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudSB0ZXh0IHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51TGFiZWxDb2xvcjogY29sb3J9KTsgCiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICAgICAgICAgICAgICAvL2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IgPSBjb2xvcjsgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgIT0gJ2NsZWFyJyl7bGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciA9IGNvbG9yfTsgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGRlZmF1bHQgcG9ydGFsIGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4J31gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBsZXQgcG9ydGFsQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IHdvdWxkIHlvdSBsaWtlIHlvdXIgcG9ydGFsIHRvIGxvb2sgbGlrZT8nfSk7CiAgICAgICAgICAgICAgICBpZiAoIXBvcnRhbENvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgcG9ydGFsQ29sb3IgPSAnIzI2MzIzOCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7J3BvcnRhbENvbG9yJzogcG9ydGFsQ29sb3J9KTsgCiAgICAgICAgICAgICAgICAvL2Rlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGRlZmF1bHQgbWFwIHBvcnRhbCBiYXNlbWFwYCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgc2hvdXQoInNob3dBQkJhc2VtYXBPcHRpb25zIik7CiAgICAgICAgICAgIGAKICAgICAgICB9LAogICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiAiZGVmYXVsdCBzZXR0aW5ncyIsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgICAgICAgICBjb2xvcjogJ3JlZCcsCiAgICAgICAgICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7J2RlZmF1bHRQZXJzb25hbGl0eSc6IHRydWV9KTsgCiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJtZW51IGNvbG9yIiwKICAgICAgICAvLyAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAvLyAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgIC8vICAgICAgICAgY29uc3QgbWVudUNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGFiUGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHt0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudSdzIHRvIGJlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51Q29sb3I6IG1lbnVDb2xvcn0pOyAKICAgICAgICAvLyAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7YCwKICAgICAgICAvLyB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJwcm9tcHQiLAogICAgICAgIC8vICAgICBvbkNsaWNrOiBgQGAsCiAgICAgICAgLy8gfSwKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAgIGxhYmVsOiAiZm9ybSIsCiAgICAgICAgLy8gICAgIG9uQ2xpY2s6IGBAIAogICAgICAgIC8vICAgICAgICAgY29uc3QgZm9ybSA9IGF3YWl0IG9zLnNob3dJbnB1dChhYlBlcnNvbmFsaXR5LnRhZ3MuYWJGb3JtLCB7dGl0bGU6ICd3aGF0IGZvcm0gd291bGQgeW91IGxpa2UgbWUgdG8gdGFrZT8nfSk7CiAgICAgICAgLy8gICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7Zm9ybTogZm9ybX0pOyAKICAgICAgICAvLyAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7YCwKICAgICAgICAvLyB9CiAgICBdCn0KCnRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJQZXJzb25hbGl0eUNvbmZpZ0J1dHRvbik7Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJFbnZpcm9ubWVudE1lbnUnLCB7IG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWx9ICknAKSnxKMEmpYBBWxlYXJuAgQApKfEowTGhQIo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycApKfEowSalgEDZ3B0AgQApKfEowTthQIo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycApKfEowSalgEIYWJJZ25vcmUCBACkp8SjBJSGAgR0cnVlJwCkp8SjBJqWAQZzZWFyY2gCBACkp8SjBJmGAijwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCkp8SjBJqWAQZudWdnZXQCBACkp8SjBMCGAijwn5SXNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmJwCkp8SjBJqWAQV0ZXN0cwIEAKSnxKME54YCKPCflJdiODNkOTcyYi0wNTM1LTQwNTEtYjU4OS00MWNlZGE4NTM1ZjEnAKSnxKMEmpYBD29uUG9ydGFsQ2hhbmdlZAIEAKSnxKMEjocCbkBpZiAodGhhdC5wb3J0YWwgPT0gInN5c3RlbVBvcnRhbCIgJiYgIXRoYXQuZGltZW5zaW9uICYmICFsaW5rcy50ZXN0cykKewogICAgbGlua3MubGVhcm4uYWJBZGFwdCgiYWJUZXN0cyIpOwp9JwCkp8SjBJqWAQNhc2sCBACkp8SjBP2HAijwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCkp8SjBJqWAQlhYlZlcnNpb24CBACkp8SjBKSIAgUxMC4xMycApKfEowSalgERYWJDcmVhdGVNZW51SW5wdXQCBACkp8SjBKqIAp4CQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVJbnB1dCA9IHsNCiAgICBmb3JtOiAiaW5wdXQiLA0KICAgIG1lbnVJdGVtU2hvd1N1Ym1pdFdoZW5FbXB0eTogZmFsc2UsDQogICAgZm9ybUlucHV0TXVsdGlsaW5lOiBudWxsLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVJbnB1dCk7DQoNCnJldHVybiBtZW51Qm90OycApKfEowSalgEQYWJDcmVhdGVNZW51VGV4dAIEAKSnxKMEyYoCgQRAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpjb25zdCB7DQogICAgbWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIC4uLnJlc3QNCn0gPSB0aGF0Ow0KDQpsZXQgbWVudVRleHQgPSB7DQogICAgZm9ybTogInRleHQiLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgcG9pbnRhYmxlOiBmYWxzZSwNCiAgICBjb2xvcjogIndoaXRlIiwNCiAgICBtZW51SXRlbVN0eWxlOiB7DQogICAgICAgICJwYWRkaW5nLXRvcCI6ICI2cHgiLA0KICAgICAgICAicGFkZGluZy1ib3R0b20iOiAiNnB4IiwNCiAgICB9LA0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZTogew0KICAgICAgICAid2hpdGUtc3BhY2UiOiAicHJlLXdyYXAiLA0KICAgICAgICAuLi5tZW51SXRlbUxhYmVsU3R5bGUsDQogICAgfSwNCiAgICAuLi5yZXN0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRleHQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAKSnxKMEmpYBEGFiQ3JlYXRlTWVudVRvb2wCBACkp8SjBMuOAo4BQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVUb29sID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51VG9vbCk7DQoNCnJldHVybiBtZW51Qm90OycApKfEowSalgESYWJDcmVhdGVNZW51V2l6YXJkAgQApKfEowTajwKSAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51V2l6YXJkID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51V2l6YXJkKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCkp8SjBJqWARRhYkNyZWF0ZU1lbnVEcm9wZG93bgIEAKSnxKME7ZACuhxAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAoIXRoYXQuZHJvcGRvd25Tb3J0T3JkZXIpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudURyb3Bkb3duOiBkcm9wZG93blNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCBvdXRlck1lbnVCdXR0b24gPSB7DQogICAgLi4udGhhdCwNCiAgICBmb3JtQWRkcmVzczogdGhhdC5mb3JtQWRkcmVzcyA/PyAiYXJyb3dfcmlnaHQiLA0KICAgIGRyb3Bkb3duT3BlbjogZmFsc2UsDQogICAgb25DbGljazogYEANCiAgICAgICAgdGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gJHt0aGF0LmRyb3Bkb3duU29ydE9yZGVyfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gZmFsc2U7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyh0YWdzLmRyb3Bkb3duT3B0aW9ucywgdGFncy5kcm9wZG93blNvcnRPcmRlcik7DQogICAgICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkRlc3Ryb3k6IGBADQogICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgYCwNCiAgICBvblBvaW50ZXJVcDogYEANCiAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgbWFza3MuZm9ybUFkZHJlc3MgPSAiYXJyb3dfcmlnaHQiOw0KICAgICAgICB9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSBmYWxzZSkgew0KICAgICAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAiZm9ybUFkZHJlc3MiLCAiYXJyb3dfZHJvcF9kb3duIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJtZW51SXRlbVN0eWxlIiwgey4uLnRhZ3MubWVudUl0ZW1TdHlsZSwgImJvcmRlckJvdHRvbUxlZnRSYWRpdXMiOiAiMCIsICJib3JkZXJCb3R0b21SaWdodFJhZGl1cyI6ICIwIn0pOw0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkJvdENoYW5nZWQ6IGBADQogICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ2Ryb3Bkb3duT3BlbicpICYmIHRhZ3MuZHJvcGRvd25PcGVuID09IHRydWUpIHsNCiAgICAgICAgICAgIHNob3V0KCJhYk1lbnVEcm9wZG93bk9wZW5lZCIsIHRoaXNCb3QpOw0KICAgICAgICB9DQogICAgYCwNCiAgICBhYk1lbnVEcm9wZG93bk9wZW5lZDogYEANCiAgICAgICAgaWYgKHRoYXQgIT0gdGhpc0JvdCkgew0KICAgICAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gZmFsc2U7DQogICAgICAgICAgICBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIGANCn07DQoNCmlmICh0aGF0LmZvcm1BZGRyZXNzICYmIHRoYXQuZm9ybUFkZHJlc3MgIT0gImFycm93X3JpZ2h0Iikgew0KICAgIG91dGVyTWVudUJ1dHRvbi5jdXN0b21Gb3JtQWRkcmVzcyA9IHRydWU7DQp9DQpvdXRlck1lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IHRoYXQuZHJvcGRvd25Tb3J0T3JkZXI7DQoNCmNvbnN0IG1lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihvdXRlck1lbnVCdXR0b24pOw0KbWVudUJvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMgPSBnZW5lcmF0ZU1lbnVPcHRpb25zOw0KDQphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZU1lbnVPcHRpb25zIChvcHRpb25zLCBzb3J0T3JkZXIpIHsNCiAgICBjb25zdCBtZW51Qm90cyA9IFtdOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7ICsraSkgew0KDQogICAgICAgIGxldCBuZXdNZW51QnV0dG9uID0gew0KICAgICAgICAgICAgLi4ub3B0aW9uc1tpXSwNCiAgICAgICAgICAgIGNsZWFyRHJvcGRvd25NZW51OiBgQA0KICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMDApOw0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoaSA9PSBvcHRpb25zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAgMCA4cHggOHB4IjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIDAgOHB4IDhweCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJUb3AiXSA9ICJub25lIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJtYXJnaW5Ub3AiXSA9ICIwIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJwYWRkaW5nTGVmdCJdID0gIjM1cHgiOw0KDQogICAgICAgIGNvbnN0IG5ld01lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCiAgICB9DQoNCiAgICBtZW51Qm90LnRhZ3MubWVudUJvdHMgPSBnZXRMaW5rKG1lbnVCb3RzKTsNCn0NCg0KaWYgKHRoYXQuZGVmYXVsdE9wZW4pIHsNCiAgICBtZW51Qm90Lm9uUG9pbnRlclVwKCk7DQogICAgbWVudUJvdC5vbkNsaWNrKCk7DQp9DQoNCnJldHVybiBtZW51Qm90Ow0KDQonAKSnxKMEmpYBEWFiQ3JlYXRlTWVudUdyb3VwAgQApKfEowSorQLcHUAvKg0KICAgRVhBTVBMRQ0KICAgY29uc3QgbWVudUdyb3VwID0gew0KICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBncm91cFNvcnRPcmRlcjogMSwNCiAgICAgICAgbWVudUl0ZW1zOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICBjb2xvcjogIm9yYW5nZSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgbWVudUl0ZW1UeXBlOiAiZHJvcGRvd24iLA0KICAgICAgICAgICAgICAgIGRyb3Bkb3duT3B0aW9uczogWw0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfQ0KKi8NCg0KaWYgICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0Lmdyb3VwU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVHcm91cDogZ3JvdXBTb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgew0KICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwNCiAgICBtZW51SXRlbXMgPSBbXSwNCiAgICAuLi5hZGRpdGlvbmFsVGFncw0KfSA9IHRoYXQgPz8ge30NCg0KY29uc3QgbWVudUJvdHMgPSBbXTsNCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudUl0ZW1zLmxlbmd0aDsgKytpKSB7DQoNCiAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9Ow0KDQogICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDApOw0KDQogICAgbGV0IGluZGl2TWVudUl0ZW1TdHlsZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVN0eWxlID8/IHt9Ow0KICAgIGxldCBpbmRpdk1lbnVUeXBlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtVHlwZSA/PyB1bmRlZmluZWQ7DQogICAgbGV0IGluZGl2QWRkaXRpb25hbFRhZ3MgPSBtZW51SXRlbXNbaV07DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdOw0KICAgIH0NCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdOw0KICAgIH0NCg0KICAgIGNvbnN0IGJhc2VTdHlsaW5nID0gew0KICAgICAgICAiYm9yZGVyVG9wIjogIm5vbmUiLA0KICAgICAgICAibWFyZ2luVG9wIjogIjAiDQogICAgfQ0KDQogICAgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCAwIDhweCA4cHgiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfSBlbHNlIGlmIChpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjhweCA4cHggMCAwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nO30NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gaW5kaXZBZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGluZGl2QWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBsZXQgbmV3TWVudUJvdDsNCiAgICBzd2l0Y2goaW5kaXZNZW51VHlwZSkgew0KICAgICAgICBjYXNlICJkcm9wZG93biI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bigNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC4uLm5ld01lbnVCdXR0b24sDQogICAgICAgICAgICAgICAgICAgICJkcm9wZG93blNvcnRPcmRlciI6IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTApDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiaW5wdXQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidGV4dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRvb2wiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ3aXphcmQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICB9DQogICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCn0NCg0KcmV0dXJuIG1lbnVCb3RzOycApKfEowSalgELcGVyc29uYWxpdHkCBACkp8SjBIXLAijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwCkp8SjBJqWARdhYkdldEVudmlyb25tZW50T3B0aW9ucwIEAKSnxKMErMsCwClAY29uc3Qgb3B0aW9ucyA9IFtdOwoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogYGhpZGVgLAogICAgICAgIGZvcm1BZGRyZXNzOiAidmlzaWJpbGl0eV9vZmYiLAogICAgICAgIG9uQ2xpY2s6ICJAIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAib3B0aW1pemUgbW9kZSIsCiAgICBvbkNyZWF0ZTogIkAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgb25DbGljazogIkAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA9IGZhbHNlIDogY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSB0cnVlOyB0aGlzQm90Lm9uQ3JlYXRlKCk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxCn0pCgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAic2xlZXAiLAogICAgICAgIGZvcm1BZGRyZXNzOiAibmlnaHRzX3N0YXkiLAogICAgICAgIG9uQ2xpY2s6ICJAbGlua3MubWFuaWZlc3RhdGlvbi5hYlNldEF3YWtlKHsgYXdha2U6IGZhbHNlIH0pIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMwogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiY2hhdCIsCiAgICBmb3JtQWRkcmVzczogImNoYXQiLAogICAgb25DbGljazogIkAgc2hvdXQoJ2FiQ2hhdEJhck9wZW4nKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDQKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogIm51Z2dldHMiLAogICAgb25DcmVhdGU6ICJAIHRhZ3MubnVnTWFuYWdlciA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuaW50ZXJmYWNlLm51Z2dldCcpKTsgaWYgKGxpbmtzLm51Z01hbmFnZXIudGFncy5saXN0ZW5pbmcpe3RhZ3Mub25DbGljayA9IGBAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCBudWxsKTtgO3RhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94YDt9ZWxzZXsgICAgdGFncy5vbkNsaWNrID0gYEAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIHRydWUsICdsb2NhbCcpO2A7ICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94X291dGxpbmVfYmxhbmtgO30iLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDUKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBhYkVudmlyb25tZW50R2F0ZTogImdwdCIsCiAgICBvbkNyZWF0ZTogIkAgIGlmICghYXV0aEJvdCl7ZGVzdHJveSh0aGlzQm90KTt9ZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gJ0ZyZWVQbGF5JyB8fCBhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSB1bmRlZmluZWQpe2Rlc3Ryb3kodGhpc0JvdCk7fTsgdGFncy5sYWJlbCA9ICdlZGl0ICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBwcm9tcHQnOyB0YWdzLmdwdEJvdCA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuYWN0aW9uLmFzaycpKTsiLAogICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgb25DbGljazogIkAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDcKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImdyaWQgc25hcCIsCiAgICBvbkNyZWF0ZTogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnIiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlO3RhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDgKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImJvdCBzbmFwIiwKICAgIG9uQ3JlYXRlOiAiQCB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgb25DbGljazogIkAgbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlOyB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDkKfSkKCmlmIChhdXRoQm90KSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAiYWNjb3VudCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJiYWRnZSIsCiAgICAgICAgb25DbGljazogIkAgb3Muc2hvd0FjY291bnRJbmZvKCk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAKICAgIH0pCn0KCmlmIChsaW5rcy50ZXN0cykgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBhYkVudmlyb25tZW50R2F0ZTogInRlc3RzIiwKICAgICAgICBsYWJlbDogInJlY29yZCB0ZXN0IiwKICAgICAgICBmb3JtQWRkcmVzczogInNjaWVuY2UiLAogICAgICAgIG9uS2V5RG93bjogIkAgIiwKICAgICAgICBvbktleVVwOiAiQCAiLAogICAgICAgIG9uQ2xpY2s6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRlc3QnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDExCiAgICB9KQoKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJ0ZXN0cyIsCiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdHJhY2UiLAogICAgICAgIGZvcm1BZGRyZXNzOiAidGltZWxpbmUiLAogICAgICAgIG9uS2V5RG93bjogIkAgIiwKICAgICAgICBvbktleVVwOiAiQCAiLAogICAgICAgIG9uQ2xpY2s6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRyYWNlJyk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMgogICAgfSkKfQoKaWYgKGdldEJvdCgic3lzdGVtIiwgImFiLmhvbWUuZWdnIikpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJ0ZXN0cyIsCiAgICAgICAgbGFiZWw6ICJzYXZlIGhvbWUgZWdnIiwKICAgICAgICBmb3JtQWRkcmVzczogImVnZyIsCiAgICAgICAgb25LZXlEb3duOiAiQCAiLAogICAgICAgIG9uS2V5VXA6ICJAICIsCiAgICAgICAgb25DbGljazogYEBnZXRCb3QoInN5c3RlbSIsICJhYi5ob21lLmVnZyIpLnNhdmVEYXRhKCk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTtgLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMwogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAidXBkYXRlICIgKyBhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgIGxlYXJuOiB0YWdzLmxlYXJuLAogICAgb25LZXlEb3duOiAiQCAiLAogICAgb25LZXlVcDogIkAgIiwKICAgIG9uQ2xpY2s6IGBAbGlua3MubGVhcm4udXBkYXRlQUIoKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTtgLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDE0Cn0pCgpvcHRpb25zLnB1c2goewogICAgb25DcmVhdGU6IGBACiAgICAgICAgdGFncy5sYWJlbCA9ICJwZXJtYW5lbnRseSBkZWxldGUgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7CiAgICAgICAgdGFncy5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29udHJhc3RDb2xvciA/PyAiI0Q5MzAzMCI7CiAgICBgLAogICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICBvbkNsaWNrOiBgQAogICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IG9zLnNob3dDb25maXJtKHsKICAgICAgICAgICAgdGl0bGU6ICdQZXJtYW5lbnRseSBkZWxldGUgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgIGNvbnRlbnQ6ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlICcgKyAgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgZnJvbSAnICsgbGlua3MubGVhcm4udGFncy5hYkluc3QgKyAnPyBUaGlzIGlzIG5vdCByZXZlcnNpYmxlIScsCiAgICAgICAgfSkKCiAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKCiAgICAgICAgY29uc3QgYWJCb3RzID0gZ2V0Qm90cygoYikgPT4gewogICAgICAgICAgICByZXR1cm4gYi5zcGFjZSA9PT0gJ3NoYXJlZCcgJiYKICAgICAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtICYmCiAgICAgICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbS5zdGFydHNXaXRoKCdhYicpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgIGRlc3Ryb3koYWJCb3RzKTsKICAgICAgICB9CiAgICBgLAogICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMDAKfSkKCnJldHVybiBvcHRpb25zOycApKfEowSalgEeYWJDcmVhdGVUb29sYm94RHJvcGRvd25PcHRpb25zAgQApKfEowTt9ALjE0Bjb25zdCB0b29sYm94VG9vbHMgPSBbLi4udGhhdC50b29sQXJyYXldID8/IFtdOw0KY29uc3QgdG9vbGJveE5hbWUgPSB0aGF0LnRvb2xib3hOYW1lID8/ICJLaXQgIjsNCmNvbnN0IHRvb2xib3ggPSB0aGF0LnRvb2xib3g7DQpjb25zdCBncmlkSW5mb3JtYXRpb24gPSAodGhhdD8uZ3JpZEluZm9ybWF0aW9uICYmIHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiAhPSB1bmRlZmluZWQpID8gdGhhdD8uZ3JpZEluZm9ybWF0aW9uIDogYWJSZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOw0KDQpjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnRvb2xib3ggPSBnZXRMaW5rKHRvb2xib3gpOw0KbWVudU9wdGlvbnMuZ3JpZEluZm9ybWF0aW9uID0gZ3JpZEluZm9ybWF0aW9uOw0KbWVudU9wdGlvbnMuc2VhcmNoID0gdGFncy5zZWFyY2g7DQptZW51T3B0aW9ucy5hcnRpZmFjdCA9IHRhZ3MuYXJ0aWZhY3Q7DQovL21lbnVPcHRpb25zLmZvcm1BZGRyZXNzID0gImhhcmR3YXJlIjsNCg0KaWYgKHRvb2xib3hUb29scy5sZW5ndGggPT09IDApIHsNCiAgICBjb25zdCBtZXNzYWdlID0gdG9vbGJveE5hbWUgKyAiIGRvZXMgbm90IGhhdmUgYW55IHRvb2xzIGxpc3RlZCBpbiB0aGUgdG9vbF9hcnJheSB0YWciOw0KDQogICAgYWIubG9nKGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBtZXNzYWdlKTsNCiAgICBvcy50b2FzdChtZXNzYWdlLCA1KTsNCiAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpOw0KfQ0KDQpmb3IgKGxldCB0b29sIG9mIHRvb2xib3hUb29scykgew0KICAgIGNvbnN0IHRvb2xCdXR0b24gPSB7DQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBsYWJlbDogdG9vbC5uYW1lLA0KICAgICAgICB0YXJnZXRBQjogdG9vbC50YXJnZXRBQiwNCiAgICAgICAgaXNBcnRpZmFjdDogdG9vbC5hcnRpZmFjdCB8fCBmYWxzZSwNCiAgICAgICAgb25DbGljazpgQA0KICAgICAgICAgICAgaWYgKHRhZ3MuaXNBcnRpZmFjdCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGFiQXJ0aWZhY3RTaGFyZCA9IHsNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICAgICAgICAgICAgZWdnUGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llczogWw0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGxpbmtzLmFydGlmYWN0LmFiQ3JlYXRlQXJ0aWZhY3RQcm9taXNlQm90KHsNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdE5hbWU6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3RTaGFyZCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCLA0KICAgICAgICAgICAgICAgICAgICBzb3VyY2VFdmVudDogJ3Rvb2wnLA0KICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiB0YWdzLnRvb2xib3gsDQogICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9uDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgYCwNCiAgICB9Ow0KDQogICAgaWYgKHRvb2wuZm9ybUFkZHJlc3MpIHsNCiAgICAgICAgdG9vbEJ1dHRvbi5mb3JtQWRkcmVzcyA9IHRvb2wuZm9ybUFkZHJlc3M7DQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2godG9vbEJ1dHRvbik7DQp9DQoNCnJldHVybiBkcm9wZG93bk9wdGlvbnM7JwCkp8SjBJqWARBvbkFCQXV0aEJvdEFkZGVkAgQApKfEowTRiAMYQHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7JwCkp8SjBJqWAQhhcnRpZmFjdAIEAKSnxKME6ogDKPCflJc3OGU0MTUwMy1jOTMzLTRmOGEtODE3YS1iYTk3YmY4ZDVkMjcnAQRib3RzJGM3OGFhNjYzLWQwNWMtNGVjNC1iYzJjLTI2ZmQ1MTU2MGI5NwEnAKSnxKMEkYkDCGFiSWdub3JlAgQApKfEowSSiQMEdHJ1ZScApKfEowSRiQMLYWJJbnRlcmZhY2UCBACkp8SjBJeJAwR0cnVlJwCkp8SjBJGJAwZzeXN0ZW0CBACkp8SjBJyJAxhhYi5pbnRlcmZhY2UuYm90X2ZhY3RvcnknAKSnxKMEkYkDFmFiQ3JlYXRlQmlsbGJvYXJkTGFiZWwCBACkp8SjBLWJA4xCQGNvbnN0IHsgCiAgICBib3QsCiAgICBkaW1lbnNpb24sCiAgICBwcmVzZXJ2ZU5ld0xpbmVzID0gdHJ1ZSwKICAgIGxhYmVsID0gJycsCiAgICBzcGFjZSA9ICd0ZW1wTG9jYWwnLAogICAgY29sb3IgPSAnd2hpdGUnLAogICAgbGFiZWxDb2xvciA9ICdibGFjaycsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9OwoKYXNzZXJ0KGxpbmtzLnV0aWxzLmlzQm90KGJvdCksIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm90IGlzIGEgcmVxdWlyZWQgQm90IHBhcmFtZXRlci5gKTsKYXNzZXJ0KGRpbWVuc2lvbiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkaW1lbnNpb24gaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CmFzc2VydChyZXN0Lm9uQ3JlYXRlID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQW55Qm90c0NoYW5nZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25BbnlCb3RzUmVtb3ZlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC51cGRhdGVMYWJlbCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5sYWJlbFdvcmRXcmFwTW9kZSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGxhYmVsV29yZFdyYXBNb2RlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwoKLy8gLS0tIDEpIFdvcmQgYnJlYWtpbmcgKHdyYXAgYnkgd29yZHMsIGNodW5rIGxvbmcgd29yZHMpIC0tLQpmdW5jdGlvbiBicmVha1dvcmRzVG9MaW5lcyh0ZXh0LCBtYXhDb2xzID0gMTgpIHsKICAgIGlmICghdGV4dCkgcmV0dXJuIFsnJ107CiAgICBjb25zdCB3b3JkcyA9IHRleHQuc3BsaXQoL1xzKy8pLmZpbHRlcihCb29sZWFuKTsKICAgIGNvbnN0IGxpbmVzID0gW107CiAgICBsZXQgbGluZSA9ICcnOwoKICAgIGNvbnN0IHB1c2ggPSAoKSA9PiB7IGxpbmVzLnB1c2gobGluZSk7IGxpbmUgPSAnJzsgfTsKCiAgICBmb3IgKGNvbnN0IHcgb2Ygd29yZHMpIHsKICAgICAgICBpZiAody5sZW5ndGggPiBtYXhDb2xzKSB7CiAgICAgICAgICAgIC8vIGNsb3NlIGN1cnJlbnQgbGluZSAoaWYgYW55KSBiZWZvcmUgY2h1bmtpbmcgYSBsb25nIHdvcmQKICAgICAgICAgICAgaWYgKGxpbmUpIHB1c2goKTsKICAgICAgICAgICAgLy8gY2h1bmsgdGhlIGxvbmcgd29yZAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcubGVuZ3RoOyBpICs9IG1heENvbHMpIHsKICAgICAgICAgICAgICAgIGxpbmVzLnB1c2gody5zbGljZShpLCBpICsgbWF4Q29scykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpbmUgPSAnJzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICghbGluZS5sZW5ndGgpIHsKICAgICAgICAgICAgbGluZSA9IHc7CiAgICAgICAgfSBlbHNlIGlmIChsaW5lLmxlbmd0aCArIDEgKyB3Lmxlbmd0aCA8PSBtYXhDb2xzKSB7CiAgICAgICAgICAgIGxpbmUgKz0gJyAnICsgdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwdXNoKCk7CiAgICAgICAgICAgIGxpbmUgPSB3OwogICAgICAgIH0KICAgIH0KICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaCgpOwoKICAgIHJldHVybiBsaW5lcy5sZW5ndGggPyBsaW5lcyA6IFsnJ107Cn0KCi8vIFByZXNlcnZlcyBleGlzdGluZyBcbiBhcyBoYXJkIGJyZWFrczsgd3JhcHMgd2l0aGluIGVhY2ggaGFyZCBsaW5lLgpmdW5jdGlvbiBicmVha1dvcmRzVG9MaW5lc1ByZXNlcnZlTmV3bGluZXModGV4dCwgbWF4Q29scyA9IDE4KSB7CiAgaWYgKHRleHQgPT0gbnVsbCkgcmV0dXJuIFsnJ107CgogIC8vIFNwbGl0IG9uIHJlYWwgbmV3bGluZXM7IGtlZXAgZW1wdHkgbGluZXMgc28gd2UgcHJlc2VydmUgYmxhbmsgbGluZXMuCiAgY29uc3QgaGFyZExpbmVzID0gU3RyaW5nKHRleHQpLnNwbGl0KC9ccj9cbi8pOwogIGNvbnN0IG91dCA9IFtdOwoKICAvLyBIZWxwZXIgdG8gd3JhcCBhIHNpbmdsZSBoYXJkIGxpbmUgYnkgd29yZHMgKHdpdGggbG9uZy13b3JkIGNodW5raW5nKQogIGNvbnN0IHdyYXBPbmUgPSAoc3JjKSA9PiB7CiAgICAvLyBOb3JtYWxpemUgdGFicyAtPiBzcGFjZXM7IGNvbGxhcHNlIGludGVybmFsIHdoaXRlc3BhY2UgKG5vdCBuZXdsaW5lcykKICAgIGNvbnN0IHMgPSBzcmMucmVwbGFjZSgvXHQvZywgJyAgICAnKS5yZXBsYWNlKC9ccysvZywgJyAnKS50cmltKCk7CiAgICBpZiAoIXMubGVuZ3RoKSB7IG91dC5wdXNoKCcnKTsgcmV0dXJuOyB9CgogICAgY29uc3Qgd29yZHMgPSBzLnNwbGl0KCcgJyk7CiAgICBsZXQgbGluZSA9ICcnOwoKICAgIGNvbnN0IHB1c2hMaW5lID0gKCkgPT4geyBvdXQucHVzaChsaW5lKTsgbGluZSA9ICcnOyB9OwoKICAgIC8vIGNodW5rIGxvbmcgd29yZHMgdG8gZW11bGF0ZSAnYnJlYWtXb3JkcycKICAgIGNvbnN0IGNodW5rV29yZCA9ICh3KSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdy5sZW5ndGg7IGkgKz0gbWF4Q29scykgewogICAgICAgIGNvbnN0IGNodW5rID0gdy5zbGljZShpLCBpICsgbWF4Q29scyk7CiAgICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgbGluZSA9IGNodW5rOwogICAgICAgIGVsc2UgeyBwdXNoTGluZSgpOyBsaW5lID0gY2h1bms7IH0KICAgICAgfQogICAgfTsKCiAgICBmb3IgKGNvbnN0IHcgb2Ygd29yZHMpIHsKICAgICAgaWYgKHcubGVuZ3RoID4gbWF4Q29scykgewogICAgICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaExpbmUoKTsKICAgICAgICBjaHVua1dvcmQodyk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgewogICAgICAgIGxpbmUgPSB3OwogICAgICB9IGVsc2UgaWYgKGxpbmUubGVuZ3RoICsgMSArIHcubGVuZ3RoIDw9IG1heENvbHMpIHsKICAgICAgICBsaW5lICs9ICcgJyArIHc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHVzaExpbmUoKTsKICAgICAgICBsaW5lID0gdzsKICAgICAgfQogICAgfQogICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoTGluZSgpOwogIH07CgogIGZvciAoY29uc3QgaGwgb2YgaGFyZExpbmVzKSB7CiAgICB3cmFwT25lKGhsKTsgICAgICAgICAgIC8vIHdyYXAgd2l0aGluIHRoaXMgaGFyZCBsaW5lCiAgfQoKICAvLyBJZiB0aGUgaW5wdXQgZW5kZWQgd2l0aCBhIHRyYWlsaW5nIG5ld2xpbmUsIHdlIGFscmVhZHkgcHJlc2VydmVkIGl0CiAgLy8gYmVjYXVzZSBzcGxpdCBrZXB0IGFuIGVtcHR5IGxhc3QgaXRlbSAtPiBiZWNhbWUgYW4gZW1wdHkgd3JhcHBlZCBsaW5lLgogIHJldHVybiBvdXQubGVuZ3RoID8gb3V0IDogWycnXTsKfQoKLy8gLS0tIDIpIFNpbXBsZSBzaXppbmcgZnJvbSBsaW5lcyAtLS0KLy8gVGhpbmsgb2YgImNvbHNQZXJTY2FsZVgiIGFzICJhYm91dCBOIGNoYXJhY3RlcnMgcGVyIDEgc2NhbGVYIi4KZnVuY3Rpb24gY29tcHV0ZVNpbXBsZVNjYWxlc0Zyb21MaW5lcyhsaW5lcywgewogICAgY29sc1BlclNjYWxlWCA9IDIuNSwKICAgIG1pblNjYWxlWCA9IDEuMjUsCiAgICBtYXhTY2FsZVggPSAxMCwKICAgIGJhc2VTY2FsZVkgPSAxLjIsCiAgICBwZXJMaW5lWSA9IDAuNzUsCn0gPSB7fSkgewogICAgY29uc3QgbG9uZ2VzdCA9IGxpbmVzLnJlZHVjZSgobSwgbCkgPT4gTWF0aC5tYXgobSwgbC5sZW5ndGgpLCAwKTsKICAgIGNvbnN0IGxpbmVDb3VudCA9IE1hdGgubWF4KDEsIGxpbmVzLmxlbmd0aCk7CgogICAgLy8gV2lkdGggc2NhbGVzIHdpdGggdGhlIGxvbmdlc3QgbGluZSBsZW5ndGgKICAgIGxldCBzY2FsZVggPSBsb25nZXN0ID4gMCA/IChsb25nZXN0IC8gY29sc1BlclNjYWxlWCkgOiBtaW5TY2FsZVg7CiAgICBzY2FsZVggPSBNYXRoLm1heChtaW5TY2FsZVgsIE1hdGgubWluKG1heFNjYWxlWCwgc2NhbGVYKSk7CgogICAgLy8gSGVpZ2h0IGdyb3dzIHBlciBsaW5lOyBrZWVwIGl0IHNpbXBsZSBhbmQgcHJlZGljdGFibGUKICAgIGNvbnN0IHNjYWxlWSA9IE1hdGgubWF4KGJhc2VTY2FsZVksIGJhc2VTY2FsZVkgKyAobGluZUNvdW50IC0gMSkgKiBwZXJMaW5lWSk7CgogICAgcmV0dXJuIHsgc2NhbGVYLCBzY2FsZVksIGxvbmdlc3QsIGxpbmVDb3VudCB9Owp9CgoKLy8gUGljayB5b3VyIHRhcmdldCAiY29sdW1ucyIgcGVyIGxpbmUgKHR3ZWFrIHRvIHRhc3RlKQpjb25zdCBNQVhfQ09MUyA9IDMyOwoKLy8gQnJlYWsgdGhlIHRleHQgeW91cnNlbGYKY29uc3QgbGluZXMgPSBwcmVzZXJ2ZU5ld0xpbmVzID8gYnJlYWtXb3Jkc1RvTGluZXNQcmVzZXJ2ZU5ld2xpbmVzKGxhYmVsLCBNQVhfQ09MUykgOiBicmVha1dvcmRzVG9MaW5lcyhsYWJlbCwgTUFYX0NPTFMpOwpjb25zdCB3cmFwcGVkTGFiZWwgPSBsaW5lcy5qb2luKCdcbicpOwoKLy8gQ29tcHV0ZSBzaW1wbGUgc2NhbGVzIGZyb20gdGhlIHdyYXBwZWQgdGV4dApjb25zdCB7IHNjYWxlWCwgc2NhbGVZIH0gPSBjb21wdXRlU2ltcGxlU2NhbGVzRnJvbUxpbmVzKGxpbmVzKTsKCmxldCBsYWJlbE1vZCA9IHsKICAgIHNwYWNlOiBzcGFjZSwKICAgIHRyYWNrQm90SWQ6IGJvdC5pZCwKICAgIGZvcm06ICdzcHJpdGUnLAogICAgY29sb3IsCiAgICBsYWJlbDogd3JhcHBlZExhYmVsLAogICAgbGFiZWxDb2xvciwKICAgIGxhYmVsU2l6ZTogMSwKICAgIGxhYmVsUGFkZGluZ1g6IDAuNSwKICAgIGxhYmVsV29yZFdyYXBNb2RlOiAnbm9uZScsCiAgICBzY2FsZVgsIAogICAgc2NhbGVZLAogICAgc2NhbGVaOiAwLjEsCiAgICBib3RMYWJlbE1hcmdpbjogMSwKICAgIGFuY2hvclBvaW50OiAn4p6h77iPMCwtMC41LDAnLAogICAgb3JpZW50YXRpb25Nb2RlOiAnYmlsbGJvYXJkJywKICAgIGRpbWVuc2lvbjogZGltZW5zaW9uLAogICAgZGVidWc6IGZhbHNlLAogICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgb25DcmVhdGU6IGBACiAgICAgICAgLy8gV2FpdCBmb3IgcmVxdWlyZWQgYm90cyB0byBiZSByZWFkeS4KICAgICAgICBsZXQgd2FpdFRpbWUgPSAwOwoKICAgICAgICB3aGlsZSghZ2xvYmFsVGhpcy5hYikgewogICAgICAgICAgICBpZiAod2FpdFRpbWUgPj0gNTAwMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCBvcy5zbGVlcCgyNTApOwogICAgICAgICAgICB3YWl0VGltZSArPSAyNTA7CiAgICAgICAgfQoKICAgICAgICB0YWdzLnJlYWR5ID0gdHJ1ZTsKICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICBgLAogICAgb25BbnlCb3RzQ2hhbmdlZDogYEAKCiAgICAgICAgZm9yIChjb25zdCBjaGFuZ2VkIG9mIHRoYXQpIHsKICAgICAgICAgICAgaWYgKGNoYW5nZWQuYm90ICYmIGNoYW5nZWQuYm90LmlkID09PSB0YWdzLnRyYWNrQm90SWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9ubHlSb3RhdGlvblRhZ3MgPSBjaGFuZ2VkLnRhZ3MuZXZlcnkoKHQpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5lbmRzV2l0aCgnUm90YXRpb24nKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblgnKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblknKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblonKQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gb25seVJvdGF0aW9uVGFnczonLCBvbmx5Um90YXRpb25UYWdzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAob25seVJvdGF0aW9uVGFncykgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICBgLAogICAgb25BbnlCb3RzUmVtb3ZlZDogYEAKCiAgICAgICAgaWYgKHRoYXQuYm90SURzLmluY2x1ZGVzKHRhZ3MudHJhY2tCb3RJZCkpIHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICB9CiAgICBgLAogICAgb25Qb3J0YWxDaGFuZ2VkOiBgQAogICAgICAgIGlmICh0aGF0LmRpbWVuc2lvbiA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgICAgIH0KICAgIGAsCiAgICB1cGRhdGVMYWJlbDogYEAKICAgICAgICBpZiAoIXRhZ3MucmVhZHkpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmluZyB1cGRhdGVMYWJlbCBiZWNhdXNlIG5vdCByZWFkeScpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaW5NYXBQb3J0YWwgPSAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgY29uc3QgaW5HcmlkUG9ydGFsID0gKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICghaW5NYXBQb3J0YWwgJiYgIWluR3JpZFBvcnRhbCkgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmUgdXBkYXRlTGFiZWwgY2FsbCwgbm90IGluIGVpdGhlciBncmlkIG9yIG1hcCBwb3J0YWwuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdHJhY2tCb3QgPSBnZXRCb3QoJ2lkJywgdGFncy50cmFja0JvdElkKTsKICAgICAgICBjb25zdCB0cmFja1Bvc2l0aW9uID0gZ2V0Qm90UG9zaXRpb24odHJhY2tCb3QsIHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSB0cmFja1Bvc2l0aW9uOicsIHRyYWNrUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgbGV0IGxhYmVsUG9zaXRpb24gPSB7IHg6IHRyYWNrUG9zaXRpb24ueCwgeTogdHJhY2tQb3NpdGlvbi55LCB6OiB0cmFja1Bvc2l0aW9uLnogfTsgCgogICAgICAgIGNvbnN0IHRyYWNrQm90U2NhbGUgPSB0cmFja0JvdC50YWdzLnNjYWxlID8/IDE7CiAgICAgICAgY29uc3QgdHJhY2tCb3RTY2FsZVogPSB0cmFja0JvdC50YWdzLnNjYWxlWiA/PyAxOwoKICAgICAgICBsZXQgbWV0ZXJzUGVyR3JpZFVuaXQgPSAxOwoKICAgICAgICBpZiAoaW5NYXBQb3J0YWwpIHsKICAgICAgICAgICAgLy8gU2NhbGUgdG8gbWFwIHBvcnRhbCB1bml0cy4KICAgICAgICAgICAgbWV0ZXJzUGVyR3JpZFVuaXQgPSAxMDsKICAgICAgICB9CgogICAgICAgIGxldCB0cmFja0JvdFJlYWxTY2FsZVogPSAodHJhY2tCb3RTY2FsZVogKiB0cmFja0JvdFNjYWxlKSAqIG1ldGVyc1BlckdyaWRVbml0OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIHRyYWNrQm90UmVhbFNjYWxlWjonLCB0cmFja0JvdFJlYWxTY2FsZVopOwogICAgICAgIH0KCiAgICAgICAgbGFiZWxQb3NpdGlvbi56ICs9IHRyYWNrQm90UmVhbFNjYWxlWiArICh0YWdzLmJvdExhYmVsTWFyZ2luICogbWV0ZXJzUGVyR3JpZFVuaXQpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGxhYmVsUG9zaXRpb246JywgbGFiZWxQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1gnXSA9IGxhYmVsUG9zaXRpb24ueDsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1knXSA9IGxhYmVsUG9zaXRpb24ueTsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1onXSA9IGxhYmVsUG9zaXRpb24uejsKICAgIGAKfTsKCmxhYmVsTW9kID0gewogICAgLi4ubGFiZWxNb2QsCiAgICAuLi5yZXN0LAp9Cgpjb25zdCBsYWJlbEJvdCA9IGNyZWF0ZShsYWJlbE1vZCk7CgpyZXR1cm4gbGFiZWxCb3Q7JwCkp8SjBJGJAwV1dGlscwIEAKSnxKMEvssDKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAKSnxKMEkYkDBGZvcm0CBACkp8SjBOXLAwdub3RoaW5nJwCkp8SjBJGJAwlhYlZlcnNpb24CBACkp8SjBO3LAwUxMC4xMwA="}]}