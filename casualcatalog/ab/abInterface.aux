{"version":2,"updates":[{"id":0,"timestamp":1761069586732,"update":"AewBi/+YmwoAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwCL/5ibCgAKYWJJRE9yaWdpbgIEAIv/mJsKAQ10b29sYm94X3NraWxsJwCL/5ibCgALYWJJbnRlcmZhY2UCBACL/5ibCg8EdHJ1ZScAi/+YmwoAC2Rlc2NyaXB0aW9uAgQAi/+YmwoUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwCL/5ibCgAEZm9ybQIEAIv/mJsKPgdub3RoaW5nJwCL/5ibCgAEbWVudQIEAIv/mJsKRijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCL/5ibCgAGc3lzdGVtAgQAi/+YmwptFGFiLmludGVyZmFjZS50b29sYm94JwCL/5ibCgAKYWJJRFN0dWRpbwIEAIv/mJsKggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwCL/5ibCgAIcmVtZW1iZXICBACL/5ibCqcBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIv/mJsKAAt0b29sYm94X2FkZAIEAIv/mJsKzgHlC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgiYmFzZVNraWxsIiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIGF3YWl0IG9zLnNsZWVwKDIwMCk7CiAgICAgICAgbWVudUJvdC5vblBvaW50ZXJVcCgpOwogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScAi/+YmwoABWxlYXJuAgQAi/+Ymwq0DSjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCL/5ibCgAFc3RvcmUCBACL/5ibCtsNKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAIv/mJsKAAZzZWFyY2gCBACL/5ibCoIOKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAIv/mJsKAAhhYklnbm9yZQIEAIv/mJsKqQ4EdHJ1ZScAi/+YmwoACWFiVmVyc2lvbgIEAIv/mJsKrg4FMTAuMjcnAIv/mJsKAA1tYW5pZmVzdGF0aW9uAgQAi/+Ymwq0Dijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCL/5ibCgAQYWJHcmlkTWVudUFjdGlvbgIEAIv/mJsK2w65C0AvLyBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKLy8gY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCi8vIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAovLyAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKLy8gICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyBgOwovLyB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACi8vICAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewovLyAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7Ci8vICAgICB9Ci8vIGA7Ci8vIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IGBACi8vICAgICB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKLy8gICAgIHRoaXNCb3QubWFza3Mub25LZXlEb3duID0gbnVsbDsKLy8gICAgIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IG51bGw7Ci8vIGA7CgovLyBjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKLy8gY29uc3QgbWVudUJvdCA9IHt9OwoKLy8gbWVudUJvdC5hYk1lbnUgPSB0cnVlOwovLyBtZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Ci8vIG1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwovLyBtZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwovLyBtZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOwovLyBtZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247Ci8vIG1lbnVCb3Qub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIudG9vbGJveF9hZGQoe3Rvb2xib3hEYXRhOiB0YWdzLnRvb2xib3hfZGF0YSwgZ3JpZERhdGE6IHRhZ3MuZ3JpZERhdGF9KTsgc2hvdXQoImFiTWVudVJlZnJlc2giKTtgOwoKLy8gZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykKLy8gewovLyAgICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOwovLyAgICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsKCi8vICAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7Ci8vICAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7CgovLyAgICAgaWYgKCFleHRhbnRCb3QpCi8vICAgICB7Ci8vICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJvdCk7Ci8vICAgICB9Ci8vIH0nAIv/mJsKABRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAIv/mJsKlRriAkBjb25zdCB0b29sYm94QXJyYXkgPSBhYlJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKCmxldCBhbGxUb29sc0xvYWRlZCA9IHRydWU7Cgpmb3IgKGxldCBpID0gMDsgaSA8IHRvb2xib3hBcnJheS5sZW5ndGg7IGkrKykgewogICAgY29uc3QgY3VycmVudFRvb2wgPSB0b29sYm94QXJyYXlbaV0ubmFtZTsKCiAgICBpZiAoIWdldEJvdCgiYWJJRE9yaWdpbiIsIGN1cnJlbnRUb29sKSAmJiAhZ2V0Qm90KGN1cnJlbnRUb29sLCB0cnVlKSkgewogICAgICAgIGFsbFRvb2xzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChhbGxUb29sc0xvYWRlZCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfScAi/+YmwoADmFiR3JpZE1lbnVJY29uAgQAi/+Ymwr4HApsb2NhbF9tYWxsJwCL/5ibCgAPYWJHcmlkTWVudUxhYmVsAgQAi/+YmwqDHQ5jYXN1YWwgY2F0YWxvZycAi/+YmwoAE2FiR3JpZE1lbnVTb3J0T3JkZXICBACL/5ibCpIdATMnAIv/mJsKAA9vbkFCSW5pdGlhbGl6ZWQCBACL/5ibCpQdKkAvLyBsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOycAi/+YmwoADW9uU2tpbGxVcGRhdGUCBACL/5ibCr8dV0BsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOw0KDQpjb25zb2xlLmxvZygiW1Rvb2xib3hdIExvYWRpbmcgY2FzdWFsIGtpdCIpOycAi/+YmwoACnNoZWxsVXRpbHMCBACL/5ibCpceKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAIv/mJsKABhhYkdyaWRNZW51T25CZWZvcmVDcmVhdGUCBACL/5ibCr4e/AhAaWYgKGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSkgew0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiR3JpZE1lbnVMYWJlbCIsIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSk7DQp9DQoNCg0KLy9ORVcNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsNCg0KZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykNCnsNCiAgICBjb25zdCBtZW51Qm90ID0ge307DQoNCiAgICBtZW51Qm90LmFiTWVudSA9IHRydWU7DQogICAgbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KICAgIG1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOw0KICAgIG1lbnVCb3QubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7DQogICAgbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsNCiAgICBtZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247DQogICAgbWVudUJvdC5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7DQogICAgDQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7DQogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOw0KDQogICAgaWYgKCFleHRhbnRCb3QpDQogICAgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtZW51Qm90KTsNCiAgICB9DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAi/+YmwoAEmFiR3JpZE1lbnVJdGVtVHlwZQIEAIv/mJsKuycIZHJvcGRvd24nAIv/mJsKABFkcm9wZG93blNvcnRPcmRlcgIEAIv/mJsKxCcBMycAi/+YmwoAD2Ryb3Bkb3duT3B0aW9ucwIEAIv/mJsKxicG8J+nrFtdJwEEYm90cyQxNzQxMGQ4My03ZWVlLTRhMWUtYjYzOC02NTQ2Mzc0ZDE3YzMBJwCL/5ibCssnBnN5c3RlbQIEAIv/mJsKzCcRYWIuaW50ZXJmYWNlLnNjYW4nAIv/mJsKyycEZm9ybQIEAIv/mJsK3icHbm90aGluZycAi/+YmwrLJwthYkludGVyZmFjZQIEAIv/mJsK5icEdHJ1ZScAi/+YmwrLJwhhYklnbm9yZQIEAIv/mJsK6ycEdHJ1ZScAi/+YmwrLJw9vblFSQ29kZVNjYW5uZWQCBACL/5ibCvAn/Q9AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgpsZXQgcmVxdWVzdGluZ0FJID0gZmFsc2U7CmlmIChjb25maWdCb3QudGFncy5yZXF1ZXN0aW5nQUkpIHsKICAgIGNvbmZpZ0JvdC50YWdzLnJlcXVlc3RpbmdBSSA9IG51bGw7CiAgICByZXF1ZXN0aW5nQUkgPSB0cnVlOwp9CgppZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhc2siKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBpZiAocmVxdWVzdGluZ0FJKSB7CiAgICAgICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgicmVxdWVzdGluZ0FJIiwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIG9zLmdvVG9VUkwoc2Nhbm5lZFVSTC5ocmVmKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7CiAgICAgICAgICAgIGxldCBuZXdUYWcgPSBrZXk7CiAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3NbbmV3VGFnXSA9IG5ld1ZhbHVlOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuYXNrKSB7CiAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogY29uZmlnQm90LnRhZ3MuYXNrfSk7CiAgICAgICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5wYXR0ZXJuKSB7CiAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogY29uZmlnQm90LnRhZ3MucGF0dGVybn0pOwogICAgICAgIH0KICAgICAgICAKICAgIH0KfScAi/+YmwrLJwVzdG9yZQIEAIv/mJsK7jco8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAi/+YmwrLJwZzZWFyY2gCBACL/5ibCpU4KPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAIv/mJsKyycQYWJDb3JlTWVudUFjdGlvbgIEAIv/mJsKvDg3QG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7Cgpjb25maWdCb3QudGFncy5hYlNjYW4gPSB0cnVlOycAi/+YmwrLJw9hYkNvcmVNZW51TGFiZWwCBACL/5ibCvQ4BHNjYW4nAIv/mJsKyycOYWJDb3JlTWVudUljb24CBACL/5ibCvk4D3FyX2NvZGVfc2Nhbm5lcicAi/+YmwrLJxNhYkNvcmVNZW51U29ydE9yZGVyAgQAi/+YmwqJOQEzJwCL/5ibCssnCWFiVmVyc2lvbgIEAIv/mJsKizkFMTAuMjcnAQRib3RzJDNhNmNiOWNhLWIzYjQtNGQ3Ny04MmY2LWZhNTliNTI5NmVjOQEnAIv/mJsKkTkGc3lzdGVtAgQAi/+YmwqSORdhYi5pbnRlcmZhY2UubmF2aWdhdGlvbicAi/+YmwqROQhhYklnbm9yZQIEAIv/mJsKqjkEdHJ1ZScAi/+YmwqROQ9kcm9wZG93bk9wdGlvbnMCBACL/5ibCq85BvCfp6xbXScAi/+YmwqRORJhYkNvcmVNZW51SXRlbVR5cGUCBACL/5ibCrQ5CGRyb3Bkb3duJwCL/5ibCpE5EWRyb3Bkb3duU29ydE9yZGVyAgQAi/+Ymwq9OQRhdXRvJwCL/5ibCpE5GGFiQ29yZU1lbnVPbkJlZm9yZUNyZWF0ZQIEAIv/mJsKwjn+IEBjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgY3VycmVudERpbSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQpjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KDQovLyBpZiAoY3VycmVudFBvcnRhbCAhPSAnbWFwJykgew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KLy8gfSBlbHNlIHsNCi8vICAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQovLyB9DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk5hdmlnYXRpb25NZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5za2lsbEJvdCA9IGdldExpbmsodGhpc0JvdCk7DQoNCmNvbnN0IGhvbWVXb3JsZEJ1dHRvbiA9IHsNCiAgICAuLi5tZW51T3B0aW9ucywNCiAgICBsYWJlbDogImhvbWUgd29ybGQiLA0KICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1LzM4YWU4YjY5NTdmNDQ4M2Q4NzE2MTQxZDFlOThjOTNmMGU3ZGNjZTE1YmM1YzEyM2JkMGU5ZTFhYjY4N2NjMDUucG5nJywNCiAgICBvbkNsaWNrOiBgQA0KICAgICAgICBjb25zdCBjdXJyZW50VVJMID0gbmV3IFVSTChjb25maWdCb3QudGFncy51cmwpOw0KICAgICAgICBjb25zdCBvcmlnaW4gPSBjdXJyZW50VVJMLm9yaWdpbjsNCg0KICAgICAgICBsZXQgbmV3VVJMID0gbmV3IFVSTChvcmlnaW4pOw0KDQogICAgICAgIGlmIChhYlJlbWVtYmVyLnRhZ3MuYWxsb3dDaGFubmVscykgew0KICAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImNoYW5uZWwiLCBmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuY29tSWQpIHsNCiAgICAgICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJjb21JZCIsIGNvbmZpZ0JvdC50YWdzLmNvbUlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJvd25lciIsIChjb25maWdCb3QudGFncy5zdHVkaW8gJiYgY29uZmlnQm90LnRhZ3Muc3R1ZGlvICE9IGF1dGhCb3QuaWQpID8gY29uZmlnQm90LnRhZ3Muc3R1ZGlvIDogInBsYXllciIpOw0KICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiaW5zdCIsICdob21lJyk7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJtYXBQb3J0YWwiLCAnaG9tZScpOw0KICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiYXNrIiwgJ2hvbWUnKTsNCiAgICAgICAgDQogICAgICAgIGlmIChjb25maWdCb3QudGFncy5zdHVkaW8gJiYgY29uZmlnQm90LnRhZ3Muc3R1ZGlvICE9IGF1dGhCb3QuaWQpIHsNCiAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoInN0dWRpbyIsIHRoYXQuaWQpOyANCiAgICAgICAgfQ0KDQogICAgICAgIG9zLm9wZW5VUkwobmV3VVJMLmhyZWYpOw0KICAgIGANCn07DQoNCmlmICghZ2V0Qm90KCJpc0hvbWVXb3JsZENvcmUiLCB0cnVlKSAmJiBhdXRoQm90KSB7DQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZVdvcmxkQnV0dG9uKTsNCn0NCg0KaWYgKGN1cnJlbnRQb3J0YWwgPT0gJ21hcCcpIHsNCg0KICAgIGNvbnN0IGhvbWVCYXNlQm90ID0gZ2V0Qm90KCJob21lQmFzZSIsIHRydWUpOw0KDQogICAgaWYgKGhvbWVCYXNlQm90KSB7DQogICAgICAgIGNvbnN0IGhvbWVCdXR0b24gPSB7DQogICAgICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgICAgIGxhYmVsOiBob21lQmFzZUJvdC50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2h0dHBzOi8vYXV0aC1hdXgtZGV2LWZpbGVzYnVja2V0LTY4MjM5NzY5MDY2MC5zMy5hbWF6b25hd3MuY29tLzMxOGMwNGYxLTEzOTEtNGMxMC04ZDQzLWFhZWJjNTE3MDI2NS9jZDM4YWZmYzA2MDRiZWFhNTg4ZGEyMWFhMWJlNzUwYmIzZTczYjNiM2NhZTIzZWIzMDMwN2MzNDQ5NDQ1OWYzLnBuZycsDQogICAgICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgICAgIGNvbnN0IGhvbWVCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgaWYgKGhvbWVCb3QpIHsNCiAgICAgICAgICAgICAgICAgICAgb3MuZm9jdXNPbihob21lQm90LCB7IHpvb206IDIwMDAgfSkuY2F0Y2goKCkgPT4ge30pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgYA0KICAgICAgICB9Ow0KDQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGhvbWVCdXR0b24pOw0KICAgIH0NCg0KICAgIGNvbnN0IHBsYWNlc0FyciA9IFtdOw0KICAgIGNvbnN0IHBsYWNlcyA9IGdldEJvdHMoImhvbWVQbGFjZSIsIHRydWUpOw0KICAgIGZvciAoY29uc3QgaFBsYWNlIG9mIHBsYWNlcykgew0KICAgICAgICBpZiAoaFBsYWNlLnRhZ3MuaG9tZUJhc2UgPT0gdHJ1ZSkgew0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgcGxhY2VPYmogPSB7DQogICAgICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgICAgIGxhYmVsOiBoUGxhY2UudGFncy5wbGFjZUxhYmVsLA0KICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdsb2NhdGlvbl9vbicsDQogICAgICAgICAgICBwbGFjZTogZ2V0TGluayhoUGxhY2UpLA0KICAgICAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgICAgICBpZiAobGlua3MucGxhY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgb3MuZm9jdXNPbihsaW5rcy5wbGFjZSwgeyB6b29tOiAyMDAwIH0pLmNhdGNoKGUgPT4ge30pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgICAgIGANCiAgICAgICAgfQ0KDQogICAgICAgIHBsYWNlc0Fyci5wdXNoKHBsYWNlT2JqKTsNCiAgICB9DQoNCiAgICBwbGFjZXNBcnIuc29ydCgoYSwgYikgPT4gew0KICAgICAgICBjb25zdCBuYW1lQSA9IGEubGFiZWwudG9VcHBlckNhc2UoKTsNCiAgICAgICAgY29uc3QgbmFtZUIgPSBiLmxhYmVsLnRvVXBwZXJDYXNlKCk7DQoNCiAgICAgICAgaWYgKG5hbWVBIDwgbmFtZUIpIHsNCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobmFtZUEgPiBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIDA7DQogICAgfSk7DQoNCiAgICBmb3IgKGNvbnN0IHNvcnRlZFBsYWNlIG9mIHBsYWNlc0Fycikgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChzb3J0ZWRQbGFjZSk7DQogICAgfQ0KDQoNCiAgICBjb25zdCBjdXJyZW50TG9jYXRpb25CdXR0b24gPSB7DQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBsYWJlbDogJ2N1cnJlbnQgbG9jYXRpb24nLA0KICAgICAgICBmb3JtQWRkcmVzczogJ25lYXJfbWUnLA0KICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgbGlua3Muc2tpbGxCb3QuZ29Ub0N1cnJlbnRMb2NhdGlvbigpOw0KICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgYA0KICAgIH0NCg0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGN1cnJlbnRMb2NhdGlvbkJ1dHRvbik7DQp9DQoNCmlmIChkcm9wZG93bk9wdGlvbnMubGVuZ3RoID09IDApIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gdHJ1ZTsNCn0gZWxzZSB7DQogICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IGZhbHNlOw0KfQ0KDQptYXNrcy5kcm9wZG93bk9wdGlvbnMgPSBkcm9wZG93bk9wdGlvbnM7DQoNCnJldHVybjsnAIv/mJsKkTkQYWJDb3JlTWVudUFjdGlvbgIEAIv/mJsKwVoDQC8vJwCL/5ibCpE5C2FiSW50ZXJmYWNlAgQAi/+YmwrFWgR0cnVlJwCL/5ibCpE5D2FiQ29yZU1lbnVMYWJlbAIEAIv/mJsKyloJcGxhY2UgbmF2JwCL/5ibCpE5BGZvcm0CBACL/5ibCtRaB25vdGhpbmcnAIv/mJsKkTkTZ29Ub0N1cnJlbnRMb2NhdGlvbgIEAIv/mJsK3FqABEBjb25zdCBsb2NhdGlvbiA9IGF3YWl0IG9zLmdldEdlb2xvY2F0aW9uKCk7DQoNCmlmIChsb2NhdGlvbi5zdWNjZXNzKSB7DQogICAgY29uc3QgY3VycmVudERpbSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQogICAgY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQoNCiAgICBpZiAoY3VycmVudFBvcnRhbCAhPSAnbWFwJykgew0KICAgICAgICBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSBjdXJyZW50RGltOw0KICAgIH0NCg0KICAgIG9zLmZvY3VzT24oe3g6IGxvY2F0aW9uLmxvbmdpdHVkZSwgeTogbG9jYXRpb24ubGF0aXR1ZGV9LCB7cG9ydGFsOiAnbWFwJywgem9vbTogMjAwMH0pOw0KfSBlbHNlIHsNCiAgICBvcy50b2FzdCgiTG9jYXRpb24gc2VydmljZXMgbm90IGF2YWlsYWJsZSIpDQp9JwCL/5ibCpE5CWFiVmVyc2lvbgIEAIv/mJsK3V4FMTAuMjcnAQRib3RzJDQ5M2ZmYTRkLTQ2ZDQtNGE5OC1hZTljLTEyMTJkNjUxMTMzZgEnAIv/mJsK414Gc3lzdGVtAgQAi/+YmwrkXhRhYi5pbnRlcmZhY2UudmVyc2lvbicAi/+YmwrjXg1vblNraWxsVXBkYXRlAgQAi/+Ymwr5XqcBQGNvbnN0IHZlcnNpb25TdHJpbmcgPSB0YWdzLmFiSW50ZXJmYWNlTWFqb3JWZXJzaW9uICsgIi4iICsgdGFncy5hYkludGVyZmFjZU1pbm9yVmVyc2lvbjsNCg0KY29uc29sZS5sb2coIltBQkludGVyZmFjZV0gTG9hZGVkIEFCIEludGVyZmFjZSB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAIv/mJsK414XYWJJbnRlcmZhY2VNYWpvclZlcnNpb24CBACL/5ibCqFgATInAIv/mJsK414XYWJJbnRlcmZhY2VNaW5vclZlcnNpb24CBACL/5ibCqNgAjE5JwCL/5ibCuNeCGFiSWdub3JlAgQAi/+YmwqmYAR0cnVlJwCL/5ibCuNeBGZvcm0CBACL/5ibCqtgB25vdGhpbmcnAIv/mJsK414LYWJJbnRlcmZhY2UCBACL/5ibCrNgBHRydWUnAIv/mJsK414JYWJWZXJzaW9uAgQAi/+Ymwq4YAUxMC4yNycBBGJvdHMkNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmAScAi/+Ymwq+YAZzeXN0ZW0CBACL/5ibCr9gE2FiLmludGVyZmFjZS5udWdnZXQnAIv/mJsKvmAEZm9ybQIEAIv/mJsK02AHbm90aGluZycAi/+Ymwq+YAthYkludGVyZmFjZQIEAIv/mJsK22AEdHJ1ZScAi/+Ymwq+YAhhYklnbm9yZQIEAIv/mJsK4GAEdHJ1ZScAi/+Ymwq+YAxhYkxvYWROdWdnZXQCBACL/5ibCuVgmAJAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldE5hbWU7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIitudWdnZXROYW1lOwpsZXQgbG9hZGVkTnVnZ2V0ID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBmb3JtYXR0ZWROdWdnZXRBQiwgYWJWZXJzaW9uOiB0aGF0LnZlcnNpb24sIHJldHVyblR5cGU6ICJkYXRhIn0pOwoKbG9hZGVkTnVnZ2V0ID0gbG9hZGVkTnVnZ2V0LnN0YXRlW251Z2dldE5hbWVdLm51Z2dldDsKCnJldHVybiBsb2FkZWROdWdnZXQ7JwCL/5ibCr5gD2FiUHVibGlzaE51Z2dldAIEAIv/mJsK/mKMA0AvL3Nob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiAibnVnTmFtZSIsIGRhdGE6IGRhdGF9KTsgIEFERCBFR0cgSUQgRVZFTlRVQUxMWQpsZXQgdGVzdE51Z2dldCA9IHRoYXQuZGF0YTsKbGV0IGZvcm1hdHRlZE51Z2dldCA9IHtpZDogdGhhdC5udWcsIG51Z2dldDogdGVzdE51Z2dldH07CmxldCB0ZXN0TnVnZ2V0TmFtZSA9IHRoYXQubnVnOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrdGVzdE51Z2dldE5hbWU7CgptYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBmb3JtYXR0ZWROdWdnZXRBQjsKCmxpbmtzLnN0b3JlLmFiUHVibGlzaEFCKHthYjogZm9ybWF0dGVkTnVnZ2V0QUIsIHRhcmdldDogZm9ybWF0dGVkTnVnZ2V0LCBzb3VyY2VFdmVudDogJ3B1Ymxpc2hfbnVnZ2V0J30pOycAi/+Ymwq+YA9pbXBsZW1lbnROdWdnZXQCBACL/5ibCotmsQdAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldDsKbGV0IG51Z2dldFZlcnNpb25DaGVjayA9IG51Z2dldE5hbWUuaW5kZXhPZigiLnYiKTsKbGV0IHZlcnNpb247CgppZiAobnVnZ2V0VmVyc2lvbkNoZWNrICE9IC0xKQp7CiAgICBudWdnZXROYW1lID0gbnVnZ2V0TmFtZS5zdWJzdHJpbmcoMCwgbnVnZ2V0VmVyc2lvbkNoZWNrKTsKCiAgICBsZXQgdmVyc2lvbkNoZWNrID0gdGhhdC5udWdnZXQuc3Vic3RyaW5nKG51Z2dldFZlcnNpb25DaGVjayArIDIpOwoKICAgIGlmIChpc05hTih2ZXJzaW9uQ2hlY2spKQogICAgewogICAgICAgIGNvbnNvbGUubG9nKHZlcnNpb25DaGVjaywgInZlcnNpb24gaXMgbm90IGEgbnVtYmVyIik7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdmVyc2lvbiA9IE51bWJlcih2ZXJzaW9uQ2hlY2spOwogICAgfQp9CmNvbnNvbGUubG9nKG51Z2dldE5hbWUsIHZlcnNpb24pOwpsZXQgbnVnRGF0YSA9IGF3YWl0IHRoaXNCb3QuYWJMb2FkTnVnZ2V0KHtudWdnZXROYW1lOiBudWdnZXROYW1lLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7CgppZiAobnVnRGF0YSA9PSAiYWJJRCBub3QgZm91bmQiKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IG5vdCBmb3VuZCIpOwp9CmVsc2UKewogICAgbGV0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CiAgICBsZXQgdGFyZ2V0VGFnID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10udG9TdHJpbmcoKTsKICAgIGxldCB0YXJnZXROdWcgPSAieyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0VGFnLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7CiAgICBpbnNlcnRUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgbnVnRGF0YSk7Cn0nAIv/mJsKvmAMbnVnZ2V0QnV0dG9uAgQAi/+Ymwq9bfUMQGxldCB0YWdWYWx1ZSA9IHRoYXQudGFnVmFsdWU7CmxldCByZWdleCA9IC9cbi9naTsKbGV0IGJyZWFrQ2hlY2s7CmxldCBicmVha0FycmF5ID0gWzBdOwovL2xldCBjcmVhdGVkQnV0dG9ucyA9IFtdOwoKd2hpbGUgKGJyZWFrQ2hlY2sgPSByZWdleC5leGVjKHRhZ1ZhbHVlKSkKewogICAgYnJlYWtBcnJheS5wdXNoKGJyZWFrQ2hlY2suaW5kZXgpOwp9CgpsZXQgbmV3TnVnZ2V0QnV0dG9uID0ge307CgpuZXdOdWdnZXRCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TnVnZ2V0QnV0dG9uLmZvcm0gPSAiY29kZUJ1dHRvbiI7Cm5ld051Z2dldEJ1dHRvbi50YXJnZXRCb3QgPSB0aGF0LmJvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldFRhZyA9IHRoYXQudGFnOwpuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAibG9hZCBudWdnZXQiOwpuZXdOdWdnZXRCdXR0b24ubnVnZ2V0UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnXSA9IHRydWU7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRNYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLmltcGxlbWVudE51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKZGVzdHJveSh0aGlzQm90KTtgOwoKZm9yIChsZXQgbnVncyA9IDA7IG51Z3MgPCB0aGF0Lm51Z2dldC5sZW5ndGg7IG51Z3MrKykKewogICAgbGV0IGN1cnJlbnROdWdnZXQgPSB0aGF0Lm51Z2dldFtudWdzXTsKICAgIC8vbGV0IGJ1dHRvbkNoZWNrID0gY3JlYXRlZEJ1dHRvbnMuaW5kZXhPZihjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwoKICAgIGlmICghY3VycmVudE51Z2dldCB8fCBjdXJyZW50TnVnZ2V0ID09IHVuZGVmaW5lZCkgLy98fCBidXR0b25DaGVjayAhPSAtMQogICAgewogICAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChjdXJyZW50TnVnZ2V0Lm51Z1B1Ymxpc2gpCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLnBhY2thZ2VOdWdnZXQoe2JvdDogdGFncy50YXJnZXRCb3QsIG51Z2dldDogdGFncy50YXJnZXROdWdnZXQsIHRhZzogdGFncy50YXJnZXRUYWd9KTsKCiAgICAgICAgZGVzdHJveSh0aGlzQm90KTtgOwoKICAgICAgICBuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAicHVibGlzaCAiICsgY3VycmVudE51Z2dldC5udWdOYW1lICsgIiBudWdnZXQiOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CgogICAgbmV3TnVnZ2V0QnV0dG9uLnRhcmdldE51Z2dldCA9IGN1cnJlbnROdWdnZXQubnVnTmFtZTsKICAgIG5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnICsgIlN0YXJ0Il0gPSBjdXJyZW50TnVnZ2V0Lm51Z1N0YXJ0OwoKICAgIGNyZWF0ZShuZXdOdWdnZXRCdXR0b24pOwoKICAgIC8vY3JlYXRlZEJ1dHRvbnMucHVzaChjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwp9CgpyZXR1cm47JwCL/5ibCr5gC251Z2dldFBhcnNlAgQAi/+YmwqxeqcPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwCL/5ibCr5gDW9uQUJQdWJsaXNoZWQCBACL/5ibCtmJAcEBQGNvbnNvbGUubG9nKHRoYXQuYWIsIHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQoKaWYgKHRoYXQuYWIgPT0gdGFncy5udWdnZXRUb1B1Ymxpc2gpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgcHVibGlzaGVkIik7CgogICAgbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gbnVsbDsKCiAgICBjb25maWdCb3QubWFza3MuYWJWZXJzaW9uID0gbnVsbDsKfScAi/+Ymwq+YBBvbkFueUJvdHNDaGFuZ2VkAgQAi/+YmwqbiwG3BEBpZiAoY29uZmlnQm90ICYmIHRoYXRbMF0uYm90LmlkICE9IHRoaXNCb3QuaWQpIAp7CiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QpIHJldHVybjsgLy8gSWdub3JlIGlmIHRoZSBjb25maWdCb3QgaXNuJ3QgcmVhZHkgeWV0LgoKICAgIGNvbnN0IGVkaXRlZEJvdElEID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdC5yZXBsYWNlKCLwn5SXIiwgIiIpOwoKICAgIGlmICghdGhhdC5maW5kKHggPT4geC5ib3QuaWQgPT0gZWRpdGVkQm90SUQpKSByZXR1cm47IC8vIElmIHRoZSBib3QgY2hhbmdlZCB3YXNuJ3QgYmVpbmcgZWRpdGVkIGJ5IHRoZSB1c2VyIGlnbm9yZSBpdC4KCiAgICBjb25zdCBlZGl0ZWRUYWcgPSBjb25maWdCb3QudGFncy5lZGl0aW5nVGFnOwogICAgY29uc3QgZWRpdGVkQm90ID0gZ2V0Qm90KCJpZCIsIGVkaXRlZEJvdElEKTsKCiAgICBpZiAoZWRpdGVkQm90ICYmIGVkaXRlZFRhZykgCiAgICB7CiAgICAgICAgc2hvdXQoIm51Z2dldFJlc2V0Iik7CgogICAgICAgIHRoaXNCb3QubnVnZ2V0UGFyc2UoeyBlZGl0ZWRCb3QsIGVkaXRlZFRhZyB9KTsKICAgIH0KfScAi/+Ymwq+YAhvbkNyZWF0ZQIEAIv/mJsK0Y8BTEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnAIv/mJsKvmANcGFja2FnZU51Z2dldAIEAIv/mJsKnpAB+AZAY29uc3QgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKY29uc3QgdGFnVGV4dCA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddOwoKaWYgKGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXggfHwgY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXgpCnsKICAgIGxldCBzdGFydFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXg7CiAgICBsZXQgZW5kUG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXg7CgogICAgaWYgKHN0YXJ0UG9zID09IGVuZFBvcykKICAgIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlIGlmIChzdGFydFBvcyA+IGVuZFBvcykKICAgIHsKICAgICAgICBsZXQgbmV3U3RhcnRQb3MgPSBlbmRQb3M7CiAgICAgICAgbGV0IG5ld0VuZFBvcyA9IHN0YXJ0UG9zOwoKICAgICAgICBzdGFydFBvcyA9IG5ld1N0YXJ0UG9zOwogICAgICAgIGVuZFBvcyA9IG5ld0VuZFBvczsKICAgIH0KCiAgICBsZXQgZGF0YSA9IHRhZ1RleHQuc3Vic3RyaW5nKHN0YXJ0UG9zLCBlbmRQb3MgKyAxKTsKCiAgICBzaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogdGhhdC5udWdnZXQsIGRhdGE6IGRhdGF9KTsKCiAgICBvcy50b2FzdCgibnVnIGlzIHB1Ymxpc2hpbmciLCAxMCk7CgogICAgbGV0IHRhcmdldE51ZyA9ICIubnVnIHsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgiY2Fubm90IHJlYWQgbnVnZ2V0IHRvIGJlIHB1Ymxpc2hlZCIpCn0nAIv/mJsKvmAIcmVtZW1iZXICBACL/5ibCpeXASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCL/5ibCr5gBnNlYXJjaAIEAIv/mJsKvpcBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAIv/mJsKvmAFc3RvcmUCBACL/5ibCuWXASjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCL/5ibCr5gCWxpc3RlbmluZwIEAIv/mJsKjJgBBWZhbHNlJwCL/5ibCr5gCWFiVmVyc2lvbgIEAIv/mJsKkpgBBTEwLjI3JwEEYm90cyRiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IBJwCL/5ibCpiYARlhYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yAgQAi/+YmwqZmAHODEBjb25zdCB7CiAgICBsYWJlbCA9IGAke2FiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX0gaXMgd29ya2luZ2AsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9CgpsZXQgYnVzeUluZGljYXRvciA9IHsKICAgIG9uUG9pbnRlclVwOiBudWxsLAogICAgb25Qb2ludGVyRG93bjogbnVsbCwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBidXN5TGFiZWw6IGxhYmVsLAogICAgbGFiZWxBbGlnbm1lbnQ6ICdsZWZ0JywKICAgIHN0YXRlOiAwLAogICAgYW5pbVN0YXRlczogWwogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcnLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICBdLAogICAgYW5pbVJhdGU6IDUwMCwKICAgIG9uQm90QWRkZWQ6IGBACiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIG9uQm90Q2hhbmdlZDogYEAKICAgICAgICBjb25zdCBuZWVkUmVmcmVzaCA9IHRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2J1c3lMYWJlbCcgfHwgdCA9PT0gJ3N0YXRlJyB8fCB0ID09PSAnYW5pbVN0YXRlcycpOwogICAgICAgIGlmIChuZWVkUmVmcmVzaCkgewogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfQogICAgYCwKICAgIHJlZnJlc2hEaXNwbGF5OiBgQAogICAgICAgIGlmICh0YWdzLmFuaW1TdGF0ZXMgJiYgdGFncy5hbmltU3RhdGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgYW5pbVN0YXRlID0gdGFncy5hbmltU3RhdGVzW3RhZ3Muc3RhdGVdOwoKICAgICAgICAgICAgdGFncy5sYWJlbCA9IHRhZ3MuYnVzeUxhYmVsLnRyaW0oKSArIGFuaW1TdGF0ZS5lbGxpcHNpczsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGFuaW1TdGF0ZS5mb3JtQWRkcmVzczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLmxhYmVsIAogICAgICAgIH0KICAgIGAsCiAgICBhbmltYXRlOiBgQAogICAgICAgIGlmICh0YWdzLnN0YXRlID49IHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgKz0gMTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLnNsZWVwKHRhZ3MuYW5pbVJhdGUpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIC4uLnJlc3QKfTsKCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihidXN5SW5kaWNhdG9yKTsKCnJldHVybiBtZW51Qm90OycAi/+YmwqYmAEGc3lzdGVtAgQAi/+YmwropAERYWIuaW50ZXJmYWNlLm1lbnUnAIv/mJsKmJgBBGZvcm0CBACL/5ibCvqkAQdub3RoaW5nJwCL/5ibCpiYAQtkZXNjcmlwdGlvbgIEAIv/mJsKgqUBJlRoaXMgc2tpbGwgaXMgZGVzaWduZWQgZm9yIG1lbnUgc3R1ZmYuKACL/5ibCpiYAQthYkludGVyZmFjZQF4JwCL/5ibCpiYAQphYk9wZW5NZW51AgQAi/+YmwqqpQG6HEBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBtZW51VHlwZSA9IHRoYXQgPyAiYWIiICsgdGhhdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoYXQuc2xpY2UoMSkgKyAiTWVudSI6ICJhYkNvcmVNZW51IjsgLy9zZXQgdXAgYSBjaGVjayB0byBzZWUgd2hhdCB0eXBlIG9mIG1lbnUgc2hvdWxkIGJlIG9jY3VyaW5nIFtjb3JlLCBib3QsIGdyaWQsIGluc3RdCmxldCBtZW51U2tpbGxzID0gZ2V0Qm90cyhtZW51VHlwZSArICJBY3Rpb24iKTsKbGV0IG1heE9wdGlvbnMgPSBtZW51VHlwZSA9PSAiaW5zdCIgPyA3IDogNTsKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5wZXJzb25hbGl0eSA9IHRhZ3MucGVyc29uYWxpdHk7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5iYXNlU2tpbGwuJHttZW51VHlwZSArICJBY3Rpb24ifSh7Ym90OiB0aGlzQm90fSk7YDsKCmxldCBzb3J0T3JkZXJJbmRleCA9IG1lbnVTa2lsbHMubGVuZ3RoOwpmb3IgKGxldCBpID0gMDsgaSA8IG1lbnVTa2lsbHMubGVuZ3RoOyBpKyspLy9BREQgTE9HSUMgRk9SIE1PUkUgT1BUSU9OUyBUSEFOIDUgOiBtYXhPcHRpb25zCnsKICAgIC8vQWxsb3dzIGZvciBjb2RlIHRvIGdldCBjYWxsZWQgYmVmb3JlIHRoZSBtZW51IGdlbmVyYXRlcywgdXNlZnVsIGZvciBkeW5hbWljYWxseSBzZXQgZ3JvdXBzIG9yIGRyb3Bkb3ducwogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJPbkJlZm9yZUNyZWF0ZSJdKSB7CiAgICAgICAgYXdhaXQgd2hpc3BlcihtZW51U2tpbGxzW2ldLCBtZW51VHlwZSArICJPbkJlZm9yZUNyZWF0ZSIpOwogICAgfSAKCiAgICBpZiAobWVudVNraWxsc1tpXS50YWdzW21lbnVUeXBlICsgIkhpZGUiXSkgewogICAgICAgIGNvbnRpbnVlOwogICAgfQogICAgCiAgICBsZXQgY3VycmVudFNraWxsID0gbWVudVNraWxsc1tpXTsKCiAgICBhYk1lbnVCdXR0b24uYmFzZVNraWxsID0gIvCflJciICsgY3VycmVudFNraWxsLmlkOwogICAgYWJNZW51QnV0dG9uLmxhYmVsID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiTGFiZWwiXTsKICAgIGFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkljb24iXTsKICAgIGFiTWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIk9uR2VuZXJhdGUiXTsKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJTb3J0T3JkZXIiXTsKICAgIGFiTWVudUJ1dHRvbi5jb2xvciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkNvbG9yIl0gPyBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdIDogbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7CgogICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImRyb3Bkb3duIikgewogICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93bk9wdGlvbnMgPSBjdXJyZW50U2tpbGwudGFncy5kcm9wZG93bk9wdGlvbnM7CiAgICAKICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiRGVmYXVsdE9wZW4iXSA9PSB0cnVlKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbiA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGVsZXRlIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbjsKICAgICAgICB9CgogICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5kcm9wZG93blNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiZ3JvdXAiKSB7CiAgICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5ncm91cFNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmdyb3VwU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmdyb3VwU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIGFiTWVudUJ1dHRvbi5tZW51SXRlbXMgPSBjdXJyZW50U2tpbGwudGFncy5tZW51SXRlbXM7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVHcm91cChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJpbnB1dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gInRleHQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gInRvb2wiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUb29sKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gIndpemFyZCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOwogICAgfQp9Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJPcGVuTWVudScsIHsgbWVudTogdGhhdCwgbWVudVR5cGUsIG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsIH0pOycAi/+YmwqYmAESYWJDcmVhdGVNZW51QnV0dG9uAgQAi/+YmwrjwQH4DUBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9OwoKbGV0IHsKICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwKICAgIC4uLmFkZGl0aW9uYWxUYWdzCn0gPSB0aGF0ID8/IHt9CgppZiAodHlwZW9mIG1lbnVJdGVtU3R5bGUgPT0gJ3N0cmluZycpIHsKICAgIG1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbVN0eWxlLnJlcGxhY2UoL1x1ezFGOUVDfS91LCAnJyk7IAogICAgbWVudUl0ZW1TdHlsZSA9IEpTT04ucGFyc2UobWVudUl0ZW1TdHlsZSk7Cn0KCmZ1bmN0aW9uIGhhc0JvcmRlclN0eWxlKCkgewogICAgaWYgKG1lbnVJdGVtU3R5bGVbImJvcmRlci10b3Atc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItbGVmdC1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1ib3R0b20tc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItcmlnaHQtc3R5bGUiXSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdKSB7CiAgICBpZiAoYWRkaXRpb25hbFRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJNZW51R3JvdXAiXSkgewoKICAgIH0KfQoKbmV3TWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdNZW51QnV0dG9uLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7Cm5ld01lbnVCdXR0b24ubGFiZWxDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7Cm5ld01lbnVCdXR0b24uc2hhZG93Q29sb3IgPSB0aGF0LnNoYWRvd0NvbG9yID8/IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU2hhZG93Q29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLnNjYWxlWSA9IDE7Cgpjb25zdCBtZW51U3R5bGluZyA9IHsKICAgICJib3JkZXItcmFkaXVzIjoiOHB4IiwKICAgICJtYXJnaW4tdG9wIjogIjhweCIsCiAgICAiYm94LXNoYWRvdyI6IGAzcHggNHB4ICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIm1pbi1oZWlnaHQiOiAiNDRweCIsCiAgICAiYm9yZGVyIjogaGFzQm9yZGVyU3R5bGUoKSA/ICIiIDogYDJweCBzb2xpZCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJ3aWR0aCI6ICJjYWxjKDEwMCUgLSA1cHgpIiwKICAgIC4uLm1lbnVJdGVtU3R5bGUKfQoKbmV3TWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gbWVudVN0eWxpbmc7Cgpjb25zdCBjbGlja2VkU3R5bGluZyA9IHsKICAgIC4uLm1lbnVTdHlsaW5nLAogICAgImZpbHRlciI6ICJicmlnaHRuZXNzKDYwJSkiCn0KY29uc3QgYmFzZVN0eWxlID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9ICfwn6esICR7SlNPTi5zdHJpbmdpZnkoY2xpY2tlZFN0eWxpbmcpfSdgCgpuZXdNZW51QnV0dG9uLm9uUG9pbnRlckRvd24gPSBtZW51SXRlbVN0eWxlPy5bIm1hcmdpbi10b3AiXSAhPSAiMHB4IiA/IGJhc2VTdHlsZSA6ICJAIC8vIjsKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJVcCA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsYDsKCmZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQp7CiAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOwp9CgpuZXdNZW51QnV0dG9uID0gY3JlYXRlKG5ld01lbnVCdXR0b24pOwoKcmV0dXJuIG5ld01lbnVCdXR0b247JwCL/5ibCpiYAQ1hYk1lbnVSZWZyZXNoAgQAi/+YmwrazwGdAUBpZiAoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbD8uc3Vic3RyaW5nKDAsMikgPT0gImFiIikKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKICAgIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKICAgIG1hc2tzLm9uS2V5RG93biA9IG51bGw7Cn0nAIv/mJsKmJgBCHJlbWVtYmVyAgQAi/+Ymwr40AEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAi/+YmwqYmAENbWFuaWZlc3RhdGlvbgIEAIv/mJsKn9EBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAIv/mJsKmJgBEWFiRW52aXJvbm1lbnRNZW51AgQAi/+YmwrG0QG6N0BzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5wZXJzb25hbGl0eSA9IHRhZ3MucGVyc29uYWxpdHk7CmFiTWVudUJ1dHRvbi5sZWFybiA9IHRhZ3MubGVhcm47Cgpjb25zdCBhYkVudmlyb25tZW50T3B0aW9ucyA9IHRoaXNCb3QuYWJHZXRFbnZpcm9ubWVudE9wdGlvbnMoKTsKCmJ1dHRvbkxvb3A6CmZvciAobGV0IGkgPSAwOyBpIDwgYWJFbnZpcm9ubWVudE9wdGlvbnMubGVuZ3RoOyBpKyspCnsKICAgIGxldCBhY3RpdmVCdXR0b24gPSBhYkVudmlyb25tZW50T3B0aW9uc1tpXTsKCiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gYWN0aXZlQnV0dG9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOwoKICAgIGlmIChhY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudEdhdGUpCiAgICB7CiAgICAgICAgaWYgKCFsaW5rc1thY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudEdhdGVdKQogICAgICAgIHsKICAgICAgICAgICAgY29udGludWUgYnV0dG9uTG9vcDsKICAgICAgICB9CiAgICB9CgogICAgbGV0IG5ld0J1dHRvbkRhdGEgPSB7Li4uYWJNZW51QnV0dG9uLCAuLi5hY3RpdmVCdXR0b259OwoKICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld0J1dHRvbkRhdGEpOwp9Cgpjb25zdCBhYlBlcnNvbmFsaXR5Q29uZmlnQnV0dG9uID0gewogICAgbGFiZWw6ICJjdXN0b21pemU6IGFiIHBlcnNvbmFsaXR5IiwKICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgIGFiTWVudVNvcnRPcmRlcjogMSwKICAgIGRyb3Bkb3duU29ydE9yZGVyOiAxLAogICAgZHJvcGRvd25PcHRpb25zOiBbCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYG5hbWU6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImN1YmUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LCB7dGl0bGU6ICd3aGF0IHdvdWxkIHlvdSBsaWtlIHRvIGNhbGwgbWU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge25hbWU6IG5hbWV9KTsgCiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGFpIG1vZGVsOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGFpTW9kZWxzID0gbGlua3MucmVtZW1iZXIudGFncy5haU1vZGVsczsKCiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zID0gW107CgogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb21wYW55R3JvdXAgb2YgYWlNb2RlbHMpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1vZGVsRW50cnkgb2YgY29tcGFueUdyb3VwLm1vZGVscykgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goeyBsYWJlbDogbW9kZWxFbnRyeS5tb2RlbCwgdmFsdWU6IG1vZGVsRW50cnkubW9kZWwgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRNb2RlbEluZGV4ID0gb3B0aW9ucy5maW5kSW5kZXgobyA9PiBvLnZhbHVlID09PSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCk7CgogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQoY3VycmVudE1vZGVsSW5kZXgsIHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3doYXQgYWkgbW9kZWwgd291bGQgeW91IGxpa2UgbWUgdG8gdXNlPycsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2xpc3QnLAogICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBvcHRpb25zLAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkT3B0aW9uICYmIHNlbGVjdGVkT3B0aW9uLnZhbHVlICE9PSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCkgewogICAgICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHthaU1vZGVsOiBzZWxlY3RlZE9wdGlvbi52YWx1ZX0pOyAKICAgICAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBtZSB0byBiZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7Y29sb3I6IGNvbG9yfSk7IAogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnVzIHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51Q29sb3I6IGNvbG9yfSk7IAogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTtgLAogICAgICAgICAgICAgICAgLy9saW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yID0gY29sb3I7IGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yICE9ICdjbGVhcicpe2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgPSBjb2xvcn07IGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IHRleHQgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51IHRleHQgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVMYWJlbENvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICAgICAgICAgIC8vbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvciA9IGNvbG9yOyBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciAhPSAnY2xlYXInKXtsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yID0gY29sb3J9OyBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBwb3J0YWwgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGxldCBwb3J0YWxDb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyAnIzI2MzIzOCcsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgeW91ciBwb3J0YWwgdG8gbG9vayBsaWtlPyd9KTsKICAgICAgICAgICAgICAgIGlmICghcG9ydGFsQ29sb3IpIHsKICAgICAgICAgICAgICAgICAgICBwb3J0YWxDb2xvciA9ICcjMjYzMjM4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsncG9ydGFsQ29sb3InOiBwb3J0YWxDb2xvcn0pOyAKICAgICAgICAgICAgICAgIC8vZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBtYXAgcG9ydGFsIGJhc2VtYXBgLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBzaG91dCgic2hvd0FCQmFzZW1hcE9wdGlvbnMiKTsKICAgICAgICAgICAgYAogICAgICAgIH0sCiAgICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJkZWZhdWx0IHNldHRpbmdzIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICAgICAgICAgIGNvbG9yOiAncmVkJywKICAgICAgICAgICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsnZGVmYXVsdFBlcnNvbmFsaXR5JzogdHJ1ZX0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogIm1lbnUgY29sb3IiLAogICAgICAgIC8vICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgIC8vICAgICAgb25DbGljazogYEAgCiAgICAgICAgLy8gICAgICAgICBjb25zdCBtZW51Q29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQoYWJQZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvciwge3RpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51J3MgdG8gYmU/J30pOwogICAgICAgIC8vICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVDb2xvcjogbWVudUNvbG9yfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIC8vIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogInByb21wdCIsCiAgICAgICAgLy8gICAgIG9uQ2xpY2s6IGBAYCwKICAgICAgICAvLyB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJmb3JtIiwKICAgICAgICAvLyAgICAgb25DbGljazogYEAgCiAgICAgICAgLy8gICAgICAgICBjb25zdCBmb3JtID0gYXdhaXQgb3Muc2hvd0lucHV0KGFiUGVyc29uYWxpdHkudGFncy5hYkZvcm0sIHt0aXRsZTogJ3doYXQgZm9ybSB3b3VsZCB5b3UgbGlrZSBtZSB0byB0YWtlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHtmb3JtOiBmb3JtfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIC8vIH0KICAgIF0KfQoKdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bihhYlBlcnNvbmFsaXR5Q29uZmlnQnV0dG9uKTsKCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAogICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwpgOwp0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACiAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewogICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CiAgICB9CmA7CgpzaG91dCgnb25BQkVudmlyb25tZW50TWVudScsIHsgbWVudVBvcnRhbDogY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbH0gKScAi/+YmwqYmAEFbGVhcm4CBACL/5ibCoGJAijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCL/5ibCpiYAQNncHQCBACL/5ibCqiJAijwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCL/5ibCpiYAQhhYklnbm9yZQIEAIv/mJsKz4kCBHRydWUnAIv/mJsKmJgBBnNlYXJjaAIEAIv/mJsK1IkCKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAIv/mJsKmJgBBm51Z2dldAIEAIv/mJsK+4kCKPCflJc0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYnAIv/mJsKmJgBBXRlc3RzAgQAi/+YmwqiigIo8J+Ul2I4M2Q5NzJiLTA1MzUtNDA1MS1iNTg5LTQxY2VkYTg1MzVmMScAi/+YmwqYmAEPb25Qb3J0YWxDaGFuZ2VkAgQAi/+YmwrJigJuQGlmICh0aGF0LnBvcnRhbCA9PSAic3lzdGVtUG9ydGFsIiAmJiAhdGhhdC5kaW1lbnNpb24gJiYgIWxpbmtzLnRlc3RzKQp7CiAgICBsaW5rcy5sZWFybi5hYkFkYXB0KCJhYlRlc3RzIik7Cn0nAIv/mJsKmJgBA2FzawIEAIv/mJsKuIsCKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAIv/mJsKmJgBCWFiVmVyc2lvbgIEAIv/mJsK34sCBTEwLjI3JwCL/5ibCpiYARFhYkNyZWF0ZU1lbnVJbnB1dAIEAIv/mJsK5YsCngJAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudUlucHV0ID0gew0KICAgIGZvcm06ICJpbnB1dCIsDQogICAgbWVudUl0ZW1TaG93U3VibWl0V2hlbkVtcHR5OiBmYWxzZSwNCiAgICBmb3JtSW5wdXRNdWx0aWxpbmU6IG51bGwsDQogICAgb25Qb2ludGVyVXA6IG51bGwsDQogICAgb25Qb2ludGVyRG93bjogbnVsbCwNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUlucHV0KTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCL/5ibCpiYARBhYkNyZWF0ZU1lbnVUZXh0AgQAi/+YmwqEjgKBBEBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmNvbnN0IHsNCiAgICBtZW51SXRlbUxhYmVsU3R5bGUsDQogICAgLi4ucmVzdA0KfSA9IHRoYXQ7DQoNCmxldCBtZW51VGV4dCA9IHsNCiAgICBmb3JtOiAidGV4dCIsDQogICAgb25Qb2ludGVyVXA6IG51bGwsDQogICAgb25Qb2ludGVyRG93bjogbnVsbCwNCiAgICBwb2ludGFibGU6IGZhbHNlLA0KICAgIGNvbG9yOiAid2hpdGUiLA0KICAgIG1lbnVJdGVtU3R5bGU6IHsNCiAgICAgICAgInBhZGRpbmctdG9wIjogIjZweCIsDQogICAgICAgICJwYWRkaW5nLWJvdHRvbSI6ICI2cHgiLA0KICAgIH0sDQogICAgbWVudUl0ZW1MYWJlbFN0eWxlOiB7DQogICAgICAgICJ3aGl0ZS1zcGFjZSI6ICJwcmUtd3JhcCIsDQogICAgICAgIC4uLm1lbnVJdGVtTGFiZWxTdHlsZSwNCiAgICB9LA0KICAgIC4uLnJlc3QNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51VGV4dCk7DQoNCnJldHVybiBtZW51Qm90OycAi/+YmwqYmAEQYWJDcmVhdGVNZW51VG9vbAIEAIv/mJsKhpICjgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVRvb2wgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUb29sKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCL/5ibCpiYARJhYkNyZWF0ZU1lbnVXaXphcmQCBACL/5ibCpWTApIBQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVXaXphcmQgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVXaXphcmQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAIv/mJsKmJgBFGFiQ3JlYXRlTWVudURyb3Bkb3duAgQAi/+YmwqolAK6HEBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICghdGhhdC5kcm9wZG93blNvcnRPcmRlcikgew0KICAgIHRocm93IG5ldyBFcnJvcihgYWJDcmVhdGVNZW51RHJvcGRvd246IGRyb3Bkb3duU29ydE9yZGVyIGlzIG5vdCBwcm92aWRlZC5gKTsNCn0NCg0KbGV0IG91dGVyTWVudUJ1dHRvbiA9IHsNCiAgICAuLi50aGF0LA0KICAgIGZvcm1BZGRyZXNzOiB0aGF0LmZvcm1BZGRyZXNzID8/ICJhcnJvd19yaWdodCIsDQogICAgZHJvcGRvd25PcGVuOiBmYWxzZSwNCiAgICBvbkNsaWNrOiBgQA0KICAgICAgICB0YWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSAke3RoYXQuZHJvcGRvd25Tb3J0T3JkZXJ9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucykgew0KICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKHRhZ3MuZHJvcGRvd25PcHRpb25zLCB0YWdzLmRyb3Bkb3duU29ydE9yZGVyKTsNCiAgICAgICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICBgLA0KICAgIG9uRGVzdHJveTogYEANCiAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICBgLA0KICAgIG9uUG9pbnRlclVwOiBgQA0KICAgICAgICBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbDsNCiAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICBtYXNrcy5mb3JtQWRkcmVzcyA9ICJhcnJvd19yaWdodCI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IGZhbHNlKSB7DQogICAgICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJmb3JtQWRkcmVzcyIsICJhcnJvd19kcm9wX2Rvd24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgIm1lbnVJdGVtU3R5bGUiLCB7Li4udGFncy5tZW51SXRlbVN0eWxlLCAiYm9yZGVyQm90dG9tTGVmdFJhZGl1cyI6ICIwIiwgImJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzIjogIjAifSk7DQogICAgICAgIH0NCiAgICBgLA0KICAgIG9uQm90Q2hhbmdlZDogYEANCiAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygnZHJvcGRvd25PcGVuJykgJiYgdGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgc2hvdXQoImFiTWVudURyb3Bkb3duT3BlbmVkIiwgdGhpc0JvdCk7DQogICAgICAgIH0NCiAgICBgLA0KICAgIGFiTWVudURyb3Bkb3duT3BlbmVkOiBgQA0KICAgICAgICBpZiAodGhhdCAhPSB0aGlzQm90KSB7DQogICAgICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSBmYWxzZTsNCiAgICAgICAgICAgIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsOw0KICAgICAgICB9DQogICAgYA0KfTsNCg0KaWYgKHRoYXQuZm9ybUFkZHJlc3MgJiYgdGhhdC5mb3JtQWRkcmVzcyAhPSAiYXJyb3dfcmlnaHQiKSB7DQogICAgb3V0ZXJNZW51QnV0dG9uLmN1c3RvbUZvcm1BZGRyZXNzID0gdHJ1ZTsNCn0NCm91dGVyTWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gdGhhdC5kcm9wZG93blNvcnRPcmRlcjsNCg0KY29uc3QgbWVudUJvdCA9IGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG91dGVyTWVudUJ1dHRvbik7DQptZW51Qm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyA9IGdlbmVyYXRlTWVudU9wdGlvbnM7DQoNCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlTWVudU9wdGlvbnMgKG9wdGlvbnMsIHNvcnRPcmRlcikgew0KICAgIGNvbnN0IG1lbnVCb3RzID0gW107DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgKytpKSB7DQoNCiAgICAgICAgbGV0IG5ld01lbnVCdXR0b24gPSB7DQogICAgICAgICAgICAuLi5vcHRpb25zW2ldLA0KICAgICAgICAgICAgY2xlYXJEcm9wZG93bk1lbnU6IGBADQogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsNCiAgICAgICAgICAgIGANCiAgICAgICAgfTsNCg0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSBOdW1iZXIoc29ydE9yZGVyKSArICgoaSArIDEpIC8gMTAwMCk7DQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbF0gPSB0cnVlOw0KDQogICAgICAgIGlmIChpID09IG9wdGlvbnMubGVuZ3RoIC0gMSkgew0KICAgICAgICAgICAgaWYgKG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyUmFkaXVzIl0gPSAiMCAwIDhweCA4cHgiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAgMCA4cHggOHB4Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyUmFkaXVzIl0gPSAiMCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclRvcCJdID0gIm5vbmUiOw0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bIm1hcmdpblRvcCJdID0gIjAiOw0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bInBhZGRpbmdMZWZ0Il0gPSAiMzVweCI7DQoNCiAgICAgICAgY29uc3QgbmV3TWVudUJvdCA9IGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld01lbnVCdXR0b24pOw0KICAgICAgICBtZW51Qm90cy5wdXNoKG5ld01lbnVCb3QpOw0KICAgIH0NCg0KICAgIG1lbnVCb3QudGFncy5tZW51Qm90cyA9IGdldExpbmsobWVudUJvdHMpOw0KfQ0KDQppZiAodGhhdC5kZWZhdWx0T3Blbikgew0KICAgIG1lbnVCb3Qub25Qb2ludGVyVXAoKTsNCiAgICBtZW51Qm90Lm9uQ2xpY2soKTsNCn0NCg0KcmV0dXJuIG1lbnVCb3Q7DQoNCicAi/+YmwqYmAERYWJDcmVhdGVNZW51R3JvdXACBACL/5ibCuOwAr0fQC8qDQogICBFWEFNUExFDQogICBjb25zdCBtZW51R3JvdXAgPSB7DQogICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGdyb3VwU29ydE9yZGVyOiAxLA0KICAgICAgICBtZW51SXRlbXM6IFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDIiLA0KICAgICAgICAgICAgICAgIGNvbG9yOiAib3JhbmdlIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICBtZW51SXRlbVR5cGU6ICJkcm9wZG93biIsDQogICAgICAgICAgICAgICAgZHJvcGRvd25PcHRpb25zOiBbDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDEiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMyIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICB9DQogICAgICAgIF0NCiAgICB9DQoqLw0KDQppZiAgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAoIXRoYXQuZ3JvdXBTb3J0T3JkZXIpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudUdyb3VwOiBncm91cFNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCB7DQogICAgbWVudUl0ZW1TdHlsZSA9IHt9LA0KICAgIG1lbnVJdGVtcyA9IFtdLA0KICAgIC4uLmFkZGl0aW9uYWxUYWdzDQp9ID0gdGhhdCA/PyB7fQ0KDQpjb25zdCBtZW51Qm90cyA9IFtdOw0KZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51SXRlbXMubGVuZ3RoOyArK2kpIHsNCg0KICAgIGxldCBuZXdNZW51QnV0dG9uID0ge307DQoNCiAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSBOdW1iZXIodGhhdC5ncm91cFNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMCk7DQoNCiAgICBsZXQgaW5kaXZNZW51SXRlbVN0eWxlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtU3R5bGUgPz8ge307DQogICAgbGV0IGluZGl2TWVudVR5cGUgPSBtZW51SXRlbXNbaV0ubWVudUl0ZW1UeXBlID8/IHVuZGVmaW5lZDsNCiAgICBsZXQgaW5kaXZBZGRpdGlvbmFsVGFncyA9IG1lbnVJdGVtc1tpXTsNCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgIGRlbGV0ZSBpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVN0eWxlIl07DQogICAgfQ0KICAgIGlmIChpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVR5cGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl07DQogICAgfQ0KDQogICAgY29uc3QgYmFzZVN0eWxpbmcgPSB7DQogICAgICAgICJib3JkZXJUb3AiOiAibm9uZSIsDQogICAgICAgICJtYXJnaW5Ub3AiOiAiMCINCiAgICB9DQoNCiAgICBpZiAoaSA9PSBtZW51SXRlbXMubGVuZ3RoIC0gMSAmJiBpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQogICAgZWxzZSBpZiAoaSA9PSBtZW51SXRlbXMubGVuZ3RoIC0gMSkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLmJhc2VTdHlsaW5nLA0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICIwIDAgOHB4IDhweCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9IGVsc2UgaWYgKGkgPT0gMCkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiOHB4IDhweCAwIDAiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7fQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLmJhc2VTdHlsaW5nLA0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICIwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQ0KICAgIHsNCiAgICAgICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBpbmRpdkFkZGl0aW9uYWxUYWdzKQ0KICAgIHsNCiAgICAgICAgbmV3TWVudUJ1dHRvblt0YWddID0gaW5kaXZBZGRpdGlvbmFsVGFnc1t0YWddOw0KICAgIH0NCg0KICAgIGxldCBuZXdNZW51Qm90Ow0KICAgIHN3aXRjaChpbmRpdk1lbnVUeXBlKSB7DQogICAgICAgIGNhc2UgImRyb3Bkb3duIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLi4ubmV3TWVudUJ1dHRvbiwNCiAgICAgICAgICAgICAgICAgICAgImRyb3Bkb3duU29ydE9yZGVyIjogTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMCkNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJpbnB1dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ0ZXh0IjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidG9vbCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUb29sKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgIndpemFyZCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgIH0NCiAgICBtZW51Qm90cy5wdXNoKG5ld01lbnVCb3QpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdHM7JwCL/5ibCpiYAQtwZXJzb25hbGl0eQIEAIv/mJsKodACKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAIv/mJsKmJgBF2FiR2V0RW52aXJvbm1lbnRPcHRpb25zAgQAi/+YmwrI0ALBOkBjb25zdCBvcHRpb25zID0gW107CgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiBgaGlkZWAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJ2aXNpYmlsaXR5X29mZiIsCiAgICAgICAgb25DbGljazogIkAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAwCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJvcHRpbWl6ZSBtb2RlIiwKICAgIG9uQ3JlYXRlOiAiQCBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA/IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JyA6IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICBvbkNsaWNrOiAiQCBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA/IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gZmFsc2UgOiBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA9IHRydWU7IHRoaXNCb3Qub25DcmVhdGUoKTsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEKfSkKCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJzbGVlcCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJuaWdodHNfc3RheSIsCiAgICAgICAgb25DbGljazogIkBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiU2V0QXdha2UoeyBhd2FrZTogZmFsc2UgfSkiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAzCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJjaGF0IiwKICAgIGZvcm1BZGRyZXNzOiAiY2hhdCIsCiAgICBvbkNsaWNrOiAiQCBzaG91dCgnYWJDaGF0QmFyT3BlbicpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAibnVnZ2V0cyIsCiAgICBvbkNyZWF0ZTogIkAgdGFncy5udWdNYW5hZ2VyID0gZ2V0TGluayhnZXRCb3QoJ3N5c3RlbScsICdhYi5pbnRlcmZhY2UubnVnZ2V0JykpOyBpZiAobGlua3MubnVnTWFuYWdlci50YWdzLmxpc3RlbmluZyl7dGFncy5vbkNsaWNrID0gYEAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIG51bGwpO2A7dGFncy5mb3JtQWRkcmVzcyA9IGBjaGVja19ib3hgO31lbHNleyAgICB0YWdzLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgdHJ1ZSwgJ2xvY2FsJyk7YDsgICAgdGFncy5mb3JtQWRkcmVzcyA9IGBjaGVja19ib3hfb3V0bGluZV9ibGFua2A7fSIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNQp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGFiRW52aXJvbm1lbnRHYXRlOiAiZ3B0IiwKICAgIG9uQ3JlYXRlOiAiQCAgaWYgKCFhdXRoQm90KXtkZXN0cm95KHRoaXNCb3QpO31lbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAnRnJlZVBsYXknIHx8IGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09IHVuZGVmaW5lZCl7ZGVzdHJveSh0aGlzQm90KTt9OyB0YWdzLmxhYmVsID0gJ2VkaXQgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIHByb21wdCc7IHRhZ3MuZ3B0Qm90ID0gZ2V0TGluayhnZXRCb3QoJ3N5c3RlbScsICdhYi5hY3Rpb24uYXNrJykpOyIsCiAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICBvbkNsaWNrOiAiQCBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNwp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiZ3JpZCBzbmFwIiwKICAgIG9uQ3JlYXRlOiAiQCB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayciLAogICAgb25DbGljazogIkAgbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGU7dGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogOAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiYm90IHNuYXAiLAogICAgb25DcmVhdGU6ICJAIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICBvbkNsaWNrOiAiQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogOQp9KQoKaWYgKGF1dGhCb3QpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJhY2NvdW50IiwKICAgICAgICBmb3JtQWRkcmVzczogImJhZGdlIiwKICAgICAgICBvbkNsaWNrOiAiQCBvcy5zaG93QWNjb3VudEluZm8oKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMAogICAgfSkKfQoKaWYgKGxpbmtzLnRlc3RzKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgICAgIGxhYmVsOiAicmVjb3JkIHRlc3QiLAogICAgICAgIGZvcm1BZGRyZXNzOiAic2NpZW5jZSIsCiAgICAgICAgb25LZXlEb3duOiAiQCAiLAogICAgICAgIG9uS2V5VXA6ICJAICIsCiAgICAgICAgb25DbGljazogIkAgbGV0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCdrZXlib2FyZCcsICdTaGlmdCcpO2xldCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7c2hvdXQoJ2FiUmVjb3JkVGVzdCcpO3Nob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTEKICAgIH0pCgogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBhYkVudmlyb25tZW50R2F0ZTogInRlc3RzIiwKICAgICAgICBsYWJlbDogInJlY29yZCB0cmFjZSIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJ0aW1lbGluZSIsCiAgICAgICAgb25LZXlEb3duOiAiQCAiLAogICAgICAgIG9uS2V5VXA6ICJAICIsCiAgICAgICAgb25DbGljazogIkAgbGV0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCdrZXlib2FyZCcsICdTaGlmdCcpO2xldCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7c2hvdXQoJ2FiUmVjb3JkVHJhY2UnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEyCiAgICB9KQp9CgppZiAoZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaG9tZS5lZ2ciKSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBhYkVudmlyb25tZW50R2F0ZTogInRlc3RzIiwKICAgICAgICBsYWJlbDogInNhdmUgaG9tZSBlZ2ciLAogICAgICAgIGZvcm1BZGRyZXNzOiAiZWdnIiwKICAgICAgICBvbktleURvd246ICJAICIsCiAgICAgICAgb25LZXlVcDogIkAgIiwKICAgICAgICBvbkNsaWNrOiBgQGdldEJvdCgic3lzdGVtIiwgImFiLmhvbWUuZWdnIikuc2F2ZURhdGEoKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEzCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJjaGVjayBmb3IgIiArIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIHVwZGF0ZXMiLAogICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgIGxlYXJuOiB0YWdzLmxlYXJuLAogICAgb25LZXlEb3duOiAiQCAiLAogICAgb25LZXlVcDogIkAgIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxNCwKICAgIGNoZWNrRm9yVXBkYXRlczogYEAKICAgICAgICAvLyBUZW1wb3JhcmlseSByZXBsYWNlIHdpdGggYnVzeSBpbmRpY2F0b3Igd2hpbGUgY2hlY2tpbmcgZm9yIHVwZGF0ZXMuCiAgICAgICAgdGFncy5hYk1lbnUgPSBmYWxzZTsKCiAgICAgICAgdGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IgPSBhYi5saW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3IoewogICAgICAgICAgICBhYk1lbnU6IHRydWUsCiAgICAgICAgICAgIGxhYmVsOiAnY2hlY2tpbmcgZm9yIHVwZGF0ZXMgdG8gJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgYWJNZW51U29ydE9yZGVyOiB0YWdzLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyLAogICAgICAgIH0pOwoKICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjayA9IGF3YWl0IGFiLmFiQ2hlY2tBQlVwZGF0ZUF2YWlsYWJsZSh7IGRldGFpbGVkOiB0cnVlIH0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpOwogICAgICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IG51bGw7CgogICAgICAgICAgICAvLyBCcmluZyBiYWNrIHRoZSB1cGRhdGUgYnV0dG9uLgogICAgICAgICAgICB0YWdzLmFiTWVudSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sgJiYgdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2suc3VjY2VzcykgeyAgICAKICAgICAgICAgICAgaWYgKGdsb2JhbFRoaXMuYWJVcGRhdGVDaGVja2VyKSB7CiAgICAgICAgICAgICAgICBhYlVwZGF0ZUNoZWNrZXIudGFncy51cGRhdGVBdmFpbGFibGUgPSB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay51cGRhdGVBdmFpbGFibGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay51cGRhdGVBdmFpbGFibGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFiRmlsZXNXaXRoVXBkYXRlcyA9IHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLmFiRmlsZUNoZWNrcy5maWx0ZXIoZiA9PiBmLnVwZGF0ZUF2YWlsYWJsZSk7CgogICAgICAgICAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVXBkYXRlcyBmb3VuZCBmb3IgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnVGhlcmUgYXJlICcgKyBhYkZpbGVzV2l0aFVwZGF0ZXMubGVuZ3RoICsgJyBmaWxlIHVwZGF0ZXMgZm9yICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnLiBXb3VsZCB5b3UgbGlrZSB0byBpbnN0YWxsIHRoZSB1cGRhdGVzIG5vdz8gWW91IGFuZCBhbnkgY29ubmVjdGVkIHVzZXJzIHdpbGwgYXV0b21hdGljYWxseSByZWZyZXNoIHRoZSBwYWdlIGFmdGVyIHRoZSB1cGRhdGUgaXMgY29tcGxldGUuJywKICAgICAgICAgICAgICAgICAgICBjYW5jZWxUZXh0OiAnTm90IG5vdycsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybVRleHQ6ICdZZXMnCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgICAgICAgICBsaW5rcy5sZWFybi51cGRhdGVBQigpOyAKICAgICAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWIubGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdChhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIGlzIGFscmVhZHkgdXAtdG8tZGF0ZSEnKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1hc2tzLmxhYmVsID0gJ3VwZGF0ZSBjaGVjayBmYWlsZWQnOwogICAgICAgIH0KICAgIGAsCiAgICBvbkNsaWNrOiBgQAogICAgICAgIHRoaXNCb3QuY2hlY2tGb3JVcGRhdGVzKCk7CiAgICBgLAogICAgb25EZXN0cm95OiBgQAogICAgICAgIGlmICh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcikgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICB9CiAgICBgLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIG9uQ3JlYXRlOiBgQAogICAgICAgIHRhZ3MubGFiZWwgPSAicGVybWFuZW50bHkgZGVsZXRlICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwogICAgICAgIHRhZ3MuY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbnRyYXN0Q29sb3IgPz8gIiNEOTMwMzAiOwogICAgYCwKICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgb25DbGljazogYEAKICAgICAgICBjb25zdCBjb25maXJtZWQgPSBhd2FpdCBvcy5zaG93Q29uZmlybSh7CiAgICAgICAgICAgIHRpdGxlOiAnUGVybWFuZW50bHkgZGVsZXRlICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICBjb250ZW50OiAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSAnICsgIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIGZyb20gJyArIGxpbmtzLmxlYXJuLnRhZ3MuYWJJbnN0ICsgJz8gVGhpcyBpcyBub3QgcmV2ZXJzaWJsZSEnLAogICAgICAgIH0pCgogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CgogICAgICAgIGNvbnN0IGFiQm90cyA9IGdldEJvdHMoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbSAmJgogICAgICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0uc3RhcnRzV2l0aCgnYWInKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGNvbmZpcm1lZCkgewogICAgICAgICAgICBkZXN0cm95KGFiQm90cyk7CiAgICAgICAgfQogICAgYCwKICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAwCn0pCgpyZXR1cm4gb3B0aW9uczsnAIv/mJsKmJgBHmFiQ3JlYXRlVG9vbGJveERyb3Bkb3duT3B0aW9ucwIEAIv/mJsKiosD4xNAY29uc3QgdG9vbGJveFRvb2xzID0gWy4uLnRoYXQudG9vbEFycmF5XSA/PyBbXTsNCmNvbnN0IHRvb2xib3hOYW1lID0gdGhhdC50b29sYm94TmFtZSA/PyAiS2l0ICI7DQpjb25zdCB0b29sYm94ID0gdGhhdC50b29sYm94Ow0KY29uc3QgZ3JpZEluZm9ybWF0aW9uID0gKHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiAmJiB0aGF0Py5ncmlkSW5mb3JtYXRpb24gIT0gdW5kZWZpbmVkKSA/IHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiA6IGFiUmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsNCg0KY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy50b29sYm94ID0gZ2V0TGluayh0b29sYm94KTsNCm1lbnVPcHRpb25zLmdyaWRJbmZvcm1hdGlvbiA9IGdyaWRJbmZvcm1hdGlvbjsNCm1lbnVPcHRpb25zLnNlYXJjaCA9IHRhZ3Muc2VhcmNoOw0KbWVudU9wdGlvbnMuYXJ0aWZhY3QgPSB0YWdzLmFydGlmYWN0Ow0KLy9tZW51T3B0aW9ucy5mb3JtQWRkcmVzcyA9ICJoYXJkd2FyZSI7DQoNCmlmICh0b29sYm94VG9vbHMubGVuZ3RoID09PSAwKSB7DQogICAgY29uc3QgbWVzc2FnZSA9IHRvb2xib3hOYW1lICsgIiBkb2VzIG5vdCBoYXZlIGFueSB0b29scyBsaXN0ZWQgaW4gdGhlIHRvb2xfYXJyYXkgdGFnIjsNCg0KICAgIGFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgbWVzc2FnZSk7DQogICAgb3MudG9hc3QobWVzc2FnZSwgNSk7DQogICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsNCn0NCg0KZm9yIChsZXQgdG9vbCBvZiB0b29sYm94VG9vbHMpIHsNCiAgICBjb25zdCB0b29sQnV0dG9uID0gew0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgbGFiZWw6IHRvb2wubmFtZSwNCiAgICAgICAgdGFyZ2V0QUI6IHRvb2wudGFyZ2V0QUIsDQogICAgICAgIGlzQXJ0aWZhY3Q6IHRvb2wuYXJ0aWZhY3QgfHwgZmFsc2UsDQogICAgICAgIG9uQ2xpY2s6YEANCiAgICAgICAgICAgIGlmICh0YWdzLmlzQXJ0aWZhY3QpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBhYkFydGlmYWN0U2hhcmQgPSB7DQogICAgICAgICAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiB0YWdzLnRvb2xib3gsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB0YWdzLmdyaWRJbmZvcm1hdGlvbg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXM6IFsNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc2tJRDogdGFncy50YXJnZXRBQg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBsaW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0UHJvbWlzZUJvdCh7DQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3ROYW1lOiB0YWdzLnRhcmdldEFCLA0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0SW5zdGFuY2VJRDogdXVpZCgpLA0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0U2hhcmQsDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQXNrSUQoew0KICAgICAgICAgICAgICAgICAgICBhc2tJRDogdGFncy50YXJnZXRBQiwNCiAgICAgICAgICAgICAgICAgICAgc291cmNlRXZlbnQ6ICd0b29sJywNCiAgICAgICAgICAgICAgICAgICAgZWdnUGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJveEJvdDogdGFncy50b29sYm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB0YWdzLmdyaWRJbmZvcm1hdGlvbg0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICB9DQogICAgICAgIGAsDQogICAgfTsNCg0KICAgIGlmICh0b29sLmZvcm1BZGRyZXNzKSB7DQogICAgICAgIHRvb2xCdXR0b24uZm9ybUFkZHJlc3MgPSB0b29sLmZvcm1BZGRyZXNzOw0KICAgIH0NCg0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHRvb2xCdXR0b24pOw0KfQ0KDQpyZXR1cm4gZHJvcGRvd25PcHRpb25zOycAi/+YmwqYmAEQb25BQkF1dGhCb3RBZGRlZAIEAIv/mJsK7p4DGEBzaG91dCgnYWJNZW51UmVmcmVzaCcpOycAi/+YmwqYmAEIYXJ0aWZhY3QCBACL/5ibCoefAyjwn5SXNzhlNDE1MDMtYzkzMy00ZjhhLTgxN2EtYmE5N2JmOGQ1ZDI3JwEEYm90cyRjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcBJwCL/5ibCq6fAwhhYklnbm9yZQIEAIv/mJsKr58DBHRydWUnAIv/mJsKrp8DC2FiSW50ZXJmYWNlAgQAi/+Ymwq0nwMEdHJ1ZScAi/+YmwqunwMGc3lzdGVtAgQAi/+Ymwq5nwMYYWIuaW50ZXJmYWNlLmJvdF9mYWN0b3J5JwCL/5ibCq6fAxZhYkNyZWF0ZUJpbGxib2FyZExhYmVsAgQAi/+YmwrSnwONRUBsZXQgeyAKICAgIGJvdCwKICAgIGRpbWVuc2lvbiwKICAgIHByZXNlcnZlTmV3TGluZXMgPSB0cnVlLAogICAgbGFiZWwgPSAnJywKICAgIHNwYWNlID0gJ3RlbXBMb2NhbCcsCiAgICBjb2xvciA9ICd3aGl0ZScsCiAgICBsYWJlbENvbG9yID0gJ2JsYWNrJywKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge307CgppZiAodHlwZW9mIGxhYmVsICE9PSAnc3RyaW5nJykgewogICAgbGFiZWwgPSBTdHJpbmcobGFiZWwpOwp9Cgphc3NlcnQobGlua3MudXRpbHMuaXNCb3QoYm90KSwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3QgaXMgYSByZXF1aXJlZCBCb3QgcGFyYW1ldGVyLmApOwphc3NlcnQoZGltZW5zaW9uLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRpbWVuc2lvbiBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKYXNzZXJ0KHJlc3Qub25DcmVhdGUgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25BbnlCb3RzQ2hhbmdlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkFueUJvdHNSZW1vdmVkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LnVwZGF0ZUxhYmVsID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LmxhYmVsV29yZFdyYXBNb2RlID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbGFiZWxXb3JkV3JhcE1vZGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CgovLyAtLS0gMSkgV29yZCBicmVha2luZyAod3JhcCBieSB3b3JkcywgY2h1bmsgbG9uZyB3b3JkcykgLS0tCmZ1bmN0aW9uIGJyZWFrV29yZHNUb0xpbmVzKHRleHQsIG1heENvbHMgPSAxOCkgewogICAgaWYgKCF0ZXh0KSByZXR1cm4gWycnXTsKICAgIGNvbnN0IHdvcmRzID0gdGV4dC5zcGxpdCgvXHMrLykuZmlsdGVyKEJvb2xlYW4pOwogICAgY29uc3QgbGluZXMgPSBbXTsKICAgIGxldCBsaW5lID0gJyc7CgogICAgY29uc3QgcHVzaCA9ICgpID0+IHsgbGluZXMucHVzaChsaW5lKTsgbGluZSA9ICcnOyB9OwoKICAgIGZvciAoY29uc3QgdyBvZiB3b3JkcykgewogICAgICAgIGlmICh3Lmxlbmd0aCA+IG1heENvbHMpIHsKICAgICAgICAgICAgLy8gY2xvc2UgY3VycmVudCBsaW5lIChpZiBhbnkpIGJlZm9yZSBjaHVua2luZyBhIGxvbmcgd29yZAogICAgICAgICAgICBpZiAobGluZSkgcHVzaCgpOwogICAgICAgICAgICAvLyBjaHVuayB0aGUgbG9uZyB3b3JkCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdy5sZW5ndGg7IGkgKz0gbWF4Q29scykgewogICAgICAgICAgICAgICAgbGluZXMucHVzaCh3LnNsaWNlKGksIGkgKyBtYXhDb2xzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZSA9ICcnOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgewogICAgICAgICAgICBsaW5lID0gdzsKICAgICAgICB9IGVsc2UgaWYgKGxpbmUubGVuZ3RoICsgMSArIHcubGVuZ3RoIDw9IG1heENvbHMpIHsKICAgICAgICAgICAgbGluZSArPSAnICcgKyB3OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHB1c2goKTsKICAgICAgICAgICAgbGluZSA9IHc7CiAgICAgICAgfQogICAgfQogICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoKCk7CgogICAgcmV0dXJuIGxpbmVzLmxlbmd0aCA/IGxpbmVzIDogWycnXTsKfQoKLy8gUHJlc2VydmVzIGV4aXN0aW5nIFxuIGFzIGhhcmQgYnJlYWtzOyB3cmFwcyB3aXRoaW4gZWFjaCBoYXJkIGxpbmUuCmZ1bmN0aW9uIGJyZWFrV29yZHNUb0xpbmVzUHJlc2VydmVOZXdsaW5lcyh0ZXh0LCBtYXhDb2xzID0gMTgpIHsKICBpZiAodGV4dCA9PSBudWxsKSByZXR1cm4gWycnXTsKCiAgLy8gU3BsaXQgb24gcmVhbCBuZXdsaW5lczsga2VlcCBlbXB0eSBsaW5lcyBzbyB3ZSBwcmVzZXJ2ZSBibGFuayBsaW5lcy4KICBjb25zdCBoYXJkTGluZXMgPSBTdHJpbmcodGV4dCkuc3BsaXQoL1xyP1xuLyk7CiAgY29uc3Qgb3V0ID0gW107CgogIC8vIEhlbHBlciB0byB3cmFwIGEgc2luZ2xlIGhhcmQgbGluZSBieSB3b3JkcyAod2l0aCBsb25nLXdvcmQgY2h1bmtpbmcpCiAgY29uc3Qgd3JhcE9uZSA9IChzcmMpID0+IHsKICAgIC8vIE5vcm1hbGl6ZSB0YWJzIC0+IHNwYWNlczsgY29sbGFwc2UgaW50ZXJuYWwgd2hpdGVzcGFjZSAobm90IG5ld2xpbmVzKQogICAgY29uc3QgcyA9IHNyYy5yZXBsYWNlKC9cdC9nLCAnICAgICcpLnJlcGxhY2UoL1xzKy9nLCAnICcpLnRyaW0oKTsKICAgIGlmICghcy5sZW5ndGgpIHsgb3V0LnB1c2goJycpOyByZXR1cm47IH0KCiAgICBjb25zdCB3b3JkcyA9IHMuc3BsaXQoJyAnKTsKICAgIGxldCBsaW5lID0gJyc7CgogICAgY29uc3QgcHVzaExpbmUgPSAoKSA9PiB7IG91dC5wdXNoKGxpbmUpOyBsaW5lID0gJyc7IH07CgogICAgLy8gY2h1bmsgbG9uZyB3b3JkcyB0byBlbXVsYXRlICdicmVha1dvcmRzJwogICAgY29uc3QgY2h1bmtXb3JkID0gKHcpID0+IHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3Lmxlbmd0aDsgaSArPSBtYXhDb2xzKSB7CiAgICAgICAgY29uc3QgY2h1bmsgPSB3LnNsaWNlKGksIGkgKyBtYXhDb2xzKTsKICAgICAgICBpZiAoIWxpbmUubGVuZ3RoKSBsaW5lID0gY2h1bms7CiAgICAgICAgZWxzZSB7IHB1c2hMaW5lKCk7IGxpbmUgPSBjaHVuazsgfQogICAgICB9CiAgICB9OwoKICAgIGZvciAoY29uc3QgdyBvZiB3b3JkcykgewogICAgICBpZiAody5sZW5ndGggPiBtYXhDb2xzKSB7CiAgICAgICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoTGluZSgpOwogICAgICAgIGNodW5rV29yZCh3KTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIWxpbmUubGVuZ3RoKSB7CiAgICAgICAgbGluZSA9IHc7CiAgICAgIH0gZWxzZSBpZiAobGluZS5sZW5ndGggKyAxICsgdy5sZW5ndGggPD0gbWF4Q29scykgewogICAgICAgIGxpbmUgKz0gJyAnICsgdzsKICAgICAgfSBlbHNlIHsKICAgICAgICBwdXNoTGluZSgpOwogICAgICAgIGxpbmUgPSB3OwogICAgICB9CiAgICB9CiAgICBpZiAobGluZS5sZW5ndGgpIHB1c2hMaW5lKCk7CiAgfTsKCiAgZm9yIChjb25zdCBobCBvZiBoYXJkTGluZXMpIHsKICAgIHdyYXBPbmUoaGwpOyAgICAgICAgICAgLy8gd3JhcCB3aXRoaW4gdGhpcyBoYXJkIGxpbmUKICB9CgogIC8vIElmIHRoZSBpbnB1dCBlbmRlZCB3aXRoIGEgdHJhaWxpbmcgbmV3bGluZSwgd2UgYWxyZWFkeSBwcmVzZXJ2ZWQgaXQKICAvLyBiZWNhdXNlIHNwbGl0IGtlcHQgYW4gZW1wdHkgbGFzdCBpdGVtIC0+IGJlY2FtZSBhbiBlbXB0eSB3cmFwcGVkIGxpbmUuCiAgcmV0dXJuIG91dC5sZW5ndGggPyBvdXQgOiBbJyddOwp9CgovLyAtLS0gMikgU2ltcGxlIHNpemluZyBmcm9tIGxpbmVzIC0tLQovLyBUaGluayBvZiAiY29sc1BlclNjYWxlWCIgYXMgImFib3V0IE4gY2hhcmFjdGVycyBwZXIgMSBzY2FsZVgiLgpmdW5jdGlvbiBjb21wdXRlU2ltcGxlU2NhbGVzRnJvbUxpbmVzKGxpbmVzLCB7CiAgICBjb2xzUGVyU2NhbGVYID0gMi41LAogICAgbWluU2NhbGVYID0gMS4yNSwKICAgIG1heFNjYWxlWCA9IDEwLAogICAgYmFzZVNjYWxlWSA9IDEuMiwKICAgIHBlckxpbmVZID0gMC43NSwKfSA9IHt9KSB7CiAgICBjb25zdCBsb25nZXN0ID0gbGluZXMucmVkdWNlKChtLCBsKSA9PiBNYXRoLm1heChtLCBsLmxlbmd0aCksIDApOwogICAgY29uc3QgbGluZUNvdW50ID0gTWF0aC5tYXgoMSwgbGluZXMubGVuZ3RoKTsKCiAgICAvLyBXaWR0aCBzY2FsZXMgd2l0aCB0aGUgbG9uZ2VzdCBsaW5lIGxlbmd0aAogICAgbGV0IHNjYWxlWCA9IGxvbmdlc3QgPiAwID8gKGxvbmdlc3QgLyBjb2xzUGVyU2NhbGVYKSA6IG1pblNjYWxlWDsKICAgIHNjYWxlWCA9IE1hdGgubWF4KG1pblNjYWxlWCwgTWF0aC5taW4obWF4U2NhbGVYLCBzY2FsZVgpKTsKCiAgICAvLyBIZWlnaHQgZ3Jvd3MgcGVyIGxpbmU7IGtlZXAgaXQgc2ltcGxlIGFuZCBwcmVkaWN0YWJsZQogICAgY29uc3Qgc2NhbGVZID0gTWF0aC5tYXgoYmFzZVNjYWxlWSwgYmFzZVNjYWxlWSArIChsaW5lQ291bnQgLSAxKSAqIHBlckxpbmVZKTsKCiAgICByZXR1cm4geyBzY2FsZVgsIHNjYWxlWSwgbG9uZ2VzdCwgbGluZUNvdW50IH07Cn0KCgovLyBQaWNrIHlvdXIgdGFyZ2V0ICJjb2x1bW5zIiBwZXIgbGluZSAodHdlYWsgdG8gdGFzdGUpCmNvbnN0IE1BWF9DT0xTID0gMzI7CgovLyBCcmVhayB0aGUgdGV4dCB5b3Vyc2VsZgpjb25zdCBsaW5lcyA9IHByZXNlcnZlTmV3TGluZXMgPyBicmVha1dvcmRzVG9MaW5lc1ByZXNlcnZlTmV3bGluZXMobGFiZWwsIE1BWF9DT0xTKSA6IGJyZWFrV29yZHNUb0xpbmVzKGxhYmVsLCBNQVhfQ09MUyk7CmNvbnN0IHdyYXBwZWRMYWJlbCA9IGxpbmVzLmpvaW4oJ1xuJyk7CgovLyBDb21wdXRlIHNpbXBsZSBzY2FsZXMgZnJvbSB0aGUgd3JhcHBlZCB0ZXh0CmNvbnN0IHsgc2NhbGVYLCBzY2FsZVkgfSA9IGNvbXB1dGVTaW1wbGVTY2FsZXNGcm9tTGluZXMobGluZXMpOwoKbGV0IGxhYmVsTW9kID0gewogICAgc3BhY2U6IHNwYWNlLAogICAgdHJhY2tCb3RJZDogYm90LmlkLAogICAgZm9ybTogJ3Nwcml0ZScsCiAgICBjb2xvciwKICAgIGxhYmVsOiB3cmFwcGVkTGFiZWwsCiAgICBsYWJlbENvbG9yLAogICAgbGFiZWxTaXplOiAxLAogICAgbGFiZWxQYWRkaW5nWDogMC41LAogICAgbGFiZWxXb3JkV3JhcE1vZGU6ICdub25lJywKICAgIHNjYWxlWCwgCiAgICBzY2FsZVksCiAgICBzY2FsZVo6IDAuMSwKICAgIGJvdExhYmVsTWFyZ2luOiAxLAogICAgYW5jaG9yUG9pbnQ6ICfinqHvuI8wLC0wLjUsMCcsCiAgICBvcmllbnRhdGlvbk1vZGU6ICdiaWxsYm9hcmQnLAogICAgZGltZW5zaW9uOiBkaW1lbnNpb24sCiAgICBkZWJ1ZzogZmFsc2UsCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBvbkNyZWF0ZTogYEAKICAgICAgICAvLyBXYWl0IGZvciByZXF1aXJlZCBib3RzIHRvIGJlIHJlYWR5LgogICAgICAgIGxldCB3YWl0VGltZSA9IDA7CgogICAgICAgIHdoaWxlKCFnbG9iYWxUaGlzLmFiKSB7CiAgICAgICAgICAgIGlmICh3YWl0VGltZSA+PSA1MDAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IG9zLnNsZWVwKDI1MCk7CiAgICAgICAgICAgIHdhaXRUaW1lICs9IDI1MDsKICAgICAgICB9CgogICAgICAgIHRhZ3MucmVhZHkgPSB0cnVlOwogICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgIGAsCiAgICBvbkFueUJvdHNDaGFuZ2VkOiBgQAogICAgICAgIGZvciAoY29uc3QgY2hhbmdlZCBvZiB0aGF0KSB7CiAgICAgICAgICAgIGlmIChjaGFuZ2VkLmJvdCAmJiBjaGFuZ2VkLmJvdC5pZCA9PT0gdGFncy50cmFja0JvdElkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvbmx5Um90YXRpb25UYWdzID0gY2hhbmdlZC50YWdzLmV2ZXJ5KCh0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZW5kc1dpdGgoJ1JvdGF0aW9uJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25YJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25ZJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25aJykKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIG9ubHlSb3RhdGlvblRhZ3M6Jywgb25seVJvdGF0aW9uVGFncyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG9ubHlSb3RhdGlvblRhZ3MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgYCwKICAgIG9uQW55Qm90c1JlbW92ZWQ6IGBACgogICAgICAgIGlmICh0aGF0LmJvdElEcy5pbmNsdWRlcyh0YWdzLnRyYWNrQm90SWQpKSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgfQogICAgYCwKICAgIG9uUG9ydGFsQ2hhbmdlZDogYEAKICAgICAgICBpZiAodGhhdC5kaW1lbnNpb24gPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgICAgICB9CiAgICBgLAogICAgdXBkYXRlTGFiZWw6IGBACiAgICAgICAgaWYgKCF0YWdzLnJlYWR5KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JpbmcgdXBkYXRlTGFiZWwgYmVjYXVzZSBub3QgcmVhZHknKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGhhc0xhYmVsID0gdGFncy5sYWJlbCAhPSBudWxsICYmIHRhZ3MubGFiZWwgIT09ICcnOwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gaGFzTGFiZWw7CgogICAgICAgIGlmICghaGFzTGFiZWwpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JlIHVwZGF0ZUxhYmVsIGNhbGwsIHRoZXJlIGlzIG5vIGxhYmVsIHRhZyB2YWx1ZSB0byBkaXNwbGF5LicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBpbk1hcFBvcnRhbCA9IChjb25maWdCb3QudGFncy5tYXBQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBjb25zdCBpbkdyaWRQb3J0YWwgPSAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKCFpbk1hcFBvcnRhbCAmJiAhaW5HcmlkUG9ydGFsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yZSB1cGRhdGVMYWJlbCBjYWxsLCBub3QgaW4gZWl0aGVyIGdyaWQgb3IgbWFwIHBvcnRhbC4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCB0cmFja0JvdCA9IGdldEJvdCgnaWQnLCB0YWdzLnRyYWNrQm90SWQpOwogICAgICAgIGNvbnN0IHRyYWNrUG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbih0cmFja0JvdCwgdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIHRyYWNrUG9zaXRpb246JywgdHJhY2tQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICBsZXQgbGFiZWxQb3NpdGlvbiA9IHsgeDogdHJhY2tQb3NpdGlvbi54LCB5OiB0cmFja1Bvc2l0aW9uLnksIHo6IHRyYWNrUG9zaXRpb24ueiB9OyAKCiAgICAgICAgY29uc3QgdHJhY2tCb3RTY2FsZSA9IHRyYWNrQm90LnRhZ3Muc2NhbGUgPz8gMTsKICAgICAgICBjb25zdCB0cmFja0JvdFNjYWxlWiA9IHRyYWNrQm90LnRhZ3Muc2NhbGVaID8/IDE7CgogICAgICAgIGxldCBtZXRlcnNQZXJHcmlkVW5pdCA9IDE7CgogICAgICAgIGlmIChpbk1hcFBvcnRhbCkgewogICAgICAgICAgICAvLyBTY2FsZSB0byBtYXAgcG9ydGFsIHVuaXRzLgogICAgICAgICAgICBtZXRlcnNQZXJHcmlkVW5pdCA9IDEwOwogICAgICAgIH0KCiAgICAgICAgbGV0IHRyYWNrQm90UmVhbFNjYWxlWiA9ICh0cmFja0JvdFNjYWxlWiAqIHRyYWNrQm90U2NhbGUpICogbWV0ZXJzUGVyR3JpZFVuaXQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gdHJhY2tCb3RSZWFsU2NhbGVaOicsIHRyYWNrQm90UmVhbFNjYWxlWik7CiAgICAgICAgfQoKICAgICAgICBsYWJlbFBvc2l0aW9uLnogKz0gdHJhY2tCb3RSZWFsU2NhbGVaICsgKHRhZ3MuYm90TGFiZWxNYXJnaW4gKiBtZXRlcnNQZXJHcmlkVW5pdCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gbGFiZWxQb3NpdGlvbjonLCBsYWJlbFBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWCddID0gbGFiZWxQb3NpdGlvbi54OwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWSddID0gbGFiZWxQb3NpdGlvbi55OwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWiddID0gbGFiZWxQb3NpdGlvbi56OwogICAgYAp9OwoKbGFiZWxNb2QgPSB7CiAgICAuLi5sYWJlbE1vZCwKICAgIC4uLnJlc3QsCn0KCmNvbnN0IGxhYmVsQm90ID0gY3JlYXRlKGxhYmVsTW9kKTsKCnJldHVybiBsYWJlbEJvdDsnAIv/mJsKrp8DBXV0aWxzAgQAi/+Ymwrc5AMo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAi/+YmwqunwMEZm9ybQIEAIv/mJsKg+UDB25vdGhpbmcnAIv/mJsKrp8DCWFiVmVyc2lvbgIEAIv/mJsKi+UDBTEwLjI3AA=="}]}