{"version":2,"updates":[{"id":0,"timestamp":1765824842594,"update":"Ae4BqLDc0AcAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwCosNzQBwAKYWJJRE9yaWdpbgIEAKiw3NAHAQ10b29sYm94X3NraWxsJwCosNzQBwALYWJJbnRlcmZhY2UCBACosNzQBw8EdHJ1ZScAqLDc0AcAC2Rlc2NyaXB0aW9uAgQAqLDc0AcUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwCosNzQBwAEZm9ybQIEAKiw3NAHPgdub3RoaW5nJwCosNzQBwAEbWVudQIEAKiw3NAHRijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCosNzQBwAGc3lzdGVtAgQAqLDc0AdtFGFiLmludGVyZmFjZS50b29sYm94JwCosNzQBwAKYWJJRFN0dWRpbwIEAKiw3NAHggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwCosNzQBwAIcmVtZW1iZXICBACosNzQB6cBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAKiw3NAHAAt0b29sYm94X2FkZAIEAKiw3NAHzgHIC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgiYmFzZVNraWxsIiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIG1lbnVCb3Qub25Qb2ludGVyVXAoKTsKICAgICAgICBtZW51Qm90Lm9uQ2xpY2soKTsKICAgIH0KfQplbHNlIGlmIChhY3RpdmVUb29sYm94ICYmIGFjdGl2ZVRvb2xib3gudGFncy5hYkdyaWRNZW51QWN0aW9uKSB7CiAgICBhY3RpdmVUb29sYm94LmFiR3JpZE1lbnVBY3Rpb24oeyBncmlkSW5mb3JtYXRpb246IGdyaWREYXRhIH0pOwp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiQ29yZU1lbnVBY3Rpb24pIHsKICAgIC8vUkVGUkVTSCBBTkQgVEhFTiBPUEVOPz8/Cn0nAKiw3NAHAAVsZWFybgIEAKiw3NAHlw0o8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAqLDc0AcABXN0b3JlAgQAqLDc0Ae+DSjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCosNzQBwAGc2VhcmNoAgQAqLDc0AflDSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCosNzQBwAIYWJJZ25vcmUCBACosNzQB4wOBHRydWUnAKiw3NAHAAlhYlZlcnNpb24CBACosNzQB5EOBTEwLjM1JwCosNzQBwANbWFuaWZlc3RhdGlvbgIEAKiw3NAHlw4o8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAqLDc0AcAEGFiR3JpZE1lbnVBY3Rpb24CBACosNzQB74OuQtALy8gc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCi8vIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgovLyB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKLy8gICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKLy8gYDsKLy8gdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAovLyAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKLy8gICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwovLyAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyAgICAgfQovLyBgOwovLyB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBgQAovLyAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBudWxsOwovLyBgOwoKLy8gY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7Ci8vIGNvbnN0IG1lbnVCb3QgPSB7fTsKCi8vIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsKLy8gbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwovLyBtZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKLy8gbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKLy8gbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsKLy8gbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwovLyBtZW51Qm90Lm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsKCi8vIGZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspCi8vIHsKLy8gICAgIGNvbnN0IGFjdGl2ZVRvb2xib3ggPSBwb3NzaWJsZVRvb2xib3hlc1tpXTsKLy8gICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7CgovLyAgICAgbWVudUJvdC50b29sYm94X2RhdGEgPSBhY3RpdmVUb29sYm94OwovLyAgICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOwoKLy8gICAgIGlmICghZXh0YW50Qm90KQovLyAgICAgewovLyAgICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCb3QpOwovLyAgICAgfQovLyB9JwCosNzQBwAUYWJHcmlkTWVudU9uR2VuZXJhdGUCBACosNzQB/gZ4gJAY29uc3QgdG9vbGJveEFycmF5ID0gYWJSZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7CgpsZXQgYWxsVG9vbHNMb2FkZWQgPSB0cnVlOwoKZm9yIChsZXQgaSA9IDA7IGkgPCB0b29sYm94QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IGN1cnJlbnRUb29sID0gdG9vbGJveEFycmF5W2ldLm5hbWU7CgogICAgaWYgKCFnZXRCb3QoImFiSURPcmlnaW4iLCBjdXJyZW50VG9vbCkgJiYgIWdldEJvdChjdXJyZW50VG9vbCwgdHJ1ZSkpIHsKICAgICAgICBhbGxUb29sc0xvYWRlZCA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgfQp9CgppZiAoYWxsVG9vbHNMb2FkZWQpIHsKICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAKiw3NAHAA5hYkdyaWRNZW51SWNvbgIEAKiw3NAH2xwKbG9jYWxfbWFsbCcAqLDc0AcAD2FiR3JpZE1lbnVMYWJlbAIEAKiw3NAH5hwHY2F0YWxvZycAqLDc0AcAE2FiR3JpZE1lbnVTb3J0T3JkZXICBACosNzQB+4cAzEwMCcAqLDc0AcAD29uQUJJbml0aWFsaXplZAIEAKiw3NAH8hwqQC8vIGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7JwCosNzQBwANb25Ta2lsbFVwZGF0ZQIEAKiw3NAHnR1XQGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7DQoNCmNvbnNvbGUubG9nKCJbVG9vbGJveF0gTG9hZGluZyBjYXN1YWwga2l0Iik7JwCosNzQBwAKc2hlbGxVdGlscwIEAKiw3NAH9R0o8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAqLDc0AcAGGFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZQIEAKiw3NAHnB7UCUBpZiAoYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkNhdGFsb2dOYW1lKSB7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJHcmlkTWVudUxhYmVsIiwgYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkNhdGFsb2dOYW1lKTsNCn0NCg0KDQovL05FVw0KY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IHBvc3NpYmxlVG9vbGJveGVzID0gbGlua3MucmVtZW1iZXIudGFncy50b29sYm94X2FycmF5Ow0KDQpmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlVG9vbGJveGVzLmxlbmd0aDsgaSsrKQ0Kew0KICAgIGNvbnN0IG1lbnVCb3QgPSB7fTsNCg0KICAgIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsNCiAgICBtZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQogICAgbWVudUJvdC5ncmlkRGF0YSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQogICAgbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsNCiAgICBtZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOw0KICAgIG1lbnVCb3QubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsNCiAgICBtZW51Qm90Lm9uQ2xpY2sgPSBgQCANCiAgICAgICAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyANCiAgICAgICAgc2V0VGFnTWFzayhhYi5saW5rcy5yZW1lbWJlciwgImxhc3RPcGVuZWREcm9wZG93biIsIG51bGwpOw0KICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7DQogICAgDQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7DQogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOw0KDQogICAgaWYgKCFleHRhbnRCb3QpDQogICAgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtZW51Qm90KTsNCiAgICB9DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAqLDc0AcAEmFiR3JpZE1lbnVJdGVtVHlwZQIEAKiw3NAH8ScIZHJvcGRvd24nAKiw3NAHABFkcm9wZG93blNvcnRPcmRlcgIEAKiw3NAH+icDMTAwJwCosNzQBwAPZHJvcGRvd25PcHRpb25zAgQAqLDc0Af+Jwbwn6esW10nAQRib3RzJDE3NDEwZDgzLTdlZWUtNGExZS1iNjM4LTY1NDYzNzRkMTdjMwEnAKiw3NAHgygGc3lzdGVtAgQAqLDc0AeEKBFhYi5pbnRlcmZhY2Uuc2NhbicAqLDc0AeDKARmb3JtAgQAqLDc0AeWKAdub3RoaW5nJwCosNzQB4MoC2FiSW50ZXJmYWNlAgQAqLDc0AeeKAR0cnVlJwCosNzQB4MoCGFiSWdub3JlAgQAqLDc0AejKAR0cnVlJwCosNzQB4MoD29uUVJDb2RlU2Nhbm5lZAIEAKiw3NAHqCj9D0BpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBzY2FubmVkICIgKyB0aGF0KTsKCmxldCByZXF1ZXN0aW5nQUkgPSBmYWxzZTsKaWYgKGNvbmZpZ0JvdC50YWdzLnJlcXVlc3RpbmdBSSkgewogICAgY29uZmlnQm90LnRhZ3MucmVxdWVzdGluZ0FJID0gbnVsbDsKICAgIHJlcXVlc3RpbmdBSSA9IHRydWU7Cn0KCmlmIChjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbikKewogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGlua3Muc3RvcmUuYWJRUlB1Ymxpc2godGhhdCk7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuKQp7CiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICBjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4gPSBudWxsOwoKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIHRyeQogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CgogICAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IHBoQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoInBoIik7CiAgICBsZXQgaW5zdENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJpbnN0Iik7CiAgICBsZXQgYWJDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiYWIiKTsKICAgIGxldCBjd0NoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJjdyIpOwoKICAgIGlmIChwaENoZWNrICYmIGluc3RDaGVjayAmJiBhYkNoZWNrICYmIGN3Q2hlY2spCiAgICB7CiAgICAgICAgb3MuZ29Ub1VSTCh0aGF0KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBvcy50b2FzdCgibm90IGEgcmVjb2duaXplZCBwcmFjdGljZSBwZXJtaXQiKTsKICAgIH0KCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLmFiU2NhbikKewogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBjb25maWdCb3QudGFncy5hYlNjYW4gPSBudWxsOwogICAgCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICB0cnkgCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7CiAgICB9CiAgICBjYXRjaCAoZSkgCiAgICB7CiAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiB0aGF0fSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZihzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFzayIpID09ICJlZ2dDYXJ0b24iKQogICAgewogICAgICAgIGlmIChyZXF1ZXN0aW5nQUkpIHsKICAgICAgICAgICAgc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJyZXF1ZXN0aW5nQUkiLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgb3MuZ29Ub1VSTChzY2FubmVkVVJMLmhyZWYpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5hc2spIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hc2t9KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5wYXR0ZXJufSk7CiAgICAgICAgfQogICAgICAgIAogICAgfQp9JwCosNzQB4MoBXN0b3JlAgQAqLDc0AemOCjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCosNzQB4MoBnNlYXJjaAIEAKiw3NAHzTgo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAqLDc0AeDKBBhYkNvcmVNZW51QWN0aW9uAgQAqLDc0Af0ODdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwCosNzQB4MoD2FiQ29yZU1lbnVMYWJlbAIEAKiw3NAHrDkEc2NhbicAqLDc0AeDKA5hYkNvcmVNZW51SWNvbgIEAKiw3NAHsTkPcXJfY29kZV9zY2FubmVyJwCosNzQB4MoE2FiQ29yZU1lbnVTb3J0T3JkZXICBACosNzQB8E5ATMnAKiw3NAHgygJYWJWZXJzaW9uAgQAqLDc0AfDOQUxMC4zNScBBGJvdHMkM2E2Y2I5Y2EtYjNiNC00ZDc3LTgyZjYtZmE1OWI1Mjk2ZWM5AScAqLDc0AfJOQZzeXN0ZW0CBACosNzQB8o5F2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwCosNzQB8k5CGFiSWdub3JlAgQAqLDc0AfiOQR0cnVlJwCosNzQB8k5D2Ryb3Bkb3duT3B0aW9ucwIEAKiw3NAH5zkG8J+nrFtdJwCosNzQB8k5EmFiQ29yZU1lbnVJdGVtVHlwZQIEAKiw3NAH7DkIZHJvcGRvd24nAKiw3NAHyTkRZHJvcGRvd25Tb3J0T3JkZXICBACosNzQB/U5BGF1dG8nAKiw3NAHyTkYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQAqLDc0Af6Of4gQGNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCmNvbnN0IGN1cnJlbnRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyAibWFwIiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT0gImJsdWVwcmludCIgPyAiYmx1ZXByaW50IiA6ImdyaWQiOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCi8vIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQovLyB9IGVsc2Ugew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCi8vIH0NCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTmF2aWdhdGlvbk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCg0KY29uc3QgaG9tZVdvcmxkQnV0dG9uID0gew0KICAgIC4uLm1lbnVPcHRpb25zLA0KICAgIGxhYmVsOiAiaG9tZSB3b3JsZCIsDQogICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvMzhhZThiNjk1N2Y0NDgzZDg3MTYxNDFkMWU5OGM5M2YwZTdkY2NlMTViYzVjMTIzYmQwZTllMWFiNjg3Y2MwNS5wbmcnLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIGNvbnN0IGN1cnJlbnRVUkwgPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCk7DQogICAgICAgIGNvbnN0IG9yaWdpbiA9IGN1cnJlbnRVUkwub3JpZ2luOw0KDQogICAgICAgIGxldCBuZXdVUkwgPSBuZXcgVVJMKG9yaWdpbik7DQoNCiAgICAgICAgaWYgKGFiUmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY2hhbm5lbCIsIGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb25maWdCb3QudGFncy5jb21JZCkgew0KICAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImNvbUlkIiwgY29uZmlnQm90LnRhZ3MuY29tSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm93bmVyIiwgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiAicGxheWVyIik7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJpbnN0IiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm1hcFBvcnRhbCIsICdob21lJyk7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJhc2siLCAnaG9tZScpOw0KICAgICAgICANCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgew0KICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgic3R1ZGlvIiwgdGhhdC5pZCk7IA0KICAgICAgICB9DQoNCiAgICAgICAgb3Mub3BlblVSTChuZXdVUkwuaHJlZik7DQogICAgYA0KfTsNCg0KaWYgKCFnZXRCb3QoImlzSG9tZVdvcmxkQ29yZSIsIHRydWUpICYmIGF1dGhCb3QpIHsNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lV29ybGRCdXR0b24pOw0KfQ0KDQppZiAoY3VycmVudFBvcnRhbCA9PSAnbWFwJykgew0KDQogICAgY29uc3QgaG9tZUJhc2VCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQoNCiAgICBpZiAoaG9tZUJhc2VCb3QpIHsNCiAgICAgICAgY29uc3QgaG9tZUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhvbWVCYXNlQm90LnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1L2NkMzhhZmZjMDYwNGJlYWE1ODhkYTIxYWExYmU3NTBiYjNlNzNiM2IzY2FlMjNlYjMwMzA3YzM0NDk0NDU5ZjMucG5nJywNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgY29uc3QgaG9tZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBpZiAoaG9tZUJvdCkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGhvbWVCb3QsIHsgem9vbTogMjAwMCB9KS5jYXRjaCgoKSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZUJ1dHRvbik7DQogICAgfQ0KDQogICAgY29uc3QgcGxhY2VzQXJyID0gW107DQogICAgY29uc3QgcGxhY2VzID0gZ2V0Qm90cygiaG9tZVBsYWNlIiwgdHJ1ZSk7DQogICAgZm9yIChjb25zdCBoUGxhY2Ugb2YgcGxhY2VzKSB7DQogICAgICAgIGlmIChoUGxhY2UudGFncy5ob21lQmFzZSA9PSB0cnVlKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBwbGFjZU9iaiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhQbGFjZS50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2xvY2F0aW9uX29uJywNCiAgICAgICAgICAgIHBsYWNlOiBnZXRMaW5rKGhQbGFjZSksDQogICAgICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgICAgIGlmIChsaW5rcy5wbGFjZSkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGxpbmtzLnBsYWNlLCB7IHpvb206IDIwMDAgfSkuY2F0Y2goZSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICAgICAgYA0KICAgICAgICB9DQoNCiAgICAgICAgcGxhY2VzQXJyLnB1c2gocGxhY2VPYmopOw0KICAgIH0NCg0KICAgIHBsYWNlc0Fyci5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgIGNvbnN0IG5hbWVBID0gYS5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KICAgICAgICBjb25zdCBuYW1lQiA9IGIubGFiZWwudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMDsNCiAgICB9KTsNCg0KICAgIGZvciAoY29uc3Qgc29ydGVkUGxhY2Ugb2YgcGxhY2VzQXJyKSB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHNvcnRlZFBsYWNlKTsNCiAgICB9DQoNCg0KICAgIGNvbnN0IGN1cnJlbnRMb2NhdGlvbkJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiAnY3VycmVudCBsb2NhdGlvbicsDQogICAgICAgIGZvcm1BZGRyZXNzOiAnbmVhcl9tZScsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5za2lsbEJvdC5nb1RvQ3VycmVudExvY2F0aW9uKCk7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goY3VycmVudExvY2F0aW9uQnV0dG9uKTsNCn0NCg0KaWYgKGRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPT0gMCkgew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KfSBlbHNlIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAqLDc0AfJORBhYkNvcmVNZW51QWN0aW9uAgQAqLDc0Af5WgNALy8nAKiw3NAHyTkLYWJJbnRlcmZhY2UCBACosNzQB/1aBHRydWUnAKiw3NAHyTkPYWJDb3JlTWVudUxhYmVsAgQAqLDc0AeCWwlwbGFjZSBuYXYnAKiw3NAHyTkEZm9ybQIEAKiw3NAHjFsHbm90aGluZycAqLDc0AfJORNnb1RvQ3VycmVudExvY2F0aW9uAgQAqLDc0AeUW4AEQGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgb3MuZ2V0R2VvbG9jYXRpb24oKTsNCg0KaWYgKGxvY2F0aW9uLnN1Y2Nlc3MpIHsNCiAgICBjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCiAgICBjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCg0KICAgIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IGN1cnJlbnREaW07DQogICAgfQ0KDQogICAgb3MuZm9jdXNPbih7eDogbG9jYXRpb24ubG9uZ2l0dWRlLCB5OiBsb2NhdGlvbi5sYXRpdHVkZX0sIHtwb3J0YWw6ICdtYXAnLCB6b29tOiAyMDAwfSk7DQp9IGVsc2Ugew0KICAgIG9zLnRvYXN0KCJMb2NhdGlvbiBzZXJ2aWNlcyBub3QgYXZhaWxhYmxlIikNCn0nAKiw3NAHyTkJYWJWZXJzaW9uAgQAqLDc0AeVXwUxMC4zNScBBGJvdHMkNDkzZmZhNGQtNDZkNC00YTk4LWFlOWMtMTIxMmQ2NTExMzNmAScAqLDc0AebXwZzeXN0ZW0CBACosNzQB5xfFGFiLmludGVyZmFjZS52ZXJzaW9uJwCosNzQB5tfDW9uU2tpbGxVcGRhdGUCBACosNzQB7FfpwFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJJbnRlcmZhY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiSW50ZXJmYWNlTWlub3JWZXJzaW9uOw0KDQpjb25zb2xlLmxvZygiW0FCSW50ZXJmYWNlXSBMb2FkZWQgQUIgSW50ZXJmYWNlIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAqLDc0AebXxdhYkludGVyZmFjZU1ham9yVmVyc2lvbgIEAKiw3NAH2WABMicAqLDc0AebXxdhYkludGVyZmFjZU1pbm9yVmVyc2lvbgIEAKiw3NAH22ACMjcnAKiw3NAHm18IYWJJZ25vcmUCBACosNzQB95gBHRydWUnAKiw3NAHm18EZm9ybQIEAKiw3NAH42AHbm90aGluZycAqLDc0AebXwthYkludGVyZmFjZQIEAKiw3NAH62AEdHJ1ZScAqLDc0AebXwlhYlZlcnNpb24CBACosNzQB/BgBTEwLjM1JwEEYm90cyQ0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYBJwCosNzQB/ZgBnN5c3RlbQIEAKiw3NAH92ATYWIuaW50ZXJmYWNlLm51Z2dldCcAqLDc0Af2YARmb3JtAgQAqLDc0AeLYQdub3RoaW5nJwCosNzQB/ZgC2FiSW50ZXJmYWNlAgQAqLDc0AeTYQR0cnVlJwCosNzQB/ZgCGFiSWdub3JlAgQAqLDc0AeYYQR0cnVlJwCosNzQB/ZgDGFiTG9hZE51Z2dldAIEAKiw3NAHnWGYAkBsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0TmFtZTsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK251Z2dldE5hbWU7CmxldCBsb2FkZWROdWdnZXQgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGZvcm1hdHRlZE51Z2dldEFCLCBhYlZlcnNpb246IHRoYXQudmVyc2lvbiwgcmV0dXJuVHlwZTogImRhdGEifSk7Cgpsb2FkZWROdWdnZXQgPSBsb2FkZWROdWdnZXQuc3RhdGVbbnVnZ2V0TmFtZV0ubnVnZ2V0OwoKcmV0dXJuIGxvYWRlZE51Z2dldDsnAKiw3NAH9mAPYWJQdWJsaXNoTnVnZ2V0AgQAqLDc0Ae2Y4wDQC8vc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6ICJudWdOYW1lIiwgZGF0YTogZGF0YX0pOyAgQUREIEVHRyBJRCBFVkVOVFVBTExZCmxldCB0ZXN0TnVnZ2V0ID0gdGhhdC5kYXRhOwpsZXQgZm9ybWF0dGVkTnVnZ2V0ID0ge2lkOiB0aGF0Lm51ZywgbnVnZ2V0OiB0ZXN0TnVnZ2V0fTsKbGV0IHRlc3ROdWdnZXROYW1lID0gdGhhdC5udWc7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIit0ZXN0TnVnZ2V0TmFtZTsKCm1hc2tzLm51Z2dldFRvUHVibGlzaCA9IGZvcm1hdHRlZE51Z2dldEFCOwoKbGlua3Muc3RvcmUuYWJQdWJsaXNoQUIoe2FiOiBmb3JtYXR0ZWROdWdnZXRBQiwgdGFyZ2V0OiBmb3JtYXR0ZWROdWdnZXQsIHNvdXJjZUV2ZW50OiAncHVibGlzaF9udWdnZXQnfSk7JwCosNzQB/ZgD2ltcGxlbWVudE51Z2dldAIEAKiw3NAHw2axB0BsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0OwpsZXQgbnVnZ2V0VmVyc2lvbkNoZWNrID0gbnVnZ2V0TmFtZS5pbmRleE9mKCIudiIpOwpsZXQgdmVyc2lvbjsKCmlmIChudWdnZXRWZXJzaW9uQ2hlY2sgIT0gLTEpCnsKICAgIG51Z2dldE5hbWUgPSBudWdnZXROYW1lLnN1YnN0cmluZygwLCBudWdnZXRWZXJzaW9uQ2hlY2spOwoKICAgIGxldCB2ZXJzaW9uQ2hlY2sgPSB0aGF0Lm51Z2dldC5zdWJzdHJpbmcobnVnZ2V0VmVyc2lvbkNoZWNrICsgMik7CgogICAgaWYgKGlzTmFOKHZlcnNpb25DaGVjaykpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2codmVyc2lvbkNoZWNrLCAidmVyc2lvbiBpcyBub3QgYSBudW1iZXIiKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB2ZXJzaW9uID0gTnVtYmVyKHZlcnNpb25DaGVjayk7CiAgICB9Cn0KY29uc29sZS5sb2cobnVnZ2V0TmFtZSwgdmVyc2lvbik7CmxldCBudWdEYXRhID0gYXdhaXQgdGhpc0JvdC5hYkxvYWROdWdnZXQoe251Z2dldE5hbWU6IG51Z2dldE5hbWUsIHZlcnNpb246IHZlcnNpb259KTsKCmlmIChudWdEYXRhID09ICJhYklEIG5vdCBmb3VuZCIpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgbm90IGZvdW5kIik7Cn0KZWxzZQp7CiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKICAgIGxldCB0YXJnZXRUYWcgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS50b1N0cmluZygpOwogICAgbGV0IHRhcmdldE51ZyA9ICJ7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRUYWcuaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKICAgIGluc2VydFRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCBudWdEYXRhKTsKfScAqLDc0Af2YAxudWdnZXRCdXR0b24CBACosNzQB/Vt9QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnAKiw3NAH9mALbnVnZ2V0UGFyc2UCBACosNzQB+l6pw9AY29uc3Qgb3JpZ2luYWxUYWdWYWx1ZSA9IHRoYXQuZWRpdGVkQm90LnJhd1t0aGF0LmVkaXRlZFRhZ107CmxldCB0YWdWYWx1ZSA9IG9yaWdpbmFsVGFnVmFsdWU7CgppZiAoIXRhZ1ZhbHVlKSAKewogICAgcmV0dXJuOwp9CmVsc2UgaWYgKHR5cGVvZiB0YWdWYWx1ZSAhPT0gInN0cmluZyIpIAp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnRvU3RyaW5nKCk7Cn0KCmxldCBpbml0aWFsUG9zc2libGVOdWdQb3MgPSAwOwoKaWYgKGluaXRpYWxQb3NzaWJsZU51Z1BvcyA9PSAtMSkgCnsKICAgIHJldHVybjsKfQplbHNlCnsKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxQb3NzaWJsZU51Z1Bvcyk7Cn0KCmxldCBwb3NzaWJsZU51Z3MgPSBvcmlnaW5hbFRhZ1ZhbHVlLnJlcGxhY2UoL1tee10vZywgIiIpLmxlbmd0aDsKbGV0IHRvdGFsTnVnQnJlYWtzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwpsZXQgYnJlYWtMZXZlbCA9IDA7CmxldCBudWdzVG9DaGVjayA9IFtdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZU51Z3M7IGkrKykKewogICAgbGV0IGluaXRpYWxOdWdQb3MgPSB0YWdWYWx1ZS5pbmRleE9mKCJ7IikgKyAxOwogICAgbGV0IHBvc3NpYmxlTnVnRW5kID0gdGFnVmFsdWUuaW5kZXhPZigifSIpOwogICAgbGV0IHBvc3NpYmxlTnVnID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MsIHBvc3NpYmxlTnVnRW5kKTsKCiAgICBpZiAocG9zc2libGVOdWcuaW5kZXhPZigiICIpID09IC0xICYmIC9cbi9nLnRlc3QocG9zc2libGVOdWcpICE9IHRydWUgJiYgcG9zc2libGVOdWcubGVuZ3RoID4gMCAmJiBwb3NzaWJsZU51Zy5pbmRleE9mKCI6IikgPT0gLTEpCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ7Iitwb3NzaWJsZU51ZysifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwogICAgICAgIGxldCBwdWJsaXNoQ2hlY2sgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDYsIGluaXRpYWxOdWdQb3MgLSAyKTsKICAgICAgICBsZXQgbnVnUHVibGlzaCA9IG51bGw7CgogICAgICAgIGlmIChwdWJsaXNoQ2hlY2sgPT0gIi5udWciKQogICAgICAgIHsKICAgICAgICAgICAgbnVnUHVibGlzaCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgICAgICAKICAgICAgICAvL0NIRUNLIElGICQgYmVmb3JlIG51Z2dldAogICAgICAgIGlmICh0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDIsIGluaXRpYWxOdWdQb3MgLSAxKSAhPSAiJCIpCiAgICAgICAgewogICAgICAgICAgICBudWdzVG9DaGVjay5wdXNoKHtudWdOYW1lOiBwb3NzaWJsZU51ZywgbnVnU3RhcnQ6IG51Z0JyZWFrcyArIDEsIG51Z1B1Ymxpc2g6IG51Z1B1Ymxpc2h9KTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ9IikpLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CgogICAgICAgIGJyZWFrTGV2ZWwgKz0gbnVnQnJlYWtzOwoKICAgICAgICBudWdCcmVha3MgPSB0b3RhbE51Z0JyZWFrcyAtICh0b3RhbE51Z0JyZWFrcyAtIGJyZWFrTGV2ZWwpOwogICAgfQoKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKHBvc3NpYmxlTnVnRW5kICsgMSk7Cn0KCnRoaXNCb3QubnVnZ2V0QnV0dG9uKHsgbnVnZ2V0OiBudWdzVG9DaGVjaywgYm90OiB0aGF0LmVkaXRlZEJvdCwgdGFnOiB0aGF0LmVkaXRlZFRhZywgdGFnVmFsdWU6IG9yaWdpbmFsVGFnVmFsdWV9KTsnAKiw3NAH9mANb25BQlB1Ymxpc2hlZAIEAKiw3NAHkYoBwQFAY29uc29sZS5sb2codGhhdC5hYiwgdGFncy5udWdnZXRUb1B1Ymxpc2gpCgppZiAodGhhdC5hYiA9PSB0YWdzLm51Z2dldFRvUHVibGlzaCkKewogICAgb3MudG9hc3QoIm51Z2dldCBwdWJsaXNoZWQiKTsKCiAgICBtYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBudWxsOwoKICAgIGNvbmZpZ0JvdC5tYXNrcy5hYlZlcnNpb24gPSBudWxsOwp9JwCosNzQB/ZgEG9uQW55Qm90c0NoYW5nZWQCBACosNzQB9OLAbcEQGlmIChjb25maWdCb3QgJiYgdGhhdFswXS5ib3QuaWQgIT0gdGhpc0JvdC5pZCkgCnsKICAgIGlmICghY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdCkgcmV0dXJuOyAvLyBJZ25vcmUgaWYgdGhlIGNvbmZpZ0JvdCBpc24ndCByZWFkeSB5ZXQuCgogICAgY29uc3QgZWRpdGVkQm90SUQgPSBjb25maWdCb3QudGFncy5lZGl0aW5nQm90LnJlcGxhY2UoIvCflJciLCAiIik7CgogICAgaWYgKCF0aGF0LmZpbmQoeCA9PiB4LmJvdC5pZCA9PSBlZGl0ZWRCb3RJRCkpIHJldHVybjsgLy8gSWYgdGhlIGJvdCBjaGFuZ2VkIHdhc24ndCBiZWluZyBlZGl0ZWQgYnkgdGhlIHVzZXIgaWdub3JlIGl0LgoKICAgIGNvbnN0IGVkaXRlZFRhZyA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdUYWc7CiAgICBjb25zdCBlZGl0ZWRCb3QgPSBnZXRCb3QoImlkIiwgZWRpdGVkQm90SUQpOwoKICAgIGlmIChlZGl0ZWRCb3QgJiYgZWRpdGVkVGFnKSAKICAgIHsKICAgICAgICBzaG91dCgibnVnZ2V0UmVzZXQiKTsKCiAgICAgICAgdGhpc0JvdC5udWdnZXRQYXJzZSh7IGVkaXRlZEJvdCwgZWRpdGVkVGFnIH0pOwogICAgfQp9JwCosNzQB/ZgCG9uQ3JlYXRlAgQAqLDc0AeJkAFMQHRhZ3MubGlzdGVuaW5nID0gZmFsc2U7CgovL3NldFRhZ01hc2sodGhpc0JvdCwgImxpc3RlbmluZyIsIHRydWUsICJsb2NhbCIpOycAqLDc0Af2YA1wYWNrYWdlTnVnZ2V0AgQAqLDc0AfWkAH4BkBjb25zdCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwpjb25zdCB0YWdUZXh0ID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ107CgppZiAoY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleCB8fCBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleCkKewogICAgbGV0IHN0YXJ0UG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleDsKICAgIGxldCBlbmRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleDsKCiAgICBpZiAoc3RhcnRQb3MgPT0gZW5kUG9zKQogICAgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2UgaWYgKHN0YXJ0UG9zID4gZW5kUG9zKQogICAgewogICAgICAgIGxldCBuZXdTdGFydFBvcyA9IGVuZFBvczsKICAgICAgICBsZXQgbmV3RW5kUG9zID0gc3RhcnRQb3M7CgogICAgICAgIHN0YXJ0UG9zID0gbmV3U3RhcnRQb3M7CiAgICAgICAgZW5kUG9zID0gbmV3RW5kUG9zOwogICAgfQoKICAgIGxldCBkYXRhID0gdGFnVGV4dC5zdWJzdHJpbmcoc3RhcnRQb3MsIGVuZFBvcyArIDEpOwoKICAgIHNob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiB0aGF0Lm51Z2dldCwgZGF0YTogZGF0YX0pOwoKICAgIG9zLnRvYXN0KCJudWcgaXMgcHVibGlzaGluZyIsIDEwKTsKCiAgICBsZXQgdGFyZ2V0TnVnID0gIi5udWcgeyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10uaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJjYW5ub3QgcmVhZCBudWdnZXQgdG8gYmUgcHVibGlzaGVkIikKfScAqLDc0Af2YAhyZW1lbWJlcgIEAKiw3NAHz5cBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAKiw3NAH9mAGc2VhcmNoAgQAqLDc0Af2lwEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAqLDc0Af2YAVzdG9yZQIEAKiw3NAHnZgBKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAKiw3NAH9mAJbGlzdGVuaW5nAgQAqLDc0AfEmAEFZmFsc2UnAKiw3NAH9mAJYWJWZXJzaW9uAgQAqLDc0AfKmAEFMTAuMzUnAQRib3RzJGIzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYgEnAKiw3NAH0JgBGWFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3ICBACosNzQB9GYAc4MQGNvbnN0IHsKICAgIGxhYmVsID0gYCR7YWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fSBpcyB3b3JraW5nYCwKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge30KCmxldCBidXN5SW5kaWNhdG9yID0gewogICAgb25Qb2ludGVyVXA6IG51bGwsCiAgICBvblBvaW50ZXJEb3duOiBudWxsLAogICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgIGJ1c3lMYWJlbDogbGFiZWwsCiAgICBsYWJlbEFsaWdubWVudDogJ2xlZnQnLAogICAgc3RhdGU6IDAsCiAgICBhbmltU3RhdGVzOiBbCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJycsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgIF0sCiAgICBhbmltUmF0ZTogNTAwLAogICAgb25Cb3RBZGRlZDogYEAKICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgb25Cb3RDaGFuZ2VkOiBgQAogICAgICAgIGNvbnN0IG5lZWRSZWZyZXNoID0gdGhhdC50YWdzLnNvbWUodCA9PiB0ID09PSAnYnVzeUxhYmVsJyB8fCB0ID09PSAnc3RhdGUnIHx8IHQgPT09ICdhbmltU3RhdGVzJyk7CiAgICAgICAgaWYgKG5lZWRSZWZyZXNoKSB7CiAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB9CiAgICBgLAogICAgcmVmcmVzaERpc3BsYXk6IGBACiAgICAgICAgaWYgKHRhZ3MuYW5pbVN0YXRlcyAmJiB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBhbmltU3RhdGUgPSB0YWdzLmFuaW1TdGF0ZXNbdGFncy5zdGF0ZV07CgogICAgICAgICAgICB0YWdzLmxhYmVsID0gdGFncy5idXN5TGFiZWwudHJpbSgpICsgYW5pbVN0YXRlLmVsbGlwc2lzOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYW5pbVN0YXRlLmZvcm1BZGRyZXNzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3MubGFiZWwgCiAgICAgICAgfQogICAgYCwKICAgIGFuaW1hdGU6IGBACiAgICAgICAgaWYgKHRhZ3Muc3RhdGUgPj0gdGFncy5hbmltU3RhdGVzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSArPSAxOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgb3Muc2xlZXAodGFncy5hbmltUmF0ZSk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgLi4ucmVzdAp9OwoKY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKGJ1c3lJbmRpY2F0b3IpOwoKcmV0dXJuIG1lbnVCb3Q7JwCosNzQB9CYAQZzeXN0ZW0CBACosNzQB6ClARFhYi5pbnRlcmZhY2UubWVudScAqLDc0AfQmAEEZm9ybQIEAKiw3NAHsqUBB25vdGhpbmcnAKiw3NAH0JgBC2Rlc2NyaXB0aW9uAgQAqLDc0Ae6pQEmVGhpcyBza2lsbCBpcyBkZXNpZ25lZCBmb3IgbWVudSBzdHVmZi4oAKiw3NAH0JgBC2FiSW50ZXJmYWNlAXgnAKiw3NAH0JgBCmFiT3Blbk1lbnUCBACosNzQB+KlAfwfQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IG1lbnVUeXBlID0gdGhhdCA/ICJhYiIgKyB0aGF0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhhdC5zbGljZSgxKSArICJNZW51IjogImFiQ29yZU1lbnUiOyAvL3NldCB1cCBhIGNoZWNrIHRvIHNlZSB3aGF0IHR5cGUgb2YgbWVudSBzaG91bGQgYmUgb2NjdXJpbmcgW2NvcmUsIGJvdCwgZ3JpZCwgaW5zdF0KbGV0IG1lbnVTa2lsbHMgPSBnZXRCb3RzKG1lbnVUeXBlICsgIkFjdGlvbiIpOwpsZXQgbWF4T3B0aW9ucyA9IG1lbnVUeXBlID09ICJpbnN0IiA/IDcgOiA1OwpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmJhc2VTa2lsbC4ke21lbnVUeXBlICsgIkFjdGlvbiJ9KHtib3Q6IHRoaXNCb3R9KTtgOwoKbGV0IHNvcnRPcmRlckluZGV4ID0gbWVudVNraWxscy5sZW5ndGg7CmZvciAobGV0IGkgPSAwOyBpIDwgbWVudVNraWxscy5sZW5ndGg7IGkrKykvL0FERCBMT0dJQyBGT1IgTU9SRSBPUFRJT05TIFRIQU4gNSA6IG1heE9wdGlvbnMKewogICAgLy9BbGxvd3MgZm9yIGNvZGUgdG8gZ2V0IGNhbGxlZCBiZWZvcmUgdGhlIG1lbnUgZ2VuZXJhdGVzLCB1c2VmdWwgZm9yIGR5bmFtaWNhbGx5IHNldCBncm91cHMgb3IgZHJvcGRvd25zCiAgICBpZiAobWVudVNraWxsc1tpXS50YWdzW21lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIl0pIHsKICAgICAgICBhd2FpdCB3aGlzcGVyKG1lbnVTa2lsbHNbaV0sIG1lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIik7CiAgICB9IAoKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiSGlkZSJdKSB7CiAgICAgICAgY29udGludWU7CiAgICB9CiAgICAKICAgIGxldCBjdXJyZW50U2tpbGwgPSBtZW51U2tpbGxzW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5iYXNlU2tpbGwgPSAi8J+UlyIgKyBjdXJyZW50U2tpbGwuaWQ7CiAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJMYWJlbCJdOwogICAgYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSWNvbiJdOwogICAgYWJNZW51QnV0dG9uLm9uQ3JlYXRlID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiT25HZW5lcmF0ZSJdOwogICAgYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIlNvcnRPcmRlciJdOwogICAgYWJNZW51QnV0dG9uLmNvbG9yID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA/IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkNvbG9yIl0gOiBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcjsKCiAgICBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiZHJvcGRvd24iKSB7CiAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duT3B0aW9ucyA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duT3B0aW9uczsKCiAgICAgICAgY29uc3QgcHJldkRyb3Bkb3duID0gbGlua3MucmVtZW1iZXIubGlua3MubGFzdE9wZW5lZERyb3Bkb3duOwogICAgICAgIGlmIChwcmV2RHJvcGRvd24gJiYgcHJldkRyb3Bkb3duLnRhZ3NbbWVudVR5cGUgKyAiQWN0aW9uIl0pIHsKICAgICAgICAgICAgaWYgKHByZXZEcm9wZG93biA9PSBjdXJyZW50U2tpbGwpIHsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICJsYXN0T3BlbmVkRHJvcGRvd24iLCBudWxsKTsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkRlZmF1bHRPcGVuIl0gPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBhYk1lbnVCdXR0b24uZGVmYXVsdE9wZW47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5kcm9wZG93blNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJNZW51QnV0dG9uKTsgICAgICAgIAogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJncm91cCIpIHsKICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyID09ICJhdXRvIikgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBzb3J0T3JkZXJJbmRleDsKICAgICAgICAgICAgKytzb3J0T3JkZXJJbmRleDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFncy5ncm91cFNvcnRPcmRlcjsKICAgICAgICB9CiAgICAgICAgYWJNZW51QnV0dG9uLm1lbnVJdGVtcyA9IGN1cnJlbnRTa2lsbC50YWdzLm1lbnVJdGVtczsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUdyb3VwKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImlucHV0IikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAidGV4dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAidG9vbCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2woYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAid2l6YXJkIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKGFiTWVudUJ1dHRvbik7CiAgICB9Cn0KCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAogICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwpgOwp0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACiAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewogICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CiAgICB9CmA7CgpzaG91dCgnb25BQk9wZW5NZW51JywgeyBtZW51OiB0aGF0LCBtZW51VHlwZSwgbWVudVBvcnRhbDogY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgfSk7JwCosNzQB9CYARJhYkNyZWF0ZU1lbnVCdXR0b24CBACosNzQB93FAfgNQGxldCBuZXdNZW51QnV0dG9uID0ge307CgpsZXQgewogICAgbWVudUl0ZW1TdHlsZSA9IHt9LAogICAgLi4uYWRkaXRpb25hbFRhZ3MKfSA9IHRoYXQgPz8ge30KCmlmICh0eXBlb2YgbWVudUl0ZW1TdHlsZSA9PSAnc3RyaW5nJykgewogICAgbWVudUl0ZW1TdHlsZSA9IG1lbnVJdGVtU3R5bGUucmVwbGFjZSgvXHV7MUY5RUN9L3UsICcnKTsgCiAgICBtZW51SXRlbVN0eWxlID0gSlNPTi5wYXJzZShtZW51SXRlbVN0eWxlKTsKfQoKZnVuY3Rpb24gaGFzQm9yZGVyU3R5bGUoKSB7CiAgICBpZiAobWVudUl0ZW1TdHlsZVsiYm9yZGVyLXRvcC1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1sZWZ0LXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLWJvdHRvbS1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1yaWdodC1zdHlsZSJdKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwp9CgppZiAoYWRkaXRpb25hbFRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbF0pIHsKICAgIGlmIChhZGRpdGlvbmFsVGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIk1lbnVHcm91cCJdKSB7CgogICAgfQp9CgpuZXdNZW51QnV0dG9uLnNwYWNlID0gInRlbXBMb2NhbCI7Cm5ld01lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcjsKbmV3TWVudUJ1dHRvbi5sYWJlbENvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKbmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvciA9IHRoYXQuc2hhZG93Q29sb3IgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTaGFkb3dDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24uc2NhbGVZID0gMTsKCmNvbnN0IG1lbnVTdHlsaW5nID0gewogICAgImJvcmRlci1yYWRpdXMiOiI4cHgiLAogICAgIm1hcmdpbi10b3AiOiAiOHB4IiwKICAgICJib3gtc2hhZG93IjogYDNweCA0cHggJHtuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yfWAsCiAgICAibWluLWhlaWdodCI6ICI0NHB4IiwKICAgICJib3JkZXIiOiBoYXNCb3JkZXJTdHlsZSgpID8gIiIgOiBgMnB4IHNvbGlkICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIndpZHRoIjogImNhbGMoMTAwJSAtIDVweCkiLAogICAgLi4ubWVudUl0ZW1TdHlsZQp9CgpuZXdNZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBtZW51U3R5bGluZzsKCmNvbnN0IGNsaWNrZWRTdHlsaW5nID0gewogICAgLi4ubWVudVN0eWxpbmcsCiAgICAiZmlsdGVyIjogImJyaWdodG5lc3MoNjAlKSIKfQpjb25zdCBiYXNlU3R5bGUgPSBgQCBtYXNrcy5tZW51SXRlbVN0eWxlID0gJ/Cfp6wgJHtKU09OLnN0cmluZ2lmeShjbGlja2VkU3R5bGluZyl9J2AKCm5ld01lbnVCdXR0b24ub25Qb2ludGVyRG93biA9IG1lbnVJdGVtU3R5bGU/LlsibWFyZ2luLXRvcCJdICE9ICIwcHgiID8gYmFzZVN0eWxlIDogIkAgLy8iOwpuZXdNZW51QnV0dG9uLm9uUG9pbnRlclVwID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGxgOwoKZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpCnsKICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107Cn0KCm5ld01lbnVCdXR0b24gPSBjcmVhdGUobmV3TWVudUJ1dHRvbik7CgpyZXR1cm4gbmV3TWVudUJ1dHRvbjsnAKiw3NAH0JgBDWFiTWVudVJlZnJlc2gCBACosNzQB9TTAZ0BQGlmIChjb25maWdCb3QudGFncy5tZW51UG9ydGFsPy5zdWJzdHJpbmcoMCwyKSA9PSAiYWIiKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgogICAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwogICAgbWFza3Mub25LZXlEb3duID0gbnVsbDsKfScAqLDc0AfQmAEIcmVtZW1iZXICBACosNzQB/LUASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCosNzQB9CYAQ1tYW5pZmVzdGF0aW9uAgQAqLDc0AeZ1QEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAqLDc0AfQmAERYWJFbnZpcm9ubWVudE1lbnUCBACosNzQB8DVAaA7QHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKCmNvbnN0IGFiRW52aXJvbm1lbnRPcHRpb25zID0gdGhpc0JvdC5hYkdldEVudmlyb25tZW50T3B0aW9ucygpOwoKYnV0dG9uTG9vcDoKZm9yIChsZXQgaSA9IDA7IGkgPCBhYkVudmlyb25tZW50T3B0aW9ucy5sZW5ndGg7IGkrKykKewogICAgbGV0IGFjdGl2ZUJ1dHRvbiA9IGFiRW52aXJvbm1lbnRPcHRpb25zW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBhY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI7CgogICAgaWYgKGFjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZSkKICAgIHsKICAgICAgICBpZiAoIWxpbmtzW2FjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZV0pCiAgICAgICAgewogICAgICAgICAgICBjb250aW51ZSBidXR0b25Mb29wOwogICAgICAgIH0KICAgIH0KCiAgICBsZXQgbmV3QnV0dG9uRGF0YSA9IHsuLi5hYk1lbnVCdXR0b24sIC4uLmFjdGl2ZUJ1dHRvbn07CgogICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3QnV0dG9uRGF0YSk7Cn0KCmNvbnN0IGFiUGVyc29uYWxpdHlDb25maWdCdXR0b24gPSB7CiAgICBsYWJlbDogImN1c3RvbWl6ZTogYWIgcGVyc29uYWxpdHkiLAogICAgLi4uYWJNZW51QnV0dG9uLAogICAgYWJNZW51U29ydE9yZGVyOiAxLAogICAgZHJvcGRvd25Tb3J0T3JkZXI6IDEsCiAgICBkcm9wZG93bk9wdGlvbnM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbmFtZTogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksIHt0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgdG8gY2FsbCBtZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bmFtZTogbmFtZX0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgYWkgbW9kZWw6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWx9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBACiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbHMgPSBjb25maWdCb3QudGFncy5haUNoYXRNb2RlbHM7CgogICAgICAgICAgICAgICAgaWYgKG1vZGVscykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBbXTsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBtb2RlbHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKHsgbGFiZWw6IGVudHJ5Lm5hbWUsIHZhbHVlOiBlbnRyeS5uYW1lIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudE1vZGVsSW5kZXggPSBvcHRpb25zLmZpbmRJbmRleChvID0+IG8udmFsdWUgPT09IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsKTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQoY3VycmVudE1vZGVsSW5kZXgsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICd3aGF0IGFpIG1vZGVsIHdvdWxkIHlvdSBsaWtlIG1lIHRvIHVzZT8nLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbGlzdCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBvcHRpb25zLAogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRPcHRpb24gJiYgc2VsZWN0ZWRPcHRpb24udmFsdWUgIT09IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHthaU1vZGVsOiBzZWxlY3RlZE9wdGlvbi52YWx1ZX0pOyAKICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChhdXRoQm90KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnNob3dBbGVydCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3NvbWV0aGluZyB3ZW50IHdyb25nJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdmYWlsZWQgdG8gZ2V0IGxpc3Qgb2YgYWkgY2hhdCBtb2RlbHMuJwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnNob3dBbGVydCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3NpZ24gaW4gcmVxdWlyZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJ3lvdSBtdXN0IHNpZ24gaW4gdG8gdXNlIGFpLicKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG1lIHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHtjb2xvcjogY29sb3J9KTsgCiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYG1lbnUgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudXMgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVDb2xvcjogY29sb3J9KTsgCiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICAgICAgICAgICAgICAvL2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IgPSBjb2xvcjsgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgIT0gJ2NsZWFyJyl7bGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciA9IGNvbG9yfTsgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYG1lbnUgdGV4dCBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnUgdGV4dCB0byBiZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bWVudUxhYmVsQ29sb3I6IGNvbG9yfSk7IAogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTtgLAogICAgICAgICAgICAgICAgLy9saW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yID0gY29sb3I7IGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yICE9ICdjbGVhcicpe2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgPSBjb2xvcn07IGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBkZWZhdWx0IHBvcnRhbCBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyAnIzI2MzIzOCd9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgbGV0IHBvcnRhbENvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4Jywge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB5b3VyIHBvcnRhbCB0byBsb29rIGxpa2U/J30pOwogICAgICAgICAgICAgICAgaWYgKCFwb3J0YWxDb2xvcikgewogICAgICAgICAgICAgICAgICAgIHBvcnRhbENvbG9yID0gJyMyNjMyMzgnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeydwb3J0YWxDb2xvcic6IHBvcnRhbENvbG9yfSk7IAogICAgICAgICAgICAgICAgLy9kZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBkZWZhdWx0IG1hcCBwb3J0YWwgYmFzZW1hcGAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIHNob3V0KCJzaG93QUJCYXNlbWFwT3B0aW9ucyIpOwogICAgICAgICAgICBgCiAgICAgICAgfSwKICAgICAgICAgewogICAgICAgICAgICBsYWJlbDogImRlZmF1bHQgc2V0dGluZ3MiLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgICAgICAgICAgY29sb3I6ICdyZWQnLAogICAgICAgICAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeydkZWZhdWx0UGVyc29uYWxpdHknOiB0cnVlfSk7IAogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAgIGxhYmVsOiAibWVudSBjb2xvciIsCiAgICAgICAgLy8gICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgLy8gICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAvLyAgICAgICAgIGNvbnN0IG1lbnVDb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yLCB7dGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnUncyB0byBiZT8nfSk7CiAgICAgICAgLy8gICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bWVudUNvbG9yOiBtZW51Q29sb3J9KTsgCiAgICAgICAgLy8gICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpO2AsCiAgICAgICAgLy8gfSwKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAgIGxhYmVsOiAicHJvbXB0IiwKICAgICAgICAvLyAgICAgb25DbGljazogYEBgLAogICAgICAgIC8vIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogImZvcm0iLAogICAgICAgIC8vICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAvLyAgICAgICAgIGNvbnN0IGZvcm0gPSBhd2FpdCBvcy5zaG93SW5wdXQoYWJQZXJzb25hbGl0eS50YWdzLmFiRm9ybSwge3RpdGxlOiAnd2hhdCBmb3JtIHdvdWxkIHlvdSBsaWtlIG1lIHRvIHRha2U/J30pOwogICAgICAgIC8vICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge2Zvcm06IGZvcm19KTsgCiAgICAgICAgLy8gICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpO2AsCiAgICAgICAgLy8gfQogICAgXQp9Cgp0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiUGVyc29uYWxpdHlDb25maWdCdXR0b24pOwoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCRW52aXJvbm1lbnRNZW51JywgeyBtZW51UG9ydGFsOiBjb25maWdCb3QudGFncy5tZW51UG9ydGFsfSApJwCosNzQB9CYAQVsZWFybgIEAKiw3NAH4ZACKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAKiw3NAH0JgBA2dwdAIEAKiw3NAHiJECKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAKiw3NAH0JgBCGFiSWdub3JlAgQAqLDc0AevkQIEdHJ1ZScAqLDc0AfQmAEGc2VhcmNoAgQAqLDc0Ae0kQIo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAqLDc0AfQmAEGbnVnZ2V0AgQAqLDc0AfbkQIo8J+UlzRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZicAqLDc0AfQmAEFdGVzdHMCBACosNzQB4KSAijwn5SXYjgzZDk3MmItMDUzNS00MDUxLWI1ODktNDFjZWRhODUzNWYxJwCosNzQB9CYAQ9vblBvcnRhbENoYW5nZWQCBACosNzQB6mSAm5AaWYgKHRoYXQucG9ydGFsID09ICJzeXN0ZW1Qb3J0YWwiICYmICF0aGF0LmRpbWVuc2lvbiAmJiAhbGlua3MudGVzdHMpCnsKICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoImFiVGVzdHMiKTsKfScAqLDc0AfQmAEDYXNrAgQAqLDc0AeYkwIo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAqLDc0AfQmAEJYWJWZXJzaW9uAgQAqLDc0Ae/kwIFMTAuMzUnAKiw3NAH0JgBEWFiQ3JlYXRlTWVudUlucHV0AgQAqLDc0AfFkwKeAkBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51SW5wdXQgPSB7DQogICAgZm9ybTogImlucHV0IiwNCiAgICBtZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHk6IGZhbHNlLA0KICAgIGZvcm1JbnB1dE11bHRpbGluZTogbnVsbCwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51SW5wdXQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAKiw3NAH0JgBEGFiQ3JlYXRlTWVudVRleHQCBACosNzQB+SVAoEEQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KY29uc3Qgew0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZSwNCiAgICAuLi5yZXN0DQp9ID0gdGhhdDsNCg0KbGV0IG1lbnVUZXh0ID0gew0KICAgIGZvcm06ICJ0ZXh0IiwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIHBvaW50YWJsZTogZmFsc2UsDQogICAgY29sb3I6ICJ3aGl0ZSIsDQogICAgbWVudUl0ZW1TdHlsZTogew0KICAgICAgICAicGFkZGluZy10b3AiOiAiNnB4IiwNCiAgICAgICAgInBhZGRpbmctYm90dG9tIjogIjZweCIsDQogICAgfSwNCiAgICBtZW51SXRlbUxhYmVsU3R5bGU6IHsNCiAgICAgICAgIndoaXRlLXNwYWNlIjogInByZS13cmFwIiwNCiAgICAgICAgLi4ubWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIH0sDQogICAgLi4ucmVzdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUZXh0KTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCosNzQB9CYARBhYkNyZWF0ZU1lbnVUb29sAgQAqLDc0AfmmQKOAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51VG9vbCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRvb2wpOw0KDQpyZXR1cm4gbWVudUJvdDsnAKiw3NAH0JgBEmFiQ3JlYXRlTWVudVdpemFyZAIEAKiw3NAH9ZoCkgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVdpemFyZCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVdpemFyZCk7DQoNCnJldHVybiBtZW51Qm90OycAqLDc0AfQmAEUYWJDcmVhdGVNZW51RHJvcGRvd24CBACosNzQB4icAt4dQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0LmRyb3Bkb3duU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVEcm9wZG93bjogZHJvcGRvd25Tb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgb3V0ZXJNZW51QnV0dG9uID0gew0KICAgIC4uLnRoYXQsDQogICAgZm9ybUFkZHJlc3M6IHRoYXQuZm9ybUFkZHJlc3MgPz8gImFycm93X3JpZ2h0IiwNCiAgICBkcm9wZG93bk9wZW46IGZhbHNlLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIHRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9ICR7dGhhdC5kcm9wZG93blNvcnRPcmRlcn0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IHRydWUpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnModGFncy5kcm9wZG93bk9wdGlvbnMsIHRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIpOw0KICAgICAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25EZXN0cm95OiBgQA0KICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgIGAsDQogICAgb25Qb2ludGVyVXA6IGBADQogICAgICAgIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsOw0KICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gImFycm93X3JpZ2h0IjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gZmFsc2UpIHsNCiAgICAgICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImZvcm1BZGRyZXNzIiwgImFycm93X2Ryb3BfZG93biIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAibWVudUl0ZW1TdHlsZSIsIHsuLi50YWdzLm1lbnVJdGVtU3R5bGUsICJib3JkZXJCb3R0b21MZWZ0UmFkaXVzIjogIjAiLCAiYm9yZGVyQm90dG9tUmlnaHRSYWRpdXMiOiAiMCJ9KTsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25Cb3RDaGFuZ2VkOiBgQA0KICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCdkcm9wZG93bk9wZW4nKSAmJiB0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51RHJvcGRvd25PcGVuZWQiLCB0aGlzQm90KTsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgYWJNZW51RHJvcGRvd25PcGVuZWQ6IGBADQogICAgICAgIGlmICh0aGF0ICE9IHRoaXNCb3QpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobGlua3MgJiYgbGlua3MuYmFzZVNraWxsKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhhYi5saW5rcy5yZW1lbWJlciwgImxhc3RPcGVuZWREcm9wZG93biIsIHRhZ3MuYmFzZVNraWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGANCn07DQoNCmlmICh0aGF0LmZvcm1BZGRyZXNzICYmIHRoYXQuZm9ybUFkZHJlc3MgIT0gImFycm93X3JpZ2h0Iikgew0KICAgIG91dGVyTWVudUJ1dHRvbi5jdXN0b21Gb3JtQWRkcmVzcyA9IHRydWU7DQp9DQpvdXRlck1lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IHRoYXQuZHJvcGRvd25Tb3J0T3JkZXI7DQoNCmNvbnN0IG1lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihvdXRlck1lbnVCdXR0b24pOw0KbWVudUJvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMgPSBnZW5lcmF0ZU1lbnVPcHRpb25zOw0KDQphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZU1lbnVPcHRpb25zIChvcHRpb25zLCBzb3J0T3JkZXIpIHsNCiAgICBjb25zdCBtZW51Qm90cyA9IFtdOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7ICsraSkgew0KDQogICAgICAgIGxldCBuZXdNZW51QnV0dG9uID0gew0KICAgICAgICAgICAgLi4ub3B0aW9uc1tpXSwNCiAgICAgICAgICAgIGNsZWFyRHJvcGRvd25NZW51OiBgQA0KICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMDApOw0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoaSA9PSBvcHRpb25zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAgMCA4cHggOHB4IjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIDAgOHB4IDhweCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJUb3AiXSA9ICJub25lIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJtYXJnaW5Ub3AiXSA9ICIwIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJwYWRkaW5nTGVmdCJdID0gIjM1cHgiOw0KDQogICAgICAgIGNvbnN0IG5ld01lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCiAgICB9DQoNCiAgICBtZW51Qm90LnRhZ3MubWVudUJvdHMgPSBnZXRMaW5rKG1lbnVCb3RzKTsNCn0NCg0KaWYgKHRoYXQuZGVmYXVsdE9wZW4pIHsNCiAgICBtZW51Qm90Lm9uUG9pbnRlclVwKCk7DQogICAgbWVudUJvdC5vbkNsaWNrKCk7DQp9DQoNCnJldHVybiBtZW51Qm90Ow0KDQonAKiw3NAH0JgBEWFiQ3JlYXRlTWVudUdyb3VwAgQAqLDc0AfnuQK9H0AvKg0KICAgRVhBTVBMRQ0KICAgY29uc3QgbWVudUdyb3VwID0gew0KICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBncm91cFNvcnRPcmRlcjogMSwNCiAgICAgICAgbWVudUl0ZW1zOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICBjb2xvcjogIm9yYW5nZSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgbWVudUl0ZW1UeXBlOiAiZHJvcGRvd24iLA0KICAgICAgICAgICAgICAgIGRyb3Bkb3duT3B0aW9uczogWw0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfQ0KKi8NCg0KaWYgICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0Lmdyb3VwU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVHcm91cDogZ3JvdXBTb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgew0KICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwNCiAgICBtZW51SXRlbXMgPSBbXSwNCiAgICAuLi5hZGRpdGlvbmFsVGFncw0KfSA9IHRoYXQgPz8ge30NCg0KY29uc3QgbWVudUJvdHMgPSBbXTsNCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudUl0ZW1zLmxlbmd0aDsgKytpKSB7DQoNCiAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9Ow0KDQogICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDApOw0KDQogICAgbGV0IGluZGl2TWVudUl0ZW1TdHlsZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVN0eWxlID8/IHt9Ow0KICAgIGxldCBpbmRpdk1lbnVUeXBlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtVHlwZSA/PyB1bmRlZmluZWQ7DQogICAgbGV0IGluZGl2QWRkaXRpb25hbFRhZ3MgPSBtZW51SXRlbXNbaV07DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdOw0KICAgIH0NCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdOw0KICAgIH0NCg0KICAgIGNvbnN0IGJhc2VTdHlsaW5nID0gew0KICAgICAgICAiYm9yZGVyVG9wIjogIm5vbmUiLA0KICAgICAgICAibWFyZ2luVG9wIjogIjAiDQogICAgfQ0KDQogICAgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEgJiYgaSA9PSAwKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfQ0KICAgIGVsc2UgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCAwIDhweCA4cHgiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfSBlbHNlIGlmIChpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjhweCA4cHggMCAwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nO30NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gaW5kaXZBZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGluZGl2QWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBsZXQgbmV3TWVudUJvdDsNCiAgICBzd2l0Y2goaW5kaXZNZW51VHlwZSkgew0KICAgICAgICBjYXNlICJkcm9wZG93biI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bigNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC4uLm5ld01lbnVCdXR0b24sDQogICAgICAgICAgICAgICAgICAgICJkcm9wZG93blNvcnRPcmRlciI6IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTApDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiaW5wdXQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidGV4dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRvb2wiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ3aXphcmQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICB9DQogICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCn0NCg0KcmV0dXJuIG1lbnVCb3RzOycAqLDc0AfQmAELcGVyc29uYWxpdHkCBACosNzQB6XZAijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwCosNzQB9CYARdhYkdldEVudmlyb25tZW50T3B0aW9ucwIEAKiw3NAHzNkCwTpAY29uc3Qgb3B0aW9ucyA9IFtdOwoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogYGhpZGVgLAogICAgICAgIGZvcm1BZGRyZXNzOiAidmlzaWJpbGl0eV9vZmYiLAogICAgICAgIG9uQ2xpY2s6ICJAIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAib3B0aW1pemUgbW9kZSIsCiAgICBvbkNyZWF0ZTogIkAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgb25DbGljazogIkAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA9IGZhbHNlIDogY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSB0cnVlOyB0aGlzQm90Lm9uQ3JlYXRlKCk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxCn0pCgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAic2xlZXAiLAogICAgICAgIGZvcm1BZGRyZXNzOiAibmlnaHRzX3N0YXkiLAogICAgICAgIG9uQ2xpY2s6ICJAbGlua3MubWFuaWZlc3RhdGlvbi5hYlNldEF3YWtlKHsgYXdha2U6IGZhbHNlIH0pIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMwogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiY2hhdCIsCiAgICBmb3JtQWRkcmVzczogImNoYXQiLAogICAgb25DbGljazogIkAgc2hvdXQoJ2FiQ2hhdEJhck9wZW4nKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDQKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogIm51Z2dldHMiLAogICAgb25DcmVhdGU6ICJAIHRhZ3MubnVnTWFuYWdlciA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuaW50ZXJmYWNlLm51Z2dldCcpKTsgaWYgKGxpbmtzLm51Z01hbmFnZXIudGFncy5saXN0ZW5pbmcpe3RhZ3Mub25DbGljayA9IGBAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCBudWxsKTtgO3RhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94YDt9ZWxzZXsgICAgdGFncy5vbkNsaWNrID0gYEAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIHRydWUsICdsb2NhbCcpO2A7ICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94X291dGxpbmVfYmxhbmtgO30iLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDUKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBhYkVudmlyb25tZW50R2F0ZTogImdwdCIsCiAgICBvbkNyZWF0ZTogIkAgIGlmICghYXV0aEJvdCl7ZGVzdHJveSh0aGlzQm90KTt9ZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gJ0ZyZWVQbGF5JyB8fCBhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSB1bmRlZmluZWQpe2Rlc3Ryb3kodGhpc0JvdCk7fTsgdGFncy5sYWJlbCA9ICdlZGl0ICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBwcm9tcHQnOyB0YWdzLmdwdEJvdCA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuYWN0aW9uLmFzaycpKTsiLAogICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgb25DbGljazogIkAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDcKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImdyaWQgc25hcCIsCiAgICBvbkNyZWF0ZTogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnIiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlO3RhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDgKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImJvdCBzbmFwIiwKICAgIG9uQ3JlYXRlOiAiQCB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgb25DbGljazogIkAgbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlOyB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDkKfSkKCmlmIChhdXRoQm90KSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAiYWNjb3VudCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJiYWRnZSIsCiAgICAgICAgb25DbGljazogIkAgb3Muc2hvd0FjY291bnRJbmZvKCk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAKICAgIH0pCn0KCmlmIChsaW5rcy50ZXN0cykgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBhYkVudmlyb25tZW50R2F0ZTogInRlc3RzIiwKICAgICAgICBsYWJlbDogInJlY29yZCB0ZXN0IiwKICAgICAgICBmb3JtQWRkcmVzczogInNjaWVuY2UiLAogICAgICAgIG9uS2V5RG93bjogIkAgIiwKICAgICAgICBvbktleVVwOiAiQCAiLAogICAgICAgIG9uQ2xpY2s6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRlc3QnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDExCiAgICB9KQoKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJ0ZXN0cyIsCiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdHJhY2UiLAogICAgICAgIGZvcm1BZGRyZXNzOiAidGltZWxpbmUiLAogICAgICAgIG9uS2V5RG93bjogIkAgIiwKICAgICAgICBvbktleVVwOiAiQCAiLAogICAgICAgIG9uQ2xpY2s6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRyYWNlJyk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMgogICAgfSkKfQoKaWYgKGdldEJvdCgic3lzdGVtIiwgImFiLmhvbWUuZWdnIikpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJ0ZXN0cyIsCiAgICAgICAgbGFiZWw6ICJzYXZlIGhvbWUgZWdnIiwKICAgICAgICBmb3JtQWRkcmVzczogImVnZyIsCiAgICAgICAgb25LZXlEb3duOiAiQCAiLAogICAgICAgIG9uS2V5VXA6ICJAICIsCiAgICAgICAgb25DbGljazogYEBnZXRCb3QoInN5c3RlbSIsICJhYi5ob21lLmVnZyIpLnNhdmVEYXRhKCk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTtgLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMwogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiY2hlY2sgZm9yICIgKyBhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiB1cGRhdGVzIiwKICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICBsZWFybjogdGFncy5sZWFybiwKICAgIG9uS2V5RG93bjogIkAgIiwKICAgIG9uS2V5VXA6ICJAICIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTQsCiAgICBjaGVja0ZvclVwZGF0ZXM6IGBACiAgICAgICAgLy8gVGVtcG9yYXJpbHkgcmVwbGFjZSB3aXRoIGJ1c3kgaW5kaWNhdG9yIHdoaWxlIGNoZWNraW5nIGZvciB1cGRhdGVzLgogICAgICAgIHRhZ3MuYWJNZW51ID0gZmFsc2U7CgogICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gYWIubGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yKHsKICAgICAgICAgICAgYWJNZW51OiB0cnVlLAogICAgICAgICAgICBsYWJlbDogJ2NoZWNraW5nIGZvciB1cGRhdGVzIHRvICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgIGFiTWVudVNvcnRPcmRlcjogdGFncy5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlciwKICAgICAgICB9KTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sgPSBhd2FpdCBhYi5hYkNoZWNrQUJVcGRhdGVBdmFpbGFibGUoeyBkZXRhaWxlZDogdHJ1ZSB9KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IgPSBudWxsOwoKICAgICAgICAgICAgLy8gQnJpbmcgYmFjayB0aGUgdXBkYXRlIGJ1dHRvbi4KICAgICAgICAgICAgdGFncy5hYk1lbnUgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrICYmIHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLnN1Y2Nlc3MpIHsgICAgCiAgICAgICAgICAgIGlmIChnbG9iYWxUaGlzLmFiVXBkYXRlQ2hlY2tlcikgewogICAgICAgICAgICAgICAgYWJVcGRhdGVDaGVja2VyLnRhZ3MudXBkYXRlQXZhaWxhYmxlID0gdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sudXBkYXRlQXZhaWxhYmxlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sudXBkYXRlQXZhaWxhYmxlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhYkZpbGVzV2l0aFVwZGF0ZXMgPSB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay5hYkZpbGVDaGVja3MuZmlsdGVyKGYgPT4gZi51cGRhdGVBdmFpbGFibGUpOwoKICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IG9zLnNob3dDb25maXJtKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1VwZGF0ZXMgZm91bmQgZm9yICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogJ1RoZXJlIGFyZSAnICsgYWJGaWxlc1dpdGhVcGRhdGVzLmxlbmd0aCArICcgZmlsZSB1cGRhdGVzIGZvciAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJy4gV291bGQgeW91IGxpa2UgdG8gaW5zdGFsbCB0aGUgdXBkYXRlcyBub3c/IFlvdSBhbmQgYW55IGNvbm5lY3RlZCB1c2VycyB3aWxsIGF1dG9tYXRpY2FsbHkgcmVmcmVzaCB0aGUgcGFnZSBhZnRlciB0aGUgdXBkYXRlIGlzIGNvbXBsZXRlLicsCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsVGV4dDogJ05vdCBub3cnLAogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1UZXh0OiAnWWVzJwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgICAgICAgICAgbGlua3MubGVhcm4udXBkYXRlQUIoKTsgCiAgICAgICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFiLmxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBpcyBhbHJlYWR5IHVwLXRvLWRhdGUhJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYXNrcy5sYWJlbCA9ICd1cGRhdGUgY2hlY2sgZmFpbGVkJzsKICAgICAgICB9CiAgICBgLAogICAgb25DbGljazogYEAKICAgICAgICB0aGlzQm90LmNoZWNrRm9yVXBkYXRlcygpOwogICAgYCwKICAgIG9uRGVzdHJveTogYEAKICAgICAgICBpZiAodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpIHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgfQogICAgYCwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBvbkNyZWF0ZTogYEAKICAgICAgICB0YWdzLmxhYmVsID0gInBlcm1hbmVudGx5IGRlbGV0ZSAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKICAgICAgICB0YWdzLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb250cmFzdENvbG9yID8/ICIjRDkzMDMwIjsKICAgIGAsCiAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgIG9uQ2xpY2s6IGBACiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ1Blcm1hbmVudGx5IGRlbGV0ZSAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgY29udGVudDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArICBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBmcm9tICcgKyBsaW5rcy5sZWFybi50YWdzLmFiSW5zdCArICc/IFRoaXMgaXMgbm90IHJldmVyc2libGUhJywKICAgICAgICB9KQoKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwoKICAgICAgICBjb25zdCBhYkJvdHMgPSBnZXRCb3RzKChiKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBiLnNwYWNlID09PSAnc2hhcmVkJyAmJgogICAgICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0gJiYKICAgICAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtLnN0YXJ0c1dpdGgoJ2FiJyk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgZGVzdHJveShhYkJvdHMpOwogICAgICAgIH0KICAgIGAsCiAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMAp9KQoKcmV0dXJuIG9wdGlvbnM7JwCosNzQB9CYAR5hYkNyZWF0ZVRvb2xib3hEcm9wZG93bk9wdGlvbnMCBACosNzQB46UA+MTQGNvbnN0IHRvb2xib3hUb29scyA9IFsuLi50aGF0LnRvb2xBcnJheV0gPz8gW107DQpjb25zdCB0b29sYm94TmFtZSA9IHRoYXQudG9vbGJveE5hbWUgPz8gIktpdCAiOw0KY29uc3QgdG9vbGJveCA9IHRoYXQudG9vbGJveDsNCmNvbnN0IGdyaWRJbmZvcm1hdGlvbiA9ICh0aGF0Py5ncmlkSW5mb3JtYXRpb24gJiYgdGhhdD8uZ3JpZEluZm9ybWF0aW9uICE9IHVuZGVmaW5lZCkgPyB0aGF0Py5ncmlkSW5mb3JtYXRpb24gOiBhYlJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQoNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMudG9vbGJveCA9IGdldExpbmsodG9vbGJveCk7DQptZW51T3B0aW9ucy5ncmlkSW5mb3JtYXRpb24gPSBncmlkSW5mb3JtYXRpb247DQptZW51T3B0aW9ucy5zZWFyY2ggPSB0YWdzLnNlYXJjaDsNCm1lbnVPcHRpb25zLmFydGlmYWN0ID0gdGFncy5hcnRpZmFjdDsNCi8vbWVudU9wdGlvbnMuZm9ybUFkZHJlc3MgPSAiaGFyZHdhcmUiOw0KDQppZiAodG9vbGJveFRvb2xzLmxlbmd0aCA9PT0gMCkgew0KICAgIGNvbnN0IG1lc3NhZ2UgPSB0b29sYm94TmFtZSArICIgZG9lcyBub3QgaGF2ZSBhbnkgdG9vbHMgbGlzdGVkIGluIHRoZSB0b29sX2FycmF5IHRhZyI7DQoNCiAgICBhYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIG1lc3NhZ2UpOw0KICAgIG9zLnRvYXN0KG1lc3NhZ2UsIDUpOw0KICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7DQp9DQoNCmZvciAobGV0IHRvb2wgb2YgdG9vbGJveFRvb2xzKSB7DQogICAgY29uc3QgdG9vbEJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiB0b29sLm5hbWUsDQogICAgICAgIHRhcmdldEFCOiB0b29sLnRhcmdldEFCLA0KICAgICAgICBpc0FydGlmYWN0OiB0b29sLmFydGlmYWN0IHx8IGZhbHNlLA0KICAgICAgICBvbkNsaWNrOmBADQogICAgICAgICAgICBpZiAodGFncy5pc0FydGlmYWN0KSB7DQogICAgICAgICAgICAgICAgY29uc3QgYWJBcnRpZmFjdFNoYXJkID0gew0KICAgICAgICAgICAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJveEJvdDogdGFncy50b29sYm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzOiBbDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUINCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgbGlua3MuYXJ0aWZhY3QuYWJDcmVhdGVBcnRpZmFjdFByb21pc2VCb3Qoew0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0TmFtZTogdGFncy50YXJnZXRBQiwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdEluc3RhbmNlSUQ6IHV1aWQoKSwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdFNoYXJkLA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsNCiAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAndG9vbCcsDQogICAgICAgICAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgLA0KICAgIH07DQoNCiAgICBpZiAodG9vbC5mb3JtQWRkcmVzcykgew0KICAgICAgICB0b29sQnV0dG9uLmZvcm1BZGRyZXNzID0gdG9vbC5mb3JtQWRkcmVzczsNCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaCh0b29sQnV0dG9uKTsNCn0NCg0KcmV0dXJuIGRyb3Bkb3duT3B0aW9uczsnAKiw3NAH0JgBEG9uQUJBdXRoQm90QWRkZWQCBACosNzQB/KnAxhAc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsnAKiw3NAH0JgBCGFydGlmYWN0AgQAqLDc0AeLqAMo8J+Ulzc4ZTQxNTAzLWM5MzMtNGY4YS04MTdhLWJhOTdiZjhkNWQyNycBBGJvdHMkYzc4YWE2NjMtZDA1Yy00ZWM0LWJjMmMtMjZmZDUxNTYwYjk3AScAqLDc0AeyqAMVYWJDcmVhdGVDdWJlRmFjZVBsYW5lAgQAqLDc0AezqAOJMUBsZXQgeyAKICAgIGJvdCwKICAgIGRpbWVuc2lvbiwKICAgIHNwYWNlID0gJ3RlbXBMb2NhbCcsCiAgICBkZWJ1ZywKICAgIGZhY2VPZmZzZXQgPSAwLjAxLAogICAgcG9pbnRhYmxlID0gZmFsc2UsCiAgICB0aWNrSW50ZXJ2YWxNUyA9IDUwMCwKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge307Cgphc3NlcnQobGlua3MudXRpbHMuaXNCb3QoYm90KSwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3QgaXMgYSByZXF1aXJlZCBCb3QgcGFyYW1ldGVyLmApOwphc3NlcnQoZGltZW5zaW9uLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRpbWVuc2lvbiBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKYXNzZXJ0KHJlc3QuZm9ybSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGZvcm0gaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LmFuY2hvclBvaW50ID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYW5jaG9yUG9pbnQgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQm90QWRkZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKCmNvbnN0IGZhY2VQbGFuZU1vZCA9IHsKICAgIHNwYWNlLAogICAgYW5jaG9yUG9pbnQ6ICdjZW50ZXInLAogICAgZGVidWcsCiAgICBmYWNlT2Zmc2V0LAogICAgZm9ybTogJ3Nwcml0ZScsCiAgICBkaW1lbnNpb24sCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIHBvaW50YWJsZSwKICAgIHRpY2tJbnRlcnZhbE1TLAogICAgdHJhbnNmb3JtZXI6IGJvdC5pZCwKICAgIG9uQm90QWRkZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnN0YXJ0VGljaygpOwogICAgfSksCiAgICBvbkJvdENoYW5nZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCd0aWNrSW50ZXJ2YWxNUycpKSB7CiAgICAgICAgICAgIHRoaXNCb3Quc3RvcFRpY2soKTsKICAgICAgICAgICAgdGhpc0JvdC5zdGFydFRpY2soKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ3RyYW5zZm9ybWVyJykpIHsKICAgICAgICAgICAgaWYgKCF0YWdzLnRyYW5zZm9ybWVyKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkFueUJvdHNSZW1vdmVkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRhZ3MudHJhbnNmb3JtZXIpIHsKICAgICAgICAgICAgaWYgKHRoYXQuYm90SURzLmluY2x1ZGVzKHRhZ3MudHJhbnNmb3JtZXIpKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnN0b3BUaWNrKCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGVzdHJveWVkYCk7CiAgICAgICAgfQogICAgfSksCiAgICBzZXREaW1lbnNpb246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25zdCBkaW1lbnNpb24gPSB0aGF0OwoKICAgICAgICBpZiAodGFncy5kaW1lbnNpb24gIT09IGRpbWVuc2lvbikgewogICAgICAgICAgICAvLyBSZW1vdmUgZnJvbSBwcmV2aW91cyBkaW1lbnNpb24uCiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gbnVsbDsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdQb3NpdGlvbiddID0gbnVsbDsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdSb3RhdGlvbiddID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChkaW1lbnNpb24pIHsKICAgICAgICAgICAgICAgIC8vIEFzc2lnbiB0byBuZXcgZGltZW5zaW9uLgogICAgICAgICAgICAgICAgdGFncy5kaW1lbnNpb24gPSBkaW1lbnNpb247CiAgICAgICAgICAgICAgICB0YWdzW2RpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0pLAogICAgc3RhcnRUaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKG1hc2tzLnRpY2tJbnRlcnZhbElkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG1hc2tzLnRpY2tJbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAndGljaycpLCB0YWdzLnRpY2tJbnRlcnZhbE1TKTsKICAgICAgICB0aGlzQm90LnRpY2soKTsKICAgIH0pLAogICAgc3RvcFRpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAobWFza3MudGlja0ludGVydmFsSWQpIHsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChtYXNrcy50aWNrSW50ZXJ2YWxJZCk7CiAgICAgICAgICAgIG1hc2tzLnRpY2tJbnRlcnZhbElkID0gbnVsbDsKICAgICAgICB9CiAgICB9KSwKICAgIHRpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25zdCBMT0NBTF9OT1JNQUxTID0gWwogICAgICAgICAgICBuZXcgVmVjdG9yMygxLCAwLCAwKSwgLy8gK1gKICAgICAgICAgICAgbmV3IFZlY3RvcjMoLTEsIDAsIDApLCAvLyAtWAogICAgICAgICAgICBuZXcgVmVjdG9yMygwLCAxLCAwKSwgLy8gK1kKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgLTEsIDApLCAvLyAtWQogICAgICAgIF0KCiAgICAgICAgY29uc3QgTE9DQUxfUE9TSVRJT05TID0gWwogICAgICAgICAgICBuZXcgVmVjdG9yMygwLjUgKyB0YWdzLmZhY2VPZmZzZXQsIDAsIC0wLjUpLCAvLyArWAogICAgICAgICAgICBuZXcgVmVjdG9yMygtMC41IC0gdGFncy5mYWNlT2Zmc2V0LCAwLCAtMC41KSwgLy8gLVgKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgMC41ICsgdGFncy5mYWNlT2Zmc2V0LCAtMC41KSwgLy8gK1kKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgLTAuNSAtIHRhZ3MuZmFjZU9mZnNldCwgLTAuNSksIC8vIC1ZCiAgICAgICAgXQoKICAgICAgICBjb25zdCBIQUxGX1BJID0gTWF0aC5QSSAvIDI7CgogICAgICAgIGNvbnN0IExPQ0FMX1JPVEFUSU9OUyA9IFsKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogSEFMRl9QSSwgeTogSEFMRl9QSSwgejogMCB9fSksIC8vICtYCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IEhBTEZfUEksIHk6IC1IQUxGX1BJLCB6OiAwIH19KSwgLy8gLVgKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogLUhBTEZfUEksIHk6IDAsIHo6IE1hdGguUEkgfX0pLCAvLyArWQogICAgICAgICAgICBuZXcgUm90YXRpb24oeyBldWxlcjogeyB4OiBIQUxGX1BJLCB5OiAwLCB6OiAwIH19KSwgLy8gLVkKICAgICAgICBdCgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgZmFjZSBwbGFuZSB0byBiZSBvbiB0aGUgZ2l2ZW4gZmFjZSBpbmRleC4gIAogICAgICAgICAqIDA6ICtYLCAgCiAgICAgICAgICogMTogLVgsICAKICAgICAgICAgKiAyOiArWSwgIAogICAgICAgICAqIDM6IC1ZCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gc2V0UGxhbmVGYWNlKGZhY2VJbmRleCkgewogICAgICAgICAgICBtYXNrc1t0YWdzLmRpbWVuc2lvbiArICdQb3NpdGlvbiddID0gTE9DQUxfUE9TSVRJT05TW2ZhY2VJbmRleF07CiAgICAgICAgICAgIG1hc2tzW3RhZ3MuZGltZW5zaW9uICsgJ1JvdGF0aW9uJ10gPSBMT0NBTF9ST1RBVElPTlNbZmFjZUluZGV4XTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uOmAsIHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICB9CgogICAgICAgIGlmICghdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcGFyZW50UG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbih0YWdzLnRyYW5zZm9ybWVyLCB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gcGFyZW50IHBvc2l0aW9uOmAsIHBhcmVudFBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGxldCBncmlkUG9ydGFsVHlwZTogJ2dyaWQnIHwgJ21pbmlHcmlkJyB8IG51bGwgPSBudWxsOwoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgZ3JpZFBvcnRhbFR5cGUgPSAnZ3JpZCc7CiAgICAgICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgZ3JpZFBvcnRhbFR5cGUgPSAnbWluaUdyaWQnOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBkZXRlY3RlZCBncmlkIHBvcnRhbCB0eXBlOmAsIGdyaWRQb3J0YWxUeXBlKTsKICAgICAgICB9CgogICAgICAgIGlmICghZ3JpZFBvcnRhbFR5cGUpIHsKICAgICAgICAgICAgc2V0UGxhbmVGYWNlKDApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBjYW1lcmFQb3NpdGlvbiA9IG9zLmdldENhbWVyYVBvc2l0aW9uKGdyaWRQb3J0YWxUeXBlKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBjYW1lcmEgcG9zaXRpb246YCwgY2FtZXJhUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGlyZWN0aW9uVG9DYW1lcmEgPSBjYW1lcmFQb3NpdGlvbi5zdWJ0cmFjdChwYXJlbnRQb3NpdGlvbikubm9ybWFsaXplKCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGlyZWN0aW9uIHRvIGNhbWVyYTpgLCBkaXJlY3Rpb25Ub0NhbWVyYSk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBwYXJlbnRSb3RhdGlvbiA9IGdldEJvdFJvdGF0aW9uKHRhZ3MudHJhbnNmb3JtZXIsIHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICBjb25zdCB3b3JsZE5vcm1hbHM6IFZlY3RvcjNbXSA9IG5ldyBBcnJheSg0KTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgICB3b3JsZE5vcm1hbHNbaV0gPSBwYXJlbnRSb3RhdGlvbi5yb3RhdGVWZWN0b3IzKExPQ0FMX05PUk1BTFNbaV0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSB3b3JsZCBub3JtYWxzOmAsIHdvcmxkTm9ybWFscyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEZpbmQgdGhlIGZhY2UgbW9zdCBmYWNpbmcgdGhlIGNhbWVyYSAobWF4IGRvdCBwcm9kdWN0KS4gCiAgICAgICAgbGV0IGJlc3RJbmRleCA9IDA7IAogICAgICAgIGxldCBiZXN0RG90ID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZOyAKICAgICAgICAKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkTm9ybWFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdCBkb3QgPSB3b3JsZE5vcm1hbHNbaV0uZG90KGRpcmVjdGlvblRvQ2FtZXJhKTsKICAgICAgICAgICAgaWYgKGRvdCA+IGJlc3REb3QpIHsKICAgICAgICAgICAgICAgIGJlc3REb3QgPSBkb3Q7IAogICAgICAgICAgICAgICAgYmVzdEluZGV4ID0gaTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gYmVzdCBmYWNlIGluZGV4OmAsIGJlc3RJbmRleCk7CiAgICAgICAgfQoKICAgICAgICBzZXRQbGFuZUZhY2UoYmVzdEluZGV4KTsKICAgIH0pLAogICAgLi4ucmVzdAp9Cgpjb25zdCBmYWNlUGxhbmVCb3QgPSBjcmVhdGUoZmFjZVBsYW5lTW9kKTsKCnJldHVybiBmYWNlUGxhbmVCb3Q7JwCosNzQB7KoAwhhYklnbm9yZQIEAKiw3NAHvdkDBHRydWUnAKiw3NAHsqgDC2FiSW50ZXJmYWNlAgQAqLDc0AfC2QMEdHJ1ZScAqLDc0AeyqAMGc3lzdGVtAgQAqLDc0AfH2QMYYWIuaW50ZXJmYWNlLmJvdF9mYWN0b3J5JwCosNzQB7KoAxZhYkNyZWF0ZUJpbGxib2FyZExhYmVsAgQAqLDc0Afg2QONRUBsZXQgeyAKICAgIGJvdCwKICAgIGRpbWVuc2lvbiwKICAgIHByZXNlcnZlTmV3TGluZXMgPSB0cnVlLAogICAgbGFiZWwgPSAnJywKICAgIHNwYWNlID0gJ3RlbXBMb2NhbCcsCiAgICBjb2xvciA9ICd3aGl0ZScsCiAgICBsYWJlbENvbG9yID0gJ2JsYWNrJywKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge307CgppZiAodHlwZW9mIGxhYmVsICE9PSAnc3RyaW5nJykgewogICAgbGFiZWwgPSBTdHJpbmcobGFiZWwpOwp9Cgphc3NlcnQobGlua3MudXRpbHMuaXNCb3QoYm90KSwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3QgaXMgYSByZXF1aXJlZCBCb3QgcGFyYW1ldGVyLmApOwphc3NlcnQoZGltZW5zaW9uLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRpbWVuc2lvbiBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKYXNzZXJ0KHJlc3Qub25DcmVhdGUgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25BbnlCb3RzQ2hhbmdlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkFueUJvdHNSZW1vdmVkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LnVwZGF0ZUxhYmVsID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LmxhYmVsV29yZFdyYXBNb2RlID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbGFiZWxXb3JkV3JhcE1vZGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CgovLyAtLS0gMSkgV29yZCBicmVha2luZyAod3JhcCBieSB3b3JkcywgY2h1bmsgbG9uZyB3b3JkcykgLS0tCmZ1bmN0aW9uIGJyZWFrV29yZHNUb0xpbmVzKHRleHQsIG1heENvbHMgPSAxOCkgewogICAgaWYgKCF0ZXh0KSByZXR1cm4gWycnXTsKICAgIGNvbnN0IHdvcmRzID0gdGV4dC5zcGxpdCgvXHMrLykuZmlsdGVyKEJvb2xlYW4pOwogICAgY29uc3QgbGluZXMgPSBbXTsKICAgIGxldCBsaW5lID0gJyc7CgogICAgY29uc3QgcHVzaCA9ICgpID0+IHsgbGluZXMucHVzaChsaW5lKTsgbGluZSA9ICcnOyB9OwoKICAgIGZvciAoY29uc3QgdyBvZiB3b3JkcykgewogICAgICAgIGlmICh3Lmxlbmd0aCA+IG1heENvbHMpIHsKICAgICAgICAgICAgLy8gY2xvc2UgY3VycmVudCBsaW5lIChpZiBhbnkpIGJlZm9yZSBjaHVua2luZyBhIGxvbmcgd29yZAogICAgICAgICAgICBpZiAobGluZSkgcHVzaCgpOwogICAgICAgICAgICAvLyBjaHVuayB0aGUgbG9uZyB3b3JkCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdy5sZW5ndGg7IGkgKz0gbWF4Q29scykgewogICAgICAgICAgICAgICAgbGluZXMucHVzaCh3LnNsaWNlKGksIGkgKyBtYXhDb2xzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZSA9ICcnOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgewogICAgICAgICAgICBsaW5lID0gdzsKICAgICAgICB9IGVsc2UgaWYgKGxpbmUubGVuZ3RoICsgMSArIHcubGVuZ3RoIDw9IG1heENvbHMpIHsKICAgICAgICAgICAgbGluZSArPSAnICcgKyB3OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHB1c2goKTsKICAgICAgICAgICAgbGluZSA9IHc7CiAgICAgICAgfQogICAgfQogICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoKCk7CgogICAgcmV0dXJuIGxpbmVzLmxlbmd0aCA/IGxpbmVzIDogWycnXTsKfQoKLy8gUHJlc2VydmVzIGV4aXN0aW5nIFxuIGFzIGhhcmQgYnJlYWtzOyB3cmFwcyB3aXRoaW4gZWFjaCBoYXJkIGxpbmUuCmZ1bmN0aW9uIGJyZWFrV29yZHNUb0xpbmVzUHJlc2VydmVOZXdsaW5lcyh0ZXh0LCBtYXhDb2xzID0gMTgpIHsKICBpZiAodGV4dCA9PSBudWxsKSByZXR1cm4gWycnXTsKCiAgLy8gU3BsaXQgb24gcmVhbCBuZXdsaW5lczsga2VlcCBlbXB0eSBsaW5lcyBzbyB3ZSBwcmVzZXJ2ZSBibGFuayBsaW5lcy4KICBjb25zdCBoYXJkTGluZXMgPSBTdHJpbmcodGV4dCkuc3BsaXQoL1xyP1xuLyk7CiAgY29uc3Qgb3V0ID0gW107CgogIC8vIEhlbHBlciB0byB3cmFwIGEgc2luZ2xlIGhhcmQgbGluZSBieSB3b3JkcyAod2l0aCBsb25nLXdvcmQgY2h1bmtpbmcpCiAgY29uc3Qgd3JhcE9uZSA9IChzcmMpID0+IHsKICAgIC8vIE5vcm1hbGl6ZSB0YWJzIC0+IHNwYWNlczsgY29sbGFwc2UgaW50ZXJuYWwgd2hpdGVzcGFjZSAobm90IG5ld2xpbmVzKQogICAgY29uc3QgcyA9IHNyYy5yZXBsYWNlKC9cdC9nLCAnICAgICcpLnJlcGxhY2UoL1xzKy9nLCAnICcpLnRyaW0oKTsKICAgIGlmICghcy5sZW5ndGgpIHsgb3V0LnB1c2goJycpOyByZXR1cm47IH0KCiAgICBjb25zdCB3b3JkcyA9IHMuc3BsaXQoJyAnKTsKICAgIGxldCBsaW5lID0gJyc7CgogICAgY29uc3QgcHVzaExpbmUgPSAoKSA9PiB7IG91dC5wdXNoKGxpbmUpOyBsaW5lID0gJyc7IH07CgogICAgLy8gY2h1bmsgbG9uZyB3b3JkcyB0byBlbXVsYXRlICdicmVha1dvcmRzJwogICAgY29uc3QgY2h1bmtXb3JkID0gKHcpID0+IHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3Lmxlbmd0aDsgaSArPSBtYXhDb2xzKSB7CiAgICAgICAgY29uc3QgY2h1bmsgPSB3LnNsaWNlKGksIGkgKyBtYXhDb2xzKTsKICAgICAgICBpZiAoIWxpbmUubGVuZ3RoKSBsaW5lID0gY2h1bms7CiAgICAgICAgZWxzZSB7IHB1c2hMaW5lKCk7IGxpbmUgPSBjaHVuazsgfQogICAgICB9CiAgICB9OwoKICAgIGZvciAoY29uc3QgdyBvZiB3b3JkcykgewogICAgICBpZiAody5sZW5ndGggPiBtYXhDb2xzKSB7CiAgICAgICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoTGluZSgpOwogICAgICAgIGNodW5rV29yZCh3KTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIWxpbmUubGVuZ3RoKSB7CiAgICAgICAgbGluZSA9IHc7CiAgICAgIH0gZWxzZSBpZiAobGluZS5sZW5ndGggKyAxICsgdy5sZW5ndGggPD0gbWF4Q29scykgewogICAgICAgIGxpbmUgKz0gJyAnICsgdzsKICAgICAgfSBlbHNlIHsKICAgICAgICBwdXNoTGluZSgpOwogICAgICAgIGxpbmUgPSB3OwogICAgICB9CiAgICB9CiAgICBpZiAobGluZS5sZW5ndGgpIHB1c2hMaW5lKCk7CiAgfTsKCiAgZm9yIChjb25zdCBobCBvZiBoYXJkTGluZXMpIHsKICAgIHdyYXBPbmUoaGwpOyAgICAgICAgICAgLy8gd3JhcCB3aXRoaW4gdGhpcyBoYXJkIGxpbmUKICB9CgogIC8vIElmIHRoZSBpbnB1dCBlbmRlZCB3aXRoIGEgdHJhaWxpbmcgbmV3bGluZSwgd2UgYWxyZWFkeSBwcmVzZXJ2ZWQgaXQKICAvLyBiZWNhdXNlIHNwbGl0IGtlcHQgYW4gZW1wdHkgbGFzdCBpdGVtIC0+IGJlY2FtZSBhbiBlbXB0eSB3cmFwcGVkIGxpbmUuCiAgcmV0dXJuIG91dC5sZW5ndGggPyBvdXQgOiBbJyddOwp9CgovLyAtLS0gMikgU2ltcGxlIHNpemluZyBmcm9tIGxpbmVzIC0tLQovLyBUaGluayBvZiAiY29sc1BlclNjYWxlWCIgYXMgImFib3V0IE4gY2hhcmFjdGVycyBwZXIgMSBzY2FsZVgiLgpmdW5jdGlvbiBjb21wdXRlU2ltcGxlU2NhbGVzRnJvbUxpbmVzKGxpbmVzLCB7CiAgICBjb2xzUGVyU2NhbGVYID0gMi41LAogICAgbWluU2NhbGVYID0gMS4yNSwKICAgIG1heFNjYWxlWCA9IDEwLAogICAgYmFzZVNjYWxlWSA9IDEuMiwKICAgIHBlckxpbmVZID0gMC43NSwKfSA9IHt9KSB7CiAgICBjb25zdCBsb25nZXN0ID0gbGluZXMucmVkdWNlKChtLCBsKSA9PiBNYXRoLm1heChtLCBsLmxlbmd0aCksIDApOwogICAgY29uc3QgbGluZUNvdW50ID0gTWF0aC5tYXgoMSwgbGluZXMubGVuZ3RoKTsKCiAgICAvLyBXaWR0aCBzY2FsZXMgd2l0aCB0aGUgbG9uZ2VzdCBsaW5lIGxlbmd0aAogICAgbGV0IHNjYWxlWCA9IGxvbmdlc3QgPiAwID8gKGxvbmdlc3QgLyBjb2xzUGVyU2NhbGVYKSA6IG1pblNjYWxlWDsKICAgIHNjYWxlWCA9IE1hdGgubWF4KG1pblNjYWxlWCwgTWF0aC5taW4obWF4U2NhbGVYLCBzY2FsZVgpKTsKCiAgICAvLyBIZWlnaHQgZ3Jvd3MgcGVyIGxpbmU7IGtlZXAgaXQgc2ltcGxlIGFuZCBwcmVkaWN0YWJsZQogICAgY29uc3Qgc2NhbGVZID0gTWF0aC5tYXgoYmFzZVNjYWxlWSwgYmFzZVNjYWxlWSArIChsaW5lQ291bnQgLSAxKSAqIHBlckxpbmVZKTsKCiAgICByZXR1cm4geyBzY2FsZVgsIHNjYWxlWSwgbG9uZ2VzdCwgbGluZUNvdW50IH07Cn0KCgovLyBQaWNrIHlvdXIgdGFyZ2V0ICJjb2x1bW5zIiBwZXIgbGluZSAodHdlYWsgdG8gdGFzdGUpCmNvbnN0IE1BWF9DT0xTID0gMzI7CgovLyBCcmVhayB0aGUgdGV4dCB5b3Vyc2VsZgpjb25zdCBsaW5lcyA9IHByZXNlcnZlTmV3TGluZXMgPyBicmVha1dvcmRzVG9MaW5lc1ByZXNlcnZlTmV3bGluZXMobGFiZWwsIE1BWF9DT0xTKSA6IGJyZWFrV29yZHNUb0xpbmVzKGxhYmVsLCBNQVhfQ09MUyk7CmNvbnN0IHdyYXBwZWRMYWJlbCA9IGxpbmVzLmpvaW4oJ1xuJyk7CgovLyBDb21wdXRlIHNpbXBsZSBzY2FsZXMgZnJvbSB0aGUgd3JhcHBlZCB0ZXh0CmNvbnN0IHsgc2NhbGVYLCBzY2FsZVkgfSA9IGNvbXB1dGVTaW1wbGVTY2FsZXNGcm9tTGluZXMobGluZXMpOwoKbGV0IGxhYmVsTW9kID0gewogICAgc3BhY2U6IHNwYWNlLAogICAgdHJhY2tCb3RJZDogYm90LmlkLAogICAgZm9ybTogJ3Nwcml0ZScsCiAgICBjb2xvciwKICAgIGxhYmVsOiB3cmFwcGVkTGFiZWwsCiAgICBsYWJlbENvbG9yLAogICAgbGFiZWxTaXplOiAxLAogICAgbGFiZWxQYWRkaW5nWDogMC41LAogICAgbGFiZWxXb3JkV3JhcE1vZGU6ICdub25lJywKICAgIHNjYWxlWCwgCiAgICBzY2FsZVksCiAgICBzY2FsZVo6IDAuMSwKICAgIGJvdExhYmVsTWFyZ2luOiAxLAogICAgYW5jaG9yUG9pbnQ6ICfinqHvuI8wLC0wLjUsMCcsCiAgICBvcmllbnRhdGlvbk1vZGU6ICdiaWxsYm9hcmQnLAogICAgZGltZW5zaW9uOiBkaW1lbnNpb24sCiAgICBkZWJ1ZzogZmFsc2UsCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBvbkNyZWF0ZTogYEAKICAgICAgICAvLyBXYWl0IGZvciByZXF1aXJlZCBib3RzIHRvIGJlIHJlYWR5LgogICAgICAgIGxldCB3YWl0VGltZSA9IDA7CgogICAgICAgIHdoaWxlKCFnbG9iYWxUaGlzLmFiKSB7CiAgICAgICAgICAgIGlmICh3YWl0VGltZSA+PSA1MDAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IG9zLnNsZWVwKDI1MCk7CiAgICAgICAgICAgIHdhaXRUaW1lICs9IDI1MDsKICAgICAgICB9CgogICAgICAgIHRhZ3MucmVhZHkgPSB0cnVlOwogICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgIGAsCiAgICBvbkFueUJvdHNDaGFuZ2VkOiBgQAogICAgICAgIGZvciAoY29uc3QgY2hhbmdlZCBvZiB0aGF0KSB7CiAgICAgICAgICAgIGlmIChjaGFuZ2VkLmJvdCAmJiBjaGFuZ2VkLmJvdC5pZCA9PT0gdGFncy50cmFja0JvdElkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvbmx5Um90YXRpb25UYWdzID0gY2hhbmdlZC50YWdzLmV2ZXJ5KCh0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZW5kc1dpdGgoJ1JvdGF0aW9uJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25YJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25ZJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25aJykKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIG9ubHlSb3RhdGlvblRhZ3M6Jywgb25seVJvdGF0aW9uVGFncyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG9ubHlSb3RhdGlvblRhZ3MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgYCwKICAgIG9uQW55Qm90c1JlbW92ZWQ6IGBACgogICAgICAgIGlmICh0aGF0LmJvdElEcy5pbmNsdWRlcyh0YWdzLnRyYWNrQm90SWQpKSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgfQogICAgYCwKICAgIG9uUG9ydGFsQ2hhbmdlZDogYEAKICAgICAgICBpZiAodGhhdC5kaW1lbnNpb24gPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgICAgICB9CiAgICBgLAogICAgdXBkYXRlTGFiZWw6IGBACiAgICAgICAgaWYgKCF0YWdzLnJlYWR5KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JpbmcgdXBkYXRlTGFiZWwgYmVjYXVzZSBub3QgcmVhZHknKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGhhc0xhYmVsID0gdGFncy5sYWJlbCAhPSBudWxsICYmIHRhZ3MubGFiZWwgIT09ICcnOwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gaGFzTGFiZWw7CgogICAgICAgIGlmICghaGFzTGFiZWwpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JlIHVwZGF0ZUxhYmVsIGNhbGwsIHRoZXJlIGlzIG5vIGxhYmVsIHRhZyB2YWx1ZSB0byBkaXNwbGF5LicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBpbk1hcFBvcnRhbCA9IChjb25maWdCb3QudGFncy5tYXBQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBjb25zdCBpbkdyaWRQb3J0YWwgPSAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKCFpbk1hcFBvcnRhbCAmJiAhaW5HcmlkUG9ydGFsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yZSB1cGRhdGVMYWJlbCBjYWxsLCBub3QgaW4gZWl0aGVyIGdyaWQgb3IgbWFwIHBvcnRhbC4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCB0cmFja0JvdCA9IGdldEJvdCgnaWQnLCB0YWdzLnRyYWNrQm90SWQpOwogICAgICAgIGNvbnN0IHRyYWNrUG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbih0cmFja0JvdCwgdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIHRyYWNrUG9zaXRpb246JywgdHJhY2tQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICBsZXQgbGFiZWxQb3NpdGlvbiA9IHsgeDogdHJhY2tQb3NpdGlvbi54LCB5OiB0cmFja1Bvc2l0aW9uLnksIHo6IHRyYWNrUG9zaXRpb24ueiB9OyAKCiAgICAgICAgY29uc3QgdHJhY2tCb3RTY2FsZSA9IHRyYWNrQm90LnRhZ3Muc2NhbGUgPz8gMTsKICAgICAgICBjb25zdCB0cmFja0JvdFNjYWxlWiA9IHRyYWNrQm90LnRhZ3Muc2NhbGVaID8/IDE7CgogICAgICAgIGxldCBtZXRlcnNQZXJHcmlkVW5pdCA9IDE7CgogICAgICAgIGlmIChpbk1hcFBvcnRhbCkgewogICAgICAgICAgICAvLyBTY2FsZSB0byBtYXAgcG9ydGFsIHVuaXRzLgogICAgICAgICAgICBtZXRlcnNQZXJHcmlkVW5pdCA9IDEwOwogICAgICAgIH0KCiAgICAgICAgbGV0IHRyYWNrQm90UmVhbFNjYWxlWiA9ICh0cmFja0JvdFNjYWxlWiAqIHRyYWNrQm90U2NhbGUpICogbWV0ZXJzUGVyR3JpZFVuaXQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gdHJhY2tCb3RSZWFsU2NhbGVaOicsIHRyYWNrQm90UmVhbFNjYWxlWik7CiAgICAgICAgfQoKICAgICAgICBsYWJlbFBvc2l0aW9uLnogKz0gdHJhY2tCb3RSZWFsU2NhbGVaICsgKHRhZ3MuYm90TGFiZWxNYXJnaW4gKiBtZXRlcnNQZXJHcmlkVW5pdCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gbGFiZWxQb3NpdGlvbjonLCBsYWJlbFBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWCddID0gbGFiZWxQb3NpdGlvbi54OwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWSddID0gbGFiZWxQb3NpdGlvbi55OwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWiddID0gbGFiZWxQb3NpdGlvbi56OwogICAgYAp9OwoKbGFiZWxNb2QgPSB7CiAgICAuLi5sYWJlbE1vZCwKICAgIC4uLnJlc3QsCn0KCmNvbnN0IGxhYmVsQm90ID0gY3JlYXRlKGxhYmVsTW9kKTsKCnJldHVybiBsYWJlbEJvdDsnAKiw3NAHsqgDBXV0aWxzAgQAqLDc0AfqngQo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAqLDc0AeyqAMEZm9ybQIEAKiw3NAHkZ8EB25vdGhpbmcnAKiw3NAHsqgDCWFiVmVyc2lvbgIEAKiw3NAHmZ8EBTEwLjM1AA=="}]}