{"version":2,"updates":[{"id":0,"timestamp":1761767408018,"update":"AewBp9rr9gUAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwCn2uv2BQAKYWJJRE9yaWdpbgIEAKfa6/YFAQ10b29sYm94X3NraWxsJwCn2uv2BQALYWJJbnRlcmZhY2UCBACn2uv2BQ8EdHJ1ZScAp9rr9gUAC2Rlc2NyaXB0aW9uAgQAp9rr9gUUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwCn2uv2BQAEZm9ybQIEAKfa6/YFPgdub3RoaW5nJwCn2uv2BQAEbWVudQIEAKfa6/YFRijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCn2uv2BQAGc3lzdGVtAgQAp9rr9gVtFGFiLmludGVyZmFjZS50b29sYm94JwCn2uv2BQAKYWJJRFN0dWRpbwIEAKfa6/YFggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwCn2uv2BQAIcmVtZW1iZXICBACn2uv2BacBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAKfa6/YFAAt0b29sYm94X2FkZAIEAKfa6/YFzgHlC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgiYmFzZVNraWxsIiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIGF3YWl0IG9zLnNsZWVwKDIwMCk7CiAgICAgICAgbWVudUJvdC5vblBvaW50ZXJVcCgpOwogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScAp9rr9gUABWxlYXJuAgQAp9rr9gW0DSjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCn2uv2BQAFc3RvcmUCBACn2uv2BdsNKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAKfa6/YFAAZzZWFyY2gCBACn2uv2BYIOKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAKfa6/YFAAhhYklnbm9yZQIEAKfa6/YFqQ4EdHJ1ZScAp9rr9gUACWFiVmVyc2lvbgIEAKfa6/YFrg4FMTAuMjknAKfa6/YFAA1tYW5pZmVzdGF0aW9uAgQAp9rr9gW0Dijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCn2uv2BQAQYWJHcmlkTWVudUFjdGlvbgIEAKfa6/YF2w65C0AvLyBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKLy8gY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCi8vIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAovLyAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKLy8gICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyBgOwovLyB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACi8vICAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewovLyAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7Ci8vICAgICB9Ci8vIGA7Ci8vIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IGBACi8vICAgICB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKLy8gICAgIHRoaXNCb3QubWFza3Mub25LZXlEb3duID0gbnVsbDsKLy8gICAgIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IG51bGw7Ci8vIGA7CgovLyBjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKLy8gY29uc3QgbWVudUJvdCA9IHt9OwoKLy8gbWVudUJvdC5hYk1lbnUgPSB0cnVlOwovLyBtZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Ci8vIG1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwovLyBtZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwovLyBtZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOwovLyBtZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247Ci8vIG1lbnVCb3Qub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIudG9vbGJveF9hZGQoe3Rvb2xib3hEYXRhOiB0YWdzLnRvb2xib3hfZGF0YSwgZ3JpZERhdGE6IHRhZ3MuZ3JpZERhdGF9KTsgc2hvdXQoImFiTWVudVJlZnJlc2giKTtgOwoKLy8gZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykKLy8gewovLyAgICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOwovLyAgICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsKCi8vICAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7Ci8vICAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7CgovLyAgICAgaWYgKCFleHRhbnRCb3QpCi8vICAgICB7Ci8vICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJvdCk7Ci8vICAgICB9Ci8vIH0nAKfa6/YFABRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAKfa6/YFlRriAkBjb25zdCB0b29sYm94QXJyYXkgPSBhYlJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKCmxldCBhbGxUb29sc0xvYWRlZCA9IHRydWU7Cgpmb3IgKGxldCBpID0gMDsgaSA8IHRvb2xib3hBcnJheS5sZW5ndGg7IGkrKykgewogICAgY29uc3QgY3VycmVudFRvb2wgPSB0b29sYm94QXJyYXlbaV0ubmFtZTsKCiAgICBpZiAoIWdldEJvdCgiYWJJRE9yaWdpbiIsIGN1cnJlbnRUb29sKSAmJiAhZ2V0Qm90KGN1cnJlbnRUb29sLCB0cnVlKSkgewogICAgICAgIGFsbFRvb2xzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChhbGxUb29sc0xvYWRlZCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfScAp9rr9gUADmFiR3JpZE1lbnVJY29uAgQAp9rr9gX4HApsb2NhbF9tYWxsJwCn2uv2BQAPYWJHcmlkTWVudUxhYmVsAgQAp9rr9gWDHQ5jYXN1YWwgY2F0YWxvZycAp9rr9gUAE2FiR3JpZE1lbnVTb3J0T3JkZXICBACn2uv2BZIdATMnAKfa6/YFAA9vbkFCSW5pdGlhbGl6ZWQCBACn2uv2BZQdKkAvLyBsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOycAp9rr9gUADW9uU2tpbGxVcGRhdGUCBACn2uv2Bb8dV0BsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOw0KDQpjb25zb2xlLmxvZygiW1Rvb2xib3hdIExvYWRpbmcgY2FzdWFsIGtpdCIpOycAp9rr9gUACnNoZWxsVXRpbHMCBACn2uv2BZceKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAKfa6/YFABhhYkdyaWRNZW51T25CZWZvcmVDcmVhdGUCBACn2uv2Bb4e/AhAaWYgKGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSkgew0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiR3JpZE1lbnVMYWJlbCIsIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSk7DQp9DQoNCg0KLy9ORVcNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsNCg0KZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykNCnsNCiAgICBjb25zdCBtZW51Qm90ID0ge307DQoNCiAgICBtZW51Qm90LmFiTWVudSA9IHRydWU7DQogICAgbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KICAgIG1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOw0KICAgIG1lbnVCb3QubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7DQogICAgbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsNCiAgICBtZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247DQogICAgbWVudUJvdC5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7DQogICAgDQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7DQogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOw0KDQogICAgaWYgKCFleHRhbnRCb3QpDQogICAgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtZW51Qm90KTsNCiAgICB9DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAp9rr9gUAEmFiR3JpZE1lbnVJdGVtVHlwZQIEAKfa6/YFuycIZHJvcGRvd24nAKfa6/YFABFkcm9wZG93blNvcnRPcmRlcgIEAKfa6/YFxCcBMycAp9rr9gUAD2Ryb3Bkb3duT3B0aW9ucwIEAKfa6/YFxicG8J+nrFtdJwEEYm90cyQxNzQxMGQ4My03ZWVlLTRhMWUtYjYzOC02NTQ2Mzc0ZDE3YzMBJwCn2uv2BcsnBnN5c3RlbQIEAKfa6/YFzCcRYWIuaW50ZXJmYWNlLnNjYW4nAKfa6/YFyycEZm9ybQIEAKfa6/YF3icHbm90aGluZycAp9rr9gXLJwthYkludGVyZmFjZQIEAKfa6/YF5icEdHJ1ZScAp9rr9gXLJwhhYklnbm9yZQIEAKfa6/YF6ycEdHJ1ZScAp9rr9gXLJw9vblFSQ29kZVNjYW5uZWQCBACn2uv2BfAn/Q9AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgpsZXQgcmVxdWVzdGluZ0FJID0gZmFsc2U7CmlmIChjb25maWdCb3QudGFncy5yZXF1ZXN0aW5nQUkpIHsKICAgIGNvbmZpZ0JvdC50YWdzLnJlcXVlc3RpbmdBSSA9IG51bGw7CiAgICByZXF1ZXN0aW5nQUkgPSB0cnVlOwp9CgppZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhc2siKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBpZiAocmVxdWVzdGluZ0FJKSB7CiAgICAgICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgicmVxdWVzdGluZ0FJIiwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIG9zLmdvVG9VUkwoc2Nhbm5lZFVSTC5ocmVmKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7CiAgICAgICAgICAgIGxldCBuZXdUYWcgPSBrZXk7CiAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3NbbmV3VGFnXSA9IG5ld1ZhbHVlOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuYXNrKSB7CiAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogY29uZmlnQm90LnRhZ3MuYXNrfSk7CiAgICAgICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5wYXR0ZXJuKSB7CiAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogY29uZmlnQm90LnRhZ3MucGF0dGVybn0pOwogICAgICAgIH0KICAgICAgICAKICAgIH0KfScAp9rr9gXLJwVzdG9yZQIEAKfa6/YF7jco8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAp9rr9gXLJwZzZWFyY2gCBACn2uv2BZU4KPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAKfa6/YFyycQYWJDb3JlTWVudUFjdGlvbgIEAKfa6/YFvDg3QG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7Cgpjb25maWdCb3QudGFncy5hYlNjYW4gPSB0cnVlOycAp9rr9gXLJw9hYkNvcmVNZW51TGFiZWwCBACn2uv2BfQ4BHNjYW4nAKfa6/YFyycOYWJDb3JlTWVudUljb24CBACn2uv2Bfk4D3FyX2NvZGVfc2Nhbm5lcicAp9rr9gXLJxNhYkNvcmVNZW51U29ydE9yZGVyAgQAp9rr9gWJOQEzJwCn2uv2BcsnCWFiVmVyc2lvbgIEAKfa6/YFizkFMTAuMjknAQRib3RzJDNhNmNiOWNhLWIzYjQtNGQ3Ny04MmY2LWZhNTliNTI5NmVjOQEnAKfa6/YFkTkGc3lzdGVtAgQAp9rr9gWSORdhYi5pbnRlcmZhY2UubmF2aWdhdGlvbicAp9rr9gWROQhhYklnbm9yZQIEAKfa6/YFqjkEdHJ1ZScAp9rr9gWROQ9kcm9wZG93bk9wdGlvbnMCBACn2uv2Ba85BvCfp6xbXScAp9rr9gWRORJhYkNvcmVNZW51SXRlbVR5cGUCBACn2uv2BbQ5CGRyb3Bkb3duJwCn2uv2BZE5EWRyb3Bkb3duU29ydE9yZGVyAgQAp9rr9gW9OQRhdXRvJwCn2uv2BZE5GGFiQ29yZU1lbnVPbkJlZm9yZUNyZWF0ZQIEAKfa6/YFwjn+IEBjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgY3VycmVudERpbSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQpjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KDQovLyBpZiAoY3VycmVudFBvcnRhbCAhPSAnbWFwJykgew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KLy8gfSBlbHNlIHsNCi8vICAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQovLyB9DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk5hdmlnYXRpb25NZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5za2lsbEJvdCA9IGdldExpbmsodGhpc0JvdCk7DQoNCmNvbnN0IGhvbWVXb3JsZEJ1dHRvbiA9IHsNCiAgICAuLi5tZW51T3B0aW9ucywNCiAgICBsYWJlbDogImhvbWUgd29ybGQiLA0KICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1LzM4YWU4YjY5NTdmNDQ4M2Q4NzE2MTQxZDFlOThjOTNmMGU3ZGNjZTE1YmM1YzEyM2JkMGU5ZTFhYjY4N2NjMDUucG5nJywNCiAgICBvbkNsaWNrOiBgQA0KICAgICAgICBjb25zdCBjdXJyZW50VVJMID0gbmV3IFVSTChjb25maWdCb3QudGFncy51cmwpOw0KICAgICAgICBjb25zdCBvcmlnaW4gPSBjdXJyZW50VVJMLm9yaWdpbjsNCg0KICAgICAgICBsZXQgbmV3VVJMID0gbmV3IFVSTChvcmlnaW4pOw0KDQogICAgICAgIGlmIChhYlJlbWVtYmVyLnRhZ3MuYWxsb3dDaGFubmVscykgew0KICAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImNoYW5uZWwiLCBmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuY29tSWQpIHsNCiAgICAgICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJjb21JZCIsIGNvbmZpZ0JvdC50YWdzLmNvbUlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJvd25lciIsIChjb25maWdCb3QudGFncy5zdHVkaW8gJiYgY29uZmlnQm90LnRhZ3Muc3R1ZGlvICE9IGF1dGhCb3QuaWQpID8gY29uZmlnQm90LnRhZ3Muc3R1ZGlvIDogInBsYXllciIpOw0KICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiaW5zdCIsICdob21lJyk7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJtYXBQb3J0YWwiLCAnaG9tZScpOw0KICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiYXNrIiwgJ2hvbWUnKTsNCiAgICAgICAgDQogICAgICAgIGlmIChjb25maWdCb3QudGFncy5zdHVkaW8gJiYgY29uZmlnQm90LnRhZ3Muc3R1ZGlvICE9IGF1dGhCb3QuaWQpIHsNCiAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoInN0dWRpbyIsIHRoYXQuaWQpOyANCiAgICAgICAgfQ0KDQogICAgICAgIG9zLm9wZW5VUkwobmV3VVJMLmhyZWYpOw0KICAgIGANCn07DQoNCmlmICghZ2V0Qm90KCJpc0hvbWVXb3JsZENvcmUiLCB0cnVlKSAmJiBhdXRoQm90KSB7DQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZVdvcmxkQnV0dG9uKTsNCn0NCg0KaWYgKGN1cnJlbnRQb3J0YWwgPT0gJ21hcCcpIHsNCg0KICAgIGNvbnN0IGhvbWVCYXNlQm90ID0gZ2V0Qm90KCJob21lQmFzZSIsIHRydWUpOw0KDQogICAgaWYgKGhvbWVCYXNlQm90KSB7DQogICAgICAgIGNvbnN0IGhvbWVCdXR0b24gPSB7DQogICAgICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgICAgIGxhYmVsOiBob21lQmFzZUJvdC50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2h0dHBzOi8vYXV0aC1hdXgtZGV2LWZpbGVzYnVja2V0LTY4MjM5NzY5MDY2MC5zMy5hbWF6b25hd3MuY29tLzMxOGMwNGYxLTEzOTEtNGMxMC04ZDQzLWFhZWJjNTE3MDI2NS9jZDM4YWZmYzA2MDRiZWFhNTg4ZGEyMWFhMWJlNzUwYmIzZTczYjNiM2NhZTIzZWIzMDMwN2MzNDQ5NDQ1OWYzLnBuZycsDQogICAgICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgICAgIGNvbnN0IGhvbWVCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgaWYgKGhvbWVCb3QpIHsNCiAgICAgICAgICAgICAgICAgICAgb3MuZm9jdXNPbihob21lQm90LCB7IHpvb206IDIwMDAgfSkuY2F0Y2goKCkgPT4ge30pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgYA0KICAgICAgICB9Ow0KDQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGhvbWVCdXR0b24pOw0KICAgIH0NCg0KICAgIGNvbnN0IHBsYWNlc0FyciA9IFtdOw0KICAgIGNvbnN0IHBsYWNlcyA9IGdldEJvdHMoImhvbWVQbGFjZSIsIHRydWUpOw0KICAgIGZvciAoY29uc3QgaFBsYWNlIG9mIHBsYWNlcykgew0KICAgICAgICBpZiAoaFBsYWNlLnRhZ3MuaG9tZUJhc2UgPT0gdHJ1ZSkgew0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgcGxhY2VPYmogPSB7DQogICAgICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgICAgIGxhYmVsOiBoUGxhY2UudGFncy5wbGFjZUxhYmVsLA0KICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdsb2NhdGlvbl9vbicsDQogICAgICAgICAgICBwbGFjZTogZ2V0TGluayhoUGxhY2UpLA0KICAgICAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgICAgICBpZiAobGlua3MucGxhY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgb3MuZm9jdXNPbihsaW5rcy5wbGFjZSwgeyB6b29tOiAyMDAwIH0pLmNhdGNoKGUgPT4ge30pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgICAgIGANCiAgICAgICAgfQ0KDQogICAgICAgIHBsYWNlc0Fyci5wdXNoKHBsYWNlT2JqKTsNCiAgICB9DQoNCiAgICBwbGFjZXNBcnIuc29ydCgoYSwgYikgPT4gew0KICAgICAgICBjb25zdCBuYW1lQSA9IGEubGFiZWwudG9VcHBlckNhc2UoKTsNCiAgICAgICAgY29uc3QgbmFtZUIgPSBiLmxhYmVsLnRvVXBwZXJDYXNlKCk7DQoNCiAgICAgICAgaWYgKG5hbWVBIDwgbmFtZUIpIHsNCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobmFtZUEgPiBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIDA7DQogICAgfSk7DQoNCiAgICBmb3IgKGNvbnN0IHNvcnRlZFBsYWNlIG9mIHBsYWNlc0Fycikgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChzb3J0ZWRQbGFjZSk7DQogICAgfQ0KDQoNCiAgICBjb25zdCBjdXJyZW50TG9jYXRpb25CdXR0b24gPSB7DQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBsYWJlbDogJ2N1cnJlbnQgbG9jYXRpb24nLA0KICAgICAgICBmb3JtQWRkcmVzczogJ25lYXJfbWUnLA0KICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgbGlua3Muc2tpbGxCb3QuZ29Ub0N1cnJlbnRMb2NhdGlvbigpOw0KICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgYA0KICAgIH0NCg0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGN1cnJlbnRMb2NhdGlvbkJ1dHRvbik7DQp9DQoNCmlmIChkcm9wZG93bk9wdGlvbnMubGVuZ3RoID09IDApIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gdHJ1ZTsNCn0gZWxzZSB7DQogICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IGZhbHNlOw0KfQ0KDQptYXNrcy5kcm9wZG93bk9wdGlvbnMgPSBkcm9wZG93bk9wdGlvbnM7DQoNCnJldHVybjsnAKfa6/YFkTkQYWJDb3JlTWVudUFjdGlvbgIEAKfa6/YFwVoDQC8vJwCn2uv2BZE5C2FiSW50ZXJmYWNlAgQAp9rr9gXFWgR0cnVlJwCn2uv2BZE5D2FiQ29yZU1lbnVMYWJlbAIEAKfa6/YFyloJcGxhY2UgbmF2JwCn2uv2BZE5BGZvcm0CBACn2uv2BdRaB25vdGhpbmcnAKfa6/YFkTkTZ29Ub0N1cnJlbnRMb2NhdGlvbgIEAKfa6/YF3FqABEBjb25zdCBsb2NhdGlvbiA9IGF3YWl0IG9zLmdldEdlb2xvY2F0aW9uKCk7DQoNCmlmIChsb2NhdGlvbi5zdWNjZXNzKSB7DQogICAgY29uc3QgY3VycmVudERpbSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQogICAgY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQoNCiAgICBpZiAoY3VycmVudFBvcnRhbCAhPSAnbWFwJykgew0KICAgICAgICBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSBjdXJyZW50RGltOw0KICAgIH0NCg0KICAgIG9zLmZvY3VzT24oe3g6IGxvY2F0aW9uLmxvbmdpdHVkZSwgeTogbG9jYXRpb24ubGF0aXR1ZGV9LCB7cG9ydGFsOiAnbWFwJywgem9vbTogMjAwMH0pOw0KfSBlbHNlIHsNCiAgICBvcy50b2FzdCgiTG9jYXRpb24gc2VydmljZXMgbm90IGF2YWlsYWJsZSIpDQp9JwCn2uv2BZE5CWFiVmVyc2lvbgIEAKfa6/YF3V4FMTAuMjknAQRib3RzJDQ5M2ZmYTRkLTQ2ZDQtNGE5OC1hZTljLTEyMTJkNjUxMTMzZgEnAKfa6/YF414Gc3lzdGVtAgQAp9rr9gXkXhRhYi5pbnRlcmZhY2UudmVyc2lvbicAp9rr9gXjXg1vblNraWxsVXBkYXRlAgQAp9rr9gX5XqcBQGNvbnN0IHZlcnNpb25TdHJpbmcgPSB0YWdzLmFiSW50ZXJmYWNlTWFqb3JWZXJzaW9uICsgIi4iICsgdGFncy5hYkludGVyZmFjZU1pbm9yVmVyc2lvbjsNCg0KY29uc29sZS5sb2coIltBQkludGVyZmFjZV0gTG9hZGVkIEFCIEludGVyZmFjZSB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAKfa6/YF414XYWJJbnRlcmZhY2VNYWpvclZlcnNpb24CBACn2uv2BaFgATInAKfa6/YF414XYWJJbnRlcmZhY2VNaW5vclZlcnNpb24CBACn2uv2BaNgAjIwJwCn2uv2BeNeCGFiSWdub3JlAgQAp9rr9gWmYAR0cnVlJwCn2uv2BeNeBGZvcm0CBACn2uv2BatgB25vdGhpbmcnAKfa6/YF414LYWJJbnRlcmZhY2UCBACn2uv2BbNgBHRydWUnAKfa6/YF414JYWJWZXJzaW9uAgQAp9rr9gW4YAUxMC4yOScBBGJvdHMkNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmAScAp9rr9gW+YAZzeXN0ZW0CBACn2uv2Bb9gE2FiLmludGVyZmFjZS5udWdnZXQnAKfa6/YFvmAEZm9ybQIEAKfa6/YF02AHbm90aGluZycAp9rr9gW+YAthYkludGVyZmFjZQIEAKfa6/YF22AEdHJ1ZScAp9rr9gW+YAhhYklnbm9yZQIEAKfa6/YF4GAEdHJ1ZScAp9rr9gW+YAxhYkxvYWROdWdnZXQCBACn2uv2BeVgmAJAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldE5hbWU7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIitudWdnZXROYW1lOwpsZXQgbG9hZGVkTnVnZ2V0ID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBmb3JtYXR0ZWROdWdnZXRBQiwgYWJWZXJzaW9uOiB0aGF0LnZlcnNpb24sIHJldHVyblR5cGU6ICJkYXRhIn0pOwoKbG9hZGVkTnVnZ2V0ID0gbG9hZGVkTnVnZ2V0LnN0YXRlW251Z2dldE5hbWVdLm51Z2dldDsKCnJldHVybiBsb2FkZWROdWdnZXQ7JwCn2uv2Bb5gD2FiUHVibGlzaE51Z2dldAIEAKfa6/YF/mKMA0AvL3Nob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiAibnVnTmFtZSIsIGRhdGE6IGRhdGF9KTsgIEFERCBFR0cgSUQgRVZFTlRVQUxMWQpsZXQgdGVzdE51Z2dldCA9IHRoYXQuZGF0YTsKbGV0IGZvcm1hdHRlZE51Z2dldCA9IHtpZDogdGhhdC5udWcsIG51Z2dldDogdGVzdE51Z2dldH07CmxldCB0ZXN0TnVnZ2V0TmFtZSA9IHRoYXQubnVnOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrdGVzdE51Z2dldE5hbWU7CgptYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBmb3JtYXR0ZWROdWdnZXRBQjsKCmxpbmtzLnN0b3JlLmFiUHVibGlzaEFCKHthYjogZm9ybWF0dGVkTnVnZ2V0QUIsIHRhcmdldDogZm9ybWF0dGVkTnVnZ2V0LCBzb3VyY2VFdmVudDogJ3B1Ymxpc2hfbnVnZ2V0J30pOycAp9rr9gW+YA9pbXBsZW1lbnROdWdnZXQCBACn2uv2BYtmsQdAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldDsKbGV0IG51Z2dldFZlcnNpb25DaGVjayA9IG51Z2dldE5hbWUuaW5kZXhPZigiLnYiKTsKbGV0IHZlcnNpb247CgppZiAobnVnZ2V0VmVyc2lvbkNoZWNrICE9IC0xKQp7CiAgICBudWdnZXROYW1lID0gbnVnZ2V0TmFtZS5zdWJzdHJpbmcoMCwgbnVnZ2V0VmVyc2lvbkNoZWNrKTsKCiAgICBsZXQgdmVyc2lvbkNoZWNrID0gdGhhdC5udWdnZXQuc3Vic3RyaW5nKG51Z2dldFZlcnNpb25DaGVjayArIDIpOwoKICAgIGlmIChpc05hTih2ZXJzaW9uQ2hlY2spKQogICAgewogICAgICAgIGNvbnNvbGUubG9nKHZlcnNpb25DaGVjaywgInZlcnNpb24gaXMgbm90IGEgbnVtYmVyIik7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdmVyc2lvbiA9IE51bWJlcih2ZXJzaW9uQ2hlY2spOwogICAgfQp9CmNvbnNvbGUubG9nKG51Z2dldE5hbWUsIHZlcnNpb24pOwpsZXQgbnVnRGF0YSA9IGF3YWl0IHRoaXNCb3QuYWJMb2FkTnVnZ2V0KHtudWdnZXROYW1lOiBudWdnZXROYW1lLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7CgppZiAobnVnRGF0YSA9PSAiYWJJRCBub3QgZm91bmQiKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IG5vdCBmb3VuZCIpOwp9CmVsc2UKewogICAgbGV0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CiAgICBsZXQgdGFyZ2V0VGFnID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10udG9TdHJpbmcoKTsKICAgIGxldCB0YXJnZXROdWcgPSAieyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0VGFnLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7CiAgICBpbnNlcnRUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgbnVnRGF0YSk7Cn0nAKfa6/YFvmAMbnVnZ2V0QnV0dG9uAgQAp9rr9gW9bfUMQGxldCB0YWdWYWx1ZSA9IHRoYXQudGFnVmFsdWU7CmxldCByZWdleCA9IC9cbi9naTsKbGV0IGJyZWFrQ2hlY2s7CmxldCBicmVha0FycmF5ID0gWzBdOwovL2xldCBjcmVhdGVkQnV0dG9ucyA9IFtdOwoKd2hpbGUgKGJyZWFrQ2hlY2sgPSByZWdleC5leGVjKHRhZ1ZhbHVlKSkKewogICAgYnJlYWtBcnJheS5wdXNoKGJyZWFrQ2hlY2suaW5kZXgpOwp9CgpsZXQgbmV3TnVnZ2V0QnV0dG9uID0ge307CgpuZXdOdWdnZXRCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TnVnZ2V0QnV0dG9uLmZvcm0gPSAiY29kZUJ1dHRvbiI7Cm5ld051Z2dldEJ1dHRvbi50YXJnZXRCb3QgPSB0aGF0LmJvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldFRhZyA9IHRoYXQudGFnOwpuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAibG9hZCBudWdnZXQiOwpuZXdOdWdnZXRCdXR0b24ubnVnZ2V0UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnXSA9IHRydWU7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRNYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLmltcGxlbWVudE51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKZGVzdHJveSh0aGlzQm90KTtgOwoKZm9yIChsZXQgbnVncyA9IDA7IG51Z3MgPCB0aGF0Lm51Z2dldC5sZW5ndGg7IG51Z3MrKykKewogICAgbGV0IGN1cnJlbnROdWdnZXQgPSB0aGF0Lm51Z2dldFtudWdzXTsKICAgIC8vbGV0IGJ1dHRvbkNoZWNrID0gY3JlYXRlZEJ1dHRvbnMuaW5kZXhPZihjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwoKICAgIGlmICghY3VycmVudE51Z2dldCB8fCBjdXJyZW50TnVnZ2V0ID09IHVuZGVmaW5lZCkgLy98fCBidXR0b25DaGVjayAhPSAtMQogICAgewogICAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChjdXJyZW50TnVnZ2V0Lm51Z1B1Ymxpc2gpCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLnBhY2thZ2VOdWdnZXQoe2JvdDogdGFncy50YXJnZXRCb3QsIG51Z2dldDogdGFncy50YXJnZXROdWdnZXQsIHRhZzogdGFncy50YXJnZXRUYWd9KTsKCiAgICAgICAgZGVzdHJveSh0aGlzQm90KTtgOwoKICAgICAgICBuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAicHVibGlzaCAiICsgY3VycmVudE51Z2dldC5udWdOYW1lICsgIiBudWdnZXQiOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CgogICAgbmV3TnVnZ2V0QnV0dG9uLnRhcmdldE51Z2dldCA9IGN1cnJlbnROdWdnZXQubnVnTmFtZTsKICAgIG5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnICsgIlN0YXJ0Il0gPSBjdXJyZW50TnVnZ2V0Lm51Z1N0YXJ0OwoKICAgIGNyZWF0ZShuZXdOdWdnZXRCdXR0b24pOwoKICAgIC8vY3JlYXRlZEJ1dHRvbnMucHVzaChjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwp9CgpyZXR1cm47JwCn2uv2Bb5gC251Z2dldFBhcnNlAgQAp9rr9gWxeqcPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwCn2uv2Bb5gDW9uQUJQdWJsaXNoZWQCBACn2uv2BdmJAcEBQGNvbnNvbGUubG9nKHRoYXQuYWIsIHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQoKaWYgKHRoYXQuYWIgPT0gdGFncy5udWdnZXRUb1B1Ymxpc2gpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgcHVibGlzaGVkIik7CgogICAgbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gbnVsbDsKCiAgICBjb25maWdCb3QubWFza3MuYWJWZXJzaW9uID0gbnVsbDsKfScAp9rr9gW+YBBvbkFueUJvdHNDaGFuZ2VkAgQAp9rr9gWbiwG3BEBpZiAoY29uZmlnQm90ICYmIHRoYXRbMF0uYm90LmlkICE9IHRoaXNCb3QuaWQpIAp7CiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QpIHJldHVybjsgLy8gSWdub3JlIGlmIHRoZSBjb25maWdCb3QgaXNuJ3QgcmVhZHkgeWV0LgoKICAgIGNvbnN0IGVkaXRlZEJvdElEID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdC5yZXBsYWNlKCLwn5SXIiwgIiIpOwoKICAgIGlmICghdGhhdC5maW5kKHggPT4geC5ib3QuaWQgPT0gZWRpdGVkQm90SUQpKSByZXR1cm47IC8vIElmIHRoZSBib3QgY2hhbmdlZCB3YXNuJ3QgYmVpbmcgZWRpdGVkIGJ5IHRoZSB1c2VyIGlnbm9yZSBpdC4KCiAgICBjb25zdCBlZGl0ZWRUYWcgPSBjb25maWdCb3QudGFncy5lZGl0aW5nVGFnOwogICAgY29uc3QgZWRpdGVkQm90ID0gZ2V0Qm90KCJpZCIsIGVkaXRlZEJvdElEKTsKCiAgICBpZiAoZWRpdGVkQm90ICYmIGVkaXRlZFRhZykgCiAgICB7CiAgICAgICAgc2hvdXQoIm51Z2dldFJlc2V0Iik7CgogICAgICAgIHRoaXNCb3QubnVnZ2V0UGFyc2UoeyBlZGl0ZWRCb3QsIGVkaXRlZFRhZyB9KTsKICAgIH0KfScAp9rr9gW+YAhvbkNyZWF0ZQIEAKfa6/YF0Y8BTEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnAKfa6/YFvmANcGFja2FnZU51Z2dldAIEAKfa6/YFnpAB+AZAY29uc3QgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKY29uc3QgdGFnVGV4dCA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddOwoKaWYgKGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXggfHwgY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXgpCnsKICAgIGxldCBzdGFydFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXg7CiAgICBsZXQgZW5kUG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXg7CgogICAgaWYgKHN0YXJ0UG9zID09IGVuZFBvcykKICAgIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlIGlmIChzdGFydFBvcyA+IGVuZFBvcykKICAgIHsKICAgICAgICBsZXQgbmV3U3RhcnRQb3MgPSBlbmRQb3M7CiAgICAgICAgbGV0IG5ld0VuZFBvcyA9IHN0YXJ0UG9zOwoKICAgICAgICBzdGFydFBvcyA9IG5ld1N0YXJ0UG9zOwogICAgICAgIGVuZFBvcyA9IG5ld0VuZFBvczsKICAgIH0KCiAgICBsZXQgZGF0YSA9IHRhZ1RleHQuc3Vic3RyaW5nKHN0YXJ0UG9zLCBlbmRQb3MgKyAxKTsKCiAgICBzaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogdGhhdC5udWdnZXQsIGRhdGE6IGRhdGF9KTsKCiAgICBvcy50b2FzdCgibnVnIGlzIHB1Ymxpc2hpbmciLCAxMCk7CgogICAgbGV0IHRhcmdldE51ZyA9ICIubnVnIHsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgiY2Fubm90IHJlYWQgbnVnZ2V0IHRvIGJlIHB1Ymxpc2hlZCIpCn0nAKfa6/YFvmAIcmVtZW1iZXICBACn2uv2BZeXASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCn2uv2Bb5gBnNlYXJjaAIEAKfa6/YFvpcBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAKfa6/YFvmAFc3RvcmUCBACn2uv2BeWXASjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCn2uv2Bb5gCWxpc3RlbmluZwIEAKfa6/YFjJgBBWZhbHNlJwCn2uv2Bb5gCWFiVmVyc2lvbgIEAKfa6/YFkpgBBTEwLjI5JwEEYm90cyRiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IBJwCn2uv2BZiYARlhYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yAgQAp9rr9gWZmAHODEBjb25zdCB7CiAgICBsYWJlbCA9IGAke2FiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX0gaXMgd29ya2luZ2AsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9CgpsZXQgYnVzeUluZGljYXRvciA9IHsKICAgIG9uUG9pbnRlclVwOiBudWxsLAogICAgb25Qb2ludGVyRG93bjogbnVsbCwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBidXN5TGFiZWw6IGxhYmVsLAogICAgbGFiZWxBbGlnbm1lbnQ6ICdsZWZ0JywKICAgIHN0YXRlOiAwLAogICAgYW5pbVN0YXRlczogWwogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcnLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICBdLAogICAgYW5pbVJhdGU6IDUwMCwKICAgIG9uQm90QWRkZWQ6IGBACiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIG9uQm90Q2hhbmdlZDogYEAKICAgICAgICBjb25zdCBuZWVkUmVmcmVzaCA9IHRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2J1c3lMYWJlbCcgfHwgdCA9PT0gJ3N0YXRlJyB8fCB0ID09PSAnYW5pbVN0YXRlcycpOwogICAgICAgIGlmIChuZWVkUmVmcmVzaCkgewogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfQogICAgYCwKICAgIHJlZnJlc2hEaXNwbGF5OiBgQAogICAgICAgIGlmICh0YWdzLmFuaW1TdGF0ZXMgJiYgdGFncy5hbmltU3RhdGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgYW5pbVN0YXRlID0gdGFncy5hbmltU3RhdGVzW3RhZ3Muc3RhdGVdOwoKICAgICAgICAgICAgdGFncy5sYWJlbCA9IHRhZ3MuYnVzeUxhYmVsLnRyaW0oKSArIGFuaW1TdGF0ZS5lbGxpcHNpczsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGFuaW1TdGF0ZS5mb3JtQWRkcmVzczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLmxhYmVsIAogICAgICAgIH0KICAgIGAsCiAgICBhbmltYXRlOiBgQAogICAgICAgIGlmICh0YWdzLnN0YXRlID49IHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgKz0gMTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLnNsZWVwKHRhZ3MuYW5pbVJhdGUpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIC4uLnJlc3QKfTsKCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihidXN5SW5kaWNhdG9yKTsKCnJldHVybiBtZW51Qm90OycAp9rr9gWYmAEGc3lzdGVtAgQAp9rr9gXopAERYWIuaW50ZXJmYWNlLm1lbnUnAKfa6/YFmJgBBGZvcm0CBACn2uv2BfqkAQdub3RoaW5nJwCn2uv2BZiYAQtkZXNjcmlwdGlvbgIEAKfa6/YFgqUBJlRoaXMgc2tpbGwgaXMgZGVzaWduZWQgZm9yIG1lbnUgc3R1ZmYuKACn2uv2BZiYAQthYkludGVyZmFjZQF4JwCn2uv2BZiYAQphYk9wZW5NZW51AgQAp9rr9gWqpQG0H0Bhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBtZW51VHlwZSA9IHRoYXQgPyAiYWIiICsgdGhhdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoYXQuc2xpY2UoMSkgKyAiTWVudSI6ICJhYkNvcmVNZW51IjsgLy9zZXQgdXAgYSBjaGVjayB0byBzZWUgd2hhdCB0eXBlIG9mIG1lbnUgc2hvdWxkIGJlIG9jY3VyaW5nIFtjb3JlLCBib3QsIGdyaWQsIGluc3RdCmxldCBtZW51U2tpbGxzID0gZ2V0Qm90cyhtZW51VHlwZSArICJBY3Rpb24iKTsKbGV0IG1heE9wdGlvbnMgPSBtZW51VHlwZSA9PSAiaW5zdCIgPyA3IDogNTsKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5wZXJzb25hbGl0eSA9IHRhZ3MucGVyc29uYWxpdHk7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5iYXNlU2tpbGwuJHttZW51VHlwZSArICJBY3Rpb24ifSh7Ym90OiB0aGlzQm90fSk7YDsKCmxldCBzb3J0T3JkZXJJbmRleCA9IG1lbnVTa2lsbHMubGVuZ3RoOwpmb3IgKGxldCBpID0gMDsgaSA8IG1lbnVTa2lsbHMubGVuZ3RoOyBpKyspLy9BREQgTE9HSUMgRk9SIE1PUkUgT1BUSU9OUyBUSEFOIDUgOiBtYXhPcHRpb25zCnsKICAgIC8vQWxsb3dzIGZvciBjb2RlIHRvIGdldCBjYWxsZWQgYmVmb3JlIHRoZSBtZW51IGdlbmVyYXRlcywgdXNlZnVsIGZvciBkeW5hbWljYWxseSBzZXQgZ3JvdXBzIG9yIGRyb3Bkb3ducwogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJPbkJlZm9yZUNyZWF0ZSJdKSB7CiAgICAgICAgYXdhaXQgd2hpc3BlcihtZW51U2tpbGxzW2ldLCBtZW51VHlwZSArICJPbkJlZm9yZUNyZWF0ZSIpOwogICAgfSAKCiAgICBpZiAobWVudVNraWxsc1tpXS50YWdzW21lbnVUeXBlICsgIkhpZGUiXSkgewogICAgICAgIGNvbnRpbnVlOwogICAgfQogICAgCiAgICBsZXQgY3VycmVudFNraWxsID0gbWVudVNraWxsc1tpXTsKCiAgICBhYk1lbnVCdXR0b24uYmFzZVNraWxsID0gIvCflJciICsgY3VycmVudFNraWxsLmlkOwogICAgYWJNZW51QnV0dG9uLmxhYmVsID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiTGFiZWwiXTsKICAgIGFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkljb24iXTsKICAgIGFiTWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIk9uR2VuZXJhdGUiXTsKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJTb3J0T3JkZXIiXTsKICAgIGFiTWVudUJ1dHRvbi5jb2xvciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkNvbG9yIl0gPyBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdIDogbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7CgogICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImRyb3Bkb3duIikgewogICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93bk9wdGlvbnMgPSBjdXJyZW50U2tpbGwudGFncy5kcm9wZG93bk9wdGlvbnM7CgogICAgICAgIGNvbnN0IHByZXZEcm9wZG93biA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmxhc3RPcGVuZWREcm9wZG93bjsKICAgICAgICBpZiAocHJldkRyb3Bkb3duICYmIHByZXZEcm9wZG93bi50YWdzW21lbnVUeXBlICsgIkFjdGlvbiJdKSB7CiAgICAgICAgICAgIGlmIChwcmV2RHJvcGRvd24gPT0gY3VycmVudFNraWxsKSB7CiAgICAgICAgICAgICAgICBhYk1lbnVCdXR0b24uZGVmYXVsdE9wZW4gPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGVsZXRlIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbjsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJEZWZhdWx0T3BlbiJdID09IHRydWUpIHsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiTWVudUJ1dHRvbik7ICAgICAgICAKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiZ3JvdXAiKSB7CiAgICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5ncm91cFNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmdyb3VwU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmdyb3VwU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIGFiTWVudUJ1dHRvbi5tZW51SXRlbXMgPSBjdXJyZW50U2tpbGwudGFncy5tZW51SXRlbXM7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVHcm91cChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJpbnB1dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gInRleHQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gInRvb2wiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUb29sKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gIndpemFyZCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOwogICAgfQp9Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJPcGVuTWVudScsIHsgbWVudTogdGhhdCwgbWVudVR5cGUsIG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsIH0pOycAp9rr9gWYmAESYWJDcmVhdGVNZW51QnV0dG9uAgQAp9rr9gXdxAH4DUBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9OwoKbGV0IHsKICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwKICAgIC4uLmFkZGl0aW9uYWxUYWdzCn0gPSB0aGF0ID8/IHt9CgppZiAodHlwZW9mIG1lbnVJdGVtU3R5bGUgPT0gJ3N0cmluZycpIHsKICAgIG1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbVN0eWxlLnJlcGxhY2UoL1x1ezFGOUVDfS91LCAnJyk7IAogICAgbWVudUl0ZW1TdHlsZSA9IEpTT04ucGFyc2UobWVudUl0ZW1TdHlsZSk7Cn0KCmZ1bmN0aW9uIGhhc0JvcmRlclN0eWxlKCkgewogICAgaWYgKG1lbnVJdGVtU3R5bGVbImJvcmRlci10b3Atc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItbGVmdC1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1ib3R0b20tc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItcmlnaHQtc3R5bGUiXSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdKSB7CiAgICBpZiAoYWRkaXRpb25hbFRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJNZW51R3JvdXAiXSkgewoKICAgIH0KfQoKbmV3TWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdNZW51QnV0dG9uLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7Cm5ld01lbnVCdXR0b24ubGFiZWxDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7Cm5ld01lbnVCdXR0b24uc2hhZG93Q29sb3IgPSB0aGF0LnNoYWRvd0NvbG9yID8/IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU2hhZG93Q29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLnNjYWxlWSA9IDE7Cgpjb25zdCBtZW51U3R5bGluZyA9IHsKICAgICJib3JkZXItcmFkaXVzIjoiOHB4IiwKICAgICJtYXJnaW4tdG9wIjogIjhweCIsCiAgICAiYm94LXNoYWRvdyI6IGAzcHggNHB4ICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIm1pbi1oZWlnaHQiOiAiNDRweCIsCiAgICAiYm9yZGVyIjogaGFzQm9yZGVyU3R5bGUoKSA/ICIiIDogYDJweCBzb2xpZCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJ3aWR0aCI6ICJjYWxjKDEwMCUgLSA1cHgpIiwKICAgIC4uLm1lbnVJdGVtU3R5bGUKfQoKbmV3TWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gbWVudVN0eWxpbmc7Cgpjb25zdCBjbGlja2VkU3R5bGluZyA9IHsKICAgIC4uLm1lbnVTdHlsaW5nLAogICAgImZpbHRlciI6ICJicmlnaHRuZXNzKDYwJSkiCn0KY29uc3QgYmFzZVN0eWxlID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9ICfwn6esICR7SlNPTi5zdHJpbmdpZnkoY2xpY2tlZFN0eWxpbmcpfSdgCgpuZXdNZW51QnV0dG9uLm9uUG9pbnRlckRvd24gPSBtZW51SXRlbVN0eWxlPy5bIm1hcmdpbi10b3AiXSAhPSAiMHB4IiA/IGJhc2VTdHlsZSA6ICJAIC8vIjsKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJVcCA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsYDsKCmZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQp7CiAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOwp9CgpuZXdNZW51QnV0dG9uID0gY3JlYXRlKG5ld01lbnVCdXR0b24pOwoKcmV0dXJuIG5ld01lbnVCdXR0b247JwCn2uv2BZiYAQ1hYk1lbnVSZWZyZXNoAgQAp9rr9gXU0gGdAUBpZiAoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbD8uc3Vic3RyaW5nKDAsMikgPT0gImFiIikKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKICAgIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKICAgIG1hc2tzLm9uS2V5RG93biA9IG51bGw7Cn0nAKfa6/YFmJgBCHJlbWVtYmVyAgQAp9rr9gXy0wEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAp9rr9gWYmAENbWFuaWZlc3RhdGlvbgIEAKfa6/YFmdQBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAKfa6/YFmJgBEWFiRW52aXJvbm1lbnRNZW51AgQAp9rr9gXA1AG6N0BzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5wZXJzb25hbGl0eSA9IHRhZ3MucGVyc29uYWxpdHk7CmFiTWVudUJ1dHRvbi5sZWFybiA9IHRhZ3MubGVhcm47Cgpjb25zdCBhYkVudmlyb25tZW50T3B0aW9ucyA9IHRoaXNCb3QuYWJHZXRFbnZpcm9ubWVudE9wdGlvbnMoKTsKCmJ1dHRvbkxvb3A6CmZvciAobGV0IGkgPSAwOyBpIDwgYWJFbnZpcm9ubWVudE9wdGlvbnMubGVuZ3RoOyBpKyspCnsKICAgIGxldCBhY3RpdmVCdXR0b24gPSBhYkVudmlyb25tZW50T3B0aW9uc1tpXTsKCiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gYWN0aXZlQnV0dG9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOwoKICAgIGlmIChhY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudEdhdGUpCiAgICB7CiAgICAgICAgaWYgKCFsaW5rc1thY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudEdhdGVdKQogICAgICAgIHsKICAgICAgICAgICAgY29udGludWUgYnV0dG9uTG9vcDsKICAgICAgICB9CiAgICB9CgogICAgbGV0IG5ld0J1dHRvbkRhdGEgPSB7Li4uYWJNZW51QnV0dG9uLCAuLi5hY3RpdmVCdXR0b259OwoKICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld0J1dHRvbkRhdGEpOwp9Cgpjb25zdCBhYlBlcnNvbmFsaXR5Q29uZmlnQnV0dG9uID0gewogICAgbGFiZWw6ICJjdXN0b21pemU6IGFiIHBlcnNvbmFsaXR5IiwKICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgIGFiTWVudVNvcnRPcmRlcjogMSwKICAgIGRyb3Bkb3duU29ydE9yZGVyOiAxLAogICAgZHJvcGRvd25PcHRpb25zOiBbCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYG5hbWU6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImN1YmUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LCB7dGl0bGU6ICd3aGF0IHdvdWxkIHlvdSBsaWtlIHRvIGNhbGwgbWU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge25hbWU6IG5hbWV9KTsgCiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGFpIG1vZGVsOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGFpTW9kZWxzID0gbGlua3MucmVtZW1iZXIudGFncy5haU1vZGVsczsKCiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zID0gW107CgogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb21wYW55R3JvdXAgb2YgYWlNb2RlbHMpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1vZGVsRW50cnkgb2YgY29tcGFueUdyb3VwLm1vZGVscykgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goeyBsYWJlbDogbW9kZWxFbnRyeS5tb2RlbCwgdmFsdWU6IG1vZGVsRW50cnkubW9kZWwgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRNb2RlbEluZGV4ID0gb3B0aW9ucy5maW5kSW5kZXgobyA9PiBvLnZhbHVlID09PSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCk7CgogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQoY3VycmVudE1vZGVsSW5kZXgsIHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3doYXQgYWkgbW9kZWwgd291bGQgeW91IGxpa2UgbWUgdG8gdXNlPycsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2xpc3QnLAogICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBvcHRpb25zLAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkT3B0aW9uICYmIHNlbGVjdGVkT3B0aW9uLnZhbHVlICE9PSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCkgewogICAgICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHthaU1vZGVsOiBzZWxlY3RlZE9wdGlvbi52YWx1ZX0pOyAKICAgICAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBtZSB0byBiZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7Y29sb3I6IGNvbG9yfSk7IAogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnVzIHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51Q29sb3I6IGNvbG9yfSk7IAogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTtgLAogICAgICAgICAgICAgICAgLy9saW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yID0gY29sb3I7IGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yICE9ICdjbGVhcicpe2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgPSBjb2xvcn07IGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IHRleHQgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51IHRleHQgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVMYWJlbENvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICAgICAgICAgIC8vbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvciA9IGNvbG9yOyBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciAhPSAnY2xlYXInKXtsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yID0gY29sb3J9OyBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBwb3J0YWwgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGxldCBwb3J0YWxDb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyAnIzI2MzIzOCcsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgeW91ciBwb3J0YWwgdG8gbG9vayBsaWtlPyd9KTsKICAgICAgICAgICAgICAgIGlmICghcG9ydGFsQ29sb3IpIHsKICAgICAgICAgICAgICAgICAgICBwb3J0YWxDb2xvciA9ICcjMjYzMjM4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsncG9ydGFsQ29sb3InOiBwb3J0YWxDb2xvcn0pOyAKICAgICAgICAgICAgICAgIC8vZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBtYXAgcG9ydGFsIGJhc2VtYXBgLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBzaG91dCgic2hvd0FCQmFzZW1hcE9wdGlvbnMiKTsKICAgICAgICAgICAgYAogICAgICAgIH0sCiAgICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJkZWZhdWx0IHNldHRpbmdzIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICAgICAgICAgIGNvbG9yOiAncmVkJywKICAgICAgICAgICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsnZGVmYXVsdFBlcnNvbmFsaXR5JzogdHJ1ZX0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogIm1lbnUgY29sb3IiLAogICAgICAgIC8vICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgIC8vICAgICAgb25DbGljazogYEAgCiAgICAgICAgLy8gICAgICAgICBjb25zdCBtZW51Q29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQoYWJQZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvciwge3RpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51J3MgdG8gYmU/J30pOwogICAgICAgIC8vICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVDb2xvcjogbWVudUNvbG9yfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIC8vIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogInByb21wdCIsCiAgICAgICAgLy8gICAgIG9uQ2xpY2s6IGBAYCwKICAgICAgICAvLyB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJmb3JtIiwKICAgICAgICAvLyAgICAgb25DbGljazogYEAgCiAgICAgICAgLy8gICAgICAgICBjb25zdCBmb3JtID0gYXdhaXQgb3Muc2hvd0lucHV0KGFiUGVyc29uYWxpdHkudGFncy5hYkZvcm0sIHt0aXRsZTogJ3doYXQgZm9ybSB3b3VsZCB5b3UgbGlrZSBtZSB0byB0YWtlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHtmb3JtOiBmb3JtfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIC8vIH0KICAgIF0KfQoKdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bihhYlBlcnNvbmFsaXR5Q29uZmlnQnV0dG9uKTsKCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAogICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwpgOwp0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACiAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewogICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CiAgICB9CmA7CgpzaG91dCgnb25BQkVudmlyb25tZW50TWVudScsIHsgbWVudVBvcnRhbDogY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbH0gKScAp9rr9gWYmAEFbGVhcm4CBACn2uv2BfuLAijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCn2uv2BZiYAQNncHQCBACn2uv2BaKMAijwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCn2uv2BZiYAQhhYklnbm9yZQIEAKfa6/YFyYwCBHRydWUnAKfa6/YFmJgBBnNlYXJjaAIEAKfa6/YFzowCKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAKfa6/YFmJgBBm51Z2dldAIEAKfa6/YF9YwCKPCflJc0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYnAKfa6/YFmJgBBXRlc3RzAgQAp9rr9gWcjQIo8J+Ul2I4M2Q5NzJiLTA1MzUtNDA1MS1iNTg5LTQxY2VkYTg1MzVmMScAp9rr9gWYmAEPb25Qb3J0YWxDaGFuZ2VkAgQAp9rr9gXDjQJuQGlmICh0aGF0LnBvcnRhbCA9PSAic3lzdGVtUG9ydGFsIiAmJiAhdGhhdC5kaW1lbnNpb24gJiYgIWxpbmtzLnRlc3RzKQp7CiAgICBsaW5rcy5sZWFybi5hYkFkYXB0KCJhYlRlc3RzIik7Cn0nAKfa6/YFmJgBA2FzawIEAKfa6/YFso4CKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAKfa6/YFmJgBCWFiVmVyc2lvbgIEAKfa6/YF2Y4CBTEwLjI5JwCn2uv2BZiYARFhYkNyZWF0ZU1lbnVJbnB1dAIEAKfa6/YF344CngJAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudUlucHV0ID0gew0KICAgIGZvcm06ICJpbnB1dCIsDQogICAgbWVudUl0ZW1TaG93U3VibWl0V2hlbkVtcHR5OiBmYWxzZSwNCiAgICBmb3JtSW5wdXRNdWx0aWxpbmU6IG51bGwsDQogICAgb25Qb2ludGVyVXA6IG51bGwsDQogICAgb25Qb2ludGVyRG93bjogbnVsbCwNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUlucHV0KTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCn2uv2BZiYARBhYkNyZWF0ZU1lbnVUZXh0AgQAp9rr9gX+kAKBBEBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmNvbnN0IHsNCiAgICBtZW51SXRlbUxhYmVsU3R5bGUsDQogICAgLi4ucmVzdA0KfSA9IHRoYXQ7DQoNCmxldCBtZW51VGV4dCA9IHsNCiAgICBmb3JtOiAidGV4dCIsDQogICAgb25Qb2ludGVyVXA6IG51bGwsDQogICAgb25Qb2ludGVyRG93bjogbnVsbCwNCiAgICBwb2ludGFibGU6IGZhbHNlLA0KICAgIGNvbG9yOiAid2hpdGUiLA0KICAgIG1lbnVJdGVtU3R5bGU6IHsNCiAgICAgICAgInBhZGRpbmctdG9wIjogIjZweCIsDQogICAgICAgICJwYWRkaW5nLWJvdHRvbSI6ICI2cHgiLA0KICAgIH0sDQogICAgbWVudUl0ZW1MYWJlbFN0eWxlOiB7DQogICAgICAgICJ3aGl0ZS1zcGFjZSI6ICJwcmUtd3JhcCIsDQogICAgICAgIC4uLm1lbnVJdGVtTGFiZWxTdHlsZSwNCiAgICB9LA0KICAgIC4uLnJlc3QNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51VGV4dCk7DQoNCnJldHVybiBtZW51Qm90OycAp9rr9gWYmAEQYWJDcmVhdGVNZW51VG9vbAIEAKfa6/YFgJUCjgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVRvb2wgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUb29sKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCn2uv2BZiYARJhYkNyZWF0ZU1lbnVXaXphcmQCBACn2uv2BY+WApIBQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVXaXphcmQgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVXaXphcmQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAKfa6/YFmJgBFGFiQ3JlYXRlTWVudURyb3Bkb3duAgQAp9rr9gWilwLeHUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICghdGhhdC5kcm9wZG93blNvcnRPcmRlcikgew0KICAgIHRocm93IG5ldyBFcnJvcihgYWJDcmVhdGVNZW51RHJvcGRvd246IGRyb3Bkb3duU29ydE9yZGVyIGlzIG5vdCBwcm92aWRlZC5gKTsNCn0NCg0KbGV0IG91dGVyTWVudUJ1dHRvbiA9IHsNCiAgICAuLi50aGF0LA0KICAgIGZvcm1BZGRyZXNzOiB0aGF0LmZvcm1BZGRyZXNzID8/ICJhcnJvd19yaWdodCIsDQogICAgZHJvcGRvd25PcGVuOiBmYWxzZSwNCiAgICBvbkNsaWNrOiBgQA0KICAgICAgICB0YWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSAke3RoYXQuZHJvcGRvd25Tb3J0T3JkZXJ9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucykgew0KICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKHRhZ3MuZHJvcGRvd25PcHRpb25zLCB0YWdzLmRyb3Bkb3duU29ydE9yZGVyKTsNCiAgICAgICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICBgLA0KICAgIG9uRGVzdHJveTogYEANCiAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICBgLA0KICAgIG9uUG9pbnRlclVwOiBgQA0KICAgICAgICBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbDsNCiAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICBtYXNrcy5mb3JtQWRkcmVzcyA9ICJhcnJvd19yaWdodCI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IGZhbHNlKSB7DQogICAgICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJmb3JtQWRkcmVzcyIsICJhcnJvd19kcm9wX2Rvd24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgIm1lbnVJdGVtU3R5bGUiLCB7Li4udGFncy5tZW51SXRlbVN0eWxlLCAiYm9yZGVyQm90dG9tTGVmdFJhZGl1cyI6ICIwIiwgImJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzIjogIjAifSk7DQogICAgICAgIH0NCiAgICBgLA0KICAgIG9uQm90Q2hhbmdlZDogYEANCiAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygnZHJvcGRvd25PcGVuJykgJiYgdGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgc2hvdXQoImFiTWVudURyb3Bkb3duT3BlbmVkIiwgdGhpc0JvdCk7DQogICAgICAgIH0NCiAgICBgLA0KICAgIGFiTWVudURyb3Bkb3duT3BlbmVkOiBgQA0KICAgICAgICBpZiAodGhhdCAhPSB0aGlzQm90KSB7DQogICAgICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSBmYWxzZTsNCiAgICAgICAgICAgIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKGxpbmtzICYmIGxpbmtzLmJhc2VTa2lsbCkgew0KICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYWIubGlua3MucmVtZW1iZXIsICJsYXN0T3BlbmVkRHJvcGRvd24iLCB0YWdzLmJhc2VTa2lsbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICBgDQp9Ow0KDQppZiAodGhhdC5mb3JtQWRkcmVzcyAmJiB0aGF0LmZvcm1BZGRyZXNzICE9ICJhcnJvd19yaWdodCIpIHsNCiAgICBvdXRlck1lbnVCdXR0b24uY3VzdG9tRm9ybUFkZHJlc3MgPSB0cnVlOw0KfQ0Kb3V0ZXJNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSB0aGF0LmRyb3Bkb3duU29ydE9yZGVyOw0KDQpjb25zdCBtZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24ob3V0ZXJNZW51QnV0dG9uKTsNCm1lbnVCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zID0gZ2VuZXJhdGVNZW51T3B0aW9uczsNCg0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNZW51T3B0aW9ucyAob3B0aW9ucywgc29ydE9yZGVyKSB7DQogICAgY29uc3QgbWVudUJvdHMgPSBbXTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyArK2kpIHsNCg0KICAgICAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm9wdGlvbnNbaV0sDQogICAgICAgICAgICBjbGVhckRyb3Bkb3duTWVudTogYEANCiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOw0KICAgICAgICAgICAgYA0KICAgICAgICB9Ow0KDQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcihzb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDAwKTsNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9IHRydWU7DQoNCiAgICAgICAgaWYgKGkgPT0gb3B0aW9ucy5sZW5ndGggLSAxKSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIDAgOHB4IDhweCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCAwIDhweCA4cHgiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyVG9wIl0gPSAibm9uZSI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsibWFyZ2luVG9wIl0gPSAiMCI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsicGFkZGluZ0xlZnQiXSA9ICIzNXB4IjsNCg0KICAgICAgICBjb25zdCBuZXdNZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQogICAgfQ0KDQogICAgbWVudUJvdC50YWdzLm1lbnVCb3RzID0gZ2V0TGluayhtZW51Qm90cyk7DQp9DQoNCmlmICh0aGF0LmRlZmF1bHRPcGVuKSB7DQogICAgbWVudUJvdC5vblBvaW50ZXJVcCgpOw0KICAgIG1lbnVCb3Qub25DbGljaygpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdDsNCg0KJwCn2uv2BZiYARFhYkNyZWF0ZU1lbnVHcm91cAIEAKfa6/YFgbUCvR9ALyoNCiAgIEVYQU1QTEUNCiAgIGNvbnN0IG1lbnVHcm91cCA9IHsNCiAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgZ3JvdXBTb3J0T3JkZXI6IDEsDQogICAgICAgIG1lbnVJdGVtczogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDEiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgY29sb3I6ICJvcmFuZ2UiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMyIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgIG1lbnVJdGVtVHlwZTogImRyb3Bkb3duIiwNCiAgICAgICAgICAgICAgICBkcm9wZG93bk9wdGlvbnM6IFsNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDIiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXQ0KICAgIH0NCiovDQoNCmlmICAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICghdGhhdC5ncm91cFNvcnRPcmRlcikgew0KICAgIHRocm93IG5ldyBFcnJvcihgYWJDcmVhdGVNZW51R3JvdXA6IGdyb3VwU29ydE9yZGVyIGlzIG5vdCBwcm92aWRlZC5gKTsNCn0NCg0KbGV0IHsNCiAgICBtZW51SXRlbVN0eWxlID0ge30sDQogICAgbWVudUl0ZW1zID0gW10sDQogICAgLi4uYWRkaXRpb25hbFRhZ3MNCn0gPSB0aGF0ID8/IHt9DQoNCmNvbnN0IG1lbnVCb3RzID0gW107DQpmb3IgKGxldCBpID0gMDsgaSA8IG1lbnVJdGVtcy5sZW5ndGg7ICsraSkgew0KDQogICAgbGV0IG5ld01lbnVCdXR0b24gPSB7fTsNCg0KICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTAwKTsNCg0KICAgIGxldCBpbmRpdk1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbXNbaV0ubWVudUl0ZW1TdHlsZSA/PyB7fTsNCiAgICBsZXQgaW5kaXZNZW51VHlwZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVR5cGUgPz8gdW5kZWZpbmVkOw0KICAgIGxldCBpbmRpdkFkZGl0aW9uYWxUYWdzID0gbWVudUl0ZW1zW2ldOw0KICAgIGlmIChpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXTsNCiAgICB9DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdKSB7DQogICAgICAgIGRlbGV0ZSBpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVR5cGUiXTsNCiAgICB9DQoNCiAgICBjb25zdCBiYXNlU3R5bGluZyA9IHsNCiAgICAgICAgImJvcmRlclRvcCI6ICJub25lIiwNCiAgICAgICAgIm1hcmdpblRvcCI6ICIwIg0KICAgIH0NCg0KICAgIGlmIChpID09IG1lbnVJdGVtcy5sZW5ndGggLSAxICYmIGkgPT0gMCkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0NCiAgICBlbHNlIGlmIChpID09IG1lbnVJdGVtcy5sZW5ndGggLSAxKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4uYmFzZVN0eWxpbmcsDQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjAgMCA4cHggOHB4IiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0gZWxzZSBpZiAoaSA9PSAwKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICI4cHggOHB4IDAgMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzt9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4uYmFzZVN0eWxpbmcsDQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjAiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpDQogICAgew0KICAgICAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgdGFnIGluIGluZGl2QWRkaXRpb25hbFRhZ3MpDQogICAgew0KICAgICAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBpbmRpdkFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgbGV0IG5ld01lbnVCb3Q7DQogICAgc3dpdGNoKGluZGl2TWVudVR5cGUpIHsNCiAgICAgICAgY2FzZSAiZHJvcGRvd24iOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAuLi5uZXdNZW51QnV0dG9uLA0KICAgICAgICAgICAgICAgICAgICAiZHJvcGRvd25Tb3J0T3JkZXIiOiBOdW1iZXIodGhhdC5ncm91cFNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgImlucHV0IjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRleHQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ0b29sIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2wobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAid2l6YXJkIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBkZWZhdWx0OiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgfQ0KICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQp9DQoNCnJldHVybiBtZW51Qm90czsnAKfa6/YFmJgBC3BlcnNvbmFsaXR5AgQAp9rr9gW/1AIo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAp9rr9gWYmAEXYWJHZXRFbnZpcm9ubWVudE9wdGlvbnMCBACn2uv2BebUAsE6QGNvbnN0IG9wdGlvbnMgPSBbXTsKCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6IGBoaWRlYCwKICAgICAgICBmb3JtQWRkcmVzczogInZpc2liaWxpdHlfb2ZmIiwKICAgICAgICBvbkNsaWNrOiAiQCBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDAKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogIm9wdGltaXplIG1vZGUiLAogICAgb25DcmVhdGU6ICJAIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnIDogdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIG9uQ2xpY2s6ICJAIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSBmYWxzZSA6IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gdHJ1ZTsgdGhpc0JvdC5vbkNyZWF0ZSgpOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMQp9KQoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInNsZWVwIiwKICAgICAgICBmb3JtQWRkcmVzczogIm5pZ2h0c19zdGF5IiwKICAgICAgICBvbkNsaWNrOiAiQGxpbmtzLm1hbmlmZXN0YXRpb24uYWJTZXRBd2FrZSh7IGF3YWtlOiBmYWxzZSB9KSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDMKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoYXQiLAogICAgZm9ybUFkZHJlc3M6ICJjaGF0IiwKICAgIG9uQ2xpY2s6ICJAIHNob3V0KCdhYkNoYXRCYXJPcGVuJyk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA0Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJudWdnZXRzIiwKICAgIG9uQ3JlYXRlOiAiQCB0YWdzLm51Z01hbmFnZXIgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmludGVyZmFjZS5udWdnZXQnKSk7IGlmIChsaW5rcy5udWdNYW5hZ2VyLnRhZ3MubGlzdGVuaW5nKXt0YWdzLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgbnVsbCk7YDt0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveGA7fWVsc2V7ICAgIHRhZ3Mub25DbGljayA9IGBAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCB0cnVlLCAnbG9jYWwnKTtgOyAgICB0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveF9vdXRsaW5lX2JsYW5rYDt9IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1Cn0pCgpvcHRpb25zLnB1c2goewogICAgYWJFbnZpcm9ubWVudEdhdGU6ICJncHQiLAogICAgb25DcmVhdGU6ICJAICBpZiAoIWF1dGhCb3Qpe2Rlc3Ryb3kodGhpc0JvdCk7fWVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICdGcmVlUGxheScgfHwgYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gdW5kZWZpbmVkKXtkZXN0cm95KHRoaXNCb3QpO307IHRhZ3MubGFiZWwgPSAnZWRpdCAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgcHJvbXB0JzsgdGFncy5ncHRCb3QgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmFjdGlvbi5hc2snKSk7IiwKICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLmdwdEJvdC5lZGl0UHJvbXB0KCk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA3Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJncmlkIHNuYXAiLAogICAgb25DcmVhdGU6ICJAIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJyIsCiAgICBvbkNsaWNrOiAiQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZTt0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA4Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJib3Qgc25hcCIsCiAgICBvbkNyZWF0ZTogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZTsgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA5Cn0pCgppZiAoYXV0aEJvdCkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogImFjY291bnQiLAogICAgICAgIGZvcm1BZGRyZXNzOiAiYmFkZ2UiLAogICAgICAgIG9uQ2xpY2s6ICJAIG9zLnNob3dBY2NvdW50SW5mbygpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwCiAgICB9KQp9CgppZiAobGlua3MudGVzdHMpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJ0ZXN0cyIsCiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdGVzdCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJzY2llbmNlIiwKICAgICAgICBvbktleURvd246ICJAICIsCiAgICAgICAgb25LZXlVcDogIkAgIiwKICAgICAgICBvbkNsaWNrOiAiQCBsZXQgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoJ2tleWJvYXJkJywgJ1NoaWZ0Jyk7bGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTtzaG91dCgnYWJSZWNvcmRUZXN0Jyk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMQogICAgfSkKCiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgICAgIGxhYmVsOiAicmVjb3JkIHRyYWNlIiwKICAgICAgICBmb3JtQWRkcmVzczogInRpbWVsaW5lIiwKICAgICAgICBvbktleURvd246ICJAICIsCiAgICAgICAgb25LZXlVcDogIkAgIiwKICAgICAgICBvbkNsaWNrOiAiQCBsZXQgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoJ2tleWJvYXJkJywgJ1NoaWZ0Jyk7bGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTtzaG91dCgnYWJSZWNvcmRUcmFjZScpO3Nob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTIKICAgIH0pCn0KCmlmIChnZXRCb3QoInN5c3RlbSIsICJhYi5ob21lLmVnZyIpKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgICAgIGxhYmVsOiAic2F2ZSBob21lIGVnZyIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJlZ2ciLAogICAgICAgIG9uS2V5RG93bjogIkAgIiwKICAgICAgICBvbktleVVwOiAiQCAiLAogICAgICAgIG9uQ2xpY2s6IGBAZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaG9tZS5lZ2ciKS5zYXZlRGF0YSgpO3Nob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTMKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoZWNrIGZvciAiICsgYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgdXBkYXRlcyIsCiAgICBmb3JtQWRkcmVzczogImN1YmUiLAogICAgbGVhcm46IHRhZ3MubGVhcm4sCiAgICBvbktleURvd246ICJAICIsCiAgICBvbktleVVwOiAiQCAiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDE0LAogICAgY2hlY2tGb3JVcGRhdGVzOiBgQAogICAgICAgIC8vIFRlbXBvcmFyaWx5IHJlcGxhY2Ugd2l0aCBidXN5IGluZGljYXRvciB3aGlsZSBjaGVja2luZyBmb3IgdXBkYXRlcy4KICAgICAgICB0YWdzLmFiTWVudSA9IGZhbHNlOwoKICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IGFiLmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcih7CiAgICAgICAgICAgIGFiTWVudTogdHJ1ZSwKICAgICAgICAgICAgbGFiZWw6ICdjaGVja2luZyBmb3IgdXBkYXRlcyB0byAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IHRhZ3MuYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIsCiAgICAgICAgfSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrID0gYXdhaXQgYWIuYWJDaGVja0FCVXBkYXRlQXZhaWxhYmxlKHsgZGV0YWlsZWQ6IHRydWUgfSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gbnVsbDsKCiAgICAgICAgICAgIC8vIEJyaW5nIGJhY2sgdGhlIHVwZGF0ZSBidXR0b24uCiAgICAgICAgICAgIHRhZ3MuYWJNZW51ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjayAmJiB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay5zdWNjZXNzKSB7ICAgIAogICAgICAgICAgICBpZiAoZ2xvYmFsVGhpcy5hYlVwZGF0ZUNoZWNrZXIpIHsKICAgICAgICAgICAgICAgIGFiVXBkYXRlQ2hlY2tlci50YWdzLnVwZGF0ZUF2YWlsYWJsZSA9IHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLnVwZGF0ZUF2YWlsYWJsZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLnVwZGF0ZUF2YWlsYWJsZSkgewogICAgICAgICAgICAgICAgY29uc3QgYWJGaWxlc1dpdGhVcGRhdGVzID0gdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2suYWJGaWxlQ2hlY2tzLmZpbHRlcihmID0+IGYudXBkYXRlQXZhaWxhYmxlKTsKCiAgICAgICAgICAgICAgICBjb25zdCBjb25maXJtZWQgPSBhd2FpdCBvcy5zaG93Q29uZmlybSh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdVcGRhdGVzIGZvdW5kIGZvciAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdUaGVyZSBhcmUgJyArIGFiRmlsZXNXaXRoVXBkYXRlcy5sZW5ndGggKyAnIGZpbGUgdXBkYXRlcyBmb3IgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcuIFdvdWxkIHlvdSBsaWtlIHRvIGluc3RhbGwgdGhlIHVwZGF0ZXMgbm93PyBZb3UgYW5kIGFueSBjb25uZWN0ZWQgdXNlcnMgd2lsbCBhdXRvbWF0aWNhbGx5IHJlZnJlc2ggdGhlIHBhZ2UgYWZ0ZXIgdGhlIHVwZGF0ZSBpcyBjb21wbGV0ZS4nLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6ICdOb3Qgbm93JywKICAgICAgICAgICAgICAgICAgICBjb25maXJtVGV4dDogJ1llcycKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCkgewogICAgICAgICAgICAgICAgICAgIGxpbmtzLmxlYXJuLnVwZGF0ZUFCKCk7IAogICAgICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhYi5saW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgaXMgYWxyZWFkeSB1cC10by1kYXRlIScpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSAndXBkYXRlIGNoZWNrIGZhaWxlZCc7CiAgICAgICAgfQogICAgYCwKICAgIG9uQ2xpY2s6IGBACiAgICAgICAgdGhpc0JvdC5jaGVja0ZvclVwZGF0ZXMoKTsKICAgIGAsCiAgICBvbkRlc3Ryb3k6IGBACiAgICAgICAgaWYgKHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpOwogICAgICAgIH0KICAgIGAsCn0pCgpvcHRpb25zLnB1c2goewogICAgb25DcmVhdGU6IGBACiAgICAgICAgdGFncy5sYWJlbCA9ICJwZXJtYW5lbnRseSBkZWxldGUgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7CiAgICAgICAgdGFncy5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29udHJhc3RDb2xvciA/PyAiI0Q5MzAzMCI7CiAgICBgLAogICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICBvbkNsaWNrOiBgQAogICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IG9zLnNob3dDb25maXJtKHsKICAgICAgICAgICAgdGl0bGU6ICdQZXJtYW5lbnRseSBkZWxldGUgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgIGNvbnRlbnQ6ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlICcgKyAgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgZnJvbSAnICsgbGlua3MubGVhcm4udGFncy5hYkluc3QgKyAnPyBUaGlzIGlzIG5vdCByZXZlcnNpYmxlIScsCiAgICAgICAgfSkKCiAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKCiAgICAgICAgY29uc3QgYWJCb3RzID0gZ2V0Qm90cygoYikgPT4gewogICAgICAgICAgICByZXR1cm4gYi5zcGFjZSA9PT0gJ3NoYXJlZCcgJiYKICAgICAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtICYmCiAgICAgICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbS5zdGFydHNXaXRoKCdhYicpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgIGRlc3Ryb3koYWJCb3RzKTsKICAgICAgICB9CiAgICBgLAogICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMDAKfSkKCnJldHVybiBvcHRpb25zOycAp9rr9gWYmAEeYWJDcmVhdGVUb29sYm94RHJvcGRvd25PcHRpb25zAgQAp9rr9gWojwPjE0Bjb25zdCB0b29sYm94VG9vbHMgPSBbLi4udGhhdC50b29sQXJyYXldID8/IFtdOw0KY29uc3QgdG9vbGJveE5hbWUgPSB0aGF0LnRvb2xib3hOYW1lID8/ICJLaXQgIjsNCmNvbnN0IHRvb2xib3ggPSB0aGF0LnRvb2xib3g7DQpjb25zdCBncmlkSW5mb3JtYXRpb24gPSAodGhhdD8uZ3JpZEluZm9ybWF0aW9uICYmIHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiAhPSB1bmRlZmluZWQpID8gdGhhdD8uZ3JpZEluZm9ybWF0aW9uIDogYWJSZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOw0KDQpjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnRvb2xib3ggPSBnZXRMaW5rKHRvb2xib3gpOw0KbWVudU9wdGlvbnMuZ3JpZEluZm9ybWF0aW9uID0gZ3JpZEluZm9ybWF0aW9uOw0KbWVudU9wdGlvbnMuc2VhcmNoID0gdGFncy5zZWFyY2g7DQptZW51T3B0aW9ucy5hcnRpZmFjdCA9IHRhZ3MuYXJ0aWZhY3Q7DQovL21lbnVPcHRpb25zLmZvcm1BZGRyZXNzID0gImhhcmR3YXJlIjsNCg0KaWYgKHRvb2xib3hUb29scy5sZW5ndGggPT09IDApIHsNCiAgICBjb25zdCBtZXNzYWdlID0gdG9vbGJveE5hbWUgKyAiIGRvZXMgbm90IGhhdmUgYW55IHRvb2xzIGxpc3RlZCBpbiB0aGUgdG9vbF9hcnJheSB0YWciOw0KDQogICAgYWIubG9nKGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBtZXNzYWdlKTsNCiAgICBvcy50b2FzdChtZXNzYWdlLCA1KTsNCiAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpOw0KfQ0KDQpmb3IgKGxldCB0b29sIG9mIHRvb2xib3hUb29scykgew0KICAgIGNvbnN0IHRvb2xCdXR0b24gPSB7DQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBsYWJlbDogdG9vbC5uYW1lLA0KICAgICAgICB0YXJnZXRBQjogdG9vbC50YXJnZXRBQiwNCiAgICAgICAgaXNBcnRpZmFjdDogdG9vbC5hcnRpZmFjdCB8fCBmYWxzZSwNCiAgICAgICAgb25DbGljazpgQA0KICAgICAgICAgICAgaWYgKHRhZ3MuaXNBcnRpZmFjdCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGFiQXJ0aWZhY3RTaGFyZCA9IHsNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICAgICAgICAgICAgZWdnUGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llczogWw0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGxpbmtzLmFydGlmYWN0LmFiQ3JlYXRlQXJ0aWZhY3RQcm9taXNlQm90KHsNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdE5hbWU6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3RTaGFyZCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCLA0KICAgICAgICAgICAgICAgICAgICBzb3VyY2VFdmVudDogJ3Rvb2wnLA0KICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiB0YWdzLnRvb2xib3gsDQogICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9uDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgYCwNCiAgICB9Ow0KDQogICAgaWYgKHRvb2wuZm9ybUFkZHJlc3MpIHsNCiAgICAgICAgdG9vbEJ1dHRvbi5mb3JtQWRkcmVzcyA9IHRvb2wuZm9ybUFkZHJlc3M7DQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2godG9vbEJ1dHRvbik7DQp9DQoNCnJldHVybiBkcm9wZG93bk9wdGlvbnM7JwCn2uv2BZiYARBvbkFCQXV0aEJvdEFkZGVkAgQAp9rr9gWMowMYQHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7JwCn2uv2BZiYAQhhcnRpZmFjdAIEAKfa6/YFpaMDKPCflJc3OGU0MTUwMy1jOTMzLTRmOGEtODE3YS1iYTk3YmY4ZDVkMjcnAQRib3RzJGM3OGFhNjYzLWQwNWMtNGVjNC1iYzJjLTI2ZmQ1MTU2MGI5NwEnAKfa6/YFzKMDCGFiSWdub3JlAgQAp9rr9gXNowMEdHJ1ZScAp9rr9gXMowMLYWJJbnRlcmZhY2UCBACn2uv2BdKjAwR0cnVlJwCn2uv2BcyjAwZzeXN0ZW0CBACn2uv2BdejAxhhYi5pbnRlcmZhY2UuYm90X2ZhY3RvcnknAKfa6/YFzKMDFmFiQ3JlYXRlQmlsbGJvYXJkTGFiZWwCBACn2uv2BfCjA41FQGxldCB7IAogICAgYm90LAogICAgZGltZW5zaW9uLAogICAgcHJlc2VydmVOZXdMaW5lcyA9IHRydWUsCiAgICBsYWJlbCA9ICcnLAogICAgc3BhY2UgPSAndGVtcExvY2FsJywKICAgIGNvbG9yID0gJ3doaXRlJywKICAgIGxhYmVsQ29sb3IgPSAnYmxhY2snLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fTsKCmlmICh0eXBlb2YgbGFiZWwgIT09ICdzdHJpbmcnKSB7CiAgICBsYWJlbCA9IFN0cmluZyhsYWJlbCk7Cn0KCmFzc2VydChsaW5rcy51dGlscy5pc0JvdChib3QpLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGJvdCBpcyBhIHJlcXVpcmVkIEJvdCBwYXJhbWV0ZXIuYCk7CmFzc2VydChkaW1lbnNpb24sIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uIGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyLmApOwphc3NlcnQocmVzdC5vbkNyZWF0ZSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkFueUJvdHNDaGFuZ2VkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQW55Qm90c1JlbW92ZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3QudXBkYXRlTGFiZWwgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3QubGFiZWxXb3JkV3JhcE1vZGUgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBsYWJlbFdvcmRXcmFwTW9kZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKCi8vIC0tLSAxKSBXb3JkIGJyZWFraW5nICh3cmFwIGJ5IHdvcmRzLCBjaHVuayBsb25nIHdvcmRzKSAtLS0KZnVuY3Rpb24gYnJlYWtXb3Jkc1RvTGluZXModGV4dCwgbWF4Q29scyA9IDE4KSB7CiAgICBpZiAoIXRleHQpIHJldHVybiBbJyddOwogICAgY29uc3Qgd29yZHMgPSB0ZXh0LnNwbGl0KC9ccysvKS5maWx0ZXIoQm9vbGVhbik7CiAgICBjb25zdCBsaW5lcyA9IFtdOwogICAgbGV0IGxpbmUgPSAnJzsKCiAgICBjb25zdCBwdXNoID0gKCkgPT4geyBsaW5lcy5wdXNoKGxpbmUpOyBsaW5lID0gJyc7IH07CgogICAgZm9yIChjb25zdCB3IG9mIHdvcmRzKSB7CiAgICAgICAgaWYgKHcubGVuZ3RoID4gbWF4Q29scykgewogICAgICAgICAgICAvLyBjbG9zZSBjdXJyZW50IGxpbmUgKGlmIGFueSkgYmVmb3JlIGNodW5raW5nIGEgbG9uZyB3b3JkCiAgICAgICAgICAgIGlmIChsaW5lKSBwdXNoKCk7CiAgICAgICAgICAgIC8vIGNodW5rIHRoZSBsb25nIHdvcmQKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3Lmxlbmd0aDsgaSArPSBtYXhDb2xzKSB7CiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKHcuc2xpY2UoaSwgaSArIG1heENvbHMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsaW5lID0gJyc7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIWxpbmUubGVuZ3RoKSB7CiAgICAgICAgICAgIGxpbmUgPSB3OwogICAgICAgIH0gZWxzZSBpZiAobGluZS5sZW5ndGggKyAxICsgdy5sZW5ndGggPD0gbWF4Q29scykgewogICAgICAgICAgICBsaW5lICs9ICcgJyArIHc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHVzaCgpOwogICAgICAgICAgICBsaW5lID0gdzsKICAgICAgICB9CiAgICB9CiAgICBpZiAobGluZS5sZW5ndGgpIHB1c2goKTsKCiAgICByZXR1cm4gbGluZXMubGVuZ3RoID8gbGluZXMgOiBbJyddOwp9CgovLyBQcmVzZXJ2ZXMgZXhpc3RpbmcgXG4gYXMgaGFyZCBicmVha3M7IHdyYXBzIHdpdGhpbiBlYWNoIGhhcmQgbGluZS4KZnVuY3Rpb24gYnJlYWtXb3Jkc1RvTGluZXNQcmVzZXJ2ZU5ld2xpbmVzKHRleHQsIG1heENvbHMgPSAxOCkgewogIGlmICh0ZXh0ID09IG51bGwpIHJldHVybiBbJyddOwoKICAvLyBTcGxpdCBvbiByZWFsIG5ld2xpbmVzOyBrZWVwIGVtcHR5IGxpbmVzIHNvIHdlIHByZXNlcnZlIGJsYW5rIGxpbmVzLgogIGNvbnN0IGhhcmRMaW5lcyA9IFN0cmluZyh0ZXh0KS5zcGxpdCgvXHI/XG4vKTsKICBjb25zdCBvdXQgPSBbXTsKCiAgLy8gSGVscGVyIHRvIHdyYXAgYSBzaW5nbGUgaGFyZCBsaW5lIGJ5IHdvcmRzICh3aXRoIGxvbmctd29yZCBjaHVua2luZykKICBjb25zdCB3cmFwT25lID0gKHNyYykgPT4gewogICAgLy8gTm9ybWFsaXplIHRhYnMgLT4gc3BhY2VzOyBjb2xsYXBzZSBpbnRlcm5hbCB3aGl0ZXNwYWNlIChub3QgbmV3bGluZXMpCiAgICBjb25zdCBzID0gc3JjLnJlcGxhY2UoL1x0L2csICcgICAgJykucmVwbGFjZSgvXHMrL2csICcgJykudHJpbSgpOwogICAgaWYgKCFzLmxlbmd0aCkgeyBvdXQucHVzaCgnJyk7IHJldHVybjsgfQoKICAgIGNvbnN0IHdvcmRzID0gcy5zcGxpdCgnICcpOwogICAgbGV0IGxpbmUgPSAnJzsKCiAgICBjb25zdCBwdXNoTGluZSA9ICgpID0+IHsgb3V0LnB1c2gobGluZSk7IGxpbmUgPSAnJzsgfTsKCiAgICAvLyBjaHVuayBsb25nIHdvcmRzIHRvIGVtdWxhdGUgJ2JyZWFrV29yZHMnCiAgICBjb25zdCBjaHVua1dvcmQgPSAodykgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcubGVuZ3RoOyBpICs9IG1heENvbHMpIHsKICAgICAgICBjb25zdCBjaHVuayA9IHcuc2xpY2UoaSwgaSArIG1heENvbHMpOwogICAgICAgIGlmICghbGluZS5sZW5ndGgpIGxpbmUgPSBjaHVuazsKICAgICAgICBlbHNlIHsgcHVzaExpbmUoKTsgbGluZSA9IGNodW5rOyB9CiAgICAgIH0KICAgIH07CgogICAgZm9yIChjb25zdCB3IG9mIHdvcmRzKSB7CiAgICAgIGlmICh3Lmxlbmd0aCA+IG1heENvbHMpIHsKICAgICAgICBpZiAobGluZS5sZW5ndGgpIHB1c2hMaW5lKCk7CiAgICAgICAgY2h1bmtXb3JkKHcpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghbGluZS5sZW5ndGgpIHsKICAgICAgICBsaW5lID0gdzsKICAgICAgfSBlbHNlIGlmIChsaW5lLmxlbmd0aCArIDEgKyB3Lmxlbmd0aCA8PSBtYXhDb2xzKSB7CiAgICAgICAgbGluZSArPSAnICcgKyB3OwogICAgICB9IGVsc2UgewogICAgICAgIHB1c2hMaW5lKCk7CiAgICAgICAgbGluZSA9IHc7CiAgICAgIH0KICAgIH0KICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaExpbmUoKTsKICB9OwoKICBmb3IgKGNvbnN0IGhsIG9mIGhhcmRMaW5lcykgewogICAgd3JhcE9uZShobCk7ICAgICAgICAgICAvLyB3cmFwIHdpdGhpbiB0aGlzIGhhcmQgbGluZQogIH0KCiAgLy8gSWYgdGhlIGlucHV0IGVuZGVkIHdpdGggYSB0cmFpbGluZyBuZXdsaW5lLCB3ZSBhbHJlYWR5IHByZXNlcnZlZCBpdAogIC8vIGJlY2F1c2Ugc3BsaXQga2VwdCBhbiBlbXB0eSBsYXN0IGl0ZW0gLT4gYmVjYW1lIGFuIGVtcHR5IHdyYXBwZWQgbGluZS4KICByZXR1cm4gb3V0Lmxlbmd0aCA/IG91dCA6IFsnJ107Cn0KCi8vIC0tLSAyKSBTaW1wbGUgc2l6aW5nIGZyb20gbGluZXMgLS0tCi8vIFRoaW5rIG9mICJjb2xzUGVyU2NhbGVYIiBhcyAiYWJvdXQgTiBjaGFyYWN0ZXJzIHBlciAxIHNjYWxlWCIuCmZ1bmN0aW9uIGNvbXB1dGVTaW1wbGVTY2FsZXNGcm9tTGluZXMobGluZXMsIHsKICAgIGNvbHNQZXJTY2FsZVggPSAyLjUsCiAgICBtaW5TY2FsZVggPSAxLjI1LAogICAgbWF4U2NhbGVYID0gMTAsCiAgICBiYXNlU2NhbGVZID0gMS4yLAogICAgcGVyTGluZVkgPSAwLjc1LAp9ID0ge30pIHsKICAgIGNvbnN0IGxvbmdlc3QgPSBsaW5lcy5yZWR1Y2UoKG0sIGwpID0+IE1hdGgubWF4KG0sIGwubGVuZ3RoKSwgMCk7CiAgICBjb25zdCBsaW5lQ291bnQgPSBNYXRoLm1heCgxLCBsaW5lcy5sZW5ndGgpOwoKICAgIC8vIFdpZHRoIHNjYWxlcyB3aXRoIHRoZSBsb25nZXN0IGxpbmUgbGVuZ3RoCiAgICBsZXQgc2NhbGVYID0gbG9uZ2VzdCA+IDAgPyAobG9uZ2VzdCAvIGNvbHNQZXJTY2FsZVgpIDogbWluU2NhbGVYOwogICAgc2NhbGVYID0gTWF0aC5tYXgobWluU2NhbGVYLCBNYXRoLm1pbihtYXhTY2FsZVgsIHNjYWxlWCkpOwoKICAgIC8vIEhlaWdodCBncm93cyBwZXIgbGluZTsga2VlcCBpdCBzaW1wbGUgYW5kIHByZWRpY3RhYmxlCiAgICBjb25zdCBzY2FsZVkgPSBNYXRoLm1heChiYXNlU2NhbGVZLCBiYXNlU2NhbGVZICsgKGxpbmVDb3VudCAtIDEpICogcGVyTGluZVkpOwoKICAgIHJldHVybiB7IHNjYWxlWCwgc2NhbGVZLCBsb25nZXN0LCBsaW5lQ291bnQgfTsKfQoKCi8vIFBpY2sgeW91ciB0YXJnZXQgImNvbHVtbnMiIHBlciBsaW5lICh0d2VhayB0byB0YXN0ZSkKY29uc3QgTUFYX0NPTFMgPSAzMjsKCi8vIEJyZWFrIHRoZSB0ZXh0IHlvdXJzZWxmCmNvbnN0IGxpbmVzID0gcHJlc2VydmVOZXdMaW5lcyA/IGJyZWFrV29yZHNUb0xpbmVzUHJlc2VydmVOZXdsaW5lcyhsYWJlbCwgTUFYX0NPTFMpIDogYnJlYWtXb3Jkc1RvTGluZXMobGFiZWwsIE1BWF9DT0xTKTsKY29uc3Qgd3JhcHBlZExhYmVsID0gbGluZXMuam9pbignXG4nKTsKCi8vIENvbXB1dGUgc2ltcGxlIHNjYWxlcyBmcm9tIHRoZSB3cmFwcGVkIHRleHQKY29uc3QgeyBzY2FsZVgsIHNjYWxlWSB9ID0gY29tcHV0ZVNpbXBsZVNjYWxlc0Zyb21MaW5lcyhsaW5lcyk7CgpsZXQgbGFiZWxNb2QgPSB7CiAgICBzcGFjZTogc3BhY2UsCiAgICB0cmFja0JvdElkOiBib3QuaWQsCiAgICBmb3JtOiAnc3ByaXRlJywKICAgIGNvbG9yLAogICAgbGFiZWw6IHdyYXBwZWRMYWJlbCwKICAgIGxhYmVsQ29sb3IsCiAgICBsYWJlbFNpemU6IDEsCiAgICBsYWJlbFBhZGRpbmdYOiAwLjUsCiAgICBsYWJlbFdvcmRXcmFwTW9kZTogJ25vbmUnLAogICAgc2NhbGVYLCAKICAgIHNjYWxlWSwKICAgIHNjYWxlWjogMC4xLAogICAgYm90TGFiZWxNYXJnaW46IDEsCiAgICBhbmNob3JQb2ludDogJ+Keoe+4jzAsLTAuNSwwJywKICAgIG9yaWVudGF0aW9uTW9kZTogJ2JpbGxib2FyZCcsCiAgICBkaW1lbnNpb246IGRpbWVuc2lvbiwKICAgIGRlYnVnOiBmYWxzZSwKICAgIFtkaW1lbnNpb25dOiB0cnVlLAogICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgIG9uQ3JlYXRlOiBgQAogICAgICAgIC8vIFdhaXQgZm9yIHJlcXVpcmVkIGJvdHMgdG8gYmUgcmVhZHkuCiAgICAgICAgbGV0IHdhaXRUaW1lID0gMDsKCiAgICAgICAgd2hpbGUoIWdsb2JhbFRoaXMuYWIpIHsKICAgICAgICAgICAgaWYgKHdhaXRUaW1lID49IDUwMDApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXdhaXQgb3Muc2xlZXAoMjUwKTsKICAgICAgICAgICAgd2FpdFRpbWUgKz0gMjUwOwogICAgICAgIH0KCiAgICAgICAgdGFncy5yZWFkeSA9IHRydWU7CiAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgYCwKICAgIG9uQW55Qm90c0NoYW5nZWQ6IGBACiAgICAgICAgZm9yIChjb25zdCBjaGFuZ2VkIG9mIHRoYXQpIHsKICAgICAgICAgICAgaWYgKGNoYW5nZWQuYm90ICYmIGNoYW5nZWQuYm90LmlkID09PSB0YWdzLnRyYWNrQm90SWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9ubHlSb3RhdGlvblRhZ3MgPSBjaGFuZ2VkLnRhZ3MuZXZlcnkoKHQpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5lbmRzV2l0aCgnUm90YXRpb24nKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblgnKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblknKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblonKQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gb25seVJvdGF0aW9uVGFnczonLCBvbmx5Um90YXRpb25UYWdzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAob25seVJvdGF0aW9uVGFncykgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICBgLAogICAgb25BbnlCb3RzUmVtb3ZlZDogYEAKCiAgICAgICAgaWYgKHRoYXQuYm90SURzLmluY2x1ZGVzKHRhZ3MudHJhY2tCb3RJZCkpIHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICB9CiAgICBgLAogICAgb25Qb3J0YWxDaGFuZ2VkOiBgQAogICAgICAgIGlmICh0aGF0LmRpbWVuc2lvbiA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgICAgIH0KICAgIGAsCiAgICB1cGRhdGVMYWJlbDogYEAKICAgICAgICBpZiAoIXRhZ3MucmVhZHkpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmluZyB1cGRhdGVMYWJlbCBiZWNhdXNlIG5vdCByZWFkeScpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaGFzTGFiZWwgPSB0YWdzLmxhYmVsICE9IG51bGwgJiYgdGFncy5sYWJlbCAhPT0gJyc7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBoYXNMYWJlbDsKCiAgICAgICAgaWYgKCFoYXNMYWJlbCkgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmUgdXBkYXRlTGFiZWwgY2FsbCwgdGhlcmUgaXMgbm8gbGFiZWwgdGFnIHZhbHVlIHRvIGRpc3BsYXkuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGluTWFwUG9ydGFsID0gKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGNvbnN0IGluR3JpZFBvcnRhbCA9IChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAoIWluTWFwUG9ydGFsICYmICFpbkdyaWRQb3J0YWwpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JlIHVwZGF0ZUxhYmVsIGNhbGwsIG5vdCBpbiBlaXRoZXIgZ3JpZCBvciBtYXAgcG9ydGFsLicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHRyYWNrQm90ID0gZ2V0Qm90KCdpZCcsIHRhZ3MudHJhY2tCb3RJZCk7CiAgICAgICAgY29uc3QgdHJhY2tQb3NpdGlvbiA9IGdldEJvdFBvc2l0aW9uKHRyYWNrQm90LCB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gdHJhY2tQb3NpdGlvbjonLCB0cmFja1Bvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGxldCBsYWJlbFBvc2l0aW9uID0geyB4OiB0cmFja1Bvc2l0aW9uLngsIHk6IHRyYWNrUG9zaXRpb24ueSwgejogdHJhY2tQb3NpdGlvbi56IH07IAoKICAgICAgICBjb25zdCB0cmFja0JvdFNjYWxlID0gdHJhY2tCb3QudGFncy5zY2FsZSA/PyAxOwogICAgICAgIGNvbnN0IHRyYWNrQm90U2NhbGVaID0gdHJhY2tCb3QudGFncy5zY2FsZVogPz8gMTsKCiAgICAgICAgbGV0IG1ldGVyc1BlckdyaWRVbml0ID0gMTsKCiAgICAgICAgaWYgKGluTWFwUG9ydGFsKSB7CiAgICAgICAgICAgIC8vIFNjYWxlIHRvIG1hcCBwb3J0YWwgdW5pdHMuCiAgICAgICAgICAgIG1ldGVyc1BlckdyaWRVbml0ID0gMTA7CiAgICAgICAgfQoKICAgICAgICBsZXQgdHJhY2tCb3RSZWFsU2NhbGVaID0gKHRyYWNrQm90U2NhbGVaICogdHJhY2tCb3RTY2FsZSkgKiBtZXRlcnNQZXJHcmlkVW5pdDsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSB0cmFja0JvdFJlYWxTY2FsZVo6JywgdHJhY2tCb3RSZWFsU2NhbGVaKTsKICAgICAgICB9CgogICAgICAgIGxhYmVsUG9zaXRpb24ueiArPSB0cmFja0JvdFJlYWxTY2FsZVogKyAodGFncy5ib3RMYWJlbE1hcmdpbiAqIG1ldGVyc1BlckdyaWRVbml0KTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBsYWJlbFBvc2l0aW9uOicsIGxhYmVsUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdYJ10gPSBsYWJlbFBvc2l0aW9uLng7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdZJ10gPSBsYWJlbFBvc2l0aW9uLnk7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdaJ10gPSBsYWJlbFBvc2l0aW9uLno7CiAgICBgCn07CgpsYWJlbE1vZCA9IHsKICAgIC4uLmxhYmVsTW9kLAogICAgLi4ucmVzdCwKfQoKY29uc3QgbGFiZWxCb3QgPSBjcmVhdGUobGFiZWxNb2QpOwoKcmV0dXJuIGxhYmVsQm90OycAp9rr9gXMowMFdXRpbHMCBACn2uv2BfroAyjwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwCn2uv2BcyjAwRmb3JtAgQAp9rr9gWh6QMHbm90aGluZycAp9rr9gXMowMJYWJWZXJzaW9uAgQAp9rr9gWp6QMFMTAuMjkA"}]}