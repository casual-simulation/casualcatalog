{"version":2,"updates":[{"id":0,"timestamp":1767819631112,"update":"Ae4B8++h3QkAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwDz76HdCQAKYWJJRE9yaWdpbgIEAPPvod0JAQ10b29sYm94X3NraWxsJwDz76HdCQALYWJJbnRlcmZhY2UCBADz76HdCQ8EdHJ1ZScA8++h3QkAC2Rlc2NyaXB0aW9uAgQA8++h3QkUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwDz76HdCQAEZm9ybQIEAPPvod0JPgdub3RoaW5nJwDz76HdCQAEbWVudQIEAPPvod0JRijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwDz76HdCQAGc3lzdGVtAgQA8++h3QltFGFiLmludGVyZmFjZS50b29sYm94JwDz76HdCQAKYWJJRFN0dWRpbwIEAPPvod0JggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwDz76HdCQAIcmVtZW1iZXICBADz76HdCacBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAPPvod0JAAt0b29sYm94X2FkZAIEAPPvod0JzgHIC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgiYmFzZVNraWxsIiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIG1lbnVCb3Qub25Qb2ludGVyVXAoKTsKICAgICAgICBtZW51Qm90Lm9uQ2xpY2soKTsKICAgIH0KfQplbHNlIGlmIChhY3RpdmVUb29sYm94ICYmIGFjdGl2ZVRvb2xib3gudGFncy5hYkdyaWRNZW51QWN0aW9uKSB7CiAgICBhY3RpdmVUb29sYm94LmFiR3JpZE1lbnVBY3Rpb24oeyBncmlkSW5mb3JtYXRpb246IGdyaWREYXRhIH0pOwp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiQ29yZU1lbnVBY3Rpb24pIHsKICAgIC8vUkVGUkVTSCBBTkQgVEhFTiBPUEVOPz8/Cn0nAPPvod0JAAVsZWFybgIEAPPvod0Jlw0o8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycA8++h3QkABXN0b3JlAgQA8++h3Qm+DSjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwDz76HdCQAGc2VhcmNoAgQA8++h3QnlDSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwDz76HdCQAIYWJJZ25vcmUCBADz76HdCYwOBHRydWUnAPPvod0JAAlhYlZlcnNpb24CBADz76HdCZEOBTEwLjM1JwDz76HdCQANbWFuaWZlc3RhdGlvbgIEAPPvod0Jlw4o8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcA8++h3QkAEGFiR3JpZE1lbnVBY3Rpb24CBADz76HdCb4OuQtALy8gc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCi8vIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgovLyB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKLy8gICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKLy8gYDsKLy8gdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAovLyAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKLy8gICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwovLyAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyAgICAgfQovLyBgOwovLyB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBgQAovLyAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBudWxsOwovLyBgOwoKLy8gY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7Ci8vIGNvbnN0IG1lbnVCb3QgPSB7fTsKCi8vIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsKLy8gbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwovLyBtZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKLy8gbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKLy8gbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsKLy8gbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwovLyBtZW51Qm90Lm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsKCi8vIGZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspCi8vIHsKLy8gICAgIGNvbnN0IGFjdGl2ZVRvb2xib3ggPSBwb3NzaWJsZVRvb2xib3hlc1tpXTsKLy8gICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7CgovLyAgICAgbWVudUJvdC50b29sYm94X2RhdGEgPSBhY3RpdmVUb29sYm94OwovLyAgICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOwoKLy8gICAgIGlmICghZXh0YW50Qm90KQovLyAgICAgewovLyAgICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCb3QpOwovLyAgICAgfQovLyB9JwDz76HdCQAUYWJHcmlkTWVudU9uR2VuZXJhdGUCBADz76HdCfgZ4gJAY29uc3QgdG9vbGJveEFycmF5ID0gYWJSZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7CgpsZXQgYWxsVG9vbHNMb2FkZWQgPSB0cnVlOwoKZm9yIChsZXQgaSA9IDA7IGkgPCB0b29sYm94QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IGN1cnJlbnRUb29sID0gdG9vbGJveEFycmF5W2ldLm5hbWU7CgogICAgaWYgKCFnZXRCb3QoImFiSURPcmlnaW4iLCBjdXJyZW50VG9vbCkgJiYgIWdldEJvdChjdXJyZW50VG9vbCwgdHJ1ZSkpIHsKICAgICAgICBhbGxUb29sc0xvYWRlZCA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgfQp9CgppZiAoYWxsVG9vbHNMb2FkZWQpIHsKICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAPPvod0JAA5hYkdyaWRNZW51SWNvbgIEAPPvod0J2xwKbG9jYWxfbWFsbCcA8++h3QkAD2FiR3JpZE1lbnVMYWJlbAIEAPPvod0J5hwHY2F0YWxvZycA8++h3QkAE2FiR3JpZE1lbnVTb3J0T3JkZXICBADz76HdCe4cAzEwMCcA8++h3QkAD29uQUJJbml0aWFsaXplZAIEAPPvod0J8hwqQC8vIGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7JwDz76HdCQANb25Ta2lsbFVwZGF0ZQIEAPPvod0JnR1XQGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7DQoNCmNvbnNvbGUubG9nKCJbVG9vbGJveF0gTG9hZGluZyBjYXN1YWwga2l0Iik7JwDz76HdCQAKc2hlbGxVdGlscwIEAPPvod0J9R0o8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycA8++h3QkAGGFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZQIEAPPvod0JnB7UCUBpZiAoYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkNhdGFsb2dOYW1lKSB7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJHcmlkTWVudUxhYmVsIiwgYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkNhdGFsb2dOYW1lKTsNCn0NCg0KDQovL05FVw0KY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IHBvc3NpYmxlVG9vbGJveGVzID0gbGlua3MucmVtZW1iZXIudGFncy50b29sYm94X2FycmF5Ow0KDQpmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlVG9vbGJveGVzLmxlbmd0aDsgaSsrKQ0Kew0KICAgIGNvbnN0IG1lbnVCb3QgPSB7fTsNCg0KICAgIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsNCiAgICBtZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQogICAgbWVudUJvdC5ncmlkRGF0YSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQogICAgbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsNCiAgICBtZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOw0KICAgIG1lbnVCb3QubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsNCiAgICBtZW51Qm90Lm9uQ2xpY2sgPSBgQCANCiAgICAgICAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyANCiAgICAgICAgc2V0VGFnTWFzayhhYi5saW5rcy5yZW1lbWJlciwgImxhc3RPcGVuZWREcm9wZG93biIsIG51bGwpOw0KICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7DQogICAgDQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7DQogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOw0KDQogICAgaWYgKCFleHRhbnRCb3QpDQogICAgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtZW51Qm90KTsNCiAgICB9DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycA8++h3QkAEmFiR3JpZE1lbnVJdGVtVHlwZQIEAPPvod0J8ScIZHJvcGRvd24nAPPvod0JABFkcm9wZG93blNvcnRPcmRlcgIEAPPvod0J+icDMTAwJwDz76HdCQAPZHJvcGRvd25PcHRpb25zAgQA8++h3Qn+Jwbwn6esW10nAQRib3RzJDE3NDEwZDgzLTdlZWUtNGExZS1iNjM4LTY1NDYzNzRkMTdjMwEnAPPvod0JgygGc3lzdGVtAgQA8++h3QmEKBFhYi5pbnRlcmZhY2Uuc2NhbicA8++h3QmDKARmb3JtAgQA8++h3QmWKAdub3RoaW5nJwDz76HdCYMoC2FiSW50ZXJmYWNlAgQA8++h3QmeKAR0cnVlJwDz76HdCYMoCGFiSWdub3JlAgQA8++h3QmjKAR0cnVlJwDz76HdCYMoD29uUVJDb2RlU2Nhbm5lZAIEAPPvod0JqCj9D0BpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBzY2FubmVkICIgKyB0aGF0KTsKCmxldCByZXF1ZXN0aW5nQUkgPSBmYWxzZTsKaWYgKGNvbmZpZ0JvdC50YWdzLnJlcXVlc3RpbmdBSSkgewogICAgY29uZmlnQm90LnRhZ3MucmVxdWVzdGluZ0FJID0gbnVsbDsKICAgIHJlcXVlc3RpbmdBSSA9IHRydWU7Cn0KCmlmIChjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbikKewogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGlua3Muc3RvcmUuYWJRUlB1Ymxpc2godGhhdCk7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuKQp7CiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICBjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4gPSBudWxsOwoKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIHRyeQogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CgogICAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IHBoQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoInBoIik7CiAgICBsZXQgaW5zdENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJpbnN0Iik7CiAgICBsZXQgYWJDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiYWIiKTsKICAgIGxldCBjd0NoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJjdyIpOwoKICAgIGlmIChwaENoZWNrICYmIGluc3RDaGVjayAmJiBhYkNoZWNrICYmIGN3Q2hlY2spCiAgICB7CiAgICAgICAgb3MuZ29Ub1VSTCh0aGF0KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBvcy50b2FzdCgibm90IGEgcmVjb2duaXplZCBwcmFjdGljZSBwZXJtaXQiKTsKICAgIH0KCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLmFiU2NhbikKewogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBjb25maWdCb3QudGFncy5hYlNjYW4gPSBudWxsOwogICAgCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICB0cnkgCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7CiAgICB9CiAgICBjYXRjaCAoZSkgCiAgICB7CiAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiB0aGF0fSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZihzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFzayIpID09ICJlZ2dDYXJ0b24iKQogICAgewogICAgICAgIGlmIChyZXF1ZXN0aW5nQUkpIHsKICAgICAgICAgICAgc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJyZXF1ZXN0aW5nQUkiLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgb3MuZ29Ub1VSTChzY2FubmVkVVJMLmhyZWYpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5hc2spIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hc2t9KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5wYXR0ZXJufSk7CiAgICAgICAgfQogICAgICAgIAogICAgfQp9JwDz76HdCYMoBXN0b3JlAgQA8++h3QmmOCjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwDz76HdCYMoBnNlYXJjaAIEAPPvod0JzTgo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScA8++h3QmDKBBhYkNvcmVNZW51QWN0aW9uAgQA8++h3Qn0ODdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwDz76HdCYMoD2FiQ29yZU1lbnVMYWJlbAIEAPPvod0JrDkEc2NhbicA8++h3QmDKA5hYkNvcmVNZW51SWNvbgIEAPPvod0JsTkPcXJfY29kZV9zY2FubmVyJwDz76HdCYMoE2FiQ29yZU1lbnVTb3J0T3JkZXICBADz76HdCcE5ATMnAPPvod0JgygJYWJWZXJzaW9uAgQA8++h3QnDOQUxMC4zNScBBGJvdHMkM2E2Y2I5Y2EtYjNiNC00ZDc3LTgyZjYtZmE1OWI1Mjk2ZWM5AScA8++h3QnJOQZzeXN0ZW0CBADz76HdCco5F2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwDz76HdCck5CGFiSWdub3JlAgQA8++h3QniOQR0cnVlJwDz76HdCck5D2Ryb3Bkb3duT3B0aW9ucwIEAPPvod0J5zkG8J+nrFtdJwDz76HdCck5EmFiQ29yZU1lbnVJdGVtVHlwZQIEAPPvod0J7DkIZHJvcGRvd24nAPPvod0JyTkRZHJvcGRvd25Tb3J0T3JkZXICBADz76HdCfU5BGF1dG8nAPPvod0JyTkYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQA8++h3Qn6Of4gQGNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCmNvbnN0IGN1cnJlbnRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyAibWFwIiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT0gImJsdWVwcmludCIgPyAiYmx1ZXByaW50IiA6ImdyaWQiOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCi8vIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQovLyB9IGVsc2Ugew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCi8vIH0NCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTmF2aWdhdGlvbk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCg0KY29uc3QgaG9tZVdvcmxkQnV0dG9uID0gew0KICAgIC4uLm1lbnVPcHRpb25zLA0KICAgIGxhYmVsOiAiaG9tZSB3b3JsZCIsDQogICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvMzhhZThiNjk1N2Y0NDgzZDg3MTYxNDFkMWU5OGM5M2YwZTdkY2NlMTViYzVjMTIzYmQwZTllMWFiNjg3Y2MwNS5wbmcnLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIGNvbnN0IGN1cnJlbnRVUkwgPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCk7DQogICAgICAgIGNvbnN0IG9yaWdpbiA9IGN1cnJlbnRVUkwub3JpZ2luOw0KDQogICAgICAgIGxldCBuZXdVUkwgPSBuZXcgVVJMKG9yaWdpbik7DQoNCiAgICAgICAgaWYgKGFiUmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY2hhbm5lbCIsIGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb25maWdCb3QudGFncy5jb21JZCkgew0KICAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImNvbUlkIiwgY29uZmlnQm90LnRhZ3MuY29tSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm93bmVyIiwgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiAicGxheWVyIik7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJpbnN0IiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm1hcFBvcnRhbCIsICdob21lJyk7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJhc2siLCAnaG9tZScpOw0KICAgICAgICANCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgew0KICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgic3R1ZGlvIiwgdGhhdC5pZCk7IA0KICAgICAgICB9DQoNCiAgICAgICAgb3Mub3BlblVSTChuZXdVUkwuaHJlZik7DQogICAgYA0KfTsNCg0KaWYgKCFnZXRCb3QoImlzSG9tZVdvcmxkQ29yZSIsIHRydWUpICYmIGF1dGhCb3QpIHsNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lV29ybGRCdXR0b24pOw0KfQ0KDQppZiAoY3VycmVudFBvcnRhbCA9PSAnbWFwJykgew0KDQogICAgY29uc3QgaG9tZUJhc2VCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQoNCiAgICBpZiAoaG9tZUJhc2VCb3QpIHsNCiAgICAgICAgY29uc3QgaG9tZUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhvbWVCYXNlQm90LnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1L2NkMzhhZmZjMDYwNGJlYWE1ODhkYTIxYWExYmU3NTBiYjNlNzNiM2IzY2FlMjNlYjMwMzA3YzM0NDk0NDU5ZjMucG5nJywNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgY29uc3QgaG9tZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBpZiAoaG9tZUJvdCkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGhvbWVCb3QsIHsgem9vbTogMjAwMCB9KS5jYXRjaCgoKSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZUJ1dHRvbik7DQogICAgfQ0KDQogICAgY29uc3QgcGxhY2VzQXJyID0gW107DQogICAgY29uc3QgcGxhY2VzID0gZ2V0Qm90cygiaG9tZVBsYWNlIiwgdHJ1ZSk7DQogICAgZm9yIChjb25zdCBoUGxhY2Ugb2YgcGxhY2VzKSB7DQogICAgICAgIGlmIChoUGxhY2UudGFncy5ob21lQmFzZSA9PSB0cnVlKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBwbGFjZU9iaiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhQbGFjZS50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2xvY2F0aW9uX29uJywNCiAgICAgICAgICAgIHBsYWNlOiBnZXRMaW5rKGhQbGFjZSksDQogICAgICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgICAgIGlmIChsaW5rcy5wbGFjZSkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGxpbmtzLnBsYWNlLCB7IHpvb206IDIwMDAgfSkuY2F0Y2goZSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICAgICAgYA0KICAgICAgICB9DQoNCiAgICAgICAgcGxhY2VzQXJyLnB1c2gocGxhY2VPYmopOw0KICAgIH0NCg0KICAgIHBsYWNlc0Fyci5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgIGNvbnN0IG5hbWVBID0gYS5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KICAgICAgICBjb25zdCBuYW1lQiA9IGIubGFiZWwudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMDsNCiAgICB9KTsNCg0KICAgIGZvciAoY29uc3Qgc29ydGVkUGxhY2Ugb2YgcGxhY2VzQXJyKSB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHNvcnRlZFBsYWNlKTsNCiAgICB9DQoNCg0KICAgIGNvbnN0IGN1cnJlbnRMb2NhdGlvbkJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiAnY3VycmVudCBsb2NhdGlvbicsDQogICAgICAgIGZvcm1BZGRyZXNzOiAnbmVhcl9tZScsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5za2lsbEJvdC5nb1RvQ3VycmVudExvY2F0aW9uKCk7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goY3VycmVudExvY2F0aW9uQnV0dG9uKTsNCn0NCg0KaWYgKGRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPT0gMCkgew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KfSBlbHNlIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycA8++h3QnJORBhYkNvcmVNZW51QWN0aW9uAgQA8++h3Qn5WgNALy8nAPPvod0JyTkLYWJJbnRlcmZhY2UCBADz76HdCf1aBHRydWUnAPPvod0JyTkPYWJDb3JlTWVudUxhYmVsAgQA8++h3QmCWwlwbGFjZSBuYXYnAPPvod0JyTkEZm9ybQIEAPPvod0JjFsHbm90aGluZycA8++h3QnJORNnb1RvQ3VycmVudExvY2F0aW9uAgQA8++h3QmUW4AEQGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgb3MuZ2V0R2VvbG9jYXRpb24oKTsNCg0KaWYgKGxvY2F0aW9uLnN1Y2Nlc3MpIHsNCiAgICBjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCiAgICBjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCg0KICAgIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IGN1cnJlbnREaW07DQogICAgfQ0KDQogICAgb3MuZm9jdXNPbih7eDogbG9jYXRpb24ubG9uZ2l0dWRlLCB5OiBsb2NhdGlvbi5sYXRpdHVkZX0sIHtwb3J0YWw6ICdtYXAnLCB6b29tOiAyMDAwfSk7DQp9IGVsc2Ugew0KICAgIG9zLnRvYXN0KCJMb2NhdGlvbiBzZXJ2aWNlcyBub3QgYXZhaWxhYmxlIikNCn0nAPPvod0JyTkJYWJWZXJzaW9uAgQA8++h3QmVXwUxMC4zNScBBGJvdHMkNDkzZmZhNGQtNDZkNC00YTk4LWFlOWMtMTIxMmQ2NTExMzNmAScA8++h3QmbXwZzeXN0ZW0CBADz76HdCZxfFGFiLmludGVyZmFjZS52ZXJzaW9uJwDz76HdCZtfDW9uU2tpbGxVcGRhdGUCBADz76HdCbFfpwFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJJbnRlcmZhY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiSW50ZXJmYWNlTWlub3JWZXJzaW9uOw0KDQpjb25zb2xlLmxvZygiW0FCSW50ZXJmYWNlXSBMb2FkZWQgQUIgSW50ZXJmYWNlIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycA8++h3QmbXxdhYkludGVyZmFjZU1ham9yVmVyc2lvbgIEAPPvod0J2WABMicA8++h3QmbXxdhYkludGVyZmFjZU1pbm9yVmVyc2lvbgIEAPPvod0J22ACMzMnAPPvod0Jm18IYWJJZ25vcmUCBADz76HdCd5gBHRydWUnAPPvod0Jm18EZm9ybQIEAPPvod0J42AHbm90aGluZycA8++h3QmbXwthYkludGVyZmFjZQIEAPPvod0J62AEdHJ1ZScA8++h3QmbXwlhYlZlcnNpb24CBADz76HdCfBgBTEwLjM1JwEEYm90cyQ0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYBJwDz76HdCfZgBnN5c3RlbQIEAPPvod0J92ATYWIuaW50ZXJmYWNlLm51Z2dldCcA8++h3Qn2YARmb3JtAgQA8++h3QmLYQdub3RoaW5nJwDz76HdCfZgC2FiSW50ZXJmYWNlAgQA8++h3QmTYQR0cnVlJwDz76HdCfZgCGFiSWdub3JlAgQA8++h3QmYYQR0cnVlJwDz76HdCfZgDGFiTG9hZE51Z2dldAIEAPPvod0JnWGYAkBsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0TmFtZTsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK251Z2dldE5hbWU7CmxldCBsb2FkZWROdWdnZXQgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGZvcm1hdHRlZE51Z2dldEFCLCBhYlZlcnNpb246IHRoYXQudmVyc2lvbiwgcmV0dXJuVHlwZTogImRhdGEifSk7Cgpsb2FkZWROdWdnZXQgPSBsb2FkZWROdWdnZXQuc3RhdGVbbnVnZ2V0TmFtZV0ubnVnZ2V0OwoKcmV0dXJuIGxvYWRlZE51Z2dldDsnAPPvod0J9mAPYWJQdWJsaXNoTnVnZ2V0AgQA8++h3Qm2Y4wDQC8vc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6ICJudWdOYW1lIiwgZGF0YTogZGF0YX0pOyAgQUREIEVHRyBJRCBFVkVOVFVBTExZCmxldCB0ZXN0TnVnZ2V0ID0gdGhhdC5kYXRhOwpsZXQgZm9ybWF0dGVkTnVnZ2V0ID0ge2lkOiB0aGF0Lm51ZywgbnVnZ2V0OiB0ZXN0TnVnZ2V0fTsKbGV0IHRlc3ROdWdnZXROYW1lID0gdGhhdC5udWc7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIit0ZXN0TnVnZ2V0TmFtZTsKCm1hc2tzLm51Z2dldFRvUHVibGlzaCA9IGZvcm1hdHRlZE51Z2dldEFCOwoKbGlua3Muc3RvcmUuYWJQdWJsaXNoQUIoe2FiOiBmb3JtYXR0ZWROdWdnZXRBQiwgdGFyZ2V0OiBmb3JtYXR0ZWROdWdnZXQsIHNvdXJjZUV2ZW50OiAncHVibGlzaF9udWdnZXQnfSk7JwDz76HdCfZgD2ltcGxlbWVudE51Z2dldAIEAPPvod0Jw2axB0BsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0OwpsZXQgbnVnZ2V0VmVyc2lvbkNoZWNrID0gbnVnZ2V0TmFtZS5pbmRleE9mKCIudiIpOwpsZXQgdmVyc2lvbjsKCmlmIChudWdnZXRWZXJzaW9uQ2hlY2sgIT0gLTEpCnsKICAgIG51Z2dldE5hbWUgPSBudWdnZXROYW1lLnN1YnN0cmluZygwLCBudWdnZXRWZXJzaW9uQ2hlY2spOwoKICAgIGxldCB2ZXJzaW9uQ2hlY2sgPSB0aGF0Lm51Z2dldC5zdWJzdHJpbmcobnVnZ2V0VmVyc2lvbkNoZWNrICsgMik7CgogICAgaWYgKGlzTmFOKHZlcnNpb25DaGVjaykpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2codmVyc2lvbkNoZWNrLCAidmVyc2lvbiBpcyBub3QgYSBudW1iZXIiKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB2ZXJzaW9uID0gTnVtYmVyKHZlcnNpb25DaGVjayk7CiAgICB9Cn0KY29uc29sZS5sb2cobnVnZ2V0TmFtZSwgdmVyc2lvbik7CmxldCBudWdEYXRhID0gYXdhaXQgdGhpc0JvdC5hYkxvYWROdWdnZXQoe251Z2dldE5hbWU6IG51Z2dldE5hbWUsIHZlcnNpb246IHZlcnNpb259KTsKCmlmIChudWdEYXRhID09ICJhYklEIG5vdCBmb3VuZCIpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgbm90IGZvdW5kIik7Cn0KZWxzZQp7CiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKICAgIGxldCB0YXJnZXRUYWcgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS50b1N0cmluZygpOwogICAgbGV0IHRhcmdldE51ZyA9ICJ7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRUYWcuaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKICAgIGluc2VydFRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCBudWdEYXRhKTsKfScA8++h3Qn2YAxudWdnZXRCdXR0b24CBADz76HdCfVt9QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnAPPvod0J9mALbnVnZ2V0UGFyc2UCBADz76HdCel6pw9AY29uc3Qgb3JpZ2luYWxUYWdWYWx1ZSA9IHRoYXQuZWRpdGVkQm90LnJhd1t0aGF0LmVkaXRlZFRhZ107CmxldCB0YWdWYWx1ZSA9IG9yaWdpbmFsVGFnVmFsdWU7CgppZiAoIXRhZ1ZhbHVlKSAKewogICAgcmV0dXJuOwp9CmVsc2UgaWYgKHR5cGVvZiB0YWdWYWx1ZSAhPT0gInN0cmluZyIpIAp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnRvU3RyaW5nKCk7Cn0KCmxldCBpbml0aWFsUG9zc2libGVOdWdQb3MgPSAwOwoKaWYgKGluaXRpYWxQb3NzaWJsZU51Z1BvcyA9PSAtMSkgCnsKICAgIHJldHVybjsKfQplbHNlCnsKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxQb3NzaWJsZU51Z1Bvcyk7Cn0KCmxldCBwb3NzaWJsZU51Z3MgPSBvcmlnaW5hbFRhZ1ZhbHVlLnJlcGxhY2UoL1tee10vZywgIiIpLmxlbmd0aDsKbGV0IHRvdGFsTnVnQnJlYWtzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwpsZXQgYnJlYWtMZXZlbCA9IDA7CmxldCBudWdzVG9DaGVjayA9IFtdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZU51Z3M7IGkrKykKewogICAgbGV0IGluaXRpYWxOdWdQb3MgPSB0YWdWYWx1ZS5pbmRleE9mKCJ7IikgKyAxOwogICAgbGV0IHBvc3NpYmxlTnVnRW5kID0gdGFnVmFsdWUuaW5kZXhPZigifSIpOwogICAgbGV0IHBvc3NpYmxlTnVnID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MsIHBvc3NpYmxlTnVnRW5kKTsKCiAgICBpZiAocG9zc2libGVOdWcuaW5kZXhPZigiICIpID09IC0xICYmIC9cbi9nLnRlc3QocG9zc2libGVOdWcpICE9IHRydWUgJiYgcG9zc2libGVOdWcubGVuZ3RoID4gMCAmJiBwb3NzaWJsZU51Zy5pbmRleE9mKCI6IikgPT0gLTEpCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ7Iitwb3NzaWJsZU51ZysifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwogICAgICAgIGxldCBwdWJsaXNoQ2hlY2sgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDYsIGluaXRpYWxOdWdQb3MgLSAyKTsKICAgICAgICBsZXQgbnVnUHVibGlzaCA9IG51bGw7CgogICAgICAgIGlmIChwdWJsaXNoQ2hlY2sgPT0gIi5udWciKQogICAgICAgIHsKICAgICAgICAgICAgbnVnUHVibGlzaCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgICAgICAKICAgICAgICAvL0NIRUNLIElGICQgYmVmb3JlIG51Z2dldAogICAgICAgIGlmICh0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDIsIGluaXRpYWxOdWdQb3MgLSAxKSAhPSAiJCIpCiAgICAgICAgewogICAgICAgICAgICBudWdzVG9DaGVjay5wdXNoKHtudWdOYW1lOiBwb3NzaWJsZU51ZywgbnVnU3RhcnQ6IG51Z0JyZWFrcyArIDEsIG51Z1B1Ymxpc2g6IG51Z1B1Ymxpc2h9KTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ9IikpLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CgogICAgICAgIGJyZWFrTGV2ZWwgKz0gbnVnQnJlYWtzOwoKICAgICAgICBudWdCcmVha3MgPSB0b3RhbE51Z0JyZWFrcyAtICh0b3RhbE51Z0JyZWFrcyAtIGJyZWFrTGV2ZWwpOwogICAgfQoKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKHBvc3NpYmxlTnVnRW5kICsgMSk7Cn0KCnRoaXNCb3QubnVnZ2V0QnV0dG9uKHsgbnVnZ2V0OiBudWdzVG9DaGVjaywgYm90OiB0aGF0LmVkaXRlZEJvdCwgdGFnOiB0aGF0LmVkaXRlZFRhZywgdGFnVmFsdWU6IG9yaWdpbmFsVGFnVmFsdWV9KTsnAPPvod0J9mANb25BQlB1Ymxpc2hlZAIEAPPvod0JkYoBwQFAY29uc29sZS5sb2codGhhdC5hYiwgdGFncy5udWdnZXRUb1B1Ymxpc2gpCgppZiAodGhhdC5hYiA9PSB0YWdzLm51Z2dldFRvUHVibGlzaCkKewogICAgb3MudG9hc3QoIm51Z2dldCBwdWJsaXNoZWQiKTsKCiAgICBtYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBudWxsOwoKICAgIGNvbmZpZ0JvdC5tYXNrcy5hYlZlcnNpb24gPSBudWxsOwp9JwDz76HdCfZgEG9uQW55Qm90c0NoYW5nZWQCBADz76HdCdOLAbcEQGlmIChjb25maWdCb3QgJiYgdGhhdFswXS5ib3QuaWQgIT0gdGhpc0JvdC5pZCkgCnsKICAgIGlmICghY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdCkgcmV0dXJuOyAvLyBJZ25vcmUgaWYgdGhlIGNvbmZpZ0JvdCBpc24ndCByZWFkeSB5ZXQuCgogICAgY29uc3QgZWRpdGVkQm90SUQgPSBjb25maWdCb3QudGFncy5lZGl0aW5nQm90LnJlcGxhY2UoIvCflJciLCAiIik7CgogICAgaWYgKCF0aGF0LmZpbmQoeCA9PiB4LmJvdC5pZCA9PSBlZGl0ZWRCb3RJRCkpIHJldHVybjsgLy8gSWYgdGhlIGJvdCBjaGFuZ2VkIHdhc24ndCBiZWluZyBlZGl0ZWQgYnkgdGhlIHVzZXIgaWdub3JlIGl0LgoKICAgIGNvbnN0IGVkaXRlZFRhZyA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdUYWc7CiAgICBjb25zdCBlZGl0ZWRCb3QgPSBnZXRCb3QoImlkIiwgZWRpdGVkQm90SUQpOwoKICAgIGlmIChlZGl0ZWRCb3QgJiYgZWRpdGVkVGFnKSAKICAgIHsKICAgICAgICBzaG91dCgibnVnZ2V0UmVzZXQiKTsKCiAgICAgICAgdGhpc0JvdC5udWdnZXRQYXJzZSh7IGVkaXRlZEJvdCwgZWRpdGVkVGFnIH0pOwogICAgfQp9JwDz76HdCfZgCG9uQ3JlYXRlAgQA8++h3QmJkAFMQHRhZ3MubGlzdGVuaW5nID0gZmFsc2U7CgovL3NldFRhZ01hc2sodGhpc0JvdCwgImxpc3RlbmluZyIsIHRydWUsICJsb2NhbCIpOycA8++h3Qn2YA1wYWNrYWdlTnVnZ2V0AgQA8++h3QnWkAH4BkBjb25zdCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwpjb25zdCB0YWdUZXh0ID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ107CgppZiAoY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleCB8fCBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleCkKewogICAgbGV0IHN0YXJ0UG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleDsKICAgIGxldCBlbmRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleDsKCiAgICBpZiAoc3RhcnRQb3MgPT0gZW5kUG9zKQogICAgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2UgaWYgKHN0YXJ0UG9zID4gZW5kUG9zKQogICAgewogICAgICAgIGxldCBuZXdTdGFydFBvcyA9IGVuZFBvczsKICAgICAgICBsZXQgbmV3RW5kUG9zID0gc3RhcnRQb3M7CgogICAgICAgIHN0YXJ0UG9zID0gbmV3U3RhcnRQb3M7CiAgICAgICAgZW5kUG9zID0gbmV3RW5kUG9zOwogICAgfQoKICAgIGxldCBkYXRhID0gdGFnVGV4dC5zdWJzdHJpbmcoc3RhcnRQb3MsIGVuZFBvcyArIDEpOwoKICAgIHNob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiB0aGF0Lm51Z2dldCwgZGF0YTogZGF0YX0pOwoKICAgIG9zLnRvYXN0KCJudWcgaXMgcHVibGlzaGluZyIsIDEwKTsKCiAgICBsZXQgdGFyZ2V0TnVnID0gIi5udWcgeyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10uaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJjYW5ub3QgcmVhZCBudWdnZXQgdG8gYmUgcHVibGlzaGVkIikKfScA8++h3Qn2YAhyZW1lbWJlcgIEAPPvod0Jz5cBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAPPvod0J9mAGc2VhcmNoAgQA8++h3Qn2lwEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScA8++h3Qn2YAVzdG9yZQIEAPPvod0JnZgBKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAPPvod0J9mAJbGlzdGVuaW5nAgQA8++h3QnEmAEFZmFsc2UnAPPvod0J9mAJYWJWZXJzaW9uAgQA8++h3QnKmAEFMTAuMzUnAQRib3RzJGIzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYgEnAPPvod0J0JgBCHByZXNlbmNlAgQA8++h3QnRmAEo8J+Ulzg3ZTk1MzQyLWU0NTYtNGI2My05ODkxLWQ3YTkyMWFkM2VlNycA8++h3QnQmAEZYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcgIEAPPvod0J+JgBzgxAY29uc3QgewogICAgbGFiZWwgPSBgJHthYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9IGlzIHdvcmtpbmdgLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fQoKbGV0IGJ1c3lJbmRpY2F0b3IgPSB7CiAgICBvblBvaW50ZXJVcDogbnVsbCwKICAgIG9uUG9pbnRlckRvd246IG51bGwsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgYnVzeUxhYmVsOiBsYWJlbCwKICAgIGxhYmVsQWxpZ25tZW50OiAnbGVmdCcsCiAgICBzdGF0ZTogMCwKICAgIGFuaW1TdGF0ZXM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgXSwKICAgIGFuaW1SYXRlOiA1MDAsCiAgICBvbkJvdEFkZGVkOiBgQAogICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICBvbkJvdENoYW5nZWQ6IGBACiAgICAgICAgY29uc3QgbmVlZFJlZnJlc2ggPSB0aGF0LnRhZ3Muc29tZSh0ID0+IHQgPT09ICdidXN5TGFiZWwnIHx8IHQgPT09ICdzdGF0ZScgfHwgdCA9PT0gJ2FuaW1TdGF0ZXMnKTsKICAgICAgICBpZiAobmVlZFJlZnJlc2gpIHsKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0KICAgIGAsCiAgICByZWZyZXNoRGlzcGxheTogYEAKICAgICAgICBpZiAodGFncy5hbmltU3RhdGVzICYmIHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IGFuaW1TdGF0ZSA9IHRhZ3MuYW5pbVN0YXRlc1t0YWdzLnN0YXRlXTsKCiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSB0YWdzLmJ1c3lMYWJlbC50cmltKCkgKyBhbmltU3RhdGUuZWxsaXBzaXM7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBhbmltU3RhdGUuZm9ybUFkZHJlc3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5sYWJlbCAKICAgICAgICB9CiAgICBgLAogICAgYW5pbWF0ZTogYEAKICAgICAgICBpZiAodGFncy5zdGF0ZSA+PSB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICB0YWdzLnN0YXRlID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLnN0YXRlICs9IDE7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBvcy5zbGVlcCh0YWdzLmFuaW1SYXRlKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICAuLi5yZXN0Cn07Cgpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYnVzeUluZGljYXRvcik7CgpyZXR1cm4gbWVudUJvdDsnAPPvod0J0JgBBnN5c3RlbQIEAPPvod0Jx6UBEWFiLmludGVyZmFjZS5tZW51JwDz76HdCdCYAQRmb3JtAgQA8++h3QnZpQEHbm90aGluZycA8++h3QnQmAELZGVzY3JpcHRpb24CBADz76HdCeGlASZUaGlzIHNraWxsIGlzIGRlc2lnbmVkIGZvciBtZW51IHN0dWZmLigA8++h3QnQmAELYWJJbnRlcmZhY2UBeCcA8++h3QnQmAEKYWJPcGVuTWVudQIEAPPvod0JiaYB8R5AYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgbWVudVR5cGUgPSB0aGF0ID8gImFiIiArIHRoYXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGF0LnNsaWNlKDEpICsgIk1lbnUiOiAiYWJDb3JlTWVudSI7IC8vc2V0IHVwIGEgY2hlY2sgdG8gc2VlIHdoYXQgdHlwZSBvZiBtZW51IHNob3VsZCBiZSBvY2N1cmluZyBbY29yZSwgYm90LCBncmlkLCBpbnN0XQpsZXQgbWVudVNraWxscyA9IGdldEJvdHMobWVudVR5cGUgKyAiQWN0aW9uIik7CmxldCBtYXhPcHRpb25zID0gbWVudVR5cGUgPT0gImluc3QiID8gNyA6IDU7CmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5OwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MuYmFzZVNraWxsLiR7bWVudVR5cGUgKyAiQWN0aW9uIn0oe2JvdDogdGhpc0JvdH0pO2A7CgpsZXQgc29ydE9yZGVySW5kZXggPSBtZW51U2tpbGxzLmxlbmd0aDsKZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51U2tpbGxzLmxlbmd0aDsgaSsrKS8vQUREIExPR0lDIEZPUiBNT1JFIE9QVElPTlMgVEhBTiA1IDogbWF4T3B0aW9ucwp7CiAgICAvL0FsbG93cyBmb3IgY29kZSB0byBnZXQgY2FsbGVkIGJlZm9yZSB0aGUgbWVudSBnZW5lcmF0ZXMsIHVzZWZ1bCBmb3IgZHluYW1pY2FsbHkgc2V0IGdyb3VwcyBvciBkcm9wZG93bnMKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiXSkgewogICAgICAgIGF3YWl0IHdoaXNwZXIobWVudVNraWxsc1tpXSwgbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiKTsKICAgIH0gCgogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJIaWRlIl0pIHsKICAgICAgICBjb250aW51ZTsKICAgIH0KICAgIAogICAgbGV0IGN1cnJlbnRTa2lsbCA9IG1lbnVTa2lsbHNbaV07CgogICAgYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGN1cnJlbnRTa2lsbC5pZDsKICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkxhYmVsIl07CiAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJY29uIl07CiAgICBhYk1lbnVCdXR0b24ub25DcmVhdGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJPbkdlbmVyYXRlIl07CiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiU29ydE9yZGVyIl07CiAgICBhYk1lbnVCdXR0b24uY29sb3IgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdID8/IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwoKICAgIGNvbnN0IG1lbnVJdGVtVHlwZSA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl07CgogICAgaWYgKG1lbnVJdGVtVHlwZSA9PSAiZHJvcGRvd24iKSB7CiAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duT3B0aW9ucyA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duT3B0aW9uczsKCiAgICAgICAgY29uc3QgcHJldkRyb3Bkb3duID0gbGlua3MucmVtZW1iZXIubGlua3MubGFzdE9wZW5lZERyb3Bkb3duOwogICAgICAgIGlmIChwcmV2RHJvcGRvd24gJiYgcHJldkRyb3Bkb3duLnRhZ3NbbWVudVR5cGUgKyAiQWN0aW9uIl0pIHsKICAgICAgICAgICAgaWYgKHByZXZEcm9wZG93biA9PSBjdXJyZW50U2tpbGwpIHsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICJsYXN0T3BlbmVkRHJvcGRvd24iLCBudWxsKTsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkRlZmF1bHRPcGVuIl0gPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBhYk1lbnVCdXR0b24uZGVmYXVsdE9wZW47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5kcm9wZG93blNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJNZW51QnV0dG9uKTsgICAgICAgIAogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gImdyb3VwIikgewogICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhYk1lbnVCdXR0b24ubWVudUl0ZW1zID0gY3VycmVudFNraWxsLnRhZ3MubWVudUl0ZW1zOwogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJpbnB1dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtVHlwZSA9PSAidGV4dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJ0b29sIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gIndpemFyZCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOwogICAgfQp9Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJPcGVuTWVudScsIHsgbWVudTogdGhhdCwgbWVudVR5cGUsIG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsIH0pOycA8++h3QnQmAESYWJDcmVhdGVNZW51QnV0dG9uAgQA8++h3Qn5xAH4DUBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9OwoKbGV0IHsKICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwKICAgIC4uLmFkZGl0aW9uYWxUYWdzCn0gPSB0aGF0ID8/IHt9CgppZiAodHlwZW9mIG1lbnVJdGVtU3R5bGUgPT0gJ3N0cmluZycpIHsKICAgIG1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbVN0eWxlLnJlcGxhY2UoL1x1ezFGOUVDfS91LCAnJyk7IAogICAgbWVudUl0ZW1TdHlsZSA9IEpTT04ucGFyc2UobWVudUl0ZW1TdHlsZSk7Cn0KCmZ1bmN0aW9uIGhhc0JvcmRlclN0eWxlKCkgewogICAgaWYgKG1lbnVJdGVtU3R5bGVbImJvcmRlci10b3Atc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItbGVmdC1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1ib3R0b20tc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItcmlnaHQtc3R5bGUiXSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdKSB7CiAgICBpZiAoYWRkaXRpb25hbFRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJNZW51R3JvdXAiXSkgewoKICAgIH0KfQoKbmV3TWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdNZW51QnV0dG9uLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7Cm5ld01lbnVCdXR0b24ubGFiZWxDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7Cm5ld01lbnVCdXR0b24uc2hhZG93Q29sb3IgPSB0aGF0LnNoYWRvd0NvbG9yID8/IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU2hhZG93Q29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLnNjYWxlWSA9IDE7Cgpjb25zdCBtZW51U3R5bGluZyA9IHsKICAgICJib3JkZXItcmFkaXVzIjoiOHB4IiwKICAgICJtYXJnaW4tdG9wIjogIjhweCIsCiAgICAiYm94LXNoYWRvdyI6IGAzcHggNHB4ICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIm1pbi1oZWlnaHQiOiAiNDRweCIsCiAgICAiYm9yZGVyIjogaGFzQm9yZGVyU3R5bGUoKSA/ICIiIDogYDJweCBzb2xpZCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJ3aWR0aCI6ICJjYWxjKDEwMCUgLSA1cHgpIiwKICAgIC4uLm1lbnVJdGVtU3R5bGUKfQoKbmV3TWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gbWVudVN0eWxpbmc7Cgpjb25zdCBjbGlja2VkU3R5bGluZyA9IHsKICAgIC4uLm1lbnVTdHlsaW5nLAogICAgImZpbHRlciI6ICJicmlnaHRuZXNzKDYwJSkiCn0KY29uc3QgYmFzZVN0eWxlID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9ICfwn6esICR7SlNPTi5zdHJpbmdpZnkoY2xpY2tlZFN0eWxpbmcpfSdgCgpuZXdNZW51QnV0dG9uLm9uUG9pbnRlckRvd24gPSBtZW51SXRlbVN0eWxlPy5bIm1hcmdpbi10b3AiXSAhPSAiMHB4IiA/IGJhc2VTdHlsZSA6ICJAIC8vIjsKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJVcCA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsYDsKCmZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQp7CiAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOwp9CgpuZXdNZW51QnV0dG9uID0gY3JlYXRlKG5ld01lbnVCdXR0b24pOwoKcmV0dXJuIG5ld01lbnVCdXR0b247JwDz76HdCdCYAQ1hYk1lbnVSZWZyZXNoAgQA8++h3Qnw0gGdAUBpZiAoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbD8uc3Vic3RyaW5nKDAsMikgPT0gImFiIikKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKICAgIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKICAgIG1hc2tzLm9uS2V5RG93biA9IG51bGw7Cn0nAPPvod0J0JgBCHJlbWVtYmVyAgQA8++h3QmO1AEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA8++h3QnQmAENbWFuaWZlc3RhdGlvbgIEAPPvod0JtdQBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAPPvod0J0JgBEWFiRW52aXJvbm1lbnRNZW51AgQA8++h3Qnc1AHBEkBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmNvbnN0IGFiTWVudUl0ZW0gPSB7CiAgICBhYk1lbnU6IHRydWUsCiAgICBhYk1lbnVSZWZyZXNoOiAiQGRlc3Ryb3kodGhpc0JvdCk7IiwKICAgIG1hbmlmZXN0YXRpb246IHRhZ3MubWFuaWZlc3RhdGlvbiwKICAgIHJlbWVtYmVyOiB0YWdzLnJlbWVtYmVyLAogICAgcGVyc29uYWxpdHk6IHRhZ3MucGVyc29uYWxpdHksCiAgICBsZWFybjogdGFncy5sZWFybiwKfTsKCmNvbnN0IGFiRW52aXJvbm1lbnRPcHRpb25zID0gdGhpc0JvdC5hYkdldEVudmlyb25tZW50T3B0aW9ucygpOyAKCmZvciAobGV0IGkgPSAwOyBpIDwgYWJFbnZpcm9ubWVudE9wdGlvbnMubGVuZ3RoOyBpKyspIHsgCiAgICBjb25zdCBvcHRpb24gPSBhYkVudmlyb25tZW50T3B0aW9uc1tpXTsKCiAgICBhc3NlcnQodHlwZW9mIG9wdGlvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlciA9PT0gJ251bWJlcicsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfX1dIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyIG11c3QgYmUgYSBudW1iZXIuYCk7CgogICAgYWJNZW51SXRlbS5hYk1lbnVTb3J0T3JkZXIgPSBvcHRpb24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI7CgogICAgY29uc3Qgb3B0aW9uTW9kID0gey4uLmFiTWVudUl0ZW0sIC4uLm9wdGlvbn07CgogICAgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICdidXR0b24nIHx8ICFvcHRpb24ubWVudUl0ZW1UeXBlKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24ob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2Ryb3Bkb3duJykgewogICAgICAgIG9wdGlvbk1vZC5kcm9wZG93blNvcnRPcmRlciA9IG9wdGlvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjsKCiAgICAgICAgLy8gTWFrZSBzdXJlIGVhY2ggZHJvcGRvd24gb3B0aW9ucyBnZXRzIGFiTWVudUl0ZW0gZGVmYXVsdHMuCiAgICAgICAgaWYgKG9wdGlvbi5kcm9wZG93bk9wdGlvbnMgJiYgb3B0aW9uLmRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgb3B0aW9uLmRyb3Bkb3duT3B0aW9ucy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgb3B0aW9uLmRyb3Bkb3duT3B0aW9uc1trXSA9IHsgLi4uYWJNZW51SXRlbSwgLi4ub3B0aW9uLmRyb3Bkb3duT3B0aW9uc1trXSB9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICdncm91cCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUdyb3VwKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICdpbnB1dCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICd0ZXh0JykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAndG9vbCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2wob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ3dpemFyZCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChvcHRpb25Nb2QpOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWVudUl0ZW1UeXBlICR7b3B0aW9uLm1lbnVJdGVtVHlwZX0gaXMgbm90IGltcGxlbWVudGVkLmApOwogICAgICAgIGNvbnRpbnVlOwogICAgfQp9CgovLyB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiUGVyc29uYWxpdHlDb25maWdCdXR0b24pOwoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCRW52aXJvbm1lbnRNZW51JywgeyBtZW51UG9ydGFsOiBjb25maWdCb3QudGFncy5tZW51UG9ydGFsfSApJwDz76HdCdCYAQVsZWFybgIEAPPvod0JnucBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAPPvod0J0JgBA2dwdAIEAPPvod0JxecBKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAPPvod0J0JgBCGFiSWdub3JlAgQA8++h3Qns5wEEdHJ1ZScA8++h3QnQmAEGc2VhcmNoAgQA8++h3Qnx5wEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScA8++h3QnQmAEGbnVnZ2V0AgQA8++h3QmY6AEo8J+UlzRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZicA8++h3QnQmAEFdGVzdHMCBADz76HdCb/oASjwn5SXYjgzZDk3MmItMDUzNS00MDUxLWI1ODktNDFjZWRhODUzNWYxJwDz76HdCdCYAQNhc2sCBADz76HdCeboASjwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwDz76HdCdCYAQlhYlZlcnNpb24CBADz76HdCY3pAQUxMC4zNScA8++h3QnQmAERYWJDcmVhdGVNZW51SW5wdXQCBADz76HdCZPpAZ4CQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVJbnB1dCA9IHsNCiAgICBmb3JtOiAiaW5wdXQiLA0KICAgIG1lbnVJdGVtU2hvd1N1Ym1pdFdoZW5FbXB0eTogZmFsc2UsDQogICAgZm9ybUlucHV0TXVsdGlsaW5lOiBudWxsLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVJbnB1dCk7DQoNCnJldHVybiBtZW51Qm90OycA8++h3QnQmAEQYWJDcmVhdGVNZW51VGV4dAIEAPPvod0JsusBgQRAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpjb25zdCB7DQogICAgbWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIC4uLnJlc3QNCn0gPSB0aGF0Ow0KDQpsZXQgbWVudVRleHQgPSB7DQogICAgZm9ybTogInRleHQiLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgcG9pbnRhYmxlOiBmYWxzZSwNCiAgICBjb2xvcjogIndoaXRlIiwNCiAgICBtZW51SXRlbVN0eWxlOiB7DQogICAgICAgICJwYWRkaW5nLXRvcCI6ICI2cHgiLA0KICAgICAgICAicGFkZGluZy1ib3R0b20iOiAiNnB4IiwNCiAgICB9LA0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZTogew0KICAgICAgICAid2hpdGUtc3BhY2UiOiAicHJlLXdyYXAiLA0KICAgICAgICAuLi5tZW51SXRlbUxhYmVsU3R5bGUsDQogICAgfSwNCiAgICAuLi5yZXN0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRleHQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAPPvod0J0JgBEGFiQ3JlYXRlTWVudVRvb2wCBADz76HdCbTvAY4BQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVUb29sID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51VG9vbCk7DQoNCnJldHVybiBtZW51Qm90OycA8++h3QnQmAESYWJDcmVhdGVNZW51V2l6YXJkAgQA8++h3QnD8AGSAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51V2l6YXJkID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51V2l6YXJkKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwDz76HdCdCYARRhYkNyZWF0ZU1lbnVEcm9wZG93bgIEAPPvod0J1vEB5R1AaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAodGhhdC5kcm9wZG93blNvcnRPcmRlciA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVEcm9wZG93bjogZHJvcGRvd25Tb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgb3V0ZXJNZW51QnV0dG9uID0gew0KICAgIC4uLnRoYXQsDQogICAgZm9ybUFkZHJlc3M6IHRoYXQuZm9ybUFkZHJlc3MgPz8gImFycm93X3JpZ2h0IiwNCiAgICBkcm9wZG93bk9wZW46IGZhbHNlLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIHRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9ICR7dGhhdC5kcm9wZG93blNvcnRPcmRlcn0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IHRydWUpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnModGFncy5kcm9wZG93bk9wdGlvbnMsIHRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIpOw0KICAgICAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25EZXN0cm95OiBgQA0KICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgIGAsDQogICAgb25Qb2ludGVyVXA6IGBADQogICAgICAgIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsOw0KICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gImFycm93X3JpZ2h0IjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gZmFsc2UpIHsNCiAgICAgICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImZvcm1BZGRyZXNzIiwgImFycm93X2Ryb3BfZG93biIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAibWVudUl0ZW1TdHlsZSIsIHsuLi50YWdzLm1lbnVJdGVtU3R5bGUsICJib3JkZXJCb3R0b21MZWZ0UmFkaXVzIjogIjAiLCAiYm9yZGVyQm90dG9tUmlnaHRSYWRpdXMiOiAiMCJ9KTsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25Cb3RDaGFuZ2VkOiBgQA0KICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCdkcm9wZG93bk9wZW4nKSAmJiB0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51RHJvcGRvd25PcGVuZWQiLCB0aGlzQm90KTsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgYWJNZW51RHJvcGRvd25PcGVuZWQ6IGBADQogICAgICAgIGlmICh0aGF0ICE9IHRoaXNCb3QpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobGlua3MgJiYgbGlua3MuYmFzZVNraWxsKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhhYi5saW5rcy5yZW1lbWJlciwgImxhc3RPcGVuZWREcm9wZG93biIsIHRhZ3MuYmFzZVNraWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGANCn07DQoNCmlmICh0aGF0LmZvcm1BZGRyZXNzICYmIHRoYXQuZm9ybUFkZHJlc3MgIT0gImFycm93X3JpZ2h0Iikgew0KICAgIG91dGVyTWVudUJ1dHRvbi5jdXN0b21Gb3JtQWRkcmVzcyA9IHRydWU7DQp9DQpvdXRlck1lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IHRoYXQuZHJvcGRvd25Tb3J0T3JkZXI7DQoNCmNvbnN0IG1lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihvdXRlck1lbnVCdXR0b24pOw0KbWVudUJvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMgPSBnZW5lcmF0ZU1lbnVPcHRpb25zOw0KDQphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZU1lbnVPcHRpb25zIChvcHRpb25zLCBzb3J0T3JkZXIpIHsNCiAgICBjb25zdCBtZW51Qm90cyA9IFtdOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7ICsraSkgew0KDQogICAgICAgIGxldCBuZXdNZW51QnV0dG9uID0gew0KICAgICAgICAgICAgLi4ub3B0aW9uc1tpXSwNCiAgICAgICAgICAgIGNsZWFyRHJvcGRvd25NZW51OiBgQA0KICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMDApOw0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoaSA9PSBvcHRpb25zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAgMCA4cHggOHB4IjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIDAgOHB4IDhweCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJUb3AiXSA9ICJub25lIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJtYXJnaW5Ub3AiXSA9ICIwIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJwYWRkaW5nTGVmdCJdID0gIjM1cHgiOw0KDQogICAgICAgIGNvbnN0IG5ld01lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCiAgICB9DQoNCiAgICBtZW51Qm90LnRhZ3MubWVudUJvdHMgPSBnZXRMaW5rKG1lbnVCb3RzKTsNCn0NCg0KaWYgKHRoYXQuZGVmYXVsdE9wZW4pIHsNCiAgICBtZW51Qm90Lm9uUG9pbnRlclVwKCk7DQogICAgbWVudUJvdC5vbkNsaWNrKCk7DQp9DQoNCnJldHVybiBtZW51Qm90Ow0KDQonAPPvod0J0JgBEWFiQ3JlYXRlTWVudUdyb3VwAgQA8++h3Qm8jwK9H0AvKg0KICAgRVhBTVBMRQ0KICAgY29uc3QgbWVudUdyb3VwID0gew0KICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBncm91cFNvcnRPcmRlcjogMSwNCiAgICAgICAgbWVudUl0ZW1zOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICBjb2xvcjogIm9yYW5nZSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgbWVudUl0ZW1UeXBlOiAiZHJvcGRvd24iLA0KICAgICAgICAgICAgICAgIGRyb3Bkb3duT3B0aW9uczogWw0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfQ0KKi8NCg0KaWYgICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0Lmdyb3VwU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVHcm91cDogZ3JvdXBTb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgew0KICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwNCiAgICBtZW51SXRlbXMgPSBbXSwNCiAgICAuLi5hZGRpdGlvbmFsVGFncw0KfSA9IHRoYXQgPz8ge30NCg0KY29uc3QgbWVudUJvdHMgPSBbXTsNCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudUl0ZW1zLmxlbmd0aDsgKytpKSB7DQoNCiAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9Ow0KDQogICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDApOw0KDQogICAgbGV0IGluZGl2TWVudUl0ZW1TdHlsZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVN0eWxlID8/IHt9Ow0KICAgIGxldCBpbmRpdk1lbnVUeXBlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtVHlwZSA/PyB1bmRlZmluZWQ7DQogICAgbGV0IGluZGl2QWRkaXRpb25hbFRhZ3MgPSBtZW51SXRlbXNbaV07DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdOw0KICAgIH0NCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdOw0KICAgIH0NCg0KICAgIGNvbnN0IGJhc2VTdHlsaW5nID0gew0KICAgICAgICAiYm9yZGVyVG9wIjogIm5vbmUiLA0KICAgICAgICAibWFyZ2luVG9wIjogIjAiDQogICAgfQ0KDQogICAgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEgJiYgaSA9PSAwKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfQ0KICAgIGVsc2UgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCAwIDhweCA4cHgiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfSBlbHNlIGlmIChpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjhweCA4cHggMCAwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nO30NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gaW5kaXZBZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGluZGl2QWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBsZXQgbmV3TWVudUJvdDsNCiAgICBzd2l0Y2goaW5kaXZNZW51VHlwZSkgew0KICAgICAgICBjYXNlICJkcm9wZG93biI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bigNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC4uLm5ld01lbnVCdXR0b24sDQogICAgICAgICAgICAgICAgICAgICJkcm9wZG93blNvcnRPcmRlciI6IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTApDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiaW5wdXQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidGV4dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRvb2wiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ3aXphcmQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICB9DQogICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCn0NCg0KcmV0dXJuIG1lbnVCb3RzOycA8++h3QnQmAELcGVyc29uYWxpdHkCBADz76HdCfquAijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwDz76HdCdCYARdhYkdldEVudmlyb25tZW50T3B0aW9ucwIEAPPvod0Joa8CxndAY29uc3Qgb3B0aW9ucyA9IFtdOwoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogYGhpZGVgLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAidmlzaWJpbGl0eV9vZmYiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICB9KSwKICAgIH0pCn0KCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJzbGVlcCIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMCwKICAgICAgICBmb3JtQWRkcmVzczogIm5pZ2h0c19zdGF5IiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJTZXRBd2FrZSh7IGF3YWtlOiBmYWxzZSB9KQogICAgICAgIH0pLAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAib3B0aW1pemUgbW9kZSIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMjAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICB9KSwKICAgIHJlZnJlc2hEaXNwbGF5OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSBmYWxzZSA6IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gdHJ1ZTsKICAgICAgICB0aGlzQm90Lm9uQ3JlYXRlKCk7CiAgICB9KSwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImN1c3RvbWl6ZTogYWIgcGVyc29uYWxpdHkiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDMwMCwKICAgIG1lbnVJdGVtVHlwZTogJ2Ryb3Bkb3duJywKICAgIGRyb3Bkb3duT3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBuYW1lOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LCB7IHRpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB0byBjYWxsIG1lPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7IG5hbWU6IG5hbWUgfSk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBhaSBtb2RlbDogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbH1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVscyA9IGNvbmZpZ0JvdC50YWdzLmFpQ2hhdE1vZGVsczsKCiAgICAgICAgICAgICAgICBpZiAobW9kZWxzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IFtdOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIG1vZGVscykgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goeyBsYWJlbDogZW50cnkubmFtZSwgdmFsdWU6IGVudHJ5Lm5hbWUgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TW9kZWxJbmRleCA9IG9wdGlvbnMuZmluZEluZGV4KG8gPT4gby52YWx1ZSA9PT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IGF3YWl0IG9zLnNob3dJbnB1dChjdXJyZW50TW9kZWxJbmRleCwgewogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3doYXQgYWkgbW9kZWwgd291bGQgeW91IGxpa2UgbWUgdG8gdXNlPycsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaXN0JywKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IG9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE9wdGlvbiAmJiBzZWxlY3RlZE9wdGlvbi52YWx1ZSAhPT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBhaU1vZGVsOiBzZWxlY3RlZE9wdGlvbi52YWx1ZSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChhdXRoQm90KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnNob3dBbGVydCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3NvbWV0aGluZyB3ZW50IHdyb25nJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdmYWlsZWQgdG8gZ2V0IGxpc3Qgb2YgYWkgY2hhdCBtb2RlbHMuJwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnNob3dBbGVydCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3NpZ24gaW4gcmVxdWlyZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJ3lvdSBtdXN0IHNpZ24gaW4gdG8gdXNlIGFpLicKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBtZSB0byBiZT8nIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBjb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHsgdHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnVzIHRvIGJlPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7IG1lbnVDb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IHRleHQgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51IHRleHQgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgbWVudUxhYmVsQ29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBwb3J0YWwgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgbGV0IHBvcnRhbENvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4JywgeyB0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgeW91ciBwb3J0YWwgdG8gbG9vayBsaWtlPycgfSk7CiAgICAgICAgICAgICAgICBpZiAoIXBvcnRhbENvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgcG9ydGFsQ29sb3IgPSAnIzI2MzIzOCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7ICdwb3J0YWxDb2xvcic6IHBvcnRhbENvbG9yIH0pOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBkZWZhdWx0IG1hcCBwb3J0YWwgYmFzZW1hcGAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvdXQoInNob3dBQkJhc2VtYXBPcHRpb25zIik7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogImRlZmF1bHQgc2V0dGluZ3MiLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgICAgICAgICAgY29sb3I6ICdyZWQnLAogICAgICAgICAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7ICdkZWZhdWx0UGVyc29uYWxpdHknOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgIF0KfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoYXQiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDQwMCwKICAgIGZvcm1BZGRyZXNzOiAiY2hhdCIsCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgc2hvdXQoJ2FiQ2hhdEJhck9wZW4nKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIH0pLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAibnVnZ2V0cyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNTAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzLm51Z01hbmFnZXIgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmludGVyZmFjZS5udWdnZXQnKSk7IAogICAgICAgIAogICAgICAgIGlmIChsaW5rcy5udWdNYW5hZ2VyLnRhZ3MubGlzdGVuaW5nKSB7IAogICAgICAgICAgICB0YWdzLm9uQ2xpY2sgPSBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyAKICAgICAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgbnVsbCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveGA7IAogICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICB0YWdzLm9uQ2xpY2sgPSBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyAKICAgICAgICAgICAgICAgIGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCB0cnVlLCAnbG9jYWwnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94X291dGxpbmVfYmxhbmtgOwogICAgICAgIH0KICAgIH0pLAp9KQoKaWYgKGxpbmtzLnByZXNlbmNlKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAiY2FtZXJhIHByZXNlbmNlIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNTEwLAogICAgICAgIHByZXNlbmNlOiB0YWdzLnByZXNlbmNlLAogICAgICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCA9ICh0aGF0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCdjYW1lcmFFbmFibGVkJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIG9zLmFkZEJvdExpc3RlbmVyKGxpbmtzLnByZXNlbmNlLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkKTsKCiAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB9KSwKICAgICAgICByZWZyZXNoRGlzcGxheTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBsaW5rcy5wcmVzZW5jZS50YWdzLmNhbWVyYUVuYWJsZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MucHJlc2VuY2UsICdjYW1lcmFFbmFibGVkJywgISEhbGlua3MucHJlc2VuY2UudGFncy5jYW1lcmFFbmFibGVkLCAnbG9jYWwnKTsKICAgICAgICB9KSwKICAgICAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgb3MucmVtb3ZlQm90TGlzdGVuZXIobGlua3MucHJlc2VuY2UsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQpOwogICAgICAgIH0pCiAgICB9KQoKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJjdXJzb3IgcHJlc2VuY2UiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1MjAsCiAgICAgICAgcHJlc2VuY2U6IHRhZ3MucHJlc2VuY2UsCiAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkID0gKHRoYXQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ2N1cnNvckVuYWJsZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgb3MuYWRkQm90TGlzdGVuZXIobGlua3MucHJlc2VuY2UsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQpOwoKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0pLAogICAgICAgIHJlZnJlc2hEaXNwbGF5OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLnByZXNlbmNlLnRhZ3MuY3Vyc29yRW5hYmxlZCA/IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JyA6IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIH0pLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5wcmVzZW5jZSwgJ2N1cnNvckVuYWJsZWQnLCAhISFsaW5rcy5wcmVzZW5jZS50YWdzLmN1cnNvckVuYWJsZWQsICdsb2NhbCcpOwogICAgICAgIH0pLAogICAgICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBvcy5yZW1vdmVCb3RMaXN0ZW5lcihsaW5rcy5wcmVzZW5jZSwgJ29uQm90Q2hhbmdlZCcsIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCk7CiAgICAgICAgfSkKICAgIH0pCn0KCmlmIChsaW5rcy5ncHQpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA2MDAsCiAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgaWYgKCFhdXRoQm90KSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICdGcmVlUGxheScgfHwgYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0YWdzLmxhYmVsID0gJ2VkaXQgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIHByb21wdCc7IHRhZ3MuZ3B0Qm90ID0gZ2V0TGluayhnZXRCb3QoJ3N5c3RlbScsICdhYi5hY3Rpb24uYXNrJykpOwogICAgICAgIH0pLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsKICAgICAgICB9KSwKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImdyaWQgc25hcCIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNzAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuaycKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlOyB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICB9KSwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImJvdCBzbmFwIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA4MDAsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlOyB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAp9KQoKaWYgKGF1dGhCb3QpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJhY2NvdW50IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogOTAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAiYmFkZ2UiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgb3Muc2hvd0FjY291bnRJbmZvKCk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfSksCiAgICB9KQp9CgppZiAobGlua3MudGVzdHMpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdGVzdCIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJzY2llbmNlIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHNob3V0KCdhYlJlY29yZFRlc3QnKTsKICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9KSwKICAgIH0pCgogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInJlY29yZCB0cmFjZSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDExMDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJ0aW1lbGluZSIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBzaG91dCgnYWJSZWNvcmRUcmFjZScpOwogICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIH0pLAogICAgfSkKfQoKaWYgKGdldEJvdCgic3lzdGVtIiwgImFiLmhvbWUuZWdnIikpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJzYXZlIGhvbWUgZWdnIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTIwMCwKICAgICAgICBmb3JtQWRkcmVzczogImVnZyIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBnZXRCb3QoInN5c3RlbSIsICJhYi5ob21lLmVnZyIpLnNhdmVEYXRhKCk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfSksCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJjaGVjayBmb3IgIiArIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIHVwZGF0ZXMiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEzMDAsCiAgICBmb3JtQWRkcmVzczogImN1YmUiLAogICAgbGVhcm46IHRhZ3MubGVhcm4sCiAgICBjaGVja0ZvclVwZGF0ZXM6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAvLyBUZW1wb3JhcmlseSByZXBsYWNlIHdpdGggYnVzeSBpbmRpY2F0b3Igd2hpbGUgY2hlY2tpbmcgZm9yIHVwZGF0ZXMuCiAgICAgICAgdGFncy5hYk1lbnUgPSBmYWxzZTsKCiAgICAgICAgdGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IgPSBhYi5saW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3IoewogICAgICAgICAgICBhYk1lbnU6IHRydWUsCiAgICAgICAgICAgIGxhYmVsOiAnY2hlY2tpbmcgZm9yIHVwZGF0ZXMgdG8gJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgYWJNZW51U29ydE9yZGVyOiB0YWdzLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyLAogICAgICAgIH0pOwoKICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjayA9IGF3YWl0IGFiLmFiQ2hlY2tBQlVwZGF0ZUF2YWlsYWJsZSh7IGRldGFpbGVkOiB0cnVlIH0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpOwogICAgICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IG51bGw7CgogICAgICAgICAgICAvLyBCcmluZyBiYWNrIHRoZSB1cGRhdGUgYnV0dG9uLgogICAgICAgICAgICB0YWdzLmFiTWVudSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sgJiYgdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2suc3VjY2VzcykgewogICAgICAgICAgICBpZiAoZ2xvYmFsVGhpcy5hYlVwZGF0ZUNoZWNrZXIpIHsKICAgICAgICAgICAgICAgIGFiVXBkYXRlQ2hlY2tlci50YWdzLnVwZGF0ZUF2YWlsYWJsZSA9IHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLnVwZGF0ZUF2YWlsYWJsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLnVwZGF0ZUF2YWlsYWJsZSkgewogICAgICAgICAgICAgICAgY29uc3QgYWJGaWxlc1dpdGhVcGRhdGVzID0gdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2suYWJGaWxlQ2hlY2tzLmZpbHRlcihmID0+IGYudXBkYXRlQXZhaWxhYmxlKTsKCiAgICAgICAgICAgICAgICBjb25zdCBjb25maXJtZWQgPSBhd2FpdCBvcy5zaG93Q29uZmlybSh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdVcGRhdGVzIGZvdW5kIGZvciAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdUaGVyZSBhcmUgJyArIGFiRmlsZXNXaXRoVXBkYXRlcy5sZW5ndGggKyAnIGZpbGUgdXBkYXRlcyBmb3IgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcuIFdvdWxkIHlvdSBsaWtlIHRvIGluc3RhbGwgdGhlIHVwZGF0ZXMgbm93PyBZb3UgYW5kIGFueSBjb25uZWN0ZWQgdXNlcnMgd2lsbCBhdXRvbWF0aWNhbGx5IHJlZnJlc2ggdGhlIHBhZ2UgYWZ0ZXIgdGhlIHVwZGF0ZSBpcyBjb21wbGV0ZS4nLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6ICdOb3Qgbm93JywKICAgICAgICAgICAgICAgICAgICBjb25maXJtVGV4dDogJ1llcycKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCkgewogICAgICAgICAgICAgICAgICAgIGxpbmtzLmxlYXJuLnVwZGF0ZUFCKCk7CiAgICAgICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFiLmxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBpcyBhbHJlYWR5IHVwLXRvLWRhdGUhJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYXNrcy5sYWJlbCA9ICd1cGRhdGUgY2hlY2sgZmFpbGVkJzsKICAgICAgICB9CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LmNoZWNrRm9yVXBkYXRlcygpOwogICAgfSksCiAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpIHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgfQogICAgfSksCn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJwZXJtYW5lbnRseSBkZWxldGUiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDk5OTksCiAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRhZ3MubGFiZWwgKz0gIiAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKICAgICAgICB0YWdzLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb250cmFzdENvbG9yID8/ICIjRDkzMDMwIjsKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IG9zLnNob3dDb25maXJtKHsKICAgICAgICAgICAgdGl0bGU6ICdQZXJtYW5lbnRseSBkZWxldGUgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgIGNvbnRlbnQ6ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBmcm9tICcgKyBsaW5rcy5sZWFybi50YWdzLmFiSW5zdCArICc/IFRoaXMgaXMgbm90IHJldmVyc2libGUhJywKICAgICAgICB9KQoKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwoKICAgICAgICBjb25zdCBhYkJvdHMgPSBnZXRCb3RzKChiKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBiLnNwYWNlID09PSAnc2hhcmVkJyAmJgogICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbSAmJgogICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbS5zdGFydHNXaXRoKCdhYicpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgIGRlc3Ryb3koYWJCb3RzKTsKICAgICAgICB9CiAgICB9KSwKfSkKCnJldHVybiBvcHRpb25zOycA8++h3QnQmAEeYWJDcmVhdGVUb29sYm94RHJvcGRvd25PcHRpb25zAgQA8++h3QnopgPjE0Bjb25zdCB0b29sYm94VG9vbHMgPSBbLi4udGhhdC50b29sQXJyYXldID8/IFtdOw0KY29uc3QgdG9vbGJveE5hbWUgPSB0aGF0LnRvb2xib3hOYW1lID8/ICJLaXQgIjsNCmNvbnN0IHRvb2xib3ggPSB0aGF0LnRvb2xib3g7DQpjb25zdCBncmlkSW5mb3JtYXRpb24gPSAodGhhdD8uZ3JpZEluZm9ybWF0aW9uICYmIHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiAhPSB1bmRlZmluZWQpID8gdGhhdD8uZ3JpZEluZm9ybWF0aW9uIDogYWJSZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOw0KDQpjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnRvb2xib3ggPSBnZXRMaW5rKHRvb2xib3gpOw0KbWVudU9wdGlvbnMuZ3JpZEluZm9ybWF0aW9uID0gZ3JpZEluZm9ybWF0aW9uOw0KbWVudU9wdGlvbnMuc2VhcmNoID0gdGFncy5zZWFyY2g7DQptZW51T3B0aW9ucy5hcnRpZmFjdCA9IHRhZ3MuYXJ0aWZhY3Q7DQovL21lbnVPcHRpb25zLmZvcm1BZGRyZXNzID0gImhhcmR3YXJlIjsNCg0KaWYgKHRvb2xib3hUb29scy5sZW5ndGggPT09IDApIHsNCiAgICBjb25zdCBtZXNzYWdlID0gdG9vbGJveE5hbWUgKyAiIGRvZXMgbm90IGhhdmUgYW55IHRvb2xzIGxpc3RlZCBpbiB0aGUgdG9vbF9hcnJheSB0YWciOw0KDQogICAgYWIubG9nKGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBtZXNzYWdlKTsNCiAgICBvcy50b2FzdChtZXNzYWdlLCA1KTsNCiAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpOw0KfQ0KDQpmb3IgKGxldCB0b29sIG9mIHRvb2xib3hUb29scykgew0KICAgIGNvbnN0IHRvb2xCdXR0b24gPSB7DQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBsYWJlbDogdG9vbC5uYW1lLA0KICAgICAgICB0YXJnZXRBQjogdG9vbC50YXJnZXRBQiwNCiAgICAgICAgaXNBcnRpZmFjdDogdG9vbC5hcnRpZmFjdCB8fCBmYWxzZSwNCiAgICAgICAgb25DbGljazpgQA0KICAgICAgICAgICAgaWYgKHRhZ3MuaXNBcnRpZmFjdCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGFiQXJ0aWZhY3RTaGFyZCA9IHsNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICAgICAgICAgICAgZWdnUGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llczogWw0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGxpbmtzLmFydGlmYWN0LmFiQ3JlYXRlQXJ0aWZhY3RQcm9taXNlQm90KHsNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdE5hbWU6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3RTaGFyZCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCLA0KICAgICAgICAgICAgICAgICAgICBzb3VyY2VFdmVudDogJ3Rvb2wnLA0KICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiB0YWdzLnRvb2xib3gsDQogICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9uDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgYCwNCiAgICB9Ow0KDQogICAgaWYgKHRvb2wuZm9ybUFkZHJlc3MpIHsNCiAgICAgICAgdG9vbEJ1dHRvbi5mb3JtQWRkcmVzcyA9IHRvb2wuZm9ybUFkZHJlc3M7DQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2godG9vbEJ1dHRvbik7DQp9DQoNCnJldHVybiBkcm9wZG93bk9wdGlvbnM7JwDz76HdCdCYARBvbkFCQXV0aEJvdEFkZGVkAgQA8++h3QnMugMYQHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7JwDz76HdCdCYAQhhcnRpZmFjdAIEAPPvod0J5boDKPCflJc3OGU0MTUwMy1jOTMzLTRmOGEtODE3YS1iYTk3YmY4ZDVkMjcnAQRib3RzJGM3OGFhNjYzLWQwNWMtNGVjNC1iYzJjLTI2ZmQ1MTU2MGI5NwEnAPPvod0JjLsDFWFiQ3JlYXRlQ3ViZUZhY2VQbGFuZQIEAPPvod0JjbsDiTFAbGV0IHsgCiAgICBib3QsCiAgICBkaW1lbnNpb24sCiAgICBzcGFjZSA9ICd0ZW1wTG9jYWwnLAogICAgZGVidWcsCiAgICBmYWNlT2Zmc2V0ID0gMC4wMSwKICAgIHBvaW50YWJsZSA9IGZhbHNlLAogICAgdGlja0ludGVydmFsTVMgPSA1MDAsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9OwoKYXNzZXJ0KGxpbmtzLnV0aWxzLmlzQm90KGJvdCksIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm90IGlzIGEgcmVxdWlyZWQgQm90IHBhcmFtZXRlci5gKTsKYXNzZXJ0KGRpbWVuc2lvbiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkaW1lbnNpb24gaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CmFzc2VydChyZXN0LmZvcm0gPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBmb3JtIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5hbmNob3JQb2ludCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFuY2hvclBvaW50IGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkJvdEFkZGVkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7Cgpjb25zdCBmYWNlUGxhbmVNb2QgPSB7CiAgICBzcGFjZSwKICAgIGFuY2hvclBvaW50OiAnY2VudGVyJywKICAgIGRlYnVnLAogICAgZmFjZU9mZnNldCwKICAgIGZvcm06ICdzcHJpdGUnLAogICAgZGltZW5zaW9uLAogICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICBwb2ludGFibGUsCiAgICB0aWNrSW50ZXJ2YWxNUywKICAgIHRyYW5zZm9ybWVyOiBib3QuaWQsCiAgICBvbkJvdEFkZGVkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGhpc0JvdC5zdGFydFRpY2soKTsKICAgIH0pLAogICAgb25Cb3RDaGFuZ2VkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygndGlja0ludGVydmFsTVMnKSkgewogICAgICAgICAgICB0aGlzQm90LnN0b3BUaWNrKCk7CiAgICAgICAgICAgIHRoaXNCb3Quc3RhcnRUaWNrKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCd0cmFuc2Zvcm1lcicpKSB7CiAgICAgICAgICAgIGlmICghdGFncy50cmFuc2Zvcm1lcikgewogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25BbnlCb3RzUmVtb3ZlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0YWdzLnRyYW5zZm9ybWVyKSB7CiAgICAgICAgICAgIGlmICh0aGF0LmJvdElEcy5pbmNsdWRlcyh0YWdzLnRyYW5zZm9ybWVyKSkgewogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGhpc0JvdC5zdG9wVGljaygpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGRlc3Ryb3llZGApOwogICAgICAgIH0KICAgIH0pLAogICAgc2V0RGltZW5zaW9uOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uc3QgZGltZW5zaW9uID0gdGhhdDsKCiAgICAgICAgaWYgKHRhZ3MuZGltZW5zaW9uICE9PSBkaW1lbnNpb24pIHsKICAgICAgICAgICAgLy8gUmVtb3ZlIGZyb20gcHJldmlvdXMgZGltZW5zaW9uLgogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnUG9zaXRpb24nXSA9IG51bGw7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnUm90YXRpb24nXSA9IG51bGw7CgogICAgICAgICAgICBpZiAoZGltZW5zaW9uKSB7CiAgICAgICAgICAgICAgICAvLyBBc3NpZ24gdG8gbmV3IGRpbWVuc2lvbi4KICAgICAgICAgICAgICAgIHRhZ3MuZGltZW5zaW9uID0gZGltZW5zaW9uOwogICAgICAgICAgICAgICAgdGFnc1tkaW1lbnNpb25dID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9KSwKICAgIHN0YXJ0VGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmIChtYXNrcy50aWNrSW50ZXJ2YWxJZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtYXNrcy50aWNrSW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHdoaXNwZXIodGhpc0JvdCwgJ3RpY2snKSwgdGFncy50aWNrSW50ZXJ2YWxNUyk7CiAgICAgICAgdGhpc0JvdC50aWNrKCk7CiAgICB9KSwKICAgIHN0b3BUaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKG1hc2tzLnRpY2tJbnRlcnZhbElkKSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobWFza3MudGlja0ludGVydmFsSWQpOwogICAgICAgICAgICBtYXNrcy50aWNrSW50ZXJ2YWxJZCA9IG51bGw7CiAgICAgICAgfQogICAgfSksCiAgICB0aWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uc3QgTE9DQUxfTk9STUFMUyA9IFsKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMSwgMCwgMCksIC8vICtYCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKC0xLCAwLCAwKSwgLy8gLVgKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgMSwgMCksIC8vICtZCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAsIC0xLCAwKSwgLy8gLVkKICAgICAgICBdCgogICAgICAgIGNvbnN0IExPQ0FMX1BPU0lUSU9OUyA9IFsKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMC41ICsgdGFncy5mYWNlT2Zmc2V0LCAwLCAtMC41KSwgLy8gK1gKICAgICAgICAgICAgbmV3IFZlY3RvcjMoLTAuNSAtIHRhZ3MuZmFjZU9mZnNldCwgMCwgLTAuNSksIC8vIC1YCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAsIDAuNSArIHRhZ3MuZmFjZU9mZnNldCwgLTAuNSksIC8vICtZCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAsIC0wLjUgLSB0YWdzLmZhY2VPZmZzZXQsIC0wLjUpLCAvLyAtWQogICAgICAgIF0KCiAgICAgICAgY29uc3QgSEFMRl9QSSA9IE1hdGguUEkgLyAyOwoKICAgICAgICBjb25zdCBMT0NBTF9ST1RBVElPTlMgPSBbCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IEhBTEZfUEksIHk6IEhBTEZfUEksIHo6IDAgfX0pLCAvLyArWAogICAgICAgICAgICBuZXcgUm90YXRpb24oeyBldWxlcjogeyB4OiBIQUxGX1BJLCB5OiAtSEFMRl9QSSwgejogMCB9fSksIC8vIC1YCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IC1IQUxGX1BJLCB5OiAwLCB6OiBNYXRoLlBJIH19KSwgLy8gK1kKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogSEFMRl9QSSwgeTogMCwgejogMCB9fSksIC8vIC1ZCiAgICAgICAgXQoKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhlIGZhY2UgcGxhbmUgdG8gYmUgb24gdGhlIGdpdmVuIGZhY2UgaW5kZXguICAKICAgICAgICAgKiAwOiArWCwgIAogICAgICAgICAqIDE6IC1YLCAgCiAgICAgICAgICogMjogK1ksICAKICAgICAgICAgKiAzOiAtWQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIHNldFBsYW5lRmFjZShmYWNlSW5kZXgpIHsKICAgICAgICAgICAgbWFza3NbdGFncy5kaW1lbnNpb24gKyAnUG9zaXRpb24nXSA9IExPQ0FMX1BPU0lUSU9OU1tmYWNlSW5kZXhdOwogICAgICAgICAgICBtYXNrc1t0YWdzLmRpbWVuc2lvbiArICdSb3RhdGlvbiddID0gTE9DQUxfUk9UQVRJT05TW2ZhY2VJbmRleF07CiAgICAgICAgfQoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGRpbWVuc2lvbjpgLCB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBhcmVudFBvc2l0aW9uID0gZ2V0Qm90UG9zaXRpb24odGFncy50cmFuc2Zvcm1lciwgdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIHBhcmVudCBwb3NpdGlvbjpgLCBwYXJlbnRQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICBsZXQgZ3JpZFBvcnRhbFR5cGU6ICdncmlkJyB8ICdtaW5pR3JpZCcgfCBudWxsID0gbnVsbDsKCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIGdyaWRQb3J0YWxUeXBlID0gJ2dyaWQnOwogICAgICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIGdyaWRQb3J0YWxUeXBlID0gJ21pbmlHcmlkJzsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGV0ZWN0ZWQgZ3JpZCBwb3J0YWwgdHlwZTpgLCBncmlkUG9ydGFsVHlwZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWdyaWRQb3J0YWxUeXBlKSB7CiAgICAgICAgICAgIHNldFBsYW5lRmFjZSgwKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgY2FtZXJhUG9zaXRpb24gPSBvcy5nZXRDYW1lcmFQb3NpdGlvbihncmlkUG9ydGFsVHlwZSk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gY2FtZXJhIHBvc2l0aW9uOmAsIGNhbWVyYVBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGRpcmVjdGlvblRvQ2FtZXJhID0gY2FtZXJhUG9zaXRpb24uc3VidHJhY3QocGFyZW50UG9zaXRpb24pLm5vcm1hbGl6ZSgpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGRpcmVjdGlvbiB0byBjYW1lcmE6YCwgZGlyZWN0aW9uVG9DYW1lcmEpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcGFyZW50Um90YXRpb24gPSBnZXRCb3RSb3RhdGlvbih0YWdzLnRyYW5zZm9ybWVyLCB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgY29uc3Qgd29ybGROb3JtYWxzOiBWZWN0b3IzW10gPSBuZXcgQXJyYXkoNCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICAgICAgd29ybGROb3JtYWxzW2ldID0gcGFyZW50Um90YXRpb24ucm90YXRlVmVjdG9yMyhMT0NBTF9OT1JNQUxTW2ldKTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gd29ybGQgbm9ybWFsczpgLCB3b3JsZE5vcm1hbHMpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBGaW5kIHRoZSBmYWNlIG1vc3QgZmFjaW5nIHRoZSBjYW1lcmEgKG1heCBkb3QgcHJvZHVjdCkuIAogICAgICAgIGxldCBiZXN0SW5kZXggPSAwOyAKICAgICAgICBsZXQgYmVzdERvdCA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWTsgCiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZE5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWxzW2ldLmRvdChkaXJlY3Rpb25Ub0NhbWVyYSk7CiAgICAgICAgICAgIGlmIChkb3QgPiBiZXN0RG90KSB7CiAgICAgICAgICAgICAgICBiZXN0RG90ID0gZG90OyAKICAgICAgICAgICAgICAgIGJlc3RJbmRleCA9IGk7IAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGJlc3QgZmFjZSBpbmRleDpgLCBiZXN0SW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgc2V0UGxhbmVGYWNlKGJlc3RJbmRleCk7CiAgICB9KSwKICAgIC4uLnJlc3QKfQoKY29uc3QgZmFjZVBsYW5lQm90ID0gY3JlYXRlKGZhY2VQbGFuZU1vZCk7CgpyZXR1cm4gZmFjZVBsYW5lQm90OycA8++h3QmMuwMIYWJJZ25vcmUCBADz76HdCZfsAwR0cnVlJwDz76HdCYy7AwthYkludGVyZmFjZQIEAPPvod0JnOwDBHRydWUnAPPvod0JjLsDBnN5c3RlbQIEAPPvod0JoewDGGFiLmludGVyZmFjZS5ib3RfZmFjdG9yeScA8++h3QmMuwMWYWJDcmVhdGVCaWxsYm9hcmRMYWJlbAIEAPPvod0JuuwDjUVAbGV0IHsgCiAgICBib3QsCiAgICBkaW1lbnNpb24sCiAgICBwcmVzZXJ2ZU5ld0xpbmVzID0gdHJ1ZSwKICAgIGxhYmVsID0gJycsCiAgICBzcGFjZSA9ICd0ZW1wTG9jYWwnLAogICAgY29sb3IgPSAnd2hpdGUnLAogICAgbGFiZWxDb2xvciA9ICdibGFjaycsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9OwoKaWYgKHR5cGVvZiBsYWJlbCAhPT0gJ3N0cmluZycpIHsKICAgIGxhYmVsID0gU3RyaW5nKGxhYmVsKTsKfQoKYXNzZXJ0KGxpbmtzLnV0aWxzLmlzQm90KGJvdCksIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm90IGlzIGEgcmVxdWlyZWQgQm90IHBhcmFtZXRlci5gKTsKYXNzZXJ0KGRpbWVuc2lvbiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkaW1lbnNpb24gaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CmFzc2VydChyZXN0Lm9uQ3JlYXRlID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQW55Qm90c0NoYW5nZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25BbnlCb3RzUmVtb3ZlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC51cGRhdGVMYWJlbCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5sYWJlbFdvcmRXcmFwTW9kZSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGxhYmVsV29yZFdyYXBNb2RlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwoKLy8gLS0tIDEpIFdvcmQgYnJlYWtpbmcgKHdyYXAgYnkgd29yZHMsIGNodW5rIGxvbmcgd29yZHMpIC0tLQpmdW5jdGlvbiBicmVha1dvcmRzVG9MaW5lcyh0ZXh0LCBtYXhDb2xzID0gMTgpIHsKICAgIGlmICghdGV4dCkgcmV0dXJuIFsnJ107CiAgICBjb25zdCB3b3JkcyA9IHRleHQuc3BsaXQoL1xzKy8pLmZpbHRlcihCb29sZWFuKTsKICAgIGNvbnN0IGxpbmVzID0gW107CiAgICBsZXQgbGluZSA9ICcnOwoKICAgIGNvbnN0IHB1c2ggPSAoKSA9PiB7IGxpbmVzLnB1c2gobGluZSk7IGxpbmUgPSAnJzsgfTsKCiAgICBmb3IgKGNvbnN0IHcgb2Ygd29yZHMpIHsKICAgICAgICBpZiAody5sZW5ndGggPiBtYXhDb2xzKSB7CiAgICAgICAgICAgIC8vIGNsb3NlIGN1cnJlbnQgbGluZSAoaWYgYW55KSBiZWZvcmUgY2h1bmtpbmcgYSBsb25nIHdvcmQKICAgICAgICAgICAgaWYgKGxpbmUpIHB1c2goKTsKICAgICAgICAgICAgLy8gY2h1bmsgdGhlIGxvbmcgd29yZAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcubGVuZ3RoOyBpICs9IG1heENvbHMpIHsKICAgICAgICAgICAgICAgIGxpbmVzLnB1c2gody5zbGljZShpLCBpICsgbWF4Q29scykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpbmUgPSAnJzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICghbGluZS5sZW5ndGgpIHsKICAgICAgICAgICAgbGluZSA9IHc7CiAgICAgICAgfSBlbHNlIGlmIChsaW5lLmxlbmd0aCArIDEgKyB3Lmxlbmd0aCA8PSBtYXhDb2xzKSB7CiAgICAgICAgICAgIGxpbmUgKz0gJyAnICsgdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwdXNoKCk7CiAgICAgICAgICAgIGxpbmUgPSB3OwogICAgICAgIH0KICAgIH0KICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaCgpOwoKICAgIHJldHVybiBsaW5lcy5sZW5ndGggPyBsaW5lcyA6IFsnJ107Cn0KCi8vIFByZXNlcnZlcyBleGlzdGluZyBcbiBhcyBoYXJkIGJyZWFrczsgd3JhcHMgd2l0aGluIGVhY2ggaGFyZCBsaW5lLgpmdW5jdGlvbiBicmVha1dvcmRzVG9MaW5lc1ByZXNlcnZlTmV3bGluZXModGV4dCwgbWF4Q29scyA9IDE4KSB7CiAgaWYgKHRleHQgPT0gbnVsbCkgcmV0dXJuIFsnJ107CgogIC8vIFNwbGl0IG9uIHJlYWwgbmV3bGluZXM7IGtlZXAgZW1wdHkgbGluZXMgc28gd2UgcHJlc2VydmUgYmxhbmsgbGluZXMuCiAgY29uc3QgaGFyZExpbmVzID0gU3RyaW5nKHRleHQpLnNwbGl0KC9ccj9cbi8pOwogIGNvbnN0IG91dCA9IFtdOwoKICAvLyBIZWxwZXIgdG8gd3JhcCBhIHNpbmdsZSBoYXJkIGxpbmUgYnkgd29yZHMgKHdpdGggbG9uZy13b3JkIGNodW5raW5nKQogIGNvbnN0IHdyYXBPbmUgPSAoc3JjKSA9PiB7CiAgICAvLyBOb3JtYWxpemUgdGFicyAtPiBzcGFjZXM7IGNvbGxhcHNlIGludGVybmFsIHdoaXRlc3BhY2UgKG5vdCBuZXdsaW5lcykKICAgIGNvbnN0IHMgPSBzcmMucmVwbGFjZSgvXHQvZywgJyAgICAnKS5yZXBsYWNlKC9ccysvZywgJyAnKS50cmltKCk7CiAgICBpZiAoIXMubGVuZ3RoKSB7IG91dC5wdXNoKCcnKTsgcmV0dXJuOyB9CgogICAgY29uc3Qgd29yZHMgPSBzLnNwbGl0KCcgJyk7CiAgICBsZXQgbGluZSA9ICcnOwoKICAgIGNvbnN0IHB1c2hMaW5lID0gKCkgPT4geyBvdXQucHVzaChsaW5lKTsgbGluZSA9ICcnOyB9OwoKICAgIC8vIGNodW5rIGxvbmcgd29yZHMgdG8gZW11bGF0ZSAnYnJlYWtXb3JkcycKICAgIGNvbnN0IGNodW5rV29yZCA9ICh3KSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdy5sZW5ndGg7IGkgKz0gbWF4Q29scykgewogICAgICAgIGNvbnN0IGNodW5rID0gdy5zbGljZShpLCBpICsgbWF4Q29scyk7CiAgICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgbGluZSA9IGNodW5rOwogICAgICAgIGVsc2UgeyBwdXNoTGluZSgpOyBsaW5lID0gY2h1bms7IH0KICAgICAgfQogICAgfTsKCiAgICBmb3IgKGNvbnN0IHcgb2Ygd29yZHMpIHsKICAgICAgaWYgKHcubGVuZ3RoID4gbWF4Q29scykgewogICAgICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaExpbmUoKTsKICAgICAgICBjaHVua1dvcmQodyk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgewogICAgICAgIGxpbmUgPSB3OwogICAgICB9IGVsc2UgaWYgKGxpbmUubGVuZ3RoICsgMSArIHcubGVuZ3RoIDw9IG1heENvbHMpIHsKICAgICAgICBsaW5lICs9ICcgJyArIHc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHVzaExpbmUoKTsKICAgICAgICBsaW5lID0gdzsKICAgICAgfQogICAgfQogICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoTGluZSgpOwogIH07CgogIGZvciAoY29uc3QgaGwgb2YgaGFyZExpbmVzKSB7CiAgICB3cmFwT25lKGhsKTsgICAgICAgICAgIC8vIHdyYXAgd2l0aGluIHRoaXMgaGFyZCBsaW5lCiAgfQoKICAvLyBJZiB0aGUgaW5wdXQgZW5kZWQgd2l0aCBhIHRyYWlsaW5nIG5ld2xpbmUsIHdlIGFscmVhZHkgcHJlc2VydmVkIGl0CiAgLy8gYmVjYXVzZSBzcGxpdCBrZXB0IGFuIGVtcHR5IGxhc3QgaXRlbSAtPiBiZWNhbWUgYW4gZW1wdHkgd3JhcHBlZCBsaW5lLgogIHJldHVybiBvdXQubGVuZ3RoID8gb3V0IDogWycnXTsKfQoKLy8gLS0tIDIpIFNpbXBsZSBzaXppbmcgZnJvbSBsaW5lcyAtLS0KLy8gVGhpbmsgb2YgImNvbHNQZXJTY2FsZVgiIGFzICJhYm91dCBOIGNoYXJhY3RlcnMgcGVyIDEgc2NhbGVYIi4KZnVuY3Rpb24gY29tcHV0ZVNpbXBsZVNjYWxlc0Zyb21MaW5lcyhsaW5lcywgewogICAgY29sc1BlclNjYWxlWCA9IDIuNSwKICAgIG1pblNjYWxlWCA9IDEuMjUsCiAgICBtYXhTY2FsZVggPSAxMCwKICAgIGJhc2VTY2FsZVkgPSAxLjIsCiAgICBwZXJMaW5lWSA9IDAuNzUsCn0gPSB7fSkgewogICAgY29uc3QgbG9uZ2VzdCA9IGxpbmVzLnJlZHVjZSgobSwgbCkgPT4gTWF0aC5tYXgobSwgbC5sZW5ndGgpLCAwKTsKICAgIGNvbnN0IGxpbmVDb3VudCA9IE1hdGgubWF4KDEsIGxpbmVzLmxlbmd0aCk7CgogICAgLy8gV2lkdGggc2NhbGVzIHdpdGggdGhlIGxvbmdlc3QgbGluZSBsZW5ndGgKICAgIGxldCBzY2FsZVggPSBsb25nZXN0ID4gMCA/IChsb25nZXN0IC8gY29sc1BlclNjYWxlWCkgOiBtaW5TY2FsZVg7CiAgICBzY2FsZVggPSBNYXRoLm1heChtaW5TY2FsZVgsIE1hdGgubWluKG1heFNjYWxlWCwgc2NhbGVYKSk7CgogICAgLy8gSGVpZ2h0IGdyb3dzIHBlciBsaW5lOyBrZWVwIGl0IHNpbXBsZSBhbmQgcHJlZGljdGFibGUKICAgIGNvbnN0IHNjYWxlWSA9IE1hdGgubWF4KGJhc2VTY2FsZVksIGJhc2VTY2FsZVkgKyAobGluZUNvdW50IC0gMSkgKiBwZXJMaW5lWSk7CgogICAgcmV0dXJuIHsgc2NhbGVYLCBzY2FsZVksIGxvbmdlc3QsIGxpbmVDb3VudCB9Owp9CgoKLy8gUGljayB5b3VyIHRhcmdldCAiY29sdW1ucyIgcGVyIGxpbmUgKHR3ZWFrIHRvIHRhc3RlKQpjb25zdCBNQVhfQ09MUyA9IDMyOwoKLy8gQnJlYWsgdGhlIHRleHQgeW91cnNlbGYKY29uc3QgbGluZXMgPSBwcmVzZXJ2ZU5ld0xpbmVzID8gYnJlYWtXb3Jkc1RvTGluZXNQcmVzZXJ2ZU5ld2xpbmVzKGxhYmVsLCBNQVhfQ09MUykgOiBicmVha1dvcmRzVG9MaW5lcyhsYWJlbCwgTUFYX0NPTFMpOwpjb25zdCB3cmFwcGVkTGFiZWwgPSBsaW5lcy5qb2luKCdcbicpOwoKLy8gQ29tcHV0ZSBzaW1wbGUgc2NhbGVzIGZyb20gdGhlIHdyYXBwZWQgdGV4dApjb25zdCB7IHNjYWxlWCwgc2NhbGVZIH0gPSBjb21wdXRlU2ltcGxlU2NhbGVzRnJvbUxpbmVzKGxpbmVzKTsKCmxldCBsYWJlbE1vZCA9IHsKICAgIHNwYWNlOiBzcGFjZSwKICAgIHRyYWNrQm90SWQ6IGJvdC5pZCwKICAgIGZvcm06ICdzcHJpdGUnLAogICAgY29sb3IsCiAgICBsYWJlbDogd3JhcHBlZExhYmVsLAogICAgbGFiZWxDb2xvciwKICAgIGxhYmVsU2l6ZTogMSwKICAgIGxhYmVsUGFkZGluZ1g6IDAuNSwKICAgIGxhYmVsV29yZFdyYXBNb2RlOiAnbm9uZScsCiAgICBzY2FsZVgsIAogICAgc2NhbGVZLAogICAgc2NhbGVaOiAwLjEsCiAgICBib3RMYWJlbE1hcmdpbjogMSwKICAgIGFuY2hvclBvaW50OiAn4p6h77iPMCwtMC41LDAnLAogICAgb3JpZW50YXRpb25Nb2RlOiAnYmlsbGJvYXJkJywKICAgIGRpbWVuc2lvbjogZGltZW5zaW9uLAogICAgZGVidWc6IGZhbHNlLAogICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgb25DcmVhdGU6IGBACiAgICAgICAgLy8gV2FpdCBmb3IgcmVxdWlyZWQgYm90cyB0byBiZSByZWFkeS4KICAgICAgICBsZXQgd2FpdFRpbWUgPSAwOwoKICAgICAgICB3aGlsZSghZ2xvYmFsVGhpcy5hYikgewogICAgICAgICAgICBpZiAod2FpdFRpbWUgPj0gNTAwMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCBvcy5zbGVlcCgyNTApOwogICAgICAgICAgICB3YWl0VGltZSArPSAyNTA7CiAgICAgICAgfQoKICAgICAgICB0YWdzLnJlYWR5ID0gdHJ1ZTsKICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICBgLAogICAgb25BbnlCb3RzQ2hhbmdlZDogYEAKICAgICAgICBmb3IgKGNvbnN0IGNoYW5nZWQgb2YgdGhhdCkgewogICAgICAgICAgICBpZiAoY2hhbmdlZC5ib3QgJiYgY2hhbmdlZC5ib3QuaWQgPT09IHRhZ3MudHJhY2tCb3RJZCkgewogICAgICAgICAgICAgICAgY29uc3Qgb25seVJvdGF0aW9uVGFncyA9IGNoYW5nZWQudGFncy5ldmVyeSgodCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmVuZHNXaXRoKCdSb3RhdGlvbicpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWCcpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWScpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWicpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBvbmx5Um90YXRpb25UYWdzOicsIG9ubHlSb3RhdGlvblRhZ3MpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChvbmx5Um90YXRpb25UYWdzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGAsCiAgICBvbkFueUJvdHNSZW1vdmVkOiBgQAoKICAgICAgICBpZiAodGhhdC5ib3RJRHMuaW5jbHVkZXModGFncy50cmFja0JvdElkKSkgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgIH0KICAgIGAsCiAgICBvblBvcnRhbENoYW5nZWQ6IGBACiAgICAgICAgaWYgKHRoYXQuZGltZW5zaW9uID09PSB0YWdzLmRpbWVuc2lvbikgewogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICAgICAgfQogICAgYCwKICAgIHVwZGF0ZUxhYmVsOiBgQAogICAgICAgIGlmICghdGFncy5yZWFkeSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yaW5nIHVwZGF0ZUxhYmVsIGJlY2F1c2Ugbm90IHJlYWR5Jyk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBoYXNMYWJlbCA9IHRhZ3MubGFiZWwgIT0gbnVsbCAmJiB0YWdzLmxhYmVsICE9PSAnJzsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGhhc0xhYmVsOwoKICAgICAgICBpZiAoIWhhc0xhYmVsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yZSB1cGRhdGVMYWJlbCBjYWxsLCB0aGVyZSBpcyBubyBsYWJlbCB0YWcgdmFsdWUgdG8gZGlzcGxheS4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaW5NYXBQb3J0YWwgPSAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgY29uc3QgaW5HcmlkUG9ydGFsID0gKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICghaW5NYXBQb3J0YWwgJiYgIWluR3JpZFBvcnRhbCkgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmUgdXBkYXRlTGFiZWwgY2FsbCwgbm90IGluIGVpdGhlciBncmlkIG9yIG1hcCBwb3J0YWwuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdHJhY2tCb3QgPSBnZXRCb3QoJ2lkJywgdGFncy50cmFja0JvdElkKTsKICAgICAgICBjb25zdCB0cmFja1Bvc2l0aW9uID0gZ2V0Qm90UG9zaXRpb24odHJhY2tCb3QsIHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSB0cmFja1Bvc2l0aW9uOicsIHRyYWNrUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgbGV0IGxhYmVsUG9zaXRpb24gPSB7IHg6IHRyYWNrUG9zaXRpb24ueCwgeTogdHJhY2tQb3NpdGlvbi55LCB6OiB0cmFja1Bvc2l0aW9uLnogfTsgCgogICAgICAgIGNvbnN0IHRyYWNrQm90U2NhbGUgPSB0cmFja0JvdC50YWdzLnNjYWxlID8/IDE7CiAgICAgICAgY29uc3QgdHJhY2tCb3RTY2FsZVogPSB0cmFja0JvdC50YWdzLnNjYWxlWiA/PyAxOwoKICAgICAgICBsZXQgbWV0ZXJzUGVyR3JpZFVuaXQgPSAxOwoKICAgICAgICBpZiAoaW5NYXBQb3J0YWwpIHsKICAgICAgICAgICAgLy8gU2NhbGUgdG8gbWFwIHBvcnRhbCB1bml0cy4KICAgICAgICAgICAgbWV0ZXJzUGVyR3JpZFVuaXQgPSAxMDsKICAgICAgICB9CgogICAgICAgIGxldCB0cmFja0JvdFJlYWxTY2FsZVogPSAodHJhY2tCb3RTY2FsZVogKiB0cmFja0JvdFNjYWxlKSAqIG1ldGVyc1BlckdyaWRVbml0OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIHRyYWNrQm90UmVhbFNjYWxlWjonLCB0cmFja0JvdFJlYWxTY2FsZVopOwogICAgICAgIH0KCiAgICAgICAgbGFiZWxQb3NpdGlvbi56ICs9IHRyYWNrQm90UmVhbFNjYWxlWiArICh0YWdzLmJvdExhYmVsTWFyZ2luICogbWV0ZXJzUGVyR3JpZFVuaXQpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGxhYmVsUG9zaXRpb246JywgbGFiZWxQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1gnXSA9IGxhYmVsUG9zaXRpb24ueDsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1knXSA9IGxhYmVsUG9zaXRpb24ueTsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1onXSA9IGxhYmVsUG9zaXRpb24uejsKICAgIGAKfTsKCmxhYmVsTW9kID0gewogICAgLi4ubGFiZWxNb2QsCiAgICAuLi5yZXN0LAp9Cgpjb25zdCBsYWJlbEJvdCA9IGNyZWF0ZShsYWJlbE1vZCk7CgpyZXR1cm4gbGFiZWxCb3Q7JwDz76HdCYy7AwV1dGlscwIEAPPvod0JxLEEKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAPPvod0JjLsDBGZvcm0CBADz76HdCeuxBAdub3RoaW5nJwDz76HdCYy7AwlhYlZlcnNpb24CBADz76HdCfOxBAUxMC4zNQA="}]}