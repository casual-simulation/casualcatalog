{"version":2,"updates":[{"id":0,"timestamp":1769542430529,"update":"AYsCoNWuuQUAJwEEYm90cyQxMzY3MjI1My0yNTM2LTQwODYtOTVjZi1lYjE2ZmZjY2U0ZGQBJwCg1a65BQAGc3lzdGVtAgQAoNWuuQUBEmFiLmludGVyZmFjZS5zb3VuZCcAoNWuuQUACGFiSWdub3JlAgQAoNWuuQUUBHRydWUnAKDVrrkFAAthYkludGVyZmFjZQIEAKDVrrkFGQR0cnVlJwCg1a65BQALZGVzY3JpcHRpb24CBACg1a65BR6lAXRoaXMgc2tpbGwgaXMgYSBtYW5hZ2VyIGZvciBzb3VuZHMNCnN1cHBvcnRlZCB0YWdzOg0KICAgIHNvdW5kQ3JlYXRlDQogICAgc291bmRDbGljaw0KICAgIHNvdW5kRHJhZw0KICAgIHNvdW5kRHJvcA0KICAgIHNvdW5kUG9pbnRlckVudGVyDQogICAgc291bmRQb2ludGVyRXhpdA0KICAgICcAoNWuuQUABGZvcm0CBACg1a65BcQBB25vdGhpbmcnAKDVrrkFAAhyZW1lbWJlcgIEAKDVrrkFzAEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAoNWuuQUAD29uQW55Qm90Q2xpY2tlZAIEAKDVrrkF8wFbQGlmICh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kQ2xpY2spIHsNCiAgICB0aGlzQm90LnBsYXlTb3VuZCh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kQ2xpY2spOw0KfScAoNWuuQUADG9uQW55Qm90RHJhZwIEAKDVrrkFzwJZQGlmICh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kRHJhZykgew0KICAgIHRoaXNCb3QucGxheVNvdW5kKHRoYXQ/LmJvdD8udGFncz8uc291bmREcmFnKTsNCn0nAKDVrrkFAAlwbGF5U291bmQCBACg1a65BakD9AFAaWYgKHRoYXQpIHsNCiAgICBpZiAodGhhdC5zdGFydHNXaXRoKCdodHRwczovLycpKSB7DQogICAgICAgIG9zLnBsYXlTb3VuZCh0aGF0KTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb25zdCBzb3VuZFVSTCA9IGF3YWl0IGFiLmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKHRoYXQpOw0KICAgICAgICBpZiAoc291bmRVUkwpIHsNCiAgICAgICAgICAgIG9zLnBsYXlTb3VuZChzb3VuZFVSTCk7DQogICAgICAgIH0NCiAgICB9DQp9JwCg1a65BQAMb25BbnlCb3REcm9wAgQAoNWuuQWeBVlAaWYgKHRoYXQ/LmJvdD8udGFncz8uc291bmREcm9wKSB7DQogICAgdGhpc0JvdC5wbGF5U291bmQodGhhdD8uYm90Py50YWdzPy5zb3VuZERyb3ApOw0KfScAoNWuuQUAFG9uQW55Qm90UG9pbnRlckVudGVyAgQAoNWuuQX4BWlAaWYgKHRoYXQ/LmJvdD8udGFncz8uc291bmRQb2ludGVyRW50ZXIpIHsNCiAgICB0aGlzQm90LnBsYXlTb3VuZCh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kUG9pbnRlckVudGVyKTsNCn0nAKDVrrkFABNvbkFueUJvdFBvaW50ZXJFeGl0AgQAoNWuuQXiBmVAaWYgKHRoYXQ/LmJvdD8udGFncz8uc291bmRQb2ludGVyRXhpdCkgewogICAgdGhpc0JvdC5wbGF5U291bmQodGhhdD8uYm90Py50YWdzPy5zb3VuZFBvaW50ZXJFeGl0KTsKfScAoNWuuQUAC29uQW55Q3JlYXRlAgQAoNWuuQXIB11AaWYgKHRoYXQ/LmJvdD8udGFncz8uc291bmRDcmVhdGUpIHsNCiAgICB0aGlzQm90LnBsYXlTb3VuZCh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kQ3JlYXRlKTsNCn0nAKDVrrkFAAlhYlZlcnNpb24CBACg1a65BaYIBTEwLjM1JwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwCg1a65BawICmFiSURPcmlnaW4CBACg1a65Ba0IDXRvb2xib3hfc2tpbGwnAKDVrrkFrAgLYWJJbnRlcmZhY2UCBACg1a65BbsIBHRydWUnAKDVrrkFrAgLZGVzY3JpcHRpb24CBACg1a65BcAIKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwCg1a65BawIBGZvcm0CBACg1a65BeoIB25vdGhpbmcnAKDVrrkFrAgEbWVudQIEAKDVrrkF8ggo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAoNWuuQWsCAZzeXN0ZW0CBACg1a65BZkJFGFiLmludGVyZmFjZS50b29sYm94JwCg1a65BawICmFiSURTdHVkaW8CBACg1a65Ba4JJGU5MWVhYjBkLTZhNzUtNGFiOS04YTBlLTUwYTRjYzBjMWQzNCcAoNWuuQWsCAhyZW1lbWJlcgIEAKDVrrkF0wko8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAoNWuuQWsCAt0b29sYm94X2FkZAIEAKDVrrkF+gnIC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgiYmFzZVNraWxsIiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIG1lbnVCb3Qub25Qb2ludGVyVXAoKTsKICAgICAgICBtZW51Qm90Lm9uQ2xpY2soKTsKICAgIH0KfQplbHNlIGlmIChhY3RpdmVUb29sYm94ICYmIGFjdGl2ZVRvb2xib3gudGFncy5hYkdyaWRNZW51QWN0aW9uKSB7CiAgICBhY3RpdmVUb29sYm94LmFiR3JpZE1lbnVBY3Rpb24oeyBncmlkSW5mb3JtYXRpb246IGdyaWREYXRhIH0pOwp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiQ29yZU1lbnVBY3Rpb24pIHsKICAgIC8vUkVGUkVTSCBBTkQgVEhFTiBPUEVOPz8/Cn0nAKDVrrkFrAgFbGVhcm4CBACg1a65BcMVKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAKDVrrkFrAgFc3RvcmUCBACg1a65BeoVKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAKDVrrkFrAgGc2VhcmNoAgQAoNWuuQWRFijwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCg1a65BawICGFiSWdub3JlAgQAoNWuuQW4FgR0cnVlJwCg1a65BawICWFiVmVyc2lvbgIEAKDVrrkFvRYFMTAuMzUnAKDVrrkFrAgNbWFuaWZlc3RhdGlvbgIEAKDVrrkFwxYo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAoNWuuQWsCBBhYkdyaWRNZW51QWN0aW9uAgQAoNWuuQXqFrkLQC8vIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgovLyBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKLy8gdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACi8vICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwovLyAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7Ci8vIGA7Ci8vIHRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKLy8gICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7Ci8vICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKLy8gICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKLy8gICAgIH0KLy8gYDsKLy8gdGhpc0JvdC5tYXNrcy5hYk1lbnVSZWZyZXNoID0gYEAKLy8gICAgIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwovLyAgICAgdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBudWxsOwovLyAgICAgdGhpc0JvdC5tYXNrcy5hYk1lbnVSZWZyZXNoID0gbnVsbDsKLy8gYDsKCi8vIGNvbnN0IHBvc3NpYmxlVG9vbGJveGVzID0gbGlua3MucmVtZW1iZXIudGFncy50b29sYm94X2FycmF5OwovLyBjb25zdCBtZW51Qm90ID0ge307CgovLyBtZW51Qm90LmFiTWVudSA9IHRydWU7Ci8vIG1lbnVCb3QuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKLy8gbWVudUJvdC5ncmlkRGF0YSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7Ci8vIG1lbnVCb3QubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7Ci8vIG1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiYWRkX2JveCI7Ci8vIG1lbnVCb3QubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKLy8gbWVudUJvdC5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7CgovLyBmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlVG9vbGJveGVzLmxlbmd0aDsgaSsrKQovLyB7Ci8vICAgICBjb25zdCBhY3RpdmVUb29sYm94ID0gcG9zc2libGVUb29sYm94ZXNbaV07Ci8vICAgICBjb25zdCBleHRhbnRCb3QgPSBhY3RpdmVUb29sYm94LnN0dWRpbyA/IGdldEJvdCgiYWJJRE9yaWdpbiIsIGFjdGl2ZVRvb2xib3gubmFtZSk6IGdldEJvdChhY3RpdmVUb29sYm94Lm5hbWUsIHRydWUpOwoKLy8gICAgIG1lbnVCb3QudG9vbGJveF9kYXRhID0gYWN0aXZlVG9vbGJveDsKLy8gICAgIG1lbnVCb3QubGFiZWwgPSBhY3RpdmVUb29sYm94LnRpdGxlID8/IGFjdGl2ZVRvb2xib3gubmFtZTsKCi8vICAgICBpZiAoIWV4dGFudEJvdCkKLy8gICAgIHsKLy8gICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51Qm90KTsKLy8gICAgIH0KLy8gfScAoNWuuQWsCBRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAKDVrrkFpCLiAkBjb25zdCB0b29sYm94QXJyYXkgPSBhYlJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKCmxldCBhbGxUb29sc0xvYWRlZCA9IHRydWU7Cgpmb3IgKGxldCBpID0gMDsgaSA8IHRvb2xib3hBcnJheS5sZW5ndGg7IGkrKykgewogICAgY29uc3QgY3VycmVudFRvb2wgPSB0b29sYm94QXJyYXlbaV0ubmFtZTsKCiAgICBpZiAoIWdldEJvdCgiYWJJRE9yaWdpbiIsIGN1cnJlbnRUb29sKSAmJiAhZ2V0Qm90KGN1cnJlbnRUb29sLCB0cnVlKSkgewogICAgICAgIGFsbFRvb2xzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChhbGxUb29sc0xvYWRlZCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfScAoNWuuQWsCA5hYkdyaWRNZW51SWNvbgIEAKDVrrkFhyUKbG9jYWxfbWFsbCcAoNWuuQWsCA9hYkdyaWRNZW51TGFiZWwCBACg1a65BZIlB2NhdGFsb2cnAKDVrrkFrAgTYWJHcmlkTWVudVNvcnRPcmRlcgIEAKDVrrkFmiUDMTAwJwCg1a65BawID29uQUJJbml0aWFsaXplZAIEAKDVrrkFniUqQC8vIGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7JwCg1a65BawIDW9uU2tpbGxVcGRhdGUCBACg1a65BcklV0BsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOw0KDQpjb25zb2xlLmxvZygiW1Rvb2xib3hdIExvYWRpbmcgY2FzdWFsIGtpdCIpOycAoNWuuQWsCApzaGVsbFV0aWxzAgQAoNWuuQWhJijwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwCg1a65BawIGGFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZQIEAKDVrrkFyCbUCUBpZiAoYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkNhdGFsb2dOYW1lKSB7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJHcmlkTWVudUxhYmVsIiwgYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkNhdGFsb2dOYW1lKTsNCn0NCg0KDQovL05FVw0KY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IHBvc3NpYmxlVG9vbGJveGVzID0gbGlua3MucmVtZW1iZXIudGFncy50b29sYm94X2FycmF5Ow0KDQpmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlVG9vbGJveGVzLmxlbmd0aDsgaSsrKQ0Kew0KICAgIGNvbnN0IG1lbnVCb3QgPSB7fTsNCg0KICAgIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsNCiAgICBtZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQogICAgbWVudUJvdC5ncmlkRGF0YSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQogICAgbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsNCiAgICBtZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOw0KICAgIG1lbnVCb3QubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsNCiAgICBtZW51Qm90Lm9uQ2xpY2sgPSBgQCANCiAgICAgICAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyANCiAgICAgICAgc2V0VGFnTWFzayhhYi5saW5rcy5yZW1lbWJlciwgImxhc3RPcGVuZWREcm9wZG93biIsIG51bGwpOw0KICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7DQogICAgDQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7DQogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOw0KDQogICAgaWYgKCFleHRhbnRCb3QpDQogICAgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtZW51Qm90KTsNCiAgICB9DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAoNWuuQWsCBJhYkdyaWRNZW51SXRlbVR5cGUCBACg1a65BZ0wCGRyb3Bkb3duJwCg1a65BawIEWRyb3Bkb3duU29ydE9yZGVyAgQAoNWuuQWmMAMxMDAnAKDVrrkFrAgPZHJvcGRvd25PcHRpb25zAgQAoNWuuQWqMAbwn6esW10nAQRib3RzJDE3NDEwZDgzLTdlZWUtNGExZS1iNjM4LTY1NDYzNzRkMTdjMwEnAKDVrrkFrzAGc3lzdGVtAgQAoNWuuQWwMBFhYi5pbnRlcmZhY2Uuc2NhbicAoNWuuQWvMARmb3JtAgQAoNWuuQXCMAdub3RoaW5nJwCg1a65Ba8wC2FiSW50ZXJmYWNlAgQAoNWuuQXKMAR0cnVlJwCg1a65Ba8wCGFiSWdub3JlAgQAoNWuuQXPMAR0cnVlJwCg1a65Ba8wD29uUVJDb2RlU2Nhbm5lZAIEAKDVrrkF1DD9D0BpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBzY2FubmVkICIgKyB0aGF0KTsKCmxldCByZXF1ZXN0aW5nQUkgPSBmYWxzZTsKaWYgKGNvbmZpZ0JvdC50YWdzLnJlcXVlc3RpbmdBSSkgewogICAgY29uZmlnQm90LnRhZ3MucmVxdWVzdGluZ0FJID0gbnVsbDsKICAgIHJlcXVlc3RpbmdBSSA9IHRydWU7Cn0KCmlmIChjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbikKewogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGlua3Muc3RvcmUuYWJRUlB1Ymxpc2godGhhdCk7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuKQp7CiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICBjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4gPSBudWxsOwoKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIHRyeQogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CgogICAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IHBoQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoInBoIik7CiAgICBsZXQgaW5zdENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJpbnN0Iik7CiAgICBsZXQgYWJDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiYWIiKTsKICAgIGxldCBjd0NoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJjdyIpOwoKICAgIGlmIChwaENoZWNrICYmIGluc3RDaGVjayAmJiBhYkNoZWNrICYmIGN3Q2hlY2spCiAgICB7CiAgICAgICAgb3MuZ29Ub1VSTCh0aGF0KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBvcy50b2FzdCgibm90IGEgcmVjb2duaXplZCBwcmFjdGljZSBwZXJtaXQiKTsKICAgIH0KCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLmFiU2NhbikKewogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBjb25maWdCb3QudGFncy5hYlNjYW4gPSBudWxsOwogICAgCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICB0cnkgCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7CiAgICB9CiAgICBjYXRjaCAoZSkgCiAgICB7CiAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiB0aGF0fSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZihzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFzayIpID09ICJlZ2dDYXJ0b24iKQogICAgewogICAgICAgIGlmIChyZXF1ZXN0aW5nQUkpIHsKICAgICAgICAgICAgc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJyZXF1ZXN0aW5nQUkiLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgb3MuZ29Ub1VSTChzY2FubmVkVVJMLmhyZWYpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5hc2spIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hc2t9KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5wYXR0ZXJufSk7CiAgICAgICAgfQogICAgICAgIAogICAgfQp9JwCg1a65Ba8wBXN0b3JlAgQAoNWuuQXSQCjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCg1a65Ba8wBnNlYXJjaAIEAKDVrrkF+UAo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAoNWuuQWvMBBhYkNvcmVNZW51QWN0aW9uAgQAoNWuuQWgQTdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwCg1a65Ba8wD2FiQ29yZU1lbnVMYWJlbAIEAKDVrrkF2EEEc2NhbicAoNWuuQWvMA5hYkNvcmVNZW51SWNvbgIEAKDVrrkF3UEPcXJfY29kZV9zY2FubmVyJwCg1a65Ba8wE2FiQ29yZU1lbnVTb3J0T3JkZXICBACg1a65Be1BATMnAKDVrrkFrzAJYWJWZXJzaW9uAgQAoNWuuQXvQQUxMC4zNScBBGJvdHMkM2E2Y2I5Y2EtYjNiNC00ZDc3LTgyZjYtZmE1OWI1Mjk2ZWM5AScAoNWuuQX1QQZzeXN0ZW0CBACg1a65BfZBF2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwCg1a65BfVBCGFiSWdub3JlAgQAoNWuuQWOQgR0cnVlJwCg1a65BfVBD2Ryb3Bkb3duT3B0aW9ucwIEAKDVrrkFk0IG8J+nrFtdJwCg1a65BfVBEmFiQ29yZU1lbnVJdGVtVHlwZQIEAKDVrrkFmEIIZHJvcGRvd24nAKDVrrkF9UERZHJvcGRvd25Tb3J0T3JkZXICBACg1a65BaFCBGF1dG8nAKDVrrkF9UEYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQAoNWuuQWmQv4gQGNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCmNvbnN0IGN1cnJlbnRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyAibWFwIiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT0gImJsdWVwcmludCIgPyAiYmx1ZXByaW50IiA6ImdyaWQiOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCi8vIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQovLyB9IGVsc2Ugew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCi8vIH0NCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTmF2aWdhdGlvbk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCg0KY29uc3QgaG9tZVdvcmxkQnV0dG9uID0gew0KICAgIC4uLm1lbnVPcHRpb25zLA0KICAgIGxhYmVsOiAiaG9tZSB3b3JsZCIsDQogICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvMzhhZThiNjk1N2Y0NDgzZDg3MTYxNDFkMWU5OGM5M2YwZTdkY2NlMTViYzVjMTIzYmQwZTllMWFiNjg3Y2MwNS5wbmcnLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIGNvbnN0IGN1cnJlbnRVUkwgPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCk7DQogICAgICAgIGNvbnN0IG9yaWdpbiA9IGN1cnJlbnRVUkwub3JpZ2luOw0KDQogICAgICAgIGxldCBuZXdVUkwgPSBuZXcgVVJMKG9yaWdpbik7DQoNCiAgICAgICAgaWYgKGFiUmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY2hhbm5lbCIsIGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb25maWdCb3QudGFncy5jb21JZCkgew0KICAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImNvbUlkIiwgY29uZmlnQm90LnRhZ3MuY29tSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm93bmVyIiwgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiAicGxheWVyIik7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJpbnN0IiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm1hcFBvcnRhbCIsICdob21lJyk7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJhc2siLCAnaG9tZScpOw0KICAgICAgICANCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgew0KICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgic3R1ZGlvIiwgdGhhdC5pZCk7IA0KICAgICAgICB9DQoNCiAgICAgICAgb3Mub3BlblVSTChuZXdVUkwuaHJlZik7DQogICAgYA0KfTsNCg0KaWYgKCFnZXRCb3QoImlzSG9tZVdvcmxkQ29yZSIsIHRydWUpICYmIGF1dGhCb3QpIHsNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lV29ybGRCdXR0b24pOw0KfQ0KDQppZiAoY3VycmVudFBvcnRhbCA9PSAnbWFwJykgew0KDQogICAgY29uc3QgaG9tZUJhc2VCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQoNCiAgICBpZiAoaG9tZUJhc2VCb3QpIHsNCiAgICAgICAgY29uc3QgaG9tZUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhvbWVCYXNlQm90LnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1L2NkMzhhZmZjMDYwNGJlYWE1ODhkYTIxYWExYmU3NTBiYjNlNzNiM2IzY2FlMjNlYjMwMzA3YzM0NDk0NDU5ZjMucG5nJywNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgY29uc3QgaG9tZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBpZiAoaG9tZUJvdCkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGhvbWVCb3QsIHsgem9vbTogMjAwMCB9KS5jYXRjaCgoKSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZUJ1dHRvbik7DQogICAgfQ0KDQogICAgY29uc3QgcGxhY2VzQXJyID0gW107DQogICAgY29uc3QgcGxhY2VzID0gZ2V0Qm90cygiaG9tZVBsYWNlIiwgdHJ1ZSk7DQogICAgZm9yIChjb25zdCBoUGxhY2Ugb2YgcGxhY2VzKSB7DQogICAgICAgIGlmIChoUGxhY2UudGFncy5ob21lQmFzZSA9PSB0cnVlKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBwbGFjZU9iaiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhQbGFjZS50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2xvY2F0aW9uX29uJywNCiAgICAgICAgICAgIHBsYWNlOiBnZXRMaW5rKGhQbGFjZSksDQogICAgICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgICAgIGlmIChsaW5rcy5wbGFjZSkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGxpbmtzLnBsYWNlLCB7IHpvb206IDIwMDAgfSkuY2F0Y2goZSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICAgICAgYA0KICAgICAgICB9DQoNCiAgICAgICAgcGxhY2VzQXJyLnB1c2gocGxhY2VPYmopOw0KICAgIH0NCg0KICAgIHBsYWNlc0Fyci5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgIGNvbnN0IG5hbWVBID0gYS5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KICAgICAgICBjb25zdCBuYW1lQiA9IGIubGFiZWwudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMDsNCiAgICB9KTsNCg0KICAgIGZvciAoY29uc3Qgc29ydGVkUGxhY2Ugb2YgcGxhY2VzQXJyKSB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHNvcnRlZFBsYWNlKTsNCiAgICB9DQoNCg0KICAgIGNvbnN0IGN1cnJlbnRMb2NhdGlvbkJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiAnY3VycmVudCBsb2NhdGlvbicsDQogICAgICAgIGZvcm1BZGRyZXNzOiAnbmVhcl9tZScsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5za2lsbEJvdC5nb1RvQ3VycmVudExvY2F0aW9uKCk7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goY3VycmVudExvY2F0aW9uQnV0dG9uKTsNCn0NCg0KaWYgKGRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPT0gMCkgew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KfSBlbHNlIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAoNWuuQX1QRBhYkNvcmVNZW51QWN0aW9uAgQAoNWuuQWlYwNALy8nAKDVrrkF9UELYWJJbnRlcmZhY2UCBACg1a65BaljBHRydWUnAKDVrrkF9UEPYWJDb3JlTWVudUxhYmVsAgQAoNWuuQWuYwlwbGFjZSBuYXYnAKDVrrkF9UEEZm9ybQIEAKDVrrkFuGMHbm90aGluZycAoNWuuQX1QRNnb1RvQ3VycmVudExvY2F0aW9uAgQAoNWuuQXAY4AEQGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgb3MuZ2V0R2VvbG9jYXRpb24oKTsNCg0KaWYgKGxvY2F0aW9uLnN1Y2Nlc3MpIHsNCiAgICBjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCiAgICBjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCg0KICAgIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IGN1cnJlbnREaW07DQogICAgfQ0KDQogICAgb3MuZm9jdXNPbih7eDogbG9jYXRpb24ubG9uZ2l0dWRlLCB5OiBsb2NhdGlvbi5sYXRpdHVkZX0sIHtwb3J0YWw6ICdtYXAnLCB6b29tOiAyMDAwfSk7DQp9IGVsc2Ugew0KICAgIG9zLnRvYXN0KCJMb2NhdGlvbiBzZXJ2aWNlcyBub3QgYXZhaWxhYmxlIikNCn0nAKDVrrkF9UEJYWJWZXJzaW9uAgQAoNWuuQXBZwUxMC4zNScBBGJvdHMkNDkzZmZhNGQtNDZkNC00YTk4LWFlOWMtMTIxMmQ2NTExMzNmAScAoNWuuQXHZwZzeXN0ZW0CBACg1a65BchnFGFiLmludGVyZmFjZS52ZXJzaW9uJwCg1a65BcdnDW9uU2tpbGxVcGRhdGUCBACg1a65Bd1npwFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJJbnRlcmZhY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiSW50ZXJmYWNlTWlub3JWZXJzaW9uOw0KDQpjb25zb2xlLmxvZygiW0FCSW50ZXJmYWNlXSBMb2FkZWQgQUIgSW50ZXJmYWNlIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAoNWuuQXHZxdhYkludGVyZmFjZU1ham9yVmVyc2lvbgIEAKDVrrkFhWkBMicAoNWuuQXHZxdhYkludGVyZmFjZU1pbm9yVmVyc2lvbgIEAKDVrrkFh2kCMzUnAKDVrrkFx2cIYWJJZ25vcmUCBACg1a65BYppBHRydWUnAKDVrrkFx2cEZm9ybQIEAKDVrrkFj2kHbm90aGluZycAoNWuuQXHZwthYkludGVyZmFjZQIEAKDVrrkFl2kEdHJ1ZScAoNWuuQXHZwlhYlZlcnNpb24CBACg1a65BZxpBTEwLjM1JwEEYm90cyQ0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYBJwCg1a65BaJpBnN5c3RlbQIEAKDVrrkFo2kTYWIuaW50ZXJmYWNlLm51Z2dldCcAoNWuuQWiaQRmb3JtAgQAoNWuuQW3aQdub3RoaW5nJwCg1a65BaJpC2FiSW50ZXJmYWNlAgQAoNWuuQW/aQR0cnVlJwCg1a65BaJpCGFiSWdub3JlAgQAoNWuuQXEaQR0cnVlJwCg1a65BaJpDGFiTG9hZE51Z2dldAIEAKDVrrkFyWmYAkBsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0TmFtZTsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK251Z2dldE5hbWU7CmxldCBsb2FkZWROdWdnZXQgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGZvcm1hdHRlZE51Z2dldEFCLCBhYlZlcnNpb246IHRoYXQudmVyc2lvbiwgcmV0dXJuVHlwZTogImRhdGEifSk7Cgpsb2FkZWROdWdnZXQgPSBsb2FkZWROdWdnZXQuc3RhdGVbbnVnZ2V0TmFtZV0ubnVnZ2V0OwoKcmV0dXJuIGxvYWRlZE51Z2dldDsnAKDVrrkFomkPYWJQdWJsaXNoTnVnZ2V0AgQAoNWuuQXia4wDQC8vc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6ICJudWdOYW1lIiwgZGF0YTogZGF0YX0pOyAgQUREIEVHRyBJRCBFVkVOVFVBTExZCmxldCB0ZXN0TnVnZ2V0ID0gdGhhdC5kYXRhOwpsZXQgZm9ybWF0dGVkTnVnZ2V0ID0ge2lkOiB0aGF0Lm51ZywgbnVnZ2V0OiB0ZXN0TnVnZ2V0fTsKbGV0IHRlc3ROdWdnZXROYW1lID0gdGhhdC5udWc7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIit0ZXN0TnVnZ2V0TmFtZTsKCm1hc2tzLm51Z2dldFRvUHVibGlzaCA9IGZvcm1hdHRlZE51Z2dldEFCOwoKbGlua3Muc3RvcmUuYWJQdWJsaXNoQUIoe2FiOiBmb3JtYXR0ZWROdWdnZXRBQiwgdGFyZ2V0OiBmb3JtYXR0ZWROdWdnZXQsIHNvdXJjZUV2ZW50OiAncHVibGlzaF9udWdnZXQnfSk7JwCg1a65BaJpD2ltcGxlbWVudE51Z2dldAIEAKDVrrkF726xB0BsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0OwpsZXQgbnVnZ2V0VmVyc2lvbkNoZWNrID0gbnVnZ2V0TmFtZS5pbmRleE9mKCIudiIpOwpsZXQgdmVyc2lvbjsKCmlmIChudWdnZXRWZXJzaW9uQ2hlY2sgIT0gLTEpCnsKICAgIG51Z2dldE5hbWUgPSBudWdnZXROYW1lLnN1YnN0cmluZygwLCBudWdnZXRWZXJzaW9uQ2hlY2spOwoKICAgIGxldCB2ZXJzaW9uQ2hlY2sgPSB0aGF0Lm51Z2dldC5zdWJzdHJpbmcobnVnZ2V0VmVyc2lvbkNoZWNrICsgMik7CgogICAgaWYgKGlzTmFOKHZlcnNpb25DaGVjaykpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2codmVyc2lvbkNoZWNrLCAidmVyc2lvbiBpcyBub3QgYSBudW1iZXIiKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB2ZXJzaW9uID0gTnVtYmVyKHZlcnNpb25DaGVjayk7CiAgICB9Cn0KY29uc29sZS5sb2cobnVnZ2V0TmFtZSwgdmVyc2lvbik7CmxldCBudWdEYXRhID0gYXdhaXQgdGhpc0JvdC5hYkxvYWROdWdnZXQoe251Z2dldE5hbWU6IG51Z2dldE5hbWUsIHZlcnNpb246IHZlcnNpb259KTsKCmlmIChudWdEYXRhID09ICJhYklEIG5vdCBmb3VuZCIpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgbm90IGZvdW5kIik7Cn0KZWxzZQp7CiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKICAgIGxldCB0YXJnZXRUYWcgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS50b1N0cmluZygpOwogICAgbGV0IHRhcmdldE51ZyA9ICJ7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRUYWcuaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKICAgIGluc2VydFRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCBudWdEYXRhKTsKfScAoNWuuQWiaQxudWdnZXRCdXR0b24CBACg1a65BaF29QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnAKDVrrkFomkLbnVnZ2V0UGFyc2UCBACg1a65BZWDAacPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwCg1a65BaJpDW9uQUJQdWJsaXNoZWQCBACg1a65Bb2SAcEBQGNvbnNvbGUubG9nKHRoYXQuYWIsIHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQoKaWYgKHRoYXQuYWIgPT0gdGFncy5udWdnZXRUb1B1Ymxpc2gpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgcHVibGlzaGVkIik7CgogICAgbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gbnVsbDsKCiAgICBjb25maWdCb3QubWFza3MuYWJWZXJzaW9uID0gbnVsbDsKfScAoNWuuQWiaRBvbkFueUJvdHNDaGFuZ2VkAgQAoNWuuQX/kwG3BEBpZiAoY29uZmlnQm90ICYmIHRoYXRbMF0uYm90LmlkICE9IHRoaXNCb3QuaWQpIAp7CiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QpIHJldHVybjsgLy8gSWdub3JlIGlmIHRoZSBjb25maWdCb3QgaXNuJ3QgcmVhZHkgeWV0LgoKICAgIGNvbnN0IGVkaXRlZEJvdElEID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdC5yZXBsYWNlKCLwn5SXIiwgIiIpOwoKICAgIGlmICghdGhhdC5maW5kKHggPT4geC5ib3QuaWQgPT0gZWRpdGVkQm90SUQpKSByZXR1cm47IC8vIElmIHRoZSBib3QgY2hhbmdlZCB3YXNuJ3QgYmVpbmcgZWRpdGVkIGJ5IHRoZSB1c2VyIGlnbm9yZSBpdC4KCiAgICBjb25zdCBlZGl0ZWRUYWcgPSBjb25maWdCb3QudGFncy5lZGl0aW5nVGFnOwogICAgY29uc3QgZWRpdGVkQm90ID0gZ2V0Qm90KCJpZCIsIGVkaXRlZEJvdElEKTsKCiAgICBpZiAoZWRpdGVkQm90ICYmIGVkaXRlZFRhZykgCiAgICB7CiAgICAgICAgc2hvdXQoIm51Z2dldFJlc2V0Iik7CgogICAgICAgIHRoaXNCb3QubnVnZ2V0UGFyc2UoeyBlZGl0ZWRCb3QsIGVkaXRlZFRhZyB9KTsKICAgIH0KfScAoNWuuQWiaQhvbkNyZWF0ZQIEAKDVrrkFtZgBTEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnAKDVrrkFomkNcGFja2FnZU51Z2dldAIEAKDVrrkFgpkB+AZAY29uc3QgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKY29uc3QgdGFnVGV4dCA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddOwoKaWYgKGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXggfHwgY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXgpCnsKICAgIGxldCBzdGFydFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXg7CiAgICBsZXQgZW5kUG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXg7CgogICAgaWYgKHN0YXJ0UG9zID09IGVuZFBvcykKICAgIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlIGlmIChzdGFydFBvcyA+IGVuZFBvcykKICAgIHsKICAgICAgICBsZXQgbmV3U3RhcnRQb3MgPSBlbmRQb3M7CiAgICAgICAgbGV0IG5ld0VuZFBvcyA9IHN0YXJ0UG9zOwoKICAgICAgICBzdGFydFBvcyA9IG5ld1N0YXJ0UG9zOwogICAgICAgIGVuZFBvcyA9IG5ld0VuZFBvczsKICAgIH0KCiAgICBsZXQgZGF0YSA9IHRhZ1RleHQuc3Vic3RyaW5nKHN0YXJ0UG9zLCBlbmRQb3MgKyAxKTsKCiAgICBzaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogdGhhdC5udWdnZXQsIGRhdGE6IGRhdGF9KTsKCiAgICBvcy50b2FzdCgibnVnIGlzIHB1Ymxpc2hpbmciLCAxMCk7CgogICAgbGV0IHRhcmdldE51ZyA9ICIubnVnIHsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgiY2Fubm90IHJlYWQgbnVnZ2V0IHRvIGJlIHB1Ymxpc2hlZCIpCn0nAKDVrrkFomkIcmVtZW1iZXICBACg1a65BfufASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCg1a65BaJpBnNlYXJjaAIEAKDVrrkFoqABKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAKDVrrkFomkFc3RvcmUCBACg1a65BcmgASjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCg1a65BaJpCWxpc3RlbmluZwIEAKDVrrkF8KABBWZhbHNlJwCg1a65BaJpCWFiVmVyc2lvbgIEAKDVrrkF9qABBTEwLjM1JwEEYm90cyRiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IBJwCg1a65BfygAQhwcmVzZW5jZQIEAKDVrrkF/aABKPCflJc4N2U5NTM0Mi1lNDU2LTRiNjMtOTg5MS1kN2E5MjFhZDNlZTcnAKDVrrkF/KABGWFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3ICBACg1a65BaShAc4MQGNvbnN0IHsKICAgIGxhYmVsID0gYCR7YWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fSBpcyB3b3JraW5nYCwKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge30KCmxldCBidXN5SW5kaWNhdG9yID0gewogICAgb25Qb2ludGVyVXA6IG51bGwsCiAgICBvblBvaW50ZXJEb3duOiBudWxsLAogICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgIGJ1c3lMYWJlbDogbGFiZWwsCiAgICBsYWJlbEFsaWdubWVudDogJ2xlZnQnLAogICAgc3RhdGU6IDAsCiAgICBhbmltU3RhdGVzOiBbCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJycsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgIF0sCiAgICBhbmltUmF0ZTogNTAwLAogICAgb25Cb3RBZGRlZDogYEAKICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgb25Cb3RDaGFuZ2VkOiBgQAogICAgICAgIGNvbnN0IG5lZWRSZWZyZXNoID0gdGhhdC50YWdzLnNvbWUodCA9PiB0ID09PSAnYnVzeUxhYmVsJyB8fCB0ID09PSAnc3RhdGUnIHx8IHQgPT09ICdhbmltU3RhdGVzJyk7CiAgICAgICAgaWYgKG5lZWRSZWZyZXNoKSB7CiAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB9CiAgICBgLAogICAgcmVmcmVzaERpc3BsYXk6IGBACiAgICAgICAgaWYgKHRhZ3MuYW5pbVN0YXRlcyAmJiB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBhbmltU3RhdGUgPSB0YWdzLmFuaW1TdGF0ZXNbdGFncy5zdGF0ZV07CgogICAgICAgICAgICB0YWdzLmxhYmVsID0gdGFncy5idXN5TGFiZWwudHJpbSgpICsgYW5pbVN0YXRlLmVsbGlwc2lzOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYW5pbVN0YXRlLmZvcm1BZGRyZXNzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3MubGFiZWwgCiAgICAgICAgfQogICAgYCwKICAgIGFuaW1hdGU6IGBACiAgICAgICAgaWYgKHRhZ3Muc3RhdGUgPj0gdGFncy5hbmltU3RhdGVzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSArPSAxOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgb3Muc2xlZXAodGFncy5hbmltUmF0ZSk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgLi4ucmVzdAp9OwoKY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKGJ1c3lJbmRpY2F0b3IpOwoKcmV0dXJuIG1lbnVCb3Q7JwCg1a65BfygAQZzeXN0ZW0CBACg1a65BfOtARFhYi5pbnRlcmZhY2UubWVudScAoNWuuQX8oAEEZm9ybQIEAKDVrrkFha4BB25vdGhpbmcnAKDVrrkF/KABC2Rlc2NyaXB0aW9uAgQAoNWuuQWNrgEmVGhpcyBza2lsbCBpcyBkZXNpZ25lZCBmb3IgbWVudSBzdHVmZi4oAKDVrrkF/KABC2FiSW50ZXJmYWNlAXgnAKDVrrkF/KABCmFiT3Blbk1lbnUCBACg1a65BbWuAfEeQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IG1lbnVUeXBlID0gdGhhdCA/ICJhYiIgKyB0aGF0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhhdC5zbGljZSgxKSArICJNZW51IjogImFiQ29yZU1lbnUiOyAvL3NldCB1cCBhIGNoZWNrIHRvIHNlZSB3aGF0IHR5cGUgb2YgbWVudSBzaG91bGQgYmUgb2NjdXJpbmcgW2NvcmUsIGJvdCwgZ3JpZCwgaW5zdF0KbGV0IG1lbnVTa2lsbHMgPSBnZXRCb3RzKG1lbnVUeXBlICsgIkFjdGlvbiIpOwpsZXQgbWF4T3B0aW9ucyA9IG1lbnVUeXBlID09ICJpbnN0IiA/IDcgOiA1OwpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmJhc2VTa2lsbC4ke21lbnVUeXBlICsgIkFjdGlvbiJ9KHtib3Q6IHRoaXNCb3R9KTtgOwoKbGV0IHNvcnRPcmRlckluZGV4ID0gbWVudVNraWxscy5sZW5ndGg7CmZvciAobGV0IGkgPSAwOyBpIDwgbWVudVNraWxscy5sZW5ndGg7IGkrKykvL0FERCBMT0dJQyBGT1IgTU9SRSBPUFRJT05TIFRIQU4gNSA6IG1heE9wdGlvbnMKewogICAgLy9BbGxvd3MgZm9yIGNvZGUgdG8gZ2V0IGNhbGxlZCBiZWZvcmUgdGhlIG1lbnUgZ2VuZXJhdGVzLCB1c2VmdWwgZm9yIGR5bmFtaWNhbGx5IHNldCBncm91cHMgb3IgZHJvcGRvd25zCiAgICBpZiAobWVudVNraWxsc1tpXS50YWdzW21lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIl0pIHsKICAgICAgICBhd2FpdCB3aGlzcGVyKG1lbnVTa2lsbHNbaV0sIG1lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIik7CiAgICB9IAoKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiSGlkZSJdKSB7CiAgICAgICAgY29udGludWU7CiAgICB9CiAgICAKICAgIGxldCBjdXJyZW50U2tpbGwgPSBtZW51U2tpbGxzW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5iYXNlU2tpbGwgPSAi8J+UlyIgKyBjdXJyZW50U2tpbGwuaWQ7CiAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJMYWJlbCJdOwogICAgYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSWNvbiJdOwogICAgYWJNZW51QnV0dG9uLm9uQ3JlYXRlID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiT25HZW5lcmF0ZSJdOwogICAgYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIlNvcnRPcmRlciJdOwogICAgYWJNZW51QnV0dG9uLmNvbG9yID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcjsKCiAgICBjb25zdCBtZW51SXRlbVR5cGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdOwoKICAgIGlmIChtZW51SXRlbVR5cGUgPT0gImRyb3Bkb3duIikgewogICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93bk9wdGlvbnMgPSBjdXJyZW50U2tpbGwudGFncy5kcm9wZG93bk9wdGlvbnM7CgogICAgICAgIGNvbnN0IHByZXZEcm9wZG93biA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmxhc3RPcGVuZWREcm9wZG93bjsKICAgICAgICBpZiAocHJldkRyb3Bkb3duICYmIHByZXZEcm9wZG93bi50YWdzW21lbnVUeXBlICsgIkFjdGlvbiJdKSB7CiAgICAgICAgICAgIGlmIChwcmV2RHJvcGRvd24gPT0gY3VycmVudFNraWxsKSB7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLnJlbWVtYmVyLCAibGFzdE9wZW5lZERyb3Bkb3duIiwgbnVsbCk7CiAgICAgICAgICAgICAgICBhYk1lbnVCdXR0b24uZGVmYXVsdE9wZW4gPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGVsZXRlIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbjsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJEZWZhdWx0T3BlbiJdID09IHRydWUpIHsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiTWVudUJ1dHRvbik7ICAgICAgICAKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJncm91cCIpIHsKICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyID09ICJhdXRvIikgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBzb3J0T3JkZXJJbmRleDsKICAgICAgICAgICAgKytzb3J0T3JkZXJJbmRleDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFncy5ncm91cFNvcnRPcmRlcjsKICAgICAgICB9CiAgICAgICAgYWJNZW51QnV0dG9uLm1lbnVJdGVtcyA9IGN1cnJlbnRTa2lsbC50YWdzLm1lbnVJdGVtczsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUdyb3VwKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtVHlwZSA9PSAiaW5wdXQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gInRleHQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtVHlwZSA9PSAidG9vbCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2woYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJ3aXphcmQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsKICAgIH0KfQoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCT3Blbk1lbnUnLCB7IG1lbnU6IHRoYXQsIG1lbnVUeXBlLCBtZW51UG9ydGFsOiBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCB9KTsnAKDVrrkF/KABEmFiQ3JlYXRlTWVudUJ1dHRvbgIEAKDVrrkFpc0B/A1AbGV0IG5ld01lbnVCdXR0b24gPSB7fTsKCmxldCB7CiAgICBtZW51SXRlbVN0eWxlID0ge30sCiAgICAuLi5hZGRpdGlvbmFsVGFncwp9ID0gdGhhdCA/PyB7fQoKaWYgKHR5cGVvZiBtZW51SXRlbVN0eWxlID09ICdzdHJpbmcnKSB7CiAgICBtZW51SXRlbVN0eWxlID0gbWVudUl0ZW1TdHlsZS5yZXBsYWNlKC9cdXsxRjlFQ30vdSwgJycpOyAKICAgIG1lbnVJdGVtU3R5bGUgPSBKU09OLnBhcnNlKG1lbnVJdGVtU3R5bGUpOwp9CgpmdW5jdGlvbiBoYXNCb3JkZXJTdHlsZSgpIHsKICAgIGlmIChtZW51SXRlbVN0eWxlWyJib3JkZXItdG9wLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLWxlZnQtc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItYm90dG9tLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLXJpZ2h0LXN0eWxlIl0pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KCmlmIChhZGRpdGlvbmFsVGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSkgewogICAgaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiTWVudUdyb3VwIl0pIHsKCiAgICB9Cn0KCm5ld01lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwpuZXdNZW51QnV0dG9uLmxhYmVsQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVMYWJlbENvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKbmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvciA9IHRoYXQuc2hhZG93Q29sb3IgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTaGFkb3dDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24uc2NhbGVZID0gMTsKCmNvbnN0IG1lbnVTdHlsaW5nID0gewogICAgImJvcmRlci1yYWRpdXMiOiI4cHgiLAogICAgIm1hcmdpbi10b3AiOiAiOHB4IiwKICAgICJib3gtc2hhZG93IjogYDNweCA0cHggJHtuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yfWAsCiAgICAibWluLWhlaWdodCI6ICI0NHB4IiwKICAgICJib3JkZXIiOiBoYXNCb3JkZXJTdHlsZSgpID8gIiIgOiBgMnB4IHNvbGlkICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIndpZHRoIjogImNhbGMoMTAwJSAtIDVweCkiLAogICAgLi4ubWVudUl0ZW1TdHlsZQp9CgpuZXdNZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBtZW51U3R5bGluZzsKCmNvbnN0IGNsaWNrZWRTdHlsaW5nID0gewogICAgLi4ubWVudVN0eWxpbmcsCiAgICAiZmlsdGVyIjogImJyaWdodG5lc3MoNjAlKSIKfQpjb25zdCBiYXNlU3R5bGUgPSBgQCBtYXNrcy5tZW51SXRlbVN0eWxlID0gJ/Cfp6wgJHtKU09OLnN0cmluZ2lmeShjbGlja2VkU3R5bGluZyl9J2AKCm5ld01lbnVCdXR0b24ub25Qb2ludGVyRG93biA9IG1lbnVJdGVtU3R5bGU/LlsibWFyZ2luLXRvcCJdICE9ICIwcHgiID8gYmFzZVN0eWxlIDogIkAgLy8iOwpuZXdNZW51QnV0dG9uLm9uUG9pbnRlclVwID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGxgOwoKZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpCnsKICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107Cn0KCm5ld01lbnVCdXR0b24gPSBjcmVhdGUobmV3TWVudUJ1dHRvbik7CgpyZXR1cm4gbmV3TWVudUJ1dHRvbjsnAKDVrrkF/KABDWFiTWVudVJlZnJlc2gCBACg1a65BaDbAZ0BQGlmIChjb25maWdCb3QudGFncy5tZW51UG9ydGFsPy5zdWJzdHJpbmcoMCwyKSA9PSAiYWIiKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgogICAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwogICAgbWFza3Mub25LZXlEb3duID0gbnVsbDsKfScAoNWuuQX8oAEIcmVtZW1iZXICBACg1a65Bb7cASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCg1a65BfygAQ1tYW5pZmVzdGF0aW9uAgQAoNWuuQXl3AEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAoNWuuQX8oAERYWJFbnZpcm9ubWVudE1lbnUCBACg1a65BYzdAcESQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKY29uc3QgYWJNZW51SXRlbSA9IHsKICAgIGFiTWVudTogdHJ1ZSwKICAgIGFiTWVudVJlZnJlc2g6ICJAZGVzdHJveSh0aGlzQm90KTsiLAogICAgbWFuaWZlc3RhdGlvbjogdGFncy5tYW5pZmVzdGF0aW9uLAogICAgcmVtZW1iZXI6IHRhZ3MucmVtZW1iZXIsCiAgICBwZXJzb25hbGl0eTogdGFncy5wZXJzb25hbGl0eSwKICAgIGxlYXJuOiB0YWdzLmxlYXJuLAp9OwoKY29uc3QgYWJFbnZpcm9ubWVudE9wdGlvbnMgPSB0aGlzQm90LmFiR2V0RW52aXJvbm1lbnRPcHRpb25zKCk7IAoKZm9yIChsZXQgaSA9IDA7IGkgPCBhYkVudmlyb25tZW50T3B0aW9ucy5sZW5ndGg7IGkrKykgeyAKICAgIGNvbnN0IG9wdGlvbiA9IGFiRW52aXJvbm1lbnRPcHRpb25zW2ldOwoKICAgIGFzc2VydCh0eXBlb2Ygb3B0aW9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyID09PSAnbnVtYmVyJywgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9fV0gYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIgbXVzdCBiZSBhIG51bWJlci5gKTsKCiAgICBhYk1lbnVJdGVtLmFiTWVudVNvcnRPcmRlciA9IG9wdGlvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjsKCiAgICBjb25zdCBvcHRpb25Nb2QgPSB7Li4uYWJNZW51SXRlbSwgLi4ub3B0aW9ufTsKCiAgICBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2J1dHRvbicgfHwgIW9wdGlvbi5tZW51SXRlbVR5cGUpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAnZHJvcGRvd24nKSB7CiAgICAgICAgb3B0aW9uTW9kLmRyb3Bkb3duU29ydE9yZGVyID0gb3B0aW9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOwoKICAgICAgICAvLyBNYWtlIHN1cmUgZWFjaCBkcm9wZG93biBvcHRpb25zIGdldHMgYWJNZW51SXRlbSBkZWZhdWx0cy4KICAgICAgICBpZiAob3B0aW9uLmRyb3Bkb3duT3B0aW9ucyAmJiBvcHRpb24uZHJvcGRvd25PcHRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBvcHRpb24uZHJvcGRvd25PcHRpb25zLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICBvcHRpb24uZHJvcGRvd25PcHRpb25zW2tdID0geyAuLi5hYk1lbnVJdGVtLCAuLi5vcHRpb24uZHJvcGRvd25PcHRpb25zW2tdIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24ob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2dyb3VwJykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2lucHV0JykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ3RleHQnKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICd0b29sJykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAnd2l6YXJkJykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtZW51SXRlbVR5cGUgJHtvcHRpb24ubWVudUl0ZW1UeXBlfSBpcyBub3QgaW1wbGVtZW50ZWQuYCk7CiAgICAgICAgY29udGludWU7CiAgICB9Cn0KCi8vIHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJQZXJzb25hbGl0eUNvbmZpZ0J1dHRvbik7Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJFbnZpcm9ubWVudE1lbnUnLCB7IG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWx9ICknAKDVrrkF/KABBWxlYXJuAgQAoNWuuQXO7wEo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAoNWuuQX8oAEDZ3B0AgQAoNWuuQX17wEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAoNWuuQX8oAEIYWJJZ25vcmUCBACg1a65BZzwAQR0cnVlJwCg1a65BfygAQZzZWFyY2gCBACg1a65BaHwASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCg1a65BfygAQZudWdnZXQCBACg1a65BcjwASjwn5SXNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmJwCg1a65BfygAQV0ZXN0cwIEAKDVrrkF7/ABKPCflJdiODNkOTcyYi0wNTM1LTQwNTEtYjU4OS00MWNlZGE4NTM1ZjEnAKDVrrkF/KABA2FzawIEAKDVrrkFlvEBKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAKDVrrkF/KABCWFiVmVyc2lvbgIEAKDVrrkFvfEBBTEwLjM1JwCg1a65BfygARFhYkNyZWF0ZU1lbnVJbnB1dAIEAKDVrrkFw/EBngJAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudUlucHV0ID0gew0KICAgIGZvcm06ICJpbnB1dCIsDQogICAgbWVudUl0ZW1TaG93U3VibWl0V2hlbkVtcHR5OiBmYWxzZSwNCiAgICBmb3JtSW5wdXRNdWx0aWxpbmU6IG51bGwsDQogICAgb25Qb2ludGVyVXA6IG51bGwsDQogICAgb25Qb2ludGVyRG93bjogbnVsbCwNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUlucHV0KTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCg1a65BfygARBhYkNyZWF0ZU1lbnVUZXh0AgQAoNWuuQXi8wGBBEBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmNvbnN0IHsNCiAgICBtZW51SXRlbUxhYmVsU3R5bGUsDQogICAgLi4ucmVzdA0KfSA9IHRoYXQ7DQoNCmxldCBtZW51VGV4dCA9IHsNCiAgICBmb3JtOiAidGV4dCIsDQogICAgb25Qb2ludGVyVXA6IG51bGwsDQogICAgb25Qb2ludGVyRG93bjogbnVsbCwNCiAgICBwb2ludGFibGU6IGZhbHNlLA0KICAgIGNvbG9yOiAid2hpdGUiLA0KICAgIG1lbnVJdGVtU3R5bGU6IHsNCiAgICAgICAgInBhZGRpbmctdG9wIjogIjZweCIsDQogICAgICAgICJwYWRkaW5nLWJvdHRvbSI6ICI2cHgiLA0KICAgIH0sDQogICAgbWVudUl0ZW1MYWJlbFN0eWxlOiB7DQogICAgICAgICJ3aGl0ZS1zcGFjZSI6ICJwcmUtd3JhcCIsDQogICAgICAgIC4uLm1lbnVJdGVtTGFiZWxTdHlsZSwNCiAgICB9LA0KICAgIC4uLnJlc3QNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51VGV4dCk7DQoNCnJldHVybiBtZW51Qm90OycAoNWuuQX8oAEQYWJDcmVhdGVNZW51VG9vbAIEAKDVrrkF5PcBjgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVRvb2wgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUb29sKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCg1a65BfygARJhYkNyZWF0ZU1lbnVXaXphcmQCBACg1a65BfP4AZIBQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVXaXphcmQgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVXaXphcmQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAKDVrrkF/KABFGFiQ3JlYXRlTWVudURyb3Bkb3duAgQAoNWuuQWG+gG6HkBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICh0aGF0LmRyb3Bkb3duU29ydE9yZGVyID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudURyb3Bkb3duOiBkcm9wZG93blNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCBvdXRlck1lbnVCdXR0b24gPSB7DQogICAgLi4udGhhdCwNCiAgICBmb3JtQWRkcmVzczogdGhhdC5mb3JtQWRkcmVzcyA/PyAiYXJyb3dfcmlnaHQiLA0KICAgIGRyb3Bkb3duT3BlbjogZmFsc2UsDQogICAgb25DbGljazogYEANCiAgICAgICAgdGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gJHt0aGF0LmRyb3Bkb3duU29ydE9yZGVyfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gZmFsc2U7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyh0YWdzLmRyb3Bkb3duT3B0aW9ucywgdGFncy5kcm9wZG93blNvcnRPcmRlcik7DQogICAgICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkRlc3Ryb3k6IGBADQogICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgYCwNCiAgICBvblBvaW50ZXJVcDogYEANCiAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgbWFza3MuZm9ybUFkZHJlc3MgPSAiYXJyb3dfcmlnaHQiOw0KICAgICAgICB9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSBmYWxzZSkgew0KICAgICAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAiZm9ybUFkZHJlc3MiLCAiYXJyb3dfZHJvcF9kb3duIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJtZW51SXRlbVN0eWxlIiwgey4uLnRhZ3MubWVudUl0ZW1TdHlsZSwgImJvcmRlckJvdHRvbUxlZnRSYWRpdXMiOiAiMCIsICJib3JkZXJCb3R0b21SaWdodFJhZGl1cyI6ICIwIn0pOw0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkJvdENoYW5nZWQ6IGBADQogICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ2Ryb3Bkb3duT3BlbicpICYmIHRhZ3MuZHJvcGRvd25PcGVuID09IHRydWUpIHsNCiAgICAgICAgICAgIHNob3V0KCJhYk1lbnVEcm9wZG93bk9wZW5lZCIsIHRoaXNCb3QpOw0KICAgICAgICB9DQogICAgYCwNCiAgICBhYk1lbnVEcm9wZG93bk9wZW5lZDogYEANCiAgICAgICAgaWYgKHRhZ3MuaWdub3JlT3BlbkRyb3Bkb3duUnVsZXMgPT0gdHJ1ZSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGF0ICE9IHRoaXNCb3QpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobGlua3MgJiYgbGlua3MuYmFzZVNraWxsKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhhYi5saW5rcy5yZW1lbWJlciwgImxhc3RPcGVuZWREcm9wZG93biIsIHRhZ3MuYmFzZVNraWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGANCn07DQoNCmlmICh0aGF0LmZvcm1BZGRyZXNzICYmIHRoYXQuZm9ybUFkZHJlc3MgIT0gImFycm93X3JpZ2h0Iikgew0KICAgIG91dGVyTWVudUJ1dHRvbi5jdXN0b21Gb3JtQWRkcmVzcyA9IHRydWU7DQp9DQpvdXRlck1lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IHRoYXQuZHJvcGRvd25Tb3J0T3JkZXI7DQoNCmNvbnN0IG1lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihvdXRlck1lbnVCdXR0b24pOw0KbWVudUJvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMgPSBnZW5lcmF0ZU1lbnVPcHRpb25zOw0KDQphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZU1lbnVPcHRpb25zIChvcHRpb25zLCBzb3J0T3JkZXIpIHsNCiAgICBjb25zdCBtZW51Qm90cyA9IFtdOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7ICsraSkgew0KDQogICAgICAgIGxldCBuZXdNZW51QnV0dG9uID0gew0KICAgICAgICAgICAgLi4ub3B0aW9uc1tpXSwNCiAgICAgICAgICAgIGNsZWFyRHJvcGRvd25NZW51OiBgQA0KICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMDApOw0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoaSA9PSBvcHRpb25zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAgMCA4cHggOHB4IjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIDAgOHB4IDhweCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJUb3AiXSA9ICJub25lIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJtYXJnaW5Ub3AiXSA9ICIwIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJwYWRkaW5nTGVmdCJdID0gIjM1cHgiOw0KDQogICAgICAgIGNvbnN0IG5ld01lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCiAgICB9DQoNCiAgICBtZW51Qm90LnRhZ3MubWVudUJvdHMgPSBnZXRMaW5rKG1lbnVCb3RzKTsNCn0NCg0KaWYgKHRoYXQuZGVmYXVsdE9wZW4pIHsNCiAgICBtZW51Qm90Lm9uUG9pbnRlclVwKCk7DQogICAgbWVudUJvdC5vbkNsaWNrKCk7DQp9DQoNCnJldHVybiBtZW51Qm90Ow0KDQonAKDVrrkF/KABEWFiQ3JlYXRlTWVudUdyb3VwAgQAoNWuuQXBmAK9H0AvKg0KICAgRVhBTVBMRQ0KICAgY29uc3QgbWVudUdyb3VwID0gew0KICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBncm91cFNvcnRPcmRlcjogMSwNCiAgICAgICAgbWVudUl0ZW1zOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICBjb2xvcjogIm9yYW5nZSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgbWVudUl0ZW1UeXBlOiAiZHJvcGRvd24iLA0KICAgICAgICAgICAgICAgIGRyb3Bkb3duT3B0aW9uczogWw0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfQ0KKi8NCg0KaWYgICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0Lmdyb3VwU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVHcm91cDogZ3JvdXBTb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgew0KICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwNCiAgICBtZW51SXRlbXMgPSBbXSwNCiAgICAuLi5hZGRpdGlvbmFsVGFncw0KfSA9IHRoYXQgPz8ge30NCg0KY29uc3QgbWVudUJvdHMgPSBbXTsNCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudUl0ZW1zLmxlbmd0aDsgKytpKSB7DQoNCiAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9Ow0KDQogICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDApOw0KDQogICAgbGV0IGluZGl2TWVudUl0ZW1TdHlsZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVN0eWxlID8/IHt9Ow0KICAgIGxldCBpbmRpdk1lbnVUeXBlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtVHlwZSA/PyB1bmRlZmluZWQ7DQogICAgbGV0IGluZGl2QWRkaXRpb25hbFRhZ3MgPSBtZW51SXRlbXNbaV07DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdOw0KICAgIH0NCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdOw0KICAgIH0NCg0KICAgIGNvbnN0IGJhc2VTdHlsaW5nID0gew0KICAgICAgICAiYm9yZGVyVG9wIjogIm5vbmUiLA0KICAgICAgICAibWFyZ2luVG9wIjogIjAiDQogICAgfQ0KDQogICAgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEgJiYgaSA9PSAwKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfQ0KICAgIGVsc2UgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCAwIDhweCA4cHgiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfSBlbHNlIGlmIChpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjhweCA4cHggMCAwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nO30NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gaW5kaXZBZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGluZGl2QWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBsZXQgbmV3TWVudUJvdDsNCiAgICBzd2l0Y2goaW5kaXZNZW51VHlwZSkgew0KICAgICAgICBjYXNlICJkcm9wZG93biI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bigNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC4uLm5ld01lbnVCdXR0b24sDQogICAgICAgICAgICAgICAgICAgICJkcm9wZG93blNvcnRPcmRlciI6IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTApDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiaW5wdXQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidGV4dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRvb2wiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ3aXphcmQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICB9DQogICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCn0NCg0KcmV0dXJuIG1lbnVCb3RzOycAoNWuuQX8oAELcGVyc29uYWxpdHkCBACg1a65Bf+3Aijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwCg1a65BfygARdhYkdldEVudmlyb25tZW50T3B0aW9ucwIEAKDVrrkFprgCtntAY29uc3Qgb3B0aW9ucyA9IFtdOwoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogYGhpZGVgLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAidmlzaWJpbGl0eV9vZmYiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICB9KSwKICAgIH0pCn0KCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJzbGVlcCIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMCwKICAgICAgICBmb3JtQWRkcmVzczogIm5pZ2h0c19zdGF5IiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJTZXRBd2FrZSh7IGF3YWtlOiBmYWxzZSB9KQogICAgICAgIH0pLAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAib3B0aW1pemUgbW9kZSIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMjAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICB9KSwKICAgIHJlZnJlc2hEaXNwbGF5OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSBmYWxzZSA6IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gdHJ1ZTsKICAgICAgICB0aGlzQm90Lm9uQ3JlYXRlKCk7CiAgICB9KSwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImN1c3RvbWl6ZTogYWIgcGVyc29uYWxpdHkiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDMwMCwKICAgIG1lbnVJdGVtVHlwZTogJ2Ryb3Bkb3duJywKICAgIGRyb3Bkb3duT3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBuYW1lOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LCB7IHRpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB0byBjYWxsIG1lPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7IG5hbWU6IG5hbWUgfSk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBhaSBtb2RlbDogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbH1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVscyA9IGNvbmZpZ0JvdC50YWdzLmFpQ2hhdE1vZGVsczsKCiAgICAgICAgICAgICAgICBpZiAobW9kZWxzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IFtdOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIG1vZGVscykgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goeyBsYWJlbDogZW50cnkubmFtZSwgdmFsdWU6IGVudHJ5Lm5hbWUgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TW9kZWxJbmRleCA9IG9wdGlvbnMuZmluZEluZGV4KG8gPT4gby52YWx1ZSA9PT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IGF3YWl0IG9zLnNob3dJbnB1dChjdXJyZW50TW9kZWxJbmRleCwgewogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3doYXQgYWkgbW9kZWwgd291bGQgeW91IGxpa2UgbWUgdG8gdXNlPycsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaXN0JywKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IG9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE9wdGlvbiAmJiBzZWxlY3RlZE9wdGlvbi52YWx1ZSAhPT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBhaU1vZGVsOiBzZWxlY3RlZE9wdGlvbi52YWx1ZSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChhdXRoQm90KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnNob3dBbGVydCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3NvbWV0aGluZyB3ZW50IHdyb25nJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdmYWlsZWQgdG8gZ2V0IGxpc3Qgb2YgYWkgY2hhdCBtb2RlbHMuJwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnNob3dBbGVydCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3NpZ24gaW4gcmVxdWlyZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJ3lvdSBtdXN0IHNpZ24gaW4gdG8gdXNlIGFpLicKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBtZSB0byBiZT8nIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBjb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHsgdHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnVzIHRvIGJlPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7IG1lbnVDb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IHRleHQgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51TGFiZWxDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUxhYmVsQ29sb3IsIHsgdHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnUgdGV4dCB0byBiZT8nIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBtZW51TGFiZWxDb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBib3QgbGFiZWwgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBib3QgdGV4dCB0byBiZT8nIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBib3RMYWJlbENvbG9yOiBjb2xvciB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGRlZmF1bHQgcG9ydGFsIGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4J31gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGxldCBwb3J0YWxDb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyAnIzI2MzIzOCcsIHsgdHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IHdvdWxkIHlvdSBsaWtlIHlvdXIgcG9ydGFsIHRvIGxvb2sgbGlrZT8nIH0pOwogICAgICAgICAgICAgICAgaWYgKCFwb3J0YWxDb2xvcikgewogICAgICAgICAgICAgICAgICAgIHBvcnRhbENvbG9yID0gJyMyNjMyMzgnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyAncG9ydGFsQ29sb3InOiBwb3J0YWxDb2xvciB9KTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBtYXAgcG9ydGFsIGJhc2VtYXBgLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCJzaG93QUJCYXNlbWFwT3B0aW9ucyIpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJkZWZhdWx0IHNldHRpbmdzIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICAgICAgICAgIGNvbG9yOiAncmVkJywKICAgICAgICAgICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyAnZGVmYXVsdFBlcnNvbmFsaXR5JzogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICBdCn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJjaGF0IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA0MDAsCiAgICBmb3JtQWRkcmVzczogImNoYXQiLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHNob3V0KCdhYkNoYXRCYXJPcGVuJyk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICB9KSwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogIm51Z2dldHMiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDUwMCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGFncy5udWdNYW5hZ2VyID0gZ2V0TGluayhnZXRCb3QoJ3N5c3RlbScsICdhYi5pbnRlcmZhY2UubnVnZ2V0JykpOyAKICAgICAgICAKICAgICAgICBpZiAobGlua3MubnVnTWFuYWdlci50YWdzLmxpc3RlbmluZykgeyAKICAgICAgICAgICAgdGFncy5vbkNsaWNrID0gTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgCiAgICAgICAgICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIG51bGwpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGBjaGVja19ib3hgOyAKICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgICAgdGFncy5vbkNsaWNrID0gTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgCiAgICAgICAgICAgICAgICBpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgdHJ1ZSwgJ2xvY2FsJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveF9vdXRsaW5lX2JsYW5rYDsKICAgICAgICB9CiAgICB9KSwKfSkKCmlmIChsaW5rcy5wcmVzZW5jZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogImNhbWVyYSBwcmVzZW5jZSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDUxMCwKICAgICAgICBwcmVzZW5jZTogdGFncy5wcmVzZW5jZSwKICAgICAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQgPSAodGhhdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygnY2FtZXJhRW5hYmxlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5hZGRCb3RMaXN0ZW5lcihsaW5rcy5wcmVzZW5jZSwgJ29uQm90Q2hhbmdlZCcsIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCk7CgogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfSksCiAgICAgICAgcmVmcmVzaERpc3BsYXk6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgbGlua3MucHJlc2VuY2UudGFncy5jYW1lcmFFbmFibGVkID8gdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnIDogdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLnByZXNlbmNlLCAnY2FtZXJhRW5hYmxlZCcsICEhIWxpbmtzLnByZXNlbmNlLnRhZ3MuY2FtZXJhRW5hYmxlZCwgJ2xvY2FsJyk7CiAgICAgICAgfSksCiAgICAgICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIG9zLnJlbW92ZUJvdExpc3RlbmVyKGxpbmtzLnByZXNlbmNlLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkKTsKICAgICAgICB9KQogICAgfSkKCiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAiY3Vyc29yIHByZXNlbmNlIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNTIwLAogICAgICAgIHByZXNlbmNlOiB0YWdzLnByZXNlbmNlLAogICAgICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCA9ICh0aGF0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCdjdXJzb3JFbmFibGVkJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIG9zLmFkZEJvdExpc3RlbmVyKGxpbmtzLnByZXNlbmNlLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkKTsKCiAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB9KSwKICAgICAgICByZWZyZXNoRGlzcGxheTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBsaW5rcy5wcmVzZW5jZS50YWdzLmN1cnNvckVuYWJsZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MucHJlc2VuY2UsICdjdXJzb3JFbmFibGVkJywgISEhbGlua3MucHJlc2VuY2UudGFncy5jdXJzb3JFbmFibGVkLCAnbG9jYWwnKTsKICAgICAgICB9KSwKICAgICAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgb3MucmVtb3ZlQm90TGlzdGVuZXIobGlua3MucHJlc2VuY2UsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQpOwogICAgICAgIH0pCiAgICB9KQp9CgppZiAobGlua3MuZ3B0KSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNjAwLAogICAgICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGlmICghYXV0aEJvdCkgewogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAnRnJlZVBsYXknIHx8IGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdlZGl0ICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBwcm9tcHQnOyB0YWdzLmdwdEJvdCA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuYWN0aW9uLmFzaycpKTsKICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLmdwdEJvdC5lZGl0UHJvbXB0KCk7CiAgICAgICAgfSksCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJncmlkIHNuYXAiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDcwMCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnCiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZTsgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgfSksCn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJib3Qgc25hcCIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogODAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZTsgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICB9KSwKfSkKCmlmIChhdXRoQm90KSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAiYWNjb3VudCIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDkwMCwKICAgICAgICBmb3JtQWRkcmVzczogImJhZGdlIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIG9zLnNob3dBY2NvdW50SW5mbygpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIH0pLAogICAgfSkKfQoKaWYgKGxpbmtzLnRlc3RzKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAicmVjb3JkIHRlc3QiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMDAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAic2NpZW5jZSIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBzaG91dCgnYWJSZWNvcmRUZXN0Jyk7CiAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfSksCiAgICB9KQoKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdHJhY2UiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMTAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAidGltZWxpbmUiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgc2hvdXQoJ2FiUmVjb3JkVHJhY2UnKTsKICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9KSwKICAgIH0pCn0KCmlmIChnZXRCb3QoInN5c3RlbSIsICJhYi5ob21lLmVnZyIpKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAic2F2ZSBob21lIGVnZyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEyMDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJlZ2ciLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaG9tZS5lZ2ciKS5zYXZlRGF0YSgpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIH0pLAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiY2hlY2sgZm9yICIgKyBhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiB1cGRhdGVzIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMzAwLAogICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgIGxlYXJuOiB0YWdzLmxlYXJuLAogICAgY2hlY2tGb3JVcGRhdGVzOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgLy8gVGVtcG9yYXJpbHkgcmVwbGFjZSB3aXRoIGJ1c3kgaW5kaWNhdG9yIHdoaWxlIGNoZWNraW5nIGZvciB1cGRhdGVzLgogICAgICAgIHRhZ3MuYWJNZW51ID0gZmFsc2U7CgogICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gYWIubGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yKHsKICAgICAgICAgICAgYWJNZW51OiB0cnVlLAogICAgICAgICAgICBsYWJlbDogJ2NoZWNraW5nIGZvciB1cGRhdGVzIHRvICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgIGFiTWVudVNvcnRPcmRlcjogdGFncy5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlciwKICAgICAgICB9KTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sgPSBhd2FpdCBhYi5hYkNoZWNrQUJVcGRhdGVBdmFpbGFibGUoeyBkZXRhaWxlZDogdHJ1ZSB9KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IgPSBudWxsOwoKICAgICAgICAgICAgLy8gQnJpbmcgYmFjayB0aGUgdXBkYXRlIGJ1dHRvbi4KICAgICAgICAgICAgdGFncy5hYk1lbnUgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrICYmIHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgaWYgKGdsb2JhbFRoaXMuYWJVcGRhdGVDaGVja2VyKSB7CiAgICAgICAgICAgICAgICBhYlVwZGF0ZUNoZWNrZXIudGFncy51cGRhdGVBdmFpbGFibGUgPSB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay51cGRhdGVBdmFpbGFibGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay51cGRhdGVBdmFpbGFibGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFiRmlsZXNXaXRoVXBkYXRlcyA9IHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLmFiRmlsZUNoZWNrcy5maWx0ZXIoZiA9PiBmLnVwZGF0ZUF2YWlsYWJsZSk7CgogICAgICAgICAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVXBkYXRlcyBmb3VuZCBmb3IgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnVGhlcmUgYXJlICcgKyBhYkZpbGVzV2l0aFVwZGF0ZXMubGVuZ3RoICsgJyBmaWxlIHVwZGF0ZXMgZm9yICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnLiBXb3VsZCB5b3UgbGlrZSB0byBpbnN0YWxsIHRoZSB1cGRhdGVzIG5vdz8gWW91IGFuZCBhbnkgY29ubmVjdGVkIHVzZXJzIHdpbGwgYXV0b21hdGljYWxseSByZWZyZXNoIHRoZSBwYWdlIGFmdGVyIHRoZSB1cGRhdGUgaXMgY29tcGxldGUuJywKICAgICAgICAgICAgICAgICAgICBjYW5jZWxUZXh0OiAnTm90IG5vdycsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybVRleHQ6ICdZZXMnCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgICAgICAgICBsaW5rcy5sZWFybi51cGRhdGVBQigpOwogICAgICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhYi5saW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgaXMgYWxyZWFkeSB1cC10by1kYXRlIScpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSAndXBkYXRlIGNoZWNrIGZhaWxlZCc7CiAgICAgICAgfQogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGhpc0JvdC5jaGVja0ZvclVwZGF0ZXMoKTsKICAgIH0pLAogICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpOwogICAgICAgIH0KICAgIH0pLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAicGVybWFuZW50bHkgZGVsZXRlIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA5OTk5LAogICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzLmxhYmVsICs9ICIgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7CiAgICAgICAgdGFncy5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29udHJhc3RDb2xvciA/PyAiI0Q5MzAzMCI7CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICBjb25zdCBjb25maXJtZWQgPSBhd2FpdCBvcy5zaG93Q29uZmlybSh7CiAgICAgICAgICAgIHRpdGxlOiAnUGVybWFuZW50bHkgZGVsZXRlICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICBjb250ZW50OiAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgZnJvbSAnICsgbGlua3MubGVhcm4udGFncy5hYkluc3QgKyAnPyBUaGlzIGlzIG5vdCByZXZlcnNpYmxlIScsCiAgICAgICAgfSkKCiAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKCiAgICAgICAgY29uc3QgYWJCb3RzID0gZ2V0Qm90cygoYikgPT4gewogICAgICAgICAgICByZXR1cm4gYi5zcGFjZSA9PT0gJ3NoYXJlZCcgJiYKICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0gJiYKICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0uc3RhcnRzV2l0aCgnYWInKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGNvbmZpcm1lZCkgewogICAgICAgICAgICBkZXN0cm95KGFiQm90cyk7CiAgICAgICAgfQogICAgfSksCn0pCgpyZXR1cm4gb3B0aW9uczsnAKDVrrkF/KABHmFiQ3JlYXRlVG9vbGJveERyb3Bkb3duT3B0aW9ucwIEAKDVrrkF3bMD4xNAY29uc3QgdG9vbGJveFRvb2xzID0gWy4uLnRoYXQudG9vbEFycmF5XSA/PyBbXTsNCmNvbnN0IHRvb2xib3hOYW1lID0gdGhhdC50b29sYm94TmFtZSA/PyAiS2l0ICI7DQpjb25zdCB0b29sYm94ID0gdGhhdC50b29sYm94Ow0KY29uc3QgZ3JpZEluZm9ybWF0aW9uID0gKHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiAmJiB0aGF0Py5ncmlkSW5mb3JtYXRpb24gIT0gdW5kZWZpbmVkKSA/IHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiA6IGFiUmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsNCg0KY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy50b29sYm94ID0gZ2V0TGluayh0b29sYm94KTsNCm1lbnVPcHRpb25zLmdyaWRJbmZvcm1hdGlvbiA9IGdyaWRJbmZvcm1hdGlvbjsNCm1lbnVPcHRpb25zLnNlYXJjaCA9IHRhZ3Muc2VhcmNoOw0KbWVudU9wdGlvbnMuYXJ0aWZhY3QgPSB0YWdzLmFydGlmYWN0Ow0KLy9tZW51T3B0aW9ucy5mb3JtQWRkcmVzcyA9ICJoYXJkd2FyZSI7DQoNCmlmICh0b29sYm94VG9vbHMubGVuZ3RoID09PSAwKSB7DQogICAgY29uc3QgbWVzc2FnZSA9IHRvb2xib3hOYW1lICsgIiBkb2VzIG5vdCBoYXZlIGFueSB0b29scyBsaXN0ZWQgaW4gdGhlIHRvb2xfYXJyYXkgdGFnIjsNCg0KICAgIGFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgbWVzc2FnZSk7DQogICAgb3MudG9hc3QobWVzc2FnZSwgNSk7DQogICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsNCn0NCg0KZm9yIChsZXQgdG9vbCBvZiB0b29sYm94VG9vbHMpIHsNCiAgICBjb25zdCB0b29sQnV0dG9uID0gew0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgbGFiZWw6IHRvb2wubmFtZSwNCiAgICAgICAgdGFyZ2V0QUI6IHRvb2wudGFyZ2V0QUIsDQogICAgICAgIGlzQXJ0aWZhY3Q6IHRvb2wuYXJ0aWZhY3QgfHwgZmFsc2UsDQogICAgICAgIG9uQ2xpY2s6YEANCiAgICAgICAgICAgIGlmICh0YWdzLmlzQXJ0aWZhY3QpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBhYkFydGlmYWN0U2hhcmQgPSB7DQogICAgICAgICAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiB0YWdzLnRvb2xib3gsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB0YWdzLmdyaWRJbmZvcm1hdGlvbg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXM6IFsNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc2tJRDogdGFncy50YXJnZXRBQg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBsaW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0UHJvbWlzZUJvdCh7DQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3ROYW1lOiB0YWdzLnRhcmdldEFCLA0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0SW5zdGFuY2VJRDogdXVpZCgpLA0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0U2hhcmQsDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQXNrSUQoew0KICAgICAgICAgICAgICAgICAgICBhc2tJRDogdGFncy50YXJnZXRBQiwNCiAgICAgICAgICAgICAgICAgICAgc291cmNlRXZlbnQ6ICd0b29sJywNCiAgICAgICAgICAgICAgICAgICAgZWdnUGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJveEJvdDogdGFncy50b29sYm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB0YWdzLmdyaWRJbmZvcm1hdGlvbg0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICB9DQogICAgICAgIGAsDQogICAgfTsNCg0KICAgIGlmICh0b29sLmZvcm1BZGRyZXNzKSB7DQogICAgICAgIHRvb2xCdXR0b24uZm9ybUFkZHJlc3MgPSB0b29sLmZvcm1BZGRyZXNzOw0KICAgIH0NCg0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHRvb2xCdXR0b24pOw0KfQ0KDQpyZXR1cm4gZHJvcGRvd25PcHRpb25zOycAoNWuuQX8oAEQb25BQkF1dGhCb3RBZGRlZAIEAKDVrrkFwccDGEBzaG91dCgnYWJNZW51UmVmcmVzaCcpOycAoNWuuQX8oAEIYXJ0aWZhY3QCBACg1a65BdrHAyjwn5SXNzhlNDE1MDMtYzkzMy00ZjhhLTgxN2EtYmE5N2JmOGQ1ZDI3JwEEYm90cyRjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcBJwCg1a65BYHIAxVhYkNyZWF0ZUN1YmVGYWNlUGxhbmUCBACg1a65BYLIA4kxQGxldCB7IAogICAgYm90LAogICAgZGltZW5zaW9uLAogICAgc3BhY2UgPSAndGVtcExvY2FsJywKICAgIGRlYnVnLAogICAgZmFjZU9mZnNldCA9IDAuMDEsCiAgICBwb2ludGFibGUgPSBmYWxzZSwKICAgIHRpY2tJbnRlcnZhbE1TID0gNTAwLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fTsKCmFzc2VydChsaW5rcy51dGlscy5pc0JvdChib3QpLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGJvdCBpcyBhIHJlcXVpcmVkIEJvdCBwYXJhbWV0ZXIuYCk7CmFzc2VydChkaW1lbnNpb24sIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uIGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyLmApOwphc3NlcnQocmVzdC5mb3JtID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZm9ybSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3QuYW5jaG9yUG9pbnQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhbmNob3JQb2ludCBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25Cb3RBZGRlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwoKY29uc3QgZmFjZVBsYW5lTW9kID0gewogICAgc3BhY2UsCiAgICBhbmNob3JQb2ludDogJ2NlbnRlcicsCiAgICBkZWJ1ZywKICAgIGZhY2VPZmZzZXQsCiAgICBmb3JtOiAnc3ByaXRlJywKICAgIGRpbWVuc2lvbiwKICAgIFtkaW1lbnNpb25dOiB0cnVlLAogICAgcG9pbnRhYmxlLAogICAgdGlja0ludGVydmFsTVMsCiAgICB0cmFuc2Zvcm1lcjogYm90LmlkLAogICAgb25Cb3RBZGRlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRoaXNCb3Quc3RhcnRUaWNrKCk7CiAgICB9KSwKICAgIG9uQm90Q2hhbmdlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ3RpY2tJbnRlcnZhbE1TJykpIHsKICAgICAgICAgICAgdGhpc0JvdC5zdG9wVGljaygpOwogICAgICAgICAgICB0aGlzQm90LnN0YXJ0VGljaygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygndHJhbnNmb3JtZXInKSkgewogICAgICAgICAgICBpZiAoIXRhZ3MudHJhbnNmb3JtZXIpIHsKICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KSwKICAgIG9uQW55Qm90c1JlbW92ZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGFncy50cmFuc2Zvcm1lcikgewogICAgICAgICAgICBpZiAodGhhdC5ib3RJRHMuaW5jbHVkZXModGFncy50cmFuc2Zvcm1lcikpIHsKICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KSwKICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRoaXNCb3Quc3RvcFRpY2soKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBkZXN0cm95ZWRgKTsKICAgICAgICB9CiAgICB9KSwKICAgIHNldERpbWVuc2lvbjogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbnN0IGRpbWVuc2lvbiA9IHRoYXQ7CgogICAgICAgIGlmICh0YWdzLmRpbWVuc2lvbiAhPT0gZGltZW5zaW9uKSB7CiAgICAgICAgICAgIC8vIFJlbW92ZSBmcm9tIHByZXZpb3VzIGRpbWVuc2lvbi4KICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBudWxsOwogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1Bvc2l0aW9uJ10gPSBudWxsOwogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1JvdGF0aW9uJ10gPSBudWxsOwoKICAgICAgICAgICAgaWYgKGRpbWVuc2lvbikgewogICAgICAgICAgICAgICAgLy8gQXNzaWduIHRvIG5ldyBkaW1lbnNpb24uCiAgICAgICAgICAgICAgICB0YWdzLmRpbWVuc2lvbiA9IGRpbWVuc2lvbjsKICAgICAgICAgICAgICAgIHRhZ3NbZGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfSksCiAgICBzdGFydFRpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAobWFza3MudGlja0ludGVydmFsSWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbWFza3MudGlja0ludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB3aGlzcGVyKHRoaXNCb3QsICd0aWNrJyksIHRhZ3MudGlja0ludGVydmFsTVMpOwogICAgICAgIHRoaXNCb3QudGljaygpOwogICAgfSksCiAgICBzdG9wVGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmIChtYXNrcy50aWNrSW50ZXJ2YWxJZCkgewogICAgICAgICAgICBjbGVhckludGVydmFsKG1hc2tzLnRpY2tJbnRlcnZhbElkKTsKICAgICAgICAgICAgbWFza3MudGlja0ludGVydmFsSWQgPSBudWxsOwogICAgICAgIH0KICAgIH0pLAogICAgdGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbnN0IExPQ0FMX05PUk1BTFMgPSBbCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDEsIDAsIDApLCAvLyArWAogICAgICAgICAgICBuZXcgVmVjdG9yMygtMSwgMCwgMCksIC8vIC1YCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAsIDEsIDApLCAvLyArWQogICAgICAgICAgICBuZXcgVmVjdG9yMygwLCAtMSwgMCksIC8vIC1ZCiAgICAgICAgXQoKICAgICAgICBjb25zdCBMT0NBTF9QT1NJVElPTlMgPSBbCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAuNSArIHRhZ3MuZmFjZU9mZnNldCwgMCwgLTAuNSksIC8vICtYCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKC0wLjUgLSB0YWdzLmZhY2VPZmZzZXQsIDAsIC0wLjUpLCAvLyAtWAogICAgICAgICAgICBuZXcgVmVjdG9yMygwLCAwLjUgKyB0YWdzLmZhY2VPZmZzZXQsIC0wLjUpLCAvLyArWQogICAgICAgICAgICBuZXcgVmVjdG9yMygwLCAtMC41IC0gdGFncy5mYWNlT2Zmc2V0LCAtMC41KSwgLy8gLVkKICAgICAgICBdCgogICAgICAgIGNvbnN0IEhBTEZfUEkgPSBNYXRoLlBJIC8gMjsKCiAgICAgICAgY29uc3QgTE9DQUxfUk9UQVRJT05TID0gWwogICAgICAgICAgICBuZXcgUm90YXRpb24oeyBldWxlcjogeyB4OiBIQUxGX1BJLCB5OiBIQUxGX1BJLCB6OiAwIH19KSwgLy8gK1gKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogSEFMRl9QSSwgeTogLUhBTEZfUEksIHo6IDAgfX0pLCAvLyAtWAogICAgICAgICAgICBuZXcgUm90YXRpb24oeyBldWxlcjogeyB4OiAtSEFMRl9QSSwgeTogMCwgejogTWF0aC5QSSB9fSksIC8vICtZCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IEhBTEZfUEksIHk6IDAsIHo6IDAgfX0pLCAvLyAtWQogICAgICAgIF0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IHRoZSBmYWNlIHBsYW5lIHRvIGJlIG9uIHRoZSBnaXZlbiBmYWNlIGluZGV4LiAgCiAgICAgICAgICogMDogK1gsICAKICAgICAgICAgKiAxOiAtWCwgIAogICAgICAgICAqIDI6ICtZLCAgCiAgICAgICAgICogMzogLVkKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBzZXRQbGFuZUZhY2UoZmFjZUluZGV4KSB7CiAgICAgICAgICAgIG1hc2tzW3RhZ3MuZGltZW5zaW9uICsgJ1Bvc2l0aW9uJ10gPSBMT0NBTF9QT1NJVElPTlNbZmFjZUluZGV4XTsKICAgICAgICAgICAgbWFza3NbdGFncy5kaW1lbnNpb24gKyAnUm90YXRpb24nXSA9IExPQ0FMX1JPVEFUSU9OU1tmYWNlSW5kZXhdOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBkaW1lbnNpb246YCwgdGFncy5kaW1lbnNpb24pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0YWdzLmRpbWVuc2lvbikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBwYXJlbnRQb3NpdGlvbiA9IGdldEJvdFBvc2l0aW9uKHRhZ3MudHJhbnNmb3JtZXIsIHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBwYXJlbnQgcG9zaXRpb246YCwgcGFyZW50UG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgbGV0IGdyaWRQb3J0YWxUeXBlOiAnZ3JpZCcgfCAnbWluaUdyaWQnIHwgbnVsbCA9IG51bGw7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgewogICAgICAgICAgICBncmlkUG9ydGFsVHlwZSA9ICdncmlkJzsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgewogICAgICAgICAgICBncmlkUG9ydGFsVHlwZSA9ICdtaW5pR3JpZCc7CiAgICAgICAgfQoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGRldGVjdGVkIGdyaWQgcG9ydGFsIHR5cGU6YCwgZ3JpZFBvcnRhbFR5cGUpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFncmlkUG9ydGFsVHlwZSkgewogICAgICAgICAgICBzZXRQbGFuZUZhY2UoMCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGNhbWVyYVBvc2l0aW9uID0gb3MuZ2V0Q2FtZXJhUG9zaXRpb24oZ3JpZFBvcnRhbFR5cGUpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGNhbWVyYSBwb3NpdGlvbjpgLCBjYW1lcmFQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkaXJlY3Rpb25Ub0NhbWVyYSA9IGNhbWVyYVBvc2l0aW9uLnN1YnRyYWN0KHBhcmVudFBvc2l0aW9uKS5ub3JtYWxpemUoKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBkaXJlY3Rpb24gdG8gY2FtZXJhOmAsIGRpcmVjdGlvblRvQ2FtZXJhKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBhcmVudFJvdGF0aW9uID0gZ2V0Qm90Um90YXRpb24odGFncy50cmFuc2Zvcm1lciwgdGFncy5kaW1lbnNpb24pOwogICAgICAgIGNvbnN0IHdvcmxkTm9ybWFsczogVmVjdG9yM1tdID0gbmV3IEFycmF5KDQpOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsc1tpXSA9IHBhcmVudFJvdGF0aW9uLnJvdGF0ZVZlY3RvcjMoTE9DQUxfTk9STUFMU1tpXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIHdvcmxkIG5vcm1hbHM6YCwgd29ybGROb3JtYWxzKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gRmluZCB0aGUgZmFjZSBtb3N0IGZhY2luZyB0aGUgY2FtZXJhIChtYXggZG90IHByb2R1Y3QpLiAKICAgICAgICBsZXQgYmVzdEluZGV4ID0gMDsgCiAgICAgICAgbGV0IGJlc3REb3QgPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFk7IAogICAgICAgIAogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29ybGROb3JtYWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGRvdCA9IHdvcmxkTm9ybWFsc1tpXS5kb3QoZGlyZWN0aW9uVG9DYW1lcmEpOwogICAgICAgICAgICBpZiAoZG90ID4gYmVzdERvdCkgewogICAgICAgICAgICAgICAgYmVzdERvdCA9IGRvdDsgCiAgICAgICAgICAgICAgICBiZXN0SW5kZXggPSBpOyAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBiZXN0IGZhY2UgaW5kZXg6YCwgYmVzdEluZGV4KTsKICAgICAgICB9CgogICAgICAgIHNldFBsYW5lRmFjZShiZXN0SW5kZXgpOwogICAgfSksCiAgICAuLi5yZXN0Cn0KCmNvbnN0IGZhY2VQbGFuZUJvdCA9IGNyZWF0ZShmYWNlUGxhbmVNb2QpOwoKcmV0dXJuIGZhY2VQbGFuZUJvdDsnAKDVrrkFgcgDCGFiSWdub3JlAgQAoNWuuQWM+QMEdHJ1ZScAoNWuuQWByAMLYWJJbnRlcmZhY2UCBACg1a65BZH5AwR0cnVlJwCg1a65BYHIAwZzeXN0ZW0CBACg1a65BZb5AxhhYi5pbnRlcmZhY2UuYm90X2ZhY3RvcnknAKDVrrkFgcgDFmFiQ3JlYXRlQmlsbGJvYXJkTGFiZWwCBACg1a65Ba/5A41FQGxldCB7IAogICAgYm90LAogICAgZGltZW5zaW9uLAogICAgcHJlc2VydmVOZXdMaW5lcyA9IHRydWUsCiAgICBsYWJlbCA9ICcnLAogICAgc3BhY2UgPSAndGVtcExvY2FsJywKICAgIGNvbG9yID0gJ3doaXRlJywKICAgIGxhYmVsQ29sb3IgPSAnYmxhY2snLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fTsKCmlmICh0eXBlb2YgbGFiZWwgIT09ICdzdHJpbmcnKSB7CiAgICBsYWJlbCA9IFN0cmluZyhsYWJlbCk7Cn0KCmFzc2VydChsaW5rcy51dGlscy5pc0JvdChib3QpLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGJvdCBpcyBhIHJlcXVpcmVkIEJvdCBwYXJhbWV0ZXIuYCk7CmFzc2VydChkaW1lbnNpb24sIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uIGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyLmApOwphc3NlcnQocmVzdC5vbkNyZWF0ZSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkFueUJvdHNDaGFuZ2VkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQW55Qm90c1JlbW92ZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3QudXBkYXRlTGFiZWwgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3QubGFiZWxXb3JkV3JhcE1vZGUgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBsYWJlbFdvcmRXcmFwTW9kZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKCi8vIC0tLSAxKSBXb3JkIGJyZWFraW5nICh3cmFwIGJ5IHdvcmRzLCBjaHVuayBsb25nIHdvcmRzKSAtLS0KZnVuY3Rpb24gYnJlYWtXb3Jkc1RvTGluZXModGV4dCwgbWF4Q29scyA9IDE4KSB7CiAgICBpZiAoIXRleHQpIHJldHVybiBbJyddOwogICAgY29uc3Qgd29yZHMgPSB0ZXh0LnNwbGl0KC9ccysvKS5maWx0ZXIoQm9vbGVhbik7CiAgICBjb25zdCBsaW5lcyA9IFtdOwogICAgbGV0IGxpbmUgPSAnJzsKCiAgICBjb25zdCBwdXNoID0gKCkgPT4geyBsaW5lcy5wdXNoKGxpbmUpOyBsaW5lID0gJyc7IH07CgogICAgZm9yIChjb25zdCB3IG9mIHdvcmRzKSB7CiAgICAgICAgaWYgKHcubGVuZ3RoID4gbWF4Q29scykgewogICAgICAgICAgICAvLyBjbG9zZSBjdXJyZW50IGxpbmUgKGlmIGFueSkgYmVmb3JlIGNodW5raW5nIGEgbG9uZyB3b3JkCiAgICAgICAgICAgIGlmIChsaW5lKSBwdXNoKCk7CiAgICAgICAgICAgIC8vIGNodW5rIHRoZSBsb25nIHdvcmQKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3Lmxlbmd0aDsgaSArPSBtYXhDb2xzKSB7CiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKHcuc2xpY2UoaSwgaSArIG1heENvbHMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsaW5lID0gJyc7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIWxpbmUubGVuZ3RoKSB7CiAgICAgICAgICAgIGxpbmUgPSB3OwogICAgICAgIH0gZWxzZSBpZiAobGluZS5sZW5ndGggKyAxICsgdy5sZW5ndGggPD0gbWF4Q29scykgewogICAgICAgICAgICBsaW5lICs9ICcgJyArIHc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHVzaCgpOwogICAgICAgICAgICBsaW5lID0gdzsKICAgICAgICB9CiAgICB9CiAgICBpZiAobGluZS5sZW5ndGgpIHB1c2goKTsKCiAgICByZXR1cm4gbGluZXMubGVuZ3RoID8gbGluZXMgOiBbJyddOwp9CgovLyBQcmVzZXJ2ZXMgZXhpc3RpbmcgXG4gYXMgaGFyZCBicmVha3M7IHdyYXBzIHdpdGhpbiBlYWNoIGhhcmQgbGluZS4KZnVuY3Rpb24gYnJlYWtXb3Jkc1RvTGluZXNQcmVzZXJ2ZU5ld2xpbmVzKHRleHQsIG1heENvbHMgPSAxOCkgewogIGlmICh0ZXh0ID09IG51bGwpIHJldHVybiBbJyddOwoKICAvLyBTcGxpdCBvbiByZWFsIG5ld2xpbmVzOyBrZWVwIGVtcHR5IGxpbmVzIHNvIHdlIHByZXNlcnZlIGJsYW5rIGxpbmVzLgogIGNvbnN0IGhhcmRMaW5lcyA9IFN0cmluZyh0ZXh0KS5zcGxpdCgvXHI/XG4vKTsKICBjb25zdCBvdXQgPSBbXTsKCiAgLy8gSGVscGVyIHRvIHdyYXAgYSBzaW5nbGUgaGFyZCBsaW5lIGJ5IHdvcmRzICh3aXRoIGxvbmctd29yZCBjaHVua2luZykKICBjb25zdCB3cmFwT25lID0gKHNyYykgPT4gewogICAgLy8gTm9ybWFsaXplIHRhYnMgLT4gc3BhY2VzOyBjb2xsYXBzZSBpbnRlcm5hbCB3aGl0ZXNwYWNlIChub3QgbmV3bGluZXMpCiAgICBjb25zdCBzID0gc3JjLnJlcGxhY2UoL1x0L2csICcgICAgJykucmVwbGFjZSgvXHMrL2csICcgJykudHJpbSgpOwogICAgaWYgKCFzLmxlbmd0aCkgeyBvdXQucHVzaCgnJyk7IHJldHVybjsgfQoKICAgIGNvbnN0IHdvcmRzID0gcy5zcGxpdCgnICcpOwogICAgbGV0IGxpbmUgPSAnJzsKCiAgICBjb25zdCBwdXNoTGluZSA9ICgpID0+IHsgb3V0LnB1c2gobGluZSk7IGxpbmUgPSAnJzsgfTsKCiAgICAvLyBjaHVuayBsb25nIHdvcmRzIHRvIGVtdWxhdGUgJ2JyZWFrV29yZHMnCiAgICBjb25zdCBjaHVua1dvcmQgPSAodykgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcubGVuZ3RoOyBpICs9IG1heENvbHMpIHsKICAgICAgICBjb25zdCBjaHVuayA9IHcuc2xpY2UoaSwgaSArIG1heENvbHMpOwogICAgICAgIGlmICghbGluZS5sZW5ndGgpIGxpbmUgPSBjaHVuazsKICAgICAgICBlbHNlIHsgcHVzaExpbmUoKTsgbGluZSA9IGNodW5rOyB9CiAgICAgIH0KICAgIH07CgogICAgZm9yIChjb25zdCB3IG9mIHdvcmRzKSB7CiAgICAgIGlmICh3Lmxlbmd0aCA+IG1heENvbHMpIHsKICAgICAgICBpZiAobGluZS5sZW5ndGgpIHB1c2hMaW5lKCk7CiAgICAgICAgY2h1bmtXb3JkKHcpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghbGluZS5sZW5ndGgpIHsKICAgICAgICBsaW5lID0gdzsKICAgICAgfSBlbHNlIGlmIChsaW5lLmxlbmd0aCArIDEgKyB3Lmxlbmd0aCA8PSBtYXhDb2xzKSB7CiAgICAgICAgbGluZSArPSAnICcgKyB3OwogICAgICB9IGVsc2UgewogICAgICAgIHB1c2hMaW5lKCk7CiAgICAgICAgbGluZSA9IHc7CiAgICAgIH0KICAgIH0KICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaExpbmUoKTsKICB9OwoKICBmb3IgKGNvbnN0IGhsIG9mIGhhcmRMaW5lcykgewogICAgd3JhcE9uZShobCk7ICAgICAgICAgICAvLyB3cmFwIHdpdGhpbiB0aGlzIGhhcmQgbGluZQogIH0KCiAgLy8gSWYgdGhlIGlucHV0IGVuZGVkIHdpdGggYSB0cmFpbGluZyBuZXdsaW5lLCB3ZSBhbHJlYWR5IHByZXNlcnZlZCBpdAogIC8vIGJlY2F1c2Ugc3BsaXQga2VwdCBhbiBlbXB0eSBsYXN0IGl0ZW0gLT4gYmVjYW1lIGFuIGVtcHR5IHdyYXBwZWQgbGluZS4KICByZXR1cm4gb3V0Lmxlbmd0aCA/IG91dCA6IFsnJ107Cn0KCi8vIC0tLSAyKSBTaW1wbGUgc2l6aW5nIGZyb20gbGluZXMgLS0tCi8vIFRoaW5rIG9mICJjb2xzUGVyU2NhbGVYIiBhcyAiYWJvdXQgTiBjaGFyYWN0ZXJzIHBlciAxIHNjYWxlWCIuCmZ1bmN0aW9uIGNvbXB1dGVTaW1wbGVTY2FsZXNGcm9tTGluZXMobGluZXMsIHsKICAgIGNvbHNQZXJTY2FsZVggPSAyLjUsCiAgICBtaW5TY2FsZVggPSAxLjI1LAogICAgbWF4U2NhbGVYID0gMTAsCiAgICBiYXNlU2NhbGVZID0gMS4yLAogICAgcGVyTGluZVkgPSAwLjc1LAp9ID0ge30pIHsKICAgIGNvbnN0IGxvbmdlc3QgPSBsaW5lcy5yZWR1Y2UoKG0sIGwpID0+IE1hdGgubWF4KG0sIGwubGVuZ3RoKSwgMCk7CiAgICBjb25zdCBsaW5lQ291bnQgPSBNYXRoLm1heCgxLCBsaW5lcy5sZW5ndGgpOwoKICAgIC8vIFdpZHRoIHNjYWxlcyB3aXRoIHRoZSBsb25nZXN0IGxpbmUgbGVuZ3RoCiAgICBsZXQgc2NhbGVYID0gbG9uZ2VzdCA+IDAgPyAobG9uZ2VzdCAvIGNvbHNQZXJTY2FsZVgpIDogbWluU2NhbGVYOwogICAgc2NhbGVYID0gTWF0aC5tYXgobWluU2NhbGVYLCBNYXRoLm1pbihtYXhTY2FsZVgsIHNjYWxlWCkpOwoKICAgIC8vIEhlaWdodCBncm93cyBwZXIgbGluZTsga2VlcCBpdCBzaW1wbGUgYW5kIHByZWRpY3RhYmxlCiAgICBjb25zdCBzY2FsZVkgPSBNYXRoLm1heChiYXNlU2NhbGVZLCBiYXNlU2NhbGVZICsgKGxpbmVDb3VudCAtIDEpICogcGVyTGluZVkpOwoKICAgIHJldHVybiB7IHNjYWxlWCwgc2NhbGVZLCBsb25nZXN0LCBsaW5lQ291bnQgfTsKfQoKCi8vIFBpY2sgeW91ciB0YXJnZXQgImNvbHVtbnMiIHBlciBsaW5lICh0d2VhayB0byB0YXN0ZSkKY29uc3QgTUFYX0NPTFMgPSAzMjsKCi8vIEJyZWFrIHRoZSB0ZXh0IHlvdXJzZWxmCmNvbnN0IGxpbmVzID0gcHJlc2VydmVOZXdMaW5lcyA/IGJyZWFrV29yZHNUb0xpbmVzUHJlc2VydmVOZXdsaW5lcyhsYWJlbCwgTUFYX0NPTFMpIDogYnJlYWtXb3Jkc1RvTGluZXMobGFiZWwsIE1BWF9DT0xTKTsKY29uc3Qgd3JhcHBlZExhYmVsID0gbGluZXMuam9pbignXG4nKTsKCi8vIENvbXB1dGUgc2ltcGxlIHNjYWxlcyBmcm9tIHRoZSB3cmFwcGVkIHRleHQKY29uc3QgeyBzY2FsZVgsIHNjYWxlWSB9ID0gY29tcHV0ZVNpbXBsZVNjYWxlc0Zyb21MaW5lcyhsaW5lcyk7CgpsZXQgbGFiZWxNb2QgPSB7CiAgICBzcGFjZTogc3BhY2UsCiAgICB0cmFja0JvdElkOiBib3QuaWQsCiAgICBmb3JtOiAnc3ByaXRlJywKICAgIGNvbG9yLAogICAgbGFiZWw6IHdyYXBwZWRMYWJlbCwKICAgIGxhYmVsQ29sb3IsCiAgICBsYWJlbFNpemU6IDEsCiAgICBsYWJlbFBhZGRpbmdYOiAwLjUsCiAgICBsYWJlbFdvcmRXcmFwTW9kZTogJ25vbmUnLAogICAgc2NhbGVYLCAKICAgIHNjYWxlWSwKICAgIHNjYWxlWjogMC4xLAogICAgYm90TGFiZWxNYXJnaW46IDEsCiAgICBhbmNob3JQb2ludDogJ+Keoe+4jzAsLTAuNSwwJywKICAgIG9yaWVudGF0aW9uTW9kZTogJ2JpbGxib2FyZCcsCiAgICBkaW1lbnNpb246IGRpbWVuc2lvbiwKICAgIGRlYnVnOiBmYWxzZSwKICAgIFtkaW1lbnNpb25dOiB0cnVlLAogICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgIG9uQ3JlYXRlOiBgQAogICAgICAgIC8vIFdhaXQgZm9yIHJlcXVpcmVkIGJvdHMgdG8gYmUgcmVhZHkuCiAgICAgICAgbGV0IHdhaXRUaW1lID0gMDsKCiAgICAgICAgd2hpbGUoIWdsb2JhbFRoaXMuYWIpIHsKICAgICAgICAgICAgaWYgKHdhaXRUaW1lID49IDUwMDApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXdhaXQgb3Muc2xlZXAoMjUwKTsKICAgICAgICAgICAgd2FpdFRpbWUgKz0gMjUwOwogICAgICAgIH0KCiAgICAgICAgdGFncy5yZWFkeSA9IHRydWU7CiAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgYCwKICAgIG9uQW55Qm90c0NoYW5nZWQ6IGBACiAgICAgICAgZm9yIChjb25zdCBjaGFuZ2VkIG9mIHRoYXQpIHsKICAgICAgICAgICAgaWYgKGNoYW5nZWQuYm90ICYmIGNoYW5nZWQuYm90LmlkID09PSB0YWdzLnRyYWNrQm90SWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9ubHlSb3RhdGlvblRhZ3MgPSBjaGFuZ2VkLnRhZ3MuZXZlcnkoKHQpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5lbmRzV2l0aCgnUm90YXRpb24nKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblgnKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblknKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblonKQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gb25seVJvdGF0aW9uVGFnczonLCBvbmx5Um90YXRpb25UYWdzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAob25seVJvdGF0aW9uVGFncykgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICBgLAogICAgb25BbnlCb3RzUmVtb3ZlZDogYEAKCiAgICAgICAgaWYgKHRoYXQuYm90SURzLmluY2x1ZGVzKHRhZ3MudHJhY2tCb3RJZCkpIHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICB9CiAgICBgLAogICAgb25Qb3J0YWxDaGFuZ2VkOiBgQAogICAgICAgIGlmICh0aGF0LmRpbWVuc2lvbiA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgICAgIH0KICAgIGAsCiAgICB1cGRhdGVMYWJlbDogYEAKICAgICAgICBpZiAoIXRhZ3MucmVhZHkpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmluZyB1cGRhdGVMYWJlbCBiZWNhdXNlIG5vdCByZWFkeScpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaGFzTGFiZWwgPSB0YWdzLmxhYmVsICE9IG51bGwgJiYgdGFncy5sYWJlbCAhPT0gJyc7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBoYXNMYWJlbDsKCiAgICAgICAgaWYgKCFoYXNMYWJlbCkgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmUgdXBkYXRlTGFiZWwgY2FsbCwgdGhlcmUgaXMgbm8gbGFiZWwgdGFnIHZhbHVlIHRvIGRpc3BsYXkuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGluTWFwUG9ydGFsID0gKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGNvbnN0IGluR3JpZFBvcnRhbCA9IChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAoIWluTWFwUG9ydGFsICYmICFpbkdyaWRQb3J0YWwpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JlIHVwZGF0ZUxhYmVsIGNhbGwsIG5vdCBpbiBlaXRoZXIgZ3JpZCBvciBtYXAgcG9ydGFsLicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHRyYWNrQm90ID0gZ2V0Qm90KCdpZCcsIHRhZ3MudHJhY2tCb3RJZCk7CiAgICAgICAgY29uc3QgdHJhY2tQb3NpdGlvbiA9IGdldEJvdFBvc2l0aW9uKHRyYWNrQm90LCB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gdHJhY2tQb3NpdGlvbjonLCB0cmFja1Bvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGxldCBsYWJlbFBvc2l0aW9uID0geyB4OiB0cmFja1Bvc2l0aW9uLngsIHk6IHRyYWNrUG9zaXRpb24ueSwgejogdHJhY2tQb3NpdGlvbi56IH07IAoKICAgICAgICBjb25zdCB0cmFja0JvdFNjYWxlID0gdHJhY2tCb3QudGFncy5zY2FsZSA/PyAxOwogICAgICAgIGNvbnN0IHRyYWNrQm90U2NhbGVaID0gdHJhY2tCb3QudGFncy5zY2FsZVogPz8gMTsKCiAgICAgICAgbGV0IG1ldGVyc1BlckdyaWRVbml0ID0gMTsKCiAgICAgICAgaWYgKGluTWFwUG9ydGFsKSB7CiAgICAgICAgICAgIC8vIFNjYWxlIHRvIG1hcCBwb3J0YWwgdW5pdHMuCiAgICAgICAgICAgIG1ldGVyc1BlckdyaWRVbml0ID0gMTA7CiAgICAgICAgfQoKICAgICAgICBsZXQgdHJhY2tCb3RSZWFsU2NhbGVaID0gKHRyYWNrQm90U2NhbGVaICogdHJhY2tCb3RTY2FsZSkgKiBtZXRlcnNQZXJHcmlkVW5pdDsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSB0cmFja0JvdFJlYWxTY2FsZVo6JywgdHJhY2tCb3RSZWFsU2NhbGVaKTsKICAgICAgICB9CgogICAgICAgIGxhYmVsUG9zaXRpb24ueiArPSB0cmFja0JvdFJlYWxTY2FsZVogKyAodGFncy5ib3RMYWJlbE1hcmdpbiAqIG1ldGVyc1BlckdyaWRVbml0KTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBsYWJlbFBvc2l0aW9uOicsIGxhYmVsUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdYJ10gPSBsYWJlbFBvc2l0aW9uLng7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdZJ10gPSBsYWJlbFBvc2l0aW9uLnk7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdaJ10gPSBsYWJlbFBvc2l0aW9uLno7CiAgICBgCn07CgpsYWJlbE1vZCA9IHsKICAgIC4uLmxhYmVsTW9kLAogICAgLi4ucmVzdCwKfQoKY29uc3QgbGFiZWxCb3QgPSBjcmVhdGUobGFiZWxNb2QpOwoKcmV0dXJuIGxhYmVsQm90OycAoNWuuQWByAMFdXRpbHMCBACg1a65Bbm+BCjwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwCg1a65BYHIAwRmb3JtAgQAoNWuuQXgvgQHbm90aGluZycAoNWuuQWByAMJYWJWZXJzaW9uAgQAoNWuuQXovgQFMTAuMzUA"}]}