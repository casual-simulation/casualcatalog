{"version":2,"updates":[{"id":0,"timestamp":1759169491054,"update":"AewBkJWrjgEAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwCQlauOAQAKYWJJRE9yaWdpbgIEAJCVq44BAQ10b29sYm94X3NraWxsJwCQlauOAQALYWJJbnRlcmZhY2UCBACQlauOAQ8EdHJ1ZScAkJWrjgEAC2Rlc2NyaXB0aW9uAgQAkJWrjgEUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwCQlauOAQAEZm9ybQIEAJCVq44BPgdub3RoaW5nJwCQlauOAQAEbWVudQIEAJCVq44BRijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCQlauOAQAGc3lzdGVtAgQAkJWrjgFtFGFiLmludGVyZmFjZS50b29sYm94JwCQlauOAQAKYWJJRFN0dWRpbwIEAJCVq44BggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwCQlauOAQAIcmVtZW1iZXICBACQlauOAacBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJCVq44BAAt0b29sYm94X2FkZAIEAJCVq44BzgHlC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgiYmFzZVNraWxsIiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIG1lbnVCb3Qub25Qb2ludGVyVXAoKTsKICAgICAgICBhd2FpdCBvcy5zbGVlcCgyMDApOwogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScAkJWrjgEABWxlYXJuAgQAkJWrjgG0DSjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCQlauOAQAFc3RvcmUCBACQlauOAdsNKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAJCVq44BAAZzZWFyY2gCBACQlauOAYIOKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAJCVq44BAAhhYklnbm9yZQIEAJCVq44BqQ4EdHJ1ZScAkJWrjgEACWFiVmVyc2lvbgIEAJCVq44Brg4FMTAuMTAnAJCVq44BAA1tYW5pZmVzdGF0aW9uAgQAkJWrjgG0Dijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCQlauOAQAQYWJHcmlkTWVudUFjdGlvbgIEAJCVq44B2w65C0AvLyBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKLy8gY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCi8vIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAovLyAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKLy8gICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyBgOwovLyB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACi8vICAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewovLyAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7Ci8vICAgICB9Ci8vIGA7Ci8vIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IGBACi8vICAgICB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKLy8gICAgIHRoaXNCb3QubWFza3Mub25LZXlEb3duID0gbnVsbDsKLy8gICAgIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IG51bGw7Ci8vIGA7CgovLyBjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKLy8gY29uc3QgbWVudUJvdCA9IHt9OwoKLy8gbWVudUJvdC5hYk1lbnUgPSB0cnVlOwovLyBtZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Ci8vIG1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwovLyBtZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwovLyBtZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOwovLyBtZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247Ci8vIG1lbnVCb3Qub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIudG9vbGJveF9hZGQoe3Rvb2xib3hEYXRhOiB0YWdzLnRvb2xib3hfZGF0YSwgZ3JpZERhdGE6IHRhZ3MuZ3JpZERhdGF9KTsgc2hvdXQoImFiTWVudVJlZnJlc2giKTtgOwoKLy8gZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykKLy8gewovLyAgICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOwovLyAgICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsKCi8vICAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7Ci8vICAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7CgovLyAgICAgaWYgKCFleHRhbnRCb3QpCi8vICAgICB7Ci8vICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJvdCk7Ci8vICAgICB9Ci8vIH0nAJCVq44BABRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAJCVq44BlRriAkBjb25zdCB0b29sYm94QXJyYXkgPSBhYlJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKCmxldCBhbGxUb29sc0xvYWRlZCA9IHRydWU7Cgpmb3IgKGxldCBpID0gMDsgaSA8IHRvb2xib3hBcnJheS5sZW5ndGg7IGkrKykgewogICAgY29uc3QgY3VycmVudFRvb2wgPSB0b29sYm94QXJyYXlbaV0ubmFtZTsKCiAgICBpZiAoIWdldEJvdCgiYWJJRE9yaWdpbiIsIGN1cnJlbnRUb29sKSAmJiAhZ2V0Qm90KGN1cnJlbnRUb29sLCB0cnVlKSkgewogICAgICAgIGFsbFRvb2xzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChhbGxUb29sc0xvYWRlZCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfScAkJWrjgEADmFiR3JpZE1lbnVJY29uAgQAkJWrjgH4HApsb2NhbF9tYWxsJwCQlauOAQAPYWJHcmlkTWVudUxhYmVsAgQAkJWrjgGDHQ5jYXN1YWwgY2F0YWxvZycAkJWrjgEAE2FiR3JpZE1lbnVTb3J0T3JkZXICBACQlauOAZIdATMnAJCVq44BAA9vbkFCSW5pdGlhbGl6ZWQCBACQlauOAZQdKkAvLyBsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOycAkJWrjgEADW9uU2tpbGxVcGRhdGUCBACQlauOAb8dV0BsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOw0KDQpjb25zb2xlLmxvZygiW1Rvb2xib3hdIExvYWRpbmcgY2FzdWFsIGtpdCIpOycAkJWrjgEACnNoZWxsVXRpbHMCBACQlauOAZceKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAJCVq44BABhhYkdyaWRNZW51T25CZWZvcmVDcmVhdGUCBACQlauOAb4e/AhAaWYgKGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSkgew0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiR3JpZE1lbnVMYWJlbCIsIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSk7DQp9DQoNCg0KLy9ORVcNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsNCg0KZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykNCnsNCiAgICBjb25zdCBtZW51Qm90ID0ge307DQoNCiAgICBtZW51Qm90LmFiTWVudSA9IHRydWU7DQogICAgbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KICAgIG1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOw0KICAgIG1lbnVCb3QubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7DQogICAgbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsNCiAgICBtZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247DQogICAgbWVudUJvdC5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7DQogICAgDQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7DQogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOw0KDQogICAgaWYgKCFleHRhbnRCb3QpDQogICAgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtZW51Qm90KTsNCiAgICB9DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAkJWrjgEAEmFiR3JpZE1lbnVJdGVtVHlwZQIEAJCVq44BuycIZHJvcGRvd24nAJCVq44BABFkcm9wZG93blNvcnRPcmRlcgIEAJCVq44BxCcBMycAkJWrjgEAD2Ryb3Bkb3duT3B0aW9ucwIEAJCVq44BxicG8J+nrFtdJwEEYm90cyQxNzQxMGQ4My03ZWVlLTRhMWUtYjYzOC02NTQ2Mzc0ZDE3YzMBJwCQlauOAcsnBnN5c3RlbQIEAJCVq44BzCcRYWIuaW50ZXJmYWNlLnNjYW4nAJCVq44ByycEZm9ybQIEAJCVq44B3icHbm90aGluZycAkJWrjgHLJwthYkludGVyZmFjZQIEAJCVq44B5icEdHJ1ZScAkJWrjgHLJwhhYklnbm9yZQIEAJCVq44B6ycEdHJ1ZScAkJWrjgHLJw9vblFSQ29kZVNjYW5uZWQCBACQlauOAfAngA5AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgppZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhc2siKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKHRoYXQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5hc2spIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hc2t9KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5wYXR0ZXJufSk7CiAgICAgICAgfQogICAgICAgIAogICAgfQp9JwCQlauOAcsnBXN0b3JlAgQAkJWrjgHxNSjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCQlauOAcsnBnNlYXJjaAIEAJCVq44BmDYo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAkJWrjgHLJxBhYkNvcmVNZW51QWN0aW9uAgQAkJWrjgG/NjdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwCQlauOAcsnD2FiQ29yZU1lbnVMYWJlbAIEAJCVq44B9zYEc2NhbicAkJWrjgHLJw5hYkNvcmVNZW51SWNvbgIEAJCVq44B/DYPcXJfY29kZV9zY2FubmVyJwCQlauOAcsnE2FiQ29yZU1lbnVTb3J0T3JkZXICBACQlauOAYw3ATMnAJCVq44ByycJYWJWZXJzaW9uAgQAkJWrjgGONwUxMC4xMCcBBGJvdHMkM2E2Y2I5Y2EtYjNiNC00ZDc3LTgyZjYtZmE1OWI1Mjk2ZWM5AScAkJWrjgGUNwZzeXN0ZW0CBACQlauOAZU3F2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwCQlauOAZQ3CGFiSWdub3JlAgQAkJWrjgGtNwR0cnVlJwCQlauOAZQ3D2Ryb3Bkb3duT3B0aW9ucwIEAJCVq44BsjcG8J+nrFtdJwCQlauOAZQ3EmFiQ29yZU1lbnVJdGVtVHlwZQIEAJCVq44BtzcIZHJvcGRvd24nAJCVq44BlDcRZHJvcGRvd25Tb3J0T3JkZXICBACQlauOAcA3BGF1dG8nAJCVq44BlDcYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQAkJWrjgHFN/4gQGNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCmNvbnN0IGN1cnJlbnRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyAibWFwIiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT0gImJsdWVwcmludCIgPyAiYmx1ZXByaW50IiA6ImdyaWQiOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCi8vIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQovLyB9IGVsc2Ugew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCi8vIH0NCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTmF2aWdhdGlvbk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCg0KY29uc3QgaG9tZVdvcmxkQnV0dG9uID0gew0KICAgIC4uLm1lbnVPcHRpb25zLA0KICAgIGxhYmVsOiAiaG9tZSB3b3JsZCIsDQogICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvMzhhZThiNjk1N2Y0NDgzZDg3MTYxNDFkMWU5OGM5M2YwZTdkY2NlMTViYzVjMTIzYmQwZTllMWFiNjg3Y2MwNS5wbmcnLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIGNvbnN0IGN1cnJlbnRVUkwgPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCk7DQogICAgICAgIGNvbnN0IG9yaWdpbiA9IGN1cnJlbnRVUkwub3JpZ2luOw0KDQogICAgICAgIGxldCBuZXdVUkwgPSBuZXcgVVJMKG9yaWdpbik7DQoNCiAgICAgICAgaWYgKGFiUmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY2hhbm5lbCIsIGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb25maWdCb3QudGFncy5jb21JZCkgew0KICAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImNvbUlkIiwgY29uZmlnQm90LnRhZ3MuY29tSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm93bmVyIiwgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiAicGxheWVyIik7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJpbnN0IiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm1hcFBvcnRhbCIsICdob21lJyk7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJhc2siLCAnaG9tZScpOw0KICAgICAgICANCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgew0KICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgic3R1ZGlvIiwgdGhhdC5pZCk7IA0KICAgICAgICB9DQoNCiAgICAgICAgb3Mub3BlblVSTChuZXdVUkwuaHJlZik7DQogICAgYA0KfTsNCg0KaWYgKCFnZXRCb3QoImlzSG9tZVdvcmxkQ29yZSIsIHRydWUpICYmIGF1dGhCb3QpIHsNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lV29ybGRCdXR0b24pOw0KfQ0KDQppZiAoY3VycmVudFBvcnRhbCA9PSAnbWFwJykgew0KDQogICAgY29uc3QgaG9tZUJhc2VCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQoNCiAgICBpZiAoaG9tZUJhc2VCb3QpIHsNCiAgICAgICAgY29uc3QgaG9tZUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhvbWVCYXNlQm90LnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1L2NkMzhhZmZjMDYwNGJlYWE1ODhkYTIxYWExYmU3NTBiYjNlNzNiM2IzY2FlMjNlYjMwMzA3YzM0NDk0NDU5ZjMucG5nJywNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgY29uc3QgaG9tZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBpZiAoaG9tZUJvdCkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGhvbWVCb3QsIHsgem9vbTogMjAwMCB9KS5jYXRjaCgoKSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZUJ1dHRvbik7DQogICAgfQ0KDQogICAgY29uc3QgcGxhY2VzQXJyID0gW107DQogICAgY29uc3QgcGxhY2VzID0gZ2V0Qm90cygiaG9tZVBsYWNlIiwgdHJ1ZSk7DQogICAgZm9yIChjb25zdCBoUGxhY2Ugb2YgcGxhY2VzKSB7DQogICAgICAgIGlmIChoUGxhY2UudGFncy5ob21lQmFzZSA9PSB0cnVlKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBwbGFjZU9iaiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhQbGFjZS50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2xvY2F0aW9uX29uJywNCiAgICAgICAgICAgIHBsYWNlOiBnZXRMaW5rKGhQbGFjZSksDQogICAgICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgICAgIGlmIChsaW5rcy5wbGFjZSkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGxpbmtzLnBsYWNlLCB7IHpvb206IDIwMDAgfSkuY2F0Y2goZSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICAgICAgYA0KICAgICAgICB9DQoNCiAgICAgICAgcGxhY2VzQXJyLnB1c2gocGxhY2VPYmopOw0KICAgIH0NCg0KICAgIHBsYWNlc0Fyci5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgIGNvbnN0IG5hbWVBID0gYS5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KICAgICAgICBjb25zdCBuYW1lQiA9IGIubGFiZWwudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMDsNCiAgICB9KTsNCg0KICAgIGZvciAoY29uc3Qgc29ydGVkUGxhY2Ugb2YgcGxhY2VzQXJyKSB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHNvcnRlZFBsYWNlKTsNCiAgICB9DQoNCg0KICAgIGNvbnN0IGN1cnJlbnRMb2NhdGlvbkJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiAnY3VycmVudCBsb2NhdGlvbicsDQogICAgICAgIGZvcm1BZGRyZXNzOiAnbmVhcl9tZScsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5za2lsbEJvdC5nb1RvQ3VycmVudExvY2F0aW9uKCk7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goY3VycmVudExvY2F0aW9uQnV0dG9uKTsNCn0NCg0KaWYgKGRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPT0gMCkgew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KfSBlbHNlIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAkJWrjgGUNxBhYkNvcmVNZW51QWN0aW9uAgQAkJWrjgHEWANALy8nAJCVq44BlDcLYWJJbnRlcmZhY2UCBACQlauOAchYBHRydWUnAJCVq44BlDcPYWJDb3JlTWVudUxhYmVsAgQAkJWrjgHNWAlwbGFjZSBuYXYnAJCVq44BlDcEZm9ybQIEAJCVq44B11gHbm90aGluZycAkJWrjgGUNxNnb1RvQ3VycmVudExvY2F0aW9uAgQAkJWrjgHfWIAEQGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgb3MuZ2V0R2VvbG9jYXRpb24oKTsNCg0KaWYgKGxvY2F0aW9uLnN1Y2Nlc3MpIHsNCiAgICBjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCiAgICBjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCg0KICAgIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IGN1cnJlbnREaW07DQogICAgfQ0KDQogICAgb3MuZm9jdXNPbih7eDogbG9jYXRpb24ubG9uZ2l0dWRlLCB5OiBsb2NhdGlvbi5sYXRpdHVkZX0sIHtwb3J0YWw6ICdtYXAnLCB6b29tOiAyMDAwfSk7DQp9IGVsc2Ugew0KICAgIG9zLnRvYXN0KCJMb2NhdGlvbiBzZXJ2aWNlcyBub3QgYXZhaWxhYmxlIikNCn0nAJCVq44BlDcJYWJWZXJzaW9uAgQAkJWrjgHgXAUxMC4xMCcBBGJvdHMkNDkzZmZhNGQtNDZkNC00YTk4LWFlOWMtMTIxMmQ2NTExMzNmAScAkJWrjgHmXAZzeXN0ZW0CBACQlauOAedcFGFiLmludGVyZmFjZS52ZXJzaW9uJwCQlauOAeZcDW9uU2tpbGxVcGRhdGUCBACQlauOAfxcpwFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJJbnRlcmZhY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiSW50ZXJmYWNlTWlub3JWZXJzaW9uOw0KDQpjb25zb2xlLmxvZygiW0FCSW50ZXJmYWNlXSBMb2FkZWQgQUIgSW50ZXJmYWNlIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAkJWrjgHmXBdhYkludGVyZmFjZU1ham9yVmVyc2lvbgIEAJCVq44BpF4BMicAkJWrjgHmXBdhYkludGVyZmFjZU1pbm9yVmVyc2lvbgIEAJCVq44Bpl4BNycAkJWrjgHmXAhhYklnbm9yZQIEAJCVq44BqF4EdHJ1ZScAkJWrjgHmXARmb3JtAgQAkJWrjgGtXgdub3RoaW5nJwCQlauOAeZcC2FiSW50ZXJmYWNlAgQAkJWrjgG1XgR0cnVlJwCQlauOAeZcCWFiVmVyc2lvbgIEAJCVq44Bul4FMTAuMTAnAQRib3RzJDRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZgEnAJCVq44BwF4Gc3lzdGVtAgQAkJWrjgHBXhNhYi5pbnRlcmZhY2UubnVnZ2V0JwCQlauOAcBeBGZvcm0CBACQlauOAdVeB25vdGhpbmcnAJCVq44BwF4LYWJJbnRlcmZhY2UCBACQlauOAd1eBHRydWUnAJCVq44BwF4IYWJJZ25vcmUCBACQlauOAeJeBHRydWUnAJCVq44BwF4MYWJMb2FkTnVnZ2V0AgQAkJWrjgHnXpgCQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXROYW1lOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrbnVnZ2V0TmFtZTsKbGV0IGxvYWRlZE51Z2dldCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogZm9ybWF0dGVkTnVnZ2V0QUIsIGFiVmVyc2lvbjogdGhhdC52ZXJzaW9uLCByZXR1cm5UeXBlOiAiZGF0YSJ9KTsKCmxvYWRlZE51Z2dldCA9IGxvYWRlZE51Z2dldC5zdGF0ZVtudWdnZXROYW1lXS5udWdnZXQ7CgpyZXR1cm4gbG9hZGVkTnVnZ2V0OycAkJWrjgHAXg9hYlB1Ymxpc2hOdWdnZXQCBACQlauOAYBhjANALy9zaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogIm51Z05hbWUiLCBkYXRhOiBkYXRhfSk7ICBBREQgRUdHIElEIEVWRU5UVUFMTFkKbGV0IHRlc3ROdWdnZXQgPSB0aGF0LmRhdGE7CmxldCBmb3JtYXR0ZWROdWdnZXQgPSB7aWQ6IHRoYXQubnVnLCBudWdnZXQ6IHRlc3ROdWdnZXR9OwpsZXQgdGVzdE51Z2dldE5hbWUgPSB0aGF0Lm51ZzsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK3Rlc3ROdWdnZXROYW1lOwoKbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gZm9ybWF0dGVkTnVnZ2V0QUI7CgpsaW5rcy5zdG9yZS5hYlB1Ymxpc2hBQih7YWI6IGZvcm1hdHRlZE51Z2dldEFCLCB0YXJnZXQ6IGZvcm1hdHRlZE51Z2dldCwgc291cmNlRXZlbnQ6ICdwdWJsaXNoX251Z2dldCd9KTsnAJCVq44BwF4PaW1wbGVtZW50TnVnZ2V0AgQAkJWrjgGNZLEHQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXQ7CmxldCBudWdnZXRWZXJzaW9uQ2hlY2sgPSBudWdnZXROYW1lLmluZGV4T2YoIi52Iik7CmxldCB2ZXJzaW9uOwoKaWYgKG51Z2dldFZlcnNpb25DaGVjayAhPSAtMSkKewogICAgbnVnZ2V0TmFtZSA9IG51Z2dldE5hbWUuc3Vic3RyaW5nKDAsIG51Z2dldFZlcnNpb25DaGVjayk7CgogICAgbGV0IHZlcnNpb25DaGVjayA9IHRoYXQubnVnZ2V0LnN1YnN0cmluZyhudWdnZXRWZXJzaW9uQ2hlY2sgKyAyKTsKCiAgICBpZiAoaXNOYU4odmVyc2lvbkNoZWNrKSkKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyh2ZXJzaW9uQ2hlY2ssICJ2ZXJzaW9uIGlzIG5vdCBhIG51bWJlciIpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHZlcnNpb24gPSBOdW1iZXIodmVyc2lvbkNoZWNrKTsKICAgIH0KfQpjb25zb2xlLmxvZyhudWdnZXROYW1lLCB2ZXJzaW9uKTsKbGV0IG51Z0RhdGEgPSBhd2FpdCB0aGlzQm90LmFiTG9hZE51Z2dldCh7bnVnZ2V0TmFtZTogbnVnZ2V0TmFtZSwgdmVyc2lvbjogdmVyc2lvbn0pOwoKaWYgKG51Z0RhdGEgPT0gImFiSUQgbm90IGZvdW5kIikKewogICAgb3MudG9hc3QoIm51Z2dldCBub3QgZm91bmQiKTsKfQplbHNlCnsKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwogICAgbGV0IHRhcmdldFRhZyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLnRvU3RyaW5nKCk7CiAgICBsZXQgdGFyZ2V0TnVnID0gInsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldFRhZy5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwogICAgaW5zZXJ0VGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIG51Z0RhdGEpOwp9JwCQlauOAcBeDG51Z2dldEJ1dHRvbgIEAJCVq44Bv2v1DEBsZXQgdGFnVmFsdWUgPSB0aGF0LnRhZ1ZhbHVlOwpsZXQgcmVnZXggPSAvXG4vZ2k7CmxldCBicmVha0NoZWNrOwpsZXQgYnJlYWtBcnJheSA9IFswXTsKLy9sZXQgY3JlYXRlZEJ1dHRvbnMgPSBbXTsKCndoaWxlIChicmVha0NoZWNrID0gcmVnZXguZXhlYyh0YWdWYWx1ZSkpCnsKICAgIGJyZWFrQXJyYXkucHVzaChicmVha0NoZWNrLmluZGV4KTsKfQoKbGV0IG5ld051Z2dldEJ1dHRvbiA9IHt9OwoKbmV3TnVnZ2V0QnV0dG9uLnNwYWNlID0gInRlbXBMb2NhbCI7Cm5ld051Z2dldEJ1dHRvbi5mb3JtID0gImNvZGVCdXR0b24iOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0Qm90ID0gdGhhdC5ib3QuaWQ7Cm5ld051Z2dldEJ1dHRvbi50YXJnZXRUYWcgPSB0aGF0LnRhZzsKbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgbnVnZ2V0IjsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldFJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpuZXdOdWdnZXRCdXR0b25bdGhhdC5ib3QuaWQgKyAiLiIgKyB0aGF0LnRhZ10gPSB0cnVlOwpuZXdOdWdnZXRCdXR0b24ubnVnZ2V0TWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7Cm5ld051Z2dldEJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubnVnZ2V0TWFuYWdlci5pbXBsZW1lbnROdWdnZXQoe2JvdDogdGFncy50YXJnZXRCb3QsIG51Z2dldDogdGFncy50YXJnZXROdWdnZXQsIHRhZzogdGFncy50YXJnZXRUYWd9KTsKCmRlc3Ryb3kodGhpc0JvdCk7YDsKCmZvciAobGV0IG51Z3MgPSAwOyBudWdzIDwgdGhhdC5udWdnZXQubGVuZ3RoOyBudWdzKyspCnsKICAgIGxldCBjdXJyZW50TnVnZ2V0ID0gdGhhdC5udWdnZXRbbnVnc107CiAgICAvL2xldCBidXR0b25DaGVjayA9IGNyZWF0ZWRCdXR0b25zLmluZGV4T2YoY3VycmVudE51Z2dldC5udWdOYW1lKTsKCiAgICBpZiAoIWN1cnJlbnROdWdnZXQgfHwgY3VycmVudE51Z2dldCA9PSB1bmRlZmluZWQpIC8vfHwgYnV0dG9uQ2hlY2sgIT0gLTEKICAgIHsKICAgICAgICBjb250aW51ZTsKICAgIH0KCiAgICBpZiAoY3VycmVudE51Z2dldC5udWdQdWJsaXNoKQogICAgewogICAgICAgIG5ld051Z2dldEJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubnVnZ2V0TWFuYWdlci5wYWNrYWdlTnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgogICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7YDsKCiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAibG9hZCAiICsgY3VycmVudE51Z2dldC5udWdOYW1lICsgIiBudWdnZXQiOwogICAgfQoKICAgIG5ld051Z2dldEJ1dHRvbi50YXJnZXROdWdnZXQgPSBjdXJyZW50TnVnZ2V0Lm51Z05hbWU7CiAgICBuZXdOdWdnZXRCdXR0b25bdGhhdC5ib3QuaWQgKyAiLiIgKyB0aGF0LnRhZyArICJTdGFydCJdID0gY3VycmVudE51Z2dldC5udWdTdGFydDsKCiAgICBjcmVhdGUobmV3TnVnZ2V0QnV0dG9uKTsKCiAgICAvL2NyZWF0ZWRCdXR0b25zLnB1c2goY3VycmVudE51Z2dldC5udWdOYW1lKTsKfQoKcmV0dXJuOycAkJWrjgHAXgtudWdnZXRQYXJzZQIEAJCVq44Bs3inD0Bjb25zdCBvcmlnaW5hbFRhZ1ZhbHVlID0gdGhhdC5lZGl0ZWRCb3QucmF3W3RoYXQuZWRpdGVkVGFnXTsKbGV0IHRhZ1ZhbHVlID0gb3JpZ2luYWxUYWdWYWx1ZTsKCmlmICghdGFnVmFsdWUpIAp7CiAgICByZXR1cm47Cn0KZWxzZSBpZiAodHlwZW9mIHRhZ1ZhbHVlICE9PSAic3RyaW5nIikgCnsKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUudG9TdHJpbmcoKTsKfQoKbGV0IGluaXRpYWxQb3NzaWJsZU51Z1BvcyA9IDA7CgppZiAoaW5pdGlhbFBvc3NpYmxlTnVnUG9zID09IC0xKSAKewogICAgcmV0dXJuOwp9CmVsc2UKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbFBvc3NpYmxlTnVnUG9zKTsKfQoKbGV0IHBvc3NpYmxlTnVncyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW157XS9nLCAiIikubGVuZ3RoOwpsZXQgdG90YWxOdWdCcmVha3MgPSBvcmlnaW5hbFRhZ1ZhbHVlLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CmxldCBicmVha0xldmVsID0gMDsKbGV0IG51Z3NUb0NoZWNrID0gW107Cgpmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlTnVnczsgaSsrKQp7CiAgICBsZXQgaW5pdGlhbE51Z1BvcyA9IHRhZ1ZhbHVlLmluZGV4T2YoInsiKSArIDE7CiAgICBsZXQgcG9zc2libGVOdWdFbmQgPSB0YWdWYWx1ZS5pbmRleE9mKCJ9Iik7CiAgICBsZXQgcG9zc2libGVOdWcgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcywgcG9zc2libGVOdWdFbmQpOwoKICAgIGlmIChwb3NzaWJsZU51Zy5pbmRleE9mKCIgIikgPT0gLTEgJiYgL1xuL2cudGVzdChwb3NzaWJsZU51ZykgIT0gdHJ1ZSAmJiBwb3NzaWJsZU51Zy5sZW5ndGggPiAwICYmIHBvc3NpYmxlTnVnLmluZGV4T2YoIjoiKSA9PSAtMSkKICAgIHsKICAgICAgICBsZXQgbnVnQnJlYWtzID0gdGFnVmFsdWUuc3Vic3RyaW5nKDAsIHRhZ1ZhbHVlLmluZGV4T2YoInsiK3Bvc3NpYmxlTnVnKyJ9IikpLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CiAgICAgICAgbGV0IHB1Ymxpc2hDaGVjayA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zIC0gNiwgaW5pdGlhbE51Z1BvcyAtIDIpOwogICAgICAgIGxldCBudWdQdWJsaXNoID0gbnVsbDsKCiAgICAgICAgaWYgKHB1Ymxpc2hDaGVjayA9PSAiLm51ZyIpCiAgICAgICAgewogICAgICAgICAgICBudWdQdWJsaXNoID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJyZWFrTGV2ZWwgKz0gbnVnQnJlYWtzOwoKICAgICAgICBudWdCcmVha3MgPSB0b3RhbE51Z0JyZWFrcyAtICh0b3RhbE51Z0JyZWFrcyAtIGJyZWFrTGV2ZWwpOwogICAgICAgIAogICAgICAgIC8vQ0hFQ0sgSUYgJCBiZWZvcmUgbnVnZ2V0CiAgICAgICAgaWYgKHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zIC0gMiwgaW5pdGlhbE51Z1BvcyAtIDEpICE9ICIkIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z3NUb0NoZWNrLnB1c2goe251Z05hbWU6IHBvc3NpYmxlTnVnLCBudWdTdGFydDogbnVnQnJlYWtzICsgMSwgbnVnUHVibGlzaDogbnVnUHVibGlzaH0pOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBsZXQgbnVnQnJlYWtzID0gdGFnVmFsdWUuc3Vic3RyaW5nKDAsIHRhZ1ZhbHVlLmluZGV4T2YoIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICB9CgogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS5zdWJzdHJpbmcocG9zc2libGVOdWdFbmQgKyAxKTsKfQoKdGhpc0JvdC5udWdnZXRCdXR0b24oeyBudWdnZXQ6IG51Z3NUb0NoZWNrLCBib3Q6IHRoYXQuZWRpdGVkQm90LCB0YWc6IHRoYXQuZWRpdGVkVGFnLCB0YWdWYWx1ZTogb3JpZ2luYWxUYWdWYWx1ZX0pOycAkJWrjgHAXg1vbkFCUHVibGlzaGVkAgQAkJWrjgHbhwHBAUBjb25zb2xlLmxvZyh0aGF0LmFiLCB0YWdzLm51Z2dldFRvUHVibGlzaCkKCmlmICh0aGF0LmFiID09IHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IHB1Ymxpc2hlZCIpOwoKICAgIG1hc2tzLm51Z2dldFRvUHVibGlzaCA9IG51bGw7CgogICAgY29uZmlnQm90Lm1hc2tzLmFiVmVyc2lvbiA9IG51bGw7Cn0nAJCVq44BwF4Qb25BbnlCb3RzQ2hhbmdlZAIEAJCVq44BnYkBtwRAaWYgKGNvbmZpZ0JvdCAmJiB0aGF0WzBdLmJvdC5pZCAhPSB0aGlzQm90LmlkKSAKewogICAgaWYgKCFjb25maWdCb3QudGFncy5lZGl0aW5nQm90KSByZXR1cm47IC8vIElnbm9yZSBpZiB0aGUgY29uZmlnQm90IGlzbid0IHJlYWR5IHlldC4KCiAgICBjb25zdCBlZGl0ZWRCb3RJRCA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QucmVwbGFjZSgi8J+UlyIsICIiKTsKCiAgICBpZiAoIXRoYXQuZmluZCh4ID0+IHguYm90LmlkID09IGVkaXRlZEJvdElEKSkgcmV0dXJuOyAvLyBJZiB0aGUgYm90IGNoYW5nZWQgd2Fzbid0IGJlaW5nIGVkaXRlZCBieSB0aGUgdXNlciBpZ25vcmUgaXQuCgogICAgY29uc3QgZWRpdGVkVGFnID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ1RhZzsKICAgIGNvbnN0IGVkaXRlZEJvdCA9IGdldEJvdCgiaWQiLCBlZGl0ZWRCb3RJRCk7CgogICAgaWYgKGVkaXRlZEJvdCAmJiBlZGl0ZWRUYWcpIAogICAgewogICAgICAgIHNob3V0KCJudWdnZXRSZXNldCIpOwoKICAgICAgICB0aGlzQm90Lm51Z2dldFBhcnNlKHsgZWRpdGVkQm90LCBlZGl0ZWRUYWcgfSk7CiAgICB9Cn0nAJCVq44BwF4Ib25DcmVhdGUCBACQlauOAdONAUxAdGFncy5saXN0ZW5pbmcgPSBmYWxzZTsKCi8vc2V0VGFnTWFzayh0aGlzQm90LCAibGlzdGVuaW5nIiwgdHJ1ZSwgImxvY2FsIik7JwCQlauOAcBeDXBhY2thZ2VOdWdnZXQCBACQlauOAaCOAfgGQGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CmNvbnN0IHRhZ1RleHQgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXTsKCmlmIChjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4IHx8IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4KQp7CiAgICBsZXQgc3RhcnRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4OwogICAgbGV0IGVuZFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4OwoKICAgIGlmIChzdGFydFBvcyA9PSBlbmRQb3MpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoc3RhcnRQb3MgPiBlbmRQb3MpCiAgICB7CiAgICAgICAgbGV0IG5ld1N0YXJ0UG9zID0gZW5kUG9zOwogICAgICAgIGxldCBuZXdFbmRQb3MgPSBzdGFydFBvczsKCiAgICAgICAgc3RhcnRQb3MgPSBuZXdTdGFydFBvczsKICAgICAgICBlbmRQb3MgPSBuZXdFbmRQb3M7CiAgICB9CgogICAgbGV0IGRhdGEgPSB0YWdUZXh0LnN1YnN0cmluZyhzdGFydFBvcywgZW5kUG9zICsgMSk7CgogICAgc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6IHRoYXQubnVnZ2V0LCBkYXRhOiBkYXRhfSk7CgogICAgb3MudG9hc3QoIm51ZyBpcyBwdWJsaXNoaW5nIiwgMTApOwoKICAgIGxldCB0YXJnZXROdWcgPSAiLm51ZyB7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImNhbm5vdCByZWFkIG51Z2dldCB0byBiZSBwdWJsaXNoZWQiKQp9JwCQlauOAcBeCHJlbWVtYmVyAgQAkJWrjgGZlQEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAkJWrjgHAXgZzZWFyY2gCBACQlauOAcCVASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCQlauOAcBeBXN0b3JlAgQAkJWrjgHnlQEo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAkJWrjgHAXglsaXN0ZW5pbmcCBACQlauOAY6WAQVmYWxzZScAkJWrjgHAXglhYlZlcnNpb24CBACQlauOAZSWAQUxMC4xMCcBBGJvdHMkYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiAScAkJWrjgGalgEZYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcgIEAJCVq44Bm5YBzgxAY29uc3QgewogICAgbGFiZWwgPSBgJHthYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9IGlzIHdvcmtpbmdgLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fQoKbGV0IGJ1c3lJbmRpY2F0b3IgPSB7CiAgICBvblBvaW50ZXJVcDogbnVsbCwKICAgIG9uUG9pbnRlckRvd246IG51bGwsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgYnVzeUxhYmVsOiBsYWJlbCwKICAgIGxhYmVsQWxpZ25tZW50OiAnbGVmdCcsCiAgICBzdGF0ZTogMCwKICAgIGFuaW1TdGF0ZXM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgXSwKICAgIGFuaW1SYXRlOiA1MDAsCiAgICBvbkJvdEFkZGVkOiBgQAogICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICBvbkJvdENoYW5nZWQ6IGBACiAgICAgICAgY29uc3QgbmVlZFJlZnJlc2ggPSB0aGF0LnRhZ3Muc29tZSh0ID0+IHQgPT09ICdidXN5TGFiZWwnIHx8IHQgPT09ICdzdGF0ZScgfHwgdCA9PT0gJ2FuaW1TdGF0ZXMnKTsKICAgICAgICBpZiAobmVlZFJlZnJlc2gpIHsKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0KICAgIGAsCiAgICByZWZyZXNoRGlzcGxheTogYEAKICAgICAgICBpZiAodGFncy5hbmltU3RhdGVzICYmIHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IGFuaW1TdGF0ZSA9IHRhZ3MuYW5pbVN0YXRlc1t0YWdzLnN0YXRlXTsKCiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSB0YWdzLmJ1c3lMYWJlbC50cmltKCkgKyBhbmltU3RhdGUuZWxsaXBzaXM7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBhbmltU3RhdGUuZm9ybUFkZHJlc3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5sYWJlbCAKICAgICAgICB9CiAgICBgLAogICAgYW5pbWF0ZTogYEAKICAgICAgICBpZiAodGFncy5zdGF0ZSA+PSB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICB0YWdzLnN0YXRlID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLnN0YXRlICs9IDE7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBvcy5zbGVlcCh0YWdzLmFuaW1SYXRlKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICAuLi5yZXN0Cn07Cgpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYnVzeUluZGljYXRvcik7CgpyZXR1cm4gbWVudUJvdDsnAJCVq44BmpYBBnN5c3RlbQIEAJCVq44B6qIBEWFiLmludGVyZmFjZS5tZW51JwCQlauOAZqWAQRmb3JtAgQAkJWrjgH8ogEHbm90aGluZycAkJWrjgGalgELZGVzY3JpcHRpb24CBACQlauOAYSjASZUaGlzIHNraWxsIGlzIGRlc2lnbmVkIGZvciBtZW51IHN0dWZmLigAkJWrjgGalgELYWJJbnRlcmZhY2UBeCcAkJWrjgGalgEKYWJPcGVuTWVudQIEAJCVq44BrKMB/RpAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgbWVudVR5cGUgPSB0aGF0ID8gImFiIiArIHRoYXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGF0LnNsaWNlKDEpICsgIk1lbnUiOiAiYWJDb3JlTWVudSI7IC8vc2V0IHVwIGEgY2hlY2sgdG8gc2VlIHdoYXQgdHlwZSBvZiBtZW51IHNob3VsZCBiZSBvY2N1cmluZyBbY29yZSwgYm90LCBncmlkLCBpbnN0XQpsZXQgbWVudVNraWxscyA9IGdldEJvdHMobWVudVR5cGUgKyAiQWN0aW9uIik7CmxldCBtYXhPcHRpb25zID0gbWVudVR5cGUgPT0gImluc3QiID8gNyA6IDU7CmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5OwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MuYmFzZVNraWxsLiR7bWVudVR5cGUgKyAiQWN0aW9uIn0oe2JvdDogdGhpc0JvdH0pO2A7CgpsZXQgc29ydE9yZGVySW5kZXggPSBtZW51U2tpbGxzLmxlbmd0aDsKZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51U2tpbGxzLmxlbmd0aDsgaSsrKS8vQUREIExPR0lDIEZPUiBNT1JFIE9QVElPTlMgVEhBTiA1IDogbWF4T3B0aW9ucwp7CiAgICAvL0FsbG93cyBmb3IgY29kZSB0byBnZXQgY2FsbGVkIGJlZm9yZSB0aGUgbWVudSBnZW5lcmF0ZXMsIHVzZWZ1bCBmb3IgZHluYW1pY2FsbHkgc2V0IGdyb3VwcyBvciBkcm9wZG93bnMKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiXSkgewogICAgICAgIGF3YWl0IHdoaXNwZXIobWVudVNraWxsc1tpXSwgbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiKTsKICAgIH0gCgogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJIaWRlIl0pIHsKICAgICAgICBjb250aW51ZTsKICAgIH0KICAgIAogICAgbGV0IGN1cnJlbnRTa2lsbCA9IG1lbnVTa2lsbHNbaV07CgogICAgYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGN1cnJlbnRTa2lsbC5pZDsKICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkxhYmVsIl07CiAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJY29uIl07CiAgICBhYk1lbnVCdXR0b24ub25DcmVhdGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJPbkdlbmVyYXRlIl07CiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiU29ydE9yZGVyIl07CiAgICBhYk1lbnVCdXR0b24uY29sb3IgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdID8gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwoKICAgIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJkcm9wZG93biIpIHsKICAgICAgICBhYk1lbnVCdXR0b24uZHJvcGRvd25PcHRpb25zID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25PcHRpb25zOwoKICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImdyb3VwIikgewogICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhYk1lbnVCdXR0b24ubWVudUl0ZW1zID0gY3VycmVudFNraWxsLnRhZ3MubWVudUl0ZW1zOwogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiaW5wdXQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ0ZXh0IikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ0b29sIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ3aXphcmQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsKICAgIH0KfQoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCT3Blbk1lbnUnLCB7IG1lbnU6IHRoYXQsIG1lbnVUeXBlLCBtZW51UG9ydGFsOiBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCB9KTsnAJCVq44BmpYBEmFiQ3JlYXRlTWVudUJ1dHRvbgIEAJCVq44BqL4B+A1AbGV0IG5ld01lbnVCdXR0b24gPSB7fTsKCmxldCB7CiAgICBtZW51SXRlbVN0eWxlID0ge30sCiAgICAuLi5hZGRpdGlvbmFsVGFncwp9ID0gdGhhdCA/PyB7fQoKaWYgKHR5cGVvZiBtZW51SXRlbVN0eWxlID09ICdzdHJpbmcnKSB7CiAgICBtZW51SXRlbVN0eWxlID0gbWVudUl0ZW1TdHlsZS5yZXBsYWNlKC9cdXsxRjlFQ30vdSwgJycpOyAKICAgIG1lbnVJdGVtU3R5bGUgPSBKU09OLnBhcnNlKG1lbnVJdGVtU3R5bGUpOwp9CgpmdW5jdGlvbiBoYXNCb3JkZXJTdHlsZSgpIHsKICAgIGlmIChtZW51SXRlbVN0eWxlWyJib3JkZXItdG9wLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLWxlZnQtc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItYm90dG9tLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLXJpZ2h0LXN0eWxlIl0pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KCmlmIChhZGRpdGlvbmFsVGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSkgewogICAgaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiTWVudUdyb3VwIl0pIHsKCiAgICB9Cn0KCm5ld01lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwpuZXdNZW51QnV0dG9uLmxhYmVsQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwpuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yID0gdGhhdC5zaGFkb3dDb2xvciA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVNoYWRvd0NvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5zY2FsZVkgPSAxOwoKY29uc3QgbWVudVN0eWxpbmcgPSB7CiAgICAiYm9yZGVyLXJhZGl1cyI6IjhweCIsCiAgICAibWFyZ2luLXRvcCI6ICI4cHgiLAogICAgImJveC1zaGFkb3ciOiBgM3B4IDRweCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJtaW4taGVpZ2h0IjogIjQ0cHgiLAogICAgImJvcmRlciI6IGhhc0JvcmRlclN0eWxlKCkgPyAiIiA6IGAycHggc29saWQgJHtuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yfWAsCiAgICAid2lkdGgiOiAiY2FsYygxMDAlIC0gNXB4KSIsCiAgICAuLi5tZW51SXRlbVN0eWxlCn0KCm5ld01lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IG1lbnVTdHlsaW5nOwoKY29uc3QgY2xpY2tlZFN0eWxpbmcgPSB7CiAgICAuLi5tZW51U3R5bGluZywKICAgICJmaWx0ZXIiOiAiYnJpZ2h0bmVzcyg2MCUpIgp9CmNvbnN0IGJhc2VTdHlsZSA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSAn8J+nrCAke0pTT04uc3RyaW5naWZ5KGNsaWNrZWRTdHlsaW5nKX0nYAoKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJEb3duID0gbWVudUl0ZW1TdHlsZT8uWyJtYXJnaW4tdG9wIl0gIT0gIjBweCIgPyBiYXNlU3R5bGUgOiAiQCAvLyI7Cm5ld01lbnVCdXR0b24ub25Qb2ludGVyVXAgPSBgQCBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbGA7Cgpmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykKewogICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsKfQoKbmV3TWVudUJ1dHRvbiA9IGNyZWF0ZShuZXdNZW51QnV0dG9uKTsKCnJldHVybiBuZXdNZW51QnV0dG9uOycAkJWrjgGalgENYWJNZW51UmVmcmVzaAIEAJCVq44Bn8wBnQFAaWYgKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw/LnN1YnN0cmluZygwLDIpID09ICJhYiIpCnsKICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKCiAgICBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7CiAgICBtYXNrcy5vbktleURvd24gPSBudWxsOwp9JwCQlauOAZqWAQhyZW1lbWJlcgIEAJCVq44Bvc0BKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJCVq44BmpYBDW1hbmlmZXN0YXRpb24CBACQlauOAeTNASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCQlauOAZqWARFhYkVudmlyb25tZW50TWVudQIEAJCVq44Bi84BujdAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5OwphYk1lbnVCdXR0b24ubGVhcm4gPSB0YWdzLmxlYXJuOwoKY29uc3QgYWJFbnZpcm9ubWVudE9wdGlvbnMgPSB0aGlzQm90LmFiR2V0RW52aXJvbm1lbnRPcHRpb25zKCk7CgpidXR0b25Mb29wOgpmb3IgKGxldCBpID0gMDsgaSA8IGFiRW52aXJvbm1lbnRPcHRpb25zLmxlbmd0aDsgaSsrKQp7CiAgICBsZXQgYWN0aXZlQnV0dG9uID0gYWJFbnZpcm9ubWVudE9wdGlvbnNbaV07CgogICAgYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGFjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjsKCiAgICBpZiAoYWN0aXZlQnV0dG9uLmFiRW52aXJvbm1lbnRHYXRlKQogICAgewogICAgICAgIGlmICghbGlua3NbYWN0aXZlQnV0dG9uLmFiRW52aXJvbm1lbnRHYXRlXSkKICAgICAgICB7CiAgICAgICAgICAgIGNvbnRpbnVlIGJ1dHRvbkxvb3A7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBuZXdCdXR0b25EYXRhID0gey4uLmFiTWVudUJ1dHRvbiwgLi4uYWN0aXZlQnV0dG9ufTsKCiAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdCdXR0b25EYXRhKTsKfQoKY29uc3QgYWJQZXJzb25hbGl0eUNvbmZpZ0J1dHRvbiA9IHsKICAgIGxhYmVsOiAiY3VzdG9taXplOiBhYiBwZXJzb25hbGl0eSIsCiAgICAuLi5hYk1lbnVCdXR0b24sCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEsCiAgICBkcm9wZG93blNvcnRPcmRlcjogMSwKICAgIGRyb3Bkb3duT3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBuYW1lOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwge3RpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB0byBjYWxsIG1lPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHtuYW1lOiBuYW1lfSk7IAogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBhaSBtb2RlbDogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbH1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBhaU1vZGVscyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWlNb2RlbHM7CgogICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IFtdOwoKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29tcGFueUdyb3VwIG9mIGFpTW9kZWxzKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBtb2RlbEVudHJ5IG9mIGNvbXBhbnlHcm91cC5tb2RlbHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKHsgbGFiZWw6IG1vZGVsRW50cnkubW9kZWwsIHZhbHVlOiBtb2RlbEVudHJ5Lm1vZGVsIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TW9kZWxJbmRleCA9IG9wdGlvbnMuZmluZEluZGV4KG8gPT4gby52YWx1ZSA9PT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpOwoKICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkT3B0aW9uID0gYXdhaXQgb3Muc2hvd0lucHV0KGN1cnJlbnRNb2RlbEluZGV4LCB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICd3aGF0IGFpIG1vZGVsIHdvdWxkIHlvdSBsaWtlIG1lIHRvIHVzZT8nLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaXN0JywKICAgICAgICAgICAgICAgICAgICBpdGVtczogb3B0aW9ucywKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE9wdGlvbiAmJiBzZWxlY3RlZE9wdGlvbi52YWx1ZSAhPT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7YWlNb2RlbDogc2VsZWN0ZWRPcHRpb24udmFsdWV9KTsgCiAgICAgICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbWUgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge2NvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51cyB0byBiZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bWVudUNvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICAgICAgICAgIC8vbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvciA9IGNvbG9yOyBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciAhPSAnY2xlYXInKXtsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yID0gY29sb3J9OyBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSB0ZXh0IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudSB0ZXh0IHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51TGFiZWxDb2xvcjogY29sb3J9KTsgCiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICAgICAgICAgICAgICAvL2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IgPSBjb2xvcjsgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgIT0gJ2NsZWFyJyl7bGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciA9IGNvbG9yfTsgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGRlZmF1bHQgcG9ydGFsIGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4J31gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBsZXQgcG9ydGFsQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IHdvdWxkIHlvdSBsaWtlIHlvdXIgcG9ydGFsIHRvIGxvb2sgbGlrZT8nfSk7CiAgICAgICAgICAgICAgICBpZiAoIXBvcnRhbENvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgcG9ydGFsQ29sb3IgPSAnIzI2MzIzOCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7J3BvcnRhbENvbG9yJzogcG9ydGFsQ29sb3J9KTsgCiAgICAgICAgICAgICAgICAvL2Rlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGRlZmF1bHQgbWFwIHBvcnRhbCBiYXNlbWFwYCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgc2hvdXQoInNob3dBQkJhc2VtYXBPcHRpb25zIik7CiAgICAgICAgICAgIGAKICAgICAgICB9LAogICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiAiZGVmYXVsdCBzZXR0aW5ncyIsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgICAgICAgICBjb2xvcjogJ3JlZCcsCiAgICAgICAgICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7J2RlZmF1bHRQZXJzb25hbGl0eSc6IHRydWV9KTsgCiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJtZW51IGNvbG9yIiwKICAgICAgICAvLyAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAvLyAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgIC8vICAgICAgICAgY29uc3QgbWVudUNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGFiUGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHt0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudSdzIHRvIGJlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51Q29sb3I6IG1lbnVDb2xvcn0pOyAKICAgICAgICAvLyAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7YCwKICAgICAgICAvLyB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJwcm9tcHQiLAogICAgICAgIC8vICAgICBvbkNsaWNrOiBgQGAsCiAgICAgICAgLy8gfSwKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAgIGxhYmVsOiAiZm9ybSIsCiAgICAgICAgLy8gICAgIG9uQ2xpY2s6IGBAIAogICAgICAgIC8vICAgICAgICAgY29uc3QgZm9ybSA9IGF3YWl0IG9zLnNob3dJbnB1dChhYlBlcnNvbmFsaXR5LnRhZ3MuYWJGb3JtLCB7dGl0bGU6ICd3aGF0IGZvcm0gd291bGQgeW91IGxpa2UgbWUgdG8gdGFrZT8nfSk7CiAgICAgICAgLy8gICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7Zm9ybTogZm9ybX0pOyAKICAgICAgICAvLyAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7YCwKICAgICAgICAvLyB9CiAgICBdCn0KCnRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJQZXJzb25hbGl0eUNvbmZpZ0J1dHRvbik7Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJFbnZpcm9ubWVudE1lbnUnLCB7IG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWx9ICknAJCVq44BmpYBBWxlYXJuAgQAkJWrjgHGhQIo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAkJWrjgGalgEDZ3B0AgQAkJWrjgHthQIo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAkJWrjgGalgEIYWJJZ25vcmUCBACQlauOAZSGAgR0cnVlJwCQlauOAZqWAQZzZWFyY2gCBACQlauOAZmGAijwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCQlauOAZqWAQZudWdnZXQCBACQlauOAcCGAijwn5SXNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmJwCQlauOAZqWAQV0ZXN0cwIEAJCVq44B54YCKPCflJdiODNkOTcyYi0wNTM1LTQwNTEtYjU4OS00MWNlZGE4NTM1ZjEnAJCVq44BmpYBD29uUG9ydGFsQ2hhbmdlZAIEAJCVq44BjocCbkBpZiAodGhhdC5wb3J0YWwgPT0gInN5c3RlbVBvcnRhbCIgJiYgIXRoYXQuZGltZW5zaW9uICYmICFsaW5rcy50ZXN0cykKewogICAgbGlua3MubGVhcm4uYWJBZGFwdCgiYWJUZXN0cyIpOwp9JwCQlauOAZqWAQNhc2sCBACQlauOAf2HAijwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCQlauOAZqWAQlhYlZlcnNpb24CBACQlauOAaSIAgUxMC4xMCcAkJWrjgGalgERYWJDcmVhdGVNZW51SW5wdXQCBACQlauOAaqIAp4CQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVJbnB1dCA9IHsNCiAgICBmb3JtOiAiaW5wdXQiLA0KICAgIG1lbnVJdGVtU2hvd1N1Ym1pdFdoZW5FbXB0eTogZmFsc2UsDQogICAgZm9ybUlucHV0TXVsdGlsaW5lOiBudWxsLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVJbnB1dCk7DQoNCnJldHVybiBtZW51Qm90OycAkJWrjgGalgEQYWJDcmVhdGVNZW51VGV4dAIEAJCVq44ByYoCgQRAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpjb25zdCB7DQogICAgbWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIC4uLnJlc3QNCn0gPSB0aGF0Ow0KDQpsZXQgbWVudVRleHQgPSB7DQogICAgZm9ybTogInRleHQiLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgcG9pbnRhYmxlOiBmYWxzZSwNCiAgICBjb2xvcjogIndoaXRlIiwNCiAgICBtZW51SXRlbVN0eWxlOiB7DQogICAgICAgICJwYWRkaW5nLXRvcCI6ICI2cHgiLA0KICAgICAgICAicGFkZGluZy1ib3R0b20iOiAiNnB4IiwNCiAgICB9LA0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZTogew0KICAgICAgICAid2hpdGUtc3BhY2UiOiAicHJlLXdyYXAiLA0KICAgICAgICAuLi5tZW51SXRlbUxhYmVsU3R5bGUsDQogICAgfSwNCiAgICAuLi5yZXN0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRleHQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAJCVq44BmpYBEGFiQ3JlYXRlTWVudVRvb2wCBACQlauOAcuOAo4BQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVUb29sID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51VG9vbCk7DQoNCnJldHVybiBtZW51Qm90OycAkJWrjgGalgESYWJDcmVhdGVNZW51V2l6YXJkAgQAkJWrjgHajwKSAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51V2l6YXJkID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51V2l6YXJkKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCQlauOAZqWARRhYkNyZWF0ZU1lbnVEcm9wZG93bgIEAJCVq44B7ZAC6BtAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAoIXRoYXQuZHJvcGRvd25Tb3J0T3JkZXIpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudURyb3Bkb3duOiBkcm9wZG93blNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCBvdXRlck1lbnVCdXR0b24gPSB7DQogICAgLi4udGhhdCwNCiAgICBmb3JtQWRkcmVzczogdGhhdC5mb3JtQWRkcmVzcyA/PyAiYXJyb3dfcmlnaHQiLA0KICAgIGRyb3Bkb3duT3BlbjogZmFsc2UsDQogICAgb25DbGljazogYEANCiAgICAgICAgdGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gJHt0aGF0LmRyb3Bkb3duU29ydE9yZGVyfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gZmFsc2U7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyh0YWdzLmRyb3Bkb3duT3B0aW9ucywgdGFncy5kcm9wZG93blNvcnRPcmRlcik7DQogICAgICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkRlc3Ryb3k6IGBADQogICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgYCwNCiAgICBvblBvaW50ZXJVcDogYEANCiAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgbWFza3MuZm9ybUFkZHJlc3MgPSAiYXJyb3dfcmlnaHQiOw0KICAgICAgICB9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSBmYWxzZSkgew0KICAgICAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAiZm9ybUFkZHJlc3MiLCAiYXJyb3dfZHJvcF9kb3duIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJtZW51SXRlbVN0eWxlIiwgey4uLnRhZ3MubWVudUl0ZW1TdHlsZSwgImJvcmRlckJvdHRvbUxlZnRSYWRpdXMiOiAiMCIsICJib3JkZXJCb3R0b21SaWdodFJhZGl1cyI6ICIwIn0pOw0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkJvdENoYW5nZWQ6IGBADQogICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ2Ryb3Bkb3duT3BlbicpICYmIHRhZ3MuZHJvcGRvd25PcGVuID09IHRydWUpIHsNCiAgICAgICAgICAgIHNob3V0KCJhYk1lbnVEcm9wZG93bk9wZW5lZCIsIHRoaXNCb3QpOw0KICAgICAgICB9DQogICAgYCwNCiAgICBhYk1lbnVEcm9wZG93bk9wZW5lZDogYEANCiAgICAgICAgaWYgKHRoYXQgIT0gdGhpc0JvdCkgew0KICAgICAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gZmFsc2U7DQogICAgICAgICAgICBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIGANCn07DQoNCmlmICh0aGF0LmZvcm1BZGRyZXNzICYmIHRoYXQuZm9ybUFkZHJlc3MgIT0gImFycm93X3JpZ2h0Iikgew0KICAgIG91dGVyTWVudUJ1dHRvbi5jdXN0b21Gb3JtQWRkcmVzcyA9IHRydWU7DQp9DQpvdXRlck1lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IHRoYXQuZHJvcGRvd25Tb3J0T3JkZXI7DQoNCmNvbnN0IG1lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihvdXRlck1lbnVCdXR0b24pOw0KbWVudUJvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMgPSBnZW5lcmF0ZU1lbnVPcHRpb25zOw0KDQphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZU1lbnVPcHRpb25zIChvcHRpb25zLCBzb3J0T3JkZXIpIHsNCiAgICBjb25zdCBtZW51Qm90cyA9IFtdOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7ICsraSkgew0KDQogICAgICAgIGxldCBuZXdNZW51QnV0dG9uID0gew0KICAgICAgICAgICAgLi4ub3B0aW9uc1tpXSwNCiAgICAgICAgICAgIGNsZWFyRHJvcGRvd25NZW51OiBgQA0KICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMDApOw0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoaSA9PSBvcHRpb25zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAgMCA4cHggOHB4IjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIDAgOHB4IDhweCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJUb3AiXSA9ICJub25lIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJtYXJnaW5Ub3AiXSA9ICIwIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJwYWRkaW5nTGVmdCJdID0gIjM1cHgiOw0KDQogICAgICAgIGNvbnN0IG5ld01lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCiAgICB9DQoNCiAgICBtZW51Qm90LnRhZ3MubWVudUJvdHMgPSBnZXRMaW5rKG1lbnVCb3RzKTsNCn0NCg0KcmV0dXJuIG1lbnVCb3Q7DQoNCicAkJWrjgGalgERYWJDcmVhdGVNZW51R3JvdXACBACQlauOAdasAtwdQC8qDQogICBFWEFNUExFDQogICBjb25zdCBtZW51R3JvdXAgPSB7DQogICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGdyb3VwU29ydE9yZGVyOiAxLA0KICAgICAgICBtZW51SXRlbXM6IFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDIiLA0KICAgICAgICAgICAgICAgIGNvbG9yOiAib3JhbmdlIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICBtZW51SXRlbVR5cGU6ICJkcm9wZG93biIsDQogICAgICAgICAgICAgICAgZHJvcGRvd25PcHRpb25zOiBbDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDEiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMyIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICB9DQogICAgICAgIF0NCiAgICB9DQoqLw0KDQppZiAgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAoIXRoYXQuZ3JvdXBTb3J0T3JkZXIpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudUdyb3VwOiBncm91cFNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCB7DQogICAgbWVudUl0ZW1TdHlsZSA9IHt9LA0KICAgIG1lbnVJdGVtcyA9IFtdLA0KICAgIC4uLmFkZGl0aW9uYWxUYWdzDQp9ID0gdGhhdCA/PyB7fQ0KDQpjb25zdCBtZW51Qm90cyA9IFtdOw0KZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51SXRlbXMubGVuZ3RoOyArK2kpIHsNCg0KICAgIGxldCBuZXdNZW51QnV0dG9uID0ge307DQoNCiAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSBOdW1iZXIodGhhdC5ncm91cFNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMCk7DQoNCiAgICBsZXQgaW5kaXZNZW51SXRlbVN0eWxlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtU3R5bGUgPz8ge307DQogICAgbGV0IGluZGl2TWVudVR5cGUgPSBtZW51SXRlbXNbaV0ubWVudUl0ZW1UeXBlID8/IHVuZGVmaW5lZDsNCiAgICBsZXQgaW5kaXZBZGRpdGlvbmFsVGFncyA9IG1lbnVJdGVtc1tpXTsNCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgIGRlbGV0ZSBpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVN0eWxlIl07DQogICAgfQ0KICAgIGlmIChpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVR5cGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl07DQogICAgfQ0KDQogICAgY29uc3QgYmFzZVN0eWxpbmcgPSB7DQogICAgICAgICJib3JkZXJUb3AiOiAibm9uZSIsDQogICAgICAgICJtYXJnaW5Ub3AiOiAiMCINCiAgICB9DQoNCiAgICBpZiAoaSA9PSBtZW51SXRlbXMubGVuZ3RoIC0gMSkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLmJhc2VTdHlsaW5nLA0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICIwIDAgOHB4IDhweCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9IGVsc2UgaWYgKGkgPT0gMCkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiOHB4IDhweCAwIDAiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7fQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLmJhc2VTdHlsaW5nLA0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICIwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQ0KICAgIHsNCiAgICAgICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBpbmRpdkFkZGl0aW9uYWxUYWdzKQ0KICAgIHsNCiAgICAgICAgbmV3TWVudUJ1dHRvblt0YWddID0gaW5kaXZBZGRpdGlvbmFsVGFnc1t0YWddOw0KICAgIH0NCg0KICAgIGxldCBuZXdNZW51Qm90Ow0KICAgIHN3aXRjaChpbmRpdk1lbnVUeXBlKSB7DQogICAgICAgIGNhc2UgImRyb3Bkb3duIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLi4ubmV3TWVudUJ1dHRvbiwNCiAgICAgICAgICAgICAgICAgICAgImRyb3Bkb3duU29ydE9yZGVyIjogTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMCkNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJpbnB1dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ0ZXh0IjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidG9vbCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUb29sKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgIndpemFyZCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgIH0NCiAgICBtZW51Qm90cy5wdXNoKG5ld01lbnVCb3QpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdHM7JwCQlauOAZqWAQtwZXJzb25hbGl0eQIEAJCVq44Bs8oCKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAJCVq44BmpYBF2FiR2V0RW52aXJvbm1lbnRPcHRpb25zAgQAkJWrjgHaygLAKUBjb25zdCBvcHRpb25zID0gW107CgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiBgaGlkZWAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJ2aXNpYmlsaXR5X29mZiIsCiAgICAgICAgb25DbGljazogIkAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAwCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJvcHRpbWl6ZSBtb2RlIiwKICAgIG9uQ3JlYXRlOiAiQCBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA/IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JyA6IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICBvbkNsaWNrOiAiQCBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA/IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gZmFsc2UgOiBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA9IHRydWU7IHRoaXNCb3Qub25DcmVhdGUoKTsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEKfSkKCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJzbGVlcCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJuaWdodHNfc3RheSIsCiAgICAgICAgb25DbGljazogIkBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiU2V0QXdha2UoeyBhd2FrZTogZmFsc2UgfSkiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAzCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJjaGF0IiwKICAgIGZvcm1BZGRyZXNzOiAiY2hhdCIsCiAgICBvbkNsaWNrOiAiQCBzaG91dCgnYWJDaGF0QmFyT3BlbicpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAibnVnZ2V0cyIsCiAgICBvbkNyZWF0ZTogIkAgdGFncy5udWdNYW5hZ2VyID0gZ2V0TGluayhnZXRCb3QoJ3N5c3RlbScsICdhYi5pbnRlcmZhY2UubnVnZ2V0JykpOyBpZiAobGlua3MubnVnTWFuYWdlci50YWdzLmxpc3RlbmluZyl7dGFncy5vbkNsaWNrID0gYEAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIG51bGwpO2A7dGFncy5mb3JtQWRkcmVzcyA9IGBjaGVja19ib3hgO31lbHNleyAgICB0YWdzLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgdHJ1ZSwgJ2xvY2FsJyk7YDsgICAgdGFncy5mb3JtQWRkcmVzcyA9IGBjaGVja19ib3hfb3V0bGluZV9ibGFua2A7fSIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNQp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGFiRW52aXJvbm1lbnRHYXRlOiAiZ3B0IiwKICAgIG9uQ3JlYXRlOiAiQCAgaWYgKCFhdXRoQm90KXtkZXN0cm95KHRoaXNCb3QpO31lbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAnRnJlZVBsYXknIHx8IGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09IHVuZGVmaW5lZCl7ZGVzdHJveSh0aGlzQm90KTt9OyB0YWdzLmxhYmVsID0gJ2VkaXQgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIHByb21wdCc7IHRhZ3MuZ3B0Qm90ID0gZ2V0TGluayhnZXRCb3QoJ3N5c3RlbScsICdhYi5hY3Rpb24uYXNrJykpOyIsCiAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICBvbkNsaWNrOiAiQCBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNwp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiZ3JpZCBzbmFwIiwKICAgIG9uQ3JlYXRlOiAiQCB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayciLAogICAgb25DbGljazogIkAgbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGU7dGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogOAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiYm90IHNuYXAiLAogICAgb25DcmVhdGU6ICJAIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICBvbkNsaWNrOiAiQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogOQp9KQoKaWYgKGF1dGhCb3QpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJhY2NvdW50IiwKICAgICAgICBmb3JtQWRkcmVzczogImJhZGdlIiwKICAgICAgICBvbkNsaWNrOiAiQCBvcy5zaG93QWNjb3VudEluZm8oKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMAogICAgfSkKfQoKaWYgKGxpbmtzLnRlc3RzKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgICAgIGxhYmVsOiAicmVjb3JkIHRlc3QiLAogICAgICAgIGZvcm1BZGRyZXNzOiAic2NpZW5jZSIsCiAgICAgICAgb25LZXlEb3duOiAiQCAiLAogICAgICAgIG9uS2V5VXA6ICJAICIsCiAgICAgICAgb25DbGljazogIkAgbGV0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCdrZXlib2FyZCcsICdTaGlmdCcpO2xldCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7c2hvdXQoJ2FiUmVjb3JkVGVzdCcpO3Nob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTEKICAgIH0pCgogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBhYkVudmlyb25tZW50R2F0ZTogInRlc3RzIiwKICAgICAgICBsYWJlbDogInJlY29yZCB0cmFjZSIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJ0aW1lbGluZSIsCiAgICAgICAgb25LZXlEb3duOiAiQCAiLAogICAgICAgIG9uS2V5VXA6ICJAICIsCiAgICAgICAgb25DbGljazogIkAgbGV0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCdrZXlib2FyZCcsICdTaGlmdCcpO2xldCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7c2hvdXQoJ2FiUmVjb3JkVHJhY2UnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEyCiAgICB9KQp9CgppZiAoZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaG9tZS5lZ2ciKSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBhYkVudmlyb25tZW50R2F0ZTogInRlc3RzIiwKICAgICAgICBsYWJlbDogInNhdmUgaG9tZSBlZ2ciLAogICAgICAgIGZvcm1BZGRyZXNzOiAiZWdnIiwKICAgICAgICBvbktleURvd246ICJAICIsCiAgICAgICAgb25LZXlVcDogIkAgIiwKICAgICAgICBvbkNsaWNrOiBgQGdldEJvdCgic3lzdGVtIiwgImFiLmhvbWUuZWdnIikuc2F2ZURhdGEoKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEzCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJ1cGRhdGUgIiArIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICBmb3JtQWRkcmVzczogImN1YmUiLAogICAgbGVhcm46IHRhZ3MubGVhcm4sCiAgICBvbktleURvd246ICJAICIsCiAgICBvbktleVVwOiAiQCAiLAogICAgb25DbGljazogYEBsaW5rcy5sZWFybi51cGRhdGVBQigpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTQKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBvbkNyZWF0ZTogYEAKICAgICAgICB0YWdzLmxhYmVsID0gInBlcm1hbmVudGx5IGRlbGV0ZSAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKICAgICAgICB0YWdzLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb250cmFzdENvbG9yID8/ICIjRDkzMDMwIjsKICAgIGAsCiAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgIG9uQ2xpY2s6IGBACiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ1Blcm1hbmVudGx5IGRlbGV0ZSAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgY29udGVudDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArICBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBmcm9tICcgKyBsaW5rcy5sZWFybi50YWdzLmFiSW5zdCArICc/IFRoaXMgaXMgbm90IHJldmVyc2libGUhJywKICAgICAgICB9KQoKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwoKICAgICAgICBjb25zdCBhYkJvdHMgPSBnZXRCb3RzKChiKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBiLnNwYWNlID09PSAnc2hhcmVkJyAmJgogICAgICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0gJiYKICAgICAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtLnN0YXJ0c1dpdGgoJ2FiJyk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgZGVzdHJveShhYkJvdHMpOwogICAgICAgIH0KICAgIGAsCiAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMAp9KQoKcmV0dXJuIG9wdGlvbnM7JwCQlauOAZqWAR5hYkNyZWF0ZVRvb2xib3hEcm9wZG93bk9wdGlvbnMCBACQlauOAZv0AuMTQGNvbnN0IHRvb2xib3hUb29scyA9IFsuLi50aGF0LnRvb2xBcnJheV0gPz8gW107DQpjb25zdCB0b29sYm94TmFtZSA9IHRoYXQudG9vbGJveE5hbWUgPz8gIktpdCAiOw0KY29uc3QgdG9vbGJveCA9IHRoYXQudG9vbGJveDsNCmNvbnN0IGdyaWRJbmZvcm1hdGlvbiA9ICh0aGF0Py5ncmlkSW5mb3JtYXRpb24gJiYgdGhhdD8uZ3JpZEluZm9ybWF0aW9uICE9IHVuZGVmaW5lZCkgPyB0aGF0Py5ncmlkSW5mb3JtYXRpb24gOiBhYlJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQoNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMudG9vbGJveCA9IGdldExpbmsodG9vbGJveCk7DQptZW51T3B0aW9ucy5ncmlkSW5mb3JtYXRpb24gPSBncmlkSW5mb3JtYXRpb247DQptZW51T3B0aW9ucy5zZWFyY2ggPSB0YWdzLnNlYXJjaDsNCm1lbnVPcHRpb25zLmFydGlmYWN0ID0gdGFncy5hcnRpZmFjdDsNCi8vbWVudU9wdGlvbnMuZm9ybUFkZHJlc3MgPSAiaGFyZHdhcmUiOw0KDQppZiAodG9vbGJveFRvb2xzLmxlbmd0aCA9PT0gMCkgew0KICAgIGNvbnN0IG1lc3NhZ2UgPSB0b29sYm94TmFtZSArICIgZG9lcyBub3QgaGF2ZSBhbnkgdG9vbHMgbGlzdGVkIGluIHRoZSB0b29sX2FycmF5IHRhZyI7DQoNCiAgICBhYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIG1lc3NhZ2UpOw0KICAgIG9zLnRvYXN0KG1lc3NhZ2UsIDUpOw0KICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7DQp9DQoNCmZvciAobGV0IHRvb2wgb2YgdG9vbGJveFRvb2xzKSB7DQogICAgY29uc3QgdG9vbEJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiB0b29sLm5hbWUsDQogICAgICAgIHRhcmdldEFCOiB0b29sLnRhcmdldEFCLA0KICAgICAgICBpc0FydGlmYWN0OiB0b29sLmFydGlmYWN0IHx8IGZhbHNlLA0KICAgICAgICBvbkNsaWNrOmBADQogICAgICAgICAgICBpZiAodGFncy5pc0FydGlmYWN0KSB7DQogICAgICAgICAgICAgICAgY29uc3QgYWJBcnRpZmFjdFNoYXJkID0gew0KICAgICAgICAgICAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJveEJvdDogdGFncy50b29sYm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzOiBbDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUINCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgbGlua3MuYXJ0aWZhY3QuYWJDcmVhdGVBcnRpZmFjdFByb21pc2VCb3Qoew0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0TmFtZTogdGFncy50YXJnZXRBQiwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdEluc3RhbmNlSUQ6IHV1aWQoKSwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdFNoYXJkLA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsNCiAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAndG9vbCcsDQogICAgICAgICAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgLA0KICAgIH07DQoNCiAgICBpZiAodG9vbC5mb3JtQWRkcmVzcykgew0KICAgICAgICB0b29sQnV0dG9uLmZvcm1BZGRyZXNzID0gdG9vbC5mb3JtQWRkcmVzczsNCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaCh0b29sQnV0dG9uKTsNCn0NCg0KcmV0dXJuIGRyb3Bkb3duT3B0aW9uczsnAJCVq44BmpYBEG9uQUJBdXRoQm90QWRkZWQCBACQlauOAf+HAxhAc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsnAJCVq44BmpYBCGFydGlmYWN0AgQAkJWrjgGYiAMo8J+Ulzc4ZTQxNTAzLWM5MzMtNGY4YS04MTdhLWJhOTdiZjhkNWQyNycBBGJvdHMkYzc4YWE2NjMtZDA1Yy00ZWM0LWJjMmMtMjZmZDUxNTYwYjk3AScAkJWrjgG/iAMIYWJJZ25vcmUCBACQlauOAcCIAwR0cnVlJwCQlauOAb+IAwthYkludGVyZmFjZQIEAJCVq44BxYgDBHRydWUnAJCVq44Bv4gDBnN5c3RlbQIEAJCVq44ByogDGGFiLmludGVyZmFjZS5ib3RfZmFjdG9yeScAkJWrjgG/iAMWYWJDcmVhdGVCaWxsYm9hcmRMYWJlbAIEAJCVq44B44gDjEJAY29uc3QgeyAKICAgIGJvdCwKICAgIGRpbWVuc2lvbiwKICAgIHByZXNlcnZlTmV3TGluZXMgPSB0cnVlLAogICAgbGFiZWwgPSAnJywKICAgIHNwYWNlID0gJ3RlbXBMb2NhbCcsCiAgICBjb2xvciA9ICd3aGl0ZScsCiAgICBsYWJlbENvbG9yID0gJ2JsYWNrJywKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge307Cgphc3NlcnQobGlua3MudXRpbHMuaXNCb3QoYm90KSwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3QgaXMgYSByZXF1aXJlZCBCb3QgcGFyYW1ldGVyLmApOwphc3NlcnQoZGltZW5zaW9uLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRpbWVuc2lvbiBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKYXNzZXJ0KHJlc3Qub25DcmVhdGUgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25BbnlCb3RzQ2hhbmdlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkFueUJvdHNSZW1vdmVkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LnVwZGF0ZUxhYmVsID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LmxhYmVsV29yZFdyYXBNb2RlID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbGFiZWxXb3JkV3JhcE1vZGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CgovLyAtLS0gMSkgV29yZCBicmVha2luZyAod3JhcCBieSB3b3JkcywgY2h1bmsgbG9uZyB3b3JkcykgLS0tCmZ1bmN0aW9uIGJyZWFrV29yZHNUb0xpbmVzKHRleHQsIG1heENvbHMgPSAxOCkgewogICAgaWYgKCF0ZXh0KSByZXR1cm4gWycnXTsKICAgIGNvbnN0IHdvcmRzID0gdGV4dC5zcGxpdCgvXHMrLykuZmlsdGVyKEJvb2xlYW4pOwogICAgY29uc3QgbGluZXMgPSBbXTsKICAgIGxldCBsaW5lID0gJyc7CgogICAgY29uc3QgcHVzaCA9ICgpID0+IHsgbGluZXMucHVzaChsaW5lKTsgbGluZSA9ICcnOyB9OwoKICAgIGZvciAoY29uc3QgdyBvZiB3b3JkcykgewogICAgICAgIGlmICh3Lmxlbmd0aCA+IG1heENvbHMpIHsKICAgICAgICAgICAgLy8gY2xvc2UgY3VycmVudCBsaW5lIChpZiBhbnkpIGJlZm9yZSBjaHVua2luZyBhIGxvbmcgd29yZAogICAgICAgICAgICBpZiAobGluZSkgcHVzaCgpOwogICAgICAgICAgICAvLyBjaHVuayB0aGUgbG9uZyB3b3JkCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdy5sZW5ndGg7IGkgKz0gbWF4Q29scykgewogICAgICAgICAgICAgICAgbGluZXMucHVzaCh3LnNsaWNlKGksIGkgKyBtYXhDb2xzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZSA9ICcnOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgewogICAgICAgICAgICBsaW5lID0gdzsKICAgICAgICB9IGVsc2UgaWYgKGxpbmUubGVuZ3RoICsgMSArIHcubGVuZ3RoIDw9IG1heENvbHMpIHsKICAgICAgICAgICAgbGluZSArPSAnICcgKyB3OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHB1c2goKTsKICAgICAgICAgICAgbGluZSA9IHc7CiAgICAgICAgfQogICAgfQogICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoKCk7CgogICAgcmV0dXJuIGxpbmVzLmxlbmd0aCA/IGxpbmVzIDogWycnXTsKfQoKLy8gUHJlc2VydmVzIGV4aXN0aW5nIFxuIGFzIGhhcmQgYnJlYWtzOyB3cmFwcyB3aXRoaW4gZWFjaCBoYXJkIGxpbmUuCmZ1bmN0aW9uIGJyZWFrV29yZHNUb0xpbmVzUHJlc2VydmVOZXdsaW5lcyh0ZXh0LCBtYXhDb2xzID0gMTgpIHsKICBpZiAodGV4dCA9PSBudWxsKSByZXR1cm4gWycnXTsKCiAgLy8gU3BsaXQgb24gcmVhbCBuZXdsaW5lczsga2VlcCBlbXB0eSBsaW5lcyBzbyB3ZSBwcmVzZXJ2ZSBibGFuayBsaW5lcy4KICBjb25zdCBoYXJkTGluZXMgPSBTdHJpbmcodGV4dCkuc3BsaXQoL1xyP1xuLyk7CiAgY29uc3Qgb3V0ID0gW107CgogIC8vIEhlbHBlciB0byB3cmFwIGEgc2luZ2xlIGhhcmQgbGluZSBieSB3b3JkcyAod2l0aCBsb25nLXdvcmQgY2h1bmtpbmcpCiAgY29uc3Qgd3JhcE9uZSA9IChzcmMpID0+IHsKICAgIC8vIE5vcm1hbGl6ZSB0YWJzIC0+IHNwYWNlczsgY29sbGFwc2UgaW50ZXJuYWwgd2hpdGVzcGFjZSAobm90IG5ld2xpbmVzKQogICAgY29uc3QgcyA9IHNyYy5yZXBsYWNlKC9cdC9nLCAnICAgICcpLnJlcGxhY2UoL1xzKy9nLCAnICcpLnRyaW0oKTsKICAgIGlmICghcy5sZW5ndGgpIHsgb3V0LnB1c2goJycpOyByZXR1cm47IH0KCiAgICBjb25zdCB3b3JkcyA9IHMuc3BsaXQoJyAnKTsKICAgIGxldCBsaW5lID0gJyc7CgogICAgY29uc3QgcHVzaExpbmUgPSAoKSA9PiB7IG91dC5wdXNoKGxpbmUpOyBsaW5lID0gJyc7IH07CgogICAgLy8gY2h1bmsgbG9uZyB3b3JkcyB0byBlbXVsYXRlICdicmVha1dvcmRzJwogICAgY29uc3QgY2h1bmtXb3JkID0gKHcpID0+IHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3Lmxlbmd0aDsgaSArPSBtYXhDb2xzKSB7CiAgICAgICAgY29uc3QgY2h1bmsgPSB3LnNsaWNlKGksIGkgKyBtYXhDb2xzKTsKICAgICAgICBpZiAoIWxpbmUubGVuZ3RoKSBsaW5lID0gY2h1bms7CiAgICAgICAgZWxzZSB7IHB1c2hMaW5lKCk7IGxpbmUgPSBjaHVuazsgfQogICAgICB9CiAgICB9OwoKICAgIGZvciAoY29uc3QgdyBvZiB3b3JkcykgewogICAgICBpZiAody5sZW5ndGggPiBtYXhDb2xzKSB7CiAgICAgICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoTGluZSgpOwogICAgICAgIGNodW5rV29yZCh3KTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIWxpbmUubGVuZ3RoKSB7CiAgICAgICAgbGluZSA9IHc7CiAgICAgIH0gZWxzZSBpZiAobGluZS5sZW5ndGggKyAxICsgdy5sZW5ndGggPD0gbWF4Q29scykgewogICAgICAgIGxpbmUgKz0gJyAnICsgdzsKICAgICAgfSBlbHNlIHsKICAgICAgICBwdXNoTGluZSgpOwogICAgICAgIGxpbmUgPSB3OwogICAgICB9CiAgICB9CiAgICBpZiAobGluZS5sZW5ndGgpIHB1c2hMaW5lKCk7CiAgfTsKCiAgZm9yIChjb25zdCBobCBvZiBoYXJkTGluZXMpIHsKICAgIHdyYXBPbmUoaGwpOyAgICAgICAgICAgLy8gd3JhcCB3aXRoaW4gdGhpcyBoYXJkIGxpbmUKICB9CgogIC8vIElmIHRoZSBpbnB1dCBlbmRlZCB3aXRoIGEgdHJhaWxpbmcgbmV3bGluZSwgd2UgYWxyZWFkeSBwcmVzZXJ2ZWQgaXQKICAvLyBiZWNhdXNlIHNwbGl0IGtlcHQgYW4gZW1wdHkgbGFzdCBpdGVtIC0+IGJlY2FtZSBhbiBlbXB0eSB3cmFwcGVkIGxpbmUuCiAgcmV0dXJuIG91dC5sZW5ndGggPyBvdXQgOiBbJyddOwp9CgovLyAtLS0gMikgU2ltcGxlIHNpemluZyBmcm9tIGxpbmVzIC0tLQovLyBUaGluayBvZiAiY29sc1BlclNjYWxlWCIgYXMgImFib3V0IE4gY2hhcmFjdGVycyBwZXIgMSBzY2FsZVgiLgpmdW5jdGlvbiBjb21wdXRlU2ltcGxlU2NhbGVzRnJvbUxpbmVzKGxpbmVzLCB7CiAgICBjb2xzUGVyU2NhbGVYID0gMi41LAogICAgbWluU2NhbGVYID0gMS4yNSwKICAgIG1heFNjYWxlWCA9IDEwLAogICAgYmFzZVNjYWxlWSA9IDEuMiwKICAgIHBlckxpbmVZID0gMC43NSwKfSA9IHt9KSB7CiAgICBjb25zdCBsb25nZXN0ID0gbGluZXMucmVkdWNlKChtLCBsKSA9PiBNYXRoLm1heChtLCBsLmxlbmd0aCksIDApOwogICAgY29uc3QgbGluZUNvdW50ID0gTWF0aC5tYXgoMSwgbGluZXMubGVuZ3RoKTsKCiAgICAvLyBXaWR0aCBzY2FsZXMgd2l0aCB0aGUgbG9uZ2VzdCBsaW5lIGxlbmd0aAogICAgbGV0IHNjYWxlWCA9IGxvbmdlc3QgPiAwID8gKGxvbmdlc3QgLyBjb2xzUGVyU2NhbGVYKSA6IG1pblNjYWxlWDsKICAgIHNjYWxlWCA9IE1hdGgubWF4KG1pblNjYWxlWCwgTWF0aC5taW4obWF4U2NhbGVYLCBzY2FsZVgpKTsKCiAgICAvLyBIZWlnaHQgZ3Jvd3MgcGVyIGxpbmU7IGtlZXAgaXQgc2ltcGxlIGFuZCBwcmVkaWN0YWJsZQogICAgY29uc3Qgc2NhbGVZID0gTWF0aC5tYXgoYmFzZVNjYWxlWSwgYmFzZVNjYWxlWSArIChsaW5lQ291bnQgLSAxKSAqIHBlckxpbmVZKTsKCiAgICByZXR1cm4geyBzY2FsZVgsIHNjYWxlWSwgbG9uZ2VzdCwgbGluZUNvdW50IH07Cn0KCgovLyBQaWNrIHlvdXIgdGFyZ2V0ICJjb2x1bW5zIiBwZXIgbGluZSAodHdlYWsgdG8gdGFzdGUpCmNvbnN0IE1BWF9DT0xTID0gMzI7CgovLyBCcmVhayB0aGUgdGV4dCB5b3Vyc2VsZgpjb25zdCBsaW5lcyA9IHByZXNlcnZlTmV3TGluZXMgPyBicmVha1dvcmRzVG9MaW5lc1ByZXNlcnZlTmV3bGluZXMobGFiZWwsIE1BWF9DT0xTKSA6IGJyZWFrV29yZHNUb0xpbmVzKGxhYmVsLCBNQVhfQ09MUyk7CmNvbnN0IHdyYXBwZWRMYWJlbCA9IGxpbmVzLmpvaW4oJ1xuJyk7CgovLyBDb21wdXRlIHNpbXBsZSBzY2FsZXMgZnJvbSB0aGUgd3JhcHBlZCB0ZXh0CmNvbnN0IHsgc2NhbGVYLCBzY2FsZVkgfSA9IGNvbXB1dGVTaW1wbGVTY2FsZXNGcm9tTGluZXMobGluZXMpOwoKbGV0IGxhYmVsTW9kID0gewogICAgc3BhY2U6IHNwYWNlLAogICAgdHJhY2tCb3RJZDogYm90LmlkLAogICAgZm9ybTogJ3Nwcml0ZScsCiAgICBjb2xvciwKICAgIGxhYmVsOiB3cmFwcGVkTGFiZWwsCiAgICBsYWJlbENvbG9yLAogICAgbGFiZWxTaXplOiAxLAogICAgbGFiZWxQYWRkaW5nWDogMC41LAogICAgbGFiZWxXb3JkV3JhcE1vZGU6ICdub25lJywKICAgIHNjYWxlWCwgCiAgICBzY2FsZVksCiAgICBzY2FsZVo6IDAuMSwKICAgIGJvdExhYmVsTWFyZ2luOiAxLAogICAgYW5jaG9yUG9pbnQ6ICfinqHvuI8wLC0wLjUsMCcsCiAgICBvcmllbnRhdGlvbk1vZGU6ICdiaWxsYm9hcmQnLAogICAgZGltZW5zaW9uOiBkaW1lbnNpb24sCiAgICBkZWJ1ZzogZmFsc2UsCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBvbkNyZWF0ZTogYEAKICAgICAgICAvLyBXYWl0IGZvciByZXF1aXJlZCBib3RzIHRvIGJlIHJlYWR5LgogICAgICAgIGxldCB3YWl0VGltZSA9IDA7CgogICAgICAgIHdoaWxlKCFnbG9iYWxUaGlzLmFiKSB7CiAgICAgICAgICAgIGlmICh3YWl0VGltZSA+PSA1MDAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IG9zLnNsZWVwKDI1MCk7CiAgICAgICAgICAgIHdhaXRUaW1lICs9IDI1MDsKICAgICAgICB9CgogICAgICAgIHRhZ3MucmVhZHkgPSB0cnVlOwogICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgIGAsCiAgICBvbkFueUJvdHNDaGFuZ2VkOiBgQAoKICAgICAgICBmb3IgKGNvbnN0IGNoYW5nZWQgb2YgdGhhdCkgewogICAgICAgICAgICBpZiAoY2hhbmdlZC5ib3QgJiYgY2hhbmdlZC5ib3QuaWQgPT09IHRhZ3MudHJhY2tCb3RJZCkgewogICAgICAgICAgICAgICAgY29uc3Qgb25seVJvdGF0aW9uVGFncyA9IGNoYW5nZWQudGFncy5ldmVyeSgodCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmVuZHNXaXRoKCdSb3RhdGlvbicpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWCcpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWScpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWicpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBvbmx5Um90YXRpb25UYWdzOicsIG9ubHlSb3RhdGlvblRhZ3MpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChvbmx5Um90YXRpb25UYWdzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGAsCiAgICBvbkFueUJvdHNSZW1vdmVkOiBgQAoKICAgICAgICBpZiAodGhhdC5ib3RJRHMuaW5jbHVkZXModGFncy50cmFja0JvdElkKSkgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgIH0KICAgIGAsCiAgICBvblBvcnRhbENoYW5nZWQ6IGBACiAgICAgICAgaWYgKHRoYXQuZGltZW5zaW9uID09PSB0YWdzLmRpbWVuc2lvbikgewogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICAgICAgfQogICAgYCwKICAgIHVwZGF0ZUxhYmVsOiBgQAogICAgICAgIGlmICghdGFncy5yZWFkeSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yaW5nIHVwZGF0ZUxhYmVsIGJlY2F1c2Ugbm90IHJlYWR5Jyk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBpbk1hcFBvcnRhbCA9IChjb25maWdCb3QudGFncy5tYXBQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBjb25zdCBpbkdyaWRQb3J0YWwgPSAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKCFpbk1hcFBvcnRhbCAmJiAhaW5HcmlkUG9ydGFsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yZSB1cGRhdGVMYWJlbCBjYWxsLCBub3QgaW4gZWl0aGVyIGdyaWQgb3IgbWFwIHBvcnRhbC4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCB0cmFja0JvdCA9IGdldEJvdCgnaWQnLCB0YWdzLnRyYWNrQm90SWQpOwogICAgICAgIGNvbnN0IHRyYWNrUG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbih0cmFja0JvdCwgdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIHRyYWNrUG9zaXRpb246JywgdHJhY2tQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICBsZXQgbGFiZWxQb3NpdGlvbiA9IHsgeDogdHJhY2tQb3NpdGlvbi54LCB5OiB0cmFja1Bvc2l0aW9uLnksIHo6IHRyYWNrUG9zaXRpb24ueiB9OyAKCiAgICAgICAgY29uc3QgdHJhY2tCb3RTY2FsZSA9IHRyYWNrQm90LnRhZ3Muc2NhbGUgPz8gMTsKICAgICAgICBjb25zdCB0cmFja0JvdFNjYWxlWiA9IHRyYWNrQm90LnRhZ3Muc2NhbGVaID8/IDE7CgogICAgICAgIGxldCBtZXRlcnNQZXJHcmlkVW5pdCA9IDE7CgogICAgICAgIGlmIChpbk1hcFBvcnRhbCkgewogICAgICAgICAgICAvLyBTY2FsZSB0byBtYXAgcG9ydGFsIHVuaXRzLgogICAgICAgICAgICBtZXRlcnNQZXJHcmlkVW5pdCA9IDEwOwogICAgICAgIH0KCiAgICAgICAgbGV0IHRyYWNrQm90UmVhbFNjYWxlWiA9ICh0cmFja0JvdFNjYWxlWiAqIHRyYWNrQm90U2NhbGUpICogbWV0ZXJzUGVyR3JpZFVuaXQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gdHJhY2tCb3RSZWFsU2NhbGVaOicsIHRyYWNrQm90UmVhbFNjYWxlWik7CiAgICAgICAgfQoKICAgICAgICBsYWJlbFBvc2l0aW9uLnogKz0gdHJhY2tCb3RSZWFsU2NhbGVaICsgKHRhZ3MuYm90TGFiZWxNYXJnaW4gKiBtZXRlcnNQZXJHcmlkVW5pdCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gbGFiZWxQb3NpdGlvbjonLCBsYWJlbFBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWCddID0gbGFiZWxQb3NpdGlvbi54OwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWSddID0gbGFiZWxQb3NpdGlvbi55OwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWiddID0gbGFiZWxQb3NpdGlvbi56OwogICAgYAp9OwoKbGFiZWxNb2QgPSB7CiAgICAuLi5sYWJlbE1vZCwKICAgIC4uLnJlc3QsCn0KCmNvbnN0IGxhYmVsQm90ID0gY3JlYXRlKGxhYmVsTW9kKTsKCnJldHVybiBsYWJlbEJvdDsnAJCVq44Bv4gDBXV0aWxzAgQAkJWrjgHsygMo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAkJWrjgG/iAMEZm9ybQIEAJCVq44Bk8sDB25vdGhpbmcnAJCVq44Bv4gDCWFiVmVyc2lvbgIEAJCVq44Bm8sDBTEwLjEwAA=="}]}