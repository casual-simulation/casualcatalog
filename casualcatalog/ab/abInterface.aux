{"version":2,"updates":[{"id":0,"timestamp":1766084274686,"update":"Ae4Bg/W4MQAnAQRib3RzJDEzZjMzYTUxLWMyZmEtNDZkYS1hODhlLWU1YzA2NzU1NmQwMgEnAIP1uDEACmFiSURPcmlnaW4CBACD9bgxAQ10b29sYm94X3NraWxsJwCD9bgxAAthYkludGVyZmFjZQIEAIP1uDEPBHRydWUnAIP1uDEAC2Rlc2NyaXB0aW9uAgQAg/W4MRQpVGhpcyBza2lsbCBpcyBhbiBpbnRlcmZhY2UgZm9yIHRvb2xib3hlcy4nAIP1uDEABGZvcm0CBACD9bgxPgdub3RoaW5nJwCD9bgxAARtZW51AgQAg/W4MUYo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAg/W4MQAGc3lzdGVtAgQAg/W4MW0UYWIuaW50ZXJmYWNlLnRvb2xib3gnAIP1uDEACmFiSURTdHVkaW8CBACD9bgxggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwCD9bgxAAhyZW1lbWJlcgIEAIP1uDGnASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCD9bgxAAt0b29sYm94X2FkZAIEAIP1uDHOAcgLQGNvbnN0IHRvb2xib3hEYXRhID0gdGhhdC50b29sYm94RGF0YTsKY29uc3QgdG9vbGJveFRpdGxlID0gdG9vbGJveERhdGEudGl0bGU7CmNvbnN0IHRvb2xib3hOYW1lID0gdG9vbGJveERhdGEubmFtZTsKY29uc3QgdG9vbGJveFN0dWRpbyA9IHRvb2xib3hEYXRhLnN0dWRpbzsKY29uc3QgZ3JpZERhdGEgPSB0aGF0LmdyaWREYXRhOwoKLy9MT0FESU5HIEJBUj8KCmlmICghbGlua3Muc2hlbGxVdGlscykgewogICAgLy8gTmVlZCBhYlNoZWxsIHRvIHVzZSBpdCdzIGFiTG9nIGZ1bmN0aW9uLgogICAgbGlua3MubGVhcm4uYWJBZGFwdCgnYWJTaGVsbCcpOwp9CgppZiAodG9vbGJveFN0dWRpbyA9PSBmYWxzZSkgewogICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdCh0b29sYm94TmFtZSk7CiAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKGAke3Rvb2xib3hUaXRsZSA/PyB0b29sYm94TmFtZX0gbG9hZGVkYCk7Cn0KZWxzZSB7CiAgICBjb25zdCB0b29sYm94TG9va3VwID0gYXdhaXQgbGlua3Muc2VhcmNoLmhhdGNoKHsgYWJJRDogdG9vbGJveE5hbWUsIHJlY29yZEtleTogdG9vbGJveFN0dWRpbywgYXV0b0hhdGNoOiB0cnVlIH0pOwoKICAgIGlmICh0b29sYm94TG9va3VwLnN1Y2Nlc3MpIHsKICAgICAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKGAke3Rvb2xib3hUaXRsZSA/PyB0b29sYm94TmFtZX0gbG9hZGVkYCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYGlzc3VlIGxvYWRpbmcgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9LCBwbGVhc2UgdHJ5IGFnYWluYCwgbG9nVHlwZTogJ2Vycm9yJyB9KTsKICAgIH0KfQoKY29uc3QgYWN0aXZlVG9vbGJveCA9IGdldEJvdCgic3lzdGVtIiwgYGFiLnRvb2xib3guJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9YCk7CgppZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJHcmlkTWVudU9uQmVmb3JlQ3JlYXRlKSB7CiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkdyaWRGb2N1cyA9IGdyaWREYXRhOwogICAgYXdhaXQgYWIubGlua3MubWVudS5hYk9wZW5NZW51KCJncmlkIik7CiAgICBjb25zdCBtZW51Qm90ID0gZ2V0Qm90KCJiYXNlU2tpbGwiLCBnZXRMaW5rKGFjdGl2ZVRvb2xib3gpKTsKICAgIGlmIChtZW51Qm90KSB7CiAgICAgICAgbWVudUJvdC5vblBvaW50ZXJVcCgpOwogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScAg/W4MQAFbGVhcm4CBACD9bgxlw0o8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAg/W4MQAFc3RvcmUCBACD9bgxvg0o8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAg/W4MQAGc2VhcmNoAgQAg/W4MeUNKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAIP1uDEACGFiSWdub3JlAgQAg/W4MYwOBHRydWUnAIP1uDEACWFiVmVyc2lvbgIEAIP1uDGRDgUxMC4zNScAg/W4MQANbWFuaWZlc3RhdGlvbgIEAIP1uDGXDijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCD9bgxABBhYkdyaWRNZW51QWN0aW9uAgQAg/W4Mb4OuQtALy8gc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCi8vIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgovLyB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKLy8gICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKLy8gYDsKLy8gdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAovLyAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKLy8gICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwovLyAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyAgICAgfQovLyBgOwovLyB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBgQAovLyAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBudWxsOwovLyBgOwoKLy8gY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7Ci8vIGNvbnN0IG1lbnVCb3QgPSB7fTsKCi8vIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsKLy8gbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwovLyBtZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKLy8gbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKLy8gbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsKLy8gbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwovLyBtZW51Qm90Lm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsKCi8vIGZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspCi8vIHsKLy8gICAgIGNvbnN0IGFjdGl2ZVRvb2xib3ggPSBwb3NzaWJsZVRvb2xib3hlc1tpXTsKLy8gICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7CgovLyAgICAgbWVudUJvdC50b29sYm94X2RhdGEgPSBhY3RpdmVUb29sYm94OwovLyAgICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOwoKLy8gICAgIGlmICghZXh0YW50Qm90KQovLyAgICAgewovLyAgICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCb3QpOwovLyAgICAgfQovLyB9JwCD9bgxABRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAIP1uDH4GeICQGNvbnN0IHRvb2xib3hBcnJheSA9IGFiUmVtZW1iZXIudGFncy50b29sYm94X2FycmF5OwoKbGV0IGFsbFRvb2xzTG9hZGVkID0gdHJ1ZTsKCmZvciAobGV0IGkgPSAwOyBpIDwgdG9vbGJveEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBjdXJyZW50VG9vbCA9IHRvb2xib3hBcnJheVtpXS5uYW1lOwoKICAgIGlmICghZ2V0Qm90KCJhYklET3JpZ2luIiwgY3VycmVudFRvb2wpICYmICFnZXRCb3QoY3VycmVudFRvb2wsIHRydWUpKSB7CiAgICAgICAgYWxsVG9vbHNMb2FkZWQgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgIH0KfQoKaWYgKGFsbFRvb2xzTG9hZGVkKSB7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwCD9bgxAA5hYkdyaWRNZW51SWNvbgIEAIP1uDHbHApsb2NhbF9tYWxsJwCD9bgxAA9hYkdyaWRNZW51TGFiZWwCBACD9bgx5hwHY2F0YWxvZycAg/W4MQATYWJHcmlkTWVudVNvcnRPcmRlcgIEAIP1uDHuHAMxMDAnAIP1uDEAD29uQUJJbml0aWFsaXplZAIEAIP1uDHyHCpALy8gbGlua3MubGVhcm4uYWJBZGFwdCgiY2FzdWFsX3Rvb2xib3giKTsnAIP1uDEADW9uU2tpbGxVcGRhdGUCBACD9bgxnR1XQGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7DQoNCmNvbnNvbGUubG9nKCJbVG9vbGJveF0gTG9hZGluZyBjYXN1YWwga2l0Iik7JwCD9bgxAApzaGVsbFV0aWxzAgQAg/W4MfUdKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAIP1uDEAGGFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZQIEAIP1uDGcHtQJQGlmIChhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQ2F0YWxvZ05hbWUpIHsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkdyaWRNZW51TGFiZWwiLCBhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQ2F0YWxvZ05hbWUpOw0KfQ0KDQoNCi8vTkVXDQpjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspDQp7DQogICAgY29uc3QgbWVudUJvdCA9IHt9Ow0KDQogICAgbWVudUJvdC5hYk1lbnUgPSB0cnVlOw0KICAgIG1lbnVCb3QuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCiAgICBtZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsNCiAgICBtZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOw0KICAgIG1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiYWRkX2JveCI7DQogICAgbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOw0KICAgIG1lbnVCb3Qub25DbGljayA9IGBAIA0KICAgICAgICBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IA0KICAgICAgICBzZXRUYWdNYXNrKGFiLmxpbmtzLnJlbWVtYmVyLCAibGFzdE9wZW5lZERyb3Bkb3duIiwgbnVsbCk7DQogICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsNCiAgICANCiAgICBjb25zdCBhY3RpdmVUb29sYm94ID0gcG9zc2libGVUb29sYm94ZXNbaV07DQogICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsNCg0KICAgIG1lbnVCb3QudG9vbGJveF9kYXRhID0gYWN0aXZlVG9vbGJveDsNCiAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7DQoNCiAgICBpZiAoIWV4dGFudEJvdCkNCiAgICB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKG1lbnVCb3QpOw0KICAgIH0NCn0NCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwCD9bgxABJhYkdyaWRNZW51SXRlbVR5cGUCBACD9bgx8ScIZHJvcGRvd24nAIP1uDEAEWRyb3Bkb3duU29ydE9yZGVyAgQAg/W4MfonAzEwMCcAg/W4MQAPZHJvcGRvd25PcHRpb25zAgQAg/W4Mf4nBvCfp6xbXScBBGJvdHMkMTc0MTBkODMtN2VlZS00YTFlLWI2MzgtNjU0NjM3NGQxN2MzAScAg/W4MYMoBnN5c3RlbQIEAIP1uDGEKBFhYi5pbnRlcmZhY2Uuc2NhbicAg/W4MYMoBGZvcm0CBACD9bgxligHbm90aGluZycAg/W4MYMoC2FiSW50ZXJmYWNlAgQAg/W4MZ4oBHRydWUnAIP1uDGDKAhhYklnbm9yZQIEAIP1uDGjKAR0cnVlJwCD9bgxgygPb25RUkNvZGVTY2FubmVkAgQAg/W4Mago/Q9AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgpsZXQgcmVxdWVzdGluZ0FJID0gZmFsc2U7CmlmIChjb25maWdCb3QudGFncy5yZXF1ZXN0aW5nQUkpIHsKICAgIGNvbmZpZ0JvdC50YWdzLnJlcXVlc3RpbmdBSSA9IG51bGw7CiAgICByZXF1ZXN0aW5nQUkgPSB0cnVlOwp9CgppZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhc2siKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBpZiAocmVxdWVzdGluZ0FJKSB7CiAgICAgICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgicmVxdWVzdGluZ0FJIiwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIG9zLmdvVG9VUkwoc2Nhbm5lZFVSTC5ocmVmKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7CiAgICAgICAgICAgIGxldCBuZXdUYWcgPSBrZXk7CiAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3NbbmV3VGFnXSA9IG5ld1ZhbHVlOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuYXNrKSB7CiAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogY29uZmlnQm90LnRhZ3MuYXNrfSk7CiAgICAgICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5wYXR0ZXJuKSB7CiAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogY29uZmlnQm90LnRhZ3MucGF0dGVybn0pOwogICAgICAgIH0KICAgICAgICAKICAgIH0KfScAg/W4MYMoBXN0b3JlAgQAg/W4MaY4KPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAIP1uDGDKAZzZWFyY2gCBACD9bgxzTgo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAg/W4MYMoEGFiQ29yZU1lbnVBY3Rpb24CBACD9bgx9Dg3QG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7Cgpjb25maWdCb3QudGFncy5hYlNjYW4gPSB0cnVlOycAg/W4MYMoD2FiQ29yZU1lbnVMYWJlbAIEAIP1uDGsOQRzY2FuJwCD9bgxgygOYWJDb3JlTWVudUljb24CBACD9bgxsTkPcXJfY29kZV9zY2FubmVyJwCD9bgxgygTYWJDb3JlTWVudVNvcnRPcmRlcgIEAIP1uDHBOQEzJwCD9bgxgygJYWJWZXJzaW9uAgQAg/W4McM5BTEwLjM1JwEEYm90cyQzYTZjYjljYS1iM2I0LTRkNzctODJmNi1mYTU5YjUyOTZlYzkBJwCD9bgxyTkGc3lzdGVtAgQAg/W4Mco5F2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwCD9bgxyTkIYWJJZ25vcmUCBACD9bgx4jkEdHJ1ZScAg/W4Mck5D2Ryb3Bkb3duT3B0aW9ucwIEAIP1uDHnOQbwn6esW10nAIP1uDHJORJhYkNvcmVNZW51SXRlbVR5cGUCBACD9bgx7DkIZHJvcGRvd24nAIP1uDHJORFkcm9wZG93blNvcnRPcmRlcgIEAIP1uDH1OQRhdXRvJwCD9bgxyTkYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQAg/W4Mfo5/iBAY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IGN1cnJlbnREaW0gPSBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uOw0KY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCg0KLy8gaWYgKGN1cnJlbnRQb3J0YWwgIT0gJ21hcCcpIHsNCi8vICAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gdHJ1ZTsNCi8vIH0gZWxzZSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IGZhbHNlOw0KLy8gfQ0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJOYXZpZ2F0aW9uTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuc2tpbGxCb3QgPSBnZXRMaW5rKHRoaXNCb3QpOw0KDQpjb25zdCBob21lV29ybGRCdXR0b24gPSB7DQogICAgLi4ubWVudU9wdGlvbnMsDQogICAgbGFiZWw6ICJob21lIHdvcmxkIiwNCiAgICBmb3JtQWRkcmVzczogJ2h0dHBzOi8vYXV0aC1hdXgtZGV2LWZpbGVzYnVja2V0LTY4MjM5NzY5MDY2MC5zMy5hbWF6b25hd3MuY29tLzMxOGMwNGYxLTEzOTEtNGMxMC04ZDQzLWFhZWJjNTE3MDI2NS8zOGFlOGI2OTU3ZjQ0ODNkODcxNjE0MWQxZTk4YzkzZjBlN2RjY2UxNWJjNWMxMjNiZDBlOWUxYWI2ODdjYzA1LnBuZycsDQogICAgb25DbGljazogYEANCiAgICAgICAgY29uc3QgY3VycmVudFVSTCA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKTsNCiAgICAgICAgY29uc3Qgb3JpZ2luID0gY3VycmVudFVSTC5vcmlnaW47DQoNCiAgICAgICAgbGV0IG5ld1VSTCA9IG5ldyBVUkwob3JpZ2luKTsNCg0KICAgICAgICBpZiAoYWJSZW1lbWJlci50YWdzLmFsbG93Q2hhbm5lbHMpIHsNCiAgICAgICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJjaGFubmVsIiwgZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmNvbUlkKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY29tSWQiLCBjb25maWdCb3QudGFncy5jb21JZCk7DQogICAgICAgIH0NCg0KICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgib3duZXIiLCAoY29uZmlnQm90LnRhZ3Muc3R1ZGlvICYmIGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAhPSBhdXRoQm90LmlkKSA/IGNvbmZpZ0JvdC50YWdzLnN0dWRpbyA6ICJwbGF5ZXIiKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImluc3QiLCAnaG9tZScpOw0KICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgibWFwUG9ydGFsIiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImFzayIsICdob21lJyk7DQogICAgICAgIA0KICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Muc3R1ZGlvICYmIGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAhPSBhdXRoQm90LmlkKSB7DQogICAgICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJzdHVkaW8iLCB0aGF0LmlkKTsgDQogICAgICAgIH0NCg0KICAgICAgICBvcy5vcGVuVVJMKG5ld1VSTC5ocmVmKTsNCiAgICBgDQp9Ow0KDQppZiAoIWdldEJvdCgiaXNIb21lV29ybGRDb3JlIiwgdHJ1ZSkgJiYgYXV0aEJvdCkgew0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGhvbWVXb3JsZEJ1dHRvbik7DQp9DQoNCmlmIChjdXJyZW50UG9ydGFsID09ICdtYXAnKSB7DQoNCiAgICBjb25zdCBob21lQmFzZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCg0KICAgIGlmIChob21lQmFzZUJvdCkgew0KICAgICAgICBjb25zdCBob21lQnV0dG9uID0gew0KICAgICAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgICAgICBsYWJlbDogaG9tZUJhc2VCb3QudGFncy5wbGFjZUxhYmVsLA0KICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvY2QzOGFmZmMwNjA0YmVhYTU4OGRhMjFhYTFiZTc1MGJiM2U3M2IzYjNjYWUyM2ViMzAzMDdjMzQ0OTQ0NTlmMy5wbmcnLA0KICAgICAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgICAgICBjb25zdCBob21lQm90ID0gZ2V0Qm90KCJob21lQmFzZSIsIHRydWUpOw0KICAgICAgICAgICAgICAgIGlmIChob21lQm90KSB7DQogICAgICAgICAgICAgICAgICAgIG9zLmZvY3VzT24oaG9tZUJvdCwgeyB6b29tOiAyMDAwIH0pLmNhdGNoKCgpID0+IHt9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIGANCiAgICAgICAgfTsNCg0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lQnV0dG9uKTsNCiAgICB9DQoNCiAgICBjb25zdCBwbGFjZXNBcnIgPSBbXTsNCiAgICBjb25zdCBwbGFjZXMgPSBnZXRCb3RzKCJob21lUGxhY2UiLCB0cnVlKTsNCiAgICBmb3IgKGNvbnN0IGhQbGFjZSBvZiBwbGFjZXMpIHsNCiAgICAgICAgaWYgKGhQbGFjZS50YWdzLmhvbWVCYXNlID09IHRydWUpIHsNCiAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHBsYWNlT2JqID0gew0KICAgICAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgICAgICBsYWJlbDogaFBsYWNlLnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnbG9jYXRpb25fb24nLA0KICAgICAgICAgICAgcGxhY2U6IGdldExpbmsoaFBsYWNlKSwNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgaWYgKGxpbmtzLnBsYWNlKSB7DQogICAgICAgICAgICAgICAgICAgIG9zLmZvY3VzT24obGlua3MucGxhY2UsIHsgem9vbTogMjAwMCB9KS5jYXRjaChlID0+IHt9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgICAgICBgDQogICAgICAgIH0NCg0KICAgICAgICBwbGFjZXNBcnIucHVzaChwbGFjZU9iaik7DQogICAgfQ0KDQogICAgcGxhY2VzQXJyLnNvcnQoKGEsIGIpID0+IHsNCiAgICAgICAgY29uc3QgbmFtZUEgPSBhLmxhYmVsLnRvVXBwZXJDYXNlKCk7DQogICAgICAgIGNvbnN0IG5hbWVCID0gYi5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KDQogICAgICAgIGlmIChuYW1lQSA8IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG5hbWVBID4gbmFtZUIpIHsNCiAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAwOw0KICAgIH0pOw0KDQogICAgZm9yIChjb25zdCBzb3J0ZWRQbGFjZSBvZiBwbGFjZXNBcnIpIHsNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goc29ydGVkUGxhY2UpOw0KICAgIH0NCg0KDQogICAgY29uc3QgY3VycmVudExvY2F0aW9uQnV0dG9uID0gew0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgbGFiZWw6ICdjdXJyZW50IGxvY2F0aW9uJywNCiAgICAgICAgZm9ybUFkZHJlc3M6ICduZWFyX21lJywNCiAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgIGxpbmtzLnNraWxsQm90LmdvVG9DdXJyZW50TG9jYXRpb24oKTsNCiAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgIGANCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChjdXJyZW50TG9jYXRpb25CdXR0b24pOw0KfQ0KDQppZiAoZHJvcGRvd25PcHRpb25zLmxlbmd0aCA9PSAwKSB7DQogICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQp9IGVsc2Ugew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCn0NCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwCD9bgxyTkQYWJDb3JlTWVudUFjdGlvbgIEAIP1uDH5WgNALy8nAIP1uDHJOQthYkludGVyZmFjZQIEAIP1uDH9WgR0cnVlJwCD9bgxyTkPYWJDb3JlTWVudUxhYmVsAgQAg/W4MYJbCXBsYWNlIG5hdicAg/W4Mck5BGZvcm0CBACD9bgxjFsHbm90aGluZycAg/W4Mck5E2dvVG9DdXJyZW50TG9jYXRpb24CBACD9bgxlFuABEBjb25zdCBsb2NhdGlvbiA9IGF3YWl0IG9zLmdldEdlb2xvY2F0aW9uKCk7DQoNCmlmIChsb2NhdGlvbi5zdWNjZXNzKSB7DQogICAgY29uc3QgY3VycmVudERpbSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQogICAgY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQoNCiAgICBpZiAoY3VycmVudFBvcnRhbCAhPSAnbWFwJykgew0KICAgICAgICBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSBjdXJyZW50RGltOw0KICAgIH0NCg0KICAgIG9zLmZvY3VzT24oe3g6IGxvY2F0aW9uLmxvbmdpdHVkZSwgeTogbG9jYXRpb24ubGF0aXR1ZGV9LCB7cG9ydGFsOiAnbWFwJywgem9vbTogMjAwMH0pOw0KfSBlbHNlIHsNCiAgICBvcy50b2FzdCgiTG9jYXRpb24gc2VydmljZXMgbm90IGF2YWlsYWJsZSIpDQp9JwCD9bgxyTkJYWJWZXJzaW9uAgQAg/W4MZVfBTEwLjM1JwEEYm90cyQ0OTNmZmE0ZC00NmQ0LTRhOTgtYWU5Yy0xMjEyZDY1MTEzM2YBJwCD9bgxm18Gc3lzdGVtAgQAg/W4MZxfFGFiLmludGVyZmFjZS52ZXJzaW9uJwCD9bgxm18Nb25Ta2lsbFVwZGF0ZQIEAIP1uDGxX6cBQGNvbnN0IHZlcnNpb25TdHJpbmcgPSB0YWdzLmFiSW50ZXJmYWNlTWFqb3JWZXJzaW9uICsgIi4iICsgdGFncy5hYkludGVyZmFjZU1pbm9yVmVyc2lvbjsNCg0KY29uc29sZS5sb2coIltBQkludGVyZmFjZV0gTG9hZGVkIEFCIEludGVyZmFjZSB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAIP1uDGbXxdhYkludGVyZmFjZU1ham9yVmVyc2lvbgIEAIP1uDHZYAEyJwCD9bgxm18XYWJJbnRlcmZhY2VNaW5vclZlcnNpb24CBACD9bgx22ACMzEnAIP1uDGbXwhhYklnbm9yZQIEAIP1uDHeYAR0cnVlJwCD9bgxm18EZm9ybQIEAIP1uDHjYAdub3RoaW5nJwCD9bgxm18LYWJJbnRlcmZhY2UCBACD9bgx62AEdHJ1ZScAg/W4MZtfCWFiVmVyc2lvbgIEAIP1uDHwYAUxMC4zNScBBGJvdHMkNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmAScAg/W4MfZgBnN5c3RlbQIEAIP1uDH3YBNhYi5pbnRlcmZhY2UubnVnZ2V0JwCD9bgx9mAEZm9ybQIEAIP1uDGLYQdub3RoaW5nJwCD9bgx9mALYWJJbnRlcmZhY2UCBACD9bgxk2EEdHJ1ZScAg/W4MfZgCGFiSWdub3JlAgQAg/W4MZhhBHRydWUnAIP1uDH2YAxhYkxvYWROdWdnZXQCBACD9bgxnWGYAkBsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0TmFtZTsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK251Z2dldE5hbWU7CmxldCBsb2FkZWROdWdnZXQgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGZvcm1hdHRlZE51Z2dldEFCLCBhYlZlcnNpb246IHRoYXQudmVyc2lvbiwgcmV0dXJuVHlwZTogImRhdGEifSk7Cgpsb2FkZWROdWdnZXQgPSBsb2FkZWROdWdnZXQuc3RhdGVbbnVnZ2V0TmFtZV0ubnVnZ2V0OwoKcmV0dXJuIGxvYWRlZE51Z2dldDsnAIP1uDH2YA9hYlB1Ymxpc2hOdWdnZXQCBACD9bgxtmOMA0AvL3Nob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiAibnVnTmFtZSIsIGRhdGE6IGRhdGF9KTsgIEFERCBFR0cgSUQgRVZFTlRVQUxMWQpsZXQgdGVzdE51Z2dldCA9IHRoYXQuZGF0YTsKbGV0IGZvcm1hdHRlZE51Z2dldCA9IHtpZDogdGhhdC5udWcsIG51Z2dldDogdGVzdE51Z2dldH07CmxldCB0ZXN0TnVnZ2V0TmFtZSA9IHRoYXQubnVnOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrdGVzdE51Z2dldE5hbWU7CgptYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBmb3JtYXR0ZWROdWdnZXRBQjsKCmxpbmtzLnN0b3JlLmFiUHVibGlzaEFCKHthYjogZm9ybWF0dGVkTnVnZ2V0QUIsIHRhcmdldDogZm9ybWF0dGVkTnVnZ2V0LCBzb3VyY2VFdmVudDogJ3B1Ymxpc2hfbnVnZ2V0J30pOycAg/W4MfZgD2ltcGxlbWVudE51Z2dldAIEAIP1uDHDZrEHQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXQ7CmxldCBudWdnZXRWZXJzaW9uQ2hlY2sgPSBudWdnZXROYW1lLmluZGV4T2YoIi52Iik7CmxldCB2ZXJzaW9uOwoKaWYgKG51Z2dldFZlcnNpb25DaGVjayAhPSAtMSkKewogICAgbnVnZ2V0TmFtZSA9IG51Z2dldE5hbWUuc3Vic3RyaW5nKDAsIG51Z2dldFZlcnNpb25DaGVjayk7CgogICAgbGV0IHZlcnNpb25DaGVjayA9IHRoYXQubnVnZ2V0LnN1YnN0cmluZyhudWdnZXRWZXJzaW9uQ2hlY2sgKyAyKTsKCiAgICBpZiAoaXNOYU4odmVyc2lvbkNoZWNrKSkKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyh2ZXJzaW9uQ2hlY2ssICJ2ZXJzaW9uIGlzIG5vdCBhIG51bWJlciIpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHZlcnNpb24gPSBOdW1iZXIodmVyc2lvbkNoZWNrKTsKICAgIH0KfQpjb25zb2xlLmxvZyhudWdnZXROYW1lLCB2ZXJzaW9uKTsKbGV0IG51Z0RhdGEgPSBhd2FpdCB0aGlzQm90LmFiTG9hZE51Z2dldCh7bnVnZ2V0TmFtZTogbnVnZ2V0TmFtZSwgdmVyc2lvbjogdmVyc2lvbn0pOwoKaWYgKG51Z0RhdGEgPT0gImFiSUQgbm90IGZvdW5kIikKewogICAgb3MudG9hc3QoIm51Z2dldCBub3QgZm91bmQiKTsKfQplbHNlCnsKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwogICAgbGV0IHRhcmdldFRhZyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLnRvU3RyaW5nKCk7CiAgICBsZXQgdGFyZ2V0TnVnID0gInsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldFRhZy5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwogICAgaW5zZXJ0VGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIG51Z0RhdGEpOwp9JwCD9bgx9mAMbnVnZ2V0QnV0dG9uAgQAg/W4MfVt9QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnAIP1uDH2YAtudWdnZXRQYXJzZQIEAIP1uDHpeqcPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwCD9bgx9mANb25BQlB1Ymxpc2hlZAIEAIP1uDGRigHBAUBjb25zb2xlLmxvZyh0aGF0LmFiLCB0YWdzLm51Z2dldFRvUHVibGlzaCkKCmlmICh0aGF0LmFiID09IHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IHB1Ymxpc2hlZCIpOwoKICAgIG1hc2tzLm51Z2dldFRvUHVibGlzaCA9IG51bGw7CgogICAgY29uZmlnQm90Lm1hc2tzLmFiVmVyc2lvbiA9IG51bGw7Cn0nAIP1uDH2YBBvbkFueUJvdHNDaGFuZ2VkAgQAg/W4MdOLAbcEQGlmIChjb25maWdCb3QgJiYgdGhhdFswXS5ib3QuaWQgIT0gdGhpc0JvdC5pZCkgCnsKICAgIGlmICghY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdCkgcmV0dXJuOyAvLyBJZ25vcmUgaWYgdGhlIGNvbmZpZ0JvdCBpc24ndCByZWFkeSB5ZXQuCgogICAgY29uc3QgZWRpdGVkQm90SUQgPSBjb25maWdCb3QudGFncy5lZGl0aW5nQm90LnJlcGxhY2UoIvCflJciLCAiIik7CgogICAgaWYgKCF0aGF0LmZpbmQoeCA9PiB4LmJvdC5pZCA9PSBlZGl0ZWRCb3RJRCkpIHJldHVybjsgLy8gSWYgdGhlIGJvdCBjaGFuZ2VkIHdhc24ndCBiZWluZyBlZGl0ZWQgYnkgdGhlIHVzZXIgaWdub3JlIGl0LgoKICAgIGNvbnN0IGVkaXRlZFRhZyA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdUYWc7CiAgICBjb25zdCBlZGl0ZWRCb3QgPSBnZXRCb3QoImlkIiwgZWRpdGVkQm90SUQpOwoKICAgIGlmIChlZGl0ZWRCb3QgJiYgZWRpdGVkVGFnKSAKICAgIHsKICAgICAgICBzaG91dCgibnVnZ2V0UmVzZXQiKTsKCiAgICAgICAgdGhpc0JvdC5udWdnZXRQYXJzZSh7IGVkaXRlZEJvdCwgZWRpdGVkVGFnIH0pOwogICAgfQp9JwCD9bgx9mAIb25DcmVhdGUCBACD9bgxiZABTEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnAIP1uDH2YA1wYWNrYWdlTnVnZ2V0AgQAg/W4MdaQAfgGQGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CmNvbnN0IHRhZ1RleHQgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXTsKCmlmIChjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4IHx8IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4KQp7CiAgICBsZXQgc3RhcnRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4OwogICAgbGV0IGVuZFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4OwoKICAgIGlmIChzdGFydFBvcyA9PSBlbmRQb3MpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoc3RhcnRQb3MgPiBlbmRQb3MpCiAgICB7CiAgICAgICAgbGV0IG5ld1N0YXJ0UG9zID0gZW5kUG9zOwogICAgICAgIGxldCBuZXdFbmRQb3MgPSBzdGFydFBvczsKCiAgICAgICAgc3RhcnRQb3MgPSBuZXdTdGFydFBvczsKICAgICAgICBlbmRQb3MgPSBuZXdFbmRQb3M7CiAgICB9CgogICAgbGV0IGRhdGEgPSB0YWdUZXh0LnN1YnN0cmluZyhzdGFydFBvcywgZW5kUG9zICsgMSk7CgogICAgc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6IHRoYXQubnVnZ2V0LCBkYXRhOiBkYXRhfSk7CgogICAgb3MudG9hc3QoIm51ZyBpcyBwdWJsaXNoaW5nIiwgMTApOwoKICAgIGxldCB0YXJnZXROdWcgPSAiLm51ZyB7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImNhbm5vdCByZWFkIG51Z2dldCB0byBiZSBwdWJsaXNoZWQiKQp9JwCD9bgx9mAIcmVtZW1iZXICBACD9bgxz5cBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIP1uDH2YAZzZWFyY2gCBACD9bgx9pcBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAIP1uDH2YAVzdG9yZQIEAIP1uDGdmAEo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAg/W4MfZgCWxpc3RlbmluZwIEAIP1uDHEmAEFZmFsc2UnAIP1uDH2YAlhYlZlcnNpb24CBACD9bgxypgBBTEwLjM1JwEEYm90cyRiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IBJwCD9bgx0JgBDnByZXNlbmNlQ2FtZXJhAgQAg/W4MdGYASjwn5SXODdlOTUzNDItZTQ1Ni00YjYzLTk4OTEtZDdhOTIxYWQzZWU3JwCD9bgx0JgBGWFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3ICBACD9bgx+JgBzgxAY29uc3QgewogICAgbGFiZWwgPSBgJHthYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9IGlzIHdvcmtpbmdgLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fQoKbGV0IGJ1c3lJbmRpY2F0b3IgPSB7CiAgICBvblBvaW50ZXJVcDogbnVsbCwKICAgIG9uUG9pbnRlckRvd246IG51bGwsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgYnVzeUxhYmVsOiBsYWJlbCwKICAgIGxhYmVsQWxpZ25tZW50OiAnbGVmdCcsCiAgICBzdGF0ZTogMCwKICAgIGFuaW1TdGF0ZXM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgXSwKICAgIGFuaW1SYXRlOiA1MDAsCiAgICBvbkJvdEFkZGVkOiBgQAogICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICBvbkJvdENoYW5nZWQ6IGBACiAgICAgICAgY29uc3QgbmVlZFJlZnJlc2ggPSB0aGF0LnRhZ3Muc29tZSh0ID0+IHQgPT09ICdidXN5TGFiZWwnIHx8IHQgPT09ICdzdGF0ZScgfHwgdCA9PT0gJ2FuaW1TdGF0ZXMnKTsKICAgICAgICBpZiAobmVlZFJlZnJlc2gpIHsKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0KICAgIGAsCiAgICByZWZyZXNoRGlzcGxheTogYEAKICAgICAgICBpZiAodGFncy5hbmltU3RhdGVzICYmIHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IGFuaW1TdGF0ZSA9IHRhZ3MuYW5pbVN0YXRlc1t0YWdzLnN0YXRlXTsKCiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSB0YWdzLmJ1c3lMYWJlbC50cmltKCkgKyBhbmltU3RhdGUuZWxsaXBzaXM7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBhbmltU3RhdGUuZm9ybUFkZHJlc3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5sYWJlbCAKICAgICAgICB9CiAgICBgLAogICAgYW5pbWF0ZTogYEAKICAgICAgICBpZiAodGFncy5zdGF0ZSA+PSB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICB0YWdzLnN0YXRlID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLnN0YXRlICs9IDE7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBvcy5zbGVlcCh0YWdzLmFuaW1SYXRlKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICAuLi5yZXN0Cn07Cgpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYnVzeUluZGljYXRvcik7CgpyZXR1cm4gbWVudUJvdDsnAIP1uDHQmAEGc3lzdGVtAgQAg/W4McelARFhYi5pbnRlcmZhY2UubWVudScAg/W4MdCYAQRmb3JtAgQAg/W4MdmlAQdub3RoaW5nJwCD9bgx0JgBC2Rlc2NyaXB0aW9uAgQAg/W4MeGlASZUaGlzIHNraWxsIGlzIGRlc2lnbmVkIGZvciBtZW51IHN0dWZmLigAg/W4MdCYAQthYkludGVyZmFjZQF4JwCD9bgx0JgBCmFiT3Blbk1lbnUCBACD9bgxiaYB8R5AYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgbWVudVR5cGUgPSB0aGF0ID8gImFiIiArIHRoYXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGF0LnNsaWNlKDEpICsgIk1lbnUiOiAiYWJDb3JlTWVudSI7IC8vc2V0IHVwIGEgY2hlY2sgdG8gc2VlIHdoYXQgdHlwZSBvZiBtZW51IHNob3VsZCBiZSBvY2N1cmluZyBbY29yZSwgYm90LCBncmlkLCBpbnN0XQpsZXQgbWVudVNraWxscyA9IGdldEJvdHMobWVudVR5cGUgKyAiQWN0aW9uIik7CmxldCBtYXhPcHRpb25zID0gbWVudVR5cGUgPT0gImluc3QiID8gNyA6IDU7CmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5OwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MuYmFzZVNraWxsLiR7bWVudVR5cGUgKyAiQWN0aW9uIn0oe2JvdDogdGhpc0JvdH0pO2A7CgpsZXQgc29ydE9yZGVySW5kZXggPSBtZW51U2tpbGxzLmxlbmd0aDsKZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51U2tpbGxzLmxlbmd0aDsgaSsrKS8vQUREIExPR0lDIEZPUiBNT1JFIE9QVElPTlMgVEhBTiA1IDogbWF4T3B0aW9ucwp7CiAgICAvL0FsbG93cyBmb3IgY29kZSB0byBnZXQgY2FsbGVkIGJlZm9yZSB0aGUgbWVudSBnZW5lcmF0ZXMsIHVzZWZ1bCBmb3IgZHluYW1pY2FsbHkgc2V0IGdyb3VwcyBvciBkcm9wZG93bnMKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiXSkgewogICAgICAgIGF3YWl0IHdoaXNwZXIobWVudVNraWxsc1tpXSwgbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiKTsKICAgIH0gCgogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJIaWRlIl0pIHsKICAgICAgICBjb250aW51ZTsKICAgIH0KICAgIAogICAgbGV0IGN1cnJlbnRTa2lsbCA9IG1lbnVTa2lsbHNbaV07CgogICAgYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGN1cnJlbnRTa2lsbC5pZDsKICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkxhYmVsIl07CiAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJY29uIl07CiAgICBhYk1lbnVCdXR0b24ub25DcmVhdGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJPbkdlbmVyYXRlIl07CiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiU29ydE9yZGVyIl07CiAgICBhYk1lbnVCdXR0b24uY29sb3IgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdID8/IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwoKICAgIGNvbnN0IG1lbnVJdGVtVHlwZSA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl07CgogICAgaWYgKG1lbnVJdGVtVHlwZSA9PSAiZHJvcGRvd24iKSB7CiAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duT3B0aW9ucyA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duT3B0aW9uczsKCiAgICAgICAgY29uc3QgcHJldkRyb3Bkb3duID0gbGlua3MucmVtZW1iZXIubGlua3MubGFzdE9wZW5lZERyb3Bkb3duOwogICAgICAgIGlmIChwcmV2RHJvcGRvd24gJiYgcHJldkRyb3Bkb3duLnRhZ3NbbWVudVR5cGUgKyAiQWN0aW9uIl0pIHsKICAgICAgICAgICAgaWYgKHByZXZEcm9wZG93biA9PSBjdXJyZW50U2tpbGwpIHsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICJsYXN0T3BlbmVkRHJvcGRvd24iLCBudWxsKTsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkRlZmF1bHRPcGVuIl0gPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBhYk1lbnVCdXR0b24uZGVmYXVsdE9wZW47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5kcm9wZG93blNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJNZW51QnV0dG9uKTsgICAgICAgIAogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gImdyb3VwIikgewogICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhYk1lbnVCdXR0b24ubWVudUl0ZW1zID0gY3VycmVudFNraWxsLnRhZ3MubWVudUl0ZW1zOwogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJpbnB1dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtVHlwZSA9PSAidGV4dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJ0b29sIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gIndpemFyZCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOwogICAgfQp9Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJPcGVuTWVudScsIHsgbWVudTogdGhhdCwgbWVudVR5cGUsIG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsIH0pOycAg/W4MdCYARJhYkNyZWF0ZU1lbnVCdXR0b24CBACD9bgx+cQB+A1AbGV0IG5ld01lbnVCdXR0b24gPSB7fTsKCmxldCB7CiAgICBtZW51SXRlbVN0eWxlID0ge30sCiAgICAuLi5hZGRpdGlvbmFsVGFncwp9ID0gdGhhdCA/PyB7fQoKaWYgKHR5cGVvZiBtZW51SXRlbVN0eWxlID09ICdzdHJpbmcnKSB7CiAgICBtZW51SXRlbVN0eWxlID0gbWVudUl0ZW1TdHlsZS5yZXBsYWNlKC9cdXsxRjlFQ30vdSwgJycpOyAKICAgIG1lbnVJdGVtU3R5bGUgPSBKU09OLnBhcnNlKG1lbnVJdGVtU3R5bGUpOwp9CgpmdW5jdGlvbiBoYXNCb3JkZXJTdHlsZSgpIHsKICAgIGlmIChtZW51SXRlbVN0eWxlWyJib3JkZXItdG9wLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLWxlZnQtc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItYm90dG9tLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLXJpZ2h0LXN0eWxlIl0pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KCmlmIChhZGRpdGlvbmFsVGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSkgewogICAgaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiTWVudUdyb3VwIl0pIHsKCiAgICB9Cn0KCm5ld01lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwpuZXdNZW51QnV0dG9uLmxhYmVsQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwpuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yID0gdGhhdC5zaGFkb3dDb2xvciA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVNoYWRvd0NvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5zY2FsZVkgPSAxOwoKY29uc3QgbWVudVN0eWxpbmcgPSB7CiAgICAiYm9yZGVyLXJhZGl1cyI6IjhweCIsCiAgICAibWFyZ2luLXRvcCI6ICI4cHgiLAogICAgImJveC1zaGFkb3ciOiBgM3B4IDRweCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJtaW4taGVpZ2h0IjogIjQ0cHgiLAogICAgImJvcmRlciI6IGhhc0JvcmRlclN0eWxlKCkgPyAiIiA6IGAycHggc29saWQgJHtuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yfWAsCiAgICAid2lkdGgiOiAiY2FsYygxMDAlIC0gNXB4KSIsCiAgICAuLi5tZW51SXRlbVN0eWxlCn0KCm5ld01lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IG1lbnVTdHlsaW5nOwoKY29uc3QgY2xpY2tlZFN0eWxpbmcgPSB7CiAgICAuLi5tZW51U3R5bGluZywKICAgICJmaWx0ZXIiOiAiYnJpZ2h0bmVzcyg2MCUpIgp9CmNvbnN0IGJhc2VTdHlsZSA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSAn8J+nrCAke0pTT04uc3RyaW5naWZ5KGNsaWNrZWRTdHlsaW5nKX0nYAoKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJEb3duID0gbWVudUl0ZW1TdHlsZT8uWyJtYXJnaW4tdG9wIl0gIT0gIjBweCIgPyBiYXNlU3R5bGUgOiAiQCAvLyI7Cm5ld01lbnVCdXR0b24ub25Qb2ludGVyVXAgPSBgQCBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbGA7Cgpmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykKewogICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsKfQoKbmV3TWVudUJ1dHRvbiA9IGNyZWF0ZShuZXdNZW51QnV0dG9uKTsKCnJldHVybiBuZXdNZW51QnV0dG9uOycAg/W4MdCYAQ1hYk1lbnVSZWZyZXNoAgQAg/W4MfDSAZ0BQGlmIChjb25maWdCb3QudGFncy5tZW51UG9ydGFsPy5zdWJzdHJpbmcoMCwyKSA9PSAiYWIiKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgogICAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwogICAgbWFza3Mub25LZXlEb3duID0gbnVsbDsKfScAg/W4MdCYAQhyZW1lbWJlcgIEAIP1uDGO1AEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAg/W4MdCYAQ1tYW5pZmVzdGF0aW9uAgQAg/W4MbXUASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCD9bgx0JgBEWFiRW52aXJvbm1lbnRNZW51AgQAg/W4MdzUAcESQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKY29uc3QgYWJNZW51SXRlbSA9IHsKICAgIGFiTWVudTogdHJ1ZSwKICAgIGFiTWVudVJlZnJlc2g6ICJAZGVzdHJveSh0aGlzQm90KTsiLAogICAgbWFuaWZlc3RhdGlvbjogdGFncy5tYW5pZmVzdGF0aW9uLAogICAgcmVtZW1iZXI6IHRhZ3MucmVtZW1iZXIsCiAgICBwZXJzb25hbGl0eTogdGFncy5wZXJzb25hbGl0eSwKICAgIGxlYXJuOiB0YWdzLmxlYXJuLAp9OwoKY29uc3QgYWJFbnZpcm9ubWVudE9wdGlvbnMgPSB0aGlzQm90LmFiR2V0RW52aXJvbm1lbnRPcHRpb25zKCk7IAoKZm9yIChsZXQgaSA9IDA7IGkgPCBhYkVudmlyb25tZW50T3B0aW9ucy5sZW5ndGg7IGkrKykgeyAKICAgIGNvbnN0IG9wdGlvbiA9IGFiRW52aXJvbm1lbnRPcHRpb25zW2ldOwoKICAgIGFzc2VydCh0eXBlb2Ygb3B0aW9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyID09PSAnbnVtYmVyJywgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9fV0gYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIgbXVzdCBiZSBhIG51bWJlci5gKTsKCiAgICBhYk1lbnVJdGVtLmFiTWVudVNvcnRPcmRlciA9IG9wdGlvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjsKCiAgICBjb25zdCBvcHRpb25Nb2QgPSB7Li4uYWJNZW51SXRlbSwgLi4ub3B0aW9ufTsKCiAgICBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2J1dHRvbicgfHwgIW9wdGlvbi5tZW51SXRlbVR5cGUpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAnZHJvcGRvd24nKSB7CiAgICAgICAgb3B0aW9uTW9kLmRyb3Bkb3duU29ydE9yZGVyID0gb3B0aW9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOwoKICAgICAgICAvLyBNYWtlIHN1cmUgZWFjaCBkcm9wZG93biBvcHRpb25zIGdldHMgYWJNZW51SXRlbSBkZWZhdWx0cy4KICAgICAgICBpZiAob3B0aW9uLmRyb3Bkb3duT3B0aW9ucyAmJiBvcHRpb24uZHJvcGRvd25PcHRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBvcHRpb24uZHJvcGRvd25PcHRpb25zLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICBvcHRpb24uZHJvcGRvd25PcHRpb25zW2tdID0geyAuLi5hYk1lbnVJdGVtLCAuLi5vcHRpb24uZHJvcGRvd25PcHRpb25zW2tdIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24ob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2dyb3VwJykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2lucHV0JykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ3RleHQnKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICd0b29sJykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAnd2l6YXJkJykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtZW51SXRlbVR5cGUgJHtvcHRpb24ubWVudUl0ZW1UeXBlfSBpcyBub3QgaW1wbGVtZW50ZWQuYCk7CiAgICAgICAgY29udGludWU7CiAgICB9Cn0KCi8vIHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJQZXJzb25hbGl0eUNvbmZpZ0J1dHRvbik7Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJFbnZpcm9ubWVudE1lbnUnLCB7IG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWx9ICknAIP1uDHQmAEFbGVhcm4CBACD9bgxnucBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAIP1uDHQmAEDZ3B0AgQAg/W4McXnASjwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCD9bgx0JgBCGFiSWdub3JlAgQAg/W4MeznAQR0cnVlJwCD9bgx0JgBBnNlYXJjaAIEAIP1uDHx5wEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAg/W4MdCYAQZudWdnZXQCBACD9bgxmOgBKPCflJc0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYnAIP1uDHQmAEFdGVzdHMCBACD9bgxv+gBKPCflJdiODNkOTcyYi0wNTM1LTQwNTEtYjU4OS00MWNlZGE4NTM1ZjEnAIP1uDHQmAEDYXNrAgQAg/W4MeboASjwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCD9bgx0JgBCWFiVmVyc2lvbgIEAIP1uDGN6QEFMTAuMzUnAIP1uDHQmAERYWJDcmVhdGVNZW51SW5wdXQCBACD9bgxk+kBngJAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudUlucHV0ID0gew0KICAgIGZvcm06ICJpbnB1dCIsDQogICAgbWVudUl0ZW1TaG93U3VibWl0V2hlbkVtcHR5OiBmYWxzZSwNCiAgICBmb3JtSW5wdXRNdWx0aWxpbmU6IG51bGwsDQogICAgb25Qb2ludGVyVXA6IG51bGwsDQogICAgb25Qb2ludGVyRG93bjogbnVsbCwNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUlucHV0KTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCD9bgx0JgBEGFiQ3JlYXRlTWVudVRleHQCBACD9bgxsusBgQRAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpjb25zdCB7DQogICAgbWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIC4uLnJlc3QNCn0gPSB0aGF0Ow0KDQpsZXQgbWVudVRleHQgPSB7DQogICAgZm9ybTogInRleHQiLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgcG9pbnRhYmxlOiBmYWxzZSwNCiAgICBjb2xvcjogIndoaXRlIiwNCiAgICBtZW51SXRlbVN0eWxlOiB7DQogICAgICAgICJwYWRkaW5nLXRvcCI6ICI2cHgiLA0KICAgICAgICAicGFkZGluZy1ib3R0b20iOiAiNnB4IiwNCiAgICB9LA0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZTogew0KICAgICAgICAid2hpdGUtc3BhY2UiOiAicHJlLXdyYXAiLA0KICAgICAgICAuLi5tZW51SXRlbUxhYmVsU3R5bGUsDQogICAgfSwNCiAgICAuLi5yZXN0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRleHQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAIP1uDHQmAEQYWJDcmVhdGVNZW51VG9vbAIEAIP1uDG07wGOAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51VG9vbCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRvb2wpOw0KDQpyZXR1cm4gbWVudUJvdDsnAIP1uDHQmAESYWJDcmVhdGVNZW51V2l6YXJkAgQAg/W4McPwAZIBQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVXaXphcmQgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVXaXphcmQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAIP1uDHQmAEUYWJDcmVhdGVNZW51RHJvcGRvd24CBACD9bgx1vEB5R1AaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAodGhhdC5kcm9wZG93blNvcnRPcmRlciA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVEcm9wZG93bjogZHJvcGRvd25Tb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgb3V0ZXJNZW51QnV0dG9uID0gew0KICAgIC4uLnRoYXQsDQogICAgZm9ybUFkZHJlc3M6IHRoYXQuZm9ybUFkZHJlc3MgPz8gImFycm93X3JpZ2h0IiwNCiAgICBkcm9wZG93bk9wZW46IGZhbHNlLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIHRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9ICR7dGhhdC5kcm9wZG93blNvcnRPcmRlcn0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IHRydWUpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnModGFncy5kcm9wZG93bk9wdGlvbnMsIHRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIpOw0KICAgICAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25EZXN0cm95OiBgQA0KICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgIGAsDQogICAgb25Qb2ludGVyVXA6IGBADQogICAgICAgIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsOw0KICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gImFycm93X3JpZ2h0IjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gZmFsc2UpIHsNCiAgICAgICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImZvcm1BZGRyZXNzIiwgImFycm93X2Ryb3BfZG93biIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAibWVudUl0ZW1TdHlsZSIsIHsuLi50YWdzLm1lbnVJdGVtU3R5bGUsICJib3JkZXJCb3R0b21MZWZ0UmFkaXVzIjogIjAiLCAiYm9yZGVyQm90dG9tUmlnaHRSYWRpdXMiOiAiMCJ9KTsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25Cb3RDaGFuZ2VkOiBgQA0KICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCdkcm9wZG93bk9wZW4nKSAmJiB0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51RHJvcGRvd25PcGVuZWQiLCB0aGlzQm90KTsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgYWJNZW51RHJvcGRvd25PcGVuZWQ6IGBADQogICAgICAgIGlmICh0aGF0ICE9IHRoaXNCb3QpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobGlua3MgJiYgbGlua3MuYmFzZVNraWxsKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhhYi5saW5rcy5yZW1lbWJlciwgImxhc3RPcGVuZWREcm9wZG93biIsIHRhZ3MuYmFzZVNraWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGANCn07DQoNCmlmICh0aGF0LmZvcm1BZGRyZXNzICYmIHRoYXQuZm9ybUFkZHJlc3MgIT0gImFycm93X3JpZ2h0Iikgew0KICAgIG91dGVyTWVudUJ1dHRvbi5jdXN0b21Gb3JtQWRkcmVzcyA9IHRydWU7DQp9DQpvdXRlck1lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IHRoYXQuZHJvcGRvd25Tb3J0T3JkZXI7DQoNCmNvbnN0IG1lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihvdXRlck1lbnVCdXR0b24pOw0KbWVudUJvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMgPSBnZW5lcmF0ZU1lbnVPcHRpb25zOw0KDQphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZU1lbnVPcHRpb25zIChvcHRpb25zLCBzb3J0T3JkZXIpIHsNCiAgICBjb25zdCBtZW51Qm90cyA9IFtdOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7ICsraSkgew0KDQogICAgICAgIGxldCBuZXdNZW51QnV0dG9uID0gew0KICAgICAgICAgICAgLi4ub3B0aW9uc1tpXSwNCiAgICAgICAgICAgIGNsZWFyRHJvcGRvd25NZW51OiBgQA0KICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMDApOw0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoaSA9PSBvcHRpb25zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAgMCA4cHggOHB4IjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIDAgOHB4IDhweCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJUb3AiXSA9ICJub25lIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJtYXJnaW5Ub3AiXSA9ICIwIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJwYWRkaW5nTGVmdCJdID0gIjM1cHgiOw0KDQogICAgICAgIGNvbnN0IG5ld01lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCiAgICB9DQoNCiAgICBtZW51Qm90LnRhZ3MubWVudUJvdHMgPSBnZXRMaW5rKG1lbnVCb3RzKTsNCn0NCg0KaWYgKHRoYXQuZGVmYXVsdE9wZW4pIHsNCiAgICBtZW51Qm90Lm9uUG9pbnRlclVwKCk7DQogICAgbWVudUJvdC5vbkNsaWNrKCk7DQp9DQoNCnJldHVybiBtZW51Qm90Ow0KDQonAIP1uDHQmAERYWJDcmVhdGVNZW51R3JvdXACBACD9bgxvI8CvR9ALyoNCiAgIEVYQU1QTEUNCiAgIGNvbnN0IG1lbnVHcm91cCA9IHsNCiAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgZ3JvdXBTb3J0T3JkZXI6IDEsDQogICAgICAgIG1lbnVJdGVtczogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDEiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgY29sb3I6ICJvcmFuZ2UiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMyIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgIG1lbnVJdGVtVHlwZTogImRyb3Bkb3duIiwNCiAgICAgICAgICAgICAgICBkcm9wZG93bk9wdGlvbnM6IFsNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDIiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXQ0KICAgIH0NCiovDQoNCmlmICAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICghdGhhdC5ncm91cFNvcnRPcmRlcikgew0KICAgIHRocm93IG5ldyBFcnJvcihgYWJDcmVhdGVNZW51R3JvdXA6IGdyb3VwU29ydE9yZGVyIGlzIG5vdCBwcm92aWRlZC5gKTsNCn0NCg0KbGV0IHsNCiAgICBtZW51SXRlbVN0eWxlID0ge30sDQogICAgbWVudUl0ZW1zID0gW10sDQogICAgLi4uYWRkaXRpb25hbFRhZ3MNCn0gPSB0aGF0ID8/IHt9DQoNCmNvbnN0IG1lbnVCb3RzID0gW107DQpmb3IgKGxldCBpID0gMDsgaSA8IG1lbnVJdGVtcy5sZW5ndGg7ICsraSkgew0KDQogICAgbGV0IG5ld01lbnVCdXR0b24gPSB7fTsNCg0KICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTAwKTsNCg0KICAgIGxldCBpbmRpdk1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbXNbaV0ubWVudUl0ZW1TdHlsZSA/PyB7fTsNCiAgICBsZXQgaW5kaXZNZW51VHlwZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVR5cGUgPz8gdW5kZWZpbmVkOw0KICAgIGxldCBpbmRpdkFkZGl0aW9uYWxUYWdzID0gbWVudUl0ZW1zW2ldOw0KICAgIGlmIChpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXTsNCiAgICB9DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdKSB7DQogICAgICAgIGRlbGV0ZSBpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVR5cGUiXTsNCiAgICB9DQoNCiAgICBjb25zdCBiYXNlU3R5bGluZyA9IHsNCiAgICAgICAgImJvcmRlclRvcCI6ICJub25lIiwNCiAgICAgICAgIm1hcmdpblRvcCI6ICIwIg0KICAgIH0NCg0KICAgIGlmIChpID09IG1lbnVJdGVtcy5sZW5ndGggLSAxICYmIGkgPT0gMCkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0NCiAgICBlbHNlIGlmIChpID09IG1lbnVJdGVtcy5sZW5ndGggLSAxKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4uYmFzZVN0eWxpbmcsDQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjAgMCA4cHggOHB4IiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0gZWxzZSBpZiAoaSA9PSAwKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICI4cHggOHB4IDAgMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzt9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4uYmFzZVN0eWxpbmcsDQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjAiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpDQogICAgew0KICAgICAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgdGFnIGluIGluZGl2QWRkaXRpb25hbFRhZ3MpDQogICAgew0KICAgICAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBpbmRpdkFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgbGV0IG5ld01lbnVCb3Q7DQogICAgc3dpdGNoKGluZGl2TWVudVR5cGUpIHsNCiAgICAgICAgY2FzZSAiZHJvcGRvd24iOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAuLi5uZXdNZW51QnV0dG9uLA0KICAgICAgICAgICAgICAgICAgICAiZHJvcGRvd25Tb3J0T3JkZXIiOiBOdW1iZXIodGhhdC5ncm91cFNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgImlucHV0IjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRleHQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ0b29sIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2wobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAid2l6YXJkIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBkZWZhdWx0OiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgfQ0KICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQp9DQoNCnJldHVybiBtZW51Qm90czsnAIP1uDHQmAELcGVyc29uYWxpdHkCBACD9bgx+q4CKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAIP1uDHQmAEXYWJHZXRFbnZpcm9ubWVudE9wdGlvbnMCBACD9bgxoa8C6W9AY29uc3Qgb3B0aW9ucyA9IFtdOwoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogYGhpZGVgLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAidmlzaWJpbGl0eV9vZmYiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICB9KSwKICAgIH0pCn0KCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJzbGVlcCIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMCwKICAgICAgICBmb3JtQWRkcmVzczogIm5pZ2h0c19zdGF5IiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJTZXRBd2FrZSh7IGF3YWtlOiBmYWxzZSB9KQogICAgICAgIH0pLAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAib3B0aW1pemUgbW9kZSIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMjAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICB9KSwKICAgIHJlZnJlc2hEaXNwbGF5OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSBmYWxzZSA6IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gdHJ1ZTsKICAgICAgICB0aGlzQm90Lm9uQ3JlYXRlKCk7CiAgICB9KSwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImN1c3RvbWl6ZTogYWIgcGVyc29uYWxpdHkiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDMwMCwKICAgIG1lbnVJdGVtVHlwZTogJ2Ryb3Bkb3duJywKICAgIGRyb3Bkb3duT3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBuYW1lOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LCB7IHRpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB0byBjYWxsIG1lPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7IG5hbWU6IG5hbWUgfSk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBhaSBtb2RlbDogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbH1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVscyA9IGNvbmZpZ0JvdC50YWdzLmFpQ2hhdE1vZGVsczsKCiAgICAgICAgICAgICAgICBpZiAobW9kZWxzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IFtdOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIG1vZGVscykgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goeyBsYWJlbDogZW50cnkubmFtZSwgdmFsdWU6IGVudHJ5Lm5hbWUgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TW9kZWxJbmRleCA9IG9wdGlvbnMuZmluZEluZGV4KG8gPT4gby52YWx1ZSA9PT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IGF3YWl0IG9zLnNob3dJbnB1dChjdXJyZW50TW9kZWxJbmRleCwgewogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3doYXQgYWkgbW9kZWwgd291bGQgeW91IGxpa2UgbWUgdG8gdXNlPycsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaXN0JywKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IG9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE9wdGlvbiAmJiBzZWxlY3RlZE9wdGlvbi52YWx1ZSAhPT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBhaU1vZGVsOiBzZWxlY3RlZE9wdGlvbi52YWx1ZSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChhdXRoQm90KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnNob3dBbGVydCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3NvbWV0aGluZyB3ZW50IHdyb25nJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdmYWlsZWQgdG8gZ2V0IGxpc3Qgb2YgYWkgY2hhdCBtb2RlbHMuJwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnNob3dBbGVydCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3NpZ24gaW4gcmVxdWlyZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJ3lvdSBtdXN0IHNpZ24gaW4gdG8gdXNlIGFpLicKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBtZSB0byBiZT8nIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBjb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHsgdHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnVzIHRvIGJlPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7IG1lbnVDb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IHRleHQgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51IHRleHQgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgbWVudUxhYmVsQ29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBwb3J0YWwgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgbGV0IHBvcnRhbENvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4JywgeyB0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgeW91ciBwb3J0YWwgdG8gbG9vayBsaWtlPycgfSk7CiAgICAgICAgICAgICAgICBpZiAoIXBvcnRhbENvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgcG9ydGFsQ29sb3IgPSAnIzI2MzIzOCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7ICdwb3J0YWxDb2xvcic6IHBvcnRhbENvbG9yIH0pOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBkZWZhdWx0IG1hcCBwb3J0YWwgYmFzZW1hcGAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvdXQoInNob3dBQkJhc2VtYXBPcHRpb25zIik7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogImRlZmF1bHQgc2V0dGluZ3MiLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgICAgICAgICAgY29sb3I6ICdyZWQnLAogICAgICAgICAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7ICdkZWZhdWx0UGVyc29uYWxpdHknOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgIF0KfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoYXQiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDQwMCwKICAgIGZvcm1BZGRyZXNzOiAiY2hhdCIsCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgc2hvdXQoJ2FiQ2hhdEJhck9wZW4nKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIH0pLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAibnVnZ2V0cyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNTAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzLm51Z01hbmFnZXIgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmludGVyZmFjZS5udWdnZXQnKSk7IAogICAgICAgIAogICAgICAgIGlmIChsaW5rcy5udWdNYW5hZ2VyLnRhZ3MubGlzdGVuaW5nKSB7IAogICAgICAgICAgICB0YWdzLm9uQ2xpY2sgPSBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyAKICAgICAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgbnVsbCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveGA7IAogICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICB0YWdzLm9uQ2xpY2sgPSBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyAKICAgICAgICAgICAgICAgIGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCB0cnVlLCAnbG9jYWwnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94X291dGxpbmVfYmxhbmtgOwogICAgICAgIH0KICAgIH0pLAp9KQoKaWYgKGxpbmtzLnByZXNlbmNlQ2FtZXJhKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAiY2FtZXJhIHByZXNlbmNlIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNTEwLAogICAgICAgIHByZXNlbmNlQ2FtZXJhOiB0YWdzLnByZXNlbmNlQ2FtZXJhLAogICAgICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5vblByZXNlbmNlQ2FtZXJhQm90Q2hhbmdlZCA9ICh0aGF0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCdlbmFibGVkJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIG9zLmFkZEJvdExpc3RlbmVyKGxpbmtzLnByZXNlbmNlQ2FtZXJhLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VDYW1lcmFCb3RDaGFuZ2VkKTsKCiAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB9KSwKICAgICAgICByZWZyZXNoRGlzcGxheTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBsaW5rcy5wcmVzZW5jZUNhbWVyYS50YWdzLmVuYWJsZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MucHJlc2VuY2VDYW1lcmEsICdlbmFibGVkJywgISEhbGlua3MucHJlc2VuY2VDYW1lcmEudGFncy5lbmFibGVkLCAnbG9jYWwnKTsKICAgICAgICB9KSwKICAgICAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgb3MucmVtb3ZlQm90TGlzdGVuZXIobGlua3MucHJlc2VuY2VDYW1lcmEsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25QcmVzZW5jZUNhbWVyYUJvdENoYW5nZWQpOwogICAgICAgIH0pCiAgICB9KQp9CgppZiAobGlua3MuZ3B0KSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNjAwLAogICAgICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGlmICghYXV0aEJvdCkgewogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAnRnJlZVBsYXknIHx8IGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdlZGl0ICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBwcm9tcHQnOyB0YWdzLmdwdEJvdCA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuYWN0aW9uLmFzaycpKTsKICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLmdwdEJvdC5lZGl0UHJvbXB0KCk7CiAgICAgICAgfSksCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJncmlkIHNuYXAiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDcwMCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnCiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZTsgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgfSksCn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJib3Qgc25hcCIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogODAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZTsgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICB9KSwKfSkKCmlmIChhdXRoQm90KSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAiYWNjb3VudCIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDkwMCwKICAgICAgICBmb3JtQWRkcmVzczogImJhZGdlIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIG9zLnNob3dBY2NvdW50SW5mbygpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIH0pLAogICAgfSkKfQoKaWYgKGxpbmtzLnRlc3RzKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAicmVjb3JkIHRlc3QiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMDAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAic2NpZW5jZSIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBzaG91dCgnYWJSZWNvcmRUZXN0Jyk7CiAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfSksCiAgICB9KQoKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdHJhY2UiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMTAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAidGltZWxpbmUiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgc2hvdXQoJ2FiUmVjb3JkVHJhY2UnKTsKICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9KSwKICAgIH0pCn0KCmlmIChnZXRCb3QoInN5c3RlbSIsICJhYi5ob21lLmVnZyIpKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAic2F2ZSBob21lIGVnZyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEyMDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJlZ2ciLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaG9tZS5lZ2ciKS5zYXZlRGF0YSgpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIH0pLAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiY2hlY2sgZm9yICIgKyBhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiB1cGRhdGVzIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMzAwLAogICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgIGxlYXJuOiB0YWdzLmxlYXJuLAogICAgY2hlY2tGb3JVcGRhdGVzOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgLy8gVGVtcG9yYXJpbHkgcmVwbGFjZSB3aXRoIGJ1c3kgaW5kaWNhdG9yIHdoaWxlIGNoZWNraW5nIGZvciB1cGRhdGVzLgogICAgICAgIHRhZ3MuYWJNZW51ID0gZmFsc2U7CgogICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gYWIubGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yKHsKICAgICAgICAgICAgYWJNZW51OiB0cnVlLAogICAgICAgICAgICBsYWJlbDogJ2NoZWNraW5nIGZvciB1cGRhdGVzIHRvICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgIGFiTWVudVNvcnRPcmRlcjogdGFncy5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlciwKICAgICAgICB9KTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sgPSBhd2FpdCBhYi5hYkNoZWNrQUJVcGRhdGVBdmFpbGFibGUoeyBkZXRhaWxlZDogdHJ1ZSB9KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IgPSBudWxsOwoKICAgICAgICAgICAgLy8gQnJpbmcgYmFjayB0aGUgdXBkYXRlIGJ1dHRvbi4KICAgICAgICAgICAgdGFncy5hYk1lbnUgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrICYmIHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgaWYgKGdsb2JhbFRoaXMuYWJVcGRhdGVDaGVja2VyKSB7CiAgICAgICAgICAgICAgICBhYlVwZGF0ZUNoZWNrZXIudGFncy51cGRhdGVBdmFpbGFibGUgPSB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay51cGRhdGVBdmFpbGFibGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay51cGRhdGVBdmFpbGFibGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFiRmlsZXNXaXRoVXBkYXRlcyA9IHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLmFiRmlsZUNoZWNrcy5maWx0ZXIoZiA9PiBmLnVwZGF0ZUF2YWlsYWJsZSk7CgogICAgICAgICAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVXBkYXRlcyBmb3VuZCBmb3IgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnVGhlcmUgYXJlICcgKyBhYkZpbGVzV2l0aFVwZGF0ZXMubGVuZ3RoICsgJyBmaWxlIHVwZGF0ZXMgZm9yICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnLiBXb3VsZCB5b3UgbGlrZSB0byBpbnN0YWxsIHRoZSB1cGRhdGVzIG5vdz8gWW91IGFuZCBhbnkgY29ubmVjdGVkIHVzZXJzIHdpbGwgYXV0b21hdGljYWxseSByZWZyZXNoIHRoZSBwYWdlIGFmdGVyIHRoZSB1cGRhdGUgaXMgY29tcGxldGUuJywKICAgICAgICAgICAgICAgICAgICBjYW5jZWxUZXh0OiAnTm90IG5vdycsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybVRleHQ6ICdZZXMnCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgICAgICAgICBsaW5rcy5sZWFybi51cGRhdGVBQigpOwogICAgICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhYi5saW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgaXMgYWxyZWFkeSB1cC10by1kYXRlIScpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSAndXBkYXRlIGNoZWNrIGZhaWxlZCc7CiAgICAgICAgfQogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGhpc0JvdC5jaGVja0ZvclVwZGF0ZXMoKTsKICAgIH0pLAogICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpOwogICAgICAgIH0KICAgIH0pLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAicGVybWFuZW50bHkgZGVsZXRlIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA5OTk5LAogICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzLmxhYmVsICs9ICIgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7CiAgICAgICAgdGFncy5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29udHJhc3RDb2xvciA/PyAiI0Q5MzAzMCI7CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICBjb25zdCBjb25maXJtZWQgPSBhd2FpdCBvcy5zaG93Q29uZmlybSh7CiAgICAgICAgICAgIHRpdGxlOiAnUGVybWFuZW50bHkgZGVsZXRlICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICBjb250ZW50OiAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgZnJvbSAnICsgbGlua3MubGVhcm4udGFncy5hYkluc3QgKyAnPyBUaGlzIGlzIG5vdCByZXZlcnNpYmxlIScsCiAgICAgICAgfSkKCiAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKCiAgICAgICAgY29uc3QgYWJCb3RzID0gZ2V0Qm90cygoYikgPT4gewogICAgICAgICAgICByZXR1cm4gYi5zcGFjZSA9PT0gJ3NoYXJlZCcgJiYKICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0gJiYKICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0uc3RhcnRzV2l0aCgnYWInKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGNvbmZpcm1lZCkgewogICAgICAgICAgICBkZXN0cm95KGFiQm90cyk7CiAgICAgICAgfQogICAgfSksCn0pCgpyZXR1cm4gb3B0aW9uczsnAIP1uDHQmAEeYWJDcmVhdGVUb29sYm94RHJvcGRvd25PcHRpb25zAgQAg/W4MYufA+MTQGNvbnN0IHRvb2xib3hUb29scyA9IFsuLi50aGF0LnRvb2xBcnJheV0gPz8gW107DQpjb25zdCB0b29sYm94TmFtZSA9IHRoYXQudG9vbGJveE5hbWUgPz8gIktpdCAiOw0KY29uc3QgdG9vbGJveCA9IHRoYXQudG9vbGJveDsNCmNvbnN0IGdyaWRJbmZvcm1hdGlvbiA9ICh0aGF0Py5ncmlkSW5mb3JtYXRpb24gJiYgdGhhdD8uZ3JpZEluZm9ybWF0aW9uICE9IHVuZGVmaW5lZCkgPyB0aGF0Py5ncmlkSW5mb3JtYXRpb24gOiBhYlJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQoNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMudG9vbGJveCA9IGdldExpbmsodG9vbGJveCk7DQptZW51T3B0aW9ucy5ncmlkSW5mb3JtYXRpb24gPSBncmlkSW5mb3JtYXRpb247DQptZW51T3B0aW9ucy5zZWFyY2ggPSB0YWdzLnNlYXJjaDsNCm1lbnVPcHRpb25zLmFydGlmYWN0ID0gdGFncy5hcnRpZmFjdDsNCi8vbWVudU9wdGlvbnMuZm9ybUFkZHJlc3MgPSAiaGFyZHdhcmUiOw0KDQppZiAodG9vbGJveFRvb2xzLmxlbmd0aCA9PT0gMCkgew0KICAgIGNvbnN0IG1lc3NhZ2UgPSB0b29sYm94TmFtZSArICIgZG9lcyBub3QgaGF2ZSBhbnkgdG9vbHMgbGlzdGVkIGluIHRoZSB0b29sX2FycmF5IHRhZyI7DQoNCiAgICBhYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIG1lc3NhZ2UpOw0KICAgIG9zLnRvYXN0KG1lc3NhZ2UsIDUpOw0KICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7DQp9DQoNCmZvciAobGV0IHRvb2wgb2YgdG9vbGJveFRvb2xzKSB7DQogICAgY29uc3QgdG9vbEJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiB0b29sLm5hbWUsDQogICAgICAgIHRhcmdldEFCOiB0b29sLnRhcmdldEFCLA0KICAgICAgICBpc0FydGlmYWN0OiB0b29sLmFydGlmYWN0IHx8IGZhbHNlLA0KICAgICAgICBvbkNsaWNrOmBADQogICAgICAgICAgICBpZiAodGFncy5pc0FydGlmYWN0KSB7DQogICAgICAgICAgICAgICAgY29uc3QgYWJBcnRpZmFjdFNoYXJkID0gew0KICAgICAgICAgICAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJveEJvdDogdGFncy50b29sYm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzOiBbDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUINCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgbGlua3MuYXJ0aWZhY3QuYWJDcmVhdGVBcnRpZmFjdFByb21pc2VCb3Qoew0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0TmFtZTogdGFncy50YXJnZXRBQiwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdEluc3RhbmNlSUQ6IHV1aWQoKSwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdFNoYXJkLA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsNCiAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAndG9vbCcsDQogICAgICAgICAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgLA0KICAgIH07DQoNCiAgICBpZiAodG9vbC5mb3JtQWRkcmVzcykgew0KICAgICAgICB0b29sQnV0dG9uLmZvcm1BZGRyZXNzID0gdG9vbC5mb3JtQWRkcmVzczsNCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaCh0b29sQnV0dG9uKTsNCn0NCg0KcmV0dXJuIGRyb3Bkb3duT3B0aW9uczsnAIP1uDHQmAEQb25BQkF1dGhCb3RBZGRlZAIEAIP1uDHvsgMYQHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7JwCD9bgx0JgBCGFydGlmYWN0AgQAg/W4MYizAyjwn5SXNzhlNDE1MDMtYzkzMy00ZjhhLTgxN2EtYmE5N2JmOGQ1ZDI3JwEEYm90cyRjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcBJwCD9bgxr7MDFWFiQ3JlYXRlQ3ViZUZhY2VQbGFuZQIEAIP1uDGwswOJMUBsZXQgeyAKICAgIGJvdCwKICAgIGRpbWVuc2lvbiwKICAgIHNwYWNlID0gJ3RlbXBMb2NhbCcsCiAgICBkZWJ1ZywKICAgIGZhY2VPZmZzZXQgPSAwLjAxLAogICAgcG9pbnRhYmxlID0gZmFsc2UsCiAgICB0aWNrSW50ZXJ2YWxNUyA9IDUwMCwKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge307Cgphc3NlcnQobGlua3MudXRpbHMuaXNCb3QoYm90KSwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3QgaXMgYSByZXF1aXJlZCBCb3QgcGFyYW1ldGVyLmApOwphc3NlcnQoZGltZW5zaW9uLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRpbWVuc2lvbiBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKYXNzZXJ0KHJlc3QuZm9ybSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGZvcm0gaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LmFuY2hvclBvaW50ID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYW5jaG9yUG9pbnQgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQm90QWRkZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKCmNvbnN0IGZhY2VQbGFuZU1vZCA9IHsKICAgIHNwYWNlLAogICAgYW5jaG9yUG9pbnQ6ICdjZW50ZXInLAogICAgZGVidWcsCiAgICBmYWNlT2Zmc2V0LAogICAgZm9ybTogJ3Nwcml0ZScsCiAgICBkaW1lbnNpb24sCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIHBvaW50YWJsZSwKICAgIHRpY2tJbnRlcnZhbE1TLAogICAgdHJhbnNmb3JtZXI6IGJvdC5pZCwKICAgIG9uQm90QWRkZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnN0YXJ0VGljaygpOwogICAgfSksCiAgICBvbkJvdENoYW5nZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCd0aWNrSW50ZXJ2YWxNUycpKSB7CiAgICAgICAgICAgIHRoaXNCb3Quc3RvcFRpY2soKTsKICAgICAgICAgICAgdGhpc0JvdC5zdGFydFRpY2soKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ3RyYW5zZm9ybWVyJykpIHsKICAgICAgICAgICAgaWYgKCF0YWdzLnRyYW5zZm9ybWVyKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkFueUJvdHNSZW1vdmVkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRhZ3MudHJhbnNmb3JtZXIpIHsKICAgICAgICAgICAgaWYgKHRoYXQuYm90SURzLmluY2x1ZGVzKHRhZ3MudHJhbnNmb3JtZXIpKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnN0b3BUaWNrKCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGVzdHJveWVkYCk7CiAgICAgICAgfQogICAgfSksCiAgICBzZXREaW1lbnNpb246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25zdCBkaW1lbnNpb24gPSB0aGF0OwoKICAgICAgICBpZiAodGFncy5kaW1lbnNpb24gIT09IGRpbWVuc2lvbikgewogICAgICAgICAgICAvLyBSZW1vdmUgZnJvbSBwcmV2aW91cyBkaW1lbnNpb24uCiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gbnVsbDsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdQb3NpdGlvbiddID0gbnVsbDsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdSb3RhdGlvbiddID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChkaW1lbnNpb24pIHsKICAgICAgICAgICAgICAgIC8vIEFzc2lnbiB0byBuZXcgZGltZW5zaW9uLgogICAgICAgICAgICAgICAgdGFncy5kaW1lbnNpb24gPSBkaW1lbnNpb247CiAgICAgICAgICAgICAgICB0YWdzW2RpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0pLAogICAgc3RhcnRUaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKG1hc2tzLnRpY2tJbnRlcnZhbElkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG1hc2tzLnRpY2tJbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAndGljaycpLCB0YWdzLnRpY2tJbnRlcnZhbE1TKTsKICAgICAgICB0aGlzQm90LnRpY2soKTsKICAgIH0pLAogICAgc3RvcFRpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAobWFza3MudGlja0ludGVydmFsSWQpIHsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChtYXNrcy50aWNrSW50ZXJ2YWxJZCk7CiAgICAgICAgICAgIG1hc2tzLnRpY2tJbnRlcnZhbElkID0gbnVsbDsKICAgICAgICB9CiAgICB9KSwKICAgIHRpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25zdCBMT0NBTF9OT1JNQUxTID0gWwogICAgICAgICAgICBuZXcgVmVjdG9yMygxLCAwLCAwKSwgLy8gK1gKICAgICAgICAgICAgbmV3IFZlY3RvcjMoLTEsIDAsIDApLCAvLyAtWAogICAgICAgICAgICBuZXcgVmVjdG9yMygwLCAxLCAwKSwgLy8gK1kKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgLTEsIDApLCAvLyAtWQogICAgICAgIF0KCiAgICAgICAgY29uc3QgTE9DQUxfUE9TSVRJT05TID0gWwogICAgICAgICAgICBuZXcgVmVjdG9yMygwLjUgKyB0YWdzLmZhY2VPZmZzZXQsIDAsIC0wLjUpLCAvLyArWAogICAgICAgICAgICBuZXcgVmVjdG9yMygtMC41IC0gdGFncy5mYWNlT2Zmc2V0LCAwLCAtMC41KSwgLy8gLVgKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgMC41ICsgdGFncy5mYWNlT2Zmc2V0LCAtMC41KSwgLy8gK1kKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgLTAuNSAtIHRhZ3MuZmFjZU9mZnNldCwgLTAuNSksIC8vIC1ZCiAgICAgICAgXQoKICAgICAgICBjb25zdCBIQUxGX1BJID0gTWF0aC5QSSAvIDI7CgogICAgICAgIGNvbnN0IExPQ0FMX1JPVEFUSU9OUyA9IFsKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogSEFMRl9QSSwgeTogSEFMRl9QSSwgejogMCB9fSksIC8vICtYCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IEhBTEZfUEksIHk6IC1IQUxGX1BJLCB6OiAwIH19KSwgLy8gLVgKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogLUhBTEZfUEksIHk6IDAsIHo6IE1hdGguUEkgfX0pLCAvLyArWQogICAgICAgICAgICBuZXcgUm90YXRpb24oeyBldWxlcjogeyB4OiBIQUxGX1BJLCB5OiAwLCB6OiAwIH19KSwgLy8gLVkKICAgICAgICBdCgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgZmFjZSBwbGFuZSB0byBiZSBvbiB0aGUgZ2l2ZW4gZmFjZSBpbmRleC4gIAogICAgICAgICAqIDA6ICtYLCAgCiAgICAgICAgICogMTogLVgsICAKICAgICAgICAgKiAyOiArWSwgIAogICAgICAgICAqIDM6IC1ZCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gc2V0UGxhbmVGYWNlKGZhY2VJbmRleCkgewogICAgICAgICAgICBtYXNrc1t0YWdzLmRpbWVuc2lvbiArICdQb3NpdGlvbiddID0gTE9DQUxfUE9TSVRJT05TW2ZhY2VJbmRleF07CiAgICAgICAgICAgIG1hc2tzW3RhZ3MuZGltZW5zaW9uICsgJ1JvdGF0aW9uJ10gPSBMT0NBTF9ST1RBVElPTlNbZmFjZUluZGV4XTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uOmAsIHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICB9CgogICAgICAgIGlmICghdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcGFyZW50UG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbih0YWdzLnRyYW5zZm9ybWVyLCB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gcGFyZW50IHBvc2l0aW9uOmAsIHBhcmVudFBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGxldCBncmlkUG9ydGFsVHlwZTogJ2dyaWQnIHwgJ21pbmlHcmlkJyB8IG51bGwgPSBudWxsOwoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgZ3JpZFBvcnRhbFR5cGUgPSAnZ3JpZCc7CiAgICAgICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgZ3JpZFBvcnRhbFR5cGUgPSAnbWluaUdyaWQnOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBkZXRlY3RlZCBncmlkIHBvcnRhbCB0eXBlOmAsIGdyaWRQb3J0YWxUeXBlKTsKICAgICAgICB9CgogICAgICAgIGlmICghZ3JpZFBvcnRhbFR5cGUpIHsKICAgICAgICAgICAgc2V0UGxhbmVGYWNlKDApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBjYW1lcmFQb3NpdGlvbiA9IG9zLmdldENhbWVyYVBvc2l0aW9uKGdyaWRQb3J0YWxUeXBlKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBjYW1lcmEgcG9zaXRpb246YCwgY2FtZXJhUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGlyZWN0aW9uVG9DYW1lcmEgPSBjYW1lcmFQb3NpdGlvbi5zdWJ0cmFjdChwYXJlbnRQb3NpdGlvbikubm9ybWFsaXplKCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGlyZWN0aW9uIHRvIGNhbWVyYTpgLCBkaXJlY3Rpb25Ub0NhbWVyYSk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBwYXJlbnRSb3RhdGlvbiA9IGdldEJvdFJvdGF0aW9uKHRhZ3MudHJhbnNmb3JtZXIsIHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICBjb25zdCB3b3JsZE5vcm1hbHM6IFZlY3RvcjNbXSA9IG5ldyBBcnJheSg0KTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgICB3b3JsZE5vcm1hbHNbaV0gPSBwYXJlbnRSb3RhdGlvbi5yb3RhdGVWZWN0b3IzKExPQ0FMX05PUk1BTFNbaV0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSB3b3JsZCBub3JtYWxzOmAsIHdvcmxkTm9ybWFscyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEZpbmQgdGhlIGZhY2UgbW9zdCBmYWNpbmcgdGhlIGNhbWVyYSAobWF4IGRvdCBwcm9kdWN0KS4gCiAgICAgICAgbGV0IGJlc3RJbmRleCA9IDA7IAogICAgICAgIGxldCBiZXN0RG90ID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZOyAKICAgICAgICAKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkTm9ybWFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdCBkb3QgPSB3b3JsZE5vcm1hbHNbaV0uZG90KGRpcmVjdGlvblRvQ2FtZXJhKTsKICAgICAgICAgICAgaWYgKGRvdCA+IGJlc3REb3QpIHsKICAgICAgICAgICAgICAgIGJlc3REb3QgPSBkb3Q7IAogICAgICAgICAgICAgICAgYmVzdEluZGV4ID0gaTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gYmVzdCBmYWNlIGluZGV4OmAsIGJlc3RJbmRleCk7CiAgICAgICAgfQoKICAgICAgICBzZXRQbGFuZUZhY2UoYmVzdEluZGV4KTsKICAgIH0pLAogICAgLi4ucmVzdAp9Cgpjb25zdCBmYWNlUGxhbmVCb3QgPSBjcmVhdGUoZmFjZVBsYW5lTW9kKTsKCnJldHVybiBmYWNlUGxhbmVCb3Q7JwCD9bgxr7MDCGFiSWdub3JlAgQAg/W4MbrkAwR0cnVlJwCD9bgxr7MDC2FiSW50ZXJmYWNlAgQAg/W4Mb/kAwR0cnVlJwCD9bgxr7MDBnN5c3RlbQIEAIP1uDHE5AMYYWIuaW50ZXJmYWNlLmJvdF9mYWN0b3J5JwCD9bgxr7MDFmFiQ3JlYXRlQmlsbGJvYXJkTGFiZWwCBACD9bgx3eQDjUVAbGV0IHsgCiAgICBib3QsCiAgICBkaW1lbnNpb24sCiAgICBwcmVzZXJ2ZU5ld0xpbmVzID0gdHJ1ZSwKICAgIGxhYmVsID0gJycsCiAgICBzcGFjZSA9ICd0ZW1wTG9jYWwnLAogICAgY29sb3IgPSAnd2hpdGUnLAogICAgbGFiZWxDb2xvciA9ICdibGFjaycsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9OwoKaWYgKHR5cGVvZiBsYWJlbCAhPT0gJ3N0cmluZycpIHsKICAgIGxhYmVsID0gU3RyaW5nKGxhYmVsKTsKfQoKYXNzZXJ0KGxpbmtzLnV0aWxzLmlzQm90KGJvdCksIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm90IGlzIGEgcmVxdWlyZWQgQm90IHBhcmFtZXRlci5gKTsKYXNzZXJ0KGRpbWVuc2lvbiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkaW1lbnNpb24gaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CmFzc2VydChyZXN0Lm9uQ3JlYXRlID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQW55Qm90c0NoYW5nZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25BbnlCb3RzUmVtb3ZlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC51cGRhdGVMYWJlbCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5sYWJlbFdvcmRXcmFwTW9kZSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGxhYmVsV29yZFdyYXBNb2RlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwoKLy8gLS0tIDEpIFdvcmQgYnJlYWtpbmcgKHdyYXAgYnkgd29yZHMsIGNodW5rIGxvbmcgd29yZHMpIC0tLQpmdW5jdGlvbiBicmVha1dvcmRzVG9MaW5lcyh0ZXh0LCBtYXhDb2xzID0gMTgpIHsKICAgIGlmICghdGV4dCkgcmV0dXJuIFsnJ107CiAgICBjb25zdCB3b3JkcyA9IHRleHQuc3BsaXQoL1xzKy8pLmZpbHRlcihCb29sZWFuKTsKICAgIGNvbnN0IGxpbmVzID0gW107CiAgICBsZXQgbGluZSA9ICcnOwoKICAgIGNvbnN0IHB1c2ggPSAoKSA9PiB7IGxpbmVzLnB1c2gobGluZSk7IGxpbmUgPSAnJzsgfTsKCiAgICBmb3IgKGNvbnN0IHcgb2Ygd29yZHMpIHsKICAgICAgICBpZiAody5sZW5ndGggPiBtYXhDb2xzKSB7CiAgICAgICAgICAgIC8vIGNsb3NlIGN1cnJlbnQgbGluZSAoaWYgYW55KSBiZWZvcmUgY2h1bmtpbmcgYSBsb25nIHdvcmQKICAgICAgICAgICAgaWYgKGxpbmUpIHB1c2goKTsKICAgICAgICAgICAgLy8gY2h1bmsgdGhlIGxvbmcgd29yZAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcubGVuZ3RoOyBpICs9IG1heENvbHMpIHsKICAgICAgICAgICAgICAgIGxpbmVzLnB1c2gody5zbGljZShpLCBpICsgbWF4Q29scykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpbmUgPSAnJzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICghbGluZS5sZW5ndGgpIHsKICAgICAgICAgICAgbGluZSA9IHc7CiAgICAgICAgfSBlbHNlIGlmIChsaW5lLmxlbmd0aCArIDEgKyB3Lmxlbmd0aCA8PSBtYXhDb2xzKSB7CiAgICAgICAgICAgIGxpbmUgKz0gJyAnICsgdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwdXNoKCk7CiAgICAgICAgICAgIGxpbmUgPSB3OwogICAgICAgIH0KICAgIH0KICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaCgpOwoKICAgIHJldHVybiBsaW5lcy5sZW5ndGggPyBsaW5lcyA6IFsnJ107Cn0KCi8vIFByZXNlcnZlcyBleGlzdGluZyBcbiBhcyBoYXJkIGJyZWFrczsgd3JhcHMgd2l0aGluIGVhY2ggaGFyZCBsaW5lLgpmdW5jdGlvbiBicmVha1dvcmRzVG9MaW5lc1ByZXNlcnZlTmV3bGluZXModGV4dCwgbWF4Q29scyA9IDE4KSB7CiAgaWYgKHRleHQgPT0gbnVsbCkgcmV0dXJuIFsnJ107CgogIC8vIFNwbGl0IG9uIHJlYWwgbmV3bGluZXM7IGtlZXAgZW1wdHkgbGluZXMgc28gd2UgcHJlc2VydmUgYmxhbmsgbGluZXMuCiAgY29uc3QgaGFyZExpbmVzID0gU3RyaW5nKHRleHQpLnNwbGl0KC9ccj9cbi8pOwogIGNvbnN0IG91dCA9IFtdOwoKICAvLyBIZWxwZXIgdG8gd3JhcCBhIHNpbmdsZSBoYXJkIGxpbmUgYnkgd29yZHMgKHdpdGggbG9uZy13b3JkIGNodW5raW5nKQogIGNvbnN0IHdyYXBPbmUgPSAoc3JjKSA9PiB7CiAgICAvLyBOb3JtYWxpemUgdGFicyAtPiBzcGFjZXM7IGNvbGxhcHNlIGludGVybmFsIHdoaXRlc3BhY2UgKG5vdCBuZXdsaW5lcykKICAgIGNvbnN0IHMgPSBzcmMucmVwbGFjZSgvXHQvZywgJyAgICAnKS5yZXBsYWNlKC9ccysvZywgJyAnKS50cmltKCk7CiAgICBpZiAoIXMubGVuZ3RoKSB7IG91dC5wdXNoKCcnKTsgcmV0dXJuOyB9CgogICAgY29uc3Qgd29yZHMgPSBzLnNwbGl0KCcgJyk7CiAgICBsZXQgbGluZSA9ICcnOwoKICAgIGNvbnN0IHB1c2hMaW5lID0gKCkgPT4geyBvdXQucHVzaChsaW5lKTsgbGluZSA9ICcnOyB9OwoKICAgIC8vIGNodW5rIGxvbmcgd29yZHMgdG8gZW11bGF0ZSAnYnJlYWtXb3JkcycKICAgIGNvbnN0IGNodW5rV29yZCA9ICh3KSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdy5sZW5ndGg7IGkgKz0gbWF4Q29scykgewogICAgICAgIGNvbnN0IGNodW5rID0gdy5zbGljZShpLCBpICsgbWF4Q29scyk7CiAgICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgbGluZSA9IGNodW5rOwogICAgICAgIGVsc2UgeyBwdXNoTGluZSgpOyBsaW5lID0gY2h1bms7IH0KICAgICAgfQogICAgfTsKCiAgICBmb3IgKGNvbnN0IHcgb2Ygd29yZHMpIHsKICAgICAgaWYgKHcubGVuZ3RoID4gbWF4Q29scykgewogICAgICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaExpbmUoKTsKICAgICAgICBjaHVua1dvcmQodyk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgewogICAgICAgIGxpbmUgPSB3OwogICAgICB9IGVsc2UgaWYgKGxpbmUubGVuZ3RoICsgMSArIHcubGVuZ3RoIDw9IG1heENvbHMpIHsKICAgICAgICBsaW5lICs9ICcgJyArIHc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHVzaExpbmUoKTsKICAgICAgICBsaW5lID0gdzsKICAgICAgfQogICAgfQogICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoTGluZSgpOwogIH07CgogIGZvciAoY29uc3QgaGwgb2YgaGFyZExpbmVzKSB7CiAgICB3cmFwT25lKGhsKTsgICAgICAgICAgIC8vIHdyYXAgd2l0aGluIHRoaXMgaGFyZCBsaW5lCiAgfQoKICAvLyBJZiB0aGUgaW5wdXQgZW5kZWQgd2l0aCBhIHRyYWlsaW5nIG5ld2xpbmUsIHdlIGFscmVhZHkgcHJlc2VydmVkIGl0CiAgLy8gYmVjYXVzZSBzcGxpdCBrZXB0IGFuIGVtcHR5IGxhc3QgaXRlbSAtPiBiZWNhbWUgYW4gZW1wdHkgd3JhcHBlZCBsaW5lLgogIHJldHVybiBvdXQubGVuZ3RoID8gb3V0IDogWycnXTsKfQoKLy8gLS0tIDIpIFNpbXBsZSBzaXppbmcgZnJvbSBsaW5lcyAtLS0KLy8gVGhpbmsgb2YgImNvbHNQZXJTY2FsZVgiIGFzICJhYm91dCBOIGNoYXJhY3RlcnMgcGVyIDEgc2NhbGVYIi4KZnVuY3Rpb24gY29tcHV0ZVNpbXBsZVNjYWxlc0Zyb21MaW5lcyhsaW5lcywgewogICAgY29sc1BlclNjYWxlWCA9IDIuNSwKICAgIG1pblNjYWxlWCA9IDEuMjUsCiAgICBtYXhTY2FsZVggPSAxMCwKICAgIGJhc2VTY2FsZVkgPSAxLjIsCiAgICBwZXJMaW5lWSA9IDAuNzUsCn0gPSB7fSkgewogICAgY29uc3QgbG9uZ2VzdCA9IGxpbmVzLnJlZHVjZSgobSwgbCkgPT4gTWF0aC5tYXgobSwgbC5sZW5ndGgpLCAwKTsKICAgIGNvbnN0IGxpbmVDb3VudCA9IE1hdGgubWF4KDEsIGxpbmVzLmxlbmd0aCk7CgogICAgLy8gV2lkdGggc2NhbGVzIHdpdGggdGhlIGxvbmdlc3QgbGluZSBsZW5ndGgKICAgIGxldCBzY2FsZVggPSBsb25nZXN0ID4gMCA/IChsb25nZXN0IC8gY29sc1BlclNjYWxlWCkgOiBtaW5TY2FsZVg7CiAgICBzY2FsZVggPSBNYXRoLm1heChtaW5TY2FsZVgsIE1hdGgubWluKG1heFNjYWxlWCwgc2NhbGVYKSk7CgogICAgLy8gSGVpZ2h0IGdyb3dzIHBlciBsaW5lOyBrZWVwIGl0IHNpbXBsZSBhbmQgcHJlZGljdGFibGUKICAgIGNvbnN0IHNjYWxlWSA9IE1hdGgubWF4KGJhc2VTY2FsZVksIGJhc2VTY2FsZVkgKyAobGluZUNvdW50IC0gMSkgKiBwZXJMaW5lWSk7CgogICAgcmV0dXJuIHsgc2NhbGVYLCBzY2FsZVksIGxvbmdlc3QsIGxpbmVDb3VudCB9Owp9CgoKLy8gUGljayB5b3VyIHRhcmdldCAiY29sdW1ucyIgcGVyIGxpbmUgKHR3ZWFrIHRvIHRhc3RlKQpjb25zdCBNQVhfQ09MUyA9IDMyOwoKLy8gQnJlYWsgdGhlIHRleHQgeW91cnNlbGYKY29uc3QgbGluZXMgPSBwcmVzZXJ2ZU5ld0xpbmVzID8gYnJlYWtXb3Jkc1RvTGluZXNQcmVzZXJ2ZU5ld2xpbmVzKGxhYmVsLCBNQVhfQ09MUykgOiBicmVha1dvcmRzVG9MaW5lcyhsYWJlbCwgTUFYX0NPTFMpOwpjb25zdCB3cmFwcGVkTGFiZWwgPSBsaW5lcy5qb2luKCdcbicpOwoKLy8gQ29tcHV0ZSBzaW1wbGUgc2NhbGVzIGZyb20gdGhlIHdyYXBwZWQgdGV4dApjb25zdCB7IHNjYWxlWCwgc2NhbGVZIH0gPSBjb21wdXRlU2ltcGxlU2NhbGVzRnJvbUxpbmVzKGxpbmVzKTsKCmxldCBsYWJlbE1vZCA9IHsKICAgIHNwYWNlOiBzcGFjZSwKICAgIHRyYWNrQm90SWQ6IGJvdC5pZCwKICAgIGZvcm06ICdzcHJpdGUnLAogICAgY29sb3IsCiAgICBsYWJlbDogd3JhcHBlZExhYmVsLAogICAgbGFiZWxDb2xvciwKICAgIGxhYmVsU2l6ZTogMSwKICAgIGxhYmVsUGFkZGluZ1g6IDAuNSwKICAgIGxhYmVsV29yZFdyYXBNb2RlOiAnbm9uZScsCiAgICBzY2FsZVgsIAogICAgc2NhbGVZLAogICAgc2NhbGVaOiAwLjEsCiAgICBib3RMYWJlbE1hcmdpbjogMSwKICAgIGFuY2hvclBvaW50OiAn4p6h77iPMCwtMC41LDAnLAogICAgb3JpZW50YXRpb25Nb2RlOiAnYmlsbGJvYXJkJywKICAgIGRpbWVuc2lvbjogZGltZW5zaW9uLAogICAgZGVidWc6IGZhbHNlLAogICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgb25DcmVhdGU6IGBACiAgICAgICAgLy8gV2FpdCBmb3IgcmVxdWlyZWQgYm90cyB0byBiZSByZWFkeS4KICAgICAgICBsZXQgd2FpdFRpbWUgPSAwOwoKICAgICAgICB3aGlsZSghZ2xvYmFsVGhpcy5hYikgewogICAgICAgICAgICBpZiAod2FpdFRpbWUgPj0gNTAwMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCBvcy5zbGVlcCgyNTApOwogICAgICAgICAgICB3YWl0VGltZSArPSAyNTA7CiAgICAgICAgfQoKICAgICAgICB0YWdzLnJlYWR5ID0gdHJ1ZTsKICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICBgLAogICAgb25BbnlCb3RzQ2hhbmdlZDogYEAKICAgICAgICBmb3IgKGNvbnN0IGNoYW5nZWQgb2YgdGhhdCkgewogICAgICAgICAgICBpZiAoY2hhbmdlZC5ib3QgJiYgY2hhbmdlZC5ib3QuaWQgPT09IHRhZ3MudHJhY2tCb3RJZCkgewogICAgICAgICAgICAgICAgY29uc3Qgb25seVJvdGF0aW9uVGFncyA9IGNoYW5nZWQudGFncy5ldmVyeSgodCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmVuZHNXaXRoKCdSb3RhdGlvbicpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWCcpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWScpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWicpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBvbmx5Um90YXRpb25UYWdzOicsIG9ubHlSb3RhdGlvblRhZ3MpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChvbmx5Um90YXRpb25UYWdzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGAsCiAgICBvbkFueUJvdHNSZW1vdmVkOiBgQAoKICAgICAgICBpZiAodGhhdC5ib3RJRHMuaW5jbHVkZXModGFncy50cmFja0JvdElkKSkgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgIH0KICAgIGAsCiAgICBvblBvcnRhbENoYW5nZWQ6IGBACiAgICAgICAgaWYgKHRoYXQuZGltZW5zaW9uID09PSB0YWdzLmRpbWVuc2lvbikgewogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICAgICAgfQogICAgYCwKICAgIHVwZGF0ZUxhYmVsOiBgQAogICAgICAgIGlmICghdGFncy5yZWFkeSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yaW5nIHVwZGF0ZUxhYmVsIGJlY2F1c2Ugbm90IHJlYWR5Jyk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBoYXNMYWJlbCA9IHRhZ3MubGFiZWwgIT0gbnVsbCAmJiB0YWdzLmxhYmVsICE9PSAnJzsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGhhc0xhYmVsOwoKICAgICAgICBpZiAoIWhhc0xhYmVsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yZSB1cGRhdGVMYWJlbCBjYWxsLCB0aGVyZSBpcyBubyBsYWJlbCB0YWcgdmFsdWUgdG8gZGlzcGxheS4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaW5NYXBQb3J0YWwgPSAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgY29uc3QgaW5HcmlkUG9ydGFsID0gKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICghaW5NYXBQb3J0YWwgJiYgIWluR3JpZFBvcnRhbCkgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmUgdXBkYXRlTGFiZWwgY2FsbCwgbm90IGluIGVpdGhlciBncmlkIG9yIG1hcCBwb3J0YWwuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdHJhY2tCb3QgPSBnZXRCb3QoJ2lkJywgdGFncy50cmFja0JvdElkKTsKICAgICAgICBjb25zdCB0cmFja1Bvc2l0aW9uID0gZ2V0Qm90UG9zaXRpb24odHJhY2tCb3QsIHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSB0cmFja1Bvc2l0aW9uOicsIHRyYWNrUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgbGV0IGxhYmVsUG9zaXRpb24gPSB7IHg6IHRyYWNrUG9zaXRpb24ueCwgeTogdHJhY2tQb3NpdGlvbi55LCB6OiB0cmFja1Bvc2l0aW9uLnogfTsgCgogICAgICAgIGNvbnN0IHRyYWNrQm90U2NhbGUgPSB0cmFja0JvdC50YWdzLnNjYWxlID8/IDE7CiAgICAgICAgY29uc3QgdHJhY2tCb3RTY2FsZVogPSB0cmFja0JvdC50YWdzLnNjYWxlWiA/PyAxOwoKICAgICAgICBsZXQgbWV0ZXJzUGVyR3JpZFVuaXQgPSAxOwoKICAgICAgICBpZiAoaW5NYXBQb3J0YWwpIHsKICAgICAgICAgICAgLy8gU2NhbGUgdG8gbWFwIHBvcnRhbCB1bml0cy4KICAgICAgICAgICAgbWV0ZXJzUGVyR3JpZFVuaXQgPSAxMDsKICAgICAgICB9CgogICAgICAgIGxldCB0cmFja0JvdFJlYWxTY2FsZVogPSAodHJhY2tCb3RTY2FsZVogKiB0cmFja0JvdFNjYWxlKSAqIG1ldGVyc1BlckdyaWRVbml0OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIHRyYWNrQm90UmVhbFNjYWxlWjonLCB0cmFja0JvdFJlYWxTY2FsZVopOwogICAgICAgIH0KCiAgICAgICAgbGFiZWxQb3NpdGlvbi56ICs9IHRyYWNrQm90UmVhbFNjYWxlWiArICh0YWdzLmJvdExhYmVsTWFyZ2luICogbWV0ZXJzUGVyR3JpZFVuaXQpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGxhYmVsUG9zaXRpb246JywgbGFiZWxQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1gnXSA9IGxhYmVsUG9zaXRpb24ueDsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1knXSA9IGxhYmVsUG9zaXRpb24ueTsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1onXSA9IGxhYmVsUG9zaXRpb24uejsKICAgIGAKfTsKCmxhYmVsTW9kID0gewogICAgLi4ubGFiZWxNb2QsCiAgICAuLi5yZXN0LAp9Cgpjb25zdCBsYWJlbEJvdCA9IGNyZWF0ZShsYWJlbE1vZCk7CgpyZXR1cm4gbGFiZWxCb3Q7JwCD9bgxr7MDBXV0aWxzAgQAg/W4MeepBCjwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwCD9bgxr7MDBGZvcm0CBACD9bgxjqoEB25vdGhpbmcnAIP1uDGvswMJYWJWZXJzaW9uAgQAg/W4MZaqBAUxMC4zNQA="}]}