{"version":2,"updates":[{"id":0,"timestamp":1756481169488,"update":"AdUB+56DiQQAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwD7noOJBAAKYWJJRE9yaWdpbgIEAPueg4kEAQ10b29sYm94X3NraWxsJwD7noOJBAALYWJJbnRlcmZhY2UCBAD7noOJBA8EdHJ1ZScA+56DiQQAC2Rlc2NyaXB0aW9uAgQA+56DiQQUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwD7noOJBAAEZm9ybQIEAPueg4kEPgdub3RoaW5nJwD7noOJBAAEbWVudQIEAPueg4kERijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwD7noOJBAAGc3lzdGVtAgQA+56DiQRtFGFiLmludGVyZmFjZS50b29sYm94JwD7noOJBAAKYWJJRFN0dWRpbwIEAPueg4kEggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwD7noOJBAAIcmVtZW1iZXICBAD7noOJBKcBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAPueg4kEAAt0b29sYm94X2FkZAIEAPueg4kEzgGnC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgidG9vbGJveCIsIGdldExpbmsoYWN0aXZlVG9vbGJveCkpOwogICAgaWYgKG1lbnVCb3QpIHsKICAgICAgICBtZW51Qm90Lm9uQ2xpY2soKTsKICAgIH0KfQplbHNlIGlmIChhY3RpdmVUb29sYm94ICYmIGFjdGl2ZVRvb2xib3gudGFncy5hYkdyaWRNZW51QWN0aW9uKSB7CiAgICBhY3RpdmVUb29sYm94LmFiR3JpZE1lbnVBY3Rpb24oeyBncmlkSW5mb3JtYXRpb246IGdyaWREYXRhIH0pOwp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiQ29yZU1lbnVBY3Rpb24pIHsKICAgIC8vUkVGUkVTSCBBTkQgVEhFTiBPUEVOPz8/Cn0nAPueg4kEAAVsZWFybgIEAPueg4kE9gwo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycA+56DiQQABXN0b3JlAgQA+56DiQSdDSjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwD7noOJBAAGc2VhcmNoAgQA+56DiQTEDSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwD7noOJBAAIYWJJZ25vcmUCBAD7noOJBOsNBHRydWUnAPueg4kEAAlhYlZlcnNpb24CBAD7noOJBPANBDEwLjYnAPueg4kEAA1tYW5pZmVzdGF0aW9uAgQA+56DiQT1DSjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwD7noOJBAAQYWJHcmlkTWVudUFjdGlvbgIEAPueg4kEnA7KCkBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAogICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwpgOwp0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACiAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewogICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CiAgICB9CmA7CnRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IGBACiAgICB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKICAgIHRoaXNCb3QubWFza3Mub25LZXlEb3duID0gbnVsbDsKICAgIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IG51bGw7CmA7Cgpjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKY29uc3QgbWVudUJvdCA9IHt9OwoKbWVudUJvdC5hYk1lbnUgPSB0cnVlOwptZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwptZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwptZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOwptZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247Cm1lbnVCb3Qub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIudG9vbGJveF9hZGQoe3Rvb2xib3hEYXRhOiB0YWdzLnRvb2xib3hfZGF0YSwgZ3JpZERhdGE6IHRhZ3MuZ3JpZERhdGF9KTsgc2hvdXQoImFiTWVudVJlZnJlc2giKTtgOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykKewogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOwogICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsKCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7CiAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7CgogICAgaWYgKCFleHRhbnRCb3QpCiAgICB7CiAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJvdCk7CiAgICB9Cn0nAPueg4kEABRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAPueg4kE5xjiAkBjb25zdCB0b29sYm94QXJyYXkgPSBhYlJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKCmxldCBhbGxUb29sc0xvYWRlZCA9IHRydWU7Cgpmb3IgKGxldCBpID0gMDsgaSA8IHRvb2xib3hBcnJheS5sZW5ndGg7IGkrKykgewogICAgY29uc3QgY3VycmVudFRvb2wgPSB0b29sYm94QXJyYXlbaV0ubmFtZTsKCiAgICBpZiAoIWdldEJvdCgiYWJJRE9yaWdpbiIsIGN1cnJlbnRUb29sKSAmJiAhZ2V0Qm90KGN1cnJlbnRUb29sLCB0cnVlKSkgewogICAgICAgIGFsbFRvb2xzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChhbGxUb29sc0xvYWRlZCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfScA+56DiQQADmFiR3JpZE1lbnVJY29uAgQA+56DiQTKGwpsb2NhbF9tYWxsJwD7noOJBAAPYWJHcmlkTWVudUxhYmVsAgQA+56DiQTVGw5jYXN1YWwgY2F0YWxvZycA+56DiQQAE2FiR3JpZE1lbnVTb3J0T3JkZXICBAD7noOJBOQbATMnAPueg4kEAA9vbkFCSW5pdGlhbGl6ZWQCBAD7noOJBOYbKkAvLyBsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOycA+56DiQQADW9uU2tpbGxVcGRhdGUCBAD7noOJBJEcV0BsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOw0KDQpjb25zb2xlLmxvZygiW1Rvb2xib3hdIExvYWRpbmcgY2FzdWFsIGtpdCIpOycA+56DiQQACnNoZWxsVXRpbHMCBAD7noOJBOkcKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAPueg4kEABhhYkdyaWRNZW51T25CZWZvcmVDcmVhdGUCBAD7noOJBJAdiAFAaWYgKGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSkgew0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiR3JpZE1lbnVMYWJlbCIsIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSk7DQp9JwEEYm90cyQxNzQxMGQ4My03ZWVlLTRhMWUtYjYzOC02NTQ2Mzc0ZDE3YzMBJwD7noOJBJkeBnN5c3RlbQIEAPueg4kEmh4RYWIuaW50ZXJmYWNlLnNjYW4nAPueg4kEmR4EZm9ybQIEAPueg4kErB4Hbm90aGluZycA+56DiQSZHgthYkludGVyZmFjZQIEAPueg4kEtB4EdHJ1ZScA+56DiQSZHghhYklnbm9yZQIEAPueg4kEuR4EdHJ1ZScA+56DiQSZHg9vblFSQ29kZVNjYW5uZWQCBAD7noOJBL4egA5AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgppZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhc2siKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKHRoYXQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5hc2spIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hc2t9KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5wYXR0ZXJufSk7CiAgICAgICAgfQogICAgICAgIAogICAgfQp9JwD7noOJBJkeBXN0b3JlAgQA+56DiQS/LCjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwD7noOJBJkeBnNlYXJjaAIEAPueg4kE5iwo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScA+56DiQSZHhBhYkNvcmVNZW51QWN0aW9uAgQA+56DiQSNLTdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwD7noOJBJkeD2FiQ29yZU1lbnVMYWJlbAIEAPueg4kExS0Ec2NhbicA+56DiQSZHg5hYkNvcmVNZW51SWNvbgIEAPueg4kEyi0PcXJfY29kZV9zY2FubmVyJwD7noOJBJkeE2FiQ29yZU1lbnVTb3J0T3JkZXICBAD7noOJBNotATMnAPueg4kEmR4JYWJWZXJzaW9uAgQA+56DiQTcLQQxMC42JwEEYm90cyQzYTZjYjljYS1iM2I0LTRkNzctODJmNi1mYTU5YjUyOTZlYzkBJwD7noOJBOEtBnN5c3RlbQIEAPueg4kE4i0XYWIuaW50ZXJmYWNlLm5hdmlnYXRpb24nAPueg4kE4S0IYWJJZ25vcmUCBAD7noOJBPotBHRydWUnAPueg4kE4S0PZHJvcGRvd25PcHRpb25zAgQA+56DiQT/LQbwn6esW10nAPueg4kE4S0SYWJDb3JlTWVudUl0ZW1UeXBlAgQA+56DiQSELghkcm9wZG93bicA+56DiQThLRFkcm9wZG93blNvcnRPcmRlcgIEAPueg4kEjS4EYXV0bycA+56DiQThLRhhYkNvcmVNZW51T25CZWZvcmVDcmVhdGUCBAD7noOJBJIurBJAY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IGN1cnJlbnREaW0gPSBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uOw0KY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCg0KaWYgKGN1cnJlbnRQb3J0YWwgIT0gJ21hcCcpIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gdHJ1ZTsNCn0gZWxzZSB7DQogICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IGZhbHNlOw0KfQ0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJOYXZpZ2F0aW9uTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuc2tpbGxCb3QgPSBnZXRMaW5rKHRoaXNCb3QpOw0KDQpjb25zdCBob21lQnV0dG9uID0gew0KICAgIC4uLm1lbnVPcHRpb25zLA0KICAgIGxhYmVsOiAiaG9tZSIsDQogICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvY2QzOGFmZmMwNjA0YmVhYTU4OGRhMjFhYTFiZTc1MGJiM2U3M2IzYjNjYWUyM2ViMzAzMDdjMzQ0OTQ0NTlmMy5wbmcnLA0KICAgIG9uQ2xpY2s6IGBAY29uc3QgaG9tZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCiAgICBpZiAoaG9tZUJvdCkgew0KICAgICAgICBvcy5mb2N1c09uKGhvbWVCb3QpLmNhdGNoKGUgPT4ge30pOw0KICAgIH0NCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgIGANCn07DQoNCg0KaWYgKGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKSkgew0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGhvbWVCdXR0b24pOw0KfQ0KDQpjb25zdCBwbGFjZXNBcnIgPSBbXTsNCmNvbnN0IHBsYWNlcyA9IGdldEJvdHMoImhvbWVQbGFjZSIsIHRydWUpOw0KZm9yIChjb25zdCBoUGxhY2Ugb2YgcGxhY2VzKSB7DQogICAgaWYgKGhQbGFjZS50YWdzLmhvbWVCYXNlID09IHRydWUpIHsNCiAgICAgICAgY29udGludWU7DQogICAgfQ0KICAgIGNvbnN0IHBsYWNlT2JqID0gew0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgbGFiZWw6IGhQbGFjZS50YWdzLmxhYmVsLA0KICAgICAgICBmb3JtQWRkcmVzczogJ2xvY2F0aW9uX29uJywNCiAgICAgICAgcGxhY2U6IGdldExpbmsoaFBsYWNlKSwNCiAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgIGlmIChsaW5rcy5wbGFjZSkgew0KICAgICAgICAgICAgICAgIG9zLmZvY3VzT24obGlua3MucGxhY2UpLmNhdGNoKGUgPT4ge30pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIGANCiAgICB9DQoNCiAgICBwbGFjZXNBcnIucHVzaChwbGFjZU9iaik7DQp9DQoNCnBsYWNlc0Fyci5zb3J0KChhLCBiKSA9PiB7DQogICAgY29uc3QgbmFtZUEgPSBhLmxhYmVsLnRvVXBwZXJDYXNlKCk7DQogICAgY29uc3QgbmFtZUIgPSBiLmxhYmVsLnRvVXBwZXJDYXNlKCk7DQoNCiAgICBpZiAobmFtZUEgPCBuYW1lQikgew0KICAgICAgICByZXR1cm4gLTE7DQogICAgfQ0KICAgIGlmIChuYW1lQSA+IG5hbWVCKSB7DQogICAgICAgIHJldHVybiAxOw0KICAgIH0NCiAgICByZXR1cm4gMDsNCn0pOw0KDQpmb3IgKGNvbnN0IHNvcnRlZFBsYWNlIG9mIHBsYWNlc0Fycikgew0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHNvcnRlZFBsYWNlKTsNCn0NCg0KDQpjb25zdCBjdXJyZW50TG9jYXRpb25CdXR0b24gPSB7DQogICAgLi4ubWVudU9wdGlvbnMsDQogICAgbGFiZWw6ICdjdXJyZW50IGxvY2F0aW9uJywNCiAgICBmb3JtQWRkcmVzczogJ25lYXJfbWUnLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIGxpbmtzLnNraWxsQm90LmdvVG9DdXJyZW50TG9jYXRpb24oKTsNCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICBgDQp9DQoNCmRyb3Bkb3duT3B0aW9ucy5wdXNoKGN1cnJlbnRMb2NhdGlvbkJ1dHRvbik7DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycA+56DiQThLRBhYkNvcmVNZW51QWN0aW9uAgQA+56DiQS/QANALy8nAPueg4kE4S0LYWJJbnRlcmZhY2UCBAD7noOJBMNABHRydWUnAPueg4kE4S0PYWJDb3JlTWVudUxhYmVsAgQA+56DiQTIQApuYXZpZ2F0aW9uJwD7noOJBOEtBGZvcm0CBAD7noOJBNNAB25vdGhpbmcnAPueg4kE4S0TZ29Ub0N1cnJlbnRMb2NhdGlvbgIEAPueg4kE20DZBEBjb25zdCBsb2NhdGlvbiA9IGF3YWl0IG9zLmdldEdlb2xvY2F0aW9uKCk7DQoNCmlmIChsb2NhdGlvbi5zdWNjZXNzKSB7DQogICAgY29uc3QgY3VycmVudERpbSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQogICAgY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQoNCiAgICBpZiAoY3VycmVudFBvcnRhbCA9PSAnbWFwJykgew0KICAgICAgICBvcy5mb2N1c09uKHt4OiBsb2NhdGlvbi5sb25naXR1ZGUsIHk6IGxvY2F0aW9uLmxhdGl0dWRlfSwge3BvcnRhbDogJ21hcCd9KTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSBjdXJyZW50RGltOw0KICAgICAgICBvcy5mb2N1c09uKHt4OiBsb2NhdGlvbi5sb25naXR1ZGUsIHk6IGxvY2F0aW9uLmxhdGl0dWRlfSwge3BvcnRhbDogJ21hcCd9KTsNCiAgICB9DQp9IGVsc2Ugew0KICAgIG9zLnRvYXN0KCJMb2NhdGlvbiBzZXJ2aWNlcyBub3QgYXZhaWxhYmxlIikNCn0nAPueg4kE4S0JYWJWZXJzaW9uAgQA+56DiQS1RQQxMC42JwEEYm90cyQ0OTNmZmE0ZC00NmQ0LTRhOTgtYWU5Yy0xMjEyZDY1MTEzM2YBJwD7noOJBLpFBnN5c3RlbQIEAPueg4kEu0UUYWIuaW50ZXJmYWNlLnZlcnNpb24nAPueg4kEukUNb25Ta2lsbFVwZGF0ZQIEAPueg4kE0EWnAUBjb25zdCB2ZXJzaW9uU3RyaW5nID0gdGFncy5hYkludGVyZmFjZU1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJJbnRlcmZhY2VNaW5vclZlcnNpb247DQoNCmNvbnNvbGUubG9nKCJbQUJJbnRlcmZhY2VdIExvYWRlZCBBQiBJbnRlcmZhY2UgdmVyc2lvbiAiICsgdmVyc2lvblN0cmluZyk7JwD7noOJBLpFF2FiSW50ZXJmYWNlTWFqb3JWZXJzaW9uAgQA+56DiQT4RgExJwD7noOJBLpFF2FiSW50ZXJmYWNlTWlub3JWZXJzaW9uAgQA+56DiQT6RgIyMScA+56DiQS6RQhhYklnbm9yZQIEAPueg4kE/UYEdHJ1ZScA+56DiQS6RQRmb3JtAgQA+56DiQSCRwdub3RoaW5nJwD7noOJBLpFC2FiSW50ZXJmYWNlAgQA+56DiQSKRwR0cnVlJwD7noOJBLpFCWFiVmVyc2lvbgIEAPueg4kEj0cEMTAuNicBBGJvdHMkNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmAScA+56DiQSURwZzeXN0ZW0CBAD7noOJBJVHE2FiLmludGVyZmFjZS5udWdnZXQnAPueg4kElEcEZm9ybQIEAPueg4kEqUcHbm90aGluZycA+56DiQSURwthYkludGVyZmFjZQIEAPueg4kEsUcEdHJ1ZScA+56DiQSURwhhYklnbm9yZQIEAPueg4kEtkcEdHJ1ZScA+56DiQSURwxhYkxvYWROdWdnZXQCBAD7noOJBLtHmAJAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldE5hbWU7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIitudWdnZXROYW1lOwpsZXQgbG9hZGVkTnVnZ2V0ID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBmb3JtYXR0ZWROdWdnZXRBQiwgYWJWZXJzaW9uOiB0aGF0LnZlcnNpb24sIHJldHVyblR5cGU6ICJkYXRhIn0pOwoKbG9hZGVkTnVnZ2V0ID0gbG9hZGVkTnVnZ2V0LnN0YXRlW251Z2dldE5hbWVdLm51Z2dldDsKCnJldHVybiBsb2FkZWROdWdnZXQ7JwD7noOJBJRHD2FiUHVibGlzaE51Z2dldAIEAPueg4kE1EmMA0AvL3Nob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiAibnVnTmFtZSIsIGRhdGE6IGRhdGF9KTsgIEFERCBFR0cgSUQgRVZFTlRVQUxMWQpsZXQgdGVzdE51Z2dldCA9IHRoYXQuZGF0YTsKbGV0IGZvcm1hdHRlZE51Z2dldCA9IHtpZDogdGhhdC5udWcsIG51Z2dldDogdGVzdE51Z2dldH07CmxldCB0ZXN0TnVnZ2V0TmFtZSA9IHRoYXQubnVnOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrdGVzdE51Z2dldE5hbWU7CgptYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBmb3JtYXR0ZWROdWdnZXRBQjsKCmxpbmtzLnN0b3JlLmFiUHVibGlzaEFCKHthYjogZm9ybWF0dGVkTnVnZ2V0QUIsIHRhcmdldDogZm9ybWF0dGVkTnVnZ2V0LCBzb3VyY2VFdmVudDogJ3B1Ymxpc2hfbnVnZ2V0J30pOycA+56DiQSURw9pbXBsZW1lbnROdWdnZXQCBAD7noOJBOFMsQdAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldDsKbGV0IG51Z2dldFZlcnNpb25DaGVjayA9IG51Z2dldE5hbWUuaW5kZXhPZigiLnYiKTsKbGV0IHZlcnNpb247CgppZiAobnVnZ2V0VmVyc2lvbkNoZWNrICE9IC0xKQp7CiAgICBudWdnZXROYW1lID0gbnVnZ2V0TmFtZS5zdWJzdHJpbmcoMCwgbnVnZ2V0VmVyc2lvbkNoZWNrKTsKCiAgICBsZXQgdmVyc2lvbkNoZWNrID0gdGhhdC5udWdnZXQuc3Vic3RyaW5nKG51Z2dldFZlcnNpb25DaGVjayArIDIpOwoKICAgIGlmIChpc05hTih2ZXJzaW9uQ2hlY2spKQogICAgewogICAgICAgIGNvbnNvbGUubG9nKHZlcnNpb25DaGVjaywgInZlcnNpb24gaXMgbm90IGEgbnVtYmVyIik7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdmVyc2lvbiA9IE51bWJlcih2ZXJzaW9uQ2hlY2spOwogICAgfQp9CmNvbnNvbGUubG9nKG51Z2dldE5hbWUsIHZlcnNpb24pOwpsZXQgbnVnRGF0YSA9IGF3YWl0IHRoaXNCb3QuYWJMb2FkTnVnZ2V0KHtudWdnZXROYW1lOiBudWdnZXROYW1lLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7CgppZiAobnVnRGF0YSA9PSAiYWJJRCBub3QgZm91bmQiKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IG5vdCBmb3VuZCIpOwp9CmVsc2UKewogICAgbGV0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CiAgICBsZXQgdGFyZ2V0VGFnID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10udG9TdHJpbmcoKTsKICAgIGxldCB0YXJnZXROdWcgPSAieyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0VGFnLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7CiAgICBpbnNlcnRUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgbnVnRGF0YSk7Cn0nAPueg4kElEcMbnVnZ2V0QnV0dG9uAgQA+56DiQSTVPUMQGxldCB0YWdWYWx1ZSA9IHRoYXQudGFnVmFsdWU7CmxldCByZWdleCA9IC9cbi9naTsKbGV0IGJyZWFrQ2hlY2s7CmxldCBicmVha0FycmF5ID0gWzBdOwovL2xldCBjcmVhdGVkQnV0dG9ucyA9IFtdOwoKd2hpbGUgKGJyZWFrQ2hlY2sgPSByZWdleC5leGVjKHRhZ1ZhbHVlKSkKewogICAgYnJlYWtBcnJheS5wdXNoKGJyZWFrQ2hlY2suaW5kZXgpOwp9CgpsZXQgbmV3TnVnZ2V0QnV0dG9uID0ge307CgpuZXdOdWdnZXRCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TnVnZ2V0QnV0dG9uLmZvcm0gPSAiY29kZUJ1dHRvbiI7Cm5ld051Z2dldEJ1dHRvbi50YXJnZXRCb3QgPSB0aGF0LmJvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldFRhZyA9IHRoYXQudGFnOwpuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAibG9hZCBudWdnZXQiOwpuZXdOdWdnZXRCdXR0b24ubnVnZ2V0UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnXSA9IHRydWU7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRNYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLmltcGxlbWVudE51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKZGVzdHJveSh0aGlzQm90KTtgOwoKZm9yIChsZXQgbnVncyA9IDA7IG51Z3MgPCB0aGF0Lm51Z2dldC5sZW5ndGg7IG51Z3MrKykKewogICAgbGV0IGN1cnJlbnROdWdnZXQgPSB0aGF0Lm51Z2dldFtudWdzXTsKICAgIC8vbGV0IGJ1dHRvbkNoZWNrID0gY3JlYXRlZEJ1dHRvbnMuaW5kZXhPZihjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwoKICAgIGlmICghY3VycmVudE51Z2dldCB8fCBjdXJyZW50TnVnZ2V0ID09IHVuZGVmaW5lZCkgLy98fCBidXR0b25DaGVjayAhPSAtMQogICAgewogICAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChjdXJyZW50TnVnZ2V0Lm51Z1B1Ymxpc2gpCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLnBhY2thZ2VOdWdnZXQoe2JvdDogdGFncy50YXJnZXRCb3QsIG51Z2dldDogdGFncy50YXJnZXROdWdnZXQsIHRhZzogdGFncy50YXJnZXRUYWd9KTsKCiAgICAgICAgZGVzdHJveSh0aGlzQm90KTtgOwoKICAgICAgICBuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAicHVibGlzaCAiICsgY3VycmVudE51Z2dldC5udWdOYW1lICsgIiBudWdnZXQiOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CgogICAgbmV3TnVnZ2V0QnV0dG9uLnRhcmdldE51Z2dldCA9IGN1cnJlbnROdWdnZXQubnVnTmFtZTsKICAgIG5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnICsgIlN0YXJ0Il0gPSBjdXJyZW50TnVnZ2V0Lm51Z1N0YXJ0OwoKICAgIGNyZWF0ZShuZXdOdWdnZXRCdXR0b24pOwoKICAgIC8vY3JlYXRlZEJ1dHRvbnMucHVzaChjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwp9CgpyZXR1cm47JwD7noOJBJRHC251Z2dldFBhcnNlAgQA+56DiQSHYacPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwD7noOJBJRHDW9uQUJQdWJsaXNoZWQCBAD7noOJBK9wwQFAY29uc29sZS5sb2codGhhdC5hYiwgdGFncy5udWdnZXRUb1B1Ymxpc2gpCgppZiAodGhhdC5hYiA9PSB0YWdzLm51Z2dldFRvUHVibGlzaCkKewogICAgb3MudG9hc3QoIm51Z2dldCBwdWJsaXNoZWQiKTsKCiAgICBtYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBudWxsOwoKICAgIGNvbmZpZ0JvdC5tYXNrcy5hYlZlcnNpb24gPSBudWxsOwp9JwD7noOJBJRHEG9uQW55Qm90c0NoYW5nZWQCBAD7noOJBPFxtwRAaWYgKGNvbmZpZ0JvdCAmJiB0aGF0WzBdLmJvdC5pZCAhPSB0aGlzQm90LmlkKSAKewogICAgaWYgKCFjb25maWdCb3QudGFncy5lZGl0aW5nQm90KSByZXR1cm47IC8vIElnbm9yZSBpZiB0aGUgY29uZmlnQm90IGlzbid0IHJlYWR5IHlldC4KCiAgICBjb25zdCBlZGl0ZWRCb3RJRCA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QucmVwbGFjZSgi8J+UlyIsICIiKTsKCiAgICBpZiAoIXRoYXQuZmluZCh4ID0+IHguYm90LmlkID09IGVkaXRlZEJvdElEKSkgcmV0dXJuOyAvLyBJZiB0aGUgYm90IGNoYW5nZWQgd2Fzbid0IGJlaW5nIGVkaXRlZCBieSB0aGUgdXNlciBpZ25vcmUgaXQuCgogICAgY29uc3QgZWRpdGVkVGFnID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ1RhZzsKICAgIGNvbnN0IGVkaXRlZEJvdCA9IGdldEJvdCgiaWQiLCBlZGl0ZWRCb3RJRCk7CgogICAgaWYgKGVkaXRlZEJvdCAmJiBlZGl0ZWRUYWcpIAogICAgewogICAgICAgIHNob3V0KCJudWdnZXRSZXNldCIpOwoKICAgICAgICB0aGlzQm90Lm51Z2dldFBhcnNlKHsgZWRpdGVkQm90LCBlZGl0ZWRUYWcgfSk7CiAgICB9Cn0nAPueg4kElEcIb25DcmVhdGUCBAD7noOJBKd2TEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnAPueg4kElEcNcGFja2FnZU51Z2dldAIEAPueg4kE9Hb4BkBjb25zdCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwpjb25zdCB0YWdUZXh0ID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ107CgppZiAoY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleCB8fCBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleCkKewogICAgbGV0IHN0YXJ0UG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleDsKICAgIGxldCBlbmRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleDsKCiAgICBpZiAoc3RhcnRQb3MgPT0gZW5kUG9zKQogICAgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2UgaWYgKHN0YXJ0UG9zID4gZW5kUG9zKQogICAgewogICAgICAgIGxldCBuZXdTdGFydFBvcyA9IGVuZFBvczsKICAgICAgICBsZXQgbmV3RW5kUG9zID0gc3RhcnRQb3M7CgogICAgICAgIHN0YXJ0UG9zID0gbmV3U3RhcnRQb3M7CiAgICAgICAgZW5kUG9zID0gbmV3RW5kUG9zOwogICAgfQoKICAgIGxldCBkYXRhID0gdGFnVGV4dC5zdWJzdHJpbmcoc3RhcnRQb3MsIGVuZFBvcyArIDEpOwoKICAgIHNob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiB0aGF0Lm51Z2dldCwgZGF0YTogZGF0YX0pOwoKICAgIG9zLnRvYXN0KCJudWcgaXMgcHVibGlzaGluZyIsIDEwKTsKCiAgICBsZXQgdGFyZ2V0TnVnID0gIi5udWcgeyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10uaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJjYW5ub3QgcmVhZCBudWdnZXQgdG8gYmUgcHVibGlzaGVkIikKfScA+56DiQSURwhyZW1lbWJlcgIEAPueg4kE7X0o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA+56DiQSURwZzZWFyY2gCBAD7noOJBJR+KPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAPueg4kElEcFc3RvcmUCBAD7noOJBLt+KPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAPueg4kElEcJbGlzdGVuaW5nAgQA+56DiQTifgVmYWxzZScA+56DiQSURwlhYlZlcnNpb24CBAD7noOJBOh+BDEwLjYnAQRib3RzJGIzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYgEnAPueg4kE7X4ZYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcgIEAPueg4kE7n7ODEBjb25zdCB7CiAgICBsYWJlbCA9IGAke2FiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX0gaXMgd29ya2luZ2AsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9CgpsZXQgYnVzeUluZGljYXRvciA9IHsKICAgIG9uUG9pbnRlclVwOiBudWxsLAogICAgb25Qb2ludGVyRG93bjogbnVsbCwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBidXN5TGFiZWw6IGxhYmVsLAogICAgbGFiZWxBbGlnbm1lbnQ6ICdsZWZ0JywKICAgIHN0YXRlOiAwLAogICAgYW5pbVN0YXRlczogWwogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcnLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICBdLAogICAgYW5pbVJhdGU6IDUwMCwKICAgIG9uQm90QWRkZWQ6IGBACiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIG9uQm90Q2hhbmdlZDogYEAKICAgICAgICBjb25zdCBuZWVkUmVmcmVzaCA9IHRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2J1c3lMYWJlbCcgfHwgdCA9PT0gJ3N0YXRlJyB8fCB0ID09PSAnYW5pbVN0YXRlcycpOwogICAgICAgIGlmIChuZWVkUmVmcmVzaCkgewogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfQogICAgYCwKICAgIHJlZnJlc2hEaXNwbGF5OiBgQAogICAgICAgIGlmICh0YWdzLmFuaW1TdGF0ZXMgJiYgdGFncy5hbmltU3RhdGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgYW5pbVN0YXRlID0gdGFncy5hbmltU3RhdGVzW3RhZ3Muc3RhdGVdOwoKICAgICAgICAgICAgdGFncy5sYWJlbCA9IHRhZ3MuYnVzeUxhYmVsLnRyaW0oKSArIGFuaW1TdGF0ZS5lbGxpcHNpczsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGFuaW1TdGF0ZS5mb3JtQWRkcmVzczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLmxhYmVsIAogICAgICAgIH0KICAgIGAsCiAgICBhbmltYXRlOiBgQAogICAgICAgIGlmICh0YWdzLnN0YXRlID49IHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgKz0gMTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLnNsZWVwKHRhZ3MuYW5pbVJhdGUpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIC4uLnJlc3QKfTsKCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihidXN5SW5kaWNhdG9yKTsKCnJldHVybiBtZW51Qm90OycA+56DiQTtfgZzeXN0ZW0CBAD7noOJBL2LARFhYi5pbnRlcmZhY2UubWVudScA+56DiQTtfgRmb3JtAgQA+56DiQTPiwEHbm90aGluZycA+56DiQTtfgtkZXNjcmlwdGlvbgIEAPueg4kE14sBJlRoaXMgc2tpbGwgaXMgZGVzaWduZWQgZm9yIG1lbnUgc3R1ZmYuKAD7noOJBO1+C2FiSW50ZXJmYWNlAXgnAPueg4kE7X4KYWJPcGVuTWVudQIEAPueg4kE/4sB/RpAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgbWVudVR5cGUgPSB0aGF0ID8gImFiIiArIHRoYXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGF0LnNsaWNlKDEpICsgIk1lbnUiOiAiYWJDb3JlTWVudSI7IC8vc2V0IHVwIGEgY2hlY2sgdG8gc2VlIHdoYXQgdHlwZSBvZiBtZW51IHNob3VsZCBiZSBvY2N1cmluZyBbY29yZSwgYm90LCBncmlkLCBpbnN0XQpsZXQgbWVudVNraWxscyA9IGdldEJvdHMobWVudVR5cGUgKyAiQWN0aW9uIik7CmxldCBtYXhPcHRpb25zID0gbWVudVR5cGUgPT0gImluc3QiID8gNyA6IDU7CmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5OwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MuYmFzZVNraWxsLiR7bWVudVR5cGUgKyAiQWN0aW9uIn0oe2JvdDogdGhpc0JvdH0pO2A7CgpsZXQgc29ydE9yZGVySW5kZXggPSBtZW51U2tpbGxzLmxlbmd0aDsKZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51U2tpbGxzLmxlbmd0aDsgaSsrKS8vQUREIExPR0lDIEZPUiBNT1JFIE9QVElPTlMgVEhBTiA1IDogbWF4T3B0aW9ucwp7CiAgICAvL0FsbG93cyBmb3IgY29kZSB0byBnZXQgY2FsbGVkIGJlZm9yZSB0aGUgbWVudSBnZW5lcmF0ZXMsIHVzZWZ1bCBmb3IgZHluYW1pY2FsbHkgc2V0IGdyb3VwcyBvciBkcm9wZG93bnMKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiXSkgewogICAgICAgIGF3YWl0IHdoaXNwZXIobWVudVNraWxsc1tpXSwgbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiKTsKICAgIH0gCgogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJIaWRlIl0pIHsKICAgICAgICBjb250aW51ZTsKICAgIH0KICAgIAogICAgbGV0IGN1cnJlbnRTa2lsbCA9IG1lbnVTa2lsbHNbaV07CgogICAgYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGN1cnJlbnRTa2lsbC5pZDsKICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkxhYmVsIl07CiAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJY29uIl07CiAgICBhYk1lbnVCdXR0b24ub25DcmVhdGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJPbkdlbmVyYXRlIl07CiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiU29ydE9yZGVyIl07CiAgICBhYk1lbnVCdXR0b24uY29sb3IgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdID8gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwoKICAgIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJkcm9wZG93biIpIHsKICAgICAgICBhYk1lbnVCdXR0b24uZHJvcGRvd25PcHRpb25zID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25PcHRpb25zOwoKICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImdyb3VwIikgewogICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhYk1lbnVCdXR0b24ubWVudUl0ZW1zID0gY3VycmVudFNraWxsLnRhZ3MubWVudUl0ZW1zOwogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiaW5wdXQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ0ZXh0IikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ0b29sIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ3aXphcmQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsKICAgIH0KfQoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCT3Blbk1lbnUnLCB7IG1lbnU6IHRoYXQsIG1lbnVUeXBlLCBtZW51UG9ydGFsOiBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCB9KTsnAPueg4kE7X4SYWJDcmVhdGVNZW51QnV0dG9uAgQA+56DiQT7pgH4DUBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9OwoKbGV0IHsKICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwKICAgIC4uLmFkZGl0aW9uYWxUYWdzCn0gPSB0aGF0ID8/IHt9CgppZiAodHlwZW9mIG1lbnVJdGVtU3R5bGUgPT0gJ3N0cmluZycpIHsKICAgIG1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbVN0eWxlLnJlcGxhY2UoL1x1ezFGOUVDfS91LCAnJyk7IAogICAgbWVudUl0ZW1TdHlsZSA9IEpTT04ucGFyc2UobWVudUl0ZW1TdHlsZSk7Cn0KCmZ1bmN0aW9uIGhhc0JvcmRlclN0eWxlKCkgewogICAgaWYgKG1lbnVJdGVtU3R5bGVbImJvcmRlci10b3Atc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItbGVmdC1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1ib3R0b20tc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItcmlnaHQtc3R5bGUiXSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdKSB7CiAgICBpZiAoYWRkaXRpb25hbFRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJNZW51R3JvdXAiXSkgewoKICAgIH0KfQoKbmV3TWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdNZW51QnV0dG9uLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7Cm5ld01lbnVCdXR0b24ubGFiZWxDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7Cm5ld01lbnVCdXR0b24uc2hhZG93Q29sb3IgPSB0aGF0LnNoYWRvd0NvbG9yID8/IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU2hhZG93Q29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLnNjYWxlWSA9IDE7Cgpjb25zdCBtZW51U3R5bGluZyA9IHsKICAgICJib3JkZXItcmFkaXVzIjoiOHB4IiwKICAgICJtYXJnaW4tdG9wIjogIjhweCIsCiAgICAiYm94LXNoYWRvdyI6IGAzcHggNHB4ICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIm1pbi1oZWlnaHQiOiAiNDRweCIsCiAgICAiYm9yZGVyIjogaGFzQm9yZGVyU3R5bGUoKSA/ICIiIDogYDJweCBzb2xpZCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJ3aWR0aCI6ICJjYWxjKDEwMCUgLSA1cHgpIiwKICAgIC4uLm1lbnVJdGVtU3R5bGUKfQoKbmV3TWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gbWVudVN0eWxpbmc7Cgpjb25zdCBjbGlja2VkU3R5bGluZyA9IHsKICAgIC4uLm1lbnVTdHlsaW5nLAogICAgImZpbHRlciI6ICJicmlnaHRuZXNzKDYwJSkiCn0KY29uc3QgYmFzZVN0eWxlID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9ICfwn6esICR7SlNPTi5zdHJpbmdpZnkoY2xpY2tlZFN0eWxpbmcpfSdgCgpuZXdNZW51QnV0dG9uLm9uUG9pbnRlckRvd24gPSBtZW51SXRlbVN0eWxlPy5bIm1hcmdpbi10b3AiXSAhPSAiMHB4IiA/IGJhc2VTdHlsZSA6ICJAIC8vIjsKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJVcCA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsYDsKCmZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQp7CiAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOwp9CgpuZXdNZW51QnV0dG9uID0gY3JlYXRlKG5ld01lbnVCdXR0b24pOwoKcmV0dXJuIG5ld01lbnVCdXR0b247JwD7noOJBO1+DWFiTWVudVJlZnJlc2gCBAD7noOJBPK0AZ0BQGlmIChjb25maWdCb3QudGFncy5tZW51UG9ydGFsPy5zdWJzdHJpbmcoMCwyKSA9PSAiYWIiKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgogICAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwogICAgbWFza3Mub25LZXlEb3duID0gbnVsbDsKfScA+56DiQTtfghyZW1lbWJlcgIEAPueg4kEkLYBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAPueg4kE7X4NbWFuaWZlc3RhdGlvbgIEAPueg4kEt7YBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAPueg4kE7X4RYWJFbnZpcm9ubWVudE1lbnUCBAD7noOJBN62AYQyQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKCmNvbnN0IGFiRW52aXJvbm1lbnRPcHRpb25zID0gdGhpc0JvdC5hYkdldEVudmlyb25tZW50T3B0aW9ucygpOwoKYnV0dG9uTG9vcDoKZm9yIChsZXQgaSA9IDA7IGkgPCBhYkVudmlyb25tZW50T3B0aW9ucy5sZW5ndGg7IGkrKykKewogICAgbGV0IGFjdGl2ZUJ1dHRvbiA9IGFiRW52aXJvbm1lbnRPcHRpb25zW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBhY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI7CgogICAgaWYgKGFjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZSkKICAgIHsKICAgICAgICBpZiAoIWxpbmtzW2FjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZV0pCiAgICAgICAgewogICAgICAgICAgICBjb250aW51ZSBidXR0b25Mb29wOwogICAgICAgIH0KICAgIH0KCiAgICBsZXQgbmV3QnV0dG9uRGF0YSA9IHsuLi5hYk1lbnVCdXR0b24sIC4uLmFjdGl2ZUJ1dHRvbn07CgogICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3QnV0dG9uRGF0YSk7Cn0KCmNvbnN0IGFiUGVyc29uYWxpdHlDb25maWdCdXR0b24gPSB7CiAgICBsYWJlbDogImN1c3RvbWl6ZTogYWIgcGVyc29uYWxpdHkiLAogICAgLi4uYWJNZW51QnV0dG9uLAogICAgYWJNZW51U29ydE9yZGVyOiAxLAogICAgZHJvcGRvd25Tb3J0T3JkZXI6IDEsCiAgICBkcm9wZG93bk9wdGlvbnM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbmFtZTogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksIHt0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgdG8gY2FsbCBtZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bmFtZTogbmFtZX0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAgIGxhYmVsOiBgYWkgbW9kZWw6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWx9YCwKICAgICAgICAvLyAgICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgICAgICAvLyAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgIC8vICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAvLyAgICAgICAgIGNvbnN0IGFpTW9kZWwgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwsIHt0aXRsZTogJ3doYXQgYWkgbW9kZWwgd291bGQgeW91IGxpa2UgbWUgdG8gdXNlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHthaU1vZGVsOiBhaU1vZGVsfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAvLyAgICAgYCwKICAgICAgICAvLyB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbWUgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge2NvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51cyB0byBiZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bWVudUNvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICAgICAgICAgIC8vbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvciA9IGNvbG9yOyBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciAhPSAnY2xlYXInKXtsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yID0gY29sb3J9OyBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSB0ZXh0IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudSB0ZXh0IHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51TGFiZWxDb2xvcjogY29sb3J9KTsgCiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICAgICAgICAgICAgICAvL2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IgPSBjb2xvcjsgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgIT0gJ2NsZWFyJyl7bGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciA9IGNvbG9yfTsgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGRlZmF1bHQgcG9ydGFsIGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4J31gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBsZXQgcG9ydGFsQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IHdvdWxkIHlvdSBsaWtlIHlvdXIgcG9ydGFsIHRvIGxvb2sgbGlrZT8nfSk7CiAgICAgICAgICAgICAgICBpZiAoIXBvcnRhbENvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgcG9ydGFsQ29sb3IgPSAnIzI2MzIzOCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7J3BvcnRhbENvbG9yJzogcG9ydGFsQ29sb3J9KTsgCiAgICAgICAgICAgICAgICAvL2Rlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGRlZmF1bHQgbWFwIHBvcnRhbCBiYXNlbWFwYCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgc2hvdXQoInNob3dBQkJhc2VtYXBPcHRpb25zIik7CiAgICAgICAgICAgIGAKICAgICAgICB9LAogICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiAiZGVmYXVsdCBzZXR0aW5ncyIsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgICAgICAgICBjb2xvcjogJ3JlZCcsCiAgICAgICAgICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7J2RlZmF1bHRQZXJzb25hbGl0eSc6IHRydWV9KTsgCiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJtZW51IGNvbG9yIiwKICAgICAgICAvLyAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAvLyAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgIC8vICAgICAgICAgY29uc3QgbWVudUNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGFiUGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHt0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudSdzIHRvIGJlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51Q29sb3I6IG1lbnVDb2xvcn0pOyAKICAgICAgICAvLyAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7YCwKICAgICAgICAvLyB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJwcm9tcHQiLAogICAgICAgIC8vICAgICBvbkNsaWNrOiBgQGAsCiAgICAgICAgLy8gfSwKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAgIGxhYmVsOiAiZm9ybSIsCiAgICAgICAgLy8gICAgIG9uQ2xpY2s6IGBAIAogICAgICAgIC8vICAgICAgICAgY29uc3QgZm9ybSA9IGF3YWl0IG9zLnNob3dJbnB1dChhYlBlcnNvbmFsaXR5LnRhZ3MuYWJGb3JtLCB7dGl0bGU6ICd3aGF0IGZvcm0gd291bGQgeW91IGxpa2UgbWUgdG8gdGFrZT8nfSk7CiAgICAgICAgLy8gICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7Zm9ybTogZm9ybX0pOyAKICAgICAgICAvLyAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7YCwKICAgICAgICAvLyB9CiAgICBdCn0KCnRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJQZXJzb25hbGl0eUNvbmZpZ0J1dHRvbik7Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJFbnZpcm9ubWVudE1lbnUnLCB7IG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWx9ICknAPueg4kE7X4FbGVhcm4CBAD7noOJBOPoASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwD7noOJBO1+A2dwdAIEAPueg4kEiukBKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAPueg4kE7X4IYWJJZ25vcmUCBAD7noOJBLHpAQR0cnVlJwD7noOJBO1+BnNlYXJjaAIEAPueg4kEtukBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAPueg4kE7X4GbnVnZ2V0AgQA+56DiQTd6QEo8J+UlzRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZicA+56DiQTtfgV0ZXN0cwIEAPueg4kEhOoBKPCflJdiODNkOTcyYi0wNTM1LTQwNTEtYjU4OS00MWNlZGE4NTM1ZjEnAPueg4kE7X4Pb25Qb3J0YWxDaGFuZ2VkAgQA+56DiQSr6gFuQGlmICh0aGF0LnBvcnRhbCA9PSAic3lzdGVtUG9ydGFsIiAmJiAhdGhhdC5kaW1lbnNpb24gJiYgIWxpbmtzLnRlc3RzKQp7CiAgICBsaW5rcy5sZWFybi5hYkFkYXB0KCJhYlRlc3RzIik7Cn0nAPueg4kE7X4DYXNrAgQA+56DiQSa6wEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycA+56DiQTtfglhYlZlcnNpb24CBAD7noOJBMHrAQQxMC42JwD7noOJBO1+EWFiQ3JlYXRlTWVudUlucHV0AgQA+56DiQTG6wGeAkBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51SW5wdXQgPSB7DQogICAgZm9ybTogImlucHV0IiwNCiAgICBtZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHk6IGZhbHNlLA0KICAgIGZvcm1JbnB1dE11bHRpbGluZTogbnVsbCwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51SW5wdXQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAPueg4kE7X4QYWJDcmVhdGVNZW51VGV4dAIEAPueg4kE5e0BgQRAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpjb25zdCB7DQogICAgbWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIC4uLnJlc3QNCn0gPSB0aGF0Ow0KDQpsZXQgbWVudVRleHQgPSB7DQogICAgZm9ybTogInRleHQiLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgcG9pbnRhYmxlOiBmYWxzZSwNCiAgICBjb2xvcjogIndoaXRlIiwNCiAgICBtZW51SXRlbVN0eWxlOiB7DQogICAgICAgICJwYWRkaW5nLXRvcCI6ICI2cHgiLA0KICAgICAgICAicGFkZGluZy1ib3R0b20iOiAiNnB4IiwNCiAgICB9LA0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZTogew0KICAgICAgICAid2hpdGUtc3BhY2UiOiAicHJlLXdyYXAiLA0KICAgICAgICAuLi5tZW51SXRlbUxhYmVsU3R5bGUsDQogICAgfSwNCiAgICAuLi5yZXN0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRleHQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAPueg4kE7X4QYWJDcmVhdGVNZW51VG9vbAIEAPueg4kE5/EBjgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVRvb2wgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUb29sKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwD7noOJBO1+EmFiQ3JlYXRlTWVudVdpemFyZAIEAPueg4kE9vIBkgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVdpemFyZCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVdpemFyZCk7DQoNCnJldHVybiBtZW51Qm90OycA+56DiQTtfhRhYkNyZWF0ZU1lbnVEcm9wZG93bgIEAPueg4kEifQB1RhAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAoIXRoYXQuZHJvcGRvd25Tb3J0T3JkZXIpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudURyb3Bkb3duOiBkcm9wZG93blNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCBvdXRlck1lbnVCdXR0b24gPSB7DQogICAgLi4udGhhdCwNCiAgICBmb3JtQWRkcmVzczogdGhhdC5mb3JtQWRkcmVzcyA/PyAiYXJyb3dfcmlnaHQiLA0KICAgIGRyb3Bkb3duT3BlbjogZmFsc2UsDQogICAgb25DbGljazogYEANCiAgICAgICAgdGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gJHt0aGF0LmRyb3Bkb3duU29ydE9yZGVyfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gZmFsc2U7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyh0YWdzLmRyb3Bkb3duT3B0aW9ucywgdGFncy5kcm9wZG93blNvcnRPcmRlcik7DQogICAgICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkRlc3Ryb3k6IGBADQogICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgYCwNCiAgICBvblBvaW50ZXJVcDogYEANCiAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgbWFza3MuZm9ybUFkZHJlc3MgPSAiYXJyb3dfcmlnaHQiOw0KICAgICAgICB9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSBmYWxzZSkgew0KICAgICAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAiZm9ybUFkZHJlc3MiLCAiYXJyb3dfZHJvcF9kb3duIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJtZW51SXRlbVN0eWxlIiwgey4uLnRhZ3MubWVudUl0ZW1TdHlsZSwgImJvcmRlckJvdHRvbUxlZnRSYWRpdXMiOiAiMCIsICJib3JkZXJCb3R0b21SaWdodFJhZGl1cyI6ICIwIn0pOw0KICAgICAgICB9DQogICAgYA0KfTsNCg0KaWYgKHRoYXQuZm9ybUFkZHJlc3MgJiYgdGhhdC5mb3JtQWRkcmVzcyAhPSAiYXJyb3dfcmlnaHQiKSB7DQogICAgb3V0ZXJNZW51QnV0dG9uLmN1c3RvbUZvcm1BZGRyZXNzID0gdHJ1ZTsNCn0NCm91dGVyTWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gdGhhdC5kcm9wZG93blNvcnRPcmRlcjsNCg0KY29uc3QgbWVudUJvdCA9IGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG91dGVyTWVudUJ1dHRvbik7DQptZW51Qm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyA9IGdlbmVyYXRlTWVudU9wdGlvbnM7DQoNCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlTWVudU9wdGlvbnMgKG9wdGlvbnMsIHNvcnRPcmRlcikgew0KICAgIGNvbnN0IG1lbnVCb3RzID0gW107DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgKytpKSB7DQoNCiAgICAgICAgbGV0IG5ld01lbnVCdXR0b24gPSB7DQogICAgICAgICAgICAuLi5vcHRpb25zW2ldLA0KICAgICAgICAgICAgY2xlYXJEcm9wZG93bk1lbnU6IGBADQogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsNCiAgICAgICAgICAgIGANCiAgICAgICAgfTsNCg0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSBOdW1iZXIoc29ydE9yZGVyKSArICgoaSArIDEpIC8gMTAwMCk7DQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbF0gPSB0cnVlOw0KDQogICAgICAgIGlmIChpID09IG9wdGlvbnMubGVuZ3RoIC0gMSkgew0KICAgICAgICAgICAgaWYgKG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyUmFkaXVzIl0gPSAiMCAwIDhweCA4cHgiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAgMCA4cHggOHB4Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyUmFkaXVzIl0gPSAiMCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclRvcCJdID0gIm5vbmUiOw0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bIm1hcmdpblRvcCJdID0gIjAiOw0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bInBhZGRpbmdMZWZ0Il0gPSAiMzVweCI7DQoNCiAgICAgICAgY29uc3QgbmV3TWVudUJvdCA9IGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld01lbnVCdXR0b24pOw0KICAgICAgICBtZW51Qm90cy5wdXNoKG5ld01lbnVCb3QpOw0KICAgIH0NCg0KICAgIG1lbnVCb3QudGFncy5tZW51Qm90cyA9IGdldExpbmsobWVudUJvdHMpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdDsNCg0KJwD7noOJBO1+EWFiQ3JlYXRlTWVudUdyb3VwAgQA+56DiQTfjALcHUAvKg0KICAgRVhBTVBMRQ0KICAgY29uc3QgbWVudUdyb3VwID0gew0KICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBncm91cFNvcnRPcmRlcjogMSwNCiAgICAgICAgbWVudUl0ZW1zOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICBjb2xvcjogIm9yYW5nZSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgbWVudUl0ZW1UeXBlOiAiZHJvcGRvd24iLA0KICAgICAgICAgICAgICAgIGRyb3Bkb3duT3B0aW9uczogWw0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfQ0KKi8NCg0KaWYgICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0Lmdyb3VwU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVHcm91cDogZ3JvdXBTb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgew0KICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwNCiAgICBtZW51SXRlbXMgPSBbXSwNCiAgICAuLi5hZGRpdGlvbmFsVGFncw0KfSA9IHRoYXQgPz8ge30NCg0KY29uc3QgbWVudUJvdHMgPSBbXTsNCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudUl0ZW1zLmxlbmd0aDsgKytpKSB7DQoNCiAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9Ow0KDQogICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDApOw0KDQogICAgbGV0IGluZGl2TWVudUl0ZW1TdHlsZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVN0eWxlID8/IHt9Ow0KICAgIGxldCBpbmRpdk1lbnVUeXBlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtVHlwZSA/PyB1bmRlZmluZWQ7DQogICAgbGV0IGluZGl2QWRkaXRpb25hbFRhZ3MgPSBtZW51SXRlbXNbaV07DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdOw0KICAgIH0NCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdOw0KICAgIH0NCg0KICAgIGNvbnN0IGJhc2VTdHlsaW5nID0gew0KICAgICAgICAiYm9yZGVyVG9wIjogIm5vbmUiLA0KICAgICAgICAibWFyZ2luVG9wIjogIjAiDQogICAgfQ0KDQogICAgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCAwIDhweCA4cHgiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfSBlbHNlIGlmIChpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjhweCA4cHggMCAwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nO30NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gaW5kaXZBZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGluZGl2QWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBsZXQgbmV3TWVudUJvdDsNCiAgICBzd2l0Y2goaW5kaXZNZW51VHlwZSkgew0KICAgICAgICBjYXNlICJkcm9wZG93biI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bigNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC4uLm5ld01lbnVCdXR0b24sDQogICAgICAgICAgICAgICAgICAgICJkcm9wZG93blNvcnRPcmRlciI6IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTApDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiaW5wdXQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidGV4dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRvb2wiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ3aXphcmQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICB9DQogICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCn0NCg0KcmV0dXJuIG1lbnVCb3RzOycA+56DiQTtfgtwZXJzb25hbGl0eQIEAPueg4kEvKoCKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAPueg4kE7X4XYWJHZXRFbnZpcm9ubWVudE9wdGlvbnMCBAD7noOJBOOqAq0nQGNvbnN0IG9wdGlvbnMgPSBbXTsKCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6IGBoaWRlYCwKICAgICAgICBmb3JtQWRkcmVzczogInZpc2liaWxpdHlfb2ZmIiwKICAgICAgICBvbkNsaWNrOiAiQCBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDAKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogIm9wdGltaXplIG1vZGUiLAogICAgb25DcmVhdGU6ICJAIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnIDogdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIG9uQ2xpY2s6ICJAIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSBmYWxzZSA6IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gdHJ1ZTsgdGhpc0JvdC5vbkNyZWF0ZSgpOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMQp9KQoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInNsZWVwIiwKICAgICAgICBmb3JtQWRkcmVzczogIm5pZ2h0c19zdGF5IiwKICAgICAgICBvbkNsaWNrOiAiQGxpbmtzLm1hbmlmZXN0YXRpb24uYWJTZXRBd2FrZSh7IGF3YWtlOiBmYWxzZSB9KSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDMKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoYXQiLAogICAgZm9ybUFkZHJlc3M6ICJjaGF0IiwKICAgIG9uQ2xpY2s6ICJAIHNob3V0KCdhYkNoYXRCYXJPcGVuJyk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA0Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJudWdnZXRzIiwKICAgIG9uQ3JlYXRlOiAiQCB0YWdzLm51Z01hbmFnZXIgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmludGVyZmFjZS5udWdnZXQnKSk7IGlmIChsaW5rcy5udWdNYW5hZ2VyLnRhZ3MubGlzdGVuaW5nKXt0YWdzLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgbnVsbCk7YDt0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveGA7fWVsc2V7ICAgIHRhZ3Mub25DbGljayA9IGBAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCB0cnVlLCAnbG9jYWwnKTtgOyAgICB0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveF9vdXRsaW5lX2JsYW5rYDt9IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1Cn0pCgpvcHRpb25zLnB1c2goewogICAgYWJFbnZpcm9ubWVudEdhdGU6ICJncHQiLAogICAgb25DcmVhdGU6ICJAICBpZiAoIWF1dGhCb3Qpe2Rlc3Ryb3kodGhpc0JvdCk7fWVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICdGcmVlUGxheScgfHwgYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gdW5kZWZpbmVkKXtkZXN0cm95KHRoaXNCb3QpO307IHRhZ3MubGFiZWwgPSAnZWRpdCAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgcHJvbXB0JzsgdGFncy5ncHRCb3QgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmFjdGlvbi5hc2snKSk7IiwKICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLmdwdEJvdC5lZGl0UHJvbXB0KCk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA3Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJncmlkIHNuYXAiLAogICAgb25DcmVhdGU6ICJAIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJyIsCiAgICBvbkNsaWNrOiAiQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZTt0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA4Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJib3Qgc25hcCIsCiAgICBvbkNyZWF0ZTogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZTsgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA5Cn0pCgppZiAoYXV0aEJvdCkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogImFjY291bnQiLAogICAgICAgIGZvcm1BZGRyZXNzOiAiYmFkZ2UiLAogICAgICAgIG9uQ2xpY2s6ICJAIG9zLnNob3dBY2NvdW50SW5mbygpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwCiAgICB9KQp9CgppZiAobGlua3MudGVzdHMpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJ0ZXN0cyIsCiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdGVzdCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJzY2llbmNlIiwKICAgICAgICBvbktleURvd246ICJAICIsCiAgICAgICAgb25LZXlVcDogIkAgIiwKICAgICAgICBvbkNsaWNrOiAiQCBsZXQgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoJ2tleWJvYXJkJywgJ1NoaWZ0Jyk7bGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTtzaG91dCgnYWJSZWNvcmRUZXN0Jyk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMQogICAgfSkKCiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgICAgIGxhYmVsOiAicmVjb3JkIHRyYWNlIiwKICAgICAgICBmb3JtQWRkcmVzczogInRpbWVsaW5lIiwKICAgICAgICBvbktleURvd246ICJAICIsCiAgICAgICAgb25LZXlVcDogIkAgIiwKICAgICAgICBvbkNsaWNrOiAiQCBsZXQgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoJ2tleWJvYXJkJywgJ1NoaWZ0Jyk7bGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTtzaG91dCgnYWJSZWNvcmRUcmFjZScpO3Nob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTIKICAgIH0pCn0KCmlmIChnZXRCb3QoInN5c3RlbSIsICJhYi5ob21lLmVnZyIpKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgICAgIGxhYmVsOiAic2F2ZSBob21lIGVnZyIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJlZ2ciLAogICAgICAgIG9uS2V5RG93bjogIkAgIiwKICAgICAgICBvbktleVVwOiAiQCAiLAogICAgICAgIG9uQ2xpY2s6IGBAZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaG9tZS5lZ2ciKS5zYXZlRGF0YSgpO3Nob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTMKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBvbkNyZWF0ZTogYEAKICAgICAgICB0YWdzLmxhYmVsID0gInBlcm1hbmVudGx5IGRlbGV0ZSAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKICAgICAgICB0YWdzLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb250cmFzdENvbG9yID8/ICIjRDkzMDMwIjsKICAgIGAsCiAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgIG9uQ2xpY2s6IGBACiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ1Blcm1hbmVudGx5IGRlbGV0ZSAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgY29udGVudDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArICBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBmcm9tICcgKyBsaW5rcy5sZWFybi50YWdzLmFiSW5zdCArICc/IFRoaXMgaXMgbm90IHJldmVyc2libGUhJywKICAgICAgICB9KQoKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwoKICAgICAgICBjb25zdCBhYkJvdHMgPSBnZXRCb3RzKChiKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBiLnNwYWNlID09PSAnc2hhcmVkJyAmJgogICAgICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0gJiYKICAgICAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtLnN0YXJ0c1dpdGgoJ2FiJyk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgZGVzdHJveShhYkJvdHMpOwogICAgICAgIH0KICAgIGAsCiAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMAp9KQoKcmV0dXJuIG9wdGlvbnM7JwD7noOJBO1+HmFiQ3JlYXRlVG9vbGJveERyb3Bkb3duT3B0aW9ucwIEAPueg4kEkdICxAxAY29uc3QgdG9vbGJveFRvb2xzID0gWy4uLnRoYXQudG9vbEFycmF5XSA/PyBbXTsNCmNvbnN0IHRvb2xib3hOYW1lID0gdGhhdC50b29sYm94TmFtZSA/PyAiS2l0ICI7DQpjb25zdCB0b29sYm94ID0gdGhhdC50b29sYm94Ow0KY29uc3QgZ3JpZEluZm9ybWF0aW9uID0gKHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiAmJiB0aGF0Py5ncmlkSW5mb3JtYXRpb24gIT0gdW5kZWZpbmVkKSA/IHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiA6IGFiUmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsNCg0KY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy50b29sYm94ID0gZ2V0TGluayh0b29sYm94KTsNCm1lbnVPcHRpb25zLmdyaWRJbmZvcm1hdGlvbiA9IGdyaWRJbmZvcm1hdGlvbjsNCm1lbnVPcHRpb25zLnNlYXJjaCA9IHRhZ3Muc2VhcmNoOw0KLy9tZW51T3B0aW9ucy5mb3JtQWRkcmVzcyA9ICJoYXJkd2FyZSI7DQoNCmlmICh0b29sYm94VG9vbHMubGVuZ3RoID09PSAwKSB7DQogICAgY29uc3QgbWVzc2FnZSA9IHRvb2xib3hOYW1lICsgIiBkb2VzIG5vdCBoYXZlIGFueSB0b29scyBsaXN0ZWQgaW4gdGhlIHRvb2xfYXJyYXkgdGFnIjsNCg0KICAgIGFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgbWVzc2FnZSk7DQogICAgb3MudG9hc3QobWVzc2FnZSwgNSk7DQogICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsNCn0NCg0KZm9yIChsZXQgdG9vbCBvZiB0b29sYm94VG9vbHMpIHsNCiAgICBjb25zdCB0b29sQnV0dG9uID0gew0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgbGFiZWw6IHRvb2wubmFtZSwNCiAgICAgICAgdGFyZ2V0QUI6IHRvb2wudGFyZ2V0QUIsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgc291cmNlRXZlbnQ6ICd0b29sJywNCiAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB0YWdzLmdyaWRJbmZvcm1hdGlvbg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgIGAsDQogICAgfTsNCg0KICAgIGlmICh0b29sLmZvcm1BZGRyZXNzKSB7DQogICAgICAgIHRvb2xCdXR0b24uZm9ybUFkZHJlc3MgPSB0b29sLmZvcm1BZGRyZXNzOw0KICAgIH0NCg0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHRvb2xCdXR0b24pOw0KfQ0KDQpyZXR1cm4gZHJvcGRvd25PcHRpb25zOycA+56DiQTtfhBvbkFCQXV0aEJvdEFkZGVkAgQA+56DiQTW3gIYQHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7AA=="}]}