{"version":2,"updates":[{"id":0,"timestamp":1754933735572,"update":"AbgBuNasgwUAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwC41qyDBQAKYWJJRE9yaWdpbgIEALjWrIMFAQ10b29sYm94X3NraWxsJwC41qyDBQALYWJJbnRlcmZhY2UCBAC41qyDBQ8EdHJ1ZScAuNasgwUAC2Rlc2NyaXB0aW9uAgQAuNasgwUUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwC41qyDBQAEZm9ybQIEALjWrIMFPgdub3RoaW5nJwC41qyDBQAEbWVudQIEALjWrIMFRijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwC41qyDBQAGc3lzdGVtAgQAuNasgwVtFGFiLmludGVyZmFjZS50b29sYm94JwC41qyDBQAKYWJJRFN0dWRpbwIEALjWrIMFggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwC41qyDBQAIcmVtZW1iZXICBAC41qyDBacBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnALjWrIMFAAt0b29sYm94X2FkZAIEALjWrIMFzgHzCkBjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3gudGFncy5hYkdyaWRNZW51T25CZWZvcmVDcmVhdGUpIHsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgidG9vbGJveCIsIGdldExpbmsoYWN0aXZlVG9vbGJveCkpOwogICAgaWYgKG1lbnVCb3QpIHsKICAgICAgICBtZW51Qm90Lm9uQ2xpY2soKTsKICAgIH0KfQplbHNlIGlmIChhY3RpdmVUb29sYm94LnRhZ3MuYWJHcmlkTWVudUFjdGlvbikgewogICAgYWN0aXZlVG9vbGJveC5hYkdyaWRNZW51QWN0aW9uKHsgZ3JpZEluZm9ybWF0aW9uOiBncmlkRGF0YSB9KTsKfQplbHNlIGlmIChhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScAuNasgwUABWxlYXJuAgQAuNasgwXCDCjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwC41qyDBQAFc3RvcmUCBAC41qyDBekMKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnALjWrIMFAAZzZWFyY2gCBAC41qyDBZANKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnALjWrIMFAAhhYklnbm9yZQIEALjWrIMFtw0EdHJ1ZScAuNasgwUACWFiVmVyc2lvbgIEALjWrIMFvA0EMTAuNScAuNasgwUADW1hbmlmZXN0YXRpb24CBAC41qyDBcENKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnALjWrIMFABBhYkdyaWRNZW51QWN0aW9uAgQAuNasgwXoDfsHQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7Cgpjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKY29uc3QgbWVudUJvdCA9IHt9OwoKbWVudUJvdC5hYk1lbnUgPSB0cnVlOwptZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwptZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwptZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOwptZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247Cm1lbnVCb3Qub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIudG9vbGJveF9hZGQoe3Rvb2xib3hEYXRhOiB0YWdzLnRvb2xib3hfZGF0YSwgZ3JpZERhdGE6IHRhZ3MuZ3JpZERhdGF9KTsgc2hvdXQoImFiTWVudVJlZnJlc2giKTtgOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykKewogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOwogICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsKCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7CiAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7CgogICAgaWYgKCFleHRhbnRCb3QpCiAgICB7CiAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJvdCk7CiAgICB9Cn0nALjWrIMFABRhYkdyaWRNZW51T25HZW5lcmF0ZQIEALjWrIMF5BXiAkBjb25zdCB0b29sYm94QXJyYXkgPSBhYlJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKCmxldCBhbGxUb29sc0xvYWRlZCA9IHRydWU7Cgpmb3IgKGxldCBpID0gMDsgaSA8IHRvb2xib3hBcnJheS5sZW5ndGg7IGkrKykgewogICAgY29uc3QgY3VycmVudFRvb2wgPSB0b29sYm94QXJyYXlbaV0ubmFtZTsKCiAgICBpZiAoIWdldEJvdCgiYWJJRE9yaWdpbiIsIGN1cnJlbnRUb29sKSAmJiAhZ2V0Qm90KGN1cnJlbnRUb29sLCB0cnVlKSkgewogICAgICAgIGFsbFRvb2xzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChhbGxUb29sc0xvYWRlZCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfScAuNasgwUADmFiR3JpZE1lbnVJY29uAgQAuNasgwXHGApsb2NhbF9tYWxsJwC41qyDBQAPYWJHcmlkTWVudUxhYmVsAgQAuNasgwXSGA5jYXN1YWwgY2F0YWxvZycAuNasgwUAE2FiR3JpZE1lbnVTb3J0T3JkZXICBAC41qyDBeEYATMnALjWrIMFAA9vbkFCSW5pdGlhbGl6ZWQCBAC41qyDBeMYKkAvLyBsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOycAuNasgwUADW9uU2tpbGxVcGRhdGUCBAC41qyDBY4ZV0BsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOw0KDQpjb25zb2xlLmxvZygiW1Rvb2xib3hdIExvYWRpbmcgY2FzdWFsIGtpdCIpOycAuNasgwUACnNoZWxsVXRpbHMCBAC41qyDBeYZKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAQRib3RzJDE3NDEwZDgzLTdlZWUtNGExZS1iNjM4LTY1NDYzNzRkMTdjMwEnALjWrIMFjRoGc3lzdGVtAgQAuNasgwWOGhFhYi5pbnRlcmZhY2Uuc2NhbicAuNasgwWNGgRmb3JtAgQAuNasgwWgGgdub3RoaW5nJwC41qyDBY0aC2FiSW50ZXJmYWNlAgQAuNasgwWoGgR0cnVlJwC41qyDBY0aCGFiSWdub3JlAgQAuNasgwWtGgR0cnVlJwC41qyDBY0aD29uUVJDb2RlU2Nhbm5lZAIEALjWrIMFshr9DUBpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBzY2FubmVkICIgKyB0aGF0KTsKCmlmIChjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbikKewogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGlua3Muc3RvcmUuYWJRUlB1Ymxpc2godGhhdCk7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuKQp7CiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICBjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4gPSBudWxsOwoKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIHRyeQogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CgogICAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IHBoQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoInBoIik7CiAgICBsZXQgaW5zdENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJpbnN0Iik7CiAgICBsZXQgYWJDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiYWIiKTsKICAgIGxldCBjd0NoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJjdyIpOwoKICAgIGlmIChwaENoZWNrICYmIGluc3RDaGVjayAmJiBhYkNoZWNrICYmIGN3Q2hlY2spCiAgICB7CiAgICAgICAgb3MuZ29Ub1VSTCh0aGF0KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBvcy50b2FzdCgibm90IGEgcmVjb2duaXplZCBwcmFjdGljZSBwZXJtaXQiKTsKICAgIH0KCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLmFiU2NhbikKewogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBjb25maWdCb3QudGFncy5hYlNjYW4gPSBudWxsOwogICAgCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICB0cnkgCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7CiAgICB9CiAgICBjYXRjaCAoZSkgCiAgICB7CiAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiB0aGF0fSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZihzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFiIikgPT0gImVnZ0NhcnRvbiIpCiAgICB7CiAgICAgICAgb3MuZ29Ub1VSTCh0aGF0KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7CiAgICAgICAgICAgIGxldCBuZXdUYWcgPSBrZXk7CiAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3NbbmV3VGFnXSA9IG5ld1ZhbHVlOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuYWIpIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hYn0pOwogICAgICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucGF0dGVybikgewogICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm59KTsKICAgICAgICB9CiAgICAgICAgCiAgICB9Cn0nALjWrIMFjRoFc3RvcmUCBAC41qyDBbAoKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnALjWrIMFjRoGc2VhcmNoAgQAuNasgwXXKCjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwC41qyDBY0aEGFiQ29yZU1lbnVBY3Rpb24CBAC41qyDBf4oN0Bvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwoKY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gdHJ1ZTsnALjWrIMFjRoPYWJDb3JlTWVudUxhYmVsAgQAuNasgwW2KQRzY2FuJwC41qyDBY0aDmFiQ29yZU1lbnVJY29uAgQAuNasgwW7KQ9xcl9jb2RlX3NjYW5uZXInALjWrIMFjRoTYWJDb3JlTWVudVNvcnRPcmRlcgIEALjWrIMFyykBMycAuNasgwWNGglhYlZlcnNpb24CBAC41qyDBc0pBDEwLjUnAQRib3RzJDQ5M2ZmYTRkLTQ2ZDQtNGE5OC1hZTljLTEyMTJkNjUxMTMzZgEnALjWrIMF0ikGc3lzdGVtAgQAuNasgwXTKRRhYi5pbnRlcmZhY2UudmVyc2lvbicAuNasgwXSKQ1vblNraWxsVXBkYXRlAgQAuNasgwXoKacBQGNvbnN0IHZlcnNpb25TdHJpbmcgPSB0YWdzLmFiSW50ZXJmYWNlTWFqb3JWZXJzaW9uICsgIi4iICsgdGFncy5hYkludGVyZmFjZU1pbm9yVmVyc2lvbjsNCg0KY29uc29sZS5sb2coIltBQkludGVyZmFjZV0gTG9hZGVkIEFCIEludGVyZmFjZSB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnALjWrIMF0ikXYWJJbnRlcmZhY2VNYWpvclZlcnNpb24CBAC41qyDBZArATEnALjWrIMF0ikXYWJJbnRlcmZhY2VNaW5vclZlcnNpb24CBAC41qyDBZIrAjE0JwC41qyDBdIpCGFiSWdub3JlAgQAuNasgwWVKwR0cnVlJwC41qyDBdIpBGZvcm0CBAC41qyDBZorB25vdGhpbmcnALjWrIMF0ikLYWJJbnRlcmZhY2UCBAC41qyDBaIrBHRydWUnALjWrIMF0ikJYWJWZXJzaW9uAgQAuNasgwWnKwQxMC41JwEEYm90cyQ0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYBJwC41qyDBawrBnN5c3RlbQIEALjWrIMFrSsTYWIuaW50ZXJmYWNlLm51Z2dldCcAuNasgwWsKwRmb3JtAgQAuNasgwXBKwdub3RoaW5nJwC41qyDBawrC2FiSW50ZXJmYWNlAgQAuNasgwXJKwR0cnVlJwC41qyDBawrCGFiSWdub3JlAgQAuNasgwXOKwR0cnVlJwC41qyDBawrDGFiTG9hZE51Z2dldAIEALjWrIMF0yuYAkBsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0TmFtZTsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK251Z2dldE5hbWU7CmxldCBsb2FkZWROdWdnZXQgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGZvcm1hdHRlZE51Z2dldEFCLCBhYlZlcnNpb246IHRoYXQudmVyc2lvbiwgcmV0dXJuVHlwZTogImRhdGEifSk7Cgpsb2FkZWROdWdnZXQgPSBsb2FkZWROdWdnZXQuc3RhdGVbbnVnZ2V0TmFtZV0ubnVnZ2V0OwoKcmV0dXJuIGxvYWRlZE51Z2dldDsnALjWrIMFrCsPYWJQdWJsaXNoTnVnZ2V0AgQAuNasgwXsLYwDQC8vc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6ICJudWdOYW1lIiwgZGF0YTogZGF0YX0pOyAgQUREIEVHRyBJRCBFVkVOVFVBTExZCmxldCB0ZXN0TnVnZ2V0ID0gdGhhdC5kYXRhOwpsZXQgZm9ybWF0dGVkTnVnZ2V0ID0ge2lkOiB0aGF0Lm51ZywgbnVnZ2V0OiB0ZXN0TnVnZ2V0fTsKbGV0IHRlc3ROdWdnZXROYW1lID0gdGhhdC5udWc7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIit0ZXN0TnVnZ2V0TmFtZTsKCm1hc2tzLm51Z2dldFRvUHVibGlzaCA9IGZvcm1hdHRlZE51Z2dldEFCOwoKbGlua3Muc3RvcmUuYWJQdWJsaXNoQUIoe2FiOiBmb3JtYXR0ZWROdWdnZXRBQiwgdGFyZ2V0OiBmb3JtYXR0ZWROdWdnZXQsIHNvdXJjZUV2ZW50OiAncHVibGlzaF9udWdnZXQnfSk7JwC41qyDBawrD2ltcGxlbWVudE51Z2dldAIEALjWrIMF+TCxB0BsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0OwpsZXQgbnVnZ2V0VmVyc2lvbkNoZWNrID0gbnVnZ2V0TmFtZS5pbmRleE9mKCIudiIpOwpsZXQgdmVyc2lvbjsKCmlmIChudWdnZXRWZXJzaW9uQ2hlY2sgIT0gLTEpCnsKICAgIG51Z2dldE5hbWUgPSBudWdnZXROYW1lLnN1YnN0cmluZygwLCBudWdnZXRWZXJzaW9uQ2hlY2spOwoKICAgIGxldCB2ZXJzaW9uQ2hlY2sgPSB0aGF0Lm51Z2dldC5zdWJzdHJpbmcobnVnZ2V0VmVyc2lvbkNoZWNrICsgMik7CgogICAgaWYgKGlzTmFOKHZlcnNpb25DaGVjaykpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2codmVyc2lvbkNoZWNrLCAidmVyc2lvbiBpcyBub3QgYSBudW1iZXIiKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB2ZXJzaW9uID0gTnVtYmVyKHZlcnNpb25DaGVjayk7CiAgICB9Cn0KY29uc29sZS5sb2cobnVnZ2V0TmFtZSwgdmVyc2lvbik7CmxldCBudWdEYXRhID0gYXdhaXQgdGhpc0JvdC5hYkxvYWROdWdnZXQoe251Z2dldE5hbWU6IG51Z2dldE5hbWUsIHZlcnNpb246IHZlcnNpb259KTsKCmlmIChudWdEYXRhID09ICJhYklEIG5vdCBmb3VuZCIpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgbm90IGZvdW5kIik7Cn0KZWxzZQp7CiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKICAgIGxldCB0YXJnZXRUYWcgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS50b1N0cmluZygpOwogICAgbGV0IHRhcmdldE51ZyA9ICJ7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRUYWcuaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKICAgIGluc2VydFRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCBudWdEYXRhKTsKfScAuNasgwWsKwxudWdnZXRCdXR0b24CBAC41qyDBas49QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnALjWrIMFrCsLbnVnZ2V0UGFyc2UCBAC41qyDBZ9Fpw9AY29uc3Qgb3JpZ2luYWxUYWdWYWx1ZSA9IHRoYXQuZWRpdGVkQm90LnJhd1t0aGF0LmVkaXRlZFRhZ107CmxldCB0YWdWYWx1ZSA9IG9yaWdpbmFsVGFnVmFsdWU7CgppZiAoIXRhZ1ZhbHVlKSAKewogICAgcmV0dXJuOwp9CmVsc2UgaWYgKHR5cGVvZiB0YWdWYWx1ZSAhPT0gInN0cmluZyIpIAp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnRvU3RyaW5nKCk7Cn0KCmxldCBpbml0aWFsUG9zc2libGVOdWdQb3MgPSAwOwoKaWYgKGluaXRpYWxQb3NzaWJsZU51Z1BvcyA9PSAtMSkgCnsKICAgIHJldHVybjsKfQplbHNlCnsKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxQb3NzaWJsZU51Z1Bvcyk7Cn0KCmxldCBwb3NzaWJsZU51Z3MgPSBvcmlnaW5hbFRhZ1ZhbHVlLnJlcGxhY2UoL1tee10vZywgIiIpLmxlbmd0aDsKbGV0IHRvdGFsTnVnQnJlYWtzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwpsZXQgYnJlYWtMZXZlbCA9IDA7CmxldCBudWdzVG9DaGVjayA9IFtdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZU51Z3M7IGkrKykKewogICAgbGV0IGluaXRpYWxOdWdQb3MgPSB0YWdWYWx1ZS5pbmRleE9mKCJ7IikgKyAxOwogICAgbGV0IHBvc3NpYmxlTnVnRW5kID0gdGFnVmFsdWUuaW5kZXhPZigifSIpOwogICAgbGV0IHBvc3NpYmxlTnVnID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MsIHBvc3NpYmxlTnVnRW5kKTsKCiAgICBpZiAocG9zc2libGVOdWcuaW5kZXhPZigiICIpID09IC0xICYmIC9cbi9nLnRlc3QocG9zc2libGVOdWcpICE9IHRydWUgJiYgcG9zc2libGVOdWcubGVuZ3RoID4gMCAmJiBwb3NzaWJsZU51Zy5pbmRleE9mKCI6IikgPT0gLTEpCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ7Iitwb3NzaWJsZU51ZysifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwogICAgICAgIGxldCBwdWJsaXNoQ2hlY2sgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDYsIGluaXRpYWxOdWdQb3MgLSAyKTsKICAgICAgICBsZXQgbnVnUHVibGlzaCA9IG51bGw7CgogICAgICAgIGlmIChwdWJsaXNoQ2hlY2sgPT0gIi5udWciKQogICAgICAgIHsKICAgICAgICAgICAgbnVnUHVibGlzaCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgICAgICAKICAgICAgICAvL0NIRUNLIElGICQgYmVmb3JlIG51Z2dldAogICAgICAgIGlmICh0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDIsIGluaXRpYWxOdWdQb3MgLSAxKSAhPSAiJCIpCiAgICAgICAgewogICAgICAgICAgICBudWdzVG9DaGVjay5wdXNoKHtudWdOYW1lOiBwb3NzaWJsZU51ZywgbnVnU3RhcnQ6IG51Z0JyZWFrcyArIDEsIG51Z1B1Ymxpc2g6IG51Z1B1Ymxpc2h9KTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ9IikpLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CgogICAgICAgIGJyZWFrTGV2ZWwgKz0gbnVnQnJlYWtzOwoKICAgICAgICBudWdCcmVha3MgPSB0b3RhbE51Z0JyZWFrcyAtICh0b3RhbE51Z0JyZWFrcyAtIGJyZWFrTGV2ZWwpOwogICAgfQoKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKHBvc3NpYmxlTnVnRW5kICsgMSk7Cn0KCnRoaXNCb3QubnVnZ2V0QnV0dG9uKHsgbnVnZ2V0OiBudWdzVG9DaGVjaywgYm90OiB0aGF0LmVkaXRlZEJvdCwgdGFnOiB0aGF0LmVkaXRlZFRhZywgdGFnVmFsdWU6IG9yaWdpbmFsVGFnVmFsdWV9KTsnALjWrIMFrCsNb25BQlB1Ymxpc2hlZAIEALjWrIMFx1TBAUBjb25zb2xlLmxvZyh0aGF0LmFiLCB0YWdzLm51Z2dldFRvUHVibGlzaCkKCmlmICh0aGF0LmFiID09IHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IHB1Ymxpc2hlZCIpOwoKICAgIG1hc2tzLm51Z2dldFRvUHVibGlzaCA9IG51bGw7CgogICAgY29uZmlnQm90Lm1hc2tzLmFiVmVyc2lvbiA9IG51bGw7Cn0nALjWrIMFrCsQb25BbnlCb3RzQ2hhbmdlZAIEALjWrIMFiVa3BEBpZiAoY29uZmlnQm90ICYmIHRoYXRbMF0uYm90LmlkICE9IHRoaXNCb3QuaWQpIAp7CiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QpIHJldHVybjsgLy8gSWdub3JlIGlmIHRoZSBjb25maWdCb3QgaXNuJ3QgcmVhZHkgeWV0LgoKICAgIGNvbnN0IGVkaXRlZEJvdElEID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdC5yZXBsYWNlKCLwn5SXIiwgIiIpOwoKICAgIGlmICghdGhhdC5maW5kKHggPT4geC5ib3QuaWQgPT0gZWRpdGVkQm90SUQpKSByZXR1cm47IC8vIElmIHRoZSBib3QgY2hhbmdlZCB3YXNuJ3QgYmVpbmcgZWRpdGVkIGJ5IHRoZSB1c2VyIGlnbm9yZSBpdC4KCiAgICBjb25zdCBlZGl0ZWRUYWcgPSBjb25maWdCb3QudGFncy5lZGl0aW5nVGFnOwogICAgY29uc3QgZWRpdGVkQm90ID0gZ2V0Qm90KCJpZCIsIGVkaXRlZEJvdElEKTsKCiAgICBpZiAoZWRpdGVkQm90ICYmIGVkaXRlZFRhZykgCiAgICB7CiAgICAgICAgc2hvdXQoIm51Z2dldFJlc2V0Iik7CgogICAgICAgIHRoaXNCb3QubnVnZ2V0UGFyc2UoeyBlZGl0ZWRCb3QsIGVkaXRlZFRhZyB9KTsKICAgIH0KfScAuNasgwWsKwhvbkNyZWF0ZQIEALjWrIMFv1pMQHRhZ3MubGlzdGVuaW5nID0gZmFsc2U7CgovL3NldFRhZ01hc2sodGhpc0JvdCwgImxpc3RlbmluZyIsIHRydWUsICJsb2NhbCIpOycAuNasgwWsKw1wYWNrYWdlTnVnZ2V0AgQAuNasgwWMW/gGQGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CmNvbnN0IHRhZ1RleHQgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXTsKCmlmIChjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4IHx8IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4KQp7CiAgICBsZXQgc3RhcnRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4OwogICAgbGV0IGVuZFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4OwoKICAgIGlmIChzdGFydFBvcyA9PSBlbmRQb3MpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoc3RhcnRQb3MgPiBlbmRQb3MpCiAgICB7CiAgICAgICAgbGV0IG5ld1N0YXJ0UG9zID0gZW5kUG9zOwogICAgICAgIGxldCBuZXdFbmRQb3MgPSBzdGFydFBvczsKCiAgICAgICAgc3RhcnRQb3MgPSBuZXdTdGFydFBvczsKICAgICAgICBlbmRQb3MgPSBuZXdFbmRQb3M7CiAgICB9CgogICAgbGV0IGRhdGEgPSB0YWdUZXh0LnN1YnN0cmluZyhzdGFydFBvcywgZW5kUG9zICsgMSk7CgogICAgc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6IHRoYXQubnVnZ2V0LCBkYXRhOiBkYXRhfSk7CgogICAgb3MudG9hc3QoIm51ZyBpcyBwdWJsaXNoaW5nIiwgMTApOwoKICAgIGxldCB0YXJnZXROdWcgPSAiLm51ZyB7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImNhbm5vdCByZWFkIG51Z2dldCB0byBiZSBwdWJsaXNoZWQiKQp9JwC41qyDBawrCHJlbWVtYmVyAgQAuNasgwWFYijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC41qyDBawrBnNlYXJjaAIEALjWrIMFrGIo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAuNasgwWsKwVzdG9yZQIEALjWrIMF02Io8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAuNasgwWsKwlsaXN0ZW5pbmcCBAC41qyDBfpiBWZhbHNlJwC41qyDBawrCWFiVmVyc2lvbgIEALjWrIMFgGMEMTAuNScBBGJvdHMkYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiAScAuNasgwWFYxlhYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yAgQAuNasgwWGY84MQGNvbnN0IHsKICAgIGxhYmVsID0gYCR7YWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fSBpcyB3b3JraW5nYCwKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge30KCmxldCBidXN5SW5kaWNhdG9yID0gewogICAgb25Qb2ludGVyVXA6IG51bGwsCiAgICBvblBvaW50ZXJEb3duOiBudWxsLAogICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgIGJ1c3lMYWJlbDogbGFiZWwsCiAgICBsYWJlbEFsaWdubWVudDogJ2xlZnQnLAogICAgc3RhdGU6IDAsCiAgICBhbmltU3RhdGVzOiBbCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJycsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgIF0sCiAgICBhbmltUmF0ZTogNTAwLAogICAgb25Cb3RBZGRlZDogYEAKICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgb25Cb3RDaGFuZ2VkOiBgQAogICAgICAgIGNvbnN0IG5lZWRSZWZyZXNoID0gdGhhdC50YWdzLnNvbWUodCA9PiB0ID09PSAnYnVzeUxhYmVsJyB8fCB0ID09PSAnc3RhdGUnIHx8IHQgPT09ICdhbmltU3RhdGVzJyk7CiAgICAgICAgaWYgKG5lZWRSZWZyZXNoKSB7CiAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB9CiAgICBgLAogICAgcmVmcmVzaERpc3BsYXk6IGBACiAgICAgICAgaWYgKHRhZ3MuYW5pbVN0YXRlcyAmJiB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBhbmltU3RhdGUgPSB0YWdzLmFuaW1TdGF0ZXNbdGFncy5zdGF0ZV07CgogICAgICAgICAgICB0YWdzLmxhYmVsID0gdGFncy5idXN5TGFiZWwudHJpbSgpICsgYW5pbVN0YXRlLmVsbGlwc2lzOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYW5pbVN0YXRlLmZvcm1BZGRyZXNzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3MubGFiZWwgCiAgICAgICAgfQogICAgYCwKICAgIGFuaW1hdGU6IGBACiAgICAgICAgaWYgKHRhZ3Muc3RhdGUgPj0gdGFncy5hbmltU3RhdGVzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSArPSAxOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgb3Muc2xlZXAodGFncy5hbmltUmF0ZSk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgLi4ucmVzdAp9OwoKY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKGJ1c3lJbmRpY2F0b3IpOwoKcmV0dXJuIG1lbnVCb3Q7JwC41qyDBYVjBnN5c3RlbQIEALjWrIMF1W8RYWIuaW50ZXJmYWNlLm1lbnUnALjWrIMFhWMEZm9ybQIEALjWrIMF528Hbm90aGluZycAuNasgwWFYwtkZXNjcmlwdGlvbgIEALjWrIMF728mVGhpcyBza2lsbCBpcyBkZXNpZ25lZCBmb3IgbWVudSBzdHVmZi4oALjWrIMFhWMLYWJJbnRlcmZhY2UBeCcAuNasgwWFYwphYk9wZW5NZW51AgQAuNasgwWXcJ0YQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IG1lbnVUeXBlID0gdGhhdCA/ICJhYiIgKyB0aGF0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhhdC5zbGljZSgxKSArICJNZW51IjogImFiQ29yZU1lbnUiOyAvL3NldCB1cCBhIGNoZWNrIHRvIHNlZSB3aGF0IHR5cGUgb2YgbWVudSBzaG91bGQgYmUgb2NjdXJpbmcgW2NvcmUsIGJvdCwgZ3JpZCwgaW5zdF0KbGV0IG1lbnVTa2lsbHMgPSBnZXRCb3RzKG1lbnVUeXBlICsgIkFjdGlvbiIpOwpsZXQgbWF4T3B0aW9ucyA9IG1lbnVUeXBlID09ICJpbnN0IiA/IDcgOiA1OwpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmJhc2VTa2lsbC4ke21lbnVUeXBlICsgIkFjdGlvbiJ9KHtib3Q6IHRoaXNCb3R9KTtgOwoKbGV0IHNvcnRPcmRlckluZGV4ID0gbWVudVNraWxscy5sZW5ndGg7CmZvciAobGV0IGkgPSAwOyBpIDwgbWVudVNraWxscy5sZW5ndGg7IGkrKykvL0FERCBMT0dJQyBGT1IgTU9SRSBPUFRJT05TIFRIQU4gNSA6IG1heE9wdGlvbnMKewogICAgLy9BbGxvd3MgZm9yIGNvZGUgdG8gZ2V0IGNhbGxlZCBiZWZvcmUgdGhlIG1lbnUgZ2VuZXJhdGVzLCB1c2VmdWwgZm9yIGR5bmFtaWNhbGx5IHNldCBncm91cHMgb3IgZHJvcGRvd25zCiAgICBpZiAobWVudVNraWxsc1tpXS50YWdzW21lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIl0pIHsKICAgICAgICBhd2FpdCB3aGlzcGVyKG1lbnVTa2lsbHNbaV0sIG1lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIik7CiAgICB9IAogICAgCiAgICBsZXQgY3VycmVudFNraWxsID0gbWVudVNraWxsc1tpXTsKCiAgICBhYk1lbnVCdXR0b24uYmFzZVNraWxsID0gIvCflJciICsgY3VycmVudFNraWxsLmlkOwogICAgYWJNZW51QnV0dG9uLmxhYmVsID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiTGFiZWwiXTsKICAgIGFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkljb24iXTsKICAgIGFiTWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIk9uR2VuZXJhdGUiXTsKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJTb3J0T3JkZXIiXTsKICAgIGFiTWVudUJ1dHRvbi5jb2xvciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkNvbG9yIl0gPyBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdIDogbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7CgogICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImRyb3Bkb3duIikgewogICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93bk9wdGlvbnMgPSBjdXJyZW50U2tpbGwudGFncy5kcm9wZG93bk9wdGlvbnM7CgogICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5kcm9wZG93blNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiZ3JvdXAiKSB7CiAgICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5ncm91cFNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmdyb3VwU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmdyb3VwU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIGFiTWVudUJ1dHRvbi5tZW51SXRlbXMgPSBjdXJyZW50U2tpbGwudGFncy5tZW51SXRlbXM7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVHcm91cChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJpbnB1dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gInRleHQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gInRvb2wiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUb29sKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gIndpemFyZCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOwogICAgfQp9Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gIkAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IjsnALjWrIMFhWMSYWJDcmVhdGVNZW51QnV0dG9uAgQAuNasgwWziAH4DUBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9OwoKbGV0IHsKICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwKICAgIC4uLmFkZGl0aW9uYWxUYWdzCn0gPSB0aGF0ID8/IHt9CgppZiAodHlwZW9mIG1lbnVJdGVtU3R5bGUgPT0gJ3N0cmluZycpIHsKICAgIG1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbVN0eWxlLnJlcGxhY2UoL1x1ezFGOUVDfS91LCAnJyk7IAogICAgbWVudUl0ZW1TdHlsZSA9IEpTT04ucGFyc2UobWVudUl0ZW1TdHlsZSk7Cn0KCmZ1bmN0aW9uIGhhc0JvcmRlclN0eWxlKCkgewogICAgaWYgKG1lbnVJdGVtU3R5bGVbImJvcmRlci10b3Atc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItbGVmdC1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1ib3R0b20tc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItcmlnaHQtc3R5bGUiXSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdKSB7CiAgICBpZiAoYWRkaXRpb25hbFRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJNZW51R3JvdXAiXSkgewoKICAgIH0KfQoKbmV3TWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdNZW51QnV0dG9uLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7Cm5ld01lbnVCdXR0b24ubGFiZWxDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7Cm5ld01lbnVCdXR0b24uc2hhZG93Q29sb3IgPSB0aGF0LnNoYWRvd0NvbG9yID8/IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU2hhZG93Q29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLnNjYWxlWSA9IDE7Cgpjb25zdCBtZW51U3R5bGluZyA9IHsKICAgICJib3JkZXItcmFkaXVzIjoiOHB4IiwKICAgICJtYXJnaW4tdG9wIjogIjhweCIsCiAgICAiYm94LXNoYWRvdyI6IGAzcHggNHB4ICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIm1pbi1oZWlnaHQiOiAiNDRweCIsCiAgICAiYm9yZGVyIjogaGFzQm9yZGVyU3R5bGUoKSA/ICIiIDogYDJweCBzb2xpZCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJ3aWR0aCI6ICJjYWxjKDEwMCUgLSA1cHgpIiwKICAgIC4uLm1lbnVJdGVtU3R5bGUKfQoKbmV3TWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gbWVudVN0eWxpbmc7Cgpjb25zdCBjbGlja2VkU3R5bGluZyA9IHsKICAgIC4uLm1lbnVTdHlsaW5nLAogICAgImZpbHRlciI6ICJicmlnaHRuZXNzKDYwJSkiCn0KY29uc3QgYmFzZVN0eWxlID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9ICfwn6esICR7SlNPTi5zdHJpbmdpZnkoY2xpY2tlZFN0eWxpbmcpfSdgCgpuZXdNZW51QnV0dG9uLm9uUG9pbnRlckRvd24gPSBtZW51SXRlbVN0eWxlPy5bIm1hcmdpbi10b3AiXSAhPSAiMHB4IiA/IGJhc2VTdHlsZSA6ICJAIC8vIjsKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJVcCA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsYDsKCmZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQp7CiAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOwp9CgpuZXdNZW51QnV0dG9uID0gY3JlYXRlKG5ld01lbnVCdXR0b24pOwoKcmV0dXJuIG5ld01lbnVCdXR0b247JwC41qyDBYVjDWFiTWVudVJlZnJlc2gCBAC41qyDBaqWAYEBQGlmIChjb25maWdCb3QudGFncy5tZW51UG9ydGFsPy5zdWJzdHJpbmcoMCwyKSA9PSAiYWIiKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgogICAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwp9JwC41qyDBYVjCHJlbWVtYmVyAgQAuNasgwWslwEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAuNasgwWFYw1tYW5pZmVzdGF0aW9uAgQAuNasgwXTlwEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAuNasgwWFYxFhYkVudmlyb25tZW50TWVudQIEALjWrIMF+pcBuilAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5OwphYk1lbnVCdXR0b24ubGVhcm4gPSB0YWdzLmxlYXJuOwoKY29uc3QgYWJFbnZpcm9ubWVudE9wdGlvbnMgPSB0aGlzQm90LmFiR2V0RW52aXJvbm1lbnRPcHRpb25zKCk7CgpidXR0b25Mb29wOgpmb3IgKGxldCBpID0gMDsgaSA8IGFiRW52aXJvbm1lbnRPcHRpb25zLmxlbmd0aDsgaSsrKQp7CiAgICBsZXQgYWN0aXZlQnV0dG9uID0gYWJFbnZpcm9ubWVudE9wdGlvbnNbaV07CgogICAgYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGFjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjsKCiAgICBpZiAoYWN0aXZlQnV0dG9uLmFiRW52aXJvbm1lbnRHYXRlKQogICAgewogICAgICAgIGlmICghbGlua3NbYWN0aXZlQnV0dG9uLmFiRW52aXJvbm1lbnRHYXRlXSkKICAgICAgICB7CiAgICAgICAgICAgIGNvbnRpbnVlIGJ1dHRvbkxvb3A7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBuZXdCdXR0b25EYXRhID0gey4uLmFiTWVudUJ1dHRvbiwgLi4uYWN0aXZlQnV0dG9ufTsKCiAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdCdXR0b25EYXRhKTsKfQoKY29uc3QgYWJQZXJzb25hbGl0eUNvbmZpZ0J1dHRvbiA9IHsKICAgIGxhYmVsOiAiY3VzdG9taXplOiBhYiBwZXJzb25hbGl0eSIsCiAgICAuLi5hYk1lbnVCdXR0b24sCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEsCiAgICBkcm9wZG93blNvcnRPcmRlcjogMSwKICAgIGRyb3Bkb3duT3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJuYW1lIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwge3RpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB0byBjYWxsIG1lPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHtuYW1lOiBuYW1lfSk7IAogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogImNvbG9yIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBtZSB0byBiZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7Y29sb3I6IGNvbG9yfSk7IAogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgICAgICAgICAgLy9saW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yID0gY29sb3I7IGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yICE9ICdjbGVhcicpe2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgPSBjb2xvcn07IGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJtZW51IGNvbG9yIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudXMgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVDb2xvcjogY29sb3J9KTsgCiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICAgICAgICAgICAgICAvL2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IgPSBjb2xvcjsgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgIT0gJ2NsZWFyJyl7bGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciA9IGNvbG9yfTsgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogIm1lbnUgdGV4dCBjb2xvciIsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51IHRleHQgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVMYWJlbENvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICAgICAgICAgIC8vbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvciA9IGNvbG9yOyBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciAhPSAnY2xlYXInKXtsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yID0gY29sb3J9OyBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiAiZGVmYXVsdCBwb3J0YWwgY29sb3IiLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBsZXQgcG9ydGFsQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IHdvdWxkIHlvdSBsaWtlIHlvdXIgcG9ydGFsIHRvIGxvb2sgbGlrZT8nfSk7CiAgICAgICAgICAgICAgICBpZiAoIXBvcnRhbENvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgcG9ydGFsQ29sb3IgPSAnIzI2MzIzOCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7J3BvcnRhbENvbG9yJzogcG9ydGFsQ29sb3J9KTsgCiAgICAgICAgICAgICAgICAvL2Rlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJkZWZhdWx0IHNldHRpbmdzIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICAgICAgICAgIGNvbG9yOiAncmVkJywKICAgICAgICAgICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsnZGVmYXVsdFBlcnNvbmFsaXR5JzogdHJ1ZX0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogIm1lbnUgY29sb3IiLAogICAgICAgIC8vICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgIC8vICAgICAgb25DbGljazogYEAgCiAgICAgICAgLy8gICAgICAgICBjb25zdCBtZW51Q29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQoYWJQZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvciwge3RpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51J3MgdG8gYmU/J30pOwogICAgICAgIC8vICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVDb2xvcjogbWVudUNvbG9yfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIC8vIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogInByb21wdCIsCiAgICAgICAgLy8gICAgIG9uQ2xpY2s6IGBAYCwKICAgICAgICAvLyB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJmb3JtIiwKICAgICAgICAvLyAgICAgb25DbGljazogYEAgCiAgICAgICAgLy8gICAgICAgICBjb25zdCBmb3JtID0gYXdhaXQgb3Muc2hvd0lucHV0KGFiUGVyc29uYWxpdHkudGFncy5hYkZvcm0sIHt0aXRsZTogJ3doYXQgZm9ybSB3b3VsZCB5b3UgbGlrZSBtZSB0byB0YWtlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHtmb3JtOiBmb3JtfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIC8vIH0KICAgIF0KfQoKdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bihhYlBlcnNvbmFsaXR5Q29uZmlnQnV0dG9uKTsKCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsiOycAuNasgwWFYwVsZWFybgIEALjWrIMFtcEBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnALjWrIMFhWMDZ3B0AgQAuNasgwXcwQEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAuNasgwWFYwhhYklnbm9yZQIEALjWrIMFg8IBBHRydWUnALjWrIMFhWMGc2VhcmNoAgQAuNasgwWIwgEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAuNasgwWFYwZudWdnZXQCBAC41qyDBa/CASjwn5SXNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmJwC41qyDBYVjBXRlc3RzAgQAuNasgwXWwgEo8J+Ul2I4M2Q5NzJiLTA1MzUtNDA1MS1iNTg5LTQxY2VkYTg1MzVmMScAuNasgwWFYw9vblBvcnRhbENoYW5nZWQCBAC41qyDBf3CAW5AaWYgKHRoYXQucG9ydGFsID09ICJzeXN0ZW1Qb3J0YWwiICYmICF0aGF0LmRpbWVuc2lvbiAmJiAhbGlua3MudGVzdHMpCnsKICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoImFiVGVzdHMiKTsKfScAuNasgwWFYwNhc2sCBAC41qyDBezDASjwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwC41qyDBYVjCWFiVmVyc2lvbgIEALjWrIMFk8QBBDEwLjUnALjWrIMFhWMRYWJDcmVhdGVNZW51SW5wdXQCBAC41qyDBZjEAZ4CQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVJbnB1dCA9IHsNCiAgICBmb3JtOiAiaW5wdXQiLA0KICAgIG1lbnVJdGVtU2hvd1N1Ym1pdFdoZW5FbXB0eTogZmFsc2UsDQogICAgZm9ybUlucHV0TXVsdGlsaW5lOiBudWxsLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVJbnB1dCk7DQoNCnJldHVybiBtZW51Qm90OycAuNasgwWFYxBhYkNyZWF0ZU1lbnVUZXh0AgQAuNasgwW3xgGBBEBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmNvbnN0IHsNCiAgICBtZW51SXRlbUxhYmVsU3R5bGUsDQogICAgLi4ucmVzdA0KfSA9IHRoYXQ7DQoNCmxldCBtZW51VGV4dCA9IHsNCiAgICBmb3JtOiAidGV4dCIsDQogICAgb25Qb2ludGVyVXA6IG51bGwsDQogICAgb25Qb2ludGVyRG93bjogbnVsbCwNCiAgICBwb2ludGFibGU6IGZhbHNlLA0KICAgIGNvbG9yOiAid2hpdGUiLA0KICAgIG1lbnVJdGVtU3R5bGU6IHsNCiAgICAgICAgInBhZGRpbmctdG9wIjogIjZweCIsDQogICAgICAgICJwYWRkaW5nLWJvdHRvbSI6ICI2cHgiLA0KICAgIH0sDQogICAgbWVudUl0ZW1MYWJlbFN0eWxlOiB7DQogICAgICAgICJ3aGl0ZS1zcGFjZSI6ICJwcmUtd3JhcCIsDQogICAgICAgIC4uLm1lbnVJdGVtTGFiZWxTdHlsZSwNCiAgICB9LA0KICAgIC4uLnJlc3QNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51VGV4dCk7DQoNCnJldHVybiBtZW51Qm90OycAuNasgwWFYxBhYkNyZWF0ZU1lbnVUb29sAgQAuNasgwW5ygGOAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51VG9vbCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRvb2wpOw0KDQpyZXR1cm4gbWVudUJvdDsnALjWrIMFhWMSYWJDcmVhdGVNZW51V2l6YXJkAgQAuNasgwXIywGSAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51V2l6YXJkID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51V2l6YXJkKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwC41qyDBYVjFGFiQ3JlYXRlTWVudURyb3Bkb3duAgQAuNasgwXbzAHVGEBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICghdGhhdC5kcm9wZG93blNvcnRPcmRlcikgew0KICAgIHRocm93IG5ldyBFcnJvcihgYWJDcmVhdGVNZW51RHJvcGRvd246IGRyb3Bkb3duU29ydE9yZGVyIGlzIG5vdCBwcm92aWRlZC5gKTsNCn0NCg0KbGV0IG91dGVyTWVudUJ1dHRvbiA9IHsNCiAgICAuLi50aGF0LA0KICAgIGZvcm1BZGRyZXNzOiB0aGF0LmZvcm1BZGRyZXNzID8/ICJhcnJvd19yaWdodCIsDQogICAgZHJvcGRvd25PcGVuOiBmYWxzZSwNCiAgICBvbkNsaWNrOiBgQA0KICAgICAgICB0YWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSAke3RoYXQuZHJvcGRvd25Tb3J0T3JkZXJ9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucykgew0KICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKHRhZ3MuZHJvcGRvd25PcHRpb25zLCB0YWdzLmRyb3Bkb3duU29ydE9yZGVyKTsNCiAgICAgICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICBgLA0KICAgIG9uRGVzdHJveTogYEANCiAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICBgLA0KICAgIG9uUG9pbnRlclVwOiBgQA0KICAgICAgICBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbDsNCiAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICBtYXNrcy5mb3JtQWRkcmVzcyA9ICJhcnJvd19yaWdodCI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IGZhbHNlKSB7DQogICAgICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJmb3JtQWRkcmVzcyIsICJhcnJvd19kcm9wX2Rvd24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgIm1lbnVJdGVtU3R5bGUiLCB7Li4udGFncy5tZW51SXRlbVN0eWxlLCAiYm9yZGVyQm90dG9tTGVmdFJhZGl1cyI6ICIwIiwgImJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzIjogIjAifSk7DQogICAgICAgIH0NCiAgICBgDQp9Ow0KDQppZiAodGhhdC5mb3JtQWRkcmVzcyAmJiB0aGF0LmZvcm1BZGRyZXNzICE9ICJhcnJvd19yaWdodCIpIHsNCiAgICBvdXRlck1lbnVCdXR0b24uY3VzdG9tRm9ybUFkZHJlc3MgPSB0cnVlOw0KfQ0Kb3V0ZXJNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSB0aGF0LmRyb3Bkb3duU29ydE9yZGVyOw0KDQpjb25zdCBtZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24ob3V0ZXJNZW51QnV0dG9uKTsNCm1lbnVCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zID0gZ2VuZXJhdGVNZW51T3B0aW9uczsNCg0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNZW51T3B0aW9ucyAob3B0aW9ucywgc29ydE9yZGVyKSB7DQogICAgY29uc3QgbWVudUJvdHMgPSBbXTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyArK2kpIHsNCg0KICAgICAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm9wdGlvbnNbaV0sDQogICAgICAgICAgICBjbGVhckRyb3Bkb3duTWVudTogYEANCiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOw0KICAgICAgICAgICAgYA0KICAgICAgICB9Ow0KDQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcihzb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDAwKTsNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9IHRydWU7DQoNCiAgICAgICAgaWYgKGkgPT0gb3B0aW9ucy5sZW5ndGggLSAxKSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIDAgOHB4IDhweCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCAwIDhweCA4cHgiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyVG9wIl0gPSAibm9uZSI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsibWFyZ2luVG9wIl0gPSAiMCI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsicGFkZGluZ0xlZnQiXSA9ICIzNXB4IjsNCg0KICAgICAgICBjb25zdCBuZXdNZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQogICAgfQ0KDQogICAgbWVudUJvdC50YWdzLm1lbnVCb3RzID0gZ2V0TGluayhtZW51Qm90cyk7DQp9DQoNCnJldHVybiBtZW51Qm90Ow0KDQonALjWrIMFhWMRYWJDcmVhdGVNZW51R3JvdXACBAC41qyDBbHlAdwdQC8qDQogICBFWEFNUExFDQogICBjb25zdCBtZW51R3JvdXAgPSB7DQogICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGdyb3VwU29ydE9yZGVyOiAxLA0KICAgICAgICBtZW51SXRlbXM6IFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDIiLA0KICAgICAgICAgICAgICAgIGNvbG9yOiAib3JhbmdlIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICBtZW51SXRlbVR5cGU6ICJkcm9wZG93biIsDQogICAgICAgICAgICAgICAgZHJvcGRvd25PcHRpb25zOiBbDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDEiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMyIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICB9DQogICAgICAgIF0NCiAgICB9DQoqLw0KDQppZiAgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAoIXRoYXQuZ3JvdXBTb3J0T3JkZXIpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudUdyb3VwOiBncm91cFNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCB7DQogICAgbWVudUl0ZW1TdHlsZSA9IHt9LA0KICAgIG1lbnVJdGVtcyA9IFtdLA0KICAgIC4uLmFkZGl0aW9uYWxUYWdzDQp9ID0gdGhhdCA/PyB7fQ0KDQpjb25zdCBtZW51Qm90cyA9IFtdOw0KZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51SXRlbXMubGVuZ3RoOyArK2kpIHsNCg0KICAgIGxldCBuZXdNZW51QnV0dG9uID0ge307DQoNCiAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSBOdW1iZXIodGhhdC5ncm91cFNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMCk7DQoNCiAgICBsZXQgaW5kaXZNZW51SXRlbVN0eWxlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtU3R5bGUgPz8ge307DQogICAgbGV0IGluZGl2TWVudVR5cGUgPSBtZW51SXRlbXNbaV0ubWVudUl0ZW1UeXBlID8/IHVuZGVmaW5lZDsNCiAgICBsZXQgaW5kaXZBZGRpdGlvbmFsVGFncyA9IG1lbnVJdGVtc1tpXTsNCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgIGRlbGV0ZSBpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVN0eWxlIl07DQogICAgfQ0KICAgIGlmIChpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVR5cGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl07DQogICAgfQ0KDQogICAgY29uc3QgYmFzZVN0eWxpbmcgPSB7DQogICAgICAgICJib3JkZXJUb3AiOiAibm9uZSIsDQogICAgICAgICJtYXJnaW5Ub3AiOiAiMCINCiAgICB9DQoNCiAgICBpZiAoaSA9PSBtZW51SXRlbXMubGVuZ3RoIC0gMSkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLmJhc2VTdHlsaW5nLA0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICIwIDAgOHB4IDhweCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9IGVsc2UgaWYgKGkgPT0gMCkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiOHB4IDhweCAwIDAiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7fQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLmJhc2VTdHlsaW5nLA0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICIwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQ0KICAgIHsNCiAgICAgICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBpbmRpdkFkZGl0aW9uYWxUYWdzKQ0KICAgIHsNCiAgICAgICAgbmV3TWVudUJ1dHRvblt0YWddID0gaW5kaXZBZGRpdGlvbmFsVGFnc1t0YWddOw0KICAgIH0NCg0KICAgIGxldCBuZXdNZW51Qm90Ow0KICAgIHN3aXRjaChpbmRpdk1lbnVUeXBlKSB7DQogICAgICAgIGNhc2UgImRyb3Bkb3duIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLi4ubmV3TWVudUJ1dHRvbiwNCiAgICAgICAgICAgICAgICAgICAgImRyb3Bkb3duU29ydE9yZGVyIjogTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMCkNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJpbnB1dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ0ZXh0IjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidG9vbCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUb29sKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgIndpemFyZCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgIH0NCiAgICBtZW51Qm90cy5wdXNoKG5ld01lbnVCb3QpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdHM7JwC41qyDBYVjC3BlcnNvbmFsaXR5AgQAuNasgwWOgwIo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAuNasgwWFYxdhYkdldEVudmlyb25tZW50T3B0aW9ucwIEALjWrIMFtYMC5SRAY29uc3Qgb3B0aW9ucyA9IFsKICAgIHsKICAgICAgICBsYWJlbDogImhpZGUiLAogICAgICAgIGZvcm1BZGRyZXNzOiAidmlzaWJpbGl0eV9vZmYiLAogICAgICAgIG9uQ2xpY2s6ICJAIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMAogICAgfSwKICAgIHsKICAgICAgICBsYWJlbDogIm9wdGltaXplIG1vZGUiLAogICAgICAgIG9uQ3JlYXRlOiAiQCBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA/IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JyA6IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICAgICAgb25DbGljazogIkAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA9IGZhbHNlIDogY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSB0cnVlOyB0aGlzQm90Lm9uQ3JlYXRlKCk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMQogICAgfSwKICAgIHsKICAgICAgICBsYWJlbDogInNsZWVwIiwKICAgICAgICBmb3JtQWRkcmVzczogIm5pZ2h0c19zdGF5IiwKICAgICAgICBvbkNsaWNrOiAiQGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7IHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICdhYkF3YWtlU3RhdGUnLCBmYWxzZSwgJ3NoYXJlZCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDMKICAgIH0sCiAgICB7CiAgICAgICAgbGFiZWw6ICJjaGF0IiwKICAgICAgICBmb3JtQWRkcmVzczogImNoYXQiLAogICAgICAgIG9uQ2xpY2s6ICJAIHNob3V0KCdhYkNoYXRCYXJPcGVuJyk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNAogICAgfSwKICAgIHsKICAgICAgICBsYWJlbDogIm51Z2dldHMiLAogICAgICAgIG9uQ3JlYXRlOiAiQCB0YWdzLm51Z01hbmFnZXIgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmludGVyZmFjZS5udWdnZXQnKSk7IGlmIChsaW5rcy5udWdNYW5hZ2VyLnRhZ3MubGlzdGVuaW5nKXt0YWdzLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgbnVsbCk7YDt0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveGA7fWVsc2V7ICAgIHRhZ3Mub25DbGljayA9IGBAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCB0cnVlLCAnbG9jYWwnKTtgOyAgICB0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveF9vdXRsaW5lX2JsYW5rYDt9IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNQogICAgfSwKICAgIHsKICAgICAgICBhYkVudmlyb25tZW50R2F0ZTogImdwdCIsCiAgICAgICAgb25DcmVhdGU6ICJAICBpZiAoIWF1dGhCb3Qpe2Rlc3Ryb3kodGhpc0JvdCk7fWVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICdGcmVlUGxheScgfHwgYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gdW5kZWZpbmVkKXtkZXN0cm95KHRoaXNCb3QpO307IHRhZ3MubGFiZWwgPSAnZWRpdCAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgcHJvbXB0JzsgdGFncy5ncHRCb3QgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmFjdGlvbi5hc2snKSk7IiwKICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgb25DbGljazogIkAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA3CiAgICB9LAogICAgewogICAgICAgIGxhYmVsOiAiZ3JpZCBzbmFwIiwKICAgICAgICBvbkNyZWF0ZTogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnIiwKICAgICAgICBvbkNsaWNrOiAiQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZTt0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogOAogICAgfSwKICAgIHsKICAgICAgICBsYWJlbDogImJvdCBzbmFwIiwKICAgICAgICBvbkNyZWF0ZTogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgICAgICBvbkNsaWNrOiAiQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDkKICAgIH0sCiAgICB7CiAgICAgICAgbGFiZWw6ICJhY2NvdW50IiwKICAgICAgICBmb3JtQWRkcmVzczogImJhZGdlIiwKICAgICAgICBvbkNsaWNrOiAiQCBvcy5zaG93QWNjb3VudEluZm8oKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMAogICAgfSwKICAgIHsKICAgICAgICBhYkVudmlyb25tZW50R2F0ZTogInRlc3RzIiwKICAgICAgICBsYWJlbDogInJlY29yZCB0ZXN0IiwKICAgICAgICBmb3JtQWRkcmVzczogInNjaWVuY2UiLAogICAgICAgIG9uS2V5RG93bjogIkAgIiwKICAgICAgICBvbktleVVwOiAiQCAiLAogICAgICAgIG9uQ2xpY2s6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRlc3QnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDExCiAgICB9LAogICAgewogICAgICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgICAgIGxhYmVsOiAicmVjb3JkIHRyYWNlIiwKICAgICAgICBmb3JtQWRkcmVzczogInRpbWVsaW5lIiwKICAgICAgICBvbktleURvd246ICJAICIsCiAgICAgICAgb25LZXlVcDogIkAgIiwKICAgICAgICBvbkNsaWNrOiAiQCBsZXQgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoJ2tleWJvYXJkJywgJ1NoaWZ0Jyk7bGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTtzaG91dCgnYWJSZWNvcmRUcmFjZScpO3Nob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTIKICAgIH0sCiAgICB7CiAgICAgICAgb25DcmVhdGU6IGBACiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSAicGVybWFuZW50bHkgZGVsZXRlICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwogICAgICAgICAgICB0YWdzLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb250cmFzdENvbG9yID8/ICIjRDkzMDMwIjsKICAgICAgICBgLAogICAgICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgICAgIG9uQ2xpY2s6IGBACiAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CgogICAgICAgICAgICBjb25zdCBhYkJvdHMgPSBnZXRCb3RzKChiKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gYi5zcGFjZSA9PT0gJ3NoYXJlZCcgJiYKICAgICAgICAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtICYmCiAgICAgICAgICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbS5zdGFydHNXaXRoKCdhYicpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IG9zLnNob3dDb25maXJtKHsKICAgICAgICAgICAgICAgIHRpdGxlOiAnUGVybWFuZW50bHkgZGVsZXRlICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICAgICAgY29udGVudDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArICBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBmcm9tICcgKyBsaW5rcy5sZWFybi50YWdzLmFiSW5zdCArICc/IFRoaXMgaXMgbm90IHJldmVyc2libGUhJywKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgICAgIGRlc3Ryb3koYWJCb3RzKTsKICAgICAgICAgICAgfQogICAgICAgIGAsCiAgICAgICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAwCiAgICB9Cl0KCnJldHVybiBvcHRpb25zOycAuNasgwWFYx5hYkNyZWF0ZVRvb2xib3hEcm9wZG93bk9wdGlvbnMCBAC41qyDBZuoAroLQGNvbnN0IHRvb2xib3hUb29scyA9IFsuLi50aGF0LnRvb2xBcnJheV0gPz8gW107DQpjb25zdCB0b29sYm94TmFtZSA9IHRoYXQudG9vbGJveE5hbWUgPz8gIktpdCAiOw0KY29uc3QgdG9vbGJveCA9IHRoYXQudG9vbGJveDsNCmNvbnN0IGdyaWRJbmZvcm1hdGlvbiA9IHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiA/PyBhYlJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQoNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMudG9vbGJveCA9IGdldExpbmsodG9vbGJveCk7DQptZW51T3B0aW9ucy5ncmlkSW5mb3JtYXRpb24gPSBncmlkSW5mb3JtYXRpb247DQptZW51T3B0aW9ucy5zZWFyY2ggPSB0YWdzLnNlYXJjaDsNCi8vbWVudU9wdGlvbnMuZm9ybUFkZHJlc3MgPSAiaGFyZHdhcmUiOw0KDQppZiAodG9vbGJveFRvb2xzLmxlbmd0aCA9PT0gMCkgew0KICAgIGNvbnN0IG1lc3NhZ2UgPSB0b29sYm94TmFtZSArICIgZG9lcyBub3QgaGF2ZSBhbnkgdG9vbHMgbGlzdGVkIGluIHRoZSB0b29sX2FycmF5IHRhZyI7DQoNCiAgICBhYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIG1lc3NhZ2UpOw0KICAgIG9zLnRvYXN0KG1lc3NhZ2UsIDUpOw0KICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7DQp9DQoNCmZvciAobGV0IHRvb2wgb2YgdG9vbGJveFRvb2xzKSB7DQogICAgY29uc3QgdG9vbEJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiB0b29sLm5hbWUsDQogICAgICAgIHRhcmdldEFCOiB0b29sLnRhcmdldEFCLA0KICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgbGlua3Muc2VhcmNoLmFiTG9hZFRvb2woew0KICAgICAgICAgICAgICAgIHRvb2xOYW1lOiB0YWdzLnRhcmdldEFCLA0KICAgICAgICAgICAgICAgIHRvb2xQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB0YWdzLmdyaWRJbmZvcm1hdGlvbg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9KQ0KICAgICAgICBgLA0KICAgIH07DQoNCiAgICBpZiAodG9vbC5mb3JtQWRkcmVzcykgew0KICAgICAgICB0b29sQnV0dG9uLmZvcm1BZGRyZXNzID0gdG9vbC5mb3JtQWRkcmVzczsNCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaCh0b29sQnV0dG9uKTsNCn0NCg0KcmV0dXJuIGRyb3Bkb3duT3B0aW9uczsA"}]}