{"version":2,"updates":[{"id":0,"timestamp":1768867972823,"update":"Ae4Bx/e3PgAnAQRib3RzJDEzZjMzYTUxLWMyZmEtNDZkYS1hODhlLWU1YzA2NzU1NmQwMgEnAMf3tz4ACmFiSURPcmlnaW4CBADH97c+AQ10b29sYm94X3NraWxsJwDH97c+AAthYkludGVyZmFjZQIEAMf3tz4PBHRydWUnAMf3tz4AC2Rlc2NyaXB0aW9uAgQAx/e3PhQpVGhpcyBza2lsbCBpcyBhbiBpbnRlcmZhY2UgZm9yIHRvb2xib3hlcy4nAMf3tz4ABGZvcm0CBADH97c+Pgdub3RoaW5nJwDH97c+AARtZW51AgQAx/e3PkYo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAx/e3PgAGc3lzdGVtAgQAx/e3Pm0UYWIuaW50ZXJmYWNlLnRvb2xib3gnAMf3tz4ACmFiSURTdHVkaW8CBADH97c+ggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwDH97c+AAhyZW1lbWJlcgIEAMf3tz6nASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDH97c+AAt0b29sYm94X2FkZAIEAMf3tz7OAcgLQGNvbnN0IHRvb2xib3hEYXRhID0gdGhhdC50b29sYm94RGF0YTsKY29uc3QgdG9vbGJveFRpdGxlID0gdG9vbGJveERhdGEudGl0bGU7CmNvbnN0IHRvb2xib3hOYW1lID0gdG9vbGJveERhdGEubmFtZTsKY29uc3QgdG9vbGJveFN0dWRpbyA9IHRvb2xib3hEYXRhLnN0dWRpbzsKY29uc3QgZ3JpZERhdGEgPSB0aGF0LmdyaWREYXRhOwoKLy9MT0FESU5HIEJBUj8KCmlmICghbGlua3Muc2hlbGxVdGlscykgewogICAgLy8gTmVlZCBhYlNoZWxsIHRvIHVzZSBpdCdzIGFiTG9nIGZ1bmN0aW9uLgogICAgbGlua3MubGVhcm4uYWJBZGFwdCgnYWJTaGVsbCcpOwp9CgppZiAodG9vbGJveFN0dWRpbyA9PSBmYWxzZSkgewogICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdCh0b29sYm94TmFtZSk7CiAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKGAke3Rvb2xib3hUaXRsZSA/PyB0b29sYm94TmFtZX0gbG9hZGVkYCk7Cn0KZWxzZSB7CiAgICBjb25zdCB0b29sYm94TG9va3VwID0gYXdhaXQgbGlua3Muc2VhcmNoLmhhdGNoKHsgYWJJRDogdG9vbGJveE5hbWUsIHJlY29yZEtleTogdG9vbGJveFN0dWRpbywgYXV0b0hhdGNoOiB0cnVlIH0pOwoKICAgIGlmICh0b29sYm94TG9va3VwLnN1Y2Nlc3MpIHsKICAgICAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKGAke3Rvb2xib3hUaXRsZSA/PyB0b29sYm94TmFtZX0gbG9hZGVkYCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYGlzc3VlIGxvYWRpbmcgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9LCBwbGVhc2UgdHJ5IGFnYWluYCwgbG9nVHlwZTogJ2Vycm9yJyB9KTsKICAgIH0KfQoKY29uc3QgYWN0aXZlVG9vbGJveCA9IGdldEJvdCgic3lzdGVtIiwgYGFiLnRvb2xib3guJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9YCk7CgppZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJHcmlkTWVudU9uQmVmb3JlQ3JlYXRlKSB7CiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkdyaWRGb2N1cyA9IGdyaWREYXRhOwogICAgYXdhaXQgYWIubGlua3MubWVudS5hYk9wZW5NZW51KCJncmlkIik7CiAgICBjb25zdCBtZW51Qm90ID0gZ2V0Qm90KCJiYXNlU2tpbGwiLCBnZXRMaW5rKGFjdGl2ZVRvb2xib3gpKTsKICAgIGlmIChtZW51Qm90KSB7CiAgICAgICAgbWVudUJvdC5vblBvaW50ZXJVcCgpOwogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScAx/e3PgAFbGVhcm4CBADH97c+lw0o8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAx/e3PgAFc3RvcmUCBADH97c+vg0o8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAx/e3PgAGc2VhcmNoAgQAx/e3PuUNKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAMf3tz4ACGFiSWdub3JlAgQAx/e3PowOBHRydWUnAMf3tz4ACWFiVmVyc2lvbgIEAMf3tz6RDgUxMC4zNScAx/e3PgANbWFuaWZlc3RhdGlvbgIEAMf3tz6XDijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDH97c+ABBhYkdyaWRNZW51QWN0aW9uAgQAx/e3Pr4OuQtALy8gc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCi8vIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgovLyB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKLy8gICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKLy8gYDsKLy8gdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAovLyAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKLy8gICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwovLyAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyAgICAgfQovLyBgOwovLyB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBgQAovLyAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBudWxsOwovLyBgOwoKLy8gY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7Ci8vIGNvbnN0IG1lbnVCb3QgPSB7fTsKCi8vIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsKLy8gbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwovLyBtZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKLy8gbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKLy8gbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsKLy8gbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwovLyBtZW51Qm90Lm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsKCi8vIGZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspCi8vIHsKLy8gICAgIGNvbnN0IGFjdGl2ZVRvb2xib3ggPSBwb3NzaWJsZVRvb2xib3hlc1tpXTsKLy8gICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7CgovLyAgICAgbWVudUJvdC50b29sYm94X2RhdGEgPSBhY3RpdmVUb29sYm94OwovLyAgICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOwoKLy8gICAgIGlmICghZXh0YW50Qm90KQovLyAgICAgewovLyAgICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCb3QpOwovLyAgICAgfQovLyB9JwDH97c+ABRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAMf3tz74GeICQGNvbnN0IHRvb2xib3hBcnJheSA9IGFiUmVtZW1iZXIudGFncy50b29sYm94X2FycmF5OwoKbGV0IGFsbFRvb2xzTG9hZGVkID0gdHJ1ZTsKCmZvciAobGV0IGkgPSAwOyBpIDwgdG9vbGJveEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBjdXJyZW50VG9vbCA9IHRvb2xib3hBcnJheVtpXS5uYW1lOwoKICAgIGlmICghZ2V0Qm90KCJhYklET3JpZ2luIiwgY3VycmVudFRvb2wpICYmICFnZXRCb3QoY3VycmVudFRvb2wsIHRydWUpKSB7CiAgICAgICAgYWxsVG9vbHNMb2FkZWQgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgIH0KfQoKaWYgKGFsbFRvb2xzTG9hZGVkKSB7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwDH97c+AA5hYkdyaWRNZW51SWNvbgIEAMf3tz7bHApsb2NhbF9tYWxsJwDH97c+AA9hYkdyaWRNZW51TGFiZWwCBADH97c+5hwHY2F0YWxvZycAx/e3PgATYWJHcmlkTWVudVNvcnRPcmRlcgIEAMf3tz7uHAMxMDAnAMf3tz4AD29uQUJJbml0aWFsaXplZAIEAMf3tz7yHCpALy8gbGlua3MubGVhcm4uYWJBZGFwdCgiY2FzdWFsX3Rvb2xib3giKTsnAMf3tz4ADW9uU2tpbGxVcGRhdGUCBADH97c+nR1XQGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7DQoNCmNvbnNvbGUubG9nKCJbVG9vbGJveF0gTG9hZGluZyBjYXN1YWwga2l0Iik7JwDH97c+AApzaGVsbFV0aWxzAgQAx/e3PvUdKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAMf3tz4AGGFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZQIEAMf3tz6cHtQJQGlmIChhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQ2F0YWxvZ05hbWUpIHsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkdyaWRNZW51TGFiZWwiLCBhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQ2F0YWxvZ05hbWUpOw0KfQ0KDQoNCi8vTkVXDQpjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspDQp7DQogICAgY29uc3QgbWVudUJvdCA9IHt9Ow0KDQogICAgbWVudUJvdC5hYk1lbnUgPSB0cnVlOw0KICAgIG1lbnVCb3QuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCiAgICBtZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsNCiAgICBtZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOw0KICAgIG1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiYWRkX2JveCI7DQogICAgbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOw0KICAgIG1lbnVCb3Qub25DbGljayA9IGBAIA0KICAgICAgICBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IA0KICAgICAgICBzZXRUYWdNYXNrKGFiLmxpbmtzLnJlbWVtYmVyLCAibGFzdE9wZW5lZERyb3Bkb3duIiwgbnVsbCk7DQogICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsNCiAgICANCiAgICBjb25zdCBhY3RpdmVUb29sYm94ID0gcG9zc2libGVUb29sYm94ZXNbaV07DQogICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsNCg0KICAgIG1lbnVCb3QudG9vbGJveF9kYXRhID0gYWN0aXZlVG9vbGJveDsNCiAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7DQoNCiAgICBpZiAoIWV4dGFudEJvdCkNCiAgICB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKG1lbnVCb3QpOw0KICAgIH0NCn0NCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwDH97c+ABJhYkdyaWRNZW51SXRlbVR5cGUCBADH97c+8ScIZHJvcGRvd24nAMf3tz4AEWRyb3Bkb3duU29ydE9yZGVyAgQAx/e3PvonAzEwMCcAx/e3PgAPZHJvcGRvd25PcHRpb25zAgQAx/e3Pv4nBvCfp6xbXScBBGJvdHMkMTc0MTBkODMtN2VlZS00YTFlLWI2MzgtNjU0NjM3NGQxN2MzAScAx/e3PoMoBnN5c3RlbQIEAMf3tz6EKBFhYi5pbnRlcmZhY2Uuc2NhbicAx/e3PoMoBGZvcm0CBADH97c+ligHbm90aGluZycAx/e3PoMoC2FiSW50ZXJmYWNlAgQAx/e3Pp4oBHRydWUnAMf3tz6DKAhhYklnbm9yZQIEAMf3tz6jKAR0cnVlJwDH97c+gygPb25RUkNvZGVTY2FubmVkAgQAx/e3Pqgo/Q9AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgpsZXQgcmVxdWVzdGluZ0FJID0gZmFsc2U7CmlmIChjb25maWdCb3QudGFncy5yZXF1ZXN0aW5nQUkpIHsKICAgIGNvbmZpZ0JvdC50YWdzLnJlcXVlc3RpbmdBSSA9IG51bGw7CiAgICByZXF1ZXN0aW5nQUkgPSB0cnVlOwp9CgppZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhc2siKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBpZiAocmVxdWVzdGluZ0FJKSB7CiAgICAgICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgicmVxdWVzdGluZ0FJIiwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIG9zLmdvVG9VUkwoc2Nhbm5lZFVSTC5ocmVmKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7CiAgICAgICAgICAgIGxldCBuZXdUYWcgPSBrZXk7CiAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3NbbmV3VGFnXSA9IG5ld1ZhbHVlOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuYXNrKSB7CiAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogY29uZmlnQm90LnRhZ3MuYXNrfSk7CiAgICAgICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5wYXR0ZXJuKSB7CiAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogY29uZmlnQm90LnRhZ3MucGF0dGVybn0pOwogICAgICAgIH0KICAgICAgICAKICAgIH0KfScAx/e3PoMoBXN0b3JlAgQAx/e3PqY4KPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAMf3tz6DKAZzZWFyY2gCBADH97c+zTgo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAx/e3PoMoEGFiQ29yZU1lbnVBY3Rpb24CBADH97c+9Dg3QG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7Cgpjb25maWdCb3QudGFncy5hYlNjYW4gPSB0cnVlOycAx/e3PoMoD2FiQ29yZU1lbnVMYWJlbAIEAMf3tz6sOQRzY2FuJwDH97c+gygOYWJDb3JlTWVudUljb24CBADH97c+sTkPcXJfY29kZV9zY2FubmVyJwDH97c+gygTYWJDb3JlTWVudVNvcnRPcmRlcgIEAMf3tz7BOQEzJwDH97c+gygJYWJWZXJzaW9uAgQAx/e3PsM5BTEwLjM1JwEEYm90cyQzYTZjYjljYS1iM2I0LTRkNzctODJmNi1mYTU5YjUyOTZlYzkBJwDH97c+yTkGc3lzdGVtAgQAx/e3Pso5F2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwDH97c+yTkIYWJJZ25vcmUCBADH97c+4jkEdHJ1ZScAx/e3Psk5D2Ryb3Bkb3duT3B0aW9ucwIEAMf3tz7nOQbwn6esW10nAMf3tz7JORJhYkNvcmVNZW51SXRlbVR5cGUCBADH97c+7DkIZHJvcGRvd24nAMf3tz7JORFkcm9wZG93blNvcnRPcmRlcgIEAMf3tz71OQRhdXRvJwDH97c+yTkYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQAx/e3Pvo5/iBAY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IGN1cnJlbnREaW0gPSBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uOw0KY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCg0KLy8gaWYgKGN1cnJlbnRQb3J0YWwgIT0gJ21hcCcpIHsNCi8vICAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gdHJ1ZTsNCi8vIH0gZWxzZSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IGZhbHNlOw0KLy8gfQ0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJOYXZpZ2F0aW9uTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuc2tpbGxCb3QgPSBnZXRMaW5rKHRoaXNCb3QpOw0KDQpjb25zdCBob21lV29ybGRCdXR0b24gPSB7DQogICAgLi4ubWVudU9wdGlvbnMsDQogICAgbGFiZWw6ICJob21lIHdvcmxkIiwNCiAgICBmb3JtQWRkcmVzczogJ2h0dHBzOi8vYXV0aC1hdXgtZGV2LWZpbGVzYnVja2V0LTY4MjM5NzY5MDY2MC5zMy5hbWF6b25hd3MuY29tLzMxOGMwNGYxLTEzOTEtNGMxMC04ZDQzLWFhZWJjNTE3MDI2NS8zOGFlOGI2OTU3ZjQ0ODNkODcxNjE0MWQxZTk4YzkzZjBlN2RjY2UxNWJjNWMxMjNiZDBlOWUxYWI2ODdjYzA1LnBuZycsDQogICAgb25DbGljazogYEANCiAgICAgICAgY29uc3QgY3VycmVudFVSTCA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKTsNCiAgICAgICAgY29uc3Qgb3JpZ2luID0gY3VycmVudFVSTC5vcmlnaW47DQoNCiAgICAgICAgbGV0IG5ld1VSTCA9IG5ldyBVUkwob3JpZ2luKTsNCg0KICAgICAgICBpZiAoYWJSZW1lbWJlci50YWdzLmFsbG93Q2hhbm5lbHMpIHsNCiAgICAgICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJjaGFubmVsIiwgZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmNvbUlkKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY29tSWQiLCBjb25maWdCb3QudGFncy5jb21JZCk7DQogICAgICAgIH0NCg0KICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgib3duZXIiLCAoY29uZmlnQm90LnRhZ3Muc3R1ZGlvICYmIGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAhPSBhdXRoQm90LmlkKSA/IGNvbmZpZ0JvdC50YWdzLnN0dWRpbyA6ICJwbGF5ZXIiKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImluc3QiLCAnaG9tZScpOw0KICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgibWFwUG9ydGFsIiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImFzayIsICdob21lJyk7DQogICAgICAgIA0KICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Muc3R1ZGlvICYmIGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAhPSBhdXRoQm90LmlkKSB7DQogICAgICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJzdHVkaW8iLCB0aGF0LmlkKTsgDQogICAgICAgIH0NCg0KICAgICAgICBvcy5vcGVuVVJMKG5ld1VSTC5ocmVmKTsNCiAgICBgDQp9Ow0KDQppZiAoIWdldEJvdCgiaXNIb21lV29ybGRDb3JlIiwgdHJ1ZSkgJiYgYXV0aEJvdCkgew0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGhvbWVXb3JsZEJ1dHRvbik7DQp9DQoNCmlmIChjdXJyZW50UG9ydGFsID09ICdtYXAnKSB7DQoNCiAgICBjb25zdCBob21lQmFzZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCg0KICAgIGlmIChob21lQmFzZUJvdCkgew0KICAgICAgICBjb25zdCBob21lQnV0dG9uID0gew0KICAgICAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgICAgICBsYWJlbDogaG9tZUJhc2VCb3QudGFncy5wbGFjZUxhYmVsLA0KICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvY2QzOGFmZmMwNjA0YmVhYTU4OGRhMjFhYTFiZTc1MGJiM2U3M2IzYjNjYWUyM2ViMzAzMDdjMzQ0OTQ0NTlmMy5wbmcnLA0KICAgICAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgICAgICBjb25zdCBob21lQm90ID0gZ2V0Qm90KCJob21lQmFzZSIsIHRydWUpOw0KICAgICAgICAgICAgICAgIGlmIChob21lQm90KSB7DQogICAgICAgICAgICAgICAgICAgIG9zLmZvY3VzT24oaG9tZUJvdCwgeyB6b29tOiAyMDAwIH0pLmNhdGNoKCgpID0+IHt9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIGANCiAgICAgICAgfTsNCg0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lQnV0dG9uKTsNCiAgICB9DQoNCiAgICBjb25zdCBwbGFjZXNBcnIgPSBbXTsNCiAgICBjb25zdCBwbGFjZXMgPSBnZXRCb3RzKCJob21lUGxhY2UiLCB0cnVlKTsNCiAgICBmb3IgKGNvbnN0IGhQbGFjZSBvZiBwbGFjZXMpIHsNCiAgICAgICAgaWYgKGhQbGFjZS50YWdzLmhvbWVCYXNlID09IHRydWUpIHsNCiAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHBsYWNlT2JqID0gew0KICAgICAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgICAgICBsYWJlbDogaFBsYWNlLnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnbG9jYXRpb25fb24nLA0KICAgICAgICAgICAgcGxhY2U6IGdldExpbmsoaFBsYWNlKSwNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgaWYgKGxpbmtzLnBsYWNlKSB7DQogICAgICAgICAgICAgICAgICAgIG9zLmZvY3VzT24obGlua3MucGxhY2UsIHsgem9vbTogMjAwMCB9KS5jYXRjaChlID0+IHt9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgICAgICBgDQogICAgICAgIH0NCg0KICAgICAgICBwbGFjZXNBcnIucHVzaChwbGFjZU9iaik7DQogICAgfQ0KDQogICAgcGxhY2VzQXJyLnNvcnQoKGEsIGIpID0+IHsNCiAgICAgICAgY29uc3QgbmFtZUEgPSBhLmxhYmVsLnRvVXBwZXJDYXNlKCk7DQogICAgICAgIGNvbnN0IG5hbWVCID0gYi5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KDQogICAgICAgIGlmIChuYW1lQSA8IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG5hbWVBID4gbmFtZUIpIHsNCiAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAwOw0KICAgIH0pOw0KDQogICAgZm9yIChjb25zdCBzb3J0ZWRQbGFjZSBvZiBwbGFjZXNBcnIpIHsNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goc29ydGVkUGxhY2UpOw0KICAgIH0NCg0KDQogICAgY29uc3QgY3VycmVudExvY2F0aW9uQnV0dG9uID0gew0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgbGFiZWw6ICdjdXJyZW50IGxvY2F0aW9uJywNCiAgICAgICAgZm9ybUFkZHJlc3M6ICduZWFyX21lJywNCiAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgIGxpbmtzLnNraWxsQm90LmdvVG9DdXJyZW50TG9jYXRpb24oKTsNCiAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgIGANCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChjdXJyZW50TG9jYXRpb25CdXR0b24pOw0KfQ0KDQppZiAoZHJvcGRvd25PcHRpb25zLmxlbmd0aCA9PSAwKSB7DQogICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQp9IGVsc2Ugew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCn0NCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwDH97c+yTkQYWJDb3JlTWVudUFjdGlvbgIEAMf3tz75WgNALy8nAMf3tz7JOQthYkludGVyZmFjZQIEAMf3tz79WgR0cnVlJwDH97c+yTkPYWJDb3JlTWVudUxhYmVsAgQAx/e3PoJbCXBsYWNlIG5hdicAx/e3Psk5BGZvcm0CBADH97c+jFsHbm90aGluZycAx/e3Psk5E2dvVG9DdXJyZW50TG9jYXRpb24CBADH97c+lFuABEBjb25zdCBsb2NhdGlvbiA9IGF3YWl0IG9zLmdldEdlb2xvY2F0aW9uKCk7DQoNCmlmIChsb2NhdGlvbi5zdWNjZXNzKSB7DQogICAgY29uc3QgY3VycmVudERpbSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQogICAgY29uc3QgY3VycmVudFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/ICJtYXAiIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PSAiYmx1ZXByaW50IiA/ICJibHVlcHJpbnQiIDoiZ3JpZCI7DQoNCiAgICBpZiAoY3VycmVudFBvcnRhbCAhPSAnbWFwJykgew0KICAgICAgICBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPSBjdXJyZW50RGltOw0KICAgIH0NCg0KICAgIG9zLmZvY3VzT24oe3g6IGxvY2F0aW9uLmxvbmdpdHVkZSwgeTogbG9jYXRpb24ubGF0aXR1ZGV9LCB7cG9ydGFsOiAnbWFwJywgem9vbTogMjAwMH0pOw0KfSBlbHNlIHsNCiAgICBvcy50b2FzdCgiTG9jYXRpb24gc2VydmljZXMgbm90IGF2YWlsYWJsZSIpDQp9JwDH97c+yTkJYWJWZXJzaW9uAgQAx/e3PpVfBTEwLjM1JwEEYm90cyQ0OTNmZmE0ZC00NmQ0LTRhOTgtYWU5Yy0xMjEyZDY1MTEzM2YBJwDH97c+m18Gc3lzdGVtAgQAx/e3PpxfFGFiLmludGVyZmFjZS52ZXJzaW9uJwDH97c+m18Nb25Ta2lsbFVwZGF0ZQIEAMf3tz6xX6cBQGNvbnN0IHZlcnNpb25TdHJpbmcgPSB0YWdzLmFiSW50ZXJmYWNlTWFqb3JWZXJzaW9uICsgIi4iICsgdGFncy5hYkludGVyZmFjZU1pbm9yVmVyc2lvbjsNCg0KY29uc29sZS5sb2coIltBQkludGVyZmFjZV0gTG9hZGVkIEFCIEludGVyZmFjZSB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAMf3tz6bXxdhYkludGVyZmFjZU1ham9yVmVyc2lvbgIEAMf3tz7ZYAEyJwDH97c+m18XYWJJbnRlcmZhY2VNaW5vclZlcnNpb24CBADH97c+22ACMzMnAMf3tz6bXwhhYklnbm9yZQIEAMf3tz7eYAR0cnVlJwDH97c+m18EZm9ybQIEAMf3tz7jYAdub3RoaW5nJwDH97c+m18LYWJJbnRlcmZhY2UCBADH97c+62AEdHJ1ZScAx/e3PptfCWFiVmVyc2lvbgIEAMf3tz7wYAUxMC4zNScBBGJvdHMkNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmAScAx/e3PvZgBnN5c3RlbQIEAMf3tz73YBNhYi5pbnRlcmZhY2UubnVnZ2V0JwDH97c+9mAEZm9ybQIEAMf3tz6LYQdub3RoaW5nJwDH97c+9mALYWJJbnRlcmZhY2UCBADH97c+k2EEdHJ1ZScAx/e3PvZgCGFiSWdub3JlAgQAx/e3PphhBHRydWUnAMf3tz72YAxhYkxvYWROdWdnZXQCBADH97c+nWGYAkBsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0TmFtZTsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK251Z2dldE5hbWU7CmxldCBsb2FkZWROdWdnZXQgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGZvcm1hdHRlZE51Z2dldEFCLCBhYlZlcnNpb246IHRoYXQudmVyc2lvbiwgcmV0dXJuVHlwZTogImRhdGEifSk7Cgpsb2FkZWROdWdnZXQgPSBsb2FkZWROdWdnZXQuc3RhdGVbbnVnZ2V0TmFtZV0ubnVnZ2V0OwoKcmV0dXJuIGxvYWRlZE51Z2dldDsnAMf3tz72YA9hYlB1Ymxpc2hOdWdnZXQCBADH97c+tmOMA0AvL3Nob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiAibnVnTmFtZSIsIGRhdGE6IGRhdGF9KTsgIEFERCBFR0cgSUQgRVZFTlRVQUxMWQpsZXQgdGVzdE51Z2dldCA9IHRoYXQuZGF0YTsKbGV0IGZvcm1hdHRlZE51Z2dldCA9IHtpZDogdGhhdC5udWcsIG51Z2dldDogdGVzdE51Z2dldH07CmxldCB0ZXN0TnVnZ2V0TmFtZSA9IHRoYXQubnVnOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrdGVzdE51Z2dldE5hbWU7CgptYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBmb3JtYXR0ZWROdWdnZXRBQjsKCmxpbmtzLnN0b3JlLmFiUHVibGlzaEFCKHthYjogZm9ybWF0dGVkTnVnZ2V0QUIsIHRhcmdldDogZm9ybWF0dGVkTnVnZ2V0LCBzb3VyY2VFdmVudDogJ3B1Ymxpc2hfbnVnZ2V0J30pOycAx/e3PvZgD2ltcGxlbWVudE51Z2dldAIEAMf3tz7DZrEHQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXQ7CmxldCBudWdnZXRWZXJzaW9uQ2hlY2sgPSBudWdnZXROYW1lLmluZGV4T2YoIi52Iik7CmxldCB2ZXJzaW9uOwoKaWYgKG51Z2dldFZlcnNpb25DaGVjayAhPSAtMSkKewogICAgbnVnZ2V0TmFtZSA9IG51Z2dldE5hbWUuc3Vic3RyaW5nKDAsIG51Z2dldFZlcnNpb25DaGVjayk7CgogICAgbGV0IHZlcnNpb25DaGVjayA9IHRoYXQubnVnZ2V0LnN1YnN0cmluZyhudWdnZXRWZXJzaW9uQ2hlY2sgKyAyKTsKCiAgICBpZiAoaXNOYU4odmVyc2lvbkNoZWNrKSkKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyh2ZXJzaW9uQ2hlY2ssICJ2ZXJzaW9uIGlzIG5vdCBhIG51bWJlciIpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHZlcnNpb24gPSBOdW1iZXIodmVyc2lvbkNoZWNrKTsKICAgIH0KfQpjb25zb2xlLmxvZyhudWdnZXROYW1lLCB2ZXJzaW9uKTsKbGV0IG51Z0RhdGEgPSBhd2FpdCB0aGlzQm90LmFiTG9hZE51Z2dldCh7bnVnZ2V0TmFtZTogbnVnZ2V0TmFtZSwgdmVyc2lvbjogdmVyc2lvbn0pOwoKaWYgKG51Z0RhdGEgPT0gImFiSUQgbm90IGZvdW5kIikKewogICAgb3MudG9hc3QoIm51Z2dldCBub3QgZm91bmQiKTsKfQplbHNlCnsKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwogICAgbGV0IHRhcmdldFRhZyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLnRvU3RyaW5nKCk7CiAgICBsZXQgdGFyZ2V0TnVnID0gInsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldFRhZy5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwogICAgaW5zZXJ0VGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIG51Z0RhdGEpOwp9JwDH97c+9mAMbnVnZ2V0QnV0dG9uAgQAx/e3PvVt9QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnAMf3tz72YAtudWdnZXRQYXJzZQIEAMf3tz7peqcPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwDH97c+9mANb25BQlB1Ymxpc2hlZAIEAMf3tz6RigHBAUBjb25zb2xlLmxvZyh0aGF0LmFiLCB0YWdzLm51Z2dldFRvUHVibGlzaCkKCmlmICh0aGF0LmFiID09IHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IHB1Ymxpc2hlZCIpOwoKICAgIG1hc2tzLm51Z2dldFRvUHVibGlzaCA9IG51bGw7CgogICAgY29uZmlnQm90Lm1hc2tzLmFiVmVyc2lvbiA9IG51bGw7Cn0nAMf3tz72YBBvbkFueUJvdHNDaGFuZ2VkAgQAx/e3PtOLAbcEQGlmIChjb25maWdCb3QgJiYgdGhhdFswXS5ib3QuaWQgIT0gdGhpc0JvdC5pZCkgCnsKICAgIGlmICghY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdCkgcmV0dXJuOyAvLyBJZ25vcmUgaWYgdGhlIGNvbmZpZ0JvdCBpc24ndCByZWFkeSB5ZXQuCgogICAgY29uc3QgZWRpdGVkQm90SUQgPSBjb25maWdCb3QudGFncy5lZGl0aW5nQm90LnJlcGxhY2UoIvCflJciLCAiIik7CgogICAgaWYgKCF0aGF0LmZpbmQoeCA9PiB4LmJvdC5pZCA9PSBlZGl0ZWRCb3RJRCkpIHJldHVybjsgLy8gSWYgdGhlIGJvdCBjaGFuZ2VkIHdhc24ndCBiZWluZyBlZGl0ZWQgYnkgdGhlIHVzZXIgaWdub3JlIGl0LgoKICAgIGNvbnN0IGVkaXRlZFRhZyA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdUYWc7CiAgICBjb25zdCBlZGl0ZWRCb3QgPSBnZXRCb3QoImlkIiwgZWRpdGVkQm90SUQpOwoKICAgIGlmIChlZGl0ZWRCb3QgJiYgZWRpdGVkVGFnKSAKICAgIHsKICAgICAgICBzaG91dCgibnVnZ2V0UmVzZXQiKTsKCiAgICAgICAgdGhpc0JvdC5udWdnZXRQYXJzZSh7IGVkaXRlZEJvdCwgZWRpdGVkVGFnIH0pOwogICAgfQp9JwDH97c+9mAIb25DcmVhdGUCBADH97c+iZABTEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnAMf3tz72YA1wYWNrYWdlTnVnZ2V0AgQAx/e3PtaQAfgGQGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CmNvbnN0IHRhZ1RleHQgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXTsKCmlmIChjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4IHx8IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4KQp7CiAgICBsZXQgc3RhcnRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4OwogICAgbGV0IGVuZFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4OwoKICAgIGlmIChzdGFydFBvcyA9PSBlbmRQb3MpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoc3RhcnRQb3MgPiBlbmRQb3MpCiAgICB7CiAgICAgICAgbGV0IG5ld1N0YXJ0UG9zID0gZW5kUG9zOwogICAgICAgIGxldCBuZXdFbmRQb3MgPSBzdGFydFBvczsKCiAgICAgICAgc3RhcnRQb3MgPSBuZXdTdGFydFBvczsKICAgICAgICBlbmRQb3MgPSBuZXdFbmRQb3M7CiAgICB9CgogICAgbGV0IGRhdGEgPSB0YWdUZXh0LnN1YnN0cmluZyhzdGFydFBvcywgZW5kUG9zICsgMSk7CgogICAgc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6IHRoYXQubnVnZ2V0LCBkYXRhOiBkYXRhfSk7CgogICAgb3MudG9hc3QoIm51ZyBpcyBwdWJsaXNoaW5nIiwgMTApOwoKICAgIGxldCB0YXJnZXROdWcgPSAiLm51ZyB7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImNhbm5vdCByZWFkIG51Z2dldCB0byBiZSBwdWJsaXNoZWQiKQp9JwDH97c+9mAIcmVtZW1iZXICBADH97c+z5cBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAMf3tz72YAZzZWFyY2gCBADH97c+9pcBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAMf3tz72YAVzdG9yZQIEAMf3tz6dmAEo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAx/e3PvZgCWxpc3RlbmluZwIEAMf3tz7EmAEFZmFsc2UnAMf3tz72YAlhYlZlcnNpb24CBADH97c+ypgBBTEwLjM1JwEEYm90cyRiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IBJwDH97c+0JgBCHByZXNlbmNlAgQAx/e3PtGYASjwn5SXODdlOTUzNDItZTQ1Ni00YjYzLTk4OTEtZDdhOTIxYWQzZWU3JwDH97c+0JgBGWFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3ICBADH97c++JgBzgxAY29uc3QgewogICAgbGFiZWwgPSBgJHthYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9IGlzIHdvcmtpbmdgLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fQoKbGV0IGJ1c3lJbmRpY2F0b3IgPSB7CiAgICBvblBvaW50ZXJVcDogbnVsbCwKICAgIG9uUG9pbnRlckRvd246IG51bGwsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgYnVzeUxhYmVsOiBsYWJlbCwKICAgIGxhYmVsQWxpZ25tZW50OiAnbGVmdCcsCiAgICBzdGF0ZTogMCwKICAgIGFuaW1TdGF0ZXM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgXSwKICAgIGFuaW1SYXRlOiA1MDAsCiAgICBvbkJvdEFkZGVkOiBgQAogICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICBvbkJvdENoYW5nZWQ6IGBACiAgICAgICAgY29uc3QgbmVlZFJlZnJlc2ggPSB0aGF0LnRhZ3Muc29tZSh0ID0+IHQgPT09ICdidXN5TGFiZWwnIHx8IHQgPT09ICdzdGF0ZScgfHwgdCA9PT0gJ2FuaW1TdGF0ZXMnKTsKICAgICAgICBpZiAobmVlZFJlZnJlc2gpIHsKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0KICAgIGAsCiAgICByZWZyZXNoRGlzcGxheTogYEAKICAgICAgICBpZiAodGFncy5hbmltU3RhdGVzICYmIHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IGFuaW1TdGF0ZSA9IHRhZ3MuYW5pbVN0YXRlc1t0YWdzLnN0YXRlXTsKCiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSB0YWdzLmJ1c3lMYWJlbC50cmltKCkgKyBhbmltU3RhdGUuZWxsaXBzaXM7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBhbmltU3RhdGUuZm9ybUFkZHJlc3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5sYWJlbCAKICAgICAgICB9CiAgICBgLAogICAgYW5pbWF0ZTogYEAKICAgICAgICBpZiAodGFncy5zdGF0ZSA+PSB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICB0YWdzLnN0YXRlID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLnN0YXRlICs9IDE7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBvcy5zbGVlcCh0YWdzLmFuaW1SYXRlKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICAuLi5yZXN0Cn07Cgpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYnVzeUluZGljYXRvcik7CgpyZXR1cm4gbWVudUJvdDsnAMf3tz7QmAEGc3lzdGVtAgQAx/e3PselARFhYi5pbnRlcmZhY2UubWVudScAx/e3PtCYAQRmb3JtAgQAx/e3PtmlAQdub3RoaW5nJwDH97c+0JgBC2Rlc2NyaXB0aW9uAgQAx/e3PuGlASZUaGlzIHNraWxsIGlzIGRlc2lnbmVkIGZvciBtZW51IHN0dWZmLigAx/e3PtCYAQthYkludGVyZmFjZQF4JwDH97c+0JgBCmFiT3Blbk1lbnUCBADH97c+iaYB8R5AYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgbWVudVR5cGUgPSB0aGF0ID8gImFiIiArIHRoYXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGF0LnNsaWNlKDEpICsgIk1lbnUiOiAiYWJDb3JlTWVudSI7IC8vc2V0IHVwIGEgY2hlY2sgdG8gc2VlIHdoYXQgdHlwZSBvZiBtZW51IHNob3VsZCBiZSBvY2N1cmluZyBbY29yZSwgYm90LCBncmlkLCBpbnN0XQpsZXQgbWVudVNraWxscyA9IGdldEJvdHMobWVudVR5cGUgKyAiQWN0aW9uIik7CmxldCBtYXhPcHRpb25zID0gbWVudVR5cGUgPT0gImluc3QiID8gNyA6IDU7CmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5OwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MuYmFzZVNraWxsLiR7bWVudVR5cGUgKyAiQWN0aW9uIn0oe2JvdDogdGhpc0JvdH0pO2A7CgpsZXQgc29ydE9yZGVySW5kZXggPSBtZW51U2tpbGxzLmxlbmd0aDsKZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51U2tpbGxzLmxlbmd0aDsgaSsrKS8vQUREIExPR0lDIEZPUiBNT1JFIE9QVElPTlMgVEhBTiA1IDogbWF4T3B0aW9ucwp7CiAgICAvL0FsbG93cyBmb3IgY29kZSB0byBnZXQgY2FsbGVkIGJlZm9yZSB0aGUgbWVudSBnZW5lcmF0ZXMsIHVzZWZ1bCBmb3IgZHluYW1pY2FsbHkgc2V0IGdyb3VwcyBvciBkcm9wZG93bnMKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiXSkgewogICAgICAgIGF3YWl0IHdoaXNwZXIobWVudVNraWxsc1tpXSwgbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiKTsKICAgIH0gCgogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJIaWRlIl0pIHsKICAgICAgICBjb250aW51ZTsKICAgIH0KICAgIAogICAgbGV0IGN1cnJlbnRTa2lsbCA9IG1lbnVTa2lsbHNbaV07CgogICAgYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGN1cnJlbnRTa2lsbC5pZDsKICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkxhYmVsIl07CiAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJY29uIl07CiAgICBhYk1lbnVCdXR0b24ub25DcmVhdGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJPbkdlbmVyYXRlIl07CiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiU29ydE9yZGVyIl07CiAgICBhYk1lbnVCdXR0b24uY29sb3IgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdID8/IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwoKICAgIGNvbnN0IG1lbnVJdGVtVHlwZSA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl07CgogICAgaWYgKG1lbnVJdGVtVHlwZSA9PSAiZHJvcGRvd24iKSB7CiAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duT3B0aW9ucyA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duT3B0aW9uczsKCiAgICAgICAgY29uc3QgcHJldkRyb3Bkb3duID0gbGlua3MucmVtZW1iZXIubGlua3MubGFzdE9wZW5lZERyb3Bkb3duOwogICAgICAgIGlmIChwcmV2RHJvcGRvd24gJiYgcHJldkRyb3Bkb3duLnRhZ3NbbWVudVR5cGUgKyAiQWN0aW9uIl0pIHsKICAgICAgICAgICAgaWYgKHByZXZEcm9wZG93biA9PSBjdXJyZW50U2tpbGwpIHsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICJsYXN0T3BlbmVkRHJvcGRvd24iLCBudWxsKTsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkRlZmF1bHRPcGVuIl0gPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBhYk1lbnVCdXR0b24uZGVmYXVsdE9wZW47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5kcm9wZG93blNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJNZW51QnV0dG9uKTsgICAgICAgIAogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gImdyb3VwIikgewogICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhYk1lbnVCdXR0b24ubWVudUl0ZW1zID0gY3VycmVudFNraWxsLnRhZ3MubWVudUl0ZW1zOwogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJpbnB1dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtVHlwZSA9PSAidGV4dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJ0b29sIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gIndpemFyZCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOwogICAgfQp9Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJPcGVuTWVudScsIHsgbWVudTogdGhhdCwgbWVudVR5cGUsIG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsIH0pOycAx/e3PtCYARJhYkNyZWF0ZU1lbnVCdXR0b24CBADH97c++cQB/A1AbGV0IG5ld01lbnVCdXR0b24gPSB7fTsKCmxldCB7CiAgICBtZW51SXRlbVN0eWxlID0ge30sCiAgICAuLi5hZGRpdGlvbmFsVGFncwp9ID0gdGhhdCA/PyB7fQoKaWYgKHR5cGVvZiBtZW51SXRlbVN0eWxlID09ICdzdHJpbmcnKSB7CiAgICBtZW51SXRlbVN0eWxlID0gbWVudUl0ZW1TdHlsZS5yZXBsYWNlKC9cdXsxRjlFQ30vdSwgJycpOyAKICAgIG1lbnVJdGVtU3R5bGUgPSBKU09OLnBhcnNlKG1lbnVJdGVtU3R5bGUpOwp9CgpmdW5jdGlvbiBoYXNCb3JkZXJTdHlsZSgpIHsKICAgIGlmIChtZW51SXRlbVN0eWxlWyJib3JkZXItdG9wLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLWxlZnQtc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItYm90dG9tLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLXJpZ2h0LXN0eWxlIl0pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KCmlmIChhZGRpdGlvbmFsVGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSkgewogICAgaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiTWVudUdyb3VwIl0pIHsKCiAgICB9Cn0KCm5ld01lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwpuZXdNZW51QnV0dG9uLmxhYmVsQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVMYWJlbENvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKbmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvciA9IHRoYXQuc2hhZG93Q29sb3IgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTaGFkb3dDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24uc2NhbGVZID0gMTsKCmNvbnN0IG1lbnVTdHlsaW5nID0gewogICAgImJvcmRlci1yYWRpdXMiOiI4cHgiLAogICAgIm1hcmdpbi10b3AiOiAiOHB4IiwKICAgICJib3gtc2hhZG93IjogYDNweCA0cHggJHtuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yfWAsCiAgICAibWluLWhlaWdodCI6ICI0NHB4IiwKICAgICJib3JkZXIiOiBoYXNCb3JkZXJTdHlsZSgpID8gIiIgOiBgMnB4IHNvbGlkICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIndpZHRoIjogImNhbGMoMTAwJSAtIDVweCkiLAogICAgLi4ubWVudUl0ZW1TdHlsZQp9CgpuZXdNZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBtZW51U3R5bGluZzsKCmNvbnN0IGNsaWNrZWRTdHlsaW5nID0gewogICAgLi4ubWVudVN0eWxpbmcsCiAgICAiZmlsdGVyIjogImJyaWdodG5lc3MoNjAlKSIKfQpjb25zdCBiYXNlU3R5bGUgPSBgQCBtYXNrcy5tZW51SXRlbVN0eWxlID0gJ/Cfp6wgJHtKU09OLnN0cmluZ2lmeShjbGlja2VkU3R5bGluZyl9J2AKCm5ld01lbnVCdXR0b24ub25Qb2ludGVyRG93biA9IG1lbnVJdGVtU3R5bGU/LlsibWFyZ2luLXRvcCJdICE9ICIwcHgiID8gYmFzZVN0eWxlIDogIkAgLy8iOwpuZXdNZW51QnV0dG9uLm9uUG9pbnRlclVwID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGxgOwoKZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpCnsKICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107Cn0KCm5ld01lbnVCdXR0b24gPSBjcmVhdGUobmV3TWVudUJ1dHRvbik7CgpyZXR1cm4gbmV3TWVudUJ1dHRvbjsnAMf3tz7QmAENYWJNZW51UmVmcmVzaAIEAMf3tz700gGdAUBpZiAoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbD8uc3Vic3RyaW5nKDAsMikgPT0gImFiIikKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKICAgIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKICAgIG1hc2tzLm9uS2V5RG93biA9IG51bGw7Cn0nAMf3tz7QmAEIcmVtZW1iZXICBADH97c+ktQBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAMf3tz7QmAENbWFuaWZlc3RhdGlvbgIEAMf3tz651AEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAx/e3PtCYARFhYkVudmlyb25tZW50TWVudQIEAMf3tz7g1AHBEkBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmNvbnN0IGFiTWVudUl0ZW0gPSB7CiAgICBhYk1lbnU6IHRydWUsCiAgICBhYk1lbnVSZWZyZXNoOiAiQGRlc3Ryb3kodGhpc0JvdCk7IiwKICAgIG1hbmlmZXN0YXRpb246IHRhZ3MubWFuaWZlc3RhdGlvbiwKICAgIHJlbWVtYmVyOiB0YWdzLnJlbWVtYmVyLAogICAgcGVyc29uYWxpdHk6IHRhZ3MucGVyc29uYWxpdHksCiAgICBsZWFybjogdGFncy5sZWFybiwKfTsKCmNvbnN0IGFiRW52aXJvbm1lbnRPcHRpb25zID0gdGhpc0JvdC5hYkdldEVudmlyb25tZW50T3B0aW9ucygpOyAKCmZvciAobGV0IGkgPSAwOyBpIDwgYWJFbnZpcm9ubWVudE9wdGlvbnMubGVuZ3RoOyBpKyspIHsgCiAgICBjb25zdCBvcHRpb24gPSBhYkVudmlyb25tZW50T3B0aW9uc1tpXTsKCiAgICBhc3NlcnQodHlwZW9mIG9wdGlvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlciA9PT0gJ251bWJlcicsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfX1dIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyIG11c3QgYmUgYSBudW1iZXIuYCk7CgogICAgYWJNZW51SXRlbS5hYk1lbnVTb3J0T3JkZXIgPSBvcHRpb24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI7CgogICAgY29uc3Qgb3B0aW9uTW9kID0gey4uLmFiTWVudUl0ZW0sIC4uLm9wdGlvbn07CgogICAgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICdidXR0b24nIHx8ICFvcHRpb24ubWVudUl0ZW1UeXBlKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24ob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2Ryb3Bkb3duJykgewogICAgICAgIG9wdGlvbk1vZC5kcm9wZG93blNvcnRPcmRlciA9IG9wdGlvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjsKCiAgICAgICAgLy8gTWFrZSBzdXJlIGVhY2ggZHJvcGRvd24gb3B0aW9ucyBnZXRzIGFiTWVudUl0ZW0gZGVmYXVsdHMuCiAgICAgICAgaWYgKG9wdGlvbi5kcm9wZG93bk9wdGlvbnMgJiYgb3B0aW9uLmRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgb3B0aW9uLmRyb3Bkb3duT3B0aW9ucy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgb3B0aW9uLmRyb3Bkb3duT3B0aW9uc1trXSA9IHsgLi4uYWJNZW51SXRlbSwgLi4ub3B0aW9uLmRyb3Bkb3duT3B0aW9uc1trXSB9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICdncm91cCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUdyb3VwKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICdpbnB1dCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICd0ZXh0JykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAndG9vbCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2wob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ3dpemFyZCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChvcHRpb25Nb2QpOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWVudUl0ZW1UeXBlICR7b3B0aW9uLm1lbnVJdGVtVHlwZX0gaXMgbm90IGltcGxlbWVudGVkLmApOwogICAgICAgIGNvbnRpbnVlOwogICAgfQp9CgovLyB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiUGVyc29uYWxpdHlDb25maWdCdXR0b24pOwoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCRW52aXJvbm1lbnRNZW51JywgeyBtZW51UG9ydGFsOiBjb25maWdCb3QudGFncy5tZW51UG9ydGFsfSApJwDH97c+0JgBBWxlYXJuAgQAx/e3PqLnASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDH97c+0JgBA2dwdAIEAMf3tz7J5wEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAx/e3PtCYAQhhYklnbm9yZQIEAMf3tz7w5wEEdHJ1ZScAx/e3PtCYAQZzZWFyY2gCBADH97c+9ecBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAMf3tz7QmAEGbnVnZ2V0AgQAx/e3PpzoASjwn5SXNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmJwDH97c+0JgBBXRlc3RzAgQAx/e3PsPoASjwn5SXYjgzZDk3MmItMDUzNS00MDUxLWI1ODktNDFjZWRhODUzNWYxJwDH97c+0JgBA2FzawIEAMf3tz7q6AEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAx/e3PtCYAQlhYlZlcnNpb24CBADH97c+kekBBTEwLjM1JwDH97c+0JgBEWFiQ3JlYXRlTWVudUlucHV0AgQAx/e3PpfpAZ4CQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVJbnB1dCA9IHsNCiAgICBmb3JtOiAiaW5wdXQiLA0KICAgIG1lbnVJdGVtU2hvd1N1Ym1pdFdoZW5FbXB0eTogZmFsc2UsDQogICAgZm9ybUlucHV0TXVsdGlsaW5lOiBudWxsLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVJbnB1dCk7DQoNCnJldHVybiBtZW51Qm90OycAx/e3PtCYARBhYkNyZWF0ZU1lbnVUZXh0AgQAx/e3PrbrAYEEQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KY29uc3Qgew0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZSwNCiAgICAuLi5yZXN0DQp9ID0gdGhhdDsNCg0KbGV0IG1lbnVUZXh0ID0gew0KICAgIGZvcm06ICJ0ZXh0IiwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIHBvaW50YWJsZTogZmFsc2UsDQogICAgY29sb3I6ICJ3aGl0ZSIsDQogICAgbWVudUl0ZW1TdHlsZTogew0KICAgICAgICAicGFkZGluZy10b3AiOiAiNnB4IiwNCiAgICAgICAgInBhZGRpbmctYm90dG9tIjogIjZweCIsDQogICAgfSwNCiAgICBtZW51SXRlbUxhYmVsU3R5bGU6IHsNCiAgICAgICAgIndoaXRlLXNwYWNlIjogInByZS13cmFwIiwNCiAgICAgICAgLi4ubWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIH0sDQogICAgLi4ucmVzdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUZXh0KTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwDH97c+0JgBEGFiQ3JlYXRlTWVudVRvb2wCBADH97c+uO8BjgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVRvb2wgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUb29sKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwDH97c+0JgBEmFiQ3JlYXRlTWVudVdpemFyZAIEAMf3tz7H8AGSAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51V2l6YXJkID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51V2l6YXJkKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwDH97c+0JgBFGFiQ3JlYXRlTWVudURyb3Bkb3duAgQAx/e3PtrxAeUdQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKHRoYXQuZHJvcGRvd25Tb3J0T3JkZXIgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBFcnJvcihgYWJDcmVhdGVNZW51RHJvcGRvd246IGRyb3Bkb3duU29ydE9yZGVyIGlzIG5vdCBwcm92aWRlZC5gKTsNCn0NCg0KbGV0IG91dGVyTWVudUJ1dHRvbiA9IHsNCiAgICAuLi50aGF0LA0KICAgIGZvcm1BZGRyZXNzOiB0aGF0LmZvcm1BZGRyZXNzID8/ICJhcnJvd19yaWdodCIsDQogICAgZHJvcGRvd25PcGVuOiBmYWxzZSwNCiAgICBvbkNsaWNrOiBgQA0KICAgICAgICB0YWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSAke3RoYXQuZHJvcGRvd25Tb3J0T3JkZXJ9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucykgew0KICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKHRhZ3MuZHJvcGRvd25PcHRpb25zLCB0YWdzLmRyb3Bkb3duU29ydE9yZGVyKTsNCiAgICAgICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICBgLA0KICAgIG9uRGVzdHJveTogYEANCiAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICBgLA0KICAgIG9uUG9pbnRlclVwOiBgQA0KICAgICAgICBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbDsNCiAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICBtYXNrcy5mb3JtQWRkcmVzcyA9ICJhcnJvd19yaWdodCI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IGZhbHNlKSB7DQogICAgICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJmb3JtQWRkcmVzcyIsICJhcnJvd19kcm9wX2Rvd24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgIm1lbnVJdGVtU3R5bGUiLCB7Li4udGFncy5tZW51SXRlbVN0eWxlLCAiYm9yZGVyQm90dG9tTGVmdFJhZGl1cyI6ICIwIiwgImJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzIjogIjAifSk7DQogICAgICAgIH0NCiAgICBgLA0KICAgIG9uQm90Q2hhbmdlZDogYEANCiAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygnZHJvcGRvd25PcGVuJykgJiYgdGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgc2hvdXQoImFiTWVudURyb3Bkb3duT3BlbmVkIiwgdGhpc0JvdCk7DQogICAgICAgIH0NCiAgICBgLA0KICAgIGFiTWVudURyb3Bkb3duT3BlbmVkOiBgQA0KICAgICAgICBpZiAodGhhdCAhPSB0aGlzQm90KSB7DQogICAgICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSBmYWxzZTsNCiAgICAgICAgICAgIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKGxpbmtzICYmIGxpbmtzLmJhc2VTa2lsbCkgew0KICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYWIubGlua3MucmVtZW1iZXIsICJsYXN0T3BlbmVkRHJvcGRvd24iLCB0YWdzLmJhc2VTa2lsbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICBgDQp9Ow0KDQppZiAodGhhdC5mb3JtQWRkcmVzcyAmJiB0aGF0LmZvcm1BZGRyZXNzICE9ICJhcnJvd19yaWdodCIpIHsNCiAgICBvdXRlck1lbnVCdXR0b24uY3VzdG9tRm9ybUFkZHJlc3MgPSB0cnVlOw0KfQ0Kb3V0ZXJNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSB0aGF0LmRyb3Bkb3duU29ydE9yZGVyOw0KDQpjb25zdCBtZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24ob3V0ZXJNZW51QnV0dG9uKTsNCm1lbnVCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zID0gZ2VuZXJhdGVNZW51T3B0aW9uczsNCg0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNZW51T3B0aW9ucyAob3B0aW9ucywgc29ydE9yZGVyKSB7DQogICAgY29uc3QgbWVudUJvdHMgPSBbXTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyArK2kpIHsNCg0KICAgICAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm9wdGlvbnNbaV0sDQogICAgICAgICAgICBjbGVhckRyb3Bkb3duTWVudTogYEANCiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOw0KICAgICAgICAgICAgYA0KICAgICAgICB9Ow0KDQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcihzb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDAwKTsNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9IHRydWU7DQoNCiAgICAgICAgaWYgKGkgPT0gb3B0aW9ucy5sZW5ndGggLSAxKSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIDAgOHB4IDhweCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCAwIDhweCA4cHgiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyVG9wIl0gPSAibm9uZSI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsibWFyZ2luVG9wIl0gPSAiMCI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsicGFkZGluZ0xlZnQiXSA9ICIzNXB4IjsNCg0KICAgICAgICBjb25zdCBuZXdNZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQogICAgfQ0KDQogICAgbWVudUJvdC50YWdzLm1lbnVCb3RzID0gZ2V0TGluayhtZW51Qm90cyk7DQp9DQoNCmlmICh0aGF0LmRlZmF1bHRPcGVuKSB7DQogICAgbWVudUJvdC5vblBvaW50ZXJVcCgpOw0KICAgIG1lbnVCb3Qub25DbGljaygpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdDsNCg0KJwDH97c+0JgBEWFiQ3JlYXRlTWVudUdyb3VwAgQAx/e3PsCPAr0fQC8qDQogICBFWEFNUExFDQogICBjb25zdCBtZW51R3JvdXAgPSB7DQogICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGdyb3VwU29ydE9yZGVyOiAxLA0KICAgICAgICBtZW51SXRlbXM6IFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDIiLA0KICAgICAgICAgICAgICAgIGNvbG9yOiAib3JhbmdlIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICBtZW51SXRlbVR5cGU6ICJkcm9wZG93biIsDQogICAgICAgICAgICAgICAgZHJvcGRvd25PcHRpb25zOiBbDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDEiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMyIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICB9DQogICAgICAgIF0NCiAgICB9DQoqLw0KDQppZiAgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAoIXRoYXQuZ3JvdXBTb3J0T3JkZXIpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudUdyb3VwOiBncm91cFNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCB7DQogICAgbWVudUl0ZW1TdHlsZSA9IHt9LA0KICAgIG1lbnVJdGVtcyA9IFtdLA0KICAgIC4uLmFkZGl0aW9uYWxUYWdzDQp9ID0gdGhhdCA/PyB7fQ0KDQpjb25zdCBtZW51Qm90cyA9IFtdOw0KZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51SXRlbXMubGVuZ3RoOyArK2kpIHsNCg0KICAgIGxldCBuZXdNZW51QnV0dG9uID0ge307DQoNCiAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSBOdW1iZXIodGhhdC5ncm91cFNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMCk7DQoNCiAgICBsZXQgaW5kaXZNZW51SXRlbVN0eWxlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtU3R5bGUgPz8ge307DQogICAgbGV0IGluZGl2TWVudVR5cGUgPSBtZW51SXRlbXNbaV0ubWVudUl0ZW1UeXBlID8/IHVuZGVmaW5lZDsNCiAgICBsZXQgaW5kaXZBZGRpdGlvbmFsVGFncyA9IG1lbnVJdGVtc1tpXTsNCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgIGRlbGV0ZSBpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVN0eWxlIl07DQogICAgfQ0KICAgIGlmIChpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVR5cGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl07DQogICAgfQ0KDQogICAgY29uc3QgYmFzZVN0eWxpbmcgPSB7DQogICAgICAgICJib3JkZXJUb3AiOiAibm9uZSIsDQogICAgICAgICJtYXJnaW5Ub3AiOiAiMCINCiAgICB9DQoNCiAgICBpZiAoaSA9PSBtZW51SXRlbXMubGVuZ3RoIC0gMSAmJiBpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQogICAgZWxzZSBpZiAoaSA9PSBtZW51SXRlbXMubGVuZ3RoIC0gMSkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLmJhc2VTdHlsaW5nLA0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICIwIDAgOHB4IDhweCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9IGVsc2UgaWYgKGkgPT0gMCkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiOHB4IDhweCAwIDAiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7fQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLmJhc2VTdHlsaW5nLA0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICIwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQ0KICAgIHsNCiAgICAgICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBpbmRpdkFkZGl0aW9uYWxUYWdzKQ0KICAgIHsNCiAgICAgICAgbmV3TWVudUJ1dHRvblt0YWddID0gaW5kaXZBZGRpdGlvbmFsVGFnc1t0YWddOw0KICAgIH0NCg0KICAgIGxldCBuZXdNZW51Qm90Ow0KICAgIHN3aXRjaChpbmRpdk1lbnVUeXBlKSB7DQogICAgICAgIGNhc2UgImRyb3Bkb3duIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLi4ubmV3TWVudUJ1dHRvbiwNCiAgICAgICAgICAgICAgICAgICAgImRyb3Bkb3duU29ydE9yZGVyIjogTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMCkNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJpbnB1dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ0ZXh0IjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidG9vbCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUb29sKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgIndpemFyZCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgIH0NCiAgICBtZW51Qm90cy5wdXNoKG5ld01lbnVCb3QpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdHM7JwDH97c+0JgBC3BlcnNvbmFsaXR5AgQAx/e3Pv6uAijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwDH97c+0JgBF2FiR2V0RW52aXJvbm1lbnRPcHRpb25zAgQAx/e3PqWvArZ7QGNvbnN0IG9wdGlvbnMgPSBbXTsKCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6IGBoaWRlYCwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMCwKICAgICAgICBmb3JtQWRkcmVzczogInZpc2liaWxpdHlfb2ZmIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgfSksCiAgICB9KQp9CgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAic2xlZXAiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJuaWdodHNfc3RheSIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiU2V0QXdha2UoeyBhd2FrZTogZmFsc2UgfSkKICAgICAgICB9KSwKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogIm9wdGltaXplIG1vZGUiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDIwMCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgfSksCiAgICByZWZyZXNoRGlzcGxheTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnIDogdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA/IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gZmFsc2UgOiBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA9IHRydWU7CiAgICAgICAgdGhpc0JvdC5vbkNyZWF0ZSgpOwogICAgfSksCn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJjdXN0b21pemU6IGFiIHBlcnNvbmFsaXR5IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAzMDAsCiAgICBtZW51SXRlbVR5cGU6ICdkcm9wZG93bicsCiAgICBkcm9wZG93bk9wdGlvbnM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbmFtZTogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwgeyB0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgdG8gY2FsbCBtZT8nIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBuYW1lOiBuYW1lIH0pOwogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgYWkgbW9kZWw6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWx9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbHMgPSBjb25maWdCb3QudGFncy5haUNoYXRNb2RlbHM7CgogICAgICAgICAgICAgICAgaWYgKG1vZGVscykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBbXTsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBtb2RlbHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKHsgbGFiZWw6IGVudHJ5Lm5hbWUsIHZhbHVlOiBlbnRyeS5uYW1lIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudE1vZGVsSW5kZXggPSBvcHRpb25zLmZpbmRJbmRleChvID0+IG8udmFsdWUgPT09IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsKTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQoY3VycmVudE1vZGVsSW5kZXgsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICd3aGF0IGFpIG1vZGVsIHdvdWxkIHlvdSBsaWtlIG1lIHRvIHVzZT8nLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbGlzdCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBvcHRpb25zLAogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRPcHRpb24gJiYgc2VsZWN0ZWRPcHRpb24udmFsdWUgIT09IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgYWlNb2RlbDogc2VsZWN0ZWRPcHRpb24udmFsdWUgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aEJvdCkgewogICAgICAgICAgICAgICAgICAgICAgICBvcy5zaG93QWxlcnQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdzb21ldGhpbmcgd2VudCB3cm9uZycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnZmFpbGVkIHRvIGdldCBsaXN0IG9mIGFpIGNoYXQgbW9kZWxzLicKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBvcy5zaG93QWxlcnQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdzaWduIGluIHJlcXVpcmVkJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICd5b3UgbXVzdCBzaWduIGluIHRvIHVzZSBhaS4nCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvciwgeyB0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbWUgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgY29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51cyB0byBiZT8nIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBtZW51Q29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSB0ZXh0IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUxhYmVsQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVMYWJlbENvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51IHRleHQgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgbWVudUxhYmVsQ29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgYm90IGxhYmVsIGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciwgeyB0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgYm90IHRleHQgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgYm90TGFiZWxDb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBkZWZhdWx0IHBvcnRhbCBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyAnIzI2MzIzOCd9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgcG9ydGFsQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB5b3VyIHBvcnRhbCB0byBsb29rIGxpa2U/JyB9KTsKICAgICAgICAgICAgICAgIGlmICghcG9ydGFsQ29sb3IpIHsKICAgICAgICAgICAgICAgICAgICBwb3J0YWxDb2xvciA9ICcjMjYzMjM4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgJ3BvcnRhbENvbG9yJzogcG9ydGFsQ29sb3IgfSk7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGRlZmF1bHQgbWFwIHBvcnRhbCBiYXNlbWFwYCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgic2hvd0FCQmFzZW1hcE9wdGlvbnMiKTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiAiZGVmYXVsdCBzZXR0aW5ncyIsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgICAgICAgICBjb2xvcjogJ3JlZCcsCiAgICAgICAgICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgJ2RlZmF1bHRQZXJzb25hbGl0eSc6IHRydWUgfSk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgXQp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiY2hhdCIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNDAwLAogICAgZm9ybUFkZHJlc3M6ICJjaGF0IiwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBzaG91dCgnYWJDaGF0QmFyT3BlbicpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgfSksCn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJudWdnZXRzIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1MDAsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRhZ3MubnVnTWFuYWdlciA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuaW50ZXJmYWNlLm51Z2dldCcpKTsgCiAgICAgICAgCiAgICAgICAgaWYgKGxpbmtzLm51Z01hbmFnZXIudGFncy5saXN0ZW5pbmcpIHsgCiAgICAgICAgICAgIHRhZ3Mub25DbGljayA9IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IAogICAgICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCBudWxsKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94YDsgCiAgICAgICAgfSBlbHNlIHsgCiAgICAgICAgICAgIHRhZ3Mub25DbGljayA9IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IAogICAgICAgICAgICAgICAgaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIHRydWUsICdsb2NhbCcpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGBjaGVja19ib3hfb3V0bGluZV9ibGFua2A7CiAgICAgICAgfQogICAgfSksCn0pCgppZiAobGlua3MucHJlc2VuY2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJjYW1lcmEgcHJlc2VuY2UiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1MTAsCiAgICAgICAgcHJlc2VuY2U6IHRhZ3MucHJlc2VuY2UsCiAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkID0gKHRoYXQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ2NhbWVyYUVuYWJsZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgb3MuYWRkQm90TGlzdGVuZXIobGlua3MucHJlc2VuY2UsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQpOwoKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0pLAogICAgICAgIHJlZnJlc2hEaXNwbGF5OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLnByZXNlbmNlLnRhZ3MuY2FtZXJhRW5hYmxlZCA/IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JyA6IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIH0pLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5wcmVzZW5jZSwgJ2NhbWVyYUVuYWJsZWQnLCAhISFsaW5rcy5wcmVzZW5jZS50YWdzLmNhbWVyYUVuYWJsZWQsICdsb2NhbCcpOwogICAgICAgIH0pLAogICAgICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBvcy5yZW1vdmVCb3RMaXN0ZW5lcihsaW5rcy5wcmVzZW5jZSwgJ29uQm90Q2hhbmdlZCcsIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCk7CiAgICAgICAgfSkKICAgIH0pCgogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogImN1cnNvciBwcmVzZW5jZSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDUyMCwKICAgICAgICBwcmVzZW5jZTogdGFncy5wcmVzZW5jZSwKICAgICAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQgPSAodGhhdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygnY3Vyc29yRW5hYmxlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5hZGRCb3RMaXN0ZW5lcihsaW5rcy5wcmVzZW5jZSwgJ29uQm90Q2hhbmdlZCcsIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCk7CgogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfSksCiAgICAgICAgcmVmcmVzaERpc3BsYXk6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgbGlua3MucHJlc2VuY2UudGFncy5jdXJzb3JFbmFibGVkID8gdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnIDogdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLnByZXNlbmNlLCAnY3Vyc29yRW5hYmxlZCcsICEhIWxpbmtzLnByZXNlbmNlLnRhZ3MuY3Vyc29yRW5hYmxlZCwgJ2xvY2FsJyk7CiAgICAgICAgfSksCiAgICAgICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIG9zLnJlbW92ZUJvdExpc3RlbmVyKGxpbmtzLnByZXNlbmNlLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkKTsKICAgICAgICB9KQogICAgfSkKfQoKaWYgKGxpbmtzLmdwdCkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDYwMCwKICAgICAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBpZiAoIWF1dGhCb3QpIHsKICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gJ0ZyZWVQbGF5JyB8fCBhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSAnZWRpdCAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgcHJvbXB0JzsgdGFncy5ncHRCb3QgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmFjdGlvbi5hc2snKSk7CiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpOwogICAgICAgIH0pLAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiZ3JpZCBzbmFwIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA3MDAsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJwogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiYm90IHNuYXAiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDgwMCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgfSksCn0pCgppZiAoYXV0aEJvdCkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogImFjY291bnQiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA5MDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJiYWRnZSIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBvcy5zaG93QWNjb3VudEluZm8oKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9KSwKICAgIH0pCn0KCmlmIChsaW5rcy50ZXN0cykgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInJlY29yZCB0ZXN0IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAwMCwKICAgICAgICBmb3JtQWRkcmVzczogInNjaWVuY2UiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgc2hvdXQoJ2FiUmVjb3JkVGVzdCcpOwogICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIH0pLAogICAgfSkKCiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAicmVjb3JkIHRyYWNlIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTEwMCwKICAgICAgICBmb3JtQWRkcmVzczogInRpbWVsaW5lIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHNob3V0KCdhYlJlY29yZFRyYWNlJyk7CiAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfSksCiAgICB9KQp9CgppZiAoZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaG9tZS5lZ2ciKSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInNhdmUgaG9tZSBlZ2ciLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMjAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAiZWdnIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGdldEJvdCgic3lzdGVtIiwgImFiLmhvbWUuZWdnIikuc2F2ZURhdGEoKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9KSwKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoZWNrIGZvciAiICsgYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgdXBkYXRlcyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTMwMCwKICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICBsZWFybjogdGFncy5sZWFybiwKICAgIGNoZWNrRm9yVXBkYXRlczogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgIC8vIFRlbXBvcmFyaWx5IHJlcGxhY2Ugd2l0aCBidXN5IGluZGljYXRvciB3aGlsZSBjaGVja2luZyBmb3IgdXBkYXRlcy4KICAgICAgICB0YWdzLmFiTWVudSA9IGZhbHNlOwoKICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IGFiLmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcih7CiAgICAgICAgICAgIGFiTWVudTogdHJ1ZSwKICAgICAgICAgICAgbGFiZWw6ICdjaGVja2luZyBmb3IgdXBkYXRlcyB0byAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IHRhZ3MuYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIsCiAgICAgICAgfSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrID0gYXdhaXQgYWIuYWJDaGVja0FCVXBkYXRlQXZhaWxhYmxlKHsgZGV0YWlsZWQ6IHRydWUgfSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gbnVsbDsKCiAgICAgICAgICAgIC8vIEJyaW5nIGJhY2sgdGhlIHVwZGF0ZSBidXR0b24uCiAgICAgICAgICAgIHRhZ3MuYWJNZW51ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjayAmJiB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay5zdWNjZXNzKSB7CiAgICAgICAgICAgIGlmIChnbG9iYWxUaGlzLmFiVXBkYXRlQ2hlY2tlcikgewogICAgICAgICAgICAgICAgYWJVcGRhdGVDaGVja2VyLnRhZ3MudXBkYXRlQXZhaWxhYmxlID0gdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sudXBkYXRlQXZhaWxhYmxlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sudXBkYXRlQXZhaWxhYmxlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhYkZpbGVzV2l0aFVwZGF0ZXMgPSB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay5hYkZpbGVDaGVja3MuZmlsdGVyKGYgPT4gZi51cGRhdGVBdmFpbGFibGUpOwoKICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IG9zLnNob3dDb25maXJtKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1VwZGF0ZXMgZm91bmQgZm9yICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogJ1RoZXJlIGFyZSAnICsgYWJGaWxlc1dpdGhVcGRhdGVzLmxlbmd0aCArICcgZmlsZSB1cGRhdGVzIGZvciAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJy4gV291bGQgeW91IGxpa2UgdG8gaW5zdGFsbCB0aGUgdXBkYXRlcyBub3c/IFlvdSBhbmQgYW55IGNvbm5lY3RlZCB1c2VycyB3aWxsIGF1dG9tYXRpY2FsbHkgcmVmcmVzaCB0aGUgcGFnZSBhZnRlciB0aGUgdXBkYXRlIGlzIGNvbXBsZXRlLicsCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsVGV4dDogJ05vdCBub3cnLAogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1UZXh0OiAnWWVzJwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgICAgICAgICAgbGlua3MubGVhcm4udXBkYXRlQUIoKTsKICAgICAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWIubGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdChhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIGlzIGFscmVhZHkgdXAtdG8tZGF0ZSEnKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1hc2tzLmxhYmVsID0gJ3VwZGF0ZSBjaGVjayBmYWlsZWQnOwogICAgICAgIH0KICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRoaXNCb3QuY2hlY2tGb3JVcGRhdGVzKCk7CiAgICB9KSwKICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcikgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICB9CiAgICB9KSwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogInBlcm1hbmVudGx5IGRlbGV0ZSIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogOTk5OSwKICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGFncy5sYWJlbCArPSAiICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwogICAgICAgIHRhZ3MuY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbnRyYXN0Q29sb3IgPz8gIiNEOTMwMzAiOwogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ1Blcm1hbmVudGx5IGRlbGV0ZSAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgY29udGVudDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIGZyb20gJyArIGxpbmtzLmxlYXJuLnRhZ3MuYWJJbnN0ICsgJz8gVGhpcyBpcyBub3QgcmV2ZXJzaWJsZSEnLAogICAgICAgIH0pCgogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CgogICAgICAgIGNvbnN0IGFiQm90cyA9IGdldEJvdHMoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtICYmCiAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtLnN0YXJ0c1dpdGgoJ2FiJyk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgZGVzdHJveShhYkJvdHMpOwogICAgICAgIH0KICAgIH0pLAp9KQoKcmV0dXJuIG9wdGlvbnM7JwDH97c+0JgBHmFiQ3JlYXRlVG9vbGJveERyb3Bkb3duT3B0aW9ucwIEAMf3tz7cqgPjE0Bjb25zdCB0b29sYm94VG9vbHMgPSBbLi4udGhhdC50b29sQXJyYXldID8/IFtdOw0KY29uc3QgdG9vbGJveE5hbWUgPSB0aGF0LnRvb2xib3hOYW1lID8/ICJLaXQgIjsNCmNvbnN0IHRvb2xib3ggPSB0aGF0LnRvb2xib3g7DQpjb25zdCBncmlkSW5mb3JtYXRpb24gPSAodGhhdD8uZ3JpZEluZm9ybWF0aW9uICYmIHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiAhPSB1bmRlZmluZWQpID8gdGhhdD8uZ3JpZEluZm9ybWF0aW9uIDogYWJSZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOw0KDQpjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnRvb2xib3ggPSBnZXRMaW5rKHRvb2xib3gpOw0KbWVudU9wdGlvbnMuZ3JpZEluZm9ybWF0aW9uID0gZ3JpZEluZm9ybWF0aW9uOw0KbWVudU9wdGlvbnMuc2VhcmNoID0gdGFncy5zZWFyY2g7DQptZW51T3B0aW9ucy5hcnRpZmFjdCA9IHRhZ3MuYXJ0aWZhY3Q7DQovL21lbnVPcHRpb25zLmZvcm1BZGRyZXNzID0gImhhcmR3YXJlIjsNCg0KaWYgKHRvb2xib3hUb29scy5sZW5ndGggPT09IDApIHsNCiAgICBjb25zdCBtZXNzYWdlID0gdG9vbGJveE5hbWUgKyAiIGRvZXMgbm90IGhhdmUgYW55IHRvb2xzIGxpc3RlZCBpbiB0aGUgdG9vbF9hcnJheSB0YWciOw0KDQogICAgYWIubG9nKGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBtZXNzYWdlKTsNCiAgICBvcy50b2FzdChtZXNzYWdlLCA1KTsNCiAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpOw0KfQ0KDQpmb3IgKGxldCB0b29sIG9mIHRvb2xib3hUb29scykgew0KICAgIGNvbnN0IHRvb2xCdXR0b24gPSB7DQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBsYWJlbDogdG9vbC5uYW1lLA0KICAgICAgICB0YXJnZXRBQjogdG9vbC50YXJnZXRBQiwNCiAgICAgICAgaXNBcnRpZmFjdDogdG9vbC5hcnRpZmFjdCB8fCBmYWxzZSwNCiAgICAgICAgb25DbGljazpgQA0KICAgICAgICAgICAgaWYgKHRhZ3MuaXNBcnRpZmFjdCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGFiQXJ0aWZhY3RTaGFyZCA9IHsNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICAgICAgICAgICAgZWdnUGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llczogWw0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGxpbmtzLmFydGlmYWN0LmFiQ3JlYXRlQXJ0aWZhY3RQcm9taXNlQm90KHsNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdE5hbWU6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3RTaGFyZCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCLA0KICAgICAgICAgICAgICAgICAgICBzb3VyY2VFdmVudDogJ3Rvb2wnLA0KICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiB0YWdzLnRvb2xib3gsDQogICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9uDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgYCwNCiAgICB9Ow0KDQogICAgaWYgKHRvb2wuZm9ybUFkZHJlc3MpIHsNCiAgICAgICAgdG9vbEJ1dHRvbi5mb3JtQWRkcmVzcyA9IHRvb2wuZm9ybUFkZHJlc3M7DQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2godG9vbEJ1dHRvbik7DQp9DQoNCnJldHVybiBkcm9wZG93bk9wdGlvbnM7JwDH97c+0JgBEG9uQUJBdXRoQm90QWRkZWQCBADH97c+wL4DGEBzaG91dCgnYWJNZW51UmVmcmVzaCcpOycAx/e3PtCYAQhhcnRpZmFjdAIEAMf3tz7ZvgMo8J+Ulzc4ZTQxNTAzLWM5MzMtNGY4YS04MTdhLWJhOTdiZjhkNWQyNycBBGJvdHMkYzc4YWE2NjMtZDA1Yy00ZWM0LWJjMmMtMjZmZDUxNTYwYjk3AScAx/e3PoC/AxVhYkNyZWF0ZUN1YmVGYWNlUGxhbmUCBADH97c+gb8DiTFAbGV0IHsgCiAgICBib3QsCiAgICBkaW1lbnNpb24sCiAgICBzcGFjZSA9ICd0ZW1wTG9jYWwnLAogICAgZGVidWcsCiAgICBmYWNlT2Zmc2V0ID0gMC4wMSwKICAgIHBvaW50YWJsZSA9IGZhbHNlLAogICAgdGlja0ludGVydmFsTVMgPSA1MDAsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9OwoKYXNzZXJ0KGxpbmtzLnV0aWxzLmlzQm90KGJvdCksIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm90IGlzIGEgcmVxdWlyZWQgQm90IHBhcmFtZXRlci5gKTsKYXNzZXJ0KGRpbWVuc2lvbiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkaW1lbnNpb24gaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CmFzc2VydChyZXN0LmZvcm0gPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBmb3JtIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5hbmNob3JQb2ludCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFuY2hvclBvaW50IGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkJvdEFkZGVkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7Cgpjb25zdCBmYWNlUGxhbmVNb2QgPSB7CiAgICBzcGFjZSwKICAgIGFuY2hvclBvaW50OiAnY2VudGVyJywKICAgIGRlYnVnLAogICAgZmFjZU9mZnNldCwKICAgIGZvcm06ICdzcHJpdGUnLAogICAgZGltZW5zaW9uLAogICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICBwb2ludGFibGUsCiAgICB0aWNrSW50ZXJ2YWxNUywKICAgIHRyYW5zZm9ybWVyOiBib3QuaWQsCiAgICBvbkJvdEFkZGVkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGhpc0JvdC5zdGFydFRpY2soKTsKICAgIH0pLAogICAgb25Cb3RDaGFuZ2VkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygndGlja0ludGVydmFsTVMnKSkgewogICAgICAgICAgICB0aGlzQm90LnN0b3BUaWNrKCk7CiAgICAgICAgICAgIHRoaXNCb3Quc3RhcnRUaWNrKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCd0cmFuc2Zvcm1lcicpKSB7CiAgICAgICAgICAgIGlmICghdGFncy50cmFuc2Zvcm1lcikgewogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25BbnlCb3RzUmVtb3ZlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0YWdzLnRyYW5zZm9ybWVyKSB7CiAgICAgICAgICAgIGlmICh0aGF0LmJvdElEcy5pbmNsdWRlcyh0YWdzLnRyYW5zZm9ybWVyKSkgewogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGhpc0JvdC5zdG9wVGljaygpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGRlc3Ryb3llZGApOwogICAgICAgIH0KICAgIH0pLAogICAgc2V0RGltZW5zaW9uOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uc3QgZGltZW5zaW9uID0gdGhhdDsKCiAgICAgICAgaWYgKHRhZ3MuZGltZW5zaW9uICE9PSBkaW1lbnNpb24pIHsKICAgICAgICAgICAgLy8gUmVtb3ZlIGZyb20gcHJldmlvdXMgZGltZW5zaW9uLgogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnUG9zaXRpb24nXSA9IG51bGw7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnUm90YXRpb24nXSA9IG51bGw7CgogICAgICAgICAgICBpZiAoZGltZW5zaW9uKSB7CiAgICAgICAgICAgICAgICAvLyBBc3NpZ24gdG8gbmV3IGRpbWVuc2lvbi4KICAgICAgICAgICAgICAgIHRhZ3MuZGltZW5zaW9uID0gZGltZW5zaW9uOwogICAgICAgICAgICAgICAgdGFnc1tkaW1lbnNpb25dID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9KSwKICAgIHN0YXJ0VGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmIChtYXNrcy50aWNrSW50ZXJ2YWxJZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtYXNrcy50aWNrSW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHdoaXNwZXIodGhpc0JvdCwgJ3RpY2snKSwgdGFncy50aWNrSW50ZXJ2YWxNUyk7CiAgICAgICAgdGhpc0JvdC50aWNrKCk7CiAgICB9KSwKICAgIHN0b3BUaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKG1hc2tzLnRpY2tJbnRlcnZhbElkKSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobWFza3MudGlja0ludGVydmFsSWQpOwogICAgICAgICAgICBtYXNrcy50aWNrSW50ZXJ2YWxJZCA9IG51bGw7CiAgICAgICAgfQogICAgfSksCiAgICB0aWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uc3QgTE9DQUxfTk9STUFMUyA9IFsKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMSwgMCwgMCksIC8vICtYCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKC0xLCAwLCAwKSwgLy8gLVgKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgMSwgMCksIC8vICtZCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAsIC0xLCAwKSwgLy8gLVkKICAgICAgICBdCgogICAgICAgIGNvbnN0IExPQ0FMX1BPU0lUSU9OUyA9IFsKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMC41ICsgdGFncy5mYWNlT2Zmc2V0LCAwLCAtMC41KSwgLy8gK1gKICAgICAgICAgICAgbmV3IFZlY3RvcjMoLTAuNSAtIHRhZ3MuZmFjZU9mZnNldCwgMCwgLTAuNSksIC8vIC1YCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAsIDAuNSArIHRhZ3MuZmFjZU9mZnNldCwgLTAuNSksIC8vICtZCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAsIC0wLjUgLSB0YWdzLmZhY2VPZmZzZXQsIC0wLjUpLCAvLyAtWQogICAgICAgIF0KCiAgICAgICAgY29uc3QgSEFMRl9QSSA9IE1hdGguUEkgLyAyOwoKICAgICAgICBjb25zdCBMT0NBTF9ST1RBVElPTlMgPSBbCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IEhBTEZfUEksIHk6IEhBTEZfUEksIHo6IDAgfX0pLCAvLyArWAogICAgICAgICAgICBuZXcgUm90YXRpb24oeyBldWxlcjogeyB4OiBIQUxGX1BJLCB5OiAtSEFMRl9QSSwgejogMCB9fSksIC8vIC1YCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IC1IQUxGX1BJLCB5OiAwLCB6OiBNYXRoLlBJIH19KSwgLy8gK1kKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogSEFMRl9QSSwgeTogMCwgejogMCB9fSksIC8vIC1ZCiAgICAgICAgXQoKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhlIGZhY2UgcGxhbmUgdG8gYmUgb24gdGhlIGdpdmVuIGZhY2UgaW5kZXguICAKICAgICAgICAgKiAwOiArWCwgIAogICAgICAgICAqIDE6IC1YLCAgCiAgICAgICAgICogMjogK1ksICAKICAgICAgICAgKiAzOiAtWQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIHNldFBsYW5lRmFjZShmYWNlSW5kZXgpIHsKICAgICAgICAgICAgbWFza3NbdGFncy5kaW1lbnNpb24gKyAnUG9zaXRpb24nXSA9IExPQ0FMX1BPU0lUSU9OU1tmYWNlSW5kZXhdOwogICAgICAgICAgICBtYXNrc1t0YWdzLmRpbWVuc2lvbiArICdSb3RhdGlvbiddID0gTE9DQUxfUk9UQVRJT05TW2ZhY2VJbmRleF07CiAgICAgICAgfQoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGRpbWVuc2lvbjpgLCB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBhcmVudFBvc2l0aW9uID0gZ2V0Qm90UG9zaXRpb24odGFncy50cmFuc2Zvcm1lciwgdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIHBhcmVudCBwb3NpdGlvbjpgLCBwYXJlbnRQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICBsZXQgZ3JpZFBvcnRhbFR5cGU6ICdncmlkJyB8ICdtaW5pR3JpZCcgfCBudWxsID0gbnVsbDsKCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIGdyaWRQb3J0YWxUeXBlID0gJ2dyaWQnOwogICAgICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIGdyaWRQb3J0YWxUeXBlID0gJ21pbmlHcmlkJzsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGV0ZWN0ZWQgZ3JpZCBwb3J0YWwgdHlwZTpgLCBncmlkUG9ydGFsVHlwZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWdyaWRQb3J0YWxUeXBlKSB7CiAgICAgICAgICAgIHNldFBsYW5lRmFjZSgwKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgY2FtZXJhUG9zaXRpb24gPSBvcy5nZXRDYW1lcmFQb3NpdGlvbihncmlkUG9ydGFsVHlwZSk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gY2FtZXJhIHBvc2l0aW9uOmAsIGNhbWVyYVBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGRpcmVjdGlvblRvQ2FtZXJhID0gY2FtZXJhUG9zaXRpb24uc3VidHJhY3QocGFyZW50UG9zaXRpb24pLm5vcm1hbGl6ZSgpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGRpcmVjdGlvbiB0byBjYW1lcmE6YCwgZGlyZWN0aW9uVG9DYW1lcmEpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcGFyZW50Um90YXRpb24gPSBnZXRCb3RSb3RhdGlvbih0YWdzLnRyYW5zZm9ybWVyLCB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgY29uc3Qgd29ybGROb3JtYWxzOiBWZWN0b3IzW10gPSBuZXcgQXJyYXkoNCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICAgICAgd29ybGROb3JtYWxzW2ldID0gcGFyZW50Um90YXRpb24ucm90YXRlVmVjdG9yMyhMT0NBTF9OT1JNQUxTW2ldKTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gd29ybGQgbm9ybWFsczpgLCB3b3JsZE5vcm1hbHMpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBGaW5kIHRoZSBmYWNlIG1vc3QgZmFjaW5nIHRoZSBjYW1lcmEgKG1heCBkb3QgcHJvZHVjdCkuIAogICAgICAgIGxldCBiZXN0SW5kZXggPSAwOyAKICAgICAgICBsZXQgYmVzdERvdCA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWTsgCiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZE5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWxzW2ldLmRvdChkaXJlY3Rpb25Ub0NhbWVyYSk7CiAgICAgICAgICAgIGlmIChkb3QgPiBiZXN0RG90KSB7CiAgICAgICAgICAgICAgICBiZXN0RG90ID0gZG90OyAKICAgICAgICAgICAgICAgIGJlc3RJbmRleCA9IGk7IAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGJlc3QgZmFjZSBpbmRleDpgLCBiZXN0SW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgc2V0UGxhbmVGYWNlKGJlc3RJbmRleCk7CiAgICB9KSwKICAgIC4uLnJlc3QKfQoKY29uc3QgZmFjZVBsYW5lQm90ID0gY3JlYXRlKGZhY2VQbGFuZU1vZCk7CgpyZXR1cm4gZmFjZVBsYW5lQm90OycAx/e3PoC/AwhhYklnbm9yZQIEAMf3tz6L8AMEdHJ1ZScAx/e3PoC/AwthYkludGVyZmFjZQIEAMf3tz6Q8AMEdHJ1ZScAx/e3PoC/AwZzeXN0ZW0CBADH97c+lfADGGFiLmludGVyZmFjZS5ib3RfZmFjdG9yeScAx/e3PoC/AxZhYkNyZWF0ZUJpbGxib2FyZExhYmVsAgQAx/e3Pq7wA41FQGxldCB7IAogICAgYm90LAogICAgZGltZW5zaW9uLAogICAgcHJlc2VydmVOZXdMaW5lcyA9IHRydWUsCiAgICBsYWJlbCA9ICcnLAogICAgc3BhY2UgPSAndGVtcExvY2FsJywKICAgIGNvbG9yID0gJ3doaXRlJywKICAgIGxhYmVsQ29sb3IgPSAnYmxhY2snLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fTsKCmlmICh0eXBlb2YgbGFiZWwgIT09ICdzdHJpbmcnKSB7CiAgICBsYWJlbCA9IFN0cmluZyhsYWJlbCk7Cn0KCmFzc2VydChsaW5rcy51dGlscy5pc0JvdChib3QpLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGJvdCBpcyBhIHJlcXVpcmVkIEJvdCBwYXJhbWV0ZXIuYCk7CmFzc2VydChkaW1lbnNpb24sIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uIGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyLmApOwphc3NlcnQocmVzdC5vbkNyZWF0ZSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkFueUJvdHNDaGFuZ2VkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQW55Qm90c1JlbW92ZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3QudXBkYXRlTGFiZWwgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3QubGFiZWxXb3JkV3JhcE1vZGUgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBsYWJlbFdvcmRXcmFwTW9kZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKCi8vIC0tLSAxKSBXb3JkIGJyZWFraW5nICh3cmFwIGJ5IHdvcmRzLCBjaHVuayBsb25nIHdvcmRzKSAtLS0KZnVuY3Rpb24gYnJlYWtXb3Jkc1RvTGluZXModGV4dCwgbWF4Q29scyA9IDE4KSB7CiAgICBpZiAoIXRleHQpIHJldHVybiBbJyddOwogICAgY29uc3Qgd29yZHMgPSB0ZXh0LnNwbGl0KC9ccysvKS5maWx0ZXIoQm9vbGVhbik7CiAgICBjb25zdCBsaW5lcyA9IFtdOwogICAgbGV0IGxpbmUgPSAnJzsKCiAgICBjb25zdCBwdXNoID0gKCkgPT4geyBsaW5lcy5wdXNoKGxpbmUpOyBsaW5lID0gJyc7IH07CgogICAgZm9yIChjb25zdCB3IG9mIHdvcmRzKSB7CiAgICAgICAgaWYgKHcubGVuZ3RoID4gbWF4Q29scykgewogICAgICAgICAgICAvLyBjbG9zZSBjdXJyZW50IGxpbmUgKGlmIGFueSkgYmVmb3JlIGNodW5raW5nIGEgbG9uZyB3b3JkCiAgICAgICAgICAgIGlmIChsaW5lKSBwdXNoKCk7CiAgICAgICAgICAgIC8vIGNodW5rIHRoZSBsb25nIHdvcmQKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3Lmxlbmd0aDsgaSArPSBtYXhDb2xzKSB7CiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKHcuc2xpY2UoaSwgaSArIG1heENvbHMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsaW5lID0gJyc7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIWxpbmUubGVuZ3RoKSB7CiAgICAgICAgICAgIGxpbmUgPSB3OwogICAgICAgIH0gZWxzZSBpZiAobGluZS5sZW5ndGggKyAxICsgdy5sZW5ndGggPD0gbWF4Q29scykgewogICAgICAgICAgICBsaW5lICs9ICcgJyArIHc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHVzaCgpOwogICAgICAgICAgICBsaW5lID0gdzsKICAgICAgICB9CiAgICB9CiAgICBpZiAobGluZS5sZW5ndGgpIHB1c2goKTsKCiAgICByZXR1cm4gbGluZXMubGVuZ3RoID8gbGluZXMgOiBbJyddOwp9CgovLyBQcmVzZXJ2ZXMgZXhpc3RpbmcgXG4gYXMgaGFyZCBicmVha3M7IHdyYXBzIHdpdGhpbiBlYWNoIGhhcmQgbGluZS4KZnVuY3Rpb24gYnJlYWtXb3Jkc1RvTGluZXNQcmVzZXJ2ZU5ld2xpbmVzKHRleHQsIG1heENvbHMgPSAxOCkgewogIGlmICh0ZXh0ID09IG51bGwpIHJldHVybiBbJyddOwoKICAvLyBTcGxpdCBvbiByZWFsIG5ld2xpbmVzOyBrZWVwIGVtcHR5IGxpbmVzIHNvIHdlIHByZXNlcnZlIGJsYW5rIGxpbmVzLgogIGNvbnN0IGhhcmRMaW5lcyA9IFN0cmluZyh0ZXh0KS5zcGxpdCgvXHI/XG4vKTsKICBjb25zdCBvdXQgPSBbXTsKCiAgLy8gSGVscGVyIHRvIHdyYXAgYSBzaW5nbGUgaGFyZCBsaW5lIGJ5IHdvcmRzICh3aXRoIGxvbmctd29yZCBjaHVua2luZykKICBjb25zdCB3cmFwT25lID0gKHNyYykgPT4gewogICAgLy8gTm9ybWFsaXplIHRhYnMgLT4gc3BhY2VzOyBjb2xsYXBzZSBpbnRlcm5hbCB3aGl0ZXNwYWNlIChub3QgbmV3bGluZXMpCiAgICBjb25zdCBzID0gc3JjLnJlcGxhY2UoL1x0L2csICcgICAgJykucmVwbGFjZSgvXHMrL2csICcgJykudHJpbSgpOwogICAgaWYgKCFzLmxlbmd0aCkgeyBvdXQucHVzaCgnJyk7IHJldHVybjsgfQoKICAgIGNvbnN0IHdvcmRzID0gcy5zcGxpdCgnICcpOwogICAgbGV0IGxpbmUgPSAnJzsKCiAgICBjb25zdCBwdXNoTGluZSA9ICgpID0+IHsgb3V0LnB1c2gobGluZSk7IGxpbmUgPSAnJzsgfTsKCiAgICAvLyBjaHVuayBsb25nIHdvcmRzIHRvIGVtdWxhdGUgJ2JyZWFrV29yZHMnCiAgICBjb25zdCBjaHVua1dvcmQgPSAodykgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcubGVuZ3RoOyBpICs9IG1heENvbHMpIHsKICAgICAgICBjb25zdCBjaHVuayA9IHcuc2xpY2UoaSwgaSArIG1heENvbHMpOwogICAgICAgIGlmICghbGluZS5sZW5ndGgpIGxpbmUgPSBjaHVuazsKICAgICAgICBlbHNlIHsgcHVzaExpbmUoKTsgbGluZSA9IGNodW5rOyB9CiAgICAgIH0KICAgIH07CgogICAgZm9yIChjb25zdCB3IG9mIHdvcmRzKSB7CiAgICAgIGlmICh3Lmxlbmd0aCA+IG1heENvbHMpIHsKICAgICAgICBpZiAobGluZS5sZW5ndGgpIHB1c2hMaW5lKCk7CiAgICAgICAgY2h1bmtXb3JkKHcpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghbGluZS5sZW5ndGgpIHsKICAgICAgICBsaW5lID0gdzsKICAgICAgfSBlbHNlIGlmIChsaW5lLmxlbmd0aCArIDEgKyB3Lmxlbmd0aCA8PSBtYXhDb2xzKSB7CiAgICAgICAgbGluZSArPSAnICcgKyB3OwogICAgICB9IGVsc2UgewogICAgICAgIHB1c2hMaW5lKCk7CiAgICAgICAgbGluZSA9IHc7CiAgICAgIH0KICAgIH0KICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaExpbmUoKTsKICB9OwoKICBmb3IgKGNvbnN0IGhsIG9mIGhhcmRMaW5lcykgewogICAgd3JhcE9uZShobCk7ICAgICAgICAgICAvLyB3cmFwIHdpdGhpbiB0aGlzIGhhcmQgbGluZQogIH0KCiAgLy8gSWYgdGhlIGlucHV0IGVuZGVkIHdpdGggYSB0cmFpbGluZyBuZXdsaW5lLCB3ZSBhbHJlYWR5IHByZXNlcnZlZCBpdAogIC8vIGJlY2F1c2Ugc3BsaXQga2VwdCBhbiBlbXB0eSBsYXN0IGl0ZW0gLT4gYmVjYW1lIGFuIGVtcHR5IHdyYXBwZWQgbGluZS4KICByZXR1cm4gb3V0Lmxlbmd0aCA/IG91dCA6IFsnJ107Cn0KCi8vIC0tLSAyKSBTaW1wbGUgc2l6aW5nIGZyb20gbGluZXMgLS0tCi8vIFRoaW5rIG9mICJjb2xzUGVyU2NhbGVYIiBhcyAiYWJvdXQgTiBjaGFyYWN0ZXJzIHBlciAxIHNjYWxlWCIuCmZ1bmN0aW9uIGNvbXB1dGVTaW1wbGVTY2FsZXNGcm9tTGluZXMobGluZXMsIHsKICAgIGNvbHNQZXJTY2FsZVggPSAyLjUsCiAgICBtaW5TY2FsZVggPSAxLjI1LAogICAgbWF4U2NhbGVYID0gMTAsCiAgICBiYXNlU2NhbGVZID0gMS4yLAogICAgcGVyTGluZVkgPSAwLjc1LAp9ID0ge30pIHsKICAgIGNvbnN0IGxvbmdlc3QgPSBsaW5lcy5yZWR1Y2UoKG0sIGwpID0+IE1hdGgubWF4KG0sIGwubGVuZ3RoKSwgMCk7CiAgICBjb25zdCBsaW5lQ291bnQgPSBNYXRoLm1heCgxLCBsaW5lcy5sZW5ndGgpOwoKICAgIC8vIFdpZHRoIHNjYWxlcyB3aXRoIHRoZSBsb25nZXN0IGxpbmUgbGVuZ3RoCiAgICBsZXQgc2NhbGVYID0gbG9uZ2VzdCA+IDAgPyAobG9uZ2VzdCAvIGNvbHNQZXJTY2FsZVgpIDogbWluU2NhbGVYOwogICAgc2NhbGVYID0gTWF0aC5tYXgobWluU2NhbGVYLCBNYXRoLm1pbihtYXhTY2FsZVgsIHNjYWxlWCkpOwoKICAgIC8vIEhlaWdodCBncm93cyBwZXIgbGluZTsga2VlcCBpdCBzaW1wbGUgYW5kIHByZWRpY3RhYmxlCiAgICBjb25zdCBzY2FsZVkgPSBNYXRoLm1heChiYXNlU2NhbGVZLCBiYXNlU2NhbGVZICsgKGxpbmVDb3VudCAtIDEpICogcGVyTGluZVkpOwoKICAgIHJldHVybiB7IHNjYWxlWCwgc2NhbGVZLCBsb25nZXN0LCBsaW5lQ291bnQgfTsKfQoKCi8vIFBpY2sgeW91ciB0YXJnZXQgImNvbHVtbnMiIHBlciBsaW5lICh0d2VhayB0byB0YXN0ZSkKY29uc3QgTUFYX0NPTFMgPSAzMjsKCi8vIEJyZWFrIHRoZSB0ZXh0IHlvdXJzZWxmCmNvbnN0IGxpbmVzID0gcHJlc2VydmVOZXdMaW5lcyA/IGJyZWFrV29yZHNUb0xpbmVzUHJlc2VydmVOZXdsaW5lcyhsYWJlbCwgTUFYX0NPTFMpIDogYnJlYWtXb3Jkc1RvTGluZXMobGFiZWwsIE1BWF9DT0xTKTsKY29uc3Qgd3JhcHBlZExhYmVsID0gbGluZXMuam9pbignXG4nKTsKCi8vIENvbXB1dGUgc2ltcGxlIHNjYWxlcyBmcm9tIHRoZSB3cmFwcGVkIHRleHQKY29uc3QgeyBzY2FsZVgsIHNjYWxlWSB9ID0gY29tcHV0ZVNpbXBsZVNjYWxlc0Zyb21MaW5lcyhsaW5lcyk7CgpsZXQgbGFiZWxNb2QgPSB7CiAgICBzcGFjZTogc3BhY2UsCiAgICB0cmFja0JvdElkOiBib3QuaWQsCiAgICBmb3JtOiAnc3ByaXRlJywKICAgIGNvbG9yLAogICAgbGFiZWw6IHdyYXBwZWRMYWJlbCwKICAgIGxhYmVsQ29sb3IsCiAgICBsYWJlbFNpemU6IDEsCiAgICBsYWJlbFBhZGRpbmdYOiAwLjUsCiAgICBsYWJlbFdvcmRXcmFwTW9kZTogJ25vbmUnLAogICAgc2NhbGVYLCAKICAgIHNjYWxlWSwKICAgIHNjYWxlWjogMC4xLAogICAgYm90TGFiZWxNYXJnaW46IDEsCiAgICBhbmNob3JQb2ludDogJ+Keoe+4jzAsLTAuNSwwJywKICAgIG9yaWVudGF0aW9uTW9kZTogJ2JpbGxib2FyZCcsCiAgICBkaW1lbnNpb246IGRpbWVuc2lvbiwKICAgIGRlYnVnOiBmYWxzZSwKICAgIFtkaW1lbnNpb25dOiB0cnVlLAogICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgIG9uQ3JlYXRlOiBgQAogICAgICAgIC8vIFdhaXQgZm9yIHJlcXVpcmVkIGJvdHMgdG8gYmUgcmVhZHkuCiAgICAgICAgbGV0IHdhaXRUaW1lID0gMDsKCiAgICAgICAgd2hpbGUoIWdsb2JhbFRoaXMuYWIpIHsKICAgICAgICAgICAgaWYgKHdhaXRUaW1lID49IDUwMDApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXdhaXQgb3Muc2xlZXAoMjUwKTsKICAgICAgICAgICAgd2FpdFRpbWUgKz0gMjUwOwogICAgICAgIH0KCiAgICAgICAgdGFncy5yZWFkeSA9IHRydWU7CiAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgYCwKICAgIG9uQW55Qm90c0NoYW5nZWQ6IGBACiAgICAgICAgZm9yIChjb25zdCBjaGFuZ2VkIG9mIHRoYXQpIHsKICAgICAgICAgICAgaWYgKGNoYW5nZWQuYm90ICYmIGNoYW5nZWQuYm90LmlkID09PSB0YWdzLnRyYWNrQm90SWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9ubHlSb3RhdGlvblRhZ3MgPSBjaGFuZ2VkLnRhZ3MuZXZlcnkoKHQpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5lbmRzV2l0aCgnUm90YXRpb24nKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblgnKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblknKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblonKQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gb25seVJvdGF0aW9uVGFnczonLCBvbmx5Um90YXRpb25UYWdzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAob25seVJvdGF0aW9uVGFncykgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICBgLAogICAgb25BbnlCb3RzUmVtb3ZlZDogYEAKCiAgICAgICAgaWYgKHRoYXQuYm90SURzLmluY2x1ZGVzKHRhZ3MudHJhY2tCb3RJZCkpIHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICB9CiAgICBgLAogICAgb25Qb3J0YWxDaGFuZ2VkOiBgQAogICAgICAgIGlmICh0aGF0LmRpbWVuc2lvbiA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgICAgIH0KICAgIGAsCiAgICB1cGRhdGVMYWJlbDogYEAKICAgICAgICBpZiAoIXRhZ3MucmVhZHkpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmluZyB1cGRhdGVMYWJlbCBiZWNhdXNlIG5vdCByZWFkeScpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaGFzTGFiZWwgPSB0YWdzLmxhYmVsICE9IG51bGwgJiYgdGFncy5sYWJlbCAhPT0gJyc7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBoYXNMYWJlbDsKCiAgICAgICAgaWYgKCFoYXNMYWJlbCkgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmUgdXBkYXRlTGFiZWwgY2FsbCwgdGhlcmUgaXMgbm8gbGFiZWwgdGFnIHZhbHVlIHRvIGRpc3BsYXkuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGluTWFwUG9ydGFsID0gKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGNvbnN0IGluR3JpZFBvcnRhbCA9IChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAoIWluTWFwUG9ydGFsICYmICFpbkdyaWRQb3J0YWwpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JlIHVwZGF0ZUxhYmVsIGNhbGwsIG5vdCBpbiBlaXRoZXIgZ3JpZCBvciBtYXAgcG9ydGFsLicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHRyYWNrQm90ID0gZ2V0Qm90KCdpZCcsIHRhZ3MudHJhY2tCb3RJZCk7CiAgICAgICAgY29uc3QgdHJhY2tQb3NpdGlvbiA9IGdldEJvdFBvc2l0aW9uKHRyYWNrQm90LCB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gdHJhY2tQb3NpdGlvbjonLCB0cmFja1Bvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGxldCBsYWJlbFBvc2l0aW9uID0geyB4OiB0cmFja1Bvc2l0aW9uLngsIHk6IHRyYWNrUG9zaXRpb24ueSwgejogdHJhY2tQb3NpdGlvbi56IH07IAoKICAgICAgICBjb25zdCB0cmFja0JvdFNjYWxlID0gdHJhY2tCb3QudGFncy5zY2FsZSA/PyAxOwogICAgICAgIGNvbnN0IHRyYWNrQm90U2NhbGVaID0gdHJhY2tCb3QudGFncy5zY2FsZVogPz8gMTsKCiAgICAgICAgbGV0IG1ldGVyc1BlckdyaWRVbml0ID0gMTsKCiAgICAgICAgaWYgKGluTWFwUG9ydGFsKSB7CiAgICAgICAgICAgIC8vIFNjYWxlIHRvIG1hcCBwb3J0YWwgdW5pdHMuCiAgICAgICAgICAgIG1ldGVyc1BlckdyaWRVbml0ID0gMTA7CiAgICAgICAgfQoKICAgICAgICBsZXQgdHJhY2tCb3RSZWFsU2NhbGVaID0gKHRyYWNrQm90U2NhbGVaICogdHJhY2tCb3RTY2FsZSkgKiBtZXRlcnNQZXJHcmlkVW5pdDsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSB0cmFja0JvdFJlYWxTY2FsZVo6JywgdHJhY2tCb3RSZWFsU2NhbGVaKTsKICAgICAgICB9CgogICAgICAgIGxhYmVsUG9zaXRpb24ueiArPSB0cmFja0JvdFJlYWxTY2FsZVogKyAodGFncy5ib3RMYWJlbE1hcmdpbiAqIG1ldGVyc1BlckdyaWRVbml0KTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBsYWJlbFBvc2l0aW9uOicsIGxhYmVsUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdYJ10gPSBsYWJlbFBvc2l0aW9uLng7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdZJ10gPSBsYWJlbFBvc2l0aW9uLnk7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdaJ10gPSBsYWJlbFBvc2l0aW9uLno7CiAgICBgCn07CgpsYWJlbE1vZCA9IHsKICAgIC4uLmxhYmVsTW9kLAogICAgLi4ucmVzdCwKfQoKY29uc3QgbGFiZWxCb3QgPSBjcmVhdGUobGFiZWxNb2QpOwoKcmV0dXJuIGxhYmVsQm90OycAx/e3PoC/AwV1dGlscwIEAMf3tz64tQQo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAx/e3PoC/AwRmb3JtAgQAx/e3Pt+1BAdub3RoaW5nJwDH97c+gL8DCWFiVmVyc2lvbgIEAMf3tz7ntQQFMTAuMzUA"}]}