{"version":2,"updates":[{"id":0,"timestamp":1757474509650,"update":"AewB4e/lhgkAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwDh7+WGCQAKYWJJRE9yaWdpbgIEAOHv5YYJAQ10b29sYm94X3NraWxsJwDh7+WGCQALYWJJbnRlcmZhY2UCBADh7+WGCQ8EdHJ1ZScA4e/lhgkAC2Rlc2NyaXB0aW9uAgQA4e/lhgkUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwDh7+WGCQAEZm9ybQIEAOHv5YYJPgdub3RoaW5nJwDh7+WGCQAEbWVudQIEAOHv5YYJRijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwDh7+WGCQAGc3lzdGVtAgQA4e/lhgltFGFiLmludGVyZmFjZS50b29sYm94JwDh7+WGCQAKYWJJRFN0dWRpbwIEAOHv5YYJggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwDh7+WGCQAIcmVtZW1iZXICBADh7+WGCacBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAOHv5YYJAAt0b29sYm94X2FkZAIEAOHv5YYJzgHlC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgiYmFzZVNraWxsIiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIG1lbnVCb3Qub25Qb2ludGVyVXAoKTsKICAgICAgICBhd2FpdCBvcy5zbGVlcCgyMDApOwogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScA4e/lhgkABWxlYXJuAgQA4e/lhgm0DSjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDh7+WGCQAFc3RvcmUCBADh7+WGCdsNKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAOHv5YYJAAZzZWFyY2gCBADh7+WGCYIOKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAOHv5YYJAAhhYklnbm9yZQIEAOHv5YYJqQ4EdHJ1ZScA4e/lhgkACWFiVmVyc2lvbgIEAOHv5YYJrg4EMTAuOScA4e/lhgkADW1hbmlmZXN0YXRpb24CBADh7+WGCbMOKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAOHv5YYJABBhYkdyaWRNZW51QWN0aW9uAgQA4e/lhgnaDrkLQC8vIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgovLyBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKLy8gdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACi8vICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwovLyAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7Ci8vIGA7Ci8vIHRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKLy8gICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7Ci8vICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKLy8gICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKLy8gICAgIH0KLy8gYDsKLy8gdGhpc0JvdC5tYXNrcy5hYk1lbnVSZWZyZXNoID0gYEAKLy8gICAgIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwovLyAgICAgdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBudWxsOwovLyAgICAgdGhpc0JvdC5tYXNrcy5hYk1lbnVSZWZyZXNoID0gbnVsbDsKLy8gYDsKCi8vIGNvbnN0IHBvc3NpYmxlVG9vbGJveGVzID0gbGlua3MucmVtZW1iZXIudGFncy50b29sYm94X2FycmF5OwovLyBjb25zdCBtZW51Qm90ID0ge307CgovLyBtZW51Qm90LmFiTWVudSA9IHRydWU7Ci8vIG1lbnVCb3QuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKLy8gbWVudUJvdC5ncmlkRGF0YSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7Ci8vIG1lbnVCb3QubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7Ci8vIG1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiYWRkX2JveCI7Ci8vIG1lbnVCb3QubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKLy8gbWVudUJvdC5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7CgovLyBmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlVG9vbGJveGVzLmxlbmd0aDsgaSsrKQovLyB7Ci8vICAgICBjb25zdCBhY3RpdmVUb29sYm94ID0gcG9zc2libGVUb29sYm94ZXNbaV07Ci8vICAgICBjb25zdCBleHRhbnRCb3QgPSBhY3RpdmVUb29sYm94LnN0dWRpbyA/IGdldEJvdCgiYWJJRE9yaWdpbiIsIGFjdGl2ZVRvb2xib3gubmFtZSk6IGdldEJvdChhY3RpdmVUb29sYm94Lm5hbWUsIHRydWUpOwoKLy8gICAgIG1lbnVCb3QudG9vbGJveF9kYXRhID0gYWN0aXZlVG9vbGJveDsKLy8gICAgIG1lbnVCb3QubGFiZWwgPSBhY3RpdmVUb29sYm94LnRpdGxlID8/IGFjdGl2ZVRvb2xib3gubmFtZTsKCi8vICAgICBpZiAoIWV4dGFudEJvdCkKLy8gICAgIHsKLy8gICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51Qm90KTsKLy8gICAgIH0KLy8gfScA4e/lhgkAFGFiR3JpZE1lbnVPbkdlbmVyYXRlAgQA4e/lhgmUGuICQGNvbnN0IHRvb2xib3hBcnJheSA9IGFiUmVtZW1iZXIudGFncy50b29sYm94X2FycmF5OwoKbGV0IGFsbFRvb2xzTG9hZGVkID0gdHJ1ZTsKCmZvciAobGV0IGkgPSAwOyBpIDwgdG9vbGJveEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBjdXJyZW50VG9vbCA9IHRvb2xib3hBcnJheVtpXS5uYW1lOwoKICAgIGlmICghZ2V0Qm90KCJhYklET3JpZ2luIiwgY3VycmVudFRvb2wpICYmICFnZXRCb3QoY3VycmVudFRvb2wsIHRydWUpKSB7CiAgICAgICAgYWxsVG9vbHNMb2FkZWQgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgIH0KfQoKaWYgKGFsbFRvb2xzTG9hZGVkKSB7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwDh7+WGCQAOYWJHcmlkTWVudUljb24CBADh7+WGCfccCmxvY2FsX21hbGwnAOHv5YYJAA9hYkdyaWRNZW51TGFiZWwCBADh7+WGCYIdDmNhc3VhbCBjYXRhbG9nJwDh7+WGCQATYWJHcmlkTWVudVNvcnRPcmRlcgIEAOHv5YYJkR0BMycA4e/lhgkAD29uQUJJbml0aWFsaXplZAIEAOHv5YYJkx0qQC8vIGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7JwDh7+WGCQANb25Ta2lsbFVwZGF0ZQIEAOHv5YYJvh1XQGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7DQoNCmNvbnNvbGUubG9nKCJbVG9vbGJveF0gTG9hZGluZyBjYXN1YWwga2l0Iik7JwDh7+WGCQAKc2hlbGxVdGlscwIEAOHv5YYJlh4o8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycA4e/lhgkAGGFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZQIEAOHv5YYJvR78CEBpZiAoYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkNhdGFsb2dOYW1lKSB7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJHcmlkTWVudUxhYmVsIiwgYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkNhdGFsb2dOYW1lKTsNCn0NCg0KDQovL05FVw0KY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IHBvc3NpYmxlVG9vbGJveGVzID0gbGlua3MucmVtZW1iZXIudGFncy50b29sYm94X2FycmF5Ow0KDQpmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlVG9vbGJveGVzLmxlbmd0aDsgaSsrKQ0Kew0KICAgIGNvbnN0IG1lbnVCb3QgPSB7fTsNCg0KICAgIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsNCiAgICBtZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQogICAgbWVudUJvdC5ncmlkRGF0YSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQogICAgbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsNCiAgICBtZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOw0KICAgIG1lbnVCb3QubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsNCiAgICBtZW51Qm90Lm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsNCiAgICANCiAgICBjb25zdCBhY3RpdmVUb29sYm94ID0gcG9zc2libGVUb29sYm94ZXNbaV07DQogICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsNCg0KICAgIG1lbnVCb3QudG9vbGJveF9kYXRhID0gYWN0aXZlVG9vbGJveDsNCiAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7DQoNCiAgICBpZiAoIWV4dGFudEJvdCkNCiAgICB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKG1lbnVCb3QpOw0KICAgIH0NCn0NCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwDh7+WGCQASYWJHcmlkTWVudUl0ZW1UeXBlAgQA4e/lhgm6Jwhkcm9wZG93bicA4e/lhgkAEWRyb3Bkb3duU29ydE9yZGVyAgQA4e/lhgnDJwEzJwDh7+WGCQAPZHJvcGRvd25PcHRpb25zAgQA4e/lhgnFJwbwn6esW10nAQRib3RzJDE3NDEwZDgzLTdlZWUtNGExZS1iNjM4LTY1NDYzNzRkMTdjMwEnAOHv5YYJyicGc3lzdGVtAgQA4e/lhgnLJxFhYi5pbnRlcmZhY2Uuc2NhbicA4e/lhgnKJwRmb3JtAgQA4e/lhgndJwdub3RoaW5nJwDh7+WGCconC2FiSW50ZXJmYWNlAgQA4e/lhgnlJwR0cnVlJwDh7+WGCconCGFiSWdub3JlAgQA4e/lhgnqJwR0cnVlJwDh7+WGCconD29uUVJDb2RlU2Nhbm5lZAIEAOHv5YYJ7yeADkBpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBzY2FubmVkICIgKyB0aGF0KTsKCmlmIChjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbikKewogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGlua3Muc3RvcmUuYWJRUlB1Ymxpc2godGhhdCk7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuKQp7CiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICBjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4gPSBudWxsOwoKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIHRyeQogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CgogICAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IHBoQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoInBoIik7CiAgICBsZXQgaW5zdENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJpbnN0Iik7CiAgICBsZXQgYWJDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiYWIiKTsKICAgIGxldCBjd0NoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJjdyIpOwoKICAgIGlmIChwaENoZWNrICYmIGluc3RDaGVjayAmJiBhYkNoZWNrICYmIGN3Q2hlY2spCiAgICB7CiAgICAgICAgb3MuZ29Ub1VSTCh0aGF0KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBvcy50b2FzdCgibm90IGEgcmVjb2duaXplZCBwcmFjdGljZSBwZXJtaXQiKTsKICAgIH0KCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLmFiU2NhbikKewogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBjb25maWdCb3QudGFncy5hYlNjYW4gPSBudWxsOwogICAgCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICB0cnkgCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7CiAgICB9CiAgICBjYXRjaCAoZSkgCiAgICB7CiAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiB0aGF0fSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZihzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFzayIpID09ICJlZ2dDYXJ0b24iKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4gewogICAgICAgICAgICBsZXQgbmV3VGFnID0ga2V5OwogICAgICAgICAgICBsZXQgbmV3VmFsdWUgPSB2YWx1ZTsKCiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzW25ld1RhZ10gPSBuZXdWYWx1ZTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmFzaykgewogICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLmFza30pOwogICAgICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucGF0dGVybikgewogICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm59KTsKICAgICAgICB9CiAgICAgICAgCiAgICB9Cn0nAOHv5YYJyicFc3RvcmUCBADh7+WGCfA1KPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAOHv5YYJyicGc2VhcmNoAgQA4e/lhgmXNijwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwDh7+WGCconEGFiQ29yZU1lbnVBY3Rpb24CBADh7+WGCb42N0Bvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwoKY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gdHJ1ZTsnAOHv5YYJyicPYWJDb3JlTWVudUxhYmVsAgQA4e/lhgn2NgRzY2FuJwDh7+WGCconDmFiQ29yZU1lbnVJY29uAgQA4e/lhgn7Ng9xcl9jb2RlX3NjYW5uZXInAOHv5YYJyicTYWJDb3JlTWVudVNvcnRPcmRlcgIEAOHv5YYJizcBMycA4e/lhgnKJwlhYlZlcnNpb24CBADh7+WGCY03BDEwLjknAQRib3RzJDNhNmNiOWNhLWIzYjQtNGQ3Ny04MmY2LWZhNTliNTI5NmVjOQEnAOHv5YYJkjcGc3lzdGVtAgQA4e/lhgmTNxdhYi5pbnRlcmZhY2UubmF2aWdhdGlvbicA4e/lhgmSNwhhYklnbm9yZQIEAOHv5YYJqzcEdHJ1ZScA4e/lhgmSNw9kcm9wZG93bk9wdGlvbnMCBADh7+WGCbA3BvCfp6xbXScA4e/lhgmSNxJhYkNvcmVNZW51SXRlbVR5cGUCBADh7+WGCbU3CGRyb3Bkb3duJwDh7+WGCZI3EWRyb3Bkb3duU29ydE9yZGVyAgQA4e/lhgm+NwRhdXRvJwDh7+WGCZI3GGFiQ29yZU1lbnVPbkJlZm9yZUNyZWF0ZQIEAOHv5YYJwzeqG0Bjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgY3VycmVudERpbSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247DQpjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KDQovLyBpZiAoY3VycmVudFBvcnRhbCAhPSAnbWFwJykgew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KLy8gfSBlbHNlIHsNCi8vICAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQovLyB9DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk5hdmlnYXRpb25NZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy5za2lsbEJvdCA9IGdldExpbmsodGhpc0JvdCk7DQoNCmNvbnN0IGhvbWVXb3JsZEJ1dHRvbiA9IHsNCiAgICAuLi5tZW51T3B0aW9ucywNCiAgICBsYWJlbDogImhvbWUgd29ybGQiLA0KICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1LzM4YWU4YjY5NTdmNDQ4M2Q4NzE2MTQxZDFlOThjOTNmMGU3ZGNjZTE1YmM1YzEyM2JkMGU5ZTFhYjY4N2NjMDUucG5nJywNCiAgICBvbkNsaWNrOiBgQA0KICAgICAgICBjb25zdCBwZXJtYWxpbmtVUkwgPSBjb25maWdCb3QudGFncy5wZXJtYWxpbms7DQogICAgICAgIGNvbnN0IGZpcnN0SW5kZXggPSBwZXJtYWxpbmtVUkwuaW5kZXhPZigiJiIpOw0KICAgICAgICBjb25zdCBpbml0aWFsVVJMID0gcGVybWFsaW5rVVJMLnN1YnN0cmluZygwLCBmaXJzdEluZGV4KTsNCg0KICAgICAgICBvcy5vcGVuVVJMKGluaXRpYWxVUkwgKyAiJmFzaz1ob21lIiArICImYmlvcz1sb2NhbCIpOw0KICAgIGANCn07DQoNCmlmICghZ2V0Qm90KCJpc0hvbWVXb3JsZENvcmUiLCB0cnVlKSAmJiBhdXRoQm90KSB7DQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZVdvcmxkQnV0dG9uKTsNCn0NCg0KaWYgKGN1cnJlbnRQb3J0YWwgPT0gJ21hcCcpIHsNCg0KICAgIGNvbnN0IGhvbWVCYXNlQm90ID0gZ2V0Qm90KCJob21lQmFzZSIsIHRydWUpOw0KDQogICAgaWYgKGhvbWVCYXNlQm90KSB7DQogICAgICAgIGNvbnN0IGhvbWVCdXR0b24gPSB7DQogICAgICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgICAgIGxhYmVsOiBob21lQmFzZUJvdC50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2h0dHBzOi8vYXV0aC1hdXgtZGV2LWZpbGVzYnVja2V0LTY4MjM5NzY5MDY2MC5zMy5hbWF6b25hd3MuY29tLzMxOGMwNGYxLTEzOTEtNGMxMC04ZDQzLWFhZWJjNTE3MDI2NS9jZDM4YWZmYzA2MDRiZWFhNTg4ZGEyMWFhMWJlNzUwYmIzZTczYjNiM2NhZTIzZWIzMDMwN2MzNDQ5NDQ1OWYzLnBuZycsDQogICAgICAgICAgICBvbkNsaWNrOiBgQGNvbnN0IGhvbWVCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQogICAgICAgICAgICBpZiAoaG9tZUJvdCkgew0KICAgICAgICAgICAgICAgIG9zLmZvY3VzT24oaG9tZUJvdCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgYA0KICAgICAgICB9Ow0KDQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGhvbWVCdXR0b24pOw0KICAgIH0NCg0KICAgIGNvbnN0IHBsYWNlc0FyciA9IFtdOw0KICAgIGNvbnN0IHBsYWNlcyA9IGdldEJvdHMoImhvbWVQbGFjZSIsIHRydWUpOw0KICAgIGZvciAoY29uc3QgaFBsYWNlIG9mIHBsYWNlcykgew0KICAgICAgICBpZiAoaFBsYWNlLnRhZ3MuaG9tZUJhc2UgPT0gdHJ1ZSkgew0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgcGxhY2VPYmogPSB7DQogICAgICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgICAgIGxhYmVsOiBoUGxhY2UudGFncy5wbGFjZUxhYmVsLA0KICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdsb2NhdGlvbl9vbicsDQogICAgICAgICAgICBwbGFjZTogZ2V0TGluayhoUGxhY2UpLA0KICAgICAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgICAgICBpZiAobGlua3MucGxhY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgb3MuZm9jdXNPbihsaW5rcy5wbGFjZSkuY2F0Y2goZSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICAgICAgYA0KICAgICAgICB9DQoNCiAgICAgICAgcGxhY2VzQXJyLnB1c2gocGxhY2VPYmopOw0KICAgIH0NCg0KICAgIHBsYWNlc0Fyci5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgIGNvbnN0IG5hbWVBID0gYS5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KICAgICAgICBjb25zdCBuYW1lQiA9IGIubGFiZWwudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMDsNCiAgICB9KTsNCg0KICAgIGZvciAoY29uc3Qgc29ydGVkUGxhY2Ugb2YgcGxhY2VzQXJyKSB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHNvcnRlZFBsYWNlKTsNCiAgICB9DQoNCg0KICAgIGNvbnN0IGN1cnJlbnRMb2NhdGlvbkJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiAnY3VycmVudCBsb2NhdGlvbicsDQogICAgICAgIGZvcm1BZGRyZXNzOiAnbmVhcl9tZScsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5za2lsbEJvdC5nb1RvQ3VycmVudExvY2F0aW9uKCk7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goY3VycmVudExvY2F0aW9uQnV0dG9uKTsNCn0NCg0KaWYgKGRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPT0gMCkgew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KfSBlbHNlIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycA4e/lhgmSNxBhYkNvcmVNZW51QWN0aW9uAgQA4e/lhgnuUgNALy8nAOHv5YYJkjcLYWJJbnRlcmZhY2UCBADh7+WGCfJSBHRydWUnAOHv5YYJkjcPYWJDb3JlTWVudUxhYmVsAgQA4e/lhgn3UglwbGFjZSBuYXYnAOHv5YYJkjcEZm9ybQIEAOHv5YYJgVMHbm90aGluZycA4e/lhgmSNxNnb1RvQ3VycmVudExvY2F0aW9uAgQA4e/lhgmJU9kEQGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgb3MuZ2V0R2VvbG9jYXRpb24oKTsNCg0KaWYgKGxvY2F0aW9uLnN1Y2Nlc3MpIHsNCiAgICBjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCiAgICBjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCg0KICAgIGlmIChjdXJyZW50UG9ydGFsID09ICdtYXAnKSB7DQogICAgICAgIG9zLmZvY3VzT24oe3g6IGxvY2F0aW9uLmxvbmdpdHVkZSwgeTogbG9jYXRpb24ubGF0aXR1ZGV9LCB7cG9ydGFsOiAnbWFwJ30pOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IGN1cnJlbnREaW07DQogICAgICAgIG9zLmZvY3VzT24oe3g6IGxvY2F0aW9uLmxvbmdpdHVkZSwgeTogbG9jYXRpb24ubGF0aXR1ZGV9LCB7cG9ydGFsOiAnbWFwJ30pOw0KICAgIH0NCn0gZWxzZSB7DQogICAgb3MudG9hc3QoIkxvY2F0aW9uIHNlcnZpY2VzIG5vdCBhdmFpbGFibGUiKQ0KfScA4e/lhgmSNwlhYlZlcnNpb24CBADh7+WGCeNXBDEwLjknAQRib3RzJDQ5M2ZmYTRkLTQ2ZDQtNGE5OC1hZTljLTEyMTJkNjUxMTMzZgEnAOHv5YYJ6FcGc3lzdGVtAgQA4e/lhgnpVxRhYi5pbnRlcmZhY2UudmVyc2lvbicA4e/lhgnoVw1vblNraWxsVXBkYXRlAgQA4e/lhgn+V6cBQGNvbnN0IHZlcnNpb25TdHJpbmcgPSB0YWdzLmFiSW50ZXJmYWNlTWFqb3JWZXJzaW9uICsgIi4iICsgdGFncy5hYkludGVyZmFjZU1pbm9yVmVyc2lvbjsNCg0KY29uc29sZS5sb2coIltBQkludGVyZmFjZV0gTG9hZGVkIEFCIEludGVyZmFjZSB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAOHv5YYJ6FcXYWJJbnRlcmZhY2VNYWpvclZlcnNpb24CBADh7+WGCaZZATInAOHv5YYJ6FcXYWJJbnRlcmZhY2VNaW5vclZlcnNpb24CBADh7+WGCahZATMnAOHv5YYJ6FcIYWJJZ25vcmUCBADh7+WGCapZBHRydWUnAOHv5YYJ6FcEZm9ybQIEAOHv5YYJr1kHbm90aGluZycA4e/lhgnoVwthYkludGVyZmFjZQIEAOHv5YYJt1kEdHJ1ZScA4e/lhgnoVwlhYlZlcnNpb24CBADh7+WGCbxZBDEwLjknAQRib3RzJDRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZgEnAOHv5YYJwVkGc3lzdGVtAgQA4e/lhgnCWRNhYi5pbnRlcmZhY2UubnVnZ2V0JwDh7+WGCcFZBGZvcm0CBADh7+WGCdZZB25vdGhpbmcnAOHv5YYJwVkLYWJJbnRlcmZhY2UCBADh7+WGCd5ZBHRydWUnAOHv5YYJwVkIYWJJZ25vcmUCBADh7+WGCeNZBHRydWUnAOHv5YYJwVkMYWJMb2FkTnVnZ2V0AgQA4e/lhgnoWZgCQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXROYW1lOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrbnVnZ2V0TmFtZTsKbGV0IGxvYWRlZE51Z2dldCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogZm9ybWF0dGVkTnVnZ2V0QUIsIGFiVmVyc2lvbjogdGhhdC52ZXJzaW9uLCByZXR1cm5UeXBlOiAiZGF0YSJ9KTsKCmxvYWRlZE51Z2dldCA9IGxvYWRlZE51Z2dldC5zdGF0ZVtudWdnZXROYW1lXS5udWdnZXQ7CgpyZXR1cm4gbG9hZGVkTnVnZ2V0OycA4e/lhgnBWQ9hYlB1Ymxpc2hOdWdnZXQCBADh7+WGCYFcjANALy9zaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogIm51Z05hbWUiLCBkYXRhOiBkYXRhfSk7ICBBREQgRUdHIElEIEVWRU5UVUFMTFkKbGV0IHRlc3ROdWdnZXQgPSB0aGF0LmRhdGE7CmxldCBmb3JtYXR0ZWROdWdnZXQgPSB7aWQ6IHRoYXQubnVnLCBudWdnZXQ6IHRlc3ROdWdnZXR9OwpsZXQgdGVzdE51Z2dldE5hbWUgPSB0aGF0Lm51ZzsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK3Rlc3ROdWdnZXROYW1lOwoKbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gZm9ybWF0dGVkTnVnZ2V0QUI7CgpsaW5rcy5zdG9yZS5hYlB1Ymxpc2hBQih7YWI6IGZvcm1hdHRlZE51Z2dldEFCLCB0YXJnZXQ6IGZvcm1hdHRlZE51Z2dldCwgc291cmNlRXZlbnQ6ICdwdWJsaXNoX251Z2dldCd9KTsnAOHv5YYJwVkPaW1wbGVtZW50TnVnZ2V0AgQA4e/lhgmOX7EHQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXQ7CmxldCBudWdnZXRWZXJzaW9uQ2hlY2sgPSBudWdnZXROYW1lLmluZGV4T2YoIi52Iik7CmxldCB2ZXJzaW9uOwoKaWYgKG51Z2dldFZlcnNpb25DaGVjayAhPSAtMSkKewogICAgbnVnZ2V0TmFtZSA9IG51Z2dldE5hbWUuc3Vic3RyaW5nKDAsIG51Z2dldFZlcnNpb25DaGVjayk7CgogICAgbGV0IHZlcnNpb25DaGVjayA9IHRoYXQubnVnZ2V0LnN1YnN0cmluZyhudWdnZXRWZXJzaW9uQ2hlY2sgKyAyKTsKCiAgICBpZiAoaXNOYU4odmVyc2lvbkNoZWNrKSkKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyh2ZXJzaW9uQ2hlY2ssICJ2ZXJzaW9uIGlzIG5vdCBhIG51bWJlciIpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHZlcnNpb24gPSBOdW1iZXIodmVyc2lvbkNoZWNrKTsKICAgIH0KfQpjb25zb2xlLmxvZyhudWdnZXROYW1lLCB2ZXJzaW9uKTsKbGV0IG51Z0RhdGEgPSBhd2FpdCB0aGlzQm90LmFiTG9hZE51Z2dldCh7bnVnZ2V0TmFtZTogbnVnZ2V0TmFtZSwgdmVyc2lvbjogdmVyc2lvbn0pOwoKaWYgKG51Z0RhdGEgPT0gImFiSUQgbm90IGZvdW5kIikKewogICAgb3MudG9hc3QoIm51Z2dldCBub3QgZm91bmQiKTsKfQplbHNlCnsKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwogICAgbGV0IHRhcmdldFRhZyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLnRvU3RyaW5nKCk7CiAgICBsZXQgdGFyZ2V0TnVnID0gInsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldFRhZy5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwogICAgaW5zZXJ0VGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIG51Z0RhdGEpOwp9JwDh7+WGCcFZDG51Z2dldEJ1dHRvbgIEAOHv5YYJwGb1DEBsZXQgdGFnVmFsdWUgPSB0aGF0LnRhZ1ZhbHVlOwpsZXQgcmVnZXggPSAvXG4vZ2k7CmxldCBicmVha0NoZWNrOwpsZXQgYnJlYWtBcnJheSA9IFswXTsKLy9sZXQgY3JlYXRlZEJ1dHRvbnMgPSBbXTsKCndoaWxlIChicmVha0NoZWNrID0gcmVnZXguZXhlYyh0YWdWYWx1ZSkpCnsKICAgIGJyZWFrQXJyYXkucHVzaChicmVha0NoZWNrLmluZGV4KTsKfQoKbGV0IG5ld051Z2dldEJ1dHRvbiA9IHt9OwoKbmV3TnVnZ2V0QnV0dG9uLnNwYWNlID0gInRlbXBMb2NhbCI7Cm5ld051Z2dldEJ1dHRvbi5mb3JtID0gImNvZGVCdXR0b24iOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0Qm90ID0gdGhhdC5ib3QuaWQ7Cm5ld051Z2dldEJ1dHRvbi50YXJnZXRUYWcgPSB0aGF0LnRhZzsKbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgbnVnZ2V0IjsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldFJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpuZXdOdWdnZXRCdXR0b25bdGhhdC5ib3QuaWQgKyAiLiIgKyB0aGF0LnRhZ10gPSB0cnVlOwpuZXdOdWdnZXRCdXR0b24ubnVnZ2V0TWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7Cm5ld051Z2dldEJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubnVnZ2V0TWFuYWdlci5pbXBsZW1lbnROdWdnZXQoe2JvdDogdGFncy50YXJnZXRCb3QsIG51Z2dldDogdGFncy50YXJnZXROdWdnZXQsIHRhZzogdGFncy50YXJnZXRUYWd9KTsKCmRlc3Ryb3kodGhpc0JvdCk7YDsKCmZvciAobGV0IG51Z3MgPSAwOyBudWdzIDwgdGhhdC5udWdnZXQubGVuZ3RoOyBudWdzKyspCnsKICAgIGxldCBjdXJyZW50TnVnZ2V0ID0gdGhhdC5udWdnZXRbbnVnc107CiAgICAvL2xldCBidXR0b25DaGVjayA9IGNyZWF0ZWRCdXR0b25zLmluZGV4T2YoY3VycmVudE51Z2dldC5udWdOYW1lKTsKCiAgICBpZiAoIWN1cnJlbnROdWdnZXQgfHwgY3VycmVudE51Z2dldCA9PSB1bmRlZmluZWQpIC8vfHwgYnV0dG9uQ2hlY2sgIT0gLTEKICAgIHsKICAgICAgICBjb250aW51ZTsKICAgIH0KCiAgICBpZiAoY3VycmVudE51Z2dldC5udWdQdWJsaXNoKQogICAgewogICAgICAgIG5ld051Z2dldEJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubnVnZ2V0TWFuYWdlci5wYWNrYWdlTnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgogICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7YDsKCiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAibG9hZCAiICsgY3VycmVudE51Z2dldC5udWdOYW1lICsgIiBudWdnZXQiOwogICAgfQoKICAgIG5ld051Z2dldEJ1dHRvbi50YXJnZXROdWdnZXQgPSBjdXJyZW50TnVnZ2V0Lm51Z05hbWU7CiAgICBuZXdOdWdnZXRCdXR0b25bdGhhdC5ib3QuaWQgKyAiLiIgKyB0aGF0LnRhZyArICJTdGFydCJdID0gY3VycmVudE51Z2dldC5udWdTdGFydDsKCiAgICBjcmVhdGUobmV3TnVnZ2V0QnV0dG9uKTsKCiAgICAvL2NyZWF0ZWRCdXR0b25zLnB1c2goY3VycmVudE51Z2dldC5udWdOYW1lKTsKfQoKcmV0dXJuOycA4e/lhgnBWQtudWdnZXRQYXJzZQIEAOHv5YYJtHOnD0Bjb25zdCBvcmlnaW5hbFRhZ1ZhbHVlID0gdGhhdC5lZGl0ZWRCb3QucmF3W3RoYXQuZWRpdGVkVGFnXTsKbGV0IHRhZ1ZhbHVlID0gb3JpZ2luYWxUYWdWYWx1ZTsKCmlmICghdGFnVmFsdWUpIAp7CiAgICByZXR1cm47Cn0KZWxzZSBpZiAodHlwZW9mIHRhZ1ZhbHVlICE9PSAic3RyaW5nIikgCnsKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUudG9TdHJpbmcoKTsKfQoKbGV0IGluaXRpYWxQb3NzaWJsZU51Z1BvcyA9IDA7CgppZiAoaW5pdGlhbFBvc3NpYmxlTnVnUG9zID09IC0xKSAKewogICAgcmV0dXJuOwp9CmVsc2UKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbFBvc3NpYmxlTnVnUG9zKTsKfQoKbGV0IHBvc3NpYmxlTnVncyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW157XS9nLCAiIikubGVuZ3RoOwpsZXQgdG90YWxOdWdCcmVha3MgPSBvcmlnaW5hbFRhZ1ZhbHVlLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CmxldCBicmVha0xldmVsID0gMDsKbGV0IG51Z3NUb0NoZWNrID0gW107Cgpmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlTnVnczsgaSsrKQp7CiAgICBsZXQgaW5pdGlhbE51Z1BvcyA9IHRhZ1ZhbHVlLmluZGV4T2YoInsiKSArIDE7CiAgICBsZXQgcG9zc2libGVOdWdFbmQgPSB0YWdWYWx1ZS5pbmRleE9mKCJ9Iik7CiAgICBsZXQgcG9zc2libGVOdWcgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcywgcG9zc2libGVOdWdFbmQpOwoKICAgIGlmIChwb3NzaWJsZU51Zy5pbmRleE9mKCIgIikgPT0gLTEgJiYgL1xuL2cudGVzdChwb3NzaWJsZU51ZykgIT0gdHJ1ZSAmJiBwb3NzaWJsZU51Zy5sZW5ndGggPiAwICYmIHBvc3NpYmxlTnVnLmluZGV4T2YoIjoiKSA9PSAtMSkKICAgIHsKICAgICAgICBsZXQgbnVnQnJlYWtzID0gdGFnVmFsdWUuc3Vic3RyaW5nKDAsIHRhZ1ZhbHVlLmluZGV4T2YoInsiK3Bvc3NpYmxlTnVnKyJ9IikpLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CiAgICAgICAgbGV0IHB1Ymxpc2hDaGVjayA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zIC0gNiwgaW5pdGlhbE51Z1BvcyAtIDIpOwogICAgICAgIGxldCBudWdQdWJsaXNoID0gbnVsbDsKCiAgICAgICAgaWYgKHB1Ymxpc2hDaGVjayA9PSAiLm51ZyIpCiAgICAgICAgewogICAgICAgICAgICBudWdQdWJsaXNoID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJyZWFrTGV2ZWwgKz0gbnVnQnJlYWtzOwoKICAgICAgICBudWdCcmVha3MgPSB0b3RhbE51Z0JyZWFrcyAtICh0b3RhbE51Z0JyZWFrcyAtIGJyZWFrTGV2ZWwpOwogICAgICAgIAogICAgICAgIC8vQ0hFQ0sgSUYgJCBiZWZvcmUgbnVnZ2V0CiAgICAgICAgaWYgKHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zIC0gMiwgaW5pdGlhbE51Z1BvcyAtIDEpICE9ICIkIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z3NUb0NoZWNrLnB1c2goe251Z05hbWU6IHBvc3NpYmxlTnVnLCBudWdTdGFydDogbnVnQnJlYWtzICsgMSwgbnVnUHVibGlzaDogbnVnUHVibGlzaH0pOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBsZXQgbnVnQnJlYWtzID0gdGFnVmFsdWUuc3Vic3RyaW5nKDAsIHRhZ1ZhbHVlLmluZGV4T2YoIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICB9CgogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS5zdWJzdHJpbmcocG9zc2libGVOdWdFbmQgKyAxKTsKfQoKdGhpc0JvdC5udWdnZXRCdXR0b24oeyBudWdnZXQ6IG51Z3NUb0NoZWNrLCBib3Q6IHRoYXQuZWRpdGVkQm90LCB0YWc6IHRoYXQuZWRpdGVkVGFnLCB0YWdWYWx1ZTogb3JpZ2luYWxUYWdWYWx1ZX0pOycA4e/lhgnBWQ1vbkFCUHVibGlzaGVkAgQA4e/lhgncggHBAUBjb25zb2xlLmxvZyh0aGF0LmFiLCB0YWdzLm51Z2dldFRvUHVibGlzaCkKCmlmICh0aGF0LmFiID09IHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IHB1Ymxpc2hlZCIpOwoKICAgIG1hc2tzLm51Z2dldFRvUHVibGlzaCA9IG51bGw7CgogICAgY29uZmlnQm90Lm1hc2tzLmFiVmVyc2lvbiA9IG51bGw7Cn0nAOHv5YYJwVkQb25BbnlCb3RzQ2hhbmdlZAIEAOHv5YYJnoQBtwRAaWYgKGNvbmZpZ0JvdCAmJiB0aGF0WzBdLmJvdC5pZCAhPSB0aGlzQm90LmlkKSAKewogICAgaWYgKCFjb25maWdCb3QudGFncy5lZGl0aW5nQm90KSByZXR1cm47IC8vIElnbm9yZSBpZiB0aGUgY29uZmlnQm90IGlzbid0IHJlYWR5IHlldC4KCiAgICBjb25zdCBlZGl0ZWRCb3RJRCA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QucmVwbGFjZSgi8J+UlyIsICIiKTsKCiAgICBpZiAoIXRoYXQuZmluZCh4ID0+IHguYm90LmlkID09IGVkaXRlZEJvdElEKSkgcmV0dXJuOyAvLyBJZiB0aGUgYm90IGNoYW5nZWQgd2Fzbid0IGJlaW5nIGVkaXRlZCBieSB0aGUgdXNlciBpZ25vcmUgaXQuCgogICAgY29uc3QgZWRpdGVkVGFnID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ1RhZzsKICAgIGNvbnN0IGVkaXRlZEJvdCA9IGdldEJvdCgiaWQiLCBlZGl0ZWRCb3RJRCk7CgogICAgaWYgKGVkaXRlZEJvdCAmJiBlZGl0ZWRUYWcpIAogICAgewogICAgICAgIHNob3V0KCJudWdnZXRSZXNldCIpOwoKICAgICAgICB0aGlzQm90Lm51Z2dldFBhcnNlKHsgZWRpdGVkQm90LCBlZGl0ZWRUYWcgfSk7CiAgICB9Cn0nAOHv5YYJwVkIb25DcmVhdGUCBADh7+WGCdSIAUxAdGFncy5saXN0ZW5pbmcgPSBmYWxzZTsKCi8vc2V0VGFnTWFzayh0aGlzQm90LCAibGlzdGVuaW5nIiwgdHJ1ZSwgImxvY2FsIik7JwDh7+WGCcFZDXBhY2thZ2VOdWdnZXQCBADh7+WGCaGJAfgGQGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CmNvbnN0IHRhZ1RleHQgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXTsKCmlmIChjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4IHx8IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4KQp7CiAgICBsZXQgc3RhcnRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4OwogICAgbGV0IGVuZFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4OwoKICAgIGlmIChzdGFydFBvcyA9PSBlbmRQb3MpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoc3RhcnRQb3MgPiBlbmRQb3MpCiAgICB7CiAgICAgICAgbGV0IG5ld1N0YXJ0UG9zID0gZW5kUG9zOwogICAgICAgIGxldCBuZXdFbmRQb3MgPSBzdGFydFBvczsKCiAgICAgICAgc3RhcnRQb3MgPSBuZXdTdGFydFBvczsKICAgICAgICBlbmRQb3MgPSBuZXdFbmRQb3M7CiAgICB9CgogICAgbGV0IGRhdGEgPSB0YWdUZXh0LnN1YnN0cmluZyhzdGFydFBvcywgZW5kUG9zICsgMSk7CgogICAgc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6IHRoYXQubnVnZ2V0LCBkYXRhOiBkYXRhfSk7CgogICAgb3MudG9hc3QoIm51ZyBpcyBwdWJsaXNoaW5nIiwgMTApOwoKICAgIGxldCB0YXJnZXROdWcgPSAiLm51ZyB7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImNhbm5vdCByZWFkIG51Z2dldCB0byBiZSBwdWJsaXNoZWQiKQp9JwDh7+WGCcFZCHJlbWVtYmVyAgQA4e/lhgmakAEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA4e/lhgnBWQZzZWFyY2gCBADh7+WGCcGQASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwDh7+WGCcFZBXN0b3JlAgQA4e/lhgnokAEo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicA4e/lhgnBWQlsaXN0ZW5pbmcCBADh7+WGCY+RAQVmYWxzZScA4e/lhgnBWQlhYlZlcnNpb24CBADh7+WGCZWRAQQxMC45JwEEYm90cyRiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IBJwDh7+WGCZqRARlhYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yAgQA4e/lhgmbkQHODEBjb25zdCB7CiAgICBsYWJlbCA9IGAke2FiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX0gaXMgd29ya2luZ2AsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9CgpsZXQgYnVzeUluZGljYXRvciA9IHsKICAgIG9uUG9pbnRlclVwOiBudWxsLAogICAgb25Qb2ludGVyRG93bjogbnVsbCwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBidXN5TGFiZWw6IGxhYmVsLAogICAgbGFiZWxBbGlnbm1lbnQ6ICdsZWZ0JywKICAgIHN0YXRlOiAwLAogICAgYW5pbVN0YXRlczogWwogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcnLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICBdLAogICAgYW5pbVJhdGU6IDUwMCwKICAgIG9uQm90QWRkZWQ6IGBACiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIG9uQm90Q2hhbmdlZDogYEAKICAgICAgICBjb25zdCBuZWVkUmVmcmVzaCA9IHRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2J1c3lMYWJlbCcgfHwgdCA9PT0gJ3N0YXRlJyB8fCB0ID09PSAnYW5pbVN0YXRlcycpOwogICAgICAgIGlmIChuZWVkUmVmcmVzaCkgewogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfQogICAgYCwKICAgIHJlZnJlc2hEaXNwbGF5OiBgQAogICAgICAgIGlmICh0YWdzLmFuaW1TdGF0ZXMgJiYgdGFncy5hbmltU3RhdGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgYW5pbVN0YXRlID0gdGFncy5hbmltU3RhdGVzW3RhZ3Muc3RhdGVdOwoKICAgICAgICAgICAgdGFncy5sYWJlbCA9IHRhZ3MuYnVzeUxhYmVsLnRyaW0oKSArIGFuaW1TdGF0ZS5lbGxpcHNpczsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGFuaW1TdGF0ZS5mb3JtQWRkcmVzczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLmxhYmVsIAogICAgICAgIH0KICAgIGAsCiAgICBhbmltYXRlOiBgQAogICAgICAgIGlmICh0YWdzLnN0YXRlID49IHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgKz0gMTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLnNsZWVwKHRhZ3MuYW5pbVJhdGUpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIC4uLnJlc3QKfTsKCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihidXN5SW5kaWNhdG9yKTsKCnJldHVybiBtZW51Qm90OycA4e/lhgmakQEGc3lzdGVtAgQA4e/lhgnqnQERYWIuaW50ZXJmYWNlLm1lbnUnAOHv5YYJmpEBBGZvcm0CBADh7+WGCfydAQdub3RoaW5nJwDh7+WGCZqRAQtkZXNjcmlwdGlvbgIEAOHv5YYJhJ4BJlRoaXMgc2tpbGwgaXMgZGVzaWduZWQgZm9yIG1lbnUgc3R1ZmYuKADh7+WGCZqRAQthYkludGVyZmFjZQF4JwDh7+WGCZqRAQphYk9wZW5NZW51AgQA4e/lhgmsngH9GkBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBtZW51VHlwZSA9IHRoYXQgPyAiYWIiICsgdGhhdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoYXQuc2xpY2UoMSkgKyAiTWVudSI6ICJhYkNvcmVNZW51IjsgLy9zZXQgdXAgYSBjaGVjayB0byBzZWUgd2hhdCB0eXBlIG9mIG1lbnUgc2hvdWxkIGJlIG9jY3VyaW5nIFtjb3JlLCBib3QsIGdyaWQsIGluc3RdCmxldCBtZW51U2tpbGxzID0gZ2V0Qm90cyhtZW51VHlwZSArICJBY3Rpb24iKTsKbGV0IG1heE9wdGlvbnMgPSBtZW51VHlwZSA9PSAiaW5zdCIgPyA3IDogNTsKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5wZXJzb25hbGl0eSA9IHRhZ3MucGVyc29uYWxpdHk7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5iYXNlU2tpbGwuJHttZW51VHlwZSArICJBY3Rpb24ifSh7Ym90OiB0aGlzQm90fSk7YDsKCmxldCBzb3J0T3JkZXJJbmRleCA9IG1lbnVTa2lsbHMubGVuZ3RoOwpmb3IgKGxldCBpID0gMDsgaSA8IG1lbnVTa2lsbHMubGVuZ3RoOyBpKyspLy9BREQgTE9HSUMgRk9SIE1PUkUgT1BUSU9OUyBUSEFOIDUgOiBtYXhPcHRpb25zCnsKICAgIC8vQWxsb3dzIGZvciBjb2RlIHRvIGdldCBjYWxsZWQgYmVmb3JlIHRoZSBtZW51IGdlbmVyYXRlcywgdXNlZnVsIGZvciBkeW5hbWljYWxseSBzZXQgZ3JvdXBzIG9yIGRyb3Bkb3ducwogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJPbkJlZm9yZUNyZWF0ZSJdKSB7CiAgICAgICAgYXdhaXQgd2hpc3BlcihtZW51U2tpbGxzW2ldLCBtZW51VHlwZSArICJPbkJlZm9yZUNyZWF0ZSIpOwogICAgfSAKCiAgICBpZiAobWVudVNraWxsc1tpXS50YWdzW21lbnVUeXBlICsgIkhpZGUiXSkgewogICAgICAgIGNvbnRpbnVlOwogICAgfQogICAgCiAgICBsZXQgY3VycmVudFNraWxsID0gbWVudVNraWxsc1tpXTsKCiAgICBhYk1lbnVCdXR0b24uYmFzZVNraWxsID0gIvCflJciICsgY3VycmVudFNraWxsLmlkOwogICAgYWJNZW51QnV0dG9uLmxhYmVsID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiTGFiZWwiXTsKICAgIGFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkljb24iXTsKICAgIGFiTWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIk9uR2VuZXJhdGUiXTsKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJTb3J0T3JkZXIiXTsKICAgIGFiTWVudUJ1dHRvbi5jb2xvciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkNvbG9yIl0gPyBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdIDogbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7CgogICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImRyb3Bkb3duIikgewogICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93bk9wdGlvbnMgPSBjdXJyZW50U2tpbGwudGFncy5kcm9wZG93bk9wdGlvbnM7CgogICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5kcm9wZG93blNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiZ3JvdXAiKSB7CiAgICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5ncm91cFNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmdyb3VwU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmdyb3VwU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIGFiTWVudUJ1dHRvbi5tZW51SXRlbXMgPSBjdXJyZW50U2tpbGwudGFncy5tZW51SXRlbXM7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVHcm91cChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJpbnB1dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gInRleHQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gInRvb2wiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUb29sKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gIndpemFyZCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOwogICAgfQp9Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJPcGVuTWVudScsIHsgbWVudTogdGhhdCwgbWVudVR5cGUsIG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsIH0pOycA4e/lhgmakQESYWJDcmVhdGVNZW51QnV0dG9uAgQA4e/lhgmouQH4DUBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9OwoKbGV0IHsKICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwKICAgIC4uLmFkZGl0aW9uYWxUYWdzCn0gPSB0aGF0ID8/IHt9CgppZiAodHlwZW9mIG1lbnVJdGVtU3R5bGUgPT0gJ3N0cmluZycpIHsKICAgIG1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbVN0eWxlLnJlcGxhY2UoL1x1ezFGOUVDfS91LCAnJyk7IAogICAgbWVudUl0ZW1TdHlsZSA9IEpTT04ucGFyc2UobWVudUl0ZW1TdHlsZSk7Cn0KCmZ1bmN0aW9uIGhhc0JvcmRlclN0eWxlKCkgewogICAgaWYgKG1lbnVJdGVtU3R5bGVbImJvcmRlci10b3Atc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItbGVmdC1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1ib3R0b20tc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItcmlnaHQtc3R5bGUiXSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdKSB7CiAgICBpZiAoYWRkaXRpb25hbFRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJNZW51R3JvdXAiXSkgewoKICAgIH0KfQoKbmV3TWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdNZW51QnV0dG9uLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7Cm5ld01lbnVCdXR0b24ubGFiZWxDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7Cm5ld01lbnVCdXR0b24uc2hhZG93Q29sb3IgPSB0aGF0LnNoYWRvd0NvbG9yID8/IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU2hhZG93Q29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLnNjYWxlWSA9IDE7Cgpjb25zdCBtZW51U3R5bGluZyA9IHsKICAgICJib3JkZXItcmFkaXVzIjoiOHB4IiwKICAgICJtYXJnaW4tdG9wIjogIjhweCIsCiAgICAiYm94LXNoYWRvdyI6IGAzcHggNHB4ICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIm1pbi1oZWlnaHQiOiAiNDRweCIsCiAgICAiYm9yZGVyIjogaGFzQm9yZGVyU3R5bGUoKSA/ICIiIDogYDJweCBzb2xpZCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJ3aWR0aCI6ICJjYWxjKDEwMCUgLSA1cHgpIiwKICAgIC4uLm1lbnVJdGVtU3R5bGUKfQoKbmV3TWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gbWVudVN0eWxpbmc7Cgpjb25zdCBjbGlja2VkU3R5bGluZyA9IHsKICAgIC4uLm1lbnVTdHlsaW5nLAogICAgImZpbHRlciI6ICJicmlnaHRuZXNzKDYwJSkiCn0KY29uc3QgYmFzZVN0eWxlID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9ICfwn6esICR7SlNPTi5zdHJpbmdpZnkoY2xpY2tlZFN0eWxpbmcpfSdgCgpuZXdNZW51QnV0dG9uLm9uUG9pbnRlckRvd24gPSBtZW51SXRlbVN0eWxlPy5bIm1hcmdpbi10b3AiXSAhPSAiMHB4IiA/IGJhc2VTdHlsZSA6ICJAIC8vIjsKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJVcCA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsYDsKCmZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQp7CiAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOwp9CgpuZXdNZW51QnV0dG9uID0gY3JlYXRlKG5ld01lbnVCdXR0b24pOwoKcmV0dXJuIG5ld01lbnVCdXR0b247JwDh7+WGCZqRAQ1hYk1lbnVSZWZyZXNoAgQA4e/lhgmfxwGdAUBpZiAoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbD8uc3Vic3RyaW5nKDAsMikgPT0gImFiIikKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKICAgIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKICAgIG1hc2tzLm9uS2V5RG93biA9IG51bGw7Cn0nAOHv5YYJmpEBCHJlbWVtYmVyAgQA4e/lhgm9yAEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA4e/lhgmakQENbWFuaWZlc3RhdGlvbgIEAOHv5YYJ5MgBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAOHv5YYJmpEBEWFiRW52aXJvbm1lbnRNZW51AgQA4e/lhgmLyQG6N0BzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5wZXJzb25hbGl0eSA9IHRhZ3MucGVyc29uYWxpdHk7CmFiTWVudUJ1dHRvbi5sZWFybiA9IHRhZ3MubGVhcm47Cgpjb25zdCBhYkVudmlyb25tZW50T3B0aW9ucyA9IHRoaXNCb3QuYWJHZXRFbnZpcm9ubWVudE9wdGlvbnMoKTsKCmJ1dHRvbkxvb3A6CmZvciAobGV0IGkgPSAwOyBpIDwgYWJFbnZpcm9ubWVudE9wdGlvbnMubGVuZ3RoOyBpKyspCnsKICAgIGxldCBhY3RpdmVCdXR0b24gPSBhYkVudmlyb25tZW50T3B0aW9uc1tpXTsKCiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gYWN0aXZlQnV0dG9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOwoKICAgIGlmIChhY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudEdhdGUpCiAgICB7CiAgICAgICAgaWYgKCFsaW5rc1thY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudEdhdGVdKQogICAgICAgIHsKICAgICAgICAgICAgY29udGludWUgYnV0dG9uTG9vcDsKICAgICAgICB9CiAgICB9CgogICAgbGV0IG5ld0J1dHRvbkRhdGEgPSB7Li4uYWJNZW51QnV0dG9uLCAuLi5hY3RpdmVCdXR0b259OwoKICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld0J1dHRvbkRhdGEpOwp9Cgpjb25zdCBhYlBlcnNvbmFsaXR5Q29uZmlnQnV0dG9uID0gewogICAgbGFiZWw6ICJjdXN0b21pemU6IGFiIHBlcnNvbmFsaXR5IiwKICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgIGFiTWVudVNvcnRPcmRlcjogMSwKICAgIGRyb3Bkb3duU29ydE9yZGVyOiAxLAogICAgZHJvcGRvd25PcHRpb25zOiBbCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYG5hbWU6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImN1YmUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LCB7dGl0bGU6ICd3aGF0IHdvdWxkIHlvdSBsaWtlIHRvIGNhbGwgbWU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge25hbWU6IG5hbWV9KTsgCiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGFpIG1vZGVsOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGFpTW9kZWxzID0gbGlua3MucmVtZW1iZXIudGFncy5haU1vZGVsczsKCiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zID0gW107CgogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb21wYW55R3JvdXAgb2YgYWlNb2RlbHMpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1vZGVsRW50cnkgb2YgY29tcGFueUdyb3VwLm1vZGVscykgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goeyBsYWJlbDogbW9kZWxFbnRyeS5tb2RlbCwgdmFsdWU6IG1vZGVsRW50cnkubW9kZWwgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRNb2RlbEluZGV4ID0gb3B0aW9ucy5maW5kSW5kZXgobyA9PiBvLnZhbHVlID09PSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCk7CgogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQoY3VycmVudE1vZGVsSW5kZXgsIHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3doYXQgYWkgbW9kZWwgd291bGQgeW91IGxpa2UgbWUgdG8gdXNlPycsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2xpc3QnLAogICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBvcHRpb25zLAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkT3B0aW9uICYmIHNlbGVjdGVkT3B0aW9uLnZhbHVlICE9PSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCkgewogICAgICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHthaU1vZGVsOiBzZWxlY3RlZE9wdGlvbi52YWx1ZX0pOyAKICAgICAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBtZSB0byBiZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7Y29sb3I6IGNvbG9yfSk7IAogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnVzIHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51Q29sb3I6IGNvbG9yfSk7IAogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTtgLAogICAgICAgICAgICAgICAgLy9saW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yID0gY29sb3I7IGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yICE9ICdjbGVhcicpe2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgPSBjb2xvcn07IGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IHRleHQgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51IHRleHQgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVMYWJlbENvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICAgICAgICAgIC8vbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvciA9IGNvbG9yOyBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciAhPSAnY2xlYXInKXtsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yID0gY29sb3J9OyBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBwb3J0YWwgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGxldCBwb3J0YWxDb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyAnIzI2MzIzOCcsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgeW91ciBwb3J0YWwgdG8gbG9vayBsaWtlPyd9KTsKICAgICAgICAgICAgICAgIGlmICghcG9ydGFsQ29sb3IpIHsKICAgICAgICAgICAgICAgICAgICBwb3J0YWxDb2xvciA9ICcjMjYzMjM4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsncG9ydGFsQ29sb3InOiBwb3J0YWxDb2xvcn0pOyAKICAgICAgICAgICAgICAgIC8vZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBtYXAgcG9ydGFsIGJhc2VtYXBgLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBzaG91dCgic2hvd0FCQmFzZW1hcE9wdGlvbnMiKTsKICAgICAgICAgICAgYAogICAgICAgIH0sCiAgICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJkZWZhdWx0IHNldHRpbmdzIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICAgICAgICAgIGNvbG9yOiAncmVkJywKICAgICAgICAgICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsnZGVmYXVsdFBlcnNvbmFsaXR5JzogdHJ1ZX0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogIm1lbnUgY29sb3IiLAogICAgICAgIC8vICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgIC8vICAgICAgb25DbGljazogYEAgCiAgICAgICAgLy8gICAgICAgICBjb25zdCBtZW51Q29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQoYWJQZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvciwge3RpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51J3MgdG8gYmU/J30pOwogICAgICAgIC8vICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVDb2xvcjogbWVudUNvbG9yfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIC8vIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogInByb21wdCIsCiAgICAgICAgLy8gICAgIG9uQ2xpY2s6IGBAYCwKICAgICAgICAvLyB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJmb3JtIiwKICAgICAgICAvLyAgICAgb25DbGljazogYEAgCiAgICAgICAgLy8gICAgICAgICBjb25zdCBmb3JtID0gYXdhaXQgb3Muc2hvd0lucHV0KGFiUGVyc29uYWxpdHkudGFncy5hYkZvcm0sIHt0aXRsZTogJ3doYXQgZm9ybSB3b3VsZCB5b3UgbGlrZSBtZSB0byB0YWtlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHtmb3JtOiBmb3JtfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIC8vIH0KICAgIF0KfQoKdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bihhYlBlcnNvbmFsaXR5Q29uZmlnQnV0dG9uKTsKCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAogICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwpgOwp0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACiAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewogICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CiAgICB9CmA7CgpzaG91dCgnb25BQkVudmlyb25tZW50TWVudScsIHsgbWVudVBvcnRhbDogY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbH0gKScA4e/lhgmakQEFbGVhcm4CBADh7+WGCcaAAijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDh7+WGCZqRAQNncHQCBADh7+WGCe2AAijwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwDh7+WGCZqRAQhhYklnbm9yZQIEAOHv5YYJlIECBHRydWUnAOHv5YYJmpEBBnNlYXJjaAIEAOHv5YYJmYECKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAOHv5YYJmpEBBm51Z2dldAIEAOHv5YYJwIECKPCflJc0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYnAOHv5YYJmpEBBXRlc3RzAgQA4e/lhgnngQIo8J+Ul2I4M2Q5NzJiLTA1MzUtNDA1MS1iNTg5LTQxY2VkYTg1MzVmMScA4e/lhgmakQEPb25Qb3J0YWxDaGFuZ2VkAgQA4e/lhgmOggJuQGlmICh0aGF0LnBvcnRhbCA9PSAic3lzdGVtUG9ydGFsIiAmJiAhdGhhdC5kaW1lbnNpb24gJiYgIWxpbmtzLnRlc3RzKQp7CiAgICBsaW5rcy5sZWFybi5hYkFkYXB0KCJhYlRlc3RzIik7Cn0nAOHv5YYJmpEBA2FzawIEAOHv5YYJ/YICKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAOHv5YYJmpEBCWFiVmVyc2lvbgIEAOHv5YYJpIMCBDEwLjknAOHv5YYJmpEBEWFiQ3JlYXRlTWVudUlucHV0AgQA4e/lhgmpgwKeAkBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51SW5wdXQgPSB7DQogICAgZm9ybTogImlucHV0IiwNCiAgICBtZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHk6IGZhbHNlLA0KICAgIGZvcm1JbnB1dE11bHRpbGluZTogbnVsbCwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51SW5wdXQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAOHv5YYJmpEBEGFiQ3JlYXRlTWVudVRleHQCBADh7+WGCciFAoEEQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KY29uc3Qgew0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZSwNCiAgICAuLi5yZXN0DQp9ID0gdGhhdDsNCg0KbGV0IG1lbnVUZXh0ID0gew0KICAgIGZvcm06ICJ0ZXh0IiwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIHBvaW50YWJsZTogZmFsc2UsDQogICAgY29sb3I6ICJ3aGl0ZSIsDQogICAgbWVudUl0ZW1TdHlsZTogew0KICAgICAgICAicGFkZGluZy10b3AiOiAiNnB4IiwNCiAgICAgICAgInBhZGRpbmctYm90dG9tIjogIjZweCIsDQogICAgfSwNCiAgICBtZW51SXRlbUxhYmVsU3R5bGU6IHsNCiAgICAgICAgIndoaXRlLXNwYWNlIjogInByZS13cmFwIiwNCiAgICAgICAgLi4ubWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIH0sDQogICAgLi4ucmVzdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUZXh0KTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwDh7+WGCZqRARBhYkNyZWF0ZU1lbnVUb29sAgQA4e/lhgnKiQKOAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51VG9vbCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRvb2wpOw0KDQpyZXR1cm4gbWVudUJvdDsnAOHv5YYJmpEBEmFiQ3JlYXRlTWVudVdpemFyZAIEAOHv5YYJ2YoCkgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVdpemFyZCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVdpemFyZCk7DQoNCnJldHVybiBtZW51Qm90OycA4e/lhgmakQEUYWJDcmVhdGVNZW51RHJvcGRvd24CBADh7+WGCeyLAugbQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0LmRyb3Bkb3duU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVEcm9wZG93bjogZHJvcGRvd25Tb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgb3V0ZXJNZW51QnV0dG9uID0gew0KICAgIC4uLnRoYXQsDQogICAgZm9ybUFkZHJlc3M6IHRoYXQuZm9ybUFkZHJlc3MgPz8gImFycm93X3JpZ2h0IiwNCiAgICBkcm9wZG93bk9wZW46IGZhbHNlLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIHRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9ICR7dGhhdC5kcm9wZG93blNvcnRPcmRlcn0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IHRydWUpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnModGFncy5kcm9wZG93bk9wdGlvbnMsIHRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIpOw0KICAgICAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25EZXN0cm95OiBgQA0KICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgIGAsDQogICAgb25Qb2ludGVyVXA6IGBADQogICAgICAgIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsOw0KICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gImFycm93X3JpZ2h0IjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gZmFsc2UpIHsNCiAgICAgICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImZvcm1BZGRyZXNzIiwgImFycm93X2Ryb3BfZG93biIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAibWVudUl0ZW1TdHlsZSIsIHsuLi50YWdzLm1lbnVJdGVtU3R5bGUsICJib3JkZXJCb3R0b21MZWZ0UmFkaXVzIjogIjAiLCAiYm9yZGVyQm90dG9tUmlnaHRSYWRpdXMiOiAiMCJ9KTsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25Cb3RDaGFuZ2VkOiBgQA0KICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCdkcm9wZG93bk9wZW4nKSAmJiB0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51RHJvcGRvd25PcGVuZWQiLCB0aGlzQm90KTsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgYWJNZW51RHJvcGRvd25PcGVuZWQ6IGBADQogICAgICAgIGlmICh0aGF0ICE9IHRoaXNCb3QpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIH0NCiAgICBgDQp9Ow0KDQppZiAodGhhdC5mb3JtQWRkcmVzcyAmJiB0aGF0LmZvcm1BZGRyZXNzICE9ICJhcnJvd19yaWdodCIpIHsNCiAgICBvdXRlck1lbnVCdXR0b24uY3VzdG9tRm9ybUFkZHJlc3MgPSB0cnVlOw0KfQ0Kb3V0ZXJNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSB0aGF0LmRyb3Bkb3duU29ydE9yZGVyOw0KDQpjb25zdCBtZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24ob3V0ZXJNZW51QnV0dG9uKTsNCm1lbnVCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zID0gZ2VuZXJhdGVNZW51T3B0aW9uczsNCg0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNZW51T3B0aW9ucyAob3B0aW9ucywgc29ydE9yZGVyKSB7DQogICAgY29uc3QgbWVudUJvdHMgPSBbXTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyArK2kpIHsNCg0KICAgICAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm9wdGlvbnNbaV0sDQogICAgICAgICAgICBjbGVhckRyb3Bkb3duTWVudTogYEANCiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOw0KICAgICAgICAgICAgYA0KICAgICAgICB9Ow0KDQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcihzb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDAwKTsNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9IHRydWU7DQoNCiAgICAgICAgaWYgKGkgPT0gb3B0aW9ucy5sZW5ndGggLSAxKSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIDAgOHB4IDhweCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCAwIDhweCA4cHgiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyVG9wIl0gPSAibm9uZSI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsibWFyZ2luVG9wIl0gPSAiMCI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsicGFkZGluZ0xlZnQiXSA9ICIzNXB4IjsNCg0KICAgICAgICBjb25zdCBuZXdNZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQogICAgfQ0KDQogICAgbWVudUJvdC50YWdzLm1lbnVCb3RzID0gZ2V0TGluayhtZW51Qm90cyk7DQp9DQoNCnJldHVybiBtZW51Qm90Ow0KDQonAOHv5YYJmpEBEWFiQ3JlYXRlTWVudUdyb3VwAgQA4e/lhgnVpwLcHUAvKg0KICAgRVhBTVBMRQ0KICAgY29uc3QgbWVudUdyb3VwID0gew0KICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBncm91cFNvcnRPcmRlcjogMSwNCiAgICAgICAgbWVudUl0ZW1zOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICBjb2xvcjogIm9yYW5nZSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgbWVudUl0ZW1UeXBlOiAiZHJvcGRvd24iLA0KICAgICAgICAgICAgICAgIGRyb3Bkb3duT3B0aW9uczogWw0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfQ0KKi8NCg0KaWYgICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0Lmdyb3VwU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVHcm91cDogZ3JvdXBTb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgew0KICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwNCiAgICBtZW51SXRlbXMgPSBbXSwNCiAgICAuLi5hZGRpdGlvbmFsVGFncw0KfSA9IHRoYXQgPz8ge30NCg0KY29uc3QgbWVudUJvdHMgPSBbXTsNCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudUl0ZW1zLmxlbmd0aDsgKytpKSB7DQoNCiAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9Ow0KDQogICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDApOw0KDQogICAgbGV0IGluZGl2TWVudUl0ZW1TdHlsZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVN0eWxlID8/IHt9Ow0KICAgIGxldCBpbmRpdk1lbnVUeXBlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtVHlwZSA/PyB1bmRlZmluZWQ7DQogICAgbGV0IGluZGl2QWRkaXRpb25hbFRhZ3MgPSBtZW51SXRlbXNbaV07DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdOw0KICAgIH0NCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdOw0KICAgIH0NCg0KICAgIGNvbnN0IGJhc2VTdHlsaW5nID0gew0KICAgICAgICAiYm9yZGVyVG9wIjogIm5vbmUiLA0KICAgICAgICAibWFyZ2luVG9wIjogIjAiDQogICAgfQ0KDQogICAgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCAwIDhweCA4cHgiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfSBlbHNlIGlmIChpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjhweCA4cHggMCAwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nO30NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gaW5kaXZBZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGluZGl2QWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBsZXQgbmV3TWVudUJvdDsNCiAgICBzd2l0Y2goaW5kaXZNZW51VHlwZSkgew0KICAgICAgICBjYXNlICJkcm9wZG93biI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bigNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC4uLm5ld01lbnVCdXR0b24sDQogICAgICAgICAgICAgICAgICAgICJkcm9wZG93blNvcnRPcmRlciI6IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTApDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiaW5wdXQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidGV4dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRvb2wiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ3aXphcmQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICB9DQogICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCn0NCg0KcmV0dXJuIG1lbnVCb3RzOycA4e/lhgmakQELcGVyc29uYWxpdHkCBADh7+WGCbLFAijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwDh7+WGCZqRARdhYkdldEVudmlyb25tZW50T3B0aW9ucwIEAOHv5YYJ2cUC4ClAY29uc3Qgb3B0aW9ucyA9IFtdOwoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogYGhpZGVgLAogICAgICAgIGZvcm1BZGRyZXNzOiAidmlzaWJpbGl0eV9vZmYiLAogICAgICAgIG9uQ2xpY2s6ICJAIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAib3B0aW1pemUgbW9kZSIsCiAgICBvbkNyZWF0ZTogIkAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgb25DbGljazogIkAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA9IGZhbHNlIDogY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSB0cnVlOyB0aGlzQm90Lm9uQ3JlYXRlKCk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxCn0pCgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAic2xlZXAiLAogICAgICAgIGZvcm1BZGRyZXNzOiAibmlnaHRzX3N0YXkiLAogICAgICAgIG9uQ2xpY2s6ICJAbGlua3MubWFuaWZlc3RhdGlvbi5hYlNldEF3YWtlKHsgYXdha2U6IGZhbHNlIH0pIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMwogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiY2hhdCIsCiAgICBmb3JtQWRkcmVzczogImNoYXQiLAogICAgb25DbGljazogIkAgc2hvdXQoJ2FiQ2hhdEJhck9wZW4nKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDQKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogIm51Z2dldHMiLAogICAgb25DcmVhdGU6ICJAIHRhZ3MubnVnTWFuYWdlciA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuaW50ZXJmYWNlLm51Z2dldCcpKTsgaWYgKGxpbmtzLm51Z01hbmFnZXIudGFncy5saXN0ZW5pbmcpe3RhZ3Mub25DbGljayA9IGBAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCBudWxsKTtgO3RhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94YDt9ZWxzZXsgICAgdGFncy5vbkNsaWNrID0gYEAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIHRydWUsICdsb2NhbCcpO2A7ICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94X291dGxpbmVfYmxhbmtgO30iLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDUKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBhYkVudmlyb25tZW50R2F0ZTogImdwdCIsCiAgICBvbkNyZWF0ZTogIkAgIGlmICghYXV0aEJvdCl7ZGVzdHJveSh0aGlzQm90KTt9ZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gJ0ZyZWVQbGF5JyB8fCBhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSB1bmRlZmluZWQpe2Rlc3Ryb3kodGhpc0JvdCk7fTsgdGFncy5sYWJlbCA9ICdlZGl0ICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBwcm9tcHQnOyB0YWdzLmdwdEJvdCA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuYWN0aW9uLmFzaycpKTsiLAogICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgb25DbGljazogIkAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDcKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImdyaWQgc25hcCIsCiAgICBvbkNyZWF0ZTogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnIiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlO3RhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDgKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImJvdCBzbmFwIiwKICAgIG9uQ3JlYXRlOiAiQCB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgb25DbGljazogIkAgbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlOyB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDkKfSkKCmlmIChhdXRoQm90KSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAiYWNjb3VudCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJiYWRnZSIsCiAgICAgICAgb25DbGljazogIkAgb3Muc2hvd0FjY291bnRJbmZvKCk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAKICAgIH0pCn0KCmlmIChsaW5rcy50ZXN0cykgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBhYkVudmlyb25tZW50R2F0ZTogInRlc3RzIiwKICAgICAgICBsYWJlbDogInJlY29yZCB0ZXN0IiwKICAgICAgICBmb3JtQWRkcmVzczogInNjaWVuY2UiLAogICAgICAgIG9uS2V5RG93bjogIkAgIiwKICAgICAgICBvbktleVVwOiAiQCAiLAogICAgICAgIG9uQ2xpY2s6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRlc3QnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDExCiAgICB9KQoKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJ0ZXN0cyIsCiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdHJhY2UiLAogICAgICAgIGZvcm1BZGRyZXNzOiAidGltZWxpbmUiLAogICAgICAgIG9uS2V5RG93bjogIkAgIiwKICAgICAgICBvbktleVVwOiAiQCAiLAogICAgICAgIG9uQ2xpY2s6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRyYWNlJyk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMgogICAgfSkKfQoKaWYgKGdldEJvdCgic3lzdGVtIiwgImFiLmhvbWUuZWdnIikpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJ0ZXN0cyIsCiAgICAgICAgbGFiZWw6ICJzYXZlIGhvbWUgZWdnIiwKICAgICAgICBmb3JtQWRkcmVzczogImVnZyIsCiAgICAgICAgb25LZXlEb3duOiAiQCAiLAogICAgICAgIG9uS2V5VXA6ICJAICIsCiAgICAgICAgb25DbGljazogYEBnZXRCb3QoInN5c3RlbSIsICJhYi5ob21lLmVnZyIpLnNhdmVEYXRhKCk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTtgLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMwogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgbGFiZWw6ICJ1cGRhdGUgIiArIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICBmb3JtQWRkcmVzczogImN1YmUiLAogICAgbGVhcm46IHRhZ3MubGVhcm4sCiAgICBvbktleURvd246ICJAICIsCiAgICBvbktleVVwOiAiQCAiLAogICAgb25DbGljazogYEBsaW5rcy5sZWFybi51cGRhdGVBQigpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTQKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBvbkNyZWF0ZTogYEAKICAgICAgICB0YWdzLmxhYmVsID0gInBlcm1hbmVudGx5IGRlbGV0ZSAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKICAgICAgICB0YWdzLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb250cmFzdENvbG9yID8/ICIjRDkzMDMwIjsKICAgIGAsCiAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgIG9uQ2xpY2s6IGBACiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ1Blcm1hbmVudGx5IGRlbGV0ZSAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgY29udGVudDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArICBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBmcm9tICcgKyBsaW5rcy5sZWFybi50YWdzLmFiSW5zdCArICc/IFRoaXMgaXMgbm90IHJldmVyc2libGUhJywKICAgICAgICB9KQoKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwoKICAgICAgICBjb25zdCBhYkJvdHMgPSBnZXRCb3RzKChiKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBiLnNwYWNlID09PSAnc2hhcmVkJyAmJgogICAgICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0gJiYKICAgICAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtLnN0YXJ0c1dpdGgoJ2FiJyk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgZGVzdHJveShhYkJvdHMpOwogICAgICAgIH0KICAgIGAsCiAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMAp9KQoKcmV0dXJuIG9wdGlvbnM7JwDh7+WGCZqRAR5hYkNyZWF0ZVRvb2xib3hEcm9wZG93bk9wdGlvbnMCBADh7+WGCbrvAuMTQGNvbnN0IHRvb2xib3hUb29scyA9IFsuLi50aGF0LnRvb2xBcnJheV0gPz8gW107DQpjb25zdCB0b29sYm94TmFtZSA9IHRoYXQudG9vbGJveE5hbWUgPz8gIktpdCAiOw0KY29uc3QgdG9vbGJveCA9IHRoYXQudG9vbGJveDsNCmNvbnN0IGdyaWRJbmZvcm1hdGlvbiA9ICh0aGF0Py5ncmlkSW5mb3JtYXRpb24gJiYgdGhhdD8uZ3JpZEluZm9ybWF0aW9uICE9IHVuZGVmaW5lZCkgPyB0aGF0Py5ncmlkSW5mb3JtYXRpb24gOiBhYlJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQoNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMudG9vbGJveCA9IGdldExpbmsodG9vbGJveCk7DQptZW51T3B0aW9ucy5ncmlkSW5mb3JtYXRpb24gPSBncmlkSW5mb3JtYXRpb247DQptZW51T3B0aW9ucy5zZWFyY2ggPSB0YWdzLnNlYXJjaDsNCm1lbnVPcHRpb25zLmFydGlmYWN0ID0gdGFncy5hcnRpZmFjdDsNCi8vbWVudU9wdGlvbnMuZm9ybUFkZHJlc3MgPSAiaGFyZHdhcmUiOw0KDQppZiAodG9vbGJveFRvb2xzLmxlbmd0aCA9PT0gMCkgew0KICAgIGNvbnN0IG1lc3NhZ2UgPSB0b29sYm94TmFtZSArICIgZG9lcyBub3QgaGF2ZSBhbnkgdG9vbHMgbGlzdGVkIGluIHRoZSB0b29sX2FycmF5IHRhZyI7DQoNCiAgICBhYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIG1lc3NhZ2UpOw0KICAgIG9zLnRvYXN0KG1lc3NhZ2UsIDUpOw0KICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7DQp9DQoNCmZvciAobGV0IHRvb2wgb2YgdG9vbGJveFRvb2xzKSB7DQogICAgY29uc3QgdG9vbEJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiB0b29sLm5hbWUsDQogICAgICAgIHRhcmdldEFCOiB0b29sLnRhcmdldEFCLA0KICAgICAgICBpc0FydGlmYWN0OiB0b29sLmFydGlmYWN0IHx8IGZhbHNlLA0KICAgICAgICBvbkNsaWNrOmBADQogICAgICAgICAgICBpZiAodGFncy5pc0FydGlmYWN0KSB7DQogICAgICAgICAgICAgICAgY29uc3QgYWJBcnRpZmFjdFNoYXJkID0gew0KICAgICAgICAgICAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJveEJvdDogdGFncy50b29sYm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzOiBbDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUINCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgbGlua3MuYXJ0aWZhY3QuYWJDcmVhdGVBcnRpZmFjdFByb21pc2VCb3Qoew0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0TmFtZTogdGFncy50YXJnZXRBQiwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdEluc3RhbmNlSUQ6IHV1aWQoKSwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdFNoYXJkLA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsNCiAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAndG9vbCcsDQogICAgICAgICAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgLA0KICAgIH07DQoNCiAgICBpZiAodG9vbC5mb3JtQWRkcmVzcykgew0KICAgICAgICB0b29sQnV0dG9uLmZvcm1BZGRyZXNzID0gdG9vbC5mb3JtQWRkcmVzczsNCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaCh0b29sQnV0dG9uKTsNCn0NCg0KcmV0dXJuIGRyb3Bkb3duT3B0aW9uczsnAOHv5YYJmpEBEG9uQUJBdXRoQm90QWRkZWQCBADh7+WGCZ6DAxhAc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsnAOHv5YYJmpEBCGFydGlmYWN0AgQA4e/lhgm3gwMo8J+Ulzc4ZTQxNTAzLWM5MzMtNGY4YS04MTdhLWJhOTdiZjhkNWQyNycBBGJvdHMkYzc4YWE2NjMtZDA1Yy00ZWM0LWJjMmMtMjZmZDUxNTYwYjk3AScA4e/lhgnegwMIYWJJZ25vcmUCBADh7+WGCd+DAwR0cnVlJwDh7+WGCd6DAwthYkludGVyZmFjZQIEAOHv5YYJ5IMDBHRydWUnAOHv5YYJ3oMDBnN5c3RlbQIEAOHv5YYJ6YMDGGFiLmludGVyZmFjZS5ib3RfZmFjdG9yeScA4e/lhgnegwMWYWJDcmVhdGVCaWxsYm9hcmRMYWJlbAIEAOHv5YYJgoQDkEJAY29uc3QgeyAKICAgIGJvdCwKICAgIGRpbWVuc2lvbiwKICAgIHByZXNlcnZlTmV3TGluZXMgPSB0cnVlLAogICAgbGFiZWwgPSAnJywKICAgIHNwYWNlID0gJ3RlbXBMb2NhbCcsCiAgICBjb2xvciA9ICcjMDAwMDAwJywKICAgIGxhYmVsQ29sb3IgPSAnI2ZmZmZmZicsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9OwoKYXNzZXJ0KGxpbmtzLnV0aWxzLmlzQm90KGJvdCksIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm90IGlzIGEgcmVxdWlyZWQgQm90IHBhcmFtZXRlci5gKTsKYXNzZXJ0KGRpbWVuc2lvbiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkaW1lbnNpb24gaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CmFzc2VydChyZXN0Lm9uQ3JlYXRlID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQW55Qm90c0NoYW5nZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25BbnlCb3RzUmVtb3ZlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC51cGRhdGVMYWJlbCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5sYWJlbFdvcmRXcmFwTW9kZSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGxhYmVsV29yZFdyYXBNb2RlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwoKLy8gLS0tIDEpIFdvcmQgYnJlYWtpbmcgKHdyYXAgYnkgd29yZHMsIGNodW5rIGxvbmcgd29yZHMpIC0tLQpmdW5jdGlvbiBicmVha1dvcmRzVG9MaW5lcyh0ZXh0LCBtYXhDb2xzID0gMTgpIHsKICAgIGlmICghdGV4dCkgcmV0dXJuIFsnJ107CiAgICBjb25zdCB3b3JkcyA9IHRleHQuc3BsaXQoL1xzKy8pLmZpbHRlcihCb29sZWFuKTsKICAgIGNvbnN0IGxpbmVzID0gW107CiAgICBsZXQgbGluZSA9ICcnOwoKICAgIGNvbnN0IHB1c2ggPSAoKSA9PiB7IGxpbmVzLnB1c2gobGluZSk7IGxpbmUgPSAnJzsgfTsKCiAgICBmb3IgKGNvbnN0IHcgb2Ygd29yZHMpIHsKICAgICAgICBpZiAody5sZW5ndGggPiBtYXhDb2xzKSB7CiAgICAgICAgICAgIC8vIGNsb3NlIGN1cnJlbnQgbGluZSAoaWYgYW55KSBiZWZvcmUgY2h1bmtpbmcgYSBsb25nIHdvcmQKICAgICAgICAgICAgaWYgKGxpbmUpIHB1c2goKTsKICAgICAgICAgICAgLy8gY2h1bmsgdGhlIGxvbmcgd29yZAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcubGVuZ3RoOyBpICs9IG1heENvbHMpIHsKICAgICAgICAgICAgICAgIGxpbmVzLnB1c2gody5zbGljZShpLCBpICsgbWF4Q29scykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpbmUgPSAnJzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICghbGluZS5sZW5ndGgpIHsKICAgICAgICAgICAgbGluZSA9IHc7CiAgICAgICAgfSBlbHNlIGlmIChsaW5lLmxlbmd0aCArIDEgKyB3Lmxlbmd0aCA8PSBtYXhDb2xzKSB7CiAgICAgICAgICAgIGxpbmUgKz0gJyAnICsgdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwdXNoKCk7CiAgICAgICAgICAgIGxpbmUgPSB3OwogICAgICAgIH0KICAgIH0KICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaCgpOwoKICAgIHJldHVybiBsaW5lcy5sZW5ndGggPyBsaW5lcyA6IFsnJ107Cn0KCi8vIFByZXNlcnZlcyBleGlzdGluZyBcbiBhcyBoYXJkIGJyZWFrczsgd3JhcHMgd2l0aGluIGVhY2ggaGFyZCBsaW5lLgpmdW5jdGlvbiBicmVha1dvcmRzVG9MaW5lc1ByZXNlcnZlTmV3bGluZXModGV4dCwgbWF4Q29scyA9IDE4KSB7CiAgaWYgKHRleHQgPT0gbnVsbCkgcmV0dXJuIFsnJ107CgogIC8vIFNwbGl0IG9uIHJlYWwgbmV3bGluZXM7IGtlZXAgZW1wdHkgbGluZXMgc28gd2UgcHJlc2VydmUgYmxhbmsgbGluZXMuCiAgY29uc3QgaGFyZExpbmVzID0gU3RyaW5nKHRleHQpLnNwbGl0KC9ccj9cbi8pOwogIGNvbnN0IG91dCA9IFtdOwoKICAvLyBIZWxwZXIgdG8gd3JhcCBhIHNpbmdsZSBoYXJkIGxpbmUgYnkgd29yZHMgKHdpdGggbG9uZy13b3JkIGNodW5raW5nKQogIGNvbnN0IHdyYXBPbmUgPSAoc3JjKSA9PiB7CiAgICAvLyBOb3JtYWxpemUgdGFicyAtPiBzcGFjZXM7IGNvbGxhcHNlIGludGVybmFsIHdoaXRlc3BhY2UgKG5vdCBuZXdsaW5lcykKICAgIGNvbnN0IHMgPSBzcmMucmVwbGFjZSgvXHQvZywgJyAgICAnKS5yZXBsYWNlKC9ccysvZywgJyAnKS50cmltKCk7CiAgICBpZiAoIXMubGVuZ3RoKSB7IG91dC5wdXNoKCcnKTsgcmV0dXJuOyB9CgogICAgY29uc3Qgd29yZHMgPSBzLnNwbGl0KCcgJyk7CiAgICBsZXQgbGluZSA9ICcnOwoKICAgIGNvbnN0IHB1c2hMaW5lID0gKCkgPT4geyBvdXQucHVzaChsaW5lKTsgbGluZSA9ICcnOyB9OwoKICAgIC8vIGNodW5rIGxvbmcgd29yZHMgdG8gZW11bGF0ZSAnYnJlYWtXb3JkcycKICAgIGNvbnN0IGNodW5rV29yZCA9ICh3KSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdy5sZW5ndGg7IGkgKz0gbWF4Q29scykgewogICAgICAgIGNvbnN0IGNodW5rID0gdy5zbGljZShpLCBpICsgbWF4Q29scyk7CiAgICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgbGluZSA9IGNodW5rOwogICAgICAgIGVsc2UgeyBwdXNoTGluZSgpOyBsaW5lID0gY2h1bms7IH0KICAgICAgfQogICAgfTsKCiAgICBmb3IgKGNvbnN0IHcgb2Ygd29yZHMpIHsKICAgICAgaWYgKHcubGVuZ3RoID4gbWF4Q29scykgewogICAgICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaExpbmUoKTsKICAgICAgICBjaHVua1dvcmQodyk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgewogICAgICAgIGxpbmUgPSB3OwogICAgICB9IGVsc2UgaWYgKGxpbmUubGVuZ3RoICsgMSArIHcubGVuZ3RoIDw9IG1heENvbHMpIHsKICAgICAgICBsaW5lICs9ICcgJyArIHc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHVzaExpbmUoKTsKICAgICAgICBsaW5lID0gdzsKICAgICAgfQogICAgfQogICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoTGluZSgpOwogIH07CgogIGZvciAoY29uc3QgaGwgb2YgaGFyZExpbmVzKSB7CiAgICB3cmFwT25lKGhsKTsgICAgICAgICAgIC8vIHdyYXAgd2l0aGluIHRoaXMgaGFyZCBsaW5lCiAgfQoKICAvLyBJZiB0aGUgaW5wdXQgZW5kZWQgd2l0aCBhIHRyYWlsaW5nIG5ld2xpbmUsIHdlIGFscmVhZHkgcHJlc2VydmVkIGl0CiAgLy8gYmVjYXVzZSBzcGxpdCBrZXB0IGFuIGVtcHR5IGxhc3QgaXRlbSAtPiBiZWNhbWUgYW4gZW1wdHkgd3JhcHBlZCBsaW5lLgogIHJldHVybiBvdXQubGVuZ3RoID8gb3V0IDogWycnXTsKfQoKLy8gLS0tIDIpIFNpbXBsZSBzaXppbmcgZnJvbSBsaW5lcyAtLS0KLy8gVGhpbmsgb2YgImNvbHNQZXJTY2FsZVgiIGFzICJhYm91dCBOIGNoYXJhY3RlcnMgcGVyIDEgc2NhbGVYIi4KZnVuY3Rpb24gY29tcHV0ZVNpbXBsZVNjYWxlc0Zyb21MaW5lcyhsaW5lcywgewogICAgY29sc1BlclNjYWxlWCA9IDIuNSwKICAgIG1pblNjYWxlWCA9IDEuMjUsCiAgICBtYXhTY2FsZVggPSAxMCwKICAgIGJhc2VTY2FsZVkgPSAxLjIsCiAgICBwZXJMaW5lWSA9IDAuNzUsCn0gPSB7fSkgewogICAgY29uc3QgbG9uZ2VzdCA9IGxpbmVzLnJlZHVjZSgobSwgbCkgPT4gTWF0aC5tYXgobSwgbC5sZW5ndGgpLCAwKTsKICAgIGNvbnN0IGxpbmVDb3VudCA9IE1hdGgubWF4KDEsIGxpbmVzLmxlbmd0aCk7CgogICAgLy8gV2lkdGggc2NhbGVzIHdpdGggdGhlIGxvbmdlc3QgbGluZSBsZW5ndGgKICAgIGxldCBzY2FsZVggPSBsb25nZXN0ID4gMCA/IChsb25nZXN0IC8gY29sc1BlclNjYWxlWCkgOiBtaW5TY2FsZVg7CiAgICBzY2FsZVggPSBNYXRoLm1heChtaW5TY2FsZVgsIE1hdGgubWluKG1heFNjYWxlWCwgc2NhbGVYKSk7CgogICAgLy8gSGVpZ2h0IGdyb3dzIHBlciBsaW5lOyBrZWVwIGl0IHNpbXBsZSBhbmQgcHJlZGljdGFibGUKICAgIGNvbnN0IHNjYWxlWSA9IE1hdGgubWF4KGJhc2VTY2FsZVksIGJhc2VTY2FsZVkgKyAobGluZUNvdW50IC0gMSkgKiBwZXJMaW5lWSk7CgogICAgcmV0dXJuIHsgc2NhbGVYLCBzY2FsZVksIGxvbmdlc3QsIGxpbmVDb3VudCB9Owp9CgoKLy8gUGljayB5b3VyIHRhcmdldCAiY29sdW1ucyIgcGVyIGxpbmUgKHR3ZWFrIHRvIHRhc3RlKQpjb25zdCBNQVhfQ09MUyA9IDMyOwoKLy8gQnJlYWsgdGhlIHRleHQgeW91cnNlbGYKY29uc3QgbGluZXMgPSBwcmVzZXJ2ZU5ld0xpbmVzID8gYnJlYWtXb3Jkc1RvTGluZXNQcmVzZXJ2ZU5ld2xpbmVzKGxhYmVsLCBNQVhfQ09MUykgOiBicmVha1dvcmRzVG9MaW5lcyhsYWJlbCwgTUFYX0NPTFMpOwpjb25zdCB3cmFwcGVkTGFiZWwgPSBsaW5lcy5qb2luKCdcbicpOwoKLy8gQ29tcHV0ZSBzaW1wbGUgc2NhbGVzIGZyb20gdGhlIHdyYXBwZWQgdGV4dApjb25zdCB7IHNjYWxlWCwgc2NhbGVZIH0gPSBjb21wdXRlU2ltcGxlU2NhbGVzRnJvbUxpbmVzKGxpbmVzKTsKCmxldCBsYWJlbE1vZCA9IHsKICAgIHNwYWNlOiBzcGFjZSwKICAgIHRyYWNrQm90SWQ6IGJvdC5pZCwKICAgIGZvcm06ICdzcHJpdGUnLAogICAgY29sb3IsCiAgICBsYWJlbDogd3JhcHBlZExhYmVsLAogICAgbGFiZWxDb2xvciwKICAgIGxhYmVsU2l6ZTogMSwKICAgIGxhYmVsUGFkZGluZ1g6IDAuNSwKICAgIGxhYmVsV29yZFdyYXBNb2RlOiAnbm9uZScsCiAgICBzY2FsZVgsIAogICAgc2NhbGVZLAogICAgc2NhbGVaOiAwLjEsCiAgICBib3RMYWJlbE1hcmdpbjogMSwKICAgIGFuY2hvclBvaW50OiAn4p6h77iPMCwtMC41LDAnLAogICAgb3JpZW50YXRpb25Nb2RlOiAnYmlsbGJvYXJkJywKICAgIGRpbWVuc2lvbjogZGltZW5zaW9uLAogICAgZGVidWc6IGZhbHNlLAogICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgb25DcmVhdGU6IGBACiAgICAgICAgLy8gV2FpdCBmb3IgcmVxdWlyZWQgYm90cyB0byBiZSByZWFkeS4KICAgICAgICBsZXQgd2FpdFRpbWUgPSAwOwoKICAgICAgICB3aGlsZSghZ2xvYmFsVGhpcy5hYikgewogICAgICAgICAgICBpZiAod2FpdFRpbWUgPj0gNTAwMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCBvcy5zbGVlcCgyNTApOwogICAgICAgICAgICB3YWl0VGltZSArPSAyNTA7CiAgICAgICAgfQoKICAgICAgICB0YWdzLnJlYWR5ID0gdHJ1ZTsKICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICBgLAogICAgb25BbnlCb3RzQ2hhbmdlZDogYEAKCiAgICAgICAgZm9yIChjb25zdCBjaGFuZ2VkIG9mIHRoYXQpIHsKICAgICAgICAgICAgaWYgKGNoYW5nZWQuYm90ICYmIGNoYW5nZWQuYm90LmlkID09PSB0YWdzLnRyYWNrQm90SWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9ubHlSb3RhdGlvblRhZ3MgPSBjaGFuZ2VkLnRhZ3MuZXZlcnkoKHQpID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5lbmRzV2l0aCgnUm90YXRpb24nKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblgnKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblknKSB8fCB0LmVuZHNXaXRoKCdSb3RhdGlvblonKQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gb25seVJvdGF0aW9uVGFnczonLCBvbmx5Um90YXRpb25UYWdzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAob25seVJvdGF0aW9uVGFncykgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICBgLAogICAgb25BbnlCb3RzUmVtb3ZlZDogYEAKCiAgICAgICAgaWYgKHRoYXQuYm90SURzLmluY2x1ZGVzKHRhZ3MudHJhY2tCb3RJZCkpIHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICB9CiAgICBgLAogICAgb25Qb3J0YWxDaGFuZ2VkOiBgQAogICAgICAgIGlmICh0aGF0LmRpbWVuc2lvbiA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgICAgIH0KICAgIGAsCiAgICB1cGRhdGVMYWJlbDogYEAKICAgICAgICBpZiAoIXRhZ3MucmVhZHkpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmluZyB1cGRhdGVMYWJlbCBiZWNhdXNlIG5vdCByZWFkeScpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaW5NYXBQb3J0YWwgPSAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgY29uc3QgaW5HcmlkUG9ydGFsID0gKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICghaW5NYXBQb3J0YWwgJiYgIWluR3JpZFBvcnRhbCkgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmUgdXBkYXRlTGFiZWwgY2FsbCwgbm90IGluIGVpdGhlciBncmlkIG9yIG1hcCBwb3J0YWwuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdHJhY2tCb3QgPSBnZXRCb3QoJ2lkJywgdGFncy50cmFja0JvdElkKTsKICAgICAgICBjb25zdCB0cmFja1Bvc2l0aW9uID0gZ2V0Qm90UG9zaXRpb24odHJhY2tCb3QsIHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSB0cmFja1Bvc2l0aW9uOicsIHRyYWNrUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgbGV0IGxhYmVsUG9zaXRpb24gPSB7IHg6IHRyYWNrUG9zaXRpb24ueCwgeTogdHJhY2tQb3NpdGlvbi55LCB6OiB0cmFja1Bvc2l0aW9uLnogfTsgCgogICAgICAgIGNvbnN0IHRyYWNrQm90U2NhbGUgPSB0cmFja0JvdC50YWdzLnNjYWxlID8/IDE7CiAgICAgICAgY29uc3QgdHJhY2tCb3RTY2FsZVogPSB0cmFja0JvdC50YWdzLnNjYWxlWiA/PyAxOwoKICAgICAgICBsZXQgbWV0ZXJzUGVyR3JpZFVuaXQgPSAxOwoKICAgICAgICBpZiAoaW5NYXBQb3J0YWwpIHsKICAgICAgICAgICAgLy8gU2NhbGUgdG8gbWFwIHBvcnRhbCB1bml0cy4KICAgICAgICAgICAgbWV0ZXJzUGVyR3JpZFVuaXQgPSAxMDsKICAgICAgICB9CgogICAgICAgIGxldCB0cmFja0JvdFJlYWxTY2FsZVogPSAodHJhY2tCb3RTY2FsZVogKiB0cmFja0JvdFNjYWxlKSAqIG1ldGVyc1BlckdyaWRVbml0OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIHRyYWNrQm90UmVhbFNjYWxlWjonLCB0cmFja0JvdFJlYWxTY2FsZVopOwogICAgICAgIH0KCiAgICAgICAgbGFiZWxQb3NpdGlvbi56ICs9IHRyYWNrQm90UmVhbFNjYWxlWiArICh0YWdzLmJvdExhYmVsTWFyZ2luICogbWV0ZXJzUGVyR3JpZFVuaXQpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGxhYmVsUG9zaXRpb246JywgbGFiZWxQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1gnXSA9IGxhYmVsUG9zaXRpb24ueDsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1knXSA9IGxhYmVsUG9zaXRpb24ueTsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1onXSA9IGxhYmVsUG9zaXRpb24uejsKICAgIGAKfTsKCmxhYmVsTW9kID0gewogICAgLi4ubGFiZWxNb2QsCiAgICAuLi5yZXN0LAp9Cgpjb25zdCBsYWJlbEJvdCA9IGNyZWF0ZShsYWJlbE1vZCk7CgpyZXR1cm4gbGFiZWxCb3Q7JwDh7+WGCd6DAwV1dGlscwIEAOHv5YYJj8YDKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAOHv5YYJ3oMDBGZvcm0CBADh7+WGCbbGAwdub3RoaW5nJwDh7+WGCd6DAwlhYlZlcnNpb24CBADh7+WGCb7GAwQxMC45AA=="}]}