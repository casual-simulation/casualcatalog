{"version":2,"updates":[{"id":0,"timestamp":1771265896706,"update":"AZ0CrdbuzgkAJwEEYm90cyQxMzY3MjI1My0yNTM2LTQwODYtOTVjZi1lYjE2ZmZjY2U0ZGQBJwCt1u7OCQAGc3lzdGVtAgQArdbuzgkBEmFiLmludGVyZmFjZS5zb3VuZCcArdbuzgkACGFiSWdub3JlAgQArdbuzgkUBHRydWUnAK3W7s4JAAthYkludGVyZmFjZQIEAK3W7s4JGQR0cnVlJwCt1u7OCQALZGVzY3JpcHRpb24CBACt1u7OCR6TBHRoaXMgc2tpbGwgaXMgYSBtYW5hZ2VyIGZvciBzb3VuZHMNCnN1cHBvcnRlZCB0YWdzOg0KICAgIHNvdW5kQ3JlYXRlDQogICAgc291bmRDbGljaw0KICAgIHNvdW5kRHJhZw0KICAgIHNvdW5kRHJvcA0KICAgIHNvdW5kUG9pbnRlckVudGVyDQogICAgc291bmRQb2ludGVyRXhpdA0KDQpwb3NzaWJsZSB2YWx1ZXM6DQogICAgYm9vbGVhbiAtIGlmIHRydWUgd2lsbCBwbGF5IGEgZGVmYXVsdCBzb3VuZCBpZiBvbmUgaXMgZm91bmQuDQogICAgc3RyaW5nIHVybCAtIHdpbGwgYXR0ZW1wdCB0byBwbGF5IHRoZSBzb3VuZCBhdCB0aGUgZ2l2ZW4gdXJsIHBhdGguDQogICAgc3RyaW5nIGZpbGUgcGF0aCAtIHdpbGwgYXR0ZW1wdCB0byBwbGF5IHRoZSBzb3VuZCBhdCB0aGUgZ2l2ZW4gcGF0aCBmcm9tIHRoZSBjYXN1YWwgY2F0YWxvZy4NCiAgICBhcnJheSAtIGEgcmFuZG9tIGVudHJ5IHdpbGwgYmUgY2hvc2VuIGZyb20gdGhlIGFycmF5IGFuZCBwYXJzZWQgYXMgYW55IG9uZSBvZiB0aGUgcG9zc2libGUgdmFsdWVzIGFib3ZlLg0KICAgICcArdbuzgkABGZvcm0CBACt1u7OCbIEB25vdGhpbmcnAK3W7s4JAAhyZW1lbWJlcgIEAK3W7s4JugQo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycArdbuzgkAD29uQW55Qm90Q2xpY2tlZAIEAK3W7s4J4QSlAUBpZiAodGhhdD8uYm90Py50YWdzPy5zb3VuZENsaWNrKSB7DQogICAgdGhpc0JvdC5hYlBsYXlTb3VuZCh7DQogICAgICAgIHZhbHVlOiB0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kQ2xpY2ssDQogICAgICAgIGRlZmF1bHRWYWx1ZTogdGFncy5kZWZhdWx0Q2xpY2tTb3VuZA0KICAgIH0pOw0KfScArdbuzgkADG9uQW55Qm90RHJhZwIEAK3W7s4JhwaiAUBpZiAodGhhdD8uYm90Py50YWdzPy5zb3VuZERyYWcpIHsNCiAgICB0aGlzQm90LmFiUGxheVNvdW5kKHsNCiAgICAgICAgdmFsdWU6IHRoYXQ/LmJvdD8udGFncz8uc291bmREcmFnLA0KICAgICAgICBkZWZhdWx0VmFsdWU6IHRhZ3MuZGVmYXVsdERyYWdTb3VuZA0KICAgIH0pOw0KfScArdbuzgkADG9uQW55Qm90RHJvcAIEAK3W7s4JqgeiAUBpZiAodGhhdD8uYm90Py50YWdzPy5zb3VuZERyb3ApIHsNCiAgICB0aGlzQm90LmFiUGxheVNvdW5kKHsNCiAgICAgICAgdmFsdWU6IHRoYXQ/LmJvdD8udGFncz8uc291bmREcm9wLA0KICAgICAgICBkZWZhdWx0VmFsdWU6IHRhZ3MuZGVmYXVsdERyb3BTb3VuZA0KICAgIH0pOw0KfScArdbuzgkAFG9uQW55Qm90UG9pbnRlckVudGVyAgQArdbuzgnNCLoBQGlmICh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kUG9pbnRlckVudGVyKSB7DQogICAgdGhpc0JvdC5hYlBsYXlTb3VuZCh7DQogICAgICAgIHZhbHVlOiB0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kUG9pbnRlckVudGVyLA0KICAgICAgICBkZWZhdWx0VmFsdWU6IHRhZ3MuZGVmYXVsdFBvaW50ZXJFbnRlclNvdW5kDQogICAgfSk7DQp9JwCt1u7OCQATb25BbnlCb3RQb2ludGVyRXhpdAIEAK3W7s4JiAqyAUBpZiAodGhhdD8uYm90Py50YWdzPy5zb3VuZFBvaW50ZXJFeGl0KSB7CiAgICB0aGlzQm90LmFiUGxheVNvdW5kKHsKICAgICAgICB2YWx1ZTogdGhhdD8uYm90Py50YWdzPy5zb3VuZFBvaW50ZXJFeGl0LAogICAgICAgIGRlZmF1bHRWYWx1ZTogdGFncy5kZWZhdWx0UG9pbnRlckV4aXRTb3VuZAogICAgfSk7Cn0nAK3W7s4JAAtvbkFueUNyZWF0ZQIEAK3W7s4JuwuoAUBpZiAodGhhdD8uYm90Py50YWdzPy5zb3VuZENyZWF0ZSkgew0KICAgIHRoaXNCb3QuYWJQbGF5U291bmQoew0KICAgICAgICB2YWx1ZTogdGhhdD8uYm90Py50YWdzPy5zb3VuZENyZWF0ZSwNCiAgICAgICAgZGVmYXVsdFZhbHVlOiB0YWdzLmRlZmF1bHRDcmVhdGVTb3VuZA0KICAgIH0pOw0KfScArdbuzgkACWFiVmVyc2lvbgIEAK3W7s4J5AwFMTAuMzknAK3W7s4JAAVkZWJ1ZwIEAK3W7s4J6gwFZmFsc2UnAK3W7s4JABBkZWZhdWx0RHJvcFNvdW5kAgQArdbuzgnwDCJhYi9hdWRpby9waWVjZSBkcm9wIGFmdGVyIG1vdmUubXAzJwCt1u7OCQAQZGVmYXVsdERyYWdTb3VuZAIEAK3W7s4Jkw0gYWIvYXVkaW8vcGllY2UgdG91Y2ggdG8gbW92ZS5tcDMnAK3W7s4JABdkZWZhdWx0UG9pbnRlckV4aXRTb3VuZAIEAK3W7s4JtA1j8J+nrFsgImFiL2F1ZGlvL3BvaW50ZXIgZXhpdCBBLm1wMyIsICJhYi9hdWRpby9wb2ludGVyIGV4aXQgQi5tcDMiLCAiYWIvYXVkaW8vcG9pbnRlciBleGl0IEMubXAzIiBdJwCt1u7OCQASZGVmYXVsdENyZWF0ZVNvdW5kAgQArdbuzgmWDiNhYi9hdWRpby9kcm9wIGJsb2NrIGluIHBsYWNlXzAxLm1wMycArdbuzgkAEWRlZmF1bHRDbGlja1NvdW5kAgQArdbuzgm6DhZhYi9hdWRpby90YXAgYmxvY2subXAzJwCt1u7OCQALYWJQbGF5U291bmQCBACt1u7OCdEO6gxAY29uc3QgewogICAgdmFsdWUsCiAgICBkZWZhdWx0VmFsdWUsCn0gPSB0aGF0ID8/IHt9OwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdmFsdWU6YCwgdmFsdWUsIGBkZWZhdWx0VmFsdWU6YCwgZGVmYXVsdFZhbHVlKTsKfQoKaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICBsZXQgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB2YWx1ZS5sZW5ndGgpCiAgICBsZXQgcmFuZG9tVmFsdWUgPSB2YWx1ZVtyYW5kb21JbmRleF07CgogICAgaWYgKHJhbmRvbVZhbHVlID09PSAndHJ1ZScgfHwgcmFuZG9tVmFsdWUgPT09ICdmYWxzZScpIHsKICAgICAgICByYW5kb21WYWx1ZSA9IEJvb2xlYW4ocmFuZG9tVmFsdWUpOwogICAgfQoKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSByYW5kb21JbmRleDpgLCByYW5kb21JbmRleCwgYHJhbmRvbVZhbHVlOmAsIHJhbmRvbVZhbHVlKTsKICAgIH0KICAgIAogICAgcmV0dXJuIHRoaXNCb3QuYWJQbGF5U291bmQoeyB2YWx1ZTogcmFuZG9tVmFsdWUsIGRlZmF1bHRWYWx1ZSB9KTsKfSBlbHNlIGlmICh2YWx1ZSA9PT0gdHJ1ZSkgewogICAgcmV0dXJuIHRoaXNCb3QuYWJQbGF5U291bmQoeyB2YWx1ZTogZGVmYXVsdFZhbHVlIH0pOwp9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgIGlmICh2YWx1ZS5zdGFydHNXaXRoKCdodHRwczovLycpKSB7CiAgICAgICAgcmV0dXJuIG9zLnBsYXlTb3VuZCh2YWx1ZSk7CiAgICB9IGVsc2UgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoJ/Cfp6wnKSkgewogICAgICAgIC8vIFRoaXMgaGFwcGVucyBzb21ldGltZXMgaW4gQ2FzdWFsT1MgZm9yIHNvbWUgcmVhc29uLiAKICAgICAgICAvLyBNYW51YWxseSBwYXJzZSB0aGUganNvbiBmcm9tIHRoZSBtb2Qgc3RyaW5nIGFuZCByZS1ydW4gaXQgdGhyb3VnaC4KICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gdmFsdWUuc2xpY2UoJ/Cfp6wnLmxlbmd0aCk7CiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2UoanNvblN0cmluZyk7CgogICAgICAgIHJldHVybiB0aGlzQm90LmFiUGxheVNvdW5kKHsgdmFsdWU6IGpzb24sIGRlZmF1bHRWYWx1ZSB9KTsKICAgIH0gZWxzZXsKICAgICAgICBjb25zdCBjYXRhbG9nVVJMID0gYXdhaXQgYWIuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwodmFsdWUpOwogICAgICAgIHJldHVybiBvcy5wbGF5U291bmQoY2F0YWxvZ1VSTCk7CiAgICB9Cn0gZWxzZSB7CiAgICBpZiAodmFsdWUgIT0gZmFsc2UpIHsKICAgICAgICBpZiAoZGVmYXVsdFZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzQm90LmFiUGxheVNvdW5kKHsgdmFsdWU6IGRlZmF1bHRWYWx1ZSB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB2YWx1ZSAke3ZhbHVlfSBpcyBub3Qgc3VwcG9ydGVkLiBNdXN0IGJlIGVpdGhlciB0cnVlIGJvb2xlYW4gb3Igc3RyaW5nLmApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9JwCt1u7OCQATZGVmYXVsdERlc3Ryb3lTb3VuZAIEAK3W7s4JuBshYWIvYXVkaW8vZHJvcCBibG9jayBvZmYgYm9hcmQubXAzJwCt1u7OCQAYZGVmYXVsdFBvaW50ZXJFbnRlclNvdW5kAgQArdbuzgnaG2bwn6esWyAiYWIvYXVkaW8vcG9pbnRlciBlbnRlciBBLm1wMyIsICJhYi9hdWRpby9wb2ludGVyIGVudGVyIEIubXAzIiwgImFiL2F1ZGlvL3BvaW50ZXIgZW50ZXIgQy5tcDMiIF0nAQRib3RzJDEzZjMzYTUxLWMyZmEtNDZkYS1hODhlLWU1YzA2NzU1NmQwMgEnAK3W7s4JvxwKYWJJRE9yaWdpbgIEAK3W7s4JwBwNdG9vbGJveF9za2lsbCcArdbuzgm/HAthYkludGVyZmFjZQIEAK3W7s4JzhwEdHJ1ZScArdbuzgm/HAtkZXNjcmlwdGlvbgIEAK3W7s4J0xwpVGhpcyBza2lsbCBpcyBhbiBpbnRlcmZhY2UgZm9yIHRvb2xib3hlcy4nAK3W7s4JvxwEZm9ybQIEAK3W7s4J/RwHbm90aGluZycArdbuzgm/HARtZW51AgQArdbuzgmFHSjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCt1u7OCb8cBnN5c3RlbQIEAK3W7s4JrB0UYWIuaW50ZXJmYWNlLnRvb2xib3gnAK3W7s4JvxwKYWJJRFN0dWRpbwIEAK3W7s4JwR0kZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwCt1u7OCb8cCHJlbWVtYmVyAgQArdbuzgnmHSjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCt1u7OCb8cC3Rvb2xib3hfYWRkAgQArdbuzgmNHsgLQGNvbnN0IHRvb2xib3hEYXRhID0gdGhhdC50b29sYm94RGF0YTsKY29uc3QgdG9vbGJveFRpdGxlID0gdG9vbGJveERhdGEudGl0bGU7CmNvbnN0IHRvb2xib3hOYW1lID0gdG9vbGJveERhdGEubmFtZTsKY29uc3QgdG9vbGJveFN0dWRpbyA9IHRvb2xib3hEYXRhLnN0dWRpbzsKY29uc3QgZ3JpZERhdGEgPSB0aGF0LmdyaWREYXRhOwoKLy9MT0FESU5HIEJBUj8KCmlmICghbGlua3Muc2hlbGxVdGlscykgewogICAgLy8gTmVlZCBhYlNoZWxsIHRvIHVzZSBpdCdzIGFiTG9nIGZ1bmN0aW9uLgogICAgbGlua3MubGVhcm4uYWJBZGFwdCgnYWJTaGVsbCcpOwp9CgppZiAodG9vbGJveFN0dWRpbyA9PSBmYWxzZSkgewogICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdCh0b29sYm94TmFtZSk7CiAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKGAke3Rvb2xib3hUaXRsZSA/PyB0b29sYm94TmFtZX0gbG9hZGVkYCk7Cn0KZWxzZSB7CiAgICBjb25zdCB0b29sYm94TG9va3VwID0gYXdhaXQgbGlua3Muc2VhcmNoLmhhdGNoKHsgYWJJRDogdG9vbGJveE5hbWUsIHJlY29yZEtleTogdG9vbGJveFN0dWRpbywgYXV0b0hhdGNoOiB0cnVlIH0pOwoKICAgIGlmICh0b29sYm94TG9va3VwLnN1Y2Nlc3MpIHsKICAgICAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKGAke3Rvb2xib3hUaXRsZSA/PyB0b29sYm94TmFtZX0gbG9hZGVkYCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYGlzc3VlIGxvYWRpbmcgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9LCBwbGVhc2UgdHJ5IGFnYWluYCwgbG9nVHlwZTogJ2Vycm9yJyB9KTsKICAgIH0KfQoKY29uc3QgYWN0aXZlVG9vbGJveCA9IGdldEJvdCgic3lzdGVtIiwgYGFiLnRvb2xib3guJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9YCk7CgppZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJHcmlkTWVudU9uQmVmb3JlQ3JlYXRlKSB7CiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkdyaWRGb2N1cyA9IGdyaWREYXRhOwogICAgYXdhaXQgYWIubGlua3MubWVudS5hYk9wZW5NZW51KCJncmlkIik7CiAgICBjb25zdCBtZW51Qm90ID0gZ2V0Qm90KCJiYXNlU2tpbGwiLCBnZXRMaW5rKGFjdGl2ZVRvb2xib3gpKTsKICAgIGlmIChtZW51Qm90KSB7CiAgICAgICAgbWVudUJvdC5vblBvaW50ZXJVcCgpOwogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScArdbuzgm/HAVsZWFybgIEAK3W7s4J1iko8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycArdbuzgm/HAVzdG9yZQIEAK3W7s4J/Sko8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicArdbuzgm/HAZzZWFyY2gCBACt1u7OCaQqKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAK3W7s4JvxwIYWJJZ25vcmUCBACt1u7OCcsqBHRydWUnAK3W7s4JvxwJYWJWZXJzaW9uAgQArdbuzgnQKgUxMC4zOScArdbuzgm/HA1tYW5pZmVzdGF0aW9uAgQArdbuzgnWKijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCt1u7OCb8cEGFiR3JpZE1lbnVBY3Rpb24CBACt1u7OCf0quQtALy8gc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCi8vIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgovLyB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKLy8gICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKLy8gYDsKLy8gdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAovLyAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKLy8gICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwovLyAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyAgICAgfQovLyBgOwovLyB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBgQAovLyAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBudWxsOwovLyBgOwoKLy8gY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7Ci8vIGNvbnN0IG1lbnVCb3QgPSB7fTsKCi8vIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsKLy8gbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwovLyBtZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKLy8gbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKLy8gbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsKLy8gbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwovLyBtZW51Qm90Lm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsKCi8vIGZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspCi8vIHsKLy8gICAgIGNvbnN0IGFjdGl2ZVRvb2xib3ggPSBwb3NzaWJsZVRvb2xib3hlc1tpXTsKLy8gICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7CgovLyAgICAgbWVudUJvdC50b29sYm94X2RhdGEgPSBhY3RpdmVUb29sYm94OwovLyAgICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOwoKLy8gICAgIGlmICghZXh0YW50Qm90KQovLyAgICAgewovLyAgICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCb3QpOwovLyAgICAgfQovLyB9JwCt1u7OCb8cFGFiR3JpZE1lbnVPbkdlbmVyYXRlAgQArdbuzgm3NuICQGNvbnN0IHRvb2xib3hBcnJheSA9IGFiUmVtZW1iZXIudGFncy50b29sYm94X2FycmF5OwoKbGV0IGFsbFRvb2xzTG9hZGVkID0gdHJ1ZTsKCmZvciAobGV0IGkgPSAwOyBpIDwgdG9vbGJveEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBjdXJyZW50VG9vbCA9IHRvb2xib3hBcnJheVtpXS5uYW1lOwoKICAgIGlmICghZ2V0Qm90KCJhYklET3JpZ2luIiwgY3VycmVudFRvb2wpICYmICFnZXRCb3QoY3VycmVudFRvb2wsIHRydWUpKSB7CiAgICAgICAgYWxsVG9vbHNMb2FkZWQgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgIH0KfQoKaWYgKGFsbFRvb2xzTG9hZGVkKSB7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwCt1u7OCb8cDmFiR3JpZE1lbnVJY29uAgQArdbuzgmaOQpsb2NhbF9tYWxsJwCt1u7OCb8cD2FiR3JpZE1lbnVMYWJlbAIEAK3W7s4JpTkHY2F0YWxvZycArdbuzgm/HBNhYkdyaWRNZW51U29ydE9yZGVyAgQArdbuzgmtOQMxMDAnAK3W7s4JvxwPb25BQkluaXRpYWxpemVkAgQArdbuzgmxOSpALy8gbGlua3MubGVhcm4uYWJBZGFwdCgiY2FzdWFsX3Rvb2xib3giKTsnAK3W7s4JvxwNb25Ta2lsbFVwZGF0ZQIEAK3W7s4J3DlXQGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7DQoNCmNvbnNvbGUubG9nKCJbVG9vbGJveF0gTG9hZGluZyBjYXN1YWwga2l0Iik7JwCt1u7OCb8cCnNoZWxsVXRpbHMCBACt1u7OCbQ6KPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAK3W7s4JvxwYYWJHcmlkTWVudU9uQmVmb3JlQ3JlYXRlAgQArdbuzgnbOtQJQGlmIChhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQ2F0YWxvZ05hbWUpIHsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkdyaWRNZW51TGFiZWwiLCBhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQ2F0YWxvZ05hbWUpOw0KfQ0KDQoNCi8vTkVXDQpjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspDQp7DQogICAgY29uc3QgbWVudUJvdCA9IHt9Ow0KDQogICAgbWVudUJvdC5hYk1lbnUgPSB0cnVlOw0KICAgIG1lbnVCb3QuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCiAgICBtZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsNCiAgICBtZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOw0KICAgIG1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiYWRkX2JveCI7DQogICAgbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOw0KICAgIG1lbnVCb3Qub25DbGljayA9IGBAIA0KICAgICAgICBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IA0KICAgICAgICBzZXRUYWdNYXNrKGFiLmxpbmtzLnJlbWVtYmVyLCAibGFzdE9wZW5lZERyb3Bkb3duIiwgbnVsbCk7DQogICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsNCiAgICANCiAgICBjb25zdCBhY3RpdmVUb29sYm94ID0gcG9zc2libGVUb29sYm94ZXNbaV07DQogICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsNCg0KICAgIG1lbnVCb3QudG9vbGJveF9kYXRhID0gYWN0aXZlVG9vbGJveDsNCiAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7DQoNCiAgICBpZiAoIWV4dGFudEJvdCkNCiAgICB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKG1lbnVCb3QpOw0KICAgIH0NCn0NCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwCt1u7OCb8cEmFiR3JpZE1lbnVJdGVtVHlwZQIEAK3W7s4JsEQIZHJvcGRvd24nAK3W7s4JvxwRZHJvcGRvd25Tb3J0T3JkZXICBACt1u7OCblEAzEwMCcArdbuzgm/HA9kcm9wZG93bk9wdGlvbnMCBACt1u7OCb1EBvCfp6xbXScBBGJvdHMkMTc0MTBkODMtN2VlZS00YTFlLWI2MzgtNjU0NjM3NGQxN2MzAScArdbuzgnCRAZzeXN0ZW0CBACt1u7OCcNEEWFiLmludGVyZmFjZS5zY2FuJwCt1u7OCcJEBGZvcm0CBACt1u7OCdVEB25vdGhpbmcnAK3W7s4JwkQLYWJJbnRlcmZhY2UCBACt1u7OCd1EBHRydWUnAK3W7s4JwkQIYWJJZ25vcmUCBACt1u7OCeJEBHRydWUnAK3W7s4JwkQPb25RUkNvZGVTY2FubmVkAgQArdbuzgnnRP0PQGlmICghYnVpbGRlclZlcnNpb24pCnsKICAgIHJldHVybjsKfQoKYWIubG9nKGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHNjYW5uZWQgIiArIHRoYXQpOwoKbGV0IHJlcXVlc3RpbmdBSSA9IGZhbHNlOwppZiAoY29uZmlnQm90LnRhZ3MucmVxdWVzdGluZ0FJKSB7CiAgICBjb25maWdCb3QudGFncy5yZXF1ZXN0aW5nQUkgPSBudWxsOwogICAgcmVxdWVzdGluZ0FJID0gdHJ1ZTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuKQp7CiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsaW5rcy5zdG9yZS5hYlFSUHVibGlzaCh0aGF0KTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4pCnsKICAgIGxldCBzY2FubmVkVVJMOwoKICAgIGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbiA9IG51bGw7CgogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgdHJ5CiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7CiAgICB9CiAgICBjYXRjaCAoZSkKICAgIHsKICAgICAgICBvcy50b2FzdCgibm90IGEgcmVjb2duaXplZCBwcmFjdGljZSBwZXJtaXQiKTsKCiAgICAgICAgY29uc29sZS5sb2coZSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBsZXQgcGhDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygicGgiKTsKICAgIGxldCBpbnN0Q2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImluc3QiKTsKICAgIGxldCBhYkNoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJhYiIpOwogICAgbGV0IGN3Q2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImN3Iik7CgogICAgaWYgKHBoQ2hlY2sgJiYgaW5zdENoZWNrICYmIGFiQ2hlY2sgJiYgY3dDaGVjaykKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKHRoYXQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwogICAgfQoKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MuYWJTY2FuKQp7CiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IG51bGw7CiAgICAKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxldCBzY2FubmVkVVJMOwoKICAgIHRyeSAKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKSAKICAgIHsKICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IHRoYXR9KTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmKHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgiYXNrIikgPT0gImVnZ0NhcnRvbiIpCiAgICB7CiAgICAgICAgaWYgKHJlcXVlc3RpbmdBSSkgewogICAgICAgICAgICBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoInJlcXVlc3RpbmdBSSIsIHRydWUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBvcy5nb1RvVVJMKHNjYW5uZWRVUkwuaHJlZik7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4gewogICAgICAgICAgICBsZXQgbmV3VGFnID0ga2V5OwogICAgICAgICAgICBsZXQgbmV3VmFsdWUgPSB2YWx1ZTsKCiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzW25ld1RhZ10gPSBuZXdWYWx1ZTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmFzaykgewogICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLmFza30pOwogICAgICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucGF0dGVybikgewogICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm59KTsKICAgICAgICB9CiAgICAgICAgCiAgICB9Cn0nAK3W7s4JwkQFc3RvcmUCBACt1u7OCeVUKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAK3W7s4JwkQGc2VhcmNoAgQArdbuzgmMVSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCt1u7OCcJEEGFiQ29yZU1lbnVBY3Rpb24CBACt1u7OCbNVN0Bvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwoKY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gdHJ1ZTsnAK3W7s4JwkQPYWJDb3JlTWVudUxhYmVsAgQArdbuzgnrVQRzY2FuJwCt1u7OCcJEDmFiQ29yZU1lbnVJY29uAgQArdbuzgnwVQ9xcl9jb2RlX3NjYW5uZXInAK3W7s4JwkQTYWJDb3JlTWVudVNvcnRPcmRlcgIEAK3W7s4JgFYBMycArdbuzgnCRAlhYlZlcnNpb24CBACt1u7OCYJWBTEwLjM5JwCt1u7OCcJEFGFiQ29yZU1lbnVDbGlja1NvdW5kAgQArdbuzgmIVhRhYi9hdWRpby9xcl9zY2FuLm1wMycBBGJvdHMkM2E2Y2I5Y2EtYjNiNC00ZDc3LTgyZjYtZmE1OWI1Mjk2ZWM5AScArdbuzgmdVgZzeXN0ZW0CBACt1u7OCZ5WF2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwCt1u7OCZ1WCGFiSWdub3JlAgQArdbuzgm2VgR0cnVlJwCt1u7OCZ1WD2Ryb3Bkb3duT3B0aW9ucwIEAK3W7s4Ju1YG8J+nrFtdJwCt1u7OCZ1WEmFiQ29yZU1lbnVJdGVtVHlwZQIEAK3W7s4JwFYIZHJvcGRvd24nAK3W7s4JnVYRZHJvcGRvd25Tb3J0T3JkZXICBACt1u7OCclWBGF1dG8nAK3W7s4JnVYYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQArdbuzgnOVv4gQGNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCmNvbnN0IGN1cnJlbnRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyAibWFwIiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT0gImJsdWVwcmludCIgPyAiYmx1ZXByaW50IiA6ImdyaWQiOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCi8vIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQovLyB9IGVsc2Ugew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCi8vIH0NCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTmF2aWdhdGlvbk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCg0KY29uc3QgaG9tZVdvcmxkQnV0dG9uID0gew0KICAgIC4uLm1lbnVPcHRpb25zLA0KICAgIGxhYmVsOiAiaG9tZSB3b3JsZCIsDQogICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvMzhhZThiNjk1N2Y0NDgzZDg3MTYxNDFkMWU5OGM5M2YwZTdkY2NlMTViYzVjMTIzYmQwZTllMWFiNjg3Y2MwNS5wbmcnLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIGNvbnN0IGN1cnJlbnRVUkwgPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCk7DQogICAgICAgIGNvbnN0IG9yaWdpbiA9IGN1cnJlbnRVUkwub3JpZ2luOw0KDQogICAgICAgIGxldCBuZXdVUkwgPSBuZXcgVVJMKG9yaWdpbik7DQoNCiAgICAgICAgaWYgKGFiUmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY2hhbm5lbCIsIGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb25maWdCb3QudGFncy5jb21JZCkgew0KICAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImNvbUlkIiwgY29uZmlnQm90LnRhZ3MuY29tSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm93bmVyIiwgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiAicGxheWVyIik7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJpbnN0IiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm1hcFBvcnRhbCIsICdob21lJyk7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJhc2siLCAnaG9tZScpOw0KICAgICAgICANCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgew0KICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgic3R1ZGlvIiwgdGhhdC5pZCk7IA0KICAgICAgICB9DQoNCiAgICAgICAgb3Mub3BlblVSTChuZXdVUkwuaHJlZik7DQogICAgYA0KfTsNCg0KaWYgKCFnZXRCb3QoImlzSG9tZVdvcmxkQ29yZSIsIHRydWUpICYmIGF1dGhCb3QpIHsNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lV29ybGRCdXR0b24pOw0KfQ0KDQppZiAoY3VycmVudFBvcnRhbCA9PSAnbWFwJykgew0KDQogICAgY29uc3QgaG9tZUJhc2VCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQoNCiAgICBpZiAoaG9tZUJhc2VCb3QpIHsNCiAgICAgICAgY29uc3QgaG9tZUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhvbWVCYXNlQm90LnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1L2NkMzhhZmZjMDYwNGJlYWE1ODhkYTIxYWExYmU3NTBiYjNlNzNiM2IzY2FlMjNlYjMwMzA3YzM0NDk0NDU5ZjMucG5nJywNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgY29uc3QgaG9tZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBpZiAoaG9tZUJvdCkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGhvbWVCb3QsIHsgem9vbTogMjAwMCB9KS5jYXRjaCgoKSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZUJ1dHRvbik7DQogICAgfQ0KDQogICAgY29uc3QgcGxhY2VzQXJyID0gW107DQogICAgY29uc3QgcGxhY2VzID0gZ2V0Qm90cygiaG9tZVBsYWNlIiwgdHJ1ZSk7DQogICAgZm9yIChjb25zdCBoUGxhY2Ugb2YgcGxhY2VzKSB7DQogICAgICAgIGlmIChoUGxhY2UudGFncy5ob21lQmFzZSA9PSB0cnVlKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBwbGFjZU9iaiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhQbGFjZS50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2xvY2F0aW9uX29uJywNCiAgICAgICAgICAgIHBsYWNlOiBnZXRMaW5rKGhQbGFjZSksDQogICAgICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgICAgIGlmIChsaW5rcy5wbGFjZSkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGxpbmtzLnBsYWNlLCB7IHpvb206IDIwMDAgfSkuY2F0Y2goZSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICAgICAgYA0KICAgICAgICB9DQoNCiAgICAgICAgcGxhY2VzQXJyLnB1c2gocGxhY2VPYmopOw0KICAgIH0NCg0KICAgIHBsYWNlc0Fyci5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgIGNvbnN0IG5hbWVBID0gYS5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KICAgICAgICBjb25zdCBuYW1lQiA9IGIubGFiZWwudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMDsNCiAgICB9KTsNCg0KICAgIGZvciAoY29uc3Qgc29ydGVkUGxhY2Ugb2YgcGxhY2VzQXJyKSB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHNvcnRlZFBsYWNlKTsNCiAgICB9DQoNCg0KICAgIGNvbnN0IGN1cnJlbnRMb2NhdGlvbkJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiAnY3VycmVudCBsb2NhdGlvbicsDQogICAgICAgIGZvcm1BZGRyZXNzOiAnbmVhcl9tZScsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5za2lsbEJvdC5nb1RvQ3VycmVudExvY2F0aW9uKCk7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goY3VycmVudExvY2F0aW9uQnV0dG9uKTsNCn0NCg0KaWYgKGRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPT0gMCkgew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KfSBlbHNlIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycArdbuzgmdVhBhYkNvcmVNZW51QWN0aW9uAgQArdbuzgnNdwNALy8nAK3W7s4JnVYLYWJJbnRlcmZhY2UCBACt1u7OCdF3BHRydWUnAK3W7s4JnVYPYWJDb3JlTWVudUxhYmVsAgQArdbuzgnWdwZwbGFjZXMnAK3W7s4JnVYEZm9ybQIEAK3W7s4J3XcHbm90aGluZycArdbuzgmdVhNnb1RvQ3VycmVudExvY2F0aW9uAgQArdbuzgnld4AEQGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgb3MuZ2V0R2VvbG9jYXRpb24oKTsNCg0KaWYgKGxvY2F0aW9uLnN1Y2Nlc3MpIHsNCiAgICBjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCiAgICBjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCg0KICAgIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IGN1cnJlbnREaW07DQogICAgfQ0KDQogICAgb3MuZm9jdXNPbih7eDogbG9jYXRpb24ubG9uZ2l0dWRlLCB5OiBsb2NhdGlvbi5sYXRpdHVkZX0sIHtwb3J0YWw6ICdtYXAnLCB6b29tOiAyMDAwfSk7DQp9IGVsc2Ugew0KICAgIG9zLnRvYXN0KCJMb2NhdGlvbiBzZXJ2aWNlcyBub3QgYXZhaWxhYmxlIikNCn0nAK3W7s4JnVYJYWJWZXJzaW9uAgQArdbuzgnmewUxMC4zOScBBGJvdHMkNDkzZmZhNGQtNDZkNC00YTk4LWFlOWMtMTIxMmQ2NTExMzNmAScArdbuzgnsewZzeXN0ZW0CBACt1u7OCe17FGFiLmludGVyZmFjZS52ZXJzaW9uJwCt1u7OCex7DW9uU2tpbGxVcGRhdGUCBACt1u7OCYJ8pwFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJJbnRlcmZhY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiSW50ZXJmYWNlTWlub3JWZXJzaW9uOw0KDQpjb25zb2xlLmxvZygiW0FCSW50ZXJmYWNlXSBMb2FkZWQgQUIgSW50ZXJmYWNlIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycArdbuzgnsexdhYkludGVyZmFjZU1ham9yVmVyc2lvbgIEAK3W7s4Jqn0BMicArdbuzgnsewhhYklnbm9yZQIEAK3W7s4JrH0EdHJ1ZScArdbuzgnsewRmb3JtAgQArdbuzgmxfQdub3RoaW5nJwCt1u7OCex7C2FiSW50ZXJmYWNlAgQArdbuzgm5fQR0cnVlJwCt1u7OCex7CWFiVmVyc2lvbgIEAK3W7s4Jvn0FMTAuMzknAK3W7s4J7HsXYWJJbnRlcmZhY2VNaW5vclZlcnNpb24CBACt1u7OCcR9AjQ0JwEEYm90cyQ0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYBJwCt1u7OCcd9BnN5c3RlbQIEAK3W7s4JyH0TYWIuaW50ZXJmYWNlLm51Z2dldCcArdbuzgnHfQRmb3JtAgQArdbuzgncfQdub3RoaW5nJwCt1u7OCcd9C2FiSW50ZXJmYWNlAgQArdbuzgnkfQR0cnVlJwCt1u7OCcd9CGFiSWdub3JlAgQArdbuzgnpfQR0cnVlJwCt1u7OCcd9DGFiTG9hZE51Z2dldAIEAK3W7s4J7n2YAkBsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0TmFtZTsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK251Z2dldE5hbWU7CmxldCBsb2FkZWROdWdnZXQgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGZvcm1hdHRlZE51Z2dldEFCLCBhYlZlcnNpb246IHRoYXQudmVyc2lvbiwgcmV0dXJuVHlwZTogImRhdGEifSk7Cgpsb2FkZWROdWdnZXQgPSBsb2FkZWROdWdnZXQuc3RhdGVbbnVnZ2V0TmFtZV0ubnVnZ2V0OwoKcmV0dXJuIGxvYWRlZE51Z2dldDsnAK3W7s4Jx30PYWJQdWJsaXNoTnVnZ2V0AgQArdbuzgmHgAGMA0AvL3Nob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiAibnVnTmFtZSIsIGRhdGE6IGRhdGF9KTsgIEFERCBFR0cgSUQgRVZFTlRVQUxMWQpsZXQgdGVzdE51Z2dldCA9IHRoYXQuZGF0YTsKbGV0IGZvcm1hdHRlZE51Z2dldCA9IHtpZDogdGhhdC5udWcsIG51Z2dldDogdGVzdE51Z2dldH07CmxldCB0ZXN0TnVnZ2V0TmFtZSA9IHRoYXQubnVnOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrdGVzdE51Z2dldE5hbWU7CgptYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBmb3JtYXR0ZWROdWdnZXRBQjsKCmxpbmtzLnN0b3JlLmFiUHVibGlzaEFCKHthYjogZm9ybWF0dGVkTnVnZ2V0QUIsIHRhcmdldDogZm9ybWF0dGVkTnVnZ2V0LCBzb3VyY2VFdmVudDogJ3B1Ymxpc2hfbnVnZ2V0J30pOycArdbuzgnHfQ9pbXBsZW1lbnROdWdnZXQCBACt1u7OCZSDAbEHQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXQ7CmxldCBudWdnZXRWZXJzaW9uQ2hlY2sgPSBudWdnZXROYW1lLmluZGV4T2YoIi52Iik7CmxldCB2ZXJzaW9uOwoKaWYgKG51Z2dldFZlcnNpb25DaGVjayAhPSAtMSkKewogICAgbnVnZ2V0TmFtZSA9IG51Z2dldE5hbWUuc3Vic3RyaW5nKDAsIG51Z2dldFZlcnNpb25DaGVjayk7CgogICAgbGV0IHZlcnNpb25DaGVjayA9IHRoYXQubnVnZ2V0LnN1YnN0cmluZyhudWdnZXRWZXJzaW9uQ2hlY2sgKyAyKTsKCiAgICBpZiAoaXNOYU4odmVyc2lvbkNoZWNrKSkKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyh2ZXJzaW9uQ2hlY2ssICJ2ZXJzaW9uIGlzIG5vdCBhIG51bWJlciIpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHZlcnNpb24gPSBOdW1iZXIodmVyc2lvbkNoZWNrKTsKICAgIH0KfQpjb25zb2xlLmxvZyhudWdnZXROYW1lLCB2ZXJzaW9uKTsKbGV0IG51Z0RhdGEgPSBhd2FpdCB0aGlzQm90LmFiTG9hZE51Z2dldCh7bnVnZ2V0TmFtZTogbnVnZ2V0TmFtZSwgdmVyc2lvbjogdmVyc2lvbn0pOwoKaWYgKG51Z0RhdGEgPT0gImFiSUQgbm90IGZvdW5kIikKewogICAgb3MudG9hc3QoIm51Z2dldCBub3QgZm91bmQiKTsKfQplbHNlCnsKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwogICAgbGV0IHRhcmdldFRhZyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLnRvU3RyaW5nKCk7CiAgICBsZXQgdGFyZ2V0TnVnID0gInsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldFRhZy5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwogICAgaW5zZXJ0VGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIG51Z0RhdGEpOwp9JwCt1u7OCcd9DG51Z2dldEJ1dHRvbgIEAK3W7s4JxooB9QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnAK3W7s4Jx30LbnVnZ2V0UGFyc2UCBACt1u7OCbqXAacPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwCt1u7OCcd9DW9uQUJQdWJsaXNoZWQCBACt1u7OCeKmAcEBQGNvbnNvbGUubG9nKHRoYXQuYWIsIHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQoKaWYgKHRoYXQuYWIgPT0gdGFncy5udWdnZXRUb1B1Ymxpc2gpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgcHVibGlzaGVkIik7CgogICAgbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gbnVsbDsKCiAgICBjb25maWdCb3QubWFza3MuYWJWZXJzaW9uID0gbnVsbDsKfScArdbuzgnHfRBvbkFueUJvdHNDaGFuZ2VkAgQArdbuzgmkqAG3BEBpZiAoY29uZmlnQm90ICYmIHRoYXRbMF0uYm90LmlkICE9IHRoaXNCb3QuaWQpIAp7CiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QpIHJldHVybjsgLy8gSWdub3JlIGlmIHRoZSBjb25maWdCb3QgaXNuJ3QgcmVhZHkgeWV0LgoKICAgIGNvbnN0IGVkaXRlZEJvdElEID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdC5yZXBsYWNlKCLwn5SXIiwgIiIpOwoKICAgIGlmICghdGhhdC5maW5kKHggPT4geC5ib3QuaWQgPT0gZWRpdGVkQm90SUQpKSByZXR1cm47IC8vIElmIHRoZSBib3QgY2hhbmdlZCB3YXNuJ3QgYmVpbmcgZWRpdGVkIGJ5IHRoZSB1c2VyIGlnbm9yZSBpdC4KCiAgICBjb25zdCBlZGl0ZWRUYWcgPSBjb25maWdCb3QudGFncy5lZGl0aW5nVGFnOwogICAgY29uc3QgZWRpdGVkQm90ID0gZ2V0Qm90KCJpZCIsIGVkaXRlZEJvdElEKTsKCiAgICBpZiAoZWRpdGVkQm90ICYmIGVkaXRlZFRhZykgCiAgICB7CiAgICAgICAgc2hvdXQoIm51Z2dldFJlc2V0Iik7CgogICAgICAgIHRoaXNCb3QubnVnZ2V0UGFyc2UoeyBlZGl0ZWRCb3QsIGVkaXRlZFRhZyB9KTsKICAgIH0KfScArdbuzgnHfQhvbkNyZWF0ZQIEAK3W7s4J2qwBTEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnAK3W7s4Jx30NcGFja2FnZU51Z2dldAIEAK3W7s4Jp60B+AZAY29uc3QgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKY29uc3QgdGFnVGV4dCA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddOwoKaWYgKGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXggfHwgY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXgpCnsKICAgIGxldCBzdGFydFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXg7CiAgICBsZXQgZW5kUG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXg7CgogICAgaWYgKHN0YXJ0UG9zID09IGVuZFBvcykKICAgIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlIGlmIChzdGFydFBvcyA+IGVuZFBvcykKICAgIHsKICAgICAgICBsZXQgbmV3U3RhcnRQb3MgPSBlbmRQb3M7CiAgICAgICAgbGV0IG5ld0VuZFBvcyA9IHN0YXJ0UG9zOwoKICAgICAgICBzdGFydFBvcyA9IG5ld1N0YXJ0UG9zOwogICAgICAgIGVuZFBvcyA9IG5ld0VuZFBvczsKICAgIH0KCiAgICBsZXQgZGF0YSA9IHRhZ1RleHQuc3Vic3RyaW5nKHN0YXJ0UG9zLCBlbmRQb3MgKyAxKTsKCiAgICBzaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogdGhhdC5udWdnZXQsIGRhdGE6IGRhdGF9KTsKCiAgICBvcy50b2FzdCgibnVnIGlzIHB1Ymxpc2hpbmciLCAxMCk7CgogICAgbGV0IHRhcmdldE51ZyA9ICIubnVnIHsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgiY2Fubm90IHJlYWQgbnVnZ2V0IHRvIGJlIHB1Ymxpc2hlZCIpCn0nAK3W7s4Jx30IcmVtZW1iZXICBACt1u7OCaC0ASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCt1u7OCcd9BnNlYXJjaAIEAK3W7s4Jx7QBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAK3W7s4Jx30Fc3RvcmUCBACt1u7OCe60ASjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCt1u7OCcd9CWxpc3RlbmluZwIEAK3W7s4JlbUBBWZhbHNlJwCt1u7OCcd9CWFiVmVyc2lvbgIEAK3W7s4Jm7UBBTEwLjM5JwEEYm90cyRiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IBJwCt1u7OCaG1AQhwcmVzZW5jZQIEAK3W7s4JorUBKPCflJc4N2U5NTM0Mi1lNDU2LTRiNjMtOTg5MS1kN2E5MjFhZDNlZTcnAK3W7s4JobUBGWFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3ICBACt1u7OCcm1Ac4MQGNvbnN0IHsKICAgIGxhYmVsID0gYCR7YWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fSBpcyB3b3JraW5nYCwKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge30KCmxldCBidXN5SW5kaWNhdG9yID0gewogICAgb25Qb2ludGVyVXA6IG51bGwsCiAgICBvblBvaW50ZXJEb3duOiBudWxsLAogICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgIGJ1c3lMYWJlbDogbGFiZWwsCiAgICBsYWJlbEFsaWdubWVudDogJ2xlZnQnLAogICAgc3RhdGU6IDAsCiAgICBhbmltU3RhdGVzOiBbCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJycsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgIF0sCiAgICBhbmltUmF0ZTogNTAwLAogICAgb25Cb3RBZGRlZDogYEAKICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgb25Cb3RDaGFuZ2VkOiBgQAogICAgICAgIGNvbnN0IG5lZWRSZWZyZXNoID0gdGhhdC50YWdzLnNvbWUodCA9PiB0ID09PSAnYnVzeUxhYmVsJyB8fCB0ID09PSAnc3RhdGUnIHx8IHQgPT09ICdhbmltU3RhdGVzJyk7CiAgICAgICAgaWYgKG5lZWRSZWZyZXNoKSB7CiAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB9CiAgICBgLAogICAgcmVmcmVzaERpc3BsYXk6IGBACiAgICAgICAgaWYgKHRhZ3MuYW5pbVN0YXRlcyAmJiB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBhbmltU3RhdGUgPSB0YWdzLmFuaW1TdGF0ZXNbdGFncy5zdGF0ZV07CgogICAgICAgICAgICB0YWdzLmxhYmVsID0gdGFncy5idXN5TGFiZWwudHJpbSgpICsgYW5pbVN0YXRlLmVsbGlwc2lzOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYW5pbVN0YXRlLmZvcm1BZGRyZXNzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3MubGFiZWwgCiAgICAgICAgfQogICAgYCwKICAgIGFuaW1hdGU6IGBACiAgICAgICAgaWYgKHRhZ3Muc3RhdGUgPj0gdGFncy5hbmltU3RhdGVzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSArPSAxOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgb3Muc2xlZXAodGFncy5hbmltUmF0ZSk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgLi4ucmVzdAp9OwoKY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKGJ1c3lJbmRpY2F0b3IpOwoKcmV0dXJuIG1lbnVCb3Q7JwCt1u7OCaG1AQZzeXN0ZW0CBACt1u7OCZjCARFhYi5pbnRlcmZhY2UubWVudScArdbuzgmhtQEEZm9ybQIEAK3W7s4JqsIBB25vdGhpbmcnAK3W7s4JobUBC2Rlc2NyaXB0aW9uAgQArdbuzgmywgEmVGhpcyBza2lsbCBpcyBkZXNpZ25lZCBmb3IgbWVudSBzdHVmZi4oAK3W7s4JobUBC2FiSW50ZXJmYWNlAXgnAK3W7s4JobUBCmFiT3Blbk1lbnUCBACt1u7OCdrCAbwgQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IG1lbnVUeXBlID0gdGhhdCA/ICJhYiIgKyB0aGF0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhhdC5zbGljZSgxKSArICJNZW51IjogImFiQ29yZU1lbnUiOyAvL3NldCB1cCBhIGNoZWNrIHRvIHNlZSB3aGF0IHR5cGUgb2YgbWVudSBzaG91bGQgYmUgb2NjdXJpbmcgW2NvcmUsIGJvdCwgZ3JpZCwgaW5zdF0KbGV0IG1lbnVTa2lsbHMgPSBnZXRCb3RzKG1lbnVUeXBlICsgIkFjdGlvbiIpOwpsZXQgbWF4T3B0aW9ucyA9IG1lbnVUeXBlID09ICJpbnN0IiA/IDcgOiA1OwpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmJhc2VTa2lsbC4ke21lbnVUeXBlICsgIkFjdGlvbiJ9KHtib3Q6IHRoaXNCb3R9KTtgOwoKbGV0IHNvcnRPcmRlckluZGV4ID0gbWVudVNraWxscy5sZW5ndGg7CmZvciAobGV0IGkgPSAwOyBpIDwgbWVudVNraWxscy5sZW5ndGg7IGkrKykvL0FERCBMT0dJQyBGT1IgTU9SRSBPUFRJT05TIFRIQU4gNSA6IG1heE9wdGlvbnMKewogICAgLy9BbGxvd3MgZm9yIGNvZGUgdG8gZ2V0IGNhbGxlZCBiZWZvcmUgdGhlIG1lbnUgZ2VuZXJhdGVzLCB1c2VmdWwgZm9yIGR5bmFtaWNhbGx5IHNldCBncm91cHMgb3IgZHJvcGRvd25zCiAgICBpZiAobWVudVNraWxsc1tpXS50YWdzW21lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIl0pIHsKICAgICAgICBhd2FpdCB3aGlzcGVyKG1lbnVTa2lsbHNbaV0sIG1lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIik7CiAgICB9IAoKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiSGlkZSJdKSB7CiAgICAgICAgY29udGludWU7CiAgICB9CiAgICAKICAgIGxldCBjdXJyZW50U2tpbGwgPSBtZW51U2tpbGxzW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5iYXNlU2tpbGwgPSAi8J+UlyIgKyBjdXJyZW50U2tpbGwuaWQ7CiAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJMYWJlbCJdOwogICAgYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSWNvbiJdOwogICAgYWJNZW51QnV0dG9uLm9uQ3JlYXRlID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiT25HZW5lcmF0ZSJdOwogICAgYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIlNvcnRPcmRlciJdOwogICAgYWJNZW51QnV0dG9uLmNvbG9yID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcjsKCiAgICBjb25zdCBjbGlja1NvdW5kID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAnQ2xpY2tTb3VuZCddOwogICAgaWYgKGNsaWNrU291bmQgIT0gbnVsbCkgewogICAgICAgIGFiTWVudUJ1dHRvbi5zb3VuZENsaWNrID0gY2xpY2tTb3VuZDsKICAgIH0gZWxzZSB7CiAgICAgICAgZGVsZXRlIGFiTWVudUJ1dHRvbi5zb3VuZENsaWNrOwogICAgfQoKICAgIGNvbnN0IG1lbnVJdGVtVHlwZSA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl07CgogICAgaWYgKG1lbnVJdGVtVHlwZSA9PSAiZHJvcGRvd24iKSB7CiAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duT3B0aW9ucyA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duT3B0aW9uczsKCiAgICAgICAgY29uc3QgcHJldkRyb3Bkb3duID0gbGlua3MucmVtZW1iZXIubGlua3MubGFzdE9wZW5lZERyb3Bkb3duOwogICAgICAgIGlmIChwcmV2RHJvcGRvd24gJiYgcHJldkRyb3Bkb3duLnRhZ3NbbWVudVR5cGUgKyAiQWN0aW9uIl0pIHsKICAgICAgICAgICAgaWYgKHByZXZEcm9wZG93biA9PSBjdXJyZW50U2tpbGwpIHsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICJsYXN0T3BlbmVkRHJvcGRvd24iLCBudWxsKTsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkRlZmF1bHRPcGVuIl0gPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBhYk1lbnVCdXR0b24uZGVmYXVsdE9wZW47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFncy5kcm9wZG93blNvcnRPcmRlciA9PSAiYXV0byIpIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gc29ydE9yZGVySW5kZXg7CiAgICAgICAgICAgICsrc29ydE9yZGVySW5kZXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duU29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXI7CiAgICAgICAgfQogICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJNZW51QnV0dG9uKTsgICAgICAgIAogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gImdyb3VwIikgewogICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhYk1lbnVCdXR0b24ubWVudUl0ZW1zID0gY3VycmVudFNraWxsLnRhZ3MubWVudUl0ZW1zOwogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJpbnB1dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtVHlwZSA9PSAidGV4dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJ0b29sIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gIndpemFyZCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOwogICAgfQp9Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJPcGVuTWVudScsIHsgbWVudTogdGhhdCwgbWVudVR5cGUsIG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsIH0pOycArdbuzgmhtQESYWJDcmVhdGVNZW51QnV0dG9uAgQArdbuzgmV4wGgD0BsZXQgbmV3TWVudUJ1dHRvbiA9IHt9OwoKbGV0IHsKICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwKICAgIC4uLmFkZGl0aW9uYWxUYWdzCn0gPSB0aGF0ID8/IHt9CgppZiAodHlwZW9mIG1lbnVJdGVtU3R5bGUgPT0gJ3N0cmluZycpIHsKICAgIG1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbVN0eWxlLnJlcGxhY2UoL1x1ezFGOUVDfS91LCAnJyk7IAogICAgbWVudUl0ZW1TdHlsZSA9IEpTT04ucGFyc2UobWVudUl0ZW1TdHlsZSk7Cn0KCmZ1bmN0aW9uIGhhc0JvcmRlclN0eWxlKCkgewogICAgaWYgKG1lbnVJdGVtU3R5bGVbImJvcmRlci10b3Atc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItbGVmdC1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1ib3R0b20tc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItcmlnaHQtc3R5bGUiXSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdKSB7CiAgICBpZiAoYWRkaXRpb25hbFRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJNZW51R3JvdXAiXSkgewoKICAgIH0KfQoKbmV3TWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdNZW51QnV0dG9uLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7Cm5ld01lbnVCdXR0b24ubGFiZWxDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUxhYmVsQ29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwpuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yID0gdGhhdC5zaGFkb3dDb2xvciA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVNoYWRvd0NvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5zY2FsZVkgPSAxOwpuZXdNZW51QnV0dG9uLnNvdW5kQ2xpY2sgPSAi8J+nrCIgKyBKU09OLnN0cmluZ2lmeShbCiAgICAiYWIvYXVkaW8vYnV0dG9uIGNsaWNrXzAxLm1wMyIsCiAgICAiYWIvYXVkaW8vYnV0dG9uIGNsaWNrXzAyLm1wMyIsCiAgICAiYWIvYXVkaW8vYnV0dG9uIGNsaWNrXzAzLm1wMyIKXSk7Cgpjb25zdCBtZW51U3R5bGluZyA9IHsKICAgICJib3JkZXItcmFkaXVzIjoiOHB4IiwKICAgICJtYXJnaW4tdG9wIjogIjhweCIsCiAgICAiYm94LXNoYWRvdyI6IGAzcHggNHB4ICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIm1pbi1oZWlnaHQiOiAiNDRweCIsCiAgICAiYm9yZGVyIjogaGFzQm9yZGVyU3R5bGUoKSA/ICIiIDogYDJweCBzb2xpZCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJ3aWR0aCI6ICJjYWxjKDEwMCUgLSA1cHgpIiwKICAgIC4uLm1lbnVJdGVtU3R5bGUKfQoKbmV3TWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gbWVudVN0eWxpbmc7Cgpjb25zdCBjbGlja2VkU3R5bGluZyA9IHsKICAgIC4uLm1lbnVTdHlsaW5nLAogICAgImZpbHRlciI6ICJicmlnaHRuZXNzKDYwJSkiCn0KY29uc3QgYmFzZVN0eWxlID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9ICfwn6esICR7SlNPTi5zdHJpbmdpZnkoY2xpY2tlZFN0eWxpbmcpfSdgCgpuZXdNZW51QnV0dG9uLm9uUG9pbnRlckRvd24gPSBtZW51SXRlbVN0eWxlPy5bIm1hcmdpbi10b3AiXSAhPSAiMHB4IiA/IGJhc2VTdHlsZSA6ICJAIC8vIjsKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJVcCA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsYDsKCmZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQp7CiAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOwp9CgpuZXdNZW51QnV0dG9uID0gY3JlYXRlKG5ld01lbnVCdXR0b24pOwoKcmV0dXJuIG5ld01lbnVCdXR0b247JwCt1u7OCaG1AQ1hYk1lbnVSZWZyZXNoAgQArdbuzgmy8gGdAUBpZiAoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbD8uc3Vic3RyaW5nKDAsMikgPT0gImFiIikKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKICAgIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKICAgIG1hc2tzLm9uS2V5RG93biA9IG51bGw7Cn0nAK3W7s4JobUBCHJlbWVtYmVyAgQArdbuzgnQ8wEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycArdbuzgmhtQENbWFuaWZlc3RhdGlvbgIEAK3W7s4J9/MBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAK3W7s4JobUBEWFiRW52aXJvbm1lbnRNZW51AgQArdbuzgme9AHBEkBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmNvbnN0IGFiTWVudUl0ZW0gPSB7CiAgICBhYk1lbnU6IHRydWUsCiAgICBhYk1lbnVSZWZyZXNoOiAiQGRlc3Ryb3kodGhpc0JvdCk7IiwKICAgIG1hbmlmZXN0YXRpb246IHRhZ3MubWFuaWZlc3RhdGlvbiwKICAgIHJlbWVtYmVyOiB0YWdzLnJlbWVtYmVyLAogICAgcGVyc29uYWxpdHk6IHRhZ3MucGVyc29uYWxpdHksCiAgICBsZWFybjogdGFncy5sZWFybiwKfTsKCmNvbnN0IGFiRW52aXJvbm1lbnRPcHRpb25zID0gdGhpc0JvdC5hYkdldEVudmlyb25tZW50T3B0aW9ucygpOyAKCmZvciAobGV0IGkgPSAwOyBpIDwgYWJFbnZpcm9ubWVudE9wdGlvbnMubGVuZ3RoOyBpKyspIHsgCiAgICBjb25zdCBvcHRpb24gPSBhYkVudmlyb25tZW50T3B0aW9uc1tpXTsKCiAgICBhc3NlcnQodHlwZW9mIG9wdGlvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlciA9PT0gJ251bWJlcicsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfX1dIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyIG11c3QgYmUgYSBudW1iZXIuYCk7CgogICAgYWJNZW51SXRlbS5hYk1lbnVTb3J0T3JkZXIgPSBvcHRpb24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI7CgogICAgY29uc3Qgb3B0aW9uTW9kID0gey4uLmFiTWVudUl0ZW0sIC4uLm9wdGlvbn07CgogICAgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICdidXR0b24nIHx8ICFvcHRpb24ubWVudUl0ZW1UeXBlKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24ob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2Ryb3Bkb3duJykgewogICAgICAgIG9wdGlvbk1vZC5kcm9wZG93blNvcnRPcmRlciA9IG9wdGlvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjsKCiAgICAgICAgLy8gTWFrZSBzdXJlIGVhY2ggZHJvcGRvd24gb3B0aW9ucyBnZXRzIGFiTWVudUl0ZW0gZGVmYXVsdHMuCiAgICAgICAgaWYgKG9wdGlvbi5kcm9wZG93bk9wdGlvbnMgJiYgb3B0aW9uLmRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgb3B0aW9uLmRyb3Bkb3duT3B0aW9ucy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgb3B0aW9uLmRyb3Bkb3duT3B0aW9uc1trXSA9IHsgLi4uYWJNZW51SXRlbSwgLi4ub3B0aW9uLmRyb3Bkb3duT3B0aW9uc1trXSB9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICdncm91cCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUdyb3VwKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICdpbnB1dCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICd0ZXh0JykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAndG9vbCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2wob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ3dpemFyZCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChvcHRpb25Nb2QpOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWVudUl0ZW1UeXBlICR7b3B0aW9uLm1lbnVJdGVtVHlwZX0gaXMgbm90IGltcGxlbWVudGVkLmApOwogICAgICAgIGNvbnRpbnVlOwogICAgfQp9CgovLyB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiUGVyc29uYWxpdHlDb25maWdCdXR0b24pOwoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCRW52aXJvbm1lbnRNZW51JywgeyBtZW51UG9ydGFsOiBjb25maWdCb3QudGFncy5tZW51UG9ydGFsfSApJwCt1u7OCaG1AQVsZWFybgIEAK3W7s4J4IYCKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAK3W7s4JobUBA2dwdAIEAK3W7s4Jh4cCKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAK3W7s4JobUBCGFiSWdub3JlAgQArdbuzgmuhwIEdHJ1ZScArdbuzgmhtQEGc2VhcmNoAgQArdbuzgmzhwIo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScArdbuzgmhtQEGbnVnZ2V0AgQArdbuzgnahwIo8J+UlzRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZicArdbuzgmhtQEFdGVzdHMCBACt1u7OCYGIAijwn5SXYjgzZDk3MmItMDUzNS00MDUxLWI1ODktNDFjZWRhODUzNWYxJwCt1u7OCaG1AQNhc2sCBACt1u7OCaiIAijwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCt1u7OCaG1AQlhYlZlcnNpb24CBACt1u7OCc+IAgUxMC4zOScArdbuzgmhtQERYWJDcmVhdGVNZW51SW5wdXQCBACt1u7OCdWIAp4CQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVJbnB1dCA9IHsNCiAgICBmb3JtOiAiaW5wdXQiLA0KICAgIG1lbnVJdGVtU2hvd1N1Ym1pdFdoZW5FbXB0eTogZmFsc2UsDQogICAgZm9ybUlucHV0TXVsdGlsaW5lOiBudWxsLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVJbnB1dCk7DQoNCnJldHVybiBtZW51Qm90OycArdbuzgmhtQEQYWJDcmVhdGVNZW51VGV4dAIEAK3W7s4J9IoCgQRAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpjb25zdCB7DQogICAgbWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIC4uLnJlc3QNCn0gPSB0aGF0Ow0KDQpsZXQgbWVudVRleHQgPSB7DQogICAgZm9ybTogInRleHQiLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgcG9pbnRhYmxlOiBmYWxzZSwNCiAgICBjb2xvcjogIndoaXRlIiwNCiAgICBtZW51SXRlbVN0eWxlOiB7DQogICAgICAgICJwYWRkaW5nLXRvcCI6ICI2cHgiLA0KICAgICAgICAicGFkZGluZy1ib3R0b20iOiAiNnB4IiwNCiAgICB9LA0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZTogew0KICAgICAgICAid2hpdGUtc3BhY2UiOiAicHJlLXdyYXAiLA0KICAgICAgICAuLi5tZW51SXRlbUxhYmVsU3R5bGUsDQogICAgfSwNCiAgICAuLi5yZXN0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRleHQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAK3W7s4JobUBEGFiQ3JlYXRlTWVudVRvb2wCBACt1u7OCfaOAo4BQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVUb29sID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51VG9vbCk7DQoNCnJldHVybiBtZW51Qm90OycArdbuzgmhtQESYWJDcmVhdGVNZW51V2l6YXJkAgQArdbuzgmFkAKSAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51V2l6YXJkID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51V2l6YXJkKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCt1u7OCaG1ARRhYkNyZWF0ZU1lbnVEcm9wZG93bgIEAK3W7s4JmJECkyBAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAodGhhdC5kcm9wZG93blNvcnRPcmRlciA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVEcm9wZG93bjogZHJvcGRvd25Tb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgb3V0ZXJNZW51QnV0dG9uID0gew0KICAgIC4uLnRoYXQsDQogICAgZm9ybUFkZHJlc3M6IHRoYXQuZm9ybUFkZHJlc3MgPz8gImFycm93X3JpZ2h0IiwNCiAgICBkcm9wZG93bk9wZW46IGZhbHNlLA0KICAgIG9uQm90QWRkZWQ6IGBADQogICAgICAgIHRoaXNCb3QudXBkYXRlU3R5bGUoKTsNCiAgICBgLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIHRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9ICR7dGhhdC5kcm9wZG93blNvcnRPcmRlcn0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IHRydWUpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnModGFncy5kcm9wZG93bk9wdGlvbnMsIHRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIpOw0KICAgICAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25EZXN0cm95OiBgQA0KICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgIGAsDQogICAgdXBkYXRlU3R5bGU6IGBADQogICAgICAgIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsOw0KICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gImFycm93X3JpZ2h0IjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4pIHsNCiAgICAgICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImZvcm1BZGRyZXNzIiwgImFycm93X2Ryb3BfZG93biIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAibWVudUl0ZW1TdHlsZSIsIHsuLi50YWdzLm1lbnVJdGVtU3R5bGUsICJib3JkZXJCb3R0b21MZWZ0UmFkaXVzIjogIjAiLCAiYm9yZGVyQm90dG9tUmlnaHRSYWRpdXMiOiAiMCJ9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25Cb3RDaGFuZ2VkOiBgQA0KICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCdkcm9wZG93bk9wZW4nKSkgew0KICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVTdHlsZSgpOw0KICAgICAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IHRydWUpIHsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51RHJvcGRvd25PcGVuZWQiLCB0aGlzQm90KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGAsDQogICAgYWJNZW51RHJvcGRvd25PcGVuZWQ6IGBADQogICAgICAgIGlmICh0YWdzLmlnbm9yZU9wZW5Ecm9wZG93blJ1bGVzID09IHRydWUpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhhdCAhPSB0aGlzQm90KSB7DQogICAgICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSBmYWxzZTsNCiAgICAgICAgICAgIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKGxpbmtzICYmIGxpbmtzLmJhc2VTa2lsbCkgew0KICAgICAgICAgICAgICAgIHNldFRhZ01hc2soYWIubGlua3MucmVtZW1iZXIsICJsYXN0T3BlbmVkRHJvcGRvd24iLCB0YWdzLmJhc2VTa2lsbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICBgDQp9Ow0KDQppZiAodGhhdC5mb3JtQWRkcmVzcyAmJiB0aGF0LmZvcm1BZGRyZXNzICE9ICJhcnJvd19yaWdodCIpIHsNCiAgICBvdXRlck1lbnVCdXR0b24uY3VzdG9tRm9ybUFkZHJlc3MgPSB0cnVlOw0KfQ0Kb3V0ZXJNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSB0aGF0LmRyb3Bkb3duU29ydE9yZGVyOw0KDQpjb25zdCBtZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24ob3V0ZXJNZW51QnV0dG9uKTsNCm1lbnVCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zID0gZ2VuZXJhdGVNZW51T3B0aW9uczsNCg0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNZW51T3B0aW9ucyAob3B0aW9ucywgc29ydE9yZGVyKSB7DQogICAgY29uc3QgbWVudUJvdHMgPSBbXTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyArK2kpIHsNCg0KICAgICAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm9wdGlvbnNbaV0sDQogICAgICAgICAgICBhYkRyb3Bkb3duT3B0aW9uOiB0cnVlLA0KICAgICAgICAgICAgY2xlYXJEcm9wZG93bk1lbnU6IGBADQogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsNCiAgICAgICAgICAgIGANCiAgICAgICAgfTsNCg0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSBOdW1iZXIoc29ydE9yZGVyKSArICgoaSArIDEpIC8gMTAwMCk7DQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbF0gPSB0cnVlOw0KDQogICAgICAgIGlmIChpID09IG9wdGlvbnMubGVuZ3RoIC0gMSkgew0KICAgICAgICAgICAgaWYgKG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyUmFkaXVzIl0gPSAiMCAwIDhweCA4cHgiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAgMCA4cHggOHB4Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyUmFkaXVzIl0gPSAiMCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclRvcCJdID0gIm5vbmUiOw0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bIm1hcmdpblRvcCJdID0gIjAiOw0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bInBhZGRpbmdMZWZ0Il0gPSAiMzVweCI7DQoNCiAgICAgICAgY29uc3QgbmV3TWVudUJvdCA9IGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld01lbnVCdXR0b24pOw0KICAgICAgICBtZW51Qm90cy5wdXNoKG5ld01lbnVCb3QpOw0KICAgIH0NCg0KICAgIG1lbnVCb3QudGFncy5tZW51Qm90cyA9IGdldExpbmsobWVudUJvdHMpOw0KfQ0KDQppZiAodGhhdC5kZWZhdWx0T3Blbikgew0KICAgIG1lbnVCb3Qub25Qb2ludGVyVXAoKTsNCiAgICBtZW51Qm90Lm9uQ2xpY2soKTsNCn0NCg0KcmV0dXJuIG1lbnVCb3Q7DQoNCicArdbuzgmhtQERYWJDcmVhdGVNZW51R3JvdXACBACt1u7OCayxAr0fQC8qDQogICBFWEFNUExFDQogICBjb25zdCBtZW51R3JvdXAgPSB7DQogICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGdyb3VwU29ydE9yZGVyOiAxLA0KICAgICAgICBtZW51SXRlbXM6IFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDIiLA0KICAgICAgICAgICAgICAgIGNvbG9yOiAib3JhbmdlIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICBtZW51SXRlbVR5cGU6ICJkcm9wZG93biIsDQogICAgICAgICAgICAgICAgZHJvcGRvd25PcHRpb25zOiBbDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDEiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMyIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICB9DQogICAgICAgIF0NCiAgICB9DQoqLw0KDQppZiAgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAoIXRoYXQuZ3JvdXBTb3J0T3JkZXIpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudUdyb3VwOiBncm91cFNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCB7DQogICAgbWVudUl0ZW1TdHlsZSA9IHt9LA0KICAgIG1lbnVJdGVtcyA9IFtdLA0KICAgIC4uLmFkZGl0aW9uYWxUYWdzDQp9ID0gdGhhdCA/PyB7fQ0KDQpjb25zdCBtZW51Qm90cyA9IFtdOw0KZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51SXRlbXMubGVuZ3RoOyArK2kpIHsNCg0KICAgIGxldCBuZXdNZW51QnV0dG9uID0ge307DQoNCiAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSBOdW1iZXIodGhhdC5ncm91cFNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMCk7DQoNCiAgICBsZXQgaW5kaXZNZW51SXRlbVN0eWxlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtU3R5bGUgPz8ge307DQogICAgbGV0IGluZGl2TWVudVR5cGUgPSBtZW51SXRlbXNbaV0ubWVudUl0ZW1UeXBlID8/IHVuZGVmaW5lZDsNCiAgICBsZXQgaW5kaXZBZGRpdGlvbmFsVGFncyA9IG1lbnVJdGVtc1tpXTsNCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgIGRlbGV0ZSBpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVN0eWxlIl07DQogICAgfQ0KICAgIGlmIChpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVR5cGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl07DQogICAgfQ0KDQogICAgY29uc3QgYmFzZVN0eWxpbmcgPSB7DQogICAgICAgICJib3JkZXJUb3AiOiAibm9uZSIsDQogICAgICAgICJtYXJnaW5Ub3AiOiAiMCINCiAgICB9DQoNCiAgICBpZiAoaSA9PSBtZW51SXRlbXMubGVuZ3RoIC0gMSAmJiBpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQogICAgZWxzZSBpZiAoaSA9PSBtZW51SXRlbXMubGVuZ3RoIC0gMSkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLmJhc2VTdHlsaW5nLA0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICIwIDAgOHB4IDhweCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9IGVsc2UgaWYgKGkgPT0gMCkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiOHB4IDhweCAwIDAiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7fQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLmJhc2VTdHlsaW5nLA0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICIwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQ0KICAgIHsNCiAgICAgICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBpbmRpdkFkZGl0aW9uYWxUYWdzKQ0KICAgIHsNCiAgICAgICAgbmV3TWVudUJ1dHRvblt0YWddID0gaW5kaXZBZGRpdGlvbmFsVGFnc1t0YWddOw0KICAgIH0NCg0KICAgIGxldCBuZXdNZW51Qm90Ow0KICAgIHN3aXRjaChpbmRpdk1lbnVUeXBlKSB7DQogICAgICAgIGNhc2UgImRyb3Bkb3duIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLi4ubmV3TWVudUJ1dHRvbiwNCiAgICAgICAgICAgICAgICAgICAgImRyb3Bkb3duU29ydE9yZGVyIjogTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMCkNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJpbnB1dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ0ZXh0IjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidG9vbCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUb29sKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgIndpemFyZCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgIH0NCiAgICBtZW51Qm90cy5wdXNoKG5ld01lbnVCb3QpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdHM7JwCt1u7OCaG1AQtwZXJzb25hbGl0eQIEAK3W7s4J6tACKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAK3W7s4JobUBF2FiR2V0RW52aXJvbm1lbnRPcHRpb25zAgQArdbuzgmR0QLrfkBjb25zdCBvcHRpb25zID0gW107CgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiBgaGlkZWAsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJ2aXNpYmlsaXR5X29mZiIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgIH0pLAogICAgfSkKfQoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInNsZWVwIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAibmlnaHRzX3N0YXkiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYlNldEF3YWtlKHsgYXdha2U6IGZhbHNlIH0pCiAgICAgICAgfSksCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJvcHRpbWl6ZSBtb2RlIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAyMDAsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgIH0pLAogICAgcmVmcmVzaERpc3BsYXk6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA/IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JyA6IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA9IGZhbHNlIDogY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSB0cnVlOwogICAgICAgIHRoaXNCb3Qub25DcmVhdGUoKTsKICAgIH0pLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiY3VzdG9taXplOiBhYiBwZXJzb25hbGl0eSIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMzAwLAogICAgbWVudUl0ZW1UeXBlOiAnZHJvcGRvd24nLAogICAgZHJvcGRvd25PcHRpb25zOiBbCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYG5hbWU6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImN1YmUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksIHsgdGl0bGU6ICd3aGF0IHdvdWxkIHlvdSBsaWtlIHRvIGNhbGwgbWU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdhYlBlcnNvbmFsaXR5Q2hhbmdlJywgeyBhYkJ1aWxkZXJJZGVudGl0eTogbmFtZSB9KTsKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGFpIG1vZGVsOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgbW9kZWxzID0gY29uZmlnQm90LnRhZ3MuYWlDaGF0TW9kZWxzOwoKICAgICAgICAgICAgICAgIGlmIChtb2RlbHMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zID0gW107CgogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgbW9kZWxzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucHVzaCh7IGxhYmVsOiBlbnRyeS5uYW1lLCB2YWx1ZTogZW50cnkubmFtZSB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRNb2RlbEluZGV4ID0gb3B0aW9ucy5maW5kSW5kZXgobyA9PiBvLnZhbHVlID09PSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkT3B0aW9uID0gYXdhaXQgb3Muc2hvd0lucHV0KGN1cnJlbnRNb2RlbEluZGV4LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnd2hhdCBhaSBtb2RlbCB3b3VsZCB5b3UgbGlrZSBtZSB0byB1c2U/JywKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2xpc3QnLAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogb3B0aW9ucywKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkT3B0aW9uICYmIHNlbGVjdGVkT3B0aW9uLnZhbHVlICE9PSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCkgewogICAgICAgICAgICAgICAgICAgICAgICBzaG91dCgnYWJQZXJzb25hbGl0eUNoYW5nZScsIHsgYWJQcmVmZXJyZWRBSU1vZGVsOiBzZWxlY3RlZE9wdGlvbi52YWx1ZSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChhdXRoQm90KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnNob3dBbGVydCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3NvbWV0aGluZyB3ZW50IHdyb25nJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdmYWlsZWQgdG8gZ2V0IGxpc3Qgb2YgYWkgY2hhdCBtb2RlbHMuJwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnNob3dBbGVydCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3NpZ24gaW4gcmVxdWlyZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJ3lvdSBtdXN0IHNpZ24gaW4gdG8gdXNlIGFpLicKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGFpIGFsd2F5cyBhcHByb3ZlOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJBbHdheXNBcHByb3ZlUGF0Y2hCb3RzID8gJ3llcycgOiAnbm8nfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnZWRpdF9ub3RlJywKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgc2hvdXQoJ2FiUGVyc29uYWxpdHlDaGFuZ2UnLCB7IGFiQWx3YXlzQXBwcm92ZVBhdGNoQm90czogIWxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJBbHdheXNBcHByb3ZlUGF0Y2hCb3RzIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvciwgeyB0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbWUgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdhYlBlcnNvbmFsaXR5Q2hhbmdlJywgeyBhYkJhc2VDb2xvcjogY29sb3IsIGFiQmFzZVN0cm9rZUNvbG9yOiBjb2xvciB9KTsKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYG1lbnUgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvciwgeyB0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudXMgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdhYlBlcnNvbmFsaXR5Q2hhbmdlJywgeyBhYkJhc2VNZW51Q29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSB0ZXh0IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUxhYmVsQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVMYWJlbENvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51IHRleHQgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdhYlBlcnNvbmFsaXR5Q2hhbmdlJywgeyBhYkJhc2VNZW51TGFiZWxDb2xvcjogY29sb3IsIGFiQmFzZVNoYWRvd0NvbG9yOiBjb2xvciB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGJvdCBsYWJlbCBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3IsIHsgdHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IGJvdCB0ZXh0IHRvIGJlPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJQZXJzb25hbGl0eUNoYW5nZScsIHsgYWJCYXNlTGFiZWxDb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBkZWZhdWx0IHBvcnRhbCBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyAnIzI2MzIzOCd9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgcG9ydGFsQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB5b3VyIHBvcnRhbCB0byBsb29rIGxpa2U/JyB9KTsKICAgICAgICAgICAgICAgIGlmICghcG9ydGFsQ29sb3IpIHsKICAgICAgICAgICAgICAgICAgICBwb3J0YWxDb2xvciA9ICcjMjYzMjM4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNob3V0KCdhYlBlcnNvbmFsaXR5Q2hhbmdlJywgeyBhYkJhc2VHcmlkUG9ydGFsQ29sb3I6IHBvcnRhbENvbG9yIH0pOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBkZWZhdWx0IG1hcCBwb3J0YWwgYmFzZW1hcGAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvdXQoInNob3dBQkJhc2VtYXBPcHRpb25zIik7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogImRlZmF1bHQgc2V0dGluZ3MiLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgICAgICAgICAgY29sb3I6ICdyZWQnLAogICAgICAgICAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJQZXJzb25hbGl0eVJlc2V0Jyk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgXQp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiY2hhdCIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNDAwLAogICAgZm9ybUFkZHJlc3M6ICJjaGF0IiwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBzaG91dCgnYWJDaGF0QmFyT3BlbicpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgfSksCn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJudWdnZXRzIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1MDAsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRhZ3MubnVnTWFuYWdlciA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuaW50ZXJmYWNlLm51Z2dldCcpKTsgCiAgICAgICAgCiAgICAgICAgaWYgKGxpbmtzLm51Z01hbmFnZXIudGFncy5saXN0ZW5pbmcpIHsgCiAgICAgICAgICAgIHRhZ3Mub25DbGljayA9IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IAogICAgICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCBudWxsKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94YDsgCiAgICAgICAgfSBlbHNlIHsgCiAgICAgICAgICAgIHRhZ3Mub25DbGljayA9IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IAogICAgICAgICAgICAgICAgaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIHRydWUsICdsb2NhbCcpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGBjaGVja19ib3hfb3V0bGluZV9ibGFua2A7CiAgICAgICAgfQogICAgfSksCn0pCgppZiAobGlua3MucHJlc2VuY2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJjYW1lcmEgcHJlc2VuY2UiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1MTAsCiAgICAgICAgcHJlc2VuY2U6IHRhZ3MucHJlc2VuY2UsCiAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkID0gKHRoYXQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ2NhbWVyYUVuYWJsZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgb3MuYWRkQm90TGlzdGVuZXIobGlua3MucHJlc2VuY2UsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQpOwoKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0pLAogICAgICAgIHJlZnJlc2hEaXNwbGF5OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLnByZXNlbmNlLnRhZ3MuY2FtZXJhRW5hYmxlZCA/IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JyA6IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIH0pLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5wcmVzZW5jZSwgJ2NhbWVyYUVuYWJsZWQnLCAhISFsaW5rcy5wcmVzZW5jZS50YWdzLmNhbWVyYUVuYWJsZWQsICdsb2NhbCcpOwogICAgICAgIH0pLAogICAgICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBvcy5yZW1vdmVCb3RMaXN0ZW5lcihsaW5rcy5wcmVzZW5jZSwgJ29uQm90Q2hhbmdlZCcsIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCk7CiAgICAgICAgfSkKICAgIH0pCgogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogImN1cnNvciBwcmVzZW5jZSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDUyMCwKICAgICAgICBwcmVzZW5jZTogdGFncy5wcmVzZW5jZSwKICAgICAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQgPSAodGhhdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygnY3Vyc29yRW5hYmxlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5hZGRCb3RMaXN0ZW5lcihsaW5rcy5wcmVzZW5jZSwgJ29uQm90Q2hhbmdlZCcsIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCk7CgogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfSksCiAgICAgICAgcmVmcmVzaERpc3BsYXk6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgbGlua3MucHJlc2VuY2UudGFncy5jdXJzb3JFbmFibGVkID8gdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnIDogdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLnByZXNlbmNlLCAnY3Vyc29yRW5hYmxlZCcsICEhIWxpbmtzLnByZXNlbmNlLnRhZ3MuY3Vyc29yRW5hYmxlZCwgJ2xvY2FsJyk7CiAgICAgICAgfSksCiAgICAgICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIG9zLnJlbW92ZUJvdExpc3RlbmVyKGxpbmtzLnByZXNlbmNlLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkKTsKICAgICAgICB9KQogICAgfSkKfQoKaWYgKGxpbmtzLmdwdCkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDYwMCwKICAgICAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBpZiAoIWF1dGhCb3QpIHsKICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gJ0ZyZWVQbGF5JyB8fCBhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSAnZWRpdCAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgcHJvbXB0JzsgdGFncy5ncHRCb3QgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmFjdGlvbi5hc2snKSk7CiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpOwogICAgICAgIH0pLAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiZ3JpZCBzbmFwIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA3MDAsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJwogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiYm90IHNuYXAiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDgwMCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgfSksCn0pCgppZiAoYXV0aEJvdCkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogImFjY291bnQiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA5MDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJiYWRnZSIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBvcy5zaG93QWNjb3VudEluZm8oKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9KSwKICAgIH0pCn0KCmlmIChsaW5rcy50ZXN0cykgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInJlY29yZCB0ZXN0IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAwMCwKICAgICAgICBmb3JtQWRkcmVzczogInNjaWVuY2UiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgc2hvdXQoJ2FiUmVjb3JkVGVzdCcpOwogICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIH0pLAogICAgfSkKCiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAicmVjb3JkIHRyYWNlIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTEwMCwKICAgICAgICBmb3JtQWRkcmVzczogInRpbWVsaW5lIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHNob3V0KCdhYlJlY29yZFRyYWNlJyk7CiAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfSksCiAgICB9KQp9CgppZiAoZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaG9tZS5lZ2ciKSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInNhdmUgaG9tZSBlZ2ciLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMjAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAiZWdnIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGdldEJvdCgic3lzdGVtIiwgImFiLmhvbWUuZWdnIikuc2F2ZURhdGEoKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9KSwKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoZWNrIGZvciAiICsgYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgdXBkYXRlcyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTMwMCwKICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICBsZWFybjogdGFncy5sZWFybiwKICAgIGNoZWNrRm9yVXBkYXRlczogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgIC8vIFRlbXBvcmFyaWx5IHJlcGxhY2Ugd2l0aCBidXN5IGluZGljYXRvciB3aGlsZSBjaGVja2luZyBmb3IgdXBkYXRlcy4KICAgICAgICB0YWdzLmFiTWVudSA9IGZhbHNlOwoKICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IGFiLmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcih7CiAgICAgICAgICAgIGFiTWVudTogdHJ1ZSwKICAgICAgICAgICAgbGFiZWw6ICdjaGVja2luZyBmb3IgdXBkYXRlcyB0byAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IHRhZ3MuYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIsCiAgICAgICAgfSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrID0gYXdhaXQgYWIuYWJDaGVja0FCVXBkYXRlQXZhaWxhYmxlKHsgZGV0YWlsZWQ6IHRydWUgfSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gbnVsbDsKCiAgICAgICAgICAgIC8vIEJyaW5nIGJhY2sgdGhlIHVwZGF0ZSBidXR0b24uCiAgICAgICAgICAgIHRhZ3MuYWJNZW51ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjayAmJiB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay5zdWNjZXNzKSB7CiAgICAgICAgICAgIGlmIChnbG9iYWxUaGlzLmFiVXBkYXRlQ2hlY2tlcikgewogICAgICAgICAgICAgICAgYWJVcGRhdGVDaGVja2VyLnRhZ3MudXBkYXRlQXZhaWxhYmxlID0gdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sudXBkYXRlQXZhaWxhYmxlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sudXBkYXRlQXZhaWxhYmxlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhYkZpbGVzV2l0aFVwZGF0ZXMgPSB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay5hYkZpbGVDaGVja3MuZmlsdGVyKGYgPT4gZi51cGRhdGVBdmFpbGFibGUpOwoKICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IG9zLnNob3dDb25maXJtKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1VwZGF0ZXMgZm91bmQgZm9yICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogJ1RoZXJlIGFyZSAnICsgYWJGaWxlc1dpdGhVcGRhdGVzLmxlbmd0aCArICcgZmlsZSB1cGRhdGVzIGZvciAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJy4gV291bGQgeW91IGxpa2UgdG8gaW5zdGFsbCB0aGUgdXBkYXRlcyBub3c/IFlvdSBhbmQgYW55IGNvbm5lY3RlZCB1c2VycyB3aWxsIGF1dG9tYXRpY2FsbHkgcmVmcmVzaCB0aGUgcGFnZSBhZnRlciB0aGUgdXBkYXRlIGlzIGNvbXBsZXRlLicsCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsVGV4dDogJ05vdCBub3cnLAogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1UZXh0OiAnWWVzJwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgICAgICAgICAgbGlua3MubGVhcm4udXBkYXRlQUIoKTsKICAgICAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWIubGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdChhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIGlzIGFscmVhZHkgdXAtdG8tZGF0ZSEnKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1hc2tzLmxhYmVsID0gJ3VwZGF0ZSBjaGVjayBmYWlsZWQnOwogICAgICAgIH0KICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRoaXNCb3QuY2hlY2tGb3JVcGRhdGVzKCk7CiAgICB9KSwKICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcikgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICB9CiAgICB9KSwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogInBlcm1hbmVudGx5IGRlbGV0ZSIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogOTk5OSwKICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGFncy5sYWJlbCArPSAiICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwogICAgICAgIHRhZ3MuY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbnRyYXN0Q29sb3IgPz8gIiNEOTMwMzAiOwogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ1Blcm1hbmVudGx5IGRlbGV0ZSAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgY29udGVudDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIGZyb20gJyArIGxpbmtzLmxlYXJuLnRhZ3MuYWJJbnN0ICsgJz8gVGhpcyBpcyBub3QgcmV2ZXJzaWJsZSEnLAogICAgICAgIH0pCgogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CgogICAgICAgIGNvbnN0IGFiQm90cyA9IGdldEJvdHMoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtICYmCiAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtLnN0YXJ0c1dpdGgoJ2FiJyk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgZGVzdHJveShhYkJvdHMpOwogICAgICAgIH0KICAgIH0pLAp9KQoKcmV0dXJuIG9wdGlvbnM7JwCt1u7OCaG1AR5hYkNyZWF0ZVRvb2xib3hEcm9wZG93bk9wdGlvbnMCBACt1u7OCf3PA+MTQGNvbnN0IHRvb2xib3hUb29scyA9IFsuLi50aGF0LnRvb2xBcnJheV0gPz8gW107DQpjb25zdCB0b29sYm94TmFtZSA9IHRoYXQudG9vbGJveE5hbWUgPz8gIktpdCAiOw0KY29uc3QgdG9vbGJveCA9IHRoYXQudG9vbGJveDsNCmNvbnN0IGdyaWRJbmZvcm1hdGlvbiA9ICh0aGF0Py5ncmlkSW5mb3JtYXRpb24gJiYgdGhhdD8uZ3JpZEluZm9ybWF0aW9uICE9IHVuZGVmaW5lZCkgPyB0aGF0Py5ncmlkSW5mb3JtYXRpb24gOiBhYlJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQoNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMudG9vbGJveCA9IGdldExpbmsodG9vbGJveCk7DQptZW51T3B0aW9ucy5ncmlkSW5mb3JtYXRpb24gPSBncmlkSW5mb3JtYXRpb247DQptZW51T3B0aW9ucy5zZWFyY2ggPSB0YWdzLnNlYXJjaDsNCm1lbnVPcHRpb25zLmFydGlmYWN0ID0gdGFncy5hcnRpZmFjdDsNCi8vbWVudU9wdGlvbnMuZm9ybUFkZHJlc3MgPSAiaGFyZHdhcmUiOw0KDQppZiAodG9vbGJveFRvb2xzLmxlbmd0aCA9PT0gMCkgew0KICAgIGNvbnN0IG1lc3NhZ2UgPSB0b29sYm94TmFtZSArICIgZG9lcyBub3QgaGF2ZSBhbnkgdG9vbHMgbGlzdGVkIGluIHRoZSB0b29sX2FycmF5IHRhZyI7DQoNCiAgICBhYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIG1lc3NhZ2UpOw0KICAgIG9zLnRvYXN0KG1lc3NhZ2UsIDUpOw0KICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7DQp9DQoNCmZvciAobGV0IHRvb2wgb2YgdG9vbGJveFRvb2xzKSB7DQogICAgY29uc3QgdG9vbEJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiB0b29sLm5hbWUsDQogICAgICAgIHRhcmdldEFCOiB0b29sLnRhcmdldEFCLA0KICAgICAgICBpc0FydGlmYWN0OiB0b29sLmFydGlmYWN0IHx8IGZhbHNlLA0KICAgICAgICBvbkNsaWNrOmBADQogICAgICAgICAgICBpZiAodGFncy5pc0FydGlmYWN0KSB7DQogICAgICAgICAgICAgICAgY29uc3QgYWJBcnRpZmFjdFNoYXJkID0gew0KICAgICAgICAgICAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJveEJvdDogdGFncy50b29sYm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzOiBbDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUINCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgbGlua3MuYXJ0aWZhY3QuYWJDcmVhdGVBcnRpZmFjdFByb21pc2VCb3Qoew0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0TmFtZTogdGFncy50YXJnZXRBQiwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdEluc3RhbmNlSUQ6IHV1aWQoKSwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdFNoYXJkLA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsNCiAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAndG9vbCcsDQogICAgICAgICAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgLA0KICAgIH07DQoNCiAgICBpZiAodG9vbC5mb3JtQWRkcmVzcykgew0KICAgICAgICB0b29sQnV0dG9uLmZvcm1BZGRyZXNzID0gdG9vbC5mb3JtQWRkcmVzczsNCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaCh0b29sQnV0dG9uKTsNCn0NCg0KcmV0dXJuIGRyb3Bkb3duT3B0aW9uczsnAK3W7s4JobUBEG9uQUJBdXRoQm90QWRkZWQCBACt1u7OCeHjAxhAc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsnAK3W7s4JobUBCGFydGlmYWN0AgQArdbuzgn64wMo8J+Ulzc4ZTQxNTAzLWM5MzMtNGY4YS04MTdhLWJhOTdiZjhkNWQyNycBBGJvdHMkYzc4YWE2NjMtZDA1Yy00ZWM0LWJjMmMtMjZmZDUxNTYwYjk3AScArdbuzgmh5AMVYWJDcmVhdGVDdWJlRmFjZVBsYW5lAgQArdbuzgmi5AOJMUBsZXQgeyAKICAgIGJvdCwKICAgIGRpbWVuc2lvbiwKICAgIHNwYWNlID0gJ3RlbXBMb2NhbCcsCiAgICBkZWJ1ZywKICAgIGZhY2VPZmZzZXQgPSAwLjAxLAogICAgcG9pbnRhYmxlID0gZmFsc2UsCiAgICB0aWNrSW50ZXJ2YWxNUyA9IDUwMCwKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge307Cgphc3NlcnQobGlua3MudXRpbHMuaXNCb3QoYm90KSwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3QgaXMgYSByZXF1aXJlZCBCb3QgcGFyYW1ldGVyLmApOwphc3NlcnQoZGltZW5zaW9uLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRpbWVuc2lvbiBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKYXNzZXJ0KHJlc3QuZm9ybSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGZvcm0gaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LmFuY2hvclBvaW50ID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYW5jaG9yUG9pbnQgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQm90QWRkZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKCmNvbnN0IGZhY2VQbGFuZU1vZCA9IHsKICAgIHNwYWNlLAogICAgYW5jaG9yUG9pbnQ6ICdjZW50ZXInLAogICAgZGVidWcsCiAgICBmYWNlT2Zmc2V0LAogICAgZm9ybTogJ3Nwcml0ZScsCiAgICBkaW1lbnNpb24sCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIHBvaW50YWJsZSwKICAgIHRpY2tJbnRlcnZhbE1TLAogICAgdHJhbnNmb3JtZXI6IGJvdC5pZCwKICAgIG9uQm90QWRkZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnN0YXJ0VGljaygpOwogICAgfSksCiAgICBvbkJvdENoYW5nZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCd0aWNrSW50ZXJ2YWxNUycpKSB7CiAgICAgICAgICAgIHRoaXNCb3Quc3RvcFRpY2soKTsKICAgICAgICAgICAgdGhpc0JvdC5zdGFydFRpY2soKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ3RyYW5zZm9ybWVyJykpIHsKICAgICAgICAgICAgaWYgKCF0YWdzLnRyYW5zZm9ybWVyKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkFueUJvdHNSZW1vdmVkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRhZ3MudHJhbnNmb3JtZXIpIHsKICAgICAgICAgICAgaWYgKHRoYXQuYm90SURzLmluY2x1ZGVzKHRhZ3MudHJhbnNmb3JtZXIpKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnN0b3BUaWNrKCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGVzdHJveWVkYCk7CiAgICAgICAgfQogICAgfSksCiAgICBzZXREaW1lbnNpb246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25zdCBkaW1lbnNpb24gPSB0aGF0OwoKICAgICAgICBpZiAodGFncy5kaW1lbnNpb24gIT09IGRpbWVuc2lvbikgewogICAgICAgICAgICAvLyBSZW1vdmUgZnJvbSBwcmV2aW91cyBkaW1lbnNpb24uCiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gbnVsbDsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdQb3NpdGlvbiddID0gbnVsbDsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdSb3RhdGlvbiddID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChkaW1lbnNpb24pIHsKICAgICAgICAgICAgICAgIC8vIEFzc2lnbiB0byBuZXcgZGltZW5zaW9uLgogICAgICAgICAgICAgICAgdGFncy5kaW1lbnNpb24gPSBkaW1lbnNpb247CiAgICAgICAgICAgICAgICB0YWdzW2RpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0pLAogICAgc3RhcnRUaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKG1hc2tzLnRpY2tJbnRlcnZhbElkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG1hc2tzLnRpY2tJbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAndGljaycpLCB0YWdzLnRpY2tJbnRlcnZhbE1TKTsKICAgICAgICB0aGlzQm90LnRpY2soKTsKICAgIH0pLAogICAgc3RvcFRpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAobWFza3MudGlja0ludGVydmFsSWQpIHsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChtYXNrcy50aWNrSW50ZXJ2YWxJZCk7CiAgICAgICAgICAgIG1hc2tzLnRpY2tJbnRlcnZhbElkID0gbnVsbDsKICAgICAgICB9CiAgICB9KSwKICAgIHRpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25zdCBMT0NBTF9OT1JNQUxTID0gWwogICAgICAgICAgICBuZXcgVmVjdG9yMygxLCAwLCAwKSwgLy8gK1gKICAgICAgICAgICAgbmV3IFZlY3RvcjMoLTEsIDAsIDApLCAvLyAtWAogICAgICAgICAgICBuZXcgVmVjdG9yMygwLCAxLCAwKSwgLy8gK1kKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgLTEsIDApLCAvLyAtWQogICAgICAgIF0KCiAgICAgICAgY29uc3QgTE9DQUxfUE9TSVRJT05TID0gWwogICAgICAgICAgICBuZXcgVmVjdG9yMygwLjUgKyB0YWdzLmZhY2VPZmZzZXQsIDAsIC0wLjUpLCAvLyArWAogICAgICAgICAgICBuZXcgVmVjdG9yMygtMC41IC0gdGFncy5mYWNlT2Zmc2V0LCAwLCAtMC41KSwgLy8gLVgKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgMC41ICsgdGFncy5mYWNlT2Zmc2V0LCAtMC41KSwgLy8gK1kKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgLTAuNSAtIHRhZ3MuZmFjZU9mZnNldCwgLTAuNSksIC8vIC1ZCiAgICAgICAgXQoKICAgICAgICBjb25zdCBIQUxGX1BJID0gTWF0aC5QSSAvIDI7CgogICAgICAgIGNvbnN0IExPQ0FMX1JPVEFUSU9OUyA9IFsKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogSEFMRl9QSSwgeTogSEFMRl9QSSwgejogMCB9fSksIC8vICtYCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IEhBTEZfUEksIHk6IC1IQUxGX1BJLCB6OiAwIH19KSwgLy8gLVgKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogLUhBTEZfUEksIHk6IDAsIHo6IE1hdGguUEkgfX0pLCAvLyArWQogICAgICAgICAgICBuZXcgUm90YXRpb24oeyBldWxlcjogeyB4OiBIQUxGX1BJLCB5OiAwLCB6OiAwIH19KSwgLy8gLVkKICAgICAgICBdCgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgZmFjZSBwbGFuZSB0byBiZSBvbiB0aGUgZ2l2ZW4gZmFjZSBpbmRleC4gIAogICAgICAgICAqIDA6ICtYLCAgCiAgICAgICAgICogMTogLVgsICAKICAgICAgICAgKiAyOiArWSwgIAogICAgICAgICAqIDM6IC1ZCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gc2V0UGxhbmVGYWNlKGZhY2VJbmRleCkgewogICAgICAgICAgICBtYXNrc1t0YWdzLmRpbWVuc2lvbiArICdQb3NpdGlvbiddID0gTE9DQUxfUE9TSVRJT05TW2ZhY2VJbmRleF07CiAgICAgICAgICAgIG1hc2tzW3RhZ3MuZGltZW5zaW9uICsgJ1JvdGF0aW9uJ10gPSBMT0NBTF9ST1RBVElPTlNbZmFjZUluZGV4XTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uOmAsIHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICB9CgogICAgICAgIGlmICghdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcGFyZW50UG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbih0YWdzLnRyYW5zZm9ybWVyLCB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gcGFyZW50IHBvc2l0aW9uOmAsIHBhcmVudFBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGxldCBncmlkUG9ydGFsVHlwZTogJ2dyaWQnIHwgJ21pbmlHcmlkJyB8IG51bGwgPSBudWxsOwoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgZ3JpZFBvcnRhbFR5cGUgPSAnZ3JpZCc7CiAgICAgICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgZ3JpZFBvcnRhbFR5cGUgPSAnbWluaUdyaWQnOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBkZXRlY3RlZCBncmlkIHBvcnRhbCB0eXBlOmAsIGdyaWRQb3J0YWxUeXBlKTsKICAgICAgICB9CgogICAgICAgIGlmICghZ3JpZFBvcnRhbFR5cGUpIHsKICAgICAgICAgICAgc2V0UGxhbmVGYWNlKDApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBjYW1lcmFQb3NpdGlvbiA9IG9zLmdldENhbWVyYVBvc2l0aW9uKGdyaWRQb3J0YWxUeXBlKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBjYW1lcmEgcG9zaXRpb246YCwgY2FtZXJhUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGlyZWN0aW9uVG9DYW1lcmEgPSBjYW1lcmFQb3NpdGlvbi5zdWJ0cmFjdChwYXJlbnRQb3NpdGlvbikubm9ybWFsaXplKCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGlyZWN0aW9uIHRvIGNhbWVyYTpgLCBkaXJlY3Rpb25Ub0NhbWVyYSk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBwYXJlbnRSb3RhdGlvbiA9IGdldEJvdFJvdGF0aW9uKHRhZ3MudHJhbnNmb3JtZXIsIHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICBjb25zdCB3b3JsZE5vcm1hbHM6IFZlY3RvcjNbXSA9IG5ldyBBcnJheSg0KTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgICB3b3JsZE5vcm1hbHNbaV0gPSBwYXJlbnRSb3RhdGlvbi5yb3RhdGVWZWN0b3IzKExPQ0FMX05PUk1BTFNbaV0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSB3b3JsZCBub3JtYWxzOmAsIHdvcmxkTm9ybWFscyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEZpbmQgdGhlIGZhY2UgbW9zdCBmYWNpbmcgdGhlIGNhbWVyYSAobWF4IGRvdCBwcm9kdWN0KS4gCiAgICAgICAgbGV0IGJlc3RJbmRleCA9IDA7IAogICAgICAgIGxldCBiZXN0RG90ID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZOyAKICAgICAgICAKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkTm9ybWFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdCBkb3QgPSB3b3JsZE5vcm1hbHNbaV0uZG90KGRpcmVjdGlvblRvQ2FtZXJhKTsKICAgICAgICAgICAgaWYgKGRvdCA+IGJlc3REb3QpIHsKICAgICAgICAgICAgICAgIGJlc3REb3QgPSBkb3Q7IAogICAgICAgICAgICAgICAgYmVzdEluZGV4ID0gaTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gYmVzdCBmYWNlIGluZGV4OmAsIGJlc3RJbmRleCk7CiAgICAgICAgfQoKICAgICAgICBzZXRQbGFuZUZhY2UoYmVzdEluZGV4KTsKICAgIH0pLAogICAgLi4ucmVzdAp9Cgpjb25zdCBmYWNlUGxhbmVCb3QgPSBjcmVhdGUoZmFjZVBsYW5lTW9kKTsKCnJldHVybiBmYWNlUGxhbmVCb3Q7JwCt1u7OCaHkAwhhYklnbm9yZQIEAK3W7s4JrJUEBHRydWUnAK3W7s4JoeQDC2FiSW50ZXJmYWNlAgQArdbuzgmxlQQEdHJ1ZScArdbuzgmh5AMGc3lzdGVtAgQArdbuzgm2lQQYYWIuaW50ZXJmYWNlLmJvdF9mYWN0b3J5JwCt1u7OCaHkAxZhYkNyZWF0ZUJpbGxib2FyZExhYmVsAgQArdbuzgnPlQSNRUBsZXQgeyAKICAgIGJvdCwKICAgIGRpbWVuc2lvbiwKICAgIHByZXNlcnZlTmV3TGluZXMgPSB0cnVlLAogICAgbGFiZWwgPSAnJywKICAgIHNwYWNlID0gJ3RlbXBMb2NhbCcsCiAgICBjb2xvciA9ICd3aGl0ZScsCiAgICBsYWJlbENvbG9yID0gJ2JsYWNrJywKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge307CgppZiAodHlwZW9mIGxhYmVsICE9PSAnc3RyaW5nJykgewogICAgbGFiZWwgPSBTdHJpbmcobGFiZWwpOwp9Cgphc3NlcnQobGlua3MudXRpbHMuaXNCb3QoYm90KSwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3QgaXMgYSByZXF1aXJlZCBCb3QgcGFyYW1ldGVyLmApOwphc3NlcnQoZGltZW5zaW9uLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRpbWVuc2lvbiBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKYXNzZXJ0KHJlc3Qub25DcmVhdGUgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25BbnlCb3RzQ2hhbmdlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkFueUJvdHNSZW1vdmVkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LnVwZGF0ZUxhYmVsID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LmxhYmVsV29yZFdyYXBNb2RlID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbGFiZWxXb3JkV3JhcE1vZGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CgovLyAtLS0gMSkgV29yZCBicmVha2luZyAod3JhcCBieSB3b3JkcywgY2h1bmsgbG9uZyB3b3JkcykgLS0tCmZ1bmN0aW9uIGJyZWFrV29yZHNUb0xpbmVzKHRleHQsIG1heENvbHMgPSAxOCkgewogICAgaWYgKCF0ZXh0KSByZXR1cm4gWycnXTsKICAgIGNvbnN0IHdvcmRzID0gdGV4dC5zcGxpdCgvXHMrLykuZmlsdGVyKEJvb2xlYW4pOwogICAgY29uc3QgbGluZXMgPSBbXTsKICAgIGxldCBsaW5lID0gJyc7CgogICAgY29uc3QgcHVzaCA9ICgpID0+IHsgbGluZXMucHVzaChsaW5lKTsgbGluZSA9ICcnOyB9OwoKICAgIGZvciAoY29uc3QgdyBvZiB3b3JkcykgewogICAgICAgIGlmICh3Lmxlbmd0aCA+IG1heENvbHMpIHsKICAgICAgICAgICAgLy8gY2xvc2UgY3VycmVudCBsaW5lIChpZiBhbnkpIGJlZm9yZSBjaHVua2luZyBhIGxvbmcgd29yZAogICAgICAgICAgICBpZiAobGluZSkgcHVzaCgpOwogICAgICAgICAgICAvLyBjaHVuayB0aGUgbG9uZyB3b3JkCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdy5sZW5ndGg7IGkgKz0gbWF4Q29scykgewogICAgICAgICAgICAgICAgbGluZXMucHVzaCh3LnNsaWNlKGksIGkgKyBtYXhDb2xzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZSA9ICcnOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgewogICAgICAgICAgICBsaW5lID0gdzsKICAgICAgICB9IGVsc2UgaWYgKGxpbmUubGVuZ3RoICsgMSArIHcubGVuZ3RoIDw9IG1heENvbHMpIHsKICAgICAgICAgICAgbGluZSArPSAnICcgKyB3OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHB1c2goKTsKICAgICAgICAgICAgbGluZSA9IHc7CiAgICAgICAgfQogICAgfQogICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoKCk7CgogICAgcmV0dXJuIGxpbmVzLmxlbmd0aCA/IGxpbmVzIDogWycnXTsKfQoKLy8gUHJlc2VydmVzIGV4aXN0aW5nIFxuIGFzIGhhcmQgYnJlYWtzOyB3cmFwcyB3aXRoaW4gZWFjaCBoYXJkIGxpbmUuCmZ1bmN0aW9uIGJyZWFrV29yZHNUb0xpbmVzUHJlc2VydmVOZXdsaW5lcyh0ZXh0LCBtYXhDb2xzID0gMTgpIHsKICBpZiAodGV4dCA9PSBudWxsKSByZXR1cm4gWycnXTsKCiAgLy8gU3BsaXQgb24gcmVhbCBuZXdsaW5lczsga2VlcCBlbXB0eSBsaW5lcyBzbyB3ZSBwcmVzZXJ2ZSBibGFuayBsaW5lcy4KICBjb25zdCBoYXJkTGluZXMgPSBTdHJpbmcodGV4dCkuc3BsaXQoL1xyP1xuLyk7CiAgY29uc3Qgb3V0ID0gW107CgogIC8vIEhlbHBlciB0byB3cmFwIGEgc2luZ2xlIGhhcmQgbGluZSBieSB3b3JkcyAod2l0aCBsb25nLXdvcmQgY2h1bmtpbmcpCiAgY29uc3Qgd3JhcE9uZSA9IChzcmMpID0+IHsKICAgIC8vIE5vcm1hbGl6ZSB0YWJzIC0+IHNwYWNlczsgY29sbGFwc2UgaW50ZXJuYWwgd2hpdGVzcGFjZSAobm90IG5ld2xpbmVzKQogICAgY29uc3QgcyA9IHNyYy5yZXBsYWNlKC9cdC9nLCAnICAgICcpLnJlcGxhY2UoL1xzKy9nLCAnICcpLnRyaW0oKTsKICAgIGlmICghcy5sZW5ndGgpIHsgb3V0LnB1c2goJycpOyByZXR1cm47IH0KCiAgICBjb25zdCB3b3JkcyA9IHMuc3BsaXQoJyAnKTsKICAgIGxldCBsaW5lID0gJyc7CgogICAgY29uc3QgcHVzaExpbmUgPSAoKSA9PiB7IG91dC5wdXNoKGxpbmUpOyBsaW5lID0gJyc7IH07CgogICAgLy8gY2h1bmsgbG9uZyB3b3JkcyB0byBlbXVsYXRlICdicmVha1dvcmRzJwogICAgY29uc3QgY2h1bmtXb3JkID0gKHcpID0+IHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3Lmxlbmd0aDsgaSArPSBtYXhDb2xzKSB7CiAgICAgICAgY29uc3QgY2h1bmsgPSB3LnNsaWNlKGksIGkgKyBtYXhDb2xzKTsKICAgICAgICBpZiAoIWxpbmUubGVuZ3RoKSBsaW5lID0gY2h1bms7CiAgICAgICAgZWxzZSB7IHB1c2hMaW5lKCk7IGxpbmUgPSBjaHVuazsgfQogICAgICB9CiAgICB9OwoKICAgIGZvciAoY29uc3QgdyBvZiB3b3JkcykgewogICAgICBpZiAody5sZW5ndGggPiBtYXhDb2xzKSB7CiAgICAgICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoTGluZSgpOwogICAgICAgIGNodW5rV29yZCh3KTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIWxpbmUubGVuZ3RoKSB7CiAgICAgICAgbGluZSA9IHc7CiAgICAgIH0gZWxzZSBpZiAobGluZS5sZW5ndGggKyAxICsgdy5sZW5ndGggPD0gbWF4Q29scykgewogICAgICAgIGxpbmUgKz0gJyAnICsgdzsKICAgICAgfSBlbHNlIHsKICAgICAgICBwdXNoTGluZSgpOwogICAgICAgIGxpbmUgPSB3OwogICAgICB9CiAgICB9CiAgICBpZiAobGluZS5sZW5ndGgpIHB1c2hMaW5lKCk7CiAgfTsKCiAgZm9yIChjb25zdCBobCBvZiBoYXJkTGluZXMpIHsKICAgIHdyYXBPbmUoaGwpOyAgICAgICAgICAgLy8gd3JhcCB3aXRoaW4gdGhpcyBoYXJkIGxpbmUKICB9CgogIC8vIElmIHRoZSBpbnB1dCBlbmRlZCB3aXRoIGEgdHJhaWxpbmcgbmV3bGluZSwgd2UgYWxyZWFkeSBwcmVzZXJ2ZWQgaXQKICAvLyBiZWNhdXNlIHNwbGl0IGtlcHQgYW4gZW1wdHkgbGFzdCBpdGVtIC0+IGJlY2FtZSBhbiBlbXB0eSB3cmFwcGVkIGxpbmUuCiAgcmV0dXJuIG91dC5sZW5ndGggPyBvdXQgOiBbJyddOwp9CgovLyAtLS0gMikgU2ltcGxlIHNpemluZyBmcm9tIGxpbmVzIC0tLQovLyBUaGluayBvZiAiY29sc1BlclNjYWxlWCIgYXMgImFib3V0IE4gY2hhcmFjdGVycyBwZXIgMSBzY2FsZVgiLgpmdW5jdGlvbiBjb21wdXRlU2ltcGxlU2NhbGVzRnJvbUxpbmVzKGxpbmVzLCB7CiAgICBjb2xzUGVyU2NhbGVYID0gMi41LAogICAgbWluU2NhbGVYID0gMS4yNSwKICAgIG1heFNjYWxlWCA9IDEwLAogICAgYmFzZVNjYWxlWSA9IDEuMiwKICAgIHBlckxpbmVZID0gMC43NSwKfSA9IHt9KSB7CiAgICBjb25zdCBsb25nZXN0ID0gbGluZXMucmVkdWNlKChtLCBsKSA9PiBNYXRoLm1heChtLCBsLmxlbmd0aCksIDApOwogICAgY29uc3QgbGluZUNvdW50ID0gTWF0aC5tYXgoMSwgbGluZXMubGVuZ3RoKTsKCiAgICAvLyBXaWR0aCBzY2FsZXMgd2l0aCB0aGUgbG9uZ2VzdCBsaW5lIGxlbmd0aAogICAgbGV0IHNjYWxlWCA9IGxvbmdlc3QgPiAwID8gKGxvbmdlc3QgLyBjb2xzUGVyU2NhbGVYKSA6IG1pblNjYWxlWDsKICAgIHNjYWxlWCA9IE1hdGgubWF4KG1pblNjYWxlWCwgTWF0aC5taW4obWF4U2NhbGVYLCBzY2FsZVgpKTsKCiAgICAvLyBIZWlnaHQgZ3Jvd3MgcGVyIGxpbmU7IGtlZXAgaXQgc2ltcGxlIGFuZCBwcmVkaWN0YWJsZQogICAgY29uc3Qgc2NhbGVZID0gTWF0aC5tYXgoYmFzZVNjYWxlWSwgYmFzZVNjYWxlWSArIChsaW5lQ291bnQgLSAxKSAqIHBlckxpbmVZKTsKCiAgICByZXR1cm4geyBzY2FsZVgsIHNjYWxlWSwgbG9uZ2VzdCwgbGluZUNvdW50IH07Cn0KCgovLyBQaWNrIHlvdXIgdGFyZ2V0ICJjb2x1bW5zIiBwZXIgbGluZSAodHdlYWsgdG8gdGFzdGUpCmNvbnN0IE1BWF9DT0xTID0gMzI7CgovLyBCcmVhayB0aGUgdGV4dCB5b3Vyc2VsZgpjb25zdCBsaW5lcyA9IHByZXNlcnZlTmV3TGluZXMgPyBicmVha1dvcmRzVG9MaW5lc1ByZXNlcnZlTmV3bGluZXMobGFiZWwsIE1BWF9DT0xTKSA6IGJyZWFrV29yZHNUb0xpbmVzKGxhYmVsLCBNQVhfQ09MUyk7CmNvbnN0IHdyYXBwZWRMYWJlbCA9IGxpbmVzLmpvaW4oJ1xuJyk7CgovLyBDb21wdXRlIHNpbXBsZSBzY2FsZXMgZnJvbSB0aGUgd3JhcHBlZCB0ZXh0CmNvbnN0IHsgc2NhbGVYLCBzY2FsZVkgfSA9IGNvbXB1dGVTaW1wbGVTY2FsZXNGcm9tTGluZXMobGluZXMpOwoKbGV0IGxhYmVsTW9kID0gewogICAgc3BhY2U6IHNwYWNlLAogICAgdHJhY2tCb3RJZDogYm90LmlkLAogICAgZm9ybTogJ3Nwcml0ZScsCiAgICBjb2xvciwKICAgIGxhYmVsOiB3cmFwcGVkTGFiZWwsCiAgICBsYWJlbENvbG9yLAogICAgbGFiZWxTaXplOiAxLAogICAgbGFiZWxQYWRkaW5nWDogMC41LAogICAgbGFiZWxXb3JkV3JhcE1vZGU6ICdub25lJywKICAgIHNjYWxlWCwgCiAgICBzY2FsZVksCiAgICBzY2FsZVo6IDAuMSwKICAgIGJvdExhYmVsTWFyZ2luOiAxLAogICAgYW5jaG9yUG9pbnQ6ICfinqHvuI8wLC0wLjUsMCcsCiAgICBvcmllbnRhdGlvbk1vZGU6ICdiaWxsYm9hcmQnLAogICAgZGltZW5zaW9uOiBkaW1lbnNpb24sCiAgICBkZWJ1ZzogZmFsc2UsCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBvbkNyZWF0ZTogYEAKICAgICAgICAvLyBXYWl0IGZvciByZXF1aXJlZCBib3RzIHRvIGJlIHJlYWR5LgogICAgICAgIGxldCB3YWl0VGltZSA9IDA7CgogICAgICAgIHdoaWxlKCFnbG9iYWxUaGlzLmFiKSB7CiAgICAgICAgICAgIGlmICh3YWl0VGltZSA+PSA1MDAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IG9zLnNsZWVwKDI1MCk7CiAgICAgICAgICAgIHdhaXRUaW1lICs9IDI1MDsKICAgICAgICB9CgogICAgICAgIHRhZ3MucmVhZHkgPSB0cnVlOwogICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgIGAsCiAgICBvbkFueUJvdHNDaGFuZ2VkOiBgQAogICAgICAgIGZvciAoY29uc3QgY2hhbmdlZCBvZiB0aGF0KSB7CiAgICAgICAgICAgIGlmIChjaGFuZ2VkLmJvdCAmJiBjaGFuZ2VkLmJvdC5pZCA9PT0gdGFncy50cmFja0JvdElkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvbmx5Um90YXRpb25UYWdzID0gY2hhbmdlZC50YWdzLmV2ZXJ5KCh0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZW5kc1dpdGgoJ1JvdGF0aW9uJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25YJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25ZJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25aJykKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIG9ubHlSb3RhdGlvblRhZ3M6Jywgb25seVJvdGF0aW9uVGFncyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG9ubHlSb3RhdGlvblRhZ3MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgYCwKICAgIG9uQW55Qm90c1JlbW92ZWQ6IGBACgogICAgICAgIGlmICh0aGF0LmJvdElEcy5pbmNsdWRlcyh0YWdzLnRyYWNrQm90SWQpKSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgfQogICAgYCwKICAgIG9uUG9ydGFsQ2hhbmdlZDogYEAKICAgICAgICBpZiAodGhhdC5kaW1lbnNpb24gPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgICAgICB9CiAgICBgLAogICAgdXBkYXRlTGFiZWw6IGBACiAgICAgICAgaWYgKCF0YWdzLnJlYWR5KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JpbmcgdXBkYXRlTGFiZWwgYmVjYXVzZSBub3QgcmVhZHknKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGhhc0xhYmVsID0gdGFncy5sYWJlbCAhPSBudWxsICYmIHRhZ3MubGFiZWwgIT09ICcnOwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gaGFzTGFiZWw7CgogICAgICAgIGlmICghaGFzTGFiZWwpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JlIHVwZGF0ZUxhYmVsIGNhbGwsIHRoZXJlIGlzIG5vIGxhYmVsIHRhZyB2YWx1ZSB0byBkaXNwbGF5LicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBpbk1hcFBvcnRhbCA9IChjb25maWdCb3QudGFncy5tYXBQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBjb25zdCBpbkdyaWRQb3J0YWwgPSAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKCFpbk1hcFBvcnRhbCAmJiAhaW5HcmlkUG9ydGFsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yZSB1cGRhdGVMYWJlbCBjYWxsLCBub3QgaW4gZWl0aGVyIGdyaWQgb3IgbWFwIHBvcnRhbC4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCB0cmFja0JvdCA9IGdldEJvdCgnaWQnLCB0YWdzLnRyYWNrQm90SWQpOwogICAgICAgIGNvbnN0IHRyYWNrUG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbih0cmFja0JvdCwgdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIHRyYWNrUG9zaXRpb246JywgdHJhY2tQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICBsZXQgbGFiZWxQb3NpdGlvbiA9IHsgeDogdHJhY2tQb3NpdGlvbi54LCB5OiB0cmFja1Bvc2l0aW9uLnksIHo6IHRyYWNrUG9zaXRpb24ueiB9OyAKCiAgICAgICAgY29uc3QgdHJhY2tCb3RTY2FsZSA9IHRyYWNrQm90LnRhZ3Muc2NhbGUgPz8gMTsKICAgICAgICBjb25zdCB0cmFja0JvdFNjYWxlWiA9IHRyYWNrQm90LnRhZ3Muc2NhbGVaID8/IDE7CgogICAgICAgIGxldCBtZXRlcnNQZXJHcmlkVW5pdCA9IDE7CgogICAgICAgIGlmIChpbk1hcFBvcnRhbCkgewogICAgICAgICAgICAvLyBTY2FsZSB0byBtYXAgcG9ydGFsIHVuaXRzLgogICAgICAgICAgICBtZXRlcnNQZXJHcmlkVW5pdCA9IDEwOwogICAgICAgIH0KCiAgICAgICAgbGV0IHRyYWNrQm90UmVhbFNjYWxlWiA9ICh0cmFja0JvdFNjYWxlWiAqIHRyYWNrQm90U2NhbGUpICogbWV0ZXJzUGVyR3JpZFVuaXQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gdHJhY2tCb3RSZWFsU2NhbGVaOicsIHRyYWNrQm90UmVhbFNjYWxlWik7CiAgICAgICAgfQoKICAgICAgICBsYWJlbFBvc2l0aW9uLnogKz0gdHJhY2tCb3RSZWFsU2NhbGVaICsgKHRhZ3MuYm90TGFiZWxNYXJnaW4gKiBtZXRlcnNQZXJHcmlkVW5pdCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gbGFiZWxQb3NpdGlvbjonLCBsYWJlbFBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWCddID0gbGFiZWxQb3NpdGlvbi54OwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWSddID0gbGFiZWxQb3NpdGlvbi55OwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWiddID0gbGFiZWxQb3NpdGlvbi56OwogICAgYAp9OwoKbGFiZWxNb2QgPSB7CiAgICAuLi5sYWJlbE1vZCwKICAgIC4uLnJlc3QsCn0KCmNvbnN0IGxhYmVsQm90ID0gY3JlYXRlKGxhYmVsTW9kKTsKCnJldHVybiBsYWJlbEJvdDsnAK3W7s4JoeQDBXV0aWxzAgQArdbuzgnZ2gQo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycArdbuzgmh5AMEZm9ybQIEAK3W7s4JgNsEB25vdGhpbmcnAK3W7s4JoeQDCWFiVmVyc2lvbgIEAK3W7s4JiNsEBTEwLjM5AA=="}]}