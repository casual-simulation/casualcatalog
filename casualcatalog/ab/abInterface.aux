{"version":2,"updates":[{"id":0,"timestamp":1771957767483,"update":"AZ0Ciayg5QQAJwEEYm90cyQxMzY3MjI1My0yNTM2LTQwODYtOTVjZi1lYjE2ZmZjY2U0ZGQBJwCJrKDlBAAGc3lzdGVtAgQAiayg5QQBEmFiLmludGVyZmFjZS5zb3VuZCcAiayg5QQACGFiSWdub3JlAgQAiayg5QQUBHRydWUnAImsoOUEAAthYkludGVyZmFjZQIEAImsoOUEGQR0cnVlJwCJrKDlBAALZGVzY3JpcHRpb24CBACJrKDlBB6TBHRoaXMgc2tpbGwgaXMgYSBtYW5hZ2VyIGZvciBzb3VuZHMNCnN1cHBvcnRlZCB0YWdzOg0KICAgIHNvdW5kQ3JlYXRlDQogICAgc291bmRDbGljaw0KICAgIHNvdW5kRHJhZw0KICAgIHNvdW5kRHJvcA0KICAgIHNvdW5kUG9pbnRlckVudGVyDQogICAgc291bmRQb2ludGVyRXhpdA0KDQpwb3NzaWJsZSB2YWx1ZXM6DQogICAgYm9vbGVhbiAtIGlmIHRydWUgd2lsbCBwbGF5IGEgZGVmYXVsdCBzb3VuZCBpZiBvbmUgaXMgZm91bmQuDQogICAgc3RyaW5nIHVybCAtIHdpbGwgYXR0ZW1wdCB0byBwbGF5IHRoZSBzb3VuZCBhdCB0aGUgZ2l2ZW4gdXJsIHBhdGguDQogICAgc3RyaW5nIGZpbGUgcGF0aCAtIHdpbGwgYXR0ZW1wdCB0byBwbGF5IHRoZSBzb3VuZCBhdCB0aGUgZ2l2ZW4gcGF0aCBmcm9tIHRoZSBjYXN1YWwgY2F0YWxvZy4NCiAgICBhcnJheSAtIGEgcmFuZG9tIGVudHJ5IHdpbGwgYmUgY2hvc2VuIGZyb20gdGhlIGFycmF5IGFuZCBwYXJzZWQgYXMgYW55IG9uZSBvZiB0aGUgcG9zc2libGUgdmFsdWVzIGFib3ZlLg0KICAgICcAiayg5QQABGZvcm0CBACJrKDlBLIEB25vdGhpbmcnAImsoOUEAAhyZW1lbWJlcgIEAImsoOUEugQo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAiayg5QQAD29uQW55Qm90Q2xpY2tlZAIEAImsoOUE4QSlAUBpZiAodGhhdD8uYm90Py50YWdzPy5zb3VuZENsaWNrKSB7DQogICAgdGhpc0JvdC5hYlBsYXlTb3VuZCh7DQogICAgICAgIHZhbHVlOiB0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kQ2xpY2ssDQogICAgICAgIGRlZmF1bHRWYWx1ZTogdGFncy5kZWZhdWx0Q2xpY2tTb3VuZA0KICAgIH0pOw0KfScAiayg5QQADG9uQW55Qm90RHJhZwIEAImsoOUEhwaiAUBpZiAodGhhdD8uYm90Py50YWdzPy5zb3VuZERyYWcpIHsNCiAgICB0aGlzQm90LmFiUGxheVNvdW5kKHsNCiAgICAgICAgdmFsdWU6IHRoYXQ/LmJvdD8udGFncz8uc291bmREcmFnLA0KICAgICAgICBkZWZhdWx0VmFsdWU6IHRhZ3MuZGVmYXVsdERyYWdTb3VuZA0KICAgIH0pOw0KfScAiayg5QQADG9uQW55Qm90RHJvcAIEAImsoOUEqgeiAUBpZiAodGhhdD8uYm90Py50YWdzPy5zb3VuZERyb3ApIHsNCiAgICB0aGlzQm90LmFiUGxheVNvdW5kKHsNCiAgICAgICAgdmFsdWU6IHRoYXQ/LmJvdD8udGFncz8uc291bmREcm9wLA0KICAgICAgICBkZWZhdWx0VmFsdWU6IHRhZ3MuZGVmYXVsdERyb3BTb3VuZA0KICAgIH0pOw0KfScAiayg5QQAFG9uQW55Qm90UG9pbnRlckVudGVyAgQAiayg5QTNCLoBQGlmICh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kUG9pbnRlckVudGVyKSB7DQogICAgdGhpc0JvdC5hYlBsYXlTb3VuZCh7DQogICAgICAgIHZhbHVlOiB0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kUG9pbnRlckVudGVyLA0KICAgICAgICBkZWZhdWx0VmFsdWU6IHRhZ3MuZGVmYXVsdFBvaW50ZXJFbnRlclNvdW5kDQogICAgfSk7DQp9JwCJrKDlBAATb25BbnlCb3RQb2ludGVyRXhpdAIEAImsoOUEiAqyAUBpZiAodGhhdD8uYm90Py50YWdzPy5zb3VuZFBvaW50ZXJFeGl0KSB7CiAgICB0aGlzQm90LmFiUGxheVNvdW5kKHsKICAgICAgICB2YWx1ZTogdGhhdD8uYm90Py50YWdzPy5zb3VuZFBvaW50ZXJFeGl0LAogICAgICAgIGRlZmF1bHRWYWx1ZTogdGFncy5kZWZhdWx0UG9pbnRlckV4aXRTb3VuZAogICAgfSk7Cn0nAImsoOUEAAtvbkFueUNyZWF0ZQIEAImsoOUEuwuoAUBpZiAodGhhdD8uYm90Py50YWdzPy5zb3VuZENyZWF0ZSkgew0KICAgIHRoaXNCb3QuYWJQbGF5U291bmQoew0KICAgICAgICB2YWx1ZTogdGhhdD8uYm90Py50YWdzPy5zb3VuZENyZWF0ZSwNCiAgICAgICAgZGVmYXVsdFZhbHVlOiB0YWdzLmRlZmF1bHRDcmVhdGVTb3VuZA0KICAgIH0pOw0KfScAiayg5QQACWFiVmVyc2lvbgIEAImsoOUE5AwFMTAuNDInAImsoOUEAAVkZWJ1ZwIEAImsoOUE6gwFZmFsc2UnAImsoOUEABBkZWZhdWx0RHJvcFNvdW5kAgQAiayg5QTwDCJhYi9hdWRpby9waWVjZSBkcm9wIGFmdGVyIG1vdmUubXAzJwCJrKDlBAAQZGVmYXVsdERyYWdTb3VuZAIEAImsoOUEkw0gYWIvYXVkaW8vcGllY2UgdG91Y2ggdG8gbW92ZS5tcDMnAImsoOUEABdkZWZhdWx0UG9pbnRlckV4aXRTb3VuZAIEAImsoOUEtA1j8J+nrFsgImFiL2F1ZGlvL3BvaW50ZXIgZXhpdCBBLm1wMyIsICJhYi9hdWRpby9wb2ludGVyIGV4aXQgQi5tcDMiLCAiYWIvYXVkaW8vcG9pbnRlciBleGl0IEMubXAzIiBdJwCJrKDlBAASZGVmYXVsdENyZWF0ZVNvdW5kAgQAiayg5QSWDiNhYi9hdWRpby9kcm9wIGJsb2NrIGluIHBsYWNlXzAxLm1wMycAiayg5QQAEWRlZmF1bHRDbGlja1NvdW5kAgQAiayg5QS6DhZhYi9hdWRpby90YXAgYmxvY2subXAzJwCJrKDlBAALYWJQbGF5U291bmQCBACJrKDlBNEO6gxAY29uc3QgewogICAgdmFsdWUsCiAgICBkZWZhdWx0VmFsdWUsCn0gPSB0aGF0ID8/IHt9OwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdmFsdWU6YCwgdmFsdWUsIGBkZWZhdWx0VmFsdWU6YCwgZGVmYXVsdFZhbHVlKTsKfQoKaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICBsZXQgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB2YWx1ZS5sZW5ndGgpCiAgICBsZXQgcmFuZG9tVmFsdWUgPSB2YWx1ZVtyYW5kb21JbmRleF07CgogICAgaWYgKHJhbmRvbVZhbHVlID09PSAndHJ1ZScgfHwgcmFuZG9tVmFsdWUgPT09ICdmYWxzZScpIHsKICAgICAgICByYW5kb21WYWx1ZSA9IEJvb2xlYW4ocmFuZG9tVmFsdWUpOwogICAgfQoKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSByYW5kb21JbmRleDpgLCByYW5kb21JbmRleCwgYHJhbmRvbVZhbHVlOmAsIHJhbmRvbVZhbHVlKTsKICAgIH0KICAgIAogICAgcmV0dXJuIHRoaXNCb3QuYWJQbGF5U291bmQoeyB2YWx1ZTogcmFuZG9tVmFsdWUsIGRlZmF1bHRWYWx1ZSB9KTsKfSBlbHNlIGlmICh2YWx1ZSA9PT0gdHJ1ZSkgewogICAgcmV0dXJuIHRoaXNCb3QuYWJQbGF5U291bmQoeyB2YWx1ZTogZGVmYXVsdFZhbHVlIH0pOwp9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgIGlmICh2YWx1ZS5zdGFydHNXaXRoKCdodHRwczovLycpKSB7CiAgICAgICAgcmV0dXJuIG9zLnBsYXlTb3VuZCh2YWx1ZSk7CiAgICB9IGVsc2UgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoJ/Cfp6wnKSkgewogICAgICAgIC8vIFRoaXMgaGFwcGVucyBzb21ldGltZXMgaW4gQ2FzdWFsT1MgZm9yIHNvbWUgcmVhc29uLiAKICAgICAgICAvLyBNYW51YWxseSBwYXJzZSB0aGUganNvbiBmcm9tIHRoZSBtb2Qgc3RyaW5nIGFuZCByZS1ydW4gaXQgdGhyb3VnaC4KICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gdmFsdWUuc2xpY2UoJ/Cfp6wnLmxlbmd0aCk7CiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2UoanNvblN0cmluZyk7CgogICAgICAgIHJldHVybiB0aGlzQm90LmFiUGxheVNvdW5kKHsgdmFsdWU6IGpzb24sIGRlZmF1bHRWYWx1ZSB9KTsKICAgIH0gZWxzZXsKICAgICAgICBjb25zdCBjYXRhbG9nVVJMID0gYXdhaXQgYWIuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwodmFsdWUpOwogICAgICAgIHJldHVybiBvcy5wbGF5U291bmQoY2F0YWxvZ1VSTCk7CiAgICB9Cn0gZWxzZSB7CiAgICBpZiAodmFsdWUgIT0gZmFsc2UpIHsKICAgICAgICBpZiAoZGVmYXVsdFZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzQm90LmFiUGxheVNvdW5kKHsgdmFsdWU6IGRlZmF1bHRWYWx1ZSB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB2YWx1ZSAke3ZhbHVlfSBpcyBub3Qgc3VwcG9ydGVkLiBNdXN0IGJlIGVpdGhlciB0cnVlIGJvb2xlYW4gb3Igc3RyaW5nLmApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9JwCJrKDlBAATZGVmYXVsdERlc3Ryb3lTb3VuZAIEAImsoOUEuBshYWIvYXVkaW8vZHJvcCBibG9jayBvZmYgYm9hcmQubXAzJwCJrKDlBAAYZGVmYXVsdFBvaW50ZXJFbnRlclNvdW5kAgQAiayg5QTaG2bwn6esWyAiYWIvYXVkaW8vcG9pbnRlciBlbnRlciBBLm1wMyIsICJhYi9hdWRpby9wb2ludGVyIGVudGVyIEIubXAzIiwgImFiL2F1ZGlvL3BvaW50ZXIgZW50ZXIgQy5tcDMiIF0nAQRib3RzJDEzZjMzYTUxLWMyZmEtNDZkYS1hODhlLWU1YzA2NzU1NmQwMgEnAImsoOUEvxwKYWJJRE9yaWdpbgIEAImsoOUEwBwNdG9vbGJveF9za2lsbCcAiayg5QS/HAthYkludGVyZmFjZQIEAImsoOUEzhwEdHJ1ZScAiayg5QS/HAtkZXNjcmlwdGlvbgIEAImsoOUE0xwpVGhpcyBza2lsbCBpcyBhbiBpbnRlcmZhY2UgZm9yIHRvb2xib3hlcy4nAImsoOUEvxwEZm9ybQIEAImsoOUE/RwHbm90aGluZycAiayg5QS/HARtZW51AgQAiayg5QSFHSjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCJrKDlBL8cBnN5c3RlbQIEAImsoOUErB0UYWIuaW50ZXJmYWNlLnRvb2xib3gnAImsoOUEvxwKYWJJRFN0dWRpbwIEAImsoOUEwR0kZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwCJrKDlBL8cCHJlbWVtYmVyAgQAiayg5QTmHSjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCJrKDlBL8cC3Rvb2xib3hfYWRkAgQAiayg5QSNHsgLQGNvbnN0IHRvb2xib3hEYXRhID0gdGhhdC50b29sYm94RGF0YTsKY29uc3QgdG9vbGJveFRpdGxlID0gdG9vbGJveERhdGEudGl0bGU7CmNvbnN0IHRvb2xib3hOYW1lID0gdG9vbGJveERhdGEubmFtZTsKY29uc3QgdG9vbGJveFN0dWRpbyA9IHRvb2xib3hEYXRhLnN0dWRpbzsKY29uc3QgZ3JpZERhdGEgPSB0aGF0LmdyaWREYXRhOwoKLy9MT0FESU5HIEJBUj8KCmlmICghbGlua3Muc2hlbGxVdGlscykgewogICAgLy8gTmVlZCBhYlNoZWxsIHRvIHVzZSBpdCdzIGFiTG9nIGZ1bmN0aW9uLgogICAgbGlua3MubGVhcm4uYWJBZGFwdCgnYWJTaGVsbCcpOwp9CgppZiAodG9vbGJveFN0dWRpbyA9PSBmYWxzZSkgewogICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdCh0b29sYm94TmFtZSk7CiAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKGAke3Rvb2xib3hUaXRsZSA/PyB0b29sYm94TmFtZX0gbG9hZGVkYCk7Cn0KZWxzZSB7CiAgICBjb25zdCB0b29sYm94TG9va3VwID0gYXdhaXQgbGlua3Muc2VhcmNoLmhhdGNoKHsgYWJJRDogdG9vbGJveE5hbWUsIHJlY29yZEtleTogdG9vbGJveFN0dWRpbywgYXV0b0hhdGNoOiB0cnVlIH0pOwoKICAgIGlmICh0b29sYm94TG9va3VwLnN1Y2Nlc3MpIHsKICAgICAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKGAke3Rvb2xib3hUaXRsZSA/PyB0b29sYm94TmFtZX0gbG9hZGVkYCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYGlzc3VlIGxvYWRpbmcgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9LCBwbGVhc2UgdHJ5IGFnYWluYCwgbG9nVHlwZTogJ2Vycm9yJyB9KTsKICAgIH0KfQoKY29uc3QgYWN0aXZlVG9vbGJveCA9IGdldEJvdCgic3lzdGVtIiwgYGFiLnRvb2xib3guJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9YCk7CgppZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJHcmlkTWVudU9uQmVmb3JlQ3JlYXRlKSB7CiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkdyaWRGb2N1cyA9IGdyaWREYXRhOwogICAgYXdhaXQgYWIubGlua3MubWVudS5hYk9wZW5NZW51KCJncmlkIik7CiAgICBjb25zdCBtZW51Qm90ID0gZ2V0Qm90KCJiYXNlU2tpbGwiLCBnZXRMaW5rKGFjdGl2ZVRvb2xib3gpKTsKICAgIGlmIChtZW51Qm90KSB7CiAgICAgICAgbWVudUJvdC5vblBvaW50ZXJVcCgpOwogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScAiayg5QS/HAVsZWFybgIEAImsoOUE1iko8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAiayg5QS/HAVzdG9yZQIEAImsoOUE/Sko8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAiayg5QS/HAZzZWFyY2gCBACJrKDlBKQqKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAImsoOUEvxwIYWJJZ25vcmUCBACJrKDlBMsqBHRydWUnAImsoOUEvxwJYWJWZXJzaW9uAgQAiayg5QTQKgUxMC40MicAiayg5QS/HA1tYW5pZmVzdGF0aW9uAgQAiayg5QTWKijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCJrKDlBL8cEGFiR3JpZE1lbnVBY3Rpb24CBACJrKDlBP0quQtALy8gc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCi8vIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgovLyB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKLy8gICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKLy8gYDsKLy8gdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAovLyAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKLy8gICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwovLyAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyAgICAgfQovLyBgOwovLyB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBgQAovLyAgICAgdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IG51bGw7Ci8vICAgICB0aGlzQm90Lm1hc2tzLmFiTWVudVJlZnJlc2ggPSBudWxsOwovLyBgOwoKLy8gY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7Ci8vIGNvbnN0IG1lbnVCb3QgPSB7fTsKCi8vIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsKLy8gbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwovLyBtZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKLy8gbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKLy8gbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsKLy8gbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwovLyBtZW51Qm90Lm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsKCi8vIGZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspCi8vIHsKLy8gICAgIGNvbnN0IGFjdGl2ZVRvb2xib3ggPSBwb3NzaWJsZVRvb2xib3hlc1tpXTsKLy8gICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7CgovLyAgICAgbWVudUJvdC50b29sYm94X2RhdGEgPSBhY3RpdmVUb29sYm94OwovLyAgICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOwoKLy8gICAgIGlmICghZXh0YW50Qm90KQovLyAgICAgewovLyAgICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCb3QpOwovLyAgICAgfQovLyB9JwCJrKDlBL8cFGFiR3JpZE1lbnVPbkdlbmVyYXRlAgQAiayg5QS3NuICQGNvbnN0IHRvb2xib3hBcnJheSA9IGFiUmVtZW1iZXIudGFncy50b29sYm94X2FycmF5OwoKbGV0IGFsbFRvb2xzTG9hZGVkID0gdHJ1ZTsKCmZvciAobGV0IGkgPSAwOyBpIDwgdG9vbGJveEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBjdXJyZW50VG9vbCA9IHRvb2xib3hBcnJheVtpXS5uYW1lOwoKICAgIGlmICghZ2V0Qm90KCJhYklET3JpZ2luIiwgY3VycmVudFRvb2wpICYmICFnZXRCb3QoY3VycmVudFRvb2wsIHRydWUpKSB7CiAgICAgICAgYWxsVG9vbHNMb2FkZWQgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgIH0KfQoKaWYgKGFsbFRvb2xzTG9hZGVkKSB7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwCJrKDlBL8cD2FiR3JpZE1lbnVMYWJlbAIEAImsoOUEmjkHY2F0YWxvZycAiayg5QS/HBNhYkdyaWRNZW51U29ydE9yZGVyAgQAiayg5QSiOQMxMDAnAImsoOUEvxwPb25BQkluaXRpYWxpemVkAgQAiayg5QSmOSpALy8gbGlua3MubGVhcm4uYWJBZGFwdCgiY2FzdWFsX3Rvb2xib3giKTsnAImsoOUEvxwNb25Ta2lsbFVwZGF0ZQIEAImsoOUE0TlXQGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7DQoNCmNvbnNvbGUubG9nKCJbVG9vbGJveF0gTG9hZGluZyBjYXN1YWwga2l0Iik7JwCJrKDlBL8cCnNoZWxsVXRpbHMCBACJrKDlBKk6KPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAImsoOUEvxwYYWJHcmlkTWVudU9uQmVmb3JlQ3JlYXRlAgQAiayg5QTQOtQJQGlmIChhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQ2F0YWxvZ05hbWUpIHsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkdyaWRNZW51TGFiZWwiLCBhYi5saW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQ2F0YWxvZ05hbWUpOw0KfQ0KDQoNCi8vTkVXDQpjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCg0KY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspDQp7DQogICAgY29uc3QgbWVudUJvdCA9IHt9Ow0KDQogICAgbWVudUJvdC5hYk1lbnUgPSB0cnVlOw0KICAgIG1lbnVCb3QuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCiAgICBtZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsNCiAgICBtZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOw0KICAgIG1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiYWRkX2JveCI7DQogICAgbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOw0KICAgIG1lbnVCb3Qub25DbGljayA9IGBAIA0KICAgICAgICBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IA0KICAgICAgICBzZXRUYWdNYXNrKGFiLmxpbmtzLnJlbWVtYmVyLCAibGFzdE9wZW5lZERyb3Bkb3duIiwgbnVsbCk7DQogICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsNCiAgICANCiAgICBjb25zdCBhY3RpdmVUb29sYm94ID0gcG9zc2libGVUb29sYm94ZXNbaV07DQogICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsNCg0KICAgIG1lbnVCb3QudG9vbGJveF9kYXRhID0gYWN0aXZlVG9vbGJveDsNCiAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7DQoNCiAgICBpZiAoIWV4dGFudEJvdCkNCiAgICB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKG1lbnVCb3QpOw0KICAgIH0NCn0NCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwCJrKDlBL8cEmFiR3JpZE1lbnVJdGVtVHlwZQIEAImsoOUEpUQIZHJvcGRvd24nAImsoOUEvxwRZHJvcGRvd25Tb3J0T3JkZXICBACJrKDlBK5EAzEwMCcAiayg5QS/HA9kcm9wZG93bk9wdGlvbnMCBACJrKDlBLJEBvCfp6xbXScAiayg5QS/HA5hYkdyaWRNZW51SWNvbgIEAImsoOUEt0QKbG9jYWxfbWFsbCcBBGJvdHMkMTc0MTBkODMtN2VlZS00YTFlLWI2MzgtNjU0NjM3NGQxN2MzAScAiayg5QTCRAZzeXN0ZW0CBACJrKDlBMNEEWFiLmludGVyZmFjZS5zY2FuJwCJrKDlBMJEBGZvcm0CBACJrKDlBNVEB25vdGhpbmcnAImsoOUEwkQLYWJJbnRlcmZhY2UCBACJrKDlBN1EBHRydWUnAImsoOUEwkQIYWJJZ25vcmUCBACJrKDlBOJEBHRydWUnAImsoOUEwkQPb25RUkNvZGVTY2FubmVkAgQAiayg5QTnRP0PQGlmICghYnVpbGRlclZlcnNpb24pCnsKICAgIHJldHVybjsKfQoKYWIubG9nKGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHNjYW5uZWQgIiArIHRoYXQpOwoKbGV0IHJlcXVlc3RpbmdBSSA9IGZhbHNlOwppZiAoY29uZmlnQm90LnRhZ3MucmVxdWVzdGluZ0FJKSB7CiAgICBjb25maWdCb3QudGFncy5yZXF1ZXN0aW5nQUkgPSBudWxsOwogICAgcmVxdWVzdGluZ0FJID0gdHJ1ZTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuKQp7CiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsaW5rcy5zdG9yZS5hYlFSUHVibGlzaCh0aGF0KTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4pCnsKICAgIGxldCBzY2FubmVkVVJMOwoKICAgIGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbiA9IG51bGw7CgogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgdHJ5CiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7CiAgICB9CiAgICBjYXRjaCAoZSkKICAgIHsKICAgICAgICBvcy50b2FzdCgibm90IGEgcmVjb2duaXplZCBwcmFjdGljZSBwZXJtaXQiKTsKCiAgICAgICAgY29uc29sZS5sb2coZSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBsZXQgcGhDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygicGgiKTsKICAgIGxldCBpbnN0Q2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImluc3QiKTsKICAgIGxldCBhYkNoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJhYiIpOwogICAgbGV0IGN3Q2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImN3Iik7CgogICAgaWYgKHBoQ2hlY2sgJiYgaW5zdENoZWNrICYmIGFiQ2hlY2sgJiYgY3dDaGVjaykKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKHRoYXQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwogICAgfQoKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MuYWJTY2FuKQp7CiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IG51bGw7CiAgICAKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxldCBzY2FubmVkVVJMOwoKICAgIHRyeSAKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKSAKICAgIHsKICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IHRoYXR9KTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmKHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgiYXNrIikgPT0gImVnZ0NhcnRvbiIpCiAgICB7CiAgICAgICAgaWYgKHJlcXVlc3RpbmdBSSkgewogICAgICAgICAgICBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoInJlcXVlc3RpbmdBSSIsIHRydWUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBvcy5nb1RvVVJMKHNjYW5uZWRVUkwuaHJlZik7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4gewogICAgICAgICAgICBsZXQgbmV3VGFnID0ga2V5OwogICAgICAgICAgICBsZXQgbmV3VmFsdWUgPSB2YWx1ZTsKCiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzW25ld1RhZ10gPSBuZXdWYWx1ZTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmFzaykgewogICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLmFza30pOwogICAgICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucGF0dGVybikgewogICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm59KTsKICAgICAgICB9CiAgICAgICAgCiAgICB9Cn0nAImsoOUEwkQFc3RvcmUCBACJrKDlBOVUKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAImsoOUEwkQGc2VhcmNoAgQAiayg5QSMVSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCJrKDlBMJEEGFiQ29yZU1lbnVBY3Rpb24CBACJrKDlBLNVN0Bvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwoKY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gdHJ1ZTsnAImsoOUEwkQPYWJDb3JlTWVudUxhYmVsAgQAiayg5QTrVQRzY2FuJwCJrKDlBMJEDmFiQ29yZU1lbnVJY29uAgQAiayg5QTwVQ9xcl9jb2RlX3NjYW5uZXInAImsoOUEwkQTYWJDb3JlTWVudVNvcnRPcmRlcgIEAImsoOUEgFYBMycAiayg5QTCRAlhYlZlcnNpb24CBACJrKDlBIJWBTEwLjQyJwCJrKDlBMJEFGFiQ29yZU1lbnVDbGlja1NvdW5kAgQAiayg5QSIVhRhYi9hdWRpby9xcl9zY2FuLm1wMycBBGJvdHMkM2E2Y2I5Y2EtYjNiNC00ZDc3LTgyZjYtZmE1OWI1Mjk2ZWM5AScAiayg5QSdVgZzeXN0ZW0CBACJrKDlBJ5WF2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwCJrKDlBJ1WCGFiSWdub3JlAgQAiayg5QS2VgR0cnVlJwCJrKDlBJ1WD2Ryb3Bkb3duT3B0aW9ucwIEAImsoOUEu1YG8J+nrFtdJwCJrKDlBJ1WEmFiQ29yZU1lbnVJdGVtVHlwZQIEAImsoOUEwFYIZHJvcGRvd24nAImsoOUEnVYRZHJvcGRvd25Tb3J0T3JkZXICBACJrKDlBMlWBGF1dG8nAImsoOUEnVYYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQAiayg5QTOVsEgQGNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCmNvbnN0IGN1cnJlbnRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyAibWFwIiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT0gImJsdWVwcmludCIgPyAiYmx1ZXByaW50IiA6ImdyaWQiOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCi8vIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQovLyB9IGVsc2Ugew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCi8vIH0NCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTmF2aWdhdGlvbk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCg0KY29uc3QgZm9ybUFkZHJlc3NMaW5rID0gYXdhaXQgYWIuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwoIi9hYi9pY29ucy9lZ2dfcGxhbmV0X2xvZ28uc3ZnIik7DQoNCmNvbnN0IGhvbWVXb3JsZEJ1dHRvbiA9IHsNCiAgICAuLi5tZW51T3B0aW9ucywNCiAgICBsYWJlbDogImhvbWUgd29ybGQiLA0KICAgIGZvcm1BZGRyZXNzOiBmb3JtQWRkcmVzc0xpbmssDQogICAgb25DbGljazogYEANCiAgICAgICAgY29uc3QgY3VycmVudFVSTCA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKTsNCiAgICAgICAgY29uc3Qgb3JpZ2luID0gY3VycmVudFVSTC5vcmlnaW47DQoNCiAgICAgICAgbGV0IG5ld1VSTCA9IG5ldyBVUkwob3JpZ2luKTsNCg0KICAgICAgICBpZiAoYWJSZW1lbWJlci50YWdzLmFsbG93Q2hhbm5lbHMpIHsNCiAgICAgICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJjaGFubmVsIiwgZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmNvbUlkKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY29tSWQiLCBjb25maWdCb3QudGFncy5jb21JZCk7DQogICAgICAgIH0NCg0KICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgib3duZXIiLCAoY29uZmlnQm90LnRhZ3Muc3R1ZGlvICYmIGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAhPSBhdXRoQm90LmlkKSA/IGNvbmZpZ0JvdC50YWdzLnN0dWRpbyA6ICJwbGF5ZXIiKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImluc3QiLCAnaG9tZScpOw0KICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgibWFwUG9ydGFsIiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImFzayIsICdob21lJyk7DQogICAgICAgIA0KICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3Muc3R1ZGlvICYmIGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAhPSBhdXRoQm90LmlkKSB7DQogICAgICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJzdHVkaW8iLCB0aGF0LmlkKTsgDQogICAgICAgIH0NCg0KICAgICAgICBvcy5vcGVuVVJMKG5ld1VSTC5ocmVmKTsNCiAgICBgDQp9Ow0KDQppZiAoIWdldEJvdCgiaXNIb21lV29ybGRDb3JlIiwgdHJ1ZSkgJiYgYXV0aEJvdCkgew0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKGhvbWVXb3JsZEJ1dHRvbik7DQp9DQoNCmlmIChjdXJyZW50UG9ydGFsID09ICdtYXAnKSB7DQoNCiAgICBjb25zdCBob21lQmFzZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCg0KICAgIGlmIChob21lQmFzZUJvdCkgew0KICAgICAgICBjb25zdCBob21lQnV0dG9uID0gew0KICAgICAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgICAgICBsYWJlbDogaG9tZUJhc2VCb3QudGFncy5wbGFjZUxhYmVsLA0KICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvY2QzOGFmZmMwNjA0YmVhYTU4OGRhMjFhYTFiZTc1MGJiM2U3M2IzYjNjYWUyM2ViMzAzMDdjMzQ0OTQ0NTlmMy5wbmcnLA0KICAgICAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgICAgICBjb25zdCBob21lQm90ID0gZ2V0Qm90KCJob21lQmFzZSIsIHRydWUpOw0KICAgICAgICAgICAgICAgIGlmIChob21lQm90KSB7DQogICAgICAgICAgICAgICAgICAgIG9zLmZvY3VzT24oaG9tZUJvdCwgeyB6b29tOiAyMDAwIH0pLmNhdGNoKCgpID0+IHt9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIGANCiAgICAgICAgfTsNCg0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lQnV0dG9uKTsNCiAgICB9DQoNCiAgICBjb25zdCBwbGFjZXNBcnIgPSBbXTsNCiAgICBjb25zdCBwbGFjZXMgPSBnZXRCb3RzKCJob21lUGxhY2UiLCB0cnVlKTsNCiAgICBmb3IgKGNvbnN0IGhQbGFjZSBvZiBwbGFjZXMpIHsNCiAgICAgICAgaWYgKGhQbGFjZS50YWdzLmhvbWVCYXNlID09IHRydWUpIHsNCiAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHBsYWNlT2JqID0gew0KICAgICAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgICAgICBsYWJlbDogaFBsYWNlLnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnbG9jYXRpb25fb24nLA0KICAgICAgICAgICAgcGxhY2U6IGdldExpbmsoaFBsYWNlKSwNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgaWYgKGxpbmtzLnBsYWNlKSB7DQogICAgICAgICAgICAgICAgICAgIG9zLmZvY3VzT24obGlua3MucGxhY2UsIHsgem9vbTogMjAwMCB9KS5jYXRjaChlID0+IHt9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgICAgICBgDQogICAgICAgIH0NCg0KICAgICAgICBwbGFjZXNBcnIucHVzaChwbGFjZU9iaik7DQogICAgfQ0KDQogICAgcGxhY2VzQXJyLnNvcnQoKGEsIGIpID0+IHsNCiAgICAgICAgY29uc3QgbmFtZUEgPSBhLmxhYmVsLnRvVXBwZXJDYXNlKCk7DQogICAgICAgIGNvbnN0IG5hbWVCID0gYi5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KDQogICAgICAgIGlmIChuYW1lQSA8IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG5hbWVBID4gbmFtZUIpIHsNCiAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAwOw0KICAgIH0pOw0KDQogICAgZm9yIChjb25zdCBzb3J0ZWRQbGFjZSBvZiBwbGFjZXNBcnIpIHsNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goc29ydGVkUGxhY2UpOw0KICAgIH0NCg0KDQogICAgY29uc3QgY3VycmVudExvY2F0aW9uQnV0dG9uID0gew0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgbGFiZWw6ICdjdXJyZW50IGxvY2F0aW9uJywNCiAgICAgICAgZm9ybUFkZHJlc3M6ICduZWFyX21lJywNCiAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgIGxpbmtzLnNraWxsQm90LmdvVG9DdXJyZW50TG9jYXRpb24oKTsNCiAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgIGANCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChjdXJyZW50TG9jYXRpb25CdXR0b24pOw0KfQ0KDQppZiAoZHJvcGRvd25PcHRpb25zLmxlbmd0aCA9PSAwKSB7DQogICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQp9IGVsc2Ugew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCn0NCg0KbWFza3MuZHJvcGRvd25PcHRpb25zID0gZHJvcGRvd25PcHRpb25zOw0KDQpyZXR1cm47JwCJrKDlBJ1WEGFiQ29yZU1lbnVBY3Rpb24CBACJrKDlBJB3A0AvLycAiayg5QSdVgthYkludGVyZmFjZQIEAImsoOUElHcEdHJ1ZScAiayg5QSdVg9hYkNvcmVNZW51TGFiZWwCBACJrKDlBJl3BnBsYWNlcycAiayg5QSdVgRmb3JtAgQAiayg5QSgdwdub3RoaW5nJwCJrKDlBJ1WE2dvVG9DdXJyZW50TG9jYXRpb24CBACJrKDlBKh3gARAY29uc3QgbG9jYXRpb24gPSBhd2FpdCBvcy5nZXRHZW9sb2NhdGlvbigpOw0KDQppZiAobG9jYXRpb24uc3VjY2Vzcykgew0KICAgIGNvbnN0IGN1cnJlbnREaW0gPSBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uOw0KICAgIGNvbnN0IGN1cnJlbnRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyAibWFwIiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT0gImJsdWVwcmludCIgPyAiYmx1ZXByaW50IiA6ImdyaWQiOw0KDQogICAgaWYgKGN1cnJlbnRQb3J0YWwgIT0gJ21hcCcpIHsNCiAgICAgICAgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID0gY3VycmVudERpbTsNCiAgICB9DQoNCiAgICBvcy5mb2N1c09uKHt4OiBsb2NhdGlvbi5sb25naXR1ZGUsIHk6IGxvY2F0aW9uLmxhdGl0dWRlfSwge3BvcnRhbDogJ21hcCcsIHpvb206IDIwMDB9KTsNCn0gZWxzZSB7DQogICAgb3MudG9hc3QoIkxvY2F0aW9uIHNlcnZpY2VzIG5vdCBhdmFpbGFibGUiKQ0KfScAiayg5QSdVglhYlZlcnNpb24CBACJrKDlBKl7BTEwLjQyJwEEYm90cyQ0OTNmZmE0ZC00NmQ0LTRhOTgtYWU5Yy0xMjEyZDY1MTEzM2YBJwCJrKDlBK97BnN5c3RlbQIEAImsoOUEsHsUYWIuaW50ZXJmYWNlLnZlcnNpb24nAImsoOUEr3sNb25Ta2lsbFVwZGF0ZQIEAImsoOUExXunAUBjb25zdCB2ZXJzaW9uU3RyaW5nID0gdGFncy5hYkludGVyZmFjZU1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJJbnRlcmZhY2VNaW5vclZlcnNpb247DQoNCmNvbnNvbGUubG9nKCJbQUJJbnRlcmZhY2VdIExvYWRlZCBBQiBJbnRlcmZhY2UgdmVyc2lvbiAiICsgdmVyc2lvblN0cmluZyk7JwCJrKDlBK97F2FiSW50ZXJmYWNlTWFqb3JWZXJzaW9uAgQAiayg5QTtfAEyJwCJrKDlBK97CGFiSWdub3JlAgQAiayg5QTvfAR0cnVlJwCJrKDlBK97BGZvcm0CBACJrKDlBPR8B25vdGhpbmcnAImsoOUEr3sLYWJJbnRlcmZhY2UCBACJrKDlBPx8BHRydWUnAImsoOUEr3sJYWJWZXJzaW9uAgQAiayg5QSBfQUxMC40MicAiayg5QSvexdhYkludGVyZmFjZU1pbm9yVmVyc2lvbgIEAImsoOUEh30CNDUnAQRib3RzJDRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZgEnAImsoOUEin0Gc3lzdGVtAgQAiayg5QSLfRNhYi5pbnRlcmZhY2UubnVnZ2V0JwCJrKDlBIp9BGZvcm0CBACJrKDlBJ99B25vdGhpbmcnAImsoOUEin0LYWJJbnRlcmZhY2UCBACJrKDlBKd9BHRydWUnAImsoOUEin0IYWJJZ25vcmUCBACJrKDlBKx9BHRydWUnAImsoOUEin0MYWJMb2FkTnVnZ2V0AgQAiayg5QSxfZgCQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXROYW1lOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrbnVnZ2V0TmFtZTsKbGV0IGxvYWRlZE51Z2dldCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogZm9ybWF0dGVkTnVnZ2V0QUIsIGFiVmVyc2lvbjogdGhhdC52ZXJzaW9uLCByZXR1cm5UeXBlOiAiZGF0YSJ9KTsKCmxvYWRlZE51Z2dldCA9IGxvYWRlZE51Z2dldC5zdGF0ZVtudWdnZXROYW1lXS5udWdnZXQ7CgpyZXR1cm4gbG9hZGVkTnVnZ2V0OycAiayg5QSKfQ9hYlB1Ymxpc2hOdWdnZXQCBACJrKDlBMp/jANALy9zaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogIm51Z05hbWUiLCBkYXRhOiBkYXRhfSk7ICBBREQgRUdHIElEIEVWRU5UVUFMTFkKbGV0IHRlc3ROdWdnZXQgPSB0aGF0LmRhdGE7CmxldCBmb3JtYXR0ZWROdWdnZXQgPSB7aWQ6IHRoYXQubnVnLCBudWdnZXQ6IHRlc3ROdWdnZXR9OwpsZXQgdGVzdE51Z2dldE5hbWUgPSB0aGF0Lm51ZzsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK3Rlc3ROdWdnZXROYW1lOwoKbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gZm9ybWF0dGVkTnVnZ2V0QUI7CgpsaW5rcy5zdG9yZS5hYlB1Ymxpc2hBQih7YWI6IGZvcm1hdHRlZE51Z2dldEFCLCB0YXJnZXQ6IGZvcm1hdHRlZE51Z2dldCwgc291cmNlRXZlbnQ6ICdwdWJsaXNoX251Z2dldCd9KTsnAImsoOUEin0PaW1wbGVtZW50TnVnZ2V0AgQAiayg5QTXggGxB0BsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0OwpsZXQgbnVnZ2V0VmVyc2lvbkNoZWNrID0gbnVnZ2V0TmFtZS5pbmRleE9mKCIudiIpOwpsZXQgdmVyc2lvbjsKCmlmIChudWdnZXRWZXJzaW9uQ2hlY2sgIT0gLTEpCnsKICAgIG51Z2dldE5hbWUgPSBudWdnZXROYW1lLnN1YnN0cmluZygwLCBudWdnZXRWZXJzaW9uQ2hlY2spOwoKICAgIGxldCB2ZXJzaW9uQ2hlY2sgPSB0aGF0Lm51Z2dldC5zdWJzdHJpbmcobnVnZ2V0VmVyc2lvbkNoZWNrICsgMik7CgogICAgaWYgKGlzTmFOKHZlcnNpb25DaGVjaykpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2codmVyc2lvbkNoZWNrLCAidmVyc2lvbiBpcyBub3QgYSBudW1iZXIiKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB2ZXJzaW9uID0gTnVtYmVyKHZlcnNpb25DaGVjayk7CiAgICB9Cn0KY29uc29sZS5sb2cobnVnZ2V0TmFtZSwgdmVyc2lvbik7CmxldCBudWdEYXRhID0gYXdhaXQgdGhpc0JvdC5hYkxvYWROdWdnZXQoe251Z2dldE5hbWU6IG51Z2dldE5hbWUsIHZlcnNpb246IHZlcnNpb259KTsKCmlmIChudWdEYXRhID09ICJhYklEIG5vdCBmb3VuZCIpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgbm90IGZvdW5kIik7Cn0KZWxzZQp7CiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKICAgIGxldCB0YXJnZXRUYWcgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS50b1N0cmluZygpOwogICAgbGV0IHRhcmdldE51ZyA9ICJ7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRUYWcuaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKICAgIGluc2VydFRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCBudWdEYXRhKTsKfScAiayg5QSKfQxudWdnZXRCdXR0b24CBACJrKDlBImKAfUMQGxldCB0YWdWYWx1ZSA9IHRoYXQudGFnVmFsdWU7CmxldCByZWdleCA9IC9cbi9naTsKbGV0IGJyZWFrQ2hlY2s7CmxldCBicmVha0FycmF5ID0gWzBdOwovL2xldCBjcmVhdGVkQnV0dG9ucyA9IFtdOwoKd2hpbGUgKGJyZWFrQ2hlY2sgPSByZWdleC5leGVjKHRhZ1ZhbHVlKSkKewogICAgYnJlYWtBcnJheS5wdXNoKGJyZWFrQ2hlY2suaW5kZXgpOwp9CgpsZXQgbmV3TnVnZ2V0QnV0dG9uID0ge307CgpuZXdOdWdnZXRCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TnVnZ2V0QnV0dG9uLmZvcm0gPSAiY29kZUJ1dHRvbiI7Cm5ld051Z2dldEJ1dHRvbi50YXJnZXRCb3QgPSB0aGF0LmJvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldFRhZyA9IHRoYXQudGFnOwpuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAibG9hZCBudWdnZXQiOwpuZXdOdWdnZXRCdXR0b24ubnVnZ2V0UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnXSA9IHRydWU7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRNYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLmltcGxlbWVudE51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKZGVzdHJveSh0aGlzQm90KTtgOwoKZm9yIChsZXQgbnVncyA9IDA7IG51Z3MgPCB0aGF0Lm51Z2dldC5sZW5ndGg7IG51Z3MrKykKewogICAgbGV0IGN1cnJlbnROdWdnZXQgPSB0aGF0Lm51Z2dldFtudWdzXTsKICAgIC8vbGV0IGJ1dHRvbkNoZWNrID0gY3JlYXRlZEJ1dHRvbnMuaW5kZXhPZihjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwoKICAgIGlmICghY3VycmVudE51Z2dldCB8fCBjdXJyZW50TnVnZ2V0ID09IHVuZGVmaW5lZCkgLy98fCBidXR0b25DaGVjayAhPSAtMQogICAgewogICAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChjdXJyZW50TnVnZ2V0Lm51Z1B1Ymxpc2gpCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLnBhY2thZ2VOdWdnZXQoe2JvdDogdGFncy50YXJnZXRCb3QsIG51Z2dldDogdGFncy50YXJnZXROdWdnZXQsIHRhZzogdGFncy50YXJnZXRUYWd9KTsKCiAgICAgICAgZGVzdHJveSh0aGlzQm90KTtgOwoKICAgICAgICBuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAicHVibGlzaCAiICsgY3VycmVudE51Z2dldC5udWdOYW1lICsgIiBudWdnZXQiOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CgogICAgbmV3TnVnZ2V0QnV0dG9uLnRhcmdldE51Z2dldCA9IGN1cnJlbnROdWdnZXQubnVnTmFtZTsKICAgIG5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnICsgIlN0YXJ0Il0gPSBjdXJyZW50TnVnZ2V0Lm51Z1N0YXJ0OwoKICAgIGNyZWF0ZShuZXdOdWdnZXRCdXR0b24pOwoKICAgIC8vY3JlYXRlZEJ1dHRvbnMucHVzaChjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwp9CgpyZXR1cm47JwCJrKDlBIp9C251Z2dldFBhcnNlAgQAiayg5QT9lgGnD0Bjb25zdCBvcmlnaW5hbFRhZ1ZhbHVlID0gdGhhdC5lZGl0ZWRCb3QucmF3W3RoYXQuZWRpdGVkVGFnXTsKbGV0IHRhZ1ZhbHVlID0gb3JpZ2luYWxUYWdWYWx1ZTsKCmlmICghdGFnVmFsdWUpIAp7CiAgICByZXR1cm47Cn0KZWxzZSBpZiAodHlwZW9mIHRhZ1ZhbHVlICE9PSAic3RyaW5nIikgCnsKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUudG9TdHJpbmcoKTsKfQoKbGV0IGluaXRpYWxQb3NzaWJsZU51Z1BvcyA9IDA7CgppZiAoaW5pdGlhbFBvc3NpYmxlTnVnUG9zID09IC0xKSAKewogICAgcmV0dXJuOwp9CmVsc2UKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbFBvc3NpYmxlTnVnUG9zKTsKfQoKbGV0IHBvc3NpYmxlTnVncyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW157XS9nLCAiIikubGVuZ3RoOwpsZXQgdG90YWxOdWdCcmVha3MgPSBvcmlnaW5hbFRhZ1ZhbHVlLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CmxldCBicmVha0xldmVsID0gMDsKbGV0IG51Z3NUb0NoZWNrID0gW107Cgpmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlTnVnczsgaSsrKQp7CiAgICBsZXQgaW5pdGlhbE51Z1BvcyA9IHRhZ1ZhbHVlLmluZGV4T2YoInsiKSArIDE7CiAgICBsZXQgcG9zc2libGVOdWdFbmQgPSB0YWdWYWx1ZS5pbmRleE9mKCJ9Iik7CiAgICBsZXQgcG9zc2libGVOdWcgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcywgcG9zc2libGVOdWdFbmQpOwoKICAgIGlmIChwb3NzaWJsZU51Zy5pbmRleE9mKCIgIikgPT0gLTEgJiYgL1xuL2cudGVzdChwb3NzaWJsZU51ZykgIT0gdHJ1ZSAmJiBwb3NzaWJsZU51Zy5sZW5ndGggPiAwICYmIHBvc3NpYmxlTnVnLmluZGV4T2YoIjoiKSA9PSAtMSkKICAgIHsKICAgICAgICBsZXQgbnVnQnJlYWtzID0gdGFnVmFsdWUuc3Vic3RyaW5nKDAsIHRhZ1ZhbHVlLmluZGV4T2YoInsiK3Bvc3NpYmxlTnVnKyJ9IikpLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CiAgICAgICAgbGV0IHB1Ymxpc2hDaGVjayA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zIC0gNiwgaW5pdGlhbE51Z1BvcyAtIDIpOwogICAgICAgIGxldCBudWdQdWJsaXNoID0gbnVsbDsKCiAgICAgICAgaWYgKHB1Ymxpc2hDaGVjayA9PSAiLm51ZyIpCiAgICAgICAgewogICAgICAgICAgICBudWdQdWJsaXNoID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJyZWFrTGV2ZWwgKz0gbnVnQnJlYWtzOwoKICAgICAgICBudWdCcmVha3MgPSB0b3RhbE51Z0JyZWFrcyAtICh0b3RhbE51Z0JyZWFrcyAtIGJyZWFrTGV2ZWwpOwogICAgICAgIAogICAgICAgIC8vQ0hFQ0sgSUYgJCBiZWZvcmUgbnVnZ2V0CiAgICAgICAgaWYgKHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zIC0gMiwgaW5pdGlhbE51Z1BvcyAtIDEpICE9ICIkIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z3NUb0NoZWNrLnB1c2goe251Z05hbWU6IHBvc3NpYmxlTnVnLCBudWdTdGFydDogbnVnQnJlYWtzICsgMSwgbnVnUHVibGlzaDogbnVnUHVibGlzaH0pOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBsZXQgbnVnQnJlYWtzID0gdGFnVmFsdWUuc3Vic3RyaW5nKDAsIHRhZ1ZhbHVlLmluZGV4T2YoIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICB9CgogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS5zdWJzdHJpbmcocG9zc2libGVOdWdFbmQgKyAxKTsKfQoKdGhpc0JvdC5udWdnZXRCdXR0b24oeyBudWdnZXQ6IG51Z3NUb0NoZWNrLCBib3Q6IHRoYXQuZWRpdGVkQm90LCB0YWc6IHRoYXQuZWRpdGVkVGFnLCB0YWdWYWx1ZTogb3JpZ2luYWxUYWdWYWx1ZX0pOycAiayg5QSKfQ1vbkFCUHVibGlzaGVkAgQAiayg5QSlpgHBAUBjb25zb2xlLmxvZyh0aGF0LmFiLCB0YWdzLm51Z2dldFRvUHVibGlzaCkKCmlmICh0aGF0LmFiID09IHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IHB1Ymxpc2hlZCIpOwoKICAgIG1hc2tzLm51Z2dldFRvUHVibGlzaCA9IG51bGw7CgogICAgY29uZmlnQm90Lm1hc2tzLmFiVmVyc2lvbiA9IG51bGw7Cn0nAImsoOUEin0Qb25BbnlCb3RzQ2hhbmdlZAIEAImsoOUE56cBtwRAaWYgKGNvbmZpZ0JvdCAmJiB0aGF0WzBdLmJvdC5pZCAhPSB0aGlzQm90LmlkKSAKewogICAgaWYgKCFjb25maWdCb3QudGFncy5lZGl0aW5nQm90KSByZXR1cm47IC8vIElnbm9yZSBpZiB0aGUgY29uZmlnQm90IGlzbid0IHJlYWR5IHlldC4KCiAgICBjb25zdCBlZGl0ZWRCb3RJRCA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QucmVwbGFjZSgi8J+UlyIsICIiKTsKCiAgICBpZiAoIXRoYXQuZmluZCh4ID0+IHguYm90LmlkID09IGVkaXRlZEJvdElEKSkgcmV0dXJuOyAvLyBJZiB0aGUgYm90IGNoYW5nZWQgd2Fzbid0IGJlaW5nIGVkaXRlZCBieSB0aGUgdXNlciBpZ25vcmUgaXQuCgogICAgY29uc3QgZWRpdGVkVGFnID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ1RhZzsKICAgIGNvbnN0IGVkaXRlZEJvdCA9IGdldEJvdCgiaWQiLCBlZGl0ZWRCb3RJRCk7CgogICAgaWYgKGVkaXRlZEJvdCAmJiBlZGl0ZWRUYWcpIAogICAgewogICAgICAgIHNob3V0KCJudWdnZXRSZXNldCIpOwoKICAgICAgICB0aGlzQm90Lm51Z2dldFBhcnNlKHsgZWRpdGVkQm90LCBlZGl0ZWRUYWcgfSk7CiAgICB9Cn0nAImsoOUEin0Ib25DcmVhdGUCBACJrKDlBJ2sAUxAdGFncy5saXN0ZW5pbmcgPSBmYWxzZTsKCi8vc2V0VGFnTWFzayh0aGlzQm90LCAibGlzdGVuaW5nIiwgdHJ1ZSwgImxvY2FsIik7JwCJrKDlBIp9DXBhY2thZ2VOdWdnZXQCBACJrKDlBOqsAfgGQGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CmNvbnN0IHRhZ1RleHQgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXTsKCmlmIChjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4IHx8IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4KQp7CiAgICBsZXQgc3RhcnRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4OwogICAgbGV0IGVuZFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4OwoKICAgIGlmIChzdGFydFBvcyA9PSBlbmRQb3MpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoc3RhcnRQb3MgPiBlbmRQb3MpCiAgICB7CiAgICAgICAgbGV0IG5ld1N0YXJ0UG9zID0gZW5kUG9zOwogICAgICAgIGxldCBuZXdFbmRQb3MgPSBzdGFydFBvczsKCiAgICAgICAgc3RhcnRQb3MgPSBuZXdTdGFydFBvczsKICAgICAgICBlbmRQb3MgPSBuZXdFbmRQb3M7CiAgICB9CgogICAgbGV0IGRhdGEgPSB0YWdUZXh0LnN1YnN0cmluZyhzdGFydFBvcywgZW5kUG9zICsgMSk7CgogICAgc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6IHRoYXQubnVnZ2V0LCBkYXRhOiBkYXRhfSk7CgogICAgb3MudG9hc3QoIm51ZyBpcyBwdWJsaXNoaW5nIiwgMTApOwoKICAgIGxldCB0YXJnZXROdWcgPSAiLm51ZyB7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImNhbm5vdCByZWFkIG51Z2dldCB0byBiZSBwdWJsaXNoZWQiKQp9JwCJrKDlBIp9CHJlbWVtYmVyAgQAiayg5QTjswEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAiayg5QSKfQZzZWFyY2gCBACJrKDlBIq0ASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCJrKDlBIp9BXN0b3JlAgQAiayg5QSxtAEo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAiayg5QSKfQlsaXN0ZW5pbmcCBACJrKDlBNi0AQVmYWxzZScAiayg5QSKfQlhYlZlcnNpb24CBACJrKDlBN60AQUxMC40MicBBGJvdHMkYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiAScAiayg5QTktAEIcHJlc2VuY2UCBACJrKDlBOW0ASjwn5SXODdlOTUzNDItZTQ1Ni00YjYzLTk4OTEtZDdhOTIxYWQzZWU3JwCJrKDlBOS0ARlhYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yAgQAiayg5QSMtQHODEBjb25zdCB7CiAgICBsYWJlbCA9IGAke2FiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX0gaXMgd29ya2luZ2AsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9CgpsZXQgYnVzeUluZGljYXRvciA9IHsKICAgIG9uUG9pbnRlclVwOiBudWxsLAogICAgb25Qb2ludGVyRG93bjogbnVsbCwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBidXN5TGFiZWw6IGxhYmVsLAogICAgbGFiZWxBbGlnbm1lbnQ6ICdsZWZ0JywKICAgIHN0YXRlOiAwLAogICAgYW5pbVN0YXRlczogWwogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcnLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICBdLAogICAgYW5pbVJhdGU6IDUwMCwKICAgIG9uQm90QWRkZWQ6IGBACiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIG9uQm90Q2hhbmdlZDogYEAKICAgICAgICBjb25zdCBuZWVkUmVmcmVzaCA9IHRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2J1c3lMYWJlbCcgfHwgdCA9PT0gJ3N0YXRlJyB8fCB0ID09PSAnYW5pbVN0YXRlcycpOwogICAgICAgIGlmIChuZWVkUmVmcmVzaCkgewogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfQogICAgYCwKICAgIHJlZnJlc2hEaXNwbGF5OiBgQAogICAgICAgIGlmICh0YWdzLmFuaW1TdGF0ZXMgJiYgdGFncy5hbmltU3RhdGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgYW5pbVN0YXRlID0gdGFncy5hbmltU3RhdGVzW3RhZ3Muc3RhdGVdOwoKICAgICAgICAgICAgdGFncy5sYWJlbCA9IHRhZ3MuYnVzeUxhYmVsLnRyaW0oKSArIGFuaW1TdGF0ZS5lbGxpcHNpczsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGFuaW1TdGF0ZS5mb3JtQWRkcmVzczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLmxhYmVsIAogICAgICAgIH0KICAgIGAsCiAgICBhbmltYXRlOiBgQAogICAgICAgIGlmICh0YWdzLnN0YXRlID49IHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgKz0gMTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLnNsZWVwKHRhZ3MuYW5pbVJhdGUpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIC4uLnJlc3QKfTsKCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihidXN5SW5kaWNhdG9yKTsKCnJldHVybiBtZW51Qm90OycAiayg5QTktAEGc3lzdGVtAgQAiayg5QTbwQERYWIuaW50ZXJmYWNlLm1lbnUnAImsoOUE5LQBBGZvcm0CBACJrKDlBO3BAQdub3RoaW5nJwCJrKDlBOS0AQtkZXNjcmlwdGlvbgIEAImsoOUE9cEBJlRoaXMgc2tpbGwgaXMgZGVzaWduZWQgZm9yIG1lbnUgc3R1ZmYuKACJrKDlBOS0AQthYkludGVyZmFjZQF4JwCJrKDlBOS0AQphYk9wZW5NZW51AgQAiayg5QSdwgG8IEBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBtZW51VHlwZSA9IHRoYXQgPyAiYWIiICsgdGhhdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoYXQuc2xpY2UoMSkgKyAiTWVudSI6ICJhYkNvcmVNZW51IjsgLy9zZXQgdXAgYSBjaGVjayB0byBzZWUgd2hhdCB0eXBlIG9mIG1lbnUgc2hvdWxkIGJlIG9jY3VyaW5nIFtjb3JlLCBib3QsIGdyaWQsIGluc3RdCmxldCBtZW51U2tpbGxzID0gZ2V0Qm90cyhtZW51VHlwZSArICJBY3Rpb24iKTsKbGV0IG1heE9wdGlvbnMgPSBtZW51VHlwZSA9PSAiaW5zdCIgPyA3IDogNTsKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5wZXJzb25hbGl0eSA9IHRhZ3MucGVyc29uYWxpdHk7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5iYXNlU2tpbGwuJHttZW51VHlwZSArICJBY3Rpb24ifSh7Ym90OiB0aGlzQm90fSk7YDsKCmxldCBzb3J0T3JkZXJJbmRleCA9IG1lbnVTa2lsbHMubGVuZ3RoOwpmb3IgKGxldCBpID0gMDsgaSA8IG1lbnVTa2lsbHMubGVuZ3RoOyBpKyspLy9BREQgTE9HSUMgRk9SIE1PUkUgT1BUSU9OUyBUSEFOIDUgOiBtYXhPcHRpb25zCnsKICAgIC8vQWxsb3dzIGZvciBjb2RlIHRvIGdldCBjYWxsZWQgYmVmb3JlIHRoZSBtZW51IGdlbmVyYXRlcywgdXNlZnVsIGZvciBkeW5hbWljYWxseSBzZXQgZ3JvdXBzIG9yIGRyb3Bkb3ducwogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJPbkJlZm9yZUNyZWF0ZSJdKSB7CiAgICAgICAgYXdhaXQgd2hpc3BlcihtZW51U2tpbGxzW2ldLCBtZW51VHlwZSArICJPbkJlZm9yZUNyZWF0ZSIpOwogICAgfSAKCiAgICBpZiAobWVudVNraWxsc1tpXS50YWdzW21lbnVUeXBlICsgIkhpZGUiXSkgewogICAgICAgIGNvbnRpbnVlOwogICAgfQogICAgCiAgICBsZXQgY3VycmVudFNraWxsID0gbWVudVNraWxsc1tpXTsKCiAgICBhYk1lbnVCdXR0b24uYmFzZVNraWxsID0gIvCflJciICsgY3VycmVudFNraWxsLmlkOwogICAgYWJNZW51QnV0dG9uLmxhYmVsID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiTGFiZWwiXTsKICAgIGFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkljb24iXTsKICAgIGFiTWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIk9uR2VuZXJhdGUiXTsKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJTb3J0T3JkZXIiXTsKICAgIGFiTWVudUJ1dHRvbi5jb2xvciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkNvbG9yIl0gPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7CgogICAgY29uc3QgY2xpY2tTb3VuZCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgJ0NsaWNrU291bmQnXTsKICAgIGlmIChjbGlja1NvdW5kICE9IG51bGwpIHsKICAgICAgICBhYk1lbnVCdXR0b24uc291bmRDbGljayA9IGNsaWNrU291bmQ7CiAgICB9IGVsc2UgewogICAgICAgIGRlbGV0ZSBhYk1lbnVCdXR0b24uc291bmRDbGljazsKICAgIH0KCiAgICBjb25zdCBtZW51SXRlbVR5cGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdOwoKICAgIGlmIChtZW51SXRlbVR5cGUgPT0gImRyb3Bkb3duIikgewogICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93bk9wdGlvbnMgPSBjdXJyZW50U2tpbGwudGFncy5kcm9wZG93bk9wdGlvbnM7CgogICAgICAgIGNvbnN0IHByZXZEcm9wZG93biA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmxhc3RPcGVuZWREcm9wZG93bjsKICAgICAgICBpZiAocHJldkRyb3Bkb3duICYmIHByZXZEcm9wZG93bi50YWdzW21lbnVUeXBlICsgIkFjdGlvbiJdKSB7CiAgICAgICAgICAgIGlmIChwcmV2RHJvcGRvd24gPT0gY3VycmVudFNraWxsKSB7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLnJlbWVtYmVyLCAibGFzdE9wZW5lZERyb3Bkb3duIiwgbnVsbCk7CiAgICAgICAgICAgICAgICBhYk1lbnVCdXR0b24uZGVmYXVsdE9wZW4gPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGVsZXRlIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbjsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJEZWZhdWx0T3BlbiJdID09IHRydWUpIHsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiTWVudUJ1dHRvbik7ICAgICAgICAKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJncm91cCIpIHsKICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyID09ICJhdXRvIikgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBzb3J0T3JkZXJJbmRleDsKICAgICAgICAgICAgKytzb3J0T3JkZXJJbmRleDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFncy5ncm91cFNvcnRPcmRlcjsKICAgICAgICB9CiAgICAgICAgYWJNZW51QnV0dG9uLm1lbnVJdGVtcyA9IGN1cnJlbnRTa2lsbC50YWdzLm1lbnVJdGVtczsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUdyb3VwKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtVHlwZSA9PSAiaW5wdXQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gInRleHQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtVHlwZSA9PSAidG9vbCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2woYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJ3aXphcmQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsKICAgIH0KfQoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCT3Blbk1lbnUnLCB7IG1lbnU6IHRoYXQsIG1lbnVUeXBlLCBtZW51UG9ydGFsOiBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCB9KTsnAImsoOUE5LQBEmFiQ3JlYXRlTWVudUJ1dHRvbgIEAImsoOUE2OIBoA9AbGV0IG5ld01lbnVCdXR0b24gPSB7fTsKCmxldCB7CiAgICBtZW51SXRlbVN0eWxlID0ge30sCiAgICAuLi5hZGRpdGlvbmFsVGFncwp9ID0gdGhhdCA/PyB7fQoKaWYgKHR5cGVvZiBtZW51SXRlbVN0eWxlID09ICdzdHJpbmcnKSB7CiAgICBtZW51SXRlbVN0eWxlID0gbWVudUl0ZW1TdHlsZS5yZXBsYWNlKC9cdXsxRjlFQ30vdSwgJycpOyAKICAgIG1lbnVJdGVtU3R5bGUgPSBKU09OLnBhcnNlKG1lbnVJdGVtU3R5bGUpOwp9CgpmdW5jdGlvbiBoYXNCb3JkZXJTdHlsZSgpIHsKICAgIGlmIChtZW51SXRlbVN0eWxlWyJib3JkZXItdG9wLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLWxlZnQtc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItYm90dG9tLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLXJpZ2h0LXN0eWxlIl0pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KCmlmIChhZGRpdGlvbmFsVGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSkgewogICAgaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiTWVudUdyb3VwIl0pIHsKCiAgICB9Cn0KCm5ld01lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwpuZXdNZW51QnV0dG9uLmxhYmVsQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVMYWJlbENvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKbmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvciA9IHRoYXQuc2hhZG93Q29sb3IgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTaGFkb3dDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24uc2NhbGVZID0gMTsKbmV3TWVudUJ1dHRvbi5zb3VuZENsaWNrID0gIvCfp6wiICsgSlNPTi5zdHJpbmdpZnkoWwogICAgImFiL2F1ZGlvL2J1dHRvbiBjbGlja18wMS5tcDMiLAogICAgImFiL2F1ZGlvL2J1dHRvbiBjbGlja18wMi5tcDMiLAogICAgImFiL2F1ZGlvL2J1dHRvbiBjbGlja18wMy5tcDMiCl0pOwoKY29uc3QgbWVudVN0eWxpbmcgPSB7CiAgICAiYm9yZGVyLXJhZGl1cyI6IjhweCIsCiAgICAibWFyZ2luLXRvcCI6ICI4cHgiLAogICAgImJveC1zaGFkb3ciOiBgM3B4IDRweCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJtaW4taGVpZ2h0IjogIjQ0cHgiLAogICAgImJvcmRlciI6IGhhc0JvcmRlclN0eWxlKCkgPyAiIiA6IGAycHggc29saWQgJHtuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yfWAsCiAgICAid2lkdGgiOiAiY2FsYygxMDAlIC0gNXB4KSIsCiAgICAuLi5tZW51SXRlbVN0eWxlCn0KCm5ld01lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IG1lbnVTdHlsaW5nOwoKY29uc3QgY2xpY2tlZFN0eWxpbmcgPSB7CiAgICAuLi5tZW51U3R5bGluZywKICAgICJmaWx0ZXIiOiAiYnJpZ2h0bmVzcyg2MCUpIgp9CmNvbnN0IGJhc2VTdHlsZSA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSAn8J+nrCAke0pTT04uc3RyaW5naWZ5KGNsaWNrZWRTdHlsaW5nKX0nYAoKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJEb3duID0gbWVudUl0ZW1TdHlsZT8uWyJtYXJnaW4tdG9wIl0gIT0gIjBweCIgPyBiYXNlU3R5bGUgOiAiQCAvLyI7Cm5ld01lbnVCdXR0b24ub25Qb2ludGVyVXAgPSBgQCBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbGA7Cgpmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykKewogICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsKfQoKbmV3TWVudUJ1dHRvbiA9IGNyZWF0ZShuZXdNZW51QnV0dG9uKTsKCnJldHVybiBuZXdNZW51QnV0dG9uOycAiayg5QTktAENYWJNZW51UmVmcmVzaAIEAImsoOUE9fEBnQFAaWYgKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw/LnN1YnN0cmluZygwLDIpID09ICJhYiIpCnsKICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKCiAgICBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7CiAgICBtYXNrcy5vbktleURvd24gPSBudWxsOwp9JwCJrKDlBOS0AQhyZW1lbWJlcgIEAImsoOUEk/MBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAImsoOUE5LQBDW1hbmlmZXN0YXRpb24CBACJrKDlBLrzASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCJrKDlBOS0ARFhYkVudmlyb25tZW50TWVudQIEAImsoOUE4fMBwRJAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7Cgpjb25zdCBhYk1lbnVJdGVtID0gewogICAgYWJNZW51OiB0cnVlLAogICAgYWJNZW51UmVmcmVzaDogIkBkZXN0cm95KHRoaXNCb3QpOyIsCiAgICBtYW5pZmVzdGF0aW9uOiB0YWdzLm1hbmlmZXN0YXRpb24sCiAgICByZW1lbWJlcjogdGFncy5yZW1lbWJlciwKICAgIHBlcnNvbmFsaXR5OiB0YWdzLnBlcnNvbmFsaXR5LAogICAgbGVhcm46IHRhZ3MubGVhcm4sCn07Cgpjb25zdCBhYkVudmlyb25tZW50T3B0aW9ucyA9IHRoaXNCb3QuYWJHZXRFbnZpcm9ubWVudE9wdGlvbnMoKTsgCgpmb3IgKGxldCBpID0gMDsgaSA8IGFiRW52aXJvbm1lbnRPcHRpb25zLmxlbmd0aDsgaSsrKSB7IAogICAgY29uc3Qgb3B0aW9uID0gYWJFbnZpcm9ubWVudE9wdGlvbnNbaV07CgogICAgYXNzZXJ0KHR5cGVvZiBvcHRpb24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIgPT09ICdudW1iZXInLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX19XSBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciBtdXN0IGJlIGEgbnVtYmVyLmApOwoKICAgIGFiTWVudUl0ZW0uYWJNZW51U29ydE9yZGVyID0gb3B0aW9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOwoKICAgIGNvbnN0IG9wdGlvbk1vZCA9IHsuLi5hYk1lbnVJdGVtLCAuLi5vcHRpb259OwoKICAgIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAnYnV0dG9uJyB8fCAhb3B0aW9uLm1lbnVJdGVtVHlwZSkgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICdkcm9wZG93bicpIHsKICAgICAgICBvcHRpb25Nb2QuZHJvcGRvd25Tb3J0T3JkZXIgPSBvcHRpb24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI7CgogICAgICAgIC8vIE1ha2Ugc3VyZSBlYWNoIGRyb3Bkb3duIG9wdGlvbnMgZ2V0cyBhYk1lbnVJdGVtIGRlZmF1bHRzLgogICAgICAgIGlmIChvcHRpb24uZHJvcGRvd25PcHRpb25zICYmIG9wdGlvbi5kcm9wZG93bk9wdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IG9wdGlvbi5kcm9wZG93bk9wdGlvbnMubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgICAgIG9wdGlvbi5kcm9wZG93bk9wdGlvbnNba10gPSB7IC4uLmFiTWVudUl0ZW0sIC4uLm9wdGlvbi5kcm9wZG93bk9wdGlvbnNba10gfTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bihvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAnZ3JvdXAnKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVHcm91cChvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAnaW5wdXQnKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAndGV4dCcpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ3Rvb2wnKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUb29sKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICd3aXphcmQnKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQob3B0aW9uTW9kKTsKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG1lbnVJdGVtVHlwZSAke29wdGlvbi5tZW51SXRlbVR5cGV9IGlzIG5vdCBpbXBsZW1lbnRlZC5gKTsKICAgICAgICBjb250aW51ZTsKICAgIH0KfQoKLy8gdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bihhYlBlcnNvbmFsaXR5Q29uZmlnQnV0dG9uKTsKCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAogICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwpgOwp0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACiAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewogICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CiAgICB9CmA7CgpzaG91dCgnb25BQkVudmlyb25tZW50TWVudScsIHsgbWVudVBvcnRhbDogY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbH0gKScAiayg5QTktAEFbGVhcm4CBACJrKDlBKOGAijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCJrKDlBOS0AQNncHQCBACJrKDlBMqGAijwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCJrKDlBOS0AQhhYklnbm9yZQIEAImsoOUE8YYCBHRydWUnAImsoOUE5LQBBnNlYXJjaAIEAImsoOUE9oYCKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAImsoOUE5LQBBm51Z2dldAIEAImsoOUEnYcCKPCflJc0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYnAImsoOUE5LQBBXRlc3RzAgQAiayg5QTEhwIo8J+Ul2I4M2Q5NzJiLTA1MzUtNDA1MS1iNTg5LTQxY2VkYTg1MzVmMScAiayg5QTktAEDYXNrAgQAiayg5QTrhwIo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAiayg5QTktAEJYWJWZXJzaW9uAgQAiayg5QSSiAIFMTAuNDInAImsoOUE5LQBEWFiQ3JlYXRlTWVudUlucHV0AgQAiayg5QSYiAKeAkBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51SW5wdXQgPSB7DQogICAgZm9ybTogImlucHV0IiwNCiAgICBtZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHk6IGZhbHNlLA0KICAgIGZvcm1JbnB1dE11bHRpbGluZTogbnVsbCwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51SW5wdXQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAImsoOUE5LQBEGFiQ3JlYXRlTWVudVRleHQCBACJrKDlBLeKAoEEQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KY29uc3Qgew0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZSwNCiAgICAuLi5yZXN0DQp9ID0gdGhhdDsNCg0KbGV0IG1lbnVUZXh0ID0gew0KICAgIGZvcm06ICJ0ZXh0IiwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIHBvaW50YWJsZTogZmFsc2UsDQogICAgY29sb3I6ICJ3aGl0ZSIsDQogICAgbWVudUl0ZW1TdHlsZTogew0KICAgICAgICAicGFkZGluZy10b3AiOiAiNnB4IiwNCiAgICAgICAgInBhZGRpbmctYm90dG9tIjogIjZweCIsDQogICAgfSwNCiAgICBtZW51SXRlbUxhYmVsU3R5bGU6IHsNCiAgICAgICAgIndoaXRlLXNwYWNlIjogInByZS13cmFwIiwNCiAgICAgICAgLi4ubWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIH0sDQogICAgLi4ucmVzdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUZXh0KTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCJrKDlBOS0ARBhYkNyZWF0ZU1lbnVUb29sAgQAiayg5QS5jgKOAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51VG9vbCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRvb2wpOw0KDQpyZXR1cm4gbWVudUJvdDsnAImsoOUE5LQBEmFiQ3JlYXRlTWVudVdpemFyZAIEAImsoOUEyI8CkgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVdpemFyZCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVdpemFyZCk7DQoNCnJldHVybiBtZW51Qm90OycAiayg5QTktAEUYWJDcmVhdGVNZW51RHJvcGRvd24CBACJrKDlBNuQApMgQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKHRoYXQuZHJvcGRvd25Tb3J0T3JkZXIgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBFcnJvcihgYWJDcmVhdGVNZW51RHJvcGRvd246IGRyb3Bkb3duU29ydE9yZGVyIGlzIG5vdCBwcm92aWRlZC5gKTsNCn0NCg0KbGV0IG91dGVyTWVudUJ1dHRvbiA9IHsNCiAgICAuLi50aGF0LA0KICAgIGZvcm1BZGRyZXNzOiB0aGF0LmZvcm1BZGRyZXNzID8/ICJhcnJvd19yaWdodCIsDQogICAgZHJvcGRvd25PcGVuOiBmYWxzZSwNCiAgICBvbkJvdEFkZGVkOiBgQA0KICAgICAgICB0aGlzQm90LnVwZGF0ZVN0eWxlKCk7DQogICAgYCwNCiAgICBvbkNsaWNrOiBgQA0KICAgICAgICB0YWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSAke3RoYXQuZHJvcGRvd25Tb3J0T3JkZXJ9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucykgew0KICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKHRhZ3MuZHJvcGRvd25PcHRpb25zLCB0YWdzLmRyb3Bkb3duU29ydE9yZGVyKTsNCiAgICAgICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICBgLA0KICAgIG9uRGVzdHJveTogYEANCiAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICBgLA0KICAgIHVwZGF0ZVN0eWxlOiBgQA0KICAgICAgICBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbDsNCiAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICBtYXNrcy5mb3JtQWRkcmVzcyA9ICJhcnJvd19yaWdodCI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuKSB7DQogICAgICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJmb3JtQWRkcmVzcyIsICJhcnJvd19kcm9wX2Rvd24iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgIm1lbnVJdGVtU3R5bGUiLCB7Li4udGFncy5tZW51SXRlbVN0eWxlLCAiYm9yZGVyQm90dG9tTGVmdFJhZGl1cyI6ICIwIiwgImJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzIjogIjAifSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBtYXNrcy5mb3JtQWRkcmVzcyA9IG51bGw7DQogICAgICAgIH0NCiAgICBgLA0KICAgIG9uQm90Q2hhbmdlZDogYEANCiAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygnZHJvcGRvd25PcGVuJykpIHsNCiAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlU3R5bGUoKTsNCiAgICAgICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudURyb3Bkb3duT3BlbmVkIiwgdGhpc0JvdCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICBgLA0KICAgIGFiTWVudURyb3Bkb3duT3BlbmVkOiBgQA0KICAgICAgICBpZiAodGFncy5pZ25vcmVPcGVuRHJvcGRvd25SdWxlcyA9PSB0cnVlKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoYXQgIT0gdGhpc0JvdCkgew0KICAgICAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gZmFsc2U7DQogICAgICAgICAgICBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChsaW5rcyAmJiBsaW5rcy5iYXNlU2tpbGwpIHsNCiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGFiLmxpbmtzLnJlbWVtYmVyLCAibGFzdE9wZW5lZERyb3Bkb3duIiwgdGFncy5iYXNlU2tpbGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgYA0KfTsNCg0KaWYgKHRoYXQuZm9ybUFkZHJlc3MgJiYgdGhhdC5mb3JtQWRkcmVzcyAhPSAiYXJyb3dfcmlnaHQiKSB7DQogICAgb3V0ZXJNZW51QnV0dG9uLmN1c3RvbUZvcm1BZGRyZXNzID0gdHJ1ZTsNCn0NCm91dGVyTWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gdGhhdC5kcm9wZG93blNvcnRPcmRlcjsNCg0KY29uc3QgbWVudUJvdCA9IGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG91dGVyTWVudUJ1dHRvbik7DQptZW51Qm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyA9IGdlbmVyYXRlTWVudU9wdGlvbnM7DQoNCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlTWVudU9wdGlvbnMgKG9wdGlvbnMsIHNvcnRPcmRlcikgew0KICAgIGNvbnN0IG1lbnVCb3RzID0gW107DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgKytpKSB7DQoNCiAgICAgICAgbGV0IG5ld01lbnVCdXR0b24gPSB7DQogICAgICAgICAgICAuLi5vcHRpb25zW2ldLA0KICAgICAgICAgICAgYWJEcm9wZG93bk9wdGlvbjogdHJ1ZSwNCiAgICAgICAgICAgIGNsZWFyRHJvcGRvd25NZW51OiBgQA0KICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwMDApOw0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoaSA9PSBvcHRpb25zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAgMCA4cHggOHB4IjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIDAgOHB4IDhweCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclJhZGl1cyJdID0gIjAiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJUb3AiXSA9ICJub25lIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJtYXJnaW5Ub3AiXSA9ICIwIjsNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJwYWRkaW5nTGVmdCJdID0gIjM1cHgiOw0KDQogICAgICAgIGNvbnN0IG5ld01lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCiAgICB9DQoNCiAgICBtZW51Qm90LnRhZ3MubWVudUJvdHMgPSBnZXRMaW5rKG1lbnVCb3RzKTsNCn0NCg0KaWYgKHRoYXQuZGVmYXVsdE9wZW4pIHsNCiAgICBtZW51Qm90Lm9uUG9pbnRlclVwKCk7DQogICAgbWVudUJvdC5vbkNsaWNrKCk7DQp9DQoNCnJldHVybiBtZW51Qm90Ow0KDQonAImsoOUE5LQBEWFiQ3JlYXRlTWVudUdyb3VwAgQAiayg5QTvsAK9H0AvKg0KICAgRVhBTVBMRQ0KICAgY29uc3QgbWVudUdyb3VwID0gew0KICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBncm91cFNvcnRPcmRlcjogMSwNCiAgICAgICAgbWVudUl0ZW1zOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICBjb2xvcjogIm9yYW5nZSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgbWVudUl0ZW1UeXBlOiAiZHJvcGRvd24iLA0KICAgICAgICAgICAgICAgIGRyb3Bkb3duT3B0aW9uczogWw0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfQ0KKi8NCg0KaWYgICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0Lmdyb3VwU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVHcm91cDogZ3JvdXBTb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgew0KICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwNCiAgICBtZW51SXRlbXMgPSBbXSwNCiAgICAuLi5hZGRpdGlvbmFsVGFncw0KfSA9IHRoYXQgPz8ge30NCg0KY29uc3QgbWVudUJvdHMgPSBbXTsNCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudUl0ZW1zLmxlbmd0aDsgKytpKSB7DQoNCiAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9Ow0KDQogICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDApOw0KDQogICAgbGV0IGluZGl2TWVudUl0ZW1TdHlsZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVN0eWxlID8/IHt9Ow0KICAgIGxldCBpbmRpdk1lbnVUeXBlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtVHlwZSA/PyB1bmRlZmluZWQ7DQogICAgbGV0IGluZGl2QWRkaXRpb25hbFRhZ3MgPSBtZW51SXRlbXNbaV07DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdOw0KICAgIH0NCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdOw0KICAgIH0NCg0KICAgIGNvbnN0IGJhc2VTdHlsaW5nID0gew0KICAgICAgICAiYm9yZGVyVG9wIjogIm5vbmUiLA0KICAgICAgICAibWFyZ2luVG9wIjogIjAiDQogICAgfQ0KDQogICAgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEgJiYgaSA9PSAwKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfQ0KICAgIGVsc2UgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCAwIDhweCA4cHgiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfSBlbHNlIGlmIChpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjhweCA4cHggMCAwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nO30NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gaW5kaXZBZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGluZGl2QWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBsZXQgbmV3TWVudUJvdDsNCiAgICBzd2l0Y2goaW5kaXZNZW51VHlwZSkgew0KICAgICAgICBjYXNlICJkcm9wZG93biI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bigNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC4uLm5ld01lbnVCdXR0b24sDQogICAgICAgICAgICAgICAgICAgICJkcm9wZG93blNvcnRPcmRlciI6IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTApDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiaW5wdXQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidGV4dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRvb2wiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ3aXphcmQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICB9DQogICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCn0NCg0KcmV0dXJuIG1lbnVCb3RzOycAiayg5QTktAELcGVyc29uYWxpdHkCBACJrKDlBK3QAijwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwCJrKDlBOS0ARdhYkdldEVudmlyb25tZW50T3B0aW9ucwIEAImsoOUE1NAC635AY29uc3Qgb3B0aW9ucyA9IFtdOwoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogYGhpZGVgLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAidmlzaWJpbGl0eV9vZmYiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICB9KSwKICAgIH0pCn0KCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJzbGVlcCIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMCwKICAgICAgICBmb3JtQWRkcmVzczogIm5pZ2h0c19zdGF5IiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJTZXRBd2FrZSh7IGF3YWtlOiBmYWxzZSB9KQogICAgICAgIH0pLAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAib3B0aW1pemUgbW9kZSIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMjAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICB9KSwKICAgIHJlZnJlc2hEaXNwbGF5OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSBmYWxzZSA6IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gdHJ1ZTsKICAgICAgICB0aGlzQm90Lm9uQ3JlYXRlKCk7CiAgICB9KSwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImN1c3RvbWl6ZTogYWIgcGVyc29uYWxpdHkiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDMwMCwKICAgIG1lbnVJdGVtVHlwZTogJ2Ryb3Bkb3duJywKICAgIGRyb3Bkb3duT3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBuYW1lOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LCB7IHRpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB0byBjYWxsIG1lPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJQZXJzb25hbGl0eUNoYW5nZScsIHsgYWJCdWlsZGVySWRlbnRpdHk6IG5hbWUgfSk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBhaSBtb2RlbDogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbH1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVscyA9IGNvbmZpZ0JvdC50YWdzLmFpQ2hhdE1vZGVsczsKCiAgICAgICAgICAgICAgICBpZiAobW9kZWxzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IFtdOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIG1vZGVscykgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goeyBsYWJlbDogZW50cnkubmFtZSwgdmFsdWU6IGVudHJ5Lm5hbWUgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TW9kZWxJbmRleCA9IG9wdGlvbnMuZmluZEluZGV4KG8gPT4gby52YWx1ZSA9PT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IGF3YWl0IG9zLnNob3dJbnB1dChjdXJyZW50TW9kZWxJbmRleCwgewogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3doYXQgYWkgbW9kZWwgd291bGQgeW91IGxpa2UgbWUgdG8gdXNlPycsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaXN0JywKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IG9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE9wdGlvbiAmJiBzZWxlY3RlZE9wdGlvbi52YWx1ZSAhPT0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvdXQoJ2FiUGVyc29uYWxpdHlDaGFuZ2UnLCB7IGFiUHJlZmVycmVkQUlNb2RlbDogc2VsZWN0ZWRPcHRpb24udmFsdWUgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aEJvdCkgewogICAgICAgICAgICAgICAgICAgICAgICBvcy5zaG93QWxlcnQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdzb21ldGhpbmcgd2VudCB3cm9uZycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnZmFpbGVkIHRvIGdldCBsaXN0IG9mIGFpIGNoYXQgbW9kZWxzLicKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBvcy5zaG93QWxlcnQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdzaWduIGluIHJlcXVpcmVkJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICd5b3UgbXVzdCBzaWduIGluIHRvIHVzZSBhaS4nCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBhaSBhbHdheXMgYXBwcm92ZTogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQWx3YXlzQXBwcm92ZVBhdGNoQm90cyA/ICd5ZXMnIDogJ25vJ31gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2VkaXRfbm90ZScsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCdhYlBlcnNvbmFsaXR5Q2hhbmdlJywgeyBhYkFsd2F5c0FwcHJvdmVQYXRjaEJvdHM6ICFsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQWx3YXlzQXBwcm92ZVBhdGNoQm90cyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3IsIHsgdHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG1lIHRvIGJlPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJQZXJzb25hbGl0eUNoYW5nZScsIHsgYWJCYXNlQ29sb3I6IGNvbG9yLCBhYkJhc2VTdHJva2VDb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBtZW51IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHsgdHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnVzIHRvIGJlPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJQZXJzb25hbGl0eUNoYW5nZScsIHsgYWJCYXNlTWVudUNvbG9yOiBjb2xvciB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYG1lbnUgdGV4dCBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVMYWJlbENvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51TGFiZWxDb2xvciwgeyB0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudSB0ZXh0IHRvIGJlPycgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJQZXJzb25hbGl0eUNoYW5nZScsIHsgYWJCYXNlTWVudUxhYmVsQ29sb3I6IGNvbG9yLCBhYkJhc2VTaGFkb3dDb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBib3QgbGFiZWwgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBib3QgdGV4dCB0byBiZT8nIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2FiUGVyc29uYWxpdHlDaGFuZ2UnLCB7IGFiQmFzZUxhYmVsQ29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBwb3J0YWwgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgbGV0IHBvcnRhbENvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4JywgeyB0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgeW91ciBwb3J0YWwgdG8gbG9vayBsaWtlPycgfSk7CiAgICAgICAgICAgICAgICBpZiAoIXBvcnRhbENvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgcG9ydGFsQ29sb3IgPSAnIzI2MzIzOCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaG91dCgnYWJQZXJzb25hbGl0eUNoYW5nZScsIHsgYWJCYXNlR3JpZFBvcnRhbENvbG9yOiBwb3J0YWxDb2xvciB9KTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgZGVmYXVsdCBtYXAgcG9ydGFsIGJhc2VtYXBgLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCJzaG93QUJCYXNlbWFwT3B0aW9ucyIpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJkZWZhdWx0IHNldHRpbmdzIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICAgICAgICAgIGNvbG9yOiAncmVkJywKICAgICAgICAgICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvdXQoJ2FiUGVyc29uYWxpdHlSZXNldCcpOwogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgIF0KfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoYXQiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDQwMCwKICAgIGZvcm1BZGRyZXNzOiAiY2hhdCIsCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgc2hvdXQoJ2FiQ2hhdEJhck9wZW4nKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIH0pLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAibnVnZ2V0cyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNTAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzLm51Z01hbmFnZXIgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmludGVyZmFjZS5udWdnZXQnKSk7IAogICAgICAgIAogICAgICAgIGlmIChsaW5rcy5udWdNYW5hZ2VyLnRhZ3MubGlzdGVuaW5nKSB7IAogICAgICAgICAgICB0YWdzLm9uQ2xpY2sgPSBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyAKICAgICAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgbnVsbCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveGA7IAogICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICB0YWdzLm9uQ2xpY2sgPSBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyAKICAgICAgICAgICAgICAgIGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCB0cnVlLCAnbG9jYWwnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94X291dGxpbmVfYmxhbmtgOwogICAgICAgIH0KICAgIH0pLAp9KQoKaWYgKGxpbmtzLnByZXNlbmNlKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAiY2FtZXJhIHByZXNlbmNlIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNTEwLAogICAgICAgIHByZXNlbmNlOiB0YWdzLnByZXNlbmNlLAogICAgICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCA9ICh0aGF0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCdjYW1lcmFFbmFibGVkJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIG9zLmFkZEJvdExpc3RlbmVyKGxpbmtzLnByZXNlbmNlLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkKTsKCiAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB9KSwKICAgICAgICByZWZyZXNoRGlzcGxheTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBsaW5rcy5wcmVzZW5jZS50YWdzLmNhbWVyYUVuYWJsZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MucHJlc2VuY2UsICdjYW1lcmFFbmFibGVkJywgISEhbGlua3MucHJlc2VuY2UudGFncy5jYW1lcmFFbmFibGVkLCAnbG9jYWwnKTsKICAgICAgICB9KSwKICAgICAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgb3MucmVtb3ZlQm90TGlzdGVuZXIobGlua3MucHJlc2VuY2UsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQpOwogICAgICAgIH0pCiAgICB9KQoKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJjdXJzb3IgcHJlc2VuY2UiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1MjAsCiAgICAgICAgcHJlc2VuY2U6IHRhZ3MucHJlc2VuY2UsCiAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkID0gKHRoYXQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ2N1cnNvckVuYWJsZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgb3MuYWRkQm90TGlzdGVuZXIobGlua3MucHJlc2VuY2UsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQpOwoKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0pLAogICAgICAgIHJlZnJlc2hEaXNwbGF5OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLnByZXNlbmNlLnRhZ3MuY3Vyc29yRW5hYmxlZCA/IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JyA6IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIH0pLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5wcmVzZW5jZSwgJ2N1cnNvckVuYWJsZWQnLCAhISFsaW5rcy5wcmVzZW5jZS50YWdzLmN1cnNvckVuYWJsZWQsICdsb2NhbCcpOwogICAgICAgIH0pLAogICAgICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBvcy5yZW1vdmVCb3RMaXN0ZW5lcihsaW5rcy5wcmVzZW5jZSwgJ29uQm90Q2hhbmdlZCcsIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCk7CiAgICAgICAgfSkKICAgIH0pCn0KCmlmIChsaW5rcy5ncHQpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA2MDAsCiAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgaWYgKCFhdXRoQm90KSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICdGcmVlUGxheScgfHwgYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0YWdzLmxhYmVsID0gJ2VkaXQgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIHByb21wdCc7IHRhZ3MuZ3B0Qm90ID0gZ2V0TGluayhnZXRCb3QoJ3N5c3RlbScsICdhYi5hY3Rpb24uYXNrJykpOwogICAgICAgIH0pLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsKICAgICAgICB9KSwKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImdyaWQgc25hcCIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNzAwLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuaycKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlOyB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICB9KSwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImJvdCBzbmFwIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA4MDAsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlOyB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAp9KQoKaWYgKGF1dGhCb3QpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJhY2NvdW50IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogOTAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAiYmFkZ2UiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgb3Muc2hvd0FjY291bnRJbmZvKCk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfSksCiAgICB9KQp9CgppZiAobGlua3MudGVzdHMpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdGVzdCIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJzY2llbmNlIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHNob3V0KCdhYlJlY29yZFRlc3QnKTsKICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9KSwKICAgIH0pCgogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInJlY29yZCB0cmFjZSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDExMDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJ0aW1lbGluZSIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBzaG91dCgnYWJSZWNvcmRUcmFjZScpOwogICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIH0pLAogICAgfSkKfQoKaWYgKGdldEJvdCgic3lzdGVtIiwgImFiLmhvbWUuZWdnIikpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJzYXZlIGhvbWUgZWdnIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTIwMCwKICAgICAgICBmb3JtQWRkcmVzczogImVnZyIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBnZXRCb3QoInN5c3RlbSIsICJhYi5ob21lLmVnZyIpLnNhdmVEYXRhKCk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfSksCiAgICB9KQp9CgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJjaGVjayBmb3IgIiArIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIHVwZGF0ZXMiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEzMDAsCiAgICBmb3JtQWRkcmVzczogImN1YmUiLAogICAgbGVhcm46IHRhZ3MubGVhcm4sCiAgICBjaGVja0ZvclVwZGF0ZXM6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAvLyBUZW1wb3JhcmlseSByZXBsYWNlIHdpdGggYnVzeSBpbmRpY2F0b3Igd2hpbGUgY2hlY2tpbmcgZm9yIHVwZGF0ZXMuCiAgICAgICAgdGFncy5hYk1lbnUgPSBmYWxzZTsKCiAgICAgICAgdGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IgPSBhYi5saW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3IoewogICAgICAgICAgICBhYk1lbnU6IHRydWUsCiAgICAgICAgICAgIGxhYmVsOiAnY2hlY2tpbmcgZm9yIHVwZGF0ZXMgdG8gJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgYWJNZW51U29ydE9yZGVyOiB0YWdzLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyLAogICAgICAgIH0pOwoKICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjayA9IGF3YWl0IGFiLmFiQ2hlY2tBQlVwZGF0ZUF2YWlsYWJsZSh7IGRldGFpbGVkOiB0cnVlIH0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpOwogICAgICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IG51bGw7CgogICAgICAgICAgICAvLyBCcmluZyBiYWNrIHRoZSB1cGRhdGUgYnV0dG9uLgogICAgICAgICAgICB0YWdzLmFiTWVudSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sgJiYgdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2suc3VjY2VzcykgewogICAgICAgICAgICBpZiAoZ2xvYmFsVGhpcy5hYlVwZGF0ZUNoZWNrZXIpIHsKICAgICAgICAgICAgICAgIGFiVXBkYXRlQ2hlY2tlci50YWdzLnVwZGF0ZUF2YWlsYWJsZSA9IHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLnVwZGF0ZUF2YWlsYWJsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLnVwZGF0ZUF2YWlsYWJsZSkgewogICAgICAgICAgICAgICAgY29uc3QgYWJGaWxlc1dpdGhVcGRhdGVzID0gdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2suYWJGaWxlQ2hlY2tzLmZpbHRlcihmID0+IGYudXBkYXRlQXZhaWxhYmxlKTsKCiAgICAgICAgICAgICAgICBjb25zdCBjb25maXJtZWQgPSBhd2FpdCBvcy5zaG93Q29uZmlybSh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdVcGRhdGVzIGZvdW5kIGZvciAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdUaGVyZSBhcmUgJyArIGFiRmlsZXNXaXRoVXBkYXRlcy5sZW5ndGggKyAnIGZpbGUgdXBkYXRlcyBmb3IgJyArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcuIFdvdWxkIHlvdSBsaWtlIHRvIGluc3RhbGwgdGhlIHVwZGF0ZXMgbm93PyBZb3UgYW5kIGFueSBjb25uZWN0ZWQgdXNlcnMgd2lsbCBhdXRvbWF0aWNhbGx5IHJlZnJlc2ggdGhlIHBhZ2UgYWZ0ZXIgdGhlIHVwZGF0ZSBpcyBjb21wbGV0ZS4nLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6ICdOb3Qgbm93JywKICAgICAgICAgICAgICAgICAgICBjb25maXJtVGV4dDogJ1llcycKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCkgewogICAgICAgICAgICAgICAgICAgIGxpbmtzLmxlYXJuLnVwZGF0ZUFCKCk7CiAgICAgICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFiLmxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBpcyBhbHJlYWR5IHVwLXRvLWRhdGUhJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYXNrcy5sYWJlbCA9ICd1cGRhdGUgY2hlY2sgZmFpbGVkJzsKICAgICAgICB9CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LmNoZWNrRm9yVXBkYXRlcygpOwogICAgfSksCiAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpIHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgfQogICAgfSksCn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJwZXJtYW5lbnRseSBkZWxldGUiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDk5OTksCiAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRhZ3MubGFiZWwgKz0gIiAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKICAgICAgICB0YWdzLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb250cmFzdENvbG9yID8/ICIjRDkzMDMwIjsKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IG9zLnNob3dDb25maXJtKHsKICAgICAgICAgICAgdGl0bGU6ICdQZXJtYW5lbnRseSBkZWxldGUgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgIGNvbnRlbnQ6ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBmcm9tICcgKyBsaW5rcy5sZWFybi50YWdzLmFiSW5zdCArICc/IFRoaXMgaXMgbm90IHJldmVyc2libGUhJywKICAgICAgICB9KQoKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwoKICAgICAgICBjb25zdCBhYkJvdHMgPSBnZXRCb3RzKChiKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBiLnNwYWNlID09PSAnc2hhcmVkJyAmJgogICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbSAmJgogICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbS5zdGFydHNXaXRoKCdhYicpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgIGRlc3Ryb3koYWJCb3RzKTsKICAgICAgICB9CiAgICB9KSwKfSkKCnJldHVybiBvcHRpb25zOycAiayg5QTktAEeYWJDcmVhdGVUb29sYm94RHJvcGRvd25PcHRpb25zAgQAiayg5QTAzwPjE0Bjb25zdCB0b29sYm94VG9vbHMgPSBbLi4udGhhdC50b29sQXJyYXldID8/IFtdOw0KY29uc3QgdG9vbGJveE5hbWUgPSB0aGF0LnRvb2xib3hOYW1lID8/ICJLaXQgIjsNCmNvbnN0IHRvb2xib3ggPSB0aGF0LnRvb2xib3g7DQpjb25zdCBncmlkSW5mb3JtYXRpb24gPSAodGhhdD8uZ3JpZEluZm9ybWF0aW9uICYmIHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiAhPSB1bmRlZmluZWQpID8gdGhhdD8uZ3JpZEluZm9ybWF0aW9uIDogYWJSZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOw0KDQpjb25zdCBkcm9wZG93bk9wdGlvbnMgPSBbXTsNCmNvbnN0IGFjdGl2ZU1lbnUgPSBjb25maWdCb3QudGFncy5tZW51UG9ydGFsOw0KDQpjb25zdCBtZW51T3B0aW9ucyA9IHt9Ow0KDQptZW51T3B0aW9ucy5kaW1lbnNpb24gPSBhY3RpdmVNZW51Ow0KbWVudU9wdGlvbnNbYWN0aXZlTWVudV0gPSB0cnVlOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnRvb2xib3ggPSBnZXRMaW5rKHRvb2xib3gpOw0KbWVudU9wdGlvbnMuZ3JpZEluZm9ybWF0aW9uID0gZ3JpZEluZm9ybWF0aW9uOw0KbWVudU9wdGlvbnMuc2VhcmNoID0gdGFncy5zZWFyY2g7DQptZW51T3B0aW9ucy5hcnRpZmFjdCA9IHRhZ3MuYXJ0aWZhY3Q7DQovL21lbnVPcHRpb25zLmZvcm1BZGRyZXNzID0gImhhcmR3YXJlIjsNCg0KaWYgKHRvb2xib3hUb29scy5sZW5ndGggPT09IDApIHsNCiAgICBjb25zdCBtZXNzYWdlID0gdG9vbGJveE5hbWUgKyAiIGRvZXMgbm90IGhhdmUgYW55IHRvb2xzIGxpc3RlZCBpbiB0aGUgdG9vbF9hcnJheSB0YWciOw0KDQogICAgYWIubG9nKGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBtZXNzYWdlKTsNCiAgICBvcy50b2FzdChtZXNzYWdlLCA1KTsNCiAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpOw0KfQ0KDQpmb3IgKGxldCB0b29sIG9mIHRvb2xib3hUb29scykgew0KICAgIGNvbnN0IHRvb2xCdXR0b24gPSB7DQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBsYWJlbDogdG9vbC5uYW1lLA0KICAgICAgICB0YXJnZXRBQjogdG9vbC50YXJnZXRBQiwNCiAgICAgICAgaXNBcnRpZmFjdDogdG9vbC5hcnRpZmFjdCB8fCBmYWxzZSwNCiAgICAgICAgb25DbGljazpgQA0KICAgICAgICAgICAgaWYgKHRhZ3MuaXNBcnRpZmFjdCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGFiQXJ0aWZhY3RTaGFyZCA9IHsNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICAgICAgICAgICAgZWdnUGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llczogWw0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGxpbmtzLmFydGlmYWN0LmFiQ3JlYXRlQXJ0aWZhY3RQcm9taXNlQm90KHsNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdE5hbWU6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3RTaGFyZCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCLA0KICAgICAgICAgICAgICAgICAgICBzb3VyY2VFdmVudDogJ3Rvb2wnLA0KICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiB0YWdzLnRvb2xib3gsDQogICAgICAgICAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9uDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgYCwNCiAgICB9Ow0KDQogICAgaWYgKHRvb2wuZm9ybUFkZHJlc3MpIHsNCiAgICAgICAgdG9vbEJ1dHRvbi5mb3JtQWRkcmVzcyA9IHRvb2wuZm9ybUFkZHJlc3M7DQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2godG9vbEJ1dHRvbik7DQp9DQoNCnJldHVybiBkcm9wZG93bk9wdGlvbnM7JwCJrKDlBOS0ARBvbkFCQXV0aEJvdEFkZGVkAgQAiayg5QSk4wMYQHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7JwCJrKDlBOS0AQhhcnRpZmFjdAIEAImsoOUEveMDKPCflJc3OGU0MTUwMy1jOTMzLTRmOGEtODE3YS1iYTk3YmY4ZDVkMjcnAQRib3RzJGM3OGFhNjYzLWQwNWMtNGVjNC1iYzJjLTI2ZmQ1MTU2MGI5NwEnAImsoOUE5OMDFWFiQ3JlYXRlQ3ViZUZhY2VQbGFuZQIEAImsoOUE5eMDiTFAbGV0IHsgCiAgICBib3QsCiAgICBkaW1lbnNpb24sCiAgICBzcGFjZSA9ICd0ZW1wTG9jYWwnLAogICAgZGVidWcsCiAgICBmYWNlT2Zmc2V0ID0gMC4wMSwKICAgIHBvaW50YWJsZSA9IGZhbHNlLAogICAgdGlja0ludGVydmFsTVMgPSA1MDAsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9OwoKYXNzZXJ0KGxpbmtzLnV0aWxzLmlzQm90KGJvdCksIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm90IGlzIGEgcmVxdWlyZWQgQm90IHBhcmFtZXRlci5gKTsKYXNzZXJ0KGRpbWVuc2lvbiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkaW1lbnNpb24gaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CmFzc2VydChyZXN0LmZvcm0gPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBmb3JtIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5hbmNob3JQb2ludCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFuY2hvclBvaW50IGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkJvdEFkZGVkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7Cgpjb25zdCBmYWNlUGxhbmVNb2QgPSB7CiAgICBzcGFjZSwKICAgIGFuY2hvclBvaW50OiAnY2VudGVyJywKICAgIGRlYnVnLAogICAgZmFjZU9mZnNldCwKICAgIGZvcm06ICdzcHJpdGUnLAogICAgZGltZW5zaW9uLAogICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICBwb2ludGFibGUsCiAgICB0aWNrSW50ZXJ2YWxNUywKICAgIHRyYW5zZm9ybWVyOiBib3QuaWQsCiAgICBvbkJvdEFkZGVkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGhpc0JvdC5zdGFydFRpY2soKTsKICAgIH0pLAogICAgb25Cb3RDaGFuZ2VkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygndGlja0ludGVydmFsTVMnKSkgewogICAgICAgICAgICB0aGlzQm90LnN0b3BUaWNrKCk7CiAgICAgICAgICAgIHRoaXNCb3Quc3RhcnRUaWNrKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCd0cmFuc2Zvcm1lcicpKSB7CiAgICAgICAgICAgIGlmICghdGFncy50cmFuc2Zvcm1lcikgewogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25BbnlCb3RzUmVtb3ZlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0YWdzLnRyYW5zZm9ybWVyKSB7CiAgICAgICAgICAgIGlmICh0aGF0LmJvdElEcy5pbmNsdWRlcyh0YWdzLnRyYW5zZm9ybWVyKSkgewogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGhpc0JvdC5zdG9wVGljaygpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGRlc3Ryb3llZGApOwogICAgICAgIH0KICAgIH0pLAogICAgc2V0RGltZW5zaW9uOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uc3QgZGltZW5zaW9uID0gdGhhdDsKCiAgICAgICAgaWYgKHRhZ3MuZGltZW5zaW9uICE9PSBkaW1lbnNpb24pIHsKICAgICAgICAgICAgLy8gUmVtb3ZlIGZyb20gcHJldmlvdXMgZGltZW5zaW9uLgogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnUG9zaXRpb24nXSA9IG51bGw7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnUm90YXRpb24nXSA9IG51bGw7CgogICAgICAgICAgICBpZiAoZGltZW5zaW9uKSB7CiAgICAgICAgICAgICAgICAvLyBBc3NpZ24gdG8gbmV3IGRpbWVuc2lvbi4KICAgICAgICAgICAgICAgIHRhZ3MuZGltZW5zaW9uID0gZGltZW5zaW9uOwogICAgICAgICAgICAgICAgdGFnc1tkaW1lbnNpb25dID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9KSwKICAgIHN0YXJ0VGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmIChtYXNrcy50aWNrSW50ZXJ2YWxJZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtYXNrcy50aWNrSW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHdoaXNwZXIodGhpc0JvdCwgJ3RpY2snKSwgdGFncy50aWNrSW50ZXJ2YWxNUyk7CiAgICAgICAgdGhpc0JvdC50aWNrKCk7CiAgICB9KSwKICAgIHN0b3BUaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKG1hc2tzLnRpY2tJbnRlcnZhbElkKSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobWFza3MudGlja0ludGVydmFsSWQpOwogICAgICAgICAgICBtYXNrcy50aWNrSW50ZXJ2YWxJZCA9IG51bGw7CiAgICAgICAgfQogICAgfSksCiAgICB0aWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uc3QgTE9DQUxfTk9STUFMUyA9IFsKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMSwgMCwgMCksIC8vICtYCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKC0xLCAwLCAwKSwgLy8gLVgKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgMSwgMCksIC8vICtZCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAsIC0xLCAwKSwgLy8gLVkKICAgICAgICBdCgogICAgICAgIGNvbnN0IExPQ0FMX1BPU0lUSU9OUyA9IFsKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMC41ICsgdGFncy5mYWNlT2Zmc2V0LCAwLCAtMC41KSwgLy8gK1gKICAgICAgICAgICAgbmV3IFZlY3RvcjMoLTAuNSAtIHRhZ3MuZmFjZU9mZnNldCwgMCwgLTAuNSksIC8vIC1YCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAsIDAuNSArIHRhZ3MuZmFjZU9mZnNldCwgLTAuNSksIC8vICtZCiAgICAgICAgICAgIG5ldyBWZWN0b3IzKDAsIC0wLjUgLSB0YWdzLmZhY2VPZmZzZXQsIC0wLjUpLCAvLyAtWQogICAgICAgIF0KCiAgICAgICAgY29uc3QgSEFMRl9QSSA9IE1hdGguUEkgLyAyOwoKICAgICAgICBjb25zdCBMT0NBTF9ST1RBVElPTlMgPSBbCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IEhBTEZfUEksIHk6IEhBTEZfUEksIHo6IDAgfX0pLCAvLyArWAogICAgICAgICAgICBuZXcgUm90YXRpb24oeyBldWxlcjogeyB4OiBIQUxGX1BJLCB5OiAtSEFMRl9QSSwgejogMCB9fSksIC8vIC1YCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IC1IQUxGX1BJLCB5OiAwLCB6OiBNYXRoLlBJIH19KSwgLy8gK1kKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogSEFMRl9QSSwgeTogMCwgejogMCB9fSksIC8vIC1ZCiAgICAgICAgXQoKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhlIGZhY2UgcGxhbmUgdG8gYmUgb24gdGhlIGdpdmVuIGZhY2UgaW5kZXguICAKICAgICAgICAgKiAwOiArWCwgIAogICAgICAgICAqIDE6IC1YLCAgCiAgICAgICAgICogMjogK1ksICAKICAgICAgICAgKiAzOiAtWQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIHNldFBsYW5lRmFjZShmYWNlSW5kZXgpIHsKICAgICAgICAgICAgbWFza3NbdGFncy5kaW1lbnNpb24gKyAnUG9zaXRpb24nXSA9IExPQ0FMX1BPU0lUSU9OU1tmYWNlSW5kZXhdOwogICAgICAgICAgICBtYXNrc1t0YWdzLmRpbWVuc2lvbiArICdSb3RhdGlvbiddID0gTE9DQUxfUk9UQVRJT05TW2ZhY2VJbmRleF07CiAgICAgICAgfQoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGRpbWVuc2lvbjpgLCB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBhcmVudFBvc2l0aW9uID0gZ2V0Qm90UG9zaXRpb24odGFncy50cmFuc2Zvcm1lciwgdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIHBhcmVudCBwb3NpdGlvbjpgLCBwYXJlbnRQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICBsZXQgZ3JpZFBvcnRhbFR5cGU6ICdncmlkJyB8ICdtaW5pR3JpZCcgfCBudWxsID0gbnVsbDsKCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIGdyaWRQb3J0YWxUeXBlID0gJ2dyaWQnOwogICAgICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIGdyaWRQb3J0YWxUeXBlID0gJ21pbmlHcmlkJzsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGV0ZWN0ZWQgZ3JpZCBwb3J0YWwgdHlwZTpgLCBncmlkUG9ydGFsVHlwZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWdyaWRQb3J0YWxUeXBlKSB7CiAgICAgICAgICAgIHNldFBsYW5lRmFjZSgwKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgY2FtZXJhUG9zaXRpb24gPSBvcy5nZXRDYW1lcmFQb3NpdGlvbihncmlkUG9ydGFsVHlwZSk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gY2FtZXJhIHBvc2l0aW9uOmAsIGNhbWVyYVBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGRpcmVjdGlvblRvQ2FtZXJhID0gY2FtZXJhUG9zaXRpb24uc3VidHJhY3QocGFyZW50UG9zaXRpb24pLm5vcm1hbGl6ZSgpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGRpcmVjdGlvbiB0byBjYW1lcmE6YCwgZGlyZWN0aW9uVG9DYW1lcmEpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcGFyZW50Um90YXRpb24gPSBnZXRCb3RSb3RhdGlvbih0YWdzLnRyYW5zZm9ybWVyLCB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgY29uc3Qgd29ybGROb3JtYWxzOiBWZWN0b3IzW10gPSBuZXcgQXJyYXkoNCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICAgICAgd29ybGROb3JtYWxzW2ldID0gcGFyZW50Um90YXRpb24ucm90YXRlVmVjdG9yMyhMT0NBTF9OT1JNQUxTW2ldKTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gd29ybGQgbm9ybWFsczpgLCB3b3JsZE5vcm1hbHMpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBGaW5kIHRoZSBmYWNlIG1vc3QgZmFjaW5nIHRoZSBjYW1lcmEgKG1heCBkb3QgcHJvZHVjdCkuIAogICAgICAgIGxldCBiZXN0SW5kZXggPSAwOyAKICAgICAgICBsZXQgYmVzdERvdCA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWTsgCiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZE5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWxzW2ldLmRvdChkaXJlY3Rpb25Ub0NhbWVyYSk7CiAgICAgICAgICAgIGlmIChkb3QgPiBiZXN0RG90KSB7CiAgICAgICAgICAgICAgICBiZXN0RG90ID0gZG90OyAKICAgICAgICAgICAgICAgIGJlc3RJbmRleCA9IGk7IAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9LiR7dGFnTmFtZX1dIGJlc3QgZmFjZSBpbmRleDpgLCBiZXN0SW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgc2V0UGxhbmVGYWNlKGJlc3RJbmRleCk7CiAgICB9KSwKICAgIC4uLnJlc3QKfQoKY29uc3QgZmFjZVBsYW5lQm90ID0gY3JlYXRlKGZhY2VQbGFuZU1vZCk7CgpyZXR1cm4gZmFjZVBsYW5lQm90OycAiayg5QTk4wMIYWJJZ25vcmUCBACJrKDlBO+UBAR0cnVlJwCJrKDlBOTjAwthYkludGVyZmFjZQIEAImsoOUE9JQEBHRydWUnAImsoOUE5OMDBnN5c3RlbQIEAImsoOUE+ZQEGGFiLmludGVyZmFjZS5ib3RfZmFjdG9yeScAiayg5QTk4wMWYWJDcmVhdGVCaWxsYm9hcmRMYWJlbAIEAImsoOUEkpUEjUVAbGV0IHsgCiAgICBib3QsCiAgICBkaW1lbnNpb24sCiAgICBwcmVzZXJ2ZU5ld0xpbmVzID0gdHJ1ZSwKICAgIGxhYmVsID0gJycsCiAgICBzcGFjZSA9ICd0ZW1wTG9jYWwnLAogICAgY29sb3IgPSAnd2hpdGUnLAogICAgbGFiZWxDb2xvciA9ICdibGFjaycsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9OwoKaWYgKHR5cGVvZiBsYWJlbCAhPT0gJ3N0cmluZycpIHsKICAgIGxhYmVsID0gU3RyaW5nKGxhYmVsKTsKfQoKYXNzZXJ0KGxpbmtzLnV0aWxzLmlzQm90KGJvdCksIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm90IGlzIGEgcmVxdWlyZWQgQm90IHBhcmFtZXRlci5gKTsKYXNzZXJ0KGRpbWVuc2lvbiwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkaW1lbnNpb24gaXMgYSByZXF1aXJlZCBwYXJhbWV0ZXIuYCk7CmFzc2VydChyZXN0Lm9uQ3JlYXRlID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQW55Qm90c0NoYW5nZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25BbnlCb3RzUmVtb3ZlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC51cGRhdGVMYWJlbCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5sYWJlbFdvcmRXcmFwTW9kZSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGxhYmVsV29yZFdyYXBNb2RlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwoKLy8gLS0tIDEpIFdvcmQgYnJlYWtpbmcgKHdyYXAgYnkgd29yZHMsIGNodW5rIGxvbmcgd29yZHMpIC0tLQpmdW5jdGlvbiBicmVha1dvcmRzVG9MaW5lcyh0ZXh0LCBtYXhDb2xzID0gMTgpIHsKICAgIGlmICghdGV4dCkgcmV0dXJuIFsnJ107CiAgICBjb25zdCB3b3JkcyA9IHRleHQuc3BsaXQoL1xzKy8pLmZpbHRlcihCb29sZWFuKTsKICAgIGNvbnN0IGxpbmVzID0gW107CiAgICBsZXQgbGluZSA9ICcnOwoKICAgIGNvbnN0IHB1c2ggPSAoKSA9PiB7IGxpbmVzLnB1c2gobGluZSk7IGxpbmUgPSAnJzsgfTsKCiAgICBmb3IgKGNvbnN0IHcgb2Ygd29yZHMpIHsKICAgICAgICBpZiAody5sZW5ndGggPiBtYXhDb2xzKSB7CiAgICAgICAgICAgIC8vIGNsb3NlIGN1cnJlbnQgbGluZSAoaWYgYW55KSBiZWZvcmUgY2h1bmtpbmcgYSBsb25nIHdvcmQKICAgICAgICAgICAgaWYgKGxpbmUpIHB1c2goKTsKICAgICAgICAgICAgLy8gY2h1bmsgdGhlIGxvbmcgd29yZAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcubGVuZ3RoOyBpICs9IG1heENvbHMpIHsKICAgICAgICAgICAgICAgIGxpbmVzLnB1c2gody5zbGljZShpLCBpICsgbWF4Q29scykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpbmUgPSAnJzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICghbGluZS5sZW5ndGgpIHsKICAgICAgICAgICAgbGluZSA9IHc7CiAgICAgICAgfSBlbHNlIGlmIChsaW5lLmxlbmd0aCArIDEgKyB3Lmxlbmd0aCA8PSBtYXhDb2xzKSB7CiAgICAgICAgICAgIGxpbmUgKz0gJyAnICsgdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwdXNoKCk7CiAgICAgICAgICAgIGxpbmUgPSB3OwogICAgICAgIH0KICAgIH0KICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaCgpOwoKICAgIHJldHVybiBsaW5lcy5sZW5ndGggPyBsaW5lcyA6IFsnJ107Cn0KCi8vIFByZXNlcnZlcyBleGlzdGluZyBcbiBhcyBoYXJkIGJyZWFrczsgd3JhcHMgd2l0aGluIGVhY2ggaGFyZCBsaW5lLgpmdW5jdGlvbiBicmVha1dvcmRzVG9MaW5lc1ByZXNlcnZlTmV3bGluZXModGV4dCwgbWF4Q29scyA9IDE4KSB7CiAgaWYgKHRleHQgPT0gbnVsbCkgcmV0dXJuIFsnJ107CgogIC8vIFNwbGl0IG9uIHJlYWwgbmV3bGluZXM7IGtlZXAgZW1wdHkgbGluZXMgc28gd2UgcHJlc2VydmUgYmxhbmsgbGluZXMuCiAgY29uc3QgaGFyZExpbmVzID0gU3RyaW5nKHRleHQpLnNwbGl0KC9ccj9cbi8pOwogIGNvbnN0IG91dCA9IFtdOwoKICAvLyBIZWxwZXIgdG8gd3JhcCBhIHNpbmdsZSBoYXJkIGxpbmUgYnkgd29yZHMgKHdpdGggbG9uZy13b3JkIGNodW5raW5nKQogIGNvbnN0IHdyYXBPbmUgPSAoc3JjKSA9PiB7CiAgICAvLyBOb3JtYWxpemUgdGFicyAtPiBzcGFjZXM7IGNvbGxhcHNlIGludGVybmFsIHdoaXRlc3BhY2UgKG5vdCBuZXdsaW5lcykKICAgIGNvbnN0IHMgPSBzcmMucmVwbGFjZSgvXHQvZywgJyAgICAnKS5yZXBsYWNlKC9ccysvZywgJyAnKS50cmltKCk7CiAgICBpZiAoIXMubGVuZ3RoKSB7IG91dC5wdXNoKCcnKTsgcmV0dXJuOyB9CgogICAgY29uc3Qgd29yZHMgPSBzLnNwbGl0KCcgJyk7CiAgICBsZXQgbGluZSA9ICcnOwoKICAgIGNvbnN0IHB1c2hMaW5lID0gKCkgPT4geyBvdXQucHVzaChsaW5lKTsgbGluZSA9ICcnOyB9OwoKICAgIC8vIGNodW5rIGxvbmcgd29yZHMgdG8gZW11bGF0ZSAnYnJlYWtXb3JkcycKICAgIGNvbnN0IGNodW5rV29yZCA9ICh3KSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdy5sZW5ndGg7IGkgKz0gbWF4Q29scykgewogICAgICAgIGNvbnN0IGNodW5rID0gdy5zbGljZShpLCBpICsgbWF4Q29scyk7CiAgICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgbGluZSA9IGNodW5rOwogICAgICAgIGVsc2UgeyBwdXNoTGluZSgpOyBsaW5lID0gY2h1bms7IH0KICAgICAgfQogICAgfTsKCiAgICBmb3IgKGNvbnN0IHcgb2Ygd29yZHMpIHsKICAgICAgaWYgKHcubGVuZ3RoID4gbWF4Q29scykgewogICAgICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaExpbmUoKTsKICAgICAgICBjaHVua1dvcmQodyk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgewogICAgICAgIGxpbmUgPSB3OwogICAgICB9IGVsc2UgaWYgKGxpbmUubGVuZ3RoICsgMSArIHcubGVuZ3RoIDw9IG1heENvbHMpIHsKICAgICAgICBsaW5lICs9ICcgJyArIHc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHVzaExpbmUoKTsKICAgICAgICBsaW5lID0gdzsKICAgICAgfQogICAgfQogICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoTGluZSgpOwogIH07CgogIGZvciAoY29uc3QgaGwgb2YgaGFyZExpbmVzKSB7CiAgICB3cmFwT25lKGhsKTsgICAgICAgICAgIC8vIHdyYXAgd2l0aGluIHRoaXMgaGFyZCBsaW5lCiAgfQoKICAvLyBJZiB0aGUgaW5wdXQgZW5kZWQgd2l0aCBhIHRyYWlsaW5nIG5ld2xpbmUsIHdlIGFscmVhZHkgcHJlc2VydmVkIGl0CiAgLy8gYmVjYXVzZSBzcGxpdCBrZXB0IGFuIGVtcHR5IGxhc3QgaXRlbSAtPiBiZWNhbWUgYW4gZW1wdHkgd3JhcHBlZCBsaW5lLgogIHJldHVybiBvdXQubGVuZ3RoID8gb3V0IDogWycnXTsKfQoKLy8gLS0tIDIpIFNpbXBsZSBzaXppbmcgZnJvbSBsaW5lcyAtLS0KLy8gVGhpbmsgb2YgImNvbHNQZXJTY2FsZVgiIGFzICJhYm91dCBOIGNoYXJhY3RlcnMgcGVyIDEgc2NhbGVYIi4KZnVuY3Rpb24gY29tcHV0ZVNpbXBsZVNjYWxlc0Zyb21MaW5lcyhsaW5lcywgewogICAgY29sc1BlclNjYWxlWCA9IDIuNSwKICAgIG1pblNjYWxlWCA9IDEuMjUsCiAgICBtYXhTY2FsZVggPSAxMCwKICAgIGJhc2VTY2FsZVkgPSAxLjIsCiAgICBwZXJMaW5lWSA9IDAuNzUsCn0gPSB7fSkgewogICAgY29uc3QgbG9uZ2VzdCA9IGxpbmVzLnJlZHVjZSgobSwgbCkgPT4gTWF0aC5tYXgobSwgbC5sZW5ndGgpLCAwKTsKICAgIGNvbnN0IGxpbmVDb3VudCA9IE1hdGgubWF4KDEsIGxpbmVzLmxlbmd0aCk7CgogICAgLy8gV2lkdGggc2NhbGVzIHdpdGggdGhlIGxvbmdlc3QgbGluZSBsZW5ndGgKICAgIGxldCBzY2FsZVggPSBsb25nZXN0ID4gMCA/IChsb25nZXN0IC8gY29sc1BlclNjYWxlWCkgOiBtaW5TY2FsZVg7CiAgICBzY2FsZVggPSBNYXRoLm1heChtaW5TY2FsZVgsIE1hdGgubWluKG1heFNjYWxlWCwgc2NhbGVYKSk7CgogICAgLy8gSGVpZ2h0IGdyb3dzIHBlciBsaW5lOyBrZWVwIGl0IHNpbXBsZSBhbmQgcHJlZGljdGFibGUKICAgIGNvbnN0IHNjYWxlWSA9IE1hdGgubWF4KGJhc2VTY2FsZVksIGJhc2VTY2FsZVkgKyAobGluZUNvdW50IC0gMSkgKiBwZXJMaW5lWSk7CgogICAgcmV0dXJuIHsgc2NhbGVYLCBzY2FsZVksIGxvbmdlc3QsIGxpbmVDb3VudCB9Owp9CgoKLy8gUGljayB5b3VyIHRhcmdldCAiY29sdW1ucyIgcGVyIGxpbmUgKHR3ZWFrIHRvIHRhc3RlKQpjb25zdCBNQVhfQ09MUyA9IDMyOwoKLy8gQnJlYWsgdGhlIHRleHQgeW91cnNlbGYKY29uc3QgbGluZXMgPSBwcmVzZXJ2ZU5ld0xpbmVzID8gYnJlYWtXb3Jkc1RvTGluZXNQcmVzZXJ2ZU5ld2xpbmVzKGxhYmVsLCBNQVhfQ09MUykgOiBicmVha1dvcmRzVG9MaW5lcyhsYWJlbCwgTUFYX0NPTFMpOwpjb25zdCB3cmFwcGVkTGFiZWwgPSBsaW5lcy5qb2luKCdcbicpOwoKLy8gQ29tcHV0ZSBzaW1wbGUgc2NhbGVzIGZyb20gdGhlIHdyYXBwZWQgdGV4dApjb25zdCB7IHNjYWxlWCwgc2NhbGVZIH0gPSBjb21wdXRlU2ltcGxlU2NhbGVzRnJvbUxpbmVzKGxpbmVzKTsKCmxldCBsYWJlbE1vZCA9IHsKICAgIHNwYWNlOiBzcGFjZSwKICAgIHRyYWNrQm90SWQ6IGJvdC5pZCwKICAgIGZvcm06ICdzcHJpdGUnLAogICAgY29sb3IsCiAgICBsYWJlbDogd3JhcHBlZExhYmVsLAogICAgbGFiZWxDb2xvciwKICAgIGxhYmVsU2l6ZTogMSwKICAgIGxhYmVsUGFkZGluZ1g6IDAuNSwKICAgIGxhYmVsV29yZFdyYXBNb2RlOiAnbm9uZScsCiAgICBzY2FsZVgsIAogICAgc2NhbGVZLAogICAgc2NhbGVaOiAwLjEsCiAgICBib3RMYWJlbE1hcmdpbjogMSwKICAgIGFuY2hvclBvaW50OiAn4p6h77iPMCwtMC41LDAnLAogICAgb3JpZW50YXRpb25Nb2RlOiAnYmlsbGJvYXJkJywKICAgIGRpbWVuc2lvbjogZGltZW5zaW9uLAogICAgZGVidWc6IGZhbHNlLAogICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgb25DcmVhdGU6IGBACiAgICAgICAgLy8gV2FpdCBmb3IgcmVxdWlyZWQgYm90cyB0byBiZSByZWFkeS4KICAgICAgICBsZXQgd2FpdFRpbWUgPSAwOwoKICAgICAgICB3aGlsZSghZ2xvYmFsVGhpcy5hYikgewogICAgICAgICAgICBpZiAod2FpdFRpbWUgPj0gNTAwMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCBvcy5zbGVlcCgyNTApOwogICAgICAgICAgICB3YWl0VGltZSArPSAyNTA7CiAgICAgICAgfQoKICAgICAgICB0YWdzLnJlYWR5ID0gdHJ1ZTsKICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICBgLAogICAgb25BbnlCb3RzQ2hhbmdlZDogYEAKICAgICAgICBmb3IgKGNvbnN0IGNoYW5nZWQgb2YgdGhhdCkgewogICAgICAgICAgICBpZiAoY2hhbmdlZC5ib3QgJiYgY2hhbmdlZC5ib3QuaWQgPT09IHRhZ3MudHJhY2tCb3RJZCkgewogICAgICAgICAgICAgICAgY29uc3Qgb25seVJvdGF0aW9uVGFncyA9IGNoYW5nZWQudGFncy5ldmVyeSgodCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmVuZHNXaXRoKCdSb3RhdGlvbicpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWCcpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWScpIHx8IHQuZW5kc1dpdGgoJ1JvdGF0aW9uWicpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBvbmx5Um90YXRpb25UYWdzOicsIG9ubHlSb3RhdGlvblRhZ3MpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChvbmx5Um90YXRpb25UYWdzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGAsCiAgICBvbkFueUJvdHNSZW1vdmVkOiBgQAoKICAgICAgICBpZiAodGhhdC5ib3RJRHMuaW5jbHVkZXModGFncy50cmFja0JvdElkKSkgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgIH0KICAgIGAsCiAgICBvblBvcnRhbENoYW5nZWQ6IGBACiAgICAgICAgaWYgKHRoYXQuZGltZW5zaW9uID09PSB0YWdzLmRpbWVuc2lvbikgewogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZUxhYmVsKCk7CiAgICAgICAgfQogICAgYCwKICAgIHVwZGF0ZUxhYmVsOiBgQAogICAgICAgIGlmICghdGFncy5yZWFkeSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yaW5nIHVwZGF0ZUxhYmVsIGJlY2F1c2Ugbm90IHJlYWR5Jyk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBoYXNMYWJlbCA9IHRhZ3MubGFiZWwgIT0gbnVsbCAmJiB0YWdzLmxhYmVsICE9PSAnJzsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGhhc0xhYmVsOwoKICAgICAgICBpZiAoIWhhc0xhYmVsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yZSB1cGRhdGVMYWJlbCBjYWxsLCB0aGVyZSBpcyBubyBsYWJlbCB0YWcgdmFsdWUgdG8gZGlzcGxheS4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaW5NYXBQb3J0YWwgPSAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgY29uc3QgaW5HcmlkUG9ydGFsID0gKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICghaW5NYXBQb3J0YWwgJiYgIWluR3JpZFBvcnRhbCkgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBpZ25vcmUgdXBkYXRlTGFiZWwgY2FsbCwgbm90IGluIGVpdGhlciBncmlkIG9yIG1hcCBwb3J0YWwuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdHJhY2tCb3QgPSBnZXRCb3QoJ2lkJywgdGFncy50cmFja0JvdElkKTsKICAgICAgICBjb25zdCB0cmFja1Bvc2l0aW9uID0gZ2V0Qm90UG9zaXRpb24odHJhY2tCb3QsIHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSB0cmFja1Bvc2l0aW9uOicsIHRyYWNrUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgbGV0IGxhYmVsUG9zaXRpb24gPSB7IHg6IHRyYWNrUG9zaXRpb24ueCwgeTogdHJhY2tQb3NpdGlvbi55LCB6OiB0cmFja1Bvc2l0aW9uLnogfTsgCgogICAgICAgIGNvbnN0IHRyYWNrQm90U2NhbGUgPSB0cmFja0JvdC50YWdzLnNjYWxlID8/IDE7CiAgICAgICAgY29uc3QgdHJhY2tCb3RTY2FsZVogPSB0cmFja0JvdC50YWdzLnNjYWxlWiA/PyAxOwoKICAgICAgICBsZXQgbWV0ZXJzUGVyR3JpZFVuaXQgPSAxOwoKICAgICAgICBpZiAoaW5NYXBQb3J0YWwpIHsKICAgICAgICAgICAgLy8gU2NhbGUgdG8gbWFwIHBvcnRhbCB1bml0cy4KICAgICAgICAgICAgbWV0ZXJzUGVyR3JpZFVuaXQgPSAxMDsKICAgICAgICB9CgogICAgICAgIGxldCB0cmFja0JvdFJlYWxTY2FsZVogPSAodHJhY2tCb3RTY2FsZVogKiB0cmFja0JvdFNjYWxlKSAqIG1ldGVyc1BlckdyaWRVbml0OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIHRyYWNrQm90UmVhbFNjYWxlWjonLCB0cmFja0JvdFJlYWxTY2FsZVopOwogICAgICAgIH0KCiAgICAgICAgbGFiZWxQb3NpdGlvbi56ICs9IHRyYWNrQm90UmVhbFNjYWxlWiArICh0YWdzLmJvdExhYmVsTWFyZ2luICogbWV0ZXJzUGVyR3JpZFVuaXQpOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGxhYmVsUG9zaXRpb246JywgbGFiZWxQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1gnXSA9IGxhYmVsUG9zaXRpb24ueDsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1knXSA9IGxhYmVsUG9zaXRpb24ueTsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1onXSA9IGxhYmVsUG9zaXRpb24uejsKICAgIGAKfTsKCmxhYmVsTW9kID0gewogICAgLi4ubGFiZWxNb2QsCiAgICAuLi5yZXN0LAp9Cgpjb25zdCBsYWJlbEJvdCA9IGNyZWF0ZShsYWJlbE1vZCk7CgpyZXR1cm4gbGFiZWxCb3Q7JwCJrKDlBOTjAwV1dGlscwIEAImsoOUEnNoEKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAImsoOUE5OMDBGZvcm0CBACJrKDlBMPaBAdub3RoaW5nJwCJrKDlBOTjAwlhYlZlcnNpb24CBACJrKDlBMvaBAUxMC40MgA="}]}