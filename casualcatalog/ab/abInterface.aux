{"version":2,"updates":[{"id":0,"timestamp":1755809714309,"update":"AbgBxsn+GQAnAQRib3RzJDEzZjMzYTUxLWMyZmEtNDZkYS1hODhlLWU1YzA2NzU1NmQwMgEnAMbJ/hkACmFiSURPcmlnaW4CBADGyf4ZAQ10b29sYm94X3NraWxsJwDGyf4ZAAthYkludGVyZmFjZQIEAMbJ/hkPBHRydWUnAMbJ/hkAC2Rlc2NyaXB0aW9uAgQAxsn+GRQpVGhpcyBza2lsbCBpcyBhbiBpbnRlcmZhY2UgZm9yIHRvb2xib3hlcy4nAMbJ/hkABGZvcm0CBADGyf4ZPgdub3RoaW5nJwDGyf4ZAARtZW51AgQAxsn+GUYo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAxsn+GQAGc3lzdGVtAgQAxsn+GW0UYWIuaW50ZXJmYWNlLnRvb2xib3gnAMbJ/hkACmFiSURTdHVkaW8CBADGyf4ZggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwDGyf4ZAAhyZW1lbWJlcgIEAMbJ/hmnASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDGyf4ZAAt0b29sYm94X2FkZAIEAMbJ/hnOAacLQGNvbnN0IHRvb2xib3hEYXRhID0gdGhhdC50b29sYm94RGF0YTsKY29uc3QgdG9vbGJveFRpdGxlID0gdG9vbGJveERhdGEudGl0bGU7CmNvbnN0IHRvb2xib3hOYW1lID0gdG9vbGJveERhdGEubmFtZTsKY29uc3QgdG9vbGJveFN0dWRpbyA9IHRvb2xib3hEYXRhLnN0dWRpbzsKY29uc3QgZ3JpZERhdGEgPSB0aGF0LmdyaWREYXRhOwoKLy9MT0FESU5HIEJBUj8KCmlmICghbGlua3Muc2hlbGxVdGlscykgewogICAgLy8gTmVlZCBhYlNoZWxsIHRvIHVzZSBpdCdzIGFiTG9nIGZ1bmN0aW9uLgogICAgbGlua3MubGVhcm4uYWJBZGFwdCgnYWJTaGVsbCcpOwp9CgppZiAodG9vbGJveFN0dWRpbyA9PSBmYWxzZSkgewogICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdCh0b29sYm94TmFtZSk7CiAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKGAke3Rvb2xib3hUaXRsZSA/PyB0b29sYm94TmFtZX0gbG9hZGVkYCk7Cn0KZWxzZSB7CiAgICBjb25zdCB0b29sYm94TG9va3VwID0gYXdhaXQgbGlua3Muc2VhcmNoLmhhdGNoKHsgYWJJRDogdG9vbGJveE5hbWUsIHJlY29yZEtleTogdG9vbGJveFN0dWRpbywgYXV0b0hhdGNoOiB0cnVlIH0pOwoKICAgIGlmICh0b29sYm94TG9va3VwLnN1Y2Nlc3MpIHsKICAgICAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKGAke3Rvb2xib3hUaXRsZSA/PyB0b29sYm94TmFtZX0gbG9hZGVkYCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBsaW5rcy5zaGVsbFV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYGlzc3VlIGxvYWRpbmcgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9LCBwbGVhc2UgdHJ5IGFnYWluYCwgbG9nVHlwZTogJ2Vycm9yJyB9KTsKICAgIH0KfQoKY29uc3QgYWN0aXZlVG9vbGJveCA9IGdldEJvdCgic3lzdGVtIiwgYGFiLnRvb2xib3guJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9YCk7CgppZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJHcmlkTWVudU9uQmVmb3JlQ3JlYXRlKSB7CiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkdyaWRGb2N1cyA9IGdyaWREYXRhOwogICAgYXdhaXQgYWIubGlua3MubWVudS5hYk9wZW5NZW51KCJncmlkIik7CiAgICBjb25zdCBtZW51Qm90ID0gZ2V0Qm90KCJ0b29sYm94IiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScAxsn+GQAFbGVhcm4CBADGyf4Z9gwo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAxsn+GQAFc3RvcmUCBADGyf4ZnQ0o8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAxsn+GQAGc2VhcmNoAgQAxsn+GcQNKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAMbJ/hkACGFiSWdub3JlAgQAxsn+GesNBHRydWUnAMbJ/hkACWFiVmVyc2lvbgIEAMbJ/hnwDQQxMC42JwDGyf4ZAA1tYW5pZmVzdGF0aW9uAgQAxsn+GfUNKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAMbJ/hkAEGFiR3JpZE1lbnVBY3Rpb24CBADGyf4ZnA77B0BzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxpbmtzLm1lbnUubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsiOwoKY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7CmNvbnN0IG1lbnVCb3QgPSB7fTsKCm1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsKbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsKbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwptZW51Qm90Lm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspCnsKICAgIGNvbnN0IGFjdGl2ZVRvb2xib3ggPSBwb3NzaWJsZVRvb2xib3hlc1tpXTsKICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7CgogICAgbWVudUJvdC50b29sYm94X2RhdGEgPSBhY3RpdmVUb29sYm94OwogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOwoKICAgIGlmICghZXh0YW50Qm90KQogICAgewogICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCb3QpOwogICAgfQp9JwDGyf4ZABRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAMbJ/hmYFuICQGNvbnN0IHRvb2xib3hBcnJheSA9IGFiUmVtZW1iZXIudGFncy50b29sYm94X2FycmF5OwoKbGV0IGFsbFRvb2xzTG9hZGVkID0gdHJ1ZTsKCmZvciAobGV0IGkgPSAwOyBpIDwgdG9vbGJveEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBjdXJyZW50VG9vbCA9IHRvb2xib3hBcnJheVtpXS5uYW1lOwoKICAgIGlmICghZ2V0Qm90KCJhYklET3JpZ2luIiwgY3VycmVudFRvb2wpICYmICFnZXRCb3QoY3VycmVudFRvb2wsIHRydWUpKSB7CiAgICAgICAgYWxsVG9vbHNMb2FkZWQgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgIH0KfQoKaWYgKGFsbFRvb2xzTG9hZGVkKSB7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9JwDGyf4ZAA5hYkdyaWRNZW51SWNvbgIEAMbJ/hn7GApsb2NhbF9tYWxsJwDGyf4ZAA9hYkdyaWRNZW51TGFiZWwCBADGyf4ZhhkOY2FzdWFsIGNhdGFsb2cnAMbJ/hkAE2FiR3JpZE1lbnVTb3J0T3JkZXICBADGyf4ZlRkBMycAxsn+GQAPb25BQkluaXRpYWxpemVkAgQAxsn+GZcZKkAvLyBsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOycAxsn+GQANb25Ta2lsbFVwZGF0ZQIEAMbJ/hnCGVdAbGlua3MubGVhcm4uYWJBZGFwdCgiY2FzdWFsX3Rvb2xib3giKTsNCg0KY29uc29sZS5sb2coIltUb29sYm94XSBMb2FkaW5nIGNhc3VhbCBraXQiKTsnAMbJ/hkACnNoZWxsVXRpbHMCBADGyf4Zmhoo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycBBGJvdHMkMTc0MTBkODMtN2VlZS00YTFlLWI2MzgtNjU0NjM3NGQxN2MzAScAxsn+GcEaBnN5c3RlbQIEAMbJ/hnCGhFhYi5pbnRlcmZhY2Uuc2NhbicAxsn+GcEaBGZvcm0CBADGyf4Z1BoHbm90aGluZycAxsn+GcEaC2FiSW50ZXJmYWNlAgQAxsn+GdwaBHRydWUnAMbJ/hnBGghhYklnbm9yZQIEAMbJ/hnhGgR0cnVlJwDGyf4ZwRoPb25RUkNvZGVTY2FubmVkAgQAxsn+GeYagA5AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgppZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhc2siKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKHRoYXQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5hc2spIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hc2t9KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5wYXR0ZXJufSk7CiAgICAgICAgfQogICAgICAgIAogICAgfQp9JwDGyf4ZwRoFc3RvcmUCBADGyf4Z5ygo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAxsn+GcEaBnNlYXJjaAIEAMbJ/hmOKSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwDGyf4ZwRoQYWJDb3JlTWVudUFjdGlvbgIEAMbJ/hm1KTdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwDGyf4ZwRoPYWJDb3JlTWVudUxhYmVsAgQAxsn+Ge0pBHNjYW4nAMbJ/hnBGg5hYkNvcmVNZW51SWNvbgIEAMbJ/hnyKQ9xcl9jb2RlX3NjYW5uZXInAMbJ/hnBGhNhYkNvcmVNZW51U29ydE9yZGVyAgQAxsn+GYIqATMnAMbJ/hnBGglhYlZlcnNpb24CBADGyf4ZhCoEMTAuNicBBGJvdHMkNDkzZmZhNGQtNDZkNC00YTk4LWFlOWMtMTIxMmQ2NTExMzNmAScAxsn+GYkqBnN5c3RlbQIEAMbJ/hmKKhRhYi5pbnRlcmZhY2UudmVyc2lvbicAxsn+GYkqDW9uU2tpbGxVcGRhdGUCBADGyf4ZnyqnAUBjb25zdCB2ZXJzaW9uU3RyaW5nID0gdGFncy5hYkludGVyZmFjZU1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJJbnRlcmZhY2VNaW5vclZlcnNpb247DQoNCmNvbnNvbGUubG9nKCJbQUJJbnRlcmZhY2VdIExvYWRlZCBBQiBJbnRlcmZhY2UgdmVyc2lvbiAiICsgdmVyc2lvblN0cmluZyk7JwDGyf4ZiSoXYWJJbnRlcmZhY2VNYWpvclZlcnNpb24CBADGyf4ZxysBMScAxsn+GYkqF2FiSW50ZXJmYWNlTWlub3JWZXJzaW9uAgQAxsn+GckrAjE3JwDGyf4ZiSoIYWJJZ25vcmUCBADGyf4ZzCsEdHJ1ZScAxsn+GYkqBGZvcm0CBADGyf4Z0SsHbm90aGluZycAxsn+GYkqC2FiSW50ZXJmYWNlAgQAxsn+GdkrBHRydWUnAMbJ/hmJKglhYlZlcnNpb24CBADGyf4Z3isEMTAuNicBBGJvdHMkNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmAScAxsn+GeMrBnN5c3RlbQIEAMbJ/hnkKxNhYi5pbnRlcmZhY2UubnVnZ2V0JwDGyf4Z4ysEZm9ybQIEAMbJ/hn4Kwdub3RoaW5nJwDGyf4Z4ysLYWJJbnRlcmZhY2UCBADGyf4ZgCwEdHJ1ZScAxsn+GeMrCGFiSWdub3JlAgQAxsn+GYUsBHRydWUnAMbJ/hnjKwxhYkxvYWROdWdnZXQCBADGyf4ZiiyYAkBsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0TmFtZTsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK251Z2dldE5hbWU7CmxldCBsb2FkZWROdWdnZXQgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGZvcm1hdHRlZE51Z2dldEFCLCBhYlZlcnNpb246IHRoYXQudmVyc2lvbiwgcmV0dXJuVHlwZTogImRhdGEifSk7Cgpsb2FkZWROdWdnZXQgPSBsb2FkZWROdWdnZXQuc3RhdGVbbnVnZ2V0TmFtZV0ubnVnZ2V0OwoKcmV0dXJuIGxvYWRlZE51Z2dldDsnAMbJ/hnjKw9hYlB1Ymxpc2hOdWdnZXQCBADGyf4Zoy6MA0AvL3Nob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiAibnVnTmFtZSIsIGRhdGE6IGRhdGF9KTsgIEFERCBFR0cgSUQgRVZFTlRVQUxMWQpsZXQgdGVzdE51Z2dldCA9IHRoYXQuZGF0YTsKbGV0IGZvcm1hdHRlZE51Z2dldCA9IHtpZDogdGhhdC5udWcsIG51Z2dldDogdGVzdE51Z2dldH07CmxldCB0ZXN0TnVnZ2V0TmFtZSA9IHRoYXQubnVnOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrdGVzdE51Z2dldE5hbWU7CgptYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBmb3JtYXR0ZWROdWdnZXRBQjsKCmxpbmtzLnN0b3JlLmFiUHVibGlzaEFCKHthYjogZm9ybWF0dGVkTnVnZ2V0QUIsIHRhcmdldDogZm9ybWF0dGVkTnVnZ2V0LCBzb3VyY2VFdmVudDogJ3B1Ymxpc2hfbnVnZ2V0J30pOycAxsn+GeMrD2ltcGxlbWVudE51Z2dldAIEAMbJ/hmwMbEHQGxldCBudWdnZXROYW1lID0gdGhhdC5udWdnZXQ7CmxldCBudWdnZXRWZXJzaW9uQ2hlY2sgPSBudWdnZXROYW1lLmluZGV4T2YoIi52Iik7CmxldCB2ZXJzaW9uOwoKaWYgKG51Z2dldFZlcnNpb25DaGVjayAhPSAtMSkKewogICAgbnVnZ2V0TmFtZSA9IG51Z2dldE5hbWUuc3Vic3RyaW5nKDAsIG51Z2dldFZlcnNpb25DaGVjayk7CgogICAgbGV0IHZlcnNpb25DaGVjayA9IHRoYXQubnVnZ2V0LnN1YnN0cmluZyhudWdnZXRWZXJzaW9uQ2hlY2sgKyAyKTsKCiAgICBpZiAoaXNOYU4odmVyc2lvbkNoZWNrKSkKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyh2ZXJzaW9uQ2hlY2ssICJ2ZXJzaW9uIGlzIG5vdCBhIG51bWJlciIpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHZlcnNpb24gPSBOdW1iZXIodmVyc2lvbkNoZWNrKTsKICAgIH0KfQpjb25zb2xlLmxvZyhudWdnZXROYW1lLCB2ZXJzaW9uKTsKbGV0IG51Z0RhdGEgPSBhd2FpdCB0aGlzQm90LmFiTG9hZE51Z2dldCh7bnVnZ2V0TmFtZTogbnVnZ2V0TmFtZSwgdmVyc2lvbjogdmVyc2lvbn0pOwoKaWYgKG51Z0RhdGEgPT0gImFiSUQgbm90IGZvdW5kIikKewogICAgb3MudG9hc3QoIm51Z2dldCBub3QgZm91bmQiKTsKfQplbHNlCnsKICAgIGxldCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwogICAgbGV0IHRhcmdldFRhZyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLnRvU3RyaW5nKCk7CiAgICBsZXQgdGFyZ2V0TnVnID0gInsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldFRhZy5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwogICAgaW5zZXJ0VGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIG51Z0RhdGEpOwp9JwDGyf4Z4ysMbnVnZ2V0QnV0dG9uAgQAxsn+GeI49QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnAMbJ/hnjKwtudWdnZXRQYXJzZQIEAMbJ/hnWRacPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwDGyf4Z4ysNb25BQlB1Ymxpc2hlZAIEAMbJ/hn+VMEBQGNvbnNvbGUubG9nKHRoYXQuYWIsIHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQoKaWYgKHRoYXQuYWIgPT0gdGFncy5udWdnZXRUb1B1Ymxpc2gpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgcHVibGlzaGVkIik7CgogICAgbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gbnVsbDsKCiAgICBjb25maWdCb3QubWFza3MuYWJWZXJzaW9uID0gbnVsbDsKfScAxsn+GeMrEG9uQW55Qm90c0NoYW5nZWQCBADGyf4ZwFa3BEBpZiAoY29uZmlnQm90ICYmIHRoYXRbMF0uYm90LmlkICE9IHRoaXNCb3QuaWQpIAp7CiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QpIHJldHVybjsgLy8gSWdub3JlIGlmIHRoZSBjb25maWdCb3QgaXNuJ3QgcmVhZHkgeWV0LgoKICAgIGNvbnN0IGVkaXRlZEJvdElEID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdC5yZXBsYWNlKCLwn5SXIiwgIiIpOwoKICAgIGlmICghdGhhdC5maW5kKHggPT4geC5ib3QuaWQgPT0gZWRpdGVkQm90SUQpKSByZXR1cm47IC8vIElmIHRoZSBib3QgY2hhbmdlZCB3YXNuJ3QgYmVpbmcgZWRpdGVkIGJ5IHRoZSB1c2VyIGlnbm9yZSBpdC4KCiAgICBjb25zdCBlZGl0ZWRUYWcgPSBjb25maWdCb3QudGFncy5lZGl0aW5nVGFnOwogICAgY29uc3QgZWRpdGVkQm90ID0gZ2V0Qm90KCJpZCIsIGVkaXRlZEJvdElEKTsKCiAgICBpZiAoZWRpdGVkQm90ICYmIGVkaXRlZFRhZykgCiAgICB7CiAgICAgICAgc2hvdXQoIm51Z2dldFJlc2V0Iik7CgogICAgICAgIHRoaXNCb3QubnVnZ2V0UGFyc2UoeyBlZGl0ZWRCb3QsIGVkaXRlZFRhZyB9KTsKICAgIH0KfScAxsn+GeMrCG9uQ3JlYXRlAgQAxsn+GfZaTEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnAMbJ/hnjKw1wYWNrYWdlTnVnZ2V0AgQAxsn+GcNb+AZAY29uc3QgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKY29uc3QgdGFnVGV4dCA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddOwoKaWYgKGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXggfHwgY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXgpCnsKICAgIGxldCBzdGFydFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXg7CiAgICBsZXQgZW5kUG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXg7CgogICAgaWYgKHN0YXJ0UG9zID09IGVuZFBvcykKICAgIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlIGlmIChzdGFydFBvcyA+IGVuZFBvcykKICAgIHsKICAgICAgICBsZXQgbmV3U3RhcnRQb3MgPSBlbmRQb3M7CiAgICAgICAgbGV0IG5ld0VuZFBvcyA9IHN0YXJ0UG9zOwoKICAgICAgICBzdGFydFBvcyA9IG5ld1N0YXJ0UG9zOwogICAgICAgIGVuZFBvcyA9IG5ld0VuZFBvczsKICAgIH0KCiAgICBsZXQgZGF0YSA9IHRhZ1RleHQuc3Vic3RyaW5nKHN0YXJ0UG9zLCBlbmRQb3MgKyAxKTsKCiAgICBzaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogdGhhdC5udWdnZXQsIGRhdGE6IGRhdGF9KTsKCiAgICBvcy50b2FzdCgibnVnIGlzIHB1Ymxpc2hpbmciLCAxMCk7CgogICAgbGV0IHRhcmdldE51ZyA9ICIubnVnIHsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgiY2Fubm90IHJlYWQgbnVnZ2V0IHRvIGJlIHB1Ymxpc2hlZCIpCn0nAMbJ/hnjKwhyZW1lbWJlcgIEAMbJ/hm8Yijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDGyf4Z4ysGc2VhcmNoAgQAxsn+GeNiKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAMbJ/hnjKwVzdG9yZQIEAMbJ/hmKYyjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwDGyf4Z4ysJbGlzdGVuaW5nAgQAxsn+GbFjBWZhbHNlJwDGyf4Z4ysJYWJWZXJzaW9uAgQAxsn+GbdjBDEwLjYnAQRib3RzJGIzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYgEnAMbJ/hm8YxlhYkNyZWF0ZU1lbnVCdXN5SW5kaWNhdG9yAgQAxsn+Gb1jzgxAY29uc3QgewogICAgbGFiZWwgPSBgJHthYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHl9IGlzIHdvcmtpbmdgLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fQoKbGV0IGJ1c3lJbmRpY2F0b3IgPSB7CiAgICBvblBvaW50ZXJVcDogbnVsbCwKICAgIG9uUG9pbnRlckRvd246IG51bGwsCiAgICBwb2ludGFibGU6IGZhbHNlLAogICAgYnVzeUxhYmVsOiBsYWJlbCwKICAgIGxhYmVsQWxpZ25tZW50OiAnbGVmdCcsCiAgICBzdGF0ZTogMCwKICAgIGFuaW1TdGF0ZXM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfYm90dG9tJywKICAgICAgICB9LAogICAgXSwKICAgIGFuaW1SYXRlOiA1MDAsCiAgICBvbkJvdEFkZGVkOiBgQAogICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICBvbkJvdENoYW5nZWQ6IGBACiAgICAgICAgY29uc3QgbmVlZFJlZnJlc2ggPSB0aGF0LnRhZ3Muc29tZSh0ID0+IHQgPT09ICdidXN5TGFiZWwnIHx8IHQgPT09ICdzdGF0ZScgfHwgdCA9PT0gJ2FuaW1TdGF0ZXMnKTsKICAgICAgICBpZiAobmVlZFJlZnJlc2gpIHsKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0KICAgIGAsCiAgICByZWZyZXNoRGlzcGxheTogYEAKICAgICAgICBpZiAodGFncy5hbmltU3RhdGVzICYmIHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IGFuaW1TdGF0ZSA9IHRhZ3MuYW5pbVN0YXRlc1t0YWdzLnN0YXRlXTsKCiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSB0YWdzLmJ1c3lMYWJlbC50cmltKCkgKyBhbmltU3RhdGUuZWxsaXBzaXM7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBhbmltU3RhdGUuZm9ybUFkZHJlc3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5sYWJlbCAKICAgICAgICB9CiAgICBgLAogICAgYW5pbWF0ZTogYEAKICAgICAgICBpZiAodGFncy5zdGF0ZSA+PSB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICB0YWdzLnN0YXRlID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLnN0YXRlICs9IDE7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBvcy5zbGVlcCh0YWdzLmFuaW1SYXRlKTsKICAgICAgICB0aGlzQm90LmFuaW1hdGUoKTsKICAgIGAsCiAgICAuLi5yZXN0Cn07Cgpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYnVzeUluZGljYXRvcik7CgpyZXR1cm4gbWVudUJvdDsnAMbJ/hm8YwZzeXN0ZW0CBADGyf4ZjHARYWIuaW50ZXJmYWNlLm1lbnUnAMbJ/hm8YwRmb3JtAgQAxsn+GZ5wB25vdGhpbmcnAMbJ/hm8YwtkZXNjcmlwdGlvbgIEAMbJ/hmmcCZUaGlzIHNraWxsIGlzIGRlc2lnbmVkIGZvciBtZW51IHN0dWZmLigAxsn+GbxjC2FiSW50ZXJmYWNlAXgnAMbJ/hm8YwphYk9wZW5NZW51AgQAxsn+Gc5w9xhAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgbWVudVR5cGUgPSB0aGF0ID8gImFiIiArIHRoYXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGF0LnNsaWNlKDEpICsgIk1lbnUiOiAiYWJDb3JlTWVudSI7IC8vc2V0IHVwIGEgY2hlY2sgdG8gc2VlIHdoYXQgdHlwZSBvZiBtZW51IHNob3VsZCBiZSBvY2N1cmluZyBbY29yZSwgYm90LCBncmlkLCBpbnN0XQpsZXQgbWVudVNraWxscyA9IGdldEJvdHMobWVudVR5cGUgKyAiQWN0aW9uIik7CmxldCBtYXhPcHRpb25zID0gbWVudVR5cGUgPT0gImluc3QiID8gNyA6IDU7CmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5OwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MuYmFzZVNraWxsLiR7bWVudVR5cGUgKyAiQWN0aW9uIn0oe2JvdDogdGhpc0JvdH0pO2A7CgpsZXQgc29ydE9yZGVySW5kZXggPSBtZW51U2tpbGxzLmxlbmd0aDsKZm9yIChsZXQgaSA9IDA7IGkgPCBtZW51U2tpbGxzLmxlbmd0aDsgaSsrKS8vQUREIExPR0lDIEZPUiBNT1JFIE9QVElPTlMgVEhBTiA1IDogbWF4T3B0aW9ucwp7CiAgICAvL0FsbG93cyBmb3IgY29kZSB0byBnZXQgY2FsbGVkIGJlZm9yZSB0aGUgbWVudSBnZW5lcmF0ZXMsIHVzZWZ1bCBmb3IgZHluYW1pY2FsbHkgc2V0IGdyb3VwcyBvciBkcm9wZG93bnMKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiXSkgewogICAgICAgIGF3YWl0IHdoaXNwZXIobWVudVNraWxsc1tpXSwgbWVudVR5cGUgKyAiT25CZWZvcmVDcmVhdGUiKTsKICAgIH0gCiAgICAKICAgIGxldCBjdXJyZW50U2tpbGwgPSBtZW51U2tpbGxzW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5iYXNlU2tpbGwgPSAi8J+UlyIgKyBjdXJyZW50U2tpbGwuaWQ7CiAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJMYWJlbCJdOwogICAgYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSWNvbiJdOwogICAgYWJNZW51QnV0dG9uLm9uQ3JlYXRlID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiT25HZW5lcmF0ZSJdOwogICAgYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIlNvcnRPcmRlciJdOwogICAgYWJNZW51QnV0dG9uLmNvbG9yID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA/IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkNvbG9yIl0gOiBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcjsKCiAgICBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiZHJvcGRvd24iKSB7CiAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duT3B0aW9ucyA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duT3B0aW9uczsKCiAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duU29ydE9yZGVyID09ICJhdXRvIikgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZHJvcGRvd25Tb3J0T3JkZXIgPSBzb3J0T3JkZXJJbmRleDsKICAgICAgICAgICAgKytzb3J0T3JkZXJJbmRleDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZHJvcGRvd25Tb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFncy5kcm9wZG93blNvcnRPcmRlcjsKICAgICAgICB9CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bihhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJncm91cCIpIHsKICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyID09ICJhdXRvIikgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBzb3J0T3JkZXJJbmRleDsKICAgICAgICAgICAgKytzb3J0T3JkZXJJbmRleDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFncy5ncm91cFNvcnRPcmRlcjsKICAgICAgICB9CiAgICAgICAgYWJNZW51QnV0dG9uLm1lbnVJdGVtcyA9IGN1cnJlbnRTa2lsbC50YWdzLm1lbnVJdGVtczsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUdyb3VwKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImlucHV0IikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAidGV4dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAidG9vbCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2woYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAid2l6YXJkIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKGFiTWVudUJ1dHRvbik7CiAgICB9Cn0KCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsiOwoKc2hvdXQoJ29uQUJPcGVuTWVudScsIHsgbWVudTogdGhhdCwgbWVudVR5cGUsIG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsIH0pOycAxsn+GbxjEmFiQ3JlYXRlTWVudUJ1dHRvbgIEAMbJ/hnEiQH4DUBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9OwoKbGV0IHsKICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwKICAgIC4uLmFkZGl0aW9uYWxUYWdzCn0gPSB0aGF0ID8/IHt9CgppZiAodHlwZW9mIG1lbnVJdGVtU3R5bGUgPT0gJ3N0cmluZycpIHsKICAgIG1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbVN0eWxlLnJlcGxhY2UoL1x1ezFGOUVDfS91LCAnJyk7IAogICAgbWVudUl0ZW1TdHlsZSA9IEpTT04ucGFyc2UobWVudUl0ZW1TdHlsZSk7Cn0KCmZ1bmN0aW9uIGhhc0JvcmRlclN0eWxlKCkgewogICAgaWYgKG1lbnVJdGVtU3R5bGVbImJvcmRlci10b3Atc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItbGVmdC1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1ib3R0b20tc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItcmlnaHQtc3R5bGUiXSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdKSB7CiAgICBpZiAoYWRkaXRpb25hbFRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJNZW51R3JvdXAiXSkgewoKICAgIH0KfQoKbmV3TWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdNZW51QnV0dG9uLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3I7Cm5ld01lbnVCdXR0b24ubGFiZWxDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7Cm5ld01lbnVCdXR0b24uc2hhZG93Q29sb3IgPSB0aGF0LnNoYWRvd0NvbG9yID8/IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU2hhZG93Q29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLnNjYWxlWSA9IDE7Cgpjb25zdCBtZW51U3R5bGluZyA9IHsKICAgICJib3JkZXItcmFkaXVzIjoiOHB4IiwKICAgICJtYXJnaW4tdG9wIjogIjhweCIsCiAgICAiYm94LXNoYWRvdyI6IGAzcHggNHB4ICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIm1pbi1oZWlnaHQiOiAiNDRweCIsCiAgICAiYm9yZGVyIjogaGFzQm9yZGVyU3R5bGUoKSA/ICIiIDogYDJweCBzb2xpZCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJ3aWR0aCI6ICJjYWxjKDEwMCUgLSA1cHgpIiwKICAgIC4uLm1lbnVJdGVtU3R5bGUKfQoKbmV3TWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gbWVudVN0eWxpbmc7Cgpjb25zdCBjbGlja2VkU3R5bGluZyA9IHsKICAgIC4uLm1lbnVTdHlsaW5nLAogICAgImZpbHRlciI6ICJicmlnaHRuZXNzKDYwJSkiCn0KY29uc3QgYmFzZVN0eWxlID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9ICfwn6esICR7SlNPTi5zdHJpbmdpZnkoY2xpY2tlZFN0eWxpbmcpfSdgCgpuZXdNZW51QnV0dG9uLm9uUG9pbnRlckRvd24gPSBtZW51SXRlbVN0eWxlPy5bIm1hcmdpbi10b3AiXSAhPSAiMHB4IiA/IGJhc2VTdHlsZSA6ICJAIC8vIjsKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJVcCA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsYDsKCmZvciAoY29uc3QgdGFnIGluIGFkZGl0aW9uYWxUYWdzKQp7CiAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOwp9CgpuZXdNZW51QnV0dG9uID0gY3JlYXRlKG5ld01lbnVCdXR0b24pOwoKcmV0dXJuIG5ld01lbnVCdXR0b247JwDGyf4ZvGMNYWJNZW51UmVmcmVzaAIEAMbJ/hm7lwGBAUBpZiAoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbD8uc3Vic3RyaW5nKDAsMikgPT0gImFiIikKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKICAgIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKfScAxsn+GbxjCHJlbWVtYmVyAgQAxsn+Gb2YASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDGyf4ZvGMNbWFuaWZlc3RhdGlvbgIEAMbJ/hnkmAEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAxsn+GbxjEWFiRW52aXJvbm1lbnRNZW51AgQAxsn+GYuZAYMqQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKCmNvbnN0IGFiRW52aXJvbm1lbnRPcHRpb25zID0gdGhpc0JvdC5hYkdldEVudmlyb25tZW50T3B0aW9ucygpOwoKYnV0dG9uTG9vcDoKZm9yIChsZXQgaSA9IDA7IGkgPCBhYkVudmlyb25tZW50T3B0aW9ucy5sZW5ndGg7IGkrKykKewogICAgbGV0IGFjdGl2ZUJ1dHRvbiA9IGFiRW52aXJvbm1lbnRPcHRpb25zW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBhY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI7CgogICAgaWYgKGFjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZSkKICAgIHsKICAgICAgICBpZiAoIWxpbmtzW2FjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZV0pCiAgICAgICAgewogICAgICAgICAgICBjb250aW51ZSBidXR0b25Mb29wOwogICAgICAgIH0KICAgIH0KCiAgICBsZXQgbmV3QnV0dG9uRGF0YSA9IHsuLi5hYk1lbnVCdXR0b24sIC4uLmFjdGl2ZUJ1dHRvbn07CgogICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3QnV0dG9uRGF0YSk7Cn0KCmNvbnN0IGFiUGVyc29uYWxpdHlDb25maWdCdXR0b24gPSB7CiAgICBsYWJlbDogImN1c3RvbWl6ZTogYWIgcGVyc29uYWxpdHkiLAogICAgLi4uYWJNZW51QnV0dG9uLAogICAgYWJNZW51U29ydE9yZGVyOiAxLAogICAgZHJvcGRvd25Tb3J0T3JkZXI6IDEsCiAgICBkcm9wZG93bk9wdGlvbnM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiAibmFtZSIsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksIHt0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgdG8gY2FsbCBtZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bmFtZTogbmFtZX0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7YCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJjb2xvciIsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbWUgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge2NvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7YCwKICAgICAgICAgICAgICAgIC8vbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvciA9IGNvbG9yOyBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciAhPSAnY2xlYXInKXtsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yID0gY29sb3J9OyBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiAibWVudSBjb2xvciIsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnVzIHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51Q29sb3I6IGNvbG9yfSk7IAogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTtgLAogICAgICAgICAgICAgICAgLy9saW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yID0gY29sb3I7IGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yICE9ICdjbGVhcicpe2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgPSBjb2xvcn07IGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJtZW51IHRleHQgY29sb3IiLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudSB0ZXh0IHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51TGFiZWxDb2xvcjogY29sb3J9KTsgCiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICAgICAgICAgICAgICAvL2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IgPSBjb2xvcjsgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgIT0gJ2NsZWFyJyl7bGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciA9IGNvbG9yfTsgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogImRlZmF1bHQgcG9ydGFsIGNvbG9yIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgbGV0IHBvcnRhbENvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4Jywge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB5b3VyIHBvcnRhbCB0byBsb29rIGxpa2U/J30pOwogICAgICAgICAgICAgICAgaWYgKCFwb3J0YWxDb2xvcikgewogICAgICAgICAgICAgICAgICAgIHBvcnRhbENvbG9yID0gJyMyNjMyMzgnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeydwb3J0YWxDb2xvcic6IHBvcnRhbENvbG9yfSk7IAogICAgICAgICAgICAgICAgLy9kZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiAiZGVmYXVsdCBzZXR0aW5ncyIsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgICAgICAgICBjb2xvcjogJ3JlZCcsCiAgICAgICAgICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7J2RlZmF1bHRQZXJzb25hbGl0eSc6IHRydWV9KTsgCiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJtZW51IGNvbG9yIiwKICAgICAgICAvLyAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAvLyAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgIC8vICAgICAgICAgY29uc3QgbWVudUNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGFiUGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHt0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudSdzIHRvIGJlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51Q29sb3I6IG1lbnVDb2xvcn0pOyAKICAgICAgICAvLyAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7YCwKICAgICAgICAvLyB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJwcm9tcHQiLAogICAgICAgIC8vICAgICBvbkNsaWNrOiBgQGAsCiAgICAgICAgLy8gfSwKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAgIGxhYmVsOiAiZm9ybSIsCiAgICAgICAgLy8gICAgIG9uQ2xpY2s6IGBAIAogICAgICAgIC8vICAgICAgICAgY29uc3QgZm9ybSA9IGF3YWl0IG9zLnNob3dJbnB1dChhYlBlcnNvbmFsaXR5LnRhZ3MuYWJGb3JtLCB7dGl0bGU6ICd3aGF0IGZvcm0gd291bGQgeW91IGxpa2UgbWUgdG8gdGFrZT8nfSk7CiAgICAgICAgLy8gICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7Zm9ybTogZm9ybX0pOyAKICAgICAgICAvLyAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7YCwKICAgICAgICAvLyB9CiAgICBdCn0KCnRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJQZXJzb25hbGl0eUNvbmZpZ0J1dHRvbik7Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gIkAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IjsKCnNob3V0KCdvbkFCRW52aXJvbm1lbnRNZW51JywgeyBtZW51UG9ydGFsOiBjb25maWdCb3QudGFncy5tZW51UG9ydGFsfSApJwDGyf4ZvGMFbGVhcm4CBADGyf4Zj8MBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAMbJ/hm8YwNncHQCBADGyf4ZtsMBKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAMbJ/hm8YwhhYklnbm9yZQIEAMbJ/hndwwEEdHJ1ZScAxsn+GbxjBnNlYXJjaAIEAMbJ/hniwwEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAxsn+GbxjBm51Z2dldAIEAMbJ/hmJxAEo8J+UlzRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZicAxsn+GbxjBXRlc3RzAgQAxsn+GbDEASjwn5SXYjgzZDk3MmItMDUzNS00MDUxLWI1ODktNDFjZWRhODUzNWYxJwDGyf4ZvGMPb25Qb3J0YWxDaGFuZ2VkAgQAxsn+GdfEAW5AaWYgKHRoYXQucG9ydGFsID09ICJzeXN0ZW1Qb3J0YWwiICYmICF0aGF0LmRpbWVuc2lvbiAmJiAhbGlua3MudGVzdHMpCnsKICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoImFiVGVzdHMiKTsKfScAxsn+GbxjA2FzawIEAMbJ/hnGxQEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAxsn+GbxjCWFiVmVyc2lvbgIEAMbJ/hntxQEEMTAuNicAxsn+GbxjEWFiQ3JlYXRlTWVudUlucHV0AgQAxsn+GfLFAZ4CQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVJbnB1dCA9IHsNCiAgICBmb3JtOiAiaW5wdXQiLA0KICAgIG1lbnVJdGVtU2hvd1N1Ym1pdFdoZW5FbXB0eTogZmFsc2UsDQogICAgZm9ybUlucHV0TXVsdGlsaW5lOiBudWxsLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVJbnB1dCk7DQoNCnJldHVybiBtZW51Qm90OycAxsn+GbxjEGFiQ3JlYXRlTWVudVRleHQCBADGyf4ZkcgBgQRAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpjb25zdCB7DQogICAgbWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIC4uLnJlc3QNCn0gPSB0aGF0Ow0KDQpsZXQgbWVudVRleHQgPSB7DQogICAgZm9ybTogInRleHQiLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgcG9pbnRhYmxlOiBmYWxzZSwNCiAgICBjb2xvcjogIndoaXRlIiwNCiAgICBtZW51SXRlbVN0eWxlOiB7DQogICAgICAgICJwYWRkaW5nLXRvcCI6ICI2cHgiLA0KICAgICAgICAicGFkZGluZy1ib3R0b20iOiAiNnB4IiwNCiAgICB9LA0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZTogew0KICAgICAgICAid2hpdGUtc3BhY2UiOiAicHJlLXdyYXAiLA0KICAgICAgICAuLi5tZW51SXRlbUxhYmVsU3R5bGUsDQogICAgfSwNCiAgICAuLi5yZXN0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRleHQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAMbJ/hm8YxBhYkNyZWF0ZU1lbnVUb29sAgQAxsn+GZPMAY4BQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVUb29sID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51VG9vbCk7DQoNCnJldHVybiBtZW51Qm90OycAxsn+GbxjEmFiQ3JlYXRlTWVudVdpemFyZAIEAMbJ/hmizQGSAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51V2l6YXJkID0gew0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51V2l6YXJkKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwDGyf4ZvGMUYWJDcmVhdGVNZW51RHJvcGRvd24CBADGyf4Ztc4B1RhAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAoIXRoYXQuZHJvcGRvd25Tb3J0T3JkZXIpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudURyb3Bkb3duOiBkcm9wZG93blNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCBvdXRlck1lbnVCdXR0b24gPSB7DQogICAgLi4udGhhdCwNCiAgICBmb3JtQWRkcmVzczogdGhhdC5mb3JtQWRkcmVzcyA/PyAiYXJyb3dfcmlnaHQiLA0KICAgIGRyb3Bkb3duT3BlbjogZmFsc2UsDQogICAgb25DbGljazogYEANCiAgICAgICAgdGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gJHt0aGF0LmRyb3Bkb3duU29ydE9yZGVyfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gZmFsc2U7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyh0YWdzLmRyb3Bkb3duT3B0aW9ucywgdGFncy5kcm9wZG93blNvcnRPcmRlcik7DQogICAgICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkRlc3Ryb3k6IGBADQogICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgYCwNCiAgICBvblBvaW50ZXJVcDogYEANCiAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgbWFza3MuZm9ybUFkZHJlc3MgPSAiYXJyb3dfcmlnaHQiOw0KICAgICAgICB9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSBmYWxzZSkgew0KICAgICAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAiZm9ybUFkZHJlc3MiLCAiYXJyb3dfZHJvcF9kb3duIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJtZW51SXRlbVN0eWxlIiwgey4uLnRhZ3MubWVudUl0ZW1TdHlsZSwgImJvcmRlckJvdHRvbUxlZnRSYWRpdXMiOiAiMCIsICJib3JkZXJCb3R0b21SaWdodFJhZGl1cyI6ICIwIn0pOw0KICAgICAgICB9DQogICAgYA0KfTsNCg0KaWYgKHRoYXQuZm9ybUFkZHJlc3MgJiYgdGhhdC5mb3JtQWRkcmVzcyAhPSAiYXJyb3dfcmlnaHQiKSB7DQogICAgb3V0ZXJNZW51QnV0dG9uLmN1c3RvbUZvcm1BZGRyZXNzID0gdHJ1ZTsNCn0NCm91dGVyTWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gdGhhdC5kcm9wZG93blNvcnRPcmRlcjsNCg0KY29uc3QgbWVudUJvdCA9IGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG91dGVyTWVudUJ1dHRvbik7DQptZW51Qm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyA9IGdlbmVyYXRlTWVudU9wdGlvbnM7DQoNCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlTWVudU9wdGlvbnMgKG9wdGlvbnMsIHNvcnRPcmRlcikgew0KICAgIGNvbnN0IG1lbnVCb3RzID0gW107DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgKytpKSB7DQoNCiAgICAgICAgbGV0IG5ld01lbnVCdXR0b24gPSB7DQogICAgICAgICAgICAuLi5vcHRpb25zW2ldLA0KICAgICAgICAgICAgY2xlYXJEcm9wZG93bk1lbnU6IGBADQogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsNCiAgICAgICAgICAgIGANCiAgICAgICAgfTsNCg0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSBOdW1iZXIoc29ydE9yZGVyKSArICgoaSArIDEpIC8gMTAwMCk7DQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbF0gPSB0cnVlOw0KDQogICAgICAgIGlmIChpID09IG9wdGlvbnMubGVuZ3RoIC0gMSkgew0KICAgICAgICAgICAgaWYgKG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyUmFkaXVzIl0gPSAiMCAwIDhweCA4cHgiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAgMCA4cHggOHB4Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyUmFkaXVzIl0gPSAiMCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclRvcCJdID0gIm5vbmUiOw0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bIm1hcmdpblRvcCJdID0gIjAiOw0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bInBhZGRpbmdMZWZ0Il0gPSAiMzVweCI7DQoNCiAgICAgICAgY29uc3QgbmV3TWVudUJvdCA9IGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld01lbnVCdXR0b24pOw0KICAgICAgICBtZW51Qm90cy5wdXNoKG5ld01lbnVCb3QpOw0KICAgIH0NCg0KICAgIG1lbnVCb3QudGFncy5tZW51Qm90cyA9IGdldExpbmsobWVudUJvdHMpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdDsNCg0KJwDGyf4ZvGMRYWJDcmVhdGVNZW51R3JvdXACBADGyf4Zi+cB3B1ALyoNCiAgIEVYQU1QTEUNCiAgIGNvbnN0IG1lbnVHcm91cCA9IHsNCiAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgZ3JvdXBTb3J0T3JkZXI6IDEsDQogICAgICAgIG1lbnVJdGVtczogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDEiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgY29sb3I6ICJvcmFuZ2UiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMyIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgIG1lbnVJdGVtVHlwZTogImRyb3Bkb3duIiwNCiAgICAgICAgICAgICAgICBkcm9wZG93bk9wdGlvbnM6IFsNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDIiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXQ0KICAgIH0NCiovDQoNCmlmICAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICghdGhhdC5ncm91cFNvcnRPcmRlcikgew0KICAgIHRocm93IG5ldyBFcnJvcihgYWJDcmVhdGVNZW51R3JvdXA6IGdyb3VwU29ydE9yZGVyIGlzIG5vdCBwcm92aWRlZC5gKTsNCn0NCg0KbGV0IHsNCiAgICBtZW51SXRlbVN0eWxlID0ge30sDQogICAgbWVudUl0ZW1zID0gW10sDQogICAgLi4uYWRkaXRpb25hbFRhZ3MNCn0gPSB0aGF0ID8/IHt9DQoNCmNvbnN0IG1lbnVCb3RzID0gW107DQpmb3IgKGxldCBpID0gMDsgaSA8IG1lbnVJdGVtcy5sZW5ndGg7ICsraSkgew0KDQogICAgbGV0IG5ld01lbnVCdXR0b24gPSB7fTsNCg0KICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTAwKTsNCg0KICAgIGxldCBpbmRpdk1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbXNbaV0ubWVudUl0ZW1TdHlsZSA/PyB7fTsNCiAgICBsZXQgaW5kaXZNZW51VHlwZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVR5cGUgPz8gdW5kZWZpbmVkOw0KICAgIGxldCBpbmRpdkFkZGl0aW9uYWxUYWdzID0gbWVudUl0ZW1zW2ldOw0KICAgIGlmIChpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXTsNCiAgICB9DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdKSB7DQogICAgICAgIGRlbGV0ZSBpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVR5cGUiXTsNCiAgICB9DQoNCiAgICBjb25zdCBiYXNlU3R5bGluZyA9IHsNCiAgICAgICAgImJvcmRlclRvcCI6ICJub25lIiwNCiAgICAgICAgIm1hcmdpblRvcCI6ICIwIg0KICAgIH0NCg0KICAgIGlmIChpID09IG1lbnVJdGVtcy5sZW5ndGggLSAxKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4uYmFzZVN0eWxpbmcsDQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjAgMCA4cHggOHB4IiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0gZWxzZSBpZiAoaSA9PSAwKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICI4cHggOHB4IDAgMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzt9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4uYmFzZVN0eWxpbmcsDQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjAiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpDQogICAgew0KICAgICAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgdGFnIGluIGluZGl2QWRkaXRpb25hbFRhZ3MpDQogICAgew0KICAgICAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBpbmRpdkFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgbGV0IG5ld01lbnVCb3Q7DQogICAgc3dpdGNoKGluZGl2TWVudVR5cGUpIHsNCiAgICAgICAgY2FzZSAiZHJvcGRvd24iOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAuLi5uZXdNZW51QnV0dG9uLA0KICAgICAgICAgICAgICAgICAgICAiZHJvcGRvd25Tb3J0T3JkZXIiOiBOdW1iZXIodGhhdC5ncm91cFNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgImlucHV0IjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRleHQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ0b29sIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2wobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAid2l6YXJkIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBkZWZhdWx0OiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgfQ0KICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQp9DQoNCnJldHVybiBtZW51Qm90czsnAMbJ/hm8YwtwZXJzb25hbGl0eQIEAMbJ/hnohAIo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAxsn+GbxjF2FiR2V0RW52aXJvbm1lbnRPcHRpb25zAgQAxsn+GY+FAuUkQGNvbnN0IG9wdGlvbnMgPSBbCiAgICB7CiAgICAgICAgbGFiZWw6ICJoaWRlIiwKICAgICAgICBmb3JtQWRkcmVzczogInZpc2liaWxpdHlfb2ZmIiwKICAgICAgICBvbkNsaWNrOiAiQCBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDAKICAgIH0sCiAgICB7CiAgICAgICAgbGFiZWw6ICJvcHRpbWl6ZSBtb2RlIiwKICAgICAgICBvbkNyZWF0ZTogIkAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgICAgIG9uQ2xpY2s6ICJAIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSBmYWxzZSA6IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gdHJ1ZTsgdGhpc0JvdC5vbkNyZWF0ZSgpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEKICAgIH0sCiAgICB7CiAgICAgICAgbGFiZWw6ICJzbGVlcCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJuaWdodHNfc3RheSIsCiAgICAgICAgb25DbGljazogIkBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOyBzZXRUYWdNYXNrKGxpbmtzLnJlbWVtYmVyLCAnYWJBd2FrZVN0YXRlJywgZmFsc2UsICdzaGFyZWQnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAzCiAgICB9LAogICAgewogICAgICAgIGxhYmVsOiAiY2hhdCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJjaGF0IiwKICAgICAgICBvbkNsaWNrOiAiQCBzaG91dCgnYWJDaGF0QmFyT3BlbicpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDQKICAgIH0sCiAgICB7CiAgICAgICAgbGFiZWw6ICJudWdnZXRzIiwKICAgICAgICBvbkNyZWF0ZTogIkAgdGFncy5udWdNYW5hZ2VyID0gZ2V0TGluayhnZXRCb3QoJ3N5c3RlbScsICdhYi5pbnRlcmZhY2UubnVnZ2V0JykpOyBpZiAobGlua3MubnVnTWFuYWdlci50YWdzLmxpc3RlbmluZyl7dGFncy5vbkNsaWNrID0gYEAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIG51bGwpO2A7dGFncy5mb3JtQWRkcmVzcyA9IGBjaGVja19ib3hgO31lbHNleyAgICB0YWdzLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgdHJ1ZSwgJ2xvY2FsJyk7YDsgICAgdGFncy5mb3JtQWRkcmVzcyA9IGBjaGVja19ib3hfb3V0bGluZV9ibGFua2A7fSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDUKICAgIH0sCiAgICB7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJncHQiLAogICAgICAgIG9uQ3JlYXRlOiAiQCAgaWYgKCFhdXRoQm90KXtkZXN0cm95KHRoaXNCb3QpO31lbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAnRnJlZVBsYXknIHx8IGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09IHVuZGVmaW5lZCl7ZGVzdHJveSh0aGlzQm90KTt9OyB0YWdzLmxhYmVsID0gJ2VkaXQgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIHByb21wdCc7IHRhZ3MuZ3B0Qm90ID0gZ2V0TGluayhnZXRCb3QoJ3N5c3RlbScsICdhYi5hY3Rpb24uYXNrJykpOyIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgIG9uQ2xpY2s6ICJAIGxpbmtzLmdwdEJvdC5lZGl0UHJvbXB0KCk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNwogICAgfSwKICAgIHsKICAgICAgICBsYWJlbDogImdyaWQgc25hcCIsCiAgICAgICAgb25DcmVhdGU6ICJAIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJyIsCiAgICAgICAgb25DbGljazogIkAgbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGU7dGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDgKICAgIH0sCiAgICB7CiAgICAgICAgbGFiZWw6ICJib3Qgc25hcCIsCiAgICAgICAgb25DcmVhdGU6ICJAIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsCiAgICAgICAgb25DbGljazogIkAgbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlOyB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA5CiAgICB9LAogICAgewogICAgICAgIGxhYmVsOiAiYWNjb3VudCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJiYWRnZSIsCiAgICAgICAgb25DbGljazogIkAgb3Muc2hvd0FjY291bnRJbmZvKCk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAKICAgIH0sCiAgICB7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJ0ZXN0cyIsCiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdGVzdCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJzY2llbmNlIiwKICAgICAgICBvbktleURvd246ICJAICIsCiAgICAgICAgb25LZXlVcDogIkAgIiwKICAgICAgICBvbkNsaWNrOiAiQCBsZXQgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoJ2tleWJvYXJkJywgJ1NoaWZ0Jyk7bGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTtzaG91dCgnYWJSZWNvcmRUZXN0Jyk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMQogICAgfSwKICAgIHsKICAgICAgICBhYkVudmlyb25tZW50R2F0ZTogInRlc3RzIiwKICAgICAgICBsYWJlbDogInJlY29yZCB0cmFjZSIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJ0aW1lbGluZSIsCiAgICAgICAgb25LZXlEb3duOiAiQCAiLAogICAgICAgIG9uS2V5VXA6ICJAICIsCiAgICAgICAgb25DbGljazogIkAgbGV0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCdrZXlib2FyZCcsICdTaGlmdCcpO2xldCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7c2hvdXQoJ2FiUmVjb3JkVHJhY2UnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEyCiAgICB9LAogICAgewogICAgICAgIG9uQ3JlYXRlOiBgQAogICAgICAgICAgICB0YWdzLmxhYmVsID0gInBlcm1hbmVudGx5IGRlbGV0ZSAiICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKICAgICAgICAgICAgdGFncy5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29udHJhc3RDb2xvciA/PyAiI0Q5MzAzMCI7CiAgICAgICAgYCwKICAgICAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgICAgICBvbkNsaWNrOiBgQAogICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwoKICAgICAgICAgICAgY29uc3QgYWJCb3RzID0gZ2V0Qm90cygoYikgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbSAmJgogICAgICAgICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0uc3RhcnRzV2l0aCgnYWInKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBjb25maXJtZWQgPSBhd2FpdCBvcy5zaG93Q29uZmlybSh7CiAgICAgICAgICAgICAgICB0aXRsZTogJ1Blcm1hbmVudGx5IGRlbGV0ZSAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlICcgKyAgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgZnJvbSAnICsgbGlua3MubGVhcm4udGFncy5hYkluc3QgKyAnPyBUaGlzIGlzIG5vdCByZXZlcnNpYmxlIScsCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KGFiQm90cyk7CiAgICAgICAgICAgIH0KICAgICAgICBgLAogICAgICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwMAogICAgfQpdCgpyZXR1cm4gb3B0aW9uczsnAMbJ/hm8Yx5hYkNyZWF0ZVRvb2xib3hEcm9wZG93bk9wdGlvbnMCBADGyf4Z9akCxAxAY29uc3QgdG9vbGJveFRvb2xzID0gWy4uLnRoYXQudG9vbEFycmF5XSA/PyBbXTsNCmNvbnN0IHRvb2xib3hOYW1lID0gdGhhdC50b29sYm94TmFtZSA/PyAiS2l0ICI7DQpjb25zdCB0b29sYm94ID0gdGhhdC50b29sYm94Ow0KY29uc3QgZ3JpZEluZm9ybWF0aW9uID0gKHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiAmJiB0aGF0Py5ncmlkSW5mb3JtYXRpb24gIT0gdW5kZWZpbmVkKSA/IHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiA6IGFiUmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsNCg0KY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy50b29sYm94ID0gZ2V0TGluayh0b29sYm94KTsNCm1lbnVPcHRpb25zLmdyaWRJbmZvcm1hdGlvbiA9IGdyaWRJbmZvcm1hdGlvbjsNCm1lbnVPcHRpb25zLnNlYXJjaCA9IHRhZ3Muc2VhcmNoOw0KLy9tZW51T3B0aW9ucy5mb3JtQWRkcmVzcyA9ICJoYXJkd2FyZSI7DQoNCmlmICh0b29sYm94VG9vbHMubGVuZ3RoID09PSAwKSB7DQogICAgY29uc3QgbWVzc2FnZSA9IHRvb2xib3hOYW1lICsgIiBkb2VzIG5vdCBoYXZlIGFueSB0b29scyBsaXN0ZWQgaW4gdGhlIHRvb2xfYXJyYXkgdGFnIjsNCg0KICAgIGFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgbWVzc2FnZSk7DQogICAgb3MudG9hc3QobWVzc2FnZSwgNSk7DQogICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsNCn0NCg0KZm9yIChsZXQgdG9vbCBvZiB0b29sYm94VG9vbHMpIHsNCiAgICBjb25zdCB0b29sQnV0dG9uID0gew0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgbGFiZWw6IHRvb2wubmFtZSwNCiAgICAgICAgdGFyZ2V0QUI6IHRvb2wudGFyZ2V0QUIsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgc291cmNlRXZlbnQ6ICd0b29sJywNCiAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB0YWdzLmdyaWRJbmZvcm1hdGlvbg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgIGAsDQogICAgfTsNCg0KICAgIGlmICh0b29sLmZvcm1BZGRyZXNzKSB7DQogICAgICAgIHRvb2xCdXR0b24uZm9ybUFkZHJlc3MgPSB0b29sLmZvcm1BZGRyZXNzOw0KICAgIH0NCg0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHRvb2xCdXR0b24pOw0KfQ0KDQpyZXR1cm4gZHJvcGRvd25PcHRpb25zOwA="}]}