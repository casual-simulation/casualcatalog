{"version":2,"updates":[{"id":0,"timestamp":1759859241798,"update":"AewBkqfZ6QIAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwCSp9npAgAKYWJJRE9yaWdpbgIEAJKn2ekCAQ10b29sYm94X3NraWxsJwCSp9npAgALYWJJbnRlcmZhY2UCBACSp9npAg8EdHJ1ZScAkqfZ6QIAC2Rlc2NyaXB0aW9uAgQAkqfZ6QIUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwCSp9npAgAEZm9ybQIEAJKn2ekCPgdub3RoaW5nJwCSp9npAgAEbWVudQIEAJKn2ekCRijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCSp9npAgAGc3lzdGVtAgQAkqfZ6QJtFGFiLmludGVyZmFjZS50b29sYm94JwCSp9npAgAKYWJJRFN0dWRpbwIEAJKn2ekCggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwCSp9npAgAIcmVtZW1iZXICBACSp9npAqcBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJKn2ekCAAt0b29sYm94X2FkZAIEAJKn2ekCzgHlC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgiYmFzZVNraWxsIiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIG1lbnVCb3Qub25Qb2ludGVyVXAoKTsKICAgICAgICBhd2FpdCBvcy5zbGVlcCgyMDApOwogICAgICAgIG1lbnVCb3Qub25DbGljaygpOwogICAgfQp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVBY3Rpb24pIHsKICAgIGFjdGl2ZVRvb2xib3guYWJHcmlkTWVudUFjdGlvbih7IGdyaWRJbmZvcm1hdGlvbjogZ3JpZERhdGEgfSk7Cn0KZWxzZSBpZiAoYWN0aXZlVG9vbGJveCAmJiBhY3RpdmVUb29sYm94LnRhZ3MuYWJDb3JlTWVudUFjdGlvbikgewogICAgLy9SRUZSRVNIIEFORCBUSEVOIE9QRU4/Pz8KfScAkqfZ6QIABWxlYXJuAgQAkqfZ6QK0DSjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCSp9npAgAFc3RvcmUCBACSp9npAtsNKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAJKn2ekCAAZzZWFyY2gCBACSp9npAoIOKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAJKn2ekCAAhhYklnbm9yZQIEAJKn2ekCqQ4EdHJ1ZScAkqfZ6QIACWFiVmVyc2lvbgIEAJKn2ekCrg4FMTAuMjMnAJKn2ekCAA1tYW5pZmVzdGF0aW9uAgQAkqfZ6QK0Dijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCSp9npAgAQYWJHcmlkTWVudUFjdGlvbgIEAJKn2ekC2w65C0AvLyBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKLy8gY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCi8vIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAovLyAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKLy8gICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwovLyBgOwovLyB0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACi8vICAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewovLyAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7Ci8vICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7Ci8vICAgICB9Ci8vIGA7Ci8vIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IGBACi8vICAgICB0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKLy8gICAgIHRoaXNCb3QubWFza3Mub25LZXlEb3duID0gbnVsbDsKLy8gICAgIHRoaXNCb3QubWFza3MuYWJNZW51UmVmcmVzaCA9IG51bGw7Ci8vIGA7CgovLyBjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKLy8gY29uc3QgbWVudUJvdCA9IHt9OwoKLy8gbWVudUJvdC5hYk1lbnUgPSB0cnVlOwovLyBtZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Ci8vIG1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwovLyBtZW51Qm90Lm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwovLyBtZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOwovLyBtZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247Ci8vIG1lbnVCb3Qub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIudG9vbGJveF9hZGQoe3Rvb2xib3hEYXRhOiB0YWdzLnRvb2xib3hfZGF0YSwgZ3JpZERhdGE6IHRhZ3MuZ3JpZERhdGF9KTsgc2hvdXQoImFiTWVudVJlZnJlc2giKTtgOwoKLy8gZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykKLy8gewovLyAgICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOwovLyAgICAgY29uc3QgZXh0YW50Qm90ID0gYWN0aXZlVG9vbGJveC5zdHVkaW8gPyBnZXRCb3QoImFiSURPcmlnaW4iLCBhY3RpdmVUb29sYm94Lm5hbWUpOiBnZXRCb3QoYWN0aXZlVG9vbGJveC5uYW1lLCB0cnVlKTsKCi8vICAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7Ci8vICAgICBtZW51Qm90LmxhYmVsID0gYWN0aXZlVG9vbGJveC50aXRsZSA/PyBhY3RpdmVUb29sYm94Lm5hbWU7CgovLyAgICAgaWYgKCFleHRhbnRCb3QpCi8vICAgICB7Ci8vICAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJvdCk7Ci8vICAgICB9Ci8vIH0nAJKn2ekCABRhYkdyaWRNZW51T25HZW5lcmF0ZQIEAJKn2ekClRriAkBjb25zdCB0b29sYm94QXJyYXkgPSBhYlJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKCmxldCBhbGxUb29sc0xvYWRlZCA9IHRydWU7Cgpmb3IgKGxldCBpID0gMDsgaSA8IHRvb2xib3hBcnJheS5sZW5ndGg7IGkrKykgewogICAgY29uc3QgY3VycmVudFRvb2wgPSB0b29sYm94QXJyYXlbaV0ubmFtZTsKCiAgICBpZiAoIWdldEJvdCgiYWJJRE9yaWdpbiIsIGN1cnJlbnRUb29sKSAmJiAhZ2V0Qm90KGN1cnJlbnRUb29sLCB0cnVlKSkgewogICAgICAgIGFsbFRvb2xzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChhbGxUb29sc0xvYWRlZCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfScAkqfZ6QIADmFiR3JpZE1lbnVJY29uAgQAkqfZ6QL4HApsb2NhbF9tYWxsJwCSp9npAgAPYWJHcmlkTWVudUxhYmVsAgQAkqfZ6QKDHQ5jYXN1YWwgY2F0YWxvZycAkqfZ6QIAE2FiR3JpZE1lbnVTb3J0T3JkZXICBACSp9npApIdATMnAJKn2ekCAA9vbkFCSW5pdGlhbGl6ZWQCBACSp9npApQdKkAvLyBsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOycAkqfZ6QIADW9uU2tpbGxVcGRhdGUCBACSp9npAr8dV0BsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOw0KDQpjb25zb2xlLmxvZygiW1Rvb2xib3hdIExvYWRpbmcgY2FzdWFsIGtpdCIpOycAkqfZ6QIACnNoZWxsVXRpbHMCBACSp9npApceKPCflJc5M2Q5NjVlMC1kMjBlLTRiNDUtOGNhMC02NDkyNzNiNzEzOGMnAJKn2ekCABhhYkdyaWRNZW51T25CZWZvcmVDcmVhdGUCBACSp9npAr4e/AhAaWYgKGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSkgew0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiR3JpZE1lbnVMYWJlbCIsIGFiLmxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJDYXRhbG9nTmFtZSk7DQp9DQoNCg0KLy9ORVcNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBwb3NzaWJsZVRvb2xib3hlcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsNCg0KZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZVRvb2xib3hlcy5sZW5ndGg7IGkrKykNCnsNCiAgICBjb25zdCBtZW51Qm90ID0ge307DQoNCiAgICBtZW51Qm90LmFiTWVudSA9IHRydWU7DQogICAgbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KICAgIG1lbnVCb3QuZ3JpZERhdGEgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOw0KICAgIG1lbnVCb3QubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7DQogICAgbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsNCiAgICBtZW51Qm90Lm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247DQogICAgbWVudUJvdC5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7DQogICAgDQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7DQogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOw0KDQogICAgaWYgKCFleHRhbnRCb3QpDQogICAgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtZW51Qm90KTsNCiAgICB9DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAkqfZ6QIAEmFiR3JpZE1lbnVJdGVtVHlwZQIEAJKn2ekCuycIZHJvcGRvd24nAJKn2ekCABFkcm9wZG93blNvcnRPcmRlcgIEAJKn2ekCxCcBMycAkqfZ6QIAD2Ryb3Bkb3duT3B0aW9ucwIEAJKn2ekCxicG8J+nrFtdJwEEYm90cyQxNzQxMGQ4My03ZWVlLTRhMWUtYjYzOC02NTQ2Mzc0ZDE3YzMBJwCSp9npAssnBnN5c3RlbQIEAJKn2ekCzCcRYWIuaW50ZXJmYWNlLnNjYW4nAJKn2ekCyycEZm9ybQIEAJKn2ekC3icHbm90aGluZycAkqfZ6QLLJwthYkludGVyZmFjZQIEAJKn2ekC5icEdHJ1ZScAkqfZ6QLLJwhhYklnbm9yZQIEAJKn2ekC6ycEdHJ1ZScAkqfZ6QLLJw9vblFSQ29kZVNjYW5uZWQCBACSp9npAvAngA5AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgppZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhc2siKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKHRoYXQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5hc2spIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hc2t9KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5wYXR0ZXJufSk7CiAgICAgICAgfQogICAgICAgIAogICAgfQp9JwCSp9npAssnBXN0b3JlAgQAkqfZ6QLxNSjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCSp9npAssnBnNlYXJjaAIEAJKn2ekCmDYo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAkqfZ6QLLJxBhYkNvcmVNZW51QWN0aW9uAgQAkqfZ6QK/NjdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwCSp9npAssnD2FiQ29yZU1lbnVMYWJlbAIEAJKn2ekC9zYEc2NhbicAkqfZ6QLLJw5hYkNvcmVNZW51SWNvbgIEAJKn2ekC/DYPcXJfY29kZV9zY2FubmVyJwCSp9npAssnE2FiQ29yZU1lbnVTb3J0T3JkZXICBACSp9npAow3ATMnAJKn2ekCyycJYWJWZXJzaW9uAgQAkqfZ6QKONwUxMC4yMycBBGJvdHMkM2E2Y2I5Y2EtYjNiNC00ZDc3LTgyZjYtZmE1OWI1Mjk2ZWM5AScAkqfZ6QKUNwZzeXN0ZW0CBACSp9npApU3F2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwCSp9npApQ3CGFiSWdub3JlAgQAkqfZ6QKtNwR0cnVlJwCSp9npApQ3D2Ryb3Bkb3duT3B0aW9ucwIEAJKn2ekCsjcG8J+nrFtdJwCSp9npApQ3EmFiQ29yZU1lbnVJdGVtVHlwZQIEAJKn2ekCtzcIZHJvcGRvd24nAJKn2ekClDcRZHJvcGRvd25Tb3J0T3JkZXICBACSp9npAsA3BGF1dG8nAJKn2ekClDcYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQAkqfZ6QLFN/4gQGNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCmNvbnN0IGN1cnJlbnRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyAibWFwIiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT0gImJsdWVwcmludCIgPyAiYmx1ZXByaW50IiA6ImdyaWQiOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCi8vIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQovLyB9IGVsc2Ugew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCi8vIH0NCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTmF2aWdhdGlvbk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCg0KY29uc3QgaG9tZVdvcmxkQnV0dG9uID0gew0KICAgIC4uLm1lbnVPcHRpb25zLA0KICAgIGxhYmVsOiAiaG9tZSB3b3JsZCIsDQogICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvMzhhZThiNjk1N2Y0NDgzZDg3MTYxNDFkMWU5OGM5M2YwZTdkY2NlMTViYzVjMTIzYmQwZTllMWFiNjg3Y2MwNS5wbmcnLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIGNvbnN0IGN1cnJlbnRVUkwgPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCk7DQogICAgICAgIGNvbnN0IG9yaWdpbiA9IGN1cnJlbnRVUkwub3JpZ2luOw0KDQogICAgICAgIGxldCBuZXdVUkwgPSBuZXcgVVJMKG9yaWdpbik7DQoNCiAgICAgICAgaWYgKGFiUmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY2hhbm5lbCIsIGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb25maWdCb3QudGFncy5jb21JZCkgew0KICAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImNvbUlkIiwgY29uZmlnQm90LnRhZ3MuY29tSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm93bmVyIiwgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiAicGxheWVyIik7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJpbnN0IiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm1hcFBvcnRhbCIsICdob21lJyk7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJhc2siLCAnaG9tZScpOw0KICAgICAgICANCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgew0KICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgic3R1ZGlvIiwgdGhhdC5pZCk7IA0KICAgICAgICB9DQoNCiAgICAgICAgb3Mub3BlblVSTChuZXdVUkwuaHJlZik7DQogICAgYA0KfTsNCg0KaWYgKCFnZXRCb3QoImlzSG9tZVdvcmxkQ29yZSIsIHRydWUpICYmIGF1dGhCb3QpIHsNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lV29ybGRCdXR0b24pOw0KfQ0KDQppZiAoY3VycmVudFBvcnRhbCA9PSAnbWFwJykgew0KDQogICAgY29uc3QgaG9tZUJhc2VCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQoNCiAgICBpZiAoaG9tZUJhc2VCb3QpIHsNCiAgICAgICAgY29uc3QgaG9tZUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhvbWVCYXNlQm90LnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1L2NkMzhhZmZjMDYwNGJlYWE1ODhkYTIxYWExYmU3NTBiYjNlNzNiM2IzY2FlMjNlYjMwMzA3YzM0NDk0NDU5ZjMucG5nJywNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgY29uc3QgaG9tZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBpZiAoaG9tZUJvdCkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGhvbWVCb3QsIHsgem9vbTogMjAwMCB9KS5jYXRjaCgoKSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZUJ1dHRvbik7DQogICAgfQ0KDQogICAgY29uc3QgcGxhY2VzQXJyID0gW107DQogICAgY29uc3QgcGxhY2VzID0gZ2V0Qm90cygiaG9tZVBsYWNlIiwgdHJ1ZSk7DQogICAgZm9yIChjb25zdCBoUGxhY2Ugb2YgcGxhY2VzKSB7DQogICAgICAgIGlmIChoUGxhY2UudGFncy5ob21lQmFzZSA9PSB0cnVlKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBwbGFjZU9iaiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhQbGFjZS50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2xvY2F0aW9uX29uJywNCiAgICAgICAgICAgIHBsYWNlOiBnZXRMaW5rKGhQbGFjZSksDQogICAgICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgICAgIGlmIChsaW5rcy5wbGFjZSkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGxpbmtzLnBsYWNlLCB7IHpvb206IDIwMDAgfSkuY2F0Y2goZSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICAgICAgYA0KICAgICAgICB9DQoNCiAgICAgICAgcGxhY2VzQXJyLnB1c2gocGxhY2VPYmopOw0KICAgIH0NCg0KICAgIHBsYWNlc0Fyci5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgIGNvbnN0IG5hbWVBID0gYS5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KICAgICAgICBjb25zdCBuYW1lQiA9IGIubGFiZWwudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMDsNCiAgICB9KTsNCg0KICAgIGZvciAoY29uc3Qgc29ydGVkUGxhY2Ugb2YgcGxhY2VzQXJyKSB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHNvcnRlZFBsYWNlKTsNCiAgICB9DQoNCg0KICAgIGNvbnN0IGN1cnJlbnRMb2NhdGlvbkJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiAnY3VycmVudCBsb2NhdGlvbicsDQogICAgICAgIGZvcm1BZGRyZXNzOiAnbmVhcl9tZScsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5za2lsbEJvdC5nb1RvQ3VycmVudExvY2F0aW9uKCk7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goY3VycmVudExvY2F0aW9uQnV0dG9uKTsNCn0NCg0KaWYgKGRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPT0gMCkgew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KfSBlbHNlIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAkqfZ6QKUNxBhYkNvcmVNZW51QWN0aW9uAgQAkqfZ6QLEWANALy8nAJKn2ekClDcLYWJJbnRlcmZhY2UCBACSp9npAshYBHRydWUnAJKn2ekClDcPYWJDb3JlTWVudUxhYmVsAgQAkqfZ6QLNWAlwbGFjZSBuYXYnAJKn2ekClDcEZm9ybQIEAJKn2ekC11gHbm90aGluZycAkqfZ6QKUNxNnb1RvQ3VycmVudExvY2F0aW9uAgQAkqfZ6QLfWIAEQGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgb3MuZ2V0R2VvbG9jYXRpb24oKTsNCg0KaWYgKGxvY2F0aW9uLnN1Y2Nlc3MpIHsNCiAgICBjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCiAgICBjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCg0KICAgIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IGN1cnJlbnREaW07DQogICAgfQ0KDQogICAgb3MuZm9jdXNPbih7eDogbG9jYXRpb24ubG9uZ2l0dWRlLCB5OiBsb2NhdGlvbi5sYXRpdHVkZX0sIHtwb3J0YWw6ICdtYXAnLCB6b29tOiAyMDAwfSk7DQp9IGVsc2Ugew0KICAgIG9zLnRvYXN0KCJMb2NhdGlvbiBzZXJ2aWNlcyBub3QgYXZhaWxhYmxlIikNCn0nAJKn2ekClDcJYWJWZXJzaW9uAgQAkqfZ6QLgXAUxMC4yMycBBGJvdHMkNDkzZmZhNGQtNDZkNC00YTk4LWFlOWMtMTIxMmQ2NTExMzNmAScAkqfZ6QLmXAZzeXN0ZW0CBACSp9npAudcFGFiLmludGVyZmFjZS52ZXJzaW9uJwCSp9npAuZcDW9uU2tpbGxVcGRhdGUCBACSp9npAvxcpwFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJJbnRlcmZhY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiSW50ZXJmYWNlTWlub3JWZXJzaW9uOw0KDQpjb25zb2xlLmxvZygiW0FCSW50ZXJmYWNlXSBMb2FkZWQgQUIgSW50ZXJmYWNlIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAkqfZ6QLmXBdhYkludGVyZmFjZU1ham9yVmVyc2lvbgIEAJKn2ekCpF4BMicAkqfZ6QLmXBdhYkludGVyZmFjZU1pbm9yVmVyc2lvbgIEAJKn2ekCpl4CMTAnAJKn2ekC5lwIYWJJZ25vcmUCBACSp9npAqleBHRydWUnAJKn2ekC5lwEZm9ybQIEAJKn2ekCrl4Hbm90aGluZycAkqfZ6QLmXAthYkludGVyZmFjZQIEAJKn2ekCtl4EdHJ1ZScAkqfZ6QLmXAlhYlZlcnNpb24CBACSp9npArteBTEwLjIzJwEEYm90cyQ0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYBJwCSp9npAsFeBnN5c3RlbQIEAJKn2ekCwl4TYWIuaW50ZXJmYWNlLm51Z2dldCcAkqfZ6QLBXgRmb3JtAgQAkqfZ6QLWXgdub3RoaW5nJwCSp9npAsFeC2FiSW50ZXJmYWNlAgQAkqfZ6QLeXgR0cnVlJwCSp9npAsFeCGFiSWdub3JlAgQAkqfZ6QLjXgR0cnVlJwCSp9npAsFeDGFiTG9hZE51Z2dldAIEAJKn2ekC6F6YAkBsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0TmFtZTsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK251Z2dldE5hbWU7CmxldCBsb2FkZWROdWdnZXQgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGZvcm1hdHRlZE51Z2dldEFCLCBhYlZlcnNpb246IHRoYXQudmVyc2lvbiwgcmV0dXJuVHlwZTogImRhdGEifSk7Cgpsb2FkZWROdWdnZXQgPSBsb2FkZWROdWdnZXQuc3RhdGVbbnVnZ2V0TmFtZV0ubnVnZ2V0OwoKcmV0dXJuIGxvYWRlZE51Z2dldDsnAJKn2ekCwV4PYWJQdWJsaXNoTnVnZ2V0AgQAkqfZ6QKBYYwDQC8vc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6ICJudWdOYW1lIiwgZGF0YTogZGF0YX0pOyAgQUREIEVHRyBJRCBFVkVOVFVBTExZCmxldCB0ZXN0TnVnZ2V0ID0gdGhhdC5kYXRhOwpsZXQgZm9ybWF0dGVkTnVnZ2V0ID0ge2lkOiB0aGF0Lm51ZywgbnVnZ2V0OiB0ZXN0TnVnZ2V0fTsKbGV0IHRlc3ROdWdnZXROYW1lID0gdGhhdC5udWc7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIit0ZXN0TnVnZ2V0TmFtZTsKCm1hc2tzLm51Z2dldFRvUHVibGlzaCA9IGZvcm1hdHRlZE51Z2dldEFCOwoKbGlua3Muc3RvcmUuYWJQdWJsaXNoQUIoe2FiOiBmb3JtYXR0ZWROdWdnZXRBQiwgdGFyZ2V0OiBmb3JtYXR0ZWROdWdnZXQsIHNvdXJjZUV2ZW50OiAncHVibGlzaF9udWdnZXQnfSk7JwCSp9npAsFeD2ltcGxlbWVudE51Z2dldAIEAJKn2ekCjmSxB0BsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0OwpsZXQgbnVnZ2V0VmVyc2lvbkNoZWNrID0gbnVnZ2V0TmFtZS5pbmRleE9mKCIudiIpOwpsZXQgdmVyc2lvbjsKCmlmIChudWdnZXRWZXJzaW9uQ2hlY2sgIT0gLTEpCnsKICAgIG51Z2dldE5hbWUgPSBudWdnZXROYW1lLnN1YnN0cmluZygwLCBudWdnZXRWZXJzaW9uQ2hlY2spOwoKICAgIGxldCB2ZXJzaW9uQ2hlY2sgPSB0aGF0Lm51Z2dldC5zdWJzdHJpbmcobnVnZ2V0VmVyc2lvbkNoZWNrICsgMik7CgogICAgaWYgKGlzTmFOKHZlcnNpb25DaGVjaykpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2codmVyc2lvbkNoZWNrLCAidmVyc2lvbiBpcyBub3QgYSBudW1iZXIiKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB2ZXJzaW9uID0gTnVtYmVyKHZlcnNpb25DaGVjayk7CiAgICB9Cn0KY29uc29sZS5sb2cobnVnZ2V0TmFtZSwgdmVyc2lvbik7CmxldCBudWdEYXRhID0gYXdhaXQgdGhpc0JvdC5hYkxvYWROdWdnZXQoe251Z2dldE5hbWU6IG51Z2dldE5hbWUsIHZlcnNpb246IHZlcnNpb259KTsKCmlmIChudWdEYXRhID09ICJhYklEIG5vdCBmb3VuZCIpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgbm90IGZvdW5kIik7Cn0KZWxzZQp7CiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKICAgIGxldCB0YXJnZXRUYWcgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS50b1N0cmluZygpOwogICAgbGV0IHRhcmdldE51ZyA9ICJ7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRUYWcuaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKICAgIGluc2VydFRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCBudWdEYXRhKTsKfScAkqfZ6QLBXgxudWdnZXRCdXR0b24CBACSp9npAsBr9QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnAJKn2ekCwV4LbnVnZ2V0UGFyc2UCBACSp9npArR4pw9AY29uc3Qgb3JpZ2luYWxUYWdWYWx1ZSA9IHRoYXQuZWRpdGVkQm90LnJhd1t0aGF0LmVkaXRlZFRhZ107CmxldCB0YWdWYWx1ZSA9IG9yaWdpbmFsVGFnVmFsdWU7CgppZiAoIXRhZ1ZhbHVlKSAKewogICAgcmV0dXJuOwp9CmVsc2UgaWYgKHR5cGVvZiB0YWdWYWx1ZSAhPT0gInN0cmluZyIpIAp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnRvU3RyaW5nKCk7Cn0KCmxldCBpbml0aWFsUG9zc2libGVOdWdQb3MgPSAwOwoKaWYgKGluaXRpYWxQb3NzaWJsZU51Z1BvcyA9PSAtMSkgCnsKICAgIHJldHVybjsKfQplbHNlCnsKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxQb3NzaWJsZU51Z1Bvcyk7Cn0KCmxldCBwb3NzaWJsZU51Z3MgPSBvcmlnaW5hbFRhZ1ZhbHVlLnJlcGxhY2UoL1tee10vZywgIiIpLmxlbmd0aDsKbGV0IHRvdGFsTnVnQnJlYWtzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwpsZXQgYnJlYWtMZXZlbCA9IDA7CmxldCBudWdzVG9DaGVjayA9IFtdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZU51Z3M7IGkrKykKewogICAgbGV0IGluaXRpYWxOdWdQb3MgPSB0YWdWYWx1ZS5pbmRleE9mKCJ7IikgKyAxOwogICAgbGV0IHBvc3NpYmxlTnVnRW5kID0gdGFnVmFsdWUuaW5kZXhPZigifSIpOwogICAgbGV0IHBvc3NpYmxlTnVnID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MsIHBvc3NpYmxlTnVnRW5kKTsKCiAgICBpZiAocG9zc2libGVOdWcuaW5kZXhPZigiICIpID09IC0xICYmIC9cbi9nLnRlc3QocG9zc2libGVOdWcpICE9IHRydWUgJiYgcG9zc2libGVOdWcubGVuZ3RoID4gMCAmJiBwb3NzaWJsZU51Zy5pbmRleE9mKCI6IikgPT0gLTEpCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ7Iitwb3NzaWJsZU51ZysifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwogICAgICAgIGxldCBwdWJsaXNoQ2hlY2sgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDYsIGluaXRpYWxOdWdQb3MgLSAyKTsKICAgICAgICBsZXQgbnVnUHVibGlzaCA9IG51bGw7CgogICAgICAgIGlmIChwdWJsaXNoQ2hlY2sgPT0gIi5udWciKQogICAgICAgIHsKICAgICAgICAgICAgbnVnUHVibGlzaCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgICAgICAKICAgICAgICAvL0NIRUNLIElGICQgYmVmb3JlIG51Z2dldAogICAgICAgIGlmICh0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDIsIGluaXRpYWxOdWdQb3MgLSAxKSAhPSAiJCIpCiAgICAgICAgewogICAgICAgICAgICBudWdzVG9DaGVjay5wdXNoKHtudWdOYW1lOiBwb3NzaWJsZU51ZywgbnVnU3RhcnQ6IG51Z0JyZWFrcyArIDEsIG51Z1B1Ymxpc2g6IG51Z1B1Ymxpc2h9KTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ9IikpLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CgogICAgICAgIGJyZWFrTGV2ZWwgKz0gbnVnQnJlYWtzOwoKICAgICAgICBudWdCcmVha3MgPSB0b3RhbE51Z0JyZWFrcyAtICh0b3RhbE51Z0JyZWFrcyAtIGJyZWFrTGV2ZWwpOwogICAgfQoKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKHBvc3NpYmxlTnVnRW5kICsgMSk7Cn0KCnRoaXNCb3QubnVnZ2V0QnV0dG9uKHsgbnVnZ2V0OiBudWdzVG9DaGVjaywgYm90OiB0aGF0LmVkaXRlZEJvdCwgdGFnOiB0aGF0LmVkaXRlZFRhZywgdGFnVmFsdWU6IG9yaWdpbmFsVGFnVmFsdWV9KTsnAJKn2ekCwV4Nb25BQlB1Ymxpc2hlZAIEAJKn2ekC3IcBwQFAY29uc29sZS5sb2codGhhdC5hYiwgdGFncy5udWdnZXRUb1B1Ymxpc2gpCgppZiAodGhhdC5hYiA9PSB0YWdzLm51Z2dldFRvUHVibGlzaCkKewogICAgb3MudG9hc3QoIm51Z2dldCBwdWJsaXNoZWQiKTsKCiAgICBtYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBudWxsOwoKICAgIGNvbmZpZ0JvdC5tYXNrcy5hYlZlcnNpb24gPSBudWxsOwp9JwCSp9npAsFeEG9uQW55Qm90c0NoYW5nZWQCBACSp9npAp6JAbcEQGlmIChjb25maWdCb3QgJiYgdGhhdFswXS5ib3QuaWQgIT0gdGhpc0JvdC5pZCkgCnsKICAgIGlmICghY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdCkgcmV0dXJuOyAvLyBJZ25vcmUgaWYgdGhlIGNvbmZpZ0JvdCBpc24ndCByZWFkeSB5ZXQuCgogICAgY29uc3QgZWRpdGVkQm90SUQgPSBjb25maWdCb3QudGFncy5lZGl0aW5nQm90LnJlcGxhY2UoIvCflJciLCAiIik7CgogICAgaWYgKCF0aGF0LmZpbmQoeCA9PiB4LmJvdC5pZCA9PSBlZGl0ZWRCb3RJRCkpIHJldHVybjsgLy8gSWYgdGhlIGJvdCBjaGFuZ2VkIHdhc24ndCBiZWluZyBlZGl0ZWQgYnkgdGhlIHVzZXIgaWdub3JlIGl0LgoKICAgIGNvbnN0IGVkaXRlZFRhZyA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdUYWc7CiAgICBjb25zdCBlZGl0ZWRCb3QgPSBnZXRCb3QoImlkIiwgZWRpdGVkQm90SUQpOwoKICAgIGlmIChlZGl0ZWRCb3QgJiYgZWRpdGVkVGFnKSAKICAgIHsKICAgICAgICBzaG91dCgibnVnZ2V0UmVzZXQiKTsKCiAgICAgICAgdGhpc0JvdC5udWdnZXRQYXJzZSh7IGVkaXRlZEJvdCwgZWRpdGVkVGFnIH0pOwogICAgfQp9JwCSp9npAsFeCG9uQ3JlYXRlAgQAkqfZ6QLUjQFMQHRhZ3MubGlzdGVuaW5nID0gZmFsc2U7CgovL3NldFRhZ01hc2sodGhpc0JvdCwgImxpc3RlbmluZyIsIHRydWUsICJsb2NhbCIpOycAkqfZ6QLBXg1wYWNrYWdlTnVnZ2V0AgQAkqfZ6QKhjgH4BkBjb25zdCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwpjb25zdCB0YWdUZXh0ID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ107CgppZiAoY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleCB8fCBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleCkKewogICAgbGV0IHN0YXJ0UG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleDsKICAgIGxldCBlbmRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleDsKCiAgICBpZiAoc3RhcnRQb3MgPT0gZW5kUG9zKQogICAgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2UgaWYgKHN0YXJ0UG9zID4gZW5kUG9zKQogICAgewogICAgICAgIGxldCBuZXdTdGFydFBvcyA9IGVuZFBvczsKICAgICAgICBsZXQgbmV3RW5kUG9zID0gc3RhcnRQb3M7CgogICAgICAgIHN0YXJ0UG9zID0gbmV3U3RhcnRQb3M7CiAgICAgICAgZW5kUG9zID0gbmV3RW5kUG9zOwogICAgfQoKICAgIGxldCBkYXRhID0gdGFnVGV4dC5zdWJzdHJpbmcoc3RhcnRQb3MsIGVuZFBvcyArIDEpOwoKICAgIHNob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiB0aGF0Lm51Z2dldCwgZGF0YTogZGF0YX0pOwoKICAgIG9zLnRvYXN0KCJudWcgaXMgcHVibGlzaGluZyIsIDEwKTsKCiAgICBsZXQgdGFyZ2V0TnVnID0gIi5udWcgeyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10uaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJjYW5ub3QgcmVhZCBudWdnZXQgdG8gYmUgcHVibGlzaGVkIikKfScAkqfZ6QLBXghyZW1lbWJlcgIEAJKn2ekCmpUBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJKn2ekCwV4Gc2VhcmNoAgQAkqfZ6QLBlQEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAkqfZ6QLBXgVzdG9yZQIEAJKn2ekC6JUBKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAJKn2ekCwV4JbGlzdGVuaW5nAgQAkqfZ6QKPlgEFZmFsc2UnAJKn2ekCwV4JYWJWZXJzaW9uAgQAkqfZ6QKVlgEFMTAuMjMnAQRib3RzJGIzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYgEnAJKn2ekCm5YBGWFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3ICBACSp9npApyWAc4MQGNvbnN0IHsKICAgIGxhYmVsID0gYCR7YWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fSBpcyB3b3JraW5nYCwKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge30KCmxldCBidXN5SW5kaWNhdG9yID0gewogICAgb25Qb2ludGVyVXA6IG51bGwsCiAgICBvblBvaW50ZXJEb3duOiBudWxsLAogICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgIGJ1c3lMYWJlbDogbGFiZWwsCiAgICBsYWJlbEFsaWdubWVudDogJ2xlZnQnLAogICAgc3RhdGU6IDAsCiAgICBhbmltU3RhdGVzOiBbCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJycsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgIF0sCiAgICBhbmltUmF0ZTogNTAwLAogICAgb25Cb3RBZGRlZDogYEAKICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgb25Cb3RDaGFuZ2VkOiBgQAogICAgICAgIGNvbnN0IG5lZWRSZWZyZXNoID0gdGhhdC50YWdzLnNvbWUodCA9PiB0ID09PSAnYnVzeUxhYmVsJyB8fCB0ID09PSAnc3RhdGUnIHx8IHQgPT09ICdhbmltU3RhdGVzJyk7CiAgICAgICAgaWYgKG5lZWRSZWZyZXNoKSB7CiAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB9CiAgICBgLAogICAgcmVmcmVzaERpc3BsYXk6IGBACiAgICAgICAgaWYgKHRhZ3MuYW5pbVN0YXRlcyAmJiB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBhbmltU3RhdGUgPSB0YWdzLmFuaW1TdGF0ZXNbdGFncy5zdGF0ZV07CgogICAgICAgICAgICB0YWdzLmxhYmVsID0gdGFncy5idXN5TGFiZWwudHJpbSgpICsgYW5pbVN0YXRlLmVsbGlwc2lzOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYW5pbVN0YXRlLmZvcm1BZGRyZXNzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3MubGFiZWwgCiAgICAgICAgfQogICAgYCwKICAgIGFuaW1hdGU6IGBACiAgICAgICAgaWYgKHRhZ3Muc3RhdGUgPj0gdGFncy5hbmltU3RhdGVzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSArPSAxOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgb3Muc2xlZXAodGFncy5hbmltUmF0ZSk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgLi4ucmVzdAp9OwoKY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKGJ1c3lJbmRpY2F0b3IpOwoKcmV0dXJuIG1lbnVCb3Q7JwCSp9npApuWAQZzeXN0ZW0CBACSp9npAuuiARFhYi5pbnRlcmZhY2UubWVudScAkqfZ6QKblgEEZm9ybQIEAJKn2ekC/aIBB25vdGhpbmcnAJKn2ekCm5YBC2Rlc2NyaXB0aW9uAgQAkqfZ6QKFowEmVGhpcyBza2lsbCBpcyBkZXNpZ25lZCBmb3IgbWVudSBzdHVmZi4oAJKn2ekCm5YBC2FiSW50ZXJmYWNlAXgnAJKn2ekCm5YBCmFiT3Blbk1lbnUCBACSp9npAq2jAf0aQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IG1lbnVUeXBlID0gdGhhdCA/ICJhYiIgKyB0aGF0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhhdC5zbGljZSgxKSArICJNZW51IjogImFiQ29yZU1lbnUiOyAvL3NldCB1cCBhIGNoZWNrIHRvIHNlZSB3aGF0IHR5cGUgb2YgbWVudSBzaG91bGQgYmUgb2NjdXJpbmcgW2NvcmUsIGJvdCwgZ3JpZCwgaW5zdF0KbGV0IG1lbnVTa2lsbHMgPSBnZXRCb3RzKG1lbnVUeXBlICsgIkFjdGlvbiIpOwpsZXQgbWF4T3B0aW9ucyA9IG1lbnVUeXBlID09ICJpbnN0IiA/IDcgOiA1OwpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmJhc2VTa2lsbC4ke21lbnVUeXBlICsgIkFjdGlvbiJ9KHtib3Q6IHRoaXNCb3R9KTtgOwoKbGV0IHNvcnRPcmRlckluZGV4ID0gbWVudVNraWxscy5sZW5ndGg7CmZvciAobGV0IGkgPSAwOyBpIDwgbWVudVNraWxscy5sZW5ndGg7IGkrKykvL0FERCBMT0dJQyBGT1IgTU9SRSBPUFRJT05TIFRIQU4gNSA6IG1heE9wdGlvbnMKewogICAgLy9BbGxvd3MgZm9yIGNvZGUgdG8gZ2V0IGNhbGxlZCBiZWZvcmUgdGhlIG1lbnUgZ2VuZXJhdGVzLCB1c2VmdWwgZm9yIGR5bmFtaWNhbGx5IHNldCBncm91cHMgb3IgZHJvcGRvd25zCiAgICBpZiAobWVudVNraWxsc1tpXS50YWdzW21lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIl0pIHsKICAgICAgICBhd2FpdCB3aGlzcGVyKG1lbnVTa2lsbHNbaV0sIG1lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIik7CiAgICB9IAoKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiSGlkZSJdKSB7CiAgICAgICAgY29udGludWU7CiAgICB9CiAgICAKICAgIGxldCBjdXJyZW50U2tpbGwgPSBtZW51U2tpbGxzW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5iYXNlU2tpbGwgPSAi8J+UlyIgKyBjdXJyZW50U2tpbGwuaWQ7CiAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJMYWJlbCJdOwogICAgYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSWNvbiJdOwogICAgYWJNZW51QnV0dG9uLm9uQ3JlYXRlID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiT25HZW5lcmF0ZSJdOwogICAgYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIlNvcnRPcmRlciJdOwogICAgYWJNZW51QnV0dG9uLmNvbG9yID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA/IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkNvbG9yIl0gOiBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcjsKCiAgICBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiZHJvcGRvd24iKSB7CiAgICAgICAgYWJNZW51QnV0dG9uLmRyb3Bkb3duT3B0aW9ucyA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duT3B0aW9uczsKCiAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duU29ydE9yZGVyID09ICJhdXRvIikgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZHJvcGRvd25Tb3J0T3JkZXIgPSBzb3J0T3JkZXJJbmRleDsKICAgICAgICAgICAgKytzb3J0T3JkZXJJbmRleDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZHJvcGRvd25Tb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFncy5kcm9wZG93blNvcnRPcmRlcjsKICAgICAgICB9CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bihhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJncm91cCIpIHsKICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyID09ICJhdXRvIikgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBzb3J0T3JkZXJJbmRleDsKICAgICAgICAgICAgKytzb3J0T3JkZXJJbmRleDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFncy5ncm91cFNvcnRPcmRlcjsKICAgICAgICB9CiAgICAgICAgYWJNZW51QnV0dG9uLm1lbnVJdGVtcyA9IGN1cnJlbnRTa2lsbC50YWdzLm1lbnVJdGVtczsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUdyb3VwKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImlucHV0IikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAidGV4dCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRleHQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAidG9vbCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2woYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAid2l6YXJkIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKGFiTWVudUJ1dHRvbik7CiAgICB9Cn0KCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBgQAogICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwpgOwp0aGlzQm90Lm1hc2tzLm9uS2V5RG93biA9IGBACiAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdFc2NhcGUnKSkgewogICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CiAgICB9CmA7CgpzaG91dCgnb25BQk9wZW5NZW51JywgeyBtZW51OiB0aGF0LCBtZW51VHlwZSwgbWVudVBvcnRhbDogY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgfSk7JwCSp9npApuWARJhYkNyZWF0ZU1lbnVCdXR0b24CBACSp9npAqm+AfgNQGxldCBuZXdNZW51QnV0dG9uID0ge307CgpsZXQgewogICAgbWVudUl0ZW1TdHlsZSA9IHt9LAogICAgLi4uYWRkaXRpb25hbFRhZ3MKfSA9IHRoYXQgPz8ge30KCmlmICh0eXBlb2YgbWVudUl0ZW1TdHlsZSA9PSAnc3RyaW5nJykgewogICAgbWVudUl0ZW1TdHlsZSA9IG1lbnVJdGVtU3R5bGUucmVwbGFjZSgvXHV7MUY5RUN9L3UsICcnKTsgCiAgICBtZW51SXRlbVN0eWxlID0gSlNPTi5wYXJzZShtZW51SXRlbVN0eWxlKTsKfQoKZnVuY3Rpb24gaGFzQm9yZGVyU3R5bGUoKSB7CiAgICBpZiAobWVudUl0ZW1TdHlsZVsiYm9yZGVyLXRvcC1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1sZWZ0LXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLWJvdHRvbS1zdHlsZSJdIAogICAgICAgIHx8IG1lbnVJdGVtU3R5bGVbImJvcmRlci1yaWdodC1zdHlsZSJdKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwp9CgppZiAoYWRkaXRpb25hbFRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbF0pIHsKICAgIGlmIChhZGRpdGlvbmFsVGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIk1lbnVHcm91cCJdKSB7CgogICAgfQp9CgpuZXdNZW51QnV0dG9uLnNwYWNlID0gInRlbXBMb2NhbCI7Cm5ld01lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcjsKbmV3TWVudUJ1dHRvbi5sYWJlbENvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKbmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvciA9IHRoYXQuc2hhZG93Q29sb3IgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTaGFkb3dDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24uc2NhbGVZID0gMTsKCmNvbnN0IG1lbnVTdHlsaW5nID0gewogICAgImJvcmRlci1yYWRpdXMiOiI4cHgiLAogICAgIm1hcmdpbi10b3AiOiAiOHB4IiwKICAgICJib3gtc2hhZG93IjogYDNweCA0cHggJHtuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yfWAsCiAgICAibWluLWhlaWdodCI6ICI0NHB4IiwKICAgICJib3JkZXIiOiBoYXNCb3JkZXJTdHlsZSgpID8gIiIgOiBgMnB4IHNvbGlkICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIndpZHRoIjogImNhbGMoMTAwJSAtIDVweCkiLAogICAgLi4ubWVudUl0ZW1TdHlsZQp9CgpuZXdNZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBtZW51U3R5bGluZzsKCmNvbnN0IGNsaWNrZWRTdHlsaW5nID0gewogICAgLi4ubWVudVN0eWxpbmcsCiAgICAiZmlsdGVyIjogImJyaWdodG5lc3MoNjAlKSIKfQpjb25zdCBiYXNlU3R5bGUgPSBgQCBtYXNrcy5tZW51SXRlbVN0eWxlID0gJ/Cfp6wgJHtKU09OLnN0cmluZ2lmeShjbGlja2VkU3R5bGluZyl9J2AKCm5ld01lbnVCdXR0b24ub25Qb2ludGVyRG93biA9IG1lbnVJdGVtU3R5bGU/LlsibWFyZ2luLXRvcCJdICE9ICIwcHgiID8gYmFzZVN0eWxlIDogIkAgLy8iOwpuZXdNZW51QnV0dG9uLm9uUG9pbnRlclVwID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGxgOwoKZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpCnsKICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107Cn0KCm5ld01lbnVCdXR0b24gPSBjcmVhdGUobmV3TWVudUJ1dHRvbik7CgpyZXR1cm4gbmV3TWVudUJ1dHRvbjsnAJKn2ekCm5YBDWFiTWVudVJlZnJlc2gCBACSp9npAqDMAZ0BQGlmIChjb25maWdCb3QudGFncy5tZW51UG9ydGFsPy5zdWJzdHJpbmcoMCwyKSA9PSAiYWIiKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgogICAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwogICAgbWFza3Mub25LZXlEb3duID0gbnVsbDsKfScAkqfZ6QKblgEIcmVtZW1iZXICBACSp9npAr7NASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCSp9npApuWAQ1tYW5pZmVzdGF0aW9uAgQAkqfZ6QLlzQEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAkqfZ6QKblgERYWJFbnZpcm9ubWVudE1lbnUCBACSp9npAozOAbo3QHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKCmNvbnN0IGFiRW52aXJvbm1lbnRPcHRpb25zID0gdGhpc0JvdC5hYkdldEVudmlyb25tZW50T3B0aW9ucygpOwoKYnV0dG9uTG9vcDoKZm9yIChsZXQgaSA9IDA7IGkgPCBhYkVudmlyb25tZW50T3B0aW9ucy5sZW5ndGg7IGkrKykKewogICAgbGV0IGFjdGl2ZUJ1dHRvbiA9IGFiRW52aXJvbm1lbnRPcHRpb25zW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBhY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI7CgogICAgaWYgKGFjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZSkKICAgIHsKICAgICAgICBpZiAoIWxpbmtzW2FjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZV0pCiAgICAgICAgewogICAgICAgICAgICBjb250aW51ZSBidXR0b25Mb29wOwogICAgICAgIH0KICAgIH0KCiAgICBsZXQgbmV3QnV0dG9uRGF0YSA9IHsuLi5hYk1lbnVCdXR0b24sIC4uLmFjdGl2ZUJ1dHRvbn07CgogICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3QnV0dG9uRGF0YSk7Cn0KCmNvbnN0IGFiUGVyc29uYWxpdHlDb25maWdCdXR0b24gPSB7CiAgICBsYWJlbDogImN1c3RvbWl6ZTogYWIgcGVyc29uYWxpdHkiLAogICAgLi4uYWJNZW51QnV0dG9uLAogICAgYWJNZW51U29ydE9yZGVyOiAxLAogICAgZHJvcGRvd25Tb3J0T3JkZXI6IDEsCiAgICBkcm9wZG93bk9wdGlvbnM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbmFtZTogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksIHt0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgdG8gY2FsbCBtZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bmFtZTogbmFtZX0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgYWkgbW9kZWw6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWx9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgYWlNb2RlbHMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFpTW9kZWxzOwoKICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBbXTsKCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNvbXBhbnlHcm91cCBvZiBhaU1vZGVscykgewogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbW9kZWxFbnRyeSBvZiBjb21wYW55R3JvdXAubW9kZWxzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucHVzaCh7IGxhYmVsOiBtb2RlbEVudHJ5Lm1vZGVsLCB2YWx1ZTogbW9kZWxFbnRyeS5tb2RlbCB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudE1vZGVsSW5kZXggPSBvcHRpb25zLmZpbmRJbmRleChvID0+IG8udmFsdWUgPT09IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsKTsKCiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IGF3YWl0IG9zLnNob3dJbnB1dChjdXJyZW50TW9kZWxJbmRleCwgewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnd2hhdCBhaSBtb2RlbCB3b3VsZCB5b3UgbGlrZSBtZSB0byB1c2U/JywKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbGlzdCcsCiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IG9wdGlvbnMsCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRPcHRpb24gJiYgc2VsZWN0ZWRPcHRpb24udmFsdWUgIT09IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge2FpTW9kZWw6IHNlbGVjdGVkT3B0aW9uLnZhbHVlfSk7IAogICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG1lIHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHtjb2xvcjogY29sb3J9KTsgCiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYG1lbnUgY29sb3I6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VNZW51Q29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudXMgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVDb2xvcjogY29sb3J9KTsgCiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICAgICAgICAgICAgICAvL2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IgPSBjb2xvcjsgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgIT0gJ2NsZWFyJyl7bGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciA9IGNvbG9yfTsgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYG1lbnUgdGV4dCBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VMYWJlbENvbG9yLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnUgdGV4dCB0byBiZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bWVudUxhYmVsQ29sb3I6IGNvbG9yfSk7IAogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTtgLAogICAgICAgICAgICAgICAgLy9saW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yID0gY29sb3I7IGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yICE9ICdjbGVhcicpe2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgPSBjb2xvcn07IGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBkZWZhdWx0IHBvcnRhbCBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyAnIzI2MzIzOCd9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgbGV0IHBvcnRhbENvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4Jywge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB5b3VyIHBvcnRhbCB0byBsb29rIGxpa2U/J30pOwogICAgICAgICAgICAgICAgaWYgKCFwb3J0YWxDb2xvcikgewogICAgICAgICAgICAgICAgICAgIHBvcnRhbENvbG9yID0gJyMyNjMyMzgnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeydwb3J0YWxDb2xvcic6IHBvcnRhbENvbG9yfSk7IAogICAgICAgICAgICAgICAgLy9kZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICAgICAgYCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBkZWZhdWx0IG1hcCBwb3J0YWwgYmFzZW1hcGAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIHNob3V0KCJzaG93QUJCYXNlbWFwT3B0aW9ucyIpOwogICAgICAgICAgICBgCiAgICAgICAgfSwKICAgICAgICAgewogICAgICAgICAgICBsYWJlbDogImRlZmF1bHQgc2V0dGluZ3MiLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImRlbGV0ZV9mb3JldmVyIiwKICAgICAgICAgICAgY29sb3I6ICdyZWQnLAogICAgICAgICAgICBsYWJlbENvbG9yOiAnYmxhY2snLAogICAgICAgICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgICAgIG9uQ2xpY2s6IGBAIAogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeydkZWZhdWx0UGVyc29uYWxpdHknOiB0cnVlfSk7IAogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAgIGxhYmVsOiAibWVudSBjb2xvciIsCiAgICAgICAgLy8gICAgICAuLi5hYk1lbnVCdXR0b24sCiAgICAgICAgLy8gICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAvLyAgICAgICAgIGNvbnN0IG1lbnVDb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yLCB7dGl0bGU6ICd3aGF0IGNvbG9yIHdvdWxkIHlvdSBsaWtlIG15IG1lbnUncyB0byBiZT8nfSk7CiAgICAgICAgLy8gICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bWVudUNvbG9yOiBtZW51Q29sb3J9KTsgCiAgICAgICAgLy8gICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpO2AsCiAgICAgICAgLy8gfSwKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAgIGxhYmVsOiAicHJvbXB0IiwKICAgICAgICAvLyAgICAgb25DbGljazogYEBgLAogICAgICAgIC8vIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogImZvcm0iLAogICAgICAgIC8vICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAvLyAgICAgICAgIGNvbnN0IGZvcm0gPSBhd2FpdCBvcy5zaG93SW5wdXQoYWJQZXJzb25hbGl0eS50YWdzLmFiRm9ybSwge3RpdGxlOiAnd2hhdCBmb3JtIHdvdWxkIHlvdSBsaWtlIG1lIHRvIHRha2U/J30pOwogICAgICAgIC8vICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge2Zvcm06IGZvcm19KTsgCiAgICAgICAgLy8gICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpO2AsCiAgICAgICAgLy8gfQogICAgXQp9Cgp0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiUGVyc29uYWxpdHlDb25maWdCdXR0b24pOwoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCRW52aXJvbm1lbnRNZW51JywgeyBtZW51UG9ydGFsOiBjb25maWdCb3QudGFncy5tZW51UG9ydGFsfSApJwCSp9npApuWAQVsZWFybgIEAJKn2ekCx4UCKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAJKn2ekCm5YBA2dwdAIEAJKn2ekC7oUCKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAJKn2ekCm5YBCGFiSWdub3JlAgQAkqfZ6QKVhgIEdHJ1ZScAkqfZ6QKblgEGc2VhcmNoAgQAkqfZ6QKahgIo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAkqfZ6QKblgEGbnVnZ2V0AgQAkqfZ6QLBhgIo8J+UlzRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZicAkqfZ6QKblgEFdGVzdHMCBACSp9npAuiGAijwn5SXYjgzZDk3MmItMDUzNS00MDUxLWI1ODktNDFjZWRhODUzNWYxJwCSp9npApuWAQ9vblBvcnRhbENoYW5nZWQCBACSp9npAo+HAm5AaWYgKHRoYXQucG9ydGFsID09ICJzeXN0ZW1Qb3J0YWwiICYmICF0aGF0LmRpbWVuc2lvbiAmJiAhbGlua3MudGVzdHMpCnsKICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoImFiVGVzdHMiKTsKfScAkqfZ6QKblgEDYXNrAgQAkqfZ6QL+hwIo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAkqfZ6QKblgEJYWJWZXJzaW9uAgQAkqfZ6QKliAIFMTAuMjMnAJKn2ekCm5YBEWFiQ3JlYXRlTWVudUlucHV0AgQAkqfZ6QKriAKeAkBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51SW5wdXQgPSB7DQogICAgZm9ybTogImlucHV0IiwNCiAgICBtZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHk6IGZhbHNlLA0KICAgIGZvcm1JbnB1dE11bHRpbGluZTogbnVsbCwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51SW5wdXQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAJKn2ekCm5YBEGFiQ3JlYXRlTWVudVRleHQCBACSp9npAsqKAoEEQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KY29uc3Qgew0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZSwNCiAgICAuLi5yZXN0DQp9ID0gdGhhdDsNCg0KbGV0IG1lbnVUZXh0ID0gew0KICAgIGZvcm06ICJ0ZXh0IiwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIHBvaW50YWJsZTogZmFsc2UsDQogICAgY29sb3I6ICJ3aGl0ZSIsDQogICAgbWVudUl0ZW1TdHlsZTogew0KICAgICAgICAicGFkZGluZy10b3AiOiAiNnB4IiwNCiAgICAgICAgInBhZGRpbmctYm90dG9tIjogIjZweCIsDQogICAgfSwNCiAgICBtZW51SXRlbUxhYmVsU3R5bGU6IHsNCiAgICAgICAgIndoaXRlLXNwYWNlIjogInByZS13cmFwIiwNCiAgICAgICAgLi4ubWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIH0sDQogICAgLi4ucmVzdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUZXh0KTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwCSp9npApuWARBhYkNyZWF0ZU1lbnVUb29sAgQAkqfZ6QLMjgKOAUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51VG9vbCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRvb2wpOw0KDQpyZXR1cm4gbWVudUJvdDsnAJKn2ekCm5YBEmFiQ3JlYXRlTWVudVdpemFyZAIEAJKn2ekC248CkgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVdpemFyZCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVdpemFyZCk7DQoNCnJldHVybiBtZW51Qm90OycAkqfZ6QKblgEUYWJDcmVhdGVNZW51RHJvcGRvd24CBACSp9npAu6QArocQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0LmRyb3Bkb3duU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVEcm9wZG93bjogZHJvcGRvd25Tb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgb3V0ZXJNZW51QnV0dG9uID0gew0KICAgIC4uLnRoYXQsDQogICAgZm9ybUFkZHJlc3M6IHRoYXQuZm9ybUFkZHJlc3MgPz8gImFycm93X3JpZ2h0IiwNCiAgICBkcm9wZG93bk9wZW46IGZhbHNlLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIHRhZ3NbY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9ICR7dGhhdC5kcm9wZG93blNvcnRPcmRlcn0NCiAgICAgICAgaWYgKHRhZ3MuZHJvcGRvd25PcGVuID09IHRydWUpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKHRoaXNCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnModGFncy5kcm9wZG93bk9wdGlvbnMsIHRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIpOw0KICAgICAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25EZXN0cm95OiBgQA0KICAgICAgICB3aGlzcGVyKHRoaXNCb3QubGlua3MubWVudUJvdHMsICJjbGVhckRyb3Bkb3duTWVudSIpOw0KICAgIGAsDQogICAgb25Qb2ludGVyVXA6IGBADQogICAgICAgIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSBudWxsOw0KICAgICAgICBpZiAoIXRhZ3MuY3VzdG9tRm9ybUFkZHJlc3MpIHsNCiAgICAgICAgICAgIG1hc2tzLmZvcm1BZGRyZXNzID0gImFycm93X3JpZ2h0IjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gZmFsc2UpIHsNCiAgICAgICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImZvcm1BZGRyZXNzIiwgImFycm93X2Ryb3BfZG93biIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAibWVudUl0ZW1TdHlsZSIsIHsuLi50YWdzLm1lbnVJdGVtU3R5bGUsICJib3JkZXJCb3R0b21MZWZ0UmFkaXVzIjogIjAiLCAiYm9yZGVyQm90dG9tUmlnaHRSYWRpdXMiOiAiMCJ9KTsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgb25Cb3RDaGFuZ2VkOiBgQA0KICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCdkcm9wZG93bk9wZW4nKSAmJiB0YWdzLmRyb3Bkb3duT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51RHJvcGRvd25PcGVuZWQiLCB0aGlzQm90KTsNCiAgICAgICAgfQ0KICAgIGAsDQogICAgYWJNZW51RHJvcGRvd25PcGVuZWQ6IGBADQogICAgICAgIGlmICh0aGF0ICE9IHRoaXNCb3QpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIH0NCiAgICBgDQp9Ow0KDQppZiAodGhhdC5mb3JtQWRkcmVzcyAmJiB0aGF0LmZvcm1BZGRyZXNzICE9ICJhcnJvd19yaWdodCIpIHsNCiAgICBvdXRlck1lbnVCdXR0b24uY3VzdG9tRm9ybUFkZHJlc3MgPSB0cnVlOw0KfQ0Kb3V0ZXJNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSB0aGF0LmRyb3Bkb3duU29ydE9yZGVyOw0KDQpjb25zdCBtZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24ob3V0ZXJNZW51QnV0dG9uKTsNCm1lbnVCb3QudmFycy5nZW5lcmF0ZU1lbnVPcHRpb25zID0gZ2VuZXJhdGVNZW51T3B0aW9uczsNCg0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNZW51T3B0aW9ucyAob3B0aW9ucywgc29ydE9yZGVyKSB7DQogICAgY29uc3QgbWVudUJvdHMgPSBbXTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyArK2kpIHsNCg0KICAgICAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm9wdGlvbnNbaV0sDQogICAgICAgICAgICBjbGVhckRyb3Bkb3duTWVudTogYEANCiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOw0KICAgICAgICAgICAgYA0KICAgICAgICB9Ow0KDQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcihzb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDAwKTsNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9IHRydWU7DQoNCiAgICAgICAgaWYgKGkgPT0gb3B0aW9ucy5sZW5ndGggLSAxKSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIDAgOHB4IDhweCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCAwIDhweCA4cHgiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyVG9wIl0gPSAibm9uZSI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsibWFyZ2luVG9wIl0gPSAiMCI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsicGFkZGluZ0xlZnQiXSA9ICIzNXB4IjsNCg0KICAgICAgICBjb25zdCBuZXdNZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQogICAgfQ0KDQogICAgbWVudUJvdC50YWdzLm1lbnVCb3RzID0gZ2V0TGluayhtZW51Qm90cyk7DQp9DQoNCmlmICh0aGF0LmRlZmF1bHRPcGVuKSB7DQogICAgbWVudUJvdC5vblBvaW50ZXJVcCgpOw0KICAgIG1lbnVCb3Qub25DbGljaygpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdDsNCg0KJwCSp9npApuWARFhYkNyZWF0ZU1lbnVHcm91cAIEAJKn2ekCqa0C3B1ALyoNCiAgIEVYQU1QTEUNCiAgIGNvbnN0IG1lbnVHcm91cCA9IHsNCiAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgZ3JvdXBTb3J0T3JkZXI6IDEsDQogICAgICAgIG1lbnVJdGVtczogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDEiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgY29sb3I6ICJvcmFuZ2UiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMyIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgIG1lbnVJdGVtVHlwZTogImRyb3Bkb3duIiwNCiAgICAgICAgICAgICAgICBkcm9wZG93bk9wdGlvbnM6IFsNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDIiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXQ0KICAgIH0NCiovDQoNCmlmICAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICghdGhhdC5ncm91cFNvcnRPcmRlcikgew0KICAgIHRocm93IG5ldyBFcnJvcihgYWJDcmVhdGVNZW51R3JvdXA6IGdyb3VwU29ydE9yZGVyIGlzIG5vdCBwcm92aWRlZC5gKTsNCn0NCg0KbGV0IHsNCiAgICBtZW51SXRlbVN0eWxlID0ge30sDQogICAgbWVudUl0ZW1zID0gW10sDQogICAgLi4uYWRkaXRpb25hbFRhZ3MNCn0gPSB0aGF0ID8/IHt9DQoNCmNvbnN0IG1lbnVCb3RzID0gW107DQpmb3IgKGxldCBpID0gMDsgaSA8IG1lbnVJdGVtcy5sZW5ndGg7ICsraSkgew0KDQogICAgbGV0IG5ld01lbnVCdXR0b24gPSB7fTsNCg0KICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTAwKTsNCg0KICAgIGxldCBpbmRpdk1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbXNbaV0ubWVudUl0ZW1TdHlsZSA/PyB7fTsNCiAgICBsZXQgaW5kaXZNZW51VHlwZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVR5cGUgPz8gdW5kZWZpbmVkOw0KICAgIGxldCBpbmRpdkFkZGl0aW9uYWxUYWdzID0gbWVudUl0ZW1zW2ldOw0KICAgIGlmIChpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXTsNCiAgICB9DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdKSB7DQogICAgICAgIGRlbGV0ZSBpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVR5cGUiXTsNCiAgICB9DQoNCiAgICBjb25zdCBiYXNlU3R5bGluZyA9IHsNCiAgICAgICAgImJvcmRlclRvcCI6ICJub25lIiwNCiAgICAgICAgIm1hcmdpblRvcCI6ICIwIg0KICAgIH0NCg0KICAgIGlmIChpID09IG1lbnVJdGVtcy5sZW5ndGggLSAxKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4uYmFzZVN0eWxpbmcsDQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjAgMCA4cHggOHB4IiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0gZWxzZSBpZiAoaSA9PSAwKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICI4cHggOHB4IDAgMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzt9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4uYmFzZVN0eWxpbmcsDQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjAiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpDQogICAgew0KICAgICAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgdGFnIGluIGluZGl2QWRkaXRpb25hbFRhZ3MpDQogICAgew0KICAgICAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBpbmRpdkFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgbGV0IG5ld01lbnVCb3Q7DQogICAgc3dpdGNoKGluZGl2TWVudVR5cGUpIHsNCiAgICAgICAgY2FzZSAiZHJvcGRvd24iOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAuLi5uZXdNZW51QnV0dG9uLA0KICAgICAgICAgICAgICAgICAgICAiZHJvcGRvd25Tb3J0T3JkZXIiOiBOdW1iZXIodGhhdC5ncm91cFNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgImlucHV0IjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRleHQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ0b29sIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2wobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAid2l6YXJkIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBkZWZhdWx0OiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgfQ0KICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQp9DQoNCnJldHVybiBtZW51Qm90czsnAJKn2ekCm5YBC3BlcnNvbmFsaXR5AgQAkqfZ6QKGywIo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAkqfZ6QKblgEXYWJHZXRFbnZpcm9ubWVudE9wdGlvbnMCBACSp9npAq3LAuI2QGNvbnN0IG9wdGlvbnMgPSBbXTsKCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6IGBoaWRlYCwKICAgICAgICBmb3JtQWRkcmVzczogInZpc2liaWxpdHlfb2ZmIiwKICAgICAgICBvbkNsaWNrOiAiQCBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDAKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogIm9wdGltaXplIG1vZGUiLAogICAgb25DcmVhdGU6ICJAIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnIDogdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIG9uQ2xpY2s6ICJAIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSBmYWxzZSA6IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gdHJ1ZTsgdGhpc0JvdC5vbkNyZWF0ZSgpOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMQp9KQoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInNsZWVwIiwKICAgICAgICBmb3JtQWRkcmVzczogIm5pZ2h0c19zdGF5IiwKICAgICAgICBvbkNsaWNrOiAiQGxpbmtzLm1hbmlmZXN0YXRpb24uYWJTZXRBd2FrZSh7IGF3YWtlOiBmYWxzZSB9KSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDMKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoYXQiLAogICAgZm9ybUFkZHJlc3M6ICJjaGF0IiwKICAgIG9uQ2xpY2s6ICJAIHNob3V0KCdhYkNoYXRCYXJPcGVuJyk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA0Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJudWdnZXRzIiwKICAgIG9uQ3JlYXRlOiAiQCB0YWdzLm51Z01hbmFnZXIgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmludGVyZmFjZS5udWdnZXQnKSk7IGlmIChsaW5rcy5udWdNYW5hZ2VyLnRhZ3MubGlzdGVuaW5nKXt0YWdzLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgbnVsbCk7YDt0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveGA7fWVsc2V7ICAgIHRhZ3Mub25DbGljayA9IGBAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCB0cnVlLCAnbG9jYWwnKTtgOyAgICB0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveF9vdXRsaW5lX2JsYW5rYDt9IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1Cn0pCgpvcHRpb25zLnB1c2goewogICAgYWJFbnZpcm9ubWVudEdhdGU6ICJncHQiLAogICAgb25DcmVhdGU6ICJAICBpZiAoIWF1dGhCb3Qpe2Rlc3Ryb3kodGhpc0JvdCk7fWVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICdGcmVlUGxheScgfHwgYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gdW5kZWZpbmVkKXtkZXN0cm95KHRoaXNCb3QpO307IHRhZ3MubGFiZWwgPSAnZWRpdCAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgcHJvbXB0JzsgdGFncy5ncHRCb3QgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmFjdGlvbi5hc2snKSk7IiwKICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLmdwdEJvdC5lZGl0UHJvbXB0KCk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA3Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJncmlkIHNuYXAiLAogICAgb25DcmVhdGU6ICJAIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJyIsCiAgICBvbkNsaWNrOiAiQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZTt0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA4Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJib3Qgc25hcCIsCiAgICBvbkNyZWF0ZTogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZTsgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA5Cn0pCgppZiAoYXV0aEJvdCkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogImFjY291bnQiLAogICAgICAgIGZvcm1BZGRyZXNzOiAiYmFkZ2UiLAogICAgICAgIG9uQ2xpY2s6ICJAIG9zLnNob3dBY2NvdW50SW5mbygpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEwCiAgICB9KQp9CgppZiAobGlua3MudGVzdHMpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgYWJFbnZpcm9ubWVudEdhdGU6ICJ0ZXN0cyIsCiAgICAgICAgbGFiZWw6ICJyZWNvcmQgdGVzdCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJzY2llbmNlIiwKICAgICAgICBvbktleURvd246ICJAICIsCiAgICAgICAgb25LZXlVcDogIkAgIiwKICAgICAgICBvbkNsaWNrOiAiQCBsZXQgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoJ2tleWJvYXJkJywgJ1NoaWZ0Jyk7bGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTtzaG91dCgnYWJSZWNvcmRUZXN0Jyk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMQogICAgfSkKCiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgICAgIGxhYmVsOiAicmVjb3JkIHRyYWNlIiwKICAgICAgICBmb3JtQWRkcmVzczogInRpbWVsaW5lIiwKICAgICAgICBvbktleURvd246ICJAICIsCiAgICAgICAgb25LZXlVcDogIkAgIiwKICAgICAgICBvbkNsaWNrOiAiQCBsZXQgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoJ2tleWJvYXJkJywgJ1NoaWZ0Jyk7bGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTtzaG91dCgnYWJSZWNvcmRUcmFjZScpO3Nob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTIKICAgIH0pCn0KCmlmIChnZXRCb3QoInN5c3RlbSIsICJhYi5ob21lLmVnZyIpKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgICAgIGxhYmVsOiAic2F2ZSBob21lIGVnZyIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJlZ2ciLAogICAgICAgIG9uS2V5RG93bjogIkAgIiwKICAgICAgICBvbktleVVwOiAiQCAiLAogICAgICAgIG9uQ2xpY2s6IGBAZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaG9tZS5lZ2ciKS5zYXZlRGF0YSgpO3Nob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTMKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogInVwZGF0ZSAiICsgYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICBsZWFybjogdGFncy5sZWFybiwKICAgIG9uS2V5RG93bjogIkAgIiwKICAgIG9uS2V5VXA6ICJAICIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTQsCiAgICBvbkJvdEFkZGVkOiBgQAogICAgICAgIC8vIFRlbXBvcmFyaWx5IHJlcGxhY2Ugd2l0aCBidXN5IGluZGljYXRvciB3aGlsZSBjaGVja2luZyBmb3IgdXBkYXRlcy4KICAgICAgICB0YWdzLmFiTWVudSA9IGZhbHNlOwoKICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IGFiLmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcih7IAogICAgICAgICAgICBhYk1lbnU6IHRydWUsIAogICAgICAgICAgICBsYWJlbDogJ2NoZWNraW5nIGZvciB1cGRhdGVzIHRvICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgIGFiTWVudVNvcnRPcmRlcjogdGFncy5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlciwKICAgICAgICB9KTsKCiAgICAgICAgdHJ5IHsgCiAgICAgICAgICAgIHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrID0gYXdhaXQgYWIuYWJDaGVja0FCVXBkYXRlQXZhaWxhYmxlKHsgZGV0YWlsZWQ6IHRydWUgfSk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhYiB1cGRhdGUgY2hlY2s6JywgdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2spOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdC52YXJzLmJ1c3lJbmRpY2F0b3IpOwogICAgICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IG51bGw7CgogICAgICAgICAgICAvLyBCcmluZyBiYWNrIHRoZSB1cGRhdGUgYnV0dG9uLgogICAgICAgICAgICB0YWdzLmFiTWVudSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sgJiYgdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2suc3VjY2VzcykgewogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sudXBkYXRlQXZhaWxhYmxlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhYkZpbGVzV2l0aFVwZGF0ZXMgPSB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay5hYkZpbGVDaGVja3MuZmlsdGVyKGYgPT4gZi51cGRhdGVBdmFpbGFibGUpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2FiIGZpbGVzIHdpdGggdXBkYXRlczonLCBhYkZpbGVzV2l0aFVwZGF0ZXMpOwogICAgICAgICAgICAgICAgbWFza3MubGFiZWwgPSAndXBkYXRlICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnICgnICsgYWJGaWxlc1dpdGhVcGRhdGVzLmxlbmd0aCArICcpJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1hc2tzLmxhYmVsID0gYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJ2lzIHVwLXRvLWRhdGUnOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWFza3MubGFiZWwgPSAndXBkYXRlIGNoZWNrIGZhaWxlZCc7CiAgICAgICAgfQogICAgYCwKICAgIG9uQ2xpY2s6IGBACiAgICAgICAgaWYgKHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrICYmIHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrLnVwZGF0ZUF2YWlsYWJsZSkgewogICAgICAgICAgICBsaW5rcy5sZWFybi51cGRhdGVBQigpOyAKICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9CiAgICBgLAogICAgb25EZXN0cm95OiBgQAogICAgICAgIGlmICh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcikgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICB9CiAgICBgLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIG9uQ3JlYXRlOiBgQAogICAgICAgIHRhZ3MubGFiZWwgPSAicGVybWFuZW50bHkgZGVsZXRlICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwogICAgICAgIHRhZ3MuY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbnRyYXN0Q29sb3IgPz8gIiNEOTMwMzAiOwogICAgYCwKICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgb25DbGljazogYEAKICAgICAgICBjb25zdCBjb25maXJtZWQgPSBhd2FpdCBvcy5zaG93Q29uZmlybSh7CiAgICAgICAgICAgIHRpdGxlOiAnUGVybWFuZW50bHkgZGVsZXRlICcgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICBjb250ZW50OiAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSAnICsgIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIGZyb20gJyArIGxpbmtzLmxlYXJuLnRhZ3MuYWJJbnN0ICsgJz8gVGhpcyBpcyBub3QgcmV2ZXJzaWJsZSEnLAogICAgICAgIH0pCgogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CgogICAgICAgIGNvbnN0IGFiQm90cyA9IGdldEJvdHMoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbSAmJgogICAgICAgICAgICAgICAgICAgIGIudGFncy5zeXN0ZW0uc3RhcnRzV2l0aCgnYWInKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGNvbmZpcm1lZCkgewogICAgICAgICAgICBkZXN0cm95KGFiQm90cyk7CiAgICAgICAgfQogICAgYCwKICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAwCn0pCgpyZXR1cm4gb3B0aW9uczsnAJKn2ekCm5YBHmFiQ3JlYXRlVG9vbGJveERyb3Bkb3duT3B0aW9ucwIEAJKn2ekCkIID4xNAY29uc3QgdG9vbGJveFRvb2xzID0gWy4uLnRoYXQudG9vbEFycmF5XSA/PyBbXTsNCmNvbnN0IHRvb2xib3hOYW1lID0gdGhhdC50b29sYm94TmFtZSA/PyAiS2l0ICI7DQpjb25zdCB0b29sYm94ID0gdGhhdC50b29sYm94Ow0KY29uc3QgZ3JpZEluZm9ybWF0aW9uID0gKHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiAmJiB0aGF0Py5ncmlkSW5mb3JtYXRpb24gIT0gdW5kZWZpbmVkKSA/IHRoYXQ/LmdyaWRJbmZvcm1hdGlvbiA6IGFiUmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsNCg0KY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQpjb25zdCBhY3RpdmVNZW51ID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsNCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQptZW51T3B0aW9ucy50b29sYm94ID0gZ2V0TGluayh0b29sYm94KTsNCm1lbnVPcHRpb25zLmdyaWRJbmZvcm1hdGlvbiA9IGdyaWRJbmZvcm1hdGlvbjsNCm1lbnVPcHRpb25zLnNlYXJjaCA9IHRhZ3Muc2VhcmNoOw0KbWVudU9wdGlvbnMuYXJ0aWZhY3QgPSB0YWdzLmFydGlmYWN0Ow0KLy9tZW51T3B0aW9ucy5mb3JtQWRkcmVzcyA9ICJoYXJkd2FyZSI7DQoNCmlmICh0b29sYm94VG9vbHMubGVuZ3RoID09PSAwKSB7DQogICAgY29uc3QgbWVzc2FnZSA9IHRvb2xib3hOYW1lICsgIiBkb2VzIG5vdCBoYXZlIGFueSB0b29scyBsaXN0ZWQgaW4gdGhlIHRvb2xfYXJyYXkgdGFnIjsNCg0KICAgIGFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgbWVzc2FnZSk7DQogICAgb3MudG9hc3QobWVzc2FnZSwgNSk7DQogICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsNCn0NCg0KZm9yIChsZXQgdG9vbCBvZiB0b29sYm94VG9vbHMpIHsNCiAgICBjb25zdCB0b29sQnV0dG9uID0gew0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgbGFiZWw6IHRvb2wubmFtZSwNCiAgICAgICAgdGFyZ2V0QUI6IHRvb2wudGFyZ2V0QUIsDQogICAgICAgIGlzQXJ0aWZhY3Q6IHRvb2wuYXJ0aWZhY3QgfHwgZmFsc2UsDQogICAgICAgIG9uQ2xpY2s6YEANCiAgICAgICAgICAgIGlmICh0YWdzLmlzQXJ0aWZhY3QpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBhYkFydGlmYWN0U2hhcmQgPSB7DQogICAgICAgICAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiB0YWdzLnRvb2xib3gsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB0YWdzLmdyaWRJbmZvcm1hdGlvbg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXM6IFsNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc2tJRDogdGFncy50YXJnZXRBQg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBsaW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0UHJvbWlzZUJvdCh7DQogICAgICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3ROYW1lOiB0YWdzLnRhcmdldEFCLA0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0SW5zdGFuY2VJRDogdXVpZCgpLA0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0U2hhcmQsDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQXNrSUQoew0KICAgICAgICAgICAgICAgICAgICBhc2tJRDogdGFncy50YXJnZXRBQiwNCiAgICAgICAgICAgICAgICAgICAgc291cmNlRXZlbnQ6ICd0b29sJywNCiAgICAgICAgICAgICAgICAgICAgZWdnUGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJveEJvdDogdGFncy50b29sYm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB0YWdzLmdyaWRJbmZvcm1hdGlvbg0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICB9DQogICAgICAgIGAsDQogICAgfTsNCg0KICAgIGlmICh0b29sLmZvcm1BZGRyZXNzKSB7DQogICAgICAgIHRvb2xCdXR0b24uZm9ybUFkZHJlc3MgPSB0b29sLmZvcm1BZGRyZXNzOw0KICAgIH0NCg0KICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHRvb2xCdXR0b24pOw0KfQ0KDQpyZXR1cm4gZHJvcGRvd25PcHRpb25zOycAkqfZ6QKblgEQb25BQkF1dGhCb3RBZGRlZAIEAJKn2ekC9JUDGEBzaG91dCgnYWJNZW51UmVmcmVzaCcpOycAkqfZ6QKblgEIYXJ0aWZhY3QCBACSp9npAo2WAyjwn5SXNzhlNDE1MDMtYzkzMy00ZjhhLTgxN2EtYmE5N2JmOGQ1ZDI3JwEEYm90cyRjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcBJwCSp9npArSWAwhhYklnbm9yZQIEAJKn2ekCtZYDBHRydWUnAJKn2ekCtJYDC2FiSW50ZXJmYWNlAgQAkqfZ6QK6lgMEdHJ1ZScAkqfZ6QK0lgMGc3lzdGVtAgQAkqfZ6QK/lgMYYWIuaW50ZXJmYWNlLmJvdF9mYWN0b3J5JwCSp9npArSWAxZhYkNyZWF0ZUJpbGxib2FyZExhYmVsAgQAkqfZ6QLYlgOMQkBjb25zdCB7IAogICAgYm90LAogICAgZGltZW5zaW9uLAogICAgcHJlc2VydmVOZXdMaW5lcyA9IHRydWUsCiAgICBsYWJlbCA9ICcnLAogICAgc3BhY2UgPSAndGVtcExvY2FsJywKICAgIGNvbG9yID0gJ3doaXRlJywKICAgIGxhYmVsQ29sb3IgPSAnYmxhY2snLAogICAgLi4ucmVzdAp9ID0gdGhhdCA/PyB7fTsKCmFzc2VydChsaW5rcy51dGlscy5pc0JvdChib3QpLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGJvdCBpcyBhIHJlcXVpcmVkIEJvdCBwYXJhbWV0ZXIuYCk7CmFzc2VydChkaW1lbnNpb24sIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uIGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyLmApOwphc3NlcnQocmVzdC5vbkNyZWF0ZSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkFueUJvdHNDaGFuZ2VkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQW55Qm90c1JlbW92ZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3QudXBkYXRlTGFiZWwgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3QubGFiZWxXb3JkV3JhcE1vZGUgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBsYWJlbFdvcmRXcmFwTW9kZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKCi8vIC0tLSAxKSBXb3JkIGJyZWFraW5nICh3cmFwIGJ5IHdvcmRzLCBjaHVuayBsb25nIHdvcmRzKSAtLS0KZnVuY3Rpb24gYnJlYWtXb3Jkc1RvTGluZXModGV4dCwgbWF4Q29scyA9IDE4KSB7CiAgICBpZiAoIXRleHQpIHJldHVybiBbJyddOwogICAgY29uc3Qgd29yZHMgPSB0ZXh0LnNwbGl0KC9ccysvKS5maWx0ZXIoQm9vbGVhbik7CiAgICBjb25zdCBsaW5lcyA9IFtdOwogICAgbGV0IGxpbmUgPSAnJzsKCiAgICBjb25zdCBwdXNoID0gKCkgPT4geyBsaW5lcy5wdXNoKGxpbmUpOyBsaW5lID0gJyc7IH07CgogICAgZm9yIChjb25zdCB3IG9mIHdvcmRzKSB7CiAgICAgICAgaWYgKHcubGVuZ3RoID4gbWF4Q29scykgewogICAgICAgICAgICAvLyBjbG9zZSBjdXJyZW50IGxpbmUgKGlmIGFueSkgYmVmb3JlIGNodW5raW5nIGEgbG9uZyB3b3JkCiAgICAgICAgICAgIGlmIChsaW5lKSBwdXNoKCk7CiAgICAgICAgICAgIC8vIGNodW5rIHRoZSBsb25nIHdvcmQKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3Lmxlbmd0aDsgaSArPSBtYXhDb2xzKSB7CiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKHcuc2xpY2UoaSwgaSArIG1heENvbHMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsaW5lID0gJyc7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIWxpbmUubGVuZ3RoKSB7CiAgICAgICAgICAgIGxpbmUgPSB3OwogICAgICAgIH0gZWxzZSBpZiAobGluZS5sZW5ndGggKyAxICsgdy5sZW5ndGggPD0gbWF4Q29scykgewogICAgICAgICAgICBsaW5lICs9ICcgJyArIHc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHVzaCgpOwogICAgICAgICAgICBsaW5lID0gdzsKICAgICAgICB9CiAgICB9CiAgICBpZiAobGluZS5sZW5ndGgpIHB1c2goKTsKCiAgICByZXR1cm4gbGluZXMubGVuZ3RoID8gbGluZXMgOiBbJyddOwp9CgovLyBQcmVzZXJ2ZXMgZXhpc3RpbmcgXG4gYXMgaGFyZCBicmVha3M7IHdyYXBzIHdpdGhpbiBlYWNoIGhhcmQgbGluZS4KZnVuY3Rpb24gYnJlYWtXb3Jkc1RvTGluZXNQcmVzZXJ2ZU5ld2xpbmVzKHRleHQsIG1heENvbHMgPSAxOCkgewogIGlmICh0ZXh0ID09IG51bGwpIHJldHVybiBbJyddOwoKICAvLyBTcGxpdCBvbiByZWFsIG5ld2xpbmVzOyBrZWVwIGVtcHR5IGxpbmVzIHNvIHdlIHByZXNlcnZlIGJsYW5rIGxpbmVzLgogIGNvbnN0IGhhcmRMaW5lcyA9IFN0cmluZyh0ZXh0KS5zcGxpdCgvXHI/XG4vKTsKICBjb25zdCBvdXQgPSBbXTsKCiAgLy8gSGVscGVyIHRvIHdyYXAgYSBzaW5nbGUgaGFyZCBsaW5lIGJ5IHdvcmRzICh3aXRoIGxvbmctd29yZCBjaHVua2luZykKICBjb25zdCB3cmFwT25lID0gKHNyYykgPT4gewogICAgLy8gTm9ybWFsaXplIHRhYnMgLT4gc3BhY2VzOyBjb2xsYXBzZSBpbnRlcm5hbCB3aGl0ZXNwYWNlIChub3QgbmV3bGluZXMpCiAgICBjb25zdCBzID0gc3JjLnJlcGxhY2UoL1x0L2csICcgICAgJykucmVwbGFjZSgvXHMrL2csICcgJykudHJpbSgpOwogICAgaWYgKCFzLmxlbmd0aCkgeyBvdXQucHVzaCgnJyk7IHJldHVybjsgfQoKICAgIGNvbnN0IHdvcmRzID0gcy5zcGxpdCgnICcpOwogICAgbGV0IGxpbmUgPSAnJzsKCiAgICBjb25zdCBwdXNoTGluZSA9ICgpID0+IHsgb3V0LnB1c2gobGluZSk7IGxpbmUgPSAnJzsgfTsKCiAgICAvLyBjaHVuayBsb25nIHdvcmRzIHRvIGVtdWxhdGUgJ2JyZWFrV29yZHMnCiAgICBjb25zdCBjaHVua1dvcmQgPSAodykgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcubGVuZ3RoOyBpICs9IG1heENvbHMpIHsKICAgICAgICBjb25zdCBjaHVuayA9IHcuc2xpY2UoaSwgaSArIG1heENvbHMpOwogICAgICAgIGlmICghbGluZS5sZW5ndGgpIGxpbmUgPSBjaHVuazsKICAgICAgICBlbHNlIHsgcHVzaExpbmUoKTsgbGluZSA9IGNodW5rOyB9CiAgICAgIH0KICAgIH07CgogICAgZm9yIChjb25zdCB3IG9mIHdvcmRzKSB7CiAgICAgIGlmICh3Lmxlbmd0aCA+IG1heENvbHMpIHsKICAgICAgICBpZiAobGluZS5sZW5ndGgpIHB1c2hMaW5lKCk7CiAgICAgICAgY2h1bmtXb3JkKHcpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghbGluZS5sZW5ndGgpIHsKICAgICAgICBsaW5lID0gdzsKICAgICAgfSBlbHNlIGlmIChsaW5lLmxlbmd0aCArIDEgKyB3Lmxlbmd0aCA8PSBtYXhDb2xzKSB7CiAgICAgICAgbGluZSArPSAnICcgKyB3OwogICAgICB9IGVsc2UgewogICAgICAgIHB1c2hMaW5lKCk7CiAgICAgICAgbGluZSA9IHc7CiAgICAgIH0KICAgIH0KICAgIGlmIChsaW5lLmxlbmd0aCkgcHVzaExpbmUoKTsKICB9OwoKICBmb3IgKGNvbnN0IGhsIG9mIGhhcmRMaW5lcykgewogICAgd3JhcE9uZShobCk7ICAgICAgICAgICAvLyB3cmFwIHdpdGhpbiB0aGlzIGhhcmQgbGluZQogIH0KCiAgLy8gSWYgdGhlIGlucHV0IGVuZGVkIHdpdGggYSB0cmFpbGluZyBuZXdsaW5lLCB3ZSBhbHJlYWR5IHByZXNlcnZlZCBpdAogIC8vIGJlY2F1c2Ugc3BsaXQga2VwdCBhbiBlbXB0eSBsYXN0IGl0ZW0gLT4gYmVjYW1lIGFuIGVtcHR5IHdyYXBwZWQgbGluZS4KICByZXR1cm4gb3V0Lmxlbmd0aCA/IG91dCA6IFsnJ107Cn0KCi8vIC0tLSAyKSBTaW1wbGUgc2l6aW5nIGZyb20gbGluZXMgLS0tCi8vIFRoaW5rIG9mICJjb2xzUGVyU2NhbGVYIiBhcyAiYWJvdXQgTiBjaGFyYWN0ZXJzIHBlciAxIHNjYWxlWCIuCmZ1bmN0aW9uIGNvbXB1dGVTaW1wbGVTY2FsZXNGcm9tTGluZXMobGluZXMsIHsKICAgIGNvbHNQZXJTY2FsZVggPSAyLjUsCiAgICBtaW5TY2FsZVggPSAxLjI1LAogICAgbWF4U2NhbGVYID0gMTAsCiAgICBiYXNlU2NhbGVZID0gMS4yLAogICAgcGVyTGluZVkgPSAwLjc1LAp9ID0ge30pIHsKICAgIGNvbnN0IGxvbmdlc3QgPSBsaW5lcy5yZWR1Y2UoKG0sIGwpID0+IE1hdGgubWF4KG0sIGwubGVuZ3RoKSwgMCk7CiAgICBjb25zdCBsaW5lQ291bnQgPSBNYXRoLm1heCgxLCBsaW5lcy5sZW5ndGgpOwoKICAgIC8vIFdpZHRoIHNjYWxlcyB3aXRoIHRoZSBsb25nZXN0IGxpbmUgbGVuZ3RoCiAgICBsZXQgc2NhbGVYID0gbG9uZ2VzdCA+IDAgPyAobG9uZ2VzdCAvIGNvbHNQZXJTY2FsZVgpIDogbWluU2NhbGVYOwogICAgc2NhbGVYID0gTWF0aC5tYXgobWluU2NhbGVYLCBNYXRoLm1pbihtYXhTY2FsZVgsIHNjYWxlWCkpOwoKICAgIC8vIEhlaWdodCBncm93cyBwZXIgbGluZTsga2VlcCBpdCBzaW1wbGUgYW5kIHByZWRpY3RhYmxlCiAgICBjb25zdCBzY2FsZVkgPSBNYXRoLm1heChiYXNlU2NhbGVZLCBiYXNlU2NhbGVZICsgKGxpbmVDb3VudCAtIDEpICogcGVyTGluZVkpOwoKICAgIHJldHVybiB7IHNjYWxlWCwgc2NhbGVZLCBsb25nZXN0LCBsaW5lQ291bnQgfTsKfQoKCi8vIFBpY2sgeW91ciB0YXJnZXQgImNvbHVtbnMiIHBlciBsaW5lICh0d2VhayB0byB0YXN0ZSkKY29uc3QgTUFYX0NPTFMgPSAzMjsKCi8vIEJyZWFrIHRoZSB0ZXh0IHlvdXJzZWxmCmNvbnN0IGxpbmVzID0gcHJlc2VydmVOZXdMaW5lcyA/IGJyZWFrV29yZHNUb0xpbmVzUHJlc2VydmVOZXdsaW5lcyhsYWJlbCwgTUFYX0NPTFMpIDogYnJlYWtXb3Jkc1RvTGluZXMobGFiZWwsIE1BWF9DT0xTKTsKY29uc3Qgd3JhcHBlZExhYmVsID0gbGluZXMuam9pbignXG4nKTsKCi8vIENvbXB1dGUgc2ltcGxlIHNjYWxlcyBmcm9tIHRoZSB3cmFwcGVkIHRleHQKY29uc3QgeyBzY2FsZVgsIHNjYWxlWSB9ID0gY29tcHV0ZVNpbXBsZVNjYWxlc0Zyb21MaW5lcyhsaW5lcyk7CgpsZXQgbGFiZWxNb2QgPSB7CiAgICBzcGFjZTogc3BhY2UsCiAgICB0cmFja0JvdElkOiBib3QuaWQsCiAgICBmb3JtOiAnc3ByaXRlJywKICAgIGNvbG9yLAogICAgbGFiZWw6IHdyYXBwZWRMYWJlbCwKICAgIGxhYmVsQ29sb3IsCiAgICBsYWJlbFNpemU6IDEsCiAgICBsYWJlbFBhZGRpbmdYOiAwLjUsCiAgICBsYWJlbFdvcmRXcmFwTW9kZTogJ25vbmUnLAogICAgc2NhbGVYLCAKICAgIHNjYWxlWSwKICAgIHNjYWxlWjogMC4xLAogICAgYm90TGFiZWxNYXJnaW46IDEsCiAgICBhbmNob3JQb2ludDogJ+Keoe+4jzAsLTAuNSwwJywKICAgIG9yaWVudGF0aW9uTW9kZTogJ2JpbGxib2FyZCcsCiAgICBkaW1lbnNpb246IGRpbWVuc2lvbiwKICAgIGRlYnVnOiBmYWxzZSwKICAgIFtkaW1lbnNpb25dOiB0cnVlLAogICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgIG9uQ3JlYXRlOiBgQAogICAgICAgIC8vIFdhaXQgZm9yIHJlcXVpcmVkIGJvdHMgdG8gYmUgcmVhZHkuCiAgICAgICAgbGV0IHdhaXRUaW1lID0gMDsKCiAgICAgICAgd2hpbGUoIWdsb2JhbFRoaXMuYWIpIHsKICAgICAgICAgICAgaWYgKHdhaXRUaW1lID49IDUwMDApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXdhaXQgb3Muc2xlZXAoMjUwKTsKICAgICAgICAgICAgd2FpdFRpbWUgKz0gMjUwOwogICAgICAgIH0KCiAgICAgICAgdGFncy5yZWFkeSA9IHRydWU7CiAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgYCwKICAgIG9uQW55Qm90c0NoYW5nZWQ6IGBACgogICAgICAgIGZvciAoY29uc3QgY2hhbmdlZCBvZiB0aGF0KSB7CiAgICAgICAgICAgIGlmIChjaGFuZ2VkLmJvdCAmJiBjaGFuZ2VkLmJvdC5pZCA9PT0gdGFncy50cmFja0JvdElkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvbmx5Um90YXRpb25UYWdzID0gY2hhbmdlZC50YWdzLmV2ZXJ5KCh0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZW5kc1dpdGgoJ1JvdGF0aW9uJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25YJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25ZJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25aJykKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIG9ubHlSb3RhdGlvblRhZ3M6Jywgb25seVJvdGF0aW9uVGFncyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG9ubHlSb3RhdGlvblRhZ3MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgYCwKICAgIG9uQW55Qm90c1JlbW92ZWQ6IGBACgogICAgICAgIGlmICh0aGF0LmJvdElEcy5pbmNsdWRlcyh0YWdzLnRyYWNrQm90SWQpKSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgfQogICAgYCwKICAgIG9uUG9ydGFsQ2hhbmdlZDogYEAKICAgICAgICBpZiAodGhhdC5kaW1lbnNpb24gPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgICAgICB9CiAgICBgLAogICAgdXBkYXRlTGFiZWw6IGBACiAgICAgICAgaWYgKCF0YWdzLnJlYWR5KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JpbmcgdXBkYXRlTGFiZWwgYmVjYXVzZSBub3QgcmVhZHknKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGluTWFwUG9ydGFsID0gKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGNvbnN0IGluR3JpZFBvcnRhbCA9IChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAoIWluTWFwUG9ydGFsICYmICFpbkdyaWRQb3J0YWwpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JlIHVwZGF0ZUxhYmVsIGNhbGwsIG5vdCBpbiBlaXRoZXIgZ3JpZCBvciBtYXAgcG9ydGFsLicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHRyYWNrQm90ID0gZ2V0Qm90KCdpZCcsIHRhZ3MudHJhY2tCb3RJZCk7CiAgICAgICAgY29uc3QgdHJhY2tQb3NpdGlvbiA9IGdldEJvdFBvc2l0aW9uKHRyYWNrQm90LCB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gdHJhY2tQb3NpdGlvbjonLCB0cmFja1Bvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGxldCBsYWJlbFBvc2l0aW9uID0geyB4OiB0cmFja1Bvc2l0aW9uLngsIHk6IHRyYWNrUG9zaXRpb24ueSwgejogdHJhY2tQb3NpdGlvbi56IH07IAoKICAgICAgICBjb25zdCB0cmFja0JvdFNjYWxlID0gdHJhY2tCb3QudGFncy5zY2FsZSA/PyAxOwogICAgICAgIGNvbnN0IHRyYWNrQm90U2NhbGVaID0gdHJhY2tCb3QudGFncy5zY2FsZVogPz8gMTsKCiAgICAgICAgbGV0IG1ldGVyc1BlckdyaWRVbml0ID0gMTsKCiAgICAgICAgaWYgKGluTWFwUG9ydGFsKSB7CiAgICAgICAgICAgIC8vIFNjYWxlIHRvIG1hcCBwb3J0YWwgdW5pdHMuCiAgICAgICAgICAgIG1ldGVyc1BlckdyaWRVbml0ID0gMTA7CiAgICAgICAgfQoKICAgICAgICBsZXQgdHJhY2tCb3RSZWFsU2NhbGVaID0gKHRyYWNrQm90U2NhbGVaICogdHJhY2tCb3RTY2FsZSkgKiBtZXRlcnNQZXJHcmlkVW5pdDsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSB0cmFja0JvdFJlYWxTY2FsZVo6JywgdHJhY2tCb3RSZWFsU2NhbGVaKTsKICAgICAgICB9CgogICAgICAgIGxhYmVsUG9zaXRpb24ueiArPSB0cmFja0JvdFJlYWxTY2FsZVogKyAodGFncy5ib3RMYWJlbE1hcmdpbiAqIG1ldGVyc1BlckdyaWRVbml0KTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1thYkJpbGxib2FyZExhYmVsXSBsYWJlbFBvc2l0aW9uOicsIGxhYmVsUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdYJ10gPSBsYWJlbFBvc2l0aW9uLng7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdZJ10gPSBsYWJlbFBvc2l0aW9uLnk7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdaJ10gPSBsYWJlbFBvc2l0aW9uLno7CiAgICBgCn07CgpsYWJlbE1vZCA9IHsKICAgIC4uLmxhYmVsTW9kLAogICAgLi4ucmVzdCwKfQoKY29uc3QgbGFiZWxCb3QgPSBjcmVhdGUobGFiZWxNb2QpOwoKcmV0dXJuIGxhYmVsQm90OycAkqfZ6QK0lgMFdXRpbHMCBACSp9npAuHYAyjwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwCSp9npArSWAwRmb3JtAgQAkqfZ6QKI2QMHbm90aGluZycAkqfZ6QK0lgMJYWJWZXJzaW9uAgQAkqfZ6QKQ2QMFMTAuMjMA"}]}