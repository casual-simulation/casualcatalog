{"version":2,"updates":[{"id":0,"timestamp":1756154451708,"update":"AbgB8IX5kwEAJwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwDwhfmTAQAKYWJJRE9yaWdpbgIEAPCF+ZMBAQ10b29sYm94X3NraWxsJwDwhfmTAQALYWJJbnRlcmZhY2UCBADwhfmTAQ8EdHJ1ZScA8IX5kwEAC2Rlc2NyaXB0aW9uAgQA8IX5kwEUKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwDwhfmTAQAEZm9ybQIEAPCF+ZMBPgdub3RoaW5nJwDwhfmTAQAEbWVudQIEAPCF+ZMBRijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwDwhfmTAQAGc3lzdGVtAgQA8IX5kwFtFGFiLmludGVyZmFjZS50b29sYm94JwDwhfmTAQAKYWJJRFN0dWRpbwIEAPCF+ZMBggEkZTkxZWFiMGQtNmE3NS00YWI5LThhMGUtNTBhNGNjMGMxZDM0JwDwhfmTAQAIcmVtZW1iZXICBADwhfmTAacBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAPCF+ZMBAAt0b29sYm94X2FkZAIEAPCF+ZMBzgGnC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgidG9vbGJveCIsIGdldExpbmsoYWN0aXZlVG9vbGJveCkpOwogICAgaWYgKG1lbnVCb3QpIHsKICAgICAgICBtZW51Qm90Lm9uQ2xpY2soKTsKICAgIH0KfQplbHNlIGlmIChhY3RpdmVUb29sYm94ICYmIGFjdGl2ZVRvb2xib3gudGFncy5hYkdyaWRNZW51QWN0aW9uKSB7CiAgICBhY3RpdmVUb29sYm94LmFiR3JpZE1lbnVBY3Rpb24oeyBncmlkSW5mb3JtYXRpb246IGdyaWREYXRhIH0pOwp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiQ29yZU1lbnVBY3Rpb24pIHsKICAgIC8vUkVGUkVTSCBBTkQgVEhFTiBPUEVOPz8/Cn0nAPCF+ZMBAAVsZWFybgIEAPCF+ZMB9gwo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycA8IX5kwEABXN0b3JlAgQA8IX5kwGdDSjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwDwhfmTAQAGc2VhcmNoAgQA8IX5kwHEDSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwDwhfmTAQAIYWJJZ25vcmUCBADwhfmTAesNBHRydWUnAPCF+ZMBAAlhYlZlcnNpb24CBADwhfmTAfANBDEwLjYnAPCF+ZMBAA1tYW5pZmVzdGF0aW9uAgQA8IX5kwH1DSjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDwhfmTAQAQYWJHcmlkTWVudUFjdGlvbgIEAPCF+ZMBnA77B0BzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxpbmtzLm1lbnUubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsiOwoKY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7CmNvbnN0IG1lbnVCb3QgPSB7fTsKCm1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsKbWVudUJvdC5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51Qm90LmdyaWREYXRhID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKbWVudUJvdC5mb3JtQWRkcmVzcyA9ICJhZGRfYm94IjsKbWVudUJvdC5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwptZW51Qm90Lm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdGFncy50b29sYm94X2RhdGEsIGdyaWREYXRhOiB0YWdzLmdyaWREYXRhfSk7IHNob3V0KCJhYk1lbnVSZWZyZXNoIik7YDsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspCnsKICAgIGNvbnN0IGFjdGl2ZVRvb2xib3ggPSBwb3NzaWJsZVRvb2xib3hlc1tpXTsKICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7CgogICAgbWVudUJvdC50b29sYm94X2RhdGEgPSBhY3RpdmVUb29sYm94OwogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOwoKICAgIGlmICghZXh0YW50Qm90KQogICAgewogICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCb3QpOwogICAgfQp9JwDwhfmTAQAUYWJHcmlkTWVudU9uR2VuZXJhdGUCBADwhfmTAZgW4gJAY29uc3QgdG9vbGJveEFycmF5ID0gYWJSZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7CgpsZXQgYWxsVG9vbHNMb2FkZWQgPSB0cnVlOwoKZm9yIChsZXQgaSA9IDA7IGkgPCB0b29sYm94QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IGN1cnJlbnRUb29sID0gdG9vbGJveEFycmF5W2ldLm5hbWU7CgogICAgaWYgKCFnZXRCb3QoImFiSURPcmlnaW4iLCBjdXJyZW50VG9vbCkgJiYgIWdldEJvdChjdXJyZW50VG9vbCwgdHJ1ZSkpIHsKICAgICAgICBhbGxUb29sc0xvYWRlZCA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgfQp9CgppZiAoYWxsVG9vbHNMb2FkZWQpIHsKICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAPCF+ZMBAA5hYkdyaWRNZW51SWNvbgIEAPCF+ZMB+xgKbG9jYWxfbWFsbCcA8IX5kwEAD2FiR3JpZE1lbnVMYWJlbAIEAPCF+ZMBhhkOY2FzdWFsIGNhdGFsb2cnAPCF+ZMBABNhYkdyaWRNZW51U29ydE9yZGVyAgQA8IX5kwGVGQEzJwDwhfmTAQAPb25BQkluaXRpYWxpemVkAgQA8IX5kwGXGSpALy8gbGlua3MubGVhcm4uYWJBZGFwdCgiY2FzdWFsX3Rvb2xib3giKTsnAPCF+ZMBAA1vblNraWxsVXBkYXRlAgQA8IX5kwHCGVdAbGlua3MubGVhcm4uYWJBZGFwdCgiY2FzdWFsX3Rvb2xib3giKTsNCg0KY29uc29sZS5sb2coIltUb29sYm94XSBMb2FkaW5nIGNhc3VhbCBraXQiKTsnAPCF+ZMBAApzaGVsbFV0aWxzAgQA8IX5kwGaGijwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwEEYm90cyQxNzQxMGQ4My03ZWVlLTRhMWUtYjYzOC02NTQ2Mzc0ZDE3YzMBJwDwhfmTAcEaBnN5c3RlbQIEAPCF+ZMBwhoRYWIuaW50ZXJmYWNlLnNjYW4nAPCF+ZMBwRoEZm9ybQIEAPCF+ZMB1BoHbm90aGluZycA8IX5kwHBGgthYkludGVyZmFjZQIEAPCF+ZMB3BoEdHJ1ZScA8IX5kwHBGghhYklnbm9yZQIEAPCF+ZMB4RoEdHJ1ZScA8IX5kwHBGg9vblFSQ29kZVNjYW5uZWQCBADwhfmTAeYagA5AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgppZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFCRWdncyh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhc2siKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKHRoYXQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5hc2spIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hc2t9KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5wYXR0ZXJufSk7CiAgICAgICAgfQogICAgICAgIAogICAgfQp9JwDwhfmTAcEaBXN0b3JlAgQA8IX5kwHnKCjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwDwhfmTAcEaBnNlYXJjaAIEAPCF+ZMBjiko8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScA8IX5kwHBGhBhYkNvcmVNZW51QWN0aW9uAgQA8IX5kwG1KTdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwDwhfmTAcEaD2FiQ29yZU1lbnVMYWJlbAIEAPCF+ZMB7SkEc2NhbicA8IX5kwHBGg5hYkNvcmVNZW51SWNvbgIEAPCF+ZMB8ikPcXJfY29kZV9zY2FubmVyJwDwhfmTAcEaE2FiQ29yZU1lbnVTb3J0T3JkZXICBADwhfmTAYIqATMnAPCF+ZMBwRoJYWJWZXJzaW9uAgQA8IX5kwGEKgQxMC42JwEEYm90cyQ0OTNmZmE0ZC00NmQ0LTRhOTgtYWU5Yy0xMjEyZDY1MTEzM2YBJwDwhfmTAYkqBnN5c3RlbQIEAPCF+ZMBiioUYWIuaW50ZXJmYWNlLnZlcnNpb24nAPCF+ZMBiSoNb25Ta2lsbFVwZGF0ZQIEAPCF+ZMBnyqnAUBjb25zdCB2ZXJzaW9uU3RyaW5nID0gdGFncy5hYkludGVyZmFjZU1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJJbnRlcmZhY2VNaW5vclZlcnNpb247DQoNCmNvbnNvbGUubG9nKCJbQUJJbnRlcmZhY2VdIExvYWRlZCBBQiBJbnRlcmZhY2UgdmVyc2lvbiAiICsgdmVyc2lvblN0cmluZyk7JwDwhfmTAYkqF2FiSW50ZXJmYWNlTWFqb3JWZXJzaW9uAgQA8IX5kwHHKwExJwDwhfmTAYkqF2FiSW50ZXJmYWNlTWlub3JWZXJzaW9uAgQA8IX5kwHJKwIxNycA8IX5kwGJKghhYklnbm9yZQIEAPCF+ZMBzCsEdHJ1ZScA8IX5kwGJKgRmb3JtAgQA8IX5kwHRKwdub3RoaW5nJwDwhfmTAYkqC2FiSW50ZXJmYWNlAgQA8IX5kwHZKwR0cnVlJwDwhfmTAYkqCWFiVmVyc2lvbgIEAPCF+ZMB3isEMTAuNicBBGJvdHMkNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmAScA8IX5kwHjKwZzeXN0ZW0CBADwhfmTAeQrE2FiLmludGVyZmFjZS5udWdnZXQnAPCF+ZMB4ysEZm9ybQIEAPCF+ZMB+CsHbm90aGluZycA8IX5kwHjKwthYkludGVyZmFjZQIEAPCF+ZMBgCwEdHJ1ZScA8IX5kwHjKwhhYklnbm9yZQIEAPCF+ZMBhSwEdHJ1ZScA8IX5kwHjKwxhYkxvYWROdWdnZXQCBADwhfmTAYosmAJAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldE5hbWU7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIitudWdnZXROYW1lOwpsZXQgbG9hZGVkTnVnZ2V0ID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBmb3JtYXR0ZWROdWdnZXRBQiwgYWJWZXJzaW9uOiB0aGF0LnZlcnNpb24sIHJldHVyblR5cGU6ICJkYXRhIn0pOwoKbG9hZGVkTnVnZ2V0ID0gbG9hZGVkTnVnZ2V0LnN0YXRlW251Z2dldE5hbWVdLm51Z2dldDsKCnJldHVybiBsb2FkZWROdWdnZXQ7JwDwhfmTAeMrD2FiUHVibGlzaE51Z2dldAIEAPCF+ZMBoy6MA0AvL3Nob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiAibnVnTmFtZSIsIGRhdGE6IGRhdGF9KTsgIEFERCBFR0cgSUQgRVZFTlRVQUxMWQpsZXQgdGVzdE51Z2dldCA9IHRoYXQuZGF0YTsKbGV0IGZvcm1hdHRlZE51Z2dldCA9IHtpZDogdGhhdC5udWcsIG51Z2dldDogdGVzdE51Z2dldH07CmxldCB0ZXN0TnVnZ2V0TmFtZSA9IHRoYXQubnVnOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrdGVzdE51Z2dldE5hbWU7CgptYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBmb3JtYXR0ZWROdWdnZXRBQjsKCmxpbmtzLnN0b3JlLmFiUHVibGlzaEFCKHthYjogZm9ybWF0dGVkTnVnZ2V0QUIsIHRhcmdldDogZm9ybWF0dGVkTnVnZ2V0LCBzb3VyY2VFdmVudDogJ3B1Ymxpc2hfbnVnZ2V0J30pOycA8IX5kwHjKw9pbXBsZW1lbnROdWdnZXQCBADwhfmTAbAxsQdAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldDsKbGV0IG51Z2dldFZlcnNpb25DaGVjayA9IG51Z2dldE5hbWUuaW5kZXhPZigiLnYiKTsKbGV0IHZlcnNpb247CgppZiAobnVnZ2V0VmVyc2lvbkNoZWNrICE9IC0xKQp7CiAgICBudWdnZXROYW1lID0gbnVnZ2V0TmFtZS5zdWJzdHJpbmcoMCwgbnVnZ2V0VmVyc2lvbkNoZWNrKTsKCiAgICBsZXQgdmVyc2lvbkNoZWNrID0gdGhhdC5udWdnZXQuc3Vic3RyaW5nKG51Z2dldFZlcnNpb25DaGVjayArIDIpOwoKICAgIGlmIChpc05hTih2ZXJzaW9uQ2hlY2spKQogICAgewogICAgICAgIGNvbnNvbGUubG9nKHZlcnNpb25DaGVjaywgInZlcnNpb24gaXMgbm90IGEgbnVtYmVyIik7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdmVyc2lvbiA9IE51bWJlcih2ZXJzaW9uQ2hlY2spOwogICAgfQp9CmNvbnNvbGUubG9nKG51Z2dldE5hbWUsIHZlcnNpb24pOwpsZXQgbnVnRGF0YSA9IGF3YWl0IHRoaXNCb3QuYWJMb2FkTnVnZ2V0KHtudWdnZXROYW1lOiBudWdnZXROYW1lLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7CgppZiAobnVnRGF0YSA9PSAiYWJJRCBub3QgZm91bmQiKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IG5vdCBmb3VuZCIpOwp9CmVsc2UKewogICAgbGV0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CiAgICBsZXQgdGFyZ2V0VGFnID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10udG9TdHJpbmcoKTsKICAgIGxldCB0YXJnZXROdWcgPSAieyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0VGFnLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7CiAgICBpbnNlcnRUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgbnVnRGF0YSk7Cn0nAPCF+ZMB4ysMbnVnZ2V0QnV0dG9uAgQA8IX5kwHiOPUMQGxldCB0YWdWYWx1ZSA9IHRoYXQudGFnVmFsdWU7CmxldCByZWdleCA9IC9cbi9naTsKbGV0IGJyZWFrQ2hlY2s7CmxldCBicmVha0FycmF5ID0gWzBdOwovL2xldCBjcmVhdGVkQnV0dG9ucyA9IFtdOwoKd2hpbGUgKGJyZWFrQ2hlY2sgPSByZWdleC5leGVjKHRhZ1ZhbHVlKSkKewogICAgYnJlYWtBcnJheS5wdXNoKGJyZWFrQ2hlY2suaW5kZXgpOwp9CgpsZXQgbmV3TnVnZ2V0QnV0dG9uID0ge307CgpuZXdOdWdnZXRCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TnVnZ2V0QnV0dG9uLmZvcm0gPSAiY29kZUJ1dHRvbiI7Cm5ld051Z2dldEJ1dHRvbi50YXJnZXRCb3QgPSB0aGF0LmJvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldFRhZyA9IHRoYXQudGFnOwpuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAibG9hZCBudWdnZXQiOwpuZXdOdWdnZXRCdXR0b24ubnVnZ2V0UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnXSA9IHRydWU7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRNYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLmltcGxlbWVudE51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKZGVzdHJveSh0aGlzQm90KTtgOwoKZm9yIChsZXQgbnVncyA9IDA7IG51Z3MgPCB0aGF0Lm51Z2dldC5sZW5ndGg7IG51Z3MrKykKewogICAgbGV0IGN1cnJlbnROdWdnZXQgPSB0aGF0Lm51Z2dldFtudWdzXTsKICAgIC8vbGV0IGJ1dHRvbkNoZWNrID0gY3JlYXRlZEJ1dHRvbnMuaW5kZXhPZihjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwoKICAgIGlmICghY3VycmVudE51Z2dldCB8fCBjdXJyZW50TnVnZ2V0ID09IHVuZGVmaW5lZCkgLy98fCBidXR0b25DaGVjayAhPSAtMQogICAgewogICAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChjdXJyZW50TnVnZ2V0Lm51Z1B1Ymxpc2gpCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5udWdnZXRNYW5hZ2VyLnBhY2thZ2VOdWdnZXQoe2JvdDogdGFncy50YXJnZXRCb3QsIG51Z2dldDogdGFncy50YXJnZXROdWdnZXQsIHRhZzogdGFncy50YXJnZXRUYWd9KTsKCiAgICAgICAgZGVzdHJveSh0aGlzQm90KTtgOwoKICAgICAgICBuZXdOdWdnZXRCdXR0b24ubGFiZWwgPSAicHVibGlzaCAiICsgY3VycmVudE51Z2dldC5udWdOYW1lICsgIiBudWdnZXQiOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CgogICAgbmV3TnVnZ2V0QnV0dG9uLnRhcmdldE51Z2dldCA9IGN1cnJlbnROdWdnZXQubnVnTmFtZTsKICAgIG5ld051Z2dldEJ1dHRvblt0aGF0LmJvdC5pZCArICIuIiArIHRoYXQudGFnICsgIlN0YXJ0Il0gPSBjdXJyZW50TnVnZ2V0Lm51Z1N0YXJ0OwoKICAgIGNyZWF0ZShuZXdOdWdnZXRCdXR0b24pOwoKICAgIC8vY3JlYXRlZEJ1dHRvbnMucHVzaChjdXJyZW50TnVnZ2V0Lm51Z05hbWUpOwp9CgpyZXR1cm47JwDwhfmTAeMrC251Z2dldFBhcnNlAgQA8IX5kwHWRacPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwDwhfmTAeMrDW9uQUJQdWJsaXNoZWQCBADwhfmTAf5UwQFAY29uc29sZS5sb2codGhhdC5hYiwgdGFncy5udWdnZXRUb1B1Ymxpc2gpCgppZiAodGhhdC5hYiA9PSB0YWdzLm51Z2dldFRvUHVibGlzaCkKewogICAgb3MudG9hc3QoIm51Z2dldCBwdWJsaXNoZWQiKTsKCiAgICBtYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBudWxsOwoKICAgIGNvbmZpZ0JvdC5tYXNrcy5hYlZlcnNpb24gPSBudWxsOwp9JwDwhfmTAeMrEG9uQW55Qm90c0NoYW5nZWQCBADwhfmTAcBWtwRAaWYgKGNvbmZpZ0JvdCAmJiB0aGF0WzBdLmJvdC5pZCAhPSB0aGlzQm90LmlkKSAKewogICAgaWYgKCFjb25maWdCb3QudGFncy5lZGl0aW5nQm90KSByZXR1cm47IC8vIElnbm9yZSBpZiB0aGUgY29uZmlnQm90IGlzbid0IHJlYWR5IHlldC4KCiAgICBjb25zdCBlZGl0ZWRCb3RJRCA9IGNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QucmVwbGFjZSgi8J+UlyIsICIiKTsKCiAgICBpZiAoIXRoYXQuZmluZCh4ID0+IHguYm90LmlkID09IGVkaXRlZEJvdElEKSkgcmV0dXJuOyAvLyBJZiB0aGUgYm90IGNoYW5nZWQgd2Fzbid0IGJlaW5nIGVkaXRlZCBieSB0aGUgdXNlciBpZ25vcmUgaXQuCgogICAgY29uc3QgZWRpdGVkVGFnID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ1RhZzsKICAgIGNvbnN0IGVkaXRlZEJvdCA9IGdldEJvdCgiaWQiLCBlZGl0ZWRCb3RJRCk7CgogICAgaWYgKGVkaXRlZEJvdCAmJiBlZGl0ZWRUYWcpIAogICAgewogICAgICAgIHNob3V0KCJudWdnZXRSZXNldCIpOwoKICAgICAgICB0aGlzQm90Lm51Z2dldFBhcnNlKHsgZWRpdGVkQm90LCBlZGl0ZWRUYWcgfSk7CiAgICB9Cn0nAPCF+ZMB4ysIb25DcmVhdGUCBADwhfmTAfZaTEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnAPCF+ZMB4ysNcGFja2FnZU51Z2dldAIEAPCF+ZMBw1v4BkBjb25zdCB0YXJnZXRCb3QgPSBnZXRCb3QoImlkIiwgdGhhdC5ib3QpOwpjb25zdCB0YWdUZXh0ID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ107CgppZiAoY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleCB8fCBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleCkKewogICAgbGV0IHN0YXJ0UG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yU3RhcnRJbmRleDsKICAgIGxldCBlbmRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JFbmRJbmRleDsKCiAgICBpZiAoc3RhcnRQb3MgPT0gZW5kUG9zKQogICAgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2UgaWYgKHN0YXJ0UG9zID4gZW5kUG9zKQogICAgewogICAgICAgIGxldCBuZXdTdGFydFBvcyA9IGVuZFBvczsKICAgICAgICBsZXQgbmV3RW5kUG9zID0gc3RhcnRQb3M7CgogICAgICAgIHN0YXJ0UG9zID0gbmV3U3RhcnRQb3M7CiAgICAgICAgZW5kUG9zID0gbmV3RW5kUG9zOwogICAgfQoKICAgIGxldCBkYXRhID0gdGFnVGV4dC5zdWJzdHJpbmcoc3RhcnRQb3MsIGVuZFBvcyArIDEpOwoKICAgIHNob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiB0aGF0Lm51Z2dldCwgZGF0YTogZGF0YX0pOwoKICAgIG9zLnRvYXN0KCJudWcgaXMgcHVibGlzaGluZyIsIDEwKTsKCiAgICBsZXQgdGFyZ2V0TnVnID0gIi5udWcgeyIgKyB0aGF0Lm51Z2dldCArICJ9IjsgCiAgICBsZXQgbnVnUG9zID0gdGFyZ2V0Qm90LnJhd1t0aGF0LnRhZ10uaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJjYW5ub3QgcmVhZCBudWdnZXQgdG8gYmUgcHVibGlzaGVkIikKfScA8IX5kwHjKwhyZW1lbWJlcgIEAPCF+ZMBvGIo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA8IX5kwHjKwZzZWFyY2gCBADwhfmTAeNiKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAPCF+ZMB4ysFc3RvcmUCBADwhfmTAYpjKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAPCF+ZMB4ysJbGlzdGVuaW5nAgQA8IX5kwGxYwVmYWxzZScA8IX5kwHjKwlhYlZlcnNpb24CBADwhfmTAbdjBDEwLjYnAQRib3RzJGIzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYgEnAPCF+ZMBvGMZYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcgIEAPCF+ZMBvWPODEBjb25zdCB7CiAgICBsYWJlbCA9IGAke2FiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eX0gaXMgd29ya2luZ2AsCiAgICAuLi5yZXN0Cn0gPSB0aGF0ID8/IHt9CgpsZXQgYnVzeUluZGljYXRvciA9IHsKICAgIG9uUG9pbnRlclVwOiBudWxsLAogICAgb25Qb2ludGVyRG93bjogbnVsbCwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBidXN5TGFiZWw6IGxhYmVsLAogICAgbGFiZWxBbGlnbm1lbnQ6ICdsZWZ0JywKICAgIHN0YXRlOiAwLAogICAgYW5pbVN0YXRlczogWwogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcnLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uJywKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdob3VyZ2xhc3NfdG9wJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZWxsaXBzaXM6ICcuLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc19ib3R0b20nLAogICAgICAgIH0sCiAgICBdLAogICAgYW5pbVJhdGU6IDUwMCwKICAgIG9uQm90QWRkZWQ6IGBACiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIG9uQm90Q2hhbmdlZDogYEAKICAgICAgICBjb25zdCBuZWVkUmVmcmVzaCA9IHRoYXQudGFncy5zb21lKHQgPT4gdCA9PT0gJ2J1c3lMYWJlbCcgfHwgdCA9PT0gJ3N0YXRlJyB8fCB0ID09PSAnYW5pbVN0YXRlcycpOwogICAgICAgIGlmIChuZWVkUmVmcmVzaCkgewogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfQogICAgYCwKICAgIHJlZnJlc2hEaXNwbGF5OiBgQAogICAgICAgIGlmICh0YWdzLmFuaW1TdGF0ZXMgJiYgdGFncy5hbmltU3RhdGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgYW5pbVN0YXRlID0gdGFncy5hbmltU3RhdGVzW3RhZ3Muc3RhdGVdOwoKICAgICAgICAgICAgdGFncy5sYWJlbCA9IHRhZ3MuYnVzeUxhYmVsLnRyaW0oKSArIGFuaW1TdGF0ZS5lbGxpcHNpczsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGFuaW1TdGF0ZS5mb3JtQWRkcmVzczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdzLmxhYmVsIAogICAgICAgIH0KICAgIGAsCiAgICBhbmltYXRlOiBgQAogICAgICAgIGlmICh0YWdzLnN0YXRlID49IHRhZ3MuYW5pbVN0YXRlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3Muc3RhdGUgKz0gMTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLnNsZWVwKHRhZ3MuYW5pbVJhdGUpOwogICAgICAgIHRoaXNCb3QuYW5pbWF0ZSgpOwogICAgYCwKICAgIC4uLnJlc3QKfTsKCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihidXN5SW5kaWNhdG9yKTsKCnJldHVybiBtZW51Qm90OycA8IX5kwG8YwZzeXN0ZW0CBADwhfmTAYxwEWFiLmludGVyZmFjZS5tZW51JwDwhfmTAbxjBGZvcm0CBADwhfmTAZ5wB25vdGhpbmcnAPCF+ZMBvGMLZGVzY3JpcHRpb24CBADwhfmTAaZwJlRoaXMgc2tpbGwgaXMgZGVzaWduZWQgZm9yIG1lbnUgc3R1ZmYuKADwhfmTAbxjC2FiSW50ZXJmYWNlAXgnAPCF+ZMBvGMKYWJPcGVuTWVudQIEAPCF+ZMBznD3GEBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBtZW51VHlwZSA9IHRoYXQgPyAiYWIiICsgdGhhdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoYXQuc2xpY2UoMSkgKyAiTWVudSI6ICJhYkNvcmVNZW51IjsgLy9zZXQgdXAgYSBjaGVjayB0byBzZWUgd2hhdCB0eXBlIG9mIG1lbnUgc2hvdWxkIGJlIG9jY3VyaW5nIFtjb3JlLCBib3QsIGdyaWQsIGluc3RdCmxldCBtZW51U2tpbGxzID0gZ2V0Qm90cyhtZW51VHlwZSArICJBY3Rpb24iKTsKbGV0IG1heE9wdGlvbnMgPSBtZW51VHlwZSA9PSAiaW5zdCIgPyA3IDogNTsKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5wZXJzb25hbGl0eSA9IHRhZ3MucGVyc29uYWxpdHk7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKYWJNZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5iYXNlU2tpbGwuJHttZW51VHlwZSArICJBY3Rpb24ifSh7Ym90OiB0aGlzQm90fSk7YDsKCmxldCBzb3J0T3JkZXJJbmRleCA9IG1lbnVTa2lsbHMubGVuZ3RoOwpmb3IgKGxldCBpID0gMDsgaSA8IG1lbnVTa2lsbHMubGVuZ3RoOyBpKyspLy9BREQgTE9HSUMgRk9SIE1PUkUgT1BUSU9OUyBUSEFOIDUgOiBtYXhPcHRpb25zCnsKICAgIC8vQWxsb3dzIGZvciBjb2RlIHRvIGdldCBjYWxsZWQgYmVmb3JlIHRoZSBtZW51IGdlbmVyYXRlcywgdXNlZnVsIGZvciBkeW5hbWljYWxseSBzZXQgZ3JvdXBzIG9yIGRyb3Bkb3ducwogICAgaWYgKG1lbnVTa2lsbHNbaV0udGFnc1ttZW51VHlwZSArICJPbkJlZm9yZUNyZWF0ZSJdKSB7CiAgICAgICAgYXdhaXQgd2hpc3BlcihtZW51U2tpbGxzW2ldLCBtZW51VHlwZSArICJPbkJlZm9yZUNyZWF0ZSIpOwogICAgfSAKICAgIAogICAgbGV0IGN1cnJlbnRTa2lsbCA9IG1lbnVTa2lsbHNbaV07CgogICAgYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGN1cnJlbnRTa2lsbC5pZDsKICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkxhYmVsIl07CiAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJY29uIl07CiAgICBhYk1lbnVCdXR0b24ub25DcmVhdGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJPbkdlbmVyYXRlIl07CiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiU29ydE9yZGVyIl07CiAgICBhYk1lbnVCdXR0b24uY29sb3IgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdID8gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwoKICAgIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJkcm9wZG93biIpIHsKICAgICAgICBhYk1lbnVCdXR0b24uZHJvcGRvd25PcHRpb25zID0gY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25PcHRpb25zOwoKICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkl0ZW1UeXBlIl0gPT0gImdyb3VwIikgewogICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZ3JvdXBTb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5ncm91cFNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhYk1lbnVCdXR0b24ubWVudUl0ZW1zID0gY3VycmVudFNraWxsLnRhZ3MubWVudUl0ZW1zOwogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSXRlbVR5cGUiXSA9PSAiaW5wdXQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ0ZXh0IikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ0b29sIikgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdID09ICJ3aXphcmQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsKICAgIH0KfQoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7CgpzaG91dCgnb25BQk9wZW5NZW51JywgeyBtZW51OiB0aGF0LCBtZW51VHlwZSwgbWVudVBvcnRhbDogY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgfSk7JwDwhfmTAbxjEmFiQ3JlYXRlTWVudUJ1dHRvbgIEAPCF+ZMBxIkB+A1AbGV0IG5ld01lbnVCdXR0b24gPSB7fTsKCmxldCB7CiAgICBtZW51SXRlbVN0eWxlID0ge30sCiAgICAuLi5hZGRpdGlvbmFsVGFncwp9ID0gdGhhdCA/PyB7fQoKaWYgKHR5cGVvZiBtZW51SXRlbVN0eWxlID09ICdzdHJpbmcnKSB7CiAgICBtZW51SXRlbVN0eWxlID0gbWVudUl0ZW1TdHlsZS5yZXBsYWNlKC9cdXsxRjlFQ30vdSwgJycpOyAKICAgIG1lbnVJdGVtU3R5bGUgPSBKU09OLnBhcnNlKG1lbnVJdGVtU3R5bGUpOwp9CgpmdW5jdGlvbiBoYXNCb3JkZXJTdHlsZSgpIHsKICAgIGlmIChtZW51SXRlbVN0eWxlWyJib3JkZXItdG9wLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLWxlZnQtc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItYm90dG9tLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLXJpZ2h0LXN0eWxlIl0pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KCmlmIChhZGRpdGlvbmFsVGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSkgewogICAgaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiTWVudUdyb3VwIl0pIHsKCiAgICB9Cn0KCm5ld01lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwpuZXdNZW51QnV0dG9uLmxhYmVsQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3IgPz8gIiMwMDAiOwpuZXdNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwpuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yID0gdGhhdC5zaGFkb3dDb2xvciA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVNoYWRvd0NvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5zY2FsZVkgPSAxOwoKY29uc3QgbWVudVN0eWxpbmcgPSB7CiAgICAiYm9yZGVyLXJhZGl1cyI6IjhweCIsCiAgICAibWFyZ2luLXRvcCI6ICI4cHgiLAogICAgImJveC1zaGFkb3ciOiBgM3B4IDRweCAke25ld01lbnVCdXR0b24uc2hhZG93Q29sb3J9YCwKICAgICJtaW4taGVpZ2h0IjogIjQ0cHgiLAogICAgImJvcmRlciI6IGhhc0JvcmRlclN0eWxlKCkgPyAiIiA6IGAycHggc29saWQgJHtuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yfWAsCiAgICAid2lkdGgiOiAiY2FsYygxMDAlIC0gNXB4KSIsCiAgICAuLi5tZW51SXRlbVN0eWxlCn0KCm5ld01lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IG1lbnVTdHlsaW5nOwoKY29uc3QgY2xpY2tlZFN0eWxpbmcgPSB7CiAgICAuLi5tZW51U3R5bGluZywKICAgICJmaWx0ZXIiOiAiYnJpZ2h0bmVzcyg2MCUpIgp9CmNvbnN0IGJhc2VTdHlsZSA9IGBAIG1hc2tzLm1lbnVJdGVtU3R5bGUgPSAn8J+nrCAke0pTT04uc3RyaW5naWZ5KGNsaWNrZWRTdHlsaW5nKX0nYAoKbmV3TWVudUJ1dHRvbi5vblBvaW50ZXJEb3duID0gbWVudUl0ZW1TdHlsZT8uWyJtYXJnaW4tdG9wIl0gIT0gIjBweCIgPyBiYXNlU3R5bGUgOiAiQCAvLyI7Cm5ld01lbnVCdXR0b24ub25Qb2ludGVyVXAgPSBgQCBtYXNrcy5tZW51SXRlbVN0eWxlID0gbnVsbGA7Cgpmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykKewogICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsKfQoKbmV3TWVudUJ1dHRvbiA9IGNyZWF0ZShuZXdNZW51QnV0dG9uKTsKCnJldHVybiBuZXdNZW51QnV0dG9uOycA8IX5kwG8Yw1hYk1lbnVSZWZyZXNoAgQA8IX5kwG7lwGBAUBpZiAoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbD8uc3Vic3RyaW5nKDAsMikgPT0gImFiIikKewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKICAgIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKfScA8IX5kwG8YwhyZW1lbWJlcgIEAPCF+ZMBvZgBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAPCF+ZMBvGMNbWFuaWZlc3RhdGlvbgIEAPCF+ZMB5JgBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAPCF+ZMBvGMRYWJFbnZpcm9ubWVudE1lbnUCBADwhfmTAYuZAekuQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKCmNvbnN0IGFiRW52aXJvbm1lbnRPcHRpb25zID0gdGhpc0JvdC5hYkdldEVudmlyb25tZW50T3B0aW9ucygpOwoKYnV0dG9uTG9vcDoKZm9yIChsZXQgaSA9IDA7IGkgPCBhYkVudmlyb25tZW50T3B0aW9ucy5sZW5ndGg7IGkrKykKewogICAgbGV0IGFjdGl2ZUJ1dHRvbiA9IGFiRW52aXJvbm1lbnRPcHRpb25zW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBhY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI7CgogICAgaWYgKGFjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZSkKICAgIHsKICAgICAgICBpZiAoIWxpbmtzW2FjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZV0pCiAgICAgICAgewogICAgICAgICAgICBjb250aW51ZSBidXR0b25Mb29wOwogICAgICAgIH0KICAgIH0KCiAgICBsZXQgbmV3QnV0dG9uRGF0YSA9IHsuLi5hYk1lbnVCdXR0b24sIC4uLmFjdGl2ZUJ1dHRvbn07CgogICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3QnV0dG9uRGF0YSk7Cn0KCmNvbnN0IGFiUGVyc29uYWxpdHlDb25maWdCdXR0b24gPSB7CiAgICBsYWJlbDogImN1c3RvbWl6ZTogYWIgcGVyc29uYWxpdHkiLAogICAgLi4uYWJNZW51QnV0dG9uLAogICAgYWJNZW51U29ydE9yZGVyOiAxLAogICAgZHJvcGRvd25Tb3J0T3JkZXI6IDEsCiAgICBkcm9wZG93bk9wdGlvbnM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbmFtZTogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksIHt0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgdG8gY2FsbCBtZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bmFtZTogbmFtZX0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAgIGxhYmVsOiBgYWkgbW9kZWw6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWx9YCwKICAgICAgICAvLyAgICAgZm9ybUFkZHJlc3M6ICJjdWJlIiwKICAgICAgICAvLyAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgIC8vICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAvLyAgICAgICAgIGNvbnN0IGFpTW9kZWwgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwsIHt0aXRsZTogJ3doYXQgYWkgbW9kZWwgd291bGQgeW91IGxpa2UgbWUgdG8gdXNlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHthaU1vZGVsOiBhaU1vZGVsfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAvLyAgICAgYCwKICAgICAgICAvLyB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbWUgdG8gYmU/J30pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge2NvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgIGAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvciwge3R5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51cyB0byBiZT8nfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7bWVudUNvbG9yOiBjb2xvcn0pOyAKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7YCwKICAgICAgICAgICAgICAgIC8vbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvciA9IGNvbG9yOyBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciAhPSAnY2xlYXInKXtsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yID0gY29sb3J9OyBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSB0ZXh0IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUxhYmVsQ29sb3IsIHt0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgbWVudSB0ZXh0IHRvIGJlPyd9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHttZW51TGFiZWxDb2xvcjogY29sb3J9KTsgCiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpO2AsCiAgICAgICAgICAgICAgICAvL2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IgPSBjb2xvcjsgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3IgIT0gJ2NsZWFyJyl7bGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvciA9IGNvbG9yfTsgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGRlZmF1bHQgcG9ydGFsIGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yID8/ICcjMjYzMjM4J31gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIC4uLmFiTWVudUJ1dHRvbiwKICAgICAgICAgICAgb25DbGljazogYEAgCiAgICAgICAgICAgICAgICBsZXQgcG9ydGFsQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnLCB7dHlwZTogJ2NvbG9yJywgdGl0bGU6ICd3aGF0IHdvdWxkIHlvdSBsaWtlIHlvdXIgcG9ydGFsIHRvIGxvb2sgbGlrZT8nfSk7CiAgICAgICAgICAgICAgICBpZiAoIXBvcnRhbENvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgcG9ydGFsQ29sb3IgPSAnIzI2MzIzOCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaG91dCgnY2hhbmdlUGVyc29uYWxpdHlDb25maWcnLCB7J3BvcnRhbENvbG9yJzogcG9ydGFsQ29sb3J9KTsgCiAgICAgICAgICAgICAgICAvL2Rlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICJkZWZhdWx0IHNldHRpbmdzIiwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICAgICAgICAgIGNvbG9yOiAncmVkJywKICAgICAgICAgICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgICAgICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgICAgICBvbkNsaWNrOiBgQCAKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsnZGVmYXVsdFBlcnNvbmFsaXR5JzogdHJ1ZX0pOyAKICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICBgLAogICAgICAgIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogIm1lbnUgY29sb3IiLAogICAgICAgIC8vICAgICAgLi4uYWJNZW51QnV0dG9uLAogICAgICAgIC8vICAgICAgb25DbGljazogYEAgCiAgICAgICAgLy8gICAgICAgICBjb25zdCBtZW51Q29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQoYWJQZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvciwge3RpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51J3MgdG8gYmU/J30pOwogICAgICAgIC8vICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywge21lbnVDb2xvcjogbWVudUNvbG9yfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIC8vIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgICBsYWJlbDogInByb21wdCIsCiAgICAgICAgLy8gICAgIG9uQ2xpY2s6IGBAYCwKICAgICAgICAvLyB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgICAgbGFiZWw6ICJmb3JtIiwKICAgICAgICAvLyAgICAgb25DbGljazogYEAgCiAgICAgICAgLy8gICAgICAgICBjb25zdCBmb3JtID0gYXdhaXQgb3Muc2hvd0lucHV0KGFiUGVyc29uYWxpdHkudGFncy5hYkZvcm0sIHt0aXRsZTogJ3doYXQgZm9ybSB3b3VsZCB5b3UgbGlrZSBtZSB0byB0YWtlPyd9KTsKICAgICAgICAvLyAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHtmb3JtOiBmb3JtfSk7IAogICAgICAgIC8vICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtgLAogICAgICAgIC8vIH0KICAgIF0KfQoKdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bihhYlBlcnNvbmFsaXR5Q29uZmlnQnV0dG9uKTsKCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsiOwoKc2hvdXQoJ29uQUJFbnZpcm9ubWVudE1lbnUnLCB7IG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWx9ICknAPCF+ZMBvGMFbGVhcm4CBADwhfmTAfXHASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDwhfmTAbxjA2dwdAIEAPCF+ZMBnMgBKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnAPCF+ZMBvGMIYWJJZ25vcmUCBADwhfmTAcPIAQR0cnVlJwDwhfmTAbxjBnNlYXJjaAIEAPCF+ZMByMgBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAPCF+ZMBvGMGbnVnZ2V0AgQA8IX5kwHvyAEo8J+UlzRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZicA8IX5kwG8YwV0ZXN0cwIEAPCF+ZMBlskBKPCflJdiODNkOTcyYi0wNTM1LTQwNTEtYjU4OS00MWNlZGE4NTM1ZjEnAPCF+ZMBvGMPb25Qb3J0YWxDaGFuZ2VkAgQA8IX5kwG9yQFuQGlmICh0aGF0LnBvcnRhbCA9PSAic3lzdGVtUG9ydGFsIiAmJiAhdGhhdC5kaW1lbnNpb24gJiYgIWxpbmtzLnRlc3RzKQp7CiAgICBsaW5rcy5sZWFybi5hYkFkYXB0KCJhYlRlc3RzIik7Cn0nAPCF+ZMBvGMDYXNrAgQA8IX5kwGsygEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycA8IX5kwG8YwlhYlZlcnNpb24CBADwhfmTAdPKAQQxMC42JwDwhfmTAbxjEWFiQ3JlYXRlTWVudUlucHV0AgQA8IX5kwHYygGeAkBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmxldCBtZW51SW5wdXQgPSB7DQogICAgZm9ybTogImlucHV0IiwNCiAgICBtZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHk6IGZhbHNlLA0KICAgIGZvcm1JbnB1dE11bHRpbGluZTogbnVsbCwNCiAgICBvblBvaW50ZXJVcDogbnVsbCwNCiAgICBvblBvaW50ZXJEb3duOiBudWxsLA0KICAgIC4uLnRoYXQNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51SW5wdXQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAPCF+ZMBvGMQYWJDcmVhdGVNZW51VGV4dAIEAPCF+ZMB98wBgQRAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpjb25zdCB7DQogICAgbWVudUl0ZW1MYWJlbFN0eWxlLA0KICAgIC4uLnJlc3QNCn0gPSB0aGF0Ow0KDQpsZXQgbWVudVRleHQgPSB7DQogICAgZm9ybTogInRleHQiLA0KICAgIG9uUG9pbnRlclVwOiBudWxsLA0KICAgIG9uUG9pbnRlckRvd246IG51bGwsDQogICAgcG9pbnRhYmxlOiBmYWxzZSwNCiAgICBjb2xvcjogIndoaXRlIiwNCiAgICBtZW51SXRlbVN0eWxlOiB7DQogICAgICAgICJwYWRkaW5nLXRvcCI6ICI2cHgiLA0KICAgICAgICAicGFkZGluZy1ib3R0b20iOiAiNnB4IiwNCiAgICB9LA0KICAgIG1lbnVJdGVtTGFiZWxTdHlsZTogew0KICAgICAgICAid2hpdGUtc3BhY2UiOiAicHJlLXdyYXAiLA0KICAgICAgICAuLi5tZW51SXRlbUxhYmVsU3R5bGUsDQogICAgfSwNCiAgICAuLi5yZXN0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVRleHQpOw0KDQpyZXR1cm4gbWVudUJvdDsnAPCF+ZMBvGMQYWJDcmVhdGVNZW51VG9vbAIEAPCF+ZMB+dABjgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVRvb2wgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUb29sKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwDwhfmTAbxjEmFiQ3JlYXRlTWVudVdpemFyZAIEAPCF+ZMBiNIBkgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVdpemFyZCA9IHsNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudVdpemFyZCk7DQoNCnJldHVybiBtZW51Qm90OycA8IX5kwG8YxRhYkNyZWF0ZU1lbnVEcm9wZG93bgIEAPCF+ZMBm9MB1RhAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAoIXRoYXQuZHJvcGRvd25Tb3J0T3JkZXIpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudURyb3Bkb3duOiBkcm9wZG93blNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCBvdXRlck1lbnVCdXR0b24gPSB7DQogICAgLi4udGhhdCwNCiAgICBmb3JtQWRkcmVzczogdGhhdC5mb3JtQWRkcmVzcyA/PyAiYXJyb3dfcmlnaHQiLA0KICAgIGRyb3Bkb3duT3BlbjogZmFsc2UsDQogICAgb25DbGljazogYEANCiAgICAgICAgdGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gJHt0aGF0LmRyb3Bkb3duU29ydE9yZGVyfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gZmFsc2U7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyh0YWdzLmRyb3Bkb3duT3B0aW9ucywgdGFncy5kcm9wZG93blNvcnRPcmRlcik7DQogICAgICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkRlc3Ryb3k6IGBADQogICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgYCwNCiAgICBvblBvaW50ZXJVcDogYEANCiAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgbWFza3MuZm9ybUFkZHJlc3MgPSAiYXJyb3dfcmlnaHQiOw0KICAgICAgICB9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3BlbiA9PSBmYWxzZSkgew0KICAgICAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAiZm9ybUFkZHJlc3MiLCAiYXJyb3dfZHJvcF9kb3duIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJtZW51SXRlbVN0eWxlIiwgey4uLnRhZ3MubWVudUl0ZW1TdHlsZSwgImJvcmRlckJvdHRvbUxlZnRSYWRpdXMiOiAiMCIsICJib3JkZXJCb3R0b21SaWdodFJhZGl1cyI6ICIwIn0pOw0KICAgICAgICB9DQogICAgYA0KfTsNCg0KaWYgKHRoYXQuZm9ybUFkZHJlc3MgJiYgdGhhdC5mb3JtQWRkcmVzcyAhPSAiYXJyb3dfcmlnaHQiKSB7DQogICAgb3V0ZXJNZW51QnV0dG9uLmN1c3RvbUZvcm1BZGRyZXNzID0gdHJ1ZTsNCn0NCm91dGVyTWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gdGhhdC5kcm9wZG93blNvcnRPcmRlcjsNCg0KY29uc3QgbWVudUJvdCA9IGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG91dGVyTWVudUJ1dHRvbik7DQptZW51Qm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyA9IGdlbmVyYXRlTWVudU9wdGlvbnM7DQoNCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlTWVudU9wdGlvbnMgKG9wdGlvbnMsIHNvcnRPcmRlcikgew0KICAgIGNvbnN0IG1lbnVCb3RzID0gW107DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgKytpKSB7DQoNCiAgICAgICAgbGV0IG5ld01lbnVCdXR0b24gPSB7DQogICAgICAgICAgICAuLi5vcHRpb25zW2ldLA0KICAgICAgICAgICAgY2xlYXJEcm9wZG93bk1lbnU6IGBADQogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsNCiAgICAgICAgICAgIGANCiAgICAgICAgfTsNCg0KICAgICAgICBuZXdNZW51QnV0dG9uW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiU29ydE9yZGVyIl0gPSBOdW1iZXIoc29ydE9yZGVyKSArICgoaSArIDEpIC8gMTAwMCk7DQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbF0gPSB0cnVlOw0KDQogICAgICAgIGlmIChpID09IG9wdGlvbnMubGVuZ3RoIC0gMSkgew0KICAgICAgICAgICAgaWYgKG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyUmFkaXVzIl0gPSAiMCAwIDhweCA4cHgiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSB7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogIjAgMCA4cHggOHB4Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyUmFkaXVzIl0gPSAiMCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bImJvcmRlclRvcCJdID0gIm5vbmUiOw0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bIm1hcmdpblRvcCJdID0gIjAiOw0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl1bInBhZGRpbmdMZWZ0Il0gPSAiMzVweCI7DQoNCiAgICAgICAgY29uc3QgbmV3TWVudUJvdCA9IGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld01lbnVCdXR0b24pOw0KICAgICAgICBtZW51Qm90cy5wdXNoKG5ld01lbnVCb3QpOw0KICAgIH0NCg0KICAgIG1lbnVCb3QudGFncy5tZW51Qm90cyA9IGdldExpbmsobWVudUJvdHMpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdDsNCg0KJwDwhfmTAbxjEWFiQ3JlYXRlTWVudUdyb3VwAgQA8IX5kwHx6wHcHUAvKg0KICAgRVhBTVBMRQ0KICAgY29uc3QgbWVudUdyb3VwID0gew0KICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICBncm91cFNvcnRPcmRlcjogMSwNCiAgICAgICAgbWVudUl0ZW1zOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAyIiwNCiAgICAgICAgICAgICAgICBjb2xvcjogIm9yYW5nZSIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBsYWJlbDogImdyb3VwIG9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgbWVudUl0ZW1UeXBlOiAiZHJvcGRvd24iLA0KICAgICAgICAgICAgICAgIGRyb3Bkb3duT3B0aW9uczogWw0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAxIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDMiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfQ0KKi8NCg0KaWYgICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCF0aGF0Lmdyb3VwU29ydE9yZGVyKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKGBhYkNyZWF0ZU1lbnVHcm91cDogZ3JvdXBTb3J0T3JkZXIgaXMgbm90IHByb3ZpZGVkLmApOw0KfQ0KDQpsZXQgew0KICAgIG1lbnVJdGVtU3R5bGUgPSB7fSwNCiAgICBtZW51SXRlbXMgPSBbXSwNCiAgICAuLi5hZGRpdGlvbmFsVGFncw0KfSA9IHRoYXQgPz8ge30NCg0KY29uc3QgbWVudUJvdHMgPSBbXTsNCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudUl0ZW1zLmxlbmd0aDsgKytpKSB7DQoNCiAgICBsZXQgbmV3TWVudUJ1dHRvbiA9IHt9Ow0KDQogICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gTnVtYmVyKHRoYXQuZ3JvdXBTb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDApOw0KDQogICAgbGV0IGluZGl2TWVudUl0ZW1TdHlsZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVN0eWxlID8/IHt9Ow0KICAgIGxldCBpbmRpdk1lbnVUeXBlID0gbWVudUl0ZW1zW2ldLm1lbnVJdGVtVHlwZSA/PyB1bmRlZmluZWQ7DQogICAgbGV0IGluZGl2QWRkaXRpb25hbFRhZ3MgPSBtZW51SXRlbXNbaV07DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXSkgew0KICAgICAgICBkZWxldGUgaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1TdHlsZSJdOw0KICAgIH0NCiAgICBpZiAoaW5kaXZBZGRpdGlvbmFsVGFnc1sibWVudUl0ZW1UeXBlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdOw0KICAgIH0NCg0KICAgIGNvbnN0IGJhc2VTdHlsaW5nID0gew0KICAgICAgICAiYm9yZGVyVG9wIjogIm5vbmUiLA0KICAgICAgICAibWFyZ2luVG9wIjogIjAiDQogICAgfQ0KDQogICAgaWYgKGkgPT0gbWVudUl0ZW1zLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCAwIDhweCA4cHgiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfSBlbHNlIGlmIChpID09IDApIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjhweCA4cHggMCAwIiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nO30NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbWVudVN0eWxpbmcgPSB7DQogICAgICAgICAgICAuLi5iYXNlU3R5bGluZywNCiAgICAgICAgICAgICJib3JkZXJSYWRpdXMiOiAiMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzsNCiAgICB9DQoNCiAgICBmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gaW5kaXZBZGRpdGlvbmFsVGFncykNCiAgICB7DQogICAgICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGluZGl2QWRkaXRpb25hbFRhZ3NbdGFnXTsNCiAgICB9DQoNCiAgICBsZXQgbmV3TWVudUJvdDsNCiAgICBzd2l0Y2goaW5kaXZNZW51VHlwZSkgew0KICAgICAgICBjYXNlICJkcm9wZG93biI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVEcm9wZG93bigNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC4uLm5ld01lbnVCdXR0b24sDQogICAgICAgICAgICAgICAgICAgICJkcm9wZG93blNvcnRPcmRlciI6IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTApDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiaW5wdXQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidGV4dCI6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRvb2wiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ3aXphcmQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6IA0KICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICB9DQogICAgbWVudUJvdHMucHVzaChuZXdNZW51Qm90KTsNCn0NCg0KcmV0dXJuIG1lbnVCb3RzOycA8IX5kwG8YwtwZXJzb25hbGl0eQIEAPCF+ZMBzokCKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAPCF+ZMBvGMXYWJHZXRFbnZpcm9ubWVudE9wdGlvbnMCBADwhfmTAfWJAtQjQGNvbnN0IG9wdGlvbnMgPSBbXTsKCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJoaWRlIiwKICAgICAgICBmb3JtQWRkcmVzczogInZpc2liaWxpdHlfb2ZmIiwKICAgICAgICBvbkNsaWNrOiAiQCBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOyIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDAKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogIm9wdGltaXplIG1vZGUiLAogICAgb25DcmVhdGU6ICJAIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnIDogdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIG9uQ2xpY2s6ICJAIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSBmYWxzZSA6IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gdHJ1ZTsgdGhpc0JvdC5vbkNyZWF0ZSgpOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMQp9KQoKaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInNsZWVwIiwKICAgICAgICBmb3JtQWRkcmVzczogIm5pZ2h0c19zdGF5IiwKICAgICAgICBvbkNsaWNrOiAiQGxpbmtzLm1hbmlmZXN0YXRpb24uYWJTZXRBd2FrZSh7IGF3YWtlOiBmYWxzZSB9KSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDMKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoYXQiLAogICAgZm9ybUFkZHJlc3M6ICJjaGF0IiwKICAgIG9uQ2xpY2s6ICJAIHNob3V0KCdhYkNoYXRCYXJPcGVuJyk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA0Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJudWdnZXRzIiwKICAgIG9uQ3JlYXRlOiAiQCB0YWdzLm51Z01hbmFnZXIgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmludGVyZmFjZS5udWdnZXQnKSk7IGlmIChsaW5rcy5udWdNYW5hZ2VyLnRhZ3MubGlzdGVuaW5nKXt0YWdzLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgbnVsbCk7YDt0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveGA7fWVsc2V7ICAgIHRhZ3Mub25DbGljayA9IGBAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCB0cnVlLCAnbG9jYWwnKTtgOyAgICB0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveF9vdXRsaW5lX2JsYW5rYDt9IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1Cn0pCgpvcHRpb25zLnB1c2goewogICAgYWJFbnZpcm9ubWVudEdhdGU6ICJncHQiLAogICAgb25DcmVhdGU6ICJAICBpZiAoIWF1dGhCb3Qpe2Rlc3Ryb3kodGhpc0JvdCk7fWVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICdGcmVlUGxheScgfHwgYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gdW5kZWZpbmVkKXtkZXN0cm95KHRoaXNCb3QpO307IHRhZ3MubGFiZWwgPSAnZWRpdCAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgcHJvbXB0JzsgdGFncy5ncHRCb3QgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmFjdGlvbi5hc2snKSk7IiwKICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLmdwdEJvdC5lZGl0UHJvbXB0KCk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA3Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJncmlkIHNuYXAiLAogICAgb25DcmVhdGU6ICJAIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJyIsCiAgICBvbkNsaWNrOiAiQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA9ICFsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZTt0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA4Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJib3Qgc25hcCIsCiAgICBvbkNyZWF0ZTogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIG9uQ2xpY2s6ICJAIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkJvdFNuYXBTdGF0ZTsgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA5Cn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJhY2NvdW50IiwKICAgIGZvcm1BZGRyZXNzOiAiYmFkZ2UiLAogICAgb25DbGljazogIkAgb3Muc2hvd0FjY291bnRJbmZvKCk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGFiRW52aXJvbm1lbnRHYXRlOiAidGVzdHMiLAogICAgbGFiZWw6ICJyZWNvcmQgdGVzdCIsCiAgICBmb3JtQWRkcmVzczogInNjaWVuY2UiLAogICAgb25LZXlEb3duOiAiQCAiLAogICAgb25LZXlVcDogIkAgIiwKICAgIG9uQ2xpY2s6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRlc3QnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTEKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBhYkVudmlyb25tZW50R2F0ZTogInRlc3RzIiwKICAgIGxhYmVsOiAicmVjb3JkIHRyYWNlIiwKICAgIGZvcm1BZGRyZXNzOiAidGltZWxpbmUiLAogICAgb25LZXlEb3duOiAiQCAiLAogICAgb25LZXlVcDogIkAgIiwKICAgIG9uQ2xpY2s6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRyYWNlJyk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDEyCn0pCgpvcHRpb25zLnB1c2goewogICAgb25DcmVhdGU6IGBACiAgICAgICAgdGFncy5sYWJlbCA9ICJwZXJtYW5lbnRseSBkZWxldGUgIiArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7CiAgICAgICAgdGFncy5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29udHJhc3RDb2xvciA/PyAiI0Q5MzAzMCI7CiAgICBgLAogICAgZm9ybUFkZHJlc3M6ICJkZWxldGVfZm9yZXZlciIsCiAgICBvbkNsaWNrOiBgQAogICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IG9zLnNob3dDb25maXJtKHsKICAgICAgICAgICAgdGl0bGU6ICdQZXJtYW5lbnRseSBkZWxldGUgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgIGNvbnRlbnQ6ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlICcgKyAgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgZnJvbSAnICsgbGlua3MubGVhcm4udGFncy5hYkluc3QgKyAnPyBUaGlzIGlzIG5vdCByZXZlcnNpYmxlIScsCiAgICAgICAgfSkKCiAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKCiAgICAgICAgY29uc3QgYWJCb3RzID0gZ2V0Qm90cygoYikgPT4gewogICAgICAgICAgICByZXR1cm4gYi5zcGFjZSA9PT0gJ3NoYXJlZCcgJiYKICAgICAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtICYmCiAgICAgICAgICAgICAgICAgICAgYi50YWdzLnN5c3RlbS5zdGFydHNXaXRoKCdhYicpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgIGRlc3Ryb3koYWJCb3RzKTsKICAgICAgICB9CiAgICBgLAogICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMDAKfSkKCnJldHVybiBvcHRpb25zOycA8IX5kwG8Yx5hYkNyZWF0ZVRvb2xib3hEcm9wZG93bk9wdGlvbnMCBADwhfmTAcqtAsQMQGNvbnN0IHRvb2xib3hUb29scyA9IFsuLi50aGF0LnRvb2xBcnJheV0gPz8gW107DQpjb25zdCB0b29sYm94TmFtZSA9IHRoYXQudG9vbGJveE5hbWUgPz8gIktpdCAiOw0KY29uc3QgdG9vbGJveCA9IHRoYXQudG9vbGJveDsNCmNvbnN0IGdyaWRJbmZvcm1hdGlvbiA9ICh0aGF0Py5ncmlkSW5mb3JtYXRpb24gJiYgdGhhdD8uZ3JpZEluZm9ybWF0aW9uICE9IHVuZGVmaW5lZCkgPyB0aGF0Py5ncmlkSW5mb3JtYXRpb24gOiBhYlJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQoNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMudG9vbGJveCA9IGdldExpbmsodG9vbGJveCk7DQptZW51T3B0aW9ucy5ncmlkSW5mb3JtYXRpb24gPSBncmlkSW5mb3JtYXRpb247DQptZW51T3B0aW9ucy5zZWFyY2ggPSB0YWdzLnNlYXJjaDsNCi8vbWVudU9wdGlvbnMuZm9ybUFkZHJlc3MgPSAiaGFyZHdhcmUiOw0KDQppZiAodG9vbGJveFRvb2xzLmxlbmd0aCA9PT0gMCkgew0KICAgIGNvbnN0IG1lc3NhZ2UgPSB0b29sYm94TmFtZSArICIgZG9lcyBub3QgaGF2ZSBhbnkgdG9vbHMgbGlzdGVkIGluIHRoZSB0b29sX2FycmF5IHRhZyI7DQoNCiAgICBhYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIG1lc3NhZ2UpOw0KICAgIG9zLnRvYXN0KG1lc3NhZ2UsIDUpOw0KICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7DQp9DQoNCmZvciAobGV0IHRvb2wgb2YgdG9vbGJveFRvb2xzKSB7DQogICAgY29uc3QgdG9vbEJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiB0b29sLm5hbWUsDQogICAgICAgIHRhcmdldEFCOiB0b29sLnRhcmdldEFCLA0KICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQXNrSUQoew0KICAgICAgICAgICAgICAgIGFza0lEOiB0YWdzLnRhcmdldEFCLA0KICAgICAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAndG9vbCcsDQogICAgICAgICAgICAgICAgZWdnUGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiB0YWdzLnRvb2xib3gsDQogICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICBgLA0KICAgIH07DQoNCiAgICBpZiAodG9vbC5mb3JtQWRkcmVzcykgew0KICAgICAgICB0b29sQnV0dG9uLmZvcm1BZGRyZXNzID0gdG9vbC5mb3JtQWRkcmVzczsNCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaCh0b29sQnV0dG9uKTsNCn0NCg0KcmV0dXJuIGRyb3Bkb3duT3B0aW9uczsA"}]}