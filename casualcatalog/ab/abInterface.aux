{"version":2,"updates":[{"id":0,"timestamp":1770673663476,"update":"AYsCu7Db5AgAJwEEYm90cyQxMzY3MjI1My0yNTM2LTQwODYtOTVjZi1lYjE2ZmZjY2U0ZGQBJwC7sNvkCAAGc3lzdGVtAgQAu7Db5AgBEmFiLmludGVyZmFjZS5zb3VuZCcAu7Db5AgACGFiSWdub3JlAgQAu7Db5AgUBHRydWUnALuw2+QIAAthYkludGVyZmFjZQIEALuw2+QIGQR0cnVlJwC7sNvkCAALZGVzY3JpcHRpb24CBAC7sNvkCB6lAXRoaXMgc2tpbGwgaXMgYSBtYW5hZ2VyIGZvciBzb3VuZHMNCnN1cHBvcnRlZCB0YWdzOg0KICAgIHNvdW5kQ3JlYXRlDQogICAgc291bmRDbGljaw0KICAgIHNvdW5kRHJhZw0KICAgIHNvdW5kRHJvcA0KICAgIHNvdW5kUG9pbnRlckVudGVyDQogICAgc291bmRQb2ludGVyRXhpdA0KICAgICcAu7Db5AgABGZvcm0CBAC7sNvkCMQBB25vdGhpbmcnALuw2+QIAAhyZW1lbWJlcgIEALuw2+QIzAEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAu7Db5AgAD29uQW55Qm90Q2xpY2tlZAIEALuw2+QI8wFbQGlmICh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kQ2xpY2spIHsNCiAgICB0aGlzQm90LnBsYXlTb3VuZCh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kQ2xpY2spOw0KfScAu7Db5AgADG9uQW55Qm90RHJhZwIEALuw2+QIzwJZQGlmICh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kRHJhZykgew0KICAgIHRoaXNCb3QucGxheVNvdW5kKHRoYXQ/LmJvdD8udGFncz8uc291bmREcmFnKTsNCn0nALuw2+QIAAlwbGF5U291bmQCBAC7sNvkCKkD9AFAaWYgKHRoYXQpIHsNCiAgICBpZiAodGhhdC5zdGFydHNXaXRoKCdodHRwczovLycpKSB7DQogICAgICAgIG9zLnBsYXlTb3VuZCh0aGF0KTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb25zdCBzb3VuZFVSTCA9IGF3YWl0IGFiLmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKHRoYXQpOw0KICAgICAgICBpZiAoc291bmRVUkwpIHsNCiAgICAgICAgICAgIG9zLnBsYXlTb3VuZChzb3VuZFVSTCk7DQogICAgICAgIH0NCiAgICB9DQp9JwC7sNvkCAAMb25BbnlCb3REcm9wAgQAu7Db5AieBVlAaWYgKHRoYXQ/LmJvdD8udGFncz8uc291bmREcm9wKSB7DQogICAgdGhpc0JvdC5wbGF5U291bmQodGhhdD8uYm90Py50YWdzPy5zb3VuZERyb3ApOw0KfScAu7Db5AgAFG9uQW55Qm90UG9pbnRlckVudGVyAgQAu7Db5Aj4BWlAaWYgKHRoYXQ/LmJvdD8udGFncz8uc291bmRQb2ludGVyRW50ZXIpIHsNCiAgICB0aGlzQm90LnBsYXlTb3VuZCh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kUG9pbnRlckVudGVyKTsNCn0nALuw2+QIABNvbkFueUJvdFBvaW50ZXJFeGl0AgQAu7Db5AjiBmVAaWYgKHRoYXQ/LmJvdD8udGFncz8uc291bmRQb2ludGVyRXhpdCkgewogICAgdGhpc0JvdC5wbGF5U291bmQodGhhdD8uYm90Py50YWdzPy5zb3VuZFBvaW50ZXJFeGl0KTsKfScAu7Db5AgAC29uQW55Q3JlYXRlAgQAu7Db5AjIB11AaWYgKHRoYXQ/LmJvdD8udGFncz8uc291bmRDcmVhdGUpIHsNCiAgICB0aGlzQm90LnBsYXlTb3VuZCh0aGF0Py5ib3Q/LnRhZ3M/LnNvdW5kQ3JlYXRlKTsNCn0nALuw2+QIAAlhYlZlcnNpb24CBAC7sNvkCKYIBTEwLjM3JwEEYm90cyQxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDIBJwC7sNvkCKwICmFiSURPcmlnaW4CBAC7sNvkCK0IDXRvb2xib3hfc2tpbGwnALuw2+QIrAgLYWJJbnRlcmZhY2UCBAC7sNvkCLsIBHRydWUnALuw2+QIrAgLZGVzY3JpcHRpb24CBAC7sNvkCMAIKVRoaXMgc2tpbGwgaXMgYW4gaW50ZXJmYWNlIGZvciB0b29sYm94ZXMuJwC7sNvkCKwIBGZvcm0CBAC7sNvkCOoIB25vdGhpbmcnALuw2+QIrAgEbWVudQIEALuw2+QI8ggo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAu7Db5AisCAZzeXN0ZW0CBAC7sNvkCJkJFGFiLmludGVyZmFjZS50b29sYm94JwC7sNvkCKwICmFiSURTdHVkaW8CBAC7sNvkCK4JJGU5MWVhYjBkLTZhNzUtNGFiOS04YTBlLTUwYTRjYzBjMWQzNCcAu7Db5AisCAhyZW1lbWJlcgIEALuw2+QI0wko8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAu7Db5AisCAt0b29sYm94X2FkZAIEALuw2+QI+gnIC0Bjb25zdCB0b29sYm94RGF0YSA9IHRoYXQudG9vbGJveERhdGE7CmNvbnN0IHRvb2xib3hUaXRsZSA9IHRvb2xib3hEYXRhLnRpdGxlOwpjb25zdCB0b29sYm94TmFtZSA9IHRvb2xib3hEYXRhLm5hbWU7CmNvbnN0IHRvb2xib3hTdHVkaW8gPSB0b29sYm94RGF0YS5zdHVkaW87CmNvbnN0IGdyaWREYXRhID0gdGhhdC5ncmlkRGF0YTsKCi8vTE9BRElORyBCQVI/CgppZiAoIWxpbmtzLnNoZWxsVXRpbHMpIHsKICAgIC8vIE5lZWQgYWJTaGVsbCB0byB1c2UgaXQncyBhYkxvZyBmdW5jdGlvbi4KICAgIGxpbmtzLmxlYXJuLmFiQWRhcHQoJ2FiU2hlbGwnKTsKfQoKaWYgKHRvb2xib3hTdHVkaW8gPT0gZmFsc2UpIHsKICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQodG9vbGJveE5hbWUpOwogICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwp9CmVsc2UgewogICAgY29uc3QgdG9vbGJveExvb2t1cCA9IGF3YWl0IGxpbmtzLnNlYXJjaC5oYXRjaCh7IGFiSUQ6IHRvb2xib3hOYW1lLCByZWNvcmRLZXk6IHRvb2xib3hTdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZSB9KTsKCiAgICBpZiAodG9vbGJveExvb2t1cC5zdWNjZXNzKSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyhgJHt0b29sYm94VGl0bGUgPz8gdG9vbGJveE5hbWV9IGxvYWRlZGApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3Muc2hlbGxVdGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBpc3N1ZSBsb2FkaW5nICR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfSwgcGxlYXNlIHRyeSBhZ2FpbmAsIGxvZ1R5cGU6ICdlcnJvcicgfSk7CiAgICB9Cn0KCmNvbnN0IGFjdGl2ZVRvb2xib3ggPSBnZXRCb3QoInN5c3RlbSIsIGBhYi50b29sYm94LiR7dG9vbGJveFRpdGxlID8/IHRvb2xib3hOYW1lfWApOwoKaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZSkgewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSBncmlkRGF0YTsKICAgIGF3YWl0IGFiLmxpbmtzLm1lbnUuYWJPcGVuTWVudSgiZ3JpZCIpOwogICAgY29uc3QgbWVudUJvdCA9IGdldEJvdCgiYmFzZVNraWxsIiwgZ2V0TGluayhhY3RpdmVUb29sYm94KSk7CiAgICBpZiAobWVudUJvdCkgewogICAgICAgIG1lbnVCb3Qub25Qb2ludGVyVXAoKTsKICAgICAgICBtZW51Qm90Lm9uQ2xpY2soKTsKICAgIH0KfQplbHNlIGlmIChhY3RpdmVUb29sYm94ICYmIGFjdGl2ZVRvb2xib3gudGFncy5hYkdyaWRNZW51QWN0aW9uKSB7CiAgICBhY3RpdmVUb29sYm94LmFiR3JpZE1lbnVBY3Rpb24oeyBncmlkSW5mb3JtYXRpb246IGdyaWREYXRhIH0pOwp9CmVsc2UgaWYgKGFjdGl2ZVRvb2xib3ggJiYgYWN0aXZlVG9vbGJveC50YWdzLmFiQ29yZU1lbnVBY3Rpb24pIHsKICAgIC8vUkVGUkVTSCBBTkQgVEhFTiBPUEVOPz8/Cn0nALuw2+QIrAgFbGVhcm4CBAC7sNvkCMMVKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnALuw2+QIrAgFc3RvcmUCBAC7sNvkCOoVKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnALuw2+QIrAgGc2VhcmNoAgQAu7Db5AiRFijwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwC7sNvkCKwICGFiSWdub3JlAgQAu7Db5Ai4FgR0cnVlJwC7sNvkCKwICWFiVmVyc2lvbgIEALuw2+QIvRYFMTAuMzcnALuw2+QIrAgNbWFuaWZlc3RhdGlvbgIEALuw2+QIwxYo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAu7Db5AisCBBhYkdyaWRNZW51QWN0aW9uAgQAu7Db5AjqFrkLQC8vIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgovLyBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKLy8gdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACi8vICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwovLyAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7Ci8vIGA7Ci8vIHRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKLy8gICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7Ci8vICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKLy8gICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKLy8gICAgIH0KLy8gYDsKLy8gdGhpc0JvdC5tYXNrcy5hYk1lbnVSZWZyZXNoID0gYEAKLy8gICAgIHRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwovLyAgICAgdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBudWxsOwovLyAgICAgdGhpc0JvdC5tYXNrcy5hYk1lbnVSZWZyZXNoID0gbnVsbDsKLy8gYDsKCi8vIGNvbnN0IHBvc3NpYmxlVG9vbGJveGVzID0gbGlua3MucmVtZW1iZXIudGFncy50b29sYm94X2FycmF5OwovLyBjb25zdCBtZW51Qm90ID0ge307CgovLyBtZW51Qm90LmFiTWVudSA9IHRydWU7Ci8vIG1lbnVCb3QuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKLy8gbWVudUJvdC5ncmlkRGF0YSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7Ci8vIG1lbnVCb3QubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7Ci8vIG1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiYWRkX2JveCI7Ci8vIG1lbnVCb3QubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKLy8gbWVudUJvdC5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7CgovLyBmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlVG9vbGJveGVzLmxlbmd0aDsgaSsrKQovLyB7Ci8vICAgICBjb25zdCBhY3RpdmVUb29sYm94ID0gcG9zc2libGVUb29sYm94ZXNbaV07Ci8vICAgICBjb25zdCBleHRhbnRCb3QgPSBhY3RpdmVUb29sYm94LnN0dWRpbyA/IGdldEJvdCgiYWJJRE9yaWdpbiIsIGFjdGl2ZVRvb2xib3gubmFtZSk6IGdldEJvdChhY3RpdmVUb29sYm94Lm5hbWUsIHRydWUpOwoKLy8gICAgIG1lbnVCb3QudG9vbGJveF9kYXRhID0gYWN0aXZlVG9vbGJveDsKLy8gICAgIG1lbnVCb3QubGFiZWwgPSBhY3RpdmVUb29sYm94LnRpdGxlID8/IGFjdGl2ZVRvb2xib3gubmFtZTsKCi8vICAgICBpZiAoIWV4dGFudEJvdCkKLy8gICAgIHsKLy8gICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51Qm90KTsKLy8gICAgIH0KLy8gfScAu7Db5AisCBRhYkdyaWRNZW51T25HZW5lcmF0ZQIEALuw2+QIpCLiAkBjb25zdCB0b29sYm94QXJyYXkgPSBhYlJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheTsKCmxldCBhbGxUb29sc0xvYWRlZCA9IHRydWU7Cgpmb3IgKGxldCBpID0gMDsgaSA8IHRvb2xib3hBcnJheS5sZW5ndGg7IGkrKykgewogICAgY29uc3QgY3VycmVudFRvb2wgPSB0b29sYm94QXJyYXlbaV0ubmFtZTsKCiAgICBpZiAoIWdldEJvdCgiYWJJRE9yaWdpbiIsIGN1cnJlbnRUb29sKSAmJiAhZ2V0Qm90KGN1cnJlbnRUb29sLCB0cnVlKSkgewogICAgICAgIGFsbFRvb2xzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmlmIChhbGxUb29sc0xvYWRlZCkgewogICAgZGVzdHJveSh0aGlzQm90KTsKfScAu7Db5AisCA5hYkdyaWRNZW51SWNvbgIEALuw2+QIhyUKbG9jYWxfbWFsbCcAu7Db5AisCA9hYkdyaWRNZW51TGFiZWwCBAC7sNvkCJIlB2NhdGFsb2cnALuw2+QIrAgTYWJHcmlkTWVudVNvcnRPcmRlcgIEALuw2+QImiUDMTAwJwC7sNvkCKwID29uQUJJbml0aWFsaXplZAIEALuw2+QIniUqQC8vIGxpbmtzLmxlYXJuLmFiQWRhcHQoImNhc3VhbF90b29sYm94Iik7JwC7sNvkCKwIDW9uU2tpbGxVcGRhdGUCBAC7sNvkCMklV0BsaW5rcy5sZWFybi5hYkFkYXB0KCJjYXN1YWxfdG9vbGJveCIpOw0KDQpjb25zb2xlLmxvZygiW1Rvb2xib3hdIExvYWRpbmcgY2FzdWFsIGtpdCIpOycAu7Db5AisCApzaGVsbFV0aWxzAgQAu7Db5AihJijwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwC7sNvkCKwIGGFiR3JpZE1lbnVPbkJlZm9yZUNyZWF0ZQIEALuw2+QIyCbUCUBpZiAoYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkNhdGFsb2dOYW1lKSB7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJHcmlkTWVudUxhYmVsIiwgYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkNhdGFsb2dOYW1lKTsNCn0NCg0KDQovL05FVw0KY29uc3QgZHJvcGRvd25PcHRpb25zID0gW107DQoNCmNvbnN0IHBvc3NpYmxlVG9vbGJveGVzID0gbGlua3MucmVtZW1iZXIudGFncy50b29sYm94X2FycmF5Ow0KDQpmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlVG9vbGJveGVzLmxlbmd0aDsgaSsrKQ0Kew0KICAgIGNvbnN0IG1lbnVCb3QgPSB7fTsNCg0KICAgIG1lbnVCb3QuYWJNZW51ID0gdHJ1ZTsNCiAgICBtZW51Qm90LmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7DQogICAgbWVudUJvdC5ncmlkRGF0YSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQogICAgbWVudUJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsNCiAgICBtZW51Qm90LmZvcm1BZGRyZXNzID0gImFkZF9ib3giOw0KICAgIG1lbnVCb3QubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsNCiAgICBtZW51Qm90Lm9uQ2xpY2sgPSBgQCANCiAgICAgICAgbGlua3MubWFuYWdlci50b29sYm94X2FkZCh7dG9vbGJveERhdGE6IHRhZ3MudG9vbGJveF9kYXRhLCBncmlkRGF0YTogdGFncy5ncmlkRGF0YX0pOyANCiAgICAgICAgc2V0VGFnTWFzayhhYi5saW5rcy5yZW1lbWJlciwgImxhc3RPcGVuZWREcm9wZG93biIsIG51bGwpOw0KICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpO2A7DQogICAgDQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBtZW51Qm90LnRvb2xib3hfZGF0YSA9IGFjdGl2ZVRvb2xib3g7DQogICAgbWVudUJvdC5sYWJlbCA9IGFjdGl2ZVRvb2xib3gudGl0bGUgPz8gYWN0aXZlVG9vbGJveC5uYW1lOw0KDQogICAgaWYgKCFleHRhbnRCb3QpDQogICAgew0KICAgICAgICBkcm9wZG93bk9wdGlvbnMucHVzaChtZW51Qm90KTsNCiAgICB9DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAu7Db5AisCBJhYkdyaWRNZW51SXRlbVR5cGUCBAC7sNvkCJ0wCGRyb3Bkb3duJwC7sNvkCKwIEWRyb3Bkb3duU29ydE9yZGVyAgQAu7Db5AimMAMxMDAnALuw2+QIrAgPZHJvcGRvd25PcHRpb25zAgQAu7Db5AiqMAbwn6esW10nAQRib3RzJDE3NDEwZDgzLTdlZWUtNGExZS1iNjM4LTY1NDYzNzRkMTdjMwEnALuw2+QIrzAGc3lzdGVtAgQAu7Db5AiwMBFhYi5pbnRlcmZhY2Uuc2NhbicAu7Db5AivMARmb3JtAgQAu7Db5AjCMAdub3RoaW5nJwC7sNvkCK8wC2FiSW50ZXJmYWNlAgQAu7Db5AjKMAR0cnVlJwC7sNvkCK8wCGFiSWdub3JlAgQAu7Db5AjPMAR0cnVlJwC7sNvkCK8wD29uUVJDb2RlU2Nhbm5lZAIEALuw2+QI1DD9D0BpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmFiLmxvZyhhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBzY2FubmVkICIgKyB0aGF0KTsKCmxldCByZXF1ZXN0aW5nQUkgPSBmYWxzZTsKaWYgKGNvbmZpZ0JvdC50YWdzLnJlcXVlc3RpbmdBSSkgewogICAgY29uZmlnQm90LnRhZ3MucmVxdWVzdGluZ0FJID0gbnVsbDsKICAgIHJlcXVlc3RpbmdBSSA9IHRydWU7Cn0KCmlmIChjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbikKewogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGlua3Muc3RvcmUuYWJRUlB1Ymxpc2godGhhdCk7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuKQp7CiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICBjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4gPSBudWxsOwoKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIHRyeQogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CgogICAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IHBoQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoInBoIik7CiAgICBsZXQgaW5zdENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJpbnN0Iik7CiAgICBsZXQgYWJDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiYWIiKTsKICAgIGxldCBjd0NoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJjdyIpOwoKICAgIGlmIChwaENoZWNrICYmIGluc3RDaGVjayAmJiBhYkNoZWNrICYmIGN3Q2hlY2spCiAgICB7CiAgICAgICAgb3MuZ29Ub1VSTCh0aGF0KTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBvcy50b2FzdCgibm90IGEgcmVjb2duaXplZCBwcmFjdGljZSBwZXJtaXQiKTsKICAgIH0KCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLmFiU2NhbikKewogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBjb25maWdCb3QudGFncy5hYlNjYW4gPSBudWxsOwogICAgCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsZXQgc2Nhbm5lZFVSTDsKCiAgICB0cnkgCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7CiAgICB9CiAgICBjYXRjaCAoZSkgCiAgICB7CiAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiB0aGF0fSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZihzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFzayIpID09ICJlZ2dDYXJ0b24iKQogICAgewogICAgICAgIGlmIChyZXF1ZXN0aW5nQUkpIHsKICAgICAgICAgICAgc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJyZXF1ZXN0aW5nQUkiLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgb3MuZ29Ub1VSTChzY2FubmVkVVJMLmhyZWYpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5hc2spIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5hc2t9KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy5wYXR0ZXJufSk7CiAgICAgICAgfQogICAgICAgIAogICAgfQp9JwC7sNvkCK8wBXN0b3JlAgQAu7Db5AjSQCjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwC7sNvkCK8wBnNlYXJjaAIEALuw2+QI+UAo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAu7Db5AivMBBhYkNvcmVNZW51QWN0aW9uAgQAu7Db5AigQTdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwC7sNvkCK8wD2FiQ29yZU1lbnVMYWJlbAIEALuw2+QI2EEEc2NhbicAu7Db5AivMA5hYkNvcmVNZW51SWNvbgIEALuw2+QI3UEPcXJfY29kZV9zY2FubmVyJwC7sNvkCK8wE2FiQ29yZU1lbnVTb3J0T3JkZXICBAC7sNvkCO1BATMnALuw2+QIrzAJYWJWZXJzaW9uAgQAu7Db5AjvQQUxMC4zNycBBGJvdHMkM2E2Y2I5Y2EtYjNiNC00ZDc3LTgyZjYtZmE1OWI1Mjk2ZWM5AScAu7Db5Aj1QQZzeXN0ZW0CBAC7sNvkCPZBF2FiLmludGVyZmFjZS5uYXZpZ2F0aW9uJwC7sNvkCPVBCGFiSWdub3JlAgQAu7Db5AiOQgR0cnVlJwC7sNvkCPVBD2Ryb3Bkb3duT3B0aW9ucwIEALuw2+QIk0IG8J+nrFtdJwC7sNvkCPVBEmFiQ29yZU1lbnVJdGVtVHlwZQIEALuw2+QImEIIZHJvcGRvd24nALuw2+QI9UERZHJvcGRvd25Tb3J0T3JkZXICBAC7sNvkCKFCBGF1dG8nALuw2+QI9UEYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQAu7Db5AimQv4gQGNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KDQpjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCmNvbnN0IGN1cnJlbnRQb3J0YWwgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyAibWFwIiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT0gImJsdWVwcmludCIgPyAiYmx1ZXByaW50IiA6ImdyaWQiOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCi8vIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQovLyAgICAgdGhpc0JvdC5tYXNrcy5hYkNvcmVNZW51SGlkZSA9IHRydWU7DQovLyB9IGVsc2Ugew0KLy8gICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSBmYWxzZTsNCi8vIH0NCg0KY29uc3QgbWVudU9wdGlvbnMgPSB7fTsNCg0KbWVudU9wdGlvbnMuZGltZW5zaW9uID0gYWN0aXZlTWVudTsNCm1lbnVPcHRpb25zW2FjdGl2ZU1lbnVdID0gdHJ1ZTsNCm1lbnVPcHRpb25zLmFiTmF2aWdhdGlvbk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMuYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsNCm1lbnVPcHRpb25zLnNraWxsQm90ID0gZ2V0TGluayh0aGlzQm90KTsNCg0KY29uc3QgaG9tZVdvcmxkQnV0dG9uID0gew0KICAgIC4uLm1lbnVPcHRpb25zLA0KICAgIGxhYmVsOiAiaG9tZSB3b3JsZCIsDQogICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LWRldi1maWxlc2J1Y2tldC02ODIzOTc2OTA2NjAuczMuYW1hem9uYXdzLmNvbS8zMThjMDRmMS0xMzkxLTRjMTAtOGQ0My1hYWViYzUxNzAyNjUvMzhhZThiNjk1N2Y0NDgzZDg3MTYxNDFkMWU5OGM5M2YwZTdkY2NlMTViYzVjMTIzYmQwZTllMWFiNjg3Y2MwNS5wbmcnLA0KICAgIG9uQ2xpY2s6IGBADQogICAgICAgIGNvbnN0IGN1cnJlbnRVUkwgPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCk7DQogICAgICAgIGNvbnN0IG9yaWdpbiA9IGN1cnJlbnRVUkwub3JpZ2luOw0KDQogICAgICAgIGxldCBuZXdVUkwgPSBuZXcgVVJMKG9yaWdpbik7DQoNCiAgICAgICAgaWYgKGFiUmVtZW1iZXIudGFncy5hbGxvd0NoYW5uZWxzKSB7DQogICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgiY2hhbm5lbCIsIGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb25maWdCb3QudGFncy5jb21JZCkgew0KICAgICAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoImNvbUlkIiwgY29uZmlnQm90LnRhZ3MuY29tSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm93bmVyIiwgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiAicGxheWVyIik7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJpbnN0IiwgJ2hvbWUnKTsNCiAgICAgICAgbmV3VVJMLnNlYXJjaFBhcmFtcy5hcHBlbmQoIm1hcFBvcnRhbCIsICdob21lJyk7DQogICAgICAgIG5ld1VSTC5zZWFyY2hQYXJhbXMuYXBwZW5kKCJhc2siLCAnaG9tZScpOw0KICAgICAgICANCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnN0dWRpbyAmJiBjb25maWdCb3QudGFncy5zdHVkaW8gIT0gYXV0aEJvdC5pZCkgew0KICAgICAgICAgICBuZXdVUkwuc2VhcmNoUGFyYW1zLmFwcGVuZCgic3R1ZGlvIiwgdGhhdC5pZCk7IA0KICAgICAgICB9DQoNCiAgICAgICAgb3Mub3BlblVSTChuZXdVUkwuaHJlZik7DQogICAgYA0KfTsNCg0KaWYgKCFnZXRCb3QoImlzSG9tZVdvcmxkQ29yZSIsIHRydWUpICYmIGF1dGhCb3QpIHsNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaChob21lV29ybGRCdXR0b24pOw0KfQ0KDQppZiAoY3VycmVudFBvcnRhbCA9PSAnbWFwJykgew0KDQogICAgY29uc3QgaG9tZUJhc2VCb3QgPSBnZXRCb3QoImhvbWVCYXNlIiwgdHJ1ZSk7DQoNCiAgICBpZiAoaG9tZUJhc2VCb3QpIHsNCiAgICAgICAgY29uc3QgaG9tZUJ1dHRvbiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhvbWVCYXNlQm90LnRhZ3MucGxhY2VMYWJlbCwNCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaHR0cHM6Ly9hdXRoLWF1eC1kZXYtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vMzE4YzA0ZjEtMTM5MS00YzEwLThkNDMtYWFlYmM1MTcwMjY1L2NkMzhhZmZjMDYwNGJlYWE1ODhkYTIxYWExYmU3NTBiYjNlNzNiM2IzY2FlMjNlYjMwMzA3YzM0NDk0NDU5ZjMucG5nJywNCiAgICAgICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICAgICAgY29uc3QgaG9tZUJvdCA9IGdldEJvdCgiaG9tZUJhc2UiLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBpZiAoaG9tZUJvdCkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGhvbWVCb3QsIHsgem9vbTogMjAwMCB9KS5jYXRjaCgoKSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICBgDQogICAgICAgIH07DQoNCiAgICAgICAgZHJvcGRvd25PcHRpb25zLnB1c2goaG9tZUJ1dHRvbik7DQogICAgfQ0KDQogICAgY29uc3QgcGxhY2VzQXJyID0gW107DQogICAgY29uc3QgcGxhY2VzID0gZ2V0Qm90cygiaG9tZVBsYWNlIiwgdHJ1ZSk7DQogICAgZm9yIChjb25zdCBoUGxhY2Ugb2YgcGxhY2VzKSB7DQogICAgICAgIGlmIChoUGxhY2UudGFncy5ob21lQmFzZSA9PSB0cnVlKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBwbGFjZU9iaiA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVPcHRpb25zLA0KICAgICAgICAgICAgbGFiZWw6IGhQbGFjZS50YWdzLnBsYWNlTGFiZWwsDQogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2xvY2F0aW9uX29uJywNCiAgICAgICAgICAgIHBsYWNlOiBnZXRMaW5rKGhQbGFjZSksDQogICAgICAgICAgICBvbkNsaWNrOiBgQA0KICAgICAgICAgICAgICAgIGlmIChsaW5rcy5wbGFjZSkgew0KICAgICAgICAgICAgICAgICAgICBvcy5mb2N1c09uKGxpbmtzLnBsYWNlLCB7IHpvb206IDIwMDAgfSkuY2F0Y2goZSA9PiB7fSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICAgICAgYA0KICAgICAgICB9DQoNCiAgICAgICAgcGxhY2VzQXJyLnB1c2gocGxhY2VPYmopOw0KICAgIH0NCg0KICAgIHBsYWNlc0Fyci5zb3J0KChhLCBiKSA9PiB7DQogICAgICAgIGNvbnN0IG5hbWVBID0gYS5sYWJlbC50b1VwcGVyQ2FzZSgpOw0KICAgICAgICBjb25zdCBuYW1lQiA9IGIubGFiZWwudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMDsNCiAgICB9KTsNCg0KICAgIGZvciAoY29uc3Qgc29ydGVkUGxhY2Ugb2YgcGxhY2VzQXJyKSB7DQogICAgICAgIGRyb3Bkb3duT3B0aW9ucy5wdXNoKHNvcnRlZFBsYWNlKTsNCiAgICB9DQoNCg0KICAgIGNvbnN0IGN1cnJlbnRMb2NhdGlvbkJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiAnY3VycmVudCBsb2NhdGlvbicsDQogICAgICAgIGZvcm1BZGRyZXNzOiAnbmVhcl9tZScsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBsaW5rcy5za2lsbEJvdC5nb1RvQ3VycmVudExvY2F0aW9uKCk7DQogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgZHJvcGRvd25PcHRpb25zLnB1c2goY3VycmVudExvY2F0aW9uQnV0dG9uKTsNCn0NCg0KaWYgKGRyb3Bkb3duT3B0aW9ucy5sZW5ndGggPT0gMCkgew0KICAgIHRoaXNCb3QubWFza3MuYWJDb3JlTWVudUhpZGUgPSB0cnVlOw0KfSBlbHNlIHsNCiAgICB0aGlzQm90Lm1hc2tzLmFiQ29yZU1lbnVIaWRlID0gZmFsc2U7DQp9DQoNCm1hc2tzLmRyb3Bkb3duT3B0aW9ucyA9IGRyb3Bkb3duT3B0aW9uczsNCg0KcmV0dXJuOycAu7Db5Aj1QRBhYkNvcmVNZW51QWN0aW9uAgQAu7Db5AilYwNALy8nALuw2+QI9UELYWJJbnRlcmZhY2UCBAC7sNvkCKljBHRydWUnALuw2+QI9UEPYWJDb3JlTWVudUxhYmVsAgQAu7Db5AiuYwZwbGFjZXMnALuw2+QI9UEEZm9ybQIEALuw2+QItWMHbm90aGluZycAu7Db5Aj1QRNnb1RvQ3VycmVudExvY2F0aW9uAgQAu7Db5Ai9Y4AEQGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgb3MuZ2V0R2VvbG9jYXRpb24oKTsNCg0KaWYgKGxvY2F0aW9uLnN1Y2Nlc3MpIHsNCiAgICBjb25zdCBjdXJyZW50RGltID0gYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbjsNCiAgICBjb25zdCBjdXJyZW50UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gIm1hcCIgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09ICJibHVlcHJpbnQiID8gImJsdWVwcmludCIgOiJncmlkIjsNCg0KICAgIGlmIChjdXJyZW50UG9ydGFsICE9ICdtYXAnKSB7DQogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9IGN1cnJlbnREaW07DQogICAgfQ0KDQogICAgb3MuZm9jdXNPbih7eDogbG9jYXRpb24ubG9uZ2l0dWRlLCB5OiBsb2NhdGlvbi5sYXRpdHVkZX0sIHtwb3J0YWw6ICdtYXAnLCB6b29tOiAyMDAwfSk7DQp9IGVsc2Ugew0KICAgIG9zLnRvYXN0KCJMb2NhdGlvbiBzZXJ2aWNlcyBub3QgYXZhaWxhYmxlIikNCn0nALuw2+QI9UEJYWJWZXJzaW9uAgQAu7Db5Ai+ZwUxMC4zNycBBGJvdHMkNDkzZmZhNGQtNDZkNC00YTk4LWFlOWMtMTIxMmQ2NTExMzNmAScAu7Db5AjEZwZzeXN0ZW0CBAC7sNvkCMVnFGFiLmludGVyZmFjZS52ZXJzaW9uJwC7sNvkCMRnDW9uU2tpbGxVcGRhdGUCBAC7sNvkCNpnpwFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJJbnRlcmZhY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiSW50ZXJmYWNlTWlub3JWZXJzaW9uOw0KDQpjb25zb2xlLmxvZygiW0FCSW50ZXJmYWNlXSBMb2FkZWQgQUIgSW50ZXJmYWNlIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAu7Db5AjEZxdhYkludGVyZmFjZU1ham9yVmVyc2lvbgIEALuw2+QIgmkBMicAu7Db5AjEZxdhYkludGVyZmFjZU1pbm9yVmVyc2lvbgIEALuw2+QIhGkCMzgnALuw2+QIxGcIYWJJZ25vcmUCBAC7sNvkCIdpBHRydWUnALuw2+QIxGcEZm9ybQIEALuw2+QIjGkHbm90aGluZycAu7Db5AjEZwthYkludGVyZmFjZQIEALuw2+QIlGkEdHJ1ZScAu7Db5AjEZwlhYlZlcnNpb24CBAC7sNvkCJlpBTEwLjM3JwEEYm90cyQ0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYBJwC7sNvkCJ9pBnN5c3RlbQIEALuw2+QIoGkTYWIuaW50ZXJmYWNlLm51Z2dldCcAu7Db5AifaQRmb3JtAgQAu7Db5Ai0aQdub3RoaW5nJwC7sNvkCJ9pC2FiSW50ZXJmYWNlAgQAu7Db5Ai8aQR0cnVlJwC7sNvkCJ9pCGFiSWdub3JlAgQAu7Db5AjBaQR0cnVlJwC7sNvkCJ9pDGFiTG9hZE51Z2dldAIEALuw2+QIxmmYAkBsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0TmFtZTsKbGV0IGZvcm1hdHRlZE51Z2dldEFCID0gIm51Z18iK251Z2dldE5hbWU7CmxldCBsb2FkZWROdWdnZXQgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGZvcm1hdHRlZE51Z2dldEFCLCBhYlZlcnNpb246IHRoYXQudmVyc2lvbiwgcmV0dXJuVHlwZTogImRhdGEifSk7Cgpsb2FkZWROdWdnZXQgPSBsb2FkZWROdWdnZXQuc3RhdGVbbnVnZ2V0TmFtZV0ubnVnZ2V0OwoKcmV0dXJuIGxvYWRlZE51Z2dldDsnALuw2+QIn2kPYWJQdWJsaXNoTnVnZ2V0AgQAu7Db5Ajfa4wDQC8vc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6ICJudWdOYW1lIiwgZGF0YTogZGF0YX0pOyAgQUREIEVHRyBJRCBFVkVOVFVBTExZCmxldCB0ZXN0TnVnZ2V0ID0gdGhhdC5kYXRhOwpsZXQgZm9ybWF0dGVkTnVnZ2V0ID0ge2lkOiB0aGF0Lm51ZywgbnVnZ2V0OiB0ZXN0TnVnZ2V0fTsKbGV0IHRlc3ROdWdnZXROYW1lID0gdGhhdC5udWc7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIit0ZXN0TnVnZ2V0TmFtZTsKCm1hc2tzLm51Z2dldFRvUHVibGlzaCA9IGZvcm1hdHRlZE51Z2dldEFCOwoKbGlua3Muc3RvcmUuYWJQdWJsaXNoQUIoe2FiOiBmb3JtYXR0ZWROdWdnZXRBQiwgdGFyZ2V0OiBmb3JtYXR0ZWROdWdnZXQsIHNvdXJjZUV2ZW50OiAncHVibGlzaF9udWdnZXQnfSk7JwC7sNvkCJ9pD2ltcGxlbWVudE51Z2dldAIEALuw2+QI7G6xB0BsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0OwpsZXQgbnVnZ2V0VmVyc2lvbkNoZWNrID0gbnVnZ2V0TmFtZS5pbmRleE9mKCIudiIpOwpsZXQgdmVyc2lvbjsKCmlmIChudWdnZXRWZXJzaW9uQ2hlY2sgIT0gLTEpCnsKICAgIG51Z2dldE5hbWUgPSBudWdnZXROYW1lLnN1YnN0cmluZygwLCBudWdnZXRWZXJzaW9uQ2hlY2spOwoKICAgIGxldCB2ZXJzaW9uQ2hlY2sgPSB0aGF0Lm51Z2dldC5zdWJzdHJpbmcobnVnZ2V0VmVyc2lvbkNoZWNrICsgMik7CgogICAgaWYgKGlzTmFOKHZlcnNpb25DaGVjaykpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2codmVyc2lvbkNoZWNrLCAidmVyc2lvbiBpcyBub3QgYSBudW1iZXIiKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB2ZXJzaW9uID0gTnVtYmVyKHZlcnNpb25DaGVjayk7CiAgICB9Cn0KY29uc29sZS5sb2cobnVnZ2V0TmFtZSwgdmVyc2lvbik7CmxldCBudWdEYXRhID0gYXdhaXQgdGhpc0JvdC5hYkxvYWROdWdnZXQoe251Z2dldE5hbWU6IG51Z2dldE5hbWUsIHZlcnNpb246IHZlcnNpb259KTsKCmlmIChudWdEYXRhID09ICJhYklEIG5vdCBmb3VuZCIpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgbm90IGZvdW5kIik7Cn0KZWxzZQp7CiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKICAgIGxldCB0YXJnZXRUYWcgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS50b1N0cmluZygpOwogICAgbGV0IHRhcmdldE51ZyA9ICJ7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRUYWcuaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKICAgIGluc2VydFRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCBudWdEYXRhKTsKfScAu7Db5AifaQxudWdnZXRCdXR0b24CBAC7sNvkCJ529QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnALuw2+QIn2kLbnVnZ2V0UGFyc2UCBAC7sNvkCJKDAacPQGNvbnN0IG9yaWdpbmFsVGFnVmFsdWUgPSB0aGF0LmVkaXRlZEJvdC5yYXdbdGhhdC5lZGl0ZWRUYWddOwpsZXQgdGFnVmFsdWUgPSBvcmlnaW5hbFRhZ1ZhbHVlOwoKaWYgKCF0YWdWYWx1ZSkgCnsKICAgIHJldHVybjsKfQplbHNlIGlmICh0eXBlb2YgdGFnVmFsdWUgIT09ICJzdHJpbmciKSAKewogICAgdGFnVmFsdWUgPSB0YWdWYWx1ZS50b1N0cmluZygpOwp9CgpsZXQgaW5pdGlhbFBvc3NpYmxlTnVnUG9zID0gMDsKCmlmIChpbml0aWFsUG9zc2libGVOdWdQb3MgPT0gLTEpIAp7CiAgICByZXR1cm47Cn0KZWxzZQp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsUG9zc2libGVOdWdQb3MpOwp9CgpsZXQgcG9zc2libGVOdWdzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXntdL2csICIiKS5sZW5ndGg7CmxldCB0b3RhbE51Z0JyZWFrcyA9IG9yaWdpbmFsVGFnVmFsdWUucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKbGV0IGJyZWFrTGV2ZWwgPSAwOwpsZXQgbnVnc1RvQ2hlY2sgPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVOdWdzOyBpKyspCnsKICAgIGxldCBpbml0aWFsTnVnUG9zID0gdGFnVmFsdWUuaW5kZXhPZigieyIpICsgMTsKICAgIGxldCBwb3NzaWJsZU51Z0VuZCA9IHRhZ1ZhbHVlLmluZGV4T2YoIn0iKTsKICAgIGxldCBwb3NzaWJsZU51ZyA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhpbml0aWFsTnVnUG9zLCBwb3NzaWJsZU51Z0VuZCk7CgogICAgaWYgKHBvc3NpYmxlTnVnLmluZGV4T2YoIiAiKSA9PSAtMSAmJiAvXG4vZy50ZXN0KHBvc3NpYmxlTnVnKSAhPSB0cnVlICYmIHBvc3NpYmxlTnVnLmxlbmd0aCA+IDAgJiYgcG9zc2libGVOdWcuaW5kZXhPZigiOiIpID09IC0xKQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigieyIrcG9zc2libGVOdWcrIn0iKSkucmVwbGFjZSgvW15cbl0vZywgIiIpLmxlbmd0aDsKICAgICAgICBsZXQgcHVibGlzaENoZWNrID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSA2LCBpbml0aWFsTnVnUG9zIC0gMik7CiAgICAgICAgbGV0IG51Z1B1Ymxpc2ggPSBudWxsOwoKICAgICAgICBpZiAocHVibGlzaENoZWNrID09ICIubnVnIikKICAgICAgICB7CiAgICAgICAgICAgIG51Z1B1Ymxpc2ggPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWtMZXZlbCArPSBudWdCcmVha3M7CgogICAgICAgIG51Z0JyZWFrcyA9IHRvdGFsTnVnQnJlYWtzIC0gKHRvdGFsTnVnQnJlYWtzIC0gYnJlYWtMZXZlbCk7CiAgICAgICAgCiAgICAgICAgLy9DSEVDSyBJRiAkIGJlZm9yZSBudWdnZXQKICAgICAgICBpZiAodGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MgLSAyLCBpbml0aWFsTnVnUG9zIC0gMSkgIT0gIiQiKQogICAgICAgIHsKICAgICAgICAgICAgbnVnc1RvQ2hlY2sucHVzaCh7bnVnTmFtZTogcG9zc2libGVOdWcsIG51Z1N0YXJ0OiBudWdCcmVha3MgKyAxLCBudWdQdWJsaXNoOiBudWdQdWJsaXNofSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxldCBudWdCcmVha3MgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoMCwgdGFnVmFsdWUuaW5kZXhPZigifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgIH0KCiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnN1YnN0cmluZyhwb3NzaWJsZU51Z0VuZCArIDEpOwp9Cgp0aGlzQm90Lm51Z2dldEJ1dHRvbih7IG51Z2dldDogbnVnc1RvQ2hlY2ssIGJvdDogdGhhdC5lZGl0ZWRCb3QsIHRhZzogdGhhdC5lZGl0ZWRUYWcsIHRhZ1ZhbHVlOiBvcmlnaW5hbFRhZ1ZhbHVlfSk7JwC7sNvkCJ9pDW9uQUJQdWJsaXNoZWQCBAC7sNvkCLqSAcEBQGNvbnNvbGUubG9nKHRoYXQuYWIsIHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQoKaWYgKHRoYXQuYWIgPT0gdGFncy5udWdnZXRUb1B1Ymxpc2gpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgcHVibGlzaGVkIik7CgogICAgbWFza3MubnVnZ2V0VG9QdWJsaXNoID0gbnVsbDsKCiAgICBjb25maWdCb3QubWFza3MuYWJWZXJzaW9uID0gbnVsbDsKfScAu7Db5AifaRBvbkFueUJvdHNDaGFuZ2VkAgQAu7Db5Aj8kwG3BEBpZiAoY29uZmlnQm90ICYmIHRoYXRbMF0uYm90LmlkICE9IHRoaXNCb3QuaWQpIAp7CiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QpIHJldHVybjsgLy8gSWdub3JlIGlmIHRoZSBjb25maWdCb3QgaXNuJ3QgcmVhZHkgeWV0LgoKICAgIGNvbnN0IGVkaXRlZEJvdElEID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdC5yZXBsYWNlKCLwn5SXIiwgIiIpOwoKICAgIGlmICghdGhhdC5maW5kKHggPT4geC5ib3QuaWQgPT0gZWRpdGVkQm90SUQpKSByZXR1cm47IC8vIElmIHRoZSBib3QgY2hhbmdlZCB3YXNuJ3QgYmVpbmcgZWRpdGVkIGJ5IHRoZSB1c2VyIGlnbm9yZSBpdC4KCiAgICBjb25zdCBlZGl0ZWRUYWcgPSBjb25maWdCb3QudGFncy5lZGl0aW5nVGFnOwogICAgY29uc3QgZWRpdGVkQm90ID0gZ2V0Qm90KCJpZCIsIGVkaXRlZEJvdElEKTsKCiAgICBpZiAoZWRpdGVkQm90ICYmIGVkaXRlZFRhZykgCiAgICB7CiAgICAgICAgc2hvdXQoIm51Z2dldFJlc2V0Iik7CgogICAgICAgIHRoaXNCb3QubnVnZ2V0UGFyc2UoeyBlZGl0ZWRCb3QsIGVkaXRlZFRhZyB9KTsKICAgIH0KfScAu7Db5AifaQhvbkNyZWF0ZQIEALuw2+QIspgBTEB0YWdzLmxpc3RlbmluZyA9IGZhbHNlOwoKLy9zZXRUYWdNYXNrKHRoaXNCb3QsICJsaXN0ZW5pbmciLCB0cnVlLCAibG9jYWwiKTsnALuw2+QIn2kNcGFja2FnZU51Z2dldAIEALuw2+QI/5gB+AZAY29uc3QgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKY29uc3QgdGFnVGV4dCA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddOwoKaWYgKGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXggfHwgY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXgpCnsKICAgIGxldCBzdGFydFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvclN0YXJ0SW5kZXg7CiAgICBsZXQgZW5kUG9zID0gY29uZmlnQm90LnRhZ3MuY3Vyc29yRW5kSW5kZXg7CgogICAgaWYgKHN0YXJ0UG9zID09IGVuZFBvcykKICAgIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlIGlmIChzdGFydFBvcyA+IGVuZFBvcykKICAgIHsKICAgICAgICBsZXQgbmV3U3RhcnRQb3MgPSBlbmRQb3M7CiAgICAgICAgbGV0IG5ld0VuZFBvcyA9IHN0YXJ0UG9zOwoKICAgICAgICBzdGFydFBvcyA9IG5ld1N0YXJ0UG9zOwogICAgICAgIGVuZFBvcyA9IG5ld0VuZFBvczsKICAgIH0KCiAgICBsZXQgZGF0YSA9IHRhZ1RleHQuc3Vic3RyaW5nKHN0YXJ0UG9zLCBlbmRQb3MgKyAxKTsKCiAgICBzaG91dCgiYWJQdWJsaXNoTnVnZ2V0Iiwge251ZzogdGhhdC5udWdnZXQsIGRhdGE6IGRhdGF9KTsKCiAgICBvcy50b2FzdCgibnVnIGlzIHB1Ymxpc2hpbmciLCAxMCk7CgogICAgbGV0IHRhcmdldE51ZyA9ICIubnVnIHsiICsgdGhhdC5udWdnZXQgKyAifSI7IAogICAgbGV0IG51Z1BvcyA9IHRhcmdldEJvdC5yYXdbdGhhdC50YWddLmluZGV4T2YodGFyZ2V0TnVnKTsKCiAgICBkZWxldGVUYWdUZXh0KHRhcmdldEJvdCwgdGhhdC50YWcsIG51Z1BvcywgdGFyZ2V0TnVnLmxlbmd0aCk7Cn0KZWxzZQp7CiAgICBvcy50b2FzdCgiY2Fubm90IHJlYWQgbnVnZ2V0IHRvIGJlIHB1Ymxpc2hlZCIpCn0nALuw2+QIn2kIcmVtZW1iZXICBAC7sNvkCPifASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC7sNvkCJ9pBnNlYXJjaAIEALuw2+QIn6ABKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnALuw2+QIn2kFc3RvcmUCBAC7sNvkCMagASjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwC7sNvkCJ9pCWxpc3RlbmluZwIEALuw2+QI7aABBWZhbHNlJwC7sNvkCJ9pCWFiVmVyc2lvbgIEALuw2+QI86ABBTEwLjM3JwEEYm90cyRiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IBJwC7sNvkCPmgAQhwcmVzZW5jZQIEALuw2+QI+qABKPCflJc4N2U5NTM0Mi1lNDU2LTRiNjMtOTg5MS1kN2E5MjFhZDNlZTcnALuw2+QI+aABGWFiQ3JlYXRlTWVudUJ1c3lJbmRpY2F0b3ICBAC7sNvkCKGhAc4MQGNvbnN0IHsKICAgIGxhYmVsID0gYCR7YWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fSBpcyB3b3JraW5nYCwKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge30KCmxldCBidXN5SW5kaWNhdG9yID0gewogICAgb25Qb2ludGVyVXA6IG51bGwsCiAgICBvblBvaW50ZXJEb3duOiBudWxsLAogICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgIGJ1c3lMYWJlbDogbGFiZWwsCiAgICBsYWJlbEFsaWdubWVudDogJ2xlZnQnLAogICAgc3RhdGU6IDAsCiAgICBhbmltU3RhdGVzOiBbCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJycsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX3RvcCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGVsbGlwc2lzOiAnLi4nLAogICAgICAgICAgICBmb3JtQWRkcmVzczogJ2hvdXJnbGFzc190b3AnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBlbGxpcHNpczogJy4uLicsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAnaG91cmdsYXNzX2JvdHRvbScsCiAgICAgICAgfSwKICAgIF0sCiAgICBhbmltUmF0ZTogNTAwLAogICAgb25Cb3RBZGRlZDogYEAKICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgb25Cb3RDaGFuZ2VkOiBgQAogICAgICAgIGNvbnN0IG5lZWRSZWZyZXNoID0gdGhhdC50YWdzLnNvbWUodCA9PiB0ID09PSAnYnVzeUxhYmVsJyB8fCB0ID09PSAnc3RhdGUnIHx8IHQgPT09ICdhbmltU3RhdGVzJyk7CiAgICAgICAgaWYgKG5lZWRSZWZyZXNoKSB7CiAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICB9CiAgICBgLAogICAgcmVmcmVzaERpc3BsYXk6IGBACiAgICAgICAgaWYgKHRhZ3MuYW5pbVN0YXRlcyAmJiB0YWdzLmFuaW1TdGF0ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBhbmltU3RhdGUgPSB0YWdzLmFuaW1TdGF0ZXNbdGFncy5zdGF0ZV07CgogICAgICAgICAgICB0YWdzLmxhYmVsID0gdGFncy5idXN5TGFiZWwudHJpbSgpICsgYW5pbVN0YXRlLmVsbGlwc2lzOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYW5pbVN0YXRlLmZvcm1BZGRyZXNzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3MubGFiZWwgCiAgICAgICAgfQogICAgYCwKICAgIGFuaW1hdGU6IGBACiAgICAgICAgaWYgKHRhZ3Muc3RhdGUgPj0gdGFncy5hbmltU3RhdGVzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5zdGF0ZSArPSAxOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgb3Muc2xlZXAodGFncy5hbmltUmF0ZSk7CiAgICAgICAgdGhpc0JvdC5hbmltYXRlKCk7CiAgICBgLAogICAgLi4ucmVzdAp9OwoKY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKGJ1c3lJbmRpY2F0b3IpOwoKcmV0dXJuIG1lbnVCb3Q7JwC7sNvkCPmgAQZzeXN0ZW0CBAC7sNvkCPCtARFhYi5pbnRlcmZhY2UubWVudScAu7Db5Aj5oAEEZm9ybQIEALuw2+QIgq4BB25vdGhpbmcnALuw2+QI+aABC2Rlc2NyaXB0aW9uAgQAu7Db5AiKrgEmVGhpcyBza2lsbCBpcyBkZXNpZ25lZCBmb3IgbWVudSBzdHVmZi4oALuw2+QI+aABC2FiSW50ZXJmYWNlAXgnALuw2+QI+aABCmFiT3Blbk1lbnUCBAC7sNvkCLKuAfEeQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IG1lbnVUeXBlID0gdGhhdCA/ICJhYiIgKyB0aGF0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhhdC5zbGljZSgxKSArICJNZW51IjogImFiQ29yZU1lbnUiOyAvL3NldCB1cCBhIGNoZWNrIHRvIHNlZSB3aGF0IHR5cGUgb2YgbWVudSBzaG91bGQgYmUgb2NjdXJpbmcgW2NvcmUsIGJvdCwgZ3JpZCwgaW5zdF0KbGV0IG1lbnVTa2lsbHMgPSBnZXRCb3RzKG1lbnVUeXBlICsgIkFjdGlvbiIpOwpsZXQgbWF4T3B0aW9ucyA9IG1lbnVUeXBlID09ICJpbnN0IiA/IDcgOiA1OwpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLnBlcnNvbmFsaXR5ID0gdGFncy5wZXJzb25hbGl0eTsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmJhc2VTa2lsbC4ke21lbnVUeXBlICsgIkFjdGlvbiJ9KHtib3Q6IHRoaXNCb3R9KTtgOwoKbGV0IHNvcnRPcmRlckluZGV4ID0gbWVudVNraWxscy5sZW5ndGg7CmZvciAobGV0IGkgPSAwOyBpIDwgbWVudVNraWxscy5sZW5ndGg7IGkrKykvL0FERCBMT0dJQyBGT1IgTU9SRSBPUFRJT05TIFRIQU4gNSA6IG1heE9wdGlvbnMKewogICAgLy9BbGxvd3MgZm9yIGNvZGUgdG8gZ2V0IGNhbGxlZCBiZWZvcmUgdGhlIG1lbnUgZ2VuZXJhdGVzLCB1c2VmdWwgZm9yIGR5bmFtaWNhbGx5IHNldCBncm91cHMgb3IgZHJvcGRvd25zCiAgICBpZiAobWVudVNraWxsc1tpXS50YWdzW21lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIl0pIHsKICAgICAgICBhd2FpdCB3aGlzcGVyKG1lbnVTa2lsbHNbaV0sIG1lbnVUeXBlICsgIk9uQmVmb3JlQ3JlYXRlIik7CiAgICB9IAoKICAgIGlmIChtZW51U2tpbGxzW2ldLnRhZ3NbbWVudVR5cGUgKyAiSGlkZSJdKSB7CiAgICAgICAgY29udGludWU7CiAgICB9CiAgICAKICAgIGxldCBjdXJyZW50U2tpbGwgPSBtZW51U2tpbGxzW2ldOwoKICAgIGFiTWVudUJ1dHRvbi5iYXNlU2tpbGwgPSAi8J+UlyIgKyBjdXJyZW50U2tpbGwuaWQ7CiAgICBhYk1lbnVCdXR0b24ubGFiZWwgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJMYWJlbCJdOwogICAgYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiSWNvbiJdOwogICAgYWJNZW51QnV0dG9uLm9uQ3JlYXRlID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiT25HZW5lcmF0ZSJdOwogICAgYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIlNvcnRPcmRlciJdOwogICAgYWJNZW51QnV0dG9uLmNvbG9yID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA/PyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcjsKCiAgICBjb25zdCBtZW51SXRlbVR5cGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJdGVtVHlwZSJdOwoKICAgIGlmIChtZW51SXRlbVR5cGUgPT0gImRyb3Bkb3duIikgewogICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93bk9wdGlvbnMgPSBjdXJyZW50U2tpbGwudGFncy5kcm9wZG93bk9wdGlvbnM7CgogICAgICAgIGNvbnN0IHByZXZEcm9wZG93biA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmxhc3RPcGVuZWREcm9wZG93bjsKICAgICAgICBpZiAocHJldkRyb3Bkb3duICYmIHByZXZEcm9wZG93bi50YWdzW21lbnVUeXBlICsgIkFjdGlvbiJdKSB7CiAgICAgICAgICAgIGlmIChwcmV2RHJvcGRvd24gPT0gY3VycmVudFNraWxsKSB7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLnJlbWVtYmVyLCAibGFzdE9wZW5lZERyb3Bkb3duIiwgbnVsbCk7CiAgICAgICAgICAgICAgICBhYk1lbnVCdXR0b24uZGVmYXVsdE9wZW4gPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGVsZXRlIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbjsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJEZWZhdWx0T3BlbiJdID09IHRydWUpIHsKICAgICAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kZWZhdWx0T3BlbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYWJNZW51QnV0dG9uLmRlZmF1bHRPcGVuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY3VycmVudFNraWxsLnRhZ3MuZHJvcGRvd25Tb3J0T3JkZXIgPT0gImF1dG8iKSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IHNvcnRPcmRlckluZGV4OwogICAgICAgICAgICArK3NvcnRPcmRlckluZGV4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFiTWVudUJ1dHRvbi5kcm9wZG93blNvcnRPcmRlciA9IGN1cnJlbnRTa2lsbC50YWdzLmRyb3Bkb3duU29ydE9yZGVyOwogICAgICAgIH0KICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudURyb3Bkb3duKGFiTWVudUJ1dHRvbik7ICAgICAgICAKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJncm91cCIpIHsKICAgICAgICAgaWYgKGN1cnJlbnRTa2lsbC50YWdzLmdyb3VwU29ydE9yZGVyID09ICJhdXRvIikgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBzb3J0T3JkZXJJbmRleDsKICAgICAgICAgICAgKytzb3J0T3JkZXJJbmRleDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhYk1lbnVCdXR0b24uZ3JvdXBTb3J0T3JkZXIgPSBjdXJyZW50U2tpbGwudGFncy5ncm91cFNvcnRPcmRlcjsKICAgICAgICB9CiAgICAgICAgYWJNZW51QnV0dG9uLm1lbnVJdGVtcyA9IGN1cnJlbnRTa2lsbC50YWdzLm1lbnVJdGVtczsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUdyb3VwKGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtVHlwZSA9PSAiaW5wdXQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVJbnB1dChhYk1lbnVCdXR0b24pOwogICAgfSBlbHNlIGlmIChtZW51SXRlbVR5cGUgPT0gInRleHQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KGFiTWVudUJ1dHRvbik7CiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtVHlwZSA9PSAidG9vbCIpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2woYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSBpZiAobWVudUl0ZW1UeXBlID09ICJ3aXphcmQiKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVXaXphcmQoYWJNZW51QnV0dG9uKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsKICAgIH0KfQoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9IGBACiAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CmA7CnRoaXNCb3QubWFza3Mub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ0VzY2FwZScpKSB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgIH0KYDsKCnNob3V0KCdvbkFCT3Blbk1lbnUnLCB7IG1lbnU6IHRoYXQsIG1lbnVUeXBlLCBtZW51UG9ydGFsOiBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCB9KTsnALuw2+QI+aABEmFiQ3JlYXRlTWVudUJ1dHRvbgIEALuw2+QIos0B/A1AbGV0IG5ld01lbnVCdXR0b24gPSB7fTsKCmxldCB7CiAgICBtZW51SXRlbVN0eWxlID0ge30sCiAgICAuLi5hZGRpdGlvbmFsVGFncwp9ID0gdGhhdCA/PyB7fQoKaWYgKHR5cGVvZiBtZW51SXRlbVN0eWxlID09ICdzdHJpbmcnKSB7CiAgICBtZW51SXRlbVN0eWxlID0gbWVudUl0ZW1TdHlsZS5yZXBsYWNlKC9cdXsxRjlFQ30vdSwgJycpOyAKICAgIG1lbnVJdGVtU3R5bGUgPSBKU09OLnBhcnNlKG1lbnVJdGVtU3R5bGUpOwp9CgpmdW5jdGlvbiBoYXNCb3JkZXJTdHlsZSgpIHsKICAgIGlmIChtZW51SXRlbVN0eWxlWyJib3JkZXItdG9wLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLWxlZnQtc3R5bGUiXSAKICAgICAgICB8fCBtZW51SXRlbVN0eWxlWyJib3JkZXItYm90dG9tLXN0eWxlIl0gCiAgICAgICAgfHwgbWVudUl0ZW1TdHlsZVsiYm9yZGVyLXJpZ2h0LXN0eWxlIl0pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KCmlmIChhZGRpdGlvbmFsVGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSkgewogICAgaWYgKGFkZGl0aW9uYWxUYWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgKyAiTWVudUdyb3VwIl0pIHsKCiAgICB9Cn0KCm5ld01lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yOwpuZXdNZW51QnV0dG9uLmxhYmVsQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVMYWJlbENvbG9yID8/ICIjMDAwIjsKbmV3TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKbmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvciA9IHRoYXQuc2hhZG93Q29sb3IgPz8gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTaGFkb3dDb2xvciA/PyAiIzAwMCI7Cm5ld01lbnVCdXR0b24uc2NhbGVZID0gMTsKCmNvbnN0IG1lbnVTdHlsaW5nID0gewogICAgImJvcmRlci1yYWRpdXMiOiI4cHgiLAogICAgIm1hcmdpbi10b3AiOiAiOHB4IiwKICAgICJib3gtc2hhZG93IjogYDNweCA0cHggJHtuZXdNZW51QnV0dG9uLnNoYWRvd0NvbG9yfWAsCiAgICAibWluLWhlaWdodCI6ICI0NHB4IiwKICAgICJib3JkZXIiOiBoYXNCb3JkZXJTdHlsZSgpID8gIiIgOiBgMnB4IHNvbGlkICR7bmV3TWVudUJ1dHRvbi5zaGFkb3dDb2xvcn1gLAogICAgIndpZHRoIjogImNhbGMoMTAwJSAtIDVweCkiLAogICAgLi4ubWVudUl0ZW1TdHlsZQp9CgpuZXdNZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBtZW51U3R5bGluZzsKCmNvbnN0IGNsaWNrZWRTdHlsaW5nID0gewogICAgLi4ubWVudVN0eWxpbmcsCiAgICAiZmlsdGVyIjogImJyaWdodG5lc3MoNjAlKSIKfQpjb25zdCBiYXNlU3R5bGUgPSBgQCBtYXNrcy5tZW51SXRlbVN0eWxlID0gJ/Cfp6wgJHtKU09OLnN0cmluZ2lmeShjbGlja2VkU3R5bGluZyl9J2AKCm5ld01lbnVCdXR0b24ub25Qb2ludGVyRG93biA9IG1lbnVJdGVtU3R5bGU/LlsibWFyZ2luLXRvcCJdICE9ICIwcHgiID8gYmFzZVN0eWxlIDogIkAgLy8iOwpuZXdNZW51QnV0dG9uLm9uUG9pbnRlclVwID0gYEAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGxgOwoKZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpCnsKICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107Cn0KCm5ld01lbnVCdXR0b24gPSBjcmVhdGUobmV3TWVudUJ1dHRvbik7CgpyZXR1cm4gbmV3TWVudUJ1dHRvbjsnALuw2+QI+aABDWFiTWVudVJlZnJlc2gCBAC7sNvkCJ3bAZ0BQGlmIChjb25maWdCb3QudGFncy5tZW51UG9ydGFsPy5zdWJzdHJpbmcoMCwyKSA9PSAiYWIiKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgogICAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwogICAgbWFza3Mub25LZXlEb3duID0gbnVsbDsKfScAu7Db5Aj5oAEIcmVtZW1iZXICBAC7sNvkCLvcASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC7sNvkCPmgAQ1tYW5pZmVzdGF0aW9uAgQAu7Db5Aji3AEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAu7Db5Aj5oAERYWJFbnZpcm9ubWVudE1lbnUCBAC7sNvkCIndAcESQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKY29uc3QgYWJNZW51SXRlbSA9IHsKICAgIGFiTWVudTogdHJ1ZSwKICAgIGFiTWVudVJlZnJlc2g6ICJAZGVzdHJveSh0aGlzQm90KTsiLAogICAgbWFuaWZlc3RhdGlvbjogdGFncy5tYW5pZmVzdGF0aW9uLAogICAgcmVtZW1iZXI6IHRhZ3MucmVtZW1iZXIsCiAgICBwZXJzb25hbGl0eTogdGFncy5wZXJzb25hbGl0eSwKICAgIGxlYXJuOiB0YWdzLmxlYXJuLAp9OwoKY29uc3QgYWJFbnZpcm9ubWVudE9wdGlvbnMgPSB0aGlzQm90LmFiR2V0RW52aXJvbm1lbnRPcHRpb25zKCk7IAoKZm9yIChsZXQgaSA9IDA7IGkgPCBhYkVudmlyb25tZW50T3B0aW9ucy5sZW5ndGg7IGkrKykgeyAKICAgIGNvbnN0IG9wdGlvbiA9IGFiRW52aXJvbm1lbnRPcHRpb25zW2ldOwoKICAgIGFzc2VydCh0eXBlb2Ygb3B0aW9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyID09PSAnbnVtYmVyJywgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9fV0gYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIgbXVzdCBiZSBhIG51bWJlci5gKTsKCiAgICBhYk1lbnVJdGVtLmFiTWVudVNvcnRPcmRlciA9IG9wdGlvbi5hYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjsKCiAgICBjb25zdCBvcHRpb25Nb2QgPSB7Li4uYWJNZW51SXRlbSwgLi4ub3B0aW9ufTsKCiAgICBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2J1dHRvbicgfHwgIW9wdGlvbi5tZW51SXRlbVR5cGUpIHsKICAgICAgICB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAnZHJvcGRvd24nKSB7CiAgICAgICAgb3B0aW9uTW9kLmRyb3Bkb3duU29ydE9yZGVyID0gb3B0aW9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOwoKICAgICAgICAvLyBNYWtlIHN1cmUgZWFjaCBkcm9wZG93biBvcHRpb25zIGdldHMgYWJNZW51SXRlbSBkZWZhdWx0cy4KICAgICAgICBpZiAob3B0aW9uLmRyb3Bkb3duT3B0aW9ucyAmJiBvcHRpb24uZHJvcGRvd25PcHRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBvcHRpb24uZHJvcGRvd25PcHRpb25zLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICBvcHRpb24uZHJvcGRvd25PcHRpb25zW2tdID0geyAuLi5hYk1lbnVJdGVtLCAuLi5vcHRpb24uZHJvcGRvd25PcHRpb25zW2tdIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24ob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2dyb3VwJykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51R3JvdXAob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ2lucHV0JykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51SW5wdXQob3B0aW9uTW9kKTsKICAgIH0gZWxzZSBpZiAob3B0aW9uLm1lbnVJdGVtVHlwZSA9PT0gJ3RleHQnKSB7CiAgICAgICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVUZXh0KG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgaWYgKG9wdGlvbi5tZW51SXRlbVR5cGUgPT09ICd0b29sJykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51VG9vbChvcHRpb25Nb2QpOwogICAgfSBlbHNlIGlmIChvcHRpb24ubWVudUl0ZW1UeXBlID09PSAnd2l6YXJkJykgewogICAgICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51V2l6YXJkKG9wdGlvbk1vZCk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtZW51SXRlbVR5cGUgJHtvcHRpb24ubWVudUl0ZW1UeXBlfSBpcyBub3QgaW1wbGVtZW50ZWQuYCk7CiAgICAgICAgY29udGludWU7CiAgICB9Cn0KCi8vIHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oYWJQZXJzb25hbGl0eUNvbmZpZ0J1dHRvbik7Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gYEAKICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKYDsKdGhpc0JvdC5tYXNrcy5vbktleURvd24gPSBgQAogICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnRXNjYXBlJykpIHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgfQpgOwoKc2hvdXQoJ29uQUJFbnZpcm9ubWVudE1lbnUnLCB7IG1lbnVQb3J0YWw6IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWx9ICknALuw2+QI+aABBWxlYXJuAgQAu7Db5AjL7wEo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAu7Db5Aj5oAEDZ3B0AgQAu7Db5Ajy7wEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAu7Db5Aj5oAEIYWJJZ25vcmUCBAC7sNvkCJnwAQR0cnVlJwC7sNvkCPmgAQZzZWFyY2gCBAC7sNvkCJ7wASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwC7sNvkCPmgAQZudWdnZXQCBAC7sNvkCMXwASjwn5SXNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmJwC7sNvkCPmgAQV0ZXN0cwIEALuw2+QI7PABKPCflJdiODNkOTcyYi0wNTM1LTQwNTEtYjU4OS00MWNlZGE4NTM1ZjEnALuw2+QI+aABA2FzawIEALuw2+QIk/EBKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnALuw2+QI+aABCWFiVmVyc2lvbgIEALuw2+QIuvEBBTEwLjM3JwC7sNvkCPmgARFhYkNyZWF0ZU1lbnVJbnB1dAIEALuw2+QIwPEBngJAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudUlucHV0ID0gew0KICAgIGZvcm06ICJpbnB1dCIsDQogICAgbWVudUl0ZW1TaG93U3VibWl0V2hlbkVtcHR5OiBmYWxzZSwNCiAgICBmb3JtSW5wdXRNdWx0aWxpbmU6IG51bGwsDQogICAgb25Qb2ludGVyVXA6IG51bGwsDQogICAgb25Qb2ludGVyRG93bjogbnVsbCwNCiAgICAuLi50aGF0DQp9Ow0KDQpjb25zdCBtZW51Qm90ID0gdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUlucHV0KTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwC7sNvkCPmgARBhYkNyZWF0ZU1lbnVUZXh0AgQAu7Db5Ajf8wGBBEBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmNvbnN0IHsNCiAgICBtZW51SXRlbUxhYmVsU3R5bGUsDQogICAgLi4ucmVzdA0KfSA9IHRoYXQ7DQoNCmxldCBtZW51VGV4dCA9IHsNCiAgICBmb3JtOiAidGV4dCIsDQogICAgb25Qb2ludGVyVXA6IG51bGwsDQogICAgb25Qb2ludGVyRG93bjogbnVsbCwNCiAgICBwb2ludGFibGU6IGZhbHNlLA0KICAgIGNvbG9yOiAid2hpdGUiLA0KICAgIG1lbnVJdGVtU3R5bGU6IHsNCiAgICAgICAgInBhZGRpbmctdG9wIjogIjZweCIsDQogICAgICAgICJwYWRkaW5nLWJvdHRvbSI6ICI2cHgiLA0KICAgIH0sDQogICAgbWVudUl0ZW1MYWJlbFN0eWxlOiB7DQogICAgICAgICJ3aGl0ZS1zcGFjZSI6ICJwcmUtd3JhcCIsDQogICAgICAgIC4uLm1lbnVJdGVtTGFiZWxTdHlsZSwNCiAgICB9LA0KICAgIC4uLnJlc3QNCn07DQoNCmNvbnN0IG1lbnVCb3QgPSB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51VGV4dCk7DQoNCnJldHVybiBtZW51Qm90OycAu7Db5Aj5oAEQYWJDcmVhdGVNZW51VG9vbAIEALuw2+QI4fcBjgFAaWYgKCF0aGF0KSB7DQogICAgcmV0dXJuOw0KfQ0KDQpsZXQgbWVudVRvb2wgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVUb29sKTsNCg0KcmV0dXJuIG1lbnVCb3Q7JwC7sNvkCPmgARJhYkNyZWF0ZU1lbnVXaXphcmQCBAC7sNvkCPD4AZIBQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KbGV0IG1lbnVXaXphcmQgPSB7DQogICAgLi4udGhhdA0KfTsNCg0KY29uc3QgbWVudUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVXaXphcmQpOw0KDQpyZXR1cm4gbWVudUJvdDsnALuw2+QI+aABFGFiQ3JlYXRlTWVudURyb3Bkb3duAgQAu7Db5AiD+gGTIEBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICh0aGF0LmRyb3Bkb3duU29ydE9yZGVyID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoYGFiQ3JlYXRlTWVudURyb3Bkb3duOiBkcm9wZG93blNvcnRPcmRlciBpcyBub3QgcHJvdmlkZWQuYCk7DQp9DQoNCmxldCBvdXRlck1lbnVCdXR0b24gPSB7DQogICAgLi4udGhhdCwNCiAgICBmb3JtQWRkcmVzczogdGhhdC5mb3JtQWRkcmVzcyA/PyAiYXJyb3dfcmlnaHQiLA0KICAgIGRyb3Bkb3duT3BlbjogZmFsc2UsDQogICAgb25Cb3RBZGRlZDogYEANCiAgICAgICAgdGhpc0JvdC51cGRhdGVTdHlsZSgpOw0KICAgIGAsDQogICAgb25DbGljazogYEANCiAgICAgICAgdGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsICsgIlNvcnRPcmRlciJdID0gJHt0aGF0LmRyb3Bkb3duU29ydE9yZGVyfQ0KICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgd2hpc3Blcih0aGlzQm90LmxpbmtzLm1lbnVCb3RzLCAiY2xlYXJEcm9wZG93bk1lbnUiKTsNCiAgICAgICAgICAgIHRhZ3MuZHJvcGRvd25PcGVuID0gZmFsc2U7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMuZ2VuZXJhdGVNZW51T3B0aW9ucyh0YWdzLmRyb3Bkb3duT3B0aW9ucywgdGFncy5kcm9wZG93blNvcnRPcmRlcik7DQogICAgICAgICAgICAgICAgdGFncy5kcm9wZG93bk9wZW4gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkRlc3Ryb3k6IGBADQogICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgYCwNCiAgICB1cGRhdGVTdHlsZTogYEANCiAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIGlmICghdGFncy5jdXN0b21Gb3JtQWRkcmVzcykgew0KICAgICAgICAgICAgbWFza3MuZm9ybUFkZHJlc3MgPSAiYXJyb3dfcmlnaHQiOw0KICAgICAgICB9DQogICAgICAgIGlmICh0YWdzLmRyb3Bkb3duT3Blbikgew0KICAgICAgICAgICAgaWYgKCF0YWdzLmN1c3RvbUZvcm1BZGRyZXNzKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAiZm9ybUFkZHJlc3MiLCAiYXJyb3dfZHJvcF9kb3duIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJtZW51SXRlbVN0eWxlIiwgey4uLnRhZ3MubWVudUl0ZW1TdHlsZSwgImJvcmRlckJvdHRvbUxlZnRSYWRpdXMiOiAiMCIsICJib3JkZXJCb3R0b21SaWdodFJhZGl1cyI6ICIwIn0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbWFza3MuZm9ybUFkZHJlc3MgPSBudWxsOw0KICAgICAgICB9DQogICAgYCwNCiAgICBvbkJvdENoYW5nZWQ6IGBADQogICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ2Ryb3Bkb3duT3BlbicpKSB7DQogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVN0eWxlKCk7DQogICAgICAgICAgICBpZiAodGFncy5kcm9wZG93bk9wZW4gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVEcm9wZG93bk9wZW5lZCIsIHRoaXNCb3QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgYCwNCiAgICBhYk1lbnVEcm9wZG93bk9wZW5lZDogYEANCiAgICAgICAgaWYgKHRhZ3MuaWdub3JlT3BlbkRyb3Bkb3duUnVsZXMgPT0gdHJ1ZSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGF0ICE9IHRoaXNCb3QpIHsNCiAgICAgICAgICAgIHdoaXNwZXIodGhpc0JvdC5saW5rcy5tZW51Qm90cywgImNsZWFyRHJvcGRvd25NZW51Iik7DQogICAgICAgICAgICB0YWdzLmRyb3Bkb3duT3BlbiA9IGZhbHNlOw0KICAgICAgICAgICAgbWFza3MubWVudUl0ZW1TdHlsZSA9IG51bGw7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobGlua3MgJiYgbGlua3MuYmFzZVNraWxsKSB7DQogICAgICAgICAgICAgICAgc2V0VGFnTWFzayhhYi5saW5rcy5yZW1lbWJlciwgImxhc3RPcGVuZWREcm9wZG93biIsIHRhZ3MuYmFzZVNraWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIGANCn07DQoNCmlmICh0aGF0LmZvcm1BZGRyZXNzICYmIHRoYXQuZm9ybUFkZHJlc3MgIT0gImFycm93X3JpZ2h0Iikgew0KICAgIG91dGVyTWVudUJ1dHRvbi5jdXN0b21Gb3JtQWRkcmVzcyA9IHRydWU7DQp9DQpvdXRlck1lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IHRoYXQuZHJvcGRvd25Tb3J0T3JkZXI7DQoNCmNvbnN0IG1lbnVCb3QgPSBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihvdXRlck1lbnVCdXR0b24pOw0KbWVudUJvdC52YXJzLmdlbmVyYXRlTWVudU9wdGlvbnMgPSBnZW5lcmF0ZU1lbnVPcHRpb25zOw0KDQphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZU1lbnVPcHRpb25zIChvcHRpb25zLCBzb3J0T3JkZXIpIHsNCiAgICBjb25zdCBtZW51Qm90cyA9IFtdOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7ICsraSkgew0KDQogICAgICAgIGxldCBuZXdNZW51QnV0dG9uID0gew0KICAgICAgICAgICAgLi4ub3B0aW9uc1tpXSwNCiAgICAgICAgICAgIGFiRHJvcGRvd25PcHRpb246IHRydWUsDQogICAgICAgICAgICBjbGVhckRyb3Bkb3duTWVudTogYEANCiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOw0KICAgICAgICAgICAgYA0KICAgICAgICB9Ow0KDQogICAgICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcihzb3J0T3JkZXIpICsgKChpICsgMSkgLyAxMDAwKTsNCiAgICAgICAgbmV3TWVudUJ1dHRvbltjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9IHRydWU7DQoNCiAgICAgICAgaWYgKGkgPT0gb3B0aW9ucy5sZW5ndGggLSAxKSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIDAgOHB4IDhweCI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCAwIDhweCA4cHgiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAobmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdKSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdWyJib3JkZXJSYWRpdXMiXSA9ICIwIjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gew0KICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIwIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsiYm9yZGVyVG9wIl0gPSAibm9uZSI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsibWFyZ2luVG9wIl0gPSAiMCI7DQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXVsicGFkZGluZ0xlZnQiXSA9ICIzNXB4IjsNCg0KICAgICAgICBjb25zdCBuZXdNZW51Qm90ID0gYXdhaXQgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3TWVudUJ1dHRvbik7DQogICAgICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQogICAgfQ0KDQogICAgbWVudUJvdC50YWdzLm1lbnVCb3RzID0gZ2V0TGluayhtZW51Qm90cyk7DQp9DQoNCmlmICh0aGF0LmRlZmF1bHRPcGVuKSB7DQogICAgbWVudUJvdC5vblBvaW50ZXJVcCgpOw0KICAgIG1lbnVCb3Qub25DbGljaygpOw0KfQ0KDQpyZXR1cm4gbWVudUJvdDsNCg0KJwC7sNvkCPmgARFhYkNyZWF0ZU1lbnVHcm91cAIEALuw2+QIl5oCvR9ALyoNCiAgIEVYQU1QTEUNCiAgIGNvbnN0IG1lbnVHcm91cCA9IHsNCiAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAuLi5tZW51T3B0aW9ucywNCiAgICAgICAgZ3JvdXBTb3J0T3JkZXI6IDEsDQogICAgICAgIG1lbnVJdGVtczogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiZ3JvdXAgb3B0aW9uIDEiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMiIsDQogICAgICAgICAgICAgICAgY29sb3I6ICJvcmFuZ2UiLA0KICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJncm91cCBvcHRpb24gMyIsDQogICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgIG1lbnVJdGVtVHlwZTogImRyb3Bkb3duIiwNCiAgICAgICAgICAgICAgICBkcm9wZG93bk9wdGlvbnM6IFsNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJvcHRpb24gMSIsDQogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQGAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAib3B0aW9uIDIiLA0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEBgLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIm9wdGlvbiAzIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGBAYCwNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0NCiAgICAgICAgXQ0KICAgIH0NCiovDQoNCmlmICAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICghdGhhdC5ncm91cFNvcnRPcmRlcikgew0KICAgIHRocm93IG5ldyBFcnJvcihgYWJDcmVhdGVNZW51R3JvdXA6IGdyb3VwU29ydE9yZGVyIGlzIG5vdCBwcm92aWRlZC5gKTsNCn0NCg0KbGV0IHsNCiAgICBtZW51SXRlbVN0eWxlID0ge30sDQogICAgbWVudUl0ZW1zID0gW10sDQogICAgLi4uYWRkaXRpb25hbFRhZ3MNCn0gPSB0aGF0ID8/IHt9DQoNCmNvbnN0IG1lbnVCb3RzID0gW107DQpmb3IgKGxldCBpID0gMDsgaSA8IG1lbnVJdGVtcy5sZW5ndGg7ICsraSkgew0KDQogICAgbGV0IG5ld01lbnVCdXR0b24gPSB7fTsNCg0KICAgIG5ld01lbnVCdXR0b25bY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCArICJTb3J0T3JkZXIiXSA9IE51bWJlcih0aGF0Lmdyb3VwU29ydE9yZGVyKSArICgoaSArIDEpIC8gMTAwKTsNCg0KICAgIGxldCBpbmRpdk1lbnVJdGVtU3R5bGUgPSBtZW51SXRlbXNbaV0ubWVudUl0ZW1TdHlsZSA/PyB7fTsNCiAgICBsZXQgaW5kaXZNZW51VHlwZSA9IG1lbnVJdGVtc1tpXS5tZW51SXRlbVR5cGUgPz8gdW5kZWZpbmVkOw0KICAgIGxldCBpbmRpdkFkZGl0aW9uYWxUYWdzID0gbWVudUl0ZW1zW2ldOw0KICAgIGlmIChpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVN0eWxlIl0pIHsNCiAgICAgICAgZGVsZXRlIGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtU3R5bGUiXTsNCiAgICB9DQogICAgaWYgKGluZGl2QWRkaXRpb25hbFRhZ3NbIm1lbnVJdGVtVHlwZSJdKSB7DQogICAgICAgIGRlbGV0ZSBpbmRpdkFkZGl0aW9uYWxUYWdzWyJtZW51SXRlbVR5cGUiXTsNCiAgICB9DQoNCiAgICBjb25zdCBiYXNlU3R5bGluZyA9IHsNCiAgICAgICAgImJvcmRlclRvcCI6ICJub25lIiwNCiAgICAgICAgIm1hcmdpblRvcCI6ICIwIg0KICAgIH0NCg0KICAgIGlmIChpID09IG1lbnVJdGVtcy5sZW5ndGggLSAxICYmIGkgPT0gMCkgew0KICAgICAgICBjb25zdCBtZW51U3R5bGluZyA9IHsNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0NCiAgICBlbHNlIGlmIChpID09IG1lbnVJdGVtcy5sZW5ndGggLSAxKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4uYmFzZVN0eWxpbmcsDQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjAgMCA4cHggOHB4IiwNCiAgICAgICAgICAgIC4uLm1lbnVJdGVtU3R5bGUsDQogICAgICAgICAgICAuLi5pbmRpdk1lbnVJdGVtU3R5bGUNCiAgICAgICAgfQ0KDQogICAgICAgIG5ld01lbnVCdXR0b25bIm1lbnVJdGVtU3R5bGUiXSA9IG1lbnVTdHlsaW5nOw0KICAgIH0gZWxzZSBpZiAoaSA9PSAwKSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgImJvcmRlclJhZGl1cyI6ICI4cHggOHB4IDAgMCIsDQogICAgICAgICAgICAuLi5tZW51SXRlbVN0eWxlLA0KICAgICAgICAgICAgLi4uaW5kaXZNZW51SXRlbVN0eWxlDQogICAgICAgIH0NCg0KICAgICAgICBuZXdNZW51QnV0dG9uWyJtZW51SXRlbVN0eWxlIl0gPSBtZW51U3R5bGluZzt9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IG1lbnVTdHlsaW5nID0gew0KICAgICAgICAgICAgLi4uYmFzZVN0eWxpbmcsDQogICAgICAgICAgICAiYm9yZGVyUmFkaXVzIjogIjAiLA0KICAgICAgICAgICAgLi4ubWVudUl0ZW1TdHlsZSwNCiAgICAgICAgICAgIC4uLmluZGl2TWVudUl0ZW1TdHlsZQ0KICAgICAgICB9DQoNCiAgICAgICAgbmV3TWVudUJ1dHRvblsibWVudUl0ZW1TdHlsZSJdID0gbWVudVN0eWxpbmc7DQogICAgfQ0KDQogICAgZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpDQogICAgew0KICAgICAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBhZGRpdGlvbmFsVGFnc1t0YWddOw0KICAgIH0NCg0KICAgIGZvciAoY29uc3QgdGFnIGluIGluZGl2QWRkaXRpb25hbFRhZ3MpDQogICAgew0KICAgICAgICBuZXdNZW51QnV0dG9uW3RhZ10gPSBpbmRpdkFkZGl0aW9uYWxUYWdzW3RhZ107DQogICAgfQ0KDQogICAgbGV0IG5ld01lbnVCb3Q7DQogICAgc3dpdGNoKGluZGl2TWVudVR5cGUpIHsNCiAgICAgICAgY2FzZSAiZHJvcGRvd24iOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51RHJvcGRvd24oDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAuLi5uZXdNZW51QnV0dG9uLA0KICAgICAgICAgICAgICAgICAgICAiZHJvcGRvd25Tb3J0T3JkZXIiOiBOdW1iZXIodGhhdC5ncm91cFNvcnRPcmRlcikgKyAoKGkgKyAxKSAvIDEwKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgImlucHV0IjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudUlucHV0KG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInRleHQiOiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51VGV4dChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJ0b29sIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVRvb2wobmV3TWVudUJ1dHRvbik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAid2l6YXJkIjogDQogICAgICAgICAgICBhd2FpdCB0aGlzQm90LmFiQ3JlYXRlTWVudVdpemFyZChuZXdNZW51QnV0dG9uKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBkZWZhdWx0OiANCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld01lbnVCdXR0b24pOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgfQ0KICAgIG1lbnVCb3RzLnB1c2gobmV3TWVudUJvdCk7DQp9DQoNCnJldHVybiBtZW51Qm90czsnALuw2+QI+aABC3BlcnNvbmFsaXR5AgQAu7Db5AjVuQIo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAu7Db5Aj5oAEXYWJHZXRFbnZpcm9ubWVudE9wdGlvbnMCBAC7sNvkCPy5ArZ7QGNvbnN0IG9wdGlvbnMgPSBbXTsKCmlmICghY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6IGBoaWRlYCwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMCwKICAgICAgICBmb3JtQWRkcmVzczogInZpc2liaWxpdHlfb2ZmIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgfSksCiAgICB9KQp9CgppZiAoIWNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAic2xlZXAiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJuaWdodHNfc3RheSIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiU2V0QXdha2UoeyBhd2FrZTogZmFsc2UgfSkKICAgICAgICB9KSwKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogIm9wdGltaXplIG1vZGUiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDIwMCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgfSksCiAgICByZWZyZXNoRGlzcGxheTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnIDogdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA/IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gZmFsc2UgOiBjb25maWdCb3QudGFncy5hYk9wdGltaXplZCA9IHRydWU7CiAgICAgICAgdGhpc0JvdC5vbkNyZWF0ZSgpOwogICAgfSksCn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJjdXN0b21pemU6IGFiIHBlcnNvbmFsaXR5IiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAzMDAsCiAgICBtZW51SXRlbVR5cGU6ICdkcm9wZG93bicsCiAgICBkcm9wZG93bk9wdGlvbnM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbmFtZTogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5fWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwgeyB0aXRsZTogJ3doYXQgd291bGQgeW91IGxpa2UgdG8gY2FsbCBtZT8nIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBuYW1lOiBuYW1lIH0pOwogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgYWkgbW9kZWw6ICR7bGlua3MucGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWx9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbHMgPSBjb25maWdCb3QudGFncy5haUNoYXRNb2RlbHM7CgogICAgICAgICAgICAgICAgaWYgKG1vZGVscykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBbXTsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBtb2RlbHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKHsgbGFiZWw6IGVudHJ5Lm5hbWUsIHZhbHVlOiBlbnRyeS5uYW1lIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudE1vZGVsSW5kZXggPSBvcHRpb25zLmZpbmRJbmRleChvID0+IG8udmFsdWUgPT09IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsKTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQoY3VycmVudE1vZGVsSW5kZXgsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICd3aGF0IGFpIG1vZGVsIHdvdWxkIHlvdSBsaWtlIG1lIHRvIHVzZT8nLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbGlzdCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBvcHRpb25zLAogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRPcHRpb24gJiYgc2VsZWN0ZWRPcHRpb24udmFsdWUgIT09IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgYWlNb2RlbDogc2VsZWN0ZWRPcHRpb24udmFsdWUgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aEJvdCkgewogICAgICAgICAgICAgICAgICAgICAgICBvcy5zaG93QWxlcnQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdzb21ldGhpbmcgd2VudCB3cm9uZycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnZmFpbGVkIHRvIGdldCBsaXN0IG9mIGFpIGNoYXQgbW9kZWxzLicKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBvcy5zaG93QWxlcnQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdzaWduIGluIHJlcXVpcmVkJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICd5b3UgbXVzdCBzaWduIGluIHRvIHVzZSBhaS4nCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yfWAsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZWRpdF9ub3RlIiwKICAgICAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvciwgeyB0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbWUgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgY29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUNvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51cyB0byBiZT8nIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeyBtZW51Q29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgbWVudSB0ZXh0IGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTWVudUxhYmVsQ29sb3J9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IGF3YWl0IG9zLnNob3dJbnB1dChsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZU1lbnVMYWJlbENvbG9yLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCBjb2xvciB3b3VsZCB5b3UgbGlrZSBteSBtZW51IHRleHQgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgbWVudUxhYmVsQ29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiBgYm90IGxhYmVsIGNvbG9yOiAke2xpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvcn1gLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlTGFiZWxDb2xvciwgeyB0eXBlOiAnY29sb3InLCB0aXRsZTogJ3doYXQgY29sb3Igd291bGQgeW91IGxpa2UgbXkgYm90IHRleHQgdG8gYmU/JyB9KTsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgYm90TGFiZWxDb2xvcjogY29sb3IgfSk7CiAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6IGBkZWZhdWx0IHBvcnRhbCBjb2xvcjogJHtsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvciA/PyAnIzI2MzIzOCd9YCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgcG9ydGFsQ29sb3IgPSBhd2FpdCBvcy5zaG93SW5wdXQobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3IgPz8gJyMyNjMyMzgnLCB7IHR5cGU6ICdjb2xvcicsIHRpdGxlOiAnd2hhdCB3b3VsZCB5b3UgbGlrZSB5b3VyIHBvcnRhbCB0byBsb29rIGxpa2U/JyB9KTsKICAgICAgICAgICAgICAgIGlmICghcG9ydGFsQ29sb3IpIHsKICAgICAgICAgICAgICAgICAgICBwb3J0YWxDb2xvciA9ICcjMjYzMjM4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgJ3BvcnRhbENvbG9yJzogcG9ydGFsQ29sb3IgfSk7CiAgICAgICAgICAgIH0pLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBsYWJlbDogYGRlZmF1bHQgbWFwIHBvcnRhbCBiYXNlbWFwYCwKICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICJlZGl0X25vdGUiLAogICAgICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG91dCgic2hvd0FCQmFzZW1hcE9wdGlvbnMiKTsKICAgICAgICAgICAgfSksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhYmVsOiAiZGVmYXVsdCBzZXR0aW5ncyIsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgICAgICAgICBjb2xvcjogJ3JlZCcsCiAgICAgICAgICAgIGxhYmVsQ29sb3I6ICdibGFjaycsCiAgICAgICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsgJ2RlZmF1bHRQZXJzb25hbGl0eSc6IHRydWUgfSk7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgICAgICB9KSwKICAgICAgICB9LAogICAgXQp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiY2hhdCIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogNDAwLAogICAgZm9ybUFkZHJlc3M6ICJjaGF0IiwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBzaG91dCgnYWJDaGF0QmFyT3BlbicpOyBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgfSksCn0pCgpvcHRpb25zLnB1c2goewogICAgbGFiZWw6ICJudWdnZXRzIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1MDAsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRhZ3MubnVnTWFuYWdlciA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuaW50ZXJmYWNlLm51Z2dldCcpKTsgCiAgICAgICAgCiAgICAgICAgaWYgKGxpbmtzLm51Z01hbmFnZXIudGFncy5saXN0ZW5pbmcpIHsgCiAgICAgICAgICAgIHRhZ3Mub25DbGljayA9IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IAogICAgICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCBudWxsKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94YDsgCiAgICAgICAgfSBlbHNlIHsgCiAgICAgICAgICAgIHRhZ3Mub25DbGljayA9IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IAogICAgICAgICAgICAgICAgaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKICAgICAgICAgICAgICAgIHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIHRydWUsICdsb2NhbCcpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGBjaGVja19ib3hfb3V0bGluZV9ibGFua2A7CiAgICAgICAgfQogICAgfSksCn0pCgppZiAobGlua3MucHJlc2VuY2UpIHsKICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgbGFiZWw6ICJjYW1lcmEgcHJlc2VuY2UiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA1MTAsCiAgICAgICAgcHJlc2VuY2U6IHRhZ3MucHJlc2VuY2UsCiAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkID0gKHRoYXQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ2NhbWVyYUVuYWJsZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QucmVmcmVzaERpc3BsYXkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgb3MuYWRkQm90TGlzdGVuZXIobGlua3MucHJlc2VuY2UsICdvbkJvdENoYW5nZWQnLCB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQpOwoKICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgIH0pLAogICAgICAgIHJlZnJlc2hEaXNwbGF5OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGxpbmtzLnByZXNlbmNlLnRhZ3MuY2FtZXJhRW5hYmxlZCA/IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JyA6IHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIH0pLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgc2V0VGFnTWFzayhsaW5rcy5wcmVzZW5jZSwgJ2NhbWVyYUVuYWJsZWQnLCAhISFsaW5rcy5wcmVzZW5jZS50YWdzLmNhbWVyYUVuYWJsZWQsICdsb2NhbCcpOwogICAgICAgIH0pLAogICAgICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBvcy5yZW1vdmVCb3RMaXN0ZW5lcihsaW5rcy5wcmVzZW5jZSwgJ29uQm90Q2hhbmdlZCcsIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCk7CiAgICAgICAgfSkKICAgIH0pCgogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogImN1cnNvciBwcmVzZW5jZSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDUyMCwKICAgICAgICBwcmVzZW5jZTogdGFncy5wcmVzZW5jZSwKICAgICAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICB0aGlzQm90LnZhcnMub25QcmVzZW5jZUJvdENoYW5nZWQgPSAodGhhdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoYXQudGFncy5pbmNsdWRlcygnY3Vyc29yRW5hYmxlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpc0JvdC5yZWZyZXNoRGlzcGxheSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5hZGRCb3RMaXN0ZW5lcihsaW5rcy5wcmVzZW5jZSwgJ29uQm90Q2hhbmdlZCcsIHRoaXNCb3QudmFycy5vblByZXNlbmNlQm90Q2hhbmdlZCk7CgogICAgICAgICAgICB0aGlzQm90LnJlZnJlc2hEaXNwbGF5KCk7CiAgICAgICAgfSksCiAgICAgICAgcmVmcmVzaERpc3BsYXk6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgbGlua3MucHJlc2VuY2UudGFncy5jdXJzb3JFbmFibGVkID8gdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnIDogdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBzZXRUYWdNYXNrKGxpbmtzLnByZXNlbmNlLCAnY3Vyc29yRW5hYmxlZCcsICEhIWxpbmtzLnByZXNlbmNlLnRhZ3MuY3Vyc29yRW5hYmxlZCwgJ2xvY2FsJyk7CiAgICAgICAgfSksCiAgICAgICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIG9zLnJlbW92ZUJvdExpc3RlbmVyKGxpbmtzLnByZXNlbmNlLCAnb25Cb3RDaGFuZ2VkJywgdGhpc0JvdC52YXJzLm9uUHJlc2VuY2VCb3RDaGFuZ2VkKTsKICAgICAgICB9KQogICAgfSkKfQoKaWYgKGxpbmtzLmdwdCkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBmb3JtQWRkcmVzczogImVkaXRfbm90ZSIsCiAgICAgICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDYwMCwKICAgICAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBpZiAoIWF1dGhCb3QpIHsKICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gJ0ZyZWVQbGF5JyB8fCBhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSAnZWRpdCAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgcHJvbXB0JzsgdGFncy5ncHRCb3QgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmFjdGlvbi5hc2snKSk7CiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpOwogICAgICAgIH0pLAogICAgfSkKfQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiZ3JpZCBzbmFwIiwKICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA3MDAsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJwogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgIH0pLAp9KQoKb3B0aW9ucy5wdXNoKHsKICAgIGxhYmVsOiAiYm90IHNuYXAiLAogICAgYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI6IDgwMCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgfSksCn0pCgppZiAoYXV0aEJvdCkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogImFjY291bnQiLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiA5MDAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJiYWRnZSIsCiAgICAgICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICBvcy5zaG93QWNjb3VudEluZm8oKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9KSwKICAgIH0pCn0KCmlmIChsaW5rcy50ZXN0cykgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInJlY29yZCB0ZXN0IiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTAwMCwKICAgICAgICBmb3JtQWRkcmVzczogInNjaWVuY2UiLAogICAgICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgc2hvdXQoJ2FiUmVjb3JkVGVzdCcpOwogICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgIH0pLAogICAgfSkKCiAgICBvcHRpb25zLnB1c2goewogICAgICAgIGxhYmVsOiAicmVjb3JkIHRyYWNlIiwKICAgICAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTEwMCwKICAgICAgICBmb3JtQWRkcmVzczogInRpbWVsaW5lIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIHNob3V0KCdhYlJlY29yZFRyYWNlJyk7CiAgICAgICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICAgICAgfSksCiAgICB9KQp9CgppZiAoZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaG9tZS5lZ2ciKSkgewogICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICBsYWJlbDogInNhdmUgaG9tZSBlZ2ciLAogICAgICAgIGFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOiAxMjAwLAogICAgICAgIGZvcm1BZGRyZXNzOiAiZWdnIiwKICAgICAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgIGdldEJvdCgic3lzdGVtIiwgImFiLmhvbWUuZWdnIikuc2F2ZURhdGEoKTsgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgICAgICB9KSwKICAgIH0pCn0KCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogImNoZWNrIGZvciAiICsgYWIubGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgdXBkYXRlcyIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogMTMwMCwKICAgIGZvcm1BZGRyZXNzOiAiY3ViZSIsCiAgICBsZWFybjogdGFncy5sZWFybiwKICAgIGNoZWNrRm9yVXBkYXRlczogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgIC8vIFRlbXBvcmFyaWx5IHJlcGxhY2Ugd2l0aCBidXN5IGluZGljYXRvciB3aGlsZSBjaGVja2luZyBmb3IgdXBkYXRlcy4KICAgICAgICB0YWdzLmFiTWVudSA9IGZhbHNlOwoKICAgICAgICB0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvciA9IGFiLmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnVzeUluZGljYXRvcih7CiAgICAgICAgICAgIGFiTWVudTogdHJ1ZSwKICAgICAgICAgICAgbGFiZWw6ICdjaGVja2luZyBmb3IgdXBkYXRlcyB0byAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LAogICAgICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IHRhZ3MuYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIsCiAgICAgICAgfSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5hYlVwZGF0ZUNoZWNrID0gYXdhaXQgYWIuYWJDaGVja0FCVXBkYXRlQXZhaWxhYmxlKHsgZGV0YWlsZWQ6IHRydWUgfSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcik7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yID0gbnVsbDsKCiAgICAgICAgICAgIC8vIEJyaW5nIGJhY2sgdGhlIHVwZGF0ZSBidXR0b24uCiAgICAgICAgICAgIHRhZ3MuYWJNZW51ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjayAmJiB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay5zdWNjZXNzKSB7CiAgICAgICAgICAgIGlmIChnbG9iYWxUaGlzLmFiVXBkYXRlQ2hlY2tlcikgewogICAgICAgICAgICAgICAgYWJVcGRhdGVDaGVja2VyLnRhZ3MudXBkYXRlQXZhaWxhYmxlID0gdGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sudXBkYXRlQXZhaWxhYmxlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLmFiVXBkYXRlQ2hlY2sudXBkYXRlQXZhaWxhYmxlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhYkZpbGVzV2l0aFVwZGF0ZXMgPSB0aGlzQm90LnZhcnMuYWJVcGRhdGVDaGVjay5hYkZpbGVDaGVja3MuZmlsdGVyKGYgPT4gZi51cGRhdGVBdmFpbGFibGUpOwoKICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IG9zLnNob3dDb25maXJtKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1VwZGF0ZXMgZm91bmQgZm9yICcgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogJ1RoZXJlIGFyZSAnICsgYWJGaWxlc1dpdGhVcGRhdGVzLmxlbmd0aCArICcgZmlsZSB1cGRhdGVzIGZvciAnICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJy4gV291bGQgeW91IGxpa2UgdG8gaW5zdGFsbCB0aGUgdXBkYXRlcyBub3c/IFlvdSBhbmQgYW55IGNvbm5lY3RlZCB1c2VycyB3aWxsIGF1dG9tYXRpY2FsbHkgcmVmcmVzaCB0aGUgcGFnZSBhZnRlciB0aGUgdXBkYXRlIGlzIGNvbXBsZXRlLicsCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsVGV4dDogJ05vdCBub3cnLAogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1UZXh0OiAnWWVzJwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgICAgICAgICAgbGlua3MubGVhcm4udXBkYXRlQUIoKTsKICAgICAgICAgICAgICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWIubGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdChhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIGlzIGFscmVhZHkgdXAtdG8tZGF0ZSEnKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1hc2tzLmxhYmVsID0gJ3VwZGF0ZSBjaGVjayBmYWlsZWQnOwogICAgICAgIH0KICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRoaXNCb3QuY2hlY2tGb3JVcGRhdGVzKCk7CiAgICB9KSwKICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGlzQm90LnZhcnMuYnVzeUluZGljYXRvcikgewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QudmFycy5idXN5SW5kaWNhdG9yKTsKICAgICAgICB9CiAgICB9KSwKfSkKCm9wdGlvbnMucHVzaCh7CiAgICBsYWJlbDogInBlcm1hbmVudGx5IGRlbGV0ZSIsCiAgICBhYkVudmlyb25tZW50TWVudVNvcnRPcmRlcjogOTk5OSwKICAgIGZvcm1BZGRyZXNzOiAiZGVsZXRlX2ZvcmV2ZXIiLAogICAgbGFiZWxDb2xvcjogJ2JsYWNrJywKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGFncy5sYWJlbCArPSAiICIgKyBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5OwogICAgICAgIHRhZ3MuY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbnRyYXN0Q29sb3IgPz8gIiNEOTMwMzAiOwogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICB0aXRsZTogJ1Blcm1hbmVudGx5IGRlbGV0ZSAnICsgbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwKICAgICAgICAgICAgY29udGVudDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArIGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAnIGZyb20gJyArIGxpbmtzLmxlYXJuLnRhZ3MuYWJJbnN0ICsgJz8gVGhpcyBpcyBub3QgcmV2ZXJzaWJsZSEnLAogICAgICAgIH0pCgogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CgogICAgICAgIGNvbnN0IGFiQm90cyA9IGdldEJvdHMoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtICYmCiAgICAgICAgICAgICAgICBiLnRhZ3Muc3lzdGVtLnN0YXJ0c1dpdGgoJ2FiJyk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgZGVzdHJveShhYkJvdHMpOwogICAgICAgIH0KICAgIH0pLAp9KQoKcmV0dXJuIG9wdGlvbnM7JwC7sNvkCPmgAR5hYkNyZWF0ZVRvb2xib3hEcm9wZG93bk9wdGlvbnMCBAC7sNvkCLO1A+MTQGNvbnN0IHRvb2xib3hUb29scyA9IFsuLi50aGF0LnRvb2xBcnJheV0gPz8gW107DQpjb25zdCB0b29sYm94TmFtZSA9IHRoYXQudG9vbGJveE5hbWUgPz8gIktpdCAiOw0KY29uc3QgdG9vbGJveCA9IHRoYXQudG9vbGJveDsNCmNvbnN0IGdyaWRJbmZvcm1hdGlvbiA9ICh0aGF0Py5ncmlkSW5mb3JtYXRpb24gJiYgdGhhdD8uZ3JpZEluZm9ybWF0aW9uICE9IHVuZGVmaW5lZCkgPyB0aGF0Py5ncmlkSW5mb3JtYXRpb24gOiBhYlJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7DQoNCmNvbnN0IGRyb3Bkb3duT3B0aW9ucyA9IFtdOw0KY29uc3QgYWN0aXZlTWVudSA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7DQoNCmNvbnN0IG1lbnVPcHRpb25zID0ge307DQoNCm1lbnVPcHRpb25zLmRpbWVuc2lvbiA9IGFjdGl2ZU1lbnU7DQptZW51T3B0aW9uc1thY3RpdmVNZW51XSA9IHRydWU7DQptZW51T3B0aW9ucy5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOw0KbWVudU9wdGlvbnMudG9vbGJveCA9IGdldExpbmsodG9vbGJveCk7DQptZW51T3B0aW9ucy5ncmlkSW5mb3JtYXRpb24gPSBncmlkSW5mb3JtYXRpb247DQptZW51T3B0aW9ucy5zZWFyY2ggPSB0YWdzLnNlYXJjaDsNCm1lbnVPcHRpb25zLmFydGlmYWN0ID0gdGFncy5hcnRpZmFjdDsNCi8vbWVudU9wdGlvbnMuZm9ybUFkZHJlc3MgPSAiaGFyZHdhcmUiOw0KDQppZiAodG9vbGJveFRvb2xzLmxlbmd0aCA9PT0gMCkgew0KICAgIGNvbnN0IG1lc3NhZ2UgPSB0b29sYm94TmFtZSArICIgZG9lcyBub3QgaGF2ZSBhbnkgdG9vbHMgbGlzdGVkIGluIHRoZSB0b29sX2FycmF5IHRhZyI7DQoNCiAgICBhYi5sb2coYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIG1lc3NhZ2UpOw0KICAgIG9zLnRvYXN0KG1lc3NhZ2UsIDUpOw0KICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7DQp9DQoNCmZvciAobGV0IHRvb2wgb2YgdG9vbGJveFRvb2xzKSB7DQogICAgY29uc3QgdG9vbEJ1dHRvbiA9IHsNCiAgICAgICAgLi4ubWVudU9wdGlvbnMsDQogICAgICAgIGxhYmVsOiB0b29sLm5hbWUsDQogICAgICAgIHRhcmdldEFCOiB0b29sLnRhcmdldEFCLA0KICAgICAgICBpc0FydGlmYWN0OiB0b29sLmFydGlmYWN0IHx8IGZhbHNlLA0KICAgICAgICBvbkNsaWNrOmBADQogICAgICAgICAgICBpZiAodGFncy5pc0FydGlmYWN0KSB7DQogICAgICAgICAgICAgICAgY29uc3QgYWJBcnRpZmFjdFNoYXJkID0gew0KICAgICAgICAgICAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJveEJvdDogdGFncy50b29sYm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzOiBbDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUINCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgbGlua3MuYXJ0aWZhY3QuYWJDcmVhdGVBcnRpZmFjdFByb21pc2VCb3Qoew0KICAgICAgICAgICAgICAgICAgICBhYkFydGlmYWN0TmFtZTogdGFncy50YXJnZXRBQiwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdEluc3RhbmNlSUQ6IHV1aWQoKSwNCiAgICAgICAgICAgICAgICAgICAgYWJBcnRpZmFjdFNoYXJkLA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsNCiAgICAgICAgICAgICAgICAgICAgYXNrSUQ6IHRhZ3MudGFyZ2V0QUIsDQogICAgICAgICAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAndG9vbCcsDQogICAgICAgICAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xib3hCb3Q6IHRhZ3MudG9vbGJveCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogdGFncy5ncmlkSW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgLA0KICAgIH07DQoNCiAgICBpZiAodG9vbC5mb3JtQWRkcmVzcykgew0KICAgICAgICB0b29sQnV0dG9uLmZvcm1BZGRyZXNzID0gdG9vbC5mb3JtQWRkcmVzczsNCiAgICB9DQoNCiAgICBkcm9wZG93bk9wdGlvbnMucHVzaCh0b29sQnV0dG9uKTsNCn0NCg0KcmV0dXJuIGRyb3Bkb3duT3B0aW9uczsnALuw2+QI+aABEG9uQUJBdXRoQm90QWRkZWQCBAC7sNvkCJfJAxhAc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsnALuw2+QI+aABCGFydGlmYWN0AgQAu7Db5AiwyQMo8J+Ulzc4ZTQxNTAzLWM5MzMtNGY4YS04MTdhLWJhOTdiZjhkNWQyNycBBGJvdHMkYzc4YWE2NjMtZDA1Yy00ZWM0LWJjMmMtMjZmZDUxNTYwYjk3AScAu7Db5AjXyQMVYWJDcmVhdGVDdWJlRmFjZVBsYW5lAgQAu7Db5AjYyQOJMUBsZXQgeyAKICAgIGJvdCwKICAgIGRpbWVuc2lvbiwKICAgIHNwYWNlID0gJ3RlbXBMb2NhbCcsCiAgICBkZWJ1ZywKICAgIGZhY2VPZmZzZXQgPSAwLjAxLAogICAgcG9pbnRhYmxlID0gZmFsc2UsCiAgICB0aWNrSW50ZXJ2YWxNUyA9IDUwMCwKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge307Cgphc3NlcnQobGlua3MudXRpbHMuaXNCb3QoYm90KSwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3QgaXMgYSByZXF1aXJlZCBCb3QgcGFyYW1ldGVyLmApOwphc3NlcnQoZGltZW5zaW9uLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRpbWVuc2lvbiBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKYXNzZXJ0KHJlc3QuZm9ybSA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGZvcm0gaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LmFuY2hvclBvaW50ID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYW5jaG9yUG9pbnQgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0Lm9uQm90QWRkZWQgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKCmNvbnN0IGZhY2VQbGFuZU1vZCA9IHsKICAgIHNwYWNlLAogICAgYW5jaG9yUG9pbnQ6ICdjZW50ZXInLAogICAgZGVidWcsCiAgICBmYWNlT2Zmc2V0LAogICAgZm9ybTogJ3Nwcml0ZScsCiAgICBkaW1lbnNpb24sCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIHBvaW50YWJsZSwKICAgIHRpY2tJbnRlcnZhbE1TLAogICAgdHJhbnNmb3JtZXI6IGJvdC5pZCwKICAgIG9uQm90QWRkZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnN0YXJ0VGljaygpOwogICAgfSksCiAgICBvbkJvdENoYW5nZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCd0aWNrSW50ZXJ2YWxNUycpKSB7CiAgICAgICAgICAgIHRoaXNCb3Quc3RvcFRpY2soKTsKICAgICAgICAgICAgdGhpc0JvdC5zdGFydFRpY2soKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ3RyYW5zZm9ybWVyJykpIHsKICAgICAgICAgICAgaWYgKCF0YWdzLnRyYW5zZm9ybWVyKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkFueUJvdHNSZW1vdmVkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRhZ3MudHJhbnNmb3JtZXIpIHsKICAgICAgICAgICAgaWYgKHRoYXQuYm90SURzLmluY2x1ZGVzKHRhZ3MudHJhbnNmb3JtZXIpKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90LnN0b3BUaWNrKCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGVzdHJveWVkYCk7CiAgICAgICAgfQogICAgfSksCiAgICBzZXREaW1lbnNpb246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25zdCBkaW1lbnNpb24gPSB0aGF0OwoKICAgICAgICBpZiAodGFncy5kaW1lbnNpb24gIT09IGRpbWVuc2lvbikgewogICAgICAgICAgICAvLyBSZW1vdmUgZnJvbSBwcmV2aW91cyBkaW1lbnNpb24uCiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gbnVsbDsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdQb3NpdGlvbiddID0gbnVsbDsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbiArICdSb3RhdGlvbiddID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChkaW1lbnNpb24pIHsKICAgICAgICAgICAgICAgIC8vIEFzc2lnbiB0byBuZXcgZGltZW5zaW9uLgogICAgICAgICAgICAgICAgdGFncy5kaW1lbnNpb24gPSBkaW1lbnNpb247CiAgICAgICAgICAgICAgICB0YWdzW2RpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0pLAogICAgc3RhcnRUaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKG1hc2tzLnRpY2tJbnRlcnZhbElkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG1hc2tzLnRpY2tJbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAndGljaycpLCB0YWdzLnRpY2tJbnRlcnZhbE1TKTsKICAgICAgICB0aGlzQm90LnRpY2soKTsKICAgIH0pLAogICAgc3RvcFRpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAobWFza3MudGlja0ludGVydmFsSWQpIHsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChtYXNrcy50aWNrSW50ZXJ2YWxJZCk7CiAgICAgICAgICAgIG1hc2tzLnRpY2tJbnRlcnZhbElkID0gbnVsbDsKICAgICAgICB9CiAgICB9KSwKICAgIHRpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25zdCBMT0NBTF9OT1JNQUxTID0gWwogICAgICAgICAgICBuZXcgVmVjdG9yMygxLCAwLCAwKSwgLy8gK1gKICAgICAgICAgICAgbmV3IFZlY3RvcjMoLTEsIDAsIDApLCAvLyAtWAogICAgICAgICAgICBuZXcgVmVjdG9yMygwLCAxLCAwKSwgLy8gK1kKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgLTEsIDApLCAvLyAtWQogICAgICAgIF0KCiAgICAgICAgY29uc3QgTE9DQUxfUE9TSVRJT05TID0gWwogICAgICAgICAgICBuZXcgVmVjdG9yMygwLjUgKyB0YWdzLmZhY2VPZmZzZXQsIDAsIC0wLjUpLCAvLyArWAogICAgICAgICAgICBuZXcgVmVjdG9yMygtMC41IC0gdGFncy5mYWNlT2Zmc2V0LCAwLCAtMC41KSwgLy8gLVgKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgMC41ICsgdGFncy5mYWNlT2Zmc2V0LCAtMC41KSwgLy8gK1kKICAgICAgICAgICAgbmV3IFZlY3RvcjMoMCwgLTAuNSAtIHRhZ3MuZmFjZU9mZnNldCwgLTAuNSksIC8vIC1ZCiAgICAgICAgXQoKICAgICAgICBjb25zdCBIQUxGX1BJID0gTWF0aC5QSSAvIDI7CgogICAgICAgIGNvbnN0IExPQ0FMX1JPVEFUSU9OUyA9IFsKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogSEFMRl9QSSwgeTogSEFMRl9QSSwgejogMCB9fSksIC8vICtYCiAgICAgICAgICAgIG5ldyBSb3RhdGlvbih7IGV1bGVyOiB7IHg6IEhBTEZfUEksIHk6IC1IQUxGX1BJLCB6OiAwIH19KSwgLy8gLVgKICAgICAgICAgICAgbmV3IFJvdGF0aW9uKHsgZXVsZXI6IHsgeDogLUhBTEZfUEksIHk6IDAsIHo6IE1hdGguUEkgfX0pLCAvLyArWQogICAgICAgICAgICBuZXcgUm90YXRpb24oeyBldWxlcjogeyB4OiBIQUxGX1BJLCB5OiAwLCB6OiAwIH19KSwgLy8gLVkKICAgICAgICBdCgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgZmFjZSBwbGFuZSB0byBiZSBvbiB0aGUgZ2l2ZW4gZmFjZSBpbmRleC4gIAogICAgICAgICAqIDA6ICtYLCAgCiAgICAgICAgICogMTogLVgsICAKICAgICAgICAgKiAyOiArWSwgIAogICAgICAgICAqIDM6IC1ZCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gc2V0UGxhbmVGYWNlKGZhY2VJbmRleCkgewogICAgICAgICAgICBtYXNrc1t0YWdzLmRpbWVuc2lvbiArICdQb3NpdGlvbiddID0gTE9DQUxfUE9TSVRJT05TW2ZhY2VJbmRleF07CiAgICAgICAgICAgIG1hc2tzW3RhZ3MuZGltZW5zaW9uICsgJ1JvdGF0aW9uJ10gPSBMT0NBTF9ST1RBVElPTlNbZmFjZUluZGV4XTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uOmAsIHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICB9CgogICAgICAgIGlmICghdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcGFyZW50UG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbih0YWdzLnRyYW5zZm9ybWVyLCB0YWdzLmRpbWVuc2lvbik7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gcGFyZW50IHBvc2l0aW9uOmAsIHBhcmVudFBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIGxldCBncmlkUG9ydGFsVHlwZTogJ2dyaWQnIHwgJ21pbmlHcmlkJyB8IG51bGwgPSBudWxsOwoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgZ3JpZFBvcnRhbFR5cGUgPSAnZ3JpZCc7CiAgICAgICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgZ3JpZFBvcnRhbFR5cGUgPSAnbWluaUdyaWQnOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBkZXRlY3RlZCBncmlkIHBvcnRhbCB0eXBlOmAsIGdyaWRQb3J0YWxUeXBlKTsKICAgICAgICB9CgogICAgICAgIGlmICghZ3JpZFBvcnRhbFR5cGUpIHsKICAgICAgICAgICAgc2V0UGxhbmVGYWNlKDApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBjYW1lcmFQb3NpdGlvbiA9IG9zLmdldENhbWVyYVBvc2l0aW9uKGdyaWRQb3J0YWxUeXBlKTsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSBjYW1lcmEgcG9zaXRpb246YCwgY2FtZXJhUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGlyZWN0aW9uVG9DYW1lcmEgPSBjYW1lcmFQb3NpdGlvbi5zdWJ0cmFjdChwYXJlbnRQb3NpdGlvbikubm9ybWFsaXplKCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gZGlyZWN0aW9uIHRvIGNhbWVyYTpgLCBkaXJlY3Rpb25Ub0NhbWVyYSk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBwYXJlbnRSb3RhdGlvbiA9IGdldEJvdFJvdGF0aW9uKHRhZ3MudHJhbnNmb3JtZXIsIHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICBjb25zdCB3b3JsZE5vcm1hbHM6IFZlY3RvcjNbXSA9IG5ldyBBcnJheSg0KTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgICB3b3JsZE5vcm1hbHNbaV0gPSBwYXJlbnRSb3RhdGlvbi5yb3RhdGVWZWN0b3IzKExPQ0FMX05PUk1BTFNbaV0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS4ke3RhZ05hbWV9XSB3b3JsZCBub3JtYWxzOmAsIHdvcmxkTm9ybWFscyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEZpbmQgdGhlIGZhY2UgbW9zdCBmYWNpbmcgdGhlIGNhbWVyYSAobWF4IGRvdCBwcm9kdWN0KS4gCiAgICAgICAgbGV0IGJlc3RJbmRleCA9IDA7IAogICAgICAgIGxldCBiZXN0RG90ID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZOyAKICAgICAgICAKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkTm9ybWFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdCBkb3QgPSB3b3JsZE5vcm1hbHNbaV0uZG90KGRpcmVjdGlvblRvQ2FtZXJhKTsKICAgICAgICAgICAgaWYgKGRvdCA+IGJlc3REb3QpIHsKICAgICAgICAgICAgICAgIGJlc3REb3QgPSBkb3Q7IAogICAgICAgICAgICAgICAgYmVzdEluZGV4ID0gaTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uJHt0YWdOYW1lfV0gYmVzdCBmYWNlIGluZGV4OmAsIGJlc3RJbmRleCk7CiAgICAgICAgfQoKICAgICAgICBzZXRQbGFuZUZhY2UoYmVzdEluZGV4KTsKICAgIH0pLAogICAgLi4ucmVzdAp9Cgpjb25zdCBmYWNlUGxhbmVCb3QgPSBjcmVhdGUoZmFjZVBsYW5lTW9kKTsKCnJldHVybiBmYWNlUGxhbmVCb3Q7JwC7sNvkCNfJAwhhYklnbm9yZQIEALuw2+QI4voDBHRydWUnALuw2+QI18kDC2FiSW50ZXJmYWNlAgQAu7Db5Ajn+gMEdHJ1ZScAu7Db5AjXyQMGc3lzdGVtAgQAu7Db5Ajs+gMYYWIuaW50ZXJmYWNlLmJvdF9mYWN0b3J5JwC7sNvkCNfJAxZhYkNyZWF0ZUJpbGxib2FyZExhYmVsAgQAu7Db5AiF+wONRUBsZXQgeyAKICAgIGJvdCwKICAgIGRpbWVuc2lvbiwKICAgIHByZXNlcnZlTmV3TGluZXMgPSB0cnVlLAogICAgbGFiZWwgPSAnJywKICAgIHNwYWNlID0gJ3RlbXBMb2NhbCcsCiAgICBjb2xvciA9ICd3aGl0ZScsCiAgICBsYWJlbENvbG9yID0gJ2JsYWNrJywKICAgIC4uLnJlc3QKfSA9IHRoYXQgPz8ge307CgppZiAodHlwZW9mIGxhYmVsICE9PSAnc3RyaW5nJykgewogICAgbGFiZWwgPSBTdHJpbmcobGFiZWwpOwp9Cgphc3NlcnQobGlua3MudXRpbHMuaXNCb3QoYm90KSwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3QgaXMgYSByZXF1aXJlZCBCb3QgcGFyYW1ldGVyLmApOwphc3NlcnQoZGltZW5zaW9uLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRpbWVuc2lvbiBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlci5gKTsKYXNzZXJ0KHJlc3Qub25DcmVhdGUgPT0gbnVsbCwgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBvbkNyZWF0ZSBpcyBhIHJlc2VydmVkIHRhZy5gKTsKYXNzZXJ0KHJlc3Qub25BbnlCb3RzQ2hhbmdlZCA9PSBudWxsLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9uQ3JlYXRlIGlzIGEgcmVzZXJ2ZWQgdGFnLmApOwphc3NlcnQocmVzdC5vbkFueUJvdHNSZW1vdmVkID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LnVwZGF0ZUxhYmVsID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb25DcmVhdGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CmFzc2VydChyZXN0LmxhYmVsV29yZFdyYXBNb2RlID09IG51bGwsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbGFiZWxXb3JkV3JhcE1vZGUgaXMgYSByZXNlcnZlZCB0YWcuYCk7CgovLyAtLS0gMSkgV29yZCBicmVha2luZyAod3JhcCBieSB3b3JkcywgY2h1bmsgbG9uZyB3b3JkcykgLS0tCmZ1bmN0aW9uIGJyZWFrV29yZHNUb0xpbmVzKHRleHQsIG1heENvbHMgPSAxOCkgewogICAgaWYgKCF0ZXh0KSByZXR1cm4gWycnXTsKICAgIGNvbnN0IHdvcmRzID0gdGV4dC5zcGxpdCgvXHMrLykuZmlsdGVyKEJvb2xlYW4pOwogICAgY29uc3QgbGluZXMgPSBbXTsKICAgIGxldCBsaW5lID0gJyc7CgogICAgY29uc3QgcHVzaCA9ICgpID0+IHsgbGluZXMucHVzaChsaW5lKTsgbGluZSA9ICcnOyB9OwoKICAgIGZvciAoY29uc3QgdyBvZiB3b3JkcykgewogICAgICAgIGlmICh3Lmxlbmd0aCA+IG1heENvbHMpIHsKICAgICAgICAgICAgLy8gY2xvc2UgY3VycmVudCBsaW5lIChpZiBhbnkpIGJlZm9yZSBjaHVua2luZyBhIGxvbmcgd29yZAogICAgICAgICAgICBpZiAobGluZSkgcHVzaCgpOwogICAgICAgICAgICAvLyBjaHVuayB0aGUgbG9uZyB3b3JkCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdy5sZW5ndGg7IGkgKz0gbWF4Q29scykgewogICAgICAgICAgICAgICAgbGluZXMucHVzaCh3LnNsaWNlKGksIGkgKyBtYXhDb2xzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZSA9ICcnOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFsaW5lLmxlbmd0aCkgewogICAgICAgICAgICBsaW5lID0gdzsKICAgICAgICB9IGVsc2UgaWYgKGxpbmUubGVuZ3RoICsgMSArIHcubGVuZ3RoIDw9IG1heENvbHMpIHsKICAgICAgICAgICAgbGluZSArPSAnICcgKyB3OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHB1c2goKTsKICAgICAgICAgICAgbGluZSA9IHc7CiAgICAgICAgfQogICAgfQogICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoKCk7CgogICAgcmV0dXJuIGxpbmVzLmxlbmd0aCA/IGxpbmVzIDogWycnXTsKfQoKLy8gUHJlc2VydmVzIGV4aXN0aW5nIFxuIGFzIGhhcmQgYnJlYWtzOyB3cmFwcyB3aXRoaW4gZWFjaCBoYXJkIGxpbmUuCmZ1bmN0aW9uIGJyZWFrV29yZHNUb0xpbmVzUHJlc2VydmVOZXdsaW5lcyh0ZXh0LCBtYXhDb2xzID0gMTgpIHsKICBpZiAodGV4dCA9PSBudWxsKSByZXR1cm4gWycnXTsKCiAgLy8gU3BsaXQgb24gcmVhbCBuZXdsaW5lczsga2VlcCBlbXB0eSBsaW5lcyBzbyB3ZSBwcmVzZXJ2ZSBibGFuayBsaW5lcy4KICBjb25zdCBoYXJkTGluZXMgPSBTdHJpbmcodGV4dCkuc3BsaXQoL1xyP1xuLyk7CiAgY29uc3Qgb3V0ID0gW107CgogIC8vIEhlbHBlciB0byB3cmFwIGEgc2luZ2xlIGhhcmQgbGluZSBieSB3b3JkcyAod2l0aCBsb25nLXdvcmQgY2h1bmtpbmcpCiAgY29uc3Qgd3JhcE9uZSA9IChzcmMpID0+IHsKICAgIC8vIE5vcm1hbGl6ZSB0YWJzIC0+IHNwYWNlczsgY29sbGFwc2UgaW50ZXJuYWwgd2hpdGVzcGFjZSAobm90IG5ld2xpbmVzKQogICAgY29uc3QgcyA9IHNyYy5yZXBsYWNlKC9cdC9nLCAnICAgICcpLnJlcGxhY2UoL1xzKy9nLCAnICcpLnRyaW0oKTsKICAgIGlmICghcy5sZW5ndGgpIHsgb3V0LnB1c2goJycpOyByZXR1cm47IH0KCiAgICBjb25zdCB3b3JkcyA9IHMuc3BsaXQoJyAnKTsKICAgIGxldCBsaW5lID0gJyc7CgogICAgY29uc3QgcHVzaExpbmUgPSAoKSA9PiB7IG91dC5wdXNoKGxpbmUpOyBsaW5lID0gJyc7IH07CgogICAgLy8gY2h1bmsgbG9uZyB3b3JkcyB0byBlbXVsYXRlICdicmVha1dvcmRzJwogICAgY29uc3QgY2h1bmtXb3JkID0gKHcpID0+IHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3Lmxlbmd0aDsgaSArPSBtYXhDb2xzKSB7CiAgICAgICAgY29uc3QgY2h1bmsgPSB3LnNsaWNlKGksIGkgKyBtYXhDb2xzKTsKICAgICAgICBpZiAoIWxpbmUubGVuZ3RoKSBsaW5lID0gY2h1bms7CiAgICAgICAgZWxzZSB7IHB1c2hMaW5lKCk7IGxpbmUgPSBjaHVuazsgfQogICAgICB9CiAgICB9OwoKICAgIGZvciAoY29uc3QgdyBvZiB3b3JkcykgewogICAgICBpZiAody5sZW5ndGggPiBtYXhDb2xzKSB7CiAgICAgICAgaWYgKGxpbmUubGVuZ3RoKSBwdXNoTGluZSgpOwogICAgICAgIGNodW5rV29yZCh3KTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIWxpbmUubGVuZ3RoKSB7CiAgICAgICAgbGluZSA9IHc7CiAgICAgIH0gZWxzZSBpZiAobGluZS5sZW5ndGggKyAxICsgdy5sZW5ndGggPD0gbWF4Q29scykgewogICAgICAgIGxpbmUgKz0gJyAnICsgdzsKICAgICAgfSBlbHNlIHsKICAgICAgICBwdXNoTGluZSgpOwogICAgICAgIGxpbmUgPSB3OwogICAgICB9CiAgICB9CiAgICBpZiAobGluZS5sZW5ndGgpIHB1c2hMaW5lKCk7CiAgfTsKCiAgZm9yIChjb25zdCBobCBvZiBoYXJkTGluZXMpIHsKICAgIHdyYXBPbmUoaGwpOyAgICAgICAgICAgLy8gd3JhcCB3aXRoaW4gdGhpcyBoYXJkIGxpbmUKICB9CgogIC8vIElmIHRoZSBpbnB1dCBlbmRlZCB3aXRoIGEgdHJhaWxpbmcgbmV3bGluZSwgd2UgYWxyZWFkeSBwcmVzZXJ2ZWQgaXQKICAvLyBiZWNhdXNlIHNwbGl0IGtlcHQgYW4gZW1wdHkgbGFzdCBpdGVtIC0+IGJlY2FtZSBhbiBlbXB0eSB3cmFwcGVkIGxpbmUuCiAgcmV0dXJuIG91dC5sZW5ndGggPyBvdXQgOiBbJyddOwp9CgovLyAtLS0gMikgU2ltcGxlIHNpemluZyBmcm9tIGxpbmVzIC0tLQovLyBUaGluayBvZiAiY29sc1BlclNjYWxlWCIgYXMgImFib3V0IE4gY2hhcmFjdGVycyBwZXIgMSBzY2FsZVgiLgpmdW5jdGlvbiBjb21wdXRlU2ltcGxlU2NhbGVzRnJvbUxpbmVzKGxpbmVzLCB7CiAgICBjb2xzUGVyU2NhbGVYID0gMi41LAogICAgbWluU2NhbGVYID0gMS4yNSwKICAgIG1heFNjYWxlWCA9IDEwLAogICAgYmFzZVNjYWxlWSA9IDEuMiwKICAgIHBlckxpbmVZID0gMC43NSwKfSA9IHt9KSB7CiAgICBjb25zdCBsb25nZXN0ID0gbGluZXMucmVkdWNlKChtLCBsKSA9PiBNYXRoLm1heChtLCBsLmxlbmd0aCksIDApOwogICAgY29uc3QgbGluZUNvdW50ID0gTWF0aC5tYXgoMSwgbGluZXMubGVuZ3RoKTsKCiAgICAvLyBXaWR0aCBzY2FsZXMgd2l0aCB0aGUgbG9uZ2VzdCBsaW5lIGxlbmd0aAogICAgbGV0IHNjYWxlWCA9IGxvbmdlc3QgPiAwID8gKGxvbmdlc3QgLyBjb2xzUGVyU2NhbGVYKSA6IG1pblNjYWxlWDsKICAgIHNjYWxlWCA9IE1hdGgubWF4KG1pblNjYWxlWCwgTWF0aC5taW4obWF4U2NhbGVYLCBzY2FsZVgpKTsKCiAgICAvLyBIZWlnaHQgZ3Jvd3MgcGVyIGxpbmU7IGtlZXAgaXQgc2ltcGxlIGFuZCBwcmVkaWN0YWJsZQogICAgY29uc3Qgc2NhbGVZID0gTWF0aC5tYXgoYmFzZVNjYWxlWSwgYmFzZVNjYWxlWSArIChsaW5lQ291bnQgLSAxKSAqIHBlckxpbmVZKTsKCiAgICByZXR1cm4geyBzY2FsZVgsIHNjYWxlWSwgbG9uZ2VzdCwgbGluZUNvdW50IH07Cn0KCgovLyBQaWNrIHlvdXIgdGFyZ2V0ICJjb2x1bW5zIiBwZXIgbGluZSAodHdlYWsgdG8gdGFzdGUpCmNvbnN0IE1BWF9DT0xTID0gMzI7CgovLyBCcmVhayB0aGUgdGV4dCB5b3Vyc2VsZgpjb25zdCBsaW5lcyA9IHByZXNlcnZlTmV3TGluZXMgPyBicmVha1dvcmRzVG9MaW5lc1ByZXNlcnZlTmV3bGluZXMobGFiZWwsIE1BWF9DT0xTKSA6IGJyZWFrV29yZHNUb0xpbmVzKGxhYmVsLCBNQVhfQ09MUyk7CmNvbnN0IHdyYXBwZWRMYWJlbCA9IGxpbmVzLmpvaW4oJ1xuJyk7CgovLyBDb21wdXRlIHNpbXBsZSBzY2FsZXMgZnJvbSB0aGUgd3JhcHBlZCB0ZXh0CmNvbnN0IHsgc2NhbGVYLCBzY2FsZVkgfSA9IGNvbXB1dGVTaW1wbGVTY2FsZXNGcm9tTGluZXMobGluZXMpOwoKbGV0IGxhYmVsTW9kID0gewogICAgc3BhY2U6IHNwYWNlLAogICAgdHJhY2tCb3RJZDogYm90LmlkLAogICAgZm9ybTogJ3Nwcml0ZScsCiAgICBjb2xvciwKICAgIGxhYmVsOiB3cmFwcGVkTGFiZWwsCiAgICBsYWJlbENvbG9yLAogICAgbGFiZWxTaXplOiAxLAogICAgbGFiZWxQYWRkaW5nWDogMC41LAogICAgbGFiZWxXb3JkV3JhcE1vZGU6ICdub25lJywKICAgIHNjYWxlWCwgCiAgICBzY2FsZVksCiAgICBzY2FsZVo6IDAuMSwKICAgIGJvdExhYmVsTWFyZ2luOiAxLAogICAgYW5jaG9yUG9pbnQ6ICfinqHvuI8wLC0wLjUsMCcsCiAgICBvcmllbnRhdGlvbk1vZGU6ICdiaWxsYm9hcmQnLAogICAgZGltZW5zaW9uOiBkaW1lbnNpb24sCiAgICBkZWJ1ZzogZmFsc2UsCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICBvbkNyZWF0ZTogYEAKICAgICAgICAvLyBXYWl0IGZvciByZXF1aXJlZCBib3RzIHRvIGJlIHJlYWR5LgogICAgICAgIGxldCB3YWl0VGltZSA9IDA7CgogICAgICAgIHdoaWxlKCFnbG9iYWxUaGlzLmFiKSB7CiAgICAgICAgICAgIGlmICh3YWl0VGltZSA+PSA1MDAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IG9zLnNsZWVwKDI1MCk7CiAgICAgICAgICAgIHdhaXRUaW1lICs9IDI1MDsKICAgICAgICB9CgogICAgICAgIHRhZ3MucmVhZHkgPSB0cnVlOwogICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgIGAsCiAgICBvbkFueUJvdHNDaGFuZ2VkOiBgQAogICAgICAgIGZvciAoY29uc3QgY2hhbmdlZCBvZiB0aGF0KSB7CiAgICAgICAgICAgIGlmIChjaGFuZ2VkLmJvdCAmJiBjaGFuZ2VkLmJvdC5pZCA9PT0gdGFncy50cmFja0JvdElkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvbmx5Um90YXRpb25UYWdzID0gY2hhbmdlZC50YWdzLmV2ZXJ5KCh0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZW5kc1dpdGgoJ1JvdGF0aW9uJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25YJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25ZJykgfHwgdC5lbmRzV2l0aCgnUm90YXRpb25aJykKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIG9ubHlSb3RhdGlvblRhZ3M6Jywgb25seVJvdGF0aW9uVGFncyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG9ubHlSb3RhdGlvblRhZ3MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVMYWJlbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgYCwKICAgIG9uQW55Qm90c1JlbW92ZWQ6IGBACgogICAgICAgIGlmICh0aGF0LmJvdElEcy5pbmNsdWRlcyh0YWdzLnRyYWNrQm90SWQpKSB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgfQogICAgYCwKICAgIG9uUG9ydGFsQ2hhbmdlZDogYEAKICAgICAgICBpZiAodGhhdC5kaW1lbnNpb24gPT09IHRhZ3MuZGltZW5zaW9uKSB7CiAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTGFiZWwoKTsKICAgICAgICB9CiAgICBgLAogICAgdXBkYXRlTGFiZWw6IGBACiAgICAgICAgaWYgKCF0YWdzLnJlYWR5KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JpbmcgdXBkYXRlTGFiZWwgYmVjYXVzZSBub3QgcmVhZHknKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGhhc0xhYmVsID0gdGFncy5sYWJlbCAhPSBudWxsICYmIHRhZ3MubGFiZWwgIT09ICcnOwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gaGFzTGFiZWw7CgogICAgICAgIGlmICghaGFzTGFiZWwpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gaWdub3JlIHVwZGF0ZUxhYmVsIGNhbGwsIHRoZXJlIGlzIG5vIGxhYmVsIHRhZyB2YWx1ZSB0byBkaXNwbGF5LicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBpbk1hcFBvcnRhbCA9IChjb25maWdCb3QudGFncy5tYXBQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdCb3QudGFncy5taW5pTWFwUG9ydGFsICYmIGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBjb25zdCBpbkdyaWRQb3J0YWwgPSAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCAmJiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09PSB0YWdzLmRpbWVuc2lvbikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgJiYgY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKTsKCiAgICAgICAgaWYgKCFpbk1hcFBvcnRhbCAmJiAhaW5HcmlkUG9ydGFsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIGlnbm9yZSB1cGRhdGVMYWJlbCBjYWxsLCBub3QgaW4gZWl0aGVyIGdyaWQgb3IgbWFwIHBvcnRhbC4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCB0cmFja0JvdCA9IGdldEJvdCgnaWQnLCB0YWdzLnRyYWNrQm90SWQpOwogICAgICAgIGNvbnN0IHRyYWNrUG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbih0cmFja0JvdCwgdGFncy5kaW1lbnNpb24pOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnW2FiQmlsbGJvYXJkTGFiZWxdIHRyYWNrUG9zaXRpb246JywgdHJhY2tQb3NpdGlvbik7CiAgICAgICAgfQoKICAgICAgICBsZXQgbGFiZWxQb3NpdGlvbiA9IHsgeDogdHJhY2tQb3NpdGlvbi54LCB5OiB0cmFja1Bvc2l0aW9uLnksIHo6IHRyYWNrUG9zaXRpb24ueiB9OyAKCiAgICAgICAgY29uc3QgdHJhY2tCb3RTY2FsZSA9IHRyYWNrQm90LnRhZ3Muc2NhbGUgPz8gMTsKICAgICAgICBjb25zdCB0cmFja0JvdFNjYWxlWiA9IHRyYWNrQm90LnRhZ3Muc2NhbGVaID8/IDE7CgogICAgICAgIGxldCBtZXRlcnNQZXJHcmlkVW5pdCA9IDE7CgogICAgICAgIGlmIChpbk1hcFBvcnRhbCkgewogICAgICAgICAgICAvLyBTY2FsZSB0byBtYXAgcG9ydGFsIHVuaXRzLgogICAgICAgICAgICBtZXRlcnNQZXJHcmlkVW5pdCA9IDEwOwogICAgICAgIH0KCiAgICAgICAgbGV0IHRyYWNrQm90UmVhbFNjYWxlWiA9ICh0cmFja0JvdFNjYWxlWiAqIHRyYWNrQm90U2NhbGUpICogbWV0ZXJzUGVyR3JpZFVuaXQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gdHJhY2tCb3RSZWFsU2NhbGVaOicsIHRyYWNrQm90UmVhbFNjYWxlWik7CiAgICAgICAgfQoKICAgICAgICBsYWJlbFBvc2l0aW9uLnogKz0gdHJhY2tCb3RSZWFsU2NhbGVaICsgKHRhZ3MuYm90TGFiZWxNYXJnaW4gKiBtZXRlcnNQZXJHcmlkVW5pdCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWJCaWxsYm9hcmRMYWJlbF0gbGFiZWxQb3NpdGlvbjonLCBsYWJlbFBvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWCddID0gbGFiZWxQb3NpdGlvbi54OwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWSddID0gbGFiZWxQb3NpdGlvbi55OwogICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWiddID0gbGFiZWxQb3NpdGlvbi56OwogICAgYAp9OwoKbGFiZWxNb2QgPSB7CiAgICAuLi5sYWJlbE1vZCwKICAgIC4uLnJlc3QsCn0KCmNvbnN0IGxhYmVsQm90ID0gY3JlYXRlKGxhYmVsTW9kKTsKCnJldHVybiBsYWJlbEJvdDsnALuw2+QI18kDBXV0aWxzAgQAu7Db5AiPwAQo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycAu7Db5AjXyQMEZm9ybQIEALuw2+QItsAEB25vdGhpbmcnALuw2+QI18kDCWFiVmVyc2lvbgIEALuw2+QIvsAEBTEwLjM3AA=="}]}