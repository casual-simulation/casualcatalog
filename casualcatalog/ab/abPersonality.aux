{"version":2,"updates":[{"id":0,"timestamp":1756159669114,"update":"AaEBkcjixwcAJwEEYm90cyQxNjU1NGJjMS1lOTNlLTRhMGItOGNkMy1kZmQ3NzIzMTk2NzIBJwCRyOLHBwAJYWJWZXJzaW9uAgQAkcjixwcBBDEwLjYnAJHI4scHAAZzeXN0ZW0CBACRyOLHBwYWYWIucGVyc29uYWxpdHkudmVyc2lvbicAkcjixwcAGWFiUGVyc29uYWxpdHlNYWpvclZlcnNpb24CBACRyOLHBx0BMScAkcjixwcADW9uU2tpbGxVcGRhdGUCBACRyOLHBx+tAUBjb25zdCB2ZXJzaW9uU3RyaW5nID0gdGFncy5hYlBlcnNvbmFsaXR5TWFqb3JWZXJzaW9uICsgIi4iICsgdGFncy5hYlBlcnNvbmFsaXR5TWlub3JWZXJzaW9uOwoKY29uc29sZS5sb2coIltBQlBlcnNvbmFsaXR5XSBMb2FkZWQgQUIgUGVyc29uYWxpdHkgdmVyc2lvbiAiICsgdmVyc2lvblN0cmluZyk7JwCRyOLHBwANYWJQZXJzb25hbGl0eQIEAJHI4scHzQEEdHJ1ZScAkcjixwcACGFiSWdub3JlAgQAkcjixwfSAQR0cnVlJwCRyOLHBwAEZm9ybQIEAJHI4scH1wEHbm90aGluZycAkcjixwcAGWFiUGVyc29uYWxpdHlNaW5vclZlcnNpb24CBACRyOLHB98BATknAQRib3RzJGIyNmUxMDg5LTE3MmQtNDVhOS04ZDIyLTA1YzNmNThjMmJmNwEnAJHI4scH4QEGc3lzdGVtAgQAkcjixwfiARhhYi5wZXJzb25hbGl0eS5hbmltYXRpb24nAJHI4scH4QEEZm9ybQIEAJHI4scH+wEHbm90aGluZycAkcjixwfhAQhhYklnbm9yZQIEAJHI4scHgwIEdHJ1ZScAkcjixwfhAQ1tYW5pZmVzdGF0aW9uAgQAkcjixweIAijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCRyOLHB+EBCHJlbWVtYmVyAgQAkcjixwevAijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCRyOLHB+EBGGFuaW1hdGlvbl9hYkdyaWRNYW5pZmVzdAIEAJHI4scH1gLqDkBzaG91dCgicmVzZXQiKTsKCmNvbnN0IHBvc2l0aW9uWCA9IHRoYXQ/LnBvc2l0aW9uLnggPz8gMDsKY29uc3QgcG9zaXRpb25ZID0gdGhhdD8ucG9zaXRpb24ueSA/PyAwOwpjb25zdCBkaW1lbnNpb24gPSB0aGF0Py5kaW1lbnNpb24gPz8gImhvbWUiOwpjb25zdCBncmlkU2NhbGUgPSB0aGF0Py5zY2FsZSA/PyA1Owpjb25zdCBtb21lbnRDb3VudCA9IDA7CmNvbnN0IGdyaWRCb3QgPSB7fTsKCmdyaWRCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKZ3JpZEJvdC5jb2xvciA9ICJjbGVhciI7CmdyaWRCb3Quc3Ryb2tlQ29sb3IgPSBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmdyaWRCb3Quc2NhbGUgPSAwLjAwMTsKZ3JpZEJvdC5zY2FsZVogPSAwLjE7CmdyaWRCb3QucmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmdyaWRCb3RbZGltZW5zaW9uXSA9IHRydWU7CmdyaWRCb3QucG9pbnRhYmxlID0gZmFsc2U7CmdyaWRCb3Qua2lsbFRpbWVyID0gIkAgYXdhaXQgb3Muc2xlZXAoNDAwKTsgZGVzdHJveSh0aGlzQm90KTsiOwoKbGV0IHJvdW5kQm90czsKCmZvciAobGV0IGkgPSBncmlkU2NhbGU7IGkgPiAwOyBpLS0pCnsKICAgIGNvbnN0IGJvdENvdW50ID0gaSAqIDg7CgogICAgbGV0IHNpZGVDb3VudCA9IDA7CiAgICBsZXQgcGhhc2VGYWN0b3IgPSAwOwoKICAgIGZvciAobGV0IGogPSAwOyBqIDwgYm90Q291bnQ7IGorKykKICAgIHsKICAgICAgICBpZiAocGhhc2VGYWN0b3IgPT0gMCkKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9ICgoaSArIHBvc2l0aW9uWCkgKiAtMSkgKyBzaWRlQ291bnQ7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlkiXSA9IGkgKyBwb3NpdGlvblk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBoYXNlRmFjdG9yID09IDEpCiAgICAgICAgewogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJYIl0gPSBpICsgcG9zaXRpb25YOwogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJZIl0gPSAoaSArIHBvc2l0aW9uWSkgLSBzaWRlQ291bnQ7ICAKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocGhhc2VGYWN0b3IgPT0gMikKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9IChpICsgcG9zaXRpb25YKSAtIHNpZGVDb3VudDsKICAgICAgICAgICAgZ3JpZEJvdFtkaW1lbnNpb24gKyAiWSJdID0gKChpICsgcG9zaXRpb25ZKSAqIC0xKSA7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9ICgoaSArIHBvc2l0aW9uWCkgKiAtMSkgOwogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJZIl0gPSAoKGkgKyBwb3NpdGlvblkpICogLTEpICsgc2lkZUNvdW50OyAgCiAgICAgICAgfQoKICAgICAgICBjb25zdCBuZXdHcmlkQm90ID0gYXdhaXQgY3JlYXRlKGdyaWRCb3QpOwoKICAgICAgICBhbmltYXRlVGFnKG5ld0dyaWRCb3QsICJzY2FsZSIsIHsKICAgICAgICAgICAgdG9WYWx1ZTogMSwKICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAiZWxhc3RpYyIsCiAgICAgICAgICAgICAgICBtb2RlOiAib3V0IgogICAgICAgICAgICB9LAogICAgICAgICAgICBkdXJhdGlvbjogMC4wMQogICAgICAgIH0pOwoKICAgICAgICBuZXdHcmlkQm90LmtpbGxUaW1lcigpOwoKICAgICAgICBzaWRlQ291bnQrKzsKCiAgICAgICAgaWYgKHNpZGVDb3VudCA9PSBib3RDb3VudCAvIDQpCiAgICAgICAgewogICAgICAgICAgICBzaWRlQ291bnQgPSAwOwoKICAgICAgICAgICAgcGhhc2VGYWN0b3IrKzsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLnNsZWVwKDgpOwogICAgfQp9JwCRyOLHB+EBCWFiVmVyc2lvbgIEAJHI4scHwREEMTAuNicAkcjixwfhAQZvbkNoYXQCBACRyOLHB8YRVUAvLyBpZiAodGhhdC5tZXNzYWdlID09ICJAdGVzdCIpCi8vIHsKLy8gICAgIHRoaXNCb3QuYW5pbWF0aW9uX2FiR3JpZE1hbmlmZXN0KCk7Ci8vIH0nAJHI4scH4QELcGVyc29uYWxpdHkCBACRyOLHB5wSKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAJHI4scH4QENYWJQZXJzb25hbGl0eQIEAJHI4scHwxIEdHJ1ZScBBGJvdHMkYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiAScAkcjixwfIEgZzeXN0ZW0CBACRyOLHB8kSFWFiLnBlcnNvbmFsaXR5LmNvbmZpZycAkcjixwfIEghhYklnbm9yZQIEAJHI4scH3xIEdHJ1ZScAkcjixwfIEgRmb3JtAgQAkcjixwfkEgdub3RoaW5nJwCRyOLHB8gSC2FiQmFzZUNvbG9yAgQAkcjixwfsEgcjMDBEOUNEJwCRyOLHB8gSEWFiQmFzZVN0cm9rZUNvbG9yAgQAkcjixwf0EgcjMDBEOUNEJwCRyOLHB8gSEGFiQmx1ZXByaW50Q29sb3ICBACRyOLHB/wSByMwMDgyN0InAJHI4scHyBIIcmVtZW1iZXICBACRyOLHB4QTKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJHI4scHyBIRYWJCdWlsZGVySWRlbnRpdHkCBACRyOLHB6sTCmNhc3VhbC5ib3QnAJHI4scHyBIJYWJWZXJzaW9uAgQAkcjixwe2EwQxMC42JwCRyOLHB8gSF2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnAgQAkcjixwe7E5kQQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCFhdXRoQm90KSB7DQogICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsNCn0NCg0KaWYgKCFhdXRoQm90KSB7DQogICAgcmV0dXJuOw0KfQ0KDQphd2FpdCBvcy5ncmFudEluc3RBZG1pblBlcm1pc3Npb24oYXV0aEJvdC5pZCk7DQoNCmxldCBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGF3YWl0IG9zLmdldERhdGEoYXV0aEJvdC5pZCwgImFiUGVyc29uYWxpdHlDb25maWciKTsNCg0KaWYgKGFiUGVyc29uYWxpdHlDb25maWdEYXRhLnN1Y2Nlc3MgPT0gZmFsc2UpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IHt9Ow0KfSBlbHNlIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGFiUGVyc29uYWxpdHlDb25maWdEYXRhLmRhdGE7DQp9DQoNCmlmICh0aGF0Lm5hbWUpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCdWlsZGVySWRlbnRpdHkiXSA9IHRoYXQubmFtZTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJ1aWxkZXJJZGVudGl0eSIsIHRoYXQubmFtZSwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LmNvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZUNvbG9yIl0gPSB0aGF0LmNvbG9yOw0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VTdHJva2VDb2xvciJdID0gdGhhdC5jb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VDb2xvciIsIHRoYXQuY29sb3IsICJsb2NhbCIpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiQmFzZVN0cm9rZUNvbG9yIiwgdGhhdC5jb2xvciwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LnBvcnRhbENvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZUdyaWRQb3J0YWxDb2xvciJdID0gdGhhdC5wb3J0YWxDb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiLCB0aGF0LnBvcnRhbENvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQubWVudUNvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZU1lbnVDb2xvciJdID0gdGhhdC5tZW51Q29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlTWVudUNvbG9yIiwgdGhhdC5tZW51Q29sb3IsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5tZW51TGFiZWxDb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VMYWJlbENvbG9yIl0gPSB0aGF0Lm1lbnVMYWJlbENvbG9yOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiQmFzZUxhYmVsQ29sb3IiLCB0aGF0Lm1lbnVMYWJlbENvbG9yLCAibG9jYWwiKTsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCYXNlU2hhZG93Q29sb3IiXSA9IHRoYXQubWVudUxhYmVsQ29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlU2hhZG93Q29sb3IiLCB0aGF0Lm1lbnVMYWJlbENvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQuZm9ybSkgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkZvcm0iXSA9IHRoYXQuZm9ybTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkZvcm0iLCB0aGF0LmZvcm0sICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5haU1vZGVsKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiUHJlZmVycmVkQUlNb2RlbCJdID0gdGhhdC5haU1vZGVsOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiUHJlZmVycmVkQUlNb2RlbCIsIHRoYXQuYWlNb2RlbCwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LmRlZmF1bHRQZXJzb25hbGl0eSkgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhID0ge307DQogICAgdGhpc0JvdC51cGRhdGVQZXJzb25hbGl0eSh7fSk7DQp9DQoNCmF3YWl0IG9zLnJlY29yZERhdGEoYXV0aEJvdC5pZCwgImFiUGVyc29uYWxpdHlDb25maWciLCBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSk7DQoNCnNob3V0KCdvbkFCUGVyc29uYWxpdHlDaGFuZ2VkJywgeyBib3Q6IHRoaXNCb3QgfSk7JwCRyOLHB8gSD2FiQmFzZU1lbnVDb2xvcgIEAJHI4scH1SMHIzAwRDlDRCcAkcjixwfIEhF1cGRhdGVQZXJzb25hbGl0eQIEAJHI4scH3SOfDEBsZXQgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGE7DQoNCmlmICh0aGF0ICYmIHRoYXQgPT0ge30pIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IHt9Ow0KfSBlbHNlIHsNCiAgICBpZiAoIWF1dGhCb3QpIHsNCiAgICAgICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsNCiAgICB9DQoNCiAgICBpZiAoYXV0aEJvdCkgew0KICAgICAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGF3YWl0IG9zLmdldERhdGEoYXV0aEJvdC5pZCwgImFiUGVyc29uYWxpdHlDb25maWciKTsNCiAgICAgICAgaWYgKCFsaW5rcy5yZW1lbWJlciAmJiBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YS5zdWNjZXNzID09IGZhbHNlKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEuc3VjY2Vzcykgew0KICAgICAgICAgICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YS5kYXRhOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovL2FiQmx1ZVByaW50Q29sb3INCi8vYWJCYXNlQWNjZW50Q29sb3INCmNvbnN0IGFiVGFncyA9IFsNCiAgICAiYWJCYXNlQ29sb3IiLA0KICAgICJhYkJhc2VNZW51Q29sb3IiLA0KICAgICJhYkJ1aWxkZXJJZGVudGl0eSIsDQogICAgImFiQmFzZVN0cm9rZUNvbG9yIiwNCiAgICAiYWJCYXNlR3JpZFBvcnRhbENvbG9yIiwNCiAgICAiYWJCYXNlTGFiZWxDb2xvciIsDQogICAgImFiQmFzZVNoYWRvd0NvbG9yIiwNCiAgICAiYWJQcmVmZXJyZWRBSU1vZGVsIiwNCiAgICAiYWJDYXRhbG9nTmFtZSINCl07DQoNCmNsZWFyVGFnTWFza3ModGhpc0JvdCk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgYWJUYWdzLmxlbmd0aDsgKytpKSB7DQogICAgaWYgKGFiUGVyc29uYWxpdHlDb25maWdEYXRhICYmIGFiUGVyc29uYWxpdHlDb25maWdEYXRhW2FiVGFnc1tpXV0pIHsNCiAgICAgICAgaWYgKHRhZ3NbYWJUYWdzW2ldXSAhPSBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVthYlRhZ3NbaV1dKSB7DQogICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsIGFiVGFnc1tpXSwgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbYWJUYWdzW2ldXSwgImxvY2FsIik7DQogICAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGxpbmtzLnJlbWVtYmVyICYmIGxpbmtzLnJlbWVtYmVyLnRhZ3NbYWJUYWdzW2ldXSkgew0KICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFnc1thYlRhZ3NbaV1dICE9IHRhZ3NbYWJUYWdzW2ldXSkgew0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCBhYlRhZ3NbaV0sIGxpbmtzLnJlbWVtYmVyLnRhZ3NbYWJUYWdzW2ldXSwgImxvY2FsIik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAoYWJUYWdzW2ldID09ICJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiKSB7DQogICAgICAgIGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxDb2xvciA9IHRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yOw0KICAgIH0NCn0NCg0Kc2hvdXQoJ29uQUJQZXJzb25hbGl0eVVwZGF0ZWQnLCB7IGJvdDogdGhpc0JvdCB9KTsnAJHI4scHyBINYWJQZXJzb25hbGl0eQIEAJHI4scH/S8EdHJ1ZScAkcjixwfIEg1vblNraWxsVXBkYXRlAgQAkcjixweCMB1AdGhpc0JvdC51cGRhdGVQZXJzb25hbGl0eSgpOycAkcjixwfIEhFhYkJhc2VTaGFkb3dDb2xvcgIEAJHI4scHoDAFYmxhY2snAJHI4scHyBIQYWJCYXNlTGFiZWxDb2xvcgIEAJHI4scHpjAFYmxhY2snAQRib3RzJGI5YjgyODE5LTFmMTQtNDM5Mi04OGE5LTUyZjY3YTlmOGU1NQEnAJHI4scHrDAGc3lzdGVtAgQAkcjixwetMBhhYi5wZXJzb25hbGl0eS5hcm1fbnVkZ2UnAJHI4scHrDANb25BQkFybVBsYWNlZAIEAJHI4scHxjA4QHNldFRhZ01hc2sodGhpc0JvdCwgJ2hhc0FybUJlZW5QbGFjZWQnLCB0cnVlLCAnbG9jYWwnKTsnAJHI4scHrDAJb25BQkF3YWtlAgQAkcjixwf/MBtAdGhpc0JvdC5hYlN0YXJ0QXJtTnVkZ2UoKTsnAJHI4scHrDAIYWJJZ25vcmUCBACRyOLHB5sxBHRydWUnAJHI4scHrDANYWJQZXJzb25hbGl0eQIEAJHI4scHoDEEdHJ1ZScAkcjixwesMARmb3JtAgQAkcjixwelMQdub3RoaW5nJwCRyOLHB6wwBWxlYXJuAgQAkcjixwetMSjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCRyOLHB6wwDW1hbmlmZXN0YXRpb24CBACRyOLHB9QxKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAJHI4scHrDAIcmVtZW1iZXICBACRyOLHB/sxKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJHI4scHrDAFZGVidWcCBACRyOLHB6IyBHRydWUnAJHI4scHrDAOYXJtTnVkZ2VXYWl0TVMCBACRyOLHB6cyBDUwMDAnAJHI4scHrDAPb25BQkluaXRpYWxpemVkAgQAkcjixwesMhtAdGhpc0JvdC5hYlN0YXJ0QXJtTnVkZ2UoKTsnAJHI4scHrDAPYWJTdGFydEFybU51ZGdlAgQAkcjixwfIMqYYQGlmICh0aGlzQm90LnZhcnMubnVkZ2VBY3RpdmUpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGVyZSBpcyBhbHJlYWR5IGEgbnVkZ2UgaW4gcHJvZ3Jlc3MuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCnRoaXNCb3QudmFycy5udWRnZUFjdGl2ZSA9IHRydWU7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzdGFydGluZyBudWRnZS4uLmApCn0KCmZ1bmN0aW9uIGNhbk51ZGdlKCk6IGJvb2xlYW4gewogICAgLy8gQ2FuJ3QgaGF2ZSBwbGFjZWQgdGhlIGFybSBhbHJlYWR5LgogICAgaWYgKHRhZ3MuaGFzQXJtQmVlblBsYWNlZCkgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2Fubm90IG51ZGdlOiBhcm0gcGxhY2VtZW50IGhhcyBhbHJlYWR5IG9jY3VyZWQuYCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBBQiBtYW5pZmVzdGF0aW9uIGJvdCBtdXN0IGJlIGFjdGl2ZS4KICAgIGlmICghbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2Fubm90IG51ZGdlOiBhYiBtYW5pZmVzdGF0aW9uIGJvdCBpcyBpbmFjdGl2ZS5gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIFRoZSBpbnN0IG11c3QgYmUgZW1wdHkgb2YgYWxsIGJvdHMuIFRoZSBleGNlcHRpb25zIGFyZSBhYiBib3RzIGFuZCBidWlsdC1pbiBib3RzLgogICAgY29uc3QgdXNlck1hZGVCb3QgPSBnZXRCb3QoKGIpID0+IHsKICAgICAgICByZXR1cm4gIWIudGFncy5zeXN0ZW0/LnN0YXJ0c1dpdGgoJ2FiLicpICYmCiAgICAgICAgICAgICAgICBiLnNwYWNlID09PSAnc2hhcmVkJyAmJgogICAgICAgICAgICAgICAgIWIudGFncy5hYkVnZyAvLyBEb24ndCBpbmNsdWRlIGFiRWdnIGJvdHMgYXMgInVzZXIgbWFkZSIuCiAgICB9KQogICAgCiAgICBpZiAodXNlck1hZGVCb3QpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1Z1VzZXJNYWRlQm90cykgewogICAgICAgICAgICAgICAgY29uc3QgdXNlck1hZGVCb3RzID0gZ2V0Qm90cygoYikgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhYi50YWdzLnN5c3RlbT8uc3RhcnRzV2l0aCgnYWIuJykgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhYi50YWdzLmFiRWdnIC8vIERvbid0IGluY2x1ZGUgYWJFZ2cgYm90cyBhcyAidXNlciBtYWRlIi4KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogaW5zdCBjb250YWlucyB1c2VyIG1hZGUgYm90cy5gLCB1c2VyTWFkZUJvdHMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYW5ub3QgbnVkZ2U6IGluc3QgY29udGFpbnMgdXNlciBtYWRlIGJvdHMuYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIE1lbnUgcG9ydGFsIG11c3QgZWl0aGVyIGJlIGluYWN0aXZlIG9yIG5vdCBoYXZlIGFueSBib3RzIGluIHRoZSBjdXJyZW50bHkgYWN0aXZlIG1lbnUgcG9ydGFsLgogICAgaWYgKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwpIHsKICAgICAgICBjb25zdCBib3RJbk1lbnVQb3J0YWwgPSBnZXRCb3QoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIudGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9PT0gdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICBpZiAoYm90SW5NZW51UG9ydGFsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogbWVudVBvcnRhbCBpcyBjdXJyZW50bHkgb3BlbiBhbmQgaGFzIGJvdHMgaW4gaXQuYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKaWYgKGNhbk51ZGdlKCkpIHsKICAgIC8vIFN0YXJ0IG51ZGdlIGZvciBhcm0gcGxhY2VtZW50LgogICAgYXdhaXQgb3Muc2xlZXAodGFncy5hcm1OdWRnZVdhaXRNUyk7CgogICAgaWYgKGNhbk51ZGdlKCkpIHsKICAgICAgICAvLyBQZXJmb3JtIHRoZSBhcm0gcGxhY2VtZW50IG51ZGdlLgogICAgICAgIGNvbnN0IGdyaWRDbGlja1BhcmFtcyA9IHsKICAgICAgICAgICAgZGltZW5zaW9uOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uLAogICAgICAgICAgICBwb3NpdGlvbjogeyB4OiA1LCB5OiAwIH0sCiAgICAgICAgICAgIGZvcmNlQXJtUGxhY2VtZW50OiB0cnVlLAogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB3aGlzcGVyaW5nIG9uR3JpZENsaWNrIHRvIHRoZSBhYiBtYW5pZmVzdGF0aW9uIGJvdCB3aXRoIHRoZSBwYXJhbXM6YCwgZ3JpZENsaWNrUGFyYW1zKQogICAgICAgIH0KCiAgICAgICAgLy8gRm9yY2UgYWIgYXJtIHBsYWNlbWVudCB1c2luZyB0aGUgb25HcmlkQ2xpY2sgbGlzdGVuZXIgb2YgdGhlIG1hbmlmZXN0YXRpb24gYm90LgogICAgICAgIHdoaXNwZXIobGlua3MubWFuaWZlc3RhdGlvbiwgJ29uR3JpZENsaWNrJywgZ3JpZENsaWNrUGFyYW1zKTsKICAgIH0KfQoKdGhpc0JvdC52YXJzLm51ZGdlQWN0aXZlID0gZmFsc2U7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkb25lYCk7Cn0nAJHI4scHrDAJYWJWZXJzaW9uAgQAkcjixwfvSgQxMC42JwCRyOLHB6wwD29uUG9ydGFsQ2hhbmdlZAIEAJHI4scH9EqFAUBjb25zdCB7IHBvcnRhbCwgZGltZW5zaW9uIH0gPSB0aGF0OwoKaWYgKHBvcnRhbCA9PT0gJ21lbnVQb3J0YWwnKSB7CiAgICBpZiAoIWRpbWVuc2lvbikgewogICAgICAgIHRoaXNCb3QuYWJTdGFydEFybU51ZGdlKCk7CiAgICB9Cn0nAJHI4scHrDANYWJNZW51UmVmcmVzaAIEAJHI4scH+ksbQHRoaXNCb3QuYWJTdGFydEFybU51ZGdlKCk7JwCRyOLHB6wwEWRlYnVnVXNlck1hZGVCb3RzAgQAkcjixweWTAR0cnVlJwEEYm90cyRkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQBJwCRyOLHB5tMBnN5c3RlbQIEAJHI4scHnEwcYWIucGVyc29uYWxpdHkubWFuaWZlc3RhdGlvbicAkcjixwebTARmb3JtAgQAkcjixwe5TAdub3RoaW5nJwCRyOLHB5tMC2Rlc2NyaXB0aW9uAgQAkcjixwfBTDhUaGlzIHNraWxsIGNvbnRyb2xzIHRoZSBhY3R1YWwgYm90IGZvciB0aGUgYWIgaW50ZXJmYWNlLicAkcjixwebTAVsZWFybgIEAJHI4scH+kwo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycAkcjixwebTA9vblBvcnRhbENoYW5nZWQCBACRyOLHB6FN5A1AaWYgKGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsICE9IG51bGwgfHwgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsICE9IG51bGwpCnsKICAgIGlmICh0YWdzLmFiQm90KQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwogICAgfQoKICAgIHJldHVybjsKfQoKaWYgKCF0YWdzLmFiQXdha2UgfHwgdGhhdC5wb3J0YWwgPT0gInRhZ1BvcnRhbCIgfHwgdGhhdC5wb3J0YWwgPT0gIm1lbnVQb3J0YWwiIHx8ICh0aGF0LnBvcnRhbCA9PSAiZ3JpZFBvcnRhbCIgJiYgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsKSkKewogICAgcmV0dXJuOwp9CgppZiAodGFncy5hYkJvdCkKewogICAgZGVzdHJveShsaW5rcy5hYkJvdCk7Cn0KCmNvbnN0IHBvcnRhbEFycmF5ID0gWyJtaW5pR3JpZFBvcnRhbCIsICJncmlkUG9ydGFsIiwgIm1hcFBvcnRhbCIsICJtaW5pTWFwUG9ydGFsIiwgImxlZnRXcmlzdFBvcnRhbCIsICJyaWdodFdyaXN0UG9ydGFsIl07CgpsZXQgbWFwUG9ydGFsQ2hlY2sgPSBmYWxzZTsKbGV0IG5ld0FCID0gZmFsc2U7CgppZiAocG9ydGFsQXJyYXkuaW5kZXhPZih0aGF0LnBvcnRhbCkgIT0gLTEgJiYgdGhhdC5kaW1lbnNpb24gJiYgIWNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsKQp7CiAgICBpZiAodGhhdC5wb3J0YWwgPT0gIm1hcFBvcnRhbCIpCiAgICB7CiAgICAgICAgYXdhaXQgb3Muc2xlZXAoMjAwMCk7CiAgICAgICAgbmV3QUIgPSBhd2FpdCB0aGlzQm90LmFiTWFuaWZlc3RCb3QoeyBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLCBwb3NpdGlvbjoge3g6IC04NS42NzYxODk0ODIyNDM0LCB5OiA0Mi45NjU2NzU2NzU2NzU2fX0pOwoKICAgICAgICBtYXBQb3J0YWxDaGVjayA9IHRydWU7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3QUIgPSBhd2FpdCB0aGlzQm90LmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHBvc2l0aW9uOnt4OjAseTowfX0pOwogICAgfQp9CmVsc2UgaWYgKHBvcnRhbEFycmF5LmluZGV4T2YodGhhdC5wb3J0YWwpID09IC0xICYmICF0aGF0LmRpbWVuc2lvbikKewogICAgY29uc3Qgc3VtbW9uRGltZW5zaW9uID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKICAgIAogICAgbWFwUG9ydGFsQ2hlY2sgPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyB0cnVlIDogZmFsc2U7CgogICAgaWYgKG1hcFBvcnRhbENoZWNrKQogICAgewogICAgICAgIGF3YWl0IG9zLnNsZWVwKDIwMDApOwogICAgICAgIG5ld0FCID0gYXdhaXQgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHsgZGltZW5zaW9uOiBzdW1tb25EaW1lbnNpb24sIHBvc2l0aW9uOiB7eDogLTg1LjY3NjE4OTQ4MjI0MzQsIHk6IDQyLjk2NTY3NTY3NTY3NTZ9fSk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3QUIgPSBhd2FpdCB0aGlzQm90LmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogc3VtbW9uRGltZW5zaW9uLCBwb3NpdGlvbjp7eDowLHk6MH19KTsKICAgIH0KfQplbHNlCnsKICAgIHJldHVybjsKfQoKaWYgKG5ld0FCKQp7CiAgICBhd2FpdCBvcy5zbGVlcCg1MDApOwogICAgY29uc3Qgem9vbVZhcmlhbmNlID0gbWFwUG9ydGFsQ2hlY2sgPyAyMDAwIDogMTA7CgogICAgYXdhaXQgb3MuZm9jdXNPbihsaW5rcy5hYkJvdCwge3pvb206IHpvb21WYXJpYW5jZSwgcm90YXRpb246IHt4OiA0NSwgeTogNDV9fSkuY2F0Y2goZSA9PiB7fSk7Cn0nAJHI4scHm0wIcmVtZW1iZXICBACRyOLHB4ZbKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJHI4scHm0wNYWJNYW5pZmVzdEJvdAIEAJHI4scHrVvsEUBpZiAodGFncy5hYkJvdCkKewogICAgYXdhaXQgZGVzdHJveShsaW5rcy5hYkJvdCk7Cn0KCmxldCBhYiA9IHt9OwoKYWIuc3BhY2UgPSAidGVtcExvY2FsIjsKYWIuY29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZUNvbG9yOwphYi5mb3JtT3BhY2l0eSA9ICIwLjMzIjsKYWIubGFiZWwgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUxhYmVsOwphYi5sYWJlbFBvc2l0aW9uID0gImZyb250IjsKYWIubGFiZWxDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmFiLmxhYmVsU2l6ZSA9IDAuNjE7CmFiLm9uQ2xpY2sgPSAiQCBpZiAodGhhdC5tb2RhbGl0eSA9PSAnbW91c2UnICYmIHRoYXQuYnV0dG9uSWQgPT0gJ3JpZ2h0Jykge3JldHVybjt9IGxpbmtzLm1hbmFnZXIuYWJDbGljaygpOyI7CmFiLmRpbWVuc2lvbiA9IHRoYXQuZGltZW5zaW9uOwphYlt0aGF0LmRpbWVuc2lvbl0gPSB0cnVlOwphYlt0aGF0LmRpbWVuc2lvbiArICJYIl0gPSB0aGF0LnBvc2l0aW9uLng7CmFiW3RoYXQuZGltZW5zaW9uICsgIlkiXSA9IHRoYXQucG9zaXRpb24ueTsKYWIuc3Ryb2tlQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwovL2FiLmxpbmVDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmFiLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwphYi5hbmltYXRlQm90ID0gYEAgaWYgKGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkKQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IHJvdFogPSB0YWdzLmRpbWVuc2lvbiArICJSb3RhdGlvbloiOwpsZXQgdGFyZ2V0U2NhbGUgPSAwLjY1OwoKLy8gaWYgKHRhZ3Muc2NhbGUgPD0gMC42NTEpCi8vIHsKLy8gICAgIHRhcmdldFNjYWxlID0gMC45NTsKLy8gfQoKYXdhaXQgYW5pbWF0ZVRhZyh0aGlzQm90LAp7CiAgICBmcm9tVmFsdWU6IHsKICAgICAgICBbcm90Wl06IDAsCiAgICAgICAgLy9zY2FsZTogdGFncy5zY2FsZQogICAgfSwKICAgIHRvVmFsdWU6IHsKICAgICAgICBbcm90Wl06IDYuMywKICAgICAgICAvL3NjYWxlOiB0YXJnZXRTY2FsZQogICAgfSwKICAgIGVhc2luZzogewogICAgICAgIHR5cGU6ICJzaW51c29pZGFsIiwKICAgICAgICBtb2RlOiAiaW5vdXQiCiAgICB9LAogICAgZHVyYXRpb246IDIKfSkuY2F0Y2goZSA9PiB7fSk7CmA7CmFiLm9uQ3JlYXRlID0gYEAKCnRoaXNCb3QuYW5pbWF0ZUJvdCgpOwoKbWFza3MuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzQm90LmFuaW1hdGVCb3QoKSwgMjAwMCk7CmA7CmFiLm9uRGVzdHJveSA9IGBACmNsZWFySW50ZXJ2YWwodGFncy5pbnRlcnZhbCk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwpgOwphYi5kcmFnZ2FibGUgPSBmYWxzZTsKYWIuc2NhbGUgPSAwLjk7CgpsZXQgYWJNYW5pZmVzdGVkID0gYXdhaXQgY3JlYXRlKGFiKTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiU2Vjb25kYXJ5TGFiZWwpCnsKICAgIGxldCBhYkxhYmVsQm90ID0ge307CgogICAgYWJMYWJlbEJvdC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwogICAgYWJMYWJlbEJvdFt0aGF0LmRpbWVuc2lvbl0gPSB0cnVlOwogICAgYWJMYWJlbEJvdFt0aGF0LmRpbWVuc2lvbiArICJaIl0gPSAtMTsKICAgIGFiTGFiZWxCb3QuY3JlYXRvciA9IGFiTWFuaWZlc3RlZC5pZDsKICAgIGFiTGFiZWxCb3QudHJhbnNmb3JtZXIgPSBhYk1hbmlmZXN0ZWQuaWQ7CiAgICBhYkxhYmVsQm90LnBvaW50YWJsZSA9IGZhbHNlOwogICAgYWJMYWJlbEJvdC5jb2xvciA9ICJjbGVhciI7CiAgICBhYkxhYmVsQm90LmxhYmVsID0gbGlua3MucmVtZW1iZXIudGFncy5hYlNlY29uZGFyeUxhYmVsOwogICAgYWJMYWJlbEJvdC5sYWJlbFBvc2l0aW9uID0gImxlZnQiOwogICAgYWJMYWJlbEJvdC5sYWJlbFNpemUgPSAwLjc7CiAgICBhYkxhYmVsQm90LmxhYmVsQ29sb3IgPSBhYk1hbmlmZXN0ZWQudGFncy5sYWJlbENvbG9yOwoKICAgIGNyZWF0ZShhYkxhYmVsQm90KTsKfQoKbWFza3MuYWJCb3QgPSAi8J+UlyIgKyBhYk1hbmlmZXN0ZWQuaWQ7CgpsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkFjdGl2ZURpbWVuc2lvbiA9IHRoYXQuZGltZW5zaW9uOwoKc2hvdXQoIm9uQUJNb3ZlZCIsIHtkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLCB4OiB0aGF0LnBvc2l0aW9uLngsIHk6IHRoYXQucG9zaXRpb24ueX0pOwoKcmV0dXJuIGFiTWFuaWZlc3RlZDsKCgoKaWYgKGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkKQp7CiAgICByZXR1cm47Cn0nAJHI4scHm0wLb25HcmlkQ2xpY2sCBACRyOLHB5Zt7RNAaWYgKCF0YWdzLmFiQXdha2UpCnsKICAgIHJldHVybjsKfQoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbnN0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOwoKaWYgKHRhZ3MuYWJCb3QgJiYgKHNoaWZ0Q2hlY2sgfHwgKHRoYXQubW9kYWxpdHkgPT0gIm1vdXNlIiAmJiB0aGF0LmJ1dHRvbklkID09ICJyaWdodCIgJiYgIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSaWdodENsaWNrRGlzYWJsZWQpIHx8IHRoYXQuZm9yY2VBcm1QbGFjZW1lbnQpKQp7CiAgICBpZiAobGlua3MuYWJCb3QudGFncy5hcm0pCiAgICB7CiAgICAgICAgZGVzdHJveShsaW5rcy5hYkJvdC5saW5rcy5hcm0pOwogICAgICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IG51bGw7CiAgICB9CiAgICAKICAgIGxldCBhcm0gPSB7fTsKCiAgICBhcm0uc3BhY2UgPSAidGVtcExvY2FsIjsKICAgIGFybVt0aGF0LmRpbWVuc2lvbl0gPSB0cnVlOwogICAgYXJtW3RoYXQuZGltZW5zaW9uICsgIlgiXSA9IHRoYXQucG9zaXRpb24ueDsKICAgIGFybVt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LnBvc2l0aW9uLnk7CiAgICBhcm0uZGltZW5zaW9uID0gdGhhdC5kaW1lbnNpb247CiAgICBhcm0uc2NhbGUgPSAwLjk7CiAgICBhcm0uc2NhbGVaID0gMC4wMTsKICAgIGFybS5jb2xvciA9ICJjbGVhciI7CiAgICBhcm0uc3Ryb2tlQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwogICAgYXJtLmxpbmVDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CiAgICBhcm0ubGluZVRvID0gbGlua3MuYWJCb3QuaWQ7CiAgICBhcm0ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CiAgICBhcm0ub25DbGljayA9IGBAIGRlc3Ryb3kodGhpc0JvdCk7CiAgICBzaG91dCgib25BQkZvb3RDbGlja2VkIiwgeyBkaW1lbnNpb246IHRhZ3MuZGltZW5zaW9uIH0pOwogICAgbGlua3MubWFuYWdlci5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb246IHRhZ3MuZGltZW5zaW9uLCBwb3NpdGlvbjp7eDp0YWdzW3RhZ3MuZGltZW5zaW9uICsgIlgiXSx5OnRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWSJdfX0pO2A7CgogICAgbGV0IG5ld0FybSA9IGF3YWl0IGNyZWF0ZShhcm0pOwoKICAgIHNob3V0KCJvbkFCQXJtUGxhY2VkIiwge2RpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHg6IHRoYXQucG9zaXRpb24ueCwgeTogdGhhdC5wb3NpdGlvbi55fSk7CgogICAgbGlua3MuYWJCb3QubWFza3MuYXJtID0gIvCflJciICsgbmV3QXJtLmlkOwoKICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiR3JpZEZvY3VzID0ge2RpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHBvc2l0aW9uOiB7eDogdGhhdC5wb3NpdGlvbi54LCB5OiB0aGF0LnBvc2l0aW9uLnl9fTsKCiAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJncmlkIn0pOwoKICAgIHJldHVybjsKfQoKbGV0IGZvb3RwcmludCA9IHt9OwoKZm9vdHByaW50LnNwYWNlID0gInRlbXBMb2NhbCI7CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbl0gPSB0cnVlOwpmb290cHJpbnQuZGltZW5zaW9uID0gdGhhdC5kaW1lbnNpb247CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbiArICJYIl0gPSB0aGF0LnBvc2l0aW9uLng7CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LnBvc2l0aW9uLnk7CmZvb3RwcmludC5zY2FsZVogPSAwLjAxOwpmb290cHJpbnQub25DbGljayA9IGBAIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gZmFsc2U7CnNob3V0KCJvbkFCRm9vdENsaWNrZWQiLCB7IGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24gfSk7CmxpbmtzLm1hbmFnZXIuYWJNYW5pZmVzdEJvdCh0YWdzLnBvc2l0aW9uSW5mbyk7CmA7CmZvb3RwcmludC5wb3NpdGlvbkluZm8gPSB0aGF0Owpmb290cHJpbnQuY29sb3IgPSAiY2xlYXIiOwpmb290cHJpbnQucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5Owpmb290cHJpbnQuc3Ryb2tlQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwpmb290cHJpbnQuZHJhZ2dhYmxlID0gZmFsc2U7CmZvb3RwcmludC5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZm9vdHByaW50Lm9uQ3JlYXRlID0gYEAgc2V0VGltZW91dCgoKSA9PiBkZXN0cm95KHRoaXNCb3QpLCA4MDApOwoKICAgIGF3YWl0IGFuaW1hdGVUYWcodGhpc0JvdCwgewogICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICBzY2FsZVg6IDAuMSwKICAgICAgICAgICAgc2NhbGVZOiAwLjEKICAgICAgICB9LAogICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgc2NhbGVYOiAxLjEsCiAgICAgICAgICAgIHNjYWxlWTogMS4xCiAgICAgICAgfSwKICAgICAgICBkdXJhdGlvbjogMC41LAogICAgICAgIGVhc2luZzogewogICAgICAgICAgICB0eXBlOiAiZWxhc3RpYyIsCiAgICAgICAgICAgIG1vZGU6ICJvdXQiCiAgICAgICAgfQogICAgfSkuY2F0Y2goZSA9PiB7fSk7CmA7CgpjcmVhdGUoZm9vdHByaW50KTsnAJHI4scHm0wEbWVudQIEAJHI4scH/oABKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAJHI4scHm0wHYWJDbGljawIEAJHI4scHpYEB/wtAaWYgKCFsaW5rcy5hYkJvdCkgewogICAgcmV0dXJuOwp9CgppZiAobGlua3MuaW5wdXQpIHsKICAgIGxpbmtzLmlucHV0LmFiQ2hhdEJhckNsb3NlKCk7Cn0KCmNvbnN0IHJlc2V0ID0gdGhhdCA/IHRoYXQucmVzZXQgOiBmYWxzZTsKY29uc3QgbWVudSA9IHRoYXQgPyB0aGF0Lm1lbnUgOiAiY29yZSI7CmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCmlmICghcmVzZXQgJiYgKGxpbmtzLmFiQm90LnRhZ3MuaW50ZXJ2YWwgfHwgc3RhdGUpKSB7CiAgICBjb25zdCBhYk1lbnVCb3RzID0gZ2V0Qm90cygiYWJNZW51IiwgdHJ1ZSk7CgogICAgd2hpc3BlcihhYk1lbnVCb3RzLCAiYWJNZW51UmVmcmVzaCIpOwoKICAgIGNsZWFySW50ZXJ2YWwobGlua3MuYWJCb3QudGFncy5pbnRlcnZhbCk7CgogICAgbGlua3MuYWJCb3QubWFza3MuaW50ZXJ2YWwgPSBudWxsOwoKICAgIGNsZWFyQW5pbWF0aW9ucyhsaW5rcy5hYkJvdCk7CgogICAgY29uc3Qgcm90WiA9IGxpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlJvdGF0aW9uWiI7CgogICAgaWYgKHN0YXRlICYmIG1lbnUgPT0gImNvcmUiKSB7CiAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3MubWVudS5hYk9wZW5NZW51KG1lbnUpOwogICAgfQoKICAgIHRyeSB7CiAgICAgICAgYW5pbWF0ZVRhZyhsaW5rcy5hYkJvdCwgewogICAgICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgICAgIFtyb3RaXTogbGlua3MuYWJCb3QudGFnc1tyb3RaXSwKICAgICAgICAgICAgICAgIHNjYWxlOiBsaW5rcy5hYkJvdC50YWdzLnNjYWxlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgICAgIFtyb3RaXTogMCwKICAgICAgICAgICAgICAgIHNjYWxlOiAwLjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAic2ludXNvaWRhbCIsCiAgICAgICAgICAgICAgICBtb2RlOiAiaW5vdXQiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGR1cmF0aW9uOiAwLjUKICAgICAgICB9KQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8vIERvIG5vdGhpbmcuCiAgICB9Cn0KZWxzZSB7CiAgICBsaW5rcy5hYkJvdC5hbmltYXRlQm90KCk7CgogICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gbnVsbDsKCiAgICBpZiAobGlua3MuYWJCb3QudGFncy5hcm0pIHsKICAgICAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IGxpbmtzLmFiQm90LmFuaW1hdGVCb3QoKSwgMjAwMCk7Cn0KCnNob3V0KCdvbkFCQ2xpY2snLCB7IGFiQm90OiBsaW5rcy5hYkJvdCwgZGltZW5zaW9uOiBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiwgbWVudSwgc2hpZnRLZXk6ICEhc3RhdGUsIHJlc2V0IH0pOycAkcjixwebTAxvbkFueUJvdERyYWcCBACRyOLHB6WNAZAMQGlmICh0aGF0LmJvdCAhPSBsaW5rcy5hYkJvdCkgcmV0dXJuOwoKaWYgKGxpbmtzLmlucHV0KSB7CiAgICBsaW5rcy5pbnB1dC5hYkNoYXRCYXJDbG9zZSgpOwp9CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzICYmIHRoYXQuYm90LmlkID09IGxpbmtzLmFiQm90LmlkKQp7CiAgICBvcy5lbmFibGVDdXN0b21EcmFnZ2luZygpOwoKICAgIHJldHVybjsKfQoKaWYgKGxpbmtzLmFiQm90LnRhZ3MuYXJtKQp7CiAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7Cn0KCmlmICghdGhhdC5ib3QudGFncy5pbnRlcnZhbCkKewogICAgdGhpc0JvdC5hYkNsaWNrKCk7Cn0KCmxldCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CmxldCBhcm0gPSB7fTsKCmFybS5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwphcm1bbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb25dID0gdHJ1ZTsKYXJtW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlgiXSA9IGxpbmtzLmFiQm90LnRhZ3NbbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWCJdOwphcm1bbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWSJdID0gbGlua3MuYWJCb3QudGFnc1tsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJZIl07CmFybS5jcmVhdG9yID0gbGlua3MuYWJCb3QuaWQ7CmFybS5kaW1lbnNpb24gPSBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbjsKYXJtLnNjYWxlID0gMC45Owphcm0uc2NhbGVaID0gMC4wMTsKYXJtLmNvbG9yID0gImNsZWFyIjsKYXJtLnN0cm9rZUNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKYXJtLmxpbmVDb2xvciA9IGxpbmtzLmFiQm90LnRhZ3Muc3Ryb2tlQ29sb3I7CmFybS5saW5lVG8gPSB0aGF0LmJvdC5pZDsKYXJtLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwphcm0ub25DbGljayA9IGBAIGRlc3Ryb3kodGhpc0JvdCk7CnNob3V0KCJvbkFCRm9vdENsaWNrZWQiLCB7IGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24gfSk7CmxpbmtzLm1hbmFnZXIuYWJNYW5pZmVzdEJvdCh7ZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgcG9zaXRpb246e3g6dGFnc1t0YWdzLmRpbWVuc2lvbiArICJYIl0seTp0YWdzW3RhZ3MuZGltZW5zaW9uICsgIlkiXX19KTtgOwphcm0ub25Ecm9wID0gYEAgc2hvdXQoIm9uQUJBcm1QbGFjZWQiLCB7ZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgeDogdGhhdC50by54LCB5OiB0aGF0LnRvLnl9KTtgCgppZiAoc3RhdGUpCnsKICAgIGFybS5tdWx0aVNlbGVjdCA9IHRydWU7CiAgICBhcm0uZm9ybSA9ICJzcGhlcmUiOwogICAgYXJtLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5kcmFnZ2FibGUgPSB0cnVlOwp9CgpsZXQgbmV3QXJtID0gYXdhaXQgY3JlYXRlKGFybSk7CgpsaW5rcy5hYkJvdC5tYXNrcy5hcm0gPSAi8J+UlyIgKyBuZXdBcm0uaWQ7Cgpvcy5yZXBsYWNlRHJhZ0JvdChuZXdBcm0pOycAkcjixwebTBFvbkFueUJvdERyb3BFbnRlcgIEAJHI4scHspkB2AlAaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmIChsaW5rcy5hYkJvdD8ubGlua3MuYXJtICE9IHRoYXQuZHJhZ0JvdCkgcmV0dXJuOwoKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLm11bHRpU2VsZWN0KQp7CiAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwoKICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmtzLmFiQm90LnRhZ3MubGluZVRvKSkKICAgIHsKICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8ucHVzaCh0aGF0LnRvLmJvdC5pZCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gW3RoYXQudG8uYm90LmlkXTsKICAgIH0KCiAgICBsZXQgbmV3TGluazsKCiAgICBpZiAoIWxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLnNlbGVjdGVkQm90cykKICAgIHsKICAgICAgICBuZXdMaW5rID0gZ2V0TGluayh0aGF0LnRvLmJvdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IHByZXZpb3VzTGlua0JvdHMgPSBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubGlua3Muc2VsZWN0ZWRCb3RzOwoKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJldmlvdXNMaW5rQm90cykpCiAgICAgICAgewogICAgICAgICAgICBwcmV2aW91c0xpbmtCb3RzID0gW3ByZXZpb3VzTGlua0JvdHNdCiAgICAgICAgfQoKICAgICAgICBjb25zdCBhbHJlYWR5QWRkZWQgPSBwcmV2aW91c0xpbmtCb3RzLnNvbWUoYiA9PiBiLmlkID09PSB0aGF0LnRvLmJvdC5pZCk7CiAgICAgICAgaWYgKCFhbHJlYWR5QWRkZWQpCiAgICAgICAgewogICAgICAgICAgICBwcmV2aW91c0xpbmtCb3RzLnB1c2godGhhdC50by5ib3QpOwogICAgICAgIH0KCiAgICAgICAgbmV3TGluayA9IGdldExpbmsocHJldmlvdXNMaW5rQm90cyk7CiAgICB9CgogICAgbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3Muc2VsZWN0ZWRCb3RzID0gbmV3TGluazsKfQplbHNlCnsKICAgIGxpbmtzLmFiQm90LmxpbmtzLmFybS5tYXNrcy5zdHJva2VDb2xvciA9ICJjbGVhciI7CiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubWFza3MubGluZVRvID0gZmFsc2U7CgogICAgbGlua3MuYWJCb3QubWFza3MubGluZUNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IHRoYXQudG8uYm90LmlkOwp9JwCRyOLHB5tMEG9uQW55Qm90RHJvcEV4aXQCBACRyOLHB4ujAZwCQGlmICghbGlua3MuYWJCb3QpIHJldHVybjsKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybSAhPSB0aGF0LmRyYWdCb3QpIHJldHVybjsKCmlmICghbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3MubXVsdGlTZWxlY3QpCnsKICAgIGxpbmtzLmFiQm90LmxpbmtzLmFybS5tYXNrcy5zdHJva2VDb2xvciA9IG51bGw7CiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubWFza3MubGluZVRvID0gbnVsbDsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8gPSBsaW5rcy5hYkJvdC5saW5rcy5hcm0uaWQ7Cn0nAJHI4scHm0wMb25BbnlCb3REcm9wAgQAkcjixweopQHuC0BtYXNrcy5tdWx0aURyYWcgPSBudWxsOwoKaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmICghbGlua3MuYWJCb3QpIHJldHVybjsKaWYgKCFsaW5rcy5hYkJvdC50YWdzLmFybSkgcmV0dXJuOwppZiAobGlua3MuYWJCb3QubGlua3MuYXJtICE9IHRoYXQuZHJhZ0JvdCkgcmV0dXJuOwoKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLm11bHRpU2VsZWN0ICYmIGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLnNlbGVjdGVkQm90cykKewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJNdWx0aXBsZUJvdEZvY3VzID0gbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3Muc2VsZWN0ZWRCb3RzOwoKICAgIC8vY2hlY2sgaWYgb25seSBvbmUgYm90IGlzIHNlbGVjdGVkIGluIG11bHRpc2VsZWN0IG1vZGUKICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmtzLmFiQm90LmxpbmtzLmFybS5saW5rcy5zZWxlY3RlZEJvdHMpKSB7CiAgICAgICAgdGhpc0JvdC5hYkNsaWNrKHttZW51OiAibXVsdGlwbGVCb3QifSk7CiAgICB9IGVsc2UgewogICAgICAgIGlmIChsaW5rcy5hYkJvdC5saW5rcy5hcm0ubGlua3Muc2VsZWN0ZWRCb3RzLmlkID09IGxpbmtzLmFiQm90LmlkKQogICAgICAgIHsKICAgICAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8gPSBsaW5rcy5hYkJvdC50YWdzLmxpbmVUb1swXTsKICAgICAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJCb3RGb2N1cyA9ICLwn5SXIiArIGxpbmtzLmFiQm90LmxpbmtzLmFybS5saW5rcy5zZWxlY3RlZEJvdHMuaWQ7CgogICAgICAgICAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJib3QifSk7CiAgICAgICAgfQogICAgfSAKICAgIAogICAgZGVzdHJveShsaW5rcy5hYkJvdC5saW5rcy5hcm0pOwogICAgc2hvdXQoIm9uQUJTZWxlY3RlZEJvdCIsIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiTXVsdGlwbGVCb3RGb2N1cyk7Cn0KZWxzZSBpZiAodGhhdC50by5ib3QpCnsKICAgIGlmICh0aGF0LnRvLmJvdCA9PSBsaW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBsaW5rcy5tZW51LmFiRW52aXJvbm1lbnRNZW51KCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJCb3RGb2N1cyA9ICLwn5SXIiArIHRoYXQudG8uYm90LmlkOwoKICAgICAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJib3QifSk7CiAgICB9CiAgICAKICAgIHNob3V0KCJvbkFCU2VsZWN0ZWRCb3QiLCB0aGF0LnRvLmJvdCk7CiAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7Cn0KZWxzZQp7CiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkdyaWRGb2N1cyA9IHtkaW1lbnNpb246IHRoYXQudG8uZGltZW5zaW9uLCBwb3NpdGlvbjoge3g6IHRoYXQudG8ueCwgeTogdGhhdC50by55fX07CgogICAgdGhpc0JvdC5hYkNsaWNrKHttZW51OiAiZ3JpZCJ9KTsKfScAkcjixwebTAhhYklnbm9yZQIEAJHI4scHk7EBBHRydWUnAJHI4scHm0wDYXNrAgQAkcjixweYsQEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAkcjixwebTAlhc2tCdXR0b24CBACRyOLHB7+xAcgFQGlmICghdGFncy5hYkF3YWtlKQp7CiAgICByZXR1cm47Cn0KCmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSBsaW5rcy5tZW51LnRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gbGlua3MubWVudS50YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24uYmFzZVNraWxsID0gIvCflJciICsgbGlua3MuYXNrLmlkOwphYk1lbnVCdXR0b24ubGFiZWwgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51TGFiZWw7CmFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVJY29uOwphYk1lbnVCdXR0b24ub25DcmVhdGUgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51T25HZW5lcmF0ZTsKYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVTb3J0T3JkZXI7CmFiTWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVDb2xvciA/IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVDb2xvciA6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOycAkcjixwebTAlhYkJvdENoYXQCBACRyOLHB4a3AdULQGlmICghbGlua3MuYWJCb3QgJiYgIXRoYXQuYm90KQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IGJvdEJhc2UgPSB0aGF0LmJvdCA/IHRoYXQuYm90OiBsaW5rcy5hYkJvdDsKY29uc3QgZGltZW5zaW9uID0gIXRoYXQuYm90ID8gYm90QmFzZS50YWdzLmRpbWVuc2lvbiA6IHRoYXQuZGltZW5zaW9uID8gdGhhdC5kaW1lbnNpb24gOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwpjb25zdCBtZXNzYWdlID0gdGhhdC5tZXNzYWdlOwpjb25zdCBtZXNzYWdlVGltZSA9IHRoYXQudGltZSA/IHRoYXQudGltZSAqIDEwMDAgOiAxNjAwOyAKY29uc3QgbWVzc2FnZUJvdCA9IHt9OwoKbWVzc2FnZUJvdC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwptZXNzYWdlQm90LnRyYW5zZm9ybWVyID0gYm90QmFzZS5pZDsKbWVzc2FnZUJvdC5mb3JtID0gInNwcml0ZSI7Cm1lc3NhZ2VCb3QuY29sb3IgPSAiIzAwMDAwMCI7Cm1lc3NhZ2VCb3QubGFiZWwgPSBtZXNzYWdlOwptZXNzYWdlQm90LmxhYmVsQ29sb3IgPSAiI2ZmZmZmZiI7Cm1lc3NhZ2VCb3QubGFiZWxTaXplID0gMTsKbWVzc2FnZUJvdC5zY2FsZVggPSBtZXNzYWdlLmxlbmd0aCAvIDUgPiAxMCA/IDEwIDogbWVzc2FnZS5sZW5ndGggPCAxMCA/IDIgOiBtZXNzYWdlLmxlbmd0aCAvIDU7Cm1lc3NhZ2VCb3Quc2NhbGVZID0gKG1lc3NhZ2UubGVuZ3RoIC8gNTApID4gMSA/IE1hdGgucm91bmQobWVzc2FnZS5sZW5ndGggLyA1MCkgOiAxLjMzOwptZXNzYWdlQm90LnNjYWxlWiA9IDAuMTsKbWVzc2FnZUJvdC5vcmllbnRhdGlvbk1vZGUgPSAiYmlsbGJvYXJkIjsKbWVzc2FnZUJvdFtkaW1lbnNpb25dID0gdHJ1ZTsKbWVzc2FnZUJvdC5kaW1lbnNpb24gPSBkaW1lbnNpb247Cm1lc3NhZ2VCb3RbZGltZW5zaW9uICsgIlgiXSA9IDA7Cm1lc3NhZ2VCb3RbZGltZW5zaW9uICsgIlkiXSA9IDA7Cm1lc3NhZ2VCb3RbZGltZW5zaW9uICsgIloiXSA9IGJvdEJhc2UudGFncy5zY2FsZSA/IGJvdEJhc2UudGFncy5zY2FsZSAvIDIgKyAyIDogMjsKbWVzc2FnZUJvdC5vbkZhZGUgPSBgQCBhd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgIGZyb21WYWx1ZTogewogICAgICAgIGZvcm1PcGFjaXR5OiAxLAogICAgICAgIGxhYmVsT3BhY2l0eTogMSwKICAgICAgICBbdGFncy5kaW1lbnNpb24gKyAiWiJdOiB0YWdzW3RhZ3MuZGltZW5zaW9uICsgIloiXQogICAgfSwKICAgIHRvVmFsdWU6IHsKICAgICAgICBmb3JtT3BhY2l0eTogMCwKICAgICAgICBsYWJlbE9wYWNpdHk6IDAsCiAgICAgICAgW3RhZ3MuZGltZW5zaW9uICsgIloiXTogdGFnc1t0YWdzLmRpbWVuc2lvbiArICJaIl0gKyA1CiAgICB9LAogICAgZHVyYXRpb246ICR7dGhhdC5kdXJhdGlvbiA/PyAzfQp9KS5jYXRjaCh7fSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpjb25zdCBhY3RpdmVNZXNzYWdlID0gY3JlYXRlKG1lc3NhZ2VCb3QpOwoKc2V0VGltZW91dCgoKT0+IGFjdGl2ZU1lc3NhZ2Uub25GYWRlKCksIG1lc3NhZ2VUaW1lKTsnAJHI4scHm0wQb25BbnlCb3REcmFnZ2luZwIEAJHI4scH3MIBiRBAaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyAmJiB0aGF0LmJvdC5pZCA9PSBsaW5rcy5hYkJvdC5pZCkKewogICAgY29uc3QgYWN0aXZlRGltZW5zaW9uID0gbGlua3MucmVtZW1iZXIubWFza3MuYWJBY3RpdmVEaW1lbnNpb24gPz8gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKICAgIGxldCBkcmFnQ29vcmRpbmF0b3JCb3QgPSBsaW5rcy5kcmFnQ29vcmQ7CiAgICAKICAgIGlmICghZHJhZ0Nvb3JkaW5hdG9yQm90KQogICAgewogICAgICAgIGNvbnN0IGRyYWdDb29yZGluYXRvckJvdE1vZCA9IHt9OwoKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2Quc3BhY2UgPSAidGVtcExvY2FsIjsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2QubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kLmRpbWVuc2lvbiA9IGFjdGl2ZURpbWVuc2lvbjsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2RbYWN0aXZlRGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kW2FjdGl2ZURpbWVuc2lvbiArICJYIl0gPSAwOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZFthY3RpdmVEaW1lbnNpb24gKyAiWSJdID0gMDsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2RbYWN0aXZlRGltZW5zaW9uICsgIloiXSA9IC0xOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZC5wb2ludGFibGUgPSBmYWxzZTsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2QuY29sb3IgPSAiY2xlYXIiOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZC5vbkFueUJvdFBvaW50ZXJVcCA9IGBAIGxpbmtzLm1hbmFnZXIubWFza3MuZHJhZ0Nvb3JkID0gbnVsbDsgc2hvdXQoJ2FiU3RvcERyYWcnLCB7eDogdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1YLCB5OiB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVl9KTsgZGVzdHJveSh0aGlzQm90KTtgOwoKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3QgPSBjcmVhdGUoZHJhZ0Nvb3JkaW5hdG9yQm90TW9kKTsKCiAgICAgICAgbWFza3MuZHJhZ0Nvb3JkID0gZ2V0TGluayhkcmFnQ29vcmRpbmF0b3JCb3QpOwoKICAgICAgICBjb25zdCBkcmFnQm90cyA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1czsKCiAgICAgICAgbGlua3MuYWJCb3QubWFza3MudHJhbnNmb3JtZXIgPSBkcmFnQ29vcmRpbmF0b3JCb3QuaWQ7CiAgICAgICAgbGlua3MuYWJCb3QubWFza3MuYWJTdG9wRHJhZyA9IGBAIG1hc2tzLnRyYW5zZm9ybWVyID0gbnVsbDsgbWFza3MuYWJTdG9wRHJhZyA9IG51bGw7IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WCA9IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WCArIHRoYXQueDsgdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1ZID0gdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1ZICsgdGhhdC55YDsKCiAgICAgICAgc2V0VGFnTWFzayhkcmFnQm90cywgInRyYW5zZm9ybWVyIiwgZHJhZ0Nvb3JkaW5hdG9yQm90LmlkLCAidGVtcExvY2FsIik7CiAgICAgICAgc2V0VGFnTWFzayhkcmFnQm90cywgImFiU3RvcERyYWciLCBgQCBtYXNrcy50cmFuc2Zvcm1lciA9IG51bGw7IG1hc2tzLmFiU3RvcERyYWcgPSBudWxsOyB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVggPSB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVggKyB0aGF0Lng7IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WSA9IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WSArIHRoYXQueWAsICJ0ZW1wTG9jYWwiKTsKICAgIH0KCiAgICBjb25zdCB4Q2hhbmdlID0gdGhhdC50by54IC0gdGhhdC5mcm9tLng7CiAgICBjb25zdCB5Q2hhbmdlID0gdGhhdC50by55IC0gdGhhdC5mcm9tLnk7CgogICAgZHJhZ0Nvb3JkaW5hdG9yQm90LnRhZ3NbYWN0aXZlRGltZW5zaW9uICsgIlgiXSA9IHhDaGFuZ2U7CiAgICBkcmFnQ29vcmRpbmF0b3JCb3QudGFnc1thY3RpdmVEaW1lbnNpb24gKyAiWSJdID0geUNoYW5nZTsKICAgIGRyYWdDb29yZGluYXRvckJvdC50YWdzW2FjdGl2ZURpbWVuc2lvbiArICJaIl0gPSAtMTsKfScAkcjixwebTAlhYlZlcnNpb24CBACRyOLHB+bSAQQxMC42JwCRyOLHB5tMCWFuaW1hdGlvbgIEAJHI4scH69IBKPCflJdiMjZlMTA4OS0xNzJkLTQ1YTktOGQyMi0wNWMzZjU4YzJiZjcnAJHI4scHm0wPb25BbnlCb3RDbGlja2VkAgQAkcjixweS0wGIEUBpZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSaWdodENsaWNrRGlzYWJsZWQgICYmICF0aGF0LmJvdC50YWdzLmFiUmlnaHRDbGlja0lnbm9yZSAmJiB0aGF0Lm1vZGFsaXR5ID09ICJtb3VzZSIgJiYgdGhhdC5idXR0b25JZCA9PSAicmlnaHQiKSB7DQoNCiAgICBpZiAoIXRhZ3MuYWJBd2FrZSkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy9hYiBzZWxlY3RlZA0KICAgIGlmICh0aGF0LmJvdCA9PSBsaW5rcy5hYkJvdCkNCiAgICB7DQogICAgICAgIGxpbmtzLm1lbnUuYWJFbnZpcm9ubWVudE1lbnUoKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vR2V0IHJpZCBvZiBhbnkgb3RoZXIgb25lcw0KICAgIGlmIChsaW5rcy5hYkJvdC50YWdzLmFybSkgew0KICAgICAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7DQogICAgfQ0KDQogICAgLy9hbmltYXRpb25zDQogICAgaWYgKCFsaW5rcy5hYkJvdC50YWdzLmludGVydmFsKSB7DQogICAgICAgIHRoaXNCb3QuYWJDbGljaygpOw0KICAgIH0NCg0KICAgIC8vQ3JlYXRlIGFybQ0KICAgIGxldCBhcm0gPSB7fTsNCg0KICAgIGFybS5zcGFjZSA9ICJ0ZW1wTG9jYWwiOw0KICAgIGFybVtsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbl0gPSB0cnVlOw0KICAgIGFybVtsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJYIl0gPSB0aGF0LmJvdC50YWdzW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlgiXTsNCiAgICBhcm1bbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWSJdID0gdGhhdC5ib3QudGFnc1tsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJZIl07DQogICAgYXJtLmNyZWF0b3IgPSBsaW5rcy5hYkJvdC5pZDsNCiAgICBhcm0uZGltZW5zaW9uID0gbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb247DQogICAgYXJtLnNjYWxlID0gMC45Ow0KICAgIGFybS5zY2FsZVogPSAwLjAxOw0KICAgIGFybS5jb2xvciA9ICJjbGVhciI7DQogICAgYXJtLnN0cm9rZUNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsNCiAgICBhcm0ubGluZUNvbG9yID0gbGlua3MuYWJCb3QudGFncy5zdHJva2VDb2xvcjsNCiAgICBhcm0ubGluZVRvID0gbGlua3MuYWJCb3QuaWQ7DQogICAgYXJtLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOw0KICAgIGFybS5vbkNsaWNrID0gYEAgZGVzdHJveSh0aGlzQm90KTsNCiAgICAgICAgICAgICAgICAgICAgc2hvdXQoIm9uQUJGb290Q2xpY2tlZCIsIHsgZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiB9KTsNCiAgICAgICAgICAgICAgICAgICAgbGlua3MubWFuYWdlci5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb246IHRhZ3MuZGltZW5zaW9uLCBwb3NpdGlvbjp7eDp0YWdzW3RhZ3MuZGltZW5zaW9uICsgIlgiXSx5OnRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWSJdfX0pO2A7DQoNCiAgICBsZXQgbmV3QXJtID0gYXdhaXQgY3JlYXRlKGFybSk7DQoNCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5hcm0gPSAi8J+UlyIgKyBuZXdBcm0uaWQ7DQoNCiAgICB0aGlzQm90Lm9uQW55Qm90RHJvcEVudGVyKHsNCiAgICAgICAgZHJhZ0JvdDogbGlua3MuYWJCb3QubGlua3MuYXJtLA0KICAgICAgICB0bzogew0KICAgICAgICAgICAgYm90OiB0aGF0LmJvdCwNCiAgICAgICAgICAgIHg6IHRoYXQuYm90LnRhZ3NbbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWCJdLA0KICAgICAgICAgICAgeTogdGhhdC5ib3QudGFnc1tsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJZIl0sDQogICAgICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uDQogICAgICAgIH0sDQogICAgICAgIGZyb206IHsNCiAgICAgICAgICAgIHg6IGxpbmtzLmFiQm90LnRhZ3NbbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWCJdLA0KICAgICAgICAgICAgeTogbGlua3MuYWJCb3QudGFnc1tsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJZIl0sDQogICAgICAgICAgICBkaW1lbnNpb246IGxpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uDQogICAgICAgIH0NCiAgICB9KQ0KDQogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJCb3RGb2N1cyA9ICLwn5SXIiArIHRoYXQuYm90LmlkOw0KDQogICAgdGhpc0JvdC5hYkNsaWNrKHttZW51OiAiYm90In0pOw0KDQogICAgcmV0dXJuOw0KfScAkcjixwebTAVpbnB1dAIEAJHI4scHleQBKPCflJdmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjAnAJHI4scHm0wLcGVyc29uYWxpdHkCBACRyOLHB7zkASjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwCRyOLHB5tMDWFiUGVyc29uYWxpdHkCBACRyOLHB+PkAQR0cnVlJwCRyOLHB5tMCmFiU2V0QXdha2UCBACRyOLHB+jkAZ8SQGxldCBhd2FrZSA9IHRoYXQ/LmF3YWtlOwpsZXQgaW5pdGlhbCA9IHRoYXQ/LmluaXRpYWwgPz8gZmFsc2U7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9Cgphc3NlcnQodHlwZW9mIGF3YWtlID09PSAnYm9vbGVhbicsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXdha2UgaXMgYSByZXF1aXJlZCBib29sZWFuIHBhcmFtZXRlci5gKTsKCmlmIChjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgLy8gSWYgYWJTdGF5QXdha2UgaXMgZW5hYmxlZCwgb3ZlcnJpZGUgdGhlIGluY29taW5nIGF3YWtlIHBhcmFtZXRlciBhbmQgbmV2ZXIgbGV0IGFiIGJlIHB1dCB0byBzbGVlcC4KICAgIGF3YWtlID0gdHJ1ZTsKfQoKaWYgKHRhZ3MuYWJBd2FrZSAhPT0gYXdha2UpIHsKICAgIGlmIChpbml0aWFsKSB7CiAgICAgICAgLy8gTG9hZCB1cCBzb21lIGNvcmUgYWIgc2tpbGxzLgogICAgICAgIGNvbnN0IHNraWxsQXJyYXkgPSBbImFiUGVyc29uYWxpdHkiLCAiYWJJbnRlcmZhY2UiLCAiYWJBY3Rpb24iLCAiYWJUZXN0cyJdOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNraWxsQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdChza2lsbEFycmF5W2ldKTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLnNsZWVwKDMwMCk7CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5wYXR0ZXJuKSB7CiAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gY29uZmlnQm90LnRhZ3MucGF0dGVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA9IHV1aWQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gUGxheSBpbml0aWFsIGFuaW1hdGlvbiBpZiBvbmUgaXMgZGVmaW5lZCBvbiBhYkNvbmZpZy4KICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxBbmltYXRpb24pIHsKICAgICAgICAgICAgYXdhaXQgbGlua3MuYW5pbWF0aW9uW2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsQW5pbWF0aW9uXSgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBTaG93IGluaXRpYWwgbWVzc2FnZSBpZiBvbmUgaXMgZGVmaW5lZCBvbiBhYkNvbmZpZy4KICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxNZXNzYWdlKSB7CiAgICAgICAgICAgIHNob3V0KCJzaG93Q29uc29sZSIpOwoKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxNZXNzYWdlKSkgewogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2UubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBhYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2VbaV0pOwoKICAgICAgICAgICAgICAgICAgICBhd2FpdCBvcy5zbGVlcCgyMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gVXBkYXRlIGFiQXdha2Ugc2hhcmVkIHRhZyBtYXNrLgogICAgc2V0VGFnTWFzayh0aGlzQm90LCAnYWJBd2FrZScsIGF3YWtlLCAnc2hhcmVkJyk7CiAgICAKICAgIGlmIChhd2FrZSkgewogICAgICAgIGxldCBkaW1lbnNpb24gPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwoKICAgICAgICBpZiAoIWRpbWVuc2lvbikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzQm90LmFiTWFuaWZlc3RCb3QoeyBkaW1lbnNpb24sIHBvc2l0aW9uOiB7IHg6IDAsIHk6IDAgfSB9KTsKCiAgICAgICAgc2hvdXQoIm9uQUJBd2FrZSIsIHsgZGltZW5zaW9uLCBwb3NpdGlvbjogeyB4OiAwLCB5OiAwIH0gfSk7CiAgICB9IGVsc2UgewogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwogICAgICAgIHNob3V0KCJvbkFCU2xlZXAiKTsKICAgIH0KfScAkcjixwebTAVkZWJ1ZwIEAJHI4scHiPcBBWZhbHNlAA=="}]}