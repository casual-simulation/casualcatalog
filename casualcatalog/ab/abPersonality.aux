{"version":2,"updates":[{"id":0,"timestamp":1768868360558,"update":"AcgBiufc0A4AJwEEYm90cyQxNjU1NGJjMS1lOTNlLTRhMGItOGNkMy1kZmQ3NzIzMTk2NzIBJwCK59zQDgAJYWJWZXJzaW9uAgQAiufc0A4BBTEwLjM1JwCK59zQDgAGc3lzdGVtAgQAiufc0A4HFmFiLnBlcnNvbmFsaXR5LnZlcnNpb24nAIrn3NAOABlhYlBlcnNvbmFsaXR5TWFqb3JWZXJzaW9uAgQAiufc0A4eATInAIrn3NAOAA1vblNraWxsVXBkYXRlAgQAiufc0A4grQFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJQZXJzb25hbGl0eU1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJQZXJzb25hbGl0eU1pbm9yVmVyc2lvbjsKCmNvbnNvbGUubG9nKCJbQUJQZXJzb25hbGl0eV0gTG9hZGVkIEFCIFBlcnNvbmFsaXR5IHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAiufc0A4ADWFiUGVyc29uYWxpdHkCBACK59zQDs4BBHRydWUnAIrn3NAOAAhhYklnbm9yZQIEAIrn3NAO0wEEdHJ1ZScAiufc0A4ABGZvcm0CBACK59zQDtgBB25vdGhpbmcnAIrn3NAOABlhYlBlcnNvbmFsaXR5TWlub3JWZXJzaW9uAgQAiufc0A7gAQE3JwEEYm90cyQzYzc0YzlmMS04MmRjLTQ2NTUtOGIzOC1lN2YxMWRlODk3OGUBJwCK59zQDuIBBnN5c3RlbQIEAIrn3NAO4wEXYWIucGVyc29uYWxpdHkuYXJtX3Rvb2wnAIrn3NAO4gEMb25BbnlCb3REcmFnAgQAiufc0A77AY0IQGNvbnN0IGRyYWdCb3QgPSB0aGF0LmJvdDsKY29uc3QgZGltZW5zaW9uID0gdGhhdC5mcm9tLmRpbWVuc2lvbjsKCmlmIChkcmFnQm90LnRhZ3MuYXJtU2VsZWN0aW9uKSB7CiAgICBpZiAoZHJhZ0JvdC5tYXNrcy5hcm1Cb3QpIHsKICAgICAgICBpZiAoZHJhZ0JvdC5saW5rcy5hcm1Cb3QudGFncy5tdWx0aVNlbGVjdCAmJiBkcmFnQm90LmxpbmtzLmFybVNlbGVjdGVkQm90cyAmJiBkcmFnQm90LnRhZ3MuYXJtR3JvdXBEcmFnKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGVuYWJsZSBjdXN0b20gZHJhZ2dpbmdgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3MuZW5hYmxlQ3VzdG9tRHJhZ2dpbmcoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRlc3Ryb3kgcHJldmlvdXMgYXJtQm90OiAke2RyYWdCb3QubWFza3MuYXJtQm90fWApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkZXN0cm95KGRyYWdCb3QubGlua3MuYXJtQm90KTsKICAgICAgICAgICAgZHJhZ0JvdC5tYXNrcy5hcm1Cb3QgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBtdWx0aVNlbGVjdEtleUhlbGQgPSBvcy5nZXRJbnB1dFN0YXRlKCdrZXlib2FyZCcsICdTaGlmdCcpOwogICAgY29uc3QgbXVsdGlTZWxlY3RBbGxvd2VkID0gZHJhZ0JvdC50YWdzLmFybU11bHRpU2VsZWN0ID8/IHRydWU7CgogICAgY29uc3QgYXJtQm90ID0gdGhpc0JvdC5hYkNyZWF0ZUFybSh7CiAgICAgICAgb3JpZ2luQm90OiBkcmFnQm90LAogICAgICAgIGRpbWVuc2lvbiwKICAgICAgICBtdWx0aVNlbGVjdDogbXVsdGlTZWxlY3RLZXlIZWxkICYmIG11bHRpU2VsZWN0QWxsb3dlZCwKICAgIH0pCgogICAgb3MucmVwbGFjZURyYWdCb3QoYXJtQm90KTsKfQonAIrn3NAO4gEFZGVidWcCBACK59zQDokKBWZhbHNlJwCK59zQDuIBCWxpc3RlbmluZwIEAIrn3NAOjwoEdHJ1ZScAiufc0A7iAQthYkNyZWF0ZUFybQIEAIrn3NAOlArjSUBjb25zdCBvcmlnaW5Cb3QgPSB0aGF0Lm9yaWdpbkJvdDsKYXNzZXJ0KGFiLmxpbmtzLnV0aWxzLmlzQm90KG9yaWdpbkJvdCksIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb3JpZ2luQm90IGlzIGEgcmVxdWlyZWQgQm90IHBhcmFtZXRlci5gKTsKCmNvbnN0IGRpbWVuc2lvbiA9IHRoYXQuZGltZW5zaW9uOwphc3NlcnQodHlwZW9mIGRpbWVuc2lvbiA9PT0gJ3N0cmluZycsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uIGlzIGEgcmVxdWlyZWQgc3RyaW5nIHBhcmFtZXRlci5gKTsKCmNvbnN0IHBvc2l0aW9uID0gdGhhdC5wb3NpdGlvbiA/PyBnZXRCb3RQb3NpdGlvbihvcmlnaW5Cb3QsIGRpbWVuc2lvbik7CmNvbnN0IG11bHRpU2VsZWN0ID0gdGhhdC5tdWx0aVNlbGVjdCA/PyBmYWxzZTsKY29uc3QgYXJtQ29sb3IgPSB0aGF0LmFybUNvbG9yID8/IG9yaWdpbkJvdC50YWdzLmFybUNvbG9yID8/IG9yaWdpbkJvdC50YWdzLnN0cm9rZUNvbG9yID8/IG9yaWdpbkJvdC50YWdzLmNvbG9yOwpjb25zdCBhcm1NZXNoUGF0aCA9IHRoYXQuYXJtTWVzaFBhdGggPz8gb3JpZ2luQm90LnRhZ3MuYXJtTWVzaFBhdGg7Cgpjb25zdCBhcm0gPSB7CiAgICBzcGFjZTogJ3RlbXBMb2NhbCcsCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIFtkaW1lbnNpb24gKyAnWCddOiBwb3NpdGlvbi54LAogICAgW2RpbWVuc2lvbiArICdZJ106IHBvc2l0aW9uLnksCiAgICBbZGltZW5zaW9uICsgJ1onXTogcG9zaXRpb24ueiwKICAgIGNyZWF0b3I6IG9yaWdpbkJvdC5pZCwKICAgIGlzQXJtQm90OiB0cnVlLAogICAgcG9pbnRhYmxlOiB0cnVlLAogICAgbXVsdGlTZWxlY3QsCiAgICBkZWJ1ZzogdGFncy5kZWJ1ZywKICAgIG9yaWdpbkJvdDogZ2V0TGluayhvcmlnaW5Cb3QpLAogICAgZGltZW5zaW9uLAogICAgYXJtQ29sb3IsCiAgICBhcm1NZXNoUGF0aCwKICAgIGxpbmVDb2xvcjogYXJtQ29sb3IsCiAgICBsaW5lVG86IG9yaWdpbkJvdC5pZCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjcmVhdGVkIGFybUJvdCAke3RoaXNCb3QuaWR9YCk7CiAgICAgICAgfQogICAgICAgIC8vIERlc3Ryb3kgcHJldmlvdXMgYXJtIGlmIGl0IGlzIHN0aWxsIGFyb3VuZC4KICAgICAgICBpZiAobGlua3Mub3JpZ2luQm90Lm1hc2tzLmFybUJvdCkgewogICAgICAgICAgICBkZXN0cm95KGxpbmtzLm9yaWdpbkJvdC5saW5rcy5hcm1Cb3QpOwogICAgICAgIH0KCiAgICAgICAgdGFncy5zeXN0ZW0gPSBgYXJtLiR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9YDsKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MuYXJtQm90ID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MuZHJhZ2dhYmxlID0gdGFncy5tdWx0aVNlbGVjdDsKCiAgICAgICAgaWYgKHRhZ3MuYXJtTWVzaFBhdGggJiYgIXRhZ3MubXVsdGlTZWxlY3QpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuYXJtTWVzaFBhdGguc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3MuYXJtTWVzaFBhdGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYWIuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwodGFncy5hcm1NZXNoUGF0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRhZ3MuZm9ybSA9ICdtZXNoJzsKICAgICAgICAgICAgdGFncy5mb3JtU3VidHlwZSA9ICdnbHRmJzsKICAgICAgICAgICAgdGFncy5hbmNob3JQb2ludCA9ICdjZW50ZXInOwogICAgICAgICAgICB0YWdzLmNvbG9yID0gdGFncy5hcm1Db2xvcjsKICAgICAgICAgICAgdGFncy5zY2FsZSA9IDAuOTk5OTsgLy8gVGhlcmUgaXMgYSByZWFsbHkgc3RyYW5nZSBidWcgdGhhdCBpZiB0aGlzIGlzIGxlZnQgdW5kZWZpbmVkIG9yIHNldCB0byAxIGV4YWN0bHksIHRoZSBhcm0gd2lsbCBzb21ldGltZXMgZGlzYXBwZWFyLgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3Muc3Ryb2tlQ29sb3IgPSB0YWdzLmFybUNvbG9yOwogICAgICAgICAgICB0YWdzLmZvcm0gPSAnY3ViZSc7CiAgICAgICAgICAgIHRhZ3MuY29sb3IgPSAnY2xlYXInOwogICAgICAgICAgICB0YWdzLnNjYWxlID0gMC45OwogICAgICAgICAgICB0YWdzLnNjYWxlWiA9IDAuMDE7CgogICAgICAgICAgICBpZiAodGFncy5tdWx0aVNlbGVjdCkgewogICAgICAgICAgICAgICAgdGFncy5mb3JtID0gJ3NwaGVyZSc7CiAgICAgICAgICAgICAgICB0YWdzLmNvbG9yID0gdGFncy5hcm1Db2xvcjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gTWFrZSB0aGUgb3JpZ2luIGJvdCB1bnNlbGVjdGFibGUgZm9yIDEvNCBvZiBhIHNlY29uZC4KICAgICAgICAvLyBUaGlzIGhlbHBzIHByZXZlbnQgdW5pbnRlbnRpb25hbCBzZWxmLXNlbGVjdGlvbiBvZiB0aGUgb3JpZ2luIGJvdC4KICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MucG9pbnRhYmxlID0gZmFsc2U7CiAgICAgICAgb3Muc2xlZXAoMjUwKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLnBvaW50YWJsZSA9IG51bGw7CiAgICAgICAgfSkKCiAgICAgICAgdGhpc0JvdC5vcmlnaW5DbGVhclNlbGVjdGlvbigpOwoKICAgICAgICB3aGlzcGVyKGxpbmtzLm9yaWdpbkJvdCwgJ29uQXJtQ3JlYXRlJyk7CiAgICB9KSwKICAgIHNldEFybVZpc2libGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsZXQgdmlzaWJsZSA9IHRoYXQ7CgogICAgICAgIGlmICh2aXNpYmxlKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmFybU1lc2hQYXRoKSB7CiAgICAgICAgICAgICAgICBtYXNrcy5mb3JtT3BhY2l0eSA9IG51bGw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXNrcy5zdHJva2VDb2xvciA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1hc2tzLmxpbmVDb2xvciA9IG51bGw7CiAgICAgICAgICAgIG1hc2tzLmxpbmVUbyA9IGxpbmtzLm9yaWdpbkJvdC5pZDsgCiAgICAgICAgICAgIG1hc2tzLnBvaW50YWJsZSA9IG51bGw7CgogICAgICAgICAgICBpZiAodGFncy5tdWx0aVNlbGVjdCkgewogICAgICAgICAgICAgICAgbWFza3MuY29sb3IgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHRhZ3MuYXJtTWVzaFBhdGgpIHsKICAgICAgICAgICAgICAgIG1hc2tzLmZvcm1PcGFjaXR5ID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1hc2tzLnN0cm9rZUNvbG9yID0gJ2NsZWFyJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWFza3MubGluZUNvbG9yID0gJ2NsZWFyJzsKICAgICAgICAgICAgbWFza3MubGluZVRvID0gZmFsc2U7CiAgICAgICAgICAgIG1hc2tzLnBvaW50YWJsZSA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHRhZ3MubXVsdGlTZWxlY3QpIHsKICAgICAgICAgICAgICAgIG1hc2tzLmNvbG9yID0gJ2NsZWFyJzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbnN0IHsgZGltZW5zaW9uIH0gPSB0aGF0OwoKICAgICAgICBpZiAobGlua3Mub3JpZ2luQm90Py50YWdzLmFybVRlbGVwb3J0ID8/IHRydWUpIHsKICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90LnRhZ3NbZGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC50YWdzW2RpbWVuc2lvbiArICdYJ10gPSB0YWdzW2RpbWVuc2lvbiArICdYJ107CiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC50YWdzW2RpbWVuc2lvbiArICdZJ10gPSB0YWdzW2RpbWVuc2lvbiArICdZJ107CiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC50YWdzW2RpbWVuc2lvbiArICdaJ10gPSB0YWdzW2RpbWVuc2lvbiArICdaJ107CiAgICAgICAgfQoKICAgICAgICB3aGlzcGVyKGxpbmtzLm9yaWdpbkJvdCwgJ29uQXJtQ2xpY2snLCB7IGRpbWVuc2lvbiB9KTsKCiAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgIH0pLAogICAgb25Ecm9wRW50ZXI6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5kcmFnQm90ICE9PSB0aGlzQm90KSByZXR1cm47CiAgICAgICAgaWYgKCFsaW5rcy5vcmlnaW5Cb3QpIHJldHVybjsKCiAgICAgICAgY29uc3QgZHJvcEJvdCA9IHRoYXQudG8uYm90OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MubGluZUNvbG9yID0gdGFncy5hcm1Db2xvcjsKCiAgICAgICAgaWYgKHRhZ3MubXVsdGlTZWxlY3QpIHsKICAgICAgICAgICAgbGV0IGxpbmVUb0JvdHMgPSBsaW5rcy5vcmlnaW5Cb3QubGlua3MubGluZVRvOwoKICAgICAgICAgICAgaWYgKGxpbmVUb0JvdHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVUbyA9IGdldExpbmsoZHJvcEJvdCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsaW5lVG9Cb3RzID0gQXJyYXkuaXNBcnJheShsaW5lVG9Cb3RzKSA/IGxpbmVUb0JvdHMgOiBbbGluZVRvQm90c107CgogICAgICAgICAgICAgICAgaWYgKCFsaW5lVG9Cb3RzLmluY2x1ZGVzKGRyb3BCb3QpKSB7CiAgICAgICAgICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVUbyA9IGdldExpbmsoLi4ubGluZVRvQm90cywgZHJvcEJvdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzQm90LnNldEFybVZpc2libGUoZmFsc2UpOwoKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaGlkZSBhcm1gKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVUbyA9IGRyb3BCb3QuaWQ7CgogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzaG93IHNlbGVjdGlvbiBvbiBvcmlnaW4gYm90LmApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkRyb3BFeGl0OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQuZHJhZ0JvdCAhPT0gdGhpc0JvdCkgcmV0dXJuOwogICAgICAgIGlmICghbGlua3Mub3JpZ2luQm90KSByZXR1cm47CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGRyb3BCb3QgPSB0aGF0LnRvLmJvdDsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcm9wQm90OmAsIGRyb3BCb3QpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0YWdzLm11bHRpU2VsZWN0KSB7CiAgICAgICAgICAgIHRoaXNCb3Quc2V0QXJtVmlzaWJsZSh0cnVlKTsKCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNob3cgYXJtYCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5saW5lVG8gPSBudWxsOwoKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2hvdyBzZWxlY3Rpb24gb24gb3JpZ2luIGJvdC5gKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25Ecm9wOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQuYm90ICE9PSB0aGlzQm90KSByZXR1cm47CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgZHJvcEJvdCA9IHRoYXQudG8uYm90OwogICAgICAgIAogICAgICAgIGlmICh0YWdzLm11bHRpU2VsZWN0ICYmIGxpbmtzLm9yaWdpbkJvdC5saW5rcy5saW5lVG8pIHsKICAgICAgICAgICAgdGhpc0JvdC5zZXRBcm1WaXNpYmxlKGZhbHNlKTsKICAgICAgICAgICAgdGhpc0JvdC5vcmlnaW5TZXRTZWxlY3Rpb24obGlua3Mub3JpZ2luQm90LmxpbmtzLmxpbmVUbyk7CiAgICAgICAgfSBlbHNlIGlmIChkcm9wQm90KSB7CiAgICAgICAgICAgIHRoaXNCb3Quc2V0QXJtVmlzaWJsZShmYWxzZSk7CiAgICAgICAgICAgIHRoaXNCb3Qub3JpZ2luU2V0U2VsZWN0aW9uKGRyb3BCb3QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIERyb3BwZWQgb24gZ3JpZC4KICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZHJvcHBlZCBvbiBncmlkLmApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB3aGlzcGVyKGxpbmtzLm9yaWdpbkJvdCwgJ29uQXJtUGxhY2VkJywgeyBkaW1lbnNpb246IHRoYXQudG8uZGltZW5zaW9uLCB4OiB0aGF0LnRvLngsIHk6IHRoYXQudG8ueSwgejogdGhhdC50by56IH0pOwogICAgICAgIH0KICAgICAgICAKICAgIH0pLAogICAgb25HcmlkQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90Lm9yaWdpbkNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgIH0pLAogICAgb3JpZ2luQ2xlYXJTZWxlY3Rpb246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5hcm1TZWxlY3RlZEJvdHMgPSBudWxsOwogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5saW5lQ29sb3IgPSBudWxsOwogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5saW5lVG8gPSBudWxsOwogICAgfSksCiAgICBvcmlnaW5TZXRTZWxlY3Rpb246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25zdCBzZWxlY3RlZEJvdHMgPSB0aGF0OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MuYXJtU2VsZWN0ZWRCb3RzID0gc2VsZWN0ZWRCb3RzID8gZ2V0TGluayhzZWxlY3RlZEJvdHMpIDogbnVsbDsKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MubGluZUNvbG9yID0gdGFncy5hcm1Db2xvcjsKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MubGluZVRvID0gbGlua3Mub3JpZ2luQm90LnRhZ3MuYXJtU2VsZWN0ZWRCb3RzOwogICAgICAgIAogICAgICAgIGlmIChsaW5rcy5vcmlnaW5Cb3QubGlua3MuYXJtU2VsZWN0ZWRCb3RzKSB7CiAgICAgICAgICAgIHdoaXNwZXIobGlua3Mub3JpZ2luQm90LCAnb25Bcm1TZWxlY3RlZEJvdHMnLCBsaW5rcy5vcmlnaW5Cb3QubGlua3MuYXJtU2VsZWN0ZWRCb3RzKQogICAgICAgIH0KICAgIH0pLAogICAgb25BbnlCb3RzUmVtb3ZlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmIChsaW5rcy5vcmlnaW5Cb3QubWFza3MuYXJtU2VsZWN0ZWRCb3RzKSB7CiAgICAgICAgICAgIC8vIENoZWNrIHRoYXQgd2Ugc3RpbGwgaGF2ZSBzb21lIGFjdGl2ZSBzZWxlY3RlZCBib3RzLgogICAgICAgICAgICBsZXQgYWN0aXZlU2VsZWN0ZWRCb3RzID0gZmFsc2U7CgogICAgICAgICAgICBjb25zdCBhcm1TZWxlY3RlZEJvdHMgPSBsaW5rcy5vcmlnaW5Cb3QubGlua3MuYXJtU2VsZWN0ZWRCb3RzOwoKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJtU2VsZWN0ZWRCb3RzKSkgewogICAgICAgICAgICAgICAgYWN0aXZlU2VsZWN0ZWRCb3RzID0gYXJtU2VsZWN0ZWRCb3RzLmV2ZXJ5KGIgPT4gISFiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFjdGl2ZVNlbGVjdGVkQm90cyA9ICEhYXJtU2VsZWN0ZWRCb3RzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWFjdGl2ZVNlbGVjdGVkQm90cykgewogICAgICAgICAgICAgICAgLy8gSWYgdGhlIGJvdHMgd2UgaGFkIHNlbGVjdGVkIG5vIGxvbmdlciBleGlzdCwgZGVzdHJveSB0aGlzIGFybS4KICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3RzIHRoYXQgYXJtIGhhcyBzZWxlY3RlZCBubyBsb25nZXIgZXhpc3QsIGRlc3Ryb3kgdGhpcyBhcm0uYCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpc0JvdC5vcmlnaW5DbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3RzIHRoYXQgYXJtIGhhcyBzZWxlY3RlZCBzdGlsbCBoYXMgYWN0aXZlIGJvdHMuYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KSwKICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5hcm1Cb3QgPSBudWxsOwogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5kcmFnZ2FibGUgPSBudWxsOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7CiAgICAgICAgfQoKICAgICAgICB3aGlzcGVyKGxpbmtzLm9yaWdpbkJvdCwgJ29uQXJtRGVzdHJveScpOwogICAgfSksCn07Cgpjb25zdCBhcm1Cb3QgPSBjcmVhdGUoYXJtKTsKCnJldHVybiBhcm1Cb3Q7JwCK59zQDuIBEG9uQW55Qm90RHJhZ2dpbmcCBACK59zQDvhT0RVAY29uc3QgZHJhZ0JvdCA9IHRoYXQuYm90Owpjb25zdCBkaW1lbnNpb24gPSB0aGF0LmZyb20uZGltZW5zaW9uOwoKaWYgKGRyYWdCb3QubGlua3MuYXJtQm90KSB7CiAgICBpZiAoZHJhZ0JvdC50YWdzLmFybUdyb3VwRHJhZyAmJiBkcmFnQm90LmxpbmtzLmFybVNlbGVjdGVkQm90cykgewogICAgICAgIGxldCBkcmFnQ29vcmRpbmF0b3JCb3QgPSBsaW5rcy5kcmFnQ29vcmRpbmF0b3JCb3Q7CiAgICAgICAgCiAgICAgICAgaWYgKCFkcmFnQ29vcmRpbmF0b3JCb3QpIHsKICAgICAgICAgICAgY29uc3QgZHJhZ0Nvb3JkaW5hdG9yTW9kID0gewogICAgICAgICAgICAgICAgc3BhY2U6ICJ0ZW1wTG9jYWwiLAogICAgICAgICAgICAgICAgbWFuYWdlcjogZ2V0TGluayh0aGlzQm90KSwKICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogZGltZW5zaW9uLAogICAgICAgICAgICAgICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICAgICAgICAgICAgICBbZGltZW5zaW9uICsgIlgiXTogMCwKICAgICAgICAgICAgICAgIFtkaW1lbnNpb24gKyAiWSJdOiAwLAogICAgICAgICAgICAgICAgW2RpbWVuc2lvbiArICJaIl06IC0xLAogICAgICAgICAgICAgICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRlYnVnOiB0YWdzLmRlYnVnLAogICAgICAgICAgICAgICAgY29sb3I6ICJjbGVhciIsCiAgICAgICAgICAgICAgICBzeXN0ZW06IGBhcm1Hcm91cERyYWcuJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uY29vcmRpbmF0b3JgLAogICAgICAgICAgICAgICAgb25BbnlCb3RQb2ludGVyVXA6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRlc3Ryb3lpbmcgZHJhZyBjb29yZGluYXRvcmApOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbGlua3MubWFuYWdlci5tYXNrcy5kcmFnQ29vcmRpbmF0b3JCb3QgPSBudWxsOyAKICAgICAgICAgICAgICAgICAgICBzaG91dCgnb25Bcm1TdG9wR3JvdXBEcmFnJywgeyB4OiB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1gnXSwgeTogdGFnc1t0YWdzLmRpbWVuc2lvbiArICdZJ10gfSk7CiAgICAgICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90ID0gY3JlYXRlKGRyYWdDb29yZGluYXRvck1vZCk7CgogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjcmVhdGVkIGRyYWcgY29vcmRpbmF0b3IgYm90OmAsIGRyYWdDb29yZGluYXRvckJvdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1hc2tzLmRyYWdDb29yZGluYXRvckJvdCA9IGdldExpbmsoZHJhZ0Nvb3JkaW5hdG9yQm90KTsKCiAgICAgICAgICAgIGNvbnN0IGFybVNlbGVjdGVkQm90cyA9IGRyYWdCb3QubGlua3MuYXJtU2VsZWN0ZWRCb3RzOwogICAgICAgICAgICBjb25zdCBvbkFybVN0b3BHcm91cERyYWcgPSBgQAogICAgICAgICAgICAgICAgbWFza3MudHJhbnNmb3JtZXIgPSBudWxsOwogICAgICAgICAgICAgICAgbWFza3Mub25Bcm1TdG9wR3JvdXBEcmFnID0gbnVsbDsKICAgICAgICAgICAgICAgIHRhZ3MuJHtkaW1lbnNpb259WCA9IHRhZ3MuJHtkaW1lbnNpb259WCArIHRoYXQueDsKICAgICAgICAgICAgICAgIHRhZ3MuJHtkaW1lbnNpb259WSA9IHRhZ3MuJHtkaW1lbnNpb259WSArIHRoYXQueTsKICAgICAgICAgICAgYAoKICAgICAgICAgICAgZHJhZ0JvdC5tYXNrcy50cmFuc2Zvcm1lciA9IGRyYWdDb29yZGluYXRvckJvdC5pZDsKICAgICAgICAgICAgZHJhZ0JvdC5tYXNrcy5vbkFybVN0b3BHcm91cERyYWcgPSBvbkFybVN0b3BHcm91cERyYWc7CgogICAgICAgICAgICBzZXRUYWdNYXNrKGFybVNlbGVjdGVkQm90cywgInRyYW5zZm9ybWVyIiwgZHJhZ0Nvb3JkaW5hdG9yQm90LmlkLCAidGVtcExvY2FsIik7CiAgICAgICAgICAgIHNldFRhZ01hc2soYXJtU2VsZWN0ZWRCb3RzLCAib25Bcm1TdG9wR3JvdXBEcmFnIiwgb25Bcm1TdG9wR3JvdXBEcmFnLCAidGVtcExvY2FsIik7CiAgICAgICAgfQoKICAgICAgICBjb25zdCB4Q2hhbmdlID0gdGhhdC50by54IC0gdGhhdC5mcm9tLng7CiAgICAgICAgY29uc3QgeUNoYW5nZSA9IHRoYXQudG8ueSAtIHRoYXQuZnJvbS55OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHhDaGFuZ2U6ICR7eENoYW5nZX0sIHlDaGFuZ2U6ICR7eUNoYW5nZX1gKTsKICAgICAgICB9CgogICAgICAgIGRyYWdDb29yZGluYXRvckJvdC50YWdzW2RpbWVuc2lvbiArICJYIl0gPSB4Q2hhbmdlOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdC50YWdzW2RpbWVuc2lvbiArICJZIl0gPSB5Q2hhbmdlOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdC50YWdzW2RpbWVuc2lvbiArICJaIl0gPSAtMTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcmFnIGJvdCB3aXRoIGFybSBkb2VzIG5vdCBxdWFsaWZ5IGZvciBncm91cCBkcmFnZ2luZy5gKTsKICAgICAgICB9CiAgICB9Cn0nAIrn3NAO4gENYWJQZXJzb25hbGl0eQIEAIrn3NAOymkEdHJ1ZScAiufc0A7iAQhhYklnbm9yZQIEAIrn3NAOz2kEdHJ1ZScAiufc0A7iAQRmb3JtAgQAiufc0A7UaQdub3RoaW5nJwCK59zQDuIBCWFiVmVyc2lvbgIEAIrn3NAO3GkFMTAuMzUnAQRib3RzJGIyNmUxMDg5LTE3MmQtNDVhOS04ZDIyLTA1YzNmNThjMmJmNwEnAIrn3NAO4mkGc3lzdGVtAgQAiufc0A7jaRhhYi5wZXJzb25hbGl0eS5hbmltYXRpb24nAIrn3NAO4mkEZm9ybQIEAIrn3NAO/GkHbm90aGluZycAiufc0A7iaQhhYklnbm9yZQIEAIrn3NAOhGoEdHJ1ZScAiufc0A7iaQ1tYW5pZmVzdGF0aW9uAgQAiufc0A6Jaijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCK59zQDuJpCHJlbWVtYmVyAgQAiufc0A6waijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCK59zQDuJpGGFuaW1hdGlvbl9hYkdyaWRNYW5pZmVzdAIEAIrn3NAO12r6DkBzaG91dCgicmVzZXQiKTsKCmNvbnN0IHBvc2l0aW9uWCA9IHRoYXQ/LnBvc2l0aW9uLnggPz8gMDsKY29uc3QgcG9zaXRpb25ZID0gdGhhdD8ucG9zaXRpb24ueSA/PyAwOwpjb25zdCBkaW1lbnNpb24gPSB0aGF0Py5kaW1lbnNpb24gPz8gImhvbWUiOwpjb25zdCBncmlkU2NhbGUgPSB0aGF0Py5zY2FsZSA/PyA1Owpjb25zdCBtb21lbnRDb3VudCA9IDA7CmNvbnN0IGdyaWRCb3QgPSB7fTsKCmdyaWRCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKZ3JpZEJvdC5jb2xvciA9ICJjbGVhciI7CmdyaWRCb3Quc3Ryb2tlQ29sb3IgPSBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmdyaWRCb3Quc2NhbGUgPSAwLjAwMTsKZ3JpZEJvdC5zY2FsZVogPSAwLjE7CmdyaWRCb3QucmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmdyaWRCb3RbZGltZW5zaW9uXSA9IHRydWU7CmdyaWRCb3QucG9pbnRhYmxlID0gZmFsc2U7CmdyaWRCb3Qua2lsbFRpbWVyID0gIkAgYXdhaXQgb3Muc2xlZXAoNDAwKTsgZGVzdHJveSh0aGlzQm90KTsiOwoKbGV0IHJvdW5kQm90czsKCmZvciAobGV0IGkgPSBncmlkU2NhbGU7IGkgPiAwOyBpLS0pCnsKICAgIGNvbnN0IGJvdENvdW50ID0gaSAqIDg7CgogICAgbGV0IHNpZGVDb3VudCA9IDA7CiAgICBsZXQgcGhhc2VGYWN0b3IgPSAwOwoKICAgIGZvciAobGV0IGogPSAwOyBqIDwgYm90Q291bnQ7IGorKykKICAgIHsKICAgICAgICBpZiAocGhhc2VGYWN0b3IgPT0gMCkKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9ICgoaSArIHBvc2l0aW9uWCkgKiAtMSkgKyBzaWRlQ291bnQ7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlkiXSA9IGkgKyBwb3NpdGlvblk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBoYXNlRmFjdG9yID09IDEpCiAgICAgICAgewogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJYIl0gPSBpICsgcG9zaXRpb25YOwogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJZIl0gPSAoaSArIHBvc2l0aW9uWSkgLSBzaWRlQ291bnQ7ICAKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocGhhc2VGYWN0b3IgPT0gMikKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9IChpICsgcG9zaXRpb25YKSAtIHNpZGVDb3VudDsKICAgICAgICAgICAgZ3JpZEJvdFtkaW1lbnNpb24gKyAiWSJdID0gKChpICsgcG9zaXRpb25ZKSAqIC0xKSA7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9ICgoaSArIHBvc2l0aW9uWCkgKiAtMSkgOwogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJZIl0gPSAoKGkgKyBwb3NpdGlvblkpICogLTEpICsgc2lkZUNvdW50OyAgCiAgICAgICAgfQoKICAgICAgICBjb25zdCBuZXdHcmlkQm90ID0gYXdhaXQgY3JlYXRlKGdyaWRCb3QpOwoKICAgICAgICBhbmltYXRlVGFnKG5ld0dyaWRCb3QsICJzY2FsZSIsIHsKICAgICAgICAgICAgdG9WYWx1ZTogMSwKICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAiZWxhc3RpYyIsCiAgICAgICAgICAgICAgICBtb2RlOiAib3V0IgogICAgICAgICAgICB9LAogICAgICAgICAgICBkdXJhdGlvbjogMC4wMQogICAgICAgIH0pLmNhdGNoKCgpID0+IHt9KTsKCiAgICAgICAgbmV3R3JpZEJvdC5raWxsVGltZXIoKTsKCiAgICAgICAgc2lkZUNvdW50Kys7CgogICAgICAgIGlmIChzaWRlQ291bnQgPT0gYm90Q291bnQgLyA0KQogICAgICAgIHsKICAgICAgICAgICAgc2lkZUNvdW50ID0gMDsKCiAgICAgICAgICAgIHBoYXNlRmFjdG9yKys7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBvcy5zbGVlcCg4KTsKICAgIH0KfScAiufc0A7iaQlhYlZlcnNpb24CBACK59zQDtJ5BTEwLjM1JwCK59zQDuJpBm9uQ2hhdAIEAIrn3NAO2HlVQC8vIGlmICh0aGF0Lm1lc3NhZ2UgPT0gIkB0ZXN0IikKLy8gewovLyAgICAgdGhpc0JvdC5hbmltYXRpb25fYWJHcmlkTWFuaWZlc3QoKTsKLy8gfScAiufc0A7iaQtwZXJzb25hbGl0eQIEAIrn3NAOrnoo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAiufc0A7iaQ1hYlBlcnNvbmFsaXR5AgQAiufc0A7VegR0cnVlJwEEYm90cyRiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGIBJwCK59zQDtp6BnN5c3RlbQIEAIrn3NAO23oVYWIucGVyc29uYWxpdHkuY29uZmlnJwCK59zQDtp6CGFiSWdub3JlAgQAiufc0A7xegR0cnVlJwCK59zQDtp6BGZvcm0CBACK59zQDvZ6B25vdGhpbmcnAIrn3NAO2noLYWJCYXNlQ29sb3ICBACK59zQDv56ByMwMEQ5Q0QnAIrn3NAO2noRYWJCYXNlU3Ryb2tlQ29sb3ICBACK59zQDoZ7ByMwMEQ5Q0QnAIrn3NAO2noQYWJCbHVlcHJpbnRDb2xvcgIEAIrn3NAOjnsHIzAwODI3QicAiufc0A7aeghyZW1lbWJlcgIEAIrn3NAOlnso8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAiufc0A7aehFhYkJ1aWxkZXJJZGVudGl0eQIEAIrn3NAOvXsKY2FzdWFsLmJvdCcAiufc0A7aeglhYlZlcnNpb24CBACK59zQDsh7BTEwLjM1JwCK59zQDtp6F2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnAgQAiufc0A7Oe6wVQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCFhdXRoQm90KSB7DQogICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsNCn0NCg0KaWYgKCFhdXRoQm90KSB7DQogICAgcmV0dXJuOw0KfQ0KDQphd2FpdCBvcy5ncmFudEluc3RBZG1pblBlcm1pc3Npb24oYXV0aEJvdC5pZCk7DQoNCmxldCBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGF3YWl0IG9zLmdldERhdGEoYXV0aEJvdC5pZCwgImFiUGVyc29uYWxpdHlDb25maWciKTsNCg0KaWYgKGFiUGVyc29uYWxpdHlDb25maWdEYXRhLnN1Y2Nlc3MgPT0gZmFsc2UpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IHt9Ow0KfSBlbHNlIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGFiUGVyc29uYWxpdHlDb25maWdEYXRhLmRhdGE7DQp9DQoNCmlmICh0aGF0Lm5hbWUpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCdWlsZGVySWRlbnRpdHkiXSA9IHRoYXQubmFtZTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJ1aWxkZXJJZGVudGl0eSIsIHRoYXQubmFtZSwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LmNvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZUNvbG9yIl0gPSB0aGF0LmNvbG9yOw0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VTdHJva2VDb2xvciJdID0gdGhhdC5jb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VDb2xvciIsIHRoYXQuY29sb3IsICJsb2NhbCIpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiQmFzZVN0cm9rZUNvbG9yIiwgdGhhdC5jb2xvciwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LnBvcnRhbENvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZUdyaWRQb3J0YWxDb2xvciJdID0gdGhhdC5wb3J0YWxDb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiLCB0aGF0LnBvcnRhbENvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQubWVudUNvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZU1lbnVDb2xvciJdID0gdGhhdC5tZW51Q29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlTWVudUNvbG9yIiwgdGhhdC5tZW51Q29sb3IsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5tZW51TGFiZWxDb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VNZW51TGFiZWxDb2xvciJdID0gdGhhdC5tZW51TGFiZWxDb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VNZW51TGFiZWxDb2xvciIsIHRoYXQubWVudUxhYmVsQ29sb3IsICJsb2NhbCIpOw0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VTaGFkb3dDb2xvciJdID0gdGhhdC5tZW51TGFiZWxDb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VTaGFkb3dDb2xvciIsIHRoYXQubWVudUxhYmVsQ29sb3IsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5ib3RMYWJlbENvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZUxhYmVsQ29sb3IiXSA9IHRoYXQuYm90TGFiZWxDb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VMYWJlbENvbG9yIiwgdGhhdC5ib3RMYWJlbENvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQuZm9ybSkgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkZvcm0iXSA9IHRoYXQuZm9ybTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkZvcm0iLCB0aGF0LmZvcm0sICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5haU1vZGVsKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiUHJlZmVycmVkQUlNb2RlbCJdID0gdGhhdC5haU1vZGVsOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiUHJlZmVycmVkQUlNb2RlbCIsIHRoYXQuYWlNb2RlbCwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LmRlZmF1bHRQZXJzb25hbGl0eSkgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhID0ge307DQogICAgdGhpc0JvdC51cGRhdGVQZXJzb25hbGl0eSh7fSk7DQp9DQoNCmlmICh0aGF0Lm1hcEJhc2VtYXApIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJNYXBQb3J0YWxCYXNlIl0gPSB0aGF0Lm1hcEJhc2VtYXA7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJNYXBQb3J0YWxCYXNlIiwgdGhhdC5tYXBCYXNlbWFwLCAibG9jYWwiKTsNCn0NCg0KY29uc3QgcmVzdWx0ID0gYXdhaXQgb3MucmVjb3JkRGF0YShhdXRoQm90LmlkLCAiYWJQZXJzb25hbGl0eUNvbmZpZyIsIGFiUGVyc29uYWxpdHlDb25maWdEYXRhKTsNCg0KaWYgKHJlc3VsdC5zdWNjZXNzKSB7DQogICAgYWIubGlua3MudXRpbHMuYWJMb2coeyBtZXNzYWdlOiBgdXBkYXRlZCBwZXJzb25hbGl0eSBjb25maWcgaW4gdXNlciByZWNvcmRgLCBsb2dUeXBlOiAnbG9nJ30pOw0KfSBlbHNlIHsNCiAgICBhYi5saW5rcy51dGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBmYWlsZWQgdG8gdXBkYXRlIHBlcnNvbmFsaXR5IGNvbmZpZyBpbiB1c2VyIHJlY29yZC5cbiR7SlNPTi5zdHJpbmdpZnkocmVzdWx0LCB1bmRlZmluZWQsIDIpfWAsIGxvZ1R5cGU6ICdlcnJvcid9KTsNCn0NCg0Kc2hvdXQoJ29uQUJQZXJzb25hbGl0eUNoYW5nZWQnLCB7IGJvdDogdGhpc0JvdCB9KTsnAIrn3NAO2noPYWJCYXNlTWVudUNvbG9yAgQAiufc0A77kAEHIzAwRDlDRCcAiufc0A7aehF1cGRhdGVQZXJzb25hbGl0eQIEAIrn3NAOg5EBsxdAaWYgKHRhZ3MuZGVidWcpIHsNCiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHVwZGF0ZSBzdGFydGApOw0KfQ0KDQppZiAodGhpc0JvdC52YXJzLnVwZGF0aW5nUGVyc29uYWxpdHkpIHsNCiAgICByZXR1cm47DQp9DQoNCnRoaXNCb3QudmFycy51cGRhdGluZ1BlcnNvbmFsaXR5ID0gdHJ1ZTsNCg0KbGV0IGFiUGVyc29uYWxpdHlDb25maWdEYXRhOw0KDQppZiAodGhhdCAmJiB0aGF0ID09IHt9KSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSB7fTsNCn0gZWxzZSB7DQogICAgaWYgKCFhdXRoQm90KSB7DQogICAgICAgIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7DQogICAgfQ0KDQogICAgaWYgKGF1dGhCb3QpIHsNCiAgICAgICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSBhd2FpdCBvcy5nZXREYXRhKGF1dGhCb3QuaWQsICJhYlBlcnNvbmFsaXR5Q29uZmlnIik7DQogICAgICAgIGlmICghbGlua3MucmVtZW1iZXIgJiYgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEuc3VjY2VzcyA9PSBmYWxzZSkgew0KICAgICAgICAgICAgdGhpc0JvdC52YXJzLnVwZGF0aW5nUGVyc29uYWxpdHkgPSBmYWxzZTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YS5zdWNjZXNzKSB7DQogICAgICAgICAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGFiUGVyc29uYWxpdHlDb25maWdEYXRhLmRhdGE7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCmlmICh0YWdzLmRlYnVnKSB7DQogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YTpgLCB7Li4uYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGF9KTsNCn0NCg0KLy9hYkJsdWVQcmludENvbG9yDQovL2FiQmFzZUFjY2VudENvbG9yDQpjb25zdCBhYlRhZ3MgPSBbDQogICAgImFiQmFzZUNvbG9yIiwNCiAgICAiYWJCYXNlTWVudUNvbG9yIiwNCiAgICAiYWJCdWlsZGVySWRlbnRpdHkiLA0KICAgICJhYkJhc2VTdHJva2VDb2xvciIsDQogICAgImFiQmFzZUdyaWRQb3J0YWxDb2xvciIsDQogICAgImFiQmFzZUxhYmVsQ29sb3IiLA0KICAgICJhYkJhc2VTaGFkb3dDb2xvciIsDQogICAgImFiUHJlZmVycmVkQUlNb2RlbCIsDQogICAgImFiQ2F0YWxvZ05hbWUiLA0KICAgICJhYk1hcFBvcnRhbEJhc2UiLA0KICAgICJhYkJhc2VNZW51TGFiZWxDb2xvciINCl07DQoNCmNsZWFyVGFnTWFza3ModGhpc0JvdCk7DQoNCi8vIFJ5YW4gKEF1ZyAyOSwgMjAyNSk6IGltIG5vdCBzdXJlIGV4YWN0bHkgd2hhdCBpcyBoYXBwZW5pbmcgaGVyZSBidXQgd2l0aG91dCBzbGVlcGluZyBvbiB0aGVzZSBiaWcgdGFnIG1hc2sgY2hhbmdlcywgdGhleSBkb250IGFsbCBzZWVtIHRvIGNvbWUgaW4gcHJvcGVybHkuDQphd2FpdCBvcy5zbGVlcCgxMDApOw0KDQpmb3IgKGxldCBpID0gMDsgaSA8IGFiVGFncy5sZW5ndGg7ICsraSkgew0KICAgIGlmIChhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSAmJiBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVthYlRhZ3NbaV1dKSB7DQogICAgICAgIGlmICh0YWdzW2FiVGFnc1tpXV0gIT0gYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbYWJUYWdzW2ldXSkgew0KICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNldHRpbmcgJHthYlRhZ3NbaV19IGxvY2FsIG1hc2sgZnJvbSBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YTogJHthYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVthYlRhZ3NbaV1dfWApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCBhYlRhZ3NbaV0sIGFiUGVyc29uYWxpdHlDb25maWdEYXRhW2FiVGFnc1tpXV0sICJsb2NhbCIpOw0KICAgICAgICB9DQogICAgfSBlbHNlIGlmIChsaW5rcy5yZW1lbWJlciAmJiBsaW5rcy5yZW1lbWJlci50YWdzW2FiVGFnc1tpXV0pIHsNCiAgICAgICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3NbYWJUYWdzW2ldXSAhPSB0YWdzW2FiVGFnc1tpXV0pIHsNCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzZXR0aW5nICR7YWJUYWdzW2ldfSBsb2NhbCBtYXNrIGZyb20gYWIgcmVtZW1iZXIgYm90OmAsIGxpbmtzLnJlbWVtYmVyLnRhZ3NbYWJUYWdzW2ldXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsIGFiVGFnc1tpXSwgbGlua3MucmVtZW1iZXIudGFnc1thYlRhZ3NbaV1dLCAibG9jYWwiKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGlmIChhYlRhZ3NbaV0gPT0gImFiQmFzZUdyaWRQb3J0YWxDb2xvciIpIHsNCiAgICAgICAgZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENvbG9yID0gdGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3I7DQogICAgfQ0KDQogICAgaWYgKGFiVGFnc1tpXSA9PSAiYWJNYXBQb3J0YWxCYXNlIikgew0KICAgICAgICBtYXBQb3J0YWxCb3QudGFncy5tYXBQb3J0YWxCYXNlbWFwID0gdGFncy5hYk1hcFBvcnRhbEJhc2U7DQogICAgICAgIG1pbmlNYXBQb3J0YWxCb3QudGFncy5tYXBQb3J0YWxCYXNlbWFwID0gdGFncy5hYk1hcFBvcnRhbEJhc2U7DQogICAgfQ0KfQ0KDQovLyBSeWFuIChBdWcgMjksIDIwMjUpOiBpbSBub3Qgc3VyZSBleGFjdGx5IHdoYXQgaXMgaGFwcGVuaW5nIGhlcmUgYnV0IHdpdGhvdXQgc2xlZXBpbmcgb24gdGhlc2UgYmlnIHRhZyBtYXNrIGNoYW5nZXMsIHRoZXkgZG9udCBhbGwgc2VlbSB0byBjb21lIGluIHByb3Blcmx5Lg0KYXdhaXQgb3Muc2xlZXAoMTAwKTsNCg0KdGhpc0JvdC52YXJzLnVwZGF0aW5nUGVyc29uYWxpdHkgPSBmYWxzZTsNCnNob3V0KCdvbkFCUGVyc29uYWxpdHlVcGRhdGVkJywgeyBib3Q6IHRoaXNCb3QgfSk7JwCK59zQDtp6DWFiUGVyc29uYWxpdHkCBACK59zQDreoAQR0cnVlJwCK59zQDtp6DW9uU2tpbGxVcGRhdGUCBACK59zQDryoAR1AdGhpc0JvdC51cGRhdGVQZXJzb25hbGl0eSgpOycAiufc0A7aehFhYkJhc2VTaGFkb3dDb2xvcgIEAIrn3NAO2qgBBWJsYWNrJwCK59zQDtp6EGFiQmFzZUxhYmVsQ29sb3ICBACK59zQDuCoAQVibGFjaycAiufc0A7aegptYXBPcHRpb25zAgQAiufc0A7mqAGeB/Cfp6xbDQogICAgew0KICAgICAgICAibmFtZSI6ICAic2F0ZWxsaXRlIiwNCiAgICAgICAgImlkIjogInNhdGVsbGl0ZSINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgImh5YnJpZCIsDQogICAgICAgICJpZCI6ICJoeWJyaWQiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJvY2VhbnMiLA0KICAgICAgICAiaWQiOiAib2NlYW5zIg0KICAgIH0sDQogICAgew0KICAgICAgICAibmFtZSI6ICAib3BlbiBzdHJlZXQgbWFwIiwNCiAgICAgICAgImlkIjogIm9zbSINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgInRlcnJhaW4iLA0KICAgICAgICAiaWQiOiAidGVycmFpbiINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgImRhcmsgZ3JheSBjYW52YXMiLA0KICAgICAgICAiaWQiOiAiZGFyay1ncmF5Ig0KICAgIH0sDQogICAgew0KICAgICAgICAibmFtZSI6ICAiZ3JheSBjYW52YXMiLA0KICAgICAgICAiaWQiOiAiZ3JheSINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgInN0cmVldHMiLA0KICAgICAgICAiaWQiOiAic3RyZWV0cyINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgInN0cmVldHMgKGRhcmspIiwNCiAgICAgICAgImlkIjogInN0cmVldHMtbmlnaHQtdmVjdG9yIg0KICAgIH0sDQogICAgew0KICAgICAgICAibmFtZSI6ICAic3RyZWV0cyAobmF2aWdhdGlvbikiLA0KICAgICAgICAiaWQiOiAic3RyZWV0cy1uYXZpZ2F0aW9uLXZlY3RvciINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgInRvcG9ncmFwaGljIiwNCiAgICAgICAgImlkIjogInRvcG8iDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJzdHJlZXRzIChyZWxpZWYpIiwNCiAgICAgICAgImlkIjogInN0cmVldHMtcmVsaWVmLXZlY3RvciINCiAgICB9DQpdJwCK59zQDtp6FHNob3dBQkJhc2VtYXBPcHRpb25zAgQAiufc0A6DsAHEBUBzaG91dCgiY2xlYXJBQkJhc2VtYXBPcHRpb25zTWVudSIpOw0KDQpzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCA9ICdhYkJhc2VtYXBPcHRpb25zTWVudSc7DQoNCmZvciAoY29uc3Qgb3B0aW9uIG9mIHRhZ3MubWFwT3B0aW9ucykgew0KICAgIGlmIChvcHRpb24uaWQgPT0gbWFwUG9ydGFsQm90LnRhZ3MubWFwUG9ydGFsQmFzZW1hcCkgew0KICAgICAgICBjb250aW51ZTsNCiAgICB9DQogICAgY29uc3Qgb3B0aW9uT2JqID0gDQogICAgew0KICAgICAgICBhYkJhc2VtYXBPcHRpb25zTWVudTogdHJ1ZSwNCiAgICAgICAgY2xlYXJBQkJhc2VtYXBPcHRpb25zTWVudTogYEBkZXN0cm95KHRoaXNCb3QpO2AsDQogICAgICAgIG1hcElEOiBvcHRpb24uaWQsDQogICAgICAgIGxhYmVsOiBvcHRpb24ubmFtZSwNCiAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgIG1hcFBvcnRhbEJvdC50YWdzLm1hcFBvcnRhbEJhc2VtYXAgPSB0YWdzLm1hcElEOw0KICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeydtYXBCYXNlbWFwJzogdGFncy5tYXBJRH0pOyANCiAgICAgICAgICAgIHNob3V0KCJjbGVhckFCQmFzZW1hcE9wdGlvbnNNZW51Iik7DQogICAgICAgIGANCiAgICB9DQoNCiAgICBhYi5saW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihvcHRpb25PYmopOw0KfScAiufc0A7aegtvbkdyaWRDbGljawIEAIrn3NAOyLUBJkBzaG91dCgiY2xlYXJBQkJhc2VtYXBPcHRpb25zTWVudSIpOw0KJwCK59zQDtp6BWRlYnVnAgQAiufc0A7vtQEFZmFsc2UnAQRib3RzJGI5YjgyODE5LTFmMTQtNDM5Mi04OGE5LTUyZjY3YTlmOGU1NQEnAIrn3NAO9bUBBnN5c3RlbQIEAIrn3NAO9rUBGGFiLnBlcnNvbmFsaXR5LmFybV9udWRnZScAiufc0A71tQENb25BQkFybVBsYWNlZAIEAIrn3NAOj7YBOEBzZXRUYWdNYXNrKHRoaXNCb3QsICdoYXNBcm1CZWVuUGxhY2VkJywgdHJ1ZSwgJ2xvY2FsJyk7JwCK59zQDvW1AQlvbkFCQXdha2UCBACK59zQDsi2ATBAYXdhaXQgb3Muc2xlZXAoMjUwKTsKdGhpc0JvdC5hYlN0YXJ0QXJtTnVkZ2UoKTsnAIrn3NAO9bUBCGFiSWdub3JlAgQAiufc0A75tgEEdHJ1ZScAiufc0A71tQENYWJQZXJzb25hbGl0eQIEAIrn3NAO/rYBBHRydWUnAIrn3NAO9bUBBGZvcm0CBACK59zQDoO3AQdub3RoaW5nJwCK59zQDvW1AQVsZWFybgIEAIrn3NAOi7cBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAIrn3NAO9bUBDW1hbmlmZXN0YXRpb24CBACK59zQDrK3ASjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCK59zQDvW1AQhyZW1lbWJlcgIEAIrn3NAO2bcBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIrn3NAO9bUBBWRlYnVnAgQAiufc0A6AuAEFZmFsc2UnAIrn3NAO9bUBDmFybU51ZGdlV2FpdE1TAgQAiufc0A6GuAEENTAwMCcAiufc0A71tQEPb25BQkluaXRpYWxpemVkAgQAiufc0A6LuAEbQHRoaXNCb3QuYWJTdGFydEFybU51ZGdlKCk7JwCK59zQDvW1AQ9hYlN0YXJ0QXJtTnVkZ2UCBACK59zQDqe4AYIfQGlmICh0aGlzQm90LnZhcnMubnVkZ2VBY3RpdmUpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGVyZSBpcyBhbHJlYWR5IGEgbnVkZ2UgaW4gcHJvZ3Jlc3MuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCnRoaXNCb3QudmFycy5udWRnZUFjdGl2ZSA9IHRydWU7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzdGFydGluZyBudWRnZS4uLmApCn0KCmZ1bmN0aW9uIGNhbk51ZGdlKCk6IGJvb2xlYW4gewogICAgLy8gQ2FuJ3QgaGF2ZSBwbGFjZWQgdGhlIGFybSBhbHJlYWR5LgogICAgaWYgKHRhZ3MuaGFzQXJtQmVlblBsYWNlZCkgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2Fubm90IG51ZGdlOiBhcm0gcGxhY2VtZW50IGhhcyBhbHJlYWR5IG9jY3VyZWQuYCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBBQiBtYW5pZmVzdGF0aW9uIGJvdCBtdXN0IGJlIGFjdGl2ZS4KICAgIGlmICghbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2Fubm90IG51ZGdlOiBhYiBtYW5pZmVzdGF0aW9uIGJvdCBpcyBpbmFjdGl2ZS5gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIEFCIGNoYXQgYmFyIG11c3QgYmUgY2xvc2VkLgogICAgaWYgKGxpbmtzLmlucHV0Lm1hc2tzLmNoYXRPcGVuKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYW5ub3QgbnVkZ2U6IGFiIGNoYXQgYmFyIGlzIG9wZW4uYCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBUaGUgaW5zdCBtdXN0IGJlIGVtcHR5IG9mIGFsbCBib3RzLiBUaGUgZXhjZXB0aW9ucyBhcmUgYWIgYm90cyBhbmQgYnVpbHQtaW4gYm90cy4KICAgIGNvbnN0IHVzZXJNYWRlQm90ID0gZ2V0Qm90KChiKSA9PiB7CiAgICAgICAgcmV0dXJuICFiLnRhZ3Muc3lzdGVtPy5zdGFydHNXaXRoKCdhYi4nKSAmJgogICAgICAgICAgICAgICAgYi5zcGFjZSA9PT0gJ3NoYXJlZCcgJiYKICAgICAgICAgICAgICAgICFiLnRhZ3MuYWJFZ2cgJiYgLy8gRG9uJ3QgaW5jbHVkZSBhYkVnZyBib3RzIGFzICJ1c2VyIG1hZGUiLgogICAgICAgICAgICAgICAgIWIudGFncy5hYkxvYWRlZFNraWxsICYmIC8vIERvbid0IGluY2x1ZGUgbG9hZGVkIHNraWxsIGJvdHMgYXMgInVzZXIgbWFkZSIuCiAgICAgICAgICAgICAgICAhYi50YWdzLmFiQm90IC8vIERvbid0IGluY2x1ZGUgYW55IGJvdHMgdGhhdCBhcmUgZmxhZ2dlZCB3aXRoIGFuIGFiQm90IHRhZy4KICAgIH0pCiAgICAKICAgIGlmICh1c2VyTWFkZUJvdCkgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnVXNlck1hZGVCb3RzKSB7CiAgICAgICAgICAgICAgICBjb25zdCB1c2VyTWFkZUJvdHMgPSBnZXRCb3RzKChiKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFiLnRhZ3Muc3lzdGVtPy5zdGFydHNXaXRoKCdhYi4nKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5zcGFjZSA9PT0gJ3NoYXJlZCcgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICFiLnRhZ3MuYWJFZ2cgLy8gRG9uJ3QgaW5jbHVkZSBhYkVnZyBib3RzIGFzICJ1c2VyIG1hZGUiLgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2Fubm90IG51ZGdlOiBpbnN0IGNvbnRhaW5zIHVzZXIgbWFkZSBib3RzLmAsIHVzZXJNYWRlQm90cyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogaW5zdCBjb250YWlucyB1c2VyIG1hZGUgYm90cy5gKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gTWVudSBwb3J0YWwgbXVzdCBlaXRoZXIgYmUgaW5hY3RpdmUgb3Igbm90IGhhdmUgYW55IGJvdHMgaW4gdGhlIGN1cnJlbnRseSBhY3RpdmUgbWVudSBwb3J0YWwuCiAgICBpZiAoY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCkgewogICAgICAgIGNvbnN0IGJvdEluTWVudVBvcnRhbCA9IGdldEJvdCgoYikgPT4gewogICAgICAgICAgICByZXR1cm4gYi50YWdzW2NvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWxdID09PSB0cnVlCiAgICAgICAgfSk7CgogICAgICAgIGlmIChib3RJbk1lbnVQb3J0YWwpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2Fubm90IG51ZGdlOiBtZW51UG9ydGFsIGlzIGN1cnJlbnRseSBvcGVuIGFuZCBoYXMgYm90cyBpbiBpdC5gKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwp9CgppZiAoY2FuTnVkZ2UoKSkgewogICAgLy8gU3RhcnQgbnVkZ2UgZm9yIGFybSBwbGFjZW1lbnQuCiAgICBhd2FpdCBvcy5zbGVlcCh0YWdzLmFybU51ZGdlV2FpdE1TKTsKCiAgICBpZiAoY2FuTnVkZ2UoKSkgewogICAgICAgIGNvbnN0IGFiUG9zaXRpb25YID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC50YWdzW2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb24gKyAnWCddOwogICAgICAgIGNvbnN0IGFiUG9zaXRpb25ZID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC50YWdzW2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb24gKyAnWSddOwoKICAgICAgICBjb25zdCBncmlkQ2xpY2tQYXJhbXMgPSB7CiAgICAgICAgICAgIGRpbWVuc2lvbjogbGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbiwKICAgICAgICAgICAgcG9zaXRpb246IHsgeDogYWJQb3NpdGlvblggKyA1LCB5OiBhYlBvc2l0aW9uWSB9LAogICAgICAgICAgICBmb3JjZUFybVBsYWNlbWVudDogdHJ1ZSwKICAgICAgICB9CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPT09IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb24pIHsKICAgICAgICAgICAgLy8gTWFwIHBvcnRhbCBpcyBpbiBkaWZmZXJlbnQgY29vcmRpbmF0ZSBzcGFjZSBhbmQgc2NhbGUuCiAgICAgICAgICAgIGdyaWRDbGlja1BhcmFtcy5wb3NpdGlvbi54ID0gYWJQb3NpdGlvblggKyAwLjAwMDM1NzQzNDA2ODQwNTM4MjM7CiAgICAgICAgfQoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHdoaXNwZXJpbmcgb25HcmlkQ2xpY2sgdG8gdGhlIGFiIG1hbmlmZXN0YXRpb24gYm90IHdpdGggdGhlIHBhcmFtczpgLCBncmlkQ2xpY2tQYXJhbXMpCiAgICAgICAgfQoKICAgICAgICAvLyBGb3JjZSBhYiBhcm0gcGxhY2VtZW50IHVzaW5nIHRoZSBvbkdyaWRDbGljayBsaXN0ZW5lciBvZiB0aGUgbWFuaWZlc3RhdGlvbiBib3QuCiAgICAgICAgd2hpc3BlcihsaW5rcy5tYW5pZmVzdGF0aW9uLCAnb25HcmlkQ2xpY2snLCBncmlkQ2xpY2tQYXJhbXMpOwogICAgfQp9Cgp0aGlzQm90LnZhcnMubnVkZ2VBY3RpdmUgPSBmYWxzZTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRvbmVgKTsKfScAiufc0A71tQEQb25BQkNoYXRCYXJDbG9zZQIEAIrn3NAOqtcBG0B0aGlzQm90LmFiU3RhcnRBcm1OdWRnZSgpOycAiufc0A71tQEFaW5wdXQCBACK59zQDsbXASjwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwCK59zQDvW1AQlhYlZlcnNpb24CBACK59zQDu3XAQUxMC4zNScAiufc0A71tQEPb25Qb3J0YWxDaGFuZ2VkAgQAiufc0A7z1wGFAUBjb25zdCB7IHBvcnRhbCwgZGltZW5zaW9uIH0gPSB0aGF0OwoKaWYgKHBvcnRhbCA9PT0gJ21lbnVQb3J0YWwnKSB7CiAgICBpZiAoIWRpbWVuc2lvbikgewogICAgICAgIHRoaXNCb3QuYWJTdGFydEFybU51ZGdlKCk7CiAgICB9Cn0nAIrn3NAO9bUBDWFiTWVudVJlZnJlc2gCBACK59zQDvnYARtAdGhpc0JvdC5hYlN0YXJ0QXJtTnVkZ2UoKTsnAIrn3NAO9bUBEWRlYnVnVXNlck1hZGVCb3RzAgQAiufc0A6V2QEFZmFsc2UnAQRib3RzJGRjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZAEnAIrn3NAOm9kBBnN5c3RlbQIEAIrn3NAOnNkBHGFiLnBlcnNvbmFsaXR5Lm1hbmlmZXN0YXRpb24nAIrn3NAOm9kBBGZvcm0CBACK59zQDrnZAQdub3RoaW5nJwCK59zQDpvZAQtkZXNjcmlwdGlvbgIEAIrn3NAOwdkBOFRoaXMgc2tpbGwgY29udHJvbHMgdGhlIGFjdHVhbCBib3QgZm9yIHRoZSBhYiBpbnRlcmZhY2UuJwCK59zQDpvZAQVsZWFybgIEAIrn3NAO+tkBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAIrn3NAOm9kBD29uUG9ydGFsQ2hhbmdlZAIEAIrn3NAOodoBv0dAY29uc3QgUE9SVEFMU19USEFUX0hJREUgPSBuZXcgU2V0KFsKICAgICJzeXN0ZW1Qb3J0YWwiLAogICAgInNoZWV0UG9ydGFsIgpdKQoKY29uc3QgUE9SVEFMU19USEFUX01BTklGRVNUID0gbmV3IFNldChbCiAgICAiZ3JpZFBvcnRhbCIsCiAgICAibWFwUG9ydGFsIgpdKTsKCmNvbnN0IE1BUF9MT0FEX1dBSVRfVElNRSA9IDEwMDA7Cgpmb3IgKGNvbnN0IHBvcnRhbCBvZiBQT1JUQUxTX1RIQVRfSElERSkgewogICAgaWYgKGNvbmZpZ0JvdC50YWdzW3BvcnRhbF0gIT0gbnVsbCkgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYSBwb3J0YWwgdGhhdCBoaWRlcyBhYiBpcyBvcGVuIC0gaGlkaW5nIGFiQm90IGFuZCBpZ25vcmluZy5gKTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmFiQm90KSB7CiAgICAgICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgppZiAoY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgIT0gbnVsbCB8fCBjb25maWdCb3QudGFncy5zeXN0ZW1Qb3J0YWwgIT0gbnVsbCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNoZWV0IHBvcnRhbCBvciBzeXN0ZW0gcG9ydGFsIG9wZW5lZCAtIGhpZGluZyBhYkJvdCBhbmQgaWdub3JpbmcuYCk7CiAgICB9CgogICAgaWYgKHRhZ3MuYWJCb3QpIHsKICAgICAgICBkZXN0cm95KGxpbmtzLmFiQm90KTsKICAgIH0KCiAgICByZXR1cm47Cn0KCmlmICghdGFncy5hYkF3YWtlKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWIgaXMgbm90IGF3YWtlIC0gaWdub3JpbmcuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LnBvcnRhbCA9PSAidGFnUG9ydGFsIikgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRhZ1BvcnRhbCBjaGFuZ2VkIC0gaWdub3JpbmcuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LnBvcnRhbCA9PSAibWVudVBvcnRhbCIpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtZW51UG9ydGFsIGNoYW5nZWQgLSBpZ25vcmluZy5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKHRoYXQucG9ydGFsID09ICJncmlkUG9ydGFsIiAmJiBjb25maWdCb3QudGFncy5tYXBQb3J0YWwpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBncmlkUG9ydGFsIGNoYW5nZWQsIGJ1dCBhbHNvIGFscmVhZHkgaW4gdGhlIG1hcFBvcnRhbCAtIGlnbm9yaW5nLmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9CgovLyBUaGUgbWFwIHBvcnRhbCBpcyB0b3VnaC4gSXQgc2VlbXMgdG8gdmFyeSBpbiBsb2FkaW5nIHNwZWVkIG9uCi8vIHZhcmlvdXMgaGFyZHdhcmUgYW5kIG5ldHdvcmtzIGFuZCBoYXMgYnkgdGhlIHRpbWUgb25Qb3J0YWxDaGFuZ2VkIGlzIGNhbGxlZCBpdCBkb2VzbnQKLy8gc2VlbSBndWFyZW50ZWVkIHRvIGJlIGFjdHVhbGx5IHJlYWR5LiBBZGRpbmcgYSBoYXJkY29kZWQgd2FpdCB0aW1lIHRvIGdpdmUgdGhlIHBvcnRhbCBzcGFjZSB0byBnZXQKLy8gdGhlIG1hcCBwb3J0YWwgZnVsbHkgbG9hZGVkIGJlZm9yZSBjb250aW51aW5nIHdpdGggbWFuaWZlc3RpbmcgYWIuCi8vCi8vIEF0IHNvbWUgcG9pbnQgdGhpcyBjYW4gZ28gYXdheSBpZiB3ZSBldmVyIGdldCBhIHNob3V0IG9yIHNvbWUgb3RoZXIgZ2F1cmVudGVlIHRoYXQgdGhlIG1hcCBwb3J0YWwgaXMgbG9hZGVkL3JlYWR5LgppZiAodGhhdC5wb3J0YWwgPT09ICdtYXBQb3J0YWwnKSB7CiAgICBpZiAodGhhdC5kaW1lbnNpb24pIHsKICAgICAgICBpZiAoIXRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkZWQgJiYgIXRoaXNCb3QudmFycy5tYXBQb3J0YWxJbml0aWFsTG9hZGVkKSB7CiAgICAgICAgICAgIGlmICghdGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRXYWl0ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkV2FpdGVyID0gb3Muc2xlZXAoTUFQX0xPQURfV0FJVF9USU1FKQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB3YWl0aW5nIGZvciBtYXAgcG9ydGFsIHRvIGZpbmlzaCBsb2FkaW5nOiAke01BUF9MT0FEX1dBSVRfVElNRX1tc2ApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlci50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkV2FpdGVyID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpc0JvdC52YXJzLm1hcFBvcnRhbEluaXRpYWxMb2FkZWQgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtYXAgcG9ydGFsIGxvYWRlZC5gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIC8vIGF3YWl0IHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkV2FpdGVyOwogICAgICAgICAgICAvLyB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlciA9IG51bGw7CiAgICAgICAgICAgIC8vIHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkZWQgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG1hcCBwb3J0YWwgaXMgYWxyZWFkeSBsb2FkZWQuYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkZWQgPSBmYWxzZTsKICAgICAgICB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlciA9IG51bGw7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWFwIHBvcnRhbCBoYXMgYmVlbiB1bmxvYWRlZC5gKTsKICAgICAgICB9CiAgICB9Cn0KCi8vIFN0YXJ0IGNoZWNrcyBmb3IgaWYvd2hlcmUgd2UgbmVlZCB0byBtYW5pZmVzdCBhYi4KbGV0IG5ld0FCID0gZmFsc2U7CmxldCBuZXdBQlBvcnRhbDsKbGV0IG5ld0FCUG9zaXRpb247CmxldCBmb2N1c0NhbWVyYSA9IHRydWU7CmxldCBmb2N1c0NhbWVyYVN0YXJ0Wm9vbTsKCmlmIChQT1JUQUxTX1RIQVRfTUFOSUZFU1QuaGFzKHRoYXQucG9ydGFsKSAmJiB0aGF0LmRpbWVuc2lvbikgewogICAgLy8gQSBwb3J0YWwgdGhhdCBtYW5pZmVzdHMgYWIgaGFzIGp1c3QgY2hhbmdlZCBkaW1lbnNpb24uCiAgICAvLyBNYW5pZmVzdCBhYiBpbiB0aGUgbmV3IGRpbWVuc2lvbi4KICAgIGlmICh0aGF0LnBvcnRhbCA9PSAibWFwUG9ydGFsIiB8fCB0aGF0LnBvcnRhbCA9PSAibWluaU1hcFBvcnRhbCIpIHs7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtYW5pZmVzdGluZyBhYiBib3QgaW4gbWFwIHBvcnRhbCBkaW1lbnNpb24gJyR7dGhhdC5kaW1lbnNpb259Jy5gKTsKICAgICAgICB9CgogICAgICAgIG5ld0FCUG9zaXRpb24gPSBhd2FpdCB0aGlzQm90LmdldERlZmF1bHRNYW5pZmVzdFBvc2l0aW9uKCdtYXAnKTsKICAgICAgICBuZXdBQlBvcnRhbCA9IHRoYXQucG9ydGFsOwogICAgICAgIG5ld0FCID0gYXdhaXQgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHsgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwgcG9zaXRpb246IG5ld0FCUG9zaXRpb24gfSk7CiAgICAgICAgZm9jdXNDYW1lcmFTdGFydFpvb20gPSBhd2FpdCB0aGlzQm90LmdldFN0YXJ0Q2FtZXJhWm9vbSgnbWFwJyk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG1hbmlmZXN0aW5nIGFiIGJvdCBkaW1lbnNpb24gJyR7dGhhdC5kaW1lbnNpb259Jy5gKTsKICAgICAgICB9CgogICAgICAgIG5ld0FCUG9zaXRpb24gPSBhd2FpdCB0aGlzQm90LmdldERlZmF1bHRNYW5pZmVzdFBvc2l0aW9uKCdncmlkJyk7CiAgICAgICAgbmV3QUJQb3J0YWwgPSB0aGF0LnBvcnRhbDsKICAgICAgICBuZXdBQiA9IGF3YWl0IHRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7IGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHBvc2l0aW9uOiBuZXdBQlBvc2l0aW9uIH0pOwogICAgICAgIGZvY3VzQ2FtZXJhU3RhcnRab29tID0gYXdhaXQgdGhpc0JvdC5nZXRTdGFydENhbWVyYVpvb20oJ2dyaWQnKTsKICAgIH0KfSBlbHNlIGlmICgoUE9SVEFMU19USEFUX01BTklGRVNULmhhcyh0aGF0LnBvcnRhbCkgfHwgUE9SVEFMU19USEFUX0hJREUuaGFzKHRoYXQucG9ydGFsKSkgJiYgCiAgICAgICAgICAgIXRoYXQuZGltZW5zaW9uICYmIAogICAgICAgICAgIChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsIHx8IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCkKKSB7CiAgICAvLyBBIHBvcnRhbCB0aGF0IHR5cGljYWxseSBoaWRlcyBvciByZS1tYW5pZmVzdHMgYWIganVzdCBjbG9zZWQsIGJ1dCBlaXRoZXIgdGhlIGdyaWQgb3IgbWFwIHBvcnRhbCBhcmUgc3RpbGwgb3Blbi4KICAgIC8vIFN1bW1vbiBhYiBpbiBlaXRoZXIgdGhlIG1hcFBvcnRhbCBvciBncmlkUG9ydGFsLgogICAgbGV0IHN1bW1vbkRpbWVuc2lvbjsKCiAgICBpZiAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsKSB7CiAgICAgICAgc3VtbW9uRGltZW5zaW9uID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsOwogICAgICAgIG5ld0FCUG9ydGFsID0gJ21hcFBvcnRhbCc7CiAgICAgICAgCiAgICAgICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3Nbc3VtbW9uRGltZW5zaW9uICsgJ0FCTGFzdFBvc2l0aW9uJ10pIHsKICAgICAgICAgICAgLy8gVXNlIGxhc3Qga25vd24gcG9zaXRpb24uCiAgICAgICAgICAgIG5ld0FCUG9zaXRpb24gPSBsaW5rcy5yZW1lbWJlci50YWdzW3N1bW1vbkRpbWVuc2lvbiArICdBQkxhc3RQb3NpdGlvbiddOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFVzZSBkZWZhdWx0IG1hcCBwb3NpdGlvbi4KICAgICAgICAgICAgbmV3QUJQb3NpdGlvbiA9IGF3YWl0IHRoaXNCb3QuZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24oJ21hcCcpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCkgewogICAgICAgIHN1bW1vbkRpbWVuc2lvbiA9IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CiAgICAgICAgbmV3QUJQb3J0YWwgPSAnZ3JpZFBvcnRhbCc7CgogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzW3N1bW1vbkRpbWVuc2lvbiArICdBQkxhc3RQb3NpdGlvbiddKSB7CiAgICAgICAgICAgIC8vIFVzZSBsYXN0IGtub3duIHBvc2l0aW9uLgogICAgICAgICAgICBuZXdBQlBvc2l0aW9uID0gbGlua3MucmVtZW1iZXIudGFnc1tzdW1tb25EaW1lbnNpb24gKyAnQUJMYXN0UG9zaXRpb24nXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBVc2UgZGVmYXVsdCBncmlkIHBvc2l0aW9uLgogICAgICAgICAgICBuZXdBQlBvc2l0aW9uID0gYXdhaXQgdGhpc0JvdC5nZXREZWZhdWx0TWFuaWZlc3RQb3NpdGlvbignZ3JpZCcpOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoc3VtbW9uRGltZW5zaW9uKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzdW1tb25pbmcgYWIgYm90IGluICR7bmV3QUJQb3J0YWx9IGRpbWVuc2lvbiAnJHtzdW1tb25EaW1lbnNpb259Jy5gKTsKICAgICAgICB9CgogICAgICAgIG5ld0FCID0gYXdhaXQgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHsgZGltZW5zaW9uOiBzdW1tb25EaW1lbnNpb24sIHBvc2l0aW9uOiBuZXdBQlBvc2l0aW9uIH0pOwoKICAgICAgICBpZiAoUE9SVEFMU19USEFUX0hJREUuaGFzKHRoYXQucG9ydGFsKSkgewogICAgICAgICAgICAvLyBJZiB0aGUgcG9ydGFsIHRoYXQgY2xvc2VkIHdhcyBhIHBvcnRhbCB0aGF0IGhpZGVzIGFiLCB0aGVuIGRvbnQgcnVuIHRoZSBjYW1lcmEgZm9jdXMuCiAgICAgICAgICAgIC8vIFRoaXMgd2lsbCBqdXN0IHVzZSB0aGUgcHJldmlvdXMgY2FtZXJhIHBvc2l0aW9uIGFscmVhZHkgc3RvcmVkIGluIG1lbW9yeS4KICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gd2lsbCBub3QgZm9jdXMgY2FtZXJhIG9uIGFiIGJlY2F1c2Ugd2UgYXJlIGp1c3QgYXNzdW1pbmcgdGhlIHByZXZpb3VzIGNhbWVyYSBwb3NpdGlvbi5gKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb2N1c0NhbWVyYSA9IGZhbHNlOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3RoIHRoZSBtYXAgYW5kIGdyaWQgcG9ydGFsIGFyZSBib3RoIGNsb3NlZCwgY2Fubm90IHN1bW1vbiBhYiBpbiBlaXRoZXIuYCk7CiAgICAgICAgfQogICAgfQp9IGVsc2UgewogICAgcmV0dXJuOwp9CgppZiAoZm9jdXNDYW1lcmEgJiYgbGlua3MucmVtZW1iZXIudGFncy5tYXBQcmV2ZW50Rm9jdXMpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBza2lwcGluZyBjYW1lcmEgZm9jdXMgYW5pbWF0aW9uIGJlY2F1c2UgbWFwUHJldmVudEZvY3VzIGlzIHNldCB0byB0cnVlIG9uIHRoZSBhYiByZW1lbWJlciBib3QuYCk7CiAgICB9CgogICAgZm9jdXNDYW1lcmEgPSBmYWxzZTsKfQoKaWYgKG5ld0FCICYmIGZvY3VzQ2FtZXJhKSB7CiAgICBpZiAodGhpc0JvdC52YXJzLmFjdGl2ZUZvY3VzSW5mbyAmJiAKICAgICAgICB0aGlzQm90LnZhcnMuYWN0aXZlRm9jdXNJbmZvLnBvcnRhbCA9PT0gdGhhdC5wb3J0YWwgJiYgCiAgICAgICAgdGhpc0JvdC52YXJzLmFjdGl2ZUZvY3VzSW5mby5kaW1lbnNpb24gPT09IHRoYXQuZGltZW5zaW9uICYmCiAgICAgICAgdGhpc0JvdC52YXJzLmFjdGl2ZUZvY3VzSW5mby5wb3NpdGlvbj8ueCA9PT0gbmV3QUJQb3NpdGlvbi54ICYmCiAgICAgICAgdGhpc0JvdC52YXJzLmFjdGl2ZUZvY3VzSW5mby5wb3NpdGlvbj8ueSA9PT0gbmV3QUJQb3NpdGlvbi55CiAgICApIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNraXBwaW5nIGNhbWVyYSBmb2N1cyBhbmltYXRpb24gYmVjYXVzZSBvbmUgaXMgYWxyZWFkeSBhY3RpdmUgd2l0aCB0aGUgc2FtZSBzZXR0aW5ncy5gKTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICB0aGlzQm90LnZhcnMuYWN0aXZlRm9jdXNJbmZvID0geyAKICAgICAgICBwb3J0YWw6IHRoYXQucG9ydGFsLCAKICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLAogICAgICAgIHBvc2l0aW9uOiB7Li4ubmV3QUJQb3NpdGlvbn0sCiAgICB9OwoKICAgIGxldCB6b29tID0gMTA7CgogICAgaWYgKG5ld0FCUG9ydGFsID09PSAnbWFwUG9ydGFsJyB8fCBuZXdBQlBvcnRhbCA9PT0gJ21pbmlNYXBQb3J0YWwnKSB7CiAgICAgICAgem9vbSA9IHRhZ3MuZGVmYXVsdE1hcFBvcnRhbFpvb207CiAgICB9CiAgICAKICAgIHRyeSB7CiAgICAgICAgaWYgKGZvY3VzQ2FtZXJhU3RhcnRab29tICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2V0IHN0YXJ0IHpvb20gb2YgJHtuZXdBQlBvcnRhbH0gdG8gJHtmb2N1c0NhbWVyYVN0YXJ0Wm9vbX0uYCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlcikgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRXYWl0ZXI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF3YWl0IG9zLmZvY3VzT24obmV3QUJQb3NpdGlvbiwgeyB6b29tOiBmb2N1c0NhbWVyYVN0YXJ0Wm9vbSwgZHVyYXRpb246IDAsIHBvcnRhbDogbmV3QUJQb3J0YWwgfSk7CiAgICAgICAgICAgIGF3YWl0IG9zLnNsZWVwKDEwMDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBmb2N1cyBvbiAke0pTT04uc3RyaW5naWZ5KG5ld0FCUG9zaXRpb24pfSBpbiAke25ld0FCUG9ydGFsfSB3aXRoIHpvb20gJHt6b29tfS5gKTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLmZvY3VzT24obmV3QUJQb3NpdGlvbiwgeyB6b29tLCByb3RhdGlvbjogeyB4OiA0NSwgeTogNDUgfSwgcG9ydGFsOiBuZXdBQlBvcnRhbCB9KQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGZvY3VzT24gZXJyb3Igb2NjdXJlZDpgLCBlKTsKICAgICAgICB9CiAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXNCb3QudmFycy5hY3RpdmVGb2N1c0luZm8gPSBudWxsOwogICAgfQp9JwCK59zQDpvZAQhyZW1lbWJlcgIEAIrn3NAO4aECKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIrn3NAOm9kBDWFiTWFuaWZlc3RCb3QCBACK59zQDoiiAsE+QGNvbnN0IGRpbWVuc2lvbiA9IHRoYXQ/LmRpbWVuc2lvbjsKY29uc3QgcG9zaXRpb24gPSB0aGF0Py5wb3NpdGlvbjsKCmlmICh0aGlzQm90LnZhcnMuYWJCb3RMYXN0SWQpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkZXN0cm95aW5nIGFiQm90YCk7CiAgICB9CiAgICBkZXN0cm95KHRoaXNCb3QudmFycy5hYkJvdExhc3RJZCk7Cn0KCmNvbnN0IGFiTW9kID0gewogICAgc3BhY2U6ICd0ZW1wTG9jYWwnLAogICAgZGltZW5zaW9uLAogICAgYWJCb3Q6IHRydWUsCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIFtkaW1lbnNpb24gKyAnWCddOiBwb3NpdGlvbi54LAogICAgW2RpbWVuc2lvbiArICdZJ106IHBvc2l0aW9uLnksCiAgICBtYW5hZ2VyOiBnZXRMaW5rKHRoaXNCb3QpLAogICAgcmVtZW1iZXI6IHRhZ3MucmVtZW1iZXIsCiAgICBmb3JtOiAnY3ViZScsCiAgICBsYWJlbDogbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VMYWJlbCwKICAgIGxhYmVsUG9zaXRpb246ICdmcm9udCcsCiAgICBsYWJlbENvbG9yOiBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yLAogICAgbGFiZWxTaXplOiAwLjYxLAogICAgZHJhZ2dhYmxlOiBmYWxzZSwKICAgIGFybVNlbGVjdGlvbjogdHJ1ZSwKICAgIGFybUdyb3VwRHJhZzogdHJ1ZSwKICAgIGFybVRlbGVwb3J0OiB0cnVlLAogICAgYXJtTWVzaFBhdGg6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBcm1NZXNoUGF0aCwKICAgIGFybUNvbG9yOiBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yLAogICAgcGVyc29uYWxpdHk6IHRhZ3MucGVyc29uYWxpdHksCiAgICByZW1lbWJlcjogdGFncy5yZW1lbWJlciwKICAgIGxlYXJuOiB0YWdzLmxlYXJuLAogICAgc3BpbkR1cmF0aW9uTVM6IDIwMDAsCiAgICBzcGluSW50ZXJ2YWxNUzogMjAwMCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7IAogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiTWVzaFBhdGgpIHsKICAgICAgICAgICAgbGV0IGZvcm1BZGRyZXNzOwoKICAgICAgICAgICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJNZXNoUGF0aC5zdGFydHNXaXRoKCdodHRwczovLycpKSB7CiAgICAgICAgICAgICAgICBmb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJNZXNoUGF0aDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZvcm1BZGRyZXNzID0gbGlua3MubGVhcm4uYWJCdWlsZENhc3VhbENhdGFsb2dVUkwobGlua3MucmVtZW1iZXIudGFncy5hYk1lc2hQYXRoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBtZXNoIGZvciBhYi4KICAgICAgICAgICAgbWFza3MubWVzaEJvdCA9IGdldExpbmsoY3JlYXRlKHsKICAgICAgICAgICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgICAgICAgICAgICAgIGFiQm90OiBnZXRMaW5rKHRoaXNCb3QpLAogICAgICAgICAgICAgICAgZm9ybTogJ21lc2gnLAogICAgICAgICAgICAgICAgZm9ybVN1YnR5cGU6ICdnbHRmJywKICAgICAgICAgICAgICAgIGZvcm1BZGRyZXNzLAogICAgICAgICAgICAgICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVyOiB0aGlzQm90LmlkLAogICAgICAgICAgICAgICAgYW5jaG9yUG9pbnQ6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgW3RhZ3MuZGltZW5zaW9uXTogdHJ1ZSwKICAgICAgICAgICAgICAgIFt0YWdzLmRpbWVuc2lvbiArICdaJ106IC0wLjUKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgdGFncy5jb2xvciA9ICd0cmFuc3BhcmVudCc7CiAgICAgICAgICAgIHRhZ3Muc2NhbGUgPSAxOwogICAgICAgICAgICB0YWdzLnNwaW5JbnRlcnZhbE1TID0gNDUwMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBJZiBhIGN1c3RvbSBtZXNoIGlzIG5vdCBkZWZpbmVkIGZvciBhYiwgdGhlbiBnaXZlIGFiIGEgImNvcmUiLgogICAgICAgICAgICBtYXNrcy5jb3JlQm90ID0gZ2V0TGluayhjcmVhdGUoewogICAgICAgICAgICAgICAgc3BhY2U6ICd0ZW1wTG9jYWwnLAogICAgICAgICAgICAgICAgYWJCb3Q6IGdldExpbmsodGhpc0JvdCksCiAgICAgICAgICAgICAgICBjb2xvcjogbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvciwKICAgICAgICAgICAgICAgIGZvcm1PcGFjaXR5OiAwLjY2LAogICAgICAgICAgICAgICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNjYWxlOiAwLjc1LAogICAgICAgICAgICAgICAgdHJhbnNmb3JtZXI6IHRoaXNCb3QuaWQsCiAgICAgICAgICAgICAgICBhbmNob3JQb2ludDogJ2NlbnRlcicsCiAgICAgICAgICAgICAgICBbdGFncy5kaW1lbnNpb25dOiB0cnVlLAogICAgICAgICAgICAgICAgW3RhZ3MuZGltZW5zaW9uICsgJ1onXTogLTAuNQogICAgICAgICAgICB9KSk7CgogICAgICAgICAgICB0YWdzLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvcjsKICAgICAgICAgICAgdGFncy5zY2FsZSA9IDAuOTsKICAgICAgICAgICAgdGFncy5zdHJva2VXaWR0aCA9IDE7CiAgICAgICAgICAgIHRhZ3Muc3Ryb2tlQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwogICAgICAgICAgICB0YWdzLmZvcm1PcGFjaXR5ID0gMC4zMzsKICAgICAgICAgICAgdGFncy5mb3JtRGVwdGhUZXN0ID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB0aGlzQm90LmFuaW1hdGVCb3QoKTsKICAgICAgICBtYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHRoaXNCb3QuYW5pbWF0ZUJvdCgpLCB0YWdzLnNwaW5JbnRlcnZhbE1TKTsKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGF0Lm1vZGFsaXR5ID09ICdtb3VzZScgJiYgdGhhdC5idXR0b25JZCA9PSAncmlnaHQnKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKG1hc2tzLmFybUJvdCkgewogICAgICAgICAgICBkZXN0cm95KGxpbmtzLmFybUJvdCk7CiAgICAgICAgICAgIG1hc2tzLmFybUJvdCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soKTsKICAgIH0pLAogICAgb25Qb2ludGVyRW50ZXI6TGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGF0Lm1vZGFsaXR5ID09PSAnbW91c2UnKSB7CiAgICAgICAgICAgIHRhZ3MubW91c2VPdmVyID0gdHJ1ZTsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsKICAgICAgICB9CiAgICB9KSwKICAgIG9uUG9pbnRlckV4aXQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5tb2RhbGl0eSA9PT0gJ21vdXNlJykgewogICAgICAgICAgICB0YWdzLm1vdXNlT3ZlciA9IGZhbHNlOwogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVBvcnRhbEN1cnNvcigpOwogICAgICAgIH0KICAgIH0pLAogICAgb25Qb2ludGVyRG93bjogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGF0Lm1vZGFsaXR5ID09PSAnbW91c2UnICYmIHRoYXQuYnV0dG9uSWQgPT09ICdsZWZ0JykgewogICAgICAgICAgICB0YWdzLm1vdXNlTGVmdEJ1dHRvbkRvd24gPSB0cnVlOwogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVBvcnRhbEN1cnNvcigpOwogICAgICAgIH0KICAgIH0pLAogICAgb25Qb2ludGVyVXA6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5tb2RhbGl0eSA9PT0gJ21vdXNlJyAmJiB0aGF0LmJ1dHRvbklkID09PSAnbGVmdCcpIHsKICAgICAgICAgICAgdGFncy5tb3VzZUxlZnRCdXR0b25Eb3duID0gZmFsc2U7CiAgICAgICAgICAgIHRhZ3MubW91c2VMZWZ0RHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsKICAgICAgICB9CiAgICB9KSwKICAgIG9uRHJhZzogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0YWdzLm1vdXNlTGVmdEJ1dHRvbkRvd24pIHsKICAgICAgICAgICAgdGFncy5tb3VzZUxlZnREcmFnZ2luZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlUG9ydGFsQ3Vyc29yKCk7ICAKICAgICAgICB9CiAgICB9KSwKICAgIG9uS2V5RG93bjogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ1NoaWZ0JykpIHsKICAgICAgICAgICAgdGFncy5zaGlmdEhlbGQgPSB0cnVlOwogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVBvcnRhbEN1cnNvcigpOyAgCiAgICAgICAgfQogICAgfSksCiAgICBvbktleVVwOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnU2hpZnQnKSkgewogICAgICAgICAgICB0YWdzLnNoaWZ0SGVsZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVBvcnRhbEN1cnNvcigpOyAgCiAgICAgICAgfQogICAgfSksCiAgICB1cGRhdGVQb3J0YWxDdXJzb3I6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsZXQgY3Vyc29yID0gbnVsbDsKCiAgICAgICAgaWYgKHRhZ3MubW91c2VMZWZ0RHJhZ2dpbmcpIHsKICAgICAgICAgICAgY3Vyc29yID0gJ2dyYWJiaW5nJzsgICAgCiAgICAgICAgfSBlbHNlIGlmICh0YWdzLm1vdXNlT3ZlcikgewogICAgICAgICAgICBpZiAodGFncy5zaGlmdEhlbGQpIHsKICAgICAgICAgICAgICAgIGN1cnNvciA9ICdjb250ZXh0LW1lbnUnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3Vyc29yID0gJ3BvaW50ZXInOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbEN1cnNvciA9IGN1cnNvcjsKICAgIH0pLAogICAgYW5pbWF0ZUJvdDogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4geyAKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3Qgcm90WiA9IHRhZ3MuZGltZW5zaW9uICsgJ1JvdGF0aW9uWic7CgogICAgICAgIGF3YWl0IGFuaW1hdGVUYWcodGhpc0JvdCwKICAgICAgICB7CiAgICAgICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICAgICAgW3JvdFpdOiAwLAogICAgICAgICAgICB9LAogICAgICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgICAgICBbcm90Wl06IDYuMywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAnc2ludXNvaWRhbCcsCiAgICAgICAgICAgICAgICBtb2RlOiAnaW5vdXQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGR1cmF0aW9uOiB0YWdzLnNwaW5EdXJhdGlvbk1TIC8gMTAwMCwKICAgICAgICB9KS5jYXRjaChlID0+IHt9KTsKICAgIH0pLAogICAgb25Bcm1DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAoIXRhZ3MuaW50ZXJ2YWwpIHsKICAgICAgICAgICAgbGlua3MubWFuYWdlci5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CiAgICAgICAgfQogICAgfSksCiAgICBvbkFybVBsYWNlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiR3JpZEZvY3VzID0gewogICAgICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLCAKICAgICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgICAgIHg6IHRoYXQueCwKICAgICAgICAgICAgICAgIHk6IHRoYXQueQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soeyBtZW51OiAnZ3JpZCcgfSk7CgogICAgICAgIHNob3V0KCdvbkFCQXJtUGxhY2VkJywgdGhhdCk7CiAgICB9KSwKICAgIG9uQXJtQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgICAgICBzaG91dCgnb25BQkZvb3RDbGlja2VkJywgdGhhdCk7CiAgICB9KSwKICAgIG9uQXJtU2VsZWN0ZWRCb3RzOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRCb3RzID0gdGhhdDsKCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2VsZWN0ZWRCb3RzKSkgewogICAgICAgICAgICAvLyBNdWx0aXBsZSBib3Qgc2VsZWN0aW9uLgogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYk11bHRpcGxlQm90Rm9jdXMgPSBnZXRMaW5rKHNlbGVjdGVkQm90cyk7CiAgICAgICAgICAgIGxpbmtzLm1hbmFnZXIuYWJDbGljayh7IG1lbnU6ICdtdWx0aXBsZUJvdCcgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gU2luZ2xlIGJvdCBzZWxlY3Rpb24uCiAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQm90Rm9jdXMgPSAi8J+UlyIgKyBzZWxlY3RlZEJvdHMuaWQ7CgogICAgICAgICAgICBpZiAoc2VsZWN0ZWRCb3RzID09PSB0aGlzQm90KSB7CiAgICAgICAgICAgICAgICBhYi5saW5rcy5tZW51LmFiRW52aXJvbm1lbnRNZW51KCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soeyBtZW51OiAnYm90JyB9KTsKICAgICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCU2VsZWN0ZWRCb3QnLCBzZWxlY3RlZEJvdHMpOwogICAgfSksCiAgICBvbkFybURlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgfSksCiAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjbGVhckludGVydmFsKHRhZ3MuaW50ZXJ2YWwpOwogICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICB9KSwKfTsKCmNvbnN0IGFiQm90ID0gY3JlYXRlKGFiTW9kKTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiU2Vjb25kYXJ5TGFiZWwpIHsKICAgIGNvbnN0IGFiTGFiZWxCb3QgPSB7CiAgICAgICAgc3BhY2U6ICd0ZW1wTG9jYWwnLAogICAgICAgIFtkaW1lbnNpb25dOiB0cnVlLAogICAgICAgIFtkaW1lbnNpb24gKyAnWiddOiAtMSwKICAgICAgICBjcmVhdG9yOiBhYkJvdC5pZCwKICAgICAgICB0cmFuc2Zvcm1lcjogYWJCb3QuaWQsCiAgICAgICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgICAgICBjb2xvcjogJ2NsZWFyJywKICAgICAgICBsYWJlbDogbGlua3MucmVtZW1iZXIudGFncy5hYlNlY29uZGFyeUxhYmVsLAogICAgICAgIGxhYmVsUG9zaXRpb246ICdsZWZ0JywKICAgICAgICBsYWJlbFNpemU6IDAuNywKICAgICAgICBsYWJlbENvbG9yOiBhYkJvdC50YWdzLmxhYmVsQ29sb3IsCiAgICB9OwoKICAgIGNyZWF0ZShhYkxhYmVsQm90KTsKfQoKbWFza3MuYWJCb3QgPSBnZXRMaW5rKGFiQm90KTsKbGlua3MucmVtZW1iZXIubWFza3MuYWJBY3RpdmVEaW1lbnNpb24gPSBkaW1lbnNpb247CnRoaXNCb3QudmFycy5hYkJvdExhc3RJZCA9IGFiQm90LmlkOyAvLyBTdG9yaW5nIGlkIGFzIGEgdmFyIHByZXZlbnRzIGdob3N0IGFiQm90cyBkdXJpbmcgbXVsdGlwbGUgY2FsbHMgaW4gb25lIGZyYW1lLgoKLy8gU3RvcmUgdGhlIGxhc3QgcG9zaXRpb24gb2YgYWIgaW4gdGhpcyBkaW1lbnNpb24gb24gdGhlIHJlbWVtYmVyIGJvdC4KbGlua3MucmVtZW1iZXIubWFza3NbZGltZW5zaW9uICsgJ0FCTGFzdFBvc2l0aW9uJ10gPSAn8J+nrCcgKyBKU09OLnN0cmluZ2lmeSh7IHg6IHBvc2l0aW9uPy54LCB5OiBwb3NpdGlvbj8ueSB9KTsKCmF3YWl0IG9zLnNsZWVwKDApOyAvLyBHaXZlIENhc3VhbE9TIGEgY2hhbmNlIHRvIHVwZGF0ZSB0YWcgbWFza3MuCgpzaG91dCgnb25BQk1vdmVkJywgeyBkaW1lbnNpb24sIHg6IHBvc2l0aW9uLngsIHk6IHBvc2l0aW9uLnkgfSk7CgpyZXR1cm4gYWJCb3Q7JwCK59zQDpvZAQtvbkdyaWRDbGljawIEAIrn3NAOxuACwBRAaWYgKCF0YWdzLmFiQXdha2UpIHsKICAgIHJldHVybjsKfQoKY29uc3Qgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZiAobGlua3MuYWJCb3QgJiYgKHNoaWZ0Q2hlY2sgfHwgKHRoYXQubW9kYWxpdHkgPT0gIm1vdXNlIiAmJiB0aGF0LmJ1dHRvbklkID09ICJyaWdodCIgJiYgIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSaWdodENsaWNrRGlzYWJsZWQpIHx8IHRoYXQuZm9yY2VBcm1QbGFjZW1lbnQpKSB7CiAgICBjb25zdCBhcm1Cb3QgPSBhYi5saW5rcy5hcm1fdG9vbC5hYkNyZWF0ZUFybSh7CiAgICAgICAgb3JpZ2luQm90OiBsaW5rcy5hYkJvdCwKICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLAogICAgICAgIHBvc2l0aW9uOiB0aGF0LnBvc2l0aW9uLAogICAgfSkKCiAgICAvLyBGYWtlIHVzZXIgZHJvcHBpbmcgdGhlIGFybSBvbiB0aGUgZ3JpZCBzcGFjZS4KICAgIGFybUJvdC5vbkRyb3AoewogICAgICAgIGJvdDogYXJtQm90LAogICAgICAgIHRvOiB7CiAgICAgICAgICAgIHg6IHRoYXQucG9zaXRpb24ueCwKICAgICAgICAgICAgeTogdGhhdC5wb3NpdGlvbi55LAogICAgICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uCiAgICAgICAgfSwKICAgICAgICBmcm9tOiB7CiAgICAgICAgICAgIHg6IHRoYXQucG9zaXRpb24ueCwKICAgICAgICAgICAgeTogdGhhdC5wb3NpdGlvbi55LAogICAgICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuOwp9Cgpjb25zdCBmb290cHJpbnQgPSB7CiAgICBzcGFjZTogInRlbXBMb2NhbCIsCiAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLAogICAgW3RoYXQuZGltZW5zaW9uXTogdHJ1ZSwKICAgIFt0aGF0LmRpbWVuc2lvbiArICJYIl06IHRoYXQucG9zaXRpb24ueCwKICAgIFt0aGF0LmRpbWVuc2lvbiArICJZIl06IHRoYXQucG9zaXRpb24ueSwKICAgIHBvc2l0aW9uSW5mbzogdGhhdCwKICAgIHBlcnNvbmFsaXR5OiB0YWdzLnBlcnNvbmFsaXR5LAogICAgcmVtZW1iZXI6IHRhZ3MucmVtZW1iZXIsCiAgICBsZWFybjogdGFncy5sZWFybiwKICAgIGRyYWdnYWJsZTogZmFsc2UsCiAgICBjdXJzb3I6ICdhbGlhcycsCiAgICBtYW5hZ2VyOiBnZXRMaW5rKHRoaXNCb3QpLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGRlc3Ryb3kodGhpc0JvdCksIDgwMCk7CgogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQXJtTWVzaFBhdGgpIHsKICAgICAgICAgICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBcm1NZXNoUGF0aC5zdGFydHNXaXRoKCdodHRwczovLycpKSB7CiAgICAgICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkFybU1lc2hQYXRoOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLmxlYXJuLmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBcm1NZXNoUGF0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRhZ3MuZm9ybSA9ICdtZXNoJzsKICAgICAgICAgICAgdGFncy5mb3JtU3VidHlwZSA9ICdnbHRmJzsKICAgICAgICAgICAgdGFncy5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CiAgICAgICAgICAgIHRhZ3Muc3Ryb2tlQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwogICAgICAgICAgICB0YWdzLmFuY2hvclBvaW50ID0gJ2NlbnRlcic7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5jb2xvciA9ICdjbGVhcic7CiAgICAgICAgICAgIHRhZ3Muc3Ryb2tlQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwogICAgICAgICAgICB0YWdzLnNjYWxlWiA9IDAuMDE7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgICAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgICAgICBzY2FsZVg6IDAuMSwKICAgICAgICAgICAgICAgIHNjYWxlWTogMC4xCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgICAgIHNjYWxlWDogMS4xLAogICAgICAgICAgICAgICAgc2NhbGVZOiAxLjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHVyYXRpb246IDAuNSwKICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAiZWxhc3RpYyIsCiAgICAgICAgICAgICAgICBtb2RlOiAib3V0IgogICAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZSA9PiB7fSk7CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgIHNob3V0KCJvbkFCRm9vdENsaWNrZWQiLCB7IGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24gfSk7CiAgICAgICAgbGlua3MubWFuYWdlci5hYk1hbmlmZXN0Qm90KHRhZ3MucG9zaXRpb25JbmZvKTsKICAgIH0pLAp9OwoKCmNyZWF0ZShmb290cHJpbnQpOycAiufc0A6b2QEEbWVudQIEAIrn3NAOh/UCKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAIrn3NAOm9kBB2FiQ2xpY2sCBACK59zQDq71AtAKQGlmICghbGlua3MuYWJCb3QpIHsKICAgIHJldHVybjsKfQoKaWYgKGxpbmtzLmlucHV0KSB7CiAgICBsaW5rcy5pbnB1dC5hYkNoYXRCYXJDbG9zZSgpOwp9Cgpjb25zdCByZXNldCA9IHRoYXQgPyB0aGF0LnJlc2V0IDogZmFsc2U7CmNvbnN0IG1lbnUgPSB0aGF0ID8gdGhhdC5tZW51IDogImNvcmUiOwpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZiAoIXJlc2V0ICYmIChsaW5rcy5hYkJvdC50YWdzLmludGVydmFsIHx8IHN0YXRlKSkgewogICAgY29uc3QgYWJNZW51Qm90cyA9IGdldEJvdHMoImFiTWVudSIsIHRydWUpOwoKICAgIHdoaXNwZXIoYWJNZW51Qm90cywgImFiTWVudVJlZnJlc2giKTsKCiAgICBjbGVhckludGVydmFsKGxpbmtzLmFiQm90LnRhZ3MuaW50ZXJ2YWwpOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmludGVydmFsID0gbnVsbDsKCiAgICBjbGVhckFuaW1hdGlvbnMobGlua3MuYWJCb3QpOwoKICAgIGNvbnN0IHJvdFogPSBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJSb3RhdGlvbloiOwoKICAgIGlmIChzdGF0ZSAmJiBtZW51ID09ICJjb3JlIikgewogICAgICAgIGxpbmtzLm1lbnUuYWJFbnZpcm9ubWVudE1lbnUoKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGxpbmtzLm1lbnUuYWJPcGVuTWVudShtZW51KTsKICAgIH0KCiAgICBhbmltYXRlVGFnKGxpbmtzLmFiQm90LCB7CiAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgIFtyb3RaXTogbGlua3MuYWJCb3QudGFnc1tyb3RaXQogICAgICAgIH0sCiAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICBbcm90Wl06IDAKICAgICAgICB9LAogICAgICAgIGVhc2luZzogewogICAgICAgICAgICB0eXBlOiAic2ludXNvaWRhbCIsCiAgICAgICAgICAgIG1vZGU6ICJpbm91dCIKICAgICAgICB9LAogICAgICAgIGR1cmF0aW9uOiAwLjUKICAgIH0pLmNhdGNoKGUgPT4ge30pCn0KZWxzZSB7CiAgICBsaW5rcy5hYkJvdC5hbmltYXRlQm90KCk7CgogICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gbnVsbDsKCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGNsZWFySW50ZXJ2YWwobGlua3MuYWJCb3QudGFncy5pbnRlcnZhbCk7CiAgICBsaW5rcy5hYkJvdC5tYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IGxpbmtzLmFiQm90LmFuaW1hdGVCb3QoKSwgbGlua3MuYWJCb3QudGFncy5zcGluSW50ZXJ2YWxNUyk7Cn0KCnNob3V0KCdvbkFCQ2xpY2snLCB7IGFiQm90OiBsaW5rcy5hYkJvdCwgZGltZW5zaW9uOiBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiwgbWVudSwgc2hpZnRLZXk6ICEhc3RhdGUsIHJlc2V0IH0pOycAiufc0A6b2QEIYWJJZ25vcmUCBACK59zQDv//AgR0cnVlJwCK59zQDpvZAQNhc2sCBACK59zQDoSAAyjwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCK59zQDpvZAQlhc2tCdXR0b24CBACK59zQDquAA8gFQGlmICghdGFncy5hYkF3YWtlKQp7CiAgICByZXR1cm47Cn0KCmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSBsaW5rcy5tZW51LnRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gbGlua3MubWVudS50YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24uYmFzZVNraWxsID0gIvCflJciICsgbGlua3MuYXNrLmlkOwphYk1lbnVCdXR0b24ubGFiZWwgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51TGFiZWw7CmFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVJY29uOwphYk1lbnVCdXR0b24ub25DcmVhdGUgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51T25HZW5lcmF0ZTsKYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVTb3J0T3JkZXI7CmFiTWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVDb2xvciA/IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVDb2xvciA6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOycAiufc0A6b2QEJYWJCb3RDaGF0AgQAiufc0A7yhQPuCEBpZiAoIWxpbmtzLmFiQm90ICYmICF0aGF0LmJvdCkKewogICAgcmV0dXJuOwp9Cgpjb25zdCBib3RCYXNlID0gdGhhdC5ib3QgPyB0aGF0LmJvdDogbGlua3MuYWJCb3Q7CmNvbnN0IGRpbWVuc2lvbiA9ICF0aGF0LmJvdCA/IGJvdEJhc2UudGFncy5kaW1lbnNpb24gOiB0aGF0LmRpbWVuc2lvbiA/IHRoYXQuZGltZW5zaW9uIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKY29uc3QgbWVzc2FnZSA9IHRoYXQubWVzc2FnZTsKY29uc3QgbWVzc2FnZVRpbWUgPSB0aGF0LnRpbWUgPyB0aGF0LnRpbWUgKiAxMDAwIDogMTYwMDsgCgpjb25zdCBtZXNzYWdlQm90ID0gYXdhaXQgbGlua3MuYm90X2ZhY3RvcnkuYWJDcmVhdGVCaWxsYm9hcmRMYWJlbCh7CiAgICBib3Q6IGJvdEJhc2UsCiAgICBsYWJlbDogbWVzc2FnZSwKICAgIGRpbWVuc2lvbiwKICAgIG1lc3NhZ2VUaW1lLAogICAgY29sb3I6ICIjMDAwMDAwIiwKICAgIGxhYmVsQ29sb3I6ICIjZmZmZmZmIiwKICAgIG9uQm90QWRkZWQ6IGBACiAgICAgICAgYXdhaXQgb3Muc2xlZXAodGFncy5tZXNzYWdlVGltZSk7CiAgICAgICAgdGhpc0JvdC5vbkZhZGUoKTsKICAgIGAsCiAgICBvbkZhZGU6IGBACiAgICAgICAgYW5pbWF0ZVRhZyh0aGlzQm90LCB7CiAgICAgICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICAgICAgZm9ybU9wYWNpdHk6IDEsCiAgICAgICAgICAgICAgICBsYWJlbE9wYWNpdHk6IDEsCiAgICAgICAgICAgICAgICBbdGFncy5kaW1lbnNpb24gKyAiWiJdOiB0YWdzW3RhZ3MuZGltZW5zaW9uICsgIloiXQogICAgICAgICAgICB9LAogICAgICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgICAgICBmb3JtT3BhY2l0eTogMCwKICAgICAgICAgICAgICAgIGxhYmVsT3BhY2l0eTogMCwKICAgICAgICAgICAgICAgIFt0YWdzLmRpbWVuc2lvbiArICJaIl06IHRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWiJdICsgNQogICAgICAgICAgICB9LAogICAgICAgICAgICBkdXJhdGlvbjogJHt0aGF0LmR1cmF0aW9uID8/IDN9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHt9KQogICAgICAgIC5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICB9KQoKICAgIGAsCn0pOycAiufc0A6b2QEJYWJWZXJzaW9uAgQAiufc0A7hjgMFMTAuMzUnAIrn3NAOm9kBCWFuaW1hdGlvbgIEAIrn3NAO544DKPCflJdiMjZlMTA4OS0xNzJkLTQ1YTktOGQyMi0wNWMzZjU4YzJiZjcnAIrn3NAOm9kBD29uQW55Qm90Q2xpY2tlZAIEAIrn3NAOjo8D6QdAaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiUmlnaHRDbGlja0Rpc2FibGVkICYmICF0aGF0LmJvdC50YWdzLmFiUmlnaHRDbGlja0lnbm9yZSAmJiB0aGF0Lm1vZGFsaXR5ID09ICJtb3VzZSIgJiYgdGhhdC5idXR0b25JZCA9PSAicmlnaHQiKSB7CiAgICBpZiAoIXRhZ3MuYWJBd2FrZSkgewogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBhYiBzZWxlY3RlZAogICAgaWYgKHRoYXQuYm90ID09IGxpbmtzLmFiQm90KSB7CiAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgICAgIHJldHVybjsKICAgIH0gICAgCiAgICAKICAgIGNvbnN0IGFybUJvdCA9IGFiLmxpbmtzLmFybV90b29sLmFiQ3JlYXRlQXJtKHsKICAgICAgICBvcmlnaW5Cb3Q6IGxpbmtzLmFiQm90LAogICAgICAgIGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sCiAgICAgICAgcG9zaXRpb246IHRoYXQucG9zaXRpb24sCiAgICB9KQoKICAgIGNvbnN0IGJvdFBvc2l0aW9uID0gZ2V0Qm90UG9zaXRpb24odGhhdC5ib3QsIHRoYXQuZGltZW5zaW9uKTsKCiAgICAvLyBGYWtlIHVzZXIgZHJvcHBpbmcgdGhlIHNlbGVjdGluZyB0aGUgYm90IHdpdGggdGhlIGFybS4KICAgIGFybUJvdC5vbkRyb3AoewogICAgICAgIGJvdDogYXJtQm90LAogICAgICAgIHRvOiB7CiAgICAgICAgICAgIGJvdDogdGhhdC5ib3QsCiAgICAgICAgICAgIHg6IGJvdFBvc2l0aW9uLngsCiAgICAgICAgICAgIHk6IGJvdFBvc2l0aW9uLnksCiAgICAgICAgICAgIHo6IGJvdFBvc2l0aW9uLnosCiAgICAgICAgICAgIGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24KICAgICAgICB9LAogICAgICAgIGZyb206IHsKICAgICAgICAgICAgeDogYm90UG9zaXRpb24ueCwKICAgICAgICAgICAgeTogYm90UG9zaXRpb24ueSwKICAgICAgICAgICAgejogYm90UG9zaXRpb24ueiwKICAgICAgICAgICAgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbgogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybjsKfScAiufc0A6b2QEFaW5wdXQCBACK59zQDviWAyjwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwCK59zQDpvZAQtwZXJzb25hbGl0eQIEAIrn3NAOn5cDKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAIrn3NAOm9kBDWFiUGVyc29uYWxpdHkCBACK59zQDsaXAwR0cnVlJwCK59zQDpvZAQphYlNldEF3YWtlAgQAiufc0A7LlwOTEEBsZXQgYXdha2UgPSB0aGF0Py5hd2FrZTsKbGV0IGluaXRpYWwgPSB0aGF0Py5pbml0aWFsID8/IGZhbHNlOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKYXNzZXJ0KHR5cGVvZiBhd2FrZSA9PT0gJ2Jvb2xlYW4nLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGF3YWtlIGlzIGEgcmVxdWlyZWQgYm9vbGVhbiBwYXJhbWV0ZXIuYCk7CgppZiAoY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIC8vIElmIGFiU3RheUF3YWtlIGlzIGVuYWJsZWQsIG92ZXJyaWRlIHRoZSBpbmNvbWluZyBhd2FrZSBwYXJhbWV0ZXIgYW5kIG5ldmVyIGxldCBhYiBiZSBwdXQgdG8gc2xlZXAuCiAgICBhd2FrZSA9IHRydWU7Cn0KCmlmICh0YWdzLmFiQXdha2UgIT09IGF3YWtlKSB7CiAgICBpZiAoaW5pdGlhbCkgewogICAgICAgIGlmIChjb25maWdCb3QudGFncy5wYXR0ZXJuKSB7CiAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gY29uZmlnQm90LnRhZ3MucGF0dGVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA9IHV1aWQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gUGxheSBpbml0aWFsIGFuaW1hdGlvbiBpZiBvbmUgaXMgZGVmaW5lZCBvbiBhYkNvbmZpZy4KICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxBbmltYXRpb24pIHsKICAgICAgICAgICAgYXdhaXQgbGlua3MuYW5pbWF0aW9uW2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsQW5pbWF0aW9uXSgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBTaG93IGluaXRpYWwgbWVzc2FnZSBpZiBvbmUgaXMgZGVmaW5lZCBvbiBhYkNvbmZpZy4KICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxNZXNzYWdlKSB7CiAgICAgICAgICAgIHNob3V0KCJzaG93Q29uc29sZSIpOwoKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxNZXNzYWdlKSkgewogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2UubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBhYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2VbaV0pOwoKICAgICAgICAgICAgICAgICAgICBhd2FpdCBvcy5zbGVlcCgyMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gVXBkYXRlIGFiQXdha2Ugc2hhcmVkIHRhZyBtYXNrLgogICAgc2V0VGFnTWFzayh0aGlzQm90LCAnYWJBd2FrZScsIGF3YWtlLCAnc2hhcmVkJyk7CiAgICAKICAgIGlmIChhd2FrZSkgewogICAgICAgIGxldCBkaW1lbnNpb24gPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwoKICAgICAgICBpZiAoIWRpbWVuc2lvbikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBhd2FpdCB0aGlzQm90LmFiTWFuaWZlc3RCb3QoeyBkaW1lbnNpb24sIHBvc2l0aW9uOiB7IHg6IDAsIHk6IDAgfSB9KTsKCiAgICAgICAgc2hvdXQoIm9uQUJBd2FrZSIsIHsgZGltZW5zaW9uLCBwb3NpdGlvbjogeyB4OiAwLCB5OiAwIH0gfSk7CiAgICB9IGVsc2UgewogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwogICAgICAgIHNob3V0KCJvbkFCU2xlZXAiKTsKICAgIH0KfScAiufc0A6b2QEFdXRpbHMCBACK59zQDt+nAyjwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwCK59zQDpvZAQtib3RfZmFjdG9yeQIEAIrn3NAOhqgDKPCflJdjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcnAIrn3NAOm9kBD29uQUJJbml0aWFsaXplZAIEAIrn3NAOragDfkBpZiAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsKSB7DQogICAgdGhpc0JvdC5vblBvcnRhbENoYW5nZWQoe3BvcnRhbDogIm1hcFBvcnRhbCIsIGRpbWVuc2lvbjogY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsIH0pOw0KfScAiufc0A6b2QEFZGVidWcCBACK59zQDqypAwVmYWxzZScAiufc0A6b2QEaZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24CBACK59zQDrKpA6kLQGFzeW5jIGZ1bmN0aW9uIGdldERlZmF1bHRNYW5pZmVzdFBvc2l0aW9uKHBvcnRhbDogJ21hcCcgfCAnZ3JpZCcpOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH0gewogICAgaWYgKHBvcnRhbCA9PT0gJ2dyaWQnKSB7CiAgICAgICAgcmV0dXJuIHsgeDogMCwgeTogMCB9CiAgICB9IGVsc2UgaWYgKHBvcnRhbCA9PT0gJ21hcCcpIHsKICAgICAgICBpZiAodHlwZW9mIGxpbmtzLnJlbWVtYmVyLnRhZ3MubWFwWm9vbVBvc2l0aW9uPy54ID09PSAnbnVtYmVyJyAmJiAgdHlwZW9mIGxpbmtzLnJlbWVtYmVyLnRhZ3MubWFwWm9vbVBvc2l0aW9uPy55ID09PSAnbnVtYmVyJykgewogICAgICAgICAgICByZXR1cm4gbGlua3MucmVtZW1iZXIudGFncy5tYXBab29tUG9zaXRpb247CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGV0IGN1cnJlbnRQb3NpdGlvbiA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgbGV0IGhhc0dlb2xvY2F0aW9uUGVybWlzc2lvbiA9IGF3YWl0IGxpbmtzLnV0aWxzLmhhc0dlb2xvY2F0aW9uUGVybWlzc2lvbigpOwoKICAgICAgICAgICAgLy8gQ3VycmVudCB3b3JrLWFyb3VuZCBmb3IgYWxsb3dpbmcgZ2VvbG9jYXRpb24gZm9yIGlPUyBhcHAKICAgICAgICAgICAgaWYgKGdldEJvdCgic3lzdGVtIiwgImFiLmlvc2JyaWRnZS5tZXNzZW5nZXIiKSkgewogICAgICAgICAgICAgICAgaGFzR2VvbG9jYXRpb25QZXJtaXNzaW9uID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGhhc0dlb2xvY2F0aW9uUGVybWlzc2lvbikgewogICAgICAgICAgICAgICAgY29uc3QgZ2VvbG9jYXRpb24gPSBhd2FpdCBvcy5nZXRHZW9sb2NhdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKGdlb2xvY2F0aW9uLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UG9zaXRpb24gPSB7IHg6IGdlb2xvY2F0aW9uLmxvbmdpdHVkZSwgeTogZ2VvbG9jYXRpb24ubGF0aXR1ZGUgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY3VycmVudFBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFBvc2l0aW9uOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gR1JQTSBQb3NpdGlvbgogICAgICAgICAgICAgICAgcmV0dXJuIHsgeDogLTg1LjY3NjE4OTQ4MjI0MzQsIHk6IDQyLjk2NTY3NTY3NTY3NTYgfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHVucmVjb25naXplZCBwb3J0YWwgdHlwZSBwcm92aWRlZCB0byBnZXREZWZhdWx0TWFuaWZlc3RQb3NpdGlvbjpgLCBwb3J0YWwpOwogICAgICAgIHJldHVybiB7IHg6IDAsIHk6IDAgfQogICAgfQp9CgpyZXR1cm4gZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24odGhhdCk7JwCK59zQDpvZARJnZXRTdGFydENhbWVyYVpvb20CBACK59zQDty0A5AEQGFzeW5jIGZ1bmN0aW9uIGdldFN0YXJ0Q2FtZXJhWm9vbShwb3J0YWw6ICdtYXAnIHwgJ2dyaWQnKTogbnVtYmVyIHwgbnVsbCB7CiAgICBpZiAocG9ydGFsID09PSAnZ3JpZCcpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0gZWxzZSBpZiAocG9ydGFsID09PSAnbWFwJykgewogICAgICAgIGlmICh0eXBlb2YgbGlua3MucmVtZW1iZXIudGFncy5tYXBTdGFydFpvb20gPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgIHJldHVybiBsaW5rcy5yZW1lbWJlci50YWdzLm1hcFN0YXJ0Wm9vbTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB1bnJlY29uZ2l6ZWQgcG9ydGFsIHR5cGUgcHJvdmlkZWQgdG8gZ2V0U3RhcnRDYW1lcmFab29tOmAsIHBvcnRhbCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cn0KCnJldHVybiBnZXRTdGFydENhbWVyYVpvb20odGhhdCk7JwCK59zQDpvZARRkZWZhdWx0TWFwUG9ydGFsWm9vbQIEAIrn3NAO7bgDBDIwMDAnAIrn3NAOm9kBEG9uQUJCZWZvcmVVcGRhdGUCBACK59zQDvK4AzZAY29uZmlnQm90LnRhZ3MuYWJXYXNBd2FrZUJlZm9yZVVwZGF0ZSA9IHRhZ3MuYWJBd2FrZTsnAIrn3NAOm9kBC29uQUJVcGRhdGVkAgQAiufc0A6puQOPAUBpZiAoY29uZmlnQm90LnRhZ3MuYWJXYXNBd2FrZUJlZm9yZVVwZGF0ZSkgewogICAgY29uZmlnQm90LnRhZ3MuYWJXYXNBd2FrZUJlZm9yZVVwZGF0ZSA9IG51bGw7CiAgICBhd2FpdCB0aGlzQm90LmFiU2V0QXdha2UoeyBhd2FrZTogdHJ1ZSB9KQp9AA=="}]}