{"version":2,"updates":[{"id":0,"timestamp":1770749760908,"update":"Ac4Bl/W47goAJwEEYm90cyQxNjU1NGJjMS1lOTNlLTRhMGItOGNkMy1kZmQ3NzIzMTk2NzIBJwCX9bjuCgAJYWJWZXJzaW9uAgQAl/W47goBBTEwLjM4JwCX9bjuCgAGc3lzdGVtAgQAl/W47goHFmFiLnBlcnNvbmFsaXR5LnZlcnNpb24nAJf1uO4KABlhYlBlcnNvbmFsaXR5TWFqb3JWZXJzaW9uAgQAl/W47goeATInAJf1uO4KAA1vblNraWxsVXBkYXRlAgQAl/W47gogrQFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJQZXJzb25hbGl0eU1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJQZXJzb25hbGl0eU1pbm9yVmVyc2lvbjsKCmNvbnNvbGUubG9nKCJbQUJQZXJzb25hbGl0eV0gTG9hZGVkIEFCIFBlcnNvbmFsaXR5IHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAl/W47goADWFiUGVyc29uYWxpdHkCBACX9bjuCs4BBHRydWUnAJf1uO4KAAhhYklnbm9yZQIEAJf1uO4K0wEEdHJ1ZScAl/W47goABGZvcm0CBACX9bjuCtgBB25vdGhpbmcnAJf1uO4KABlhYlBlcnNvbmFsaXR5TWlub3JWZXJzaW9uAgQAl/W47grgAQIxMycBBGJvdHMkM2M3NGM5ZjEtODJkYy00NjU1LThiMzgtZTdmMTFkZTg5NzhlAScAl/W47grjAQZzeXN0ZW0CBACX9bjuCuQBF2FiLnBlcnNvbmFsaXR5LmFybV90b29sJwCX9bjuCuMBDG9uQW55Qm90RHJhZwIEAJf1uO4K/AGNCEBjb25zdCBkcmFnQm90ID0gdGhhdC5ib3Q7CmNvbnN0IGRpbWVuc2lvbiA9IHRoYXQuZnJvbS5kaW1lbnNpb247CgppZiAoZHJhZ0JvdC50YWdzLmFybVNlbGVjdGlvbikgewogICAgaWYgKGRyYWdCb3QubWFza3MuYXJtQm90KSB7CiAgICAgICAgaWYgKGRyYWdCb3QubGlua3MuYXJtQm90LnRhZ3MubXVsdGlTZWxlY3QgJiYgZHJhZ0JvdC5saW5rcy5hcm1TZWxlY3RlZEJvdHMgJiYgZHJhZ0JvdC50YWdzLmFybUdyb3VwRHJhZykgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBlbmFibGUgY3VzdG9tIGRyYWdnaW5nYCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9zLmVuYWJsZUN1c3RvbURyYWdnaW5nKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkZXN0cm95IHByZXZpb3VzIGFybUJvdDogJHtkcmFnQm90Lm1hc2tzLmFybUJvdH1gKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGVzdHJveShkcmFnQm90LmxpbmtzLmFybUJvdCk7CiAgICAgICAgICAgIGRyYWdCb3QubWFza3MuYXJtQm90ID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgbXVsdGlTZWxlY3RLZXlIZWxkID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTsKICAgIGNvbnN0IG11bHRpU2VsZWN0QWxsb3dlZCA9IGRyYWdCb3QudGFncy5hcm1NdWx0aVNlbGVjdCA/PyB0cnVlOwoKICAgIGNvbnN0IGFybUJvdCA9IHRoaXNCb3QuYWJDcmVhdGVBcm0oewogICAgICAgIG9yaWdpbkJvdDogZHJhZ0JvdCwKICAgICAgICBkaW1lbnNpb24sCiAgICAgICAgbXVsdGlTZWxlY3Q6IG11bHRpU2VsZWN0S2V5SGVsZCAmJiBtdWx0aVNlbGVjdEFsbG93ZWQsCiAgICB9KQoKICAgIG9zLnJlcGxhY2VEcmFnQm90KGFybUJvdCk7Cn0KJwCX9bjuCuMBBWRlYnVnAgQAl/W47gqKCgVmYWxzZScAl/W47grjAQlsaXN0ZW5pbmcCBACX9bjuCpAKBHRydWUnAJf1uO4K4wELYWJDcmVhdGVBcm0CBACX9bjuCpUK2ktAY29uc3Qgb3JpZ2luQm90ID0gdGhhdC5vcmlnaW5Cb3Q7CmFzc2VydChhYi5saW5rcy51dGlscy5pc0JvdChvcmlnaW5Cb3QpLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG9yaWdpbkJvdCBpcyBhIHJlcXVpcmVkIEJvdCBwYXJhbWV0ZXIuYCk7Cgpjb25zdCBkaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKYXNzZXJ0KHR5cGVvZiBkaW1lbnNpb24gPT09ICdzdHJpbmcnLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRpbWVuc2lvbiBpcyBhIHJlcXVpcmVkIHN0cmluZyBwYXJhbWV0ZXIuYCk7Cgpjb25zdCBwb3NpdGlvbiA9IHRoYXQucG9zaXRpb24gPz8gZ2V0Qm90UG9zaXRpb24ob3JpZ2luQm90LCBkaW1lbnNpb24pOwpjb25zdCBtdWx0aVNlbGVjdCA9IHRoYXQubXVsdGlTZWxlY3QgPz8gZmFsc2U7CmNvbnN0IGFybUNvbG9yID0gdGhhdC5hcm1Db2xvciA/PyBvcmlnaW5Cb3QudGFncy5hcm1Db2xvciA/PyBvcmlnaW5Cb3QudGFncy5zdHJva2VDb2xvciA/PyBvcmlnaW5Cb3QudGFncy5jb2xvcjsKY29uc3QgYXJtTWVzaFBhdGggPSB0aGF0LmFybU1lc2hQYXRoID8/IG9yaWdpbkJvdC50YWdzLmFybU1lc2hQYXRoOwpjb25zdCBhcm1Ecm9wU291bmQgPSB0aGF0LmFybURyb3BTb3VuZCA/PyBvcmlnaW5Cb3QudGFncy5hcm1Ecm9wU291bmQ7Cgpjb25zdCBhcm0gPSB7CiAgICBzcGFjZTogJ3RlbXBMb2NhbCcsCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIFtkaW1lbnNpb24gKyAnWCddOiBwb3NpdGlvbi54LAogICAgW2RpbWVuc2lvbiArICdZJ106IHBvc2l0aW9uLnksCiAgICBbZGltZW5zaW9uICsgJ1onXTogcG9zaXRpb24ueiwKICAgIGNyZWF0b3I6IG9yaWdpbkJvdC5pZCwKICAgIGlzQXJtQm90OiB0cnVlLAogICAgcG9pbnRhYmxlOiB0cnVlLAogICAgbXVsdGlTZWxlY3QsCiAgICBkZWJ1ZzogdGFncy5kZWJ1ZywKICAgIG9yaWdpbkJvdDogZ2V0TGluayhvcmlnaW5Cb3QpLAogICAgZGltZW5zaW9uLAogICAgYXJtQ29sb3IsCiAgICBhcm1NZXNoUGF0aCwKICAgIGFybURyb3BTb3VuZCwKICAgIGRlZmF1bHRBcm1Ecm9wU291bmQ6IHRhZ3MuZGVmYXVsdEFybURyb3BTb3VuZCwKICAgIGxpbmVDb2xvcjogYXJtQ29sb3IsCiAgICBsaW5lVG86IG9yaWdpbkJvdC5pZCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjcmVhdGVkIGFybUJvdCAke3RoaXNCb3QuaWR9YCk7CiAgICAgICAgfQogICAgICAgIC8vIERlc3Ryb3kgcHJldmlvdXMgYXJtIGlmIGl0IGlzIHN0aWxsIGFyb3VuZC4KICAgICAgICBpZiAobGlua3Mub3JpZ2luQm90Lm1hc2tzLmFybUJvdCkgewogICAgICAgICAgICBkZXN0cm95KGxpbmtzLm9yaWdpbkJvdC5saW5rcy5hcm1Cb3QpOwogICAgICAgIH0KCiAgICAgICAgdGFncy5zeXN0ZW0gPSBgYXJtLiR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9YDsKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MuYXJtQm90ID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MuZHJhZ2dhYmxlID0gdGFncy5tdWx0aVNlbGVjdDsKCiAgICAgICAgaWYgKHRhZ3MuYXJtTWVzaFBhdGggJiYgIXRhZ3MubXVsdGlTZWxlY3QpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuYXJtTWVzaFBhdGguc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3MuYXJtTWVzaFBhdGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYWIuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwodGFncy5hcm1NZXNoUGF0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRhZ3MuZm9ybSA9ICdtZXNoJzsKICAgICAgICAgICAgdGFncy5mb3JtU3VidHlwZSA9ICdnbHRmJzsKICAgICAgICAgICAgdGFncy5hbmNob3JQb2ludCA9ICdjZW50ZXInOwogICAgICAgICAgICB0YWdzLmNvbG9yID0gdGFncy5hcm1Db2xvcjsKICAgICAgICAgICAgdGFncy5zY2FsZSA9IDAuOTk5OTsgLy8gVGhlcmUgaXMgYSByZWFsbHkgc3RyYW5nZSBidWcgdGhhdCBpZiB0aGlzIGlzIGxlZnQgdW5kZWZpbmVkIG9yIHNldCB0byAxIGV4YWN0bHksIHRoZSBhcm0gd2lsbCBzb21ldGltZXMgZGlzYXBwZWFyLgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3Muc3Ryb2tlQ29sb3IgPSB0YWdzLmFybUNvbG9yOwogICAgICAgICAgICB0YWdzLmZvcm0gPSAnY3ViZSc7CiAgICAgICAgICAgIHRhZ3MuY29sb3IgPSAnY2xlYXInOwogICAgICAgICAgICB0YWdzLnNjYWxlID0gMC45OwogICAgICAgICAgICB0YWdzLnNjYWxlWiA9IDAuMDE7CgogICAgICAgICAgICBpZiAodGFncy5tdWx0aVNlbGVjdCkgewogICAgICAgICAgICAgICAgdGFncy5mb3JtID0gJ3NwaGVyZSc7CiAgICAgICAgICAgICAgICB0YWdzLmNvbG9yID0gdGFncy5hcm1Db2xvcjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gTWFrZSB0aGUgb3JpZ2luIGJvdCB1bnNlbGVjdGFibGUgZm9yIDEvNCBvZiBhIHNlY29uZC4KICAgICAgICAvLyBUaGlzIGhlbHBzIHByZXZlbnQgdW5pbnRlbnRpb25hbCBzZWxmLXNlbGVjdGlvbiBvZiB0aGUgb3JpZ2luIGJvdC4KICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MucG9pbnRhYmxlID0gZmFsc2U7CiAgICAgICAgb3Muc2xlZXAoMjUwKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLnBvaW50YWJsZSA9IG51bGw7CiAgICAgICAgfSkKCiAgICAgICAgdGhpc0JvdC5vcmlnaW5DbGVhclNlbGVjdGlvbigpOwoKICAgICAgICB3aGlzcGVyKGxpbmtzLm9yaWdpbkJvdCwgJ29uQXJtQ3JlYXRlJyk7CiAgICB9KSwKICAgIHNldEFybVZpc2libGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsZXQgdmlzaWJsZSA9IHRoYXQ7CgogICAgICAgIGlmICh2aXNpYmxlKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmFybU1lc2hQYXRoKSB7CiAgICAgICAgICAgICAgICBtYXNrcy5mb3JtT3BhY2l0eSA9IG51bGw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXNrcy5zdHJva2VDb2xvciA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1hc2tzLmxpbmVDb2xvciA9IG51bGw7CiAgICAgICAgICAgIG1hc2tzLmxpbmVUbyA9IGxpbmtzLm9yaWdpbkJvdC5pZDsgCiAgICAgICAgICAgIG1hc2tzLnBvaW50YWJsZSA9IG51bGw7CgogICAgICAgICAgICBpZiAodGFncy5tdWx0aVNlbGVjdCkgewogICAgICAgICAgICAgICAgbWFza3MuY29sb3IgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHRhZ3MuYXJtTWVzaFBhdGgpIHsKICAgICAgICAgICAgICAgIG1hc2tzLmZvcm1PcGFjaXR5ID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1hc2tzLnN0cm9rZUNvbG9yID0gJ2NsZWFyJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWFza3MubGluZUNvbG9yID0gJ2NsZWFyJzsKICAgICAgICAgICAgbWFza3MubGluZVRvID0gZmFsc2U7CiAgICAgICAgICAgIG1hc2tzLnBvaW50YWJsZSA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHRhZ3MubXVsdGlTZWxlY3QpIHsKICAgICAgICAgICAgICAgIG1hc2tzLmNvbG9yID0gJ2NsZWFyJzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbnN0IHsgZGltZW5zaW9uIH0gPSB0aGF0OwoKICAgICAgICBpZiAobGlua3Mub3JpZ2luQm90Py50YWdzLmFybVRlbGVwb3J0ID8/IHRydWUpIHsKICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90LnRhZ3NbZGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC50YWdzW2RpbWVuc2lvbiArICdYJ10gPSB0YWdzW2RpbWVuc2lvbiArICdYJ107CiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC50YWdzW2RpbWVuc2lvbiArICdZJ10gPSB0YWdzW2RpbWVuc2lvbiArICdZJ107CiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC50YWdzW2RpbWVuc2lvbiArICdaJ10gPSB0YWdzW2RpbWVuc2lvbiArICdaJ107CiAgICAgICAgfQoKICAgICAgICB3aGlzcGVyKGxpbmtzLm9yaWdpbkJvdCwgJ29uQXJtQ2xpY2snLCB7IGRpbWVuc2lvbiB9KTsKCiAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgIH0pLAogICAgb25Ecm9wRW50ZXI6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5kcmFnQm90ICE9PSB0aGlzQm90KSByZXR1cm47CiAgICAgICAgaWYgKCFsaW5rcy5vcmlnaW5Cb3QpIHJldHVybjsKCiAgICAgICAgY29uc3QgZHJvcEJvdCA9IHRoYXQudG8uYm90OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MubGluZUNvbG9yID0gdGFncy5hcm1Db2xvcjsKCiAgICAgICAgaWYgKHRhZ3MubXVsdGlTZWxlY3QpIHsKICAgICAgICAgICAgbGV0IGxpbmVUb0JvdHMgPSBsaW5rcy5vcmlnaW5Cb3QubGlua3MubGluZVRvOwoKICAgICAgICAgICAgaWYgKGxpbmVUb0JvdHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVUbyA9IGdldExpbmsoZHJvcEJvdCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsaW5lVG9Cb3RzID0gQXJyYXkuaXNBcnJheShsaW5lVG9Cb3RzKSA/IGxpbmVUb0JvdHMgOiBbbGluZVRvQm90c107CgogICAgICAgICAgICAgICAgaWYgKCFsaW5lVG9Cb3RzLmluY2x1ZGVzKGRyb3BCb3QpKSB7CiAgICAgICAgICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVUbyA9IGdldExpbmsoLi4ubGluZVRvQm90cywgZHJvcEJvdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzQm90LnNldEFybVZpc2libGUoZmFsc2UpOwoKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaGlkZSBhcm1gKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVUbyA9IGRyb3BCb3QuaWQ7CgogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzaG93IHNlbGVjdGlvbiBvbiBvcmlnaW4gYm90LmApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkRyb3BFeGl0OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQuZHJhZ0JvdCAhPT0gdGhpc0JvdCkgcmV0dXJuOwogICAgICAgIGlmICghbGlua3Mub3JpZ2luQm90KSByZXR1cm47CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGRyb3BCb3QgPSB0aGF0LnRvLmJvdDsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcm9wQm90OmAsIGRyb3BCb3QpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0YWdzLm11bHRpU2VsZWN0KSB7CiAgICAgICAgICAgIHRoaXNCb3Quc2V0QXJtVmlzaWJsZSh0cnVlKTsKCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNob3cgYXJtYCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5saW5lVG8gPSBudWxsOwoKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2hvdyBzZWxlY3Rpb24gb24gb3JpZ2luIGJvdC5gKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25Ecm9wOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQuYm90ICE9PSB0aGlzQm90KSByZXR1cm47CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgZHJvcEJvdCA9IHRoYXQudG8uYm90OwoKICAgICAgICBhYi5saW5rcy5zb3VuZC5hYlBsYXlTb3VuZCh7IHZhbHVlOiB0YWdzLmFybURyb3BTb3VuZCwgZGVmYXVsdFZhbHVlOiB0YWdzLmRlZmF1bHRBcm1Ecm9wU291bmQgfSk7CiAgICAgICAgCiAgICAgICAgaWYgKHRhZ3MubXVsdGlTZWxlY3QgJiYgbGlua3Mub3JpZ2luQm90LmxpbmtzLmxpbmVUbykgewogICAgICAgICAgICB0aGlzQm90LnNldEFybVZpc2libGUoZmFsc2UpOwogICAgICAgICAgICB0aGlzQm90Lm9yaWdpblNldFNlbGVjdGlvbihsaW5rcy5vcmlnaW5Cb3QubGlua3MubGluZVRvKTsKICAgICAgICB9IGVsc2UgaWYgKGRyb3BCb3QpIHsKICAgICAgICAgICAgdGhpc0JvdC5zZXRBcm1WaXNpYmxlKGZhbHNlKTsKICAgICAgICAgICAgdGhpc0JvdC5vcmlnaW5TZXRTZWxlY3Rpb24oZHJvcEJvdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gRHJvcHBlZCBvbiBncmlkLgogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcm9wcGVkIG9uIGdyaWQuYCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdoaXNwZXIobGlua3Mub3JpZ2luQm90LCAnb25Bcm1QbGFjZWQnLCB7IGRpbWVuc2lvbjogdGhhdC50by5kaW1lbnNpb24sIHg6IHRoYXQudG8ueCwgeTogdGhhdC50by55LCB6OiB0aGF0LnRvLnogfSk7CiAgICAgICAgfQogICAgICAgIAogICAgfSksCiAgICBvbkdyaWRDbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIHRoaXNCb3Qub3JpZ2luQ2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgfSksCiAgICBvcmlnaW5DbGVhclNlbGVjdGlvbjogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmFybVNlbGVjdGVkQm90cyA9IG51bGw7CiAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVDb2xvciA9IG51bGw7CiAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVUbyA9IG51bGw7CiAgICB9KSwKICAgIG9yaWdpblNldFNlbGVjdGlvbjogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbnN0IHNlbGVjdGVkQm90cyA9IHRoYXQ7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKICAgICAgICB9CgogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5hcm1TZWxlY3RlZEJvdHMgPSBzZWxlY3RlZEJvdHMgPyBnZXRMaW5rKHNlbGVjdGVkQm90cykgOiBudWxsOwogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5saW5lQ29sb3IgPSB0YWdzLmFybUNvbG9yOwogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5saW5lVG8gPSBsaW5rcy5vcmlnaW5Cb3QudGFncy5hcm1TZWxlY3RlZEJvdHM7CiAgICAgICAgCiAgICAgICAgaWYgKGxpbmtzLm9yaWdpbkJvdC5saW5rcy5hcm1TZWxlY3RlZEJvdHMpIHsKICAgICAgICAgICAgd2hpc3BlcihsaW5rcy5vcmlnaW5Cb3QsICdvbkFybVNlbGVjdGVkQm90cycsIGxpbmtzLm9yaWdpbkJvdC5saW5rcy5hcm1TZWxlY3RlZEJvdHMpCiAgICAgICAgfQogICAgfSksCiAgICBvbkFueUJvdHNSZW1vdmVkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5hcm1TZWxlY3RlZEJvdHMpIHsKICAgICAgICAgICAgLy8gQ2hlY2sgdGhhdCB3ZSBzdGlsbCBoYXZlIHNvbWUgYWN0aXZlIHNlbGVjdGVkIGJvdHMuCiAgICAgICAgICAgIGxldCBhY3RpdmVTZWxlY3RlZEJvdHMgPSBmYWxzZTsKCiAgICAgICAgICAgIGNvbnN0IGFybVNlbGVjdGVkQm90cyA9IGxpbmtzLm9yaWdpbkJvdC5saW5rcy5hcm1TZWxlY3RlZEJvdHM7CgogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhcm1TZWxlY3RlZEJvdHMpKSB7CiAgICAgICAgICAgICAgICBhY3RpdmVTZWxlY3RlZEJvdHMgPSBhcm1TZWxlY3RlZEJvdHMuZXZlcnkoYiA9PiAhIWIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWN0aXZlU2VsZWN0ZWRCb3RzID0gISFhcm1TZWxlY3RlZEJvdHM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghYWN0aXZlU2VsZWN0ZWRCb3RzKSB7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgYm90cyB3ZSBoYWQgc2VsZWN0ZWQgbm8gbG9uZ2VyIGV4aXN0LCBkZXN0cm95IHRoaXMgYXJtLgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGJvdHMgdGhhdCBhcm0gaGFzIHNlbGVjdGVkIG5vIGxvbmdlciBleGlzdCwgZGVzdHJveSB0aGlzIGFybS5gKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzQm90Lm9yaWdpbkNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGJvdHMgdGhhdCBhcm0gaGFzIHNlbGVjdGVkIHN0aWxsIGhhcyBhY3RpdmUgYm90cy5gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmFybUJvdCA9IG51bGw7CiAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmRyYWdnYWJsZSA9IG51bGw7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKICAgICAgICB9CgogICAgICAgIHdoaXNwZXIobGlua3Mub3JpZ2luQm90LCAnb25Bcm1EZXN0cm95Jyk7CiAgICB9KSwKfTsKCmNvbnN0IGFybUJvdCA9IGNyZWF0ZShhcm0pOwoKcmV0dXJuIGFybUJvdDsnAJf1uO4K4wEQb25BbnlCb3REcmFnZ2luZwIEAJf1uO4K8FXRFUBjb25zdCBkcmFnQm90ID0gdGhhdC5ib3Q7CmNvbnN0IGRpbWVuc2lvbiA9IHRoYXQuZnJvbS5kaW1lbnNpb247CgppZiAoZHJhZ0JvdC5saW5rcy5hcm1Cb3QpIHsKICAgIGlmIChkcmFnQm90LnRhZ3MuYXJtR3JvdXBEcmFnICYmIGRyYWdCb3QubGlua3MuYXJtU2VsZWN0ZWRCb3RzKSB7CiAgICAgICAgbGV0IGRyYWdDb29yZGluYXRvckJvdCA9IGxpbmtzLmRyYWdDb29yZGluYXRvckJvdDsKICAgICAgICAKICAgICAgICBpZiAoIWRyYWdDb29yZGluYXRvckJvdCkgewogICAgICAgICAgICBjb25zdCBkcmFnQ29vcmRpbmF0b3JNb2QgPSB7CiAgICAgICAgICAgICAgICBzcGFjZTogInRlbXBMb2NhbCIsCiAgICAgICAgICAgICAgICBtYW5hZ2VyOiBnZXRMaW5rKHRoaXNCb3QpLAogICAgICAgICAgICAgICAgZGltZW5zaW9uOiBkaW1lbnNpb24sCiAgICAgICAgICAgICAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgICAgICAgICAgICAgIFtkaW1lbnNpb24gKyAiWCJdOiAwLAogICAgICAgICAgICAgICAgW2RpbWVuc2lvbiArICJZIl06IDAsCiAgICAgICAgICAgICAgICBbZGltZW5zaW9uICsgIloiXTogLTEsCiAgICAgICAgICAgICAgICBwb2ludGFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZGVidWc6IHRhZ3MuZGVidWcsCiAgICAgICAgICAgICAgICBjb2xvcjogImNsZWFyIiwKICAgICAgICAgICAgICAgIHN5c3RlbTogYGFybUdyb3VwRHJhZy4ke3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfS5jb29yZGluYXRvcmAsCiAgICAgICAgICAgICAgICBvbkFueUJvdFBvaW50ZXJVcDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGVzdHJveWluZyBkcmFnIGNvb3JkaW5hdG9yYCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBsaW5rcy5tYW5hZ2VyLm1hc2tzLmRyYWdDb29yZGluYXRvckJvdCA9IG51bGw7IAogICAgICAgICAgICAgICAgICAgIHNob3V0KCdvbkFybVN0b3BHcm91cERyYWcnLCB7IHg6IHRhZ3NbdGFncy5kaW1lbnNpb24gKyAnWCddLCB5OiB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1knXSB9KTsKICAgICAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3QgPSBjcmVhdGUoZHJhZ0Nvb3JkaW5hdG9yTW9kKTsKCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNyZWF0ZWQgZHJhZyBjb29yZGluYXRvciBib3Q6YCwgZHJhZ0Nvb3JkaW5hdG9yQm90KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWFza3MuZHJhZ0Nvb3JkaW5hdG9yQm90ID0gZ2V0TGluayhkcmFnQ29vcmRpbmF0b3JCb3QpOwoKICAgICAgICAgICAgY29uc3QgYXJtU2VsZWN0ZWRCb3RzID0gZHJhZ0JvdC5saW5rcy5hcm1TZWxlY3RlZEJvdHM7CiAgICAgICAgICAgIGNvbnN0IG9uQXJtU3RvcEdyb3VwRHJhZyA9IGBACiAgICAgICAgICAgICAgICBtYXNrcy50cmFuc2Zvcm1lciA9IG51bGw7CiAgICAgICAgICAgICAgICBtYXNrcy5vbkFybVN0b3BHcm91cERyYWcgPSBudWxsOwogICAgICAgICAgICAgICAgdGFncy4ke2RpbWVuc2lvbn1YID0gdGFncy4ke2RpbWVuc2lvbn1YICsgdGhhdC54OwogICAgICAgICAgICAgICAgdGFncy4ke2RpbWVuc2lvbn1ZID0gdGFncy4ke2RpbWVuc2lvbn1ZICsgdGhhdC55OwogICAgICAgICAgICBgCgogICAgICAgICAgICBkcmFnQm90Lm1hc2tzLnRyYW5zZm9ybWVyID0gZHJhZ0Nvb3JkaW5hdG9yQm90LmlkOwogICAgICAgICAgICBkcmFnQm90Lm1hc2tzLm9uQXJtU3RvcEdyb3VwRHJhZyA9IG9uQXJtU3RvcEdyb3VwRHJhZzsKCiAgICAgICAgICAgIHNldFRhZ01hc2soYXJtU2VsZWN0ZWRCb3RzLCAidHJhbnNmb3JtZXIiLCBkcmFnQ29vcmRpbmF0b3JCb3QuaWQsICJ0ZW1wTG9jYWwiKTsKICAgICAgICAgICAgc2V0VGFnTWFzayhhcm1TZWxlY3RlZEJvdHMsICJvbkFybVN0b3BHcm91cERyYWciLCBvbkFybVN0b3BHcm91cERyYWcsICJ0ZW1wTG9jYWwiKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHhDaGFuZ2UgPSB0aGF0LnRvLnggLSB0aGF0LmZyb20ueDsKICAgICAgICBjb25zdCB5Q2hhbmdlID0gdGhhdC50by55IC0gdGhhdC5mcm9tLnk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0geENoYW5nZTogJHt4Q2hhbmdlfSwgeUNoYW5nZTogJHt5Q2hhbmdlfWApOwogICAgICAgIH0KCiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90LnRhZ3NbZGltZW5zaW9uICsgIlgiXSA9IHhDaGFuZ2U7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90LnRhZ3NbZGltZW5zaW9uICsgIlkiXSA9IHlDaGFuZ2U7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90LnRhZ3NbZGltZW5zaW9uICsgIloiXSA9IC0xOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRyYWcgYm90IHdpdGggYXJtIGRvZXMgbm90IHF1YWxpZnkgZm9yIGdyb3VwIGRyYWdnaW5nLmApOwogICAgICAgIH0KICAgIH0KfScAl/W47grjAQ1hYlBlcnNvbmFsaXR5AgQAl/W47grCawR0cnVlJwCX9bjuCuMBCGFiSWdub3JlAgQAl/W47grHawR0cnVlJwCX9bjuCuMBBGZvcm0CBACX9bjuCsxrB25vdGhpbmcnAJf1uO4K4wEJYWJWZXJzaW9uAgQAl/W47grUawUxMC4zOCcAl/W47grjARNkZWZhdWx0QXJtRHJvcFNvdW5kAgQAl/W47graaxlhYi9hdWRpby9zZWxlY3QgbGV2ZWwubXAzJwEEYm90cyRiMjZlMTA4OS0xNzJkLTQ1YTktOGQyMi0wNWMzZjU4YzJiZjcBJwCX9bjuCvRrBnN5c3RlbQIEAJf1uO4K9WsYYWIucGVyc29uYWxpdHkuYW5pbWF0aW9uJwCX9bjuCvRrBGZvcm0CBACX9bjuCo5sB25vdGhpbmcnAJf1uO4K9GsIYWJJZ25vcmUCBACX9bjuCpZsBHRydWUnAJf1uO4K9GsNbWFuaWZlc3RhdGlvbgIEAJf1uO4Km2wo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAl/W47gr0awhyZW1lbWJlcgIEAJf1uO4Kwmwo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAl/W47gr0axhhbmltYXRpb25fYWJHcmlkTWFuaWZlc3QCBACX9bjuCuls+g5Ac2hvdXQoInJlc2V0Iik7Cgpjb25zdCBwb3NpdGlvblggPSB0aGF0Py5wb3NpdGlvbi54ID8/IDA7CmNvbnN0IHBvc2l0aW9uWSA9IHRoYXQ/LnBvc2l0aW9uLnkgPz8gMDsKY29uc3QgZGltZW5zaW9uID0gdGhhdD8uZGltZW5zaW9uID8/ICJob21lIjsKY29uc3QgZ3JpZFNjYWxlID0gdGhhdD8uc2NhbGUgPz8gNTsKY29uc3QgbW9tZW50Q291bnQgPSAwOwpjb25zdCBncmlkQm90ID0ge307CgpncmlkQm90LnNwYWNlID0gInRlbXBMb2NhbCI7CmdyaWRCb3QuY29sb3IgPSAiY2xlYXIiOwpncmlkQm90LnN0cm9rZUNvbG9yID0gYWJQZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwpncmlkQm90LnNjYWxlID0gMC4wMDE7CmdyaWRCb3Quc2NhbGVaID0gMC4xOwpncmlkQm90LnJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpncmlkQm90W2RpbWVuc2lvbl0gPSB0cnVlOwpncmlkQm90LnBvaW50YWJsZSA9IGZhbHNlOwpncmlkQm90LmtpbGxUaW1lciA9ICJAIGF3YWl0IG9zLnNsZWVwKDQwMCk7IGRlc3Ryb3kodGhpc0JvdCk7IjsKCmxldCByb3VuZEJvdHM7Cgpmb3IgKGxldCBpID0gZ3JpZFNjYWxlOyBpID4gMDsgaS0tKQp7CiAgICBjb25zdCBib3RDb3VudCA9IGkgKiA4OwoKICAgIGxldCBzaWRlQ291bnQgPSAwOwogICAgbGV0IHBoYXNlRmFjdG9yID0gMDsKCiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJvdENvdW50OyBqKyspCiAgICB7CiAgICAgICAgaWYgKHBoYXNlRmFjdG9yID09IDApCiAgICAgICAgewogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJYIl0gPSAoKGkgKyBwb3NpdGlvblgpICogLTEpICsgc2lkZUNvdW50OwogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJZIl0gPSBpICsgcG9zaXRpb25ZOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChwaGFzZUZhY3RvciA9PSAxKQogICAgICAgIHsKICAgICAgICAgICAgZ3JpZEJvdFtkaW1lbnNpb24gKyAiWCJdID0gaSArIHBvc2l0aW9uWDsKICAgICAgICAgICAgZ3JpZEJvdFtkaW1lbnNpb24gKyAiWSJdID0gKGkgKyBwb3NpdGlvblkpIC0gc2lkZUNvdW50OyAgCiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBoYXNlRmFjdG9yID09IDIpCiAgICAgICAgewogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJYIl0gPSAoaSArIHBvc2l0aW9uWCkgLSBzaWRlQ291bnQ7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlkiXSA9ICgoaSArIHBvc2l0aW9uWSkgKiAtMSkgOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJYIl0gPSAoKGkgKyBwb3NpdGlvblgpICogLTEpIDsKICAgICAgICAgICAgZ3JpZEJvdFtkaW1lbnNpb24gKyAiWSJdID0gKChpICsgcG9zaXRpb25ZKSAqIC0xKSArIHNpZGVDb3VudDsgIAogICAgICAgIH0KCiAgICAgICAgY29uc3QgbmV3R3JpZEJvdCA9IGF3YWl0IGNyZWF0ZShncmlkQm90KTsKCiAgICAgICAgYW5pbWF0ZVRhZyhuZXdHcmlkQm90LCAic2NhbGUiLCB7CiAgICAgICAgICAgIHRvVmFsdWU6IDEsCiAgICAgICAgICAgIGVhc2luZzogewogICAgICAgICAgICAgICAgdHlwZTogImVsYXN0aWMiLAogICAgICAgICAgICAgICAgbW9kZTogIm91dCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHVyYXRpb246IDAuMDEKICAgICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7CgogICAgICAgIG5ld0dyaWRCb3Qua2lsbFRpbWVyKCk7CgogICAgICAgIHNpZGVDb3VudCsrOwoKICAgICAgICBpZiAoc2lkZUNvdW50ID09IGJvdENvdW50IC8gNCkKICAgICAgICB7CiAgICAgICAgICAgIHNpZGVDb3VudCA9IDA7CgogICAgICAgICAgICBwaGFzZUZhY3RvcisrOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgb3Muc2xlZXAoOCk7CiAgICB9Cn0nAJf1uO4K9GsJYWJWZXJzaW9uAgQAl/W47grkewUxMC4zOCcAl/W47gr0awZvbkNoYXQCBACX9bjuCup7VUAvLyBpZiAodGhhdC5tZXNzYWdlID09ICJAdGVzdCIpCi8vIHsKLy8gICAgIHRoaXNCb3QuYW5pbWF0aW9uX2FiR3JpZE1hbmlmZXN0KCk7Ci8vIH0nAJf1uO4K9GsLcGVyc29uYWxpdHkCBACX9bjuCsB8KPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAJf1uO4K9GsNYWJQZXJzb25hbGl0eQIEAJf1uO4K53wEdHJ1ZScBBGJvdHMkYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiAScAl/W47grsfAZzeXN0ZW0CBACX9bjuCu18FWFiLnBlcnNvbmFsaXR5LmNvbmZpZycAl/W47grsfAhhYklnbm9yZQIEAJf1uO4Kg30EdHJ1ZScAl/W47grsfARmb3JtAgQAl/W47gqIfQdub3RoaW5nJwCX9bjuCux8C2FiQmFzZUNvbG9yAgQAl/W47gqQfQcjMDBEOUNEJwCX9bjuCux8EWFiQmFzZVN0cm9rZUNvbG9yAgQAl/W47gqYfQcjMDBEOUNEJwCX9bjuCux8EGFiQmx1ZXByaW50Q29sb3ICBACX9bjuCqB9ByMwMDgyN0InAJf1uO4K7HwIcmVtZW1iZXICBACX9bjuCqh9KPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAJf1uO4K7HwRYWJCdWlsZGVySWRlbnRpdHkCBACX9bjuCs99CmNhc3VhbC5ib3QnAJf1uO4K7HwJYWJWZXJzaW9uAgQAl/W47grafQUxMC4zOCcAl/W47grsfBdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZwIEAJf1uO4K4H2sFUBpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICghYXV0aEJvdCkgew0KICAgIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7DQp9DQoNCmlmICghYXV0aEJvdCkgew0KICAgIHJldHVybjsNCn0NCg0KYXdhaXQgb3MuZ3JhbnRJbnN0QWRtaW5QZXJtaXNzaW9uKGF1dGhCb3QuaWQpOw0KDQpsZXQgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSBhd2FpdCBvcy5nZXREYXRhKGF1dGhCb3QuaWQsICJhYlBlcnNvbmFsaXR5Q29uZmlnIik7DQoNCmlmIChhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YS5zdWNjZXNzID09IGZhbHNlKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSB7fTsNCn0gZWxzZSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YS5kYXRhOw0KfQ0KDQppZiAodGhhdC5uYW1lKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQnVpbGRlcklkZW50aXR5Il0gPSB0aGF0Lm5hbWU7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCdWlsZGVySWRlbnRpdHkiLCB0aGF0Lm5hbWUsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5jb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VDb2xvciJdID0gdGhhdC5jb2xvcjsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCYXNlU3Ryb2tlQ29sb3IiXSA9IHRoYXQuY29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlQ29sb3IiLCB0aGF0LmNvbG9yLCAibG9jYWwiKTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VTdHJva2VDb2xvciIsIHRoYXQuY29sb3IsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5wb3J0YWxDb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiXSA9IHRoYXQucG9ydGFsQ29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlR3JpZFBvcnRhbENvbG9yIiwgdGhhdC5wb3J0YWxDb2xvciwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0Lm1lbnVDb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VNZW51Q29sb3IiXSA9IHRoYXQubWVudUNvbG9yOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiQmFzZU1lbnVDb2xvciIsIHRoYXQubWVudUNvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQubWVudUxhYmVsQ29sb3IpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCYXNlTWVudUxhYmVsQ29sb3IiXSA9IHRoYXQubWVudUxhYmVsQ29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlTWVudUxhYmVsQ29sb3IiLCB0aGF0Lm1lbnVMYWJlbENvbG9yLCAibG9jYWwiKTsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCYXNlU2hhZG93Q29sb3IiXSA9IHRoYXQubWVudUxhYmVsQ29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlU2hhZG93Q29sb3IiLCB0aGF0Lm1lbnVMYWJlbENvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQuYm90TGFiZWxDb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VMYWJlbENvbG9yIl0gPSB0aGF0LmJvdExhYmVsQ29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlTGFiZWxDb2xvciIsIHRoYXQuYm90TGFiZWxDb2xvciwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LmZvcm0pIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJGb3JtIl0gPSB0aGF0LmZvcm07DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJGb3JtIiwgdGhhdC5mb3JtLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQuYWlNb2RlbCkgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYlByZWZlcnJlZEFJTW9kZWwiXSA9IHRoYXQuYWlNb2RlbDsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYlByZWZlcnJlZEFJTW9kZWwiLCB0aGF0LmFpTW9kZWwsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5kZWZhdWx0UGVyc29uYWxpdHkpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IHt9Ow0KICAgIHRoaXNCb3QudXBkYXRlUGVyc29uYWxpdHkoe30pOw0KfQ0KDQppZiAodGhhdC5tYXBCYXNlbWFwKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiTWFwUG9ydGFsQmFzZSJdID0gdGhhdC5tYXBCYXNlbWFwOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiTWFwUG9ydGFsQmFzZSIsIHRoYXQubWFwQmFzZW1hcCwgImxvY2FsIik7DQp9DQoNCmNvbnN0IHJlc3VsdCA9IGF3YWl0IG9zLnJlY29yZERhdGEoYXV0aEJvdC5pZCwgImFiUGVyc29uYWxpdHlDb25maWciLCBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSk7DQoNCmlmIChyZXN1bHQuc3VjY2Vzcykgew0KICAgIGFiLmxpbmtzLnV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYHVwZGF0ZWQgcGVyc29uYWxpdHkgY29uZmlnIGluIHVzZXIgcmVjb3JkYCwgbG9nVHlwZTogJ2xvZyd9KTsNCn0gZWxzZSB7DQogICAgYWIubGlua3MudXRpbHMuYWJMb2coeyBtZXNzYWdlOiBgZmFpbGVkIHRvIHVwZGF0ZSBwZXJzb25hbGl0eSBjb25maWcgaW4gdXNlciByZWNvcmQuXG4ke0pTT04uc3RyaW5naWZ5KHJlc3VsdCwgdW5kZWZpbmVkLCAyKX1gLCBsb2dUeXBlOiAnZXJyb3InfSk7DQp9DQoNCnNob3V0KCdvbkFCUGVyc29uYWxpdHlDaGFuZ2VkJywgeyBib3Q6IHRoaXNCb3QgfSk7JwCX9bjuCux8D2FiQmFzZU1lbnVDb2xvcgIEAJf1uO4KjZMBByMwMEQ5Q0QnAJf1uO4K7HwRdXBkYXRlUGVyc29uYWxpdHkCBACX9bjuCpWTAbMXQGlmICh0YWdzLmRlYnVnKSB7DQogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB1cGRhdGUgc3RhcnRgKTsNCn0NCg0KaWYgKHRoaXNCb3QudmFycy51cGRhdGluZ1BlcnNvbmFsaXR5KSB7DQogICAgcmV0dXJuOw0KfQ0KDQp0aGlzQm90LnZhcnMudXBkYXRpbmdQZXJzb25hbGl0eSA9IHRydWU7DQoNCmxldCBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YTsNCg0KaWYgKHRoYXQgJiYgdGhhdCA9PSB7fSkgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhID0ge307DQp9IGVsc2Ugew0KICAgIGlmICghYXV0aEJvdCkgew0KICAgICAgICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdEluQmFja2dyb3VuZCgpOw0KICAgIH0NCg0KICAgIGlmIChhdXRoQm90KSB7DQogICAgICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhID0gYXdhaXQgb3MuZ2V0RGF0YShhdXRoQm90LmlkLCAiYWJQZXJzb25hbGl0eUNvbmZpZyIpOw0KICAgICAgICBpZiAoIWxpbmtzLnJlbWVtYmVyICYmIGFiUGVyc29uYWxpdHlDb25maWdEYXRhLnN1Y2Nlc3MgPT0gZmFsc2UpIHsNCiAgICAgICAgICAgIHRoaXNCb3QudmFycy51cGRhdGluZ1BlcnNvbmFsaXR5ID0gZmFsc2U7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEuc3VjY2Vzcykgew0KICAgICAgICAgICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YS5kYXRhOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQppZiAodGFncy5kZWJ1Zykgew0KICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGE6YCwgey4uLmFiUGVyc29uYWxpdHlDb25maWdEYXRhfSk7DQp9DQoNCi8vYWJCbHVlUHJpbnRDb2xvcg0KLy9hYkJhc2VBY2NlbnRDb2xvcg0KY29uc3QgYWJUYWdzID0gWw0KICAgICJhYkJhc2VDb2xvciIsDQogICAgImFiQmFzZU1lbnVDb2xvciIsDQogICAgImFiQnVpbGRlcklkZW50aXR5IiwNCiAgICAiYWJCYXNlU3Ryb2tlQ29sb3IiLA0KICAgICJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiLA0KICAgICJhYkJhc2VMYWJlbENvbG9yIiwNCiAgICAiYWJCYXNlU2hhZG93Q29sb3IiLA0KICAgICJhYlByZWZlcnJlZEFJTW9kZWwiLA0KICAgICJhYkNhdGFsb2dOYW1lIiwNCiAgICAiYWJNYXBQb3J0YWxCYXNlIiwNCiAgICAiYWJCYXNlTWVudUxhYmVsQ29sb3IiDQpdOw0KDQpjbGVhclRhZ01hc2tzKHRoaXNCb3QpOw0KDQovLyBSeWFuIChBdWcgMjksIDIwMjUpOiBpbSBub3Qgc3VyZSBleGFjdGx5IHdoYXQgaXMgaGFwcGVuaW5nIGhlcmUgYnV0IHdpdGhvdXQgc2xlZXBpbmcgb24gdGhlc2UgYmlnIHRhZyBtYXNrIGNoYW5nZXMsIHRoZXkgZG9udCBhbGwgc2VlbSB0byBjb21lIGluIHByb3Blcmx5Lg0KYXdhaXQgb3Muc2xlZXAoMTAwKTsNCg0KZm9yIChsZXQgaSA9IDA7IGkgPCBhYlRhZ3MubGVuZ3RoOyArK2kpIHsNCiAgICBpZiAoYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgJiYgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbYWJUYWdzW2ldXSkgew0KICAgICAgICBpZiAodGFnc1thYlRhZ3NbaV1dICE9IGFiUGVyc29uYWxpdHlDb25maWdEYXRhW2FiVGFnc1tpXV0pIHsNCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzZXR0aW5nICR7YWJUYWdzW2ldfSBsb2NhbCBtYXNrIGZyb20gYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGE6ICR7YWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbYWJUYWdzW2ldXX1gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgYWJUYWdzW2ldLCBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVthYlRhZ3NbaV1dLCAibG9jYWwiKTsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAobGlua3MucmVtZW1iZXIgJiYgbGlua3MucmVtZW1iZXIudGFnc1thYlRhZ3NbaV1dKSB7DQogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzW2FiVGFnc1tpXV0gIT0gdGFnc1thYlRhZ3NbaV1dKSB7DQogICAgICAgICAgICBpZiAodGFncy5kZWJ1Zykgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2V0dGluZyAke2FiVGFnc1tpXX0gbG9jYWwgbWFzayBmcm9tIGFiIHJlbWVtYmVyIGJvdDpgLCBsaW5rcy5yZW1lbWJlci50YWdzW2FiVGFnc1tpXV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCBhYlRhZ3NbaV0sIGxpbmtzLnJlbWVtYmVyLnRhZ3NbYWJUYWdzW2ldXSwgImxvY2FsIik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAoYWJUYWdzW2ldID09ICJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiKSB7DQogICAgICAgIGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxDb2xvciA9IHRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yOw0KICAgIH0NCg0KICAgIGlmIChhYlRhZ3NbaV0gPT0gImFiTWFwUG9ydGFsQmFzZSIpIHsNCiAgICAgICAgbWFwUG9ydGFsQm90LnRhZ3MubWFwUG9ydGFsQmFzZW1hcCA9IHRhZ3MuYWJNYXBQb3J0YWxCYXNlOw0KICAgICAgICBtaW5pTWFwUG9ydGFsQm90LnRhZ3MubWFwUG9ydGFsQmFzZW1hcCA9IHRhZ3MuYWJNYXBQb3J0YWxCYXNlOw0KICAgIH0NCn0NCg0KLy8gUnlhbiAoQXVnIDI5LCAyMDI1KTogaW0gbm90IHN1cmUgZXhhY3RseSB3aGF0IGlzIGhhcHBlbmluZyBoZXJlIGJ1dCB3aXRob3V0IHNsZWVwaW5nIG9uIHRoZXNlIGJpZyB0YWcgbWFzayBjaGFuZ2VzLCB0aGV5IGRvbnQgYWxsIHNlZW0gdG8gY29tZSBpbiBwcm9wZXJseS4NCmF3YWl0IG9zLnNsZWVwKDEwMCk7DQoNCnRoaXNCb3QudmFycy51cGRhdGluZ1BlcnNvbmFsaXR5ID0gZmFsc2U7DQpzaG91dCgnb25BQlBlcnNvbmFsaXR5VXBkYXRlZCcsIHsgYm90OiB0aGlzQm90IH0pOycAl/W47grsfA1hYlBlcnNvbmFsaXR5AgQAl/W47grJqgEEdHJ1ZScAl/W47grsfA1vblNraWxsVXBkYXRlAgQAl/W47grOqgEdQHRoaXNCb3QudXBkYXRlUGVyc29uYWxpdHkoKTsnAJf1uO4K7HwRYWJCYXNlU2hhZG93Q29sb3ICBACX9bjuCuyqAQVibGFjaycAl/W47grsfBBhYkJhc2VMYWJlbENvbG9yAgQAl/W47gryqgEFYmxhY2snAJf1uO4K7HwKbWFwT3B0aW9ucwIEAJf1uO4K+KoBngfwn6esWw0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgInNhdGVsbGl0ZSIsDQogICAgICAgICJpZCI6ICJzYXRlbGxpdGUiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJoeWJyaWQiLA0KICAgICAgICAiaWQiOiAiaHlicmlkIg0KICAgIH0sDQogICAgew0KICAgICAgICAibmFtZSI6ICAib2NlYW5zIiwNCiAgICAgICAgImlkIjogIm9jZWFucyINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgIm9wZW4gc3RyZWV0IG1hcCIsDQogICAgICAgICJpZCI6ICJvc20iDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJ0ZXJyYWluIiwNCiAgICAgICAgImlkIjogInRlcnJhaW4iDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJkYXJrIGdyYXkgY2FudmFzIiwNCiAgICAgICAgImlkIjogImRhcmstZ3JheSINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgImdyYXkgY2FudmFzIiwNCiAgICAgICAgImlkIjogImdyYXkiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJzdHJlZXRzIiwNCiAgICAgICAgImlkIjogInN0cmVldHMiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJzdHJlZXRzIChkYXJrKSIsDQogICAgICAgICJpZCI6ICJzdHJlZXRzLW5pZ2h0LXZlY3RvciINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgInN0cmVldHMgKG5hdmlnYXRpb24pIiwNCiAgICAgICAgImlkIjogInN0cmVldHMtbmF2aWdhdGlvbi12ZWN0b3IiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJ0b3BvZ3JhcGhpYyIsDQogICAgICAgICJpZCI6ICJ0b3BvIg0KICAgIH0sDQogICAgew0KICAgICAgICAibmFtZSI6ICAic3RyZWV0cyAocmVsaWVmKSIsDQogICAgICAgICJpZCI6ICJzdHJlZXRzLXJlbGllZi12ZWN0b3IiDQogICAgfQ0KXScAl/W47grsfBRzaG93QUJCYXNlbWFwT3B0aW9ucwIEAJf1uO4KlbIBxAVAc2hvdXQoImNsZWFyQUJCYXNlbWFwT3B0aW9uc01lbnUiKTsNCg0Kc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCmNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgPSAnYWJCYXNlbWFwT3B0aW9uc01lbnUnOw0KDQpmb3IgKGNvbnN0IG9wdGlvbiBvZiB0YWdzLm1hcE9wdGlvbnMpIHsNCiAgICBpZiAob3B0aW9uLmlkID09IG1hcFBvcnRhbEJvdC50YWdzLm1hcFBvcnRhbEJhc2VtYXApIHsNCiAgICAgICAgY29udGludWU7DQogICAgfQ0KICAgIGNvbnN0IG9wdGlvbk9iaiA9IA0KICAgIHsNCiAgICAgICAgYWJCYXNlbWFwT3B0aW9uc01lbnU6IHRydWUsDQogICAgICAgIGNsZWFyQUJCYXNlbWFwT3B0aW9uc01lbnU6IGBAZGVzdHJveSh0aGlzQm90KTtgLA0KICAgICAgICBtYXBJRDogb3B0aW9uLmlkLA0KICAgICAgICBsYWJlbDogb3B0aW9uLm5hbWUsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBtYXBQb3J0YWxCb3QudGFncy5tYXBQb3J0YWxCYXNlbWFwID0gdGFncy5tYXBJRDsNCiAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsnbWFwQmFzZW1hcCc6IHRhZ3MubWFwSUR9KTsgDQogICAgICAgICAgICBzaG91dCgiY2xlYXJBQkJhc2VtYXBPcHRpb25zTWVudSIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgYWIubGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ob3B0aW9uT2JqKTsNCn0nAJf1uO4K7HwLb25HcmlkQ2xpY2sCBACX9bjuCtq3ASZAc2hvdXQoImNsZWFyQUJCYXNlbWFwT3B0aW9uc01lbnUiKTsNCicAl/W47grsfAVkZWJ1ZwIEAJf1uO4KgbgBBWZhbHNlJwEEYm90cyRiOWI4MjgxOS0xZjE0LTQzOTItODhhOS01MmY2N2E5ZjhlNTUBJwCX9bjuCoe4AQZzeXN0ZW0CBACX9bjuCoi4ARhhYi5wZXJzb25hbGl0eS5hcm1fbnVkZ2UnAJf1uO4Kh7gBDW9uQUJBcm1QbGFjZWQCBACX9bjuCqG4AThAc2V0VGFnTWFzayh0aGlzQm90LCAnaGFzQXJtQmVlblBsYWNlZCcsIHRydWUsICdsb2NhbCcpOycAl/W47gqHuAEJb25BQkF3YWtlAgQAl/W47grauAEwQGF3YWl0IG9zLnNsZWVwKDI1MCk7CnRoaXNCb3QuYWJTdGFydEFybU51ZGdlKCk7JwCX9bjuCoe4AQhhYklnbm9yZQIEAJf1uO4Ki7kBBHRydWUnAJf1uO4Kh7gBDWFiUGVyc29uYWxpdHkCBACX9bjuCpC5AQR0cnVlJwCX9bjuCoe4AQRmb3JtAgQAl/W47gqVuQEHbm90aGluZycAl/W47gqHuAEFbGVhcm4CBACX9bjuCp25ASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCX9bjuCoe4AQ1tYW5pZmVzdGF0aW9uAgQAl/W47grEuQEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAl/W47gqHuAEIcmVtZW1iZXICBACX9bjuCuu5ASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCX9bjuCoe4AQVkZWJ1ZwIEAJf1uO4KkroBBWZhbHNlJwCX9bjuCoe4AQ5hcm1OdWRnZVdhaXRNUwIEAJf1uO4KmLoBBDUwMDAnAJf1uO4Kh7gBD29uQUJJbml0aWFsaXplZAIEAJf1uO4KnboBG0B0aGlzQm90LmFiU3RhcnRBcm1OdWRnZSgpOycAl/W47gqHuAEPYWJTdGFydEFybU51ZGdlAgQAl/W47gq5ugGCH0BpZiAodGhpc0JvdC52YXJzLm51ZGdlQWN0aXZlKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhlcmUgaXMgYWxyZWFkeSBhIG51ZGdlIGluIHByb2dyZXNzLmApOwogICAgfQogICAgcmV0dXJuOwp9Cgp0aGlzQm90LnZhcnMubnVkZ2VBY3RpdmUgPSB0cnVlOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc3RhcnRpbmcgbnVkZ2UuLi5gKQp9CgpmdW5jdGlvbiBjYW5OdWRnZSgpOiBib29sZWFuIHsKICAgIC8vIENhbid0IGhhdmUgcGxhY2VkIHRoZSBhcm0gYWxyZWFkeS4KICAgIGlmICh0YWdzLmhhc0FybUJlZW5QbGFjZWQpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogYXJtIHBsYWNlbWVudCBoYXMgYWxyZWFkeSBvY2N1cmVkLmApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gQUIgbWFuaWZlc3RhdGlvbiBib3QgbXVzdCBiZSBhY3RpdmUuCiAgICBpZiAoIWxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogYWIgbWFuaWZlc3RhdGlvbiBib3QgaXMgaW5hY3RpdmUuYCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBBQiBjaGF0IGJhciBtdXN0IGJlIGNsb3NlZC4KICAgIGlmIChsaW5rcy5pbnB1dC5tYXNrcy5jaGF0T3BlbikgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2Fubm90IG51ZGdlOiBhYiBjaGF0IGJhciBpcyBvcGVuLmApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gVGhlIGluc3QgbXVzdCBiZSBlbXB0eSBvZiBhbGwgYm90cy4gVGhlIGV4Y2VwdGlvbnMgYXJlIGFiIGJvdHMgYW5kIGJ1aWx0LWluIGJvdHMuCiAgICBjb25zdCB1c2VyTWFkZUJvdCA9IGdldEJvdCgoYikgPT4gewogICAgICAgIHJldHVybiAhYi50YWdzLnN5c3RlbT8uc3RhcnRzV2l0aCgnYWIuJykgJiYKICAgICAgICAgICAgICAgIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICAhYi50YWdzLmFiRWdnICYmIC8vIERvbid0IGluY2x1ZGUgYWJFZ2cgYm90cyBhcyAidXNlciBtYWRlIi4KICAgICAgICAgICAgICAgICFiLnRhZ3MuYWJMb2FkZWRTa2lsbCAmJiAvLyBEb24ndCBpbmNsdWRlIGxvYWRlZCBza2lsbCBib3RzIGFzICJ1c2VyIG1hZGUiLgogICAgICAgICAgICAgICAgIWIudGFncy5hYkJvdCAvLyBEb24ndCBpbmNsdWRlIGFueSBib3RzIHRoYXQgYXJlIGZsYWdnZWQgd2l0aCBhbiBhYkJvdCB0YWcuCiAgICB9KQogICAgCiAgICBpZiAodXNlck1hZGVCb3QpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1Z1VzZXJNYWRlQm90cykgewogICAgICAgICAgICAgICAgY29uc3QgdXNlck1hZGVCb3RzID0gZ2V0Qm90cygoYikgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhYi50YWdzLnN5c3RlbT8uc3RhcnRzV2l0aCgnYWIuJykgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhYi50YWdzLmFiRWdnIC8vIERvbid0IGluY2x1ZGUgYWJFZ2cgYm90cyBhcyAidXNlciBtYWRlIi4KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogaW5zdCBjb250YWlucyB1c2VyIG1hZGUgYm90cy5gLCB1c2VyTWFkZUJvdHMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYW5ub3QgbnVkZ2U6IGluc3QgY29udGFpbnMgdXNlciBtYWRlIGJvdHMuYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIE1lbnUgcG9ydGFsIG11c3QgZWl0aGVyIGJlIGluYWN0aXZlIG9yIG5vdCBoYXZlIGFueSBib3RzIGluIHRoZSBjdXJyZW50bHkgYWN0aXZlIG1lbnUgcG9ydGFsLgogICAgaWYgKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwpIHsKICAgICAgICBjb25zdCBib3RJbk1lbnVQb3J0YWwgPSBnZXRCb3QoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIudGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9PT0gdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICBpZiAoYm90SW5NZW51UG9ydGFsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogbWVudVBvcnRhbCBpcyBjdXJyZW50bHkgb3BlbiBhbmQgaGFzIGJvdHMgaW4gaXQuYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKaWYgKGNhbk51ZGdlKCkpIHsKICAgIC8vIFN0YXJ0IG51ZGdlIGZvciBhcm0gcGxhY2VtZW50LgogICAgYXdhaXQgb3Muc2xlZXAodGFncy5hcm1OdWRnZVdhaXRNUyk7CgogICAgaWYgKGNhbk51ZGdlKCkpIHsKICAgICAgICBjb25zdCBhYlBvc2l0aW9uWCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QudGFnc1tsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uICsgJ1gnXTsKICAgICAgICBjb25zdCBhYlBvc2l0aW9uWSA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QudGFnc1tsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uICsgJ1knXTsKCiAgICAgICAgY29uc3QgZ3JpZENsaWNrUGFyYW1zID0gewogICAgICAgICAgICBkaW1lbnNpb246IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb24sCiAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IGFiUG9zaXRpb25YICsgNSwgeTogYWJQb3NpdGlvblkgfSwKICAgICAgICAgICAgZm9yY2VBcm1QbGFjZW1lbnQ6IHRydWUsCiAgICAgICAgfQoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID09PSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uKSB7CiAgICAgICAgICAgIC8vIE1hcCBwb3J0YWwgaXMgaW4gZGlmZmVyZW50IGNvb3JkaW5hdGUgc3BhY2UgYW5kIHNjYWxlLgogICAgICAgICAgICBncmlkQ2xpY2tQYXJhbXMucG9zaXRpb24ueCA9IGFiUG9zaXRpb25YICsgMC4wMDAzNTc0MzQwNjg0MDUzODIzOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB3aGlzcGVyaW5nIG9uR3JpZENsaWNrIHRvIHRoZSBhYiBtYW5pZmVzdGF0aW9uIGJvdCB3aXRoIHRoZSBwYXJhbXM6YCwgZ3JpZENsaWNrUGFyYW1zKQogICAgICAgIH0KCiAgICAgICAgLy8gRm9yY2UgYWIgYXJtIHBsYWNlbWVudCB1c2luZyB0aGUgb25HcmlkQ2xpY2sgbGlzdGVuZXIgb2YgdGhlIG1hbmlmZXN0YXRpb24gYm90LgogICAgICAgIHdoaXNwZXIobGlua3MubWFuaWZlc3RhdGlvbiwgJ29uR3JpZENsaWNrJywgZ3JpZENsaWNrUGFyYW1zKTsKICAgIH0KfQoKdGhpc0JvdC52YXJzLm51ZGdlQWN0aXZlID0gZmFsc2U7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkb25lYCk7Cn0nAJf1uO4Kh7gBEG9uQUJDaGF0QmFyQ2xvc2UCBACX9bjuCrzZARtAdGhpc0JvdC5hYlN0YXJ0QXJtTnVkZ2UoKTsnAJf1uO4Kh7gBBWlucHV0AgQAl/W47grY2QEo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcAl/W47gqHuAEJYWJWZXJzaW9uAgQAl/W47gr/2QEFMTAuMzgnAJf1uO4Kh7gBD29uUG9ydGFsQ2hhbmdlZAIEAJf1uO4KhdoBhQFAY29uc3QgeyBwb3J0YWwsIGRpbWVuc2lvbiB9ID0gdGhhdDsKCmlmIChwb3J0YWwgPT09ICdtZW51UG9ydGFsJykgewogICAgaWYgKCFkaW1lbnNpb24pIHsKICAgICAgICB0aGlzQm90LmFiU3RhcnRBcm1OdWRnZSgpOwogICAgfQp9JwCX9bjuCoe4AQ1hYk1lbnVSZWZyZXNoAgQAl/W47gqL2wEbQHRoaXNCb3QuYWJTdGFydEFybU51ZGdlKCk7JwCX9bjuCoe4ARFkZWJ1Z1VzZXJNYWRlQm90cwIEAJf1uO4Kp9sBBWZhbHNlJwEEYm90cyRkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQBJwCX9bjuCq3bAQZzeXN0ZW0CBACX9bjuCq7bARxhYi5wZXJzb25hbGl0eS5tYW5pZmVzdGF0aW9uJwCX9bjuCq3bAQRmb3JtAgQAl/W47grL2wEHbm90aGluZycAl/W47gqt2wELZGVzY3JpcHRpb24CBACX9bjuCtPbAThUaGlzIHNraWxsIGNvbnRyb2xzIHRoZSBhY3R1YWwgYm90IGZvciB0aGUgYWIgaW50ZXJmYWNlLicAl/W47gqt2wEFbGVhcm4CBACX9bjuCozcASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCX9bjuCq3bAQ9vblBvcnRhbENoYW5nZWQCBACX9bjuCrPcAddHQGNvbnN0IFBPUlRBTFNfVEhBVF9ISURFID0gbmV3IFNldChbCiAgICAic3lzdGVtUG9ydGFsIiwKICAgICJzaGVldFBvcnRhbCIKXSkKCmNvbnN0IFBPUlRBTFNfVEhBVF9NQU5JRkVTVCA9IG5ldyBTZXQoWwogICAgImdyaWRQb3J0YWwiLAogICAgIm1hcFBvcnRhbCIKXSk7Cgpjb25zdCBNQVBfTE9BRF9XQUlUX1RJTUUgPSAxMDAwOwoKZm9yIChjb25zdCBwb3J0YWwgb2YgUE9SVEFMU19USEFUX0hJREUpIHsKICAgIGlmIChjb25maWdCb3QudGFnc1twb3J0YWxdICE9IG51bGwpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGEgcG9ydGFsIHRoYXQgaGlkZXMgYWIgaXMgb3BlbiAtIGhpZGluZyBhYkJvdCBhbmQgaWdub3JpbmcuYCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGFncy5hYkJvdCkgewogICAgICAgICAgICBkZXN0cm95KGxpbmtzLmFiQm90KTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsICE9IG51bGwgfHwgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsICE9IG51bGwpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzaGVldCBwb3J0YWwgb3Igc3lzdGVtIHBvcnRhbCBvcGVuZWQgLSBoaWRpbmcgYWJCb3QgYW5kIGlnbm9yaW5nLmApOwogICAgfQoKICAgIGlmICh0YWdzLmFiQm90KSB7CiAgICAgICAgZGVzdHJveShsaW5rcy5hYkJvdCk7CiAgICB9CgogICAgcmV0dXJuOwp9CgppZiAoIXRhZ3MuYWJBd2FrZSkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFiIGlzIG5vdCBhd2FrZSAtIGlnbm9yaW5nLmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAodGhhdC5wb3J0YWwgPT0gInRhZ1BvcnRhbCIpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0YWdQb3J0YWwgY2hhbmdlZCAtIGlnbm9yaW5nLmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAodGhhdC5wb3J0YWwgPT0gIm1lbnVQb3J0YWwiKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWVudVBvcnRhbCBjaGFuZ2VkIC0gaWdub3JpbmcuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LnBvcnRhbCA9PSAiZ3JpZFBvcnRhbCIgJiYgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZ3JpZFBvcnRhbCBjaGFuZ2VkLCBidXQgYWxzbyBhbHJlYWR5IGluIHRoZSBtYXBQb3J0YWwgLSBpZ25vcmluZy5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKLy8gVGhlIG1hcCBwb3J0YWwgaXMgdG91Z2guIEl0IHNlZW1zIHRvIHZhcnkgaW4gbG9hZGluZyBzcGVlZCBvbgovLyB2YXJpb3VzIGhhcmR3YXJlIGFuZCBuZXR3b3JrcyBhbmQgaGFzIGJ5IHRoZSB0aW1lIG9uUG9ydGFsQ2hhbmdlZCBpcyBjYWxsZWQgaXQgZG9lc250Ci8vIHNlZW0gZ3VhcmVudGVlZCB0byBiZSBhY3R1YWxseSByZWFkeS4gQWRkaW5nIGEgaGFyZGNvZGVkIHdhaXQgdGltZSB0byBnaXZlIHRoZSBwb3J0YWwgc3BhY2UgdG8gZ2V0Ci8vIHRoZSBtYXAgcG9ydGFsIGZ1bGx5IGxvYWRlZCBiZWZvcmUgY29udGludWluZyB3aXRoIG1hbmlmZXN0aW5nIGFiLgovLwovLyBBdCBzb21lIHBvaW50IHRoaXMgY2FuIGdvIGF3YXkgaWYgd2UgZXZlciBnZXQgYSBzaG91dCBvciBzb21lIG90aGVyIGdhdXJlbnRlZSB0aGF0IHRoZSBtYXAgcG9ydGFsIGlzIGxvYWRlZC9yZWFkeS4KaWYgKHRoYXQucG9ydGFsID09PSAnbWFwUG9ydGFsJykgewogICAgaWYgKHRoYXQuZGltZW5zaW9uKSB7CiAgICAgICAgaWYgKCF0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZGVkICYmICF0aGlzQm90LnZhcnMubWFwUG9ydGFsSW5pdGlhbExvYWRlZCkgewogICAgICAgICAgICBpZiAoIXRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkV2FpdGVyKSB7CiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlciA9IG9zLnNsZWVwKE1BUF9MT0FEX1dBSVRfVElNRSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gd2FpdGluZyBmb3IgbWFwIHBvcnRhbCB0byBmaW5pc2ggbG9hZGluZzogJHtNQVBfTE9BRF9XQUlUX1RJTUV9bXNgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRXYWl0ZXIudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlciA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy5tYXBQb3J0YWxJbml0aWFsTG9hZGVkID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWFwIHBvcnRhbCBsb2FkZWQuYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCgogICAgICAgICAgICAvLyBhd2FpdCB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlcjsKICAgICAgICAgICAgLy8gdGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRXYWl0ZXIgPSBudWxsOwogICAgICAgICAgICAvLyB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZGVkID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtYXAgcG9ydGFsIGlzIGFscmVhZHkgbG9hZGVkLmApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZGVkID0gZmFsc2U7CiAgICAgICAgdGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRXYWl0ZXIgPSBudWxsOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG1hcCBwb3J0YWwgaGFzIGJlZW4gdW5sb2FkZWQuYCk7CiAgICAgICAgfQogICAgfQp9CgovLyBTdGFydCBjaGVja3MgZm9yIGlmL3doZXJlIHdlIG5lZWQgdG8gbWFuaWZlc3QgYWIuCmxldCBuZXdBQiA9IGZhbHNlOwpsZXQgbmV3QUJQb3J0YWw7CmxldCBuZXdBQlBvc2l0aW9uOwpsZXQgZm9jdXNDYW1lcmEgPSB0cnVlOwpsZXQgZm9jdXNDYW1lcmFTdGFydFpvb207CgppZiAoUE9SVEFMU19USEFUX01BTklGRVNULmhhcyh0aGF0LnBvcnRhbCkgJiYgdGhhdC5kaW1lbnNpb24pIHsKICAgIC8vIEEgcG9ydGFsIHRoYXQgbWFuaWZlc3RzIGFiIGhhcyBqdXN0IGNoYW5nZWQgZGltZW5zaW9uLgogICAgLy8gTWFuaWZlc3QgYWIgaW4gdGhlIG5ldyBkaW1lbnNpb24uCiAgICBpZiAodGhhdC5wb3J0YWwgPT0gIm1hcFBvcnRhbCIgfHwgdGhhdC5wb3J0YWwgPT0gIm1pbmlNYXBQb3J0YWwiKSB7OwogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWFuaWZlc3RpbmcgYWIgYm90IGluIG1hcCBwb3J0YWwgZGltZW5zaW9uICcke3RoYXQuZGltZW5zaW9ufScuYCk7CiAgICAgICAgfQoKICAgICAgICBuZXdBQlBvc2l0aW9uID0gYXdhaXQgdGhpc0JvdC5nZXREZWZhdWx0TWFuaWZlc3RQb3NpdGlvbignbWFwJyk7CiAgICAgICAgbmV3QUJQb3J0YWwgPSB0aGF0LnBvcnRhbDsKICAgICAgICBuZXdBQiA9IGF3YWl0IHRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7IGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHBvc2l0aW9uOiBuZXdBQlBvc2l0aW9uIH0pOwogICAgICAgIGZvY3VzQ2FtZXJhU3RhcnRab29tID0gYXdhaXQgdGhpc0JvdC5nZXRTdGFydENhbWVyYVpvb20oJ21hcCcpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtYW5pZmVzdGluZyBhYiBib3QgZGltZW5zaW9uICcke3RoYXQuZGltZW5zaW9ufScuYCk7CiAgICAgICAgfQoKICAgICAgICBuZXdBQlBvc2l0aW9uID0gYXdhaXQgdGhpc0JvdC5nZXREZWZhdWx0TWFuaWZlc3RQb3NpdGlvbignZ3JpZCcpOwogICAgICAgIG5ld0FCUG9ydGFsID0gdGhhdC5wb3J0YWw7CiAgICAgICAgbmV3QUIgPSBhd2FpdCB0aGlzQm90LmFiTWFuaWZlc3RCb3QoeyBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLCBwb3NpdGlvbjogbmV3QUJQb3NpdGlvbiB9KTsKICAgICAgICBmb2N1c0NhbWVyYVN0YXJ0Wm9vbSA9IGF3YWl0IHRoaXNCb3QuZ2V0U3RhcnRDYW1lcmFab29tKCdncmlkJyk7CiAgICB9Cn0gZWxzZSBpZiAoKFBPUlRBTFNfVEhBVF9NQU5JRkVTVC5oYXModGhhdC5wb3J0YWwpIHx8IFBPUlRBTFNfVEhBVF9ISURFLmhhcyh0aGF0LnBvcnRhbCkpICYmIAogICAgICAgICAgICF0aGF0LmRpbWVuc2lvbiAmJiAKICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCB8fCBjb25maWdCb3QudGFncy5tYXBQb3J0YWwpCikgewogICAgLy8gQSBwb3J0YWwgdGhhdCB0eXBpY2FsbHkgaGlkZXMgb3IgcmUtbWFuaWZlc3RzIGFiIGp1c3QgY2xvc2VkLCBidXQgZWl0aGVyIHRoZSBncmlkIG9yIG1hcCBwb3J0YWwgYXJlIHN0aWxsIG9wZW4uCiAgICAvLyBTdW1tb24gYWIgaW4gZWl0aGVyIHRoZSBtYXBQb3J0YWwgb3IgZ3JpZFBvcnRhbC4KICAgIGxldCBzdW1tb25EaW1lbnNpb247CgogICAgaWYgKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCkgewogICAgICAgIHN1bW1vbkRpbWVuc2lvbiA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbDsKICAgICAgICBuZXdBQlBvcnRhbCA9ICdtYXBQb3J0YWwnOwogICAgICAgIAogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzW3N1bW1vbkRpbWVuc2lvbiArICdBQkxhc3RQb3NpdGlvbiddKSB7CiAgICAgICAgICAgIC8vIFVzZSBsYXN0IGtub3duIHBvc2l0aW9uLgogICAgICAgICAgICBuZXdBQlBvc2l0aW9uID0gbGlua3MucmVtZW1iZXIudGFnc1tzdW1tb25EaW1lbnNpb24gKyAnQUJMYXN0UG9zaXRpb24nXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBVc2UgZGVmYXVsdCBtYXAgcG9zaXRpb24uCiAgICAgICAgICAgIG5ld0FCUG9zaXRpb24gPSBhd2FpdCB0aGlzQm90LmdldERlZmF1bHRNYW5pZmVzdFBvc2l0aW9uKCdtYXAnKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwpIHsKICAgICAgICBzdW1tb25EaW1lbnNpb24gPSBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwogICAgICAgIG5ld0FCUG9ydGFsID0gJ2dyaWRQb3J0YWwnOwoKICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFnc1tzdW1tb25EaW1lbnNpb24gKyAnQUJMYXN0UG9zaXRpb24nXSkgewogICAgICAgICAgICAvLyBVc2UgbGFzdCBrbm93biBwb3NpdGlvbi4KICAgICAgICAgICAgbmV3QUJQb3NpdGlvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3Nbc3VtbW9uRGltZW5zaW9uICsgJ0FCTGFzdFBvc2l0aW9uJ107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gVXNlIGRlZmF1bHQgZ3JpZCBwb3NpdGlvbi4KICAgICAgICAgICAgbmV3QUJQb3NpdGlvbiA9IGF3YWl0IHRoaXNCb3QuZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24oJ2dyaWQnKTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHN1bW1vbkRpbWVuc2lvbikgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc3VtbW9uaW5nIGFiIGJvdCBpbiAke25ld0FCUG9ydGFsfSBkaW1lbnNpb24gJyR7c3VtbW9uRGltZW5zaW9ufScuYCk7CiAgICAgICAgfQoKICAgICAgICBuZXdBQiA9IGF3YWl0IHRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7IGRpbWVuc2lvbjogc3VtbW9uRGltZW5zaW9uLCBwb3NpdGlvbjogbmV3QUJQb3NpdGlvbiB9KTsKCiAgICAgICAgaWYgKFBPUlRBTFNfVEhBVF9ISURFLmhhcyh0aGF0LnBvcnRhbCkpIHsKICAgICAgICAgICAgLy8gSWYgdGhlIHBvcnRhbCB0aGF0IGNsb3NlZCB3YXMgYSBwb3J0YWwgdGhhdCBoaWRlcyBhYiwgdGhlbiBkb250IHJ1biB0aGUgY2FtZXJhIGZvY3VzLgogICAgICAgICAgICAvLyBUaGlzIHdpbGwganVzdCB1c2UgdGhlIHByZXZpb3VzIGNhbWVyYSBwb3NpdGlvbiBhbHJlYWR5IHN0b3JlZCBpbiBtZW1vcnkuCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHdpbGwgbm90IGZvY3VzIGNhbWVyYSBvbiBhYiBiZWNhdXNlIHdlIGFyZSBqdXN0IGFzc3VtaW5nIHRoZSBwcmV2aW91cyBjYW1lcmEgcG9zaXRpb24uYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9jdXNDYW1lcmEgPSBmYWxzZTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm90aCB0aGUgbWFwIGFuZCBncmlkIHBvcnRhbCBhcmUgYm90aCBjbG9zZWQsIGNhbm5vdCBzdW1tb24gYWIgaW4gZWl0aGVyLmApOwogICAgICAgIH0KICAgIH0KfSBlbHNlIHsKICAgIHJldHVybjsKfQoKaWYgKGZvY3VzQ2FtZXJhICYmIGxpbmtzLnJlbWVtYmVyLnRhZ3MubWFwUHJldmVudEZvY3VzKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2tpcHBpbmcgY2FtZXJhIGZvY3VzIGFuaW1hdGlvbiBiZWNhdXNlIG1hcFByZXZlbnRGb2N1cyBpcyBzZXQgdG8gdHJ1ZSBvbiB0aGUgYWIgcmVtZW1iZXIgYm90LmApOwogICAgfQoKICAgIGZvY3VzQ2FtZXJhID0gZmFsc2U7Cn0KCmlmIChuZXdBQiAmJiBmb2N1c0NhbWVyYSkgewogICAgaWYgKHRoaXNCb3QudmFycy5hY3RpdmVGb2N1c0luZm8gJiYgCiAgICAgICAgdGhpc0JvdC52YXJzLmFjdGl2ZUZvY3VzSW5mby5wb3J0YWwgPT09IHRoYXQucG9ydGFsICYmIAogICAgICAgIHRoaXNCb3QudmFycy5hY3RpdmVGb2N1c0luZm8uZGltZW5zaW9uID09PSB0aGF0LmRpbWVuc2lvbiAmJgogICAgICAgIHRoaXNCb3QudmFycy5hY3RpdmVGb2N1c0luZm8ucG9zaXRpb24/LnggPT09IG5ld0FCUG9zaXRpb24ueCAmJgogICAgICAgIHRoaXNCb3QudmFycy5hY3RpdmVGb2N1c0luZm8ucG9zaXRpb24/LnkgPT09IG5ld0FCUG9zaXRpb24ueQogICAgKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBza2lwcGluZyBjYW1lcmEgZm9jdXMgYW5pbWF0aW9uIGJlY2F1c2Ugb25lIGlzIGFscmVhZHkgYWN0aXZlIHdpdGggdGhlIHNhbWUgc2V0dGluZ3MuYCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgdGhpc0JvdC52YXJzLmFjdGl2ZUZvY3VzSW5mbyA9IHsgCiAgICAgICAgcG9ydGFsOiB0aGF0LnBvcnRhbCwgCiAgICAgICAgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwKICAgICAgICBwb3NpdGlvbjogey4uLm5ld0FCUG9zaXRpb259LAogICAgfTsKCiAgICBsZXQgem9vbSA9IHRhZ3MuZGVmYXVsdEdyaWRQb3J0YWxab29tOwoKICAgIGlmIChuZXdBQlBvcnRhbCA9PT0gJ21hcFBvcnRhbCcgfHwgbmV3QUJQb3J0YWwgPT09ICdtaW5pTWFwUG9ydGFsJykgewogICAgICAgIHpvb20gPSB0YWdzLmRlZmF1bHRNYXBQb3J0YWxab29tOwogICAgfQogICAgCiAgICB0cnkgewogICAgICAgIGlmIChmb2N1c0NhbWVyYVN0YXJ0Wm9vbSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNldCBzdGFydCB6b29tIG9mICR7bmV3QUJQb3J0YWx9IHRvICR7Zm9jdXNDYW1lcmFTdGFydFpvb219LmApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRXYWl0ZXIpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkV2FpdGVyOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhd2FpdCBvcy5mb2N1c09uKG5ld0FCUG9zaXRpb24sIHsgem9vbTogZm9jdXNDYW1lcmFTdGFydFpvb20sIGR1cmF0aW9uOiAwLCBwb3J0YWw6IG5ld0FCUG9ydGFsIH0pOwogICAgICAgICAgICBhd2FpdCBvcy5zbGVlcCgxMDAwKTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZm9jdXMgb24gJHtKU09OLnN0cmluZ2lmeShuZXdBQlBvc2l0aW9uKX0gaW4gJHtuZXdBQlBvcnRhbH0gd2l0aCB6b29tICR7em9vbX0uYCk7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBvcy5mb2N1c09uKG5ld0FCUG9zaXRpb24sIHsgem9vbSwgcm90YXRpb246IHsgeDogNDUsIHk6IDQ1IH0sIHBvcnRhbDogbmV3QUJQb3J0YWwgfSkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLndhcm4oYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBmb2N1c09uIGVycm9yIG9jY3VyZWQ6YCwgZSk7CiAgICAgICAgfQogICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzQm90LnZhcnMuYWN0aXZlRm9jdXNJbmZvID0gbnVsbDsKICAgIH0KfScAl/W47gqt2wEIcmVtZW1iZXICBACX9bjuCoukAijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCX9bjuCq3bAQ1hYk1hbmlmZXN0Qm90AgQAl/W47gqypALoPkBjb25zdCBkaW1lbnNpb24gPSB0aGF0Py5kaW1lbnNpb247CmNvbnN0IHBvc2l0aW9uID0gdGhhdD8ucG9zaXRpb247CgppZiAodGhpc0JvdC52YXJzLmFiQm90TGFzdElkKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGVzdHJveWluZyBhYkJvdGApOwogICAgfQogICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYWJCb3RMYXN0SWQpOwp9Cgpjb25zdCBhYk1vZCA9IHsKICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgIGRpbWVuc2lvbiwKICAgIGFiQm90OiB0cnVlLAogICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICBbZGltZW5zaW9uICsgJ1gnXTogcG9zaXRpb24ueCwKICAgIFtkaW1lbnNpb24gKyAnWSddOiBwb3NpdGlvbi55LAogICAgbWFuYWdlcjogZ2V0TGluayh0aGlzQm90KSwKICAgIHJlbWVtYmVyOiB0YWdzLnJlbWVtYmVyLAogICAgZm9ybTogJ2N1YmUnLAogICAgbGFiZWw6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlTGFiZWwsCiAgICBsYWJlbFBvc2l0aW9uOiAnZnJvbnQnLAogICAgbGFiZWxDb2xvcjogbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvciwKICAgIGxhYmVsU2l6ZTogMC42MSwKICAgIGRyYWdnYWJsZTogZmFsc2UsCiAgICBhcm1TZWxlY3Rpb246IHRydWUsCiAgICBhcm1Hcm91cERyYWc6IHRydWUsCiAgICBhcm1UZWxlcG9ydDogdHJ1ZSwKICAgIGFybU1lc2hQYXRoOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiQXJtTWVzaFBhdGgsCiAgICBhcm1Db2xvcjogbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvciwKICAgIHBlcnNvbmFsaXR5OiB0YWdzLnBlcnNvbmFsaXR5LAogICAgcmVtZW1iZXI6IHRhZ3MucmVtZW1iZXIsCiAgICBsZWFybjogdGFncy5sZWFybiwKICAgIHNwaW5EdXJhdGlvbk1TOiAyMDAwLAogICAgc3BpbkludGVydmFsTVM6IDIwMDAsCiAgICBzb3VuZENsaWNrOiAnYWIvYXVkaW8vYWJfdGFwLm1wMycsCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4geyAKICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYk1lc2hQYXRoKSB7CiAgICAgICAgICAgIGxldCBmb3JtQWRkcmVzczsKCiAgICAgICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiTWVzaFBhdGguc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgICAgZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiTWVzaFBhdGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3JtQWRkcmVzcyA9IGxpbmtzLmxlYXJuLmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJNZXNoUGF0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgbWVzaCBmb3IgYWIuCiAgICAgICAgICAgIG1hc2tzLm1lc2hCb3QgPSBnZXRMaW5rKGNyZWF0ZSh7CiAgICAgICAgICAgICAgICBzcGFjZTogJ3RlbXBMb2NhbCcsCiAgICAgICAgICAgICAgICBhYkJvdDogZ2V0TGluayh0aGlzQm90KSwKICAgICAgICAgICAgICAgIGZvcm06ICdtZXNoJywKICAgICAgICAgICAgICAgIGZvcm1TdWJ0eXBlOiAnZ2x0ZicsCiAgICAgICAgICAgICAgICBmb3JtQWRkcmVzcywKICAgICAgICAgICAgICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lcjogdGhpc0JvdC5pZCwKICAgICAgICAgICAgICAgIGFuY2hvclBvaW50OiAnY2VudGVyJywKICAgICAgICAgICAgICAgIFt0YWdzLmRpbWVuc2lvbl06IHRydWUsCiAgICAgICAgICAgICAgICBbdGFncy5kaW1lbnNpb24gKyAnWiddOiAtMC41CiAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIHRhZ3MuY29sb3IgPSAndHJhbnNwYXJlbnQnOwogICAgICAgICAgICB0YWdzLnNjYWxlID0gMTsKICAgICAgICAgICAgdGFncy5zcGluSW50ZXJ2YWxNUyA9IDQ1MDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gSWYgYSBjdXN0b20gbWVzaCBpcyBub3QgZGVmaW5lZCBmb3IgYWIsIHRoZW4gZ2l2ZSBhYiBhICJjb3JlIi4KICAgICAgICAgICAgbWFza3MuY29yZUJvdCA9IGdldExpbmsoY3JlYXRlKHsKICAgICAgICAgICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgICAgICAgICAgICAgIGFiQm90OiBnZXRMaW5rKHRoaXNCb3QpLAogICAgICAgICAgICAgICAgY29sb3I6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3IsCiAgICAgICAgICAgICAgICBmb3JtT3BhY2l0eTogMC42NiwKICAgICAgICAgICAgICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBzY2FsZTogMC43NSwKICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVyOiB0aGlzQm90LmlkLAogICAgICAgICAgICAgICAgYW5jaG9yUG9pbnQ6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgW3RhZ3MuZGltZW5zaW9uXTogdHJ1ZSwKICAgICAgICAgICAgICAgIFt0YWdzLmRpbWVuc2lvbiArICdaJ106IC0wLjUKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgdGFncy5jb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlQ29sb3I7CiAgICAgICAgICAgIHRhZ3Muc2NhbGUgPSAwLjk7CiAgICAgICAgICAgIHRhZ3Muc3Ryb2tlV2lkdGggPSAxOwogICAgICAgICAgICB0YWdzLnN0cm9rZUNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKICAgICAgICAgICAgdGFncy5mb3JtT3BhY2l0eSA9IDAuMzM7CiAgICAgICAgICAgIHRhZ3MuZm9ybURlcHRoVGVzdCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdGhpc0JvdC5hbmltYXRlQm90KCk7CiAgICAgICAgbWFza3MuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzQm90LmFuaW1hdGVCb3QoKSwgdGFncy5zcGluSW50ZXJ2YWxNUyk7CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5tb2RhbGl0eSA9PSAnbW91c2UnICYmIHRoYXQuYnV0dG9uSWQgPT0gJ3JpZ2h0JykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChtYXNrcy5hcm1Cb3QpIHsKICAgICAgICAgICAgZGVzdHJveShsaW5rcy5hcm1Cb3QpOwogICAgICAgICAgICBtYXNrcy5hcm1Cb3QgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgbGlua3MubWFuYWdlci5hYkNsaWNrKCk7CiAgICB9KSwKICAgIG9uUG9pbnRlckVudGVyOkxpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5tb2RhbGl0eSA9PT0gJ21vdXNlJykgewogICAgICAgICAgICB0YWdzLm1vdXNlT3ZlciA9IHRydWU7CiAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlUG9ydGFsQ3Vyc29yKCk7CiAgICAgICAgfQogICAgfSksCiAgICBvblBvaW50ZXJFeGl0OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQubW9kYWxpdHkgPT09ICdtb3VzZScpIHsKICAgICAgICAgICAgdGFncy5tb3VzZU92ZXIgPSBmYWxzZTsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsKICAgICAgICB9CiAgICB9KSwKICAgIG9uUG9pbnRlckRvd246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5tb2RhbGl0eSA9PT0gJ21vdXNlJyAmJiB0aGF0LmJ1dHRvbklkID09PSAnbGVmdCcpIHsKICAgICAgICAgICAgdGFncy5tb3VzZUxlZnRCdXR0b25Eb3duID0gdHJ1ZTsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsKICAgICAgICB9CiAgICB9KSwKICAgIG9uUG9pbnRlclVwOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQubW9kYWxpdHkgPT09ICdtb3VzZScgJiYgdGhhdC5idXR0b25JZCA9PT0gJ2xlZnQnKSB7CiAgICAgICAgICAgIHRhZ3MubW91c2VMZWZ0QnV0dG9uRG93biA9IGZhbHNlOwogICAgICAgICAgICB0YWdzLm1vdXNlTGVmdERyYWdnaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlUG9ydGFsQ3Vyc29yKCk7CiAgICAgICAgfQogICAgfSksCiAgICBvbkRyYWc6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGFncy5tb3VzZUxlZnRCdXR0b25Eb3duKSB7CiAgICAgICAgICAgIHRhZ3MubW91c2VMZWZ0RHJhZ2dpbmcgPSB0cnVlOwogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVBvcnRhbEN1cnNvcigpOyAgCiAgICAgICAgfQogICAgfSksCiAgICBvbktleURvd246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5rZXlzLmluY2x1ZGVzKCdTaGlmdCcpKSB7CiAgICAgICAgICAgIHRhZ3Muc2hpZnRIZWxkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsgIAogICAgICAgIH0KICAgIH0pLAogICAgb25LZXlVcDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ1NoaWZ0JykpIHsKICAgICAgICAgICAgdGFncy5zaGlmdEhlbGQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsgIAogICAgICAgIH0KICAgIH0pLAogICAgdXBkYXRlUG9ydGFsQ3Vyc29yOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgbGV0IGN1cnNvciA9IG51bGw7CgogICAgICAgIGlmICh0YWdzLm1vdXNlTGVmdERyYWdnaW5nKSB7CiAgICAgICAgICAgIGN1cnNvciA9ICdncmFiYmluZyc7ICAgIAogICAgICAgIH0gZWxzZSBpZiAodGFncy5tb3VzZU92ZXIpIHsKICAgICAgICAgICAgaWYgKHRhZ3Muc2hpZnRIZWxkKSB7CiAgICAgICAgICAgICAgICBjdXJzb3IgPSAnY29udGV4dC1tZW51JzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN1cnNvciA9ICdwb2ludGVyJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDdXJzb3IgPSBjdXJzb3I7CiAgICB9KSwKICAgIGFuaW1hdGVCb3Q6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsgCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHJvdFogPSB0YWdzLmRpbWVuc2lvbiArICdSb3RhdGlvblonOwoKICAgICAgICBhd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsCiAgICAgICAgewogICAgICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgICAgIFtyb3RaXTogMCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICAgICAgW3JvdFpdOiA2LjMsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVhc2luZzogewogICAgICAgICAgICAgICAgdHlwZTogJ3NpbnVzb2lkYWwnLAogICAgICAgICAgICAgICAgbW9kZTogJ2lub3V0JwogICAgICAgICAgICB9LAogICAgICAgICAgICBkdXJhdGlvbjogdGFncy5zcGluRHVyYXRpb25NUyAvIDEwMDAsCiAgICAgICAgfSkuY2F0Y2goZSA9PiB7fSk7CiAgICB9KSwKICAgIG9uQXJtQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKCF0YWdzLmludGVydmFsKSB7CiAgICAgICAgICAgIGxpbmtzLm1hbmFnZXIuYWJDbGljayh7IHJlc2V0OiB0cnVlIH0pOwogICAgICAgIH0KICAgIH0pLAogICAgb25Bcm1QbGFjZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkdyaWRGb2N1cyA9IHsKICAgICAgICAgICAgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwgCiAgICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgICAgICB4OiB0aGF0LngsCiAgICAgICAgICAgICAgICB5OiB0aGF0LnkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGlua3MubWFuYWdlci5hYkNsaWNrKHsgbWVudTogJ2dyaWQnIH0pOwoKICAgICAgICBzaG91dCgnb25BQkFybVBsYWNlZCcsIHRoYXQpOwogICAgfSksCiAgICBvbkFybUNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgbGlua3MubWFuYWdlci5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CiAgICAgICAgc2hvdXQoJ29uQUJGb290Q2xpY2tlZCcsIHRoYXQpOwogICAgfSksCiAgICBvbkFybVNlbGVjdGVkQm90czogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbnN0IHNlbGVjdGVkQm90cyA9IHRoYXQ7CgogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHNlbGVjdGVkQm90cykpIHsKICAgICAgICAgICAgLy8gTXVsdGlwbGUgYm90IHNlbGVjdGlvbi4KICAgICAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJNdWx0aXBsZUJvdEZvY3VzID0gZ2V0TGluayhzZWxlY3RlZEJvdHMpOwogICAgICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soeyBtZW51OiAnbXVsdGlwbGVCb3QnIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFNpbmdsZSBib3Qgc2VsZWN0aW9uLgogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJvdEZvY3VzID0gIvCflJciICsgc2VsZWN0ZWRCb3RzLmlkOwoKICAgICAgICAgICAgaWYgKHNlbGVjdGVkQm90cyA9PT0gdGhpc0JvdCkgewogICAgICAgICAgICAgICAgYWIubGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbGlua3MubWFuYWdlci5hYkNsaWNrKHsgbWVudTogJ2JvdCcgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQoKICAgICAgICBzaG91dCgnb25BQlNlbGVjdGVkQm90Jywgc2VsZWN0ZWRCb3RzKTsKICAgIH0pLAogICAgb25Bcm1EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsKICAgIH0pLAogICAgb25EZXN0cm95OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0YWdzLmludGVydmFsKTsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgfSksCn07Cgpjb25zdCBhYkJvdCA9IGNyZWF0ZShhYk1vZCk7CgppZiAobGlua3MucmVtZW1iZXIudGFncy5hYlNlY29uZGFyeUxhYmVsKSB7CiAgICBjb25zdCBhYkxhYmVsQm90ID0gewogICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgICAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgICAgICBbZGltZW5zaW9uICsgJ1onXTogLTEsCiAgICAgICAgY3JlYXRvcjogYWJCb3QuaWQsCiAgICAgICAgdHJhbnNmb3JtZXI6IGFiQm90LmlkLAogICAgICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICAgICAgY29sb3I6ICdjbGVhcicsCiAgICAgICAgbGFiZWw6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJTZWNvbmRhcnlMYWJlbCwKICAgICAgICBsYWJlbFBvc2l0aW9uOiAnbGVmdCcsCiAgICAgICAgbGFiZWxTaXplOiAwLjcsCiAgICAgICAgbGFiZWxDb2xvcjogYWJCb3QudGFncy5sYWJlbENvbG9yLAogICAgfTsKCiAgICBjcmVhdGUoYWJMYWJlbEJvdCk7Cn0KCm1hc2tzLmFiQm90ID0gZ2V0TGluayhhYkJvdCk7CmxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQWN0aXZlRGltZW5zaW9uID0gZGltZW5zaW9uOwp0aGlzQm90LnZhcnMuYWJCb3RMYXN0SWQgPSBhYkJvdC5pZDsgLy8gU3RvcmluZyBpZCBhcyBhIHZhciBwcmV2ZW50cyBnaG9zdCBhYkJvdHMgZHVyaW5nIG11bHRpcGxlIGNhbGxzIGluIG9uZSBmcmFtZS4KCi8vIFN0b3JlIHRoZSBsYXN0IHBvc2l0aW9uIG9mIGFiIGluIHRoaXMgZGltZW5zaW9uIG9uIHRoZSByZW1lbWJlciBib3QuCmxpbmtzLnJlbWVtYmVyLm1hc2tzW2RpbWVuc2lvbiArICdBQkxhc3RQb3NpdGlvbiddID0gJ/Cfp6wnICsgSlNPTi5zdHJpbmdpZnkoeyB4OiBwb3NpdGlvbj8ueCwgeTogcG9zaXRpb24/LnkgfSk7Cgphd2FpdCBvcy5zbGVlcCgwKTsgLy8gR2l2ZSBDYXN1YWxPUyBhIGNoYW5jZSB0byB1cGRhdGUgdGFnIG1hc2tzLgoKc2hvdXQoJ29uQUJNb3ZlZCcsIHsgZGltZW5zaW9uLCB4OiBwb3NpdGlvbi54LCB5OiBwb3NpdGlvbi55IH0pOwoKcmV0dXJuIGFiQm90OycAl/W47gqt2wELb25HcmlkQ2xpY2sCBACX9bjuCpfjAsAUQGlmICghdGFncy5hYkF3YWtlKSB7CiAgICByZXR1cm47Cn0KCmNvbnN0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOwoKaWYgKGxpbmtzLmFiQm90ICYmIChzaGlmdENoZWNrIHx8ICh0aGF0Lm1vZGFsaXR5ID09ICJtb3VzZSIgJiYgdGhhdC5idXR0b25JZCA9PSAicmlnaHQiICYmICFsaW5rcy5yZW1lbWJlci50YWdzLmFiUmlnaHRDbGlja0Rpc2FibGVkKSB8fCB0aGF0LmZvcmNlQXJtUGxhY2VtZW50KSkgewogICAgY29uc3QgYXJtQm90ID0gYWIubGlua3MuYXJtX3Rvb2wuYWJDcmVhdGVBcm0oewogICAgICAgIG9yaWdpbkJvdDogbGlua3MuYWJCb3QsCiAgICAgICAgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwKICAgICAgICBwb3NpdGlvbjogdGhhdC5wb3NpdGlvbiwKICAgIH0pCgogICAgLy8gRmFrZSB1c2VyIGRyb3BwaW5nIHRoZSBhcm0gb24gdGhlIGdyaWQgc3BhY2UuCiAgICBhcm1Cb3Qub25Ecm9wKHsKICAgICAgICBib3Q6IGFybUJvdCwKICAgICAgICB0bzogewogICAgICAgICAgICB4OiB0aGF0LnBvc2l0aW9uLngsCiAgICAgICAgICAgIHk6IHRoYXQucG9zaXRpb24ueSwKICAgICAgICAgICAgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbgogICAgICAgIH0sCiAgICAgICAgZnJvbTogewogICAgICAgICAgICB4OiB0aGF0LnBvc2l0aW9uLngsCiAgICAgICAgICAgIHk6IHRoYXQucG9zaXRpb24ueSwKICAgICAgICAgICAgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbgogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybjsKfQoKY29uc3QgZm9vdHByaW50ID0gewogICAgc3BhY2U6ICJ0ZW1wTG9jYWwiLAogICAgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwKICAgIFt0aGF0LmRpbWVuc2lvbl06IHRydWUsCiAgICBbdGhhdC5kaW1lbnNpb24gKyAiWCJdOiB0aGF0LnBvc2l0aW9uLngsCiAgICBbdGhhdC5kaW1lbnNpb24gKyAiWSJdOiB0aGF0LnBvc2l0aW9uLnksCiAgICBwb3NpdGlvbkluZm86IHRoYXQsCiAgICBwZXJzb25hbGl0eTogdGFncy5wZXJzb25hbGl0eSwKICAgIHJlbWVtYmVyOiB0YWdzLnJlbWVtYmVyLAogICAgbGVhcm46IHRhZ3MubGVhcm4sCiAgICBkcmFnZ2FibGU6IGZhbHNlLAogICAgY3Vyc29yOiAnYWxpYXMnLAogICAgbWFuYWdlcjogZ2V0TGluayh0aGlzQm90KSwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZyhhc3luYyAoKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBkZXN0cm95KHRoaXNCb3QpLCA4MDApOwoKICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkFybU1lc2hQYXRoKSB7CiAgICAgICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQXJtTWVzaFBhdGguc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBcm1NZXNoUGF0aDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5sZWFybi5hYkJ1aWxkQ2FzdWFsQ2F0YWxvZ1VSTChsaW5rcy5yZW1lbWJlci50YWdzLmFiQXJtTWVzaFBhdGgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0YWdzLmZvcm0gPSAnbWVzaCc7CiAgICAgICAgICAgIHRhZ3MuZm9ybVN1YnR5cGUgPSAnZ2x0Zic7CiAgICAgICAgICAgIHRhZ3MuY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwogICAgICAgICAgICB0YWdzLnN0cm9rZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKICAgICAgICAgICAgdGFncy5hbmNob3JQb2ludCA9ICdjZW50ZXInOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3MuY29sb3IgPSAnY2xlYXInOwogICAgICAgICAgICB0YWdzLnN0cm9rZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKICAgICAgICAgICAgdGFncy5zY2FsZVogPSAwLjAxOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgYW5pbWF0ZVRhZyh0aGlzQm90LCB7CiAgICAgICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICAgICAgc2NhbGVYOiAwLjEsCiAgICAgICAgICAgICAgICBzY2FsZVk6IDAuMQogICAgICAgICAgICB9LAogICAgICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgICAgICBzY2FsZVg6IDEuMSwKICAgICAgICAgICAgICAgIHNjYWxlWTogMS4xCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGR1cmF0aW9uOiAwLjUsCiAgICAgICAgICAgIGVhc2luZzogewogICAgICAgICAgICAgICAgdHlwZTogImVsYXN0aWMiLAogICAgICAgICAgICAgICAgbW9kZTogIm91dCIKICAgICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGUgPT4ge30pOwogICAgfSksCiAgICBvbkNsaWNrOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICBzaG91dCgib25BQkZvb3RDbGlja2VkIiwgeyBkaW1lbnNpb246IHRhZ3MuZGltZW5zaW9uIH0pOwogICAgICAgIGxpbmtzLm1hbmFnZXIuYWJNYW5pZmVzdEJvdCh0YWdzLnBvc2l0aW9uSW5mbyk7CiAgICB9KSwKfTsKCgpjcmVhdGUoZm9vdHByaW50KTsnAJf1uO4KrdsBBG1lbnUCBACX9bjuCtj3Aijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCX9bjuCq3bAQdhYkNsaWNrAgQAl/W47gr/9wLQCkBpZiAoIWxpbmtzLmFiQm90KSB7CiAgICByZXR1cm47Cn0KCmlmIChsaW5rcy5pbnB1dCkgewogICAgbGlua3MuaW5wdXQuYWJDaGF0QmFyQ2xvc2UoKTsKfQoKY29uc3QgcmVzZXQgPSB0aGF0ID8gdGhhdC5yZXNldCA6IGZhbHNlOwpjb25zdCBtZW51ID0gdGhhdCA/IHRoYXQubWVudSA6ICJjb3JlIjsKY29uc3Qgc3RhdGUgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOwoKaWYgKCFyZXNldCAmJiAobGlua3MuYWJCb3QudGFncy5pbnRlcnZhbCB8fCBzdGF0ZSkpIHsKICAgIGNvbnN0IGFiTWVudUJvdHMgPSBnZXRCb3RzKCJhYk1lbnUiLCB0cnVlKTsKCiAgICB3aGlzcGVyKGFiTWVudUJvdHMsICJhYk1lbnVSZWZyZXNoIik7CgogICAgY2xlYXJJbnRlcnZhbChsaW5rcy5hYkJvdC50YWdzLmludGVydmFsKTsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5pbnRlcnZhbCA9IG51bGw7CgogICAgY2xlYXJBbmltYXRpb25zKGxpbmtzLmFiQm90KTsKCiAgICBjb25zdCByb3RaID0gbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiUm90YXRpb25aIjsKCiAgICBpZiAoc3RhdGUgJiYgbWVudSA9PSAiY29yZSIpIHsKICAgICAgICBsaW5rcy5tZW51LmFiRW52aXJvbm1lbnRNZW51KCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBsaW5rcy5tZW51LmFiT3Blbk1lbnUobWVudSk7CiAgICB9CgogICAgYW5pbWF0ZVRhZyhsaW5rcy5hYkJvdCwgewogICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICBbcm90Wl06IGxpbmtzLmFiQm90LnRhZ3Nbcm90Wl0KICAgICAgICB9LAogICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgW3JvdFpdOiAwCiAgICAgICAgfSwKICAgICAgICBlYXNpbmc6IHsKICAgICAgICAgICAgdHlwZTogInNpbnVzb2lkYWwiLAogICAgICAgICAgICBtb2RlOiAiaW5vdXQiCiAgICAgICAgfSwKICAgICAgICBkdXJhdGlvbjogMC41CiAgICB9KS5jYXRjaChlID0+IHt9KQp9CmVsc2UgewogICAgbGlua3MuYWJCb3QuYW5pbWF0ZUJvdCgpOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IG51bGw7CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBjbGVhckludGVydmFsKGxpbmtzLmFiQm90LnRhZ3MuaW50ZXJ2YWwpOwogICAgbGlua3MuYWJCb3QubWFza3MuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiBsaW5rcy5hYkJvdC5hbmltYXRlQm90KCksIGxpbmtzLmFiQm90LnRhZ3Muc3BpbkludGVydmFsTVMpOwp9CgpzaG91dCgnb25BQkNsaWNrJywgeyBhYkJvdDogbGlua3MuYWJCb3QsIGRpbWVuc2lvbjogbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24sIG1lbnUsIHNoaWZ0S2V5OiAhIXN0YXRlLCByZXNldCB9KTsnAJf1uO4KrdsBCGFiSWdub3JlAgQAl/W47grQggMEdHJ1ZScAl/W47gqt2wEDYXNrAgQAl/W47grVggMo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAl/W47gqt2wEJYXNrQnV0dG9uAgQAl/W47gr8ggPIBUBpZiAoIXRhZ3MuYWJBd2FrZSkKewogICAgcmV0dXJuOwp9CgpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gbGlua3MubWVudS50YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IGxpbmtzLm1lbnUudGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGxpbmtzLmFzay5pZDsKYWJNZW51QnV0dG9uLmxhYmVsID0gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudUxhYmVsOwphYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51SWNvbjsKYWJNZW51QnV0dG9uLm9uQ3JlYXRlID0gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudU9uR2VuZXJhdGU7CmFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51U29ydE9yZGVyOwphYk1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51Q29sb3IgPyBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51Q29sb3IgOiBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsnAJf1uO4KrdsBCWFiQm90Q2hhdAIEAJf1uO4Kw4gD7ghAaWYgKCFsaW5rcy5hYkJvdCAmJiAhdGhhdC5ib3QpCnsKICAgIHJldHVybjsKfQoKY29uc3QgYm90QmFzZSA9IHRoYXQuYm90ID8gdGhhdC5ib3Q6IGxpbmtzLmFiQm90Owpjb25zdCBkaW1lbnNpb24gPSAhdGhhdC5ib3QgPyBib3RCYXNlLnRhZ3MuZGltZW5zaW9uIDogdGhhdC5kaW1lbnNpb24gPyB0aGF0LmRpbWVuc2lvbiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CmNvbnN0IG1lc3NhZ2UgPSB0aGF0Lm1lc3NhZ2U7CmNvbnN0IG1lc3NhZ2VUaW1lID0gdGhhdC50aW1lID8gdGhhdC50aW1lICogMTAwMCA6IDE2MDA7IAoKY29uc3QgbWVzc2FnZUJvdCA9IGF3YWl0IGxpbmtzLmJvdF9mYWN0b3J5LmFiQ3JlYXRlQmlsbGJvYXJkTGFiZWwoewogICAgYm90OiBib3RCYXNlLAogICAgbGFiZWw6IG1lc3NhZ2UsCiAgICBkaW1lbnNpb24sCiAgICBtZXNzYWdlVGltZSwKICAgIGNvbG9yOiAiIzAwMDAwMCIsCiAgICBsYWJlbENvbG9yOiAiI2ZmZmZmZiIsCiAgICBvbkJvdEFkZGVkOiBgQAogICAgICAgIGF3YWl0IG9zLnNsZWVwKHRhZ3MubWVzc2FnZVRpbWUpOwogICAgICAgIHRoaXNCb3Qub25GYWRlKCk7CiAgICBgLAogICAgb25GYWRlOiBgQAogICAgICAgIGFuaW1hdGVUYWcodGhpc0JvdCwgewogICAgICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgICAgIGZvcm1PcGFjaXR5OiAxLAogICAgICAgICAgICAgICAgbGFiZWxPcGFjaXR5OiAxLAogICAgICAgICAgICAgICAgW3RhZ3MuZGltZW5zaW9uICsgIloiXTogdGFnc1t0YWdzLmRpbWVuc2lvbiArICJaIl0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICAgICAgZm9ybU9wYWNpdHk6IDAsCiAgICAgICAgICAgICAgICBsYWJlbE9wYWNpdHk6IDAsCiAgICAgICAgICAgICAgICBbdGFncy5kaW1lbnNpb24gKyAiWiJdOiB0YWdzW3RhZ3MuZGltZW5zaW9uICsgIloiXSArIDUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHVyYXRpb246ICR7dGhhdC5kdXJhdGlvbiA/PyAzfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7fSkKICAgICAgICAuZmluYWxseSgoKSA9PiB7CiAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgfSkKCiAgICBgLAp9KTsnAJf1uO4KrdsBCWFiVmVyc2lvbgIEAJf1uO4KspEDBTEwLjM4JwCX9bjuCq3bAQlhbmltYXRpb24CBACX9bjuCriRAyjwn5SXYjI2ZTEwODktMTcyZC00NWE5LThkMjItMDVjM2Y1OGMyYmY3JwCX9bjuCq3bAQ9vbkFueUJvdENsaWNrZWQCBACX9bjuCt+RA+kHQGlmICghbGlua3MucmVtZW1iZXIudGFncy5hYlJpZ2h0Q2xpY2tEaXNhYmxlZCAmJiAhdGhhdC5ib3QudGFncy5hYlJpZ2h0Q2xpY2tJZ25vcmUgJiYgdGhhdC5tb2RhbGl0eSA9PSAibW91c2UiICYmIHRoYXQuYnV0dG9uSWQgPT0gInJpZ2h0IikgewogICAgaWYgKCF0YWdzLmFiQXdha2UpIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gYWIgc2VsZWN0ZWQKICAgIGlmICh0aGF0LmJvdCA9PSBsaW5rcy5hYkJvdCkgewogICAgICAgIGxpbmtzLm1lbnUuYWJFbnZpcm9ubWVudE1lbnUoKTsKICAgICAgICByZXR1cm47CiAgICB9ICAgIAogICAgCiAgICBjb25zdCBhcm1Cb3QgPSBhYi5saW5rcy5hcm1fdG9vbC5hYkNyZWF0ZUFybSh7CiAgICAgICAgb3JpZ2luQm90OiBsaW5rcy5hYkJvdCwKICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLAogICAgICAgIHBvc2l0aW9uOiB0aGF0LnBvc2l0aW9uLAogICAgfSkKCiAgICBjb25zdCBib3RQb3NpdGlvbiA9IGdldEJvdFBvc2l0aW9uKHRoYXQuYm90LCB0aGF0LmRpbWVuc2lvbik7CgogICAgLy8gRmFrZSB1c2VyIGRyb3BwaW5nIHRoZSBzZWxlY3RpbmcgdGhlIGJvdCB3aXRoIHRoZSBhcm0uCiAgICBhcm1Cb3Qub25Ecm9wKHsKICAgICAgICBib3Q6IGFybUJvdCwKICAgICAgICB0bzogewogICAgICAgICAgICBib3Q6IHRoYXQuYm90LAogICAgICAgICAgICB4OiBib3RQb3NpdGlvbi54LAogICAgICAgICAgICB5OiBib3RQb3NpdGlvbi55LAogICAgICAgICAgICB6OiBib3RQb3NpdGlvbi56LAogICAgICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uCiAgICAgICAgfSwKICAgICAgICBmcm9tOiB7CiAgICAgICAgICAgIHg6IGJvdFBvc2l0aW9uLngsCiAgICAgICAgICAgIHk6IGJvdFBvc2l0aW9uLnksCiAgICAgICAgICAgIHo6IGJvdFBvc2l0aW9uLnosCiAgICAgICAgICAgIGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24KICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm47Cn0nAJf1uO4KrdsBBWlucHV0AgQAl/W47grJmQMo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcAl/W47gqt2wELcGVyc29uYWxpdHkCBACX9bjuCvCZAyjwn5SXYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiJwCX9bjuCq3bAQ1hYlBlcnNvbmFsaXR5AgQAl/W47gqXmgMEdHJ1ZScAl/W47gqt2wEKYWJTZXRBd2FrZQIEAJf1uO4KnJoDjBBAbGV0IGF3YWtlID0gdGhhdD8uYXdha2U7CmxldCBpbml0aWFsID0gdGhhdD8uaW5pdGlhbCA/PyBmYWxzZTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7Cn0KCmFzc2VydCh0eXBlb2YgYXdha2UgPT09ICdib29sZWFuJywgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhd2FrZSBpcyBhIHJlcXVpcmVkIGJvb2xlYW4gcGFyYW1ldGVyLmApOwoKaWYgKGNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICAvLyBJZiBhYlN0YXlBd2FrZSBpcyBlbmFibGVkLCBvdmVycmlkZSB0aGUgaW5jb21pbmcgYXdha2UgcGFyYW1ldGVyIGFuZCBuZXZlciBsZXQgYWIgYmUgcHV0IHRvIHNsZWVwLgogICAgYXdha2UgPSB0cnVlOwp9CgppZiAodGFncy5hYkF3YWtlICE9PSBhd2FrZSkgewogICAgaWYgKGluaXRpYWwpIHsKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MucGF0dGVybikgewogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA9IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSB1dWlkKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFBsYXkgaW5pdGlhbCBhbmltYXRpb24gaWYgb25lIGlzIGRlZmluZWQgb24gYWJDb25maWcuCiAgICAgICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsQW5pbWF0aW9uKSB7CiAgICAgICAgICAgIGF3YWl0IGxpbmtzLmFuaW1hdGlvbltsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbEFuaW1hdGlvbl0oKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gU2hvdyBpbml0aWFsIG1lc3NhZ2UgaWYgb25lIGlzIGRlZmluZWQgb24gYWJDb25maWcuCiAgICAgICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsTWVzc2FnZSkgewogICAgICAgICAgICBzaG91dCgic2hvd0NvbnNvbGUiKTsKCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsTWVzc2FnZSkpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxNZXNzYWdlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgbGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxNZXNzYWdlW2ldKTsKCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgb3Muc2xlZXAoMjAwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBhYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFVwZGF0ZSBhYkF3YWtlIHNoYXJlZCB0YWcgbWFzay4KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgJ2FiQXdha2UnLCBhd2FrZSwgJ3NoYXJlZCcpOwogICAgCiAgICBpZiAoYXdha2UpIHsKICAgICAgICBsZXQgZGltZW5zaW9uID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8/IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CgogICAgICAgIGlmICghZGltZW5zaW9uKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvc2l0aW9uID0geyB4OiAwLCB5OiAwIH07CgogICAgICAgIGF3YWl0IHRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7IGRpbWVuc2lvbiwgcG9zaXRpb24gfSk7CgogICAgICAgIHNob3V0KCJvbkFCQXdha2UiLCB7IGRpbWVuc2lvbiwgcG9zaXRpb24sIGluaXRpYWwgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwogICAgICAgIHNob3V0KCJvbkFCU2xlZXAiKTsKICAgIH0KfScAl/W47gqt2wEFdXRpbHMCBACX9bjuCqmqAyjwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwCX9bjuCq3bAQtib3RfZmFjdG9yeQIEAJf1uO4K0KoDKPCflJdjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcnAJf1uO4KrdsBD29uQUJJbml0aWFsaXplZAIEAJf1uO4K96oDfkBpZiAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsKSB7DQogICAgdGhpc0JvdC5vblBvcnRhbENoYW5nZWQoe3BvcnRhbDogIm1hcFBvcnRhbCIsIGRpbWVuc2lvbjogY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsIH0pOw0KfScAl/W47gqt2wEFZGVidWcCBACX9bjuCvarAwVmYWxzZScAl/W47gqt2wEaZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24CBACX9bjuCvyrA6kLQGFzeW5jIGZ1bmN0aW9uIGdldERlZmF1bHRNYW5pZmVzdFBvc2l0aW9uKHBvcnRhbDogJ21hcCcgfCAnZ3JpZCcpOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH0gewogICAgaWYgKHBvcnRhbCA9PT0gJ2dyaWQnKSB7CiAgICAgICAgcmV0dXJuIHsgeDogMCwgeTogMCB9CiAgICB9IGVsc2UgaWYgKHBvcnRhbCA9PT0gJ21hcCcpIHsKICAgICAgICBpZiAodHlwZW9mIGxpbmtzLnJlbWVtYmVyLnRhZ3MubWFwWm9vbVBvc2l0aW9uPy54ID09PSAnbnVtYmVyJyAmJiAgdHlwZW9mIGxpbmtzLnJlbWVtYmVyLnRhZ3MubWFwWm9vbVBvc2l0aW9uPy55ID09PSAnbnVtYmVyJykgewogICAgICAgICAgICByZXR1cm4gbGlua3MucmVtZW1iZXIudGFncy5tYXBab29tUG9zaXRpb247CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGV0IGN1cnJlbnRQb3NpdGlvbiA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgbGV0IGhhc0dlb2xvY2F0aW9uUGVybWlzc2lvbiA9IGF3YWl0IGxpbmtzLnV0aWxzLmhhc0dlb2xvY2F0aW9uUGVybWlzc2lvbigpOwoKICAgICAgICAgICAgLy8gQ3VycmVudCB3b3JrLWFyb3VuZCBmb3IgYWxsb3dpbmcgZ2VvbG9jYXRpb24gZm9yIGlPUyBhcHAKICAgICAgICAgICAgaWYgKGdldEJvdCgic3lzdGVtIiwgImFiLmlvc2JyaWRnZS5tZXNzZW5nZXIiKSkgewogICAgICAgICAgICAgICAgaGFzR2VvbG9jYXRpb25QZXJtaXNzaW9uID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGhhc0dlb2xvY2F0aW9uUGVybWlzc2lvbikgewogICAgICAgICAgICAgICAgY29uc3QgZ2VvbG9jYXRpb24gPSBhd2FpdCBvcy5nZXRHZW9sb2NhdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKGdlb2xvY2F0aW9uLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UG9zaXRpb24gPSB7IHg6IGdlb2xvY2F0aW9uLmxvbmdpdHVkZSwgeTogZ2VvbG9jYXRpb24ubGF0aXR1ZGUgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY3VycmVudFBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFBvc2l0aW9uOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gR1JQTSBQb3NpdGlvbgogICAgICAgICAgICAgICAgcmV0dXJuIHsgeDogLTg1LjY3NjE4OTQ4MjI0MzQsIHk6IDQyLjk2NTY3NTY3NTY3NTYgfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHVucmVjb25naXplZCBwb3J0YWwgdHlwZSBwcm92aWRlZCB0byBnZXREZWZhdWx0TWFuaWZlc3RQb3NpdGlvbjpgLCBwb3J0YWwpOwogICAgICAgIHJldHVybiB7IHg6IDAsIHk6IDAgfQogICAgfQp9CgpyZXR1cm4gZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24odGhhdCk7JwCX9bjuCq3bARJnZXRTdGFydENhbWVyYVpvb20CBACX9bjuCqa3A5AEQGFzeW5jIGZ1bmN0aW9uIGdldFN0YXJ0Q2FtZXJhWm9vbShwb3J0YWw6ICdtYXAnIHwgJ2dyaWQnKTogbnVtYmVyIHwgbnVsbCB7CiAgICBpZiAocG9ydGFsID09PSAnZ3JpZCcpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0gZWxzZSBpZiAocG9ydGFsID09PSAnbWFwJykgewogICAgICAgIGlmICh0eXBlb2YgbGlua3MucmVtZW1iZXIudGFncy5tYXBTdGFydFpvb20gPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgIHJldHVybiBsaW5rcy5yZW1lbWJlci50YWdzLm1hcFN0YXJ0Wm9vbTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB1bnJlY29uZ2l6ZWQgcG9ydGFsIHR5cGUgcHJvdmlkZWQgdG8gZ2V0U3RhcnRDYW1lcmFab29tOmAsIHBvcnRhbCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cn0KCnJldHVybiBnZXRTdGFydENhbWVyYVpvb20odGhhdCk7JwCX9bjuCq3bARRkZWZhdWx0TWFwUG9ydGFsWm9vbQIEAJf1uO4Kt7sDBDEwMDAnAJf1uO4KrdsBEG9uQUJCZWZvcmVVcGRhdGUCBACX9bjuCry7AzZAY29uZmlnQm90LnRhZ3MuYWJXYXNBd2FrZUJlZm9yZVVwZGF0ZSA9IHRhZ3MuYWJBd2FrZTsnAJf1uO4KrdsBC29uQUJVcGRhdGVkAgQAl/W47grzuwOPAUBpZiAoY29uZmlnQm90LnRhZ3MuYWJXYXNBd2FrZUJlZm9yZVVwZGF0ZSkgewogICAgY29uZmlnQm90LnRhZ3MuYWJXYXNBd2FrZUJlZm9yZVVwZGF0ZSA9IG51bGw7CiAgICBhd2FpdCB0aGlzQm90LmFiU2V0QXdha2UoeyBhd2FrZTogdHJ1ZSB9KQp9JwCX9bjuCq3bARVkZWZhdWx0R3JpZFBvcnRhbFpvb20CBACX9bjuCoO9AwIyMCcAl/W47gqt2wEJb25BQkF3YWtlAgQAl/W47gqGvQPCAUBjb25zdCB7IGRpbWVuc2lvbiwgcG9zaXRpb24sIGluaXRpYWwgfSA9IHRoYXQ7CgppZiAoaW5pdGlhbCAmJiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09PSBkaW1lbnNpb24pIHsKICAgIG9zLmZvY3VzT24ocG9zaXRpb24sIHsgem9vbTogdGFncy5kZWZhdWx0R3JpZFBvcnRhbFpvb20sIHBvcnRhbDogJ2dyaWRQb3J0YWwnIH0pOwp9AA=="}]}