{"version":2,"updates":[{"id":0,"timestamp":1766177007598,"update":"Aa8Bpon/xAEAJwEEYm90cyQxNjU1NGJjMS1lOTNlLTRhMGItOGNkMy1kZmQ3NzIzMTk2NzIBJwCmif/EAQAJYWJWZXJzaW9uAgQApon/xAEBBTEwLjM0JwCmif/EAQAGc3lzdGVtAgQApon/xAEHFmFiLnBlcnNvbmFsaXR5LnZlcnNpb24nAKaJ/8QBABlhYlBlcnNvbmFsaXR5TWFqb3JWZXJzaW9uAgQApon/xAEeATEnAKaJ/8QBAA1vblNraWxsVXBkYXRlAgQApon/xAEgrQFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJQZXJzb25hbGl0eU1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJQZXJzb25hbGl0eU1pbm9yVmVyc2lvbjsKCmNvbnNvbGUubG9nKCJbQUJQZXJzb25hbGl0eV0gTG9hZGVkIEFCIFBlcnNvbmFsaXR5IHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycApon/xAEADWFiUGVyc29uYWxpdHkCBACmif/EAc4BBHRydWUnAKaJ/8QBAAhhYklnbm9yZQIEAKaJ/8QB0wEEdHJ1ZScApon/xAEABGZvcm0CBACmif/EAdgBB25vdGhpbmcnAKaJ/8QBABlhYlBlcnNvbmFsaXR5TWlub3JWZXJzaW9uAgQApon/xAHgAQQyMy4xJwEEYm90cyRiMjZlMTA4OS0xNzJkLTQ1YTktOGQyMi0wNWMzZjU4YzJiZjcBJwCmif/EAeUBBnN5c3RlbQIEAKaJ/8QB5gEYYWIucGVyc29uYWxpdHkuYW5pbWF0aW9uJwCmif/EAeUBBGZvcm0CBACmif/EAf8BB25vdGhpbmcnAKaJ/8QB5QEIYWJJZ25vcmUCBACmif/EAYcCBHRydWUnAKaJ/8QB5QENbWFuaWZlc3RhdGlvbgIEAKaJ/8QBjAIo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcApon/xAHlAQhyZW1lbWJlcgIEAKaJ/8QBswIo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycApon/xAHlARhhbmltYXRpb25fYWJHcmlkTWFuaWZlc3QCBACmif/EAdoC+g5Ac2hvdXQoInJlc2V0Iik7Cgpjb25zdCBwb3NpdGlvblggPSB0aGF0Py5wb3NpdGlvbi54ID8/IDA7CmNvbnN0IHBvc2l0aW9uWSA9IHRoYXQ/LnBvc2l0aW9uLnkgPz8gMDsKY29uc3QgZGltZW5zaW9uID0gdGhhdD8uZGltZW5zaW9uID8/ICJob21lIjsKY29uc3QgZ3JpZFNjYWxlID0gdGhhdD8uc2NhbGUgPz8gNTsKY29uc3QgbW9tZW50Q291bnQgPSAwOwpjb25zdCBncmlkQm90ID0ge307CgpncmlkQm90LnNwYWNlID0gInRlbXBMb2NhbCI7CmdyaWRCb3QuY29sb3IgPSAiY2xlYXIiOwpncmlkQm90LnN0cm9rZUNvbG9yID0gYWJQZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwpncmlkQm90LnNjYWxlID0gMC4wMDE7CmdyaWRCb3Quc2NhbGVaID0gMC4xOwpncmlkQm90LnJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwpncmlkQm90W2RpbWVuc2lvbl0gPSB0cnVlOwpncmlkQm90LnBvaW50YWJsZSA9IGZhbHNlOwpncmlkQm90LmtpbGxUaW1lciA9ICJAIGF3YWl0IG9zLnNsZWVwKDQwMCk7IGRlc3Ryb3kodGhpc0JvdCk7IjsKCmxldCByb3VuZEJvdHM7Cgpmb3IgKGxldCBpID0gZ3JpZFNjYWxlOyBpID4gMDsgaS0tKQp7CiAgICBjb25zdCBib3RDb3VudCA9IGkgKiA4OwoKICAgIGxldCBzaWRlQ291bnQgPSAwOwogICAgbGV0IHBoYXNlRmFjdG9yID0gMDsKCiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJvdENvdW50OyBqKyspCiAgICB7CiAgICAgICAgaWYgKHBoYXNlRmFjdG9yID09IDApCiAgICAgICAgewogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJYIl0gPSAoKGkgKyBwb3NpdGlvblgpICogLTEpICsgc2lkZUNvdW50OwogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJZIl0gPSBpICsgcG9zaXRpb25ZOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChwaGFzZUZhY3RvciA9PSAxKQogICAgICAgIHsKICAgICAgICAgICAgZ3JpZEJvdFtkaW1lbnNpb24gKyAiWCJdID0gaSArIHBvc2l0aW9uWDsKICAgICAgICAgICAgZ3JpZEJvdFtkaW1lbnNpb24gKyAiWSJdID0gKGkgKyBwb3NpdGlvblkpIC0gc2lkZUNvdW50OyAgCiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBoYXNlRmFjdG9yID09IDIpCiAgICAgICAgewogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJYIl0gPSAoaSArIHBvc2l0aW9uWCkgLSBzaWRlQ291bnQ7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlkiXSA9ICgoaSArIHBvc2l0aW9uWSkgKiAtMSkgOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJYIl0gPSAoKGkgKyBwb3NpdGlvblgpICogLTEpIDsKICAgICAgICAgICAgZ3JpZEJvdFtkaW1lbnNpb24gKyAiWSJdID0gKChpICsgcG9zaXRpb25ZKSAqIC0xKSArIHNpZGVDb3VudDsgIAogICAgICAgIH0KCiAgICAgICAgY29uc3QgbmV3R3JpZEJvdCA9IGF3YWl0IGNyZWF0ZShncmlkQm90KTsKCiAgICAgICAgYW5pbWF0ZVRhZyhuZXdHcmlkQm90LCAic2NhbGUiLCB7CiAgICAgICAgICAgIHRvVmFsdWU6IDEsCiAgICAgICAgICAgIGVhc2luZzogewogICAgICAgICAgICAgICAgdHlwZTogImVsYXN0aWMiLAogICAgICAgICAgICAgICAgbW9kZTogIm91dCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHVyYXRpb246IDAuMDEKICAgICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7CgogICAgICAgIG5ld0dyaWRCb3Qua2lsbFRpbWVyKCk7CgogICAgICAgIHNpZGVDb3VudCsrOwoKICAgICAgICBpZiAoc2lkZUNvdW50ID09IGJvdENvdW50IC8gNCkKICAgICAgICB7CiAgICAgICAgICAgIHNpZGVDb3VudCA9IDA7CgogICAgICAgICAgICBwaGFzZUZhY3RvcisrOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgb3Muc2xlZXAoOCk7CiAgICB9Cn0nAKaJ/8QB5QEJYWJWZXJzaW9uAgQApon/xAHVEQUxMC4zNCcApon/xAHlAQZvbkNoYXQCBACmif/EAdsRVUAvLyBpZiAodGhhdC5tZXNzYWdlID09ICJAdGVzdCIpCi8vIHsKLy8gICAgIHRoaXNCb3QuYW5pbWF0aW9uX2FiR3JpZE1hbmlmZXN0KCk7Ci8vIH0nAKaJ/8QB5QELcGVyc29uYWxpdHkCBACmif/EAbESKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAKaJ/8QB5QENYWJQZXJzb25hbGl0eQIEAKaJ/8QB2BIEdHJ1ZScBBGJvdHMkYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiAScApon/xAHdEgZzeXN0ZW0CBACmif/EAd4SFWFiLnBlcnNvbmFsaXR5LmNvbmZpZycApon/xAHdEghhYklnbm9yZQIEAKaJ/8QB9BIEdHJ1ZScApon/xAHdEgRmb3JtAgQApon/xAH5Egdub3RoaW5nJwCmif/EAd0SC2FiQmFzZUNvbG9yAgQApon/xAGBEwcjMDBEOUNEJwCmif/EAd0SEWFiQmFzZVN0cm9rZUNvbG9yAgQApon/xAGJEwcjMDBEOUNEJwCmif/EAd0SEGFiQmx1ZXByaW50Q29sb3ICBACmif/EAZETByMwMDgyN0InAKaJ/8QB3RIIcmVtZW1iZXICBACmif/EAZkTKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAKaJ/8QB3RIRYWJCdWlsZGVySWRlbnRpdHkCBACmif/EAcATCmNhc3VhbC5ib3QnAKaJ/8QB3RIJYWJWZXJzaW9uAgQApon/xAHLEwUxMC4zNCcApon/xAHdEhdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZwIEAKaJ/8QB0RPyE0BpZiAoIXRoYXQpIHsNCiAgICByZXR1cm47DQp9DQoNCmlmICghYXV0aEJvdCkgew0KICAgIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7DQp9DQoNCmlmICghYXV0aEJvdCkgew0KICAgIHJldHVybjsNCn0NCg0KYXdhaXQgb3MuZ3JhbnRJbnN0QWRtaW5QZXJtaXNzaW9uKGF1dGhCb3QuaWQpOw0KDQpsZXQgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSBhd2FpdCBvcy5nZXREYXRhKGF1dGhCb3QuaWQsICJhYlBlcnNvbmFsaXR5Q29uZmlnIik7DQoNCmlmIChhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YS5zdWNjZXNzID09IGZhbHNlKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSB7fTsNCn0gZWxzZSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YS5kYXRhOw0KfQ0KDQppZiAodGhhdC5uYW1lKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQnVpbGRlcklkZW50aXR5Il0gPSB0aGF0Lm5hbWU7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCdWlsZGVySWRlbnRpdHkiLCB0aGF0Lm5hbWUsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5jb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VDb2xvciJdID0gdGhhdC5jb2xvcjsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCYXNlU3Ryb2tlQ29sb3IiXSA9IHRoYXQuY29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlQ29sb3IiLCB0aGF0LmNvbG9yLCAibG9jYWwiKTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VTdHJva2VDb2xvciIsIHRoYXQuY29sb3IsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5wb3J0YWxDb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiXSA9IHRoYXQucG9ydGFsQ29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlR3JpZFBvcnRhbENvbG9yIiwgdGhhdC5wb3J0YWxDb2xvciwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0Lm1lbnVDb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VNZW51Q29sb3IiXSA9IHRoYXQubWVudUNvbG9yOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiQmFzZU1lbnVDb2xvciIsIHRoYXQubWVudUNvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQubWVudUxhYmVsQ29sb3IpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCYXNlTGFiZWxDb2xvciJdID0gdGhhdC5tZW51TGFiZWxDb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VMYWJlbENvbG9yIiwgdGhhdC5tZW51TGFiZWxDb2xvciwgImxvY2FsIik7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZVNoYWRvd0NvbG9yIl0gPSB0aGF0Lm1lbnVMYWJlbENvbG9yOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiQmFzZVNoYWRvd0NvbG9yIiwgdGhhdC5tZW51TGFiZWxDb2xvciwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LmZvcm0pIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJGb3JtIl0gPSB0aGF0LmZvcm07DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJGb3JtIiwgdGhhdC5mb3JtLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQuYWlNb2RlbCkgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYlByZWZlcnJlZEFJTW9kZWwiXSA9IHRoYXQuYWlNb2RlbDsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYlByZWZlcnJlZEFJTW9kZWwiLCB0aGF0LmFpTW9kZWwsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5kZWZhdWx0UGVyc29uYWxpdHkpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IHt9Ow0KICAgIHRoaXNCb3QudXBkYXRlUGVyc29uYWxpdHkoe30pOw0KfQ0KDQppZiAodGhhdC5tYXBCYXNlbWFwKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiTWFwUG9ydGFsQmFzZSJdID0gdGhhdC5tYXBCYXNlbWFwOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiTWFwUG9ydGFsQmFzZSIsIHRoYXQubWFwQmFzZW1hcCwgImxvY2FsIik7DQp9DQoNCmNvbnN0IHJlc3VsdCA9IGF3YWl0IG9zLnJlY29yZERhdGEoYXV0aEJvdC5pZCwgImFiUGVyc29uYWxpdHlDb25maWciLCBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSk7DQoNCmlmIChyZXN1bHQuc3VjY2Vzcykgew0KICAgIGFiLmxpbmtzLnV0aWxzLmFiTG9nKHsgbWVzc2FnZTogYHVwZGF0ZWQgcGVyc29uYWxpdHkgY29uZmlnIGluIHVzZXIgcmVjb3JkYCwgbG9nVHlwZTogJ2xvZyd9KTsNCn0gZWxzZSB7DQogICAgYWIubGlua3MudXRpbHMuYWJMb2coeyBtZXNzYWdlOiBgZmFpbGVkIHRvIHVwZGF0ZSBwZXJzb25hbGl0eSBjb25maWcgaW4gdXNlciByZWNvcmQuXG4ke0pTT04uc3RyaW5naWZ5KHJlc3VsdCwgdW5kZWZpbmVkLCAyKX1gLCBsb2dUeXBlOiAnZXJyb3InfSk7DQp9DQoNCnNob3V0KCdvbkFCUGVyc29uYWxpdHlDaGFuZ2VkJywgeyBib3Q6IHRoaXNCb3QgfSk7JwCmif/EAd0SD2FiQmFzZU1lbnVDb2xvcgIEAKaJ/8QBxCcHIzAwRDlDRCcApon/xAHdEhF1cGRhdGVQZXJzb25hbGl0eQIEAKaJ/8QBzCeWF0BpZiAodGFncy5kZWJ1Zykgew0KICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdXBkYXRlIHN0YXJ0YCk7DQp9DQoNCmlmICh0aGlzQm90LnZhcnMudXBkYXRpbmdQZXJzb25hbGl0eSkgew0KICAgIHJldHVybjsNCn0NCg0KdGhpc0JvdC52YXJzLnVwZGF0aW5nUGVyc29uYWxpdHkgPSB0cnVlOw0KDQpsZXQgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGE7DQoNCmlmICh0aGF0ICYmIHRoYXQgPT0ge30pIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IHt9Ow0KfSBlbHNlIHsNCiAgICBpZiAoIWF1dGhCb3QpIHsNCiAgICAgICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsNCiAgICB9DQoNCiAgICBpZiAoYXV0aEJvdCkgew0KICAgICAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGF3YWl0IG9zLmdldERhdGEoYXV0aEJvdC5pZCwgImFiUGVyc29uYWxpdHlDb25maWciKTsNCiAgICAgICAgaWYgKCFsaW5rcy5yZW1lbWJlciAmJiBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YS5zdWNjZXNzID09IGZhbHNlKSB7DQogICAgICAgICAgICB0aGlzQm90LnZhcnMudXBkYXRpbmdQZXJzb25hbGl0eSA9IGZhbHNlOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGFiUGVyc29uYWxpdHlDb25maWdEYXRhLnN1Y2Nlc3MpIHsNCiAgICAgICAgICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhID0gYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEuZGF0YTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KaWYgKHRhZ3MuZGVidWcpIHsNCiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFiUGVyc29uYWxpdHlDb25maWdEYXRhOmAsIHsuLi5hYlBlcnNvbmFsaXR5Q29uZmlnRGF0YX0pOw0KfQ0KDQovL2FiQmx1ZVByaW50Q29sb3INCi8vYWJCYXNlQWNjZW50Q29sb3INCmNvbnN0IGFiVGFncyA9IFsNCiAgICAiYWJCYXNlQ29sb3IiLA0KICAgICJhYkJhc2VNZW51Q29sb3IiLA0KICAgICJhYkJ1aWxkZXJJZGVudGl0eSIsDQogICAgImFiQmFzZVN0cm9rZUNvbG9yIiwNCiAgICAiYWJCYXNlR3JpZFBvcnRhbENvbG9yIiwNCiAgICAiYWJCYXNlTGFiZWxDb2xvciIsDQogICAgImFiQmFzZVNoYWRvd0NvbG9yIiwNCiAgICAiYWJQcmVmZXJyZWRBSU1vZGVsIiwNCiAgICAiYWJDYXRhbG9nTmFtZSIsDQogICAgImFiTWFwUG9ydGFsQmFzZSINCl07DQoNCmNsZWFyVGFnTWFza3ModGhpc0JvdCk7DQoNCi8vIFJ5YW4gKEF1ZyAyOSwgMjAyNSk6IGltIG5vdCBzdXJlIGV4YWN0bHkgd2hhdCBpcyBoYXBwZW5pbmcgaGVyZSBidXQgd2l0aG91dCBzbGVlcGluZyBvbiB0aGVzZSBiaWcgdGFnIG1hc2sgY2hhbmdlcywgdGhleSBkb250IGFsbCBzZWVtIHRvIGNvbWUgaW4gcHJvcGVybHkuDQphd2FpdCBvcy5zbGVlcCgxMDApOw0KDQpmb3IgKGxldCBpID0gMDsgaSA8IGFiVGFncy5sZW5ndGg7ICsraSkgew0KICAgIGlmIChhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSAmJiBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVthYlRhZ3NbaV1dKSB7DQogICAgICAgIGlmICh0YWdzW2FiVGFnc1tpXV0gIT0gYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbYWJUYWdzW2ldXSkgew0KICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNldHRpbmcgJHthYlRhZ3NbaV19IGxvY2FsIG1hc2sgZnJvbSBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YTogJHthYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVthYlRhZ3NbaV1dfWApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCBhYlRhZ3NbaV0sIGFiUGVyc29uYWxpdHlDb25maWdEYXRhW2FiVGFnc1tpXV0sICJsb2NhbCIpOw0KICAgICAgICB9DQogICAgfSBlbHNlIGlmIChsaW5rcy5yZW1lbWJlciAmJiBsaW5rcy5yZW1lbWJlci50YWdzW2FiVGFnc1tpXV0pIHsNCiAgICAgICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3NbYWJUYWdzW2ldXSAhPSB0YWdzW2FiVGFnc1tpXV0pIHsNCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzZXR0aW5nICR7YWJUYWdzW2ldfSBsb2NhbCBtYXNrIGZyb20gYWIgcmVtZW1iZXIgYm90OmAsIGxpbmtzLnJlbWVtYmVyLnRhZ3NbYWJUYWdzW2ldXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsIGFiVGFnc1tpXSwgbGlua3MucmVtZW1iZXIudGFnc1thYlRhZ3NbaV1dLCAibG9jYWwiKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGlmIChhYlRhZ3NbaV0gPT0gImFiQmFzZUdyaWRQb3J0YWxDb2xvciIpIHsNCiAgICAgICAgZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENvbG9yID0gdGFncy5hYkJhc2VHcmlkUG9ydGFsQ29sb3I7DQogICAgfQ0KDQogICAgaWYgKGFiVGFnc1tpXSA9PSAiYWJNYXBQb3J0YWxCYXNlIikgew0KICAgICAgICBtYXBQb3J0YWxCb3QudGFncy5tYXBQb3J0YWxCYXNlbWFwID0gdGFncy5hYk1hcFBvcnRhbEJhc2U7DQogICAgICAgIG1pbmlNYXBQb3J0YWxCb3QudGFncy5tYXBQb3J0YWxCYXNlbWFwID0gdGFncy5hYk1hcFBvcnRhbEJhc2U7DQogICAgfQ0KfQ0KDQovLyBSeWFuIChBdWcgMjksIDIwMjUpOiBpbSBub3Qgc3VyZSBleGFjdGx5IHdoYXQgaXMgaGFwcGVuaW5nIGhlcmUgYnV0IHdpdGhvdXQgc2xlZXBpbmcgb24gdGhlc2UgYmlnIHRhZyBtYXNrIGNoYW5nZXMsIHRoZXkgZG9udCBhbGwgc2VlbSB0byBjb21lIGluIHByb3Blcmx5Lg0KYXdhaXQgb3Muc2xlZXAoMTAwKTsNCg0KdGhpc0JvdC52YXJzLnVwZGF0aW5nUGVyc29uYWxpdHkgPSBmYWxzZTsNCnNob3V0KCdvbkFCUGVyc29uYWxpdHlVcGRhdGVkJywgeyBib3Q6IHRoaXNCb3QgfSk7JwCmif/EAd0SDWFiUGVyc29uYWxpdHkCBACmif/EAeM+BHRydWUnAKaJ/8QB3RINb25Ta2lsbFVwZGF0ZQIEAKaJ/8QB6D4dQHRoaXNCb3QudXBkYXRlUGVyc29uYWxpdHkoKTsnAKaJ/8QB3RIRYWJCYXNlU2hhZG93Q29sb3ICBACmif/EAYY/BWJsYWNrJwCmif/EAd0SEGFiQmFzZUxhYmVsQ29sb3ICBACmif/EAYw/BWJsYWNrJwCmif/EAd0SCm1hcE9wdGlvbnMCBACmif/EAZI/ngfwn6esWw0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgInNhdGVsbGl0ZSIsDQogICAgICAgICJpZCI6ICJzYXRlbGxpdGUiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJoeWJyaWQiLA0KICAgICAgICAiaWQiOiAiaHlicmlkIg0KICAgIH0sDQogICAgew0KICAgICAgICAibmFtZSI6ICAib2NlYW5zIiwNCiAgICAgICAgImlkIjogIm9jZWFucyINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgIm9wZW4gc3RyZWV0IG1hcCIsDQogICAgICAgICJpZCI6ICJvc20iDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJ0ZXJyYWluIiwNCiAgICAgICAgImlkIjogInRlcnJhaW4iDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJkYXJrIGdyYXkgY2FudmFzIiwNCiAgICAgICAgImlkIjogImRhcmstZ3JheSINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgImdyYXkgY2FudmFzIiwNCiAgICAgICAgImlkIjogImdyYXkiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJzdHJlZXRzIiwNCiAgICAgICAgImlkIjogInN0cmVldHMiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJzdHJlZXRzIChkYXJrKSIsDQogICAgICAgICJpZCI6ICJzdHJlZXRzLW5pZ2h0LXZlY3RvciINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgInN0cmVldHMgKG5hdmlnYXRpb24pIiwNCiAgICAgICAgImlkIjogInN0cmVldHMtbmF2aWdhdGlvbi12ZWN0b3IiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJ0b3BvZ3JhcGhpYyIsDQogICAgICAgICJpZCI6ICJ0b3BvIg0KICAgIH0sDQogICAgew0KICAgICAgICAibmFtZSI6ICAic3RyZWV0cyAocmVsaWVmKSIsDQogICAgICAgICJpZCI6ICJzdHJlZXRzLXJlbGllZi12ZWN0b3IiDQogICAgfQ0KXScApon/xAHdEhRzaG93QUJCYXNlbWFwT3B0aW9ucwIEAKaJ/8QBr0bEBUBzaG91dCgiY2xlYXJBQkJhc2VtYXBPcHRpb25zTWVudSIpOw0KDQpzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCA9ICdhYkJhc2VtYXBPcHRpb25zTWVudSc7DQoNCmZvciAoY29uc3Qgb3B0aW9uIG9mIHRhZ3MubWFwT3B0aW9ucykgew0KICAgIGlmIChvcHRpb24uaWQgPT0gbWFwUG9ydGFsQm90LnRhZ3MubWFwUG9ydGFsQmFzZW1hcCkgew0KICAgICAgICBjb250aW51ZTsNCiAgICB9DQogICAgY29uc3Qgb3B0aW9uT2JqID0gDQogICAgew0KICAgICAgICBhYkJhc2VtYXBPcHRpb25zTWVudTogdHJ1ZSwNCiAgICAgICAgY2xlYXJBQkJhc2VtYXBPcHRpb25zTWVudTogYEBkZXN0cm95KHRoaXNCb3QpO2AsDQogICAgICAgIG1hcElEOiBvcHRpb24uaWQsDQogICAgICAgIGxhYmVsOiBvcHRpb24ubmFtZSwNCiAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgIG1hcFBvcnRhbEJvdC50YWdzLm1hcFBvcnRhbEJhc2VtYXAgPSB0YWdzLm1hcElEOw0KICAgICAgICAgICAgc2hvdXQoJ2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnJywgeydtYXBCYXNlbWFwJzogdGFncy5tYXBJRH0pOyANCiAgICAgICAgICAgIHNob3V0KCJjbGVhckFCQmFzZW1hcE9wdGlvbnNNZW51Iik7DQogICAgICAgIGANCiAgICB9DQoNCiAgICBhYi5saW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihvcHRpb25PYmopOw0KfScApon/xAHdEgtvbkdyaWRDbGljawIEAKaJ/8QB9EsmQHNob3V0KCJjbGVhckFCQmFzZW1hcE9wdGlvbnNNZW51Iik7DQonAKaJ/8QB3RIFZGVidWcCBACmif/EAZtMBWZhbHNlJwEEYm90cyRiOWI4MjgxOS0xZjE0LTQzOTItODhhOS01MmY2N2E5ZjhlNTUBJwCmif/EAaFMBnN5c3RlbQIEAKaJ/8QBokwYYWIucGVyc29uYWxpdHkuYXJtX251ZGdlJwCmif/EAaFMDW9uQUJBcm1QbGFjZWQCBACmif/EAbtMOEBzZXRUYWdNYXNrKHRoaXNCb3QsICdoYXNBcm1CZWVuUGxhY2VkJywgdHJ1ZSwgJ2xvY2FsJyk7JwCmif/EAaFMCW9uQUJBd2FrZQIEAKaJ/8QB9EwwQGF3YWl0IG9zLnNsZWVwKDI1MCk7CnRoaXNCb3QuYWJTdGFydEFybU51ZGdlKCk7JwCmif/EAaFMCGFiSWdub3JlAgQApon/xAGlTQR0cnVlJwCmif/EAaFMDWFiUGVyc29uYWxpdHkCBACmif/EAapNBHRydWUnAKaJ/8QBoUwEZm9ybQIEAKaJ/8QBr00Hbm90aGluZycApon/xAGhTAVsZWFybgIEAKaJ/8QBt00o8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycApon/xAGhTA1tYW5pZmVzdGF0aW9uAgQApon/xAHeTSjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCmif/EAaFMCHJlbWVtYmVyAgQApon/xAGFTijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCmif/EAaFMBWRlYnVnAgQApon/xAGsTgVmYWxzZScApon/xAGhTA5hcm1OdWRnZVdhaXRNUwIEAKaJ/8QBsk4ENTAwMCcApon/xAGhTA9vbkFCSW5pdGlhbGl6ZWQCBACmif/EAbdOG0B0aGlzQm90LmFiU3RhcnRBcm1OdWRnZSgpOycApon/xAGhTA9hYlN0YXJ0QXJtTnVkZ2UCBACmif/EAdNOnR1AaWYgKHRoaXNCb3QudmFycy5udWRnZUFjdGl2ZSkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoZXJlIGlzIGFscmVhZHkgYSBudWRnZSBpbiBwcm9ncmVzcy5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKdGhpc0JvdC52YXJzLm51ZGdlQWN0aXZlID0gdHJ1ZTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHN0YXJ0aW5nIG51ZGdlLi4uYCkKfQoKZnVuY3Rpb24gY2FuTnVkZ2UoKTogYm9vbGVhbiB7CiAgICAvLyBDYW4ndCBoYXZlIHBsYWNlZCB0aGUgYXJtIGFscmVhZHkuCiAgICBpZiAodGFncy5oYXNBcm1CZWVuUGxhY2VkKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYW5ub3QgbnVkZ2U6IGFybSBwbGFjZW1lbnQgaGFzIGFscmVhZHkgb2NjdXJlZC5gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIEFCIG1hbmlmZXN0YXRpb24gYm90IG11c3QgYmUgYWN0aXZlLgogICAgaWYgKCFsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYW5ub3QgbnVkZ2U6IGFiIG1hbmlmZXN0YXRpb24gYm90IGlzIGluYWN0aXZlLmApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gVGhlIGluc3QgbXVzdCBiZSBlbXB0eSBvZiBhbGwgYm90cy4gVGhlIGV4Y2VwdGlvbnMgYXJlIGFiIGJvdHMgYW5kIGJ1aWx0LWluIGJvdHMuCiAgICBjb25zdCB1c2VyTWFkZUJvdCA9IGdldEJvdCgoYikgPT4gewogICAgICAgIHJldHVybiAhYi50YWdzLnN5c3RlbT8uc3RhcnRzV2l0aCgnYWIuJykgJiYKICAgICAgICAgICAgICAgIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICAhYi50YWdzLmFiRWdnICYmIC8vIERvbid0IGluY2x1ZGUgYWJFZ2cgYm90cyBhcyAidXNlciBtYWRlIi4KICAgICAgICAgICAgICAgICFiLnRhZ3MuYWJMb2FkZWRTa2lsbCAmJiAvLyBEb24ndCBpbmNsdWRlIGxvYWRlZCBza2lsbCBib3RzIGFzICJ1c2VyIG1hZGUiLgogICAgICAgICAgICAgICAgIWIudGFncy5hYkJvdCAvLyBEb24ndCBpbmNsdWRlIGFueSBib3RzIHRoYXQgYXJlIGZsYWdnZWQgd2l0aCBhbiBhYkJvdCB0YWcuCiAgICB9KQogICAgCiAgICBpZiAodXNlck1hZGVCb3QpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1Z1VzZXJNYWRlQm90cykgewogICAgICAgICAgICAgICAgY29uc3QgdXNlck1hZGVCb3RzID0gZ2V0Qm90cygoYikgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhYi50YWdzLnN5c3RlbT8uc3RhcnRzV2l0aCgnYWIuJykgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhYi50YWdzLmFiRWdnIC8vIERvbid0IGluY2x1ZGUgYWJFZ2cgYm90cyBhcyAidXNlciBtYWRlIi4KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogaW5zdCBjb250YWlucyB1c2VyIG1hZGUgYm90cy5gLCB1c2VyTWFkZUJvdHMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYW5ub3QgbnVkZ2U6IGluc3QgY29udGFpbnMgdXNlciBtYWRlIGJvdHMuYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIE1lbnUgcG9ydGFsIG11c3QgZWl0aGVyIGJlIGluYWN0aXZlIG9yIG5vdCBoYXZlIGFueSBib3RzIGluIHRoZSBjdXJyZW50bHkgYWN0aXZlIG1lbnUgcG9ydGFsLgogICAgaWYgKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwpIHsKICAgICAgICBjb25zdCBib3RJbk1lbnVQb3J0YWwgPSBnZXRCb3QoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIudGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9PT0gdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICBpZiAoYm90SW5NZW51UG9ydGFsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogbWVudVBvcnRhbCBpcyBjdXJyZW50bHkgb3BlbiBhbmQgaGFzIGJvdHMgaW4gaXQuYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKaWYgKGNhbk51ZGdlKCkpIHsKICAgIC8vIFN0YXJ0IG51ZGdlIGZvciBhcm0gcGxhY2VtZW50LgogICAgYXdhaXQgb3Muc2xlZXAodGFncy5hcm1OdWRnZVdhaXRNUyk7CgogICAgaWYgKGNhbk51ZGdlKCkpIHsKICAgICAgICBjb25zdCBhYlBvc2l0aW9uWCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QudGFnc1tsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uICsgJ1gnXTsKICAgICAgICBjb25zdCBhYlBvc2l0aW9uWSA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QudGFnc1tsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uICsgJ1knXTsKCiAgICAgICAgY29uc3QgZ3JpZENsaWNrUGFyYW1zID0gewogICAgICAgICAgICBkaW1lbnNpb246IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb24sCiAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IGFiUG9zaXRpb25YICsgNSwgeTogYWJQb3NpdGlvblkgfSwKICAgICAgICAgICAgZm9yY2VBcm1QbGFjZW1lbnQ6IHRydWUsCiAgICAgICAgfQoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID09PSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uKSB7CiAgICAgICAgICAgIC8vIE1hcCBwb3J0YWwgaXMgaW4gZGlmZmVyZW50IGNvb3JkaW5hdGUgc3BhY2UgYW5kIHNjYWxlLgogICAgICAgICAgICBncmlkQ2xpY2tQYXJhbXMucG9zaXRpb24ueCA9IGFiUG9zaXRpb25YICsgMC4wMDAzNTc0MzQwNjg0MDUzODIzOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB3aGlzcGVyaW5nIG9uR3JpZENsaWNrIHRvIHRoZSBhYiBtYW5pZmVzdGF0aW9uIGJvdCB3aXRoIHRoZSBwYXJhbXM6YCwgZ3JpZENsaWNrUGFyYW1zKQogICAgICAgIH0KCiAgICAgICAgLy8gRm9yY2UgYWIgYXJtIHBsYWNlbWVudCB1c2luZyB0aGUgb25HcmlkQ2xpY2sgbGlzdGVuZXIgb2YgdGhlIG1hbmlmZXN0YXRpb24gYm90LgogICAgICAgIHdoaXNwZXIobGlua3MubWFuaWZlc3RhdGlvbiwgJ29uR3JpZENsaWNrJywgZ3JpZENsaWNrUGFyYW1zKTsKICAgIH0KfQoKdGhpc0JvdC52YXJzLm51ZGdlQWN0aXZlID0gZmFsc2U7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkb25lYCk7Cn0nAKaJ/8QBoUwJYWJWZXJzaW9uAgQApon/xAHxawUxMC4zNCcApon/xAGhTA9vblBvcnRhbENoYW5nZWQCBACmif/EAfdrhQFAY29uc3QgeyBwb3J0YWwsIGRpbWVuc2lvbiB9ID0gdGhhdDsKCmlmIChwb3J0YWwgPT09ICdtZW51UG9ydGFsJykgewogICAgaWYgKCFkaW1lbnNpb24pIHsKICAgICAgICB0aGlzQm90LmFiU3RhcnRBcm1OdWRnZSgpOwogICAgfQp9JwCmif/EAaFMDWFiTWVudVJlZnJlc2gCBACmif/EAf1sG0B0aGlzQm90LmFiU3RhcnRBcm1OdWRnZSgpOycApon/xAGhTBFkZWJ1Z1VzZXJNYWRlQm90cwIEAKaJ/8QBmW0FZmFsc2UnAQRib3RzJGRjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZAEnAKaJ/8QBn20Gc3lzdGVtAgQApon/xAGgbRxhYi5wZXJzb25hbGl0eS5tYW5pZmVzdGF0aW9uJwCmif/EAZ9tBGZvcm0CBACmif/EAb1tB25vdGhpbmcnAKaJ/8QBn20LZGVzY3JpcHRpb24CBACmif/EAcVtOFRoaXMgc2tpbGwgY29udHJvbHMgdGhlIGFjdHVhbCBib3QgZm9yIHRoZSBhYiBpbnRlcmZhY2UuJwCmif/EAZ9tBWxlYXJuAgQApon/xAH+bSjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCmif/EAZ9tD29uUG9ydGFsQ2hhbmdlZAIEAKaJ/8QBpW6zQEBjb25zdCBQT1JUQUxTX1RIQVRfSElERSA9IG5ldyBTZXQoWwogICAgInN5c3RlbVBvcnRhbCIsCiAgICAic2hlZXRQb3J0YWwiCl0pCgpjb25zdCBQT1JUQUxTX1RIQVRfTUFOSUZFU1QgPSBuZXcgU2V0KFsKICAgICJncmlkUG9ydGFsIiwKICAgICJtYXBQb3J0YWwiCl0pOwoKYXN5bmMgZnVuY3Rpb24gZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24ocG9ydGFsOiAnbWFwJyB8ICdncmlkJyk6IHsgeDogbnVtYmVyLCB5OiBudW1iZXIgfSB7CiAgICBpZiAocG9ydGFsID09PSAnZ3JpZCcpIHsKICAgICAgICByZXR1cm4geyB4OiAwLCB5OiAwIH0KICAgIH0gZWxzZSBpZiAocG9ydGFsID09PSAnbWFwJykgewogICAgICAgIGlmICh0eXBlb2YgbGlua3MucmVtZW1iZXIudGFncy5tYXBab29tUG9zaXRpb24/LnggPT09ICdudW1iZXInICYmICB0eXBlb2YgbGlua3MucmVtZW1iZXIudGFncy5tYXBab29tUG9zaXRpb24/LnkgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgIHJldHVybiBsaW5rcy5yZW1lbWJlci50YWdzLm1hcFpvb21Qb3NpdGlvbjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsZXQgY3VycmVudFBvc2l0aW9uID0gdW5kZWZpbmVkOwogICAgICAgICAgICBsZXQgaGFzR2VvbG9jYXRpb25QZXJtaXNzaW9uID0gYXdhaXQgbGlua3MudXRpbHMuaGFzR2VvbG9jYXRpb25QZXJtaXNzaW9uKCk7CgogICAgICAgICAgICAvLyBDdXJyZW50IHdvcmstYXJvdW5kIGZvciBhbGxvd2luZyBnZW9sb2NhdGlvbiBmb3IgaU9TIGFwcAogICAgICAgICAgICBpZiAoZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuaW9zYnJpZGdlLm1lc3NlbmdlciIpKSB7CiAgICAgICAgICAgICAgICBoYXNHZW9sb2NhdGlvblBlcm1pc3Npb24gPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaGFzR2VvbG9jYXRpb25QZXJtaXNzaW9uKSB7CiAgICAgICAgICAgICAgICBjb25zdCBnZW9sb2NhdGlvbiA9IGF3YWl0IG9zLmdldEdlb2xvY2F0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoZ2VvbG9jYXRpb24uc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb3NpdGlvbiA9IHsgeDogZ2VvbG9jYXRpb24ubG9uZ2l0dWRlLCB5OiBnZW9sb2NhdGlvbi5sYXRpdHVkZSB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjdXJyZW50UG9zaXRpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50UG9zaXRpb247CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBHUlBNIFBvc2l0aW9uCiAgICAgICAgICAgICAgICByZXR1cm4geyB4OiAtODUuNjc2MTg5NDgyMjQzNCwgeTogNDIuOTY1Njc1Njc1Njc1NiB9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdW5yZWNvbmdpemVkIHBvcnRhbCB0eXBlIHByb3ZpZGVkIHRvIGdldERlZmF1bHRNYW5pZmVzdFBvc2l0aW9uOmAsIHBvcnRhbCk7CiAgICAgICAgcmV0dXJuIHsgeDogMCwgeTogMCB9CiAgICB9Cn0KCmNvbnN0IE1BUF9MT0FEX1dBSVRfVElNRSA9IDEwMDA7Cgpmb3IgKGNvbnN0IHBvcnRhbCBvZiBQT1JUQUxTX1RIQVRfSElERSkgewogICAgaWYgKGNvbmZpZ0JvdC50YWdzW3BvcnRhbF0gIT0gbnVsbCkgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYSBwb3J0YWwgdGhhdCBoaWRlcyBhYiBpcyBvcGVuIC0gaGlkaW5nIGFiQm90IGFuZCBpZ25vcmluZy5gKTsKICAgICAgICB9CgogICAgICAgIGlmICh0YWdzLmFiQm90KSB7CiAgICAgICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgppZiAoY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgIT0gbnVsbCB8fCBjb25maWdCb3QudGFncy5zeXN0ZW1Qb3J0YWwgIT0gbnVsbCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNoZWV0IHBvcnRhbCBvciBzeXN0ZW0gcG9ydGFsIG9wZW5lZCAtIGhpZGluZyBhYkJvdCBhbmQgaWdub3JpbmcuYCk7CiAgICB9CgogICAgaWYgKHRhZ3MuYWJCb3QpIHsKICAgICAgICBkZXN0cm95KGxpbmtzLmFiQm90KTsKICAgIH0KCiAgICByZXR1cm47Cn0KCmlmICghdGFncy5hYkF3YWtlKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWIgaXMgbm90IGF3YWtlIC0gaWdub3JpbmcuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LnBvcnRhbCA9PSAidGFnUG9ydGFsIikgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRhZ1BvcnRhbCBjaGFuZ2VkIC0gaWdub3JpbmcuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LnBvcnRhbCA9PSAibWVudVBvcnRhbCIpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtZW51UG9ydGFsIGNoYW5nZWQgLSBpZ25vcmluZy5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKHRoYXQucG9ydGFsID09ICJncmlkUG9ydGFsIiAmJiBjb25maWdCb3QudGFncy5tYXBQb3J0YWwpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBncmlkUG9ydGFsIGNoYW5nZWQsIGJ1dCBhbHNvIGFscmVhZHkgaW4gdGhlIG1hcFBvcnRhbCAtIGlnbm9yaW5nLmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9CgovLyBUaGUgbWFwIHBvcnRhbCBpcyB0b3VnaC4gSXQgc2VlbXMgdG8gdmFyeSBpbiBsb2FkaW5nIHNwZWVkIG9uCi8vIHZhcmlvdXMgaGFyZHdhcmUgYW5kIG5ldHdvcmtzIGFuZCBoYXMgYnkgdGhlIHRpbWUgb25Qb3J0YWxDaGFuZ2VkIGlzIGNhbGxlZCBpdCBkb2VzbnQKLy8gc2VlbSBndWFyZW50ZWVkIHRvIGJlIGFjdHVhbGx5IHJlYWR5LiBBZGRpbmcgYSBoYXJkY29kZWQgd2FpdCB0aW1lIHRvIGdpdmUgdGhlIHBvcnRhbCBzcGFjZSB0byBnZXQKLy8gdGhlIG1hcCBwb3J0YWwgZnVsbHkgbG9hZGVkIGJlZm9yZSBjb250aW51aW5nIHdpdGggbWFuaWZlc3RpbmcgYWIuCi8vCi8vIEF0IHNvbWUgcG9pbnQgdGhpcyBjYW4gZ28gYXdheSBpZiB3ZSBldmVyIGdldCBhIHNob3V0IG9yIHNvbWUgb3RoZXIgZ2F1cmVudGVlIHRoYXQgdGhlIG1hcCBwb3J0YWwgaXMgbG9hZGVkL3JlYWR5LgppZiAodGhhdC5wb3J0YWwgPT09ICdtYXBQb3J0YWwnKSB7CiAgICBpZiAodGhhdC5kaW1lbnNpb24pIHsKICAgICAgICBpZiAoIXRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkZWQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlcikgewogICAgICAgICAgICAgICAgdGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRXYWl0ZXIgPSBvcy5zbGVlcChNQVBfTE9BRF9XQUlUX1RJTUUpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHdhaXRpbmcgZm9yIG1hcCBwb3J0YWwgdG8gZmluaXNoIGxvYWRpbmc6ICR7TUFQX0xPQURfV0FJVF9USU1FfW1zYCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkV2FpdGVyOwogICAgICAgICAgICB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkZWQgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG1hcCBwb3J0YWwgaXMgYWxyZWFkeSBsb2FkZWQuYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkZWQgPSBmYWxzZTsKICAgICAgICB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlciA9IG51bGw7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWFwIHBvcnRhbCBoYXMgYmVlbiB1bmxvYWRlZC5gKTsKICAgICAgICB9CiAgICB9Cn0KCi8vIFN0YXJ0IGNoZWNrcyBmb3IgaWYvd2hlcmUgd2UgbmVlZCB0byBtYW5pZmVzdCBhYi4KbGV0IG5ld0FCID0gZmFsc2U7CmxldCBuZXdBQlBvcnRhbDsKbGV0IG5ld0FCUG9zaXRpb247CmxldCBmb2N1c0NhbWVyYSA9IHRydWU7CgppZiAoUE9SVEFMU19USEFUX01BTklGRVNULmhhcyh0aGF0LnBvcnRhbCkgJiYgdGhhdC5kaW1lbnNpb24pIHsKICAgIC8vIEEgcG9ydGFsIHRoYXQgbWFuaWZlc3RzIGFiIGhhcyBqdXN0IGNoYW5nZWQgZGltZW5zaW9uLgogICAgLy8gTWFuaWZlc3QgYWIgaW4gdGhlIG5ldyBkaW1lbnNpb24uCiAgICBpZiAodGhhdC5wb3J0YWwgPT0gIm1hcFBvcnRhbCIgfHwgdGhhdC5wb3J0YWwgPT0gIm1pbmlNYXBQb3J0YWwiKSB7OwogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWFuaWZlc3RpbmcgYWIgYm90IGluIG1hcCBwb3J0YWwgZGltZW5zaW9uICcke3RoYXQuZGltZW5zaW9ufScuYCk7CiAgICAgICAgfQoKICAgICAgICBuZXdBQlBvc2l0aW9uID0gYXdhaXQgZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24oJ21hcCcpOwogICAgICAgIG5ld0FCUG9ydGFsID0gdGhhdC5wb3J0YWw7CiAgICAgICAgbmV3QUIgPSBhd2FpdCB0aGlzQm90LmFiTWFuaWZlc3RCb3QoeyBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLCBwb3NpdGlvbjogbmV3QUJQb3NpdGlvbiB9KTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWFuaWZlc3RpbmcgYWIgYm90IGRpbWVuc2lvbiAnJHt0aGF0LmRpbWVuc2lvbn0nLmApOwogICAgICAgIH0KCiAgICAgICAgbmV3QUJQb3NpdGlvbiA9IGF3YWl0IGdldERlZmF1bHRNYW5pZmVzdFBvc2l0aW9uKCdncmlkJyk7CiAgICAgICAgbmV3QUJQb3J0YWwgPSB0aGF0LnBvcnRhbDsKICAgICAgICBuZXdBQiA9IGF3YWl0IHRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7IGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHBvc2l0aW9uOiBuZXdBQlBvc2l0aW9uIH0pOwogICAgfQp9IGVsc2UgaWYgKChQT1JUQUxTX1RIQVRfTUFOSUZFU1QuaGFzKHRoYXQucG9ydGFsKSB8fCBQT1JUQUxTX1RIQVRfSElERS5oYXModGhhdC5wb3J0YWwpKSAmJiAKICAgICAgICAgICAhdGhhdC5kaW1lbnNpb24gJiYgCiAgICAgICAgICAgKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgfHwgY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsKQopIHsKICAgIC8vIEEgcG9ydGFsIHRoYXQgdHlwaWNhbGx5IGhpZGVzIG9yIHJlLW1hbmlmZXN0cyBhYiBqdXN0IGNsb3NlZCwgYnV0IGVpdGhlciB0aGUgZ3JpZCBvciBtYXAgcG9ydGFsIGFyZSBzdGlsbCBvcGVuLgogICAgLy8gU3VtbW9uIGFiIGluIGVpdGhlciB0aGUgbWFwUG9ydGFsIG9yIGdyaWRQb3J0YWwuCiAgICBsZXQgc3VtbW9uRGltZW5zaW9uOwoKICAgIGlmIChjb25maWdCb3QudGFncy5tYXBQb3J0YWwpIHsKICAgICAgICBzdW1tb25EaW1lbnNpb24gPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWw7CiAgICAgICAgbmV3QUJQb3J0YWwgPSAnbWFwUG9ydGFsJzsKICAgICAgICAKICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFnc1tzdW1tb25EaW1lbnNpb24gKyAnQUJMYXN0UG9zaXRpb24nXSkgewogICAgICAgICAgICAvLyBVc2UgbGFzdCBrbm93biBwb3NpdGlvbi4KICAgICAgICAgICAgbmV3QUJQb3NpdGlvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3Nbc3VtbW9uRGltZW5zaW9uICsgJ0FCTGFzdFBvc2l0aW9uJ107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gVXNlIGRlZmF1bHQgbWFwIHBvc2l0aW9uLgogICAgICAgICAgICBuZXdBQlBvc2l0aW9uID0gYXdhaXQgZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24oJ21hcCcpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCkgewogICAgICAgIHN1bW1vbkRpbWVuc2lvbiA9IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CiAgICAgICAgbmV3QUJQb3J0YWwgPSAnZ3JpZFBvcnRhbCc7CgogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzW3N1bW1vbkRpbWVuc2lvbiArICdBQkxhc3RQb3NpdGlvbiddKSB7CiAgICAgICAgICAgIC8vIFVzZSBsYXN0IGtub3duIHBvc2l0aW9uLgogICAgICAgICAgICBuZXdBQlBvc2l0aW9uID0gbGlua3MucmVtZW1iZXIudGFnc1tzdW1tb25EaW1lbnNpb24gKyAnQUJMYXN0UG9zaXRpb24nXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBVc2UgZGVmYXVsdCBncmlkIHBvc2l0aW9uLgogICAgICAgICAgICBuZXdBQlBvc2l0aW9uID0gYXdhaXQgZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24oJ2dyaWQnKTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHN1bW1vbkRpbWVuc2lvbikgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc3VtbW9uaW5nIGFiIGJvdCBpbiAke25ld0FCUG9ydGFsfSBkaW1lbnNpb24gJyR7c3VtbW9uRGltZW5zaW9ufScuYCk7CiAgICAgICAgfQoKICAgICAgICBuZXdBQiA9IGF3YWl0IHRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7IGRpbWVuc2lvbjogc3VtbW9uRGltZW5zaW9uLCBwb3NpdGlvbjogbmV3QUJQb3NpdGlvbiB9KTsKCiAgICAgICAgaWYgKFBPUlRBTFNfVEhBVF9ISURFLmhhcyh0aGF0LnBvcnRhbCkpIHsKICAgICAgICAgICAgLy8gSWYgdGhlIHBvcnRhbCB0aGF0IGNsb3NlZCB3YXMgYSBwb3J0YWwgdGhhdCBoaWRlcyBhYiwgdGhlbiBkb250IHJ1biB0aGUgY2FtZXJhIGZvY3VzLgogICAgICAgICAgICAvLyBUaGlzIHdpbGwganVzdCB1c2UgdGhlIHByZXZpb3VzIGNhbWVyYSBwb3NpdGlvbiBhbHJlYWR5IHN0b3JlZCBpbiBtZW1vcnkuCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHdpbGwgbm90IGZvY3VzIGNhbWVyYSBvbiBhYiBiZWNhdXNlIHdlIGFyZSBqdXN0IGFzc3VtaW5nIHRoZSBwcmV2aW91cyBjYW1lcmEgcG9zaXRpb24uYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9jdXNDYW1lcmEgPSBmYWxzZTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYm90aCB0aGUgbWFwIGFuZCBncmlkIHBvcnRhbCBhcmUgYm90aCBjbG9zZWQsIGNhbm5vdCBzdW1tb24gYWIgaW4gZWl0aGVyLmApOwogICAgICAgIH0KICAgIH0KfSBlbHNlIHsKICAgIHJldHVybjsKfQoKaWYgKG5ld0FCICYmIGZvY3VzQ2FtZXJhKSB7CiAgICBsZXQgem9vbSA9IDEwOwoKICAgIGlmIChuZXdBQlBvcnRhbCA9PT0gJ21hcFBvcnRhbCcgfHwgbmV3QUJQb3J0YWwgPT09ICdtaW5pTWFwUG9ydGFsJykgewogICAgICAgIHpvb20gPSAyMDAwOwogICAgfQogICAgdHJ5IHsKICAgICAgICBhd2FpdCBvcy5mb2N1c09uKG5ld0FCUG9zaXRpb24sIHsgem9vbSwgcm90YXRpb246IHsgeDogNDUsIHk6IDQ1IH0sIHBvcnRhbDogbmV3QUJQb3J0YWwgfSkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLndhcm4oYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBmb2N1c09uIGVycm9yIG9jY3VyZWQ6YCwgZSk7CiAgICAgICAgfQogICAgfQp9JwCmif/EAZ9tCHJlbWVtYmVyAgQApon/xAHZrgEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycApon/xAGfbQ1hYk1hbmlmZXN0Qm90AgQApon/xAGArwG6H0Bjb25zdCBkaW1lbnNpb24gPSB0aGF0Py5kaW1lbnNpb247CmNvbnN0IHBvc2l0aW9uID0gdGhhdD8ucG9zaXRpb247CgppZiAodGhpc0JvdC52YXJzLmFiQm90TGFzdElkKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGVzdHJveWluZyBhYkJvdGApOwogICAgfQogICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYWJCb3RMYXN0SWQpOwp9CgpsZXQgYWIgPSB7fTsKCmFiLnNwYWNlID0gInRlbXBMb2NhbCI7CmFiLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvcjsKYWIuZm9ybU9wYWNpdHkgPSAiMC4zMyI7CmFiLmxhYmVsID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VMYWJlbDsKYWIubGFiZWxQb3NpdGlvbiA9ICJmcm9udCI7CmFiLmxhYmVsQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwphYi5sYWJlbFNpemUgPSAwLjYxOwphYi5vbkNsaWNrID0gYEAKICAgIGlmICh0aGF0Lm1vZGFsaXR5ID09ICdtb3VzZScgJiYgdGhhdC5idXR0b25JZCA9PSAncmlnaHQnKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgCiAgICBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soKTsKYDsKYWIub25Qb2ludGVyRW50ZXIgPSBgQAogICAgaWYgKHRoYXQubW9kYWxpdHkgPT09ICdtb3VzZScpIHsKICAgICAgICB0YWdzLm1vdXNlT3ZlciA9IHRydWU7CiAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsKICAgIH0KYDsKYWIub25Qb2ludGVyRXhpdCA9IGBACiAgICBpZiAodGhhdC5tb2RhbGl0eSA9PT0gJ21vdXNlJykgewogICAgICAgIHRhZ3MubW91c2VPdmVyID0gZmFsc2U7CiAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsKICAgIH0KYDsKYWIub25Qb2ludGVyRG93biA9IGBACiAgICBpZiAodGhhdC5tb2RhbGl0eSA9PT0gJ21vdXNlJyAmJiB0aGF0LmJ1dHRvbklkID09PSAnbGVmdCcpIHsKICAgICAgICB0YWdzLm1vdXNlTGVmdEJ1dHRvbkRvd24gPSB0cnVlOwogICAgICAgIHRoaXNCb3QudXBkYXRlUG9ydGFsQ3Vyc29yKCk7CiAgICB9CmA7CmFiLm9uUG9pbnRlclVwID0gYEAKICAgIGlmICh0aGF0Lm1vZGFsaXR5ID09PSAnbW91c2UnICYmIHRoYXQuYnV0dG9uSWQgPT09ICdsZWZ0JykgewogICAgICAgIHRhZ3MubW91c2VMZWZ0QnV0dG9uRG93biA9IGZhbHNlOwogICAgICAgIHRhZ3MubW91c2VMZWZ0RHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzQm90LnVwZGF0ZVBvcnRhbEN1cnNvcigpOwogICAgfQpgOwphYi5vbkRyYWcgPSBgQAogICAgaWYgKHRhZ3MubW91c2VMZWZ0QnV0dG9uRG93bikgewogICAgICAgIHRhZ3MubW91c2VMZWZ0RHJhZ2dpbmcgPSB0cnVlOwogICAgICAgIHRoaXNCb3QudXBkYXRlUG9ydGFsQ3Vyc29yKCk7ICAKICAgIH0KYDsKYWIub25LZXlEb3duID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ1NoaWZ0JykpIHsKICAgICAgICB0YWdzLnNoaWZ0SGVsZCA9IHRydWU7CiAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsgIAogICAgfQpgOwphYi5vbktleVVwID0gYEAKICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ1NoaWZ0JykpIHsKICAgICAgICB0YWdzLnNoaWZ0SGVsZCA9IGZhbHNlOwogICAgICAgIHRoaXNCb3QudXBkYXRlUG9ydGFsQ3Vyc29yKCk7ICAKICAgIH0KYDsKYWIudXBkYXRlUG9ydGFsQ3Vyc29yID0gYEAKICAgIGxldCBjdXJzb3IgPSBudWxsOwoKICAgIGlmICh0YWdzLm1vdXNlTGVmdERyYWdnaW5nKSB7CiAgICAgICAgY3Vyc29yID0gJ2dyYWJiaW5nJzsgICAgCiAgICB9IGVsc2UgaWYgKHRhZ3MubW91c2VPdmVyKSB7CiAgICAgICAgaWYgKHRhZ3Muc2hpZnRIZWxkKSB7CiAgICAgICAgICAgIGN1cnNvciA9ICdjb250ZXh0LW1lbnUnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN1cnNvciA9ICdwb2ludGVyJzsKICAgICAgICB9CiAgICB9CgogICAgZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxDdXJzb3IgPSBjdXJzb3I7CmA7CmFiLmRpbWVuc2lvbiA9IGRpbWVuc2lvbjsKYWJbZGltZW5zaW9uXSA9IHRydWU7CmFiW2RpbWVuc2lvbiArICJYIl0gPSBwb3NpdGlvbi54OwphYltkaW1lbnNpb24gKyAiWSJdID0gcG9zaXRpb24ueTsKYWIuc3Ryb2tlQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwphYi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKYWIuYW5pbWF0ZUJvdCA9IGBAIAogICAgaWYgKGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHJvdFogPSB0YWdzLmRpbWVuc2lvbiArICJSb3RhdGlvbloiOwogICAgbGV0IHRhcmdldFNjYWxlID0gMC42NTsKCiAgICBhd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsCiAgICB7CiAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgIFtyb3RaXTogMCwKICAgICAgICB9LAogICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgW3JvdFpdOiA2LjMsCiAgICAgICAgfSwKICAgICAgICBlYXNpbmc6IHsKICAgICAgICAgICAgdHlwZTogInNpbnVzb2lkYWwiLAogICAgICAgICAgICBtb2RlOiAiaW5vdXQiCiAgICAgICAgfSwKICAgICAgICBkdXJhdGlvbjogMgogICAgfSkuY2F0Y2goZSA9PiB7fSk7CmA7CmFiLm9uQ3JlYXRlID0gYEAKICAgIHRoaXNCb3QuYW5pbWF0ZUJvdCgpOwogICAgbWFza3MuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzQm90LmFuaW1hdGVCb3QoKSwgMjAwMCk7CmA7CmFiLm9uRGVzdHJveSA9IGBACiAgICBjbGVhckludGVydmFsKHRhZ3MuaW50ZXJ2YWwpOwogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKYDsKYWIuZHJhZ2dhYmxlID0gZmFsc2U7CmFiLnNjYWxlID0gMC45OwoKY29uc3QgYWJCb3QgPSBjcmVhdGUoYWIpOwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJTZWNvbmRhcnlMYWJlbCkgewogICAgbGV0IGFiTGFiZWxCb3QgPSB7fTsKCiAgICBhYkxhYmVsQm90LnNwYWNlID0gInRlbXBMb2NhbCI7CiAgICBhYkxhYmVsQm90W2RpbWVuc2lvbl0gPSB0cnVlOwogICAgYWJMYWJlbEJvdFtkaW1lbnNpb24gKyAiWiJdID0gLTE7CiAgICBhYkxhYmVsQm90LmNyZWF0b3IgPSBhYkJvdC5pZDsKICAgIGFiTGFiZWxCb3QudHJhbnNmb3JtZXIgPSBhYkJvdC5pZDsKICAgIGFiTGFiZWxCb3QucG9pbnRhYmxlID0gZmFsc2U7CiAgICBhYkxhYmVsQm90LmNvbG9yID0gImNsZWFyIjsKICAgIGFiTGFiZWxCb3QubGFiZWwgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiU2Vjb25kYXJ5TGFiZWw7CiAgICBhYkxhYmVsQm90LmxhYmVsUG9zaXRpb24gPSAibGVmdCI7CiAgICBhYkxhYmVsQm90LmxhYmVsU2l6ZSA9IDAuNzsKICAgIGFiTGFiZWxCb3QubGFiZWxDb2xvciA9IGFiQm90LnRhZ3MubGFiZWxDb2xvcjsKCiAgICBjcmVhdGUoYWJMYWJlbEJvdCk7Cn0KCm1hc2tzLmFiQm90ID0gIvCflJciICsgYWJCb3QuaWQ7CmxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQWN0aXZlRGltZW5zaW9uID0gZGltZW5zaW9uOwp0aGlzQm90LnZhcnMuYWJCb3RMYXN0SWQgPSBhYkJvdC5pZDsgLy8gU3RvcmluZyBpZCBhcyBhIHZhciBwcmV2ZW50cyBnaG9zdCBhYkJvdHMgZHVyaW5nIG11bHRpcGxlIGNhbGxzIGluIG9uZSBmcmFtZS4KCi8vIFN0b3JlIHRoZSBsYXN0IHBvc2l0aW9uIG9mIGFiIGluIHRoaXMgZGltZW5zaW9uIG9uIHRoZSByZW1lbWJlciBib3QuCmxpbmtzLnJlbWVtYmVyLm1hc2tzW2RpbWVuc2lvbiArICdBQkxhc3RQb3NpdGlvbiddID0gJ/Cfp6wnICsgSlNPTi5zdHJpbmdpZnkoeyB4OiBwb3NpdGlvbj8ueCwgeTogcG9zaXRpb24/LnkgfSk7Cgphd2FpdCBvcy5zbGVlcCgwKTsgLy8gR2l2ZSBDYXN1YWxPUyBhIGNoYW5jZSB0byB1cGRhdGUgdGFnIG1hc2tzLgoKc2hvdXQoIm9uQUJNb3ZlZCIsIHsgZGltZW5zaW9uLCB4OiBwb3NpdGlvbi54LCB5OiBwb3NpdGlvbi55IH0pOwoKcmV0dXJuIGFiQm90OycApon/xAGfbQtvbkdyaWRDbGljawIEAKaJ/8QBtc4BzxNAaWYgKCF0YWdzLmFiQXdha2UpCnsKICAgIHJldHVybjsKfQoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmlmIChsaW5rcy5hYkJvdD8udGFncy5hcm0pCnsKICAgIGRlc3Ryb3kobGlua3MuYWJCb3QubGlua3MuYXJtKTsKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IG51bGw7Cn0KCmNvbnN0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOwoKaWYgKHRhZ3MuYWJCb3QgJiYgKHNoaWZ0Q2hlY2sgfHwgKHRoYXQubW9kYWxpdHkgPT0gIm1vdXNlIiAmJiB0aGF0LmJ1dHRvbklkID09ICJyaWdodCIgJiYgIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSaWdodENsaWNrRGlzYWJsZWQpIHx8IHRoYXQuZm9yY2VBcm1QbGFjZW1lbnQpKQp7CiAgICAKICAgIGxldCBhcm0gPSB7fTsKCiAgICBhcm0uc3BhY2UgPSAidGVtcExvY2FsIjsKICAgIGFybVt0aGF0LmRpbWVuc2lvbl0gPSB0cnVlOwogICAgYXJtW3RoYXQuZGltZW5zaW9uICsgIlgiXSA9IHRoYXQucG9zaXRpb24ueDsKICAgIGFybVt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LnBvc2l0aW9uLnk7CiAgICBhcm0uZGltZW5zaW9uID0gdGhhdC5kaW1lbnNpb247CiAgICBhcm0uc2NhbGUgPSAwLjk7CiAgICBhcm0uc2NhbGVaID0gMC4wMTsKICAgIGFybS5jb2xvciA9ICJjbGVhciI7CiAgICBhcm0uc3Ryb2tlQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwogICAgYXJtLmxpbmVDb2xvciA9IGxpbmtzLmFiQm90LnRhZ3Muc3Ryb2tlQ29sb3I7CiAgICBhcm0ubGluZVRvID0gbGlua3MuYWJCb3QuaWQ7CiAgICBhcm0ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CiAgICBhcm0ub25DbGljayA9IGBAIGRlc3Ryb3kodGhpc0JvdCk7CiAgICBzaG91dCgib25BQkZvb3RDbGlja2VkIiwgeyBkaW1lbnNpb246IHRhZ3MuZGltZW5zaW9uIH0pOwogICAgbGlua3MubWFuYWdlci5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb246IHRhZ3MuZGltZW5zaW9uLCBwb3NpdGlvbjp7eDp0YWdzW3RhZ3MuZGltZW5zaW9uICsgIlgiXSx5OnRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWSJdfX0pO2A7CgogICAgbGV0IG5ld0FybSA9IGF3YWl0IGNyZWF0ZShhcm0pOwoKICAgIHNob3V0KCJvbkFCQXJtUGxhY2VkIiwge2RpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHg6IHRoYXQucG9zaXRpb24ueCwgeTogdGhhdC5wb3NpdGlvbi55fSk7CgogICAgbGlua3MuYWJCb3QubWFza3MuYXJtID0gIvCflJciICsgbmV3QXJtLmlkOwoKICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiR3JpZEZvY3VzID0ge2RpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHBvc2l0aW9uOiB7eDogdGhhdC5wb3NpdGlvbi54LCB5OiB0aGF0LnBvc2l0aW9uLnl9fTsKCiAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJncmlkIn0pOwoKICAgIHJldHVybjsKfQoKbGV0IGZvb3RwcmludCA9IHt9OwoKZm9vdHByaW50LnNwYWNlID0gInRlbXBMb2NhbCI7CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbl0gPSB0cnVlOwpmb290cHJpbnQuZGltZW5zaW9uID0gdGhhdC5kaW1lbnNpb247CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbiArICJYIl0gPSB0aGF0LnBvc2l0aW9uLng7CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LnBvc2l0aW9uLnk7CmZvb3RwcmludC5zY2FsZVogPSAwLjAxOwpmb290cHJpbnQub25DbGljayA9IGBAIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gZmFsc2U7CnNob3V0KCJvbkFCRm9vdENsaWNrZWQiLCB7IGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24gfSk7CmxpbmtzLm1hbmFnZXIuYWJNYW5pZmVzdEJvdCh0YWdzLnBvc2l0aW9uSW5mbyk7CmA7CmZvb3RwcmludC5wb3NpdGlvbkluZm8gPSB0aGF0Owpmb290cHJpbnQuY29sb3IgPSAiY2xlYXIiOwpmb290cHJpbnQucGVyc29uYWxpdHkgPSB0YWdzLnBlcnNvbmFsaXR5Owpmb290cHJpbnQuc3Ryb2tlQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwpmb290cHJpbnQuZHJhZ2dhYmxlID0gZmFsc2U7CmZvb3RwcmludC5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZm9vdHByaW50Lm9uQ3JlYXRlID0gYEAgc2V0VGltZW91dCgoKSA9PiBkZXN0cm95KHRoaXNCb3QpLCA4MDApOwoKICAgIGF3YWl0IGFuaW1hdGVUYWcodGhpc0JvdCwgewogICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICBzY2FsZVg6IDAuMSwKICAgICAgICAgICAgc2NhbGVZOiAwLjEKICAgICAgICB9LAogICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgc2NhbGVYOiAxLjEsCiAgICAgICAgICAgIHNjYWxlWTogMS4xCiAgICAgICAgfSwKICAgICAgICBkdXJhdGlvbjogMC41LAogICAgICAgIGVhc2luZzogewogICAgICAgICAgICB0eXBlOiAiZWxhc3RpYyIsCiAgICAgICAgICAgIG1vZGU6ICJvdXQiCiAgICAgICAgfQogICAgfSkuY2F0Y2goZSA9PiB7fSk7CmA7CgpjcmVhdGUoZm9vdHByaW50KTsnAKaJ/8QBn20EbWVudQIEAKaJ/8QB/+EBKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAKaJ/8QBn20HYWJDbGljawIEAKaJ/8QBpuIBmQtAaWYgKCFsaW5rcy5hYkJvdCkgewogICAgcmV0dXJuOwp9CgppZiAobGlua3MuaW5wdXQpIHsKICAgIGxpbmtzLmlucHV0LmFiQ2hhdEJhckNsb3NlKCk7Cn0KCmNvbnN0IHJlc2V0ID0gdGhhdCA/IHRoYXQucmVzZXQgOiBmYWxzZTsKY29uc3QgbWVudSA9IHRoYXQgPyB0aGF0Lm1lbnUgOiAiY29yZSI7CmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCmlmICghcmVzZXQgJiYgKGxpbmtzLmFiQm90LnRhZ3MuaW50ZXJ2YWwgfHwgc3RhdGUpKSB7CiAgICBjb25zdCBhYk1lbnVCb3RzID0gZ2V0Qm90cygiYWJNZW51IiwgdHJ1ZSk7CgogICAgd2hpc3BlcihhYk1lbnVCb3RzLCAiYWJNZW51UmVmcmVzaCIpOwoKICAgIGNsZWFySW50ZXJ2YWwobGlua3MuYWJCb3QudGFncy5pbnRlcnZhbCk7CgogICAgbGlua3MuYWJCb3QubWFza3MuaW50ZXJ2YWwgPSBudWxsOwoKICAgIGNsZWFyQW5pbWF0aW9ucyhsaW5rcy5hYkJvdCk7CgogICAgY29uc3Qgcm90WiA9IGxpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlJvdGF0aW9uWiI7CgogICAgaWYgKHN0YXRlICYmIG1lbnUgPT0gImNvcmUiKSB7CiAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3MubWVudS5hYk9wZW5NZW51KG1lbnUpOwogICAgfQoKICAgIGFuaW1hdGVUYWcobGlua3MuYWJCb3QsIHsKICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgW3JvdFpdOiBsaW5rcy5hYkJvdC50YWdzW3JvdFpdLAogICAgICAgICAgICBzY2FsZTogbGlua3MuYWJCb3QudGFncy5zY2FsZQogICAgICAgIH0sCiAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICBbcm90Wl06IDAsCiAgICAgICAgICAgIHNjYWxlOiAwLjkKICAgICAgICB9LAogICAgICAgIGVhc2luZzogewogICAgICAgICAgICB0eXBlOiAic2ludXNvaWRhbCIsCiAgICAgICAgICAgIG1vZGU6ICJpbm91dCIKICAgICAgICB9LAogICAgICAgIGR1cmF0aW9uOiAwLjUKICAgIH0pLmNhdGNoKGUgPT4ge30pCn0KZWxzZSB7CiAgICBsaW5rcy5hYkJvdC5hbmltYXRlQm90KCk7CgogICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gbnVsbDsKCiAgICBpZiAobGlua3MuYWJCb3QudGFncy5hcm0pIHsKICAgICAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IGxpbmtzLmFiQm90LmFuaW1hdGVCb3QoKSwgMjAwMCk7Cn0KCnNob3V0KCdvbkFCQ2xpY2snLCB7IGFiQm90OiBsaW5rcy5hYkJvdCwgZGltZW5zaW9uOiBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiwgbWVudSwgc2hpZnRLZXk6ICEhc3RhdGUsIHJlc2V0IH0pOycApon/xAGfbQxvbkFueUJvdERyYWcCBACmif/EAcDtAZAMQGlmICh0aGF0LmJvdCAhPSBsaW5rcy5hYkJvdCkgcmV0dXJuOwoKaWYgKGxpbmtzLmlucHV0KSB7CiAgICBsaW5rcy5pbnB1dC5hYkNoYXRCYXJDbG9zZSgpOwp9CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzICYmIHRoYXQuYm90LmlkID09IGxpbmtzLmFiQm90LmlkKQp7CiAgICBvcy5lbmFibGVDdXN0b21EcmFnZ2luZygpOwoKICAgIHJldHVybjsKfQoKaWYgKGxpbmtzLmFiQm90LnRhZ3MuYXJtKQp7CiAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7Cn0KCmlmICghdGhhdC5ib3QudGFncy5pbnRlcnZhbCkKewogICAgdGhpc0JvdC5hYkNsaWNrKCk7Cn0KCmxldCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CmxldCBhcm0gPSB7fTsKCmFybS5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwphcm1bbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb25dID0gdHJ1ZTsKYXJtW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlgiXSA9IGxpbmtzLmFiQm90LnRhZ3NbbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWCJdOwphcm1bbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWSJdID0gbGlua3MuYWJCb3QudGFnc1tsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJZIl07CmFybS5jcmVhdG9yID0gbGlua3MuYWJCb3QuaWQ7CmFybS5kaW1lbnNpb24gPSBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbjsKYXJtLnNjYWxlID0gMC45Owphcm0uc2NhbGVaID0gMC4wMTsKYXJtLmNvbG9yID0gImNsZWFyIjsKYXJtLnN0cm9rZUNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKYXJtLmxpbmVDb2xvciA9IGxpbmtzLmFiQm90LnRhZ3Muc3Ryb2tlQ29sb3I7CmFybS5saW5lVG8gPSB0aGF0LmJvdC5pZDsKYXJtLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwphcm0ub25DbGljayA9IGBAIGRlc3Ryb3kodGhpc0JvdCk7CnNob3V0KCJvbkFCRm9vdENsaWNrZWQiLCB7IGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24gfSk7CmxpbmtzLm1hbmFnZXIuYWJNYW5pZmVzdEJvdCh7ZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgcG9zaXRpb246e3g6dGFnc1t0YWdzLmRpbWVuc2lvbiArICJYIl0seTp0YWdzW3RhZ3MuZGltZW5zaW9uICsgIlkiXX19KTtgOwphcm0ub25Ecm9wID0gYEAgc2hvdXQoIm9uQUJBcm1QbGFjZWQiLCB7ZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgeDogdGhhdC50by54LCB5OiB0aGF0LnRvLnl9KTtgCgppZiAoc3RhdGUpCnsKICAgIGFybS5tdWx0aVNlbGVjdCA9IHRydWU7CiAgICBhcm0uZm9ybSA9ICJzcGhlcmUiOwogICAgYXJtLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5kcmFnZ2FibGUgPSB0cnVlOwp9CgpsZXQgbmV3QXJtID0gYXdhaXQgY3JlYXRlKGFybSk7CgpsaW5rcy5hYkJvdC5tYXNrcy5hcm0gPSAi8J+UlyIgKyBuZXdBcm0uaWQ7Cgpvcy5yZXBsYWNlRHJhZ0JvdChuZXdBcm0pOycApon/xAGfbRFvbkFueUJvdERyb3BFbnRlcgIEAKaJ/8QBzfkBzAlAaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmIChsaW5rcy5hYkJvdD8ubGlua3MuYXJtICE9IHRoYXQuZHJhZ0JvdCkgcmV0dXJuOwoKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLm11bHRpU2VsZWN0KQp7CiAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwoKICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmtzLmFiQm90LnRhZ3MubGluZVRvKSkKICAgIHsKICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8ucHVzaCh0aGF0LnRvLmJvdC5pZCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gW3RoYXQudG8uYm90LmlkXTsKICAgIH0KCiAgICBsZXQgbmV3TGluazsKCiAgICBpZiAoIWxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLnNlbGVjdGVkQm90cykKICAgIHsKICAgICAgICBuZXdMaW5rID0gZ2V0TGluayh0aGF0LnRvLmJvdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IHByZXZpb3VzTGlua0JvdHMgPSBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubGlua3Muc2VsZWN0ZWRCb3RzOwoKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJldmlvdXNMaW5rQm90cykpCiAgICAgICAgewogICAgICAgICAgICBwcmV2aW91c0xpbmtCb3RzID0gW3ByZXZpb3VzTGlua0JvdHNdCiAgICAgICAgfQoKICAgICAgICBjb25zdCBhbHJlYWR5QWRkZWQgPSBwcmV2aW91c0xpbmtCb3RzLnNvbWUoYiA9PiBiLmlkID09PSB0aGF0LnRvLmJvdC5pZCk7CiAgICAgICAgaWYgKCFhbHJlYWR5QWRkZWQpCiAgICAgICAgewogICAgICAgICAgICBwcmV2aW91c0xpbmtCb3RzLnB1c2godGhhdC50by5ib3QpOwogICAgICAgIH0KCiAgICAgICAgbmV3TGluayA9IGdldExpbmsocHJldmlvdXNMaW5rQm90cyk7CiAgICB9CgogICAgbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3Muc2VsZWN0ZWRCb3RzID0gbmV3TGluazsKfQplbHNlCnsKICAgIGxpbmtzLmFiQm90LmxpbmtzLmFybS5tYXNrcy5zdHJva2VDb2xvciA9ICJjbGVhciI7CiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubWFza3MubGluZVRvID0gZmFsc2U7CgogICAgbGlua3MuYWJCb3QubWFza3MubGluZUNvbG9yID0gbGlua3MuYWJCb3QudGFncy5zdHJva2VDb2xvcjsKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IHRoYXQudG8uYm90LmlkOwp9JwCmif/EAZ9tEG9uQW55Qm90RHJvcEV4aXQCBACmif/EAZqDApwCQGlmICghbGlua3MuYWJCb3QpIHJldHVybjsKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybSAhPSB0aGF0LmRyYWdCb3QpIHJldHVybjsKCmlmICghbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3MubXVsdGlTZWxlY3QpCnsKICAgIGxpbmtzLmFiQm90LmxpbmtzLmFybS5tYXNrcy5zdHJva2VDb2xvciA9IG51bGw7CiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubWFza3MubGluZVRvID0gbnVsbDsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8gPSBsaW5rcy5hYkJvdC5saW5rcy5hcm0uaWQ7Cn0nAKaJ/8QBn20Mb25BbnlCb3REcm9wAgQApon/xAG3hQLuC0BtYXNrcy5tdWx0aURyYWcgPSBudWxsOwoKaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmICghbGlua3MuYWJCb3QpIHJldHVybjsKaWYgKCFsaW5rcy5hYkJvdC50YWdzLmFybSkgcmV0dXJuOwppZiAobGlua3MuYWJCb3QubGlua3MuYXJtICE9IHRoYXQuZHJhZ0JvdCkgcmV0dXJuOwoKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLm11bHRpU2VsZWN0ICYmIGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLnNlbGVjdGVkQm90cykKewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJNdWx0aXBsZUJvdEZvY3VzID0gbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3Muc2VsZWN0ZWRCb3RzOwoKICAgIC8vY2hlY2sgaWYgb25seSBvbmUgYm90IGlzIHNlbGVjdGVkIGluIG11bHRpc2VsZWN0IG1vZGUKICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmtzLmFiQm90LmxpbmtzLmFybS5saW5rcy5zZWxlY3RlZEJvdHMpKSB7CiAgICAgICAgdGhpc0JvdC5hYkNsaWNrKHttZW51OiAibXVsdGlwbGVCb3QifSk7CiAgICB9IGVsc2UgewogICAgICAgIGlmIChsaW5rcy5hYkJvdC5saW5rcy5hcm0ubGlua3Muc2VsZWN0ZWRCb3RzLmlkID09IGxpbmtzLmFiQm90LmlkKQogICAgICAgIHsKICAgICAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8gPSBsaW5rcy5hYkJvdC50YWdzLmxpbmVUb1swXTsKICAgICAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJCb3RGb2N1cyA9ICLwn5SXIiArIGxpbmtzLmFiQm90LmxpbmtzLmFybS5saW5rcy5zZWxlY3RlZEJvdHMuaWQ7CgogICAgICAgICAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJib3QifSk7CiAgICAgICAgfQogICAgfSAKICAgIAogICAgZGVzdHJveShsaW5rcy5hYkJvdC5saW5rcy5hcm0pOwogICAgc2hvdXQoIm9uQUJTZWxlY3RlZEJvdCIsIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiTXVsdGlwbGVCb3RGb2N1cyk7Cn0KZWxzZSBpZiAodGhhdC50by5ib3QpCnsKICAgIGlmICh0aGF0LnRvLmJvdCA9PSBsaW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBsaW5rcy5tZW51LmFiRW52aXJvbm1lbnRNZW51KCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJCb3RGb2N1cyA9ICLwn5SXIiArIHRoYXQudG8uYm90LmlkOwoKICAgICAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJib3QifSk7CiAgICB9CiAgICAKICAgIHNob3V0KCJvbkFCU2VsZWN0ZWRCb3QiLCB0aGF0LnRvLmJvdCk7CiAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7Cn0KZWxzZQp7CiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkdyaWRGb2N1cyA9IHtkaW1lbnNpb246IHRoYXQudG8uZGltZW5zaW9uLCBwb3NpdGlvbjoge3g6IHRoYXQudG8ueCwgeTogdGhhdC50by55fX07CgogICAgdGhpc0JvdC5hYkNsaWNrKHttZW51OiAiZ3JpZCJ9KTsKfScApon/xAGfbQhhYklnbm9yZQIEAKaJ/8QBopECBHRydWUnAKaJ/8QBn20DYXNrAgQApon/xAGnkQIo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycApon/xAGfbQlhc2tCdXR0b24CBACmif/EAc6RAsgFQGlmICghdGFncy5hYkF3YWtlKQp7CiAgICByZXR1cm47Cn0KCmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSBsaW5rcy5tZW51LnRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gbGlua3MubWVudS50YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24uYmFzZVNraWxsID0gIvCflJciICsgbGlua3MuYXNrLmlkOwphYk1lbnVCdXR0b24ubGFiZWwgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51TGFiZWw7CmFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVJY29uOwphYk1lbnVCdXR0b24ub25DcmVhdGUgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51T25HZW5lcmF0ZTsKYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVTb3J0T3JkZXI7CmFiTWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVDb2xvciA/IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVDb2xvciA6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOycApon/xAGfbQlhYkJvdENoYXQCBACmif/EAZWXAu4IQGlmICghbGlua3MuYWJCb3QgJiYgIXRoYXQuYm90KQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IGJvdEJhc2UgPSB0aGF0LmJvdCA/IHRoYXQuYm90OiBsaW5rcy5hYkJvdDsKY29uc3QgZGltZW5zaW9uID0gIXRoYXQuYm90ID8gYm90QmFzZS50YWdzLmRpbWVuc2lvbiA6IHRoYXQuZGltZW5zaW9uID8gdGhhdC5kaW1lbnNpb24gOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwpjb25zdCBtZXNzYWdlID0gdGhhdC5tZXNzYWdlOwpjb25zdCBtZXNzYWdlVGltZSA9IHRoYXQudGltZSA/IHRoYXQudGltZSAqIDEwMDAgOiAxNjAwOyAKCmNvbnN0IG1lc3NhZ2VCb3QgPSBhd2FpdCBsaW5rcy5ib3RfZmFjdG9yeS5hYkNyZWF0ZUJpbGxib2FyZExhYmVsKHsKICAgIGJvdDogYm90QmFzZSwKICAgIGxhYmVsOiBtZXNzYWdlLAogICAgZGltZW5zaW9uLAogICAgbWVzc2FnZVRpbWUsCiAgICBjb2xvcjogIiMwMDAwMDAiLAogICAgbGFiZWxDb2xvcjogIiNmZmZmZmYiLAogICAgb25Cb3RBZGRlZDogYEAKICAgICAgICBhd2FpdCBvcy5zbGVlcCh0YWdzLm1lc3NhZ2VUaW1lKTsKICAgICAgICB0aGlzQm90Lm9uRmFkZSgpOwogICAgYCwKICAgIG9uRmFkZTogYEAKICAgICAgICBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgICAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgICAgICBmb3JtT3BhY2l0eTogMSwKICAgICAgICAgICAgICAgIGxhYmVsT3BhY2l0eTogMSwKICAgICAgICAgICAgICAgIFt0YWdzLmRpbWVuc2lvbiArICJaIl06IHRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWiJdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgICAgIGZvcm1PcGFjaXR5OiAwLAogICAgICAgICAgICAgICAgbGFiZWxPcGFjaXR5OiAwLAogICAgICAgICAgICAgICAgW3RhZ3MuZGltZW5zaW9uICsgIloiXTogdGFnc1t0YWdzLmRpbWVuc2lvbiArICJaIl0gKyA1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGR1cmF0aW9uOiAke3RoYXQuZHVyYXRpb24gPz8gM30KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4ge30pCiAgICAgICAgLmZpbmFsbHkoKCkgPT4gewogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgIH0pCgogICAgYCwKfSk7JwCmif/EAZ9tEG9uQW55Qm90RHJhZ2dpbmcCBACmif/EAYSgAokQQGlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMgJiYgdGhhdC5ib3QuaWQgPT0gbGlua3MuYWJCb3QuaWQpCnsKICAgIGNvbnN0IGFjdGl2ZURpbWVuc2lvbiA9IGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQWN0aXZlRGltZW5zaW9uID8/IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CiAgICBsZXQgZHJhZ0Nvb3JkaW5hdG9yQm90ID0gbGlua3MuZHJhZ0Nvb3JkOwogICAgCiAgICBpZiAoIWRyYWdDb29yZGluYXRvckJvdCkKICAgIHsKICAgICAgICBjb25zdCBkcmFnQ29vcmRpbmF0b3JCb3RNb2QgPSB7fTsKCiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kLnNwYWNlID0gInRlbXBMb2NhbCI7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kLm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZC5kaW1lbnNpb24gPSBhY3RpdmVEaW1lbnNpb247CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kW2FjdGl2ZURpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZFthY3RpdmVEaW1lbnNpb24gKyAiWCJdID0gMDsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2RbYWN0aXZlRGltZW5zaW9uICsgIlkiXSA9IDA7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kW2FjdGl2ZURpbWVuc2lvbiArICJaIl0gPSAtMTsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2QucG9pbnRhYmxlID0gZmFsc2U7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kLmNvbG9yID0gImNsZWFyIjsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2Qub25BbnlCb3RQb2ludGVyVXAgPSBgQCBsaW5rcy5tYW5hZ2VyLm1hc2tzLmRyYWdDb29yZCA9IG51bGw7IHNob3V0KCdhYlN0b3BEcmFnJywge3g6IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WCwgeTogdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1ZfSk7IGRlc3Ryb3kodGhpc0JvdCk7YDsKCiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90ID0gY3JlYXRlKGRyYWdDb29yZGluYXRvckJvdE1vZCk7CgogICAgICAgIG1hc2tzLmRyYWdDb29yZCA9IGdldExpbmsoZHJhZ0Nvb3JkaW5hdG9yQm90KTsKCiAgICAgICAgY29uc3QgZHJhZ0JvdHMgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXM7CgogICAgICAgIGxpbmtzLmFiQm90Lm1hc2tzLnRyYW5zZm9ybWVyID0gZHJhZ0Nvb3JkaW5hdG9yQm90LmlkOwogICAgICAgIGxpbmtzLmFiQm90Lm1hc2tzLmFiU3RvcERyYWcgPSBgQCBtYXNrcy50cmFuc2Zvcm1lciA9IG51bGw7IG1hc2tzLmFiU3RvcERyYWcgPSBudWxsOyB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVggPSB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVggKyB0aGF0Lng7IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WSA9IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WSArIHRoYXQueWA7CgogICAgICAgIHNldFRhZ01hc2soZHJhZ0JvdHMsICJ0cmFuc2Zvcm1lciIsIGRyYWdDb29yZGluYXRvckJvdC5pZCwgInRlbXBMb2NhbCIpOwogICAgICAgIHNldFRhZ01hc2soZHJhZ0JvdHMsICJhYlN0b3BEcmFnIiwgYEAgbWFza3MudHJhbnNmb3JtZXIgPSBudWxsOyBtYXNrcy5hYlN0b3BEcmFnID0gbnVsbDsgdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1YID0gdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1YICsgdGhhdC54OyB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVkgPSB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVkgKyB0aGF0LnlgLCAidGVtcExvY2FsIik7CiAgICB9CgogICAgY29uc3QgeENoYW5nZSA9IHRoYXQudG8ueCAtIHRoYXQuZnJvbS54OwogICAgY29uc3QgeUNoYW5nZSA9IHRoYXQudG8ueSAtIHRoYXQuZnJvbS55OwoKICAgIGRyYWdDb29yZGluYXRvckJvdC50YWdzW2FjdGl2ZURpbWVuc2lvbiArICJYIl0gPSB4Q2hhbmdlOwogICAgZHJhZ0Nvb3JkaW5hdG9yQm90LnRhZ3NbYWN0aXZlRGltZW5zaW9uICsgIlkiXSA9IHlDaGFuZ2U7CiAgICBkcmFnQ29vcmRpbmF0b3JCb3QudGFnc1thY3RpdmVEaW1lbnNpb24gKyAiWiJdID0gLTE7Cn0nAKaJ/8QBn20JYWJWZXJzaW9uAgQApon/xAGOsAIFMTAuMzQnAKaJ/8QBn20JYW5pbWF0aW9uAgQApon/xAGUsAIo8J+Ul2IyNmUxMDg5LTE3MmQtNDVhOS04ZDIyLTA1YzNmNThjMmJmNycApon/xAGfbQ9vbkFueUJvdENsaWNrZWQCBACmif/EAbuwAogRQGlmICghbGlua3MucmVtZW1iZXIudGFncy5hYlJpZ2h0Q2xpY2tEaXNhYmxlZCAgJiYgIXRoYXQuYm90LnRhZ3MuYWJSaWdodENsaWNrSWdub3JlICYmIHRoYXQubW9kYWxpdHkgPT0gIm1vdXNlIiAmJiB0aGF0LmJ1dHRvbklkID09ICJyaWdodCIpIHsNCg0KICAgIGlmICghdGFncy5hYkF3YWtlKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvL2FiIHNlbGVjdGVkDQogICAgaWYgKHRoYXQuYm90ID09IGxpbmtzLmFiQm90KQ0KICAgIHsNCiAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy9HZXQgcmlkIG9mIGFueSBvdGhlciBvbmVzDQogICAgaWYgKGxpbmtzLmFiQm90LnRhZ3MuYXJtKSB7DQogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QubGlua3MuYXJtKTsNCiAgICB9DQoNCiAgICAvL2FuaW1hdGlvbnMNCiAgICBpZiAoIWxpbmtzLmFiQm90LnRhZ3MuaW50ZXJ2YWwpIHsNCiAgICAgICAgdGhpc0JvdC5hYkNsaWNrKCk7DQogICAgfQ0KDQogICAgLy9DcmVhdGUgYXJtDQogICAgbGV0IGFybSA9IHt9Ow0KDQogICAgYXJtLnNwYWNlID0gInRlbXBMb2NhbCI7DQogICAgYXJtW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uXSA9IHRydWU7DQogICAgYXJtW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlgiXSA9IHRoYXQuYm90LnRhZ3NbbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWCJdOw0KICAgIGFybVtsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LmJvdC50YWdzW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlkiXTsNCiAgICBhcm0uY3JlYXRvciA9IGxpbmtzLmFiQm90LmlkOw0KICAgIGFybS5kaW1lbnNpb24gPSBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbjsNCiAgICBhcm0uc2NhbGUgPSAwLjk7DQogICAgYXJtLnNjYWxlWiA9IDAuMDE7DQogICAgYXJtLmNvbG9yID0gImNsZWFyIjsNCiAgICBhcm0uc3Ryb2tlQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOw0KICAgIGFybS5saW5lQ29sb3IgPSBsaW5rcy5hYkJvdC50YWdzLnN0cm9rZUNvbG9yOw0KICAgIGFybS5saW5lVG8gPSBsaW5rcy5hYkJvdC5pZDsNCiAgICBhcm0ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7DQogICAgYXJtLm9uQ2xpY2sgPSBgQCBkZXN0cm95KHRoaXNCb3QpOw0KICAgICAgICAgICAgICAgICAgICBzaG91dCgib25BQkZvb3RDbGlja2VkIiwgeyBkaW1lbnNpb246IHRhZ3MuZGltZW5zaW9uIH0pOw0KICAgICAgICAgICAgICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogdGFncy5kaW1lbnNpb24sIHBvc2l0aW9uOnt4OnRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWCJdLHk6dGFnc1t0YWdzLmRpbWVuc2lvbiArICJZIl19fSk7YDsNCg0KICAgIGxldCBuZXdBcm0gPSBhd2FpdCBjcmVhdGUoYXJtKTsNCg0KICAgIGxpbmtzLmFiQm90Lm1hc2tzLmFybSA9ICLwn5SXIiArIG5ld0FybS5pZDsNCg0KICAgIHRoaXNCb3Qub25BbnlCb3REcm9wRW50ZXIoew0KICAgICAgICBkcmFnQm90OiBsaW5rcy5hYkJvdC5saW5rcy5hcm0sDQogICAgICAgIHRvOiB7DQogICAgICAgICAgICBib3Q6IHRoYXQuYm90LA0KICAgICAgICAgICAgeDogdGhhdC5ib3QudGFnc1tsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJYIl0sDQogICAgICAgICAgICB5OiB0aGF0LmJvdC50YWdzW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlkiXSwNCiAgICAgICAgICAgIGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24NCiAgICAgICAgfSwNCiAgICAgICAgZnJvbTogew0KICAgICAgICAgICAgeDogbGlua3MuYWJCb3QudGFnc1tsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJYIl0sDQogICAgICAgICAgICB5OiBsaW5rcy5hYkJvdC50YWdzW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlkiXSwNCiAgICAgICAgICAgIGRpbWVuc2lvbjogbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24NCiAgICAgICAgfQ0KICAgIH0pDQoNCiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJvdEZvY3VzID0gIvCflJciICsgdGhhdC5ib3QuaWQ7DQoNCiAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJib3QifSk7DQoNCiAgICByZXR1cm47DQp9JwCmif/EAZ9tBWlucHV0AgQApon/xAG+wQIo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcApon/xAGfbQtwZXJzb25hbGl0eQIEAKaJ/8QB5cECKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAKaJ/8QBn20NYWJQZXJzb25hbGl0eQIEAKaJ/8QBjMICBHRydWUnAKaJ/8QBn20KYWJTZXRBd2FrZQIEAKaJ/8QBkcICpRJAbGV0IGF3YWtlID0gdGhhdD8uYXdha2U7CmxldCBpbml0aWFsID0gdGhhdD8uaW5pdGlhbCA/PyBmYWxzZTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7Cn0KCmFzc2VydCh0eXBlb2YgYXdha2UgPT09ICdib29sZWFuJywgYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhd2FrZSBpcyBhIHJlcXVpcmVkIGJvb2xlYW4gcGFyYW1ldGVyLmApOwoKaWYgKGNvbmZpZ0JvdC50YWdzLmFiU3RheUF3YWtlKSB7CiAgICAvLyBJZiBhYlN0YXlBd2FrZSBpcyBlbmFibGVkLCBvdmVycmlkZSB0aGUgaW5jb21pbmcgYXdha2UgcGFyYW1ldGVyIGFuZCBuZXZlciBsZXQgYWIgYmUgcHV0IHRvIHNsZWVwLgogICAgYXdha2UgPSB0cnVlOwp9CgppZiAodGFncy5hYkF3YWtlICE9PSBhd2FrZSkgewogICAgaWYgKGluaXRpYWwpIHsKICAgICAgICAvLyBMb2FkIHVwIHNvbWUgY29yZSBhYiBza2lsbHMuCiAgICAgICAgY29uc3Qgc2tpbGxBcnJheSA9IFsiYWJQZXJzb25hbGl0eSIsICJhYkludGVyZmFjZSIsICJhYkFjdGlvbiIsICJhYlRlc3RzIl07CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2tpbGxBcnJheS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhd2FpdCBsaW5rcy5sZWFybi5hYkFkYXB0KHNraWxsQXJyYXlbaV0pOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgb3Muc2xlZXAoMzAwKTsKCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pIHsKICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSBjb25maWdCb3QudGFncy5wYXR0ZXJuOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gdXVpZCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBQbGF5IGluaXRpYWwgYW5pbWF0aW9uIGlmIG9uZSBpcyBkZWZpbmVkIG9uIGFiQ29uZmlnLgogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbEFuaW1hdGlvbikgewogICAgICAgICAgICBhd2FpdCBsaW5rcy5hbmltYXRpb25bbGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxBbmltYXRpb25dKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFNob3cgaW5pdGlhbCBtZXNzYWdlIGlmIG9uZSBpcyBkZWZpbmVkIG9uIGFiQ29uZmlnLgogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2UpIHsKICAgICAgICAgICAgc2hvdXQoInNob3dDb25zb2xlIik7CgogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2UpKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsTWVzc2FnZS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsTWVzc2FnZVtpXSk7CgogICAgICAgICAgICAgICAgICAgIGF3YWl0IG9zLnNsZWVwKDIwMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYWIubG9nKGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgbGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBVcGRhdGUgYWJBd2FrZSBzaGFyZWQgdGFnIG1hc2suCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICdhYkF3YWtlJywgYXdha2UsICdzaGFyZWQnKTsKICAgIAogICAgaWYgKGF3YWtlKSB7CiAgICAgICAgbGV0IGRpbWVuc2lvbiA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CgogICAgICAgIGlmICghZGltZW5zaW9uKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGF3YWl0IHRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7IGRpbWVuc2lvbiwgcG9zaXRpb246IHsgeDogMCwgeTogMCB9IH0pOwoKICAgICAgICBzaG91dCgib25BQkF3YWtlIiwgeyBkaW1lbnNpb24sIHBvc2l0aW9uOiB7IHg6IDAsIHk6IDAgfSB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgZGVzdHJveShsaW5rcy5hYkJvdCk7CgogICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CiAgICAgICAgc2hvdXQoIm9uQUJTbGVlcCIpOwogICAgfQp9JwCmif/EAZ9tBXV0aWxzAgQApon/xAG31AIo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YycApon/xAGfbQtib3RfZmFjdG9yeQIEAKaJ/8QB3tQCKPCflJdjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcnAKaJ/8QBn20Pb25BQkluaXRpYWxpemVkAgQApon/xAGF1QJ9QGlmIChjb25maWdCb3QudGFncy5tYXBQb3J0YWwpIHsNCiAgICB0aGlzQm90Lm9uUG9ydGFsQ2hhbmdlZCh7cG9ydGFsOiAibWFwUG9ydGFsIiwgZGltZW5zaW9uOiBjb25maWdCb3QudGFncy5tYXBQb3J0YWx9KTsNCn0nAKaJ/8QBn20FZGVidWcCBACmif/EAYPWAgVmYWxzZQA="}]}