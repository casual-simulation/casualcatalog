{"version":2,"updates":[{"id":0,"timestamp":1755888719173,"update":"AaMB2uGm0woAJwEEYm90cyQxNjU1NGJjMS1lOTNlLTRhMGItOGNkMy1kZmQ3NzIzMTk2NzIBJwDa4abTCgAJYWJWZXJzaW9uAgQA2uGm0woBBDEwLjYnANrhptMKAAZzeXN0ZW0CBADa4abTCgYWYWIucGVyc29uYWxpdHkudmVyc2lvbicA2uGm0woAGWFiUGVyc29uYWxpdHlNYWpvclZlcnNpb24CBADa4abTCh0BMScA2uGm0woADW9uU2tpbGxVcGRhdGUCBADa4abTCh+tAUBjb25zdCB2ZXJzaW9uU3RyaW5nID0gdGFncy5hYlBlcnNvbmFsaXR5TWFqb3JWZXJzaW9uICsgIi4iICsgdGFncy5hYlBlcnNvbmFsaXR5TWlub3JWZXJzaW9uOwoKY29uc29sZS5sb2coIltBQlBlcnNvbmFsaXR5XSBMb2FkZWQgQUIgUGVyc29uYWxpdHkgdmVyc2lvbiAiICsgdmVyc2lvblN0cmluZyk7JwDa4abTCgANYWJQZXJzb25hbGl0eQIEANrhptMKzQEEdHJ1ZScA2uGm0woACGFiSWdub3JlAgQA2uGm0wrSAQR0cnVlJwDa4abTCgAEZm9ybQIEANrhptMK1wEHbm90aGluZycA2uGm0woAGWFiUGVyc29uYWxpdHlNaW5vclZlcnNpb24CBADa4abTCt8BATknAQRib3RzJGIyNmUxMDg5LTE3MmQtNDVhOS04ZDIyLTA1YzNmNThjMmJmNwEnANrhptMK4QEGc3lzdGVtAgQA2uGm0wriARhhYi5wZXJzb25hbGl0eS5hbmltYXRpb24nANrhptMK4QEEZm9ybQIEANrhptMK+wEHbm90aGluZycA2uGm0wrhAQhhYklnbm9yZQIEANrhptMKgwIEdHJ1ZScA2uGm0wrhAQ1tYW5pZmVzdGF0aW9uAgQA2uGm0wqIAijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDa4abTCuEBCHJlbWVtYmVyAgQA2uGm0wqvAijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDa4abTCuEBGGFuaW1hdGlvbl9hYkdyaWRNYW5pZmVzdAIEANrhptMK1gLqDkBzaG91dCgicmVzZXQiKTsKCmNvbnN0IHBvc2l0aW9uWCA9IHRoYXQ/LnBvc2l0aW9uLnggPz8gMDsKY29uc3QgcG9zaXRpb25ZID0gdGhhdD8ucG9zaXRpb24ueSA/PyAwOwpjb25zdCBkaW1lbnNpb24gPSB0aGF0Py5kaW1lbnNpb24gPz8gImhvbWUiOwpjb25zdCBncmlkU2NhbGUgPSB0aGF0Py5zY2FsZSA/PyA1Owpjb25zdCBtb21lbnRDb3VudCA9IDA7CmNvbnN0IGdyaWRCb3QgPSB7fTsKCmdyaWRCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKZ3JpZEJvdC5jb2xvciA9ICJjbGVhciI7CmdyaWRCb3Quc3Ryb2tlQ29sb3IgPSBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmdyaWRCb3Quc2NhbGUgPSAwLjAwMTsKZ3JpZEJvdC5zY2FsZVogPSAwLjE7CmdyaWRCb3QucmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmdyaWRCb3RbZGltZW5zaW9uXSA9IHRydWU7CmdyaWRCb3QucG9pbnRhYmxlID0gZmFsc2U7CmdyaWRCb3Qua2lsbFRpbWVyID0gIkAgYXdhaXQgb3Muc2xlZXAoNDAwKTsgZGVzdHJveSh0aGlzQm90KTsiOwoKbGV0IHJvdW5kQm90czsKCmZvciAobGV0IGkgPSBncmlkU2NhbGU7IGkgPiAwOyBpLS0pCnsKICAgIGNvbnN0IGJvdENvdW50ID0gaSAqIDg7CgogICAgbGV0IHNpZGVDb3VudCA9IDA7CiAgICBsZXQgcGhhc2VGYWN0b3IgPSAwOwoKICAgIGZvciAobGV0IGogPSAwOyBqIDwgYm90Q291bnQ7IGorKykKICAgIHsKICAgICAgICBpZiAocGhhc2VGYWN0b3IgPT0gMCkKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9ICgoaSArIHBvc2l0aW9uWCkgKiAtMSkgKyBzaWRlQ291bnQ7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlkiXSA9IGkgKyBwb3NpdGlvblk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBoYXNlRmFjdG9yID09IDEpCiAgICAgICAgewogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJYIl0gPSBpICsgcG9zaXRpb25YOwogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJZIl0gPSAoaSArIHBvc2l0aW9uWSkgLSBzaWRlQ291bnQ7ICAKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocGhhc2VGYWN0b3IgPT0gMikKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9IChpICsgcG9zaXRpb25YKSAtIHNpZGVDb3VudDsKICAgICAgICAgICAgZ3JpZEJvdFtkaW1lbnNpb24gKyAiWSJdID0gKChpICsgcG9zaXRpb25ZKSAqIC0xKSA7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9ICgoaSArIHBvc2l0aW9uWCkgKiAtMSkgOwogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJZIl0gPSAoKGkgKyBwb3NpdGlvblkpICogLTEpICsgc2lkZUNvdW50OyAgCiAgICAgICAgfQoKICAgICAgICBjb25zdCBuZXdHcmlkQm90ID0gYXdhaXQgY3JlYXRlKGdyaWRCb3QpOwoKICAgICAgICBhbmltYXRlVGFnKG5ld0dyaWRCb3QsICJzY2FsZSIsIHsKICAgICAgICAgICAgdG9WYWx1ZTogMSwKICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAiZWxhc3RpYyIsCiAgICAgICAgICAgICAgICBtb2RlOiAib3V0IgogICAgICAgICAgICB9LAogICAgICAgICAgICBkdXJhdGlvbjogMC4wMQogICAgICAgIH0pOwoKICAgICAgICBuZXdHcmlkQm90LmtpbGxUaW1lcigpOwoKICAgICAgICBzaWRlQ291bnQrKzsKCiAgICAgICAgaWYgKHNpZGVDb3VudCA9PSBib3RDb3VudCAvIDQpCiAgICAgICAgewogICAgICAgICAgICBzaWRlQ291bnQgPSAwOwoKICAgICAgICAgICAgcGhhc2VGYWN0b3IrKzsKICAgICAgICB9CgogICAgICAgIGF3YWl0IG9zLnNsZWVwKDgpOwogICAgfQp9JwDa4abTCuEBCWFiVmVyc2lvbgIEANrhptMKwREEMTAuNicA2uGm0wrhAQZvbkNoYXQCBADa4abTCsYRVUAvLyBpZiAodGhhdC5tZXNzYWdlID09ICJAdGVzdCIpCi8vIHsKLy8gICAgIHRoaXNCb3QuYW5pbWF0aW9uX2FiR3JpZE1hbmlmZXN0KCk7Ci8vIH0nANrhptMK4QELcGVyc29uYWxpdHkCBADa4abTCpwSKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInANrhptMK4QENYWJQZXJzb25hbGl0eQIEANrhptMKwxIEdHJ1ZScBBGJvdHMkYjc2ZGZiYzQtODU0Yi00ZjZkLWE5MWYtYTk0ODY5NDc3NGRiAScA2uGm0wrIEgZzeXN0ZW0CBADa4abTCskSFWFiLnBlcnNvbmFsaXR5LmNvbmZpZycA2uGm0wrIEghhYklnbm9yZQIEANrhptMK3xIEdHJ1ZScA2uGm0wrIEgRmb3JtAgQA2uGm0wrkEgdub3RoaW5nJwDa4abTCsgSC2FiQmFzZUNvbG9yAgQA2uGm0wrsEgcjMDBEOUNEJwDa4abTCsgSEWFiQmFzZVN0cm9rZUNvbG9yAgQA2uGm0wr0EgcjMDBEOUNEJwDa4abTCsgSEGFiQmx1ZXByaW50Q29sb3ICBADa4abTCvwSByMwMDgyN0InANrhptMKyBIIcmVtZW1iZXICBADa4abTCoQTKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnANrhptMKyBIRYWJCdWlsZGVySWRlbnRpdHkCBADa4abTCqsTCmNhc3VhbC5ib3QnANrhptMKyBIJYWJWZXJzaW9uAgQA2uGm0wq2EwQxMC42JwDa4abTCsgSF2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnAgQA2uGm0wq7E78OQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCFhdXRoQm90KSB7DQogICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsNCn0NCg0KaWYgKCFhdXRoQm90KSB7DQogICAgcmV0dXJuOw0KfQ0KDQphd2FpdCBvcy5ncmFudEluc3RBZG1pblBlcm1pc3Npb24oYXV0aEJvdC5pZCk7DQoNCmxldCBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGF3YWl0IG9zLmdldERhdGEoYXV0aEJvdC5pZCwgImFiUGVyc29uYWxpdHlDb25maWciKTsNCg0KaWYgKGFiUGVyc29uYWxpdHlDb25maWdEYXRhLnN1Y2Nlc3MgPT0gZmFsc2UpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IHt9Ow0KfSBlbHNlIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGFiUGVyc29uYWxpdHlDb25maWdEYXRhLmRhdGE7DQp9DQoNCmlmICh0aGF0Lm5hbWUpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCdWlsZGVySWRlbnRpdHkiXSA9IHRoYXQubmFtZTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJ1aWxkZXJJZGVudGl0eSIsIHRoYXQubmFtZSwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LmNvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZUNvbG9yIl0gPSB0aGF0LmNvbG9yOw0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VTdHJva2VDb2xvciJdID0gdGhhdC5jb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VDb2xvciIsIHRoYXQuY29sb3IsICJsb2NhbCIpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiQmFzZVN0cm9rZUNvbG9yIiwgdGhhdC5jb2xvciwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LnBvcnRhbENvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZUdyaWRQb3J0YWxDb2xvciJdID0gdGhhdC5wb3J0YWxDb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiLCB0aGF0LnBvcnRhbENvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQubWVudUNvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZU1lbnVDb2xvciJdID0gdGhhdC5tZW51Q29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlTWVudUNvbG9yIiwgdGhhdC5tZW51Q29sb3IsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5tZW51TGFiZWxDb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VMYWJlbENvbG9yIl0gPSB0aGF0Lm1lbnVMYWJlbENvbG9yOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiQmFzZUxhYmVsQ29sb3IiLCB0aGF0Lm1lbnVMYWJlbENvbG9yLCAibG9jYWwiKTsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCYXNlU2hhZG93Q29sb3IiXSA9IHRoYXQubWVudUxhYmVsQ29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlU2hhZG93Q29sb3IiLCB0aGF0Lm1lbnVMYWJlbENvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQuZm9ybSkgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkZvcm0iXSA9IHRoYXQuZm9ybTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkZvcm0iLCB0aGF0LmZvcm0sICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5kZWZhdWx0UGVyc29uYWxpdHkpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IHt9Ow0KICAgIHRoaXNCb3QudXBkYXRlUGVyc29uYWxpdHkoe30pOw0KfQ0KDQphd2FpdCBvcy5yZWNvcmREYXRhKGF1dGhCb3QuaWQsICJhYlBlcnNvbmFsaXR5Q29uZmlnIiwgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEpOycA2uGm0wrIEg9hYkJhc2VNZW51Q29sb3ICBADa4abTCvshByMwMEQ5Q0QnANrhptMKyBIRdXBkYXRlUGVyc29uYWxpdHkCBADa4abTCoMikgtAbGV0IGFiUGVyc29uYWxpdHlDb25maWdEYXRhOw0KDQppZiAodGhhdCAmJiB0aGF0ID09IHt9KSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSB7fTsNCn0gZWxzZSB7DQogICAgaWYgKCFhdXRoQm90KSB7DQogICAgICAgIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7DQogICAgfQ0KDQogICAgaWYgKGF1dGhCb3QpIHsNCiAgICAgICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSBhd2FpdCBvcy5nZXREYXRhKGF1dGhCb3QuaWQsICJhYlBlcnNvbmFsaXR5Q29uZmlnIik7DQogICAgICAgIGlmICghbGlua3MucmVtZW1iZXIgJiYgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEuc3VjY2VzcyA9PSBmYWxzZSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGFiUGVyc29uYWxpdHlDb25maWdEYXRhLnN1Y2Nlc3MpIHsNCiAgICAgICAgICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhID0gYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEuZGF0YTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy9hYkJsdWVQcmludENvbG9yDQovL2FiQmFzZUFjY2VudENvbG9yDQpjb25zdCBhYlRhZ3MgPSBbImFiQmFzZUNvbG9yIiwgImFiQmFzZU1lbnVDb2xvciIsICJhYkJ1aWxkZXJJZGVudGl0eSIsICJhYkJhc2VTdHJva2VDb2xvciIsICJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiLCAiYWJCYXNlTGFiZWxDb2xvciIsICJhYkJhc2VTaGFkb3dDb2xvciJdOw0KDQpjbGVhclRhZ01hc2tzKHRoaXNCb3QpOw0KDQpmb3IgKGxldCBpID0gMDsgaSA8IGFiVGFncy5sZW5ndGg7ICsraSkgew0KICAgIGlmIChhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSAmJiBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVthYlRhZ3NbaV1dKSB7DQogICAgICAgIGlmICh0YWdzW2FiVGFnc1tpXV0gIT0gYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbYWJUYWdzW2ldXSkgew0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCBhYlRhZ3NbaV0sIGFiUGVyc29uYWxpdHlDb25maWdEYXRhW2FiVGFnc1tpXV0sICJsb2NhbCIpOw0KICAgICAgICB9DQogICAgfSBlbHNlIGlmIChsaW5rcy5yZW1lbWJlciAmJiBsaW5rcy5yZW1lbWJlci50YWdzW2FiVGFnc1tpXV0pIHsNCiAgICAgICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3NbYWJUYWdzW2ldXSAhPSB0YWdzW2FiVGFnc1tpXV0pIHsNCiAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgYWJUYWdzW2ldLCBsaW5rcy5yZW1lbWJlci50YWdzW2FiVGFnc1tpXV0sICJsb2NhbCIpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgaWYgKGFiVGFnc1tpXSA9PSAiYWJCYXNlR3JpZFBvcnRhbENvbG9yIikgew0KICAgICAgICBncmlkUG9ydGFsQm90LnRhZ3MucG9ydGFsQ29sb3IgPSB0YWdzLmFiQmFzZUdyaWRQb3J0YWxDb2xvcjsNCiAgICB9DQp9JwDa4abTCsgSDWFiUGVyc29uYWxpdHkCBADa4abTCpYtBHRydWUnANrhptMKyBINb25Ta2lsbFVwZGF0ZQIEANrhptMKmy0dQHRoaXNCb3QudXBkYXRlUGVyc29uYWxpdHkoKTsnANrhptMKyBIRYWJCYXNlU2hhZG93Q29sb3ICBADa4abTCrktBWJsYWNrJwDa4abTCsgSEGFiQmFzZUxhYmVsQ29sb3ICBADa4abTCr8tBWJsYWNrJwEEYm90cyRiOWI4MjgxOS0xZjE0LTQzOTItODhhOS01MmY2N2E5ZjhlNTUBJwDa4abTCsUtBnN5c3RlbQIEANrhptMKxi0YYWIucGVyc29uYWxpdHkuYXJtX251ZGdlJwDa4abTCsUtDW9uQUJBcm1QbGFjZWQCBADa4abTCt8tOEBzZXRUYWdNYXNrKHRoaXNCb3QsICdoYXNBcm1CZWVuUGxhY2VkJywgdHJ1ZSwgJ2xvY2FsJyk7JwDa4abTCsUtCW9uQUJBd2FrZQIEANrhptMKmC4bQHRoaXNCb3QuYWJTdGFydEFybU51ZGdlKCk7JwDa4abTCsUtCGFiSWdub3JlAgQA2uGm0wq0LgR0cnVlJwDa4abTCsUtDWFiUGVyc29uYWxpdHkCBADa4abTCrkuBHRydWUnANrhptMKxS0EZm9ybQIEANrhptMKvi4Hbm90aGluZycA2uGm0wrFLQVsZWFybgIEANrhptMKxi4o8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycA2uGm0wrFLQ1tYW5pZmVzdGF0aW9uAgQA2uGm0wrtLijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDa4abTCsUtCHJlbWVtYmVyAgQA2uGm0wqULyjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDa4abTCsUtBWRlYnVnAgQA2uGm0wq7LwVmYWxzZScA2uGm0wrFLQ5hcm1OdWRnZVdhaXRNUwIEANrhptMKwS8ENTAwMCcA2uGm0wrFLQ9vbkFCSW5pdGlhbGl6ZWQCBADa4abTCsYvG0B0aGlzQm90LmFiU3RhcnRBcm1OdWRnZSgpOycA2uGm0wrFLQ9hYlN0YXJ0QXJtTnVkZ2UCBADa4abTCuIv/xNAaWYgKHRoaXNCb3QudmFycy5udWRnZUFjdGl2ZSkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoZXJlIGlzIGFscmVhZHkgYSBudWRnZSBpbiBwcm9ncmVzcy5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKdGhpc0JvdC52YXJzLm51ZGdlQWN0aXZlID0gdHJ1ZTsKCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHN0YXJ0aW5nIG51ZGdlLi4uYCkKfQoKZnVuY3Rpb24gY2FuTnVkZ2UoKTogYm9vbGVhbiB7CiAgICAvLyBDYW4ndCBoYXZlIHBsYWNlZCB0aGUgYXJtIGFscmVhZHkuCiAgICBpZiAodGFncy5oYXNBcm1CZWVuUGxhY2VkKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYW5ub3QgbnVkZ2U6IGFybSBwbGFjZW1lbnQgaGFzIGFscmVhZHkgb2NjdXJlZC5gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIEFCIG1hbmlmZXN0YXRpb24gYm90IG11c3QgYmUgYWN0aXZlLgogICAgaWYgKCFsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYW5ub3QgbnVkZ2U6IGFiIG1hbmlmZXN0YXRpb24gYm90IGlzIGluYWN0aXZlLmApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gVGhlIGluc3QgbXVzdCBiZSBlbXB0eSBvZiBhbGwgYm90cy4gVGhlIGV4Y2VwdGlvbnMgYXJlIGFiIGJvdHMgYW5kIGJ1aWx0LWluIGJvdHMuCiAgICBjb25zdCB1c2VyTWFkZUJvdCA9IGdldEJvdCgoYikgPT4gewogICAgICAgIHJldHVybiAhYi50YWdzLnN5c3RlbT8uc3RhcnRzV2l0aCgnYWIuJykgJiYKICAgICAgICAgICAgICAgIGIuc3BhY2UgPT09ICdzaGFyZWQnCiAgICB9KQogICAgCiAgICBpZiAodXNlck1hZGVCb3QpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogaW5zdCBjb250YWlucyB1c2VyIG1hZGUgYm90cy5gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIE1lbnUgcG9ydGFsIG11c3QgZWl0aGVyIGJlIGluYWN0aXZlIG9yIG5vdCBoYXZlIGFueSBib3RzIGluIHRoZSBjdXJyZW50bHkgYWN0aXZlIG1lbnUgcG9ydGFsLgogICAgaWYgKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwpIHsKICAgICAgICBjb25zdCBib3RJbk1lbnVQb3J0YWwgPSBnZXRCb3QoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIudGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9PT0gdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICBpZiAoYm90SW5NZW51UG9ydGFsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogbWVudVBvcnRhbCBpcyBjdXJyZW50bHkgb3BlbiBhbmQgaGFzIGJvdHMgaW4gaXQuYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKaWYgKGNhbk51ZGdlKCkpIHsKICAgIC8vIFN0YXJ0IG51ZGdlIGZvciBhcm0gcGxhY2VtZW50LgogICAgYXdhaXQgb3Muc2xlZXAodGFncy5hcm1OdWRnZVdhaXRNUyk7CgogICAgaWYgKGNhbk51ZGdlKCkpIHsKICAgICAgICAvLyBQZXJmb3JtIHRoZSBhcm0gcGxhY2VtZW50IG51ZGdlLgogICAgICAgIGNvbnN0IGdyaWRDbGlja1BhcmFtcyA9IHsKICAgICAgICAgICAgZGltZW5zaW9uOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uLAogICAgICAgICAgICBwb3NpdGlvbjogeyB4OiA1LCB5OiAwIH0sCiAgICAgICAgICAgIGZvcmNlQXJtUGxhY2VtZW50OiB0cnVlLAogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB3aGlzcGVyaW5nIG9uR3JpZENsaWNrIHRvIHRoZSBhYiBtYW5pZmVzdGF0aW9uIGJvdCB3aXRoIHRoZSBwYXJhbXM6YCwgZ3JpZENsaWNrUGFyYW1zKQogICAgICAgIH0KCiAgICAgICAgLy8gRm9yY2UgYWIgYXJtIHBsYWNlbWVudCB1c2luZyB0aGUgb25HcmlkQ2xpY2sgbGlzdGVuZXIgb2YgdGhlIG1hbmlmZXN0YXRpb24gYm90LgogICAgICAgIHdoaXNwZXIobGlua3MubWFuaWZlc3RhdGlvbiwgJ29uR3JpZENsaWNrJywgZ3JpZENsaWNrUGFyYW1zKTsKICAgIH0KfQoKdGhpc0JvdC52YXJzLm51ZGdlQWN0aXZlID0gZmFsc2U7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkb25lYCk7Cn0nANrhptMKxS0JYWJWZXJzaW9uAgQA2uGm0wriQwQxMC42JwDa4abTCsUtD29uUG9ydGFsQ2hhbmdlZAIEANrhptMK50O9AUBjb25zdCB7IHBvcnRhbCwgZGltZW5zaW9uIH0gPSB0aGF0OwoKY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0YCwgdGhhdCk7CgppZiAocG9ydGFsID09PSAnbWVudVBvcnRhbCcpIHsKICAgIGlmICghZGltZW5zaW9uKSB7CiAgICAgICAgdGhpc0JvdC5hYlN0YXJ0QXJtTnVkZ2UoKTsKICAgIH0KfScA2uGm0wrFLQ1hYk1lbnVSZWZyZXNoAgQA2uGm0wqlRRtAdGhpc0JvdC5hYlN0YXJ0QXJtTnVkZ2UoKTsnAQRib3RzJGRjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZAEnANrhptMKwUUGc3lzdGVtAgQA2uGm0wrCRRxhYi5wZXJzb25hbGl0eS5tYW5pZmVzdGF0aW9uJwDa4abTCsFFBGZvcm0CBADa4abTCt9FB25vdGhpbmcnANrhptMKwUULZGVzY3JpcHRpb24CBADa4abTCudFOFRoaXMgc2tpbGwgY29udHJvbHMgdGhlIGFjdHVhbCBib3QgZm9yIHRoZSBhYiBpbnRlcmZhY2UuJwDa4abTCsFFBWxlYXJuAgQA2uGm0wqgRijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDa4abTCsFFD29uUG9ydGFsQ2hhbmdlZAIEANrhptMKx0a8DUBpZiAoY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgIT0gbnVsbCB8fCBjb25maWdCb3QudGFncy5zeXN0ZW1Qb3J0YWwgIT0gbnVsbCkKewogICAgaWYgKHRhZ3MuYWJCb3QpCiAgICB7CiAgICAgICAgZGVzdHJveShsaW5rcy5hYkJvdCk7CiAgICB9CgogICAgcmV0dXJuOwp9CgppZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBd2FrZVN0YXRlIHx8IHRoYXQucG9ydGFsID09ICJ0YWdQb3J0YWwiIHx8IHRoYXQucG9ydGFsID09ICJtZW51UG9ydGFsIiB8fCAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCkpCnsKICAgIHJldHVybjsKfQoKaWYgKHRhZ3MuYWJCb3QpCnsKICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwp9Cgpjb25zdCBwb3J0YWxBcnJheSA9IFsibWluaUdyaWRQb3J0YWwiLCAiZ3JpZFBvcnRhbCIsICJtYXBQb3J0YWwiLCAibWluaU1hcFBvcnRhbCIsICJsZWZ0V3Jpc3RQb3J0YWwiLCAicmlnaHRXcmlzdFBvcnRhbCJdOwoKbGV0IG1hcFBvcnRhbENoZWNrID0gZmFsc2U7CmxldCBuZXdBQiA9IGZhbHNlOwoKaWYgKHBvcnRhbEFycmF5LmluZGV4T2YodGhhdC5wb3J0YWwpICE9IC0xICYmIHRoYXQuZGltZW5zaW9uICYmICFjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCkKewogICAgaWYgKHRoYXQucG9ydGFsID09ICJtYXBQb3J0YWwiKQogICAgewogICAgICAgIG5ld0FCID0gYXdhaXQgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHsgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwgcG9zaXRpb246IHt4OiAtODUuNjc2MTg5NDgyMjQzNCwgeTogNDIuOTY1Njc1Njc1Njc1Nn19KTsKCiAgICAgICAgbWFwUG9ydGFsQ2hlY2sgPSB0cnVlOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG5ld0FCID0gYXdhaXQgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLCBwb3NpdGlvbjp7eDowLHk6MH19KTsKICAgIH0KfQplbHNlIGlmIChwb3J0YWxBcnJheS5pbmRleE9mKHRoYXQucG9ydGFsKSA9PSAtMSAmJiAhdGhhdC5kaW1lbnNpb24pCnsKICAgIGNvbnN0IHN1bW1vbkRpbWVuc2lvbiA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CiAgICAKICAgIG1hcFBvcnRhbENoZWNrID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gdHJ1ZSA6IGZhbHNlOwoKICAgIGlmIChtYXBQb3J0YWxDaGVjaykKICAgIHsKICAgICAgICBuZXdBQiA9IGF3YWl0IHRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7IGRpbWVuc2lvbjogc3VtbW9uRGltZW5zaW9uLCBwb3NpdGlvbjoge3g6IC04NS42NzYxODk0ODIyNDM0LCB5OiA0Mi45NjU2NzU2NzU2NzU2fX0pOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG5ld0FCID0gYXdhaXQgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb246IHN1bW1vbkRpbWVuc2lvbiwgcG9zaXRpb246e3g6MCx5OjB9fSk7CiAgICB9Cn0KZWxzZQp7CiAgICByZXR1cm47Cn0KCmlmIChuZXdBQikKewogICAgYXdhaXQgb3Muc2xlZXAoNTAwKQoKICAgIGNvbnN0IHpvb21WYXJpYW5jZSA9IG1hcFBvcnRhbENoZWNrID8gMjAwMCA6IDEwOwoKICAgIGF3YWl0IG9zLmZvY3VzT24obGlua3MuYWJCb3QsIHt6b29tOiB6b29tVmFyaWFuY2UsIHJvdGF0aW9uOiB7eDogNDUsIHk6IDQ1fX0pLmNhdGNoKGUgPT4ge30pOwp9JwDa4abTCsFFCHJlbWVtYmVyAgQA2uGm0wqEVCjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDa4abTCsFFDWFiTWFuaWZlc3RCb3QCBADa4abTCqtU7BFAaWYgKHRhZ3MuYWJCb3QpCnsKICAgIGF3YWl0IGRlc3Ryb3kobGlua3MuYWJCb3QpOwp9CgpsZXQgYWIgPSB7fTsKCmFiLnNwYWNlID0gInRlbXBMb2NhbCI7CmFiLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvcjsKYWIuZm9ybU9wYWNpdHkgPSAiMC4zMyI7CmFiLmxhYmVsID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VMYWJlbDsKYWIubGFiZWxQb3NpdGlvbiA9ICJmcm9udCI7CmFiLmxhYmVsQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwphYi5sYWJlbFNpemUgPSAwLjYxOwphYi5vbkNsaWNrID0gIkAgaWYgKHRoYXQubW9kYWxpdHkgPT0gJ21vdXNlJyAmJiB0aGF0LmJ1dHRvbklkID09ICdyaWdodCcpIHtyZXR1cm47fSBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soKTsiOwphYi5kaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKYWJbdGhhdC5kaW1lbnNpb25dID0gdHJ1ZTsKYWJbdGhhdC5kaW1lbnNpb24gKyAiWCJdID0gdGhhdC5wb3NpdGlvbi54OwphYlt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LnBvc2l0aW9uLnk7CmFiLnN0cm9rZUNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKLy9hYi5saW5lQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwphYi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKYWIuYW5pbWF0ZUJvdCA9IGBAIGlmIChjb25maWdCb3QudGFncy5hYk9wdGltaXplZCkKewogICAgcmV0dXJuOwp9Cgpjb25zdCByb3RaID0gdGFncy5kaW1lbnNpb24gKyAiUm90YXRpb25aIjsKbGV0IHRhcmdldFNjYWxlID0gMC42NTsKCi8vIGlmICh0YWdzLnNjYWxlIDw9IDAuNjUxKQovLyB7Ci8vICAgICB0YXJnZXRTY2FsZSA9IDAuOTU7Ci8vIH0KCmF3YWl0IGFuaW1hdGVUYWcodGhpc0JvdCwKewogICAgZnJvbVZhbHVlOiB7CiAgICAgICAgW3JvdFpdOiAwLAogICAgICAgIC8vc2NhbGU6IHRhZ3Muc2NhbGUKICAgIH0sCiAgICB0b1ZhbHVlOiB7CiAgICAgICAgW3JvdFpdOiA2LjMsCiAgICAgICAgLy9zY2FsZTogdGFyZ2V0U2NhbGUKICAgIH0sCiAgICBlYXNpbmc6IHsKICAgICAgICB0eXBlOiAic2ludXNvaWRhbCIsCiAgICAgICAgbW9kZTogImlub3V0IgogICAgfSwKICAgIGR1cmF0aW9uOiAyCn0pLmNhdGNoKGUgPT4ge30pOwpgOwphYi5vbkNyZWF0ZSA9IGBACgp0aGlzQm90LmFuaW1hdGVCb3QoKTsKCm1hc2tzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpc0JvdC5hbmltYXRlQm90KCksIDIwMDApOwpgOwphYi5vbkRlc3Ryb3kgPSBgQApjbGVhckludGVydmFsKHRhZ3MuaW50ZXJ2YWwpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKYDsKYWIuZHJhZ2dhYmxlID0gZmFsc2U7CmFiLnNjYWxlID0gMC45OwoKbGV0IGFiTWFuaWZlc3RlZCA9IGF3YWl0IGNyZWF0ZShhYik7CgppZiAobGlua3MucmVtZW1iZXIudGFncy5hYlNlY29uZGFyeUxhYmVsKQp7CiAgICBsZXQgYWJMYWJlbEJvdCA9IHt9OwoKICAgIGFiTGFiZWxCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKICAgIGFiTGFiZWxCb3RbdGhhdC5kaW1lbnNpb25dID0gdHJ1ZTsKICAgIGFiTGFiZWxCb3RbdGhhdC5kaW1lbnNpb24gKyAiWiJdID0gLTE7CiAgICBhYkxhYmVsQm90LmNyZWF0b3IgPSBhYk1hbmlmZXN0ZWQuaWQ7CiAgICBhYkxhYmVsQm90LnRyYW5zZm9ybWVyID0gYWJNYW5pZmVzdGVkLmlkOwogICAgYWJMYWJlbEJvdC5wb2ludGFibGUgPSBmYWxzZTsKICAgIGFiTGFiZWxCb3QuY29sb3IgPSAiY2xlYXIiOwogICAgYWJMYWJlbEJvdC5sYWJlbCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJTZWNvbmRhcnlMYWJlbDsKICAgIGFiTGFiZWxCb3QubGFiZWxQb3NpdGlvbiA9ICJsZWZ0IjsKICAgIGFiTGFiZWxCb3QubGFiZWxTaXplID0gMC43OwogICAgYWJMYWJlbEJvdC5sYWJlbENvbG9yID0gYWJNYW5pZmVzdGVkLnRhZ3MubGFiZWxDb2xvcjsKCiAgICBjcmVhdGUoYWJMYWJlbEJvdCk7Cn0KCm1hc2tzLmFiQm90ID0gIvCflJciICsgYWJNYW5pZmVzdGVkLmlkOwoKbGlua3MucmVtZW1iZXIubWFza3MuYWJBY3RpdmVEaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKCnNob3V0KCJvbkFCTW92ZWQiLCB7ZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwgeDogdGhhdC5wb3NpdGlvbi54LCB5OiB0aGF0LnBvc2l0aW9uLnl9KTsKCnJldHVybiBhYk1hbmlmZXN0ZWQ7CgoKCmlmIChjb25maWdCb3QudGFncy5hYk9wdGltaXplZCkKewogICAgcmV0dXJuOwp9JwDa4abTCsFFHGFiTWFuaWZlc3RTdGF0ZUFzbGVlcE9uRW50ZXICBADa4abTCpRmgQFAZGVzdHJveShsaW5rcy5hYkJvdCk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKc2V0VGFnTWFzayhsaW5rcy5yZW1lbWJlciwgJ2FiQXdha2VTdGF0ZScsIGZhbHNlLCAnc2hhcmVkJykKCnNob3V0KCJvbkFCU2xlZXAiKTsnANrhptMKwUULb25HcmlkQ2xpY2sCBADa4abTCpZngRRAaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSkKewogICAgcmV0dXJuOwp9CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uc3Qgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZiAodGFncy5hYkJvdCAmJiAoc2hpZnRDaGVjayB8fCAodGhhdC5tb2RhbGl0eSA9PSAibW91c2UiICYmIHRoYXQuYnV0dG9uSWQgPT0gInJpZ2h0IiAmJiAhbGlua3MucmVtZW1iZXIudGFncy5hYlJpZ2h0Q2xpY2tEaXNhYmxlZCkgfHwgdGhhdC5mb3JjZUFybVBsYWNlbWVudCkpCnsKICAgIGlmIChsaW5rcy5hYkJvdC50YWdzLmFybSkKICAgIHsKICAgICAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7CiAgICAgICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gbnVsbDsKICAgIH0KICAgIAogICAgbGV0IGFybSA9IHt9OwoKICAgIGFybS5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwogICAgYXJtW3RoYXQuZGltZW5zaW9uXSA9IHRydWU7CiAgICBhcm1bdGhhdC5kaW1lbnNpb24gKyAiWCJdID0gdGhhdC5wb3NpdGlvbi54OwogICAgYXJtW3RoYXQuZGltZW5zaW9uICsgIlkiXSA9IHRoYXQucG9zaXRpb24ueTsKICAgIGFybS5kaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKICAgIGFybS5zY2FsZSA9IDAuOTsKICAgIGFybS5zY2FsZVogPSAwLjAxOwogICAgYXJtLmNvbG9yID0gImNsZWFyIjsKICAgIGFybS5zdHJva2VDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CiAgICBhcm0ubGluZUNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKICAgIGFybS5saW5lVG8gPSBsaW5rcy5hYkJvdC5pZDsKICAgIGFybS5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKICAgIGFybS5vbkNsaWNrID0gYEAgZGVzdHJveSh0aGlzQm90KTsKICAgIHNob3V0KCJvbkFCRm9vdENsaWNrZWQiLCB7IGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24gfSk7CiAgICBsaW5rcy5tYW5hZ2VyLmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogdGFncy5kaW1lbnNpb24sIHBvc2l0aW9uOnt4OnRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWCJdLHk6dGFnc1t0YWdzLmRpbWVuc2lvbiArICJZIl19fSk7YDsKCiAgICBsZXQgbmV3QXJtID0gYXdhaXQgY3JlYXRlKGFybSk7CgogICAgc2hvdXQoIm9uQUJBcm1QbGFjZWQiLCB7ZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwgeDogdGhhdC5wb3NpdGlvbi54LCB5OiB0aGF0LnBvc2l0aW9uLnl9KTsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5hcm0gPSAi8J+UlyIgKyBuZXdBcm0uaWQ7CgogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJHcmlkRm9jdXMgPSB7ZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwgcG9zaXRpb246IHt4OiB0aGF0LnBvc2l0aW9uLngsIHk6IHRoYXQucG9zaXRpb24ueX19OwoKICAgIHRoaXNCb3QuYWJDbGljayh7bWVudTogImdyaWQifSk7CgogICAgcmV0dXJuOwp9CgpsZXQgZm9vdHByaW50ID0ge307Cgpmb290cHJpbnQuc3BhY2UgPSAidGVtcExvY2FsIjsKZm9vdHByaW50W3RoYXQuZGltZW5zaW9uXSA9IHRydWU7CmZvb3RwcmludC5kaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKZm9vdHByaW50W3RoYXQuZGltZW5zaW9uICsgIlgiXSA9IHRoYXQucG9zaXRpb24ueDsKZm9vdHByaW50W3RoYXQuZGltZW5zaW9uICsgIlkiXSA9IHRoYXQucG9zaXRpb24ueTsKZm9vdHByaW50LnNjYWxlWiA9IDAuMDE7CmZvb3RwcmludC5vbkNsaWNrID0gYEAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKc2hvdXQoIm9uQUJGb290Q2xpY2tlZCIsIHsgZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiB9KTsKbGlua3MubWFuYWdlci5hYk1hbmlmZXN0Qm90KHRhZ3MucG9zaXRpb25JbmZvKTsKYDsKZm9vdHByaW50LnBvc2l0aW9uSW5mbyA9IHRoYXQ7CmZvb3RwcmludC5jb2xvciA9ICJjbGVhciI7CmZvb3RwcmludC5wZXJzb25hbGl0eSA9IHRhZ3MucGVyc29uYWxpdHk7CmZvb3RwcmludC5zdHJva2VDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmZvb3RwcmludC5kcmFnZ2FibGUgPSBmYWxzZTsKZm9vdHByaW50Lm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpmb290cHJpbnQub25DcmVhdGUgPSBgQCBzZXRUaW1lb3V0KCgpID0+IGRlc3Ryb3kodGhpc0JvdCksIDgwMCk7CgogICAgYXdhaXQgYW5pbWF0ZVRhZyh0aGlzQm90LCB7CiAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgIHNjYWxlWDogMC4xLAogICAgICAgICAgICBzY2FsZVk6IDAuMQogICAgICAgIH0sCiAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICBzY2FsZVg6IDEuMSwKICAgICAgICAgICAgc2NhbGVZOiAxLjEKICAgICAgICB9LAogICAgICAgIGR1cmF0aW9uOiAwLjUsCiAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgIHR5cGU6ICJlbGFzdGljIiwKICAgICAgICAgICAgbW9kZTogIm91dCIKICAgICAgICB9CiAgICB9KS5jYXRjaChlID0+IHt9KTsKYDsKCmNyZWF0ZShmb290cHJpbnQpOycA2uGm0wrBRQRtZW51AgQA2uGm0wqSeyjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwDa4abTCsFFB2FiQ2xpY2sCBADa4abTCrl7/wtAaWYgKCFsaW5rcy5hYkJvdCkgewogICAgcmV0dXJuOwp9CgppZiAobGlua3MuaW5wdXQpIHsKICAgIGxpbmtzLmlucHV0LmFiQ2hhdEJhckNsb3NlKCk7Cn0KCmNvbnN0IHJlc2V0ID0gdGhhdCA/IHRoYXQucmVzZXQgOiBmYWxzZTsKY29uc3QgbWVudSA9IHRoYXQgPyB0aGF0Lm1lbnUgOiAiY29yZSI7CmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCmlmICghcmVzZXQgJiYgKGxpbmtzLmFiQm90LnRhZ3MuaW50ZXJ2YWwgfHwgc3RhdGUpKSB7CiAgICBjb25zdCBhYk1lbnVCb3RzID0gZ2V0Qm90cygiYWJNZW51IiwgdHJ1ZSk7CgogICAgd2hpc3BlcihhYk1lbnVCb3RzLCAiYWJNZW51UmVmcmVzaCIpOwoKICAgIGNsZWFySW50ZXJ2YWwobGlua3MuYWJCb3QudGFncy5pbnRlcnZhbCk7CgogICAgbGlua3MuYWJCb3QubWFza3MuaW50ZXJ2YWwgPSBudWxsOwoKICAgIGNsZWFyQW5pbWF0aW9ucyhsaW5rcy5hYkJvdCk7CgogICAgY29uc3Qgcm90WiA9IGxpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlJvdGF0aW9uWiI7CgogICAgaWYgKHN0YXRlICYmIG1lbnUgPT0gImNvcmUiKSB7CiAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGlua3MubWVudS5hYk9wZW5NZW51KG1lbnUpOwogICAgfQoKICAgIHRyeSB7CiAgICAgICAgYW5pbWF0ZVRhZyhsaW5rcy5hYkJvdCwgewogICAgICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgICAgIFtyb3RaXTogbGlua3MuYWJCb3QudGFnc1tyb3RaXSwKICAgICAgICAgICAgICAgIHNjYWxlOiBsaW5rcy5hYkJvdC50YWdzLnNjYWxlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgICAgIFtyb3RaXTogMCwKICAgICAgICAgICAgICAgIHNjYWxlOiAwLjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAic2ludXNvaWRhbCIsCiAgICAgICAgICAgICAgICBtb2RlOiAiaW5vdXQiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGR1cmF0aW9uOiAwLjUKICAgICAgICB9KQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8vIERvIG5vdGhpbmcuCiAgICB9Cn0KZWxzZSB7CiAgICBsaW5rcy5hYkJvdC5hbmltYXRlQm90KCk7CgogICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gbnVsbDsKCiAgICBpZiAobGlua3MuYWJCb3QudGFncy5hcm0pIHsKICAgICAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IGxpbmtzLmFiQm90LmFuaW1hdGVCb3QoKSwgMjAwMCk7Cn0KCnNob3V0KCdvbkFCQ2xpY2snLCB7IGFiQm90OiBsaW5rcy5hYkJvdCwgZGltZW5zaW9uOiBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiwgbWVudSwgc2hpZnRLZXk6ICEhc3RhdGUsIHJlc2V0IH0pOycA2uGm0wrBRRthYk1hbmlmZXN0U3RhdGVBd2FrZU9uRW50ZXICBADa4abTCrmHAbYCQHNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICdhYkF3YWtlU3RhdGUnLCB0cnVlLCAnc2hhcmVkJykKCmxldCBkaW1lbnNpb24gPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwoKaWYgKCFkaW1lbnNpb24pCnsKICAgIHJldHVybjsKfQoKdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb24sIHBvc2l0aW9uOiB7eDogMCwgeTogMH19KTsKCnNob3V0KCJvbkFCQXdha2UiLCB7IGRpbWVuc2lvbiwgcG9zaXRpb246IHt4OiAwLCB5OiAwfX0pOycA2uGm0wrBRQxvbkFueUJvdERyYWcCBADa4abTCvCJAZAMQGlmICh0aGF0LmJvdCAhPSBsaW5rcy5hYkJvdCkgcmV0dXJuOwoKaWYgKGxpbmtzLmlucHV0KSB7CiAgICBsaW5rcy5pbnB1dC5hYkNoYXRCYXJDbG9zZSgpOwp9CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzICYmIHRoYXQuYm90LmlkID09IGxpbmtzLmFiQm90LmlkKQp7CiAgICBvcy5lbmFibGVDdXN0b21EcmFnZ2luZygpOwoKICAgIHJldHVybjsKfQoKaWYgKGxpbmtzLmFiQm90LnRhZ3MuYXJtKQp7CiAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7Cn0KCmlmICghdGhhdC5ib3QudGFncy5pbnRlcnZhbCkKewogICAgdGhpc0JvdC5hYkNsaWNrKCk7Cn0KCmxldCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CmxldCBhcm0gPSB7fTsKCmFybS5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwphcm1bbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb25dID0gdHJ1ZTsKYXJtW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlgiXSA9IGxpbmtzLmFiQm90LnRhZ3NbbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWCJdOwphcm1bbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWSJdID0gbGlua3MuYWJCb3QudGFnc1tsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJZIl07CmFybS5jcmVhdG9yID0gbGlua3MuYWJCb3QuaWQ7CmFybS5kaW1lbnNpb24gPSBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbjsKYXJtLnNjYWxlID0gMC45Owphcm0uc2NhbGVaID0gMC4wMTsKYXJtLmNvbG9yID0gImNsZWFyIjsKYXJtLnN0cm9rZUNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKYXJtLmxpbmVDb2xvciA9IGxpbmtzLmFiQm90LnRhZ3Muc3Ryb2tlQ29sb3I7CmFybS5saW5lVG8gPSB0aGF0LmJvdC5pZDsKYXJtLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwphcm0ub25DbGljayA9IGBAIGRlc3Ryb3kodGhpc0JvdCk7CnNob3V0KCJvbkFCRm9vdENsaWNrZWQiLCB7IGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24gfSk7CmxpbmtzLm1hbmFnZXIuYWJNYW5pZmVzdEJvdCh7ZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgcG9zaXRpb246e3g6dGFnc1t0YWdzLmRpbWVuc2lvbiArICJYIl0seTp0YWdzW3RhZ3MuZGltZW5zaW9uICsgIlkiXX19KTtgOwphcm0ub25Ecm9wID0gYEAgc2hvdXQoIm9uQUJBcm1QbGFjZWQiLCB7ZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgeDogdGhhdC50by54LCB5OiB0aGF0LnRvLnl9KTtgCgppZiAoc3RhdGUpCnsKICAgIGFybS5tdWx0aVNlbGVjdCA9IHRydWU7CiAgICBhcm0uZm9ybSA9ICJzcGhlcmUiOwogICAgYXJtLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5kcmFnZ2FibGUgPSB0cnVlOwp9CgpsZXQgbmV3QXJtID0gYXdhaXQgY3JlYXRlKGFybSk7CgpsaW5rcy5hYkJvdC5tYXNrcy5hcm0gPSAi8J+UlyIgKyBuZXdBcm0uaWQ7Cgpvcy5yZXBsYWNlRHJhZ0JvdChuZXdBcm0pOycA2uGm0wrBRRFvbkFueUJvdERyb3BFbnRlcgIEANrhptMK/ZUB2AlAaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmIChsaW5rcy5hYkJvdD8ubGlua3MuYXJtICE9IHRoYXQuZHJhZ0JvdCkgcmV0dXJuOwoKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLm11bHRpU2VsZWN0KQp7CiAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwoKICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmtzLmFiQm90LnRhZ3MubGluZVRvKSkKICAgIHsKICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8ucHVzaCh0aGF0LnRvLmJvdC5pZCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gW3RoYXQudG8uYm90LmlkXTsKICAgIH0KCiAgICBsZXQgbmV3TGluazsKCiAgICBpZiAoIWxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLnNlbGVjdGVkQm90cykKICAgIHsKICAgICAgICBuZXdMaW5rID0gZ2V0TGluayh0aGF0LnRvLmJvdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IHByZXZpb3VzTGlua0JvdHMgPSBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubGlua3Muc2VsZWN0ZWRCb3RzOwoKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJldmlvdXNMaW5rQm90cykpCiAgICAgICAgewogICAgICAgICAgICBwcmV2aW91c0xpbmtCb3RzID0gW3ByZXZpb3VzTGlua0JvdHNdCiAgICAgICAgfQoKICAgICAgICBjb25zdCBhbHJlYWR5QWRkZWQgPSBwcmV2aW91c0xpbmtCb3RzLnNvbWUoYiA9PiBiLmlkID09PSB0aGF0LnRvLmJvdC5pZCk7CiAgICAgICAgaWYgKCFhbHJlYWR5QWRkZWQpCiAgICAgICAgewogICAgICAgICAgICBwcmV2aW91c0xpbmtCb3RzLnB1c2godGhhdC50by5ib3QpOwogICAgICAgIH0KCiAgICAgICAgbmV3TGluayA9IGdldExpbmsocHJldmlvdXNMaW5rQm90cyk7CiAgICB9CgogICAgbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3Muc2VsZWN0ZWRCb3RzID0gbmV3TGluazsKfQplbHNlCnsKICAgIGxpbmtzLmFiQm90LmxpbmtzLmFybS5tYXNrcy5zdHJva2VDb2xvciA9ICJjbGVhciI7CiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubWFza3MubGluZVRvID0gZmFsc2U7CgogICAgbGlua3MuYWJCb3QubWFza3MubGluZUNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IHRoYXQudG8uYm90LmlkOwp9JwDa4abTCsFFEG9uQW55Qm90RHJvcEV4aXQCBADa4abTCtafAZwCQGlmICghbGlua3MuYWJCb3QpIHJldHVybjsKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybSAhPSB0aGF0LmRyYWdCb3QpIHJldHVybjsKCmlmICghbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3MubXVsdGlTZWxlY3QpCnsKICAgIGxpbmtzLmFiQm90LmxpbmtzLmFybS5tYXNrcy5zdHJva2VDb2xvciA9IG51bGw7CiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubWFza3MubGluZVRvID0gbnVsbDsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8gPSBsaW5rcy5hYkJvdC5saW5rcy5hcm0uaWQ7Cn0nANrhptMKwUUMb25BbnlCb3REcm9wAgQA2uGm0wrzoQHuC0BtYXNrcy5tdWx0aURyYWcgPSBudWxsOwoKaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmICghbGlua3MuYWJCb3QpIHJldHVybjsKaWYgKCFsaW5rcy5hYkJvdC50YWdzLmFybSkgcmV0dXJuOwppZiAobGlua3MuYWJCb3QubGlua3MuYXJtICE9IHRoYXQuZHJhZ0JvdCkgcmV0dXJuOwoKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLm11bHRpU2VsZWN0ICYmIGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLnNlbGVjdGVkQm90cykKewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJNdWx0aXBsZUJvdEZvY3VzID0gbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3Muc2VsZWN0ZWRCb3RzOwoKICAgIC8vY2hlY2sgaWYgb25seSBvbmUgYm90IGlzIHNlbGVjdGVkIGluIG11bHRpc2VsZWN0IG1vZGUKICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmtzLmFiQm90LmxpbmtzLmFybS5saW5rcy5zZWxlY3RlZEJvdHMpKSB7CiAgICAgICAgdGhpc0JvdC5hYkNsaWNrKHttZW51OiAibXVsdGlwbGVCb3QifSk7CiAgICB9IGVsc2UgewogICAgICAgIGlmIChsaW5rcy5hYkJvdC5saW5rcy5hcm0ubGlua3Muc2VsZWN0ZWRCb3RzLmlkID09IGxpbmtzLmFiQm90LmlkKQogICAgICAgIHsKICAgICAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8gPSBsaW5rcy5hYkJvdC50YWdzLmxpbmVUb1swXTsKICAgICAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJCb3RGb2N1cyA9ICLwn5SXIiArIGxpbmtzLmFiQm90LmxpbmtzLmFybS5saW5rcy5zZWxlY3RlZEJvdHMuaWQ7CgogICAgICAgICAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJib3QifSk7CiAgICAgICAgfQogICAgfSAKICAgIAogICAgZGVzdHJveShsaW5rcy5hYkJvdC5saW5rcy5hcm0pOwogICAgc2hvdXQoIm9uQUJTZWxlY3RlZEJvdCIsIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiTXVsdGlwbGVCb3RGb2N1cyk7Cn0KZWxzZSBpZiAodGhhdC50by5ib3QpCnsKICAgIGlmICh0aGF0LnRvLmJvdCA9PSBsaW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBsaW5rcy5tZW51LmFiRW52aXJvbm1lbnRNZW51KCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJCb3RGb2N1cyA9ICLwn5SXIiArIHRoYXQudG8uYm90LmlkOwoKICAgICAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJib3QifSk7CiAgICB9CiAgICAKICAgIHNob3V0KCJvbkFCU2VsZWN0ZWRCb3QiLCB0aGF0LnRvLmJvdCk7CiAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7Cn0KZWxzZQp7CiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkdyaWRGb2N1cyA9IHtkaW1lbnNpb246IHRoYXQudG8uZGltZW5zaW9uLCBwb3NpdGlvbjoge3g6IHRoYXQudG8ueCwgeTogdGhhdC50by55fX07CgogICAgdGhpc0JvdC5hYkNsaWNrKHttZW51OiAiZ3JpZCJ9KTsKfScA2uGm0wrBRQhhYklnbm9yZQIEANrhptMK3q0BBHRydWUnANrhptMKwUUDYXNrAgQA2uGm0wrjrQEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycA2uGm0wrBRQlhc2tCdXR0b24CBADa4abTCoquAdwFQGlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkF3YWtlU3RhdGUpCnsKICAgIHJldHVybjsKfQoKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5yZW1lbWJlciA9IGxpbmtzLm1lbnUudGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSBsaW5rcy5tZW51LnRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5iYXNlU2tpbGwgPSAi8J+UlyIgKyBsaW5rcy5hc2suaWQ7CmFiTWVudUJ1dHRvbi5sYWJlbCA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVMYWJlbDsKYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudUljb247CmFiTWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVPbkdlbmVyYXRlOwphYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudVNvcnRPcmRlcjsKYWJNZW51QnV0dG9uLmNvbG9yID0gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudUNvbG9yID8gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudUNvbG9yIDogbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGFiTWVudUJ1dHRvbik7JwDa4abTCsFFCWFiQm90Q2hhdAIEANrhptMK5bMB1QtAaWYgKCFsaW5rcy5hYkJvdCAmJiAhdGhhdC5ib3QpCnsKICAgIHJldHVybjsKfQoKY29uc3QgYm90QmFzZSA9IHRoYXQuYm90ID8gdGhhdC5ib3Q6IGxpbmtzLmFiQm90Owpjb25zdCBkaW1lbnNpb24gPSAhdGhhdC5ib3QgPyBib3RCYXNlLnRhZ3MuZGltZW5zaW9uIDogdGhhdC5kaW1lbnNpb24gPyB0aGF0LmRpbWVuc2lvbiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CmNvbnN0IG1lc3NhZ2UgPSB0aGF0Lm1lc3NhZ2U7CmNvbnN0IG1lc3NhZ2VUaW1lID0gdGhhdC50aW1lID8gdGhhdC50aW1lICogMTAwMCA6IDE2MDA7IApjb25zdCBtZXNzYWdlQm90ID0ge307CgptZXNzYWdlQm90LnNwYWNlID0gInRlbXBMb2NhbCI7Cm1lc3NhZ2VCb3QudHJhbnNmb3JtZXIgPSBib3RCYXNlLmlkOwptZXNzYWdlQm90LmZvcm0gPSAic3ByaXRlIjsKbWVzc2FnZUJvdC5jb2xvciA9ICIjMDAwMDAwIjsKbWVzc2FnZUJvdC5sYWJlbCA9IG1lc3NhZ2U7Cm1lc3NhZ2VCb3QubGFiZWxDb2xvciA9ICIjZmZmZmZmIjsKbWVzc2FnZUJvdC5sYWJlbFNpemUgPSAxOwptZXNzYWdlQm90LnNjYWxlWCA9IG1lc3NhZ2UubGVuZ3RoIC8gNSA+IDEwID8gMTAgOiBtZXNzYWdlLmxlbmd0aCA8IDEwID8gMiA6IG1lc3NhZ2UubGVuZ3RoIC8gNTsKbWVzc2FnZUJvdC5zY2FsZVkgPSAobWVzc2FnZS5sZW5ndGggLyA1MCkgPiAxID8gTWF0aC5yb3VuZChtZXNzYWdlLmxlbmd0aCAvIDUwKSA6IDEuMzM7Cm1lc3NhZ2VCb3Quc2NhbGVaID0gMC4xOwptZXNzYWdlQm90Lm9yaWVudGF0aW9uTW9kZSA9ICJiaWxsYm9hcmQiOwptZXNzYWdlQm90W2RpbWVuc2lvbl0gPSB0cnVlOwptZXNzYWdlQm90LmRpbWVuc2lvbiA9IGRpbWVuc2lvbjsKbWVzc2FnZUJvdFtkaW1lbnNpb24gKyAiWCJdID0gMDsKbWVzc2FnZUJvdFtkaW1lbnNpb24gKyAiWSJdID0gMDsKbWVzc2FnZUJvdFtkaW1lbnNpb24gKyAiWiJdID0gYm90QmFzZS50YWdzLnNjYWxlID8gYm90QmFzZS50YWdzLnNjYWxlIC8gMiArIDIgOiAyOwptZXNzYWdlQm90Lm9uRmFkZSA9IGBAIGF3YWl0IGFuaW1hdGVUYWcodGhpc0JvdCwgewogICAgZnJvbVZhbHVlOiB7CiAgICAgICAgZm9ybU9wYWNpdHk6IDEsCiAgICAgICAgbGFiZWxPcGFjaXR5OiAxLAogICAgICAgIFt0YWdzLmRpbWVuc2lvbiArICJaIl06IHRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWiJdCiAgICB9LAogICAgdG9WYWx1ZTogewogICAgICAgIGZvcm1PcGFjaXR5OiAwLAogICAgICAgIGxhYmVsT3BhY2l0eTogMCwKICAgICAgICBbdGFncy5kaW1lbnNpb24gKyAiWiJdOiB0YWdzW3RhZ3MuZGltZW5zaW9uICsgIloiXSArIDUKICAgIH0sCiAgICBkdXJhdGlvbjogJHt0aGF0LmR1cmF0aW9uID8/IDN9Cn0pLmNhdGNoKHt9KTsKCmRlc3Ryb3kodGhpc0JvdCk7YDsKCmNvbnN0IGFjdGl2ZU1lc3NhZ2UgPSBjcmVhdGUobWVzc2FnZUJvdCk7CgpzZXRUaW1lb3V0KCgpPT4gYWN0aXZlTWVzc2FnZS5vbkZhZGUoKSwgbWVzc2FnZVRpbWUpOycA2uGm0wrBRRBvbkFueUJvdERyYWdnaW5nAgQA2uGm0wq7vwGJEEBpZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzICYmIHRoYXQuYm90LmlkID09IGxpbmtzLmFiQm90LmlkKQp7CiAgICBjb25zdCBhY3RpdmVEaW1lbnNpb24gPSBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkFjdGl2ZURpbWVuc2lvbiA/PyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwogICAgbGV0IGRyYWdDb29yZGluYXRvckJvdCA9IGxpbmtzLmRyYWdDb29yZDsKICAgIAogICAgaWYgKCFkcmFnQ29vcmRpbmF0b3JCb3QpCiAgICB7CiAgICAgICAgY29uc3QgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kID0ge307CgogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2QuZGltZW5zaW9uID0gYWN0aXZlRGltZW5zaW9uOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZFthY3RpdmVEaW1lbnNpb25dID0gdHJ1ZTsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2RbYWN0aXZlRGltZW5zaW9uICsgIlgiXSA9IDA7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kW2FjdGl2ZURpbWVuc2lvbiArICJZIl0gPSAwOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZFthY3RpdmVEaW1lbnNpb24gKyAiWiJdID0gLTE7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kLnBvaW50YWJsZSA9IGZhbHNlOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZC5jb2xvciA9ICJjbGVhciI7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kLm9uQW55Qm90UG9pbnRlclVwID0gYEAgbGlua3MubWFuYWdlci5tYXNrcy5kcmFnQ29vcmQgPSBudWxsOyBzaG91dCgnYWJTdG9wRHJhZycsIHt4OiB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVgsIHk6IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WX0pOyBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIGRyYWdDb29yZGluYXRvckJvdCA9IGNyZWF0ZShkcmFnQ29vcmRpbmF0b3JCb3RNb2QpOwoKICAgICAgICBtYXNrcy5kcmFnQ29vcmQgPSBnZXRMaW5rKGRyYWdDb29yZGluYXRvckJvdCk7CgogICAgICAgIGNvbnN0IGRyYWdCb3RzID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzOwoKICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy50cmFuc2Zvcm1lciA9IGRyYWdDb29yZGluYXRvckJvdC5pZDsKICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5hYlN0b3BEcmFnID0gYEAgbWFza3MudHJhbnNmb3JtZXIgPSBudWxsOyBtYXNrcy5hYlN0b3BEcmFnID0gbnVsbDsgdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1YID0gdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1YICsgdGhhdC54OyB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVkgPSB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVkgKyB0aGF0LnlgOwoKICAgICAgICBzZXRUYWdNYXNrKGRyYWdCb3RzLCAidHJhbnNmb3JtZXIiLCBkcmFnQ29vcmRpbmF0b3JCb3QuaWQsICJ0ZW1wTG9jYWwiKTsKICAgICAgICBzZXRUYWdNYXNrKGRyYWdCb3RzLCAiYWJTdG9wRHJhZyIsIGBAIG1hc2tzLnRyYW5zZm9ybWVyID0gbnVsbDsgbWFza3MuYWJTdG9wRHJhZyA9IG51bGw7IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WCA9IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WCArIHRoYXQueDsgdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1ZID0gdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1ZICsgdGhhdC55YCwgInRlbXBMb2NhbCIpOwogICAgfQoKICAgIGNvbnN0IHhDaGFuZ2UgPSB0aGF0LnRvLnggLSB0aGF0LmZyb20ueDsKICAgIGNvbnN0IHlDaGFuZ2UgPSB0aGF0LnRvLnkgLSB0aGF0LmZyb20ueTsKCiAgICBkcmFnQ29vcmRpbmF0b3JCb3QudGFnc1thY3RpdmVEaW1lbnNpb24gKyAiWCJdID0geENoYW5nZTsKICAgIGRyYWdDb29yZGluYXRvckJvdC50YWdzW2FjdGl2ZURpbWVuc2lvbiArICJZIl0gPSB5Q2hhbmdlOwogICAgZHJhZ0Nvb3JkaW5hdG9yQm90LnRhZ3NbYWN0aXZlRGltZW5zaW9uICsgIloiXSA9IC0xOwp9JwDa4abTCsFFCWFiVmVyc2lvbgIEANrhptMKxc8BBDEwLjYnANrhptMKwUURYWJJbml0aWFsTWFuaWZlc3QCBADa4abTCsrPAbUJQGxldCBza2lsbEFycmF5ID0gWyJhYkludGVyZmFjZSIsICJhYkFjdGlvbiIsICJhYlRlc3RzIl07Cgpmb3IgKGxldCBpID0gMDsgaSA8IHNraWxsQXJyYXkubGVuZ3RoOyBpKyspIAp7CiAgICBhd2FpdCBsaW5rcy5sZWFybi5hYkFkYXB0KHNraWxsQXJyYXlbaV0pOwp9Cgphd2FpdCBvcy5zbGVlcCgzMDApOwoKLy9hbmltYXRpb24gaWYgYXBwbGljYWJsZQppZiAobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxBbmltYXRpb24pCnsKICAgIGF3YWl0IGxpbmtzLmFuaW1hdGlvbltsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbEFuaW1hdGlvbl0oKTsKfQoKLy9rZWVwIGFiIGF3YWtlCnNldFRhZ01hc2sobGlua3MucmVtZW1iZXIsICdhYkF3YWtlU3RhdGUnLCB0cnVlLCAnc2hhcmVkJykKCmlmIChjb25maWdCb3QudGFncy5wYXR0ZXJuKSAKewogICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSBjb25maWdCb3QudGFncy5wYXR0ZXJuOwp9CmVsc2UgCnsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gdXVpZCgpOwp9CgpjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXdha2UiLCAiYWJNYW5pZmVzdFN0YXRlIik7Cgp0aGlzQm90LmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogImhvbWUiLCBwb3NpdGlvbjp7eDowLHk6MH19KTsKCi8vbWVzc2FnZSBpZiBhcHBsaWNhYmxlCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2UpCnsKICAgIHNob3V0KCJzaG93Q29uc29sZSIpOwoKICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsTWVzc2FnZSkpCiAgICB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2UubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBhYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2VbaV0pOwoKICAgICAgICAgICAgYXdhaXQgb3Muc2xlZXAoMjAwMCk7CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsTWVzc2FnZSk7CiAgICB9Cn0nANrhptMKwUUJYW5pbWF0aW9uAgQA2uGm0wqA2QEo8J+Ul2IyNmUxMDg5LTE3MmQtNDVhOS04ZDIyLTA1YzNmNThjMmJmNycA2uGm0wrBRQ9hYk1hbmlmZXN0U3RhdGUCBADa4abTCqfZAQZBc2xlZXAnANrhptMKwUUPb25BbnlCb3RDbGlja2VkAgQA2uGm0wqu2QGbEUBpZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSaWdodENsaWNrRGlzYWJsZWQgICYmICF0aGF0LmJvdC50YWdzLmFiUmlnaHRDbGlja0lnbm9yZSAmJiB0aGF0Lm1vZGFsaXR5ID09ICJtb3VzZSIgJiYgdGhhdC5idXR0b25JZCA9PSAicmlnaHQiKSB7DQoNCiAgICBpZiAodGFncy5hYk1hbmlmZXN0U3RhdGUgPT0gIkFzbGVlcCIpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vYWIgc2VsZWN0ZWQNCiAgICBpZiAodGhhdC5ib3QgPT0gbGlua3MuYWJCb3QpDQogICAgew0KICAgICAgICBsaW5rcy5tZW51LmFiRW52aXJvbm1lbnRNZW51KCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvL0dldCByaWQgb2YgYW55IG90aGVyIG9uZXMNCiAgICBpZiAobGlua3MuYWJCb3QudGFncy5hcm0pIHsNCiAgICAgICAgZGVzdHJveShsaW5rcy5hYkJvdC5saW5rcy5hcm0pOw0KICAgIH0NCg0KICAgIC8vYW5pbWF0aW9ucw0KICAgIGlmICghbGlua3MuYWJCb3QudGFncy5pbnRlcnZhbCkgew0KICAgICAgICB0aGlzQm90LmFiQ2xpY2soKTsNCiAgICB9DQoNCiAgICAvL0NyZWF0ZSBhcm0NCiAgICBsZXQgYXJtID0ge307DQoNCiAgICBhcm0uc3BhY2UgPSAidGVtcExvY2FsIjsNCiAgICBhcm1bbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb25dID0gdHJ1ZTsNCiAgICBhcm1bbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWCJdID0gdGhhdC5ib3QudGFnc1tsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJYIl07DQogICAgYXJtW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlkiXSA9IHRoYXQuYm90LnRhZ3NbbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWSJdOw0KICAgIGFybS5jcmVhdG9yID0gbGlua3MuYWJCb3QuaWQ7DQogICAgYXJtLmRpbWVuc2lvbiA9IGxpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uOw0KICAgIGFybS5zY2FsZSA9IDAuOTsNCiAgICBhcm0uc2NhbGVaID0gMC4wMTsNCiAgICBhcm0uY29sb3IgPSAiY2xlYXIiOw0KICAgIGFybS5zdHJva2VDb2xvciA9IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7DQogICAgYXJtLmxpbmVDb2xvciA9IGxpbmtzLmFiQm90LnRhZ3Muc3Ryb2tlQ29sb3I7DQogICAgYXJtLmxpbmVUbyA9IGxpbmtzLmFiQm90LmlkOw0KICAgIGFybS5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsNCiAgICBhcm0ub25DbGljayA9IGBAIGRlc3Ryb3kodGhpc0JvdCk7DQogICAgICAgICAgICAgICAgICAgIHNob3V0KCJvbkFCRm9vdENsaWNrZWQiLCB7IGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24gfSk7DQogICAgICAgICAgICAgICAgICAgIGxpbmtzLm1hbmFnZXIuYWJNYW5pZmVzdEJvdCh7ZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgcG9zaXRpb246e3g6dGFnc1t0YWdzLmRpbWVuc2lvbiArICJYIl0seTp0YWdzW3RhZ3MuZGltZW5zaW9uICsgIlkiXX19KTtgOw0KDQogICAgbGV0IG5ld0FybSA9IGF3YWl0IGNyZWF0ZShhcm0pOw0KDQogICAgbGlua3MuYWJCb3QubWFza3MuYXJtID0gIvCflJciICsgbmV3QXJtLmlkOw0KDQogICAgdGhpc0JvdC5vbkFueUJvdERyb3BFbnRlcih7DQogICAgICAgIGRyYWdCb3Q6IGxpbmtzLmFiQm90LmxpbmtzLmFybSwNCiAgICAgICAgdG86IHsNCiAgICAgICAgICAgIGJvdDogdGhhdC5ib3QsDQogICAgICAgICAgICB4OiB0aGF0LmJvdC50YWdzW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlgiXSwNCiAgICAgICAgICAgIHk6IHRoYXQuYm90LnRhZ3NbbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWSJdLA0KICAgICAgICAgICAgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbg0KICAgICAgICB9LA0KICAgICAgICBmcm9tOiB7DQogICAgICAgICAgICB4OiBsaW5rcy5hYkJvdC50YWdzW2xpbmtzLmFiQm90LnRhZ3MuZGltZW5zaW9uICsgIlgiXSwNCiAgICAgICAgICAgIHk6IGxpbmtzLmFiQm90LnRhZ3NbbGlua3MuYWJCb3QudGFncy5kaW1lbnNpb24gKyAiWSJdLA0KICAgICAgICAgICAgZGltZW5zaW9uOiBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbg0KICAgICAgICB9DQogICAgfSkNCg0KICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQm90Rm9jdXMgPSAi8J+UlyIgKyB0aGF0LmJvdC5pZDsNCg0KICAgIHRoaXNCb3QuYWJDbGljayh7bWVudTogImJvdCJ9KTsNCg0KICAgIHJldHVybjsNCn0nANrhptMKwUUFaW5wdXQCBADa4abTCsTqASjwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwDa4abTCsFFC3BlcnNvbmFsaXR5AgQA2uGm0wrr6gEo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicA2uGm0wrBRQ1hYlBlcnNvbmFsaXR5AgQA2uGm0wqS6wEEdHJ1ZQA="}]}