{"version":2,"updates":[{"id":0,"timestamp":1767985515012,"update":"AcIBlauenQsAJwEEYm90cyQxNjU1NGJjMS1lOTNlLTRhMGItOGNkMy1kZmQ3NzIzMTk2NzIBJwCVq56dCwAJYWJWZXJzaW9uAgQAlauenQsBBTEwLjM1JwCVq56dCwAGc3lzdGVtAgQAlauenQsHFmFiLnBlcnNvbmFsaXR5LnZlcnNpb24nAJWrnp0LABlhYlBlcnNvbmFsaXR5TWFqb3JWZXJzaW9uAgQAlauenQseATInAJWrnp0LAA1vblNraWxsVXBkYXRlAgQAlauenQsgrQFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJQZXJzb25hbGl0eU1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJQZXJzb25hbGl0eU1pbm9yVmVyc2lvbjsKCmNvbnNvbGUubG9nKCJbQUJQZXJzb25hbGl0eV0gTG9hZGVkIEFCIFBlcnNvbmFsaXR5IHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAlauenQsADWFiUGVyc29uYWxpdHkCBACVq56dC84BBHRydWUnAJWrnp0LAAhhYklnbm9yZQIEAJWrnp0L0wEEdHJ1ZScAlauenQsABGZvcm0CBACVq56dC9gBB25vdGhpbmcnAJWrnp0LABlhYlBlcnNvbmFsaXR5TWlub3JWZXJzaW9uAgQAlauenQvgAQE1JwEEYm90cyQzYzc0YzlmMS04MmRjLTQ2NTUtOGIzOC1lN2YxMWRlODk3OGUBJwCVq56dC+IBBnN5c3RlbQIEAJWrnp0L4wEXYWIucGVyc29uYWxpdHkuYXJtX3Rvb2wnAJWrnp0L4gEMb25BbnlCb3REcmFnAgQAlauenQv7AY0IQGNvbnN0IGRyYWdCb3QgPSB0aGF0LmJvdDsKY29uc3QgZGltZW5zaW9uID0gdGhhdC5mcm9tLmRpbWVuc2lvbjsKCmlmIChkcmFnQm90LnRhZ3MuYXJtU2VsZWN0aW9uKSB7CiAgICBpZiAoZHJhZ0JvdC5tYXNrcy5hcm1Cb3QpIHsKICAgICAgICBpZiAoZHJhZ0JvdC5saW5rcy5hcm1Cb3QudGFncy5tdWx0aVNlbGVjdCAmJiBkcmFnQm90LmxpbmtzLmFybVNlbGVjdGVkQm90cyAmJiBkcmFnQm90LnRhZ3MuYXJtR3JvdXBEcmFnKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGVuYWJsZSBjdXN0b20gZHJhZ2dpbmdgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3MuZW5hYmxlQ3VzdG9tRHJhZ2dpbmcoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRlc3Ryb3kgcHJldmlvdXMgYXJtQm90OiAke2RyYWdCb3QubWFza3MuYXJtQm90fWApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkZXN0cm95KGRyYWdCb3QubGlua3MuYXJtQm90KTsKICAgICAgICAgICAgZHJhZ0JvdC5tYXNrcy5hcm1Cb3QgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBtdWx0aVNlbGVjdEtleUhlbGQgPSBvcy5nZXRJbnB1dFN0YXRlKCdrZXlib2FyZCcsICdTaGlmdCcpOwogICAgY29uc3QgbXVsdGlTZWxlY3RBbGxvd2VkID0gZHJhZ0JvdC50YWdzLmFybU11bHRpU2VsZWN0ID8/IHRydWU7CgogICAgY29uc3QgYXJtQm90ID0gdGhpc0JvdC5hYkNyZWF0ZUFybSh7CiAgICAgICAgb3JpZ2luQm90OiBkcmFnQm90LAogICAgICAgIGRpbWVuc2lvbiwKICAgICAgICBtdWx0aVNlbGVjdDogbXVsdGlTZWxlY3RLZXlIZWxkICYmIG11bHRpU2VsZWN0QWxsb3dlZCwKICAgIH0pCgogICAgb3MucmVwbGFjZURyYWdCb3QoYXJtQm90KTsKfQonAJWrnp0L4gEFZGVidWcCBACVq56dC4kKBWZhbHNlJwCVq56dC+IBCWxpc3RlbmluZwIEAJWrnp0LjwoEdHJ1ZScAlauenQviAQthYkNyZWF0ZUFybQIEAJWrnp0LlArjSUBjb25zdCBvcmlnaW5Cb3QgPSB0aGF0Lm9yaWdpbkJvdDsKYXNzZXJ0KGFiLmxpbmtzLnV0aWxzLmlzQm90KG9yaWdpbkJvdCksIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gb3JpZ2luQm90IGlzIGEgcmVxdWlyZWQgQm90IHBhcmFtZXRlci5gKTsKCmNvbnN0IGRpbWVuc2lvbiA9IHRoYXQuZGltZW5zaW9uOwphc3NlcnQodHlwZW9mIGRpbWVuc2lvbiA9PT0gJ3N0cmluZycsIGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZGltZW5zaW9uIGlzIGEgcmVxdWlyZWQgc3RyaW5nIHBhcmFtZXRlci5gKTsKCmNvbnN0IHBvc2l0aW9uID0gdGhhdC5wb3NpdGlvbiA/PyBnZXRCb3RQb3NpdGlvbihvcmlnaW5Cb3QsIGRpbWVuc2lvbik7CmNvbnN0IG11bHRpU2VsZWN0ID0gdGhhdC5tdWx0aVNlbGVjdCA/PyBmYWxzZTsKY29uc3QgYXJtQ29sb3IgPSB0aGF0LmFybUNvbG9yID8/IG9yaWdpbkJvdC50YWdzLmFybUNvbG9yID8/IG9yaWdpbkJvdC50YWdzLnN0cm9rZUNvbG9yID8/IG9yaWdpbkJvdC50YWdzLmNvbG9yOwpjb25zdCBhcm1NZXNoUGF0aCA9IHRoYXQuYXJtTWVzaFBhdGggPz8gb3JpZ2luQm90LnRhZ3MuYXJtTWVzaFBhdGg7Cgpjb25zdCBhcm0gPSB7CiAgICBzcGFjZTogJ3RlbXBMb2NhbCcsCiAgICBbZGltZW5zaW9uXTogdHJ1ZSwKICAgIFtkaW1lbnNpb24gKyAnWCddOiBwb3NpdGlvbi54LAogICAgW2RpbWVuc2lvbiArICdZJ106IHBvc2l0aW9uLnksCiAgICBbZGltZW5zaW9uICsgJ1onXTogcG9zaXRpb24ueiwKICAgIGNyZWF0b3I6IG9yaWdpbkJvdC5pZCwKICAgIGlzQXJtQm90OiB0cnVlLAogICAgcG9pbnRhYmxlOiB0cnVlLAogICAgbXVsdGlTZWxlY3QsCiAgICBkZWJ1ZzogdGFncy5kZWJ1ZywKICAgIG9yaWdpbkJvdDogZ2V0TGluayhvcmlnaW5Cb3QpLAogICAgZGltZW5zaW9uLAogICAgYXJtQ29sb3IsCiAgICBhcm1NZXNoUGF0aCwKICAgIGxpbmVDb2xvcjogYXJtQ29sb3IsCiAgICBsaW5lVG86IG9yaWdpbkJvdC5pZCwKICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjcmVhdGVkIGFybUJvdCAke3RoaXNCb3QuaWR9YCk7CiAgICAgICAgfQogICAgICAgIC8vIERlc3Ryb3kgcHJldmlvdXMgYXJtIGlmIGl0IGlzIHN0aWxsIGFyb3VuZC4KICAgICAgICBpZiAobGlua3Mub3JpZ2luQm90Lm1hc2tzLmFybUJvdCkgewogICAgICAgICAgICBkZXN0cm95KGxpbmtzLm9yaWdpbkJvdC5saW5rcy5hcm1Cb3QpOwogICAgICAgIH0KCiAgICAgICAgdGFncy5zeXN0ZW0gPSBgYXJtLiR7dGhpc0JvdC5pZC5zdWJzdHJpbmcoMCwgNSl9YDsKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MuYXJtQm90ID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MuZHJhZ2dhYmxlID0gdGFncy5tdWx0aVNlbGVjdDsKCiAgICAgICAgaWYgKHRhZ3MuYXJtTWVzaFBhdGggJiYgIXRhZ3MubXVsdGlTZWxlY3QpIHsKICAgICAgICAgICAgaWYgKHRhZ3MuYXJtTWVzaFBhdGguc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3MuYXJtTWVzaFBhdGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gYWIuYWJCdWlsZENhc3VhbENhdGFsb2dVUkwodGFncy5hcm1NZXNoUGF0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRhZ3MuZm9ybSA9ICdtZXNoJzsKICAgICAgICAgICAgdGFncy5mb3JtU3VidHlwZSA9ICdnbHRmJzsKICAgICAgICAgICAgdGFncy5hbmNob3JQb2ludCA9ICdjZW50ZXInOwogICAgICAgICAgICB0YWdzLmNvbG9yID0gdGFncy5hcm1Db2xvcjsKICAgICAgICAgICAgdGFncy5zY2FsZSA9IDAuOTk5OTsgLy8gVGhlcmUgaXMgYSByZWFsbHkgc3RyYW5nZSBidWcgdGhhdCBpZiB0aGlzIGlzIGxlZnQgdW5kZWZpbmVkIG9yIHNldCB0byAxIGV4YWN0bHksIHRoZSBhcm0gd2lsbCBzb21ldGltZXMgZGlzYXBwZWFyLgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3Muc3Ryb2tlQ29sb3IgPSB0YWdzLmFybUNvbG9yOwogICAgICAgICAgICB0YWdzLmZvcm0gPSAnY3ViZSc7CiAgICAgICAgICAgIHRhZ3MuY29sb3IgPSAnY2xlYXInOwogICAgICAgICAgICB0YWdzLnNjYWxlID0gMC45OwogICAgICAgICAgICB0YWdzLnNjYWxlWiA9IDAuMDE7CgogICAgICAgICAgICBpZiAodGFncy5tdWx0aVNlbGVjdCkgewogICAgICAgICAgICAgICAgdGFncy5mb3JtID0gJ3NwaGVyZSc7CiAgICAgICAgICAgICAgICB0YWdzLmNvbG9yID0gdGFncy5hcm1Db2xvcjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gTWFrZSB0aGUgb3JpZ2luIGJvdCB1bnNlbGVjdGFibGUgZm9yIDEvNCBvZiBhIHNlY29uZC4KICAgICAgICAvLyBUaGlzIGhlbHBzIHByZXZlbnQgdW5pbnRlbnRpb25hbCBzZWxmLXNlbGVjdGlvbiBvZiB0aGUgb3JpZ2luIGJvdC4KICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MucG9pbnRhYmxlID0gZmFsc2U7CiAgICAgICAgb3Muc2xlZXAoMjUwKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLnBvaW50YWJsZSA9IG51bGw7CiAgICAgICAgfSkKCiAgICAgICAgdGhpc0JvdC5vcmlnaW5DbGVhclNlbGVjdGlvbigpOwoKICAgICAgICB3aGlzcGVyKGxpbmtzLm9yaWdpbkJvdCwgJ29uQXJtQ3JlYXRlJyk7CiAgICB9KSwKICAgIHNldEFybVZpc2libGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsZXQgdmlzaWJsZSA9IHRoYXQ7CgogICAgICAgIGlmICh2aXNpYmxlKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmFybU1lc2hQYXRoKSB7CiAgICAgICAgICAgICAgICBtYXNrcy5mb3JtT3BhY2l0eSA9IG51bGw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXNrcy5zdHJva2VDb2xvciA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1hc2tzLmxpbmVDb2xvciA9IG51bGw7CiAgICAgICAgICAgIG1hc2tzLmxpbmVUbyA9IGxpbmtzLm9yaWdpbkJvdC5pZDsgCiAgICAgICAgICAgIG1hc2tzLnBvaW50YWJsZSA9IG51bGw7CgogICAgICAgICAgICBpZiAodGFncy5tdWx0aVNlbGVjdCkgewogICAgICAgICAgICAgICAgbWFza3MuY29sb3IgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHRhZ3MuYXJtTWVzaFBhdGgpIHsKICAgICAgICAgICAgICAgIG1hc2tzLmZvcm1PcGFjaXR5ID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1hc2tzLnN0cm9rZUNvbG9yID0gJ2NsZWFyJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWFza3MubGluZUNvbG9yID0gJ2NsZWFyJzsKICAgICAgICAgICAgbWFza3MubGluZVRvID0gZmFsc2U7CiAgICAgICAgICAgIG1hc2tzLnBvaW50YWJsZSA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHRhZ3MubXVsdGlTZWxlY3QpIHsKICAgICAgICAgICAgICAgIG1hc2tzLmNvbG9yID0gJ2NsZWFyJzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGNvbnN0IHsgZGltZW5zaW9uIH0gPSB0aGF0OwoKICAgICAgICBpZiAobGlua3Mub3JpZ2luQm90Py50YWdzLmFybVRlbGVwb3J0ID8/IHRydWUpIHsKICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90LnRhZ3NbZGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC50YWdzW2RpbWVuc2lvbiArICdYJ10gPSB0YWdzW2RpbWVuc2lvbiArICdYJ107CiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC50YWdzW2RpbWVuc2lvbiArICdZJ10gPSB0YWdzW2RpbWVuc2lvbiArICdZJ107CiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC50YWdzW2RpbWVuc2lvbiArICdaJ10gPSB0YWdzW2RpbWVuc2lvbiArICdaJ107CiAgICAgICAgfQoKICAgICAgICB3aGlzcGVyKGxpbmtzLm9yaWdpbkJvdCwgJ29uQXJtQ2xpY2snLCB7IGRpbWVuc2lvbiB9KTsKCiAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgIH0pLAogICAgb25Ecm9wRW50ZXI6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5kcmFnQm90ICE9PSB0aGlzQm90KSByZXR1cm47CiAgICAgICAgaWYgKCFsaW5rcy5vcmlnaW5Cb3QpIHJldHVybjsKCiAgICAgICAgY29uc3QgZHJvcEJvdCA9IHRoYXQudG8uYm90OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MubGluZUNvbG9yID0gdGFncy5hcm1Db2xvcjsKCiAgICAgICAgaWYgKHRhZ3MubXVsdGlTZWxlY3QpIHsKICAgICAgICAgICAgbGV0IGxpbmVUb0JvdHMgPSBsaW5rcy5vcmlnaW5Cb3QubGlua3MubGluZVRvOwoKICAgICAgICAgICAgaWYgKGxpbmVUb0JvdHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVUbyA9IGdldExpbmsoZHJvcEJvdCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsaW5lVG9Cb3RzID0gQXJyYXkuaXNBcnJheShsaW5lVG9Cb3RzKSA/IGxpbmVUb0JvdHMgOiBbbGluZVRvQm90c107CgogICAgICAgICAgICAgICAgaWYgKCFsaW5lVG9Cb3RzLmluY2x1ZGVzKGRyb3BCb3QpKSB7CiAgICAgICAgICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVUbyA9IGdldExpbmsoLi4ubGluZVRvQm90cywgZHJvcEJvdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzQm90LnNldEFybVZpc2libGUoZmFsc2UpOwoKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaGlkZSBhcm1gKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGlua3Mub3JpZ2luQm90Lm1hc2tzLmxpbmVUbyA9IGRyb3BCb3QuaWQ7CgogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzaG93IHNlbGVjdGlvbiBvbiBvcmlnaW4gYm90LmApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSksCiAgICBvbkRyb3BFeGl0OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQuZHJhZ0JvdCAhPT0gdGhpc0JvdCkgcmV0dXJuOwogICAgICAgIGlmICghbGlua3Mub3JpZ2luQm90KSByZXR1cm47CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGRyb3BCb3QgPSB0aGF0LnRvLmJvdDsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcm9wQm90OmAsIGRyb3BCb3QpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0YWdzLm11bHRpU2VsZWN0KSB7CiAgICAgICAgICAgIHRoaXNCb3Quc2V0QXJtVmlzaWJsZSh0cnVlKTsKCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHNob3cgYXJtYCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5saW5lVG8gPSBudWxsOwoKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2hvdyBzZWxlY3Rpb24gb24gb3JpZ2luIGJvdC5gKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pLAogICAgb25Ecm9wOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQuYm90ICE9PSB0aGlzQm90KSByZXR1cm47CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgZHJvcEJvdCA9IHRoYXQudG8uYm90OwogICAgICAgIAogICAgICAgIGlmICh0YWdzLm11bHRpU2VsZWN0ICYmIGxpbmtzLm9yaWdpbkJvdC5saW5rcy5saW5lVG8pIHsKICAgICAgICAgICAgdGhpc0JvdC5zZXRBcm1WaXNpYmxlKGZhbHNlKTsKICAgICAgICAgICAgdGhpc0JvdC5vcmlnaW5TZXRTZWxlY3Rpb24obGlua3Mub3JpZ2luQm90LmxpbmtzLmxpbmVUbyk7CiAgICAgICAgfSBlbHNlIGlmIChkcm9wQm90KSB7CiAgICAgICAgICAgIHRoaXNCb3Quc2V0QXJtVmlzaWJsZShmYWxzZSk7CiAgICAgICAgICAgIHRoaXNCb3Qub3JpZ2luU2V0U2VsZWN0aW9uKGRyb3BCb3QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIERyb3BwZWQgb24gZ3JpZC4KICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gZHJvcHBlZCBvbiBncmlkLmApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB3aGlzcGVyKGxpbmtzLm9yaWdpbkJvdCwgJ29uQXJtUGxhY2VkJywgeyBkaW1lbnNpb246IHRoYXQudG8uZGltZW5zaW9uLCB4OiB0aGF0LnRvLngsIHk6IHRoYXQudG8ueSwgejogdGhhdC50by56IH0pOwogICAgICAgIH0KICAgICAgICAKICAgIH0pLAogICAgb25HcmlkQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0aGlzQm90Lm9yaWdpbkNsZWFyU2VsZWN0aW9uKCk7CiAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgIH0pLAogICAgb3JpZ2luQ2xlYXJTZWxlY3Rpb246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5hcm1TZWxlY3RlZEJvdHMgPSBudWxsOwogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5saW5lQ29sb3IgPSBudWxsOwogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5saW5lVG8gPSBudWxsOwogICAgfSksCiAgICBvcmlnaW5TZXRTZWxlY3Rpb246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjb25zdCBzZWxlY3RlZEJvdHMgPSB0aGF0OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MuYXJtU2VsZWN0ZWRCb3RzID0gc2VsZWN0ZWRCb3RzID8gZ2V0TGluayhzZWxlY3RlZEJvdHMpIDogbnVsbDsKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MubGluZUNvbG9yID0gdGFncy5hcm1Db2xvcjsKICAgICAgICBsaW5rcy5vcmlnaW5Cb3QubWFza3MubGluZVRvID0gbGlua3Mub3JpZ2luQm90LnRhZ3MuYXJtU2VsZWN0ZWRCb3RzOwogICAgICAgIAogICAgICAgIGlmIChsaW5rcy5vcmlnaW5Cb3QubGlua3MuYXJtU2VsZWN0ZWRCb3RzKSB7CiAgICAgICAgICAgIHdoaXNwZXIobGlua3Mub3JpZ2luQm90LCAnb25Bcm1TZWxlY3RlZEJvdHMnLCBsaW5rcy5vcmlnaW5Cb3QubGlua3MuYXJtU2VsZWN0ZWRCb3RzKQogICAgICAgIH0KICAgIH0pLAogICAgb25BbnlCb3RzUmVtb3ZlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmIChsaW5rcy5vcmlnaW5Cb3QubWFza3MuYXJtU2VsZWN0ZWRCb3RzKSB7CiAgICAgICAgICAgIC8vIENoZWNrIHRoYXQgd2Ugc3RpbGwgaGF2ZSBzb21lIGFjdGl2ZSBzZWxlY3RlZCBib3RzLgogICAgICAgICAgICBsZXQgYWN0aXZlU2VsZWN0ZWRCb3RzID0gZmFsc2U7CgogICAgICAgICAgICBjb25zdCBhcm1TZWxlY3RlZEJvdHMgPSBsaW5rcy5vcmlnaW5Cb3QubGlua3MuYXJtU2VsZWN0ZWRCb3RzOwoKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJtU2VsZWN0ZWRCb3RzKSkgewogICAgICAgICAgICAgICAgYWN0aXZlU2VsZWN0ZWRCb3RzID0gYXJtU2VsZWN0ZWRCb3RzLmV2ZXJ5KGIgPT4gISFiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFjdGl2ZVNlbGVjdGVkQm90cyA9ICEhYXJtU2VsZWN0ZWRCb3RzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWFjdGl2ZVNlbGVjdGVkQm90cykgewogICAgICAgICAgICAgICAgLy8gSWYgdGhlIGJvdHMgd2UgaGFkIHNlbGVjdGVkIG5vIGxvbmdlciBleGlzdCwgZGVzdHJveSB0aGlzIGFybS4KICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3RzIHRoYXQgYXJtIGhhcyBzZWxlY3RlZCBubyBsb25nZXIgZXhpc3QsIGRlc3Ryb3kgdGhpcyBhcm0uYCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpc0JvdC5vcmlnaW5DbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3RzIHRoYXQgYXJtIGhhcyBzZWxlY3RlZCBzdGlsbCBoYXMgYWN0aXZlIGJvdHMuYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KSwKICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5hcm1Cb3QgPSBudWxsOwogICAgICAgIGxpbmtzLm9yaWdpbkJvdC5tYXNrcy5kcmFnZ2FibGUgPSBudWxsOwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7CiAgICAgICAgfQoKICAgICAgICB3aGlzcGVyKGxpbmtzLm9yaWdpbkJvdCwgJ29uQXJtRGVzdHJveScpOwogICAgfSksCn07Cgpjb25zdCBhcm1Cb3QgPSBjcmVhdGUoYXJtKTsKCnJldHVybiBhcm1Cb3Q7JwCVq56dC+IBEG9uQW55Qm90RHJhZ2dpbmcCBACVq56dC/hT0RVAY29uc3QgZHJhZ0JvdCA9IHRoYXQuYm90Owpjb25zdCBkaW1lbnNpb24gPSB0aGF0LmZyb20uZGltZW5zaW9uOwoKaWYgKGRyYWdCb3QubGlua3MuYXJtQm90KSB7CiAgICBpZiAoZHJhZ0JvdC50YWdzLmFybUdyb3VwRHJhZyAmJiBkcmFnQm90LmxpbmtzLmFybVNlbGVjdGVkQm90cykgewogICAgICAgIGxldCBkcmFnQ29vcmRpbmF0b3JCb3QgPSBsaW5rcy5kcmFnQ29vcmRpbmF0b3JCb3Q7CiAgICAgICAgCiAgICAgICAgaWYgKCFkcmFnQ29vcmRpbmF0b3JCb3QpIHsKICAgICAgICAgICAgY29uc3QgZHJhZ0Nvb3JkaW5hdG9yTW9kID0gewogICAgICAgICAgICAgICAgc3BhY2U6ICJ0ZW1wTG9jYWwiLAogICAgICAgICAgICAgICAgbWFuYWdlcjogZ2V0TGluayh0aGlzQm90KSwKICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogZGltZW5zaW9uLAogICAgICAgICAgICAgICAgW2RpbWVuc2lvbl06IHRydWUsCiAgICAgICAgICAgICAgICBbZGltZW5zaW9uICsgIlgiXTogMCwKICAgICAgICAgICAgICAgIFtkaW1lbnNpb24gKyAiWSJdOiAwLAogICAgICAgICAgICAgICAgW2RpbWVuc2lvbiArICJaIl06IC0xLAogICAgICAgICAgICAgICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRlYnVnOiB0YWdzLmRlYnVnLAogICAgICAgICAgICAgICAgY29sb3I6ICJjbGVhciIsCiAgICAgICAgICAgICAgICBzeXN0ZW06IGBhcm1Hcm91cERyYWcuJHt0aGlzQm90LmlkLnN1YnN0cmluZygwLCA1KX0uY29vcmRpbmF0b3JgLAogICAgICAgICAgICAgICAgb25BbnlCb3RQb2ludGVyVXA6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRlc3Ryb3lpbmcgZHJhZyBjb29yZGluYXRvcmApOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbGlua3MubWFuYWdlci5tYXNrcy5kcmFnQ29vcmRpbmF0b3JCb3QgPSBudWxsOyAKICAgICAgICAgICAgICAgICAgICBzaG91dCgnb25Bcm1TdG9wR3JvdXBEcmFnJywgeyB4OiB0YWdzW3RhZ3MuZGltZW5zaW9uICsgJ1gnXSwgeTogdGFnc1t0YWdzLmRpbWVuc2lvbiArICdZJ10gfSk7CiAgICAgICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90ID0gY3JlYXRlKGRyYWdDb29yZGluYXRvck1vZCk7CgogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjcmVhdGVkIGRyYWcgY29vcmRpbmF0b3IgYm90OmAsIGRyYWdDb29yZGluYXRvckJvdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1hc2tzLmRyYWdDb29yZGluYXRvckJvdCA9IGdldExpbmsoZHJhZ0Nvb3JkaW5hdG9yQm90KTsKCiAgICAgICAgICAgIGNvbnN0IGFybVNlbGVjdGVkQm90cyA9IGRyYWdCb3QubGlua3MuYXJtU2VsZWN0ZWRCb3RzOwogICAgICAgICAgICBjb25zdCBvbkFybVN0b3BHcm91cERyYWcgPSBgQAogICAgICAgICAgICAgICAgbWFza3MudHJhbnNmb3JtZXIgPSBudWxsOwogICAgICAgICAgICAgICAgbWFza3Mub25Bcm1TdG9wR3JvdXBEcmFnID0gbnVsbDsKICAgICAgICAgICAgICAgIHRhZ3MuJHtkaW1lbnNpb259WCA9IHRhZ3MuJHtkaW1lbnNpb259WCArIHRoYXQueDsKICAgICAgICAgICAgICAgIHRhZ3MuJHtkaW1lbnNpb259WSA9IHRhZ3MuJHtkaW1lbnNpb259WSArIHRoYXQueTsKICAgICAgICAgICAgYAoKICAgICAgICAgICAgZHJhZ0JvdC5tYXNrcy50cmFuc2Zvcm1lciA9IGRyYWdDb29yZGluYXRvckJvdC5pZDsKICAgICAgICAgICAgZHJhZ0JvdC5tYXNrcy5vbkFybVN0b3BHcm91cERyYWcgPSBvbkFybVN0b3BHcm91cERyYWc7CgogICAgICAgICAgICBzZXRUYWdNYXNrKGFybVNlbGVjdGVkQm90cywgInRyYW5zZm9ybWVyIiwgZHJhZ0Nvb3JkaW5hdG9yQm90LmlkLCAidGVtcExvY2FsIik7CiAgICAgICAgICAgIHNldFRhZ01hc2soYXJtU2VsZWN0ZWRCb3RzLCAib25Bcm1TdG9wR3JvdXBEcmFnIiwgb25Bcm1TdG9wR3JvdXBEcmFnLCAidGVtcExvY2FsIik7CiAgICAgICAgfQoKICAgICAgICBjb25zdCB4Q2hhbmdlID0gdGhhdC50by54IC0gdGhhdC5mcm9tLng7CiAgICAgICAgY29uc3QgeUNoYW5nZSA9IHRoYXQudG8ueSAtIHRoYXQuZnJvbS55OwoKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHhDaGFuZ2U6ICR7eENoYW5nZX0sIHlDaGFuZ2U6ICR7eUNoYW5nZX1gKTsKICAgICAgICB9CgogICAgICAgIGRyYWdDb29yZGluYXRvckJvdC50YWdzW2RpbWVuc2lvbiArICJYIl0gPSB4Q2hhbmdlOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdC50YWdzW2RpbWVuc2lvbiArICJZIl0gPSB5Q2hhbmdlOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdC50YWdzW2RpbWVuc2lvbiArICJaIl0gPSAtMTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkcmFnIGJvdCB3aXRoIGFybSBkb2VzIG5vdCBxdWFsaWZ5IGZvciBncm91cCBkcmFnZ2luZy5gKTsKICAgICAgICB9CiAgICB9Cn0nAJWrnp0L4gENYWJQZXJzb25hbGl0eQIEAJWrnp0LymkEdHJ1ZScAlauenQviAQhhYklnbm9yZQIEAJWrnp0Lz2kEdHJ1ZScAlauenQviAQRmb3JtAgQAlauenQvUaQdub3RoaW5nJwCVq56dC+IBCWFiVmVyc2lvbgIEAJWrnp0L3GkFMTAuMzUnAQRib3RzJGIyNmUxMDg5LTE3MmQtNDVhOS04ZDIyLTA1YzNmNThjMmJmNwEnAJWrnp0L4mkGc3lzdGVtAgQAlauenQvjaRhhYi5wZXJzb25hbGl0eS5hbmltYXRpb24nAJWrnp0L4mkEZm9ybQIEAJWrnp0L/GkHbm90aGluZycAlauenQviaQhhYklnbm9yZQIEAJWrnp0LhGoEdHJ1ZScAlauenQviaQ1tYW5pZmVzdGF0aW9uAgQAlauenQuJaijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCVq56dC+JpCHJlbWVtYmVyAgQAlauenQuwaijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCVq56dC+JpGGFuaW1hdGlvbl9hYkdyaWRNYW5pZmVzdAIEAJWrnp0L12r6DkBzaG91dCgicmVzZXQiKTsKCmNvbnN0IHBvc2l0aW9uWCA9IHRoYXQ/LnBvc2l0aW9uLnggPz8gMDsKY29uc3QgcG9zaXRpb25ZID0gdGhhdD8ucG9zaXRpb24ueSA/PyAwOwpjb25zdCBkaW1lbnNpb24gPSB0aGF0Py5kaW1lbnNpb24gPz8gImhvbWUiOwpjb25zdCBncmlkU2NhbGUgPSB0aGF0Py5zY2FsZSA/PyA1Owpjb25zdCBtb21lbnRDb3VudCA9IDA7CmNvbnN0IGdyaWRCb3QgPSB7fTsKCmdyaWRCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKZ3JpZEJvdC5jb2xvciA9ICJjbGVhciI7CmdyaWRCb3Quc3Ryb2tlQ29sb3IgPSBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmdyaWRCb3Quc2NhbGUgPSAwLjAwMTsKZ3JpZEJvdC5zY2FsZVogPSAwLjE7CmdyaWRCb3QucmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmdyaWRCb3RbZGltZW5zaW9uXSA9IHRydWU7CmdyaWRCb3QucG9pbnRhYmxlID0gZmFsc2U7CmdyaWRCb3Qua2lsbFRpbWVyID0gIkAgYXdhaXQgb3Muc2xlZXAoNDAwKTsgZGVzdHJveSh0aGlzQm90KTsiOwoKbGV0IHJvdW5kQm90czsKCmZvciAobGV0IGkgPSBncmlkU2NhbGU7IGkgPiAwOyBpLS0pCnsKICAgIGNvbnN0IGJvdENvdW50ID0gaSAqIDg7CgogICAgbGV0IHNpZGVDb3VudCA9IDA7CiAgICBsZXQgcGhhc2VGYWN0b3IgPSAwOwoKICAgIGZvciAobGV0IGogPSAwOyBqIDwgYm90Q291bnQ7IGorKykKICAgIHsKICAgICAgICBpZiAocGhhc2VGYWN0b3IgPT0gMCkKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9ICgoaSArIHBvc2l0aW9uWCkgKiAtMSkgKyBzaWRlQ291bnQ7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlkiXSA9IGkgKyBwb3NpdGlvblk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHBoYXNlRmFjdG9yID09IDEpCiAgICAgICAgewogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJYIl0gPSBpICsgcG9zaXRpb25YOwogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJZIl0gPSAoaSArIHBvc2l0aW9uWSkgLSBzaWRlQ291bnQ7ICAKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocGhhc2VGYWN0b3IgPT0gMikKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9IChpICsgcG9zaXRpb25YKSAtIHNpZGVDb3VudDsKICAgICAgICAgICAgZ3JpZEJvdFtkaW1lbnNpb24gKyAiWSJdID0gKChpICsgcG9zaXRpb25ZKSAqIC0xKSA7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGdyaWRCb3RbZGltZW5zaW9uICsgIlgiXSA9ICgoaSArIHBvc2l0aW9uWCkgKiAtMSkgOwogICAgICAgICAgICBncmlkQm90W2RpbWVuc2lvbiArICJZIl0gPSAoKGkgKyBwb3NpdGlvblkpICogLTEpICsgc2lkZUNvdW50OyAgCiAgICAgICAgfQoKICAgICAgICBjb25zdCBuZXdHcmlkQm90ID0gYXdhaXQgY3JlYXRlKGdyaWRCb3QpOwoKICAgICAgICBhbmltYXRlVGFnKG5ld0dyaWRCb3QsICJzY2FsZSIsIHsKICAgICAgICAgICAgdG9WYWx1ZTogMSwKICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAiZWxhc3RpYyIsCiAgICAgICAgICAgICAgICBtb2RlOiAib3V0IgogICAgICAgICAgICB9LAogICAgICAgICAgICBkdXJhdGlvbjogMC4wMQogICAgICAgIH0pLmNhdGNoKCgpID0+IHt9KTsKCiAgICAgICAgbmV3R3JpZEJvdC5raWxsVGltZXIoKTsKCiAgICAgICAgc2lkZUNvdW50Kys7CgogICAgICAgIGlmIChzaWRlQ291bnQgPT0gYm90Q291bnQgLyA0KQogICAgICAgIHsKICAgICAgICAgICAgc2lkZUNvdW50ID0gMDsKCiAgICAgICAgICAgIHBoYXNlRmFjdG9yKys7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBvcy5zbGVlcCg4KTsKICAgIH0KfScAlauenQviaQlhYlZlcnNpb24CBACVq56dC9J5BTEwLjM1JwCVq56dC+JpBm9uQ2hhdAIEAJWrnp0L2HlVQC8vIGlmICh0aGF0Lm1lc3NhZ2UgPT0gIkB0ZXN0IikKLy8gewovLyAgICAgdGhpc0JvdC5hbmltYXRpb25fYWJHcmlkTWFuaWZlc3QoKTsKLy8gfScAlauenQviaQtwZXJzb25hbGl0eQIEAJWrnp0Lrnoo8J+Ul2I3NmRmYmM0LTg1NGItNGY2ZC1hOTFmLWE5NDg2OTQ3NzRkYicAlauenQviaQ1hYlBlcnNvbmFsaXR5AgQAlauenQvVegR0cnVlJwEEYm90cyRiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGIBJwCVq56dC9p6BnN5c3RlbQIEAJWrnp0L23oVYWIucGVyc29uYWxpdHkuY29uZmlnJwCVq56dC9p6CGFiSWdub3JlAgQAlauenQvxegR0cnVlJwCVq56dC9p6BGZvcm0CBACVq56dC/Z6B25vdGhpbmcnAJWrnp0L2noLYWJCYXNlQ29sb3ICBACVq56dC/56ByMwMEQ5Q0QnAJWrnp0L2noRYWJCYXNlU3Ryb2tlQ29sb3ICBACVq56dC4Z7ByMwMEQ5Q0QnAJWrnp0L2noQYWJCbHVlcHJpbnRDb2xvcgIEAJWrnp0LjnsHIzAwODI3QicAlauenQvaeghyZW1lbWJlcgIEAJWrnp0Llnso8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAlauenQvaehFhYkJ1aWxkZXJJZGVudGl0eQIEAJWrnp0LvXsKY2FzdWFsLmJvdCcAlauenQvaeglhYlZlcnNpb24CBACVq56dC8h7BTEwLjM1JwCVq56dC9p6F2NoYW5nZVBlcnNvbmFsaXR5Q29uZmlnAgQAlauenQvOe/ITQGlmICghdGhhdCkgew0KICAgIHJldHVybjsNCn0NCg0KaWYgKCFhdXRoQm90KSB7DQogICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsNCn0NCg0KaWYgKCFhdXRoQm90KSB7DQogICAgcmV0dXJuOw0KfQ0KDQphd2FpdCBvcy5ncmFudEluc3RBZG1pblBlcm1pc3Npb24oYXV0aEJvdC5pZCk7DQoNCmxldCBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGF3YWl0IG9zLmdldERhdGEoYXV0aEJvdC5pZCwgImFiUGVyc29uYWxpdHlDb25maWciKTsNCg0KaWYgKGFiUGVyc29uYWxpdHlDb25maWdEYXRhLnN1Y2Nlc3MgPT0gZmFsc2UpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IHt9Ow0KfSBlbHNlIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGFiUGVyc29uYWxpdHlDb25maWdEYXRhLmRhdGE7DQp9DQoNCmlmICh0aGF0Lm5hbWUpIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCdWlsZGVySWRlbnRpdHkiXSA9IHRoYXQubmFtZTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJ1aWxkZXJJZGVudGl0eSIsIHRoYXQubmFtZSwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LmNvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZUNvbG9yIl0gPSB0aGF0LmNvbG9yOw0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VTdHJva2VDb2xvciJdID0gdGhhdC5jb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VDb2xvciIsIHRoYXQuY29sb3IsICJsb2NhbCIpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiQmFzZVN0cm9rZUNvbG9yIiwgdGhhdC5jb2xvciwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LnBvcnRhbENvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZUdyaWRQb3J0YWxDb2xvciJdID0gdGhhdC5wb3J0YWxDb2xvcjsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiLCB0aGF0LnBvcnRhbENvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQubWVudUNvbG9yKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiQmFzZU1lbnVDb2xvciJdID0gdGhhdC5tZW51Q29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlTWVudUNvbG9yIiwgdGhhdC5tZW51Q29sb3IsICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5tZW51TGFiZWxDb2xvcikgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkJhc2VMYWJlbENvbG9yIl0gPSB0aGF0Lm1lbnVMYWJlbENvbG9yOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiQmFzZUxhYmVsQ29sb3IiLCB0aGF0Lm1lbnVMYWJlbENvbG9yLCAibG9jYWwiKTsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJCYXNlU2hhZG93Q29sb3IiXSA9IHRoYXQubWVudUxhYmVsQ29sb3I7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJCYXNlU2hhZG93Q29sb3IiLCB0aGF0Lm1lbnVMYWJlbENvbG9yLCAibG9jYWwiKTsNCn0NCg0KaWYgKHRoYXQuZm9ybSkgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhWyJhYkZvcm0iXSA9IHRoYXQuZm9ybTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYkZvcm0iLCB0aGF0LmZvcm0sICJsb2NhbCIpOw0KfQ0KDQppZiAodGhhdC5haU1vZGVsKSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbImFiUHJlZmVycmVkQUlNb2RlbCJdID0gdGhhdC5haU1vZGVsOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImFiUHJlZmVycmVkQUlNb2RlbCIsIHRoYXQuYWlNb2RlbCwgImxvY2FsIik7DQp9DQoNCmlmICh0aGF0LmRlZmF1bHRQZXJzb25hbGl0eSkgew0KICAgIGFiUGVyc29uYWxpdHlDb25maWdEYXRhID0ge307DQogICAgdGhpc0JvdC51cGRhdGVQZXJzb25hbGl0eSh7fSk7DQp9DQoNCmlmICh0aGF0Lm1hcEJhc2VtYXApIHsNCiAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVsiYWJNYXBQb3J0YWxCYXNlIl0gPSB0aGF0Lm1hcEJhc2VtYXA7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYWJNYXBQb3J0YWxCYXNlIiwgdGhhdC5tYXBCYXNlbWFwLCAibG9jYWwiKTsNCn0NCg0KY29uc3QgcmVzdWx0ID0gYXdhaXQgb3MucmVjb3JkRGF0YShhdXRoQm90LmlkLCAiYWJQZXJzb25hbGl0eUNvbmZpZyIsIGFiUGVyc29uYWxpdHlDb25maWdEYXRhKTsNCg0KaWYgKHJlc3VsdC5zdWNjZXNzKSB7DQogICAgYWIubGlua3MudXRpbHMuYWJMb2coeyBtZXNzYWdlOiBgdXBkYXRlZCBwZXJzb25hbGl0eSBjb25maWcgaW4gdXNlciByZWNvcmRgLCBsb2dUeXBlOiAnbG9nJ30pOw0KfSBlbHNlIHsNCiAgICBhYi5saW5rcy51dGlscy5hYkxvZyh7IG1lc3NhZ2U6IGBmYWlsZWQgdG8gdXBkYXRlIHBlcnNvbmFsaXR5IGNvbmZpZyBpbiB1c2VyIHJlY29yZC5cbiR7SlNPTi5zdHJpbmdpZnkocmVzdWx0LCB1bmRlZmluZWQsIDIpfWAsIGxvZ1R5cGU6ICdlcnJvcid9KTsNCn0NCg0Kc2hvdXQoJ29uQUJQZXJzb25hbGl0eUNoYW5nZWQnLCB7IGJvdDogdGhpc0JvdCB9KTsnAJWrnp0L2noPYWJCYXNlTWVudUNvbG9yAgQAlauenQvBjwEHIzAwRDlDRCcAlauenQvaehF1cGRhdGVQZXJzb25hbGl0eQIEAJWrnp0LyY8BlhdAaWYgKHRhZ3MuZGVidWcpIHsNCiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHVwZGF0ZSBzdGFydGApOw0KfQ0KDQppZiAodGhpc0JvdC52YXJzLnVwZGF0aW5nUGVyc29uYWxpdHkpIHsNCiAgICByZXR1cm47DQp9DQoNCnRoaXNCb3QudmFycy51cGRhdGluZ1BlcnNvbmFsaXR5ID0gdHJ1ZTsNCg0KbGV0IGFiUGVyc29uYWxpdHlDb25maWdEYXRhOw0KDQppZiAodGhhdCAmJiB0aGF0ID09IHt9KSB7DQogICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSB7fTsNCn0gZWxzZSB7DQogICAgaWYgKCFhdXRoQm90KSB7DQogICAgICAgIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7DQogICAgfQ0KDQogICAgaWYgKGF1dGhCb3QpIHsNCiAgICAgICAgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgPSBhd2FpdCBvcy5nZXREYXRhKGF1dGhCb3QuaWQsICJhYlBlcnNvbmFsaXR5Q29uZmlnIik7DQogICAgICAgIGlmICghbGlua3MucmVtZW1iZXIgJiYgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEuc3VjY2VzcyA9PSBmYWxzZSkgew0KICAgICAgICAgICAgdGhpc0JvdC52YXJzLnVwZGF0aW5nUGVyc29uYWxpdHkgPSBmYWxzZTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YS5zdWNjZXNzKSB7DQogICAgICAgICAgICBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YSA9IGFiUGVyc29uYWxpdHlDb25maWdEYXRhLmRhdGE7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCmlmICh0YWdzLmRlYnVnKSB7DQogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YTpgLCB7Li4uYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGF9KTsNCn0NCg0KLy9hYkJsdWVQcmludENvbG9yDQovL2FiQmFzZUFjY2VudENvbG9yDQpjb25zdCBhYlRhZ3MgPSBbDQogICAgImFiQmFzZUNvbG9yIiwNCiAgICAiYWJCYXNlTWVudUNvbG9yIiwNCiAgICAiYWJCdWlsZGVySWRlbnRpdHkiLA0KICAgICJhYkJhc2VTdHJva2VDb2xvciIsDQogICAgImFiQmFzZUdyaWRQb3J0YWxDb2xvciIsDQogICAgImFiQmFzZUxhYmVsQ29sb3IiLA0KICAgICJhYkJhc2VTaGFkb3dDb2xvciIsDQogICAgImFiUHJlZmVycmVkQUlNb2RlbCIsDQogICAgImFiQ2F0YWxvZ05hbWUiLA0KICAgICJhYk1hcFBvcnRhbEJhc2UiDQpdOw0KDQpjbGVhclRhZ01hc2tzKHRoaXNCb3QpOw0KDQovLyBSeWFuIChBdWcgMjksIDIwMjUpOiBpbSBub3Qgc3VyZSBleGFjdGx5IHdoYXQgaXMgaGFwcGVuaW5nIGhlcmUgYnV0IHdpdGhvdXQgc2xlZXBpbmcgb24gdGhlc2UgYmlnIHRhZyBtYXNrIGNoYW5nZXMsIHRoZXkgZG9udCBhbGwgc2VlbSB0byBjb21lIGluIHByb3Blcmx5Lg0KYXdhaXQgb3Muc2xlZXAoMTAwKTsNCg0KZm9yIChsZXQgaSA9IDA7IGkgPCBhYlRhZ3MubGVuZ3RoOyArK2kpIHsNCiAgICBpZiAoYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGEgJiYgYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbYWJUYWdzW2ldXSkgew0KICAgICAgICBpZiAodGFnc1thYlRhZ3NbaV1dICE9IGFiUGVyc29uYWxpdHlDb25maWdEYXRhW2FiVGFnc1tpXV0pIHsNCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzZXR0aW5nICR7YWJUYWdzW2ldfSBsb2NhbCBtYXNrIGZyb20gYWJQZXJzb25hbGl0eUNvbmZpZ0RhdGE6ICR7YWJQZXJzb25hbGl0eUNvbmZpZ0RhdGFbYWJUYWdzW2ldXX1gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgYWJUYWdzW2ldLCBhYlBlcnNvbmFsaXR5Q29uZmlnRGF0YVthYlRhZ3NbaV1dLCAibG9jYWwiKTsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAobGlua3MucmVtZW1iZXIgJiYgbGlua3MucmVtZW1iZXIudGFnc1thYlRhZ3NbaV1dKSB7DQogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzW2FiVGFnc1tpXV0gIT0gdGFnc1thYlRhZ3NbaV1dKSB7DQogICAgICAgICAgICBpZiAodGFncy5kZWJ1Zykgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2V0dGluZyAke2FiVGFnc1tpXX0gbG9jYWwgbWFzayBmcm9tIGFiIHJlbWVtYmVyIGJvdDpgLCBsaW5rcy5yZW1lbWJlci50YWdzW2FiVGFnc1tpXV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCBhYlRhZ3NbaV0sIGxpbmtzLnJlbWVtYmVyLnRhZ3NbYWJUYWdzW2ldXSwgImxvY2FsIik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAoYWJUYWdzW2ldID09ICJhYkJhc2VHcmlkUG9ydGFsQ29sb3IiKSB7DQogICAgICAgIGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxDb2xvciA9IHRhZ3MuYWJCYXNlR3JpZFBvcnRhbENvbG9yOw0KICAgIH0NCg0KICAgIGlmIChhYlRhZ3NbaV0gPT0gImFiTWFwUG9ydGFsQmFzZSIpIHsNCiAgICAgICAgbWFwUG9ydGFsQm90LnRhZ3MubWFwUG9ydGFsQmFzZW1hcCA9IHRhZ3MuYWJNYXBQb3J0YWxCYXNlOw0KICAgICAgICBtaW5pTWFwUG9ydGFsQm90LnRhZ3MubWFwUG9ydGFsQmFzZW1hcCA9IHRhZ3MuYWJNYXBQb3J0YWxCYXNlOw0KICAgIH0NCn0NCg0KLy8gUnlhbiAoQXVnIDI5LCAyMDI1KTogaW0gbm90IHN1cmUgZXhhY3RseSB3aGF0IGlzIGhhcHBlbmluZyBoZXJlIGJ1dCB3aXRob3V0IHNsZWVwaW5nIG9uIHRoZXNlIGJpZyB0YWcgbWFzayBjaGFuZ2VzLCB0aGV5IGRvbnQgYWxsIHNlZW0gdG8gY29tZSBpbiBwcm9wZXJseS4NCmF3YWl0IG9zLnNsZWVwKDEwMCk7DQoNCnRoaXNCb3QudmFycy51cGRhdGluZ1BlcnNvbmFsaXR5ID0gZmFsc2U7DQpzaG91dCgnb25BQlBlcnNvbmFsaXR5VXBkYXRlZCcsIHsgYm90OiB0aGlzQm90IH0pOycAlauenQvaeg1hYlBlcnNvbmFsaXR5AgQAlauenQvgpgEEdHJ1ZScAlauenQvaeg1vblNraWxsVXBkYXRlAgQAlauenQvlpgEdQHRoaXNCb3QudXBkYXRlUGVyc29uYWxpdHkoKTsnAJWrnp0L2noRYWJCYXNlU2hhZG93Q29sb3ICBACVq56dC4OnAQVibGFjaycAlauenQvaehBhYkJhc2VMYWJlbENvbG9yAgQAlauenQuJpwEFYmxhY2snAJWrnp0L2noKbWFwT3B0aW9ucwIEAJWrnp0Lj6cBngfwn6esWw0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgInNhdGVsbGl0ZSIsDQogICAgICAgICJpZCI6ICJzYXRlbGxpdGUiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJoeWJyaWQiLA0KICAgICAgICAiaWQiOiAiaHlicmlkIg0KICAgIH0sDQogICAgew0KICAgICAgICAibmFtZSI6ICAib2NlYW5zIiwNCiAgICAgICAgImlkIjogIm9jZWFucyINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgIm9wZW4gc3RyZWV0IG1hcCIsDQogICAgICAgICJpZCI6ICJvc20iDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJ0ZXJyYWluIiwNCiAgICAgICAgImlkIjogInRlcnJhaW4iDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJkYXJrIGdyYXkgY2FudmFzIiwNCiAgICAgICAgImlkIjogImRhcmstZ3JheSINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgImdyYXkgY2FudmFzIiwNCiAgICAgICAgImlkIjogImdyYXkiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJzdHJlZXRzIiwNCiAgICAgICAgImlkIjogInN0cmVldHMiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJzdHJlZXRzIChkYXJrKSIsDQogICAgICAgICJpZCI6ICJzdHJlZXRzLW5pZ2h0LXZlY3RvciINCiAgICB9LA0KICAgIHsNCiAgICAgICAgIm5hbWUiOiAgInN0cmVldHMgKG5hdmlnYXRpb24pIiwNCiAgICAgICAgImlkIjogInN0cmVldHMtbmF2aWdhdGlvbi12ZWN0b3IiDQogICAgfSwNCiAgICB7DQogICAgICAgICJuYW1lIjogICJ0b3BvZ3JhcGhpYyIsDQogICAgICAgICJpZCI6ICJ0b3BvIg0KICAgIH0sDQogICAgew0KICAgICAgICAibmFtZSI6ICAic3RyZWV0cyAocmVsaWVmKSIsDQogICAgICAgICJpZCI6ICJzdHJlZXRzLXJlbGllZi12ZWN0b3IiDQogICAgfQ0KXScAlauenQvaehRzaG93QUJCYXNlbWFwT3B0aW9ucwIEAJWrnp0LrK4BxAVAc2hvdXQoImNsZWFyQUJCYXNlbWFwT3B0aW9uc01lbnUiKTsNCg0Kc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCmNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgPSAnYWJCYXNlbWFwT3B0aW9uc01lbnUnOw0KDQpmb3IgKGNvbnN0IG9wdGlvbiBvZiB0YWdzLm1hcE9wdGlvbnMpIHsNCiAgICBpZiAob3B0aW9uLmlkID09IG1hcFBvcnRhbEJvdC50YWdzLm1hcFBvcnRhbEJhc2VtYXApIHsNCiAgICAgICAgY29udGludWU7DQogICAgfQ0KICAgIGNvbnN0IG9wdGlvbk9iaiA9IA0KICAgIHsNCiAgICAgICAgYWJCYXNlbWFwT3B0aW9uc01lbnU6IHRydWUsDQogICAgICAgIGNsZWFyQUJCYXNlbWFwT3B0aW9uc01lbnU6IGBAZGVzdHJveSh0aGlzQm90KTtgLA0KICAgICAgICBtYXBJRDogb3B0aW9uLmlkLA0KICAgICAgICBsYWJlbDogb3B0aW9uLm5hbWUsDQogICAgICAgIG9uQ2xpY2s6IGBADQogICAgICAgICAgICBtYXBQb3J0YWxCb3QudGFncy5tYXBQb3J0YWxCYXNlbWFwID0gdGFncy5tYXBJRDsNCiAgICAgICAgICAgIHNob3V0KCdjaGFuZ2VQZXJzb25hbGl0eUNvbmZpZycsIHsnbWFwQmFzZW1hcCc6IHRhZ3MubWFwSUR9KTsgDQogICAgICAgICAgICBzaG91dCgiY2xlYXJBQkJhc2VtYXBPcHRpb25zTWVudSIpOw0KICAgICAgICBgDQogICAgfQ0KDQogICAgYWIubGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ob3B0aW9uT2JqKTsNCn0nAJWrnp0L2noLb25HcmlkQ2xpY2sCBACVq56dC/GzASZAc2hvdXQoImNsZWFyQUJCYXNlbWFwT3B0aW9uc01lbnUiKTsNCicAlauenQvaegVkZWJ1ZwIEAJWrnp0LmLQBBWZhbHNlJwEEYm90cyRiOWI4MjgxOS0xZjE0LTQzOTItODhhOS01MmY2N2E5ZjhlNTUBJwCVq56dC560AQZzeXN0ZW0CBACVq56dC5+0ARhhYi5wZXJzb25hbGl0eS5hcm1fbnVkZ2UnAJWrnp0LnrQBDW9uQUJBcm1QbGFjZWQCBACVq56dC7i0AThAc2V0VGFnTWFzayh0aGlzQm90LCAnaGFzQXJtQmVlblBsYWNlZCcsIHRydWUsICdsb2NhbCcpOycAlauenQuetAEJb25BQkF3YWtlAgQAlauenQvxtAEwQGF3YWl0IG9zLnNsZWVwKDI1MCk7CnRoaXNCb3QuYWJTdGFydEFybU51ZGdlKCk7JwCVq56dC560AQhhYklnbm9yZQIEAJWrnp0LorUBBHRydWUnAJWrnp0LnrQBDWFiUGVyc29uYWxpdHkCBACVq56dC6e1AQR0cnVlJwCVq56dC560AQRmb3JtAgQAlauenQustQEHbm90aGluZycAlauenQuetAEFbGVhcm4CBACVq56dC7S1ASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCVq56dC560AQ1tYW5pZmVzdGF0aW9uAgQAlauenQvbtQEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAlauenQuetAEIcmVtZW1iZXICBACVq56dC4K2ASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCVq56dC560AQVkZWJ1ZwIEAJWrnp0LqbYBBWZhbHNlJwCVq56dC560AQ5hcm1OdWRnZVdhaXRNUwIEAJWrnp0Lr7YBBDUwMDAnAJWrnp0LnrQBD29uQUJJbml0aWFsaXplZAIEAJWrnp0LtLYBG0B0aGlzQm90LmFiU3RhcnRBcm1OdWRnZSgpOycAlauenQuetAEPYWJTdGFydEFybU51ZGdlAgQAlauenQvQtgGCH0BpZiAodGhpc0JvdC52YXJzLm51ZGdlQWN0aXZlKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhlcmUgaXMgYWxyZWFkeSBhIG51ZGdlIGluIHByb2dyZXNzLmApOwogICAgfQogICAgcmV0dXJuOwp9Cgp0aGlzQm90LnZhcnMubnVkZ2VBY3RpdmUgPSB0cnVlOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc3RhcnRpbmcgbnVkZ2UuLi5gKQp9CgpmdW5jdGlvbiBjYW5OdWRnZSgpOiBib29sZWFuIHsKICAgIC8vIENhbid0IGhhdmUgcGxhY2VkIHRoZSBhcm0gYWxyZWFkeS4KICAgIGlmICh0YWdzLmhhc0FybUJlZW5QbGFjZWQpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogYXJtIHBsYWNlbWVudCBoYXMgYWxyZWFkeSBvY2N1cmVkLmApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gQUIgbWFuaWZlc3RhdGlvbiBib3QgbXVzdCBiZSBhY3RpdmUuCiAgICBpZiAoIWxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogYWIgbWFuaWZlc3RhdGlvbiBib3QgaXMgaW5hY3RpdmUuYCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBBQiBjaGF0IGJhciBtdXN0IGJlIGNsb3NlZC4KICAgIGlmIChsaW5rcy5pbnB1dC5tYXNrcy5jaGF0T3BlbikgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2Fubm90IG51ZGdlOiBhYiBjaGF0IGJhciBpcyBvcGVuLmApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gVGhlIGluc3QgbXVzdCBiZSBlbXB0eSBvZiBhbGwgYm90cy4gVGhlIGV4Y2VwdGlvbnMgYXJlIGFiIGJvdHMgYW5kIGJ1aWx0LWluIGJvdHMuCiAgICBjb25zdCB1c2VyTWFkZUJvdCA9IGdldEJvdCgoYikgPT4gewogICAgICAgIHJldHVybiAhYi50YWdzLnN5c3RlbT8uc3RhcnRzV2l0aCgnYWIuJykgJiYKICAgICAgICAgICAgICAgIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICAhYi50YWdzLmFiRWdnICYmIC8vIERvbid0IGluY2x1ZGUgYWJFZ2cgYm90cyBhcyAidXNlciBtYWRlIi4KICAgICAgICAgICAgICAgICFiLnRhZ3MuYWJMb2FkZWRTa2lsbCAmJiAvLyBEb24ndCBpbmNsdWRlIGxvYWRlZCBza2lsbCBib3RzIGFzICJ1c2VyIG1hZGUiLgogICAgICAgICAgICAgICAgIWIudGFncy5hYkJvdCAvLyBEb24ndCBpbmNsdWRlIGFueSBib3RzIHRoYXQgYXJlIGZsYWdnZWQgd2l0aCBhbiBhYkJvdCB0YWcuCiAgICB9KQogICAgCiAgICBpZiAodXNlck1hZGVCb3QpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBpZiAodGFncy5kZWJ1Z1VzZXJNYWRlQm90cykgewogICAgICAgICAgICAgICAgY29uc3QgdXNlck1hZGVCb3RzID0gZ2V0Qm90cygoYikgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhYi50YWdzLnN5c3RlbT8uc3RhcnRzV2l0aCgnYWIuJykgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhYi50YWdzLmFiRWdnIC8vIERvbid0IGluY2x1ZGUgYWJFZ2cgYm90cyBhcyAidXNlciBtYWRlIi4KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogaW5zdCBjb250YWlucyB1c2VyIG1hZGUgYm90cy5gLCB1c2VyTWFkZUJvdHMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYW5ub3QgbnVkZ2U6IGluc3QgY29udGFpbnMgdXNlciBtYWRlIGJvdHMuYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIE1lbnUgcG9ydGFsIG11c3QgZWl0aGVyIGJlIGluYWN0aXZlIG9yIG5vdCBoYXZlIGFueSBib3RzIGluIHRoZSBjdXJyZW50bHkgYWN0aXZlIG1lbnUgcG9ydGFsLgogICAgaWYgKGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwpIHsKICAgICAgICBjb25zdCBib3RJbk1lbnVQb3J0YWwgPSBnZXRCb3QoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIudGFnc1tjb25maWdCb3QudGFncy5tZW51UG9ydGFsXSA9PT0gdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICBpZiAoYm90SW5NZW51UG9ydGFsKSB7CiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbm5vdCBudWRnZTogbWVudVBvcnRhbCBpcyBjdXJyZW50bHkgb3BlbiBhbmQgaGFzIGJvdHMgaW4gaXQuYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKaWYgKGNhbk51ZGdlKCkpIHsKICAgIC8vIFN0YXJ0IG51ZGdlIGZvciBhcm0gcGxhY2VtZW50LgogICAgYXdhaXQgb3Muc2xlZXAodGFncy5hcm1OdWRnZVdhaXRNUyk7CgogICAgaWYgKGNhbk51ZGdlKCkpIHsKICAgICAgICBjb25zdCBhYlBvc2l0aW9uWCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QudGFnc1tsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uICsgJ1gnXTsKICAgICAgICBjb25zdCBhYlBvc2l0aW9uWSA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QudGFnc1tsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uICsgJ1knXTsKCiAgICAgICAgY29uc3QgZ3JpZENsaWNrUGFyYW1zID0gewogICAgICAgICAgICBkaW1lbnNpb246IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb24sCiAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IGFiUG9zaXRpb25YICsgNSwgeTogYWJQb3NpdGlvblkgfSwKICAgICAgICAgICAgZm9yY2VBcm1QbGFjZW1lbnQ6IHRydWUsCiAgICAgICAgfQoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID09PSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uKSB7CiAgICAgICAgICAgIC8vIE1hcCBwb3J0YWwgaXMgaW4gZGlmZmVyZW50IGNvb3JkaW5hdGUgc3BhY2UgYW5kIHNjYWxlLgogICAgICAgICAgICBncmlkQ2xpY2tQYXJhbXMucG9zaXRpb24ueCA9IGFiUG9zaXRpb25YICsgMC4wMDAzNTc0MzQwNjg0MDUzODIzOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB3aGlzcGVyaW5nIG9uR3JpZENsaWNrIHRvIHRoZSBhYiBtYW5pZmVzdGF0aW9uIGJvdCB3aXRoIHRoZSBwYXJhbXM6YCwgZ3JpZENsaWNrUGFyYW1zKQogICAgICAgIH0KCiAgICAgICAgLy8gRm9yY2UgYWIgYXJtIHBsYWNlbWVudCB1c2luZyB0aGUgb25HcmlkQ2xpY2sgbGlzdGVuZXIgb2YgdGhlIG1hbmlmZXN0YXRpb24gYm90LgogICAgICAgIHdoaXNwZXIobGlua3MubWFuaWZlc3RhdGlvbiwgJ29uR3JpZENsaWNrJywgZ3JpZENsaWNrUGFyYW1zKTsKICAgIH0KfQoKdGhpc0JvdC52YXJzLm51ZGdlQWN0aXZlID0gZmFsc2U7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBkb25lYCk7Cn0nAJWrnp0LnrQBEG9uQUJDaGF0QmFyQ2xvc2UCBACVq56dC9PVARtAdGhpc0JvdC5hYlN0YXJ0QXJtTnVkZ2UoKTsnAJWrnp0LnrQBBWlucHV0AgQAlauenQvv1QEo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcAlauenQuetAEJYWJWZXJzaW9uAgQAlauenQuW1gEFMTAuMzUnAJWrnp0LnrQBD29uUG9ydGFsQ2hhbmdlZAIEAJWrnp0LnNYBhQFAY29uc3QgeyBwb3J0YWwsIGRpbWVuc2lvbiB9ID0gdGhhdDsKCmlmIChwb3J0YWwgPT09ICdtZW51UG9ydGFsJykgewogICAgaWYgKCFkaW1lbnNpb24pIHsKICAgICAgICB0aGlzQm90LmFiU3RhcnRBcm1OdWRnZSgpOwogICAgfQp9JwCVq56dC560AQ1hYk1lbnVSZWZyZXNoAgQAlauenQui1wEbQHRoaXNCb3QuYWJTdGFydEFybU51ZGdlKCk7JwCVq56dC560ARFkZWJ1Z1VzZXJNYWRlQm90cwIEAJWrnp0LvtcBBWZhbHNlJwEEYm90cyRkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQBJwCVq56dC8TXAQZzeXN0ZW0CBACVq56dC8XXARxhYi5wZXJzb25hbGl0eS5tYW5pZmVzdGF0aW9uJwCVq56dC8TXAQRmb3JtAgQAlauenQvi1wEHbm90aGluZycAlauenQvE1wELZGVzY3JpcHRpb24CBACVq56dC+rXAThUaGlzIHNraWxsIGNvbnRyb2xzIHRoZSBhY3R1YWwgYm90IGZvciB0aGUgYWIgaW50ZXJmYWNlLicAlauenQvE1wEFbGVhcm4CBACVq56dC6PYASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwCVq56dC8TXAQ9vblBvcnRhbENoYW5nZWQCBACVq56dC8rYAbNAQGNvbnN0IFBPUlRBTFNfVEhBVF9ISURFID0gbmV3IFNldChbCiAgICAic3lzdGVtUG9ydGFsIiwKICAgICJzaGVldFBvcnRhbCIKXSkKCmNvbnN0IFBPUlRBTFNfVEhBVF9NQU5JRkVTVCA9IG5ldyBTZXQoWwogICAgImdyaWRQb3J0YWwiLAogICAgIm1hcFBvcnRhbCIKXSk7Cgphc3luYyBmdW5jdGlvbiBnZXREZWZhdWx0TWFuaWZlc3RQb3NpdGlvbihwb3J0YWw6ICdtYXAnIHwgJ2dyaWQnKTogeyB4OiBudW1iZXIsIHk6IG51bWJlciB9IHsKICAgIGlmIChwb3J0YWwgPT09ICdncmlkJykgewogICAgICAgIHJldHVybiB7IHg6IDAsIHk6IDAgfQogICAgfSBlbHNlIGlmIChwb3J0YWwgPT09ICdtYXAnKSB7CiAgICAgICAgaWYgKHR5cGVvZiBsaW5rcy5yZW1lbWJlci50YWdzLm1hcFpvb21Qb3NpdGlvbj8ueCA9PT0gJ251bWJlcicgJiYgIHR5cGVvZiBsaW5rcy5yZW1lbWJlci50YWdzLm1hcFpvb21Qb3NpdGlvbj8ueSA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgcmV0dXJuIGxpbmtzLnJlbWVtYmVyLnRhZ3MubWFwWm9vbVBvc2l0aW9uOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxldCBjdXJyZW50UG9zaXRpb24gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIGxldCBoYXNHZW9sb2NhdGlvblBlcm1pc3Npb24gPSBhd2FpdCBsaW5rcy51dGlscy5oYXNHZW9sb2NhdGlvblBlcm1pc3Npb24oKTsKCiAgICAgICAgICAgIC8vIEN1cnJlbnQgd29yay1hcm91bmQgZm9yIGFsbG93aW5nIGdlb2xvY2F0aW9uIGZvciBpT1MgYXBwCiAgICAgICAgICAgIGlmIChnZXRCb3QoInN5c3RlbSIsICJhYi5pb3NicmlkZ2UubWVzc2VuZ2VyIikpIHsKICAgICAgICAgICAgICAgIGhhc0dlb2xvY2F0aW9uUGVybWlzc2lvbiA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChoYXNHZW9sb2NhdGlvblBlcm1pc3Npb24pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGdlb2xvY2F0aW9uID0gYXdhaXQgb3MuZ2V0R2VvbG9jYXRpb24oKTsKICAgICAgICAgICAgICAgIGlmIChnZW9sb2NhdGlvbi5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFBvc2l0aW9uID0geyB4OiBnZW9sb2NhdGlvbi5sb25naXR1ZGUsIHk6IGdlb2xvY2F0aW9uLmxhdGl0dWRlIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1cnJlbnRQb3NpdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRQb3NpdGlvbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEdSUE0gUG9zaXRpb24KICAgICAgICAgICAgICAgIHJldHVybiB7IHg6IC04NS42NzYxODk0ODIyNDM0LCB5OiA0Mi45NjU2NzU2NzU2NzU2IH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB1bnJlY29uZ2l6ZWQgcG9ydGFsIHR5cGUgcHJvdmlkZWQgdG8gZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb246YCwgcG9ydGFsKTsKICAgICAgICByZXR1cm4geyB4OiAwLCB5OiAwIH0KICAgIH0KfQoKY29uc3QgTUFQX0xPQURfV0FJVF9USU1FID0gMTAwMDsKCmZvciAoY29uc3QgcG9ydGFsIG9mIFBPUlRBTFNfVEhBVF9ISURFKSB7CiAgICBpZiAoY29uZmlnQm90LnRhZ3NbcG9ydGFsXSAhPSBudWxsKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhIHBvcnRhbCB0aGF0IGhpZGVzIGFiIGlzIG9wZW4gLSBoaWRpbmcgYWJCb3QgYW5kIGlnbm9yaW5nLmApOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhZ3MuYWJCb3QpIHsKICAgICAgICAgICAgZGVzdHJveShsaW5rcy5hYkJvdCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm47CiAgICB9Cn0KCmlmIChjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCAhPSBudWxsIHx8IGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCAhPSBudWxsKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc2hlZXQgcG9ydGFsIG9yIHN5c3RlbSBwb3J0YWwgb3BlbmVkIC0gaGlkaW5nIGFiQm90IGFuZCBpZ25vcmluZy5gKTsKICAgIH0KCiAgICBpZiAodGFncy5hYkJvdCkgewogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwogICAgfQoKICAgIHJldHVybjsKfQoKaWYgKCF0YWdzLmFiQXdha2UpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYiBpcyBub3QgYXdha2UgLSBpZ25vcmluZy5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKHRoYXQucG9ydGFsID09ICJ0YWdQb3J0YWwiKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGFnUG9ydGFsIGNoYW5nZWQgLSBpZ25vcmluZy5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKHRoYXQucG9ydGFsID09ICJtZW51UG9ydGFsIikgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG1lbnVQb3J0YWwgY2hhbmdlZCAtIGlnbm9yaW5nLmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAodGhhdC5wb3J0YWwgPT0gImdyaWRQb3J0YWwiICYmIGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGdyaWRQb3J0YWwgY2hhbmdlZCwgYnV0IGFsc28gYWxyZWFkeSBpbiB0aGUgbWFwUG9ydGFsIC0gaWdub3JpbmcuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7Cn0KCi8vIFRoZSBtYXAgcG9ydGFsIGlzIHRvdWdoLiBJdCBzZWVtcyB0byB2YXJ5IGluIGxvYWRpbmcgc3BlZWQgb24KLy8gdmFyaW91cyBoYXJkd2FyZSBhbmQgbmV0d29ya3MgYW5kIGhhcyBieSB0aGUgdGltZSBvblBvcnRhbENoYW5nZWQgaXMgY2FsbGVkIGl0IGRvZXNudAovLyBzZWVtIGd1YXJlbnRlZWQgdG8gYmUgYWN0dWFsbHkgcmVhZHkuIEFkZGluZyBhIGhhcmRjb2RlZCB3YWl0IHRpbWUgdG8gZ2l2ZSB0aGUgcG9ydGFsIHNwYWNlIHRvIGdldAovLyB0aGUgbWFwIHBvcnRhbCBmdWxseSBsb2FkZWQgYmVmb3JlIGNvbnRpbnVpbmcgd2l0aCBtYW5pZmVzdGluZyBhYi4KLy8KLy8gQXQgc29tZSBwb2ludCB0aGlzIGNhbiBnbyBhd2F5IGlmIHdlIGV2ZXIgZ2V0IGEgc2hvdXQgb3Igc29tZSBvdGhlciBnYXVyZW50ZWUgdGhhdCB0aGUgbWFwIHBvcnRhbCBpcyBsb2FkZWQvcmVhZHkuCmlmICh0aGF0LnBvcnRhbCA9PT0gJ21hcFBvcnRhbCcpIHsKICAgIGlmICh0aGF0LmRpbWVuc2lvbikgewogICAgICAgIGlmICghdGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRlZCkgewogICAgICAgICAgICBpZiAoIXRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkV2FpdGVyKSB7CiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMubWFwUG9ydGFsTG9hZFdhaXRlciA9IG9zLnNsZWVwKE1BUF9MT0FEX1dBSVRfVElNRSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gd2FpdGluZyBmb3IgbWFwIHBvcnRhbCB0byBmaW5pc2ggbG9hZGluZzogJHtNQVBfTE9BRF9XQUlUX1RJTUV9bXNgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXdhaXQgdGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRXYWl0ZXI7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkV2FpdGVyID0gbnVsbDsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRlZCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWFwIHBvcnRhbCBpcyBhbHJlYWR5IGxvYWRlZC5gKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc0JvdC52YXJzLm1hcFBvcnRhbExvYWRlZCA9IGZhbHNlOwogICAgICAgIHRoaXNCb3QudmFycy5tYXBQb3J0YWxMb2FkV2FpdGVyID0gbnVsbDsKCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtYXAgcG9ydGFsIGhhcyBiZWVuIHVubG9hZGVkLmApOwogICAgICAgIH0KICAgIH0KfQoKLy8gU3RhcnQgY2hlY2tzIGZvciBpZi93aGVyZSB3ZSBuZWVkIHRvIG1hbmlmZXN0IGFiLgpsZXQgbmV3QUIgPSBmYWxzZTsKbGV0IG5ld0FCUG9ydGFsOwpsZXQgbmV3QUJQb3NpdGlvbjsKbGV0IGZvY3VzQ2FtZXJhID0gdHJ1ZTsKCmlmIChQT1JUQUxTX1RIQVRfTUFOSUZFU1QuaGFzKHRoYXQucG9ydGFsKSAmJiB0aGF0LmRpbWVuc2lvbikgewogICAgLy8gQSBwb3J0YWwgdGhhdCBtYW5pZmVzdHMgYWIgaGFzIGp1c3QgY2hhbmdlZCBkaW1lbnNpb24uCiAgICAvLyBNYW5pZmVzdCBhYiBpbiB0aGUgbmV3IGRpbWVuc2lvbi4KICAgIGlmICh0aGF0LnBvcnRhbCA9PSAibWFwUG9ydGFsIiB8fCB0aGF0LnBvcnRhbCA9PSAibWluaU1hcFBvcnRhbCIpIHs7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtYW5pZmVzdGluZyBhYiBib3QgaW4gbWFwIHBvcnRhbCBkaW1lbnNpb24gJyR7dGhhdC5kaW1lbnNpb259Jy5gKTsKICAgICAgICB9CgogICAgICAgIG5ld0FCUG9zaXRpb24gPSBhd2FpdCBnZXREZWZhdWx0TWFuaWZlc3RQb3NpdGlvbignbWFwJyk7CiAgICAgICAgbmV3QUJQb3J0YWwgPSB0aGF0LnBvcnRhbDsKICAgICAgICBuZXdBQiA9IGF3YWl0IHRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7IGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHBvc2l0aW9uOiBuZXdBQlBvc2l0aW9uIH0pOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtYW5pZmVzdGluZyBhYiBib3QgZGltZW5zaW9uICcke3RoYXQuZGltZW5zaW9ufScuYCk7CiAgICAgICAgfQoKICAgICAgICBuZXdBQlBvc2l0aW9uID0gYXdhaXQgZ2V0RGVmYXVsdE1hbmlmZXN0UG9zaXRpb24oJ2dyaWQnKTsKICAgICAgICBuZXdBQlBvcnRhbCA9IHRoYXQucG9ydGFsOwogICAgICAgIG5ld0FCID0gYXdhaXQgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHsgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwgcG9zaXRpb246IG5ld0FCUG9zaXRpb24gfSk7CiAgICB9Cn0gZWxzZSBpZiAoKFBPUlRBTFNfVEhBVF9NQU5JRkVTVC5oYXModGhhdC5wb3J0YWwpIHx8IFBPUlRBTFNfVEhBVF9ISURFLmhhcyh0aGF0LnBvcnRhbCkpICYmIAogICAgICAgICAgICF0aGF0LmRpbWVuc2lvbiAmJiAKICAgICAgICAgICAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCB8fCBjb25maWdCb3QudGFncy5tYXBQb3J0YWwpCikgewogICAgLy8gQSBwb3J0YWwgdGhhdCB0eXBpY2FsbHkgaGlkZXMgb3IgcmUtbWFuaWZlc3RzIGFiIGp1c3QgY2xvc2VkLCBidXQgZWl0aGVyIHRoZSBncmlkIG9yIG1hcCBwb3J0YWwgYXJlIHN0aWxsIG9wZW4uCiAgICAvLyBTdW1tb24gYWIgaW4gZWl0aGVyIHRoZSBtYXBQb3J0YWwgb3IgZ3JpZFBvcnRhbC4KICAgIGxldCBzdW1tb25EaW1lbnNpb247CgogICAgaWYgKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCkgewogICAgICAgIHN1bW1vbkRpbWVuc2lvbiA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbDsKICAgICAgICBuZXdBQlBvcnRhbCA9ICdtYXBQb3J0YWwnOwogICAgICAgIAogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzW3N1bW1vbkRpbWVuc2lvbiArICdBQkxhc3RQb3NpdGlvbiddKSB7CiAgICAgICAgICAgIC8vIFVzZSBsYXN0IGtub3duIHBvc2l0aW9uLgogICAgICAgICAgICBuZXdBQlBvc2l0aW9uID0gbGlua3MucmVtZW1iZXIudGFnc1tzdW1tb25EaW1lbnNpb24gKyAnQUJMYXN0UG9zaXRpb24nXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBVc2UgZGVmYXVsdCBtYXAgcG9zaXRpb24uCiAgICAgICAgICAgIG5ld0FCUG9zaXRpb24gPSBhd2FpdCBnZXREZWZhdWx0TWFuaWZlc3RQb3NpdGlvbignbWFwJyk7CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsKSB7CiAgICAgICAgc3VtbW9uRGltZW5zaW9uID0gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKICAgICAgICBuZXdBQlBvcnRhbCA9ICdncmlkUG9ydGFsJzsKCiAgICAgICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3Nbc3VtbW9uRGltZW5zaW9uICsgJ0FCTGFzdFBvc2l0aW9uJ10pIHsKICAgICAgICAgICAgLy8gVXNlIGxhc3Qga25vd24gcG9zaXRpb24uCiAgICAgICAgICAgIG5ld0FCUG9zaXRpb24gPSBsaW5rcy5yZW1lbWJlci50YWdzW3N1bW1vbkRpbWVuc2lvbiArICdBQkxhc3RQb3NpdGlvbiddOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFVzZSBkZWZhdWx0IGdyaWQgcG9zaXRpb24uCiAgICAgICAgICAgIG5ld0FCUG9zaXRpb24gPSBhd2FpdCBnZXREZWZhdWx0TWFuaWZlc3RQb3NpdGlvbignZ3JpZCcpOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoc3VtbW9uRGltZW5zaW9uKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzdW1tb25pbmcgYWIgYm90IGluICR7bmV3QUJQb3J0YWx9IGRpbWVuc2lvbiAnJHtzdW1tb25EaW1lbnNpb259Jy5gKTsKICAgICAgICB9CgogICAgICAgIG5ld0FCID0gYXdhaXQgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHsgZGltZW5zaW9uOiBzdW1tb25EaW1lbnNpb24sIHBvc2l0aW9uOiBuZXdBQlBvc2l0aW9uIH0pOwoKICAgICAgICBpZiAoUE9SVEFMU19USEFUX0hJREUuaGFzKHRoYXQucG9ydGFsKSkgewogICAgICAgICAgICAvLyBJZiB0aGUgcG9ydGFsIHRoYXQgY2xvc2VkIHdhcyBhIHBvcnRhbCB0aGF0IGhpZGVzIGFiLCB0aGVuIGRvbnQgcnVuIHRoZSBjYW1lcmEgZm9jdXMuCiAgICAgICAgICAgIC8vIFRoaXMgd2lsbCBqdXN0IHVzZSB0aGUgcHJldmlvdXMgY2FtZXJhIHBvc2l0aW9uIGFscmVhZHkgc3RvcmVkIGluIG1lbW9yeS4KICAgICAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gd2lsbCBub3QgZm9jdXMgY2FtZXJhIG9uIGFiIGJlY2F1c2Ugd2UgYXJlIGp1c3QgYXNzdW1pbmcgdGhlIHByZXZpb3VzIGNhbWVyYSBwb3NpdGlvbi5gKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb2N1c0NhbWVyYSA9IGZhbHNlOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBib3RoIHRoZSBtYXAgYW5kIGdyaWQgcG9ydGFsIGFyZSBib3RoIGNsb3NlZCwgY2Fubm90IHN1bW1vbiBhYiBpbiBlaXRoZXIuYCk7CiAgICAgICAgfQogICAgfQp9IGVsc2UgewogICAgcmV0dXJuOwp9CgppZiAobmV3QUIgJiYgZm9jdXNDYW1lcmEpIHsKICAgIGxldCB6b29tID0gMTA7CgogICAgaWYgKG5ld0FCUG9ydGFsID09PSAnbWFwUG9ydGFsJyB8fCBuZXdBQlBvcnRhbCA9PT0gJ21pbmlNYXBQb3J0YWwnKSB7CiAgICAgICAgem9vbSA9IDIwMDA7CiAgICB9CiAgICB0cnkgewogICAgICAgIGF3YWl0IG9zLmZvY3VzT24obmV3QUJQb3NpdGlvbiwgeyB6b29tLCByb3RhdGlvbjogeyB4OiA0NSwgeTogNDUgfSwgcG9ydGFsOiBuZXdBQlBvcnRhbCB9KQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGZvY3VzT24gZXJyb3Igb2NjdXJlZDpgLCBlKTsKICAgICAgICB9CiAgICB9Cn0nAJWrnp0LxNcBCHJlbWVtYmVyAgQAlauenQv+mAIo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAlauenQvE1wENYWJNYW5pZmVzdEJvdAIEAJWrnp0LpZkC3D1AY29uc3QgZGltZW5zaW9uID0gdGhhdD8uZGltZW5zaW9uOwpjb25zdCBwb3NpdGlvbiA9IHRoYXQ/LnBvc2l0aW9uOwoKaWYgKHRoaXNCb3QudmFycy5hYkJvdExhc3RJZCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGRlc3Ryb3lpbmcgYWJCb3RgKTsKICAgIH0KICAgIGRlc3Ryb3kodGhpc0JvdC52YXJzLmFiQm90TGFzdElkKTsKfQoKY29uc3QgYWJNb2QgPSB7CiAgICBzcGFjZTogJ3RlbXBMb2NhbCcsCiAgICBkaW1lbnNpb24sCiAgICBhYkJvdDogdHJ1ZSwKICAgIFtkaW1lbnNpb25dOiB0cnVlLAogICAgW2RpbWVuc2lvbiArICdYJ106IHBvc2l0aW9uLngsCiAgICBbZGltZW5zaW9uICsgJ1knXTogcG9zaXRpb24ueSwKICAgIG1hbmFnZXI6IGdldExpbmsodGhpc0JvdCksCiAgICByZW1lbWJlcjogdGFncy5yZW1lbWJlciwKICAgIGZvcm06ICdjdWJlJywKICAgIGxhYmVsOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUxhYmVsLAogICAgbGFiZWxQb3NpdGlvbjogJ2Zyb250JywKICAgIGxhYmVsQ29sb3I6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IsCiAgICBsYWJlbFNpemU6IDAuNjEsCiAgICBkcmFnZ2FibGU6IGZhbHNlLAogICAgYXJtU2VsZWN0aW9uOiB0cnVlLAogICAgYXJtR3JvdXBEcmFnOiB0cnVlLAogICAgYXJtVGVsZXBvcnQ6IHRydWUsCiAgICBhcm1NZXNoUGF0aDogbGlua3MucmVtZW1iZXIudGFncy5hYkFybU1lc2hQYXRoLAogICAgYXJtQ29sb3I6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IsCiAgICBwZXJzb25hbGl0eTogdGFncy5wZXJzb25hbGl0eSwKICAgIHJlbWVtYmVyOiB0YWdzLnJlbWVtYmVyLAogICAgbGVhcm46IHRhZ3MubGVhcm4sCiAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4geyAKICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYk1lc2hQYXRoKSB7CiAgICAgICAgICAgIGxldCBmb3JtQWRkcmVzczsKCiAgICAgICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiTWVzaFBhdGguc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgICAgZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiTWVzaFBhdGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3JtQWRkcmVzcyA9IGxpbmtzLmxlYXJuLmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJNZXNoUGF0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgbWVzaCBmb3IgYWIuCiAgICAgICAgICAgIG1hc2tzLm1lc2hCb3QgPSBnZXRMaW5rKGNyZWF0ZSh7CiAgICAgICAgICAgICAgICBzcGFjZTogJ3RlbXBMb2NhbCcsCiAgICAgICAgICAgICAgICBhYkJvdDogZ2V0TGluayh0aGlzQm90KSwKICAgICAgICAgICAgICAgIGZvcm06ICdtZXNoJywKICAgICAgICAgICAgICAgIGZvcm1TdWJ0eXBlOiAnZ2x0ZicsCiAgICAgICAgICAgICAgICBmb3JtQWRkcmVzcywKICAgICAgICAgICAgICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lcjogdGhpc0JvdC5pZCwKICAgICAgICAgICAgICAgIGFuY2hvclBvaW50OiAnY2VudGVyJywKICAgICAgICAgICAgICAgIFt0YWdzLmRpbWVuc2lvbl06IHRydWUsCiAgICAgICAgICAgICAgICBbdGFncy5kaW1lbnNpb24gKyAnWiddOiAtMC41CiAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIHRhZ3MuY29sb3IgPSAndHJhbnNwYXJlbnQnOwogICAgICAgICAgICB0YWdzLnNjYWxlID0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBJZiBhIGN1c3RvbSBtZXNoIGlzIG5vdCBkZWZpbmVkIGZvciBhYiwgdGhlbiBnaXZlIGFiIGEgImNvcmUiLgogICAgICAgICAgICBtYXNrcy5jb3JlQm90ID0gZ2V0TGluayhjcmVhdGUoewogICAgICAgICAgICAgICAgc3BhY2U6ICd0ZW1wTG9jYWwnLAogICAgICAgICAgICAgICAgYWJCb3Q6IGdldExpbmsodGhpc0JvdCksCiAgICAgICAgICAgICAgICBjb2xvcjogbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvciwKICAgICAgICAgICAgICAgIGZvcm1PcGFjaXR5OiAwLjY2LAogICAgICAgICAgICAgICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNjYWxlOiAwLjc1LAogICAgICAgICAgICAgICAgdHJhbnNmb3JtZXI6IHRoaXNCb3QuaWQsCiAgICAgICAgICAgICAgICBhbmNob3JQb2ludDogJ2NlbnRlcicsCiAgICAgICAgICAgICAgICBbdGFncy5kaW1lbnNpb25dOiB0cnVlLAogICAgICAgICAgICAgICAgW3RhZ3MuZGltZW5zaW9uICsgJ1onXTogLTAuNQogICAgICAgICAgICB9KSk7CgogICAgICAgICAgICB0YWdzLmNvbG9yID0gbGlua3MucGVyc29uYWxpdHkudGFncy5hYkJhc2VDb2xvcjsKICAgICAgICAgICAgdGFncy5zY2FsZSA9IDAuOTsKICAgICAgICAgICAgdGFncy5zdHJva2VXaWR0aCA9IDE7CiAgICAgICAgICAgIHRhZ3Muc3Ryb2tlQ29sb3IgPSBsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwogICAgICAgICAgICB0YWdzLmZvcm1PcGFjaXR5ID0gMC4zMzsKICAgICAgICAgICAgdGFncy5mb3JtRGVwdGhUZXN0ID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB0aGlzQm90LmFuaW1hdGVCb3QoKTsKICAgICAgICBtYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHRoaXNCb3QuYW5pbWF0ZUJvdCgpLCAyMDAwKTsKICAgIH0pLAogICAgb25DbGljazogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGF0Lm1vZGFsaXR5ID09ICdtb3VzZScgJiYgdGhhdC5idXR0b25JZCA9PSAncmlnaHQnKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKG1hc2tzLmFybUJvdCkgewogICAgICAgICAgICBkZXN0cm95KGxpbmtzLmFybUJvdCk7CiAgICAgICAgICAgIG1hc2tzLmFybUJvdCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soKTsKICAgIH0pLAogICAgb25Qb2ludGVyRW50ZXI6TGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGF0Lm1vZGFsaXR5ID09PSAnbW91c2UnKSB7CiAgICAgICAgICAgIHRhZ3MubW91c2VPdmVyID0gdHJ1ZTsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsKICAgICAgICB9CiAgICB9KSwKICAgIG9uUG9pbnRlckV4aXQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5tb2RhbGl0eSA9PT0gJ21vdXNlJykgewogICAgICAgICAgICB0YWdzLm1vdXNlT3ZlciA9IGZhbHNlOwogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVBvcnRhbEN1cnNvcigpOwogICAgICAgIH0KICAgIH0pLAogICAgb25Qb2ludGVyRG93bjogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGF0Lm1vZGFsaXR5ID09PSAnbW91c2UnICYmIHRoYXQuYnV0dG9uSWQgPT09ICdsZWZ0JykgewogICAgICAgICAgICB0YWdzLm1vdXNlTGVmdEJ1dHRvbkRvd24gPSB0cnVlOwogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVBvcnRhbEN1cnNvcigpOwogICAgICAgIH0KICAgIH0pLAogICAgb25Qb2ludGVyVXA6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAodGhhdC5tb2RhbGl0eSA9PT0gJ21vdXNlJyAmJiB0aGF0LmJ1dHRvbklkID09PSAnbGVmdCcpIHsKICAgICAgICAgICAgdGFncy5tb3VzZUxlZnRCdXR0b25Eb3duID0gZmFsc2U7CiAgICAgICAgICAgIHRhZ3MubW91c2VMZWZ0RHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVQb3J0YWxDdXJzb3IoKTsKICAgICAgICB9CiAgICB9KSwKICAgIG9uRHJhZzogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0YWdzLm1vdXNlTGVmdEJ1dHRvbkRvd24pIHsKICAgICAgICAgICAgdGFncy5tb3VzZUxlZnREcmFnZ2luZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlUG9ydGFsQ3Vyc29yKCk7ICAKICAgICAgICB9CiAgICB9KSwKICAgIG9uS2V5RG93bjogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGlmICh0aGF0LmtleXMuaW5jbHVkZXMoJ1NoaWZ0JykpIHsKICAgICAgICAgICAgdGFncy5zaGlmdEhlbGQgPSB0cnVlOwogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVBvcnRhbEN1cnNvcigpOyAgCiAgICAgICAgfQogICAgfSksCiAgICBvbktleVVwOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgaWYgKHRoYXQua2V5cy5pbmNsdWRlcygnU2hpZnQnKSkgewogICAgICAgICAgICB0YWdzLnNoaWZ0SGVsZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVBvcnRhbEN1cnNvcigpOyAgCiAgICAgICAgfQogICAgfSksCiAgICB1cGRhdGVQb3J0YWxDdXJzb3I6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsZXQgY3Vyc29yID0gbnVsbDsKCiAgICAgICAgaWYgKHRhZ3MubW91c2VMZWZ0RHJhZ2dpbmcpIHsKICAgICAgICAgICAgY3Vyc29yID0gJ2dyYWJiaW5nJzsgICAgCiAgICAgICAgfSBlbHNlIGlmICh0YWdzLm1vdXNlT3ZlcikgewogICAgICAgICAgICBpZiAodGFncy5zaGlmdEhlbGQpIHsKICAgICAgICAgICAgICAgIGN1cnNvciA9ICdjb250ZXh0LW1lbnUnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3Vyc29yID0gJ3BvaW50ZXInOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbEN1cnNvciA9IGN1cnNvcjsKICAgIH0pLAogICAgYW5pbWF0ZUJvdDogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4geyAKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3Qgcm90WiA9IHRhZ3MuZGltZW5zaW9uICsgJ1JvdGF0aW9uWic7CiAgICAgICAgbGV0IHRhcmdldFNjYWxlID0gMC42NTsKCiAgICAgICAgYXdhaXQgYW5pbWF0ZVRhZyh0aGlzQm90LAogICAgICAgIHsKICAgICAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgICAgICBbcm90Wl06IDAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgICAgIFtyb3RaXTogNi4zLAogICAgICAgICAgICB9LAogICAgICAgICAgICBlYXNpbmc6IHsKICAgICAgICAgICAgICAgIHR5cGU6ICdzaW51c29pZGFsJywKICAgICAgICAgICAgICAgIG1vZGU6ICdpbm91dCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHVyYXRpb246IDIKICAgICAgICB9KS5jYXRjaChlID0+IHt9KTsKICAgIH0pLAogICAgb25Bcm1DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAoIXRhZ3MuaW50ZXJ2YWwpIHsKICAgICAgICAgICAgbGlua3MubWFuYWdlci5hYkNsaWNrKHsgcmVzZXQ6IHRydWUgfSk7CiAgICAgICAgfQogICAgfSksCiAgICBvbkFybVBsYWNlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiR3JpZEZvY3VzID0gewogICAgICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLCAKICAgICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgICAgIHg6IHRoYXQueCwKICAgICAgICAgICAgICAgIHk6IHRoYXQueQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soeyBtZW51OiAnZ3JpZCcgfSk7CgogICAgICAgIHNob3V0KCdvbkFCQXJtUGxhY2VkJywgdGhhdCk7CiAgICB9KSwKICAgIG9uQXJtQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soeyByZXNldDogdHJ1ZSB9KTsKICAgICAgICBzaG91dCgnb25BQkZvb3RDbGlja2VkJywgdGhhdCk7CiAgICB9KSwKICAgIG9uQXJtU2VsZWN0ZWRCb3RzOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRCb3RzID0gdGhhdDsKCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2VsZWN0ZWRCb3RzKSkgewogICAgICAgICAgICAvLyBNdWx0aXBsZSBib3Qgc2VsZWN0aW9uLgogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYk11bHRpcGxlQm90Rm9jdXMgPSBnZXRMaW5rKHNlbGVjdGVkQm90cyk7CiAgICAgICAgICAgIGxpbmtzLm1hbmFnZXIuYWJDbGljayh7IG1lbnU6ICdtdWx0aXBsZUJvdCcgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gU2luZ2xlIGJvdCBzZWxlY3Rpb24uCiAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQm90Rm9jdXMgPSAi8J+UlyIgKyBzZWxlY3RlZEJvdHMuaWQ7CgogICAgICAgICAgICBpZiAoc2VsZWN0ZWRCb3RzID09PSB0aGlzQm90KSB7CiAgICAgICAgICAgICAgICBhYi5saW5rcy5tZW51LmFiRW52aXJvbm1lbnRNZW51KCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soeyBtZW51OiAnYm90JyB9KTsKICAgICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIHNob3V0KCdvbkFCU2VsZWN0ZWRCb3QnLCBzZWxlY3RlZEJvdHMpOwogICAgfSksCiAgICBvbkFybURlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBzaG91dCgnYWJNZW51UmVmcmVzaCcpOwogICAgfSksCiAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBjbGVhckludGVydmFsKHRhZ3MuaW50ZXJ2YWwpOwogICAgICAgIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7CiAgICB9KSwKfTsKCmNvbnN0IGFiQm90ID0gY3JlYXRlKGFiTW9kKTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiU2Vjb25kYXJ5TGFiZWwpIHsKICAgIGNvbnN0IGFiTGFiZWxCb3QgPSB7CiAgICAgICAgc3BhY2U6ICd0ZW1wTG9jYWwnLAogICAgICAgIFtkaW1lbnNpb25dOiB0cnVlLAogICAgICAgIFtkaW1lbnNpb24gKyAnWiddOiAtMSwKICAgICAgICBjcmVhdG9yOiBhYkJvdC5pZCwKICAgICAgICB0cmFuc2Zvcm1lcjogYWJCb3QuaWQsCiAgICAgICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgICAgICBjb2xvcjogJ2NsZWFyJywKICAgICAgICBsYWJlbDogbGlua3MucmVtZW1iZXIudGFncy5hYlNlY29uZGFyeUxhYmVsLAogICAgICAgIGxhYmVsUG9zaXRpb246ICdsZWZ0JywKICAgICAgICBsYWJlbFNpemU6IDAuNywKICAgICAgICBsYWJlbENvbG9yOiBhYkJvdC50YWdzLmxhYmVsQ29sb3IsCiAgICB9OwoKICAgIGNyZWF0ZShhYkxhYmVsQm90KTsKfQoKbWFza3MuYWJCb3QgPSBnZXRMaW5rKGFiQm90KTsKbGlua3MucmVtZW1iZXIubWFza3MuYWJBY3RpdmVEaW1lbnNpb24gPSBkaW1lbnNpb247CnRoaXNCb3QudmFycy5hYkJvdExhc3RJZCA9IGFiQm90LmlkOyAvLyBTdG9yaW5nIGlkIGFzIGEgdmFyIHByZXZlbnRzIGdob3N0IGFiQm90cyBkdXJpbmcgbXVsdGlwbGUgY2FsbHMgaW4gb25lIGZyYW1lLgoKLy8gU3RvcmUgdGhlIGxhc3QgcG9zaXRpb24gb2YgYWIgaW4gdGhpcyBkaW1lbnNpb24gb24gdGhlIHJlbWVtYmVyIGJvdC4KbGlua3MucmVtZW1iZXIubWFza3NbZGltZW5zaW9uICsgJ0FCTGFzdFBvc2l0aW9uJ10gPSAn8J+nrCcgKyBKU09OLnN0cmluZ2lmeSh7IHg6IHBvc2l0aW9uPy54LCB5OiBwb3NpdGlvbj8ueSB9KTsKCmF3YWl0IG9zLnNsZWVwKDApOyAvLyBHaXZlIENhc3VhbE9TIGEgY2hhbmNlIHRvIHVwZGF0ZSB0YWcgbWFza3MuCgpzaG91dCgnb25BQk1vdmVkJywgeyBkaW1lbnNpb24sIHg6IHBvc2l0aW9uLngsIHk6IHBvc2l0aW9uLnkgfSk7CgpyZXR1cm4gYWJCb3Q7JwCVq56dC8TXAQtvbkdyaWRDbGljawIEAJWrnp0L/tYCwBRAaWYgKCF0YWdzLmFiQXdha2UpIHsKICAgIHJldHVybjsKfQoKY29uc3Qgc2hpZnRDaGVjayA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZiAobGlua3MuYWJCb3QgJiYgKHNoaWZ0Q2hlY2sgfHwgKHRoYXQubW9kYWxpdHkgPT0gIm1vdXNlIiAmJiB0aGF0LmJ1dHRvbklkID09ICJyaWdodCIgJiYgIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSaWdodENsaWNrRGlzYWJsZWQpIHx8IHRoYXQuZm9yY2VBcm1QbGFjZW1lbnQpKSB7CiAgICBjb25zdCBhcm1Cb3QgPSBhYi5saW5rcy5hcm1fdG9vbC5hYkNyZWF0ZUFybSh7CiAgICAgICAgb3JpZ2luQm90OiBsaW5rcy5hYkJvdCwKICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLAogICAgICAgIHBvc2l0aW9uOiB0aGF0LnBvc2l0aW9uLAogICAgfSkKCiAgICAvLyBGYWtlIHVzZXIgZHJvcHBpbmcgdGhlIGFybSBvbiB0aGUgZ3JpZCBzcGFjZS4KICAgIGFybUJvdC5vbkRyb3AoewogICAgICAgIGJvdDogYXJtQm90LAogICAgICAgIHRvOiB7CiAgICAgICAgICAgIHg6IHRoYXQucG9zaXRpb24ueCwKICAgICAgICAgICAgeTogdGhhdC5wb3NpdGlvbi55LAogICAgICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uCiAgICAgICAgfSwKICAgICAgICBmcm9tOiB7CiAgICAgICAgICAgIHg6IHRoYXQucG9zaXRpb24ueCwKICAgICAgICAgICAgeTogdGhhdC5wb3NpdGlvbi55LAogICAgICAgICAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuOwp9Cgpjb25zdCBmb290cHJpbnQgPSB7CiAgICBzcGFjZTogInRlbXBMb2NhbCIsCiAgICBkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLAogICAgW3RoYXQuZGltZW5zaW9uXTogdHJ1ZSwKICAgIFt0aGF0LmRpbWVuc2lvbiArICJYIl06IHRoYXQucG9zaXRpb24ueCwKICAgIFt0aGF0LmRpbWVuc2lvbiArICJZIl06IHRoYXQucG9zaXRpb24ueSwKICAgIHBvc2l0aW9uSW5mbzogdGhhdCwKICAgIHBlcnNvbmFsaXR5OiB0YWdzLnBlcnNvbmFsaXR5LAogICAgcmVtZW1iZXI6IHRhZ3MucmVtZW1iZXIsCiAgICBsZWFybjogdGFncy5sZWFybiwKICAgIGRyYWdnYWJsZTogZmFsc2UsCiAgICBjdXJzb3I6ICdhbGlhcycsCiAgICBtYW5hZ2VyOiBnZXRMaW5rKHRoaXNCb3QpLAogICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGRlc3Ryb3kodGhpc0JvdCksIDgwMCk7CgogICAgICAgIGlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQXJtTWVzaFBhdGgpIHsKICAgICAgICAgICAgaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBcm1NZXNoUGF0aC5zdGFydHNXaXRoKCdodHRwczovLycpKSB7CiAgICAgICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkFybU1lc2hQYXRoOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLmxlYXJuLmFiQnVpbGRDYXN1YWxDYXRhbG9nVVJMKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBcm1NZXNoUGF0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRhZ3MuZm9ybSA9ICdtZXNoJzsKICAgICAgICAgICAgdGFncy5mb3JtU3VidHlwZSA9ICdnbHRmJzsKICAgICAgICAgICAgdGFncy5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CiAgICAgICAgICAgIHRhZ3Muc3Ryb2tlQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwogICAgICAgICAgICB0YWdzLmFuY2hvclBvaW50ID0gJ2NlbnRlcic7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5jb2xvciA9ICdjbGVhcic7CiAgICAgICAgICAgIHRhZ3Muc3Ryb2tlQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwogICAgICAgICAgICB0YWdzLnNjYWxlWiA9IDAuMDE7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgICAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgICAgICBzY2FsZVg6IDAuMSwKICAgICAgICAgICAgICAgIHNjYWxlWTogMC4xCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgICAgIHNjYWxlWDogMS4xLAogICAgICAgICAgICAgICAgc2NhbGVZOiAxLjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHVyYXRpb246IDAuNSwKICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAiZWxhc3RpYyIsCiAgICAgICAgICAgICAgICBtb2RlOiAib3V0IgogICAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZSA9PiB7fSk7CiAgICB9KSwKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgIHNob3V0KCJvbkFCRm9vdENsaWNrZWQiLCB7IGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24gfSk7CiAgICAgICAgbGlua3MubWFuYWdlci5hYk1hbmlmZXN0Qm90KHRhZ3MucG9zaXRpb25JbmZvKTsKICAgIH0pLAp9OwoKCmNyZWF0ZShmb290cHJpbnQpOycAlauenQvE1wEEbWVudQIEAJWrnp0Lv+sCKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAJWrnp0LxNcBB2FiQ2xpY2sCBACVq56dC+brArUKQGlmICghbGlua3MuYWJCb3QpIHsKICAgIHJldHVybjsKfQoKaWYgKGxpbmtzLmlucHV0KSB7CiAgICBsaW5rcy5pbnB1dC5hYkNoYXRCYXJDbG9zZSgpOwp9Cgpjb25zdCByZXNldCA9IHRoYXQgPyB0aGF0LnJlc2V0IDogZmFsc2U7CmNvbnN0IG1lbnUgPSB0aGF0ID8gdGhhdC5tZW51IDogImNvcmUiOwpjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CgppZiAoIXJlc2V0ICYmIChsaW5rcy5hYkJvdC50YWdzLmludGVydmFsIHx8IHN0YXRlKSkgewogICAgY29uc3QgYWJNZW51Qm90cyA9IGdldEJvdHMoImFiTWVudSIsIHRydWUpOwoKICAgIHdoaXNwZXIoYWJNZW51Qm90cywgImFiTWVudVJlZnJlc2giKTsKCiAgICBjbGVhckludGVydmFsKGxpbmtzLmFiQm90LnRhZ3MuaW50ZXJ2YWwpOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmludGVydmFsID0gbnVsbDsKCiAgICBjbGVhckFuaW1hdGlvbnMobGlua3MuYWJCb3QpOwoKICAgIGNvbnN0IHJvdFogPSBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJSb3RhdGlvbloiOwoKICAgIGlmIChzdGF0ZSAmJiBtZW51ID09ICJjb3JlIikgewogICAgICAgIGxpbmtzLm1lbnUuYWJFbnZpcm9ubWVudE1lbnUoKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGxpbmtzLm1lbnUuYWJPcGVuTWVudShtZW51KTsKICAgIH0KCiAgICBhbmltYXRlVGFnKGxpbmtzLmFiQm90LCB7CiAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgIFtyb3RaXTogbGlua3MuYWJCb3QudGFnc1tyb3RaXQogICAgICAgIH0sCiAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICBbcm90Wl06IDAKICAgICAgICB9LAogICAgICAgIGVhc2luZzogewogICAgICAgICAgICB0eXBlOiAic2ludXNvaWRhbCIsCiAgICAgICAgICAgIG1vZGU6ICJpbm91dCIKICAgICAgICB9LAogICAgICAgIGR1cmF0aW9uOiAwLjUKICAgIH0pLmNhdGNoKGUgPT4ge30pCn0KZWxzZSB7CiAgICBsaW5rcy5hYkJvdC5hbmltYXRlQm90KCk7CgogICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gbnVsbDsKCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGNsZWFySW50ZXJ2YWwobGlua3MuYWJCb3QudGFncy5pbnRlcnZhbCk7CiAgICBsaW5rcy5hYkJvdC5tYXNrcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IGxpbmtzLmFiQm90LmFuaW1hdGVCb3QoKSwgMjAwMCk7Cn0KCnNob3V0KCdvbkFCQ2xpY2snLCB7IGFiQm90OiBsaW5rcy5hYkJvdCwgZGltZW5zaW9uOiBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiwgbWVudSwgc2hpZnRLZXk6ICEhc3RhdGUsIHJlc2V0IH0pOycAlauenQvE1wEIYWJJZ25vcmUCBACVq56dC5z2AgR0cnVlJwCVq56dC8TXAQNhc2sCBACVq56dC6H2Aijwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCVq56dC8TXAQlhc2tCdXR0b24CBACVq56dC8j2AsgFQGlmICghdGFncy5hYkF3YWtlKQp7CiAgICByZXR1cm47Cn0KCmxldCBhYk1lbnVCdXR0b24gPSB7fTsKCmFiTWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSBsaW5rcy5tZW51LnRhZ3MucmVtZW1iZXI7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gbGlua3MubWVudS50YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24uYmFzZVNraWxsID0gIvCflJciICsgbGlua3MuYXNrLmlkOwphYk1lbnVCdXR0b24ubGFiZWwgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51TGFiZWw7CmFiTWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVJY29uOwphYk1lbnVCdXR0b24ub25DcmVhdGUgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51T25HZW5lcmF0ZTsKYWJNZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVTb3J0T3JkZXI7CmFiTWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVDb2xvciA/IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVDb2xvciA6IGxpbmtzLnBlcnNvbmFsaXR5LnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihhYk1lbnVCdXR0b24pOycAlauenQvE1wEJYWJCb3RDaGF0AgQAlauenQuP/ALuCEBpZiAoIWxpbmtzLmFiQm90ICYmICF0aGF0LmJvdCkKewogICAgcmV0dXJuOwp9Cgpjb25zdCBib3RCYXNlID0gdGhhdC5ib3QgPyB0aGF0LmJvdDogbGlua3MuYWJCb3Q7CmNvbnN0IGRpbWVuc2lvbiA9ICF0aGF0LmJvdCA/IGJvdEJhc2UudGFncy5kaW1lbnNpb24gOiB0aGF0LmRpbWVuc2lvbiA/IHRoYXQuZGltZW5zaW9uIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKY29uc3QgbWVzc2FnZSA9IHRoYXQubWVzc2FnZTsKY29uc3QgbWVzc2FnZVRpbWUgPSB0aGF0LnRpbWUgPyB0aGF0LnRpbWUgKiAxMDAwIDogMTYwMDsgCgpjb25zdCBtZXNzYWdlQm90ID0gYXdhaXQgbGlua3MuYm90X2ZhY3RvcnkuYWJDcmVhdGVCaWxsYm9hcmRMYWJlbCh7CiAgICBib3Q6IGJvdEJhc2UsCiAgICBsYWJlbDogbWVzc2FnZSwKICAgIGRpbWVuc2lvbiwKICAgIG1lc3NhZ2VUaW1lLAogICAgY29sb3I6ICIjMDAwMDAwIiwKICAgIGxhYmVsQ29sb3I6ICIjZmZmZmZmIiwKICAgIG9uQm90QWRkZWQ6IGBACiAgICAgICAgYXdhaXQgb3Muc2xlZXAodGFncy5tZXNzYWdlVGltZSk7CiAgICAgICAgdGhpc0JvdC5vbkZhZGUoKTsKICAgIGAsCiAgICBvbkZhZGU6IGBACiAgICAgICAgYW5pbWF0ZVRhZyh0aGlzQm90LCB7CiAgICAgICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICAgICAgZm9ybU9wYWNpdHk6IDEsCiAgICAgICAgICAgICAgICBsYWJlbE9wYWNpdHk6IDEsCiAgICAgICAgICAgICAgICBbdGFncy5kaW1lbnNpb24gKyAiWiJdOiB0YWdzW3RhZ3MuZGltZW5zaW9uICsgIloiXQogICAgICAgICAgICB9LAogICAgICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgICAgICBmb3JtT3BhY2l0eTogMCwKICAgICAgICAgICAgICAgIGxhYmVsT3BhY2l0eTogMCwKICAgICAgICAgICAgICAgIFt0YWdzLmRpbWVuc2lvbiArICJaIl06IHRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWiJdICsgNQogICAgICAgICAgICB9LAogICAgICAgICAgICBkdXJhdGlvbjogJHt0aGF0LmR1cmF0aW9uID8/IDN9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHt9KQogICAgICAgIC5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICB9KQoKICAgIGAsCn0pOycAlauenQvE1wEJYWJWZXJzaW9uAgQAlauenQv+hAMFMTAuMzUnAJWrnp0LxNcBCWFuaW1hdGlvbgIEAJWrnp0LhIUDKPCflJdiMjZlMTA4OS0xNzJkLTQ1YTktOGQyMi0wNWMzZjU4YzJiZjcnAJWrnp0LxNcBD29uQW55Qm90Q2xpY2tlZAIEAJWrnp0Lq4UD6QdAaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiUmlnaHRDbGlja0Rpc2FibGVkICYmICF0aGF0LmJvdC50YWdzLmFiUmlnaHRDbGlja0lnbm9yZSAmJiB0aGF0Lm1vZGFsaXR5ID09ICJtb3VzZSIgJiYgdGhhdC5idXR0b25JZCA9PSAicmlnaHQiKSB7CiAgICBpZiAoIXRhZ3MuYWJBd2FrZSkgewogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBhYiBzZWxlY3RlZAogICAgaWYgKHRoYXQuYm90ID09IGxpbmtzLmFiQm90KSB7CiAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgICAgIHJldHVybjsKICAgIH0gICAgCiAgICAKICAgIGNvbnN0IGFybUJvdCA9IGFiLmxpbmtzLmFybV90b29sLmFiQ3JlYXRlQXJtKHsKICAgICAgICBvcmlnaW5Cb3Q6IGxpbmtzLmFiQm90LAogICAgICAgIGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sCiAgICAgICAgcG9zaXRpb246IHRoYXQucG9zaXRpb24sCiAgICB9KQoKICAgIGNvbnN0IGJvdFBvc2l0aW9uID0gZ2V0Qm90UG9zaXRpb24odGhhdC5ib3QsIHRoYXQuZGltZW5zaW9uKTsKCiAgICAvLyBGYWtlIHVzZXIgZHJvcHBpbmcgdGhlIHNlbGVjdGluZyB0aGUgYm90IHdpdGggdGhlIGFybS4KICAgIGFybUJvdC5vbkRyb3AoewogICAgICAgIGJvdDogYXJtQm90LAogICAgICAgIHRvOiB7CiAgICAgICAgICAgIGJvdDogdGhhdC5ib3QsCiAgICAgICAgICAgIHg6IGJvdFBvc2l0aW9uLngsCiAgICAgICAgICAgIHk6IGJvdFBvc2l0aW9uLnksCiAgICAgICAgICAgIHo6IGJvdFBvc2l0aW9uLnosCiAgICAgICAgICAgIGRpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24KICAgICAgICB9LAogICAgICAgIGZyb206IHsKICAgICAgICAgICAgeDogYm90UG9zaXRpb24ueCwKICAgICAgICAgICAgeTogYm90UG9zaXRpb24ueSwKICAgICAgICAgICAgejogYm90UG9zaXRpb24ueiwKICAgICAgICAgICAgZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbgogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybjsKfScAlauenQvE1wEFaW5wdXQCBACVq56dC5WNAyjwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwCVq56dC8TXAQtwZXJzb25hbGl0eQIEAJWrnp0LvI0DKPCflJdiNzZkZmJjNC04NTRiLTRmNmQtYTkxZi1hOTQ4Njk0Nzc0ZGInAJWrnp0LxNcBDWFiUGVyc29uYWxpdHkCBACVq56dC+ONAwR0cnVlJwCVq56dC8TXAQphYlNldEF3YWtlAgQAlauenQvojQOTEEBsZXQgYXdha2UgPSB0aGF0Py5hd2FrZTsKbGV0IGluaXRpYWwgPSB0aGF0Py5pbml0aWFsID8/IGZhbHNlOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKYXNzZXJ0KHR5cGVvZiBhd2FrZSA9PT0gJ2Jvb2xlYW4nLCBgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGF3YWtlIGlzIGEgcmVxdWlyZWQgYm9vbGVhbiBwYXJhbWV0ZXIuYCk7CgppZiAoY29uZmlnQm90LnRhZ3MuYWJTdGF5QXdha2UpIHsKICAgIC8vIElmIGFiU3RheUF3YWtlIGlzIGVuYWJsZWQsIG92ZXJyaWRlIHRoZSBpbmNvbWluZyBhd2FrZSBwYXJhbWV0ZXIgYW5kIG5ldmVyIGxldCBhYiBiZSBwdXQgdG8gc2xlZXAuCiAgICBhd2FrZSA9IHRydWU7Cn0KCmlmICh0YWdzLmFiQXdha2UgIT09IGF3YWtlKSB7CiAgICBpZiAoaW5pdGlhbCkgewogICAgICAgIGlmIChjb25maWdCb3QudGFncy5wYXR0ZXJuKSB7CiAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gY29uZmlnQm90LnRhZ3MucGF0dGVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA9IHV1aWQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gUGxheSBpbml0aWFsIGFuaW1hdGlvbiBpZiBvbmUgaXMgZGVmaW5lZCBvbiBhYkNvbmZpZy4KICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxBbmltYXRpb24pIHsKICAgICAgICAgICAgYXdhaXQgbGlua3MuYW5pbWF0aW9uW2xpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsQW5pbWF0aW9uXSgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBTaG93IGluaXRpYWwgbWVzc2FnZSBpZiBvbmUgaXMgZGVmaW5lZCBvbiBhYkNvbmZpZy4KICAgICAgICBpZiAobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxNZXNzYWdlKSB7CiAgICAgICAgICAgIHNob3V0KCJzaG93Q29uc29sZSIpOwoKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobGlua3MucmVtZW1iZXIudGFncy5hYkluaXRpYWxNZXNzYWdlKSkgewogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2UubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBhYi5sb2cobGlua3MucGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiSW5pdGlhbE1lc3NhZ2VbaV0pOwoKICAgICAgICAgICAgICAgICAgICBhd2FpdCBvcy5zbGVlcCgyMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGFiLmxvZyhsaW5rcy5wZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJJbml0aWFsTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gVXBkYXRlIGFiQXdha2Ugc2hhcmVkIHRhZyBtYXNrLgogICAgc2V0VGFnTWFzayh0aGlzQm90LCAnYWJBd2FrZScsIGF3YWtlLCAnc2hhcmVkJyk7CiAgICAKICAgIGlmIChhd2FrZSkgewogICAgICAgIGxldCBkaW1lbnNpb24gPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwoKICAgICAgICBpZiAoIWRpbWVuc2lvbikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBhd2FpdCB0aGlzQm90LmFiTWFuaWZlc3RCb3QoeyBkaW1lbnNpb24sIHBvc2l0aW9uOiB7IHg6IDAsIHk6IDAgfSB9KTsKCiAgICAgICAgc2hvdXQoIm9uQUJBd2FrZSIsIHsgZGltZW5zaW9uLCBwb3NpdGlvbjogeyB4OiAwLCB5OiAwIH0gfSk7CiAgICB9IGVsc2UgewogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwogICAgICAgIHNob3V0KCJvbkFCU2xlZXAiKTsKICAgIH0KfScAlauenQvE1wEFdXRpbHMCBACVq56dC/ydAyjwn5SXOTNkOTY1ZTAtZDIwZS00YjQ1LThjYTAtNjQ5MjczYjcxMzhjJwCVq56dC8TXAQtib3RfZmFjdG9yeQIEAJWrnp0Lo54DKPCflJdjNzhhYTY2My1kMDVjLTRlYzQtYmMyYy0yNmZkNTE1NjBiOTcnAJWrnp0LxNcBD29uQUJJbml0aWFsaXplZAIEAJWrnp0Lyp4DfUBpZiAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsKSB7DQogICAgdGhpc0JvdC5vblBvcnRhbENoYW5nZWQoe3BvcnRhbDogIm1hcFBvcnRhbCIsIGRpbWVuc2lvbjogY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsfSk7DQp9JwCVq56dC8TXAQVkZWJ1ZwIEAJWrnp0LyJ8DBWZhbHNlJwCVq56dC8TXARBvbkFCQmVmb3JlVXBkYXRlAgQAlauenQvOnwM2QGNvbmZpZ0JvdC50YWdzLmFiV2FzQXdha2VCZWZvcmVVcGRhdGUgPSB0YWdzLmFiQXdha2U7JwCVq56dC8TXAQtvbkFCVXBkYXRlZAIEAJWrnp0LhaADjwFAaWYgKGNvbmZpZ0JvdC50YWdzLmFiV2FzQXdha2VCZWZvcmVVcGRhdGUpIHsKICAgIGNvbmZpZ0JvdC50YWdzLmFiV2FzQXdha2VCZWZvcmVVcGRhdGUgPSBudWxsOwogICAgYXdhaXQgdGhpc0JvdC5hYlNldEF3YWtlKHsgYXdha2U6IHRydWUgfSkKfQA="}]}