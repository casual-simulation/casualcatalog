{"version":2,"updates":[{"id":0,"timestamp":1768856733938,"update":"AV6Mm5zYAQAnAQRib3RzJDdkM2ExNzAzLTBhMDEtNDY2Yi05NzRmLWFlOWYxMDAxYWM3OAEnAIybnNgBAAZzeXN0ZW0CBACMm5zYAQETYWIucHJlc2VuY2UudmVyc2lvbicAjJuc2AEAFmFiUHJlc2VuY2VNaW5vclZlcnNpb24CBACMm5zYARUCMTEnAIybnNgBABZhYlByZXNlbmNlTWFqb3JWZXJzaW9uAgQAjJuc2AEYATAnAIybnNgBAAhhYklnbm9yZQIEAIybnNgBGgR0cnVlJwCMm5zYAQAKYWJQcmVzZW5jZQIEAIybnNgBHwR0cnVlJwCMm5zYAQAEZm9ybQIEAIybnNgBJAdub3RoaW5nJwCMm5zYAQANb25Ta2lsbFVwZGF0ZQIEAIybnNgBLJ4BQGNvbnN0IHZlcnNpb25TdHJpbmcgPSB0YWdzLmFiUHJlc2VuY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiUHJlc2VuY2VNaW5vclZlcnNpb247Cgpjb25zb2xlLmxvZygiW0FCUHJlc2VuY2VdIExvYWRlZCBBQiBzaGVsbCB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAIybnNgBAAlhYlZlcnNpb24CBACMm5zYAcsBBTEwLjM1JwEEYm90cyQ4N2U5NTM0Mi1lNDU2LTRiNjMtOTg5MS1kN2E5MjFhZDNlZTcBJwCMm5zYAdEBBnN5c3RlbQIEAIybnNgB0gETYWIucHJlc2VuY2UubWFuYWdlcicAjJuc2AHRAQphYlByZXNlbmNlAgQAjJuc2AHmAQR0cnVlJwCMm5zYAdEBCGFiSWdub3JlAgQAjJuc2AHrAQR0cnVlJwCMm5zYAdEBBGZvcm0CBACMm5zYAfABB25vdGhpbmcnAIybnNgB0QEKb25Cb3RBZGRlZAIEAIybnNgB+AGFAUAvKiogQHR5cGUgQUJVc2VyUHJlc2VuY2VRdWV1ZWRDdXJzb3JEYXRhW10gKi8KdGhpc0JvdC52YXJzLmN1cnNvclF1ZXVlID0gW107CgppZiAob3MuaXNDb2xsYWJvcmF0aXZlKCkpIHsKICAgIHRoaXNCb3Quc3RhcnRUaWNrKCk7Cn0nAIybnNgB0QEJc3RhcnRUaWNrAgQAjJuc2AH+ArAFQGlmIChtYXNrcy50aWNrSW50ZXJ2YWxJZCkgewogICAgcmV0dXJuOwp9CgppZiAoIW9zLmlzQ29sbGFib3JhdGl2ZSgpKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2FuY2VsaW5nIHRpY2sgc3RhcnQg4oCUIHRoZSBpbnN0IG11c3QgYmUgY29sbGFib3JhdGl2ZS5gKTsKICAgIH0KCiAgICByZXR1cm47Cn0KCmlmICghdGhpc0JvdC5nZXRQcmVzZW5jZUVuYWJsZWQoKSkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbmNlbGluZyB0aWNrIHN0YXJ0IOKAlCBwcmVzZW5jZSBpcyBkaXNhYmxlZC5gKTsKICAgIH0KCiAgICByZXR1cm47Cn0KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHN0YXJ0IGludGVydmFsYCk7Cn0KCmZ1bmN0aW9uIHRpY2soKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX1dIHRpY2tgKTsKICAgIH0KCiAgICB3aGlzcGVyKHRoaXNCb3QsICdvblRpY2snKTsKfQoKbWFza3MudGlja0ludGVydmFsSWQgPSBzZXRJbnRlcnZhbCh0aWNrLCB0YWdzLnRpY2tJbnRlcnZhbE1TKTsKdGljaygpOycAjJuc2AHRAQhzdG9wVGljawIEAIybnNgBqwjHAUBpZiAobWFza3MudGlja0ludGVydmFsSWQpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzdG9wIGludGVydmFsYCk7CiAgICB9CgogICAgY2xlYXJJbnRlcnZhbChtYXNrcy50aWNrSW50ZXJ2YWxJZCk7CiAgICBtYXNrcy50aWNrSW50ZXJ2YWxJZCA9IG51bGw7Cn0nAIybnNgB0QEOdGlja0ludGVydmFsTVMCBACMm5zYAfMJATMnAIybnNgB0QEFZGVidWcCBACMm5zYAfUJBWZhbHNlJwCMm5zYAdEBBm9uVGljawIEAIybnNgB+wniPUBpZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzdGFydGApOwp9CgppZiAoIXRoaXNCb3QuZ2V0UHJlc2VuY2VFbmFibGVkKCkpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpZ25vcmluZyB0aWNrIOKAlCBwcmVzZW5jZSBpcyBkaXNhYmxlZC5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKCFjb25maWdCb3QpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpZ25vcmluZyB0aWNrIOKAlCB3YWl0aW5nIGZvciBjb25maWdCb3QgdG8gYmUgcmVhZHkuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCmlmICghZ2xvYmFsVGhpcy5hYikgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgZm9yIGFiIHRvIGJlIHJlYWR5LmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAoY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpZ25vcmluZyB0aWNrIOKAlCB3YWl0aW5nIHRvIGxlYXZlIHNoZWV0IHBvcnRhbC5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgdG8gbGVhdmUgc3lzdGVtIHBvcnRhbC5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKLy8gR2V0IGxpc3Qgb2YgcmVsZXZhbnQgcHJlc2VuY2UgZGF0YSBmcm9tIHBvcnRhbHMgJiBkaW1lbnNpb25zIHRoYXQgdGhlIHVzZXIgaXMgYWN0aXZlIGluLgpjb25zdCBwcmVzZW5jZURhdGFUb0VtaXQ6IEFCVXNlclByZXNlbmNlRGF0YVtdID0gW107CgovLyBNYWtlIGEgY29weSBvZiB0aGUgY3VycmVudCBjdXJzb3IgcXVldWUgYW5kIHJlc2V0IGl0LiBDdXJyZW50IGN1cnNvciBxdWV1ZSB3aWxsIGJlIHByb2Nlc3NlZCBpbiB0aGlzIHRpY2suCmNvbnN0IGN1cnNvclF1ZXVlOiBBQlVzZXJQcmVzZW5jZVF1ZXVlZEN1cnNvckRhdGFbXSA9IFsuLi4odGhpc0JvdC52YXJzLmN1cnNvclF1ZXVlID8/IFtdKV07CnRoaXNCb3QudmFycy5jdXJzb3JRdWV1ZSA9IFtdOwoKYXN5bmMgZnVuY3Rpb24gdHJ5R2VuZXJhdGVQcmVzZW5jZURhdGFGb3JQb3J0YWwocG9ydGFsOiBzdHJpbmcpOiBBQlVzZXJQcmVzZW5jZURhdGEgfCBudWxsIHsKICAgIGNvbnN0IGluTWFwID0gcG9ydGFsID09PSAnbWFwJyB8fCBwb3J0YWwgPT09ICdtaW5pTWFwJzsKICAgIGNvbnN0IGRpbWVuc2lvbiA9IG9zLmdldFBvcnRhbERpbWVuc2lvbihwb3J0YWwpOwogICAgY29uc3QgcG9ydGFsQm90ID0gZ2xvYmFsVGhpc1twb3J0YWwgKyAnUG9ydGFsQm90J107CgogICAgaWYgKCFwb3J0YWwpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBpZiAoIWRpbWVuc2lvbikgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGlmICghcG9ydGFsQm90KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfS50cnlHZW5lcmF0ZVByZXNlbmNlRGF0YUZvclBvcnRhbF0gdW5hYmxlIHRvIGZpbmQgJHtwb3J0YWx9IHBvcnRhbCBib3QuYCk7CiAgICB9CiAgICAKICAgIGNvbnN0IHByZXNlbmNlRGF0YTogQUJVc2VyUHJlc2VuY2VEYXRhID0gewogICAgICAgIHJlbW90ZUlkOiBjb25maWdCb3QuaWQsCiAgICAgICAgcmVtb3RlTmFtZTogdGhpc0JvdC5nZXRSZW1vdGVOYW1lKCksCiAgICAgICAgcG9ydGFsLAogICAgICAgIGRpbWVuc2lvbiwKICAgICAgICBjb2xvcjogdGhpc0JvdC5nZXRSZW1vdGVDb2xvcigpLAogICAgICAgIGNhbWVyYTogdW5kZWZpbmVkLAogICAgICAgIGN1cnNvcnM6IHVuZGVmaW5lZCwKICAgIH0KCiAgICBjb25zdCBjYW1lcmFTdXBwb3J0ZWQgPSBwb3J0YWwgPT09ICdncmlkJyB8fCBwb3J0YWwgPT09ICdtaW5pR3JpZCcgfHwgcG9ydGFsID09PSAnbWFwJyB8fCBwb3J0YWwgPT09ICdtaW5pTWFwJzsKCiAgICBpZiAodGFncy5jYW1lcmFFbmFibGVkICYmIGNhbWVyYVN1cHBvcnRlZCkgewogICAgICAgIHByZXNlbmNlRGF0YS5jYW1lcmEgPSB7CiAgICAgICAgICAgIGNhbWVyYVR5cGU6IGluTWFwID8gJ3BlcnNwZWN0aXZlJyA6IChwb3J0YWxCb3QudGFncy5wb3J0YWxDYW1lcmFUeXBlID8/ICdvcnRob2dyYXBoaWMnKSwKICAgICAgICAgICAgcG9zaXRpb246IGluTWFwID8gcG9ydGFsQm90LnRhZ3MuY2FtZXJhTWFwUG9zaXRpb24gOiBwb3J0YWxCb3QudGFncy5jYW1lcmFQb3NpdGlvbiwKICAgICAgICAgICAgcXVhdGVybmlvbjogcG9ydGFsQm90LnRhZ3MuY2FtZXJhUm90YXRpb24ucXVhdGVybmlvbiwKICAgICAgICAgICAgem9vbTogcG9ydGFsQm90LnRhZ3MuY2FtZXJhWm9vbSwKICAgICAgICB9OwogICAgfQoKICAgIGNvbnN0IGN1cnNvclN1cHBvcnRlZCA9IHBvcnRhbCA9PT0gJ2dyaWQnIHx8IHBvcnRhbCA9PT0gJ21pbmlHcmlkJzsKCiAgICBpZiAodGFncy5jdXJzb3JFbmFibGVkICYmIGN1cnNvclN1cHBvcnRlZCkgewogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUG9pbnRlckN1cnNvckRhdGEocG9pbnRlcjogJ21vdXNlJyB8ICdsZWZ0JyB8ICdyaWdodCcpOiBBQlVzZXJQcmVzZW5jZUN1cnNvckRhdGEgewogICAgICAgICAgICBjb25zdCBwb2ludGVyUG9zaXRpb24gPSBvcy5nZXRQb2ludGVyUG9zaXRpb24ocG9pbnRlcik7CiAgICAgICAgICAgIGNvbnN0IHBvaW50ZXJEaXJlY3Rpb24gPSBvcy5nZXRQb2ludGVyRGlyZWN0aW9uKHBvaW50ZXIpOwogICAgICAgICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gYXdhaXQgb3MucmF5Y2FzdChwb3J0YWwsIHBvaW50ZXJQb3NpdGlvbiwgcG9pbnRlckRpcmVjdGlvbik7CgogICAgICAgICAgICBsZXQgcmF5Y2FzdEhpdDsKCiAgICAgICAgICAgIGlmIChyYXljYXN0UmVzdWx0LmJvdEludGVyc2VjdGlvbnMgJiYgcmF5Y2FzdFJlc3VsdC5ib3RJbnRlcnNlY3Rpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHJheWNhc3RIaXQgPSByYXljYXN0UmVzdWx0LmJvdEludGVyc2VjdGlvbnMuZmluZCgoaCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBoLmJvdC50YWdzLnBvaW50YWJsZSAhPSBmYWxzZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyYXljYXN0SGl0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBwb2ludGVyLAogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IHJheWNhc3RIaXQucG9pbnQueCwgeTogcmF5Y2FzdEhpdC5wb2ludC55LCB6OiByYXljYXN0SGl0LnBvaW50LnogfSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIERpZG4ndCBoaXQgYW55IGJvdHMuCiAgICAgICAgICAgICAgICAvLyBUcnkgdGVzdGluZyBhZ2FpbnN0IHRoZSBncm91bmQgcGxhbmUuCiAgICAgICAgICAgICAgICBjb25zdCBncm91bmRQb2ludCA9IG1hdGguaW50ZXJzZWN0UGxhbmUocG9pbnRlclBvc2l0aW9uLCBwb2ludGVyRGlyZWN0aW9uKTsKCiAgICAgICAgICAgICAgICBpZiAoZ3JvdW5kUG9pbnQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBwb2ludGVyLAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogeyB4OiBncm91bmRQb2ludC54LCB5OiBncm91bmRQb2ludC55LCB6OiBncm91bmRQb2ludC56IH0sCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBOb3QgaW50ZXJzZWN0aW5nIHdpdGggYW55dGhpbmcgcmlnaHQgc28gc28gbGV0cyBqdXN0IGdldCBhIHBvaW50IHNvbWUgZGlzdGFuY2UgZG93biB0aGUgCiAgICAgICAgICAgICAgICAgICAgLy8gcG9pbnRlcidzIHJheSBhbmQgY2FsbCBpdCBnb29kLgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb2F0aW5nUG9pbnQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHBvaW50ZXJQb3NpdGlvbi54ICsgcG9pbnRlckRpcmVjdGlvbi54ICogdGFncy5mbG9hdGluZ0N1cnNvckRpc3RhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICB5OiBwb2ludGVyUG9zaXRpb24ueSArIHBvaW50ZXJEaXJlY3Rpb24ueSAqIHRhZ3MuZmxvYXRpbmdDdXJzb3JEaXN0YW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgejogcG9pbnRlclBvc2l0aW9uLnogKyBwb2ludGVyRGlyZWN0aW9uLnogKiB0YWdzLmZsb2F0aW5nQ3Vyc29yRGlzdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBwb2ludGVyVHlwZTogcG9pbnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGZsb2F0aW5nUG9pbnQsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjb25zdCBjdXJzb3JzOiBBQlVzZXJQcmVzZW5jZUN1cnNvckRhdGFbXSA9IFtdOwoKICAgICAgICBpZiAobWFza3MuaW5YUikgewogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MubGVmdFBvaW50ZXJQb3J0YWwgPT09IHBvcnRhbCkgewogICAgICAgICAgICAgICAgY3Vyc29ycy5wdXNoKGF3YWl0IGdlbmVyYXRlUG9pbnRlckN1cnNvckRhdGEoJ2xlZnQnKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5yaWdodFBvaW50ZXJQb3J0YWwgPT09IHBvcnRhbCkgewogICAgICAgICAgICAgICAgY3Vyc29ycy5wdXNoKGF3YWl0IGdlbmVyYXRlUG9pbnRlckN1cnNvckRhdGEoJ3JpZ2h0JykpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCF0aGlzQm90LmlzVXNpbmdUb3VjaCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MubW91c2VQb2ludGVyUG9ydGFsID09PSBwb3J0YWwpIHsKICAgICAgICAgICAgICAgICAgICBjdXJzb3JzLnB1c2goYXdhaXQgZ2VuZXJhdGVQb2ludGVyQ3Vyc29yRGF0YSgnbW91c2UnKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaWdub3JpbmcgJ21vdXNlJyBjdXJzb3IgZGF0YSwgdG91Y2ggaXMgdGhlIGlucHV0IGJlaW5nIHVzZWQuYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEFkZCBhbnkgY3Vyc29ycyBpbiB0aGUgY3VycmVudCBkaW1lbnNpb24gZnJvbSB0aGUgZXh0ZXJuYWwgcXVldWUgaW50byB0aGUgb3V0Z29pbmcgcHJlc2VuY2UgZGF0YS4KICAgICAgICBpZiAoY3Vyc29yUXVldWUgJiYgY3Vyc29yUXVldWUubGVuZ3RoID4gMCkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gY3Vyc29yUXVldWUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIGlmIChjdXJzb3JRdWV1ZVtpXS5kaW1lbnNpb24gPT09IGRpbWVuc2lvbikgewogICAgICAgICAgICAgICAgICAgIGN1cnNvcnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBjdXJzb3JRdWV1ZVtpXS5wb2ludGVyVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGN1cnNvclF1ZXVlW2ldLnBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgICAgIGN1cnNvclF1ZXVlLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGN1cnNvcnMubGVuZ3RoKSB7CiAgICAgICAgICAgIHByZXNlbmNlRGF0YS5jdXJzb3JzID0gY3Vyc29yczsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHByZXNlbmNlRGF0YS5jYW1lcmEgfHwgKHByZXNlbmNlRGF0YS5jdXJzb3JzICYmIHByZXNlbmNlRGF0YS5jdXJzb3JzLmxlbmd0aCA+IDApKSB7CiAgICAgICAgcmV0dXJuIHByZXNlbmNlRGF0YTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cn0KCi8vIE1hcCBwb3J0YWwgc2l0cyBvbiB0b3AgdGhlIGdyaWQgcG9ydGFsIHNvIG9ubHkgc2VuZCBtYXAgcG9ydGFsIGNhbWVyYSBpZiBpdHMgZW5hYmxlZC4KaWYgKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCkgewogICAgY29uc3QgcHJlc2VuY2VEYXRhID0gYXdhaXQgdHJ5R2VuZXJhdGVQcmVzZW5jZURhdGFGb3JQb3J0YWwoJ21hcCcpOwogICAgaWYgKHByZXNlbmNlRGF0YSkgewogICAgICAgIHByZXNlbmNlRGF0YVRvRW1pdC5wdXNoKHByZXNlbmNlRGF0YSk7CiAgICB9Cn0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCkgewogICAgY29uc3QgcHJlc2VuY2VEYXRhID0gYXdhaXQgdHJ5R2VuZXJhdGVQcmVzZW5jZURhdGFGb3JQb3J0YWwoJ2dyaWQnKTsKICAgIGlmIChwcmVzZW5jZURhdGEpIHsKICAgICAgICBwcmVzZW5jZURhdGFUb0VtaXQucHVzaChwcmVzZW5jZURhdGEpOwogICAgfQp9CgovLyBNaW5pIG1hcCBwb3J0YWwgc2l0cyBvbiB0b3AgdGhlIG1pbmkgbWFwIHBvcnRhbCBzbyBvbmx5IHNlbmQgbWluaSBtYXAgcG9ydGFsIGNhbWVyYSBpZiBpdHMgZW5hYmxlZC4KaWYgKGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwpIHsKICAgIGNvbnN0IHByZXNlbmNlRGF0YSA9IGF3YWl0IHRyeUdlbmVyYXRlUHJlc2VuY2VEYXRhRm9yUG9ydGFsKCdtaW5pTWFwJyk7CiAgICBpZiAocHJlc2VuY2VEYXRhKSB7CiAgICAgICAgcHJlc2VuY2VEYXRhVG9FbWl0LnB1c2gocHJlc2VuY2VEYXRhKTsKICAgIH0KfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCkgewogICAgY29uc3QgcHJlc2VuY2VEYXRhID0gYXdhaXQgdHJ5R2VuZXJhdGVQcmVzZW5jZURhdGFGb3JQb3J0YWwoJ21pbmlHcmlkJyk7CiAgICBpZiAocHJlc2VuY2VEYXRhKSB7CiAgICAgICAgcHJlc2VuY2VEYXRhVG9FbWl0LnB1c2gocHJlc2VuY2VEYXRhKTsKICAgIH0KfQoKaWYgKHByZXNlbmNlRGF0YVRvRW1pdC5sZW5ndGggPT09IDApIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpZ25vcmluZyB0aWNrIOKAlCB3YWl0aW5nIHRvIGJlIGluIGEgcG9ydGFsIHdpdGggcHJlc2VuY2UgZGF0YS5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKY29uc3Qgb3RoZXJSZW1vdGVzID0gKGF3YWl0IG9zLnJlbW90ZXMoKSkuZmlsdGVyKGlkID0+IGlkICE9PSBjb25maWdCb3QuaWQpOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gcHJlc2VuY2VEYXRhVG9FbWl0OmAsIHByZXNlbmNlRGF0YVRvRW1pdCwgYG90aGVyUmVtb3RlczpgLCBvdGhlclJlbW90ZXMpOwp9CgppZiAob3RoZXJSZW1vdGVzLmxlbmd0aCA+IDApIHsKICAgIHNlbmRSZW1vdGVEYXRhKG90aGVyUmVtb3RlcywgJ2FiX3VzZXJfcHJlc2VuY2VfZGF0YScsIHByZXNlbmNlRGF0YVRvRW1pdCk7Cn0nAIybnNgB0QEMaXNVc2luZ1RvdWNoAgQAjJuc2AHSR4ABQGlmIChjb25maWdCb3QpIHsKICAgIHJldHVybiBjb25maWdCb3QucmF3Wyd0b3VjaF8wJ10gPT09IG51bGwgfHwgISFjb25maWdCb3QucmF3Wyd0b3VjaF8wJ10gICAKfSBlbHNlIHsKICAgIHJldHVybiB1bmRlZmluZWQ7Cn0nAIybnNgB0QELb25HcmlkQ2xpY2sCBACMm5zYAdNIqQNAaWYgKHRoYXQubW9kYWxpdHkgPT09ICd0b3VjaCcpIHsKICAgIGNvbnN0IGRpbWVuc2lvbiA9IHRoYXQuZGltZW5zaW9uOwogICAgY29uc3QgcG9zaXRpb24gPSB0aGF0LnBvc2l0aW9uOwoKICAgIC8vIEFkZCB0aGlzIHRvdWNoIHRvIHRoZSBjdXJzb3IgcXVldWUgZm9yIHRoZSBuZXh0IHRpY2suCiAgICBjb25zdCBjdXJzb3JRdWV1ZTogQUJVc2VyUHJlc2VuY2VRdWV1ZWRDdXJzb3JEYXRhW10gPSB0aGlzQm90LnZhcnMuY3Vyc29yUXVldWU7CgogICAgY3Vyc29yUXVldWUucHVzaCh7CiAgICAgICAgcG9pbnRlclR5cGU6ICd0b3VjaCcsCiAgICAgICAgZGltZW5zaW9uLAogICAgICAgIHBvc2l0aW9uOiB7IHg6IHBvc2l0aW9uLngsIHk6IHBvc2l0aW9uLnksIHo6IHBvc2l0aW9uLnogfSwKICAgIH0pCgogICAgdGhpc0JvdC5vblRpY2soKTsKfScAjJuc2AHRAQxvbkJvdENoYW5nZWQCBACMm5zYAf1L8gJAaWYgKHRoYXQudGFncy5pbmNsdWRlcygndGlja0ludGVydmFsTVMnKSkgewogICAgdGhpc0JvdC5zdG9wVGljaygpOwoKICAgIGlmIChvcy5pc0NvbGxhYm9yYXRpdmUoKSAmJiB0aGlzQm90LmdldFByZXNlbmNlRW5hYmxlZCgpKSB7CiAgICAgICAgdGhpc0JvdC5zdGFydFRpY2soKTsKICAgIH0KfSBlbHNlIGlmICh0aGF0LnRhZ3Muc29tZSgodCkgPT4gdCA9PT0gJ2N1cnNvckVuYWJsZWQnIHx8IHQgPT09ICdjYW1lcmFFbmFibGVkJykpIHsKICAgIGlmICh0aGlzQm90LmdldFByZXNlbmNlRW5hYmxlZCgpKSB7CiAgICAgICAgdGhpc0JvdC5zdGFydFRpY2soKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc0JvdC5zdG9wVGljaygpOwogICAgfQp9JwCMm5zYAdEBDG9uUmVtb3RlRGF0YQIEAIybnNgB8E75A0BpZiAoIXRoaXNCb3QuZ2V0UHJlc2VuY2VFbmFibGVkKCkpIHsKICAgIHJldHVybjsKfQoKaWYgKHRoYXQubmFtZSA9PT0gJ2FiX3VzZXJfcHJlc2VuY2VfZGF0YScpIHsKICAgIGNvbnN0IGRhdGE6IEFCVXNlclByZXNlbmNlRGF0YSB8IEFCVXNlclByZXNlbmNlRGF0YVtdID0gdGhhdC50aGF0OwoKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBhYl91c2VyX3ByZXNlbmNlX2RhdGEgZGF0YTpgLCBkYXRhKTsKICAgIH0KCiAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0aGlzQm90Lm9uQUJVc2VyUHJlc2VuY2VEYXRhUmVjZWl2ZWQoZGF0YVtpXSk7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90Lm9uQUJVc2VyUHJlc2VuY2VEYXRhUmVjZWl2ZWQoZGF0YSk7CiAgICB9Cn0nAIybnNgB0QEFdHlwZXMCBACMm5zYAepS1Qrwn5OEaW50ZXJmYWNlIEFCVXNlclByZXNlbmNlRGF0YSB7CiAgICAvKiogUmVtb3RlIGlkIG9mIHRoZSB1c2VyIHRoZSBwcmVzZW5jZSBkYXRhIGlzIGZvci4gKi8KICAgIHJlbW90ZUlkOiBzdHJpbmc7CgogICAgLyoqIENhbiBlaXRoZXIgYmUgdXNlcidzIGRpc3BsYXkgbmFtZSBvciBhIHNob3J0ZW5lZCBsb2NhbCB1c2VyIGlkLiAqKi8KICAgIHJlbW90ZU5hbWU6IHN0cmluZzsKCiAgICAvKiogUG9ydGFsIHRoYXQgdGhlIHByZXNlbmNlIGRhdGEgaXMgZm9yLiAqLwogICAgcG9ydGFsOiBzdHJpbmc7CgogICAgLyoqIERpbWVuc2lvbiB0aGF0IHRoZSBwcmVzZW5jZSBkYXRhIGlzIGZvci4gKiovCiAgICBkaW1lbnNpb246IHN0cmluZzsKCiAgICAvKiogQ29sb3Igb2YgdGhlIHVzZXIuICovCiAgICBjb2xvcjogc3RyaW5nOwoKICAgIGNhbWVyYT86IEFCVXNlclByZXNlbmNlQ2FtZXJhRGF0YTsKICAgIGN1cnNvcnM/OiBBQlVzZXJQcmVzZW5jZUN1cnNvckRhdGFbXTsKfQoKaW50ZXJmYWNlIEFCVXNlclByZXNlbmNlQ2FtZXJhRGF0YSB7CiAgICAvKiogVHlwZSBvZiB0aGUgY2FtZXJhIHRoYXQgdGhlIGRhdGEgaXMgZm9yLiAqLwogICAgY2FtZXJhVHlwZTogJ3BlcnNwZWN0aXZlJyB8ICdvcnRob2dyYXBoaWMnOwogICAgCiAgICAvKiogVGhlIHBvc2l0aW9uIG9mIHRoZSBjYW1lcmEuICoqLwogICAgcG9zaXRpb246IHsgeDogbnVtYmVyLCB5OiBudW1iZXIsIHo6IG51bWJlciB9OwoKICAgIC8qKiBUaGUgcm90YXRpb24gcXVhdGVybmlvbiBvZiB0aGUgY2FtZXJhLiAqKi8KICAgIHF1YXRlcm5pb246IHsgeDogbnVtYmVyLCB5OiBudW1iZXIsIHo6IG51bWJlciwgdzogbnVtYmVyIH07CgogICAgLyoqIFRoZSB6b29tIHZsYXVlIHRoYXQgdGhlIGNhbWVyYSBpcyBhdC4gVGhpcyBpcyBvbmx5IHJlbGV2YW50IGZvciBvcnRob2dyYXBoaWMgY2FtZXJhcy4gKi8KICAgIHpvb20/OiBudW1iZXI7Cn0KCmludGVyZmFjZSBBQlVzZXJQcmVzZW5jZUN1cnNvckRhdGEgewogICAgLyoqIFRoZSB0eXBlIG9mIHRoZSBwb2ludGVyIHRoYXQgdGhlIGRhdGEgaXMgZm9yLiAqLwogICAgcG9pbnRlclR5cGU6ICdtb3VzZScgfCAnbGVmdCcgfCAncmlnaHQnIHwgJ3RvdWNoJzsKICAgIAogICAgLyoqIFRoZSBwb3NpdGlvbiBvZiB0aGUgY3Vyc29yLiAqKi8KICAgIHBvc2l0aW9uOiB7IHg6IG51bWJlciwgeTogbnVtYmVyLCB6OiBudW1iZXIgfTsKfQoKaW50ZXJmYWNlIEFCVXNlclByZXNlbmNlUXVldWVkQ3Vyc29yRGF0YSBleHRlbmRzIEFCVXNlclByZXNlbmNlQ3Vyc29yRGF0YSB7CiAgICAvKiogVGhlIGRpbWVuc2lvbiB0aGF0IHRoaXMgY3Vyc29yIGlzIGluLiAqLwogICAgZGltZW5zaW9uOiBzdHJpbmc7Cn0nAIybnNgB0QESY2FtZXJhQm90VGltZW91dE1TAgQAjJuc2AG+XQQzMDAwJwCMm5zYAdEBC2ludGVycG9sYXRlAgQAjJuc2AHDXQR0cnVlJwCMm5zYAdEBBnRpY2tlcgIEAIybnNgByF0o8J+UlzVjMTliYzlmLWM2OGQtNDNjNy1iZTM0LTM2MDIxZjdlNGRkMycAjJuc2AHRAQ5nZXRSZW1vdGVDb2xvcgIEAIybnNgB713NAUBpZiAoIW1hc2tzLnJlbW90ZUNvbG9yKSB7CiAgICBtYXRoLnNldFJhbmRvbVNlZWQoY29uZmlnQm90LmlkKTsKICAgIG1hc2tzLnJlbW90ZUNvbG9yID0gYHJnYigke21hdGgucmFuZG9tSW50KDAsIDI1NSl9LCAke21hdGgucmFuZG9tSW50KDAsIDI1NSl9LCAke21hdGgucmFuZG9tSW50KDAsIDI1NSl9KWA7Cn0KCnJldHVybiBtYXNrcy5yZW1vdGVDb2xvcjsnAIybnNgB0QENZ2V0UmVtb3RlTmFtZQIEAIybnNgBvV/PAkAvLyBUaGUgbmFtZSB0aGF0IHRoaXMgcmVtb3RlIGlzIHRvIGJlIGtub3duIGFzIHRvIG90aGVyIHVzZXJzLgpsZXQgcmVtb3RlTmFtZTsKCmlmIChhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWUpIHsKICAgIHJlbW90ZU5hbWUgPSBhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWU7Cn0gZWxzZSBpZiAoYXV0aEJvdCAmJiBhdXRoQm90LnRhZ3MubmFtZSkgewogICAgcmVtb3RlTmFtZSA9IGF1dGhCb3QudGFncy5uYW1lOwp9IGVsc2UgewogICAgcmVtb3RlTmFtZSA9IGNvbmZpZ0JvdC5pZC5zdWJzdHJpbmcoMCw1KTsKfQoKcmV0dXJuIHJlbW90ZU5hbWU7JwCMm5zYAdEBEmN1cnNvckJvdFRpbWVvdXRNUwIEAIybnNgBjWIEMzAwMCcAjJuc2AHRAQ1jYW1lcmFFbmFibGVkAgQAjJuc2AGSYgVmYWxzZScAjJuc2AHRAQ1jdXJzb3JFbmFibGVkAgQAjJuc2AGYYgVmYWxzZScAjJuc2AHRARJnZXRQcmVzZW5jZUVuYWJsZWQCBACMm5zYAZ5iMUByZXR1cm4gdGFncy5jdXJzb3JFbmFibGVkIHx8IHRhZ3MuY2FtZXJhRW5hYmxlZDsnAIybnNgB0QEcb25BQlVzZXJQcmVzZW5jZURhdGFSZWNlaXZlZAIEAIybnNgB0GLbogFAY29uc3QgcHJlc2VuY2VEYXRhOiBBQlVzZXJQcmVzZW5jZURhdGEgPSB0aGF0OwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gcHJlc2VuY2VEYXRhOmAsIHByZXNlbmNlRGF0YSkKfQoKaWYgKHByZXNlbmNlRGF0YS5jYW1lcmEpIHsKICAgIGNvbnN0IHNob3V0UmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChzaG91dCgnb25BQlVzZXJDYW1lcmFVcGRhdGUnLCBwcmVzZW5jZURhdGEpKTsKICAgIGNvbnN0IGNhbWVyYVVwZGF0ZWQgPSBzaG91dFJlc3VsdHMubGVuZ3RoID4gMCAmJiBzaG91dFJlc3VsdHMuc29tZShyID0+IHIudmFsdWUgPT09IHRydWUpOwogICAgCiAgICBpZiAoIWNhbWVyYVVwZGF0ZWQpIHsKICAgICAgICAvLyBUaGVyZSB3YXMgbm8gdXNlciBjYW1lcmEgdGhhdCBhY2NlcHRlZCB0aGUgdXBkYXRlLCBuZWVkIHRvIGNyZWF0ZSBhIG5ldyBvbmUuCgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWFrZSB1c2VyIGNhbWVyYTpgLCBwcmVzZW5jZURhdGEpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgdXNlckNhbWVyYUJvdCA9IGNyZWF0ZSh7CiAgICAgICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgICAgICAgICAgYWJCb3Q6IHRydWUsCiAgICAgICAgICAgIGFiVXNlckNhbWVyYTogdHJ1ZSwKICAgICAgICAgICAgbWFuYWdlcjogZ2V0TGluayh0aGlzQm90KSwKICAgICAgICAgICAgZm9ybTogJ2ZydXN0dW0nLAogICAgICAgICAgICBhbmNob3JQb2ludDogJ2NlbnRlcicsCiAgICAgICAgICAgIHJlbW90ZUlkOiBwcmVzZW5jZURhdGEucmVtb3RlSWQsCiAgICAgICAgICAgIHJlbW90ZU5hbWU6IHByZXNlbmNlRGF0YS5yZW1vdGVOYW1lLAogICAgICAgICAgICBwb3J0YWw6IHByZXNlbmNlRGF0YS5wb3J0YWwsCiAgICAgICAgICAgIGRpbWVuc2lvbjogcHJlc2VuY2VEYXRhLmRpbWVuc2lvbiwKICAgICAgICAgICAgW3ByZXNlbmNlRGF0YS5kaW1lbnNpb25dOiB0cnVlLAogICAgICAgICAgICBwb2ludGFibGU6IGZhbHNlLAogICAgICAgICAgICBsYWJlbFBvc2l0aW9uOiAnZmxvYXRpbmdCaWxsYm9hcmQnLAogICAgICAgICAgICBsYWJlbFdvcmRXcmFwTW9kZTogJ25vbmUnLAogICAgICAgICAgICAvLyBsYWJlbFNpemU6IDAuMjgsCiAgICAgICAgICAgIC8vIGxhYmVsU2l6ZU1vZGU6ICdhdXRvJywKICAgICAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChsaW5rcy5tYW5hZ2VyLnRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW2FiVXNlckNhbWVyYS4ke3RhZ05hbWV9ICgke3RhZ3MucmVtb3RlTmFtZX0pXWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgb25BQlVzZXJDYW1lcmFVcGRhdGU6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZXNlbmNlRGF0YTogQUJVc2VyUHJlc2VuY2VEYXRhID0gdGhhdDsKCiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgaW5jb21pbmcgdXBkYXRlIGlzIGZvciB0aGlzIGJvdC4KICAgICAgICAgICAgICAgIGlmIChwcmVzZW5jZURhdGEucmVtb3RlSWQgIT09IHRhZ3MucmVtb3RlSWQgfHwKICAgICAgICAgICAgICAgICAgICBwcmVzZW5jZURhdGEucG9ydGFsICE9PSB0YWdzLnBvcnRhbCB8fAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlRGF0YS5kaW1lbnNpb24gIT09IHRhZ3MuZGltZW5zaW9uCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQ2xlYXIgb2xkIHRpbWVvdXQuCiAgICAgICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLnRpbWVvdXRJZCkgewogICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzQm90LnZhcnMudGltZW91dElkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMudGltZW91dElkID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAobGlua3MubWFuYWdlci50YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFthYlVzZXJDYW1lcmEuJHt0YWdOYW1lfSAoJHt0YWdzLnJlbW90ZU5hbWV9KV0gcHJlc2VuY2VEYXRhOmAsIHByZXNlbmNlRGF0YSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZ3MubGFiZWwgIT09IHByZXNlbmNlRGF0YS5yZW1vdGVOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdGFncy5sYWJlbCA9IHByZXNlbmNlRGF0YS5yZW1vdGVOYW1lOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmNvbG9yICE9PSBwcmVzZW5jZURhdGEuY29sb3IpIHsKICAgICAgICAgICAgICAgICAgICB0YWdzLmNvbG9yID0gcHJlc2VuY2VEYXRhLmNvbG9yOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmxhYmVsRmxvYXRpbmdCYWNrZ3JvdW5kQ29sb3IgIT09IHByZXNlbmNlRGF0YS5jb2xvcil7IAogICAgICAgICAgICAgICAgICAgIHRhZ3MubGFiZWxGbG9hdGluZ0JhY2tncm91bmRDb2xvciA9IHByZXNlbmNlRGF0YS5jb2xvcjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjbGFtcDAxKHQ6IG51bWJlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCB0KSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gem9vbVRvVCh6b29tOiBudW1iZXIsIHpvb21NaW46IG51bWJlciwgem9vbU1heDogbnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gdD0wIGF0IHpvb21NaW4sIHQ9MSBhdCB6b29tTWF4CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeiA9IE1hdGgubWF4KHpvb20sIDFlLTYpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBNYXRoLmxvZyh6b29tTWluKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gTWF0aC5sb2coem9vbU1heCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IChNYXRoLmxvZyh6KSAtIGEpIC8gKGIgLSBhKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xhbXAwMSh2KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBsZXJwKGE6IG51bWJlciwgYjogbnVtYmVyLCB0OiBudW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSArIChiIC0gYSkgKiB0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIE9wdGlvbmFsIHNtb290aGluZyBzbyBpdCBkb2VzbuKAmXQgZmVlbCBsaW5lYXIgLyBoYXJzaDoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNtb290aHN0ZXAodDogbnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQgKiB0ICogKDMgLSAyICogdCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gdD0wIGF0IHpvb21NaW4gKHpvb21lZCBvdXQpLCB0PTEgYXQgem9vbU1heCAoem9vbWVkIGluKQogICAgICAgICAgICAgICAgZnVuY3Rpb24gYXBwbHlFYXNlKHQ6IG51bWJlciwgZXhwb25lbnQ6IG51bWJlcikgewogICAgICAgICAgICAgICAgICAgIC8vIGV4cG9uZW50IDwgMSBzbG93cyBkb3duIHRoZSDigJxtb3ZlIGF3YXnigJ0gd2hlbiB6b29taW5nIG91dAogICAgICAgICAgICAgICAgICAgIC8vIChtYWtlcyBjdXJ2ZSBnZW50bGVyIG5lYXIgdD0wKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnBvdyhzbW9vdGhzdGVwKHQpLCBleHBvbmVudCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYXN5bmMgZnVuY3Rpb24gZ2V0Vml6Q2FtZXJhUG9zZSgKICAgICAgICAgICAgICAgICAgICBjYW1lcmFQb3NpdGlvbjogeyB4OiBudW1iZXI7IHk6IG51bWJlcjsgejogbnVtYmVyIH0sCiAgICAgICAgICAgICAgICAgICAgY2FtZXJhUm90YXRpb246IHsgeDogbnVtYmVyOyB5OiBudW1iZXI7IHo6IG51bWJlcjsgdzogbnVtYmVyIH0sCiAgICAgICAgICAgICAgICAgICAgY2FtZXJhVHlwZTogJ29ydGhvZ3JhcGhpYycgfCAncGVyc3BlY3RpdmUnLAogICAgICAgICAgICAgICAgICAgIGNhbWVyYVpvb206IG51bWJlciB8IG51bGwgfCB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgem9vbU1pbiA9IDAuNCwKICAgICAgICAgICAgICAgICAgICB6b29tTWF4ID0gODAsCiAgICAgICAgICAgICAgICAgICAgZmFyRGlzdCA9IDMwLAogICAgICAgICAgICAgICAgICAgIG5lYXJEaXN0ID0gMiwKICAgICAgICAgICAgICAgICAgICBleHBvbmVudCA9IDAuNSwKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IG5ldyBWZWN0b3IzKGNhbWVyYVBvc2l0aW9uLngsIGNhbWVyYVBvc2l0aW9uLnksIGNhbWVyYVBvc2l0aW9uLnopOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxldCByb3Q7CiAgICAgICAgICAgICAgICAgICAgaWYgKChjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uIHx8IGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSAmJiBjYW1lcmFUeXBlID09PSAncGVyc3BlY3RpdmUnKSB7IAogICAgICAgICAgICAgICAgICAgICAgICByb3QgPSBhd2FpdCBhYi5saW5rcy51dGlscy5jYWxjTWFwUm90YXRpb24oeyBtYXBQb3NpdGlvbjogY2FtZXJhUG9zaXRpb24sIGF1eFJvdGF0aW9uOiBuZXcgUm90YXRpb24oeyBxdWF0ZXJuaW9uOiBjYW1lcmFSb3RhdGlvbiB9KX0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdCA9IG5ldyBSb3RhdGlvbih7IHF1YXRlcm5pb246IGNhbWVyYVJvdGF0aW9uIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9yd2FyZCA9IHJvdC5yb3RhdGVWZWN0b3IzKG5ldyBWZWN0b3IzKDAsIDEsIDApKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbWVyYVR5cGUgPT09ICdwZXJzcGVjdGl2ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgcG9zaXRpb246IHBvcywgcm90YXRpb246IHJvdCB9OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgem9vbSA9IE1hdGgubWF4KGNhbWVyYVpvb20gPz8gMTAsIDFlLTYpOwoKICAgICAgICAgICAgICAgICAgICBsZXQgdCA9IHpvb21Ub1Qoem9vbSwgem9vbU1pbiwgem9vbU1heCk7CiAgICAgICAgICAgICAgICAgICAgdCA9IGFwcGx5RWFzZSh0LCBleHBvbmVudCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBsZXJwKGZhckRpc3QsIG5lYXJEaXN0LCB0KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2aXpQb3MgPSBwb3Muc3VidHJhY3QoZm9yd2FyZC5tdWx0aXBseVNjYWxhcihkKSk7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHBvc2l0aW9uOiB2aXpQb3MsIHJvdGF0aW9uOiByb3QsIGRlYnVnOiB7IHQsIGQsIHpvb20gfSB9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHBvc2UgPSBhd2FpdCBnZXRWaXpDYW1lcmFQb3NlKAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlRGF0YS5jYW1lcmEucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYS5xdWF0ZXJuaW9uLAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlRGF0YS5jYW1lcmEuY2FtZXJhVHlwZSwKICAgICAgICAgICAgICAgICAgICBwcmVzZW5jZURhdGEuY2FtZXJhLnpvb20sCiAgICAgICAgICAgICAgICAgICAgMC40LAogICAgICAgICAgICAgICAgICAgIDgwLAogICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgLTQyNywKICAgICAgICAgICAgICAgICAgICAwLjEsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGNvbnN0IHBvc1RhZ05hbWUgPSB0YWdzLmRpbWVuc2lvbiArICdQb3NpdGlvbic7CiAgICAgICAgICAgICAgICBjb25zdCByb3RUYWdOYW1lID0gdGFncy5kaW1lbnNpb24gKyAnUm90YXRpb24nOwoKICAgICAgICAgICAgICAgIGNsZWFyQW5pbWF0aW9ucyh0aGlzQm90LCBbcG9zVGFnTmFtZSwgcm90VGFnTmFtZV0pOwoKICAgICAgICAgICAgICAgIGlmIChsaW5rcy5tYW5hZ2VyLnRhZ3MuaW50ZXJwb2xhdGUgJiYgdGFnc1twb3NUYWdOYW1lXSAmJiB0YWdzW3JvdFRhZ05hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZVRhZyh0aGlzQm90LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgW3Bvc1RhZ05hbWVdOiB0YWdzW3Bvc1RhZ05hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgW3JvdFRhZ05hbWVdOiB0YWdzW3JvdFRhZ05hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcG9zVGFnTmFtZV06IHBvc2UucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcm90VGFnTmFtZV06IHBvc2Uucm90YXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAobGlua3MubWFuYWdlci50YWdzLnRpY2tJbnRlcnZhbE1TICsgNTApIC8gMTAwMCwKICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1hc2tzW3Bvc1RhZ05hbWVdID0gcG9zZS5wb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICBtYXNrc1tyb3RUYWdOYW1lXSA9IHBvc2Uucm90YXRpb247CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gU2V0IG5ldyB0aW1lb3V0LgogICAgICAgICAgICAgICAgdGhpc0JvdC52YXJzLnRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gZGVzdHJveSh0aGlzQm90KSwgbGlua3MubWFuYWdlci50YWdzLmNhbWVyYUJvdFRpbWVvdXRNUyk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChsaW5rcy5tYW5hZ2VyLnRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW2FiVXNlckNhbWVyYS4ke3RhZ05hbWV9ICgke3RhZ3MucmVtb3RlTmFtZX0pXWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0pCgogICAgICAgIC8vIERpcmVjdGx5IGNhbGwgb25BQlVzZXJDYW1lcmFVcGRhdGUgdGhlIGZpcnN0IHRpbWUgd2UgbWFrZSBhIG5ldyB1c2VyIGNhbWVyYSBib3QuCiAgICAgICAgYXdhaXQgdXNlckNhbWVyYUJvdC5vbkFCVXNlckNhbWVyYVVwZGF0ZShwcmVzZW5jZURhdGEpOwogICAgfQp9CgppZiAocHJlc2VuY2VEYXRhLmN1cnNvcnMgJiYgcHJlc2VuY2VEYXRhLmN1cnNvcnMubGVuZ3RoID4gMCkgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcmVzZW5jZURhdGEuY3Vyc29ycy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IHNob3V0UmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChzaG91dCgnb25BQlVzZXJDdXJzb3JVcGRhdGUnLCB7IHByZXNlbmNlRGF0YSwgY3Vyc29ySW5kZXg6IGkgfSkpOwogICAgICAgIGNvbnN0IGN1cnNvclVwZGF0ZWQgPSBzaG91dFJlc3VsdHMubGVuZ3RoID4gMCAmJiBzaG91dFJlc3VsdHMuc29tZShyID0+IHIudmFsdWUgPT09IHRydWUpOwogICAgICAgIAogICAgICAgIGlmICghY3Vyc29yVXBkYXRlZCkgewogICAgICAgICAgICAvLyBUaGVyZSB3YXMgbm8gdXNlciBjdXJzb3IgdGhhdCBhY2NlcHRlZCB0aGUgdXBkYXRlLCBuZWVkIHRvIGNyZWF0ZSBhIG5ldyBvbmUuCgogICAgICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtYWtlIHVzZXIgY3Vyc29yOmAsIHByZXNlbmNlRGF0YSwgYGN1cnNvcjpgLCBwcmVzZW5jZURhdGEuY3Vyc29yc1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGN1cnNvckJvdCA9IGNyZWF0ZSh7CiAgICAgICAgICAgICAgICBzcGFjZTogJ3RlbXBMb2NhbCcsCiAgICAgICAgICAgICAgICBhYkJvdDogdHJ1ZSwKICAgICAgICAgICAgICAgIGFiVXNlckN1cnNvcjogdHJ1ZSwKICAgICAgICAgICAgICAgIGZvcm06ICdub3RoaW5nJywKICAgICAgICAgICAgICAgIGFuY2hvclBvaW50OiAnY2VudGVyJywKICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uTW9kZTogJ2JpbGxib2FyZCcsCiAgICAgICAgICAgICAgICBwb2ludGFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIG1hbmFnZXI6IGdldExpbmsodGhpc0JvdCksCiAgICAgICAgICAgICAgICByZW1vdGVJZDogcHJlc2VuY2VEYXRhLnJlbW90ZUlkLAogICAgICAgICAgICAgICAgcmVtb3RlTmFtZTogcHJlc2VuY2VEYXRhLnJlbW90ZU5hbWUsCiAgICAgICAgICAgICAgICBwb3J0YWw6IHByZXNlbmNlRGF0YS5wb3J0YWwsCiAgICAgICAgICAgICAgICBwb2ludGVyVHlwZTogcHJlc2VuY2VEYXRhLmN1cnNvcnNbaV0ucG9pbnRlclR5cGUsCiAgICAgICAgICAgICAgICBkaWRJbml0aWFsVXBkYXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgIG9uQ3JlYXRlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW2FiVXNlckN1cnNvci4ke3RhZ05hbWV9ICgke3RhZ3MucmVtb3RlTmFtZX0pXWApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgb25BQlVzZXJDdXJzb3JVcGRhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmVzZW5jZURhdGE6IEFCVXNlclByZXNlbmNlRGF0YSA9IHRoYXQucHJlc2VuY2VEYXRhOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnNvckluZGV4OiBudW1iZXIgPSB0aGF0LmN1cnNvckluZGV4OwoKICAgICAgICAgICAgICAgICAgICBpZiAodGFncy5yZW1vdGVJZCAhPT0gcHJlc2VuY2VEYXRhLnJlbW90ZUlkIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MucG9ydGFsICE9PSBwcmVzZW5jZURhdGEucG9ydGFsIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MucG9pbnRlclR5cGUgIT09IHByZXNlbmNlRGF0YS5jdXJzb3JzW2N1cnNvckluZGV4XS5wb2ludGVyVHlwZSB8fAogICAgICAgICAgICAgICAgICAgICAgICAodGFncy5wb2ludGVyVHlwZSA9PT0gJ3RvdWNoJyAmJiB0YWdzLmRpZEluaXRpYWxVcGRhdGUpIC8vIEFsd2F5cyBsZXQgdG91Y2ggY3Vyc29ycyBkaWUuCiAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgdXBkYXRlIGlzIG5vdCBmb3IgdGhpcyBjdXJzb3IuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChsaW5rcy5tYW5hZ2VyLnRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2N1cnNvciAnICsgdGhpc0JvdC5pZC5zdWJzdHJpbmcoMCw1KSArICcgdXBkYXRlJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVBvc2l0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGltZW5zaW9uOiBwcmVzZW5jZURhdGEuZGltZW5zaW9uLAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcHJlc2VuY2VEYXRhLmN1cnNvcnNbY3Vyc29ySW5kZXhdLnBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnVwZGF0ZUNvbG9yKHsgY29sb3I6IHByZXNlbmNlRGF0YS5jb2xvciB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnVwZGF0ZU5hbWUoeyBuYW1lOiBwcmVzZW5jZURhdGEucmVtb3RlTmFtZSB9KTsKCiAgICAgICAgICAgICAgICAgICAgdGhpc0JvdC5yZXNldFRpbWVvdXQoKTsKCiAgICAgICAgICAgICAgICAgICAgdGFncy5kaWRJbml0aWFsVXBkYXRlID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIG9uR3JpZFBvcnRhbENhbWVyYUNoYW5nZWQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnVwZGF0ZVNjYWxlKCk7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIG9uQm90Q2hhbmdlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LnRhZ3Muc29tZSgodCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5lbmRzV2l0aCgnWCcpIHx8IHQuZW5kc1dpdGgoJ1knKSB8fCB0LmVuZHNXaXRoKCdaJyk7CiAgICAgICAgICAgICAgICAgICAgfSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3Vyc29yIHBvc2l0aW9uIGNoYW5nZWQuCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlU2NhbGUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHVwZGF0ZVBvc2l0aW9uOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBkaW1lbnNpb24sIHBvc2l0aW9uIH0gPSB0aGF0OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICh0YWdzLmRpbWVuc2lvbiAhPT0gZGltZW5zaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERpbWVuc2lvbiBoYXMgY2hhbmdlZC4gCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFncy5kaW1lbnNpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgY3Vyc29yIGZyb20gdGhlIHByZXZpb3VzIGRpbWVuc2lvbi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIHRhZ3MuZGltZW5zaW9uIF0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua3Muc2hhcGVCb3QudGFnc1sgdGFncy5kaW1lbnNpb24gXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5uYW1lQm90LnRhZ3NbIHRhZ3MuZGltZW5zaW9uIF0gPSBudWxsOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBwb3NpdGlvbiB0YWdzIGZvciBwcmV2aW91cyBkaW1lbnNpb24gYXMgd2VsbC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIHRhZ3MuZGltZW5zaW9uICsgJ1gnIF0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgdGFncy5kaW1lbnNpb24gKyAnWScgXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzWyB0YWdzLmRpbWVuc2lvbiArICdaJyBdID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBjdXJzb3IgdG8gdGhlIGN1cnJlbnQgZGltZW5zaW9uLgogICAgICAgICAgICAgICAgICAgICAgICB0YWdzLmRpbWVuc2lvbiA9IGRpbWVuc2lvbjsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIGRpbWVuc2lvbiBdID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgbGlua3Muc2hhcGVCb3QudGFnc1sgZGltZW5zaW9uIF0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5uYW1lQm90LnRhZ3NbIGRpbWVuc2lvbiBdID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpbVhUYWcgPSBkaW1lbnNpb24gKyAnWCc7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGltWVRhZyA9IGRpbWVuc2lvbiArICdZJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaW1aVGFnID0gZGltZW5zaW9uICsgJ1onOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXZYID0gdGFnc1sgZGltWFRhZyBdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXZZID0gdGFnc1sgZGltWVRhZyBdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXZaID0gdGFnc1sgZGltWlRhZyBdOwoKICAgICAgICAgICAgICAgICAgICBjbGVhckFuaW1hdGlvbnModGhpc0JvdCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChwcmV2WCA9PSBudWxsICYmIHByZXZZID09IG51bGwgJiYgcHJldlogPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBmaXJzdCB0aW1lIHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoaXMgY3Vyc29yIGluIHRoaXMgZGltZW5zaW9uLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBTbmFwIGN1cnNvciB0byB0aGUgcG9zaXRpb24uCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIGRpbVhUYWcgXSA9IHBvc2l0aW9uLng7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIGRpbVlUYWcgXSA9IHBvc2l0aW9uLnk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIGRpbVpUYWcgXSA9IHBvc2l0aW9uLno7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5pbnRlcnBvbGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3Vyc29yIGlzIGFscmVhZHkgcG9zaXRpb25lZCBpbiBkaW1lbnNpb24sIHNtb290aGx5IGFuaW1hdGUgdG8gdGhlIHVwZGF0ZWQgcG9zaXRpb24uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2RpbVhUYWddOiBwcmV2WCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2RpbVlUYWddOiBwcmV2WSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2RpbVpUYWddOiBwcmV2WiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2RpbVhUYWddOiBwb3NpdGlvbi54LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZGltWVRhZ106IHBvc2l0aW9uLnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtkaW1aVGFnXTogcG9zaXRpb24ueiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAobGlua3MubWFuYWdlci50YWdzLnRpY2tJbnRlcnZhbE1TICsgNTApIC8gMTAwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBbmltYXRpb24gY2FuY2VsZWQsIGRvIG5vdGhpbmcuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIGRpbVhUYWcgXSA9IHBvc2l0aW9uLng7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzWyBkaW1ZVGFnIF0gPSBwb3NpdGlvbi55OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltWlRhZyBdID0gcG9zaXRpb24uejsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgdXBkYXRlQ29sb3I6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGNvbG9yIH0gPSB0aGF0OwoKICAgICAgICAgICAgICAgICAgICBpZiAobGlua3Muc2hhcGVCb3QudGFncy5jb2xvciAhPT0gY29sb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGlua3Muc2hhcGVCb3QudGFncy5jb2xvciA9IGNvbG9yOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmtzLm5hbWVCb3QudGFncy5jb2xvciAhPT0gY29sb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGlua3MubmFtZUJvdC50YWdzLmNvbG9yID0gY29sb3I7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB1cGRhdGVOYW1lOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSB0aGF0OwoKICAgICAgICAgICAgICAgICAgICBpZiAobGlua3MubmFtZUJvdC50YWdzLmxhYmVsICE9PSBuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtzLm5hbWVCb3QudGFncy5sYWJlbCA9IG5hbWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB1cGRhdGVTY2FsZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnN0YW50U2NhbGUgPSBsaW5rcy5tYW5hZ2VyLnRhZ3MuY3Vyc29yQ29uc3RhbnRTY2FsZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpblhSID0gbGlua3MubWFuYWdlci50YWdzLmluWFI7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGluWFIgfHwKICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENhbWVyYVR5cGUgPT09ICdwZXJzcGVjdGl2ZScKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGVyc3BlY3RpdmUgc2NhbGUKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FtZXJhUG9zaXRpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiBncmlkUG9ydGFsQm90LnRhZ3MuY2FtZXJhUG9zaXRpb25YID8/IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBncmlkUG9ydGFsQm90LnRhZ3MuY2FtZXJhUG9zaXRpb25ZID8/IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6OiBncmlkUG9ydGFsQm90LnRhZ3MuY2FtZXJhUG9zaXRpb25aID8/IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBUaGlzIHdpbGwgYnJlYWsgd2hlbiB0aGUgY3Vyc29yIGlzIGluIGEgZGltZW5zaW9uIGJlaW5nIGRpc3BsYXllZCBieSBhIHBvcnRhbCBib3QuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBmaXggaXMgdG8gY2FsY3VsYXRlIHRoZSB3b3JsZCBwb3NpdGlvbiBvZiB0aGUgYm90LCBidXQgZm9yIG5vdyBpbSBnb2luZyB0byBza2lwLgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJzb3JQb3NpdGlvbiA9IHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiB0YWdzWyB0YWdzLmRpbWVuc2lvbiArICdYJyBdID8/IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiB0YWdzWyB0YWdzLmRpbWVuc2lvbiArICdZJyBdID8/IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6OiB0YWdzWyB0YWdzLmRpbWVuc2lvbiArICdaJyBdID8/IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IG1hdGgudmVjdG9yTGVuZ3RoKCBtYXRoLnN1YnRyYWN0VmVjdG9ycyhjYW1lcmFQb3NpdGlvbiwgY3Vyc29yUG9zaXRpb24pICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluaXRpYWxEaXN0YW5jZSA9IGxpbmtzLm1hbmFnZXIudGFncy5jdXJzb3JJbml0aWFsRGlzdGFuY2U7CgogICAgICAgICAgICAgICAgICAgICAgICB0YWdzLnNjYWxlID0gKGRpc3RhbmNlIC8gaW5pdGlhbERpc3RhbmNlKSAqIGNvbnN0YW50U2NhbGU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gb3J0aG9ncmFwaGljIHNjYWxlCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3Muc2NhbGUgPSBjb25zdGFudFNjYWxlIC8gZ3JpZFBvcnRhbEJvdC50YWdzLmNhbWVyYVpvb207CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAodGFncy50aW1lb3V0SWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRhZ3MudGltZW91dElkKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy50aW1lb3V0SWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgcmVzZXRUaW1lb3V0OiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpc0JvdC5jbGVhclRpbWVvdXQoKTsKCiAgICAgICAgICAgICAgICAgICAgdGFncy50aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2N1cnNvciAnICsgdGhpc0JvdC5pZC5zdWJzdHJpbmcoMCw1KSArICcgaGFzIHRpbWVkIG91dCcpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgICAgICAgICAgICAgIH0sIGxpbmtzLm1hbmFnZXIudGFncy5jdXJzb3JCb3RUaW1lb3V0TVMpOwogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBvbkRlc3Ryb3k6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LmNsZWFyVGltZW91dCgpOwoKICAgICAgICAgICAgICAgICAgICBkZXN0cm95KFsKICAgICAgICAgICAgICAgICAgICAgICAgbGlua3Muc2hhcGVCb3QsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtzLm5hbWVCb3QsCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIGNvbnN0IHNoYXBlQm90ID0gY3JlYXRlKHsKICAgICAgICAgICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgICAgICAgICAgICAgIGFiQm90OiB0cnVlLAogICAgICAgICAgICAgICAgYWJVc2VyQ3Vyc29yOiB0cnVlLAogICAgICAgICAgICAgICAgZm9ybURlcHRoVGVzdDogZmFsc2UsCiAgICAgICAgICAgICAgICBmb3JtRGVwdGhXcml0ZTogZmFsc2UsCiAgICAgICAgICAgICAgICBmb3JtUmVuZGVyT3JkZXI6IDk5OTk5LAogICAgICAgICAgICAgICAgcm90YXRpb25YT2Zmc2V0OiAwLAogICAgICAgICAgICAgICAgcm90YXRpb25ZT2Zmc2V0OiAwLAogICAgICAgICAgICAgICAgcm90YXRpb25aT2Zmc2V0OiAwLAogICAgICAgICAgICAgICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBzY2FsZTogMC41LAogICAgICAgICAgICAgICAgdHJhbnNmb3JtZXI6IGN1cnNvckJvdC50YWdzLmlkLAogICAgICAgICAgICAgICAgY3Vyc29yQm90OiBnZXRMaW5rKGN1cnNvckJvdCksCiAgICAgICAgICAgICAgICBtYW5hZ2VyOiBnZXRMaW5rKHRoaXNCb3QpLAogICAgICAgICAgICAgICAgb25Cb3RBZGRlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChsaW5rcy5jdXJzb3JCb3QudGFncy5wb2ludGVyVHlwZSA9PT0gJ3RvdWNoJykgewogICAgICAgICAgICAgICAgICAgICAgICB0YWdzLmZvcm0gPSAnc3BoZXJlJzsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5mb3JtT3BhY2l0eSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MuYW5jaG9yUG9pbnQgPSAnY2VudGVyJywKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBsYXkgYSAicGluZyIgYW5pbWF0aW9uIGZvciB0aGUgdG91Y2ggcG9pbnQuCiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGVUYWcodGhpc0JvdCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IHRhZ3Muc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybU9wYWNpdHk6IHRhZ3MuZm9ybU9wYWNpdHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiB0YWdzLnNjYWxlICogMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtT3BhY2l0eTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogKGxpbmtzLm1hbmFnZXIudGFncy5jdXJzb3JCb3RUaW1lb3V0TVMgKiAwLjUpIC8gMTAwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVhc2luZzogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdvdXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzaW51c29pZGFsJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZXN0cm95IHNlbGYgb25jZSBhbmltYXRpb24gZW5kcy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kobGlua3MuY3Vyc29yQm90KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCgpID0+IHt9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0YWdzLmZvcm0gPSAnbWVzaCc7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MuZm9ybVN1YnR5cGUgPSAnZ2x0Zic7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPWxpbmtzLm1hbmFnZXIudGFncy5jdXJzb3JNb2RlbDsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5hbmNob3JQb2ludCA9IFstMC40NSwgMC41LCAwXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY29uc3QgbmFtZUJvdCA9IGNyZWF0ZSh7CiAgICAgICAgICAgICAgICBzcGFjZTogJ3RlbXBMb2NhbCcsCiAgICAgICAgICAgICAgICBhYkJvdDogdHJ1ZSwKICAgICAgICAgICAgICAgIGFiVXNlckN1cnNvcjogdHJ1ZSwKICAgICAgICAgICAgICAgIGZvcm06ICdjdWJlJywKICAgICAgICAgICAgICAgIGZvcm1EZXB0aFRlc3Q6IGZhbHNlLAogICAgICAgICAgICAgICAgZm9ybURlcHRoV3JpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZm9ybVJlbmRlck9yZGVyOiA5OTk5OSwKICAgICAgICAgICAgICAgIGFuY2hvclBvaW50OiBbLTAuNjI1LCAxLjUsIDBdLAogICAgICAgICAgICAgICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBzY2FsZVg6IDMsCiAgICAgICAgICAgICAgICBzY2FsZVk6IDAuNiwKICAgICAgICAgICAgICAgIHNjYWxlWjogMC4xLAogICAgICAgICAgICAgICAgbGFiZWxQYWRkaW5nOiAwLjEsCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lcjogY3Vyc29yQm90LnRhZ3MuaWQsCiAgICAgICAgICAgICAgICBjdXJzb3JCb3Q6IGdldExpbmsoY3Vyc29yQm90KSwKICAgICAgICAgICAgICAgIG1hbmFnZXI6IGdldExpbmsodGhpc0JvdCksCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gR2l2ZSBjdXJzb3IgYm90IGxpbmtzIHRvIGFsbCBvZiB0aGUgY2hpbGQgYm90cyBpdCBuZWVkcyB0byBjb21tdW5pY2F0ZSB3aXRoLgogICAgICAgICAgICBjdXJzb3JCb3QubGlua3Muc2hhcGVCb3QgPSBzaGFwZUJvdC5saW5rOwogICAgICAgICAgICBjdXJzb3JCb3QubGlua3MubmFtZUJvdCA9IG5hbWVCb3QubGluazsKCiAgICAgICAgICAgIC8vIERpcmVjdGx5IGNhbGwgb25BQlVzZXJDdXJzb3JVcGRhdGUgdGhlIGZpcnN0IHRpbWUgd2UgbWFrZSBhIG5ldyB1c2VyIGNhbWVyYSBib3QuCiAgICAgICAgICAgIGF3YWl0IGN1cnNvckJvdC5vbkFCVXNlckN1cnNvclVwZGF0ZSh7IHByZXNlbmNlRGF0YSwgY3Vyc29ySW5kZXg6IGkgfSk7CiAgICAgICAgfQogICAgfQp9JwCMm5zYAdEBEG9uSW5zdFN0cmVhbUxvc3QCBACMm5zYAaaFAmVAaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKdGhpc0JvdC5zdG9wVGljaygpOycAjJuc2AHRAQ9vbkluc3RTdHJlYW1pbmcCBACMm5zYAYyGAogBQGlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7Cn0KCmlmIChvcy5pc0NvbGxhYm9yYXRpdmUoKSkgewogICAgdGhpc0JvdC5zdGFydFRpY2soKTsKfScAjJuc2AHRAQ9vbkFueUJvdENsaWNrZWQCBACMm5zYAZWHAoAPQGlmICh0aGF0Lm1vZGFsaXR5ID09PSAndG91Y2gnKSB7CiAgICBjb25zdCBkaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKCiAgICAvLyBDYXN1YWxPUyBkb2VzIG5vdCByZXBvcnQgdGhlIHBvcnRhbCB0aGF0IHRoZSBjbGljayB0b29rIHBsYWNlIGluLCBtdXN0IGluZmVyIGl0IGggICAgZXJlLgpsZXQgcG9ydGFsOwoKICAgIGlmIChjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPT09IGRpbWVuc2lvbikgewogICAgICAgIHBvcnRhbCA9ICdtYXAnOwogICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09PSBkaW1lbnNpb24pIHsKICAgICAgICBwb3J0YWwgPSAnZ3JpZCc7CiAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPT09IGRpbWVuc2lvbikgewogICAgICAgIHBvcnRhbCA9ICdtaW5pTWFwJzsKICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPT09IGRpbWVuc2lvbikgewogICAgICAgIHBvcnRhbCA9ICdtaW5pR3JpZCc7CiAgICB9CgogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGluZmVycmVkIHBvcnRhbCBmcm9tIGJvdCBjbGljazpgLCBwb3J0YWwpOwogICAgfQoKICAgIGlmIChwb3J0YWwpIHsKICAgICAgICAvLyBEbyBhIHJheWNhc3QgYWdhaW5zdCB0aGUgY3VycmVudCBtb3VzZSBwb3NpdGlvbiBpZiBhIHRvdWNoIHBvaW50ZXIgY2xpY2tlZCBhIGJvdC4KICAgICAgICAvLyBXYXMgYWJsZSB0byB2ZXJpZnkgYXQgdGhlIHRpbWUgb2Ygd3JpdGluZyAoSmFuIDE5LCAyMDI2KSB0aGF0IHRoaXMgb25seSBvY2N1cnMgZm9yIHRvdWNoXzAgc28gaXQgc2hvdWxkIGJlCiAgICAgICAgLy8gc2FmZSB0byB1c2UgQ2FzdWFsT1MncyByZXBvcnRlZCBtb3VzZSBwb3NpdGlvbiBmb3IgdGhpcyBzaW5jZSB3ZSBkb250IGdldCBhIHRvdWNoIHBvc2l0aW9uLgogICAgICAgIGNvbnN0IHBvaW50ZXJQb3NpdGlvbiA9IG9zLmdldFBvaW50ZXJQb3NpdGlvbignbW91c2UnKTsKICAgICAgICBjb25zdCBwb2ludGVyRGlyZWN0aW9uID0gb3MuZ2V0UG9pbnRlckRpcmVjdGlvbignbW91c2UnKTsKICAgICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gYXdhaXQgb3MucmF5Y2FzdChwb3J0YWwsIHBvaW50ZXJQb3NpdGlvbiwgcG9pbnRlckRpcmVjdGlvbik7CgogICAgICAgIGxldCByYXljYXN0SGl0OwoKICAgICAgICBpZiAocmF5Y2FzdFJlc3VsdC5ib3RJbnRlcnNlY3Rpb25zICYmIHJheWNhc3RSZXN1bHQuYm90SW50ZXJzZWN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJheWNhc3RIaXQgPSByYXljYXN0UmVzdWx0LmJvdEludGVyc2VjdGlvbnMuZmluZCgoaCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIGguYm90LnRhZ3MucG9pbnRhYmxlICE9IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJheWNhc3RIaXQpIHsKICAgICAgICAgICAgLy8gQWRkIHRoaXMgdG91Y2ggY2xpY2sgdG8gdGhlIGN1cnNvciBxdWV1ZSBmb3IgdGhlIG5leHQgdGljay4KICAgICAgICAgICAgY29uc3QgY3Vyc29yUXVldWU6IEFCVXNlclByZXNlbmNlUXVldWVkQ3Vyc29yRGF0YVtdID0gdGhpc0JvdC52YXJzLmN1cnNvclF1ZXVlOwoKICAgICAgICAgICAgY3Vyc29yUXVldWUucHVzaCh7CiAgICAgICAgICAgICAgICBwb2ludGVyVHlwZTogJ3RvdWNoJywKICAgICAgICAgICAgICAgIGRpbWVuc2lvbiwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IHJheWNhc3RIaXQucG9pbnQueCwgeTogcmF5Y2FzdEhpdC5wb2ludC55LCB6OiByYXljYXN0SGl0LnBvaW50LnogfSwKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIHRoaXNCb3Qub25UaWNrKCk7CiAgICAgICAgfQogICAgfQp9JwCMm5zYAdEBCW9uRW50ZXJWUgIEAIybnNgBlpYCE0BtYXNrcy5pblhSID0gdHJ1ZTsnAIybnNgB0QEJb25FbnRlckFSAgQAjJuc2AGqlgITQG1hc2tzLmluWFIgPSB0cnVlOycAjJuc2AHRAQhvbkV4aXRBUgIEAIybnNgBvpYCE0BtYXNrcy5pblhSID0gbnVsbDsnAIybnNgB0QEIb25FeGl0VlICBACMm5zYAdKWAhNAbWFza3MuaW5YUiA9IG51bGw7JwCMm5zYAdEBC2N1cnNvck1vZGVsAgQAjJuc2AHmlgLVFmRhdGE6dGV4dC94bWw7YmFzZTY0LFoyeFVSZ0lBQUFCd0NBQUFqQVFBQUVwVFQwNTdJbUZ6YzJWMElqcDdJbWRsYm1WeVlYUnZjaUk2SWt0b2NtOXViM01nWjJ4VVJpQkNiR1Z1WkdWeUlFa3ZUeUIyTXk0MExqVXdJaXdpZG1WeWMybHZiaUk2SWpJdU1DSjlMQ0psZUhSbGJuTnBiMjV6VlhObFpDSTZXeUpMU0ZKZmJXRjBaWEpwWVd4elgzVnViR2wwSWwwc0luTmpaVzVsSWpvd0xDSnpZMlZ1WlhNaU9sdDdJbTVoYldVaU9pSlRZMlZ1WlNJc0ltNXZaR1Z6SWpwYk1GMTlYU3dpYm05a1pYTWlPbHQ3SW0xbGMyZ2lPakFzSW01aGJXVWlPaUpEZFdKbEluMWRMQ0p0WVhSbGNtbGhiSE1pT2x0N0ltVjRkR1Z1YzJsdmJuTWlPbnNpUzBoU1gyMWhkR1Z5YVdGc2MxOTFibXhwZENJNmUzMTlMQ0p1WVcxbElqb2lUV0YwWlhKcFlXd2lMQ0p3WW5KTlpYUmhiR3hwWTFKdmRXZG9ibVZ6Y3lJNmV5SnRaWFJoYkd4cFkwWmhZM1J2Y2lJNk1Dd2ljbTkxWjJodVpYTnpSbUZqZEc5eUlqb3dMamw5ZlYwc0ltMWxjMmhsY3lJNlczc2libUZ0WlNJNklrTjFZbVVpTENKd2NtbHRhWFJwZG1WeklqcGJleUpoZEhSeWFXSjFkR1Z6SWpwN0lsQlBVMGxVU1U5T0lqb3dMQ0pVUlZoRFQwOVNSRjh3SWpveExDSk9UMUpOUVV3aU9qSjlMQ0pwYm1ScFkyVnpJam96TENKdFlYUmxjbWxoYkNJNk1IMWRmVjBzSW1GalkyVnpjMjl5Y3lJNlczc2lZblZtWm1WeVZtbGxkeUk2TUN3aVkyOXRjRzl1Wlc1MFZIbHdaU0k2TlRFeU5pd2lZMjkxYm5RaU9qSTRMQ0p0WVhnaU9sc3hMalE1TWpVMk1UTTBNRE16TWpBek1USXNNQzR3TnpVMU5ESTFNekU1TURjMU5UZzBOQ3d4TGpZd05UY3hNREUwT0RneE1UTTBNRE5kTENKdGFXNGlPbHN4TGpJNU1EUTFNakl3TURreE9UTTRPVGRsTFRBMUxDMHdMakE0TVRNNE56QTBNams1T1RJMk56VTRMRGN1TVRFMU16QTBORGN3TURZeU1qVTJaUzB3Tmwwc0luUjVjR1VpT2lKV1JVTXpJbjBzZXlKaWRXWm1aWEpXYVdWM0lqb3hMQ0pqYjIxd2IyNWxiblJVZVhCbElqbzFNVEkyTENKamIzVnVkQ0k2TWpnc0luUjVjR1VpT2lKV1JVTXlJbjBzZXlKaWRXWm1aWEpXYVdWM0lqb3lMQ0pqYjIxd2IyNWxiblJVZVhCbElqbzFNVEkyTENKamIzVnVkQ0k2TWpnc0luUjVjR1VpT2lKV1JVTXpJbjBzZXlKaWRXWm1aWEpXYVdWM0lqb3pMQ0pqYjIxd2IyNWxiblJVZVhCbElqbzFNVEl6TENKamIzVnVkQ0k2TXpZc0luUjVjR1VpT2lKVFEwRk1RVklpZlYwc0ltSjFabVpsY2xacFpYZHpJanBiZXlKaWRXWm1aWElpT2pBc0ltSjVkR1ZNWlc1bmRHZ2lPak16Tml3aVlubDBaVTltWm5ObGRDSTZNQ3dpZEdGeVoyVjBJam96TkRrMk1uMHNleUppZFdabVpYSWlPakFzSW1KNWRHVk1aVzVuZEdnaU9qSXlOQ3dpWW5sMFpVOW1abk5sZENJNk16TTJMQ0owWVhKblpYUWlPak0wT1RZeWZTeDdJbUoxWm1abGNpSTZNQ3dpWW5sMFpVeGxibWQwYUNJNk16TTJMQ0ppZVhSbFQyWm1jMlYwSWpvMU5qQXNJblJoY21kbGRDSTZNelE1TmpKOUxIc2lZblZtWm1WeUlqb3dMQ0ppZVhSbFRHVnVaM1JvSWpvM01pd2lZbmwwWlU5bVpuTmxkQ0k2T0RrMkxDSjBZWEpuWlhRaU9qTTBPVFl6ZlYwc0ltSjFabVpsY25NaU9sdDdJbUo1ZEdWTVpXNW5kR2dpT2prMk9IMWRmU0RJQXdBQVFrbE9BRUFNdno4SXRwbzlmTkVpUDBBTXZ6OEl0cG85Zk5FaVAwQU12ejhJdHBvOWZORWlQMXdoSHo4QXRwbzkyOUpPUDF3aEh6OEF0cG85MjlKT1Axd2hIejhBdHBvOTI5Sk9QMXdoSHo4QXRwbzkyOUpPUDRDQVdEY0x0cG85QUFEdk5vQ0FXRGNMdHBvOUFBRHZOb0NBV0RjTHRwbzlBQUR2Tm9DQVdEY0x0cG85QUFEdk5uZkpiVDRBdHBvOTZZZk5QM2ZKYlQ0QXRwbzk2WWZOUDNmSmJUNEF0cG85NllmTlAwQU12ejg0cnFhOWZORWlQMEFNdno4NHJxYTlmTkVpUDBBTXZ6ODRycWE5Zk5FaVAxd2hIejg0cnFhOTI5Sk9QMXdoSHo4NHJxYTkyOUpPUDF3aEh6ODRycWE5MjlKT1Axd2hIejg0cnFhOTI5Sk9QNENBV0RjdnJxYTlBTUR1Tm9DQVdEY3ZycWE5QU1EdU5vQ0FXRGN2cnFhOUFNRHVOb0NBV0RjdnJxYTlBTUR1Tm5mSmJUNUFycWE5NllmTlAzZkpiVDVBcnFhOTZZZk5QM2ZKYlQ1QXJxYTk2WWZOUHdBQUlEOEFBSUErQUFBZ1B3QUFnRDRBQUNBL0FBQ0FQZ0FBd0Q0QUFJQStBQURBUGdBQWdENEFBTUErQUFDQVBnQUF3RDRBQUlBK0FBQWdQd0FBQUFBQUFDQS9BQUFBQUFBQUlEOEFBQUFBQUFBZ1B3QUFBQUFBQU1BK0FBQUFBQUFBd0Q0QUFBQUFBQURBUGdBQUFBQUFBQ0EvQUFDQVBnQUFJRDhBQUlBK0FBQWdQd0FBZ0Q0QUFNQStBQUNBUGdBQXdENEFBSUErQUFEQVBnQUFnRDRBQU1BK0FBQ0FQZ0FBSUQ4QUFBQUFBQUFnUHdBQUFBQUFBQ0EvQUFBQUFBQUFJRDhBQUFBQUFBREFQZ0FBQUFBQUFNQStBQUFBQUFBQXdENEFBQUFBOHk4S3N3QUFnRC8zcFE4MHFFWkdQZ0FBQUFDNUozcy93clhJUGgxZmV6U0VnbXUvOHk4S3N3QUFnRC8zcFE4MEVtbkZNLy8vZnovZUhDa3pxRVpHUGdBQUFBQzVKM3MvYWc5bVB3QUFBQURJa3VBK1VsMTl2d0FBQUFCcmpoSSs4eThLc3dBQWdELzNwUTgwRW1uRk0vLy9mei9lSENrendyWElQaDFmZXpTRWdtdS9VbDE5dndBQUFBQnJqaEkrRW1uRk0vLy9mei9lSENremFnOW1Qd0FBQUFESWt1QStFR2xGc2dBQWdMOGV2cHF6cUVaR1BnQUFBQUM1SjNzL3dyWElQaDFmZXpTRWdtdS9xTzBkcy8vL2Y3OWlXYWV6RUdsRnNnQUFnTDhldnBxenFFWkdQZ0FBQUFDNUozcy9hZzltUHdBQUFBRElrdUErVWwxOXZ3QUFBQUJyamhJK3FPMGRzLy8vZjc5aVdhZXpFR2xGc2dBQWdMOGV2cHF6d3JYSVBoMWZlelNFZ211L1VsMTl2d0FBQUFCcmpoSStxTzBkcy8vL2Y3OWlXYWV6YWc5bVB3QUFBQURJa3VBK0JBQUpBQXdBQ0FBREFBQUFFUUFhQUJZQUZ3QU9BQklBQWdBUUFCZ0FBZ0FZQUFvQUJ3QVZBQmtBQndBWkFBc0FEUUFiQUJRQURRQVVBQVlBQlFBVEFBOEFCUUFQQUFFQScAjJuc2AHRARNjdXJzb3JDb25zdGFudFNjYWxlAgQAjJuc2AG8rQIBOCcAjJuc2AHRARVjdXJzb3JJbml0aWFsRGlzdGFuY2UCBACMm5zYAb6tAgMyMjUnAIybnNgB0QEQb25BbnlCb3RzQ2hhbmdlZAIEAIybnNgBwq0C5ghAY29uc3QgZ3JpZFBvcnRhbEJvdEluZGV4ID0gdGhhdC5maW5kSW5kZXgoKGVsKSA9PiB7CiAgICBpZiAoZWwgJiYgZ2xvYmFsVGhpcy5ncmlkUG9ydGFsQm90ICYmIGVsLmJvdCA9PT0gZ3JpZFBvcnRhbEJvdCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9KTsKCmlmIChncmlkUG9ydGFsQm90SW5kZXggPj0gMCkgewogICAgY29uc3QgY2hhbmdlZFRhZ3MgPSB0aGF0W2dyaWRQb3J0YWxCb3RJbmRleF0udGFnczsKICAgIGNvbnN0IGNhbWVyYUNoYW5nZWQgPSBjaGFuZ2VkVGFncy5zb21lKCh0KSA9PiB7CiAgICAgICAgcmV0dXJuIHQgPT09ICdjYW1lcmFQb3NpdGlvblgnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFQb3NpdGlvblknIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFQb3NpdGlvblonIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFQb3NpdGlvbk9mZnNldFgnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFQb3NpdGlvbk9mZnNldFknIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFQb3NpdGlvbk9mZnNldHonIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvblgnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvblknIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvblonIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvbk9mZnNldFgnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvbk9mZnNldFknIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvbk9mZnNldFonIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvbk9mZnNldFcnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFGb2N1c1gnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFGb2N1c1knIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFGb2N1c1onIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFab29tJyB8fAogICAgICAgICAgICB0ID09PSAnY2FtZXJhWm9vbU9mZnNldCc7CiAgICB9KQoKICAgIGlmIChjYW1lcmFDaGFuZ2VkKSB7CiAgICAgICAgc2hvdXQoJ29uR3JpZFBvcnRhbENhbWVyYUNoYW5nZWQnLCB7IGNoYW5nZWRUYWdzIH0pOwogICAgfQp9JwCMm5zYAdEBFmZsb2F0aW5nQ3Vyc29yRGlzdGFuY2UCBACMm5zYAam2AgMwLjcnAIybnNgB0QEJYWJWZXJzaW9uAgQAjJuc2AGttgIFMTAuMzUA"}]}