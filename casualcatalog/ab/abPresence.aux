{"version":2,"updates":[{"id":0,"timestamp":1768937677214,"update":"AV7zoevZDAAnAQRib3RzJDdkM2ExNzAzLTBhMDEtNDY2Yi05NzRmLWFlOWYxMDAxYWM3OAEnAPOh69kMAAZzeXN0ZW0CBADzoevZDAETYWIucHJlc2VuY2UudmVyc2lvbicA86Hr2QwAFmFiUHJlc2VuY2VNaW5vclZlcnNpb24CBADzoevZDBUCMTInAPOh69kMABZhYlByZXNlbmNlTWFqb3JWZXJzaW9uAgQA86Hr2QwYATAnAPOh69kMAAhhYklnbm9yZQIEAPOh69kMGgR0cnVlJwDzoevZDAAKYWJQcmVzZW5jZQIEAPOh69kMHwR0cnVlJwDzoevZDAAEZm9ybQIEAPOh69kMJAdub3RoaW5nJwDzoevZDAANb25Ta2lsbFVwZGF0ZQIEAPOh69kMLJ4BQGNvbnN0IHZlcnNpb25TdHJpbmcgPSB0YWdzLmFiUHJlc2VuY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiUHJlc2VuY2VNaW5vclZlcnNpb247Cgpjb25zb2xlLmxvZygiW0FCUHJlc2VuY2VdIExvYWRlZCBBQiBzaGVsbCB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAPOh69kMAAlhYlZlcnNpb24CBADzoevZDMsBBTEwLjM1JwEEYm90cyQ4N2U5NTM0Mi1lNDU2LTRiNjMtOTg5MS1kN2E5MjFhZDNlZTcBJwDzoevZDNEBBnN5c3RlbQIEAPOh69kM0gETYWIucHJlc2VuY2UubWFuYWdlcicA86Hr2QzRAQphYlByZXNlbmNlAgQA86Hr2QzmAQR0cnVlJwDzoevZDNEBCGFiSWdub3JlAgQA86Hr2QzrAQR0cnVlJwDzoevZDNEBBGZvcm0CBADzoevZDPABB25vdGhpbmcnAPOh69kM0QEKb25Cb3RBZGRlZAIEAPOh69kM+AGFAUAvKiogQHR5cGUgQUJVc2VyUHJlc2VuY2VRdWV1ZWRDdXJzb3JEYXRhW10gKi8KdGhpc0JvdC52YXJzLmN1cnNvclF1ZXVlID0gW107CgppZiAob3MuaXNDb2xsYWJvcmF0aXZlKCkpIHsKICAgIHRoaXNCb3Quc3RhcnRUaWNrKCk7Cn0nAPOh69kM0QEJc3RhcnRUaWNrAgQA86Hr2Qz+ArAFQGlmIChtYXNrcy50aWNrSW50ZXJ2YWxJZCkgewogICAgcmV0dXJuOwp9CgppZiAoIW9zLmlzQ29sbGFib3JhdGl2ZSgpKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2FuY2VsaW5nIHRpY2sgc3RhcnQg4oCUIHRoZSBpbnN0IG11c3QgYmUgY29sbGFib3JhdGl2ZS5gKTsKICAgIH0KCiAgICByZXR1cm47Cn0KCmlmICghdGhpc0JvdC5nZXRQcmVzZW5jZUVuYWJsZWQoKSkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbmNlbGluZyB0aWNrIHN0YXJ0IOKAlCBwcmVzZW5jZSBpcyBkaXNhYmxlZC5gKTsKICAgIH0KCiAgICByZXR1cm47Cn0KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHN0YXJ0IGludGVydmFsYCk7Cn0KCmZ1bmN0aW9uIHRpY2soKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX1dIHRpY2tgKTsKICAgIH0KCiAgICB3aGlzcGVyKHRoaXNCb3QsICdvblRpY2snKTsKfQoKbWFza3MudGlja0ludGVydmFsSWQgPSBzZXRJbnRlcnZhbCh0aWNrLCB0YWdzLnRpY2tJbnRlcnZhbE1TKTsKdGljaygpOycA86Hr2QzRAQhzdG9wVGljawIEAPOh69kMqwjHAUBpZiAobWFza3MudGlja0ludGVydmFsSWQpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzdG9wIGludGVydmFsYCk7CiAgICB9CgogICAgY2xlYXJJbnRlcnZhbChtYXNrcy50aWNrSW50ZXJ2YWxJZCk7CiAgICBtYXNrcy50aWNrSW50ZXJ2YWxJZCA9IG51bGw7Cn0nAPOh69kM0QEOdGlja0ludGVydmFsTVMCBADzoevZDPMJAzMwMCcA86Hr2QzRAQVkZWJ1ZwIEAPOh69kM9wkFZmFsc2UnAPOh69kM0QEGb25UaWNrAgQA86Hr2Qz9CeI9QGlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHN0YXJ0YCk7Cn0KCmlmICghdGhpc0JvdC5nZXRQcmVzZW5jZUVuYWJsZWQoKSkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHByZXNlbmNlIGlzIGRpc2FibGVkLmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAoIWNvbmZpZ0JvdCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgZm9yIGNvbmZpZ0JvdCB0byBiZSByZWFkeS5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKCFnbG9iYWxUaGlzLmFiKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaWdub3JpbmcgdGljayDigJQgd2FpdGluZyBmb3IgYWIgdG8gYmUgcmVhZHkuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCmlmIChjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgdG8gbGVhdmUgc2hlZXQgcG9ydGFsLmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAoY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaWdub3JpbmcgdGljayDigJQgd2FpdGluZyB0byBsZWF2ZSBzeXN0ZW0gcG9ydGFsLmApOwogICAgfQogICAgcmV0dXJuOwp9CgovLyBHZXQgbGlzdCBvZiByZWxldmFudCBwcmVzZW5jZSBkYXRhIGZyb20gcG9ydGFscyAmIGRpbWVuc2lvbnMgdGhhdCB0aGUgdXNlciBpcyBhY3RpdmUgaW4uCmNvbnN0IHByZXNlbmNlRGF0YVRvRW1pdDogQUJVc2VyUHJlc2VuY2VEYXRhW10gPSBbXTsKCi8vIE1ha2UgYSBjb3B5IG9mIHRoZSBjdXJyZW50IGN1cnNvciBxdWV1ZSBhbmQgcmVzZXQgaXQuIEN1cnJlbnQgY3Vyc29yIHF1ZXVlIHdpbGwgYmUgcHJvY2Vzc2VkIGluIHRoaXMgdGljay4KY29uc3QgY3Vyc29yUXVldWU6IEFCVXNlclByZXNlbmNlUXVldWVkQ3Vyc29yRGF0YVtdID0gWy4uLih0aGlzQm90LnZhcnMuY3Vyc29yUXVldWUgPz8gW10pXTsKdGhpc0JvdC52YXJzLmN1cnNvclF1ZXVlID0gW107Cgphc3luYyBmdW5jdGlvbiB0cnlHZW5lcmF0ZVByZXNlbmNlRGF0YUZvclBvcnRhbChwb3J0YWw6IHN0cmluZyk6IEFCVXNlclByZXNlbmNlRGF0YSB8IG51bGwgewogICAgY29uc3QgaW5NYXAgPSBwb3J0YWwgPT09ICdtYXAnIHx8IHBvcnRhbCA9PT0gJ21pbmlNYXAnOwogICAgY29uc3QgZGltZW5zaW9uID0gb3MuZ2V0UG9ydGFsRGltZW5zaW9uKHBvcnRhbCk7CiAgICBjb25zdCBwb3J0YWxCb3QgPSBnbG9iYWxUaGlzW3BvcnRhbCArICdQb3J0YWxCb3QnXTsKCiAgICBpZiAoIXBvcnRhbCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGlmICghZGltZW5zaW9uKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgaWYgKCFwb3J0YWxCb3QpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9LnRyeUdlbmVyYXRlUHJlc2VuY2VEYXRhRm9yUG9ydGFsXSB1bmFibGUgdG8gZmluZCAke3BvcnRhbH0gcG9ydGFsIGJvdC5gKTsKICAgIH0KICAgIAogICAgY29uc3QgcHJlc2VuY2VEYXRhOiBBQlVzZXJQcmVzZW5jZURhdGEgPSB7CiAgICAgICAgcmVtb3RlSWQ6IGNvbmZpZ0JvdC5pZCwKICAgICAgICByZW1vdGVOYW1lOiB0aGlzQm90LmdldFJlbW90ZU5hbWUoKSwKICAgICAgICBwb3J0YWwsCiAgICAgICAgZGltZW5zaW9uLAogICAgICAgIGNvbG9yOiB0aGlzQm90LmdldFJlbW90ZUNvbG9yKCksCiAgICAgICAgY2FtZXJhOiB1bmRlZmluZWQsCiAgICAgICAgY3Vyc29yczogdW5kZWZpbmVkLAogICAgfQoKICAgIGNvbnN0IGNhbWVyYVN1cHBvcnRlZCA9IHBvcnRhbCA9PT0gJ2dyaWQnIHx8IHBvcnRhbCA9PT0gJ21pbmlHcmlkJyB8fCBwb3J0YWwgPT09ICdtYXAnIHx8IHBvcnRhbCA9PT0gJ21pbmlNYXAnOwoKICAgIGlmICh0YWdzLmNhbWVyYUVuYWJsZWQgJiYgY2FtZXJhU3VwcG9ydGVkKSB7CiAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYSA9IHsKICAgICAgICAgICAgY2FtZXJhVHlwZTogaW5NYXAgPyAncGVyc3BlY3RpdmUnIDogKHBvcnRhbEJvdC50YWdzLnBvcnRhbENhbWVyYVR5cGUgPz8gJ29ydGhvZ3JhcGhpYycpLAogICAgICAgICAgICBwb3NpdGlvbjogaW5NYXAgPyBwb3J0YWxCb3QudGFncy5jYW1lcmFNYXBQb3NpdGlvbiA6IHBvcnRhbEJvdC50YWdzLmNhbWVyYVBvc2l0aW9uLAogICAgICAgICAgICBxdWF0ZXJuaW9uOiBwb3J0YWxCb3QudGFncy5jYW1lcmFSb3RhdGlvbi5xdWF0ZXJuaW9uLAogICAgICAgICAgICB6b29tOiBwb3J0YWxCb3QudGFncy5jYW1lcmFab29tLAogICAgICAgIH07CiAgICB9CgogICAgY29uc3QgY3Vyc29yU3VwcG9ydGVkID0gcG9ydGFsID09PSAnZ3JpZCcgfHwgcG9ydGFsID09PSAnbWluaUdyaWQnOwoKICAgIGlmICh0YWdzLmN1cnNvckVuYWJsZWQgJiYgY3Vyc29yU3VwcG9ydGVkKSB7CiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVQb2ludGVyQ3Vyc29yRGF0YShwb2ludGVyOiAnbW91c2UnIHwgJ2xlZnQnIHwgJ3JpZ2h0Jyk6IEFCVXNlclByZXNlbmNlQ3Vyc29yRGF0YSB7CiAgICAgICAgICAgIGNvbnN0IHBvaW50ZXJQb3NpdGlvbiA9IG9zLmdldFBvaW50ZXJQb3NpdGlvbihwb2ludGVyKTsKICAgICAgICAgICAgY29uc3QgcG9pbnRlckRpcmVjdGlvbiA9IG9zLmdldFBvaW50ZXJEaXJlY3Rpb24ocG9pbnRlcik7CiAgICAgICAgICAgIGNvbnN0IHJheWNhc3RSZXN1bHQgPSBhd2FpdCBvcy5yYXljYXN0KHBvcnRhbCwgcG9pbnRlclBvc2l0aW9uLCBwb2ludGVyRGlyZWN0aW9uKTsKCiAgICAgICAgICAgIGxldCByYXljYXN0SGl0OwoKICAgICAgICAgICAgaWYgKHJheWNhc3RSZXN1bHQuYm90SW50ZXJzZWN0aW9ucyAmJiByYXljYXN0UmVzdWx0LmJvdEludGVyc2VjdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgcmF5Y2FzdEhpdCA9IHJheWNhc3RSZXN1bHQuYm90SW50ZXJzZWN0aW9ucy5maW5kKChoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGguYm90LnRhZ3MucG9pbnRhYmxlICE9IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJheWNhc3RIaXQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRlclR5cGU6IHBvaW50ZXIsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsgeDogcmF5Y2FzdEhpdC5wb2ludC54LCB5OiByYXljYXN0SGl0LnBvaW50LnksIHo6IHJheWNhc3RIaXQucG9pbnQueiB9LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRGlkbid0IGhpdCBhbnkgYm90cy4KICAgICAgICAgICAgICAgIC8vIFRyeSB0ZXN0aW5nIGFnYWluc3QgdGhlIGdyb3VuZCBwbGFuZS4KICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VuZFBvaW50ID0gbWF0aC5pbnRlcnNlY3RQbGFuZShwb2ludGVyUG9zaXRpb24sIHBvaW50ZXJEaXJlY3Rpb24pOwoKICAgICAgICAgICAgICAgIGlmIChncm91bmRQb2ludCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRlclR5cGU6IHBvaW50ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IGdyb3VuZFBvaW50LngsIHk6IGdyb3VuZFBvaW50LnksIHo6IGdyb3VuZFBvaW50LnogfSwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE5vdCBpbnRlcnNlY3Rpbmcgd2l0aCBhbnl0aGluZyByaWdodCBzbyBzbyBsZXRzIGp1c3QgZ2V0IGEgcG9pbnQgc29tZSBkaXN0YW5jZSBkb3duIHRoZSAKICAgICAgICAgICAgICAgICAgICAvLyBwb2ludGVyJ3MgcmF5IGFuZCBjYWxsIGl0IGdvb2QuCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvYXRpbmdQb2ludCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgeDogcG9pbnRlclBvc2l0aW9uLnggKyBwb2ludGVyRGlyZWN0aW9uLnggKiB0YWdzLmZsb2F0aW5nQ3Vyc29yRGlzdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHk6IHBvaW50ZXJQb3NpdGlvbi55ICsgcG9pbnRlckRpcmVjdGlvbi55ICogdGFncy5mbG9hdGluZ0N1cnNvckRpc3RhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICB6OiBwb2ludGVyUG9zaXRpb24ueiArIHBvaW50ZXJEaXJlY3Rpb24ueiAqIHRhZ3MuZmxvYXRpbmdDdXJzb3JEaXN0YW5jZSwKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBwb2ludGVyLAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZmxvYXRpbmdQb2ludCwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IGN1cnNvcnM6IEFCVXNlclByZXNlbmNlQ3Vyc29yRGF0YVtdID0gW107CgogICAgICAgIGlmIChtYXNrcy5pblhSKSB7CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5sZWZ0UG9pbnRlclBvcnRhbCA9PT0gcG9ydGFsKSB7CiAgICAgICAgICAgICAgICBjdXJzb3JzLnB1c2goYXdhaXQgZ2VuZXJhdGVQb2ludGVyQ3Vyc29yRGF0YSgnbGVmdCcpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnJpZ2h0UG9pbnRlclBvcnRhbCA9PT0gcG9ydGFsKSB7CiAgICAgICAgICAgICAgICBjdXJzb3JzLnB1c2goYXdhaXQgZ2VuZXJhdGVQb2ludGVyQ3Vyc29yRGF0YSgncmlnaHQnKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIXRoaXNCb3QuaXNVc2luZ1RvdWNoKCkpIHsKICAgICAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5tb3VzZVBvaW50ZXJQb3J0YWwgPT09IHBvcnRhbCkgewogICAgICAgICAgICAgICAgICAgIGN1cnNvcnMucHVzaChhd2FpdCBnZW5lcmF0ZVBvaW50ZXJDdXJzb3JEYXRhKCdtb3VzZScpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpZ25vcmluZyAnbW91c2UnIGN1cnNvciBkYXRhLCB0b3VjaCBpcyB0aGUgaW5wdXQgYmVpbmcgdXNlZC5gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gQWRkIGFueSBjdXJzb3JzIGluIHRoZSBjdXJyZW50IGRpbWVuc2lvbiBmcm9tIHRoZSBleHRlcm5hbCBxdWV1ZSBpbnRvIHRoZSBvdXRnb2luZyBwcmVzZW5jZSBkYXRhLgogICAgICAgIGlmIChjdXJzb3JRdWV1ZSAmJiBjdXJzb3JRdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSBjdXJzb3JRdWV1ZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgaWYgKGN1cnNvclF1ZXVlW2ldLmRpbWVuc2lvbiA9PT0gZGltZW5zaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY3Vyc29ycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRlclR5cGU6IGN1cnNvclF1ZXVlW2ldLnBvaW50ZXJUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogY3Vyc29yUXVldWVbaV0ucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yUXVldWUuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY3Vyc29ycy5sZW5ndGgpIHsKICAgICAgICAgICAgcHJlc2VuY2VEYXRhLmN1cnNvcnMgPSBjdXJzb3JzOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAocHJlc2VuY2VEYXRhLmNhbWVyYSB8fCAocHJlc2VuY2VEYXRhLmN1cnNvcnMgJiYgcHJlc2VuY2VEYXRhLmN1cnNvcnMubGVuZ3RoID4gMCkpIHsKICAgICAgICByZXR1cm4gcHJlc2VuY2VEYXRhOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KfQoKLy8gTWFwIHBvcnRhbCBzaXRzIG9uIHRvcCB0aGUgZ3JpZCBwb3J0YWwgc28gb25seSBzZW5kIG1hcCBwb3J0YWwgY2FtZXJhIGlmIGl0cyBlbmFibGVkLgppZiAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsKSB7CiAgICBjb25zdCBwcmVzZW5jZURhdGEgPSBhd2FpdCB0cnlHZW5lcmF0ZVByZXNlbmNlRGF0YUZvclBvcnRhbCgnbWFwJyk7CiAgICBpZiAocHJlc2VuY2VEYXRhKSB7CiAgICAgICAgcHJlc2VuY2VEYXRhVG9FbWl0LnB1c2gocHJlc2VuY2VEYXRhKTsKICAgIH0KfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsKSB7CiAgICBjb25zdCBwcmVzZW5jZURhdGEgPSBhd2FpdCB0cnlHZW5lcmF0ZVByZXNlbmNlRGF0YUZvclBvcnRhbCgnZ3JpZCcpOwogICAgaWYgKHByZXNlbmNlRGF0YSkgewogICAgICAgIHByZXNlbmNlRGF0YVRvRW1pdC5wdXNoKHByZXNlbmNlRGF0YSk7CiAgICB9Cn0KCi8vIE1pbmkgbWFwIHBvcnRhbCBzaXRzIG9uIHRvcCB0aGUgbWluaSBtYXAgcG9ydGFsIHNvIG9ubHkgc2VuZCBtaW5pIG1hcCBwb3J0YWwgY2FtZXJhIGlmIGl0cyBlbmFibGVkLgppZiAoY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCkgewogICAgY29uc3QgcHJlc2VuY2VEYXRhID0gYXdhaXQgdHJ5R2VuZXJhdGVQcmVzZW5jZURhdGFGb3JQb3J0YWwoJ21pbmlNYXAnKTsKICAgIGlmIChwcmVzZW5jZURhdGEpIHsKICAgICAgICBwcmVzZW5jZURhdGFUb0VtaXQucHVzaChwcmVzZW5jZURhdGEpOwogICAgfQp9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsKSB7CiAgICBjb25zdCBwcmVzZW5jZURhdGEgPSBhd2FpdCB0cnlHZW5lcmF0ZVByZXNlbmNlRGF0YUZvclBvcnRhbCgnbWluaUdyaWQnKTsKICAgIGlmIChwcmVzZW5jZURhdGEpIHsKICAgICAgICBwcmVzZW5jZURhdGFUb0VtaXQucHVzaChwcmVzZW5jZURhdGEpOwogICAgfQp9CgppZiAocHJlc2VuY2VEYXRhVG9FbWl0Lmxlbmd0aCA9PT0gMCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgdG8gYmUgaW4gYSBwb3J0YWwgd2l0aCBwcmVzZW5jZSBkYXRhLmApOwogICAgfQogICAgcmV0dXJuOwp9Cgpjb25zdCBvdGhlclJlbW90ZXMgPSAoYXdhaXQgb3MucmVtb3RlcygpKS5maWx0ZXIoaWQgPT4gaWQgIT09IGNvbmZpZ0JvdC5pZCk7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBwcmVzZW5jZURhdGFUb0VtaXQ6YCwgcHJlc2VuY2VEYXRhVG9FbWl0LCBgb3RoZXJSZW1vdGVzOmAsIG90aGVyUmVtb3Rlcyk7Cn0KCmlmIChvdGhlclJlbW90ZXMubGVuZ3RoID4gMCkgewogICAgc2VuZFJlbW90ZURhdGEob3RoZXJSZW1vdGVzLCAnYWJfdXNlcl9wcmVzZW5jZV9kYXRhJywgcHJlc2VuY2VEYXRhVG9FbWl0KTsKfScA86Hr2QzRAQxpc1VzaW5nVG91Y2gCBADzoevZDNRHgAFAaWYgKGNvbmZpZ0JvdCkgewogICAgcmV0dXJuIGNvbmZpZ0JvdC5yYXdbJ3RvdWNoXzAnXSA9PT0gbnVsbCB8fCAhIWNvbmZpZ0JvdC5yYXdbJ3RvdWNoXzAnXSAgIAp9IGVsc2UgewogICAgcmV0dXJuIHVuZGVmaW5lZDsKfScA86Hr2QzRAQtvbkdyaWRDbGljawIEAPOh69kM1UipA0BpZiAodGhhdC5tb2RhbGl0eSA9PT0gJ3RvdWNoJykgewogICAgY29uc3QgZGltZW5zaW9uID0gdGhhdC5kaW1lbnNpb247CiAgICBjb25zdCBwb3NpdGlvbiA9IHRoYXQucG9zaXRpb247CgogICAgLy8gQWRkIHRoaXMgdG91Y2ggdG8gdGhlIGN1cnNvciBxdWV1ZSBmb3IgdGhlIG5leHQgdGljay4KICAgIGNvbnN0IGN1cnNvclF1ZXVlOiBBQlVzZXJQcmVzZW5jZVF1ZXVlZEN1cnNvckRhdGFbXSA9IHRoaXNCb3QudmFycy5jdXJzb3JRdWV1ZTsKCiAgICBjdXJzb3JRdWV1ZS5wdXNoKHsKICAgICAgICBwb2ludGVyVHlwZTogJ3RvdWNoJywKICAgICAgICBkaW1lbnNpb24sCiAgICAgICAgcG9zaXRpb246IHsgeDogcG9zaXRpb24ueCwgeTogcG9zaXRpb24ueSwgejogcG9zaXRpb24ueiB9LAogICAgfSkKCiAgICB0aGlzQm90Lm9uVGljaygpOwp9JwDzoevZDNEBDG9uQm90Q2hhbmdlZAIEAPOh69kM/0vyAkBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCd0aWNrSW50ZXJ2YWxNUycpKSB7CiAgICB0aGlzQm90LnN0b3BUaWNrKCk7CgogICAgaWYgKG9zLmlzQ29sbGFib3JhdGl2ZSgpICYmIHRoaXNCb3QuZ2V0UHJlc2VuY2VFbmFibGVkKCkpIHsKICAgICAgICB0aGlzQm90LnN0YXJ0VGljaygpOwogICAgfQp9IGVsc2UgaWYgKHRoYXQudGFncy5zb21lKCh0KSA9PiB0ID09PSAnY3Vyc29yRW5hYmxlZCcgfHwgdCA9PT0gJ2NhbWVyYUVuYWJsZWQnKSkgewogICAgaWYgKHRoaXNCb3QuZ2V0UHJlc2VuY2VFbmFibGVkKCkpIHsKICAgICAgICB0aGlzQm90LnN0YXJ0VGljaygpOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LnN0b3BUaWNrKCk7CiAgICB9Cn0nAPOh69kM0QEMb25SZW1vdGVEYXRhAgQA86Hr2QzyTvkDQGlmICghdGhpc0JvdC5nZXRQcmVzZW5jZUVuYWJsZWQoKSkgewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5uYW1lID09PSAnYWJfdXNlcl9wcmVzZW5jZV9kYXRhJykgewogICAgY29uc3QgZGF0YTogQUJVc2VyUHJlc2VuY2VEYXRhIHwgQUJVc2VyUHJlc2VuY2VEYXRhW10gPSB0aGF0LnRoYXQ7CgogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFiX3VzZXJfcHJlc2VuY2VfZGF0YSBkYXRhOmAsIGRhdGEpOwogICAgfQoKICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXNCb3Qub25BQlVzZXJQcmVzZW5jZURhdGFSZWNlaXZlZChkYXRhW2ldKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHRoaXNCb3Qub25BQlVzZXJQcmVzZW5jZURhdGFSZWNlaXZlZChkYXRhKTsKICAgIH0KfScA86Hr2QzRAQV0eXBlcwIEAPOh69kM7FLVCvCfk4RpbnRlcmZhY2UgQUJVc2VyUHJlc2VuY2VEYXRhIHsKICAgIC8qKiBSZW1vdGUgaWQgb2YgdGhlIHVzZXIgdGhlIHByZXNlbmNlIGRhdGEgaXMgZm9yLiAqLwogICAgcmVtb3RlSWQ6IHN0cmluZzsKCiAgICAvKiogQ2FuIGVpdGhlciBiZSB1c2VyJ3MgZGlzcGxheSBuYW1lIG9yIGEgc2hvcnRlbmVkIGxvY2FsIHVzZXIgaWQuICoqLwogICAgcmVtb3RlTmFtZTogc3RyaW5nOwoKICAgIC8qKiBQb3J0YWwgdGhhdCB0aGUgcHJlc2VuY2UgZGF0YSBpcyBmb3IuICovCiAgICBwb3J0YWw6IHN0cmluZzsKCiAgICAvKiogRGltZW5zaW9uIHRoYXQgdGhlIHByZXNlbmNlIGRhdGEgaXMgZm9yLiAqKi8KICAgIGRpbWVuc2lvbjogc3RyaW5nOwoKICAgIC8qKiBDb2xvciBvZiB0aGUgdXNlci4gKi8KICAgIGNvbG9yOiBzdHJpbmc7CgogICAgY2FtZXJhPzogQUJVc2VyUHJlc2VuY2VDYW1lcmFEYXRhOwogICAgY3Vyc29ycz86IEFCVXNlclByZXNlbmNlQ3Vyc29yRGF0YVtdOwp9CgppbnRlcmZhY2UgQUJVc2VyUHJlc2VuY2VDYW1lcmFEYXRhIHsKICAgIC8qKiBUeXBlIG9mIHRoZSBjYW1lcmEgdGhhdCB0aGUgZGF0YSBpcyBmb3IuICovCiAgICBjYW1lcmFUeXBlOiAncGVyc3BlY3RpdmUnIHwgJ29ydGhvZ3JhcGhpYyc7CiAgICAKICAgIC8qKiBUaGUgcG9zaXRpb24gb2YgdGhlIGNhbWVyYS4gKiovCiAgICBwb3NpdGlvbjogeyB4OiBudW1iZXIsIHk6IG51bWJlciwgejogbnVtYmVyIH07CgogICAgLyoqIFRoZSByb3RhdGlvbiBxdWF0ZXJuaW9uIG9mIHRoZSBjYW1lcmEuICoqLwogICAgcXVhdGVybmlvbjogeyB4OiBudW1iZXIsIHk6IG51bWJlciwgejogbnVtYmVyLCB3OiBudW1iZXIgfTsKCiAgICAvKiogVGhlIHpvb20gdmxhdWUgdGhhdCB0aGUgY2FtZXJhIGlzIGF0LiBUaGlzIGlzIG9ubHkgcmVsZXZhbnQgZm9yIG9ydGhvZ3JhcGhpYyBjYW1lcmFzLiAqLwogICAgem9vbT86IG51bWJlcjsKfQoKaW50ZXJmYWNlIEFCVXNlclByZXNlbmNlQ3Vyc29yRGF0YSB7CiAgICAvKiogVGhlIHR5cGUgb2YgdGhlIHBvaW50ZXIgdGhhdCB0aGUgZGF0YSBpcyBmb3IuICovCiAgICBwb2ludGVyVHlwZTogJ21vdXNlJyB8ICdsZWZ0JyB8ICdyaWdodCcgfCAndG91Y2gnOwogICAgCiAgICAvKiogVGhlIHBvc2l0aW9uIG9mIHRoZSBjdXJzb3IuICoqLwogICAgcG9zaXRpb246IHsgeDogbnVtYmVyLCB5OiBudW1iZXIsIHo6IG51bWJlciB9Owp9CgppbnRlcmZhY2UgQUJVc2VyUHJlc2VuY2VRdWV1ZWRDdXJzb3JEYXRhIGV4dGVuZHMgQUJVc2VyUHJlc2VuY2VDdXJzb3JEYXRhIHsKICAgIC8qKiBUaGUgZGltZW5zaW9uIHRoYXQgdGhpcyBjdXJzb3IgaXMgaW4uICovCiAgICBkaW1lbnNpb246IHN0cmluZzsKfScA86Hr2QzRARJjYW1lcmFCb3RUaW1lb3V0TVMCBADzoevZDMBdBDMwMDAnAPOh69kM0QELaW50ZXJwb2xhdGUCBADzoevZDMVdBHRydWUnAPOh69kM0QEGdGlja2VyAgQA86Hr2QzKXSjwn5SXNWMxOWJjOWYtYzY4ZC00M2M3LWJlMzQtMzYwMjFmN2U0ZGQzJwDzoevZDNEBDmdldFJlbW90ZUNvbG9yAgQA86Hr2QzxXc0BQGlmICghbWFza3MucmVtb3RlQ29sb3IpIHsKICAgIG1hdGguc2V0UmFuZG9tU2VlZChjb25maWdCb3QuaWQpOwogICAgbWFza3MucmVtb3RlQ29sb3IgPSBgcmdiKCR7bWF0aC5yYW5kb21JbnQoMCwgMjU1KX0sICR7bWF0aC5yYW5kb21JbnQoMCwgMjU1KX0sICR7bWF0aC5yYW5kb21JbnQoMCwgMjU1KX0pYDsKfQoKcmV0dXJuIG1hc2tzLnJlbW90ZUNvbG9yOycA86Hr2QzRAQ1nZXRSZW1vdGVOYW1lAgQA86Hr2Qy/X88CQC8vIFRoZSBuYW1lIHRoYXQgdGhpcyByZW1vdGUgaXMgdG8gYmUga25vd24gYXMgdG8gb3RoZXIgdXNlcnMuCmxldCByZW1vdGVOYW1lOwoKaWYgKGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZSkgewogICAgcmVtb3RlTmFtZSA9IGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZTsKfSBlbHNlIGlmIChhdXRoQm90ICYmIGF1dGhCb3QudGFncy5uYW1lKSB7CiAgICByZW1vdGVOYW1lID0gYXV0aEJvdC50YWdzLm5hbWU7Cn0gZWxzZSB7CiAgICByZW1vdGVOYW1lID0gY29uZmlnQm90LmlkLnN1YnN0cmluZygwLDUpOwp9CgpyZXR1cm4gcmVtb3RlTmFtZTsnAPOh69kM0QESY3Vyc29yQm90VGltZW91dE1TAgQA86Hr2QyPYgQzMDAwJwDzoevZDNEBDWNhbWVyYUVuYWJsZWQCBADzoevZDJRiBWZhbHNlJwDzoevZDNEBDWN1cnNvckVuYWJsZWQCBADzoevZDJpiBWZhbHNlJwDzoevZDNEBEmdldFByZXNlbmNlRW5hYmxlZAIEAPOh69kMoGIxQHJldHVybiB0YWdzLmN1cnNvckVuYWJsZWQgfHwgdGFncy5jYW1lcmFFbmFibGVkOycA86Hr2QzRARxvbkFCVXNlclByZXNlbmNlRGF0YVJlY2VpdmVkAgQA86Hr2QzSYtuiAUBjb25zdCBwcmVzZW5jZURhdGE6IEFCVXNlclByZXNlbmNlRGF0YSA9IHRoYXQ7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBwcmVzZW5jZURhdGE6YCwgcHJlc2VuY2VEYXRhKQp9CgppZiAocHJlc2VuY2VEYXRhLmNhbWVyYSkgewogICAgY29uc3Qgc2hvdXRSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHNob3V0KCdvbkFCVXNlckNhbWVyYVVwZGF0ZScsIHByZXNlbmNlRGF0YSkpOwogICAgY29uc3QgY2FtZXJhVXBkYXRlZCA9IHNob3V0UmVzdWx0cy5sZW5ndGggPiAwICYmIHNob3V0UmVzdWx0cy5zb21lKHIgPT4gci52YWx1ZSA9PT0gdHJ1ZSk7CiAgICAKICAgIGlmICghY2FtZXJhVXBkYXRlZCkgewogICAgICAgIC8vIFRoZXJlIHdhcyBubyB1c2VyIGNhbWVyYSB0aGF0IGFjY2VwdGVkIHRoZSB1cGRhdGUsIG5lZWQgdG8gY3JlYXRlIGEgbmV3IG9uZS4KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtYWtlIHVzZXIgY2FtZXJhOmAsIHByZXNlbmNlRGF0YSk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCB1c2VyQ2FtZXJhQm90ID0gY3JlYXRlKHsKICAgICAgICAgICAgc3BhY2U6ICd0ZW1wTG9jYWwnLAogICAgICAgICAgICBhYkJvdDogdHJ1ZSwKICAgICAgICAgICAgYWJVc2VyQ2FtZXJhOiB0cnVlLAogICAgICAgICAgICBtYW5hZ2VyOiBnZXRMaW5rKHRoaXNCb3QpLAogICAgICAgICAgICBmb3JtOiAnZnJ1c3R1bScsCiAgICAgICAgICAgIGFuY2hvclBvaW50OiAnY2VudGVyJywKICAgICAgICAgICAgcmVtb3RlSWQ6IHByZXNlbmNlRGF0YS5yZW1vdGVJZCwKICAgICAgICAgICAgcmVtb3RlTmFtZTogcHJlc2VuY2VEYXRhLnJlbW90ZU5hbWUsCiAgICAgICAgICAgIHBvcnRhbDogcHJlc2VuY2VEYXRhLnBvcnRhbCwKICAgICAgICAgICAgZGltZW5zaW9uOiBwcmVzZW5jZURhdGEuZGltZW5zaW9uLAogICAgICAgICAgICBbcHJlc2VuY2VEYXRhLmRpbWVuc2lvbl06IHRydWUsCiAgICAgICAgICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICAgICAgICAgIGxhYmVsUG9zaXRpb246ICdmbG9hdGluZ0JpbGxib2FyZCcsCiAgICAgICAgICAgIGxhYmVsV29yZFdyYXBNb2RlOiAnbm9uZScsCiAgICAgICAgICAgIC8vIGxhYmVsU2l6ZTogMC4yOCwKICAgICAgICAgICAgLy8gbGFiZWxTaXplTW9kZTogJ2F1dG8nLAogICAgICAgICAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbYWJVc2VyQ2FtZXJhLiR7dGFnTmFtZX0gKCR7dGFncy5yZW1vdGVOYW1lfSldYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBvbkFCVXNlckNhbWVyYVVwZGF0ZTogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcHJlc2VuY2VEYXRhOiBBQlVzZXJQcmVzZW5jZURhdGEgPSB0aGF0OwoKICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBpbmNvbWluZyB1cGRhdGUgaXMgZm9yIHRoaXMgYm90LgogICAgICAgICAgICAgICAgaWYgKHByZXNlbmNlRGF0YS5yZW1vdGVJZCAhPT0gdGFncy5yZW1vdGVJZCB8fAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlRGF0YS5wb3J0YWwgIT09IHRhZ3MucG9ydGFsIHx8CiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2VEYXRhLmRpbWVuc2lvbiAhPT0gdGFncy5kaW1lbnNpb24KICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBDbGVhciBvbGQgdGltZW91dC4KICAgICAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMudGltZW91dElkKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXNCb3QudmFycy50aW1lb3V0SWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy50aW1lb3V0SWQgPSBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChsaW5rcy5tYW5hZ2VyLnRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW2FiVXNlckNhbWVyYS4ke3RhZ05hbWV9ICgke3RhZ3MucmVtb3RlTmFtZX0pXSBwcmVzZW5jZURhdGE6YCwgcHJlc2VuY2VEYXRhKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGFncy5sYWJlbCAhPT0gcHJlc2VuY2VEYXRhLnJlbW90ZU5hbWUpIHsKICAgICAgICAgICAgICAgICAgICB0YWdzLmxhYmVsID0gcHJlc2VuY2VEYXRhLnJlbW90ZU5hbWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuY29sb3IgIT09IHByZXNlbmNlRGF0YS5jb2xvcikgewogICAgICAgICAgICAgICAgICAgIHRhZ3MuY29sb3IgPSBwcmVzZW5jZURhdGEuY29sb3I7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZ3MubGFiZWxGbG9hdGluZ0JhY2tncm91bmRDb2xvciAhPT0gcHJlc2VuY2VEYXRhLmNvbG9yKXsgCiAgICAgICAgICAgICAgICAgICAgdGFncy5sYWJlbEZsb2F0aW5nQmFja2dyb3VuZENvbG9yID0gcHJlc2VuY2VEYXRhLmNvbG9yOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNsYW1wMDEodDogbnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHQpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiB6b29tVG9UKHpvb206IG51bWJlciwgem9vbU1pbjogbnVtYmVyLCB6b29tTWF4OiBudW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0PTAgYXQgem9vbU1pbiwgdD0xIGF0IHpvb21NYXgKICAgICAgICAgICAgICAgICAgICBjb25zdCB6ID0gTWF0aC5tYXgoem9vbSwgMWUtNik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYSA9IE1hdGgubG9nKHpvb21NaW4pOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBNYXRoLmxvZyh6b29tTWF4KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2ID0gKE1hdGgubG9nKHopIC0gYSkgLyAoYiAtIGEpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjbGFtcDAxKHYpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGxlcnAoYTogbnVtYmVyLCBiOiBudW1iZXIsIHQ6IG51bWJlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhICsgKGIgLSBhKSAqIHQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gT3B0aW9uYWwgc21vb3RoaW5nIHNvIGl0IGRvZXNu4oCZdCBmZWVsIGxpbmVhciAvIGhhcnNoOgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc21vb3Roc3RlcCh0OiBudW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdCAqIHQgKiAoMyAtIDIgKiB0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyB0PTAgYXQgem9vbU1pbiAoem9vbWVkIG91dCksIHQ9MSBhdCB6b29tTWF4ICh6b29tZWQgaW4pCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhcHBseUVhc2UodDogbnVtYmVyLCBleHBvbmVudDogbnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZXhwb25lbnQgPCAxIHNsb3dzIGRvd24gdGhlIOKAnG1vdmUgYXdheeKAnSB3aGVuIHpvb21pbmcgb3V0CiAgICAgICAgICAgICAgICAgICAgLy8gKG1ha2VzIGN1cnZlIGdlbnRsZXIgbmVhciB0PTApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucG93KHNtb290aHN0ZXAodCksIGV4cG9uZW50KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhc3luYyBmdW5jdGlvbiBnZXRWaXpDYW1lcmFQb3NlKAogICAgICAgICAgICAgICAgICAgIGNhbWVyYVBvc2l0aW9uOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB6OiBudW1iZXIgfSwKICAgICAgICAgICAgICAgICAgICBjYW1lcmFSb3RhdGlvbjogeyB4OiBudW1iZXI7IHk6IG51bWJlcjsgejogbnVtYmVyOyB3OiBudW1iZXIgfSwKICAgICAgICAgICAgICAgICAgICBjYW1lcmFUeXBlOiAnb3J0aG9ncmFwaGljJyB8ICdwZXJzcGVjdGl2ZScsCiAgICAgICAgICAgICAgICAgICAgY2FtZXJhWm9vbTogbnVtYmVyIHwgbnVsbCB8IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICB6b29tTWluID0gMC40LAogICAgICAgICAgICAgICAgICAgIHpvb21NYXggPSA4MCwKICAgICAgICAgICAgICAgICAgICBmYXJEaXN0ID0gMzAsCiAgICAgICAgICAgICAgICAgICAgbmVhckRpc3QgPSAyLAogICAgICAgICAgICAgICAgICAgIGV4cG9uZW50ID0gMC41LAogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zID0gbmV3IFZlY3RvcjMoY2FtZXJhUG9zaXRpb24ueCwgY2FtZXJhUG9zaXRpb24ueSwgY2FtZXJhUG9zaXRpb24ueik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGV0IHJvdDsKICAgICAgICAgICAgICAgICAgICBpZiAoKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24gfHwgY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pICYmIGNhbWVyYVR5cGUgPT09ICdwZXJzcGVjdGl2ZScpIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIHJvdCA9IGF3YWl0IGFiLmxpbmtzLnV0aWxzLmNhbGNNYXBSb3RhdGlvbih7IG1hcFBvc2l0aW9uOiBjYW1lcmFQb3NpdGlvbiwgYXV4Um90YXRpb246IG5ldyBSb3RhdGlvbih7IHF1YXRlcm5pb246IGNhbWVyYVJvdGF0aW9uIH0pfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcm90ID0gbmV3IFJvdGF0aW9uKHsgcXVhdGVybmlvbjogY2FtZXJhUm90YXRpb24gfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3J3YXJkID0gcm90LnJvdGF0ZVZlY3RvcjMobmV3IFZlY3RvcjMoMCwgMSwgMCkpLm5vcm1hbGl6ZSgpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY2FtZXJhVHlwZSA9PT0gJ3BlcnNwZWN0aXZlJykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwb3NpdGlvbjogcG9zLCByb3RhdGlvbjogcm90IH07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCB6b29tID0gTWF0aC5tYXgoY2FtZXJhWm9vbSA/PyAxMCwgMWUtNik7CgogICAgICAgICAgICAgICAgICAgIGxldCB0ID0gem9vbVRvVCh6b29tLCB6b29tTWluLCB6b29tTWF4KTsKICAgICAgICAgICAgICAgICAgICB0ID0gYXBwbHlFYXNlKHQsIGV4cG9uZW50KTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZCA9IGxlcnAoZmFyRGlzdCwgbmVhckRpc3QsIHQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZpelBvcyA9IHBvcy5zdWJ0cmFjdChmb3J3YXJkLm11bHRpcGx5U2NhbGFyKGQpKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgcG9zaXRpb246IHZpelBvcywgcm90YXRpb246IHJvdCwgZGVidWc6IHsgdCwgZCwgem9vbSB9IH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgcG9zZSA9IGF3YWl0IGdldFZpekNhbWVyYVBvc2UoCiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYS5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICBwcmVzZW5jZURhdGEuY2FtZXJhLnF1YXRlcm5pb24sCiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYS5jYW1lcmFUeXBlLAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlRGF0YS5jYW1lcmEuem9vbSwKICAgICAgICAgICAgICAgICAgICAwLjQsCiAgICAgICAgICAgICAgICAgICAgODAsCiAgICAgICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICAgICAtNDI3LAogICAgICAgICAgICAgICAgICAgIDAuMSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgY29uc3QgcG9zVGFnTmFtZSA9IHRhZ3MuZGltZW5zaW9uICsgJ1Bvc2l0aW9uJzsKICAgICAgICAgICAgICAgIGNvbnN0IHJvdFRhZ05hbWUgPSB0YWdzLmRpbWVuc2lvbiArICdSb3RhdGlvbic7CgogICAgICAgICAgICAgICAgY2xlYXJBbmltYXRpb25zKHRoaXNCb3QsIFtwb3NUYWdOYW1lLCByb3RUYWdOYW1lXSk7CgogICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5pbnRlcnBvbGF0ZSAmJiB0YWdzW3Bvc1RhZ05hbWVdICYmIHRhZ3Nbcm90VGFnTmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcG9zVGFnTmFtZV06IHRhZ3NbcG9zVGFnTmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcm90VGFnTmFtZV06IHRhZ3Nbcm90VGFnTmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtwb3NUYWdOYW1lXTogcG9zZS5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtyb3RUYWdOYW1lXTogcG9zZS5yb3RhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IChsaW5rcy5tYW5hZ2VyLnRhZ3MudGlja0ludGVydmFsTVMgKyA1MCkgLyAxMDAwLAogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHt9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWFza3NbcG9zVGFnTmFtZV0gPSBwb3NlLnBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIG1hc2tzW3JvdFRhZ05hbWVdID0gcG9zZS5yb3RhdGlvbjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBTZXQgbmV3IHRpbWVvdXQuCiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMudGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiBkZXN0cm95KHRoaXNCb3QpLCBsaW5rcy5tYW5hZ2VyLnRhZ3MuY2FtZXJhQm90VGltZW91dE1TKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbYWJVc2VyQ2FtZXJhLiR7dGFnTmFtZX0gKCR7dGFncy5yZW1vdGVOYW1lfSldYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSkKCiAgICAgICAgLy8gRGlyZWN0bHkgY2FsbCBvbkFCVXNlckNhbWVyYVVwZGF0ZSB0aGUgZmlyc3QgdGltZSB3ZSBtYWtlIGEgbmV3IHVzZXIgY2FtZXJhIGJvdC4KICAgICAgICBhd2FpdCB1c2VyQ2FtZXJhQm90Lm9uQUJVc2VyQ2FtZXJhVXBkYXRlKHByZXNlbmNlRGF0YSk7CiAgICB9Cn0KCmlmIChwcmVzZW5jZURhdGEuY3Vyc29ycyAmJiBwcmVzZW5jZURhdGEuY3Vyc29ycy5sZW5ndGggPiAwKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByZXNlbmNlRGF0YS5jdXJzb3JzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hvdXRSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHNob3V0KCdvbkFCVXNlckN1cnNvclVwZGF0ZScsIHsgcHJlc2VuY2VEYXRhLCBjdXJzb3JJbmRleDogaSB9KSk7CiAgICAgICAgY29uc3QgY3Vyc29yVXBkYXRlZCA9IHNob3V0UmVzdWx0cy5sZW5ndGggPiAwICYmIHNob3V0UmVzdWx0cy5zb21lKHIgPT4gci52YWx1ZSA9PT0gdHJ1ZSk7CiAgICAgICAgCiAgICAgICAgaWYgKCFjdXJzb3JVcGRhdGVkKSB7CiAgICAgICAgICAgIC8vIFRoZXJlIHdhcyBubyB1c2VyIGN1cnNvciB0aGF0IGFjY2VwdGVkIHRoZSB1cGRhdGUsIG5lZWQgdG8gY3JlYXRlIGEgbmV3IG9uZS4KCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG1ha2UgdXNlciBjdXJzb3I6YCwgcHJlc2VuY2VEYXRhLCBgY3Vyc29yOmAsIHByZXNlbmNlRGF0YS5jdXJzb3JzW2ldKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgY3Vyc29yQm90ID0gY3JlYXRlKHsKICAgICAgICAgICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgICAgICAgICAgICAgIGFiQm90OiB0cnVlLAogICAgICAgICAgICAgICAgYWJVc2VyQ3Vyc29yOiB0cnVlLAogICAgICAgICAgICAgICAgZm9ybTogJ25vdGhpbmcnLAogICAgICAgICAgICAgICAgYW5jaG9yUG9pbnQ6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgb3JpZW50YXRpb25Nb2RlOiAnYmlsbGJvYXJkJywKICAgICAgICAgICAgICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBkcmFnZ2FibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgbWFuYWdlcjogZ2V0TGluayh0aGlzQm90KSwKICAgICAgICAgICAgICAgIHJlbW90ZUlkOiBwcmVzZW5jZURhdGEucmVtb3RlSWQsCiAgICAgICAgICAgICAgICByZW1vdGVOYW1lOiBwcmVzZW5jZURhdGEucmVtb3RlTmFtZSwKICAgICAgICAgICAgICAgIHBvcnRhbDogcHJlc2VuY2VEYXRhLnBvcnRhbCwKICAgICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBwcmVzZW5jZURhdGEuY3Vyc29yc1tpXS5wb2ludGVyVHlwZSwKICAgICAgICAgICAgICAgIGRpZEluaXRpYWxVcGRhdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobGlua3MubWFuYWdlci50YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbYWJVc2VyQ3Vyc29yLiR7dGFnTmFtZX0gKCR7dGFncy5yZW1vdGVOYW1lfSldYCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBvbkFCVXNlckN1cnNvclVwZGF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXNlbmNlRGF0YTogQUJVc2VyUHJlc2VuY2VEYXRhID0gdGhhdC5wcmVzZW5jZURhdGE7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29ySW5kZXg6IG51bWJlciA9IHRoYXQuY3Vyc29ySW5kZXg7CgogICAgICAgICAgICAgICAgICAgIGlmICh0YWdzLnJlbW90ZUlkICE9PSBwcmVzZW5jZURhdGEucmVtb3RlSWQgfHwKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5wb3J0YWwgIT09IHByZXNlbmNlRGF0YS5wb3J0YWwgfHwKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5wb2ludGVyVHlwZSAhPT0gcHJlc2VuY2VEYXRhLmN1cnNvcnNbY3Vyc29ySW5kZXhdLnBvaW50ZXJUeXBlIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICh0YWdzLnBvaW50ZXJUeXBlID09PSAndG91Y2gnICYmIHRhZ3MuZGlkSW5pdGlhbFVwZGF0ZSkgLy8gQWx3YXlzIGxldCB0b3VjaCBjdXJzb3JzIGRpZS4KICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB1cGRhdGUgaXMgbm90IGZvciB0aGlzIGN1cnNvci4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY3Vyc29yICcgKyB0aGlzQm90LmlkLnN1YnN0cmluZygwLDUpICsgJyB1cGRhdGUnKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlUG9zaXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICBkaW1lbnNpb246IHByZXNlbmNlRGF0YS5kaW1lbnNpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwcmVzZW5jZURhdGEuY3Vyc29yc1tjdXJzb3JJbmRleF0ucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlQ29sb3IoeyBjb2xvcjogcHJlc2VuY2VEYXRhLmNvbG9yIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTmFtZSh7IG5hbWU6IHByZXNlbmNlRGF0YS5yZW1vdGVOYW1lIH0pOwoKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnJlc2V0VGltZW91dCgpOwoKICAgICAgICAgICAgICAgICAgICB0YWdzLmRpZEluaXRpYWxVcGRhdGUgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgb25HcmlkUG9ydGFsQ2FtZXJhQ2hhbmdlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlU2NhbGUoKTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgb25Cb3RDaGFuZ2VkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQudGFncy5zb21lKCh0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmVuZHNXaXRoKCdYJykgfHwgdC5lbmRzV2l0aCgnWScpIHx8IHQuZW5kc1dpdGgoJ1onKTsKICAgICAgICAgICAgICAgICAgICB9KSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBDdXJzb3IgcG9zaXRpb24gY2hhbmdlZC4KICAgICAgICAgICAgICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVTY2FsZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgdXBkYXRlUG9zaXRpb246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGRpbWVuc2lvbiwgcG9zaXRpb24gfSA9IHRoYXQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGltZW5zaW9uICE9PSBkaW1lbnNpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGltZW5zaW9uIGhhcyBjaGFuZ2VkLiAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWdzLmRpbWVuc2lvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjdXJzb3IgZnJvbSB0aGUgcHJldmlvdXMgZGltZW5zaW9uLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgdGFncy5kaW1lbnNpb24gXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5zaGFwZUJvdC50YWdzWyB0YWdzLmRpbWVuc2lvbiBdID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtzLm5hbWVCb3QudGFnc1sgdGFncy5kaW1lbnNpb24gXSA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHBvc2l0aW9uIHRhZ3MgZm9yIHByZXZpb3VzIGRpbWVuc2lvbiBhcyB3ZWxsLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgdGFncy5kaW1lbnNpb24gKyAnWCcgXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzWyB0YWdzLmRpbWVuc2lvbiArICdZJyBdID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIHRhZ3MuZGltZW5zaW9uICsgJ1onIF0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGN1cnNvciB0byB0aGUgY3VycmVudCBkaW1lbnNpb24uCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MuZGltZW5zaW9uID0gZGltZW5zaW9uOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltZW5zaW9uIF0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5zaGFwZUJvdC50YWdzWyBkaW1lbnNpb24gXSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtzLm5hbWVCb3QudGFnc1sgZGltZW5zaW9uIF0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGltWFRhZyA9IGRpbWVuc2lvbiArICdYJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaW1ZVGFnID0gZGltZW5zaW9uICsgJ1knOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpbVpUYWcgPSBkaW1lbnNpb24gKyAnWic7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldlggPSB0YWdzWyBkaW1YVGFnIF07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldlkgPSB0YWdzWyBkaW1ZVGFnIF07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldlogPSB0YWdzWyBkaW1aVGFnIF07CgogICAgICAgICAgICAgICAgICAgIGNsZWFyQW5pbWF0aW9ucyh0aGlzQm90KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZYID09IG51bGwgJiYgcHJldlkgPT0gbnVsbCAmJiBwcmV2WiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGZpcnN0IHRpbWUgc2V0dGluZyB0aGUgcG9zaXRpb24gb2YgdGhpcyBjdXJzb3IgaW4gdGhpcyBkaW1lbnNpb24uCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNuYXAgY3Vyc29yIHRvIHRoZSBwb3NpdGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltWFRhZyBdID0gcG9zaXRpb24ueDsKICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltWVRhZyBdID0gcG9zaXRpb24ueTsKICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltWlRhZyBdID0gcG9zaXRpb24uejsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGlua3MubWFuYWdlci50YWdzLmludGVycG9sYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDdXJzb3IgaXMgYWxyZWFkeSBwb3NpdGlvbmVkIGluIGRpbWVuc2lvbiwgc21vb3RobHkgYW5pbWF0ZSB0byB0aGUgdXBkYXRlZCBwb3NpdGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGVUYWcodGhpc0JvdCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZGltWFRhZ106IHByZXZYLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZGltWVRhZ106IHByZXZZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZGltWlRhZ106IHByZXZaLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZGltWFRhZ106IHBvc2l0aW9uLngsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtkaW1ZVGFnXTogcG9zaXRpb24ueSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2RpbVpUYWddOiBwb3NpdGlvbi56LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IChsaW5rcy5tYW5hZ2VyLnRhZ3MudGlja0ludGVydmFsTVMgKyA1MCkgLyAxMDAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvbiBjYW5jZWxlZCwgZG8gbm90aGluZy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltWFRhZyBdID0gcG9zaXRpb24ueDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIGRpbVlUYWcgXSA9IHBvc2l0aW9uLnk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzWyBkaW1aVGFnIF0gPSBwb3NpdGlvbi56OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB1cGRhdGVDb2xvcjogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY29sb3IgfSA9IHRoYXQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChsaW5rcy5zaGFwZUJvdC50YWdzLmNvbG9yICE9PSBjb2xvcikgewogICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5zaGFwZUJvdC50YWdzLmNvbG9yID0gY29sb3I7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAobGlua3MubmFtZUJvdC50YWdzLmNvbG9yICE9PSBjb2xvcikgewogICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5uYW1lQm90LnRhZ3MuY29sb3IgPSBjb2xvcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHVwZGF0ZU5hbWU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IHRoYXQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChsaW5rcy5uYW1lQm90LnRhZ3MubGFiZWwgIT09IG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGlua3MubmFtZUJvdC50YWdzLmxhYmVsID0gbmFtZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHVwZGF0ZVNjYWxlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uc3RhbnRTY2FsZSA9IGxpbmtzLm1hbmFnZXIudGFncy5jdXJzb3JDb25zdGFudFNjYWxlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluWFIgPSBsaW5rcy5tYW5hZ2VyLnRhZ3MuaW5YUjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoaW5YUiB8fAogICAgICAgICAgICAgICAgICAgICAgICBncmlkUG9ydGFsQm90LnRhZ3MucG9ydGFsQ2FtZXJhVHlwZSA9PT0gJ3BlcnNwZWN0aXZlJwogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBwZXJzcGVjdGl2ZSBzY2FsZQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW1lcmFQb3NpdGlvbiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGdyaWRQb3J0YWxCb3QudGFncy5jYW1lcmFQb3NpdGlvblggPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IGdyaWRQb3J0YWxCb3QudGFncy5jYW1lcmFQb3NpdGlvblkgPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHo6IGdyaWRQb3J0YWxCb3QudGFncy5jYW1lcmFQb3NpdGlvblogPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFRoaXMgd2lsbCBicmVhayB3aGVuIHRoZSBjdXJzb3IgaXMgaW4gYSBkaW1lbnNpb24gYmVpbmcgZGlzcGxheWVkIGJ5IGEgcG9ydGFsIGJvdC4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGZpeCBpcyB0byBjYWxjdWxhdGUgdGhlIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSBib3QsIGJ1dCBmb3Igbm93IGltIGdvaW5nIHRvIHNraXAuCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnNvclBvc2l0aW9uID0geyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IHRhZ3NbIHRhZ3MuZGltZW5zaW9uICsgJ1gnIF0gPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IHRhZ3NbIHRhZ3MuZGltZW5zaW9uICsgJ1knIF0gPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHo6IHRhZ3NbIHRhZ3MuZGltZW5zaW9uICsgJ1onIF0gPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gbWF0aC52ZWN0b3JMZW5ndGgoIG1hdGguc3VidHJhY3RWZWN0b3JzKGNhbWVyYVBvc2l0aW9uLCBjdXJzb3JQb3NpdGlvbikgKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5pdGlhbERpc3RhbmNlID0gbGlua3MubWFuYWdlci50YWdzLmN1cnNvckluaXRpYWxEaXN0YW5jZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3Muc2NhbGUgPSAoZGlzdGFuY2UgLyBpbml0aWFsRGlzdGFuY2UpICogY29uc3RhbnRTY2FsZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBvcnRob2dyYXBoaWMgc2NhbGUKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5zY2FsZSA9IGNvbnN0YW50U2NhbGUgLyBncmlkUG9ydGFsQm90LnRhZ3MuY2FtZXJhWm9vbTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0YWdzLnRpbWVvdXRJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGFncy50aW1lb3V0SWQpOwogICAgICAgICAgICAgICAgICAgICAgICB0YWdzLnRpbWVvdXRJZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICByZXNldFRpbWVvdXQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LmNsZWFyVGltZW91dCgpOwoKICAgICAgICAgICAgICAgICAgICB0YWdzLnRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGlua3MubWFuYWdlci50YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY3Vyc29yICcgKyB0aGlzQm90LmlkLnN1YnN0cmluZygwLDUpICsgJyBoYXMgdGltZWQgb3V0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgICAgICAgICAgICAgfSwgbGlua3MubWFuYWdlci50YWdzLmN1cnNvckJvdFRpbWVvdXRNUyk7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QuY2xlYXJUaW1lb3V0KCk7CgogICAgICAgICAgICAgICAgICAgIGRlc3Ryb3koWwogICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5zaGFwZUJvdCwKICAgICAgICAgICAgICAgICAgICAgICAgbGlua3MubmFtZUJvdCwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICB9KQoKICAgICAgICAgICAgY29uc3Qgc2hhcGVCb3QgPSBjcmVhdGUoewogICAgICAgICAgICAgICAgc3BhY2U6ICd0ZW1wTG9jYWwnLAogICAgICAgICAgICAgICAgYWJCb3Q6IHRydWUsCiAgICAgICAgICAgICAgICBhYlVzZXJDdXJzb3I6IHRydWUsCiAgICAgICAgICAgICAgICBmb3JtRGVwdGhUZXN0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGZvcm1EZXB0aFdyaXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGZvcm1SZW5kZXJPcmRlcjogOTk5OTksCiAgICAgICAgICAgICAgICByb3RhdGlvblhPZmZzZXQ6IDAsCiAgICAgICAgICAgICAgICByb3RhdGlvbllPZmZzZXQ6IDAsCiAgICAgICAgICAgICAgICByb3RhdGlvblpPZmZzZXQ6IDAsCiAgICAgICAgICAgICAgICBwb2ludGFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNjYWxlOiAwLjUsCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lcjogY3Vyc29yQm90LnRhZ3MuaWQsCiAgICAgICAgICAgICAgICBjdXJzb3JCb3Q6IGdldExpbmsoY3Vyc29yQm90KSwKICAgICAgICAgICAgICAgIG1hbmFnZXI6IGdldExpbmsodGhpc0JvdCksCiAgICAgICAgICAgICAgICBvbkJvdEFkZGVkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmtzLmN1cnNvckJvdC50YWdzLnBvaW50ZXJUeXBlID09PSAndG91Y2gnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MuZm9ybSA9ICdzcGhlcmUnOwogICAgICAgICAgICAgICAgICAgICAgICB0YWdzLmZvcm1PcGFjaXR5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5hbmNob3JQb2ludCA9ICdjZW50ZXInLAoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGxheSBhICJwaW5nIiBhbmltYXRpb24gZm9yIHRoZSB0b3VjaCBwb2ludC4KICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZVRhZyh0aGlzQm90LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogdGFncy5zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtT3BhY2l0eTogdGFncy5mb3JtT3BhY2l0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IHRhZ3Muc2NhbGUgKiAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1PcGFjaXR5OiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAobGlua3MubWFuYWdlci50YWdzLmN1cnNvckJvdFRpbWVvdXRNUyAqIDAuNSkgLyAxMDAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ291dCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3NpbnVzb2lkYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlc3Ryb3kgc2VsZiBvbmNlIGFuaW1hdGlvbiBlbmRzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5jdXJzb3JCb3QpOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4ge30pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MuZm9ybSA9ICdtZXNoJzsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5mb3JtU3VidHlwZSA9ICdnbHRmJzsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9bGlua3MubWFuYWdlci50YWdzLmN1cnNvck1vZGVsOwogICAgICAgICAgICAgICAgICAgICAgICB0YWdzLmFuY2hvclBvaW50ID0gWy0wLjQ1LCAwLjUsIDBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBuYW1lQm90ID0gY3JlYXRlKHsKICAgICAgICAgICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgICAgICAgICAgICAgIGFiQm90OiB0cnVlLAogICAgICAgICAgICAgICAgYWJVc2VyQ3Vyc29yOiB0cnVlLAogICAgICAgICAgICAgICAgZm9ybTogJ2N1YmUnLAogICAgICAgICAgICAgICAgZm9ybURlcHRoVGVzdDogZmFsc2UsCiAgICAgICAgICAgICAgICBmb3JtRGVwdGhXcml0ZTogZmFsc2UsCiAgICAgICAgICAgICAgICBmb3JtUmVuZGVyT3JkZXI6IDk5OTk5LAogICAgICAgICAgICAgICAgYW5jaG9yUG9pbnQ6IFstMC42MjUsIDEuNSwgMF0sCiAgICAgICAgICAgICAgICBwb2ludGFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNjYWxlWDogMywKICAgICAgICAgICAgICAgIHNjYWxlWTogMC42LAogICAgICAgICAgICAgICAgc2NhbGVaOiAwLjEsCiAgICAgICAgICAgICAgICBsYWJlbFBhZGRpbmc6IDAuMSwKICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVyOiBjdXJzb3JCb3QudGFncy5pZCwKICAgICAgICAgICAgICAgIGN1cnNvckJvdDogZ2V0TGluayhjdXJzb3JCb3QpLAogICAgICAgICAgICAgICAgbWFuYWdlcjogZ2V0TGluayh0aGlzQm90KSwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBHaXZlIGN1cnNvciBib3QgbGlua3MgdG8gYWxsIG9mIHRoZSBjaGlsZCBib3RzIGl0IG5lZWRzIHRvIGNvbW11bmljYXRlIHdpdGguCiAgICAgICAgICAgIGN1cnNvckJvdC5saW5rcy5zaGFwZUJvdCA9IHNoYXBlQm90Lmxpbms7CiAgICAgICAgICAgIGN1cnNvckJvdC5saW5rcy5uYW1lQm90ID0gbmFtZUJvdC5saW5rOwoKICAgICAgICAgICAgLy8gRGlyZWN0bHkgY2FsbCBvbkFCVXNlckN1cnNvclVwZGF0ZSB0aGUgZmlyc3QgdGltZSB3ZSBtYWtlIGEgbmV3IHVzZXIgY2FtZXJhIGJvdC4KICAgICAgICAgICAgYXdhaXQgY3Vyc29yQm90Lm9uQUJVc2VyQ3Vyc29yVXBkYXRlKHsgcHJlc2VuY2VEYXRhLCBjdXJzb3JJbmRleDogaSB9KTsKICAgICAgICB9CiAgICB9Cn0nAPOh69kM0QEQb25JbnN0U3RyZWFtTG9zdAIEAPOh69kMqIUCZUBpZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSB0aGF0OmAsIHRoYXQpOwp9Cgp0aGlzQm90LnN0b3BUaWNrKCk7JwDzoevZDNEBD29uSW5zdFN0cmVhbWluZwIEAPOh69kMjoYCiAFAaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKaWYgKG9zLmlzQ29sbGFib3JhdGl2ZSgpKSB7CiAgICB0aGlzQm90LnN0YXJ0VGljaygpOwp9JwDzoevZDNEBD29uQW55Qm90Q2xpY2tlZAIEAPOh69kMl4cCgA9AaWYgKHRoYXQubW9kYWxpdHkgPT09ICd0b3VjaCcpIHsKICAgIGNvbnN0IGRpbWVuc2lvbiA9IHRoYXQuZGltZW5zaW9uOwoKICAgIC8vIENhc3VhbE9TIGRvZXMgbm90IHJlcG9ydCB0aGUgcG9ydGFsIHRoYXQgdGhlIGNsaWNrIHRvb2sgcGxhY2UgaW4sIG11c3QgaW5mZXIgaXQgaCAgICBlcmUuCmxldCBwb3J0YWw7CgogICAgaWYgKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9PT0gZGltZW5zaW9uKSB7CiAgICAgICAgcG9ydGFsID0gJ21hcCc7CiAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPT09IGRpbWVuc2lvbikgewogICAgICAgIHBvcnRhbCA9ICdncmlkJzsKICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCA9PT0gZGltZW5zaW9uKSB7CiAgICAgICAgcG9ydGFsID0gJ21pbmlNYXAnOwogICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PT0gZGltZW5zaW9uKSB7CiAgICAgICAgcG9ydGFsID0gJ21pbmlHcmlkJzsKICAgIH0KCiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaW5mZXJyZWQgcG9ydGFsIGZyb20gYm90IGNsaWNrOmAsIHBvcnRhbCk7CiAgICB9CgogICAgaWYgKHBvcnRhbCkgewogICAgICAgIC8vIERvIGEgcmF5Y2FzdCBhZ2FpbnN0IHRoZSBjdXJyZW50IG1vdXNlIHBvc2l0aW9uIGlmIGEgdG91Y2ggcG9pbnRlciBjbGlja2VkIGEgYm90LgogICAgICAgIC8vIFdhcyBhYmxlIHRvIHZlcmlmeSBhdCB0aGUgdGltZSBvZiB3cml0aW5nIChKYW4gMTksIDIwMjYpIHRoYXQgdGhpcyBvbmx5IG9jY3VycyBmb3IgdG91Y2hfMCBzbyBpdCBzaG91bGQgYmUKICAgICAgICAvLyBzYWZlIHRvIHVzZSBDYXN1YWxPUydzIHJlcG9ydGVkIG1vdXNlIHBvc2l0aW9uIGZvciB0aGlzIHNpbmNlIHdlIGRvbnQgZ2V0IGEgdG91Y2ggcG9zaXRpb24uCiAgICAgICAgY29uc3QgcG9pbnRlclBvc2l0aW9uID0gb3MuZ2V0UG9pbnRlclBvc2l0aW9uKCdtb3VzZScpOwogICAgICAgIGNvbnN0IHBvaW50ZXJEaXJlY3Rpb24gPSBvcy5nZXRQb2ludGVyRGlyZWN0aW9uKCdtb3VzZScpOwogICAgICAgIGNvbnN0IHJheWNhc3RSZXN1bHQgPSBhd2FpdCBvcy5yYXljYXN0KHBvcnRhbCwgcG9pbnRlclBvc2l0aW9uLCBwb2ludGVyRGlyZWN0aW9uKTsKCiAgICAgICAgbGV0IHJheWNhc3RIaXQ7CgogICAgICAgIGlmIChyYXljYXN0UmVzdWx0LmJvdEludGVyc2VjdGlvbnMgJiYgcmF5Y2FzdFJlc3VsdC5ib3RJbnRlcnNlY3Rpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmF5Y2FzdEhpdCA9IHJheWNhc3RSZXN1bHQuYm90SW50ZXJzZWN0aW9ucy5maW5kKChoKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gaC5ib3QudGFncy5wb2ludGFibGUgIT0gZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocmF5Y2FzdEhpdCkgewogICAgICAgICAgICAvLyBBZGQgdGhpcyB0b3VjaCBjbGljayB0byB0aGUgY3Vyc29yIHF1ZXVlIGZvciB0aGUgbmV4dCB0aWNrLgogICAgICAgICAgICBjb25zdCBjdXJzb3JRdWV1ZTogQUJVc2VyUHJlc2VuY2VRdWV1ZWRDdXJzb3JEYXRhW10gPSB0aGlzQm90LnZhcnMuY3Vyc29yUXVldWU7CgogICAgICAgICAgICBjdXJzb3JRdWV1ZS5wdXNoKHsKICAgICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiAndG91Y2gnLAogICAgICAgICAgICAgICAgZGltZW5zaW9uLAogICAgICAgICAgICAgICAgcG9zaXRpb246IHsgeDogcmF5Y2FzdEhpdC5wb2ludC54LCB5OiByYXljYXN0SGl0LnBvaW50LnksIHo6IHJheWNhc3RIaXQucG9pbnQueiB9LAogICAgICAgICAgICB9KQoKICAgICAgICAgICAgdGhpc0JvdC5vblRpY2soKTsKICAgICAgICB9CiAgICB9Cn0nAPOh69kM0QEJb25FbnRlclZSAgQA86Hr2QyYlgITQG1hc2tzLmluWFIgPSB0cnVlOycA86Hr2QzRAQlvbkVudGVyQVICBADzoevZDKyWAhNAbWFza3MuaW5YUiA9IHRydWU7JwDzoevZDNEBCG9uRXhpdEFSAgQA86Hr2QzAlgITQG1hc2tzLmluWFIgPSBudWxsOycA86Hr2QzRAQhvbkV4aXRWUgIEAPOh69kM1JYCE0BtYXNrcy5pblhSID0gbnVsbDsnAPOh69kM0QELY3Vyc29yTW9kZWwCBADzoevZDOiWAtUWZGF0YTp0ZXh0L3htbDtiYXNlNjQsWjJ4VVJnSUFBQUJ3Q0FBQWpBUUFBRXBUVDA1N0ltRnpjMlYwSWpwN0ltZGxibVZ5WVhSdmNpSTZJa3RvY205dWIzTWdaMnhVUmlCQ2JHVnVaR1Z5SUVrdlR5QjJNeTQwTGpVd0lpd2lkbVZ5YzJsdmJpSTZJakl1TUNKOUxDSmxlSFJsYm5OcGIyNXpWWE5sWkNJNld5SkxTRkpmYldGMFpYSnBZV3h6WDNWdWJHbDBJbDBzSW5OalpXNWxJam93TENKelkyVnVaWE1pT2x0N0ltNWhiV1VpT2lKVFkyVnVaU0lzSW01dlpHVnpJanBiTUYxOVhTd2libTlrWlhNaU9sdDdJbTFsYzJnaU9qQXNJbTVoYldVaU9pSkRkV0psSW4xZExDSnRZWFJsY21saGJITWlPbHQ3SW1WNGRHVnVjMmx2Ym5NaU9uc2lTMGhTWDIxaGRHVnlhV0ZzYzE5MWJteHBkQ0k2ZTMxOUxDSnVZVzFsSWpvaVRXRjBaWEpwWVd3aUxDSndZbkpOWlhSaGJHeHBZMUp2ZFdkb2JtVnpjeUk2ZXlKdFpYUmhiR3hwWTBaaFkzUnZjaUk2TUN3aWNtOTFaMmh1WlhOelJtRmpkRzl5SWpvd0xqbDlmVjBzSW0xbGMyaGxjeUk2VzNzaWJtRnRaU0k2SWtOMVltVWlMQ0p3Y21sdGFYUnBkbVZ6SWpwYmV5SmhkSFJ5YVdKMWRHVnpJanA3SWxCUFUwbFVTVTlPSWpvd0xDSlVSVmhEVDA5U1JGOHdJam94TENKT1QxSk5RVXdpT2pKOUxDSnBibVJwWTJWeklqb3pMQ0p0WVhSbGNtbGhiQ0k2TUgxZGZWMHNJbUZqWTJWemMyOXljeUk2VzNzaVluVm1abVZ5Vm1sbGR5STZNQ3dpWTI5dGNHOXVaVzUwVkhsd1pTSTZOVEV5Tml3aVkyOTFiblFpT2pJNExDSnRZWGdpT2xzeExqUTVNalUyTVRNME1ETXpNakF6TVRJc01DNHdOelUxTkRJMU16RTVNRGMxTlRnME5Dd3hMall3TlRjeE1ERTBPRGd4TVRNME1ETmRMQ0p0YVc0aU9sc3hMakk1TURRMU1qSXdNRGt4T1RNNE9UZGxMVEExTEMwd0xqQTRNVE00TnpBME1qazVPVEkyTnpVNExEY3VNVEUxTXpBME5EY3dNRFl5TWpVMlpTMHdObDBzSW5SNWNHVWlPaUpXUlVNekluMHNleUppZFdabVpYSldhV1YzSWpveExDSmpiMjF3YjI1bGJuUlVlWEJsSWpvMU1USTJMQ0pqYjNWdWRDSTZNamdzSW5SNWNHVWlPaUpXUlVNeUluMHNleUppZFdabVpYSldhV1YzSWpveUxDSmpiMjF3YjI1bGJuUlVlWEJsSWpvMU1USTJMQ0pqYjNWdWRDSTZNamdzSW5SNWNHVWlPaUpXUlVNekluMHNleUppZFdabVpYSldhV1YzSWpvekxDSmpiMjF3YjI1bGJuUlVlWEJsSWpvMU1USXpMQ0pqYjNWdWRDSTZNellzSW5SNWNHVWlPaUpUUTBGTVFWSWlmVjBzSW1KMVptWmxjbFpwWlhkeklqcGJleUppZFdabVpYSWlPakFzSW1KNWRHVk1aVzVuZEdnaU9qTXpOaXdpWW5sMFpVOW1abk5sZENJNk1Dd2lkR0Z5WjJWMElqb3pORGsyTW4wc2V5SmlkV1ptWlhJaU9qQXNJbUo1ZEdWTVpXNW5kR2dpT2pJeU5Dd2lZbmwwWlU5bVpuTmxkQ0k2TXpNMkxDSjBZWEpuWlhRaU9qTTBPVFl5ZlN4N0ltSjFabVpsY2lJNk1Dd2lZbmwwWlV4bGJtZDBhQ0k2TXpNMkxDSmllWFJsVDJabWMyVjBJam8xTmpBc0luUmhjbWRsZENJNk16UTVOako5TEhzaVluVm1abVZ5SWpvd0xDSmllWFJsVEdWdVozUm9Jam8zTWl3aVlubDBaVTltWm5ObGRDSTZPRGsyTENKMFlYSm5aWFFpT2pNME9UWXpmVjBzSW1KMVptWmxjbk1pT2x0N0ltSjVkR1ZNWlc1bmRHZ2lPamsyT0gxZGZTRElBd0FBUWtsT0FFQU12ejhJdHBvOWZORWlQMEFNdno4SXRwbzlmTkVpUDBBTXZ6OEl0cG85Zk5FaVAxd2hIejhBdHBvOTI5Sk9QMXdoSHo4QXRwbzkyOUpPUDF3aEh6OEF0cG85MjlKT1Axd2hIejhBdHBvOTI5Sk9QNENBV0RjTHRwbzlBQUR2Tm9DQVdEY0x0cG85QUFEdk5vQ0FXRGNMdHBvOUFBRHZOb0NBV0RjTHRwbzlBQUR2Tm5mSmJUNEF0cG85NllmTlAzZkpiVDRBdHBvOTZZZk5QM2ZKYlQ0QXRwbzk2WWZOUDBBTXZ6ODRycWE5Zk5FaVAwQU12ejg0cnFhOWZORWlQMEFNdno4NHJxYTlmTkVpUDF3aEh6ODRycWE5MjlKT1Axd2hIejg0cnFhOTI5Sk9QMXdoSHo4NHJxYTkyOUpPUDF3aEh6ODRycWE5MjlKT1A0Q0FXRGN2cnFhOUFNRHVOb0NBV0RjdnJxYTlBTUR1Tm9DQVdEY3ZycWE5QU1EdU5vQ0FXRGN2cnFhOUFNRHVObmZKYlQ1QXJxYTk2WWZOUDNmSmJUNUFycWE5NllmTlAzZkpiVDVBcnFhOTZZZk5Qd0FBSUQ4QUFJQStBQUFnUHdBQWdENEFBQ0EvQUFDQVBnQUF3RDRBQUlBK0FBREFQZ0FBZ0Q0QUFNQStBQUNBUGdBQXdENEFBSUErQUFBZ1B3QUFBQUFBQUNBL0FBQUFBQUFBSUQ4QUFBQUFBQUFnUHdBQUFBQUFBTUErQUFBQUFBQUF3RDRBQUFBQUFBREFQZ0FBQUFBQUFDQS9BQUNBUGdBQUlEOEFBSUErQUFBZ1B3QUFnRDRBQU1BK0FBQ0FQZ0FBd0Q0QUFJQStBQURBUGdBQWdENEFBTUErQUFDQVBnQUFJRDhBQUFBQUFBQWdQd0FBQUFBQUFDQS9BQUFBQUFBQUlEOEFBQUFBQUFEQVBnQUFBQUFBQU1BK0FBQUFBQUFBd0Q0QUFBQUE4eThLc3dBQWdELzNwUTgwcUVaR1BnQUFBQUM1SjNzL3dyWElQaDFmZXpTRWdtdS84eThLc3dBQWdELzNwUTgwRW1uRk0vLy9mei9lSENrenFFWkdQZ0FBQUFDNUozcy9hZzltUHdBQUFBRElrdUErVWwxOXZ3QUFBQUJyamhJKzh5OEtzd0FBZ0QvM3BRODBFbW5GTS8vL2Z6L2VIQ2t6d3JYSVBoMWZlelNFZ211L1VsMTl2d0FBQUFCcmpoSStFbW5GTS8vL2Z6L2VIQ2t6YWc5bVB3QUFBQURJa3VBK0VHbEZzZ0FBZ0w4ZXZwcXpxRVpHUGdBQUFBQzVKM3Mvd3JYSVBoMWZlelNFZ211L3FPMGRzLy8vZjc5aVdhZXpFR2xGc2dBQWdMOGV2cHF6cUVaR1BnQUFBQUM1SjNzL2FnOW1Qd0FBQUFESWt1QStVbDE5dndBQUFBQnJqaEkrcU8wZHMvLy9mNzlpV2FlekVHbEZzZ0FBZ0w4ZXZwcXp3clhJUGgxZmV6U0VnbXUvVWwxOXZ3QUFBQUJyamhJK3FPMGRzLy8vZjc5aVdhZXphZzltUHdBQUFBRElrdUErQkFBSkFBd0FDQUFEQUFBQUVRQWFBQllBRndBT0FCSUFBZ0FRQUJnQUFnQVlBQW9BQndBVkFCa0FCd0FaQUFzQURRQWJBQlFBRFFBVUFBWUFCUUFUQUE4QUJRQVBBQUVBJwDzoevZDNEBE2N1cnNvckNvbnN0YW50U2NhbGUCBADzoevZDL6tAgE4JwDzoevZDNEBFWN1cnNvckluaXRpYWxEaXN0YW5jZQIEAPOh69kMwK0CAzIyNScA86Hr2QzRARBvbkFueUJvdHNDaGFuZ2VkAgQA86Hr2QzErQLmCEBjb25zdCBncmlkUG9ydGFsQm90SW5kZXggPSB0aGF0LmZpbmRJbmRleCgoZWwpID0+IHsKICAgIGlmIChlbCAmJiBnbG9iYWxUaGlzLmdyaWRQb3J0YWxCb3QgJiYgZWwuYm90ID09PSBncmlkUG9ydGFsQm90KSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0pOwoKaWYgKGdyaWRQb3J0YWxCb3RJbmRleCA+PSAwKSB7CiAgICBjb25zdCBjaGFuZ2VkVGFncyA9IHRoYXRbZ3JpZFBvcnRhbEJvdEluZGV4XS50YWdzOwogICAgY29uc3QgY2FtZXJhQ2hhbmdlZCA9IGNoYW5nZWRUYWdzLnNvbWUoKHQpID0+IHsKICAgICAgICByZXR1cm4gdCA9PT0gJ2NhbWVyYVBvc2l0aW9uWCcgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVBvc2l0aW9uWScgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVBvc2l0aW9uWicgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVBvc2l0aW9uT2Zmc2V0WCcgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVBvc2l0aW9uT2Zmc2V0WScgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVBvc2l0aW9uT2Zmc2V0eicgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVJvdGF0aW9uWCcgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVJvdGF0aW9uWScgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVJvdGF0aW9uWicgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVJvdGF0aW9uT2Zmc2V0WCcgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVJvdGF0aW9uT2Zmc2V0WScgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVJvdGF0aW9uT2Zmc2V0WicgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVJvdGF0aW9uT2Zmc2V0VycgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYUZvY3VzWCcgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYUZvY3VzWScgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYUZvY3VzWicgfHwKICAgICAgICAgICAgdCA9PT0gJ2NhbWVyYVpvb20nIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFab29tT2Zmc2V0JzsKICAgIH0pCgogICAgaWYgKGNhbWVyYUNoYW5nZWQpIHsKICAgICAgICBzaG91dCgnb25HcmlkUG9ydGFsQ2FtZXJhQ2hhbmdlZCcsIHsgY2hhbmdlZFRhZ3MgfSk7CiAgICB9Cn0nAPOh69kM0QEWZmxvYXRpbmdDdXJzb3JEaXN0YW5jZQIEAPOh69kMq7YCAzAuNycA86Hr2QzRAQlhYlZlcnNpb24CBADzoevZDK+2AgUxMC4zNQA="}]}