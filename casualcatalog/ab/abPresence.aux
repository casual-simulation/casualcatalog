{"version":2,"updates":[{"id":0,"timestamp":1767720956748,"update":"AULBydXSAQAnAQRib3RzJDdkM2ExNzAzLTBhMDEtNDY2Yi05NzRmLWFlOWYxMDAxYWM3OAEnAMHJ1dIBAAZzeXN0ZW0CBADBydXSAQETYWIucHJlc2VuY2UudmVyc2lvbicAwcnV0gEAFmFiUHJlc2VuY2VNaW5vclZlcnNpb24CBADBydXSARUBOCcAwcnV0gEAFmFiUHJlc2VuY2VNYWpvclZlcnNpb24CBADBydXSARcBMCcAwcnV0gEACGFiSWdub3JlAgQAwcnV0gEZBHRydWUnAMHJ1dIBAAphYlByZXNlbmNlAgQAwcnV0gEeBHRydWUnAMHJ1dIBAARmb3JtAgQAwcnV0gEjB25vdGhpbmcnAMHJ1dIBAA1vblNraWxsVXBkYXRlAgQAwcnV0gErngFAY29uc3QgdmVyc2lvblN0cmluZyA9IHRhZ3MuYWJQcmVzZW5jZU1ham9yVmVyc2lvbiArICIuIiArIHRhZ3MuYWJQcmVzZW5jZU1pbm9yVmVyc2lvbjsKCmNvbnNvbGUubG9nKCJbQUJQcmVzZW5jZV0gTG9hZGVkIEFCIHNoZWxsIHZlcnNpb24gIiArIHZlcnNpb25TdHJpbmcpOycAwcnV0gEACWFiVmVyc2lvbgIEAMHJ1dIBygEFMTAuMzUnAQRib3RzJDg3ZTk1MzQyLWU0NTYtNGI2My05ODkxLWQ3YTkyMWFkM2VlNwEnAMHJ1dIB0AEGc3lzdGVtAgQAwcnV0gHRARNhYi5wcmVzZW5jZS5tYW5hZ2VyJwDBydXSAdABCmFiUHJlc2VuY2UCBADBydXSAeUBBHRydWUnAMHJ1dIB0AEIYWJJZ25vcmUCBADBydXSAeoBBHRydWUnAMHJ1dIB0AEEZm9ybQIEAMHJ1dIB7wEHbm90aGluZycAwcnV0gHQAQpvbkJvdEFkZGVkAgQAwcnV0gH3ATdAaWYgKG9zLmlzQ29sbGFib3JhdGl2ZSgpKSB7CiAgICB0aGlzQm90LnN0YXJ0VGljaygpOwp9JwDBydXSAdABCXN0YXJ0VGljawIEAMHJ1dIBrwKwBUBpZiAobWFza3MudGlja0ludGVydmFsSWQpIHsKICAgIHJldHVybjsKfQoKaWYgKCFvcy5pc0NvbGxhYm9yYXRpdmUoKSkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbmNlbGluZyB0aWNrIHN0YXJ0IOKAlCB0aGUgaW5zdCBtdXN0IGJlIGNvbGxhYm9yYXRpdmUuYCk7CiAgICB9CgogICAgcmV0dXJuOwp9CgppZiAoIXRoaXNCb3QuZ2V0UHJlc2VuY2VFbmFibGVkKCkpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBjYW5jZWxpbmcgdGljayBzdGFydCDigJQgcHJlc2VuY2UgaXMgZGlzYWJsZWQuYCk7CiAgICB9CgogICAgcmV0dXJuOwp9CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzdGFydCBpbnRlcnZhbGApOwp9CgpmdW5jdGlvbiB0aWNrKCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19XSB0aWNrYCk7CiAgICB9CgogICAgd2hpc3Blcih0aGlzQm90LCAnb25UaWNrJyk7Cn0KCm1hc2tzLnRpY2tJbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwodGljaywgdGFncy50aWNrSW50ZXJ2YWxNUyk7CnRpY2soKTsnAMHJ1dIB0AEIc3RvcFRpY2sCBADBydXSAdwHxwFAaWYgKG1hc2tzLnRpY2tJbnRlcnZhbElkKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gc3RvcCBpbnRlcnZhbGApOwogICAgfQoKICAgIGNsZWFySW50ZXJ2YWwobWFza3MudGlja0ludGVydmFsSWQpOwogICAgbWFza3MudGlja0ludGVydmFsSWQgPSBudWxsOwp9JwDBydXSAdABDnRpY2tJbnRlcnZhbE1TAgQAwcnV0gGkCQMzMDAnAMHJ1dIB0AEFZGVidWcCBADBydXSAagJBWZhbHNlJwDBydXSAdABBm9uVGljawIEAMHJ1dIBrgn6KEBpZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzdGFydGApOwp9CgppZiAoIXRoaXNCb3QuZ2V0UHJlc2VuY2VFbmFibGVkKCkpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpZ25vcmluZyB0aWNrIOKAlCBwcmVzZW5jZSBpcyBkaXNhYmxlZC5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKCFjb25maWdCb3QpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpZ25vcmluZyB0aWNrIOKAlCB3YWl0aW5nIGZvciBjb25maWdCb3QgdG8gYmUgcmVhZHkuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCmlmICghZ2xvYmFsVGhpcy5hYikgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgZm9yIGFiIHRvIGJlIHJlYWR5LmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAoY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpZ25vcmluZyB0aWNrIOKAlCB3YWl0aW5nIHRvIGxlYXZlIHNoZWV0IHBvcnRhbC5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgdG8gbGVhdmUgc3lzdGVtIHBvcnRhbC5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKLy8gR2V0IGxpc3Qgb2YgcmVsZXZhbnQgcHJlc2VuY2UgZGF0YSBmcm9tIHBvcnRhbHMgJiBkaW1lbnNpb25zIHRoYXQgdGhlIHVzZXIgaXMgYWN0aXZlIGluLgpjb25zdCBwcmVzZW5jZURhdGFUb0VtaXQ6IEFCVXNlclByZXNlbmNlRGF0YVtdID0gW107Cgpjb25zdCByZW1vdGVOYW1lID0gdGhpc0JvdC5nZXRSZW1vdGVOYW1lKCk7CmNvbnN0IHJlbW90ZUNvbG9yID0gdGhpc0JvdC5nZXRSZW1vdGVDb2xvcigpOwoKLy8gTWFwIHBvcnRhbCBzaXRzIG9uIHRvcCB0aGUgZ3JpZCBwb3J0YWwgc28gb25seSBzZW5kIG1hcCBwb3J0YWwgY2FtZXJhIGlmIGl0cyBlbmFibGVkLgppZiAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsKSB7CiAgICBjb25zdCBwcmVzZW5jZURhdGE6IEFCVXNlclByZXNlbmNlRGF0YSA9IHsKICAgICAgICByZW1vdGVJZDogY29uZmlnQm90LmlkLAogICAgICAgIHJlbW90ZU5hbWUsCiAgICAgICAgcG9ydGFsOiAnbWFwJywKICAgICAgICBkaW1lbnNpb246IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCwKICAgICAgICBjb2xvcjogcmVtb3RlQ29sb3IKICAgIH0KCiAgICBpZiAodGFncy5jYW1lcmFFbmFibGVkKSB7CiAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYSA9IHsKICAgICAgICAgICAgY2FtZXJhVHlwZTogJ3BlcnNwZWN0aXZlJywKICAgICAgICAgICAgcG9zaXRpb246IG1hcFBvcnRhbEJvdC50YWdzLmNhbWVyYU1hcFBvc2l0aW9uLAogICAgICAgICAgICBxdWF0ZXJuaW9uOiBtYXBQb3J0YWxCb3QudGFncy5jYW1lcmFSb3RhdGlvbi5xdWF0ZXJuaW9uLAogICAgICAgICAgICB6b29tOiB1bmRlZmluZWQsCiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAodGFncy5jdXJzb3JFbmFibGVkKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gVE9ETzogYWRkIGN1cnNvciBkYXRhIGZvciBtYXAgcG9ydGFsYCk7CiAgICAgICAgfQogICAgfQoKICAgIGlmIChwcmVzZW5jZURhdGEuY2FtZXJhIHx8IHByZXNlbmNlRGF0YS5jdXJzb3IpIHsKICAgICAgICBwcmVzZW5jZURhdGFUb0VtaXQucHVzaChwcmVzZW5jZURhdGEpOwogICAgfQogICAgCn0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCkgewogICAgY29uc3QgcHJlc2VuY2VEYXRhOiBBQlVzZXJQcmVzZW5jZURhdGEgPSB7CiAgICAgICAgcmVtb3RlSWQ6IGNvbmZpZ0JvdC5pZCwKICAgICAgICByZW1vdGVOYW1lLAogICAgICAgIHBvcnRhbDogJ2dyaWQnLAogICAgICAgIGRpbWVuc2lvbjogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCwKICAgICAgICBjb2xvcjogcmVtb3RlQ29sb3IKICAgIH0KCiAgICBpZiAodGFncy5jYW1lcmFFbmFibGVkKSB7CiAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYSA9IHsKICAgICAgICAgICAgY2FtZXJhVHlwZTogZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENhbWVyYVR5cGUgPz8gJ29ydGhvZ3JhcGhpYycsCiAgICAgICAgICAgIHBvc2l0aW9uOiBncmlkUG9ydGFsQm90LnRhZ3MuY2FtZXJhUG9zaXRpb24sCiAgICAgICAgICAgIHF1YXRlcm5pb246IGdyaWRQb3J0YWxCb3QudGFncy5jYW1lcmFSb3RhdGlvbi5xdWF0ZXJuaW9uLAogICAgICAgICAgICB6b29tOiBncmlkUG9ydGFsQm90LnRhZ3MuY2FtZXJhWm9vbSwKICAgICAgICB9CiAgICB9CiAgICAKICAgIGlmICh0YWdzLmN1cnNvckVuYWJsZWQpIHsKICAgICAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgICAgICBjb25zb2xlLndhcm4oYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBUT0RPOiBhZGQgY3Vyc29yIGRhdGEgZm9yIGdyaWQgcG9ydGFsYCk7CiAgICAgICAgfQogICAgfQoKICAgIGlmIChwcmVzZW5jZURhdGEuY2FtZXJhIHx8IHByZXNlbmNlRGF0YS5jdXJzb3IpIHsKICAgICAgICBwcmVzZW5jZURhdGFUb0VtaXQucHVzaChwcmVzZW5jZURhdGEpOwogICAgfQp9CgovLyBNaW5pIG1hcCBwb3J0YWwgc2l0cyBvbiB0b3AgdGhlIG1pbmkgbWFwIHBvcnRhbCBzbyBvbmx5IHNlbmQgbWluaSBtYXAgcG9ydGFsIGNhbWVyYSBpZiBpdHMgZW5hYmxlZC4KaWYgKGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwpIHsKICAgIGNvbnN0IHByZXNlbmNlRGF0YTogQUJVc2VyUHJlc2VuY2VEYXRhID0gewogICAgICAgIHJlbW90ZUlkOiBjb25maWdCb3QuaWQsCiAgICAgICAgcmVtb3RlTmFtZSwKICAgICAgICBwb3J0YWw6ICdtaW5pTWFwJywKICAgICAgICBkaW1lbnNpb246IGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwsCiAgICAgICAgY29sb3I6IHJlbW90ZUNvbG9yCiAgICB9CgogICAgaWYgKHRhZ3MuY2FtZXJhRW5hYmxlZCkgewogICAgICAgIHByZXNlbmNlRGF0YS5jYW1lcmEgPSB7CiAgICAgICAgICAgIGNhbWVyYVR5cGU6ICdwZXJzcGVjdGl2ZScsCiAgICAgICAgICAgIHBvc2l0aW9uOiBtaW5pTWFwUG9ydGFsQm90LnRhZ3MuY2FtZXJhTWFwUG9zaXRpb24sCiAgICAgICAgICAgIHF1YXRlcm5pb246IG1pbmlNYXBQb3J0YWxCb3QudGFncy5jYW1lcmFSb3RhdGlvbi5xdWF0ZXJuaW9uLAogICAgICAgICAgICB6b29tOiB1bmRlZmluZWQsCiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAodGFncy5jdXJzb3JFbmFibGVkKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gVE9ETzogYWRkIGN1cnNvciBkYXRhIGZvciBtaW5pIG1hcCBwb3J0YWxgKTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHByZXNlbmNlRGF0YS5jYW1lcmEgfHwgcHJlc2VuY2VEYXRhLmN1cnNvcikgewogICAgICAgIHByZXNlbmNlRGF0YVRvRW1pdC5wdXNoKHByZXNlbmNlRGF0YSk7CiAgICB9Cgp9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsKSB7CiAgICBjb25zdCBwcmVzZW5jZURhdGE6IEFCVXNlclByZXNlbmNlRGF0YSA9IHsKICAgICAgICByZW1vdGVJZDogY29uZmlnQm90LmlkLAogICAgICAgIHJlbW90ZU5hbWUsCiAgICAgICAgcG9ydGFsOiAnbWluaUdyaWQnLAogICAgICAgIGRpbWVuc2lvbjogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCwKICAgICAgICBjb2xvcjogcmVtb3RlQ29sb3IKICAgIH0KCiAgICBpZiAodGFncy5jYW1lcmFFbmFibGVkKSB7CiAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYSA9IHsKICAgICAgICAgICAgY2FtZXJhVHlwZTogbWluaUdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxDYW1lcmFUeXBlID8/ICdvcnRob2dyYXBoaWMnLAogICAgICAgICAgICBwb3NpdGlvbjogbWluaUdyaWRQb3J0YWxCb3QudGFncy5jYW1lcmFQb3NpdGlvbiwKICAgICAgICAgICAgcXVhdGVybmlvbjogbWluaUdyaWRQb3J0YWxCb3QudGFncy5jYW1lcmFSb3RhdGlvbi5xdWF0ZXJuaW9uLAogICAgICAgICAgICB6b29tOiBtaW5pR3JpZFBvcnRhbEJvdC50YWdzLmNhbWVyYVpvb20sCiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAodGFncy5jdXJzb3JFbmFibGVkKSB7CiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gVE9ETzogYWRkIGN1cnNvciBkYXRhIGZvciBtaW5pIGdyaWQgcG9ydGFsYCk7CiAgICAgICAgfQogICAgfQoKICAgIGlmIChwcmVzZW5jZURhdGEuY2FtZXJhIHx8IHByZXNlbmNlRGF0YS5jdXJzb3IpIHsKICAgICAgICBwcmVzZW5jZURhdGFUb0VtaXQucHVzaChwcmVzZW5jZURhdGEpOwogICAgfQp9CgppZiAocHJlc2VuY2VEYXRhVG9FbWl0Lmxlbmd0aCA9PT0gMCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgdG8gYmUgaW4gYSBwb3J0YWwgd2l0aCBwcmVzZW5jZSBkYXRhLmApOwogICAgfQogICAgcmV0dXJuOwp9Cgpjb25zdCBvdGhlclJlbW90ZXMgPSAoYXdhaXQgb3MucmVtb3RlcygpKS5maWx0ZXIoaWQgPT4gaWQgIT09IGNvbmZpZ0JvdC5pZCk7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBwcmVzZW5jZURhdGFUb0VtaXQ6YCwgcHJlc2VuY2VEYXRhVG9FbWl0LCBgb3RoZXJSZW1vdGVzOmAsIG90aGVyUmVtb3Rlcyk7Cn0KCmlmIChvdGhlclJlbW90ZXMubGVuZ3RoID4gMCkgewogICAgc2VuZFJlbW90ZURhdGEob3RoZXJSZW1vdGVzLCAnYWJfdXNlcl9wcmVzZW5jZV9kYXRhJywgcHJlc2VuY2VEYXRhVG9FbWl0KTsKfQonAMHJ1dIB0AEMb25Cb3RDaGFuZ2VkAgQAwcnV0gGdMvICQGlmICh0aGF0LnRhZ3MuaW5jbHVkZXMoJ3RpY2tJbnRlcnZhbE1TJykpIHsKICAgIHRoaXNCb3Quc3RvcFRpY2soKTsKCiAgICBpZiAob3MuaXNDb2xsYWJvcmF0aXZlKCkgJiYgdGhpc0JvdC5nZXRQcmVzZW5jZUVuYWJsZWQoKSkgewogICAgICAgIHRoaXNCb3Quc3RhcnRUaWNrKCk7CiAgICB9Cn0gZWxzZSBpZiAodGhhdC50YWdzLnNvbWUoKHQpID0+IHQgPT09ICdjdXJzb3JFbmFibGVkJyB8fCB0ID09PSAnY2FtZXJhRW5hYmxlZCcpKSB7CiAgICBpZiAodGhpc0JvdC5nZXRQcmVzZW5jZUVuYWJsZWQoKSkgewogICAgICAgIHRoaXNCb3Quc3RhcnRUaWNrKCk7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXNCb3Quc3RvcFRpY2soKTsKICAgIH0KfScAwcnV0gHQAQxvblJlbW90ZURhdGECBADBydXSAZA1+gNAaWYgKCF0aGlzQm90LmdldFByZXNlbmNlRW5hYmxlZCgpKSB7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0Lm5hbWUgPT09ICdhYl91c2VyX3ByZXNlbmNlX2RhdGEnKSB7CiAgICBjb25zdCBkYXRhOiBBQlVzZXJQcmVzZW5jZURhdGEgfCBBQlVzZXJQcmVzZW5jZURhdGFbXSA9IHRoYXQudGhhdDsKCiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYWJfdXNlcl9wcmVzZW5jZV9kYXRhIGRhdGE6YCwgZGF0YSk7CiAgICB9CgogICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGhpc0JvdC5vbkFCVXNlclByZXNlbmNlRGF0YVJlY2VpdmVkKGRhdGFbaV0pOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc0JvdC5vbkFCVXNlclByZXNlbmNlRGF0YVJlY2VpdmVkKGRhdGEpOwogICAgfQp9CicAwcnV0gHQAQV0eXBlcwIEAMHJ1dIBizm8CfCfk4RpbnRlcmZhY2UgQUJVc2VyUHJlc2VuY2VEYXRhIHsKICAgIC8qKiBSZW1vdGUgaWQgb2YgdGhlIHVzZXIgdGhlIHByZXNlbmNlIGRhdGEgaXMgZm9yLiAqLwogICAgcmVtb3RlSWQ6IHN0cmluZzsKCiAgICAvKiogQ2FuIGVpdGhlciBiZSB1c2VyJ3MgZGlzcGxheSBuYW1lIG9yIGEgc2hvcnRlbmVkIGxvY2FsIHVzZXIgaWQuICoqLwogICAgcmVtb3RlTmFtZTogc3RyaW5nOwoKICAgIC8qKiBQb3J0YWwgdGhhdCB0aGUgcHJlc2VuY2UgZGF0YSBpcyBmb3IuICovCiAgICBwb3J0YWw6IHN0cmluZzsKCiAgICAvKiogRGltZW5zaW9uIHRoYXQgdGhlIHByZXNlbmNlIGRhdGEgaXMgZm9yLiAqKi8KICAgIGRpbWVuc2lvbjogc3RyaW5nOwoKICAgIC8qKiBDb2xvciBvZiB0aGUgdXNlci4gKi8KICAgIGNvbG9yOiBzdHJpbmc7CgogICAgY2FtZXJhPzogQUJVc2VyUHJlc2VuY2VDYW1lcmFEYXRhOwogICAgY3Vyc29yPzogQUJVc2VyUHJlc2VuY2VDdXJzb3JEYXRhOwp9CgppbnRlcmZhY2UgQUJVc2VyUHJlc2VuY2VDYW1lcmFEYXRhIHsKICAgIC8qKiBUeXBlIG9mIHRoZSBjYW1lcmEgdGhhdCB0aGUgZGF0YSBpcyBmb3IuICovCiAgICBjYW1lcmFUeXBlOiAncGVyc3BlY3RpdmUnIHwgJ29ydGhvZ3JhcGhpYyc7CiAgICAKICAgIC8qKiBUaGUgcG9zaXRpb24gb2YgdGhlIGNhbWVyYS4gKiovCiAgICBwb3NpdGlvbjogeyB4OiBudW1iZXIsIHk6IG51bWJlciwgejogbnVtYmVyIH07CgogICAgLyoqIFRoZSByb3RhdGlvbiBxdWF0ZXJuaW9uIG9mIHRoZSBjYW1lcmEuICoqLwogICAgcXVhdGVybmlvbjogeyB4OiBudW1iZXIsIHk6IG51bWJlciwgejogbnVtYmVyLCB3OiBudW1iZXIgfTsKCiAgICAvKiogVGhlIHpvb20gdmxhdWUgdGhhdCB0aGUgY2FtZXJhIGlzIGF0LiBUaGlzIGlzIG9ubHkgcmVsZXZhbnQgZm9yIG9ydGhvZ3JhcGhpYyBjYW1lcmFzLiAgKi8KICAgIHpvb20/OiBudW1iZXI7Cn0KCmludGVyZmFjZSBBQlVzZXJQcmVzZW5jZUN1cnNvckRhdGEgewogICAgLyoqIFRoZSB0eXBlIG9mIHRoZSBwb2ludGVyIHRoYXQgdGhlIGRhdGEgaXMgZm9yLiAqLwogICAgcG9pbnRlclR5cGU6ICdtb3VzZScgfCAnbGVmdCcgfCAncmlnaHQnIHwgJ3RvdWNoJzsKICAgIAogICAgLyoqIFRoZSBwb3NpdGlvbiBvZiB0aGUgY3Vyc29yLiAqKi8KICAgIHBvc2l0aW9uOiB7IHg6IG51bWJlciwgeTogbnVtYmVyLCB6OiBudW1iZXIgfTsKfScAwcnV0gHQARJjYW1lcmFCb3RUaW1lb3V0TVMCBADBydXSAcZCBDMwMDAnAMHJ1dIB0AELaW50ZXJwb2xhdGUCBADBydXSActCBHRydWUnAMHJ1dIB0AEGdGlja2VyAgQAwcnV0gHQQijwn5SXNWMxOWJjOWYtYzY4ZC00M2M3LWJlMzQtMzYwMjFmN2U0ZGQzJwDBydXSAdABCWFiVmVyc2lvbgIEAMHJ1dIB90IFMTAuMzUnAMHJ1dIB0AEOZ2V0UmVtb3RlQ29sb3ICBADBydXSAf1CzQFAaWYgKCFtYXNrcy5yZW1vdGVDb2xvcikgewogICAgbWF0aC5zZXRSYW5kb21TZWVkKGNvbmZpZ0JvdC5pZCk7CiAgICBtYXNrcy5yZW1vdGVDb2xvciA9IGByZ2IoJHttYXRoLnJhbmRvbUludCgwLCAyNTUpfSwgJHttYXRoLnJhbmRvbUludCgwLCAyNTUpfSwgJHttYXRoLnJhbmRvbUludCgwLCAyNTUpfSlgOwp9CgpyZXR1cm4gbWFza3MucmVtb3RlQ29sb3I7JwDBydXSAdABDWdldFJlbW90ZU5hbWUCBADBydXSActEzwJALy8gVGhlIG5hbWUgdGhhdCB0aGlzIHJlbW90ZSBpcyB0byBiZSBrbm93biBhcyB0byBvdGhlciB1c2Vycy4KbGV0IHJlbW90ZU5hbWU7CgppZiAoYWIubGlua3MuY29uc29sZS5tYXNrcy5wcmVmZXJyZWROYW1lKSB7CiAgICByZW1vdGVOYW1lID0gYWIubGlua3MuY29uc29sZS5tYXNrcy5wcmVmZXJyZWROYW1lOwp9IGVsc2UgaWYgKGF1dGhCb3QgJiYgYXV0aEJvdC50YWdzLm5hbWUpIHsKICAgIHJlbW90ZU5hbWUgPSBhdXRoQm90LnRhZ3MubmFtZTsKfSBlbHNlIHsKICAgIHJlbW90ZU5hbWUgPSBjb25maWdCb3QuaWQuc3Vic3RyaW5nKDAsNSk7Cn0KCnJldHVybiByZW1vdGVOYW1lOycAwcnV0gHQARJjdXJzb3JCb3RUaW1lb3V0TVMCBADBydXSAZtHBDMwMDAnAMHJ1dIB0AENY2FtZXJhRW5hYmxlZAIEAMHJ1dIBoEcFZmFsc2UnAMHJ1dIB0AENY3Vyc29yRW5hYmxlZAIEAMHJ1dIBpkcFZmFsc2UnAMHJ1dIB0AESZ2V0UHJlc2VuY2VFbmFibGVkAgQAwcnV0gGsRzFAcmV0dXJuIHRhZ3MuY3Vyc29yRW5hYmxlZCB8fCB0YWdzLmNhbWVyYUVuYWJsZWQ7JwDBydXSAdABHG9uQUJVc2VyUHJlc2VuY2VEYXRhUmVjZWl2ZWQCBADBydXSAd5HtzxAY29uc3QgcHJlc2VuY2VEYXRhOiBBQlVzZXJQcmVzZW5jZURhdGEgPSB0aGF0OwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gcHJlc2VuY2VEYXRhOmAsIHByZXNlbmNlRGF0YSkKfQoKaWYgKHByZXNlbmNlRGF0YS5jYW1lcmEpIHsKICAgIGNvbnN0IHNob3V0UmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChzaG91dCgnb25BQlVzZXJDYW1lcmFVcGRhdGUnLCBwcmVzZW5jZURhdGEpKTsKICAgIGNvbnN0IGNhbWVyYVVwZGF0ZWQgPSBzaG91dFJlc3VsdHMubGVuZ3RoID4gMCAmJiBzaG91dFJlc3VsdHMuc29tZShyID0+IHIudmFsdWUgPT09IHRydWUpOwogICAgCiAgICBpZiAoIWNhbWVyYVVwZGF0ZWQpIHsKICAgICAgICAvLyBUaGVyZSB3YXMgbm8gdXNlciBjYW1lcmEgdGhhdCBhY2NlcHRlZCB0aGUgdXBkYXRlLCBuZWVkIHRvIGNyZWF0ZSBhIG5ldyBvbmUuCgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gbWFrZSB1c2VyIGNhbWVyYTpgLCBwcmVzZW5jZURhdGEpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgdXNlckNhbWVyYUJvdCA9IGNyZWF0ZSh7CiAgICAgICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgICAgICAgICAgYWJCb3Q6IHRydWUsCiAgICAgICAgICAgIGFiVXNlckNhbWVyYTogdHJ1ZSwKICAgICAgICAgICAgbWFuYWdlcjogZ2V0TGluayh0aGlzQm90KSwKICAgICAgICAgICAgZm9ybTogJ2ZydXN0dW0nLAogICAgICAgICAgICBhbmNob3JQb2ludDogJ2NlbnRlcicsCiAgICAgICAgICAgIHJlbW90ZUlkOiBwcmVzZW5jZURhdGEucmVtb3RlSWQsCiAgICAgICAgICAgIHJlbW90ZU5hbWU6IHByZXNlbmNlRGF0YS5yZW1vdGVOYW1lLAogICAgICAgICAgICBwb3J0YWw6IHByZXNlbmNlRGF0YS5wb3J0YWwsCiAgICAgICAgICAgIGRpbWVuc2lvbjogcHJlc2VuY2VEYXRhLmRpbWVuc2lvbiwKICAgICAgICAgICAgW3ByZXNlbmNlRGF0YS5kaW1lbnNpb25dOiB0cnVlLAogICAgICAgICAgICBwb2ludGFibGU6IGZhbHNlLAogICAgICAgICAgICBsYWJlbFBvc2l0aW9uOiAnZmxvYXRpbmdCaWxsYm9hcmQnLAogICAgICAgICAgICAvLyBsYWJlbFNpemU6IDAuMjgsCiAgICAgICAgICAgIC8vIGxhYmVsU2l6ZU1vZGU6ICdhdXRvJywKICAgICAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChsaW5rcy5tYW5hZ2VyLnRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW2FiVXNlckNhbWVyYS4ke3RhZ05hbWV9ICgke3RhZ3MucmVtb3RlTmFtZX0pXWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgb25BQlVzZXJDYW1lcmFVcGRhdGU6IExpc3RlbmVyU3RyaW5nKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZXNlbmNlRGF0YTogQUJVc2VyUHJlc2VuY2VEYXRhID0gdGhhdDsKCiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgaW5jb21pbmcgdXBkYXRlIGlzIGZvciB0aGlzIGJvdC4KICAgICAgICAgICAgICAgIGlmIChwcmVzZW5jZURhdGEucmVtb3RlSWQgIT09IHRhZ3MucmVtb3RlSWQgfHwKICAgICAgICAgICAgICAgICAgICBwcmVzZW5jZURhdGEucG9ydGFsICE9PSB0YWdzLnBvcnRhbCB8fAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlRGF0YS5kaW1lbnNpb24gIT09IHRhZ3MuZGltZW5zaW9uCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQ2xlYXIgb2xkIHRpbWVvdXQuCiAgICAgICAgICAgICAgICBpZiAodGhpc0JvdC52YXJzLnRpbWVvdXRJZCkgewogICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzQm90LnZhcnMudGltZW91dElkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMudGltZW91dElkID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAobGlua3MubWFuYWdlci50YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFthYlVzZXJDYW1lcmEuJHt0YWdOYW1lfSAoJHt0YWdzLnJlbW90ZU5hbWV9KV0gcHJlc2VuY2VEYXRhOmAsIHByZXNlbmNlRGF0YSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZ3MubGFiZWwgIT09IHByZXNlbmNlRGF0YS5yZW1vdGVOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdGFncy5sYWJlbCA9IHByZXNlbmNlRGF0YS5yZW1vdGVOYW1lOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmNvbG9yICE9PSBwcmVzZW5jZURhdGEuY29sb3IpIHsKICAgICAgICAgICAgICAgICAgICB0YWdzLmNvbG9yID0gcHJlc2VuY2VEYXRhLmNvbG9yOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0YWdzLmxhYmVsRmxvYXRpbmdCYWNrZ3JvdW5kQ29sb3IgIT09IHByZXNlbmNlRGF0YS5jb2xvcil7IAogICAgICAgICAgICAgICAgICAgIHRhZ3MubGFiZWxGbG9hdGluZ0JhY2tncm91bmRDb2xvciA9IHByZXNlbmNlRGF0YS5jb2xvcjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjbGFtcDAxKHQ6IG51bWJlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCB0KSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gem9vbVRvVCh6b29tOiBudW1iZXIsIHpvb21NaW46IG51bWJlciwgem9vbU1heDogbnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gdD0wIGF0IHpvb21NaW4sIHQ9MSBhdCB6b29tTWF4CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeiA9IE1hdGgubWF4KHpvb20sIDFlLTYpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBNYXRoLmxvZyh6b29tTWluKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gTWF0aC5sb2coem9vbU1heCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IChNYXRoLmxvZyh6KSAtIGEpIC8gKGIgLSBhKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xhbXAwMSh2KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBsZXJwKGE6IG51bWJlciwgYjogbnVtYmVyLCB0OiBudW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSArIChiIC0gYSkgKiB0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIE9wdGlvbmFsIHNtb290aGluZyBzbyBpdCBkb2VzbuKAmXQgZmVlbCBsaW5lYXIgLyBoYXJzaDoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNtb290aHN0ZXAodDogbnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQgKiB0ICogKDMgLSAyICogdCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gdD0wIGF0IHpvb21NaW4gKHpvb21lZCBvdXQpLCB0PTEgYXQgem9vbU1heCAoem9vbWVkIGluKQogICAgICAgICAgICAgICAgZnVuY3Rpb24gYXBwbHlFYXNlKHQ6IG51bWJlciwgZXhwb25lbnQ6IG51bWJlcikgewogICAgICAgICAgICAgICAgICAgIC8vIGV4cG9uZW50IDwgMSBzbG93cyBkb3duIHRoZSDigJxtb3ZlIGF3YXnigJ0gd2hlbiB6b29taW5nIG91dAogICAgICAgICAgICAgICAgICAgIC8vIChtYWtlcyBjdXJ2ZSBnZW50bGVyIG5lYXIgdD0wKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnBvdyhzbW9vdGhzdGVwKHQpLCBleHBvbmVudCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYXN5bmMgZnVuY3Rpb24gZ2V0Vml6Q2FtZXJhUG9zZSgKICAgICAgICAgICAgICAgICAgICBjYW1lcmFQb3NpdGlvbjogeyB4OiBudW1iZXI7IHk6IG51bWJlcjsgejogbnVtYmVyIH0sCiAgICAgICAgICAgICAgICAgICAgY2FtZXJhUm90YXRpb246IHsgeDogbnVtYmVyOyB5OiBudW1iZXI7IHo6IG51bWJlcjsgdzogbnVtYmVyIH0sCiAgICAgICAgICAgICAgICAgICAgY2FtZXJhVHlwZTogJ29ydGhvZ3JhcGhpYycgfCAncGVyc3BlY3RpdmUnLAogICAgICAgICAgICAgICAgICAgIGNhbWVyYVpvb206IG51bWJlciB8IG51bGwgfCB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgem9vbU1pbiA9IDAuNCwKICAgICAgICAgICAgICAgICAgICB6b29tTWF4ID0gODAsCiAgICAgICAgICAgICAgICAgICAgZmFyRGlzdCA9IDMwLAogICAgICAgICAgICAgICAgICAgIG5lYXJEaXN0ID0gMiwKICAgICAgICAgICAgICAgICAgICBleHBvbmVudCA9IDAuNSwKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IG5ldyBWZWN0b3IzKGNhbWVyYVBvc2l0aW9uLngsIGNhbWVyYVBvc2l0aW9uLnksIGNhbWVyYVBvc2l0aW9uLnopOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxldCByb3Q7CiAgICAgICAgICAgICAgICAgICAgaWYgKChjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uIHx8IGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPT09IHRhZ3MuZGltZW5zaW9uKSAmJiBjYW1lcmFUeXBlID09PSAncGVyc3BlY3RpdmUnKSB7IAogICAgICAgICAgICAgICAgICAgICAgICByb3QgPSBhd2FpdCBhYi5saW5rcy51dGlscy5jYWxjTWFwUm90YXRpb24oeyBtYXBQb3NpdGlvbjogY2FtZXJhUG9zaXRpb24sIGF1eFJvdGF0aW9uOiBuZXcgUm90YXRpb24oeyBxdWF0ZXJuaW9uOiBjYW1lcmFSb3RhdGlvbiB9KX0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdCA9IG5ldyBSb3RhdGlvbih7IHF1YXRlcm5pb246IGNhbWVyYVJvdGF0aW9uIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9yd2FyZCA9IHJvdC5yb3RhdGVWZWN0b3IzKG5ldyBWZWN0b3IzKDAsIDEsIDApKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbWVyYVR5cGUgPT09ICdwZXJzcGVjdGl2ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgcG9zaXRpb246IHBvcywgcm90YXRpb246IHJvdCB9OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgem9vbSA9IE1hdGgubWF4KGNhbWVyYVpvb20gPz8gMTAsIDFlLTYpOwoKICAgICAgICAgICAgICAgICAgICBsZXQgdCA9IHpvb21Ub1Qoem9vbSwgem9vbU1pbiwgem9vbU1heCk7CiAgICAgICAgICAgICAgICAgICAgdCA9IGFwcGx5RWFzZSh0LCBleHBvbmVudCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBsZXJwKGZhckRpc3QsIG5lYXJEaXN0LCB0KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2aXpQb3MgPSBwb3Muc3VidHJhY3QoZm9yd2FyZC5tdWx0aXBseVNjYWxhcihkKSk7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHBvc2l0aW9uOiB2aXpQb3MsIHJvdGF0aW9uOiByb3QsIGRlYnVnOiB7IHQsIGQsIHpvb20gfSB9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHBvc2UgPSBhd2FpdCBnZXRWaXpDYW1lcmFQb3NlKAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlRGF0YS5jYW1lcmEucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYS5xdWF0ZXJuaW9uLAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlRGF0YS5jYW1lcmEuY2FtZXJhVHlwZSwKICAgICAgICAgICAgICAgICAgICBwcmVzZW5jZURhdGEuY2FtZXJhLnpvb20sCiAgICAgICAgICAgICAgICAgICAgMC40LAogICAgICAgICAgICAgICAgICAgIDgwLAogICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgLTQyNywKICAgICAgICAgICAgICAgICAgICAwLjEsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGNvbnN0IHBvc1RhZ05hbWUgPSB0YWdzLmRpbWVuc2lvbiArICdQb3NpdGlvbic7CiAgICAgICAgICAgICAgICBjb25zdCByb3RUYWdOYW1lID0gdGFncy5kaW1lbnNpb24gKyAnUm90YXRpb24nOwoKICAgICAgICAgICAgICAgIGNsZWFyQW5pbWF0aW9ucyh0aGlzQm90LCBbcG9zVGFnTmFtZSwgcm90VGFnTmFtZV0pOwoKICAgICAgICAgICAgICAgIGlmIChsaW5rcy5tYW5hZ2VyLnRhZ3MuaW50ZXJwb2xhdGUgJiYgdGFnc1twb3NUYWdOYW1lXSAmJiB0YWdzW3JvdFRhZ05hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZVRhZyh0aGlzQm90LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgW3Bvc1RhZ05hbWVdOiB0YWdzW3Bvc1RhZ05hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgW3JvdFRhZ05hbWVdOiB0YWdzW3JvdFRhZ05hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcG9zVGFnTmFtZV06IHBvc2UucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcm90VGFnTmFtZV06IHBvc2Uucm90YXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBsaW5rcy5tYW5hZ2VyLnRhZ3MudGlja0ludGVydmFsTVMgLyAxMDAwLAogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHt9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWFza3NbcG9zVGFnTmFtZV0gPSBwb3NlLnBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIG1hc2tzW3JvdFRhZ05hbWVdID0gcG9zZS5yb3RhdGlvbjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBTZXQgbmV3IHRpbWVvdXQuCiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMudGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiBkZXN0cm95KHRoaXNCb3QpLCBsaW5rcy5tYW5hZ2VyLnRhZ3MuY2FtZXJhQm90VGltZW91dE1TKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbYWJVc2VyQ2FtZXJhLiR7dGFnTmFtZX0gKCR7dGFncy5yZW1vdGVOYW1lfSldYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSkKCiAgICAgICAgLy8gRGlyZWN0bHkgY2FsbCBvbkFCVXNlckNhbWVyYVVwZGF0ZSB0aGUgZmlyc3QgdGltZSB3ZSBtYWtlIGEgbmV3IHVzZXIgY2FtZXJhIGJvdC4KICAgICAgICBhd2FpdCB1c2VyQ2FtZXJhQm90Lm9uQUJVc2VyQ2FtZXJhVXBkYXRlKHByZXNlbmNlRGF0YSk7CiAgICB9Cn0KCmlmIChwcmVzZW5jZURhdGEuY3Vyc29yKSB7CiAgICBjb25zb2xlLndhcm4oYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBUT0RPOiB1cGRhdGUvY3JlYXRlIGN1cnNvciBib3RgKQp9AA=="}]}