{"version":2,"updates":[{"id":0,"timestamp":1768938684706,"update":"AWL6+pCmBgAnAQRib3RzJDdkM2ExNzAzLTBhMDEtNDY2Yi05NzRmLWFlOWYxMDAxYWM3OAEnAPr6kKYGAAZzeXN0ZW0CBAD6+pCmBgETYWIucHJlc2VuY2UudmVyc2lvbicA+vqQpgYAFmFiUHJlc2VuY2VNaW5vclZlcnNpb24CBAD6+pCmBhUCMTMnAPr6kKYGABZhYlByZXNlbmNlTWFqb3JWZXJzaW9uAgQA+vqQpgYYATAnAPr6kKYGAAhhYklnbm9yZQIEAPr6kKYGGgR0cnVlJwD6+pCmBgAKYWJQcmVzZW5jZQIEAPr6kKYGHwR0cnVlJwD6+pCmBgAEZm9ybQIEAPr6kKYGJAdub3RoaW5nJwD6+pCmBgANb25Ta2lsbFVwZGF0ZQIEAPr6kKYGLJ4BQGNvbnN0IHZlcnNpb25TdHJpbmcgPSB0YWdzLmFiUHJlc2VuY2VNYWpvclZlcnNpb24gKyAiLiIgKyB0YWdzLmFiUHJlc2VuY2VNaW5vclZlcnNpb247Cgpjb25zb2xlLmxvZygiW0FCUHJlc2VuY2VdIExvYWRlZCBBQiBzaGVsbCB2ZXJzaW9uICIgKyB2ZXJzaW9uU3RyaW5nKTsnAPr6kKYGAAlhYlZlcnNpb24CBAD6+pCmBssBBTEwLjM1JwEEYm90cyQ4N2U5NTM0Mi1lNDU2LTRiNjMtOTg5MS1kN2E5MjFhZDNlZTcBJwD6+pCmBtEBBnN5c3RlbQIEAPr6kKYG0gETYWIucHJlc2VuY2UubWFuYWdlcicA+vqQpgbRAQphYlByZXNlbmNlAgQA+vqQpgbmAQR0cnVlJwD6+pCmBtEBCGFiSWdub3JlAgQA+vqQpgbrAQR0cnVlJwD6+pCmBtEBBGZvcm0CBAD6+pCmBvABB25vdGhpbmcnAPr6kKYG0QEKb25Cb3RBZGRlZAIEAPr6kKYG+AGFAUAvKiogQHR5cGUgQUJVc2VyUHJlc2VuY2VRdWV1ZWRDdXJzb3JEYXRhW10gKi8KdGhpc0JvdC52YXJzLmN1cnNvclF1ZXVlID0gW107CgppZiAob3MuaXNDb2xsYWJvcmF0aXZlKCkpIHsKICAgIHRoaXNCb3Quc3RhcnRUaWNrKCk7Cn0nAPr6kKYG0QEJc3RhcnRUaWNrAgQA+vqQpgb+ArAFQGlmIChtYXNrcy50aWNrSW50ZXJ2YWxJZCkgewogICAgcmV0dXJuOwp9CgppZiAoIW9zLmlzQ29sbGFib3JhdGl2ZSgpKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gY2FuY2VsaW5nIHRpY2sgc3RhcnQg4oCUIHRoZSBpbnN0IG11c3QgYmUgY29sbGFib3JhdGl2ZS5gKTsKICAgIH0KCiAgICByZXR1cm47Cn0KCmlmICghdGhpc0JvdC5nZXRQcmVzZW5jZUVuYWJsZWQoKSkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGNhbmNlbGluZyB0aWNrIHN0YXJ0IOKAlCBwcmVzZW5jZSBpcyBkaXNhYmxlZC5gKTsKICAgIH0KCiAgICByZXR1cm47Cn0KCmlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHN0YXJ0IGludGVydmFsYCk7Cn0KCmZ1bmN0aW9uIHRpY2soKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX1dIHRpY2tgKTsKICAgIH0KCiAgICB3aGlzcGVyKHRoaXNCb3QsICdvblRpY2snKTsKfQoKbWFza3MudGlja0ludGVydmFsSWQgPSBzZXRJbnRlcnZhbCh0aWNrLCB0YWdzLnRpY2tJbnRlcnZhbE1TKTsKdGljaygpOycA+vqQpgbRAQhzdG9wVGljawIEAPr6kKYGqwjHAUBpZiAobWFza3MudGlja0ludGVydmFsSWQpIHsKICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBzdG9wIGludGVydmFsYCk7CiAgICB9CgogICAgY2xlYXJJbnRlcnZhbChtYXNrcy50aWNrSW50ZXJ2YWxJZCk7CiAgICBtYXNrcy50aWNrSW50ZXJ2YWxJZCA9IG51bGw7Cn0nAPr6kKYG0QEOdGlja0ludGVydmFsTVMCBAD6+pCmBvMJAzMwMCcA+vqQpgbRAQVkZWJ1ZwIEAPr6kKYG9wkFZmFsc2UnAPr6kKYG0QEGb25UaWNrAgQA+vqQpgb9CeI9QGlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHN0YXJ0YCk7Cn0KCmlmICghdGhpc0JvdC5nZXRQcmVzZW5jZUVuYWJsZWQoKSkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHByZXNlbmNlIGlzIGRpc2FibGVkLmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAoIWNvbmZpZ0JvdCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgZm9yIGNvbmZpZ0JvdCB0byBiZSByZWFkeS5gKTsKICAgIH0KICAgIHJldHVybjsKfQoKaWYgKCFnbG9iYWxUaGlzLmFiKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaWdub3JpbmcgdGljayDigJQgd2FpdGluZyBmb3IgYWIgdG8gYmUgcmVhZHkuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KCmlmIChjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgdG8gbGVhdmUgc2hlZXQgcG9ydGFsLmApOwogICAgfQogICAgcmV0dXJuOwp9CgppZiAoY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsKSB7CiAgICBpZiAodGFncy5kZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gaWdub3JpbmcgdGljayDigJQgd2FpdGluZyB0byBsZWF2ZSBzeXN0ZW0gcG9ydGFsLmApOwogICAgfQogICAgcmV0dXJuOwp9CgovLyBHZXQgbGlzdCBvZiByZWxldmFudCBwcmVzZW5jZSBkYXRhIGZyb20gcG9ydGFscyAmIGRpbWVuc2lvbnMgdGhhdCB0aGUgdXNlciBpcyBhY3RpdmUgaW4uCmNvbnN0IHByZXNlbmNlRGF0YVRvRW1pdDogQUJVc2VyUHJlc2VuY2VEYXRhW10gPSBbXTsKCi8vIE1ha2UgYSBjb3B5IG9mIHRoZSBjdXJyZW50IGN1cnNvciBxdWV1ZSBhbmQgcmVzZXQgaXQuIEN1cnJlbnQgY3Vyc29yIHF1ZXVlIHdpbGwgYmUgcHJvY2Vzc2VkIGluIHRoaXMgdGljay4KY29uc3QgY3Vyc29yUXVldWU6IEFCVXNlclByZXNlbmNlUXVldWVkQ3Vyc29yRGF0YVtdID0gWy4uLih0aGlzQm90LnZhcnMuY3Vyc29yUXVldWUgPz8gW10pXTsKdGhpc0JvdC52YXJzLmN1cnNvclF1ZXVlID0gW107Cgphc3luYyBmdW5jdGlvbiB0cnlHZW5lcmF0ZVByZXNlbmNlRGF0YUZvclBvcnRhbChwb3J0YWw6IHN0cmluZyk6IEFCVXNlclByZXNlbmNlRGF0YSB8IG51bGwgewogICAgY29uc3QgaW5NYXAgPSBwb3J0YWwgPT09ICdtYXAnIHx8IHBvcnRhbCA9PT0gJ21pbmlNYXAnOwogICAgY29uc3QgZGltZW5zaW9uID0gb3MuZ2V0UG9ydGFsRGltZW5zaW9uKHBvcnRhbCk7CiAgICBjb25zdCBwb3J0YWxCb3QgPSBnbG9iYWxUaGlzW3BvcnRhbCArICdQb3J0YWxCb3QnXTsKCiAgICBpZiAoIXBvcnRhbCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGlmICghZGltZW5zaW9uKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgaWYgKCFwb3J0YWxCb3QpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9LnRyeUdlbmVyYXRlUHJlc2VuY2VEYXRhRm9yUG9ydGFsXSB1bmFibGUgdG8gZmluZCAke3BvcnRhbH0gcG9ydGFsIGJvdC5gKTsKICAgIH0KICAgIAogICAgY29uc3QgcHJlc2VuY2VEYXRhOiBBQlVzZXJQcmVzZW5jZURhdGEgPSB7CiAgICAgICAgcmVtb3RlSWQ6IGNvbmZpZ0JvdC5pZCwKICAgICAgICByZW1vdGVOYW1lOiB0aGlzQm90LmdldFJlbW90ZU5hbWUoKSwKICAgICAgICBwb3J0YWwsCiAgICAgICAgZGltZW5zaW9uLAogICAgICAgIGNvbG9yOiB0aGlzQm90LmdldFJlbW90ZUNvbG9yKCksCiAgICAgICAgY2FtZXJhOiB1bmRlZmluZWQsCiAgICAgICAgY3Vyc29yczogdW5kZWZpbmVkLAogICAgfQoKICAgIGNvbnN0IGNhbWVyYVN1cHBvcnRlZCA9IHBvcnRhbCA9PT0gJ2dyaWQnIHx8IHBvcnRhbCA9PT0gJ21pbmlHcmlkJyB8fCBwb3J0YWwgPT09ICdtYXAnIHx8IHBvcnRhbCA9PT0gJ21pbmlNYXAnOwoKICAgIGlmICh0YWdzLmNhbWVyYUVuYWJsZWQgJiYgY2FtZXJhU3VwcG9ydGVkKSB7CiAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYSA9IHsKICAgICAgICAgICAgY2FtZXJhVHlwZTogaW5NYXAgPyAncGVyc3BlY3RpdmUnIDogKHBvcnRhbEJvdC50YWdzLnBvcnRhbENhbWVyYVR5cGUgPz8gJ29ydGhvZ3JhcGhpYycpLAogICAgICAgICAgICBwb3NpdGlvbjogaW5NYXAgPyBwb3J0YWxCb3QudGFncy5jYW1lcmFNYXBQb3NpdGlvbiA6IHBvcnRhbEJvdC50YWdzLmNhbWVyYVBvc2l0aW9uLAogICAgICAgICAgICBxdWF0ZXJuaW9uOiBwb3J0YWxCb3QudGFncy5jYW1lcmFSb3RhdGlvbi5xdWF0ZXJuaW9uLAogICAgICAgICAgICB6b29tOiBwb3J0YWxCb3QudGFncy5jYW1lcmFab29tLAogICAgICAgIH07CiAgICB9CgogICAgY29uc3QgY3Vyc29yU3VwcG9ydGVkID0gcG9ydGFsID09PSAnZ3JpZCcgfHwgcG9ydGFsID09PSAnbWluaUdyaWQnOwoKICAgIGlmICh0YWdzLmN1cnNvckVuYWJsZWQgJiYgY3Vyc29yU3VwcG9ydGVkKSB7CiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVQb2ludGVyQ3Vyc29yRGF0YShwb2ludGVyOiAnbW91c2UnIHwgJ2xlZnQnIHwgJ3JpZ2h0Jyk6IEFCVXNlclByZXNlbmNlQ3Vyc29yRGF0YSB7CiAgICAgICAgICAgIGNvbnN0IHBvaW50ZXJQb3NpdGlvbiA9IG9zLmdldFBvaW50ZXJQb3NpdGlvbihwb2ludGVyKTsKICAgICAgICAgICAgY29uc3QgcG9pbnRlckRpcmVjdGlvbiA9IG9zLmdldFBvaW50ZXJEaXJlY3Rpb24ocG9pbnRlcik7CiAgICAgICAgICAgIGNvbnN0IHJheWNhc3RSZXN1bHQgPSBhd2FpdCBvcy5yYXljYXN0KHBvcnRhbCwgcG9pbnRlclBvc2l0aW9uLCBwb2ludGVyRGlyZWN0aW9uKTsKCiAgICAgICAgICAgIGxldCByYXljYXN0SGl0OwoKICAgICAgICAgICAgaWYgKHJheWNhc3RSZXN1bHQuYm90SW50ZXJzZWN0aW9ucyAmJiByYXljYXN0UmVzdWx0LmJvdEludGVyc2VjdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgcmF5Y2FzdEhpdCA9IHJheWNhc3RSZXN1bHQuYm90SW50ZXJzZWN0aW9ucy5maW5kKChoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGguYm90LnRhZ3MucG9pbnRhYmxlICE9IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJheWNhc3RIaXQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRlclR5cGU6IHBvaW50ZXIsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsgeDogcmF5Y2FzdEhpdC5wb2ludC54LCB5OiByYXljYXN0SGl0LnBvaW50LnksIHo6IHJheWNhc3RIaXQucG9pbnQueiB9LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRGlkbid0IGhpdCBhbnkgYm90cy4KICAgICAgICAgICAgICAgIC8vIFRyeSB0ZXN0aW5nIGFnYWluc3QgdGhlIGdyb3VuZCBwbGFuZS4KICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VuZFBvaW50ID0gbWF0aC5pbnRlcnNlY3RQbGFuZShwb2ludGVyUG9zaXRpb24sIHBvaW50ZXJEaXJlY3Rpb24pOwoKICAgICAgICAgICAgICAgIGlmIChncm91bmRQb2ludCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRlclR5cGU6IHBvaW50ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IGdyb3VuZFBvaW50LngsIHk6IGdyb3VuZFBvaW50LnksIHo6IGdyb3VuZFBvaW50LnogfSwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE5vdCBpbnRlcnNlY3Rpbmcgd2l0aCBhbnl0aGluZyByaWdodCBzbyBzbyBsZXRzIGp1c3QgZ2V0IGEgcG9pbnQgc29tZSBkaXN0YW5jZSBkb3duIHRoZSAKICAgICAgICAgICAgICAgICAgICAvLyBwb2ludGVyJ3MgcmF5IGFuZCBjYWxsIGl0IGdvb2QuCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvYXRpbmdQb2ludCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgeDogcG9pbnRlclBvc2l0aW9uLnggKyBwb2ludGVyRGlyZWN0aW9uLnggKiB0YWdzLmZsb2F0aW5nQ3Vyc29yRGlzdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHk6IHBvaW50ZXJQb3NpdGlvbi55ICsgcG9pbnRlckRpcmVjdGlvbi55ICogdGFncy5mbG9hdGluZ0N1cnNvckRpc3RhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICB6OiBwb2ludGVyUG9zaXRpb24ueiArIHBvaW50ZXJEaXJlY3Rpb24ueiAqIHRhZ3MuZmxvYXRpbmdDdXJzb3JEaXN0YW5jZSwKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBwb2ludGVyLAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZmxvYXRpbmdQb2ludCwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IGN1cnNvcnM6IEFCVXNlclByZXNlbmNlQ3Vyc29yRGF0YVtdID0gW107CgogICAgICAgIGlmIChtYXNrcy5pblhSKSB7CiAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5sZWZ0UG9pbnRlclBvcnRhbCA9PT0gcG9ydGFsKSB7CiAgICAgICAgICAgICAgICBjdXJzb3JzLnB1c2goYXdhaXQgZ2VuZXJhdGVQb2ludGVyQ3Vyc29yRGF0YSgnbGVmdCcpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnJpZ2h0UG9pbnRlclBvcnRhbCA9PT0gcG9ydGFsKSB7CiAgICAgICAgICAgICAgICBjdXJzb3JzLnB1c2goYXdhaXQgZ2VuZXJhdGVQb2ludGVyQ3Vyc29yRGF0YSgncmlnaHQnKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIXRoaXNCb3QuaXNVc2luZ1RvdWNoKCkpIHsKICAgICAgICAgICAgICAgIGlmIChjb25maWdCb3QudGFncy5tb3VzZVBvaW50ZXJQb3J0YWwgPT09IHBvcnRhbCkgewogICAgICAgICAgICAgICAgICAgIGN1cnNvcnMucHVzaChhd2FpdCBnZW5lcmF0ZVBvaW50ZXJDdXJzb3JEYXRhKCdtb3VzZScpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBpZ25vcmluZyAnbW91c2UnIGN1cnNvciBkYXRhLCB0b3VjaCBpcyB0aGUgaW5wdXQgYmVpbmcgdXNlZC5gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gQWRkIGFueSBjdXJzb3JzIGluIHRoZSBjdXJyZW50IGRpbWVuc2lvbiBmcm9tIHRoZSBleHRlcm5hbCBxdWV1ZSBpbnRvIHRoZSBvdXRnb2luZyBwcmVzZW5jZSBkYXRhLgogICAgICAgIGlmIChjdXJzb3JRdWV1ZSAmJiBjdXJzb3JRdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSBjdXJzb3JRdWV1ZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgaWYgKGN1cnNvclF1ZXVlW2ldLmRpbWVuc2lvbiA9PT0gZGltZW5zaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY3Vyc29ycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRlclR5cGU6IGN1cnNvclF1ZXVlW2ldLnBvaW50ZXJUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogY3Vyc29yUXVldWVbaV0ucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yUXVldWUuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY3Vyc29ycy5sZW5ndGgpIHsKICAgICAgICAgICAgcHJlc2VuY2VEYXRhLmN1cnNvcnMgPSBjdXJzb3JzOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAocHJlc2VuY2VEYXRhLmNhbWVyYSB8fCAocHJlc2VuY2VEYXRhLmN1cnNvcnMgJiYgcHJlc2VuY2VEYXRhLmN1cnNvcnMubGVuZ3RoID4gMCkpIHsKICAgICAgICByZXR1cm4gcHJlc2VuY2VEYXRhOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KfQoKLy8gTWFwIHBvcnRhbCBzaXRzIG9uIHRvcCB0aGUgZ3JpZCBwb3J0YWwgc28gb25seSBzZW5kIG1hcCBwb3J0YWwgY2FtZXJhIGlmIGl0cyBlbmFibGVkLgppZiAoY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsKSB7CiAgICBjb25zdCBwcmVzZW5jZURhdGEgPSBhd2FpdCB0cnlHZW5lcmF0ZVByZXNlbmNlRGF0YUZvclBvcnRhbCgnbWFwJyk7CiAgICBpZiAocHJlc2VuY2VEYXRhKSB7CiAgICAgICAgcHJlc2VuY2VEYXRhVG9FbWl0LnB1c2gocHJlc2VuY2VEYXRhKTsKICAgIH0KfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsKSB7CiAgICBjb25zdCBwcmVzZW5jZURhdGEgPSBhd2FpdCB0cnlHZW5lcmF0ZVByZXNlbmNlRGF0YUZvclBvcnRhbCgnZ3JpZCcpOwogICAgaWYgKHByZXNlbmNlRGF0YSkgewogICAgICAgIHByZXNlbmNlRGF0YVRvRW1pdC5wdXNoKHByZXNlbmNlRGF0YSk7CiAgICB9Cn0KCi8vIE1pbmkgbWFwIHBvcnRhbCBzaXRzIG9uIHRvcCB0aGUgbWluaSBtYXAgcG9ydGFsIHNvIG9ubHkgc2VuZCBtaW5pIG1hcCBwb3J0YWwgY2FtZXJhIGlmIGl0cyBlbmFibGVkLgppZiAoY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCkgewogICAgY29uc3QgcHJlc2VuY2VEYXRhID0gYXdhaXQgdHJ5R2VuZXJhdGVQcmVzZW5jZURhdGFGb3JQb3J0YWwoJ21pbmlNYXAnKTsKICAgIGlmIChwcmVzZW5jZURhdGEpIHsKICAgICAgICBwcmVzZW5jZURhdGFUb0VtaXQucHVzaChwcmVzZW5jZURhdGEpOwogICAgfQp9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsKSB7CiAgICBjb25zdCBwcmVzZW5jZURhdGEgPSBhd2FpdCB0cnlHZW5lcmF0ZVByZXNlbmNlRGF0YUZvclBvcnRhbCgnbWluaUdyaWQnKTsKICAgIGlmIChwcmVzZW5jZURhdGEpIHsKICAgICAgICBwcmVzZW5jZURhdGFUb0VtaXQucHVzaChwcmVzZW5jZURhdGEpOwogICAgfQp9CgppZiAocHJlc2VuY2VEYXRhVG9FbWl0Lmxlbmd0aCA9PT0gMCkgewogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGlnbm9yaW5nIHRpY2sg4oCUIHdhaXRpbmcgdG8gYmUgaW4gYSBwb3J0YWwgd2l0aCBwcmVzZW5jZSBkYXRhLmApOwogICAgfQogICAgcmV0dXJuOwp9Cgpjb25zdCBvdGhlclJlbW90ZXMgPSAoYXdhaXQgb3MucmVtb3RlcygpKS5maWx0ZXIoaWQgPT4gaWQgIT09IGNvbmZpZ0JvdC5pZCk7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBwcmVzZW5jZURhdGFUb0VtaXQ6YCwgcHJlc2VuY2VEYXRhVG9FbWl0LCBgb3RoZXJSZW1vdGVzOmAsIG90aGVyUmVtb3Rlcyk7Cn0KCmlmIChvdGhlclJlbW90ZXMubGVuZ3RoID4gMCkgewogICAgc2VuZFJlbW90ZURhdGEob3RoZXJSZW1vdGVzLCAnYWJfdXNlcl9wcmVzZW5jZV9kYXRhJywgcHJlc2VuY2VEYXRhVG9FbWl0KTsKfScA+vqQpgbRAQxpc1VzaW5nVG91Y2gCBAD6+pCmBtRHgAFAaWYgKGNvbmZpZ0JvdCkgewogICAgcmV0dXJuIGNvbmZpZ0JvdC5yYXdbJ3RvdWNoXzAnXSA9PT0gbnVsbCB8fCAhIWNvbmZpZ0JvdC5yYXdbJ3RvdWNoXzAnXSAgIAp9IGVsc2UgewogICAgcmV0dXJuIHVuZGVmaW5lZDsKfScA+vqQpgbRAQtvbkdyaWRDbGljawIEAPr6kKYG1UipA0BpZiAodGhhdC5tb2RhbGl0eSA9PT0gJ3RvdWNoJykgewogICAgY29uc3QgZGltZW5zaW9uID0gdGhhdC5kaW1lbnNpb247CiAgICBjb25zdCBwb3NpdGlvbiA9IHRoYXQucG9zaXRpb247CgogICAgLy8gQWRkIHRoaXMgdG91Y2ggdG8gdGhlIGN1cnNvciBxdWV1ZSBmb3IgdGhlIG5leHQgdGljay4KICAgIGNvbnN0IGN1cnNvclF1ZXVlOiBBQlVzZXJQcmVzZW5jZVF1ZXVlZEN1cnNvckRhdGFbXSA9IHRoaXNCb3QudmFycy5jdXJzb3JRdWV1ZTsKCiAgICBjdXJzb3JRdWV1ZS5wdXNoKHsKICAgICAgICBwb2ludGVyVHlwZTogJ3RvdWNoJywKICAgICAgICBkaW1lbnNpb24sCiAgICAgICAgcG9zaXRpb246IHsgeDogcG9zaXRpb24ueCwgeTogcG9zaXRpb24ueSwgejogcG9zaXRpb24ueiB9LAogICAgfSkKCiAgICB0aGlzQm90Lm9uVGljaygpOwp9JwD6+pCmBtEBDG9uQm90Q2hhbmdlZAIEAPr6kKYG/0vyAkBpZiAodGhhdC50YWdzLmluY2x1ZGVzKCd0aWNrSW50ZXJ2YWxNUycpKSB7CiAgICB0aGlzQm90LnN0b3BUaWNrKCk7CgogICAgaWYgKG9zLmlzQ29sbGFib3JhdGl2ZSgpICYmIHRoaXNCb3QuZ2V0UHJlc2VuY2VFbmFibGVkKCkpIHsKICAgICAgICB0aGlzQm90LnN0YXJ0VGljaygpOwogICAgfQp9IGVsc2UgaWYgKHRoYXQudGFncy5zb21lKCh0KSA9PiB0ID09PSAnY3Vyc29yRW5hYmxlZCcgfHwgdCA9PT0gJ2NhbWVyYUVuYWJsZWQnKSkgewogICAgaWYgKHRoaXNCb3QuZ2V0UHJlc2VuY2VFbmFibGVkKCkpIHsKICAgICAgICB0aGlzQm90LnN0YXJ0VGljaygpOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzQm90LnN0b3BUaWNrKCk7CiAgICB9Cn0nAPr6kKYG0QEMb25SZW1vdGVEYXRhAgQA+vqQpgbyTvkDQGlmICghdGhpc0JvdC5nZXRQcmVzZW5jZUVuYWJsZWQoKSkgewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5uYW1lID09PSAnYWJfdXNlcl9wcmVzZW5jZV9kYXRhJykgewogICAgY29uc3QgZGF0YTogQUJVc2VyUHJlc2VuY2VEYXRhIHwgQUJVc2VyUHJlc2VuY2VEYXRhW10gPSB0aGF0LnRoYXQ7CgogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGFiX3VzZXJfcHJlc2VuY2VfZGF0YSBkYXRhOmAsIGRhdGEpOwogICAgfQoKICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXNCb3Qub25BQlVzZXJQcmVzZW5jZURhdGFSZWNlaXZlZChkYXRhW2ldKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHRoaXNCb3Qub25BQlVzZXJQcmVzZW5jZURhdGFSZWNlaXZlZChkYXRhKTsKICAgIH0KfScA+vqQpgbRAQV0eXBlcwIEAPr6kKYG7FLVCvCfk4RpbnRlcmZhY2UgQUJVc2VyUHJlc2VuY2VEYXRhIHsKICAgIC8qKiBSZW1vdGUgaWQgb2YgdGhlIHVzZXIgdGhlIHByZXNlbmNlIGRhdGEgaXMgZm9yLiAqLwogICAgcmVtb3RlSWQ6IHN0cmluZzsKCiAgICAvKiogQ2FuIGVpdGhlciBiZSB1c2VyJ3MgZGlzcGxheSBuYW1lIG9yIGEgc2hvcnRlbmVkIGxvY2FsIHVzZXIgaWQuICoqLwogICAgcmVtb3RlTmFtZTogc3RyaW5nOwoKICAgIC8qKiBQb3J0YWwgdGhhdCB0aGUgcHJlc2VuY2UgZGF0YSBpcyBmb3IuICovCiAgICBwb3J0YWw6IHN0cmluZzsKCiAgICAvKiogRGltZW5zaW9uIHRoYXQgdGhlIHByZXNlbmNlIGRhdGEgaXMgZm9yLiAqKi8KICAgIGRpbWVuc2lvbjogc3RyaW5nOwoKICAgIC8qKiBDb2xvciBvZiB0aGUgdXNlci4gKi8KICAgIGNvbG9yOiBzdHJpbmc7CgogICAgY2FtZXJhPzogQUJVc2VyUHJlc2VuY2VDYW1lcmFEYXRhOwogICAgY3Vyc29ycz86IEFCVXNlclByZXNlbmNlQ3Vyc29yRGF0YVtdOwp9CgppbnRlcmZhY2UgQUJVc2VyUHJlc2VuY2VDYW1lcmFEYXRhIHsKICAgIC8qKiBUeXBlIG9mIHRoZSBjYW1lcmEgdGhhdCB0aGUgZGF0YSBpcyBmb3IuICovCiAgICBjYW1lcmFUeXBlOiAncGVyc3BlY3RpdmUnIHwgJ29ydGhvZ3JhcGhpYyc7CiAgICAKICAgIC8qKiBUaGUgcG9zaXRpb24gb2YgdGhlIGNhbWVyYS4gKiovCiAgICBwb3NpdGlvbjogeyB4OiBudW1iZXIsIHk6IG51bWJlciwgejogbnVtYmVyIH07CgogICAgLyoqIFRoZSByb3RhdGlvbiBxdWF0ZXJuaW9uIG9mIHRoZSBjYW1lcmEuICoqLwogICAgcXVhdGVybmlvbjogeyB4OiBudW1iZXIsIHk6IG51bWJlciwgejogbnVtYmVyLCB3OiBudW1iZXIgfTsKCiAgICAvKiogVGhlIHpvb20gdmxhdWUgdGhhdCB0aGUgY2FtZXJhIGlzIGF0LiBUaGlzIGlzIG9ubHkgcmVsZXZhbnQgZm9yIG9ydGhvZ3JhcGhpYyBjYW1lcmFzLiAqLwogICAgem9vbT86IG51bWJlcjsKfQoKaW50ZXJmYWNlIEFCVXNlclByZXNlbmNlQ3Vyc29yRGF0YSB7CiAgICAvKiogVGhlIHR5cGUgb2YgdGhlIHBvaW50ZXIgdGhhdCB0aGUgZGF0YSBpcyBmb3IuICovCiAgICBwb2ludGVyVHlwZTogJ21vdXNlJyB8ICdsZWZ0JyB8ICdyaWdodCcgfCAndG91Y2gnOwogICAgCiAgICAvKiogVGhlIHBvc2l0aW9uIG9mIHRoZSBjdXJzb3IuICoqLwogICAgcG9zaXRpb246IHsgeDogbnVtYmVyLCB5OiBudW1iZXIsIHo6IG51bWJlciB9Owp9CgppbnRlcmZhY2UgQUJVc2VyUHJlc2VuY2VRdWV1ZWRDdXJzb3JEYXRhIGV4dGVuZHMgQUJVc2VyUHJlc2VuY2VDdXJzb3JEYXRhIHsKICAgIC8qKiBUaGUgZGltZW5zaW9uIHRoYXQgdGhpcyBjdXJzb3IgaXMgaW4uICovCiAgICBkaW1lbnNpb246IHN0cmluZzsKfScA+vqQpgbRARJjYW1lcmFCb3RUaW1lb3V0TVMCBAD6+pCmBsBdBDMwMDAnAPr6kKYG0QELaW50ZXJwb2xhdGUCBAD6+pCmBsVdBHRydWUnAPr6kKYG0QEGdGlja2VyAgQA+vqQpgbKXSjwn5SXNWMxOWJjOWYtYzY4ZC00M2M3LWJlMzQtMzYwMjFmN2U0ZGQzJwD6+pCmBtEBDmdldFJlbW90ZUNvbG9yAgQA+vqQpgbxXc0BQGlmICghbWFza3MucmVtb3RlQ29sb3IpIHsKICAgIG1hdGguc2V0UmFuZG9tU2VlZChjb25maWdCb3QuaWQpOwogICAgbWFza3MucmVtb3RlQ29sb3IgPSBgcmdiKCR7bWF0aC5yYW5kb21JbnQoMCwgMjU1KX0sICR7bWF0aC5yYW5kb21JbnQoMCwgMjU1KX0sICR7bWF0aC5yYW5kb21JbnQoMCwgMjU1KX0pYDsKfQoKcmV0dXJuIG1hc2tzLnJlbW90ZUNvbG9yOycA+vqQpgbRAQ1nZXRSZW1vdGVOYW1lAgQA+vqQpga/X88CQC8vIFRoZSBuYW1lIHRoYXQgdGhpcyByZW1vdGUgaXMgdG8gYmUga25vd24gYXMgdG8gb3RoZXIgdXNlcnMuCmxldCByZW1vdGVOYW1lOwoKaWYgKGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZSkgewogICAgcmVtb3RlTmFtZSA9IGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZTsKfSBlbHNlIGlmIChhdXRoQm90ICYmIGF1dGhCb3QudGFncy5uYW1lKSB7CiAgICByZW1vdGVOYW1lID0gYXV0aEJvdC50YWdzLm5hbWU7Cn0gZWxzZSB7CiAgICByZW1vdGVOYW1lID0gY29uZmlnQm90LmlkLnN1YnN0cmluZygwLDUpOwp9CgpyZXR1cm4gcmVtb3RlTmFtZTsnAPr6kKYG0QESY3Vyc29yQm90VGltZW91dE1TAgQA+vqQpgaPYgQzMDAwJwD6+pCmBtEBDWNhbWVyYUVuYWJsZWQCBAD6+pCmBpRiBWZhbHNlJwD6+pCmBtEBDWN1cnNvckVuYWJsZWQCBAD6+pCmBppiBWZhbHNlJwD6+pCmBtEBEmdldFByZXNlbmNlRW5hYmxlZAIEAPr6kKYGoGIxQHJldHVybiB0YWdzLmN1cnNvckVuYWJsZWQgfHwgdGFncy5jYW1lcmFFbmFibGVkOycA+vqQpgbRARxvbkFCVXNlclByZXNlbmNlRGF0YVJlY2VpdmVkAgQA+vqQpgbSYs+kAUBjb25zdCBwcmVzZW5jZURhdGE6IEFCVXNlclByZXNlbmNlRGF0YSA9IHRoYXQ7CgppZiAodGFncy5kZWJ1ZykgewogICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBwcmVzZW5jZURhdGE6YCwgcHJlc2VuY2VEYXRhKQp9CgppZiAocHJlc2VuY2VEYXRhLmNhbWVyYSkgewogICAgY29uc3Qgc2hvdXRSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHNob3V0KCdvbkFCVXNlckNhbWVyYVVwZGF0ZScsIHByZXNlbmNlRGF0YSkpOwogICAgY29uc3QgY2FtZXJhVXBkYXRlZCA9IHNob3V0UmVzdWx0cy5sZW5ndGggPiAwICYmIHNob3V0UmVzdWx0cy5zb21lKHIgPT4gci52YWx1ZSA9PT0gdHJ1ZSk7CiAgICAKICAgIGlmICghY2FtZXJhVXBkYXRlZCkgewogICAgICAgIC8vIFRoZXJlIHdhcyBubyB1c2VyIGNhbWVyYSB0aGF0IGFjY2VwdGVkIHRoZSB1cGRhdGUsIG5lZWQgdG8gY3JlYXRlIGEgbmV3IG9uZS4KCiAgICAgICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFske3RhZ3Muc3lzdGVtfS4ke3RhZ05hbWV9XSBtYWtlIHVzZXIgY2FtZXJhOmAsIHByZXNlbmNlRGF0YSk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCB1c2VyQ2FtZXJhQm90ID0gY3JlYXRlKHsKICAgICAgICAgICAgc3BhY2U6ICd0ZW1wTG9jYWwnLAogICAgICAgICAgICBhYkJvdDogdHJ1ZSwKICAgICAgICAgICAgYWJVc2VyQ2FtZXJhOiB0cnVlLAogICAgICAgICAgICBtYW5hZ2VyOiBnZXRMaW5rKHRoaXNCb3QpLAogICAgICAgICAgICBmb3JtOiAnZnJ1c3R1bScsCiAgICAgICAgICAgIGFuY2hvclBvaW50OiAnY2VudGVyJywKICAgICAgICAgICAgcmVtb3RlSWQ6IHByZXNlbmNlRGF0YS5yZW1vdGVJZCwKICAgICAgICAgICAgcmVtb3RlTmFtZTogcHJlc2VuY2VEYXRhLnJlbW90ZU5hbWUsCiAgICAgICAgICAgIHBvcnRhbDogcHJlc2VuY2VEYXRhLnBvcnRhbCwKICAgICAgICAgICAgZGltZW5zaW9uOiBwcmVzZW5jZURhdGEuZGltZW5zaW9uLAogICAgICAgICAgICBbcHJlc2VuY2VEYXRhLmRpbWVuc2lvbl06IHRydWUsCiAgICAgICAgICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICAgICAgICAgIGxhYmVsUG9zaXRpb246ICdmbG9hdGluZ0JpbGxib2FyZCcsCiAgICAgICAgICAgIGxhYmVsV29yZFdyYXBNb2RlOiAnbm9uZScsCiAgICAgICAgICAgIC8vIGxhYmVsU2l6ZTogMC4yOCwKICAgICAgICAgICAgLy8gbGFiZWxTaXplTW9kZTogJ2F1dG8nLAogICAgICAgICAgICBvbkNyZWF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbYWJVc2VyQ2FtZXJhLiR7dGFnTmFtZX0gKCR7dGFncy5yZW1vdGVOYW1lfSldYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBvbkFCVXNlckNhbWVyYVVwZGF0ZTogTGlzdGVuZXJTdHJpbmcoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcHJlc2VuY2VEYXRhOiBBQlVzZXJQcmVzZW5jZURhdGEgPSB0aGF0OwoKICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBpbmNvbWluZyB1cGRhdGUgaXMgZm9yIHRoaXMgYm90LgogICAgICAgICAgICAgICAgaWYgKHByZXNlbmNlRGF0YS5yZW1vdGVJZCAhPT0gdGFncy5yZW1vdGVJZCB8fAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlRGF0YS5wb3J0YWwgIT09IHRhZ3MucG9ydGFsIHx8CiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2VEYXRhLmRpbWVuc2lvbiAhPT0gdGFncy5kaW1lbnNpb24KICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBDbGVhciBvbGQgdGltZW91dC4KICAgICAgICAgICAgICAgIGlmICh0aGlzQm90LnZhcnMudGltZW91dElkKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXNCb3QudmFycy50aW1lb3V0SWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudmFycy50aW1lb3V0SWQgPSBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChsaW5rcy5tYW5hZ2VyLnRhZ3MuZGVidWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW2FiVXNlckNhbWVyYS4ke3RhZ05hbWV9ICgke3RhZ3MucmVtb3RlTmFtZX0pXSBwcmVzZW5jZURhdGE6YCwgcHJlc2VuY2VEYXRhKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGFncy5sYWJlbCAhPT0gcHJlc2VuY2VEYXRhLnJlbW90ZU5hbWUpIHsKICAgICAgICAgICAgICAgICAgICB0YWdzLmxhYmVsID0gcHJlc2VuY2VEYXRhLnJlbW90ZU5hbWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZ3MuY29sb3IgIT09IHByZXNlbmNlRGF0YS5jb2xvcikgewogICAgICAgICAgICAgICAgICAgIHRhZ3MuY29sb3IgPSBwcmVzZW5jZURhdGEuY29sb3I7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZ3MubGFiZWxGbG9hdGluZ0JhY2tncm91bmRDb2xvciAhPT0gcHJlc2VuY2VEYXRhLmNvbG9yKXsgCiAgICAgICAgICAgICAgICAgICAgdGFncy5sYWJlbEZsb2F0aW5nQmFja2dyb3VuZENvbG9yID0gcHJlc2VuY2VEYXRhLmNvbG9yOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNsYW1wMDEodDogbnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHQpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiB6b29tVG9UKHpvb206IG51bWJlciwgem9vbU1pbjogbnVtYmVyLCB6b29tTWF4OiBudW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0PTAgYXQgem9vbU1pbiwgdD0xIGF0IHpvb21NYXgKICAgICAgICAgICAgICAgICAgICBjb25zdCB6ID0gTWF0aC5tYXgoem9vbSwgMWUtNik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYSA9IE1hdGgubG9nKHpvb21NaW4pOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBNYXRoLmxvZyh6b29tTWF4KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2ID0gKE1hdGgubG9nKHopIC0gYSkgLyAoYiAtIGEpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjbGFtcDAxKHYpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGxlcnAoYTogbnVtYmVyLCBiOiBudW1iZXIsIHQ6IG51bWJlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhICsgKGIgLSBhKSAqIHQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gT3B0aW9uYWwgc21vb3RoaW5nIHNvIGl0IGRvZXNu4oCZdCBmZWVsIGxpbmVhciAvIGhhcnNoOgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc21vb3Roc3RlcCh0OiBudW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdCAqIHQgKiAoMyAtIDIgKiB0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyB0PTAgYXQgem9vbU1pbiAoem9vbWVkIG91dCksIHQ9MSBhdCB6b29tTWF4ICh6b29tZWQgaW4pCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhcHBseUVhc2UodDogbnVtYmVyLCBleHBvbmVudDogbnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZXhwb25lbnQgPCAxIHNsb3dzIGRvd24gdGhlIOKAnG1vdmUgYXdheeKAnSB3aGVuIHpvb21pbmcgb3V0CiAgICAgICAgICAgICAgICAgICAgLy8gKG1ha2VzIGN1cnZlIGdlbnRsZXIgbmVhciB0PTApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucG93KHNtb290aHN0ZXAodCksIGV4cG9uZW50KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhc3luYyBmdW5jdGlvbiBnZXRWaXpDYW1lcmFQb3NlKAogICAgICAgICAgICAgICAgICAgIGNhbWVyYVBvc2l0aW9uOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB6OiBudW1iZXIgfSwKICAgICAgICAgICAgICAgICAgICBjYW1lcmFSb3RhdGlvbjogeyB4OiBudW1iZXI7IHk6IG51bWJlcjsgejogbnVtYmVyOyB3OiBudW1iZXIgfSwKICAgICAgICAgICAgICAgICAgICBjYW1lcmFUeXBlOiAnb3J0aG9ncmFwaGljJyB8ICdwZXJzcGVjdGl2ZScsCiAgICAgICAgICAgICAgICAgICAgY2FtZXJhWm9vbTogbnVtYmVyIHwgbnVsbCB8IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICB6b29tTWluID0gMC40LAogICAgICAgICAgICAgICAgICAgIHpvb21NYXggPSA4MCwKICAgICAgICAgICAgICAgICAgICBmYXJEaXN0ID0gMzAsCiAgICAgICAgICAgICAgICAgICAgbmVhckRpc3QgPSAyLAogICAgICAgICAgICAgICAgICAgIGV4cG9uZW50ID0gMC41LAogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zID0gbmV3IFZlY3RvcjMoY2FtZXJhUG9zaXRpb24ueCwgY2FtZXJhUG9zaXRpb24ueSwgY2FtZXJhUG9zaXRpb24ueik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGV0IHJvdDsKICAgICAgICAgICAgICAgICAgICBpZiAoKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24gfHwgY29uZmlnQm90LnRhZ3MubWluaU1hcFBvcnRhbCA9PT0gdGFncy5kaW1lbnNpb24pICYmIGNhbWVyYVR5cGUgPT09ICdwZXJzcGVjdGl2ZScpIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIHJvdCA9IGF3YWl0IGFiLmxpbmtzLnV0aWxzLmNhbGNNYXBSb3RhdGlvbih7IG1hcFBvc2l0aW9uOiBjYW1lcmFQb3NpdGlvbiwgYXV4Um90YXRpb246IG5ldyBSb3RhdGlvbih7IHF1YXRlcm5pb246IGNhbWVyYVJvdGF0aW9uIH0pfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcm90ID0gbmV3IFJvdGF0aW9uKHsgcXVhdGVybmlvbjogY2FtZXJhUm90YXRpb24gfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3J3YXJkID0gcm90LnJvdGF0ZVZlY3RvcjMobmV3IFZlY3RvcjMoMCwgMSwgMCkpLm5vcm1hbGl6ZSgpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY2FtZXJhVHlwZSA9PT0gJ3BlcnNwZWN0aXZlJykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwb3NpdGlvbjogcG9zLCByb3RhdGlvbjogcm90IH07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCB6b29tID0gTWF0aC5tYXgoY2FtZXJhWm9vbSA/PyAxMCwgMWUtNik7CgogICAgICAgICAgICAgICAgICAgIGxldCB0ID0gem9vbVRvVCh6b29tLCB6b29tTWluLCB6b29tTWF4KTsKICAgICAgICAgICAgICAgICAgICB0ID0gYXBwbHlFYXNlKHQsIGV4cG9uZW50KTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZCA9IGxlcnAoZmFyRGlzdCwgbmVhckRpc3QsIHQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZpelBvcyA9IHBvcy5zdWJ0cmFjdChmb3J3YXJkLm11bHRpcGx5U2NhbGFyKGQpKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgcG9zaXRpb246IHZpelBvcywgcm90YXRpb246IHJvdCwgZGVidWc6IHsgdCwgZCwgem9vbSB9IH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgcG9zZSA9IGF3YWl0IGdldFZpekNhbWVyYVBvc2UoCiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYS5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICBwcmVzZW5jZURhdGEuY2FtZXJhLnF1YXRlcm5pb24sCiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2VEYXRhLmNhbWVyYS5jYW1lcmFUeXBlLAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlRGF0YS5jYW1lcmEuem9vbSwKICAgICAgICAgICAgICAgICAgICAwLjQsCiAgICAgICAgICAgICAgICAgICAgODAsCiAgICAgICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICAgICAtNDI3LAogICAgICAgICAgICAgICAgICAgIDAuMSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgY29uc3QgcG9zVGFnTmFtZSA9IHRhZ3MuZGltZW5zaW9uICsgJ1Bvc2l0aW9uJzsKICAgICAgICAgICAgICAgIGNvbnN0IHJvdFRhZ05hbWUgPSB0YWdzLmRpbWVuc2lvbiArICdSb3RhdGlvbic7CgogICAgICAgICAgICAgICAgY2xlYXJBbmltYXRpb25zKHRoaXNCb3QsIFtwb3NUYWdOYW1lLCByb3RUYWdOYW1lXSk7CgogICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5pbnRlcnBvbGF0ZSAmJiB0YWdzW3Bvc1RhZ05hbWVdICYmIHRhZ3Nbcm90VGFnTmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbVZhbHVlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcG9zVGFnTmFtZV06IHRhZ3NbcG9zVGFnTmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcm90VGFnTmFtZV06IHRhZ3Nbcm90VGFnTmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHRvVmFsdWU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtwb3NUYWdOYW1lXTogcG9zZS5wb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtyb3RUYWdOYW1lXTogcG9zZS5yb3RhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IChsaW5rcy5tYW5hZ2VyLnRhZ3MudGlja0ludGVydmFsTVMgKyA1MCkgLyAxMDAwLAogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHt9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWFza3NbcG9zVGFnTmFtZV0gPSBwb3NlLnBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIG1hc2tzW3JvdFRhZ05hbWVdID0gcG9zZS5yb3RhdGlvbjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBTZXQgbmV3IHRpbWVvdXQuCiAgICAgICAgICAgICAgICB0aGlzQm90LnZhcnMudGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiBkZXN0cm95KHRoaXNCb3QpLCBsaW5rcy5tYW5hZ2VyLnRhZ3MuY2FtZXJhQm90VGltZW91dE1TKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbYWJVc2VyQ2FtZXJhLiR7dGFnTmFtZX0gKCR7dGFncy5yZW1vdGVOYW1lfSldYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSkKCiAgICAgICAgLy8gRGlyZWN0bHkgY2FsbCBvbkFCVXNlckNhbWVyYVVwZGF0ZSB0aGUgZmlyc3QgdGltZSB3ZSBtYWtlIGEgbmV3IHVzZXIgY2FtZXJhIGJvdC4KICAgICAgICBhd2FpdCB1c2VyQ2FtZXJhQm90Lm9uQUJVc2VyQ2FtZXJhVXBkYXRlKHByZXNlbmNlRGF0YSk7CiAgICB9Cn0KCmlmIChwcmVzZW5jZURhdGEuY3Vyc29ycyAmJiBwcmVzZW5jZURhdGEuY3Vyc29ycy5sZW5ndGggPiAwKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByZXNlbmNlRGF0YS5jdXJzb3JzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hvdXRSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHNob3V0KCdvbkFCVXNlckN1cnNvclVwZGF0ZScsIHsgcHJlc2VuY2VEYXRhLCBjdXJzb3JJbmRleDogaSB9KSk7CiAgICAgICAgY29uc3QgY3Vyc29yVXBkYXRlZCA9IHNob3V0UmVzdWx0cy5sZW5ndGggPiAwICYmIHNob3V0UmVzdWx0cy5zb21lKHIgPT4gci52YWx1ZSA9PT0gdHJ1ZSk7CiAgICAgICAgCiAgICAgICAgaWYgKCFjdXJzb3JVcGRhdGVkKSB7CiAgICAgICAgICAgIC8vIFRoZXJlIHdhcyBubyB1c2VyIGN1cnNvciB0aGF0IGFjY2VwdGVkIHRoZSB1cGRhdGUsIG5lZWQgdG8gY3JlYXRlIGEgbmV3IG9uZS4KCiAgICAgICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIG1ha2UgdXNlciBjdXJzb3I6YCwgcHJlc2VuY2VEYXRhLCBgY3Vyc29yOmAsIHByZXNlbmNlRGF0YS5jdXJzb3JzW2ldKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgY3Vyc29yQm90ID0gY3JlYXRlKHsKICAgICAgICAgICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgICAgICAgICAgICAgIGFiQm90OiB0cnVlLAogICAgICAgICAgICAgICAgYWJVc2VyQ3Vyc29yOiB0cnVlLAogICAgICAgICAgICAgICAgZm9ybTogJ25vdGhpbmcnLAogICAgICAgICAgICAgICAgYW5jaG9yUG9pbnQ6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgb3JpZW50YXRpb25Nb2RlOiAnYmlsbGJvYXJkJywKICAgICAgICAgICAgICAgIHBvaW50YWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBkcmFnZ2FibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgbWFuYWdlcjogZ2V0TGluayh0aGlzQm90KSwKICAgICAgICAgICAgICAgIHJlbW90ZUlkOiBwcmVzZW5jZURhdGEucmVtb3RlSWQsCiAgICAgICAgICAgICAgICByZW1vdGVOYW1lOiBwcmVzZW5jZURhdGEucmVtb3RlTmFtZSwKICAgICAgICAgICAgICAgIHBvcnRhbDogcHJlc2VuY2VEYXRhLnBvcnRhbCwKICAgICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBwcmVzZW5jZURhdGEuY3Vyc29yc1tpXS5wb2ludGVyVHlwZSwKICAgICAgICAgICAgICAgIGRpZEluaXRpYWxVcGRhdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgb25DcmVhdGU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobGlua3MubWFuYWdlci50YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbYWJVc2VyQ3Vyc29yLiR7dGFnTmFtZX0gKCR7dGFncy5yZW1vdGVOYW1lfSldYCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBvbkFCVXNlckN1cnNvclVwZGF0ZTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXNlbmNlRGF0YTogQUJVc2VyUHJlc2VuY2VEYXRhID0gdGhhdC5wcmVzZW5jZURhdGE7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29ySW5kZXg6IG51bWJlciA9IHRoYXQuY3Vyc29ySW5kZXg7CgogICAgICAgICAgICAgICAgICAgIGlmICh0YWdzLnJlbW90ZUlkICE9PSBwcmVzZW5jZURhdGEucmVtb3RlSWQgfHwKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5wb3J0YWwgIT09IHByZXNlbmNlRGF0YS5wb3J0YWwgfHwKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5wb2ludGVyVHlwZSAhPT0gcHJlc2VuY2VEYXRhLmN1cnNvcnNbY3Vyc29ySW5kZXhdLnBvaW50ZXJUeXBlIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICh0YWdzLnBvaW50ZXJUeXBlID09PSAndG91Y2gnICYmIHRhZ3MuZGlkSW5pdGlhbFVwZGF0ZSkgLy8gQWx3YXlzIGxldCB0b3VjaCBjdXJzb3JzIGRpZS4KICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB1cGRhdGUgaXMgbm90IGZvciB0aGlzIGN1cnNvci4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY3Vyc29yICcgKyB0aGlzQm90LmlkLnN1YnN0cmluZygwLDUpICsgJyB1cGRhdGUnKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlUG9zaXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICBkaW1lbnNpb246IHByZXNlbmNlRGF0YS5kaW1lbnNpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwcmVzZW5jZURhdGEuY3Vyc29yc1tjdXJzb3JJbmRleF0ucG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlQ29sb3IoeyBjb2xvcjogcHJlc2VuY2VEYXRhLmNvbG9yIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlTmFtZSh7IG5hbWU6IHByZXNlbmNlRGF0YS5yZW1vdGVOYW1lIH0pOwoKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LnJlc2V0VGltZW91dCgpOwoKICAgICAgICAgICAgICAgICAgICB0YWdzLmRpZEluaXRpYWxVcGRhdGUgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgb25HcmlkUG9ydGFsQ2FtZXJhQ2hhbmdlZDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QudXBkYXRlU2NhbGUoKTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgb25Cb3RDaGFuZ2VkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQudGFncy5zb21lKCh0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmVuZHNXaXRoKCdYJykgfHwgdC5lbmRzV2l0aCgnWScpIHx8IHQuZW5kc1dpdGgoJ1onKTsKICAgICAgICAgICAgICAgICAgICB9KSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBDdXJzb3IgcG9zaXRpb24gY2hhbmdlZC4KICAgICAgICAgICAgICAgICAgICAgICAgdGhpc0JvdC51cGRhdGVTY2FsZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgdXBkYXRlUG9zaXRpb246IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGRpbWVuc2lvbiwgcG9zaXRpb24gfSA9IHRoYXQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZ3MuZGltZW5zaW9uICE9PSBkaW1lbnNpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGltZW5zaW9uIGhhcyBjaGFuZ2VkLiAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWdzLmRpbWVuc2lvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjdXJzb3IgZnJvbSB0aGUgcHJldmlvdXMgZGltZW5zaW9uLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgdGFncy5kaW1lbnNpb24gXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5zaGFwZUJvdC50YWdzWyB0YWdzLmRpbWVuc2lvbiBdID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtzLm5hbWVCb3QudGFnc1sgdGFncy5kaW1lbnNpb24gXSA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHBvc2l0aW9uIHRhZ3MgZm9yIHByZXZpb3VzIGRpbWVuc2lvbiBhcyB3ZWxsLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgdGFncy5kaW1lbnNpb24gKyAnWCcgXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzWyB0YWdzLmRpbWVuc2lvbiArICdZJyBdID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIHRhZ3MuZGltZW5zaW9uICsgJ1onIF0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGN1cnNvciB0byB0aGUgY3VycmVudCBkaW1lbnNpb24uCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MuZGltZW5zaW9uID0gZGltZW5zaW9uOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltZW5zaW9uIF0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5zaGFwZUJvdC50YWdzWyBkaW1lbnNpb24gXSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtzLm5hbWVCb3QudGFnc1sgZGltZW5zaW9uIF0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGltWFRhZyA9IGRpbWVuc2lvbiArICdYJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaW1ZVGFnID0gZGltZW5zaW9uICsgJ1knOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpbVpUYWcgPSBkaW1lbnNpb24gKyAnWic7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldlggPSB0YWdzWyBkaW1YVGFnIF07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldlkgPSB0YWdzWyBkaW1ZVGFnIF07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldlogPSB0YWdzWyBkaW1aVGFnIF07CgogICAgICAgICAgICAgICAgICAgIGNsZWFyQW5pbWF0aW9ucyh0aGlzQm90KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZYID09IG51bGwgJiYgcHJldlkgPT0gbnVsbCAmJiBwcmV2WiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGZpcnN0IHRpbWUgc2V0dGluZyB0aGUgcG9zaXRpb24gb2YgdGhpcyBjdXJzb3IgaW4gdGhpcyBkaW1lbnNpb24uCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNuYXAgY3Vyc29yIHRvIHRoZSBwb3NpdGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltWFRhZyBdID0gcG9zaXRpb24ueDsKICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltWVRhZyBdID0gcG9zaXRpb24ueTsKICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltWlRhZyBdID0gcG9zaXRpb24uejsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGlua3MubWFuYWdlci50YWdzLmludGVycG9sYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDdXJzb3IgaXMgYWxyZWFkeSBwb3NpdGlvbmVkIGluIGRpbWVuc2lvbiwgc21vb3RobHkgYW5pbWF0ZSB0byB0aGUgdXBkYXRlZCBwb3NpdGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGVUYWcodGhpc0JvdCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb21WYWx1ZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZGltWFRhZ106IHByZXZYLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZGltWVRhZ106IHByZXZZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZGltWlRhZ106IHByZXZaLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZGltWFRhZ106IHBvc2l0aW9uLngsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtkaW1ZVGFnXTogcG9zaXRpb24ueSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2RpbVpUYWddOiBwb3NpdGlvbi56LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IChsaW5rcy5tYW5hZ2VyLnRhZ3MudGlja0ludGVydmFsTVMgKyA1MCkgLyAxMDAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvbiBjYW5jZWxlZCwgZG8gbm90aGluZy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1sgZGltWFRhZyBdID0gcG9zaXRpb24ueDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbIGRpbVlUYWcgXSA9IHBvc2l0aW9uLnk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzWyBkaW1aVGFnIF0gPSBwb3NpdGlvbi56OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB1cGRhdGVDb2xvcjogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY29sb3IgfSA9IHRoYXQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChsaW5rcy5zaGFwZUJvdC50YWdzLmNvbG9yICE9PSBjb2xvcikgewogICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5zaGFwZUJvdC50YWdzLmNvbG9yID0gY29sb3I7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAobGlua3MubmFtZUJvdC50YWdzLmNvbG9yICE9PSBjb2xvcikgewogICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5uYW1lQm90LnRhZ3MuY29sb3IgPSBjb2xvcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHVwZGF0ZU5hbWU6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IHRoYXQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChsaW5rcy5uYW1lQm90LnRhZ3MubGFiZWwgIT09IG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGlua3MubmFtZUJvdC50YWdzLmxhYmVsID0gbmFtZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHVwZGF0ZVNjYWxlOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uc3RhbnRTY2FsZSA9IGxpbmtzLm1hbmFnZXIudGFncy5jdXJzb3JDb25zdGFudFNjYWxlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluWFIgPSBsaW5rcy5tYW5hZ2VyLnRhZ3MuaW5YUjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoaW5YUiB8fAogICAgICAgICAgICAgICAgICAgICAgICBncmlkUG9ydGFsQm90LnRhZ3MucG9ydGFsQ2FtZXJhVHlwZSA9PT0gJ3BlcnNwZWN0aXZlJwogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBwZXJzcGVjdGl2ZSBzY2FsZQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW1lcmFQb3NpdGlvbiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGdyaWRQb3J0YWxCb3QudGFncy5jYW1lcmFQb3NpdGlvblggPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IGdyaWRQb3J0YWxCb3QudGFncy5jYW1lcmFQb3NpdGlvblkgPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHo6IGdyaWRQb3J0YWxCb3QudGFncy5jYW1lcmFQb3NpdGlvblogPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFRoaXMgd2lsbCBicmVhayB3aGVuIHRoZSBjdXJzb3IgaXMgaW4gYSBkaW1lbnNpb24gYmVpbmcgZGlzcGxheWVkIGJ5IGEgcG9ydGFsIGJvdC4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGZpeCBpcyB0byBjYWxjdWxhdGUgdGhlIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSBib3QsIGJ1dCBmb3Igbm93IGltIGdvaW5nIHRvIHNraXAuCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnNvclBvc2l0aW9uID0geyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IHRhZ3NbIHRhZ3MuZGltZW5zaW9uICsgJ1gnIF0gPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IHRhZ3NbIHRhZ3MuZGltZW5zaW9uICsgJ1knIF0gPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHo6IHRhZ3NbIHRhZ3MuZGltZW5zaW9uICsgJ1onIF0gPz8gMCwKICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gbWF0aC52ZWN0b3JMZW5ndGgoIG1hdGguc3VidHJhY3RWZWN0b3JzKGNhbWVyYVBvc2l0aW9uLCBjdXJzb3JQb3NpdGlvbikgKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5pdGlhbERpc3RhbmNlID0gbGlua3MubWFuYWdlci50YWdzLmN1cnNvckluaXRpYWxEaXN0YW5jZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3Muc2NhbGUgPSAoZGlzdGFuY2UgLyBpbml0aWFsRGlzdGFuY2UpICogY29uc3RhbnRTY2FsZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBvcnRob2dyYXBoaWMgc2NhbGUKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5zY2FsZSA9IGNvbnN0YW50U2NhbGUgLyBncmlkUG9ydGFsQm90LnRhZ3MuY2FtZXJhWm9vbTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dDogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0YWdzLnRpbWVvdXRJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGFncy50aW1lb3V0SWQpOwogICAgICAgICAgICAgICAgICAgICAgICB0YWdzLnRpbWVvdXRJZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICByZXNldFRpbWVvdXQ6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzQm90LmNsZWFyVGltZW91dCgpOwoKICAgICAgICAgICAgICAgICAgICB0YWdzLnRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGlua3MubWFuYWdlci50YWdzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY3Vyc29yICcgKyB0aGlzQm90LmlkLnN1YnN0cmluZygwLDUpICsgJyBoYXMgdGltZWQgb3V0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kodGhpc0JvdCk7CiAgICAgICAgICAgICAgICAgICAgfSwgbGlua3MubWFuYWdlci50YWdzLmN1cnNvckJvdFRpbWVvdXRNUyk7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIG9uRGVzdHJveTogTGlzdGVuZXJTdHJpbmcoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXNCb3QuY2xlYXJUaW1lb3V0KCk7CgogICAgICAgICAgICAgICAgICAgIGRlc3Ryb3koWwogICAgICAgICAgICAgICAgICAgICAgICBsaW5rcy5zaGFwZUJvdCwKICAgICAgICAgICAgICAgICAgICAgICAgbGlua3MubmFtZUJvdCwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICB9KQoKICAgICAgICAgICAgY29uc3Qgc2hhcGVCb3QgPSBjcmVhdGUoewogICAgICAgICAgICAgICAgc3BhY2U6ICd0ZW1wTG9jYWwnLAogICAgICAgICAgICAgICAgYWJCb3Q6IHRydWUsCiAgICAgICAgICAgICAgICBhYlVzZXJDdXJzb3I6IHRydWUsCiAgICAgICAgICAgICAgICBmb3JtRGVwdGhUZXN0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGZvcm1EZXB0aFdyaXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGZvcm1SZW5kZXJPcmRlcjogOTk5OTksCiAgICAgICAgICAgICAgICByb3RhdGlvblhPZmZzZXQ6IDAsCiAgICAgICAgICAgICAgICByb3RhdGlvbllPZmZzZXQ6IDAsCiAgICAgICAgICAgICAgICByb3RhdGlvblpPZmZzZXQ6IDAsCiAgICAgICAgICAgICAgICBwb2ludGFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNjYWxlOiAwLjUsCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lcjogY3Vyc29yQm90LnRhZ3MuaWQsCiAgICAgICAgICAgICAgICBjdXJzb3JCb3Q6IGdldExpbmsoY3Vyc29yQm90KSwKICAgICAgICAgICAgICAgIG1hbmFnZXI6IGdldExpbmsodGhpc0JvdCksCiAgICAgICAgICAgICAgICBvbkJvdEFkZGVkOiBMaXN0ZW5lclN0cmluZygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmtzLmN1cnNvckJvdC50YWdzLnBvaW50ZXJUeXBlID09PSAndG91Y2gnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MuZm9ybSA9ICdtZXNoJzsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5mb3JtU3VidHlwZSA9ICdnbHRmJzsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLm1hbmFnZXIubGlua3MubGVhcm4uYWJCdWlsZENhc3VhbENhdGFsb2dVUkwobGlua3MubWFuYWdlci50YWdzLnBpbmdSaXBwbGVNb2RlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MuZm9ybU9wYWNpdHkgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICB0YWdzLmFuY2hvclBvaW50ID0gJ2NlbnRlcic7CgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwaW5nUmlwcGxlTW9kZWxBbmltYXRpb25EdXJhdGlvbk1TID0gODAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGxheSBhICJwaW5nIiBhbmltYXRpb24gZm9yIHRoZSB0b3VjaCBwb2ludC4KICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZVRhZyh0aGlzQm90LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogdGFncy5zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtT3BhY2l0eTogdGFncy5mb3JtT3BhY2l0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IHRhZ3Muc2NhbGUgKiAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1PcGFjaXR5OiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAocGluZ1JpcHBsZU1vZGVsQW5pbWF0aW9uRHVyYXRpb25NUykgLyAxMDAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWFzaW5nOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ291dCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3NpbnVzb2lkYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlc3Ryb3kgc2VsZiBvbmNlIGFuaW1hdGlvbiBlbmRzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy5jdXJzb3JCb3QpOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4ge30pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3MuZm9ybSA9ICdtZXNoJzsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5mb3JtU3VidHlwZSA9ICdnbHRmJzsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLm1hbmFnZXIudGFncy5jdXJzb3JNb2RlbDsKICAgICAgICAgICAgICAgICAgICAgICAgdGFncy5hbmNob3JQb2ludCA9IFstMC40NSwgMC41LCAwXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY29uc3QgbmFtZUJvdCA9IGNyZWF0ZSh7CiAgICAgICAgICAgICAgICBzcGFjZTogJ3RlbXBMb2NhbCcsCiAgICAgICAgICAgICAgICBhYkJvdDogdHJ1ZSwKICAgICAgICAgICAgICAgIGFiVXNlckN1cnNvcjogdHJ1ZSwKICAgICAgICAgICAgICAgIGZvcm06ICdjdWJlJywKICAgICAgICAgICAgICAgIGZvcm1EZXB0aFRlc3Q6IGZhbHNlLAogICAgICAgICAgICAgICAgZm9ybURlcHRoV3JpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZm9ybVJlbmRlck9yZGVyOiA5OTk5OSwKICAgICAgICAgICAgICAgIGFuY2hvclBvaW50OiBbLTAuNjI1LCAxLjUsIDBdLAogICAgICAgICAgICAgICAgcG9pbnRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBzY2FsZVg6IDMsCiAgICAgICAgICAgICAgICBzY2FsZVk6IDAuNiwKICAgICAgICAgICAgICAgIHNjYWxlWjogMC4xLAogICAgICAgICAgICAgICAgbGFiZWxQYWRkaW5nOiAwLjEsCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lcjogY3Vyc29yQm90LnRhZ3MuaWQsCiAgICAgICAgICAgICAgICBjdXJzb3JCb3Q6IGdldExpbmsoY3Vyc29yQm90KSwKICAgICAgICAgICAgICAgIG1hbmFnZXI6IGdldExpbmsodGhpc0JvdCksCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gR2l2ZSBjdXJzb3IgYm90IGxpbmtzIHRvIGFsbCBvZiB0aGUgY2hpbGQgYm90cyBpdCBuZWVkcyB0byBjb21tdW5pY2F0ZSB3aXRoLgogICAgICAgICAgICBjdXJzb3JCb3QubGlua3Muc2hhcGVCb3QgPSBzaGFwZUJvdC5saW5rOwogICAgICAgICAgICBjdXJzb3JCb3QubGlua3MubmFtZUJvdCA9IG5hbWVCb3QubGluazsKCiAgICAgICAgICAgIC8vIERpcmVjdGx5IGNhbGwgb25BQlVzZXJDdXJzb3JVcGRhdGUgdGhlIGZpcnN0IHRpbWUgd2UgbWFrZSBhIG5ldyB1c2VyIGNhbWVyYSBib3QuCiAgICAgICAgICAgIGF3YWl0IGN1cnNvckJvdC5vbkFCVXNlckN1cnNvclVwZGF0ZSh7IHByZXNlbmNlRGF0YSwgY3Vyc29ySW5kZXg6IGkgfSk7CiAgICAgICAgfQogICAgfQp9JwD6+pCmBtEBEG9uSW5zdFN0cmVhbUxvc3QCBAD6+pCmBpyHAmVAaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKdGhpc0JvdC5zdG9wVGljaygpOycA+vqQpgbRAQ9vbkluc3RTdHJlYW1pbmcCBAD6+pCmBoKIAogBQGlmICh0YWdzLmRlYnVnKSB7CiAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIHRoYXQ6YCwgdGhhdCk7Cn0KCmlmIChvcy5pc0NvbGxhYm9yYXRpdmUoKSkgewogICAgdGhpc0JvdC5zdGFydFRpY2soKTsKfScA+vqQpgbRAQ9vbkFueUJvdENsaWNrZWQCBAD6+pCmBouJAoAPQGlmICh0aGF0Lm1vZGFsaXR5ID09PSAndG91Y2gnKSB7CiAgICBjb25zdCBkaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKCiAgICAvLyBDYXN1YWxPUyBkb2VzIG5vdCByZXBvcnQgdGhlIHBvcnRhbCB0aGF0IHRoZSBjbGljayB0b29rIHBsYWNlIGluLCBtdXN0IGluZmVyIGl0IGggICAgZXJlLgpsZXQgcG9ydGFsOwoKICAgIGlmIChjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPT09IGRpbWVuc2lvbikgewogICAgICAgIHBvcnRhbCA9ICdtYXAnOwogICAgfSBlbHNlIGlmIChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID09PSBkaW1lbnNpb24pIHsKICAgICAgICBwb3J0YWwgPSAnZ3JpZCc7CiAgICB9IGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1pbmlNYXBQb3J0YWwgPT09IGRpbWVuc2lvbikgewogICAgICAgIHBvcnRhbCA9ICdtaW5pTWFwJzsKICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPT09IGRpbWVuc2lvbikgewogICAgICAgIHBvcnRhbCA9ICdtaW5pR3JpZCc7CiAgICB9CgogICAgaWYgKHRhZ3MuZGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGFncy5zeXN0ZW19LiR7dGFnTmFtZX1dIGluZmVycmVkIHBvcnRhbCBmcm9tIGJvdCBjbGljazpgLCBwb3J0YWwpOwogICAgfQoKICAgIGlmIChwb3J0YWwpIHsKICAgICAgICAvLyBEbyBhIHJheWNhc3QgYWdhaW5zdCB0aGUgY3VycmVudCBtb3VzZSBwb3NpdGlvbiBpZiBhIHRvdWNoIHBvaW50ZXIgY2xpY2tlZCBhIGJvdC4KICAgICAgICAvLyBXYXMgYWJsZSB0byB2ZXJpZnkgYXQgdGhlIHRpbWUgb2Ygd3JpdGluZyAoSmFuIDE5LCAyMDI2KSB0aGF0IHRoaXMgb25seSBvY2N1cnMgZm9yIHRvdWNoXzAgc28gaXQgc2hvdWxkIGJlCiAgICAgICAgLy8gc2FmZSB0byB1c2UgQ2FzdWFsT1MncyByZXBvcnRlZCBtb3VzZSBwb3NpdGlvbiBmb3IgdGhpcyBzaW5jZSB3ZSBkb250IGdldCBhIHRvdWNoIHBvc2l0aW9uLgogICAgICAgIGNvbnN0IHBvaW50ZXJQb3NpdGlvbiA9IG9zLmdldFBvaW50ZXJQb3NpdGlvbignbW91c2UnKTsKICAgICAgICBjb25zdCBwb2ludGVyRGlyZWN0aW9uID0gb3MuZ2V0UG9pbnRlckRpcmVjdGlvbignbW91c2UnKTsKICAgICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gYXdhaXQgb3MucmF5Y2FzdChwb3J0YWwsIHBvaW50ZXJQb3NpdGlvbiwgcG9pbnRlckRpcmVjdGlvbik7CgogICAgICAgIGxldCByYXljYXN0SGl0OwoKICAgICAgICBpZiAocmF5Y2FzdFJlc3VsdC5ib3RJbnRlcnNlY3Rpb25zICYmIHJheWNhc3RSZXN1bHQuYm90SW50ZXJzZWN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJheWNhc3RIaXQgPSByYXljYXN0UmVzdWx0LmJvdEludGVyc2VjdGlvbnMuZmluZCgoaCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIGguYm90LnRhZ3MucG9pbnRhYmxlICE9IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJheWNhc3RIaXQpIHsKICAgICAgICAgICAgLy8gQWRkIHRoaXMgdG91Y2ggY2xpY2sgdG8gdGhlIGN1cnNvciBxdWV1ZSBmb3IgdGhlIG5leHQgdGljay4KICAgICAgICAgICAgY29uc3QgY3Vyc29yUXVldWU6IEFCVXNlclByZXNlbmNlUXVldWVkQ3Vyc29yRGF0YVtdID0gdGhpc0JvdC52YXJzLmN1cnNvclF1ZXVlOwoKICAgICAgICAgICAgY3Vyc29yUXVldWUucHVzaCh7CiAgICAgICAgICAgICAgICBwb2ludGVyVHlwZTogJ3RvdWNoJywKICAgICAgICAgICAgICAgIGRpbWVuc2lvbiwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IHJheWNhc3RIaXQucG9pbnQueCwgeTogcmF5Y2FzdEhpdC5wb2ludC55LCB6OiByYXljYXN0SGl0LnBvaW50LnogfSwKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIHRoaXNCb3Qub25UaWNrKCk7CiAgICAgICAgfQogICAgfQp9JwD6+pCmBtEBCW9uRW50ZXJWUgIEAPr6kKYGjJgCE0BtYXNrcy5pblhSID0gdHJ1ZTsnAPr6kKYG0QEJb25FbnRlckFSAgQA+vqQpgagmAITQG1hc2tzLmluWFIgPSB0cnVlOycA+vqQpgbRAQhvbkV4aXRBUgIEAPr6kKYGtJgCE0BtYXNrcy5pblhSID0gbnVsbDsnAPr6kKYG0QEIb25FeGl0VlICBAD6+pCmBsiYAhNAbWFza3MuaW5YUiA9IG51bGw7JwD6+pCmBtEBC2N1cnNvck1vZGVsAgQA+vqQpgbcmALVFmRhdGE6dGV4dC94bWw7YmFzZTY0LFoyeFVSZ0lBQUFCd0NBQUFqQVFBQUVwVFQwNTdJbUZ6YzJWMElqcDdJbWRsYm1WeVlYUnZjaUk2SWt0b2NtOXViM01nWjJ4VVJpQkNiR1Z1WkdWeUlFa3ZUeUIyTXk0MExqVXdJaXdpZG1WeWMybHZiaUk2SWpJdU1DSjlMQ0psZUhSbGJuTnBiMjV6VlhObFpDSTZXeUpMU0ZKZmJXRjBaWEpwWVd4elgzVnViR2wwSWwwc0luTmpaVzVsSWpvd0xDSnpZMlZ1WlhNaU9sdDdJbTVoYldVaU9pSlRZMlZ1WlNJc0ltNXZaR1Z6SWpwYk1GMTlYU3dpYm05a1pYTWlPbHQ3SW0xbGMyZ2lPakFzSW01aGJXVWlPaUpEZFdKbEluMWRMQ0p0WVhSbGNtbGhiSE1pT2x0N0ltVjRkR1Z1YzJsdmJuTWlPbnNpUzBoU1gyMWhkR1Z5YVdGc2MxOTFibXhwZENJNmUzMTlMQ0p1WVcxbElqb2lUV0YwWlhKcFlXd2lMQ0p3WW5KTlpYUmhiR3hwWTFKdmRXZG9ibVZ6Y3lJNmV5SnRaWFJoYkd4cFkwWmhZM1J2Y2lJNk1Dd2ljbTkxWjJodVpYTnpSbUZqZEc5eUlqb3dMamw5ZlYwc0ltMWxjMmhsY3lJNlczc2libUZ0WlNJNklrTjFZbVVpTENKd2NtbHRhWFJwZG1WeklqcGJleUpoZEhSeWFXSjFkR1Z6SWpwN0lsQlBVMGxVU1U5T0lqb3dMQ0pVUlZoRFQwOVNSRjh3SWpveExDSk9UMUpOUVV3aU9qSjlMQ0pwYm1ScFkyVnpJam96TENKdFlYUmxjbWxoYkNJNk1IMWRmVjBzSW1GalkyVnpjMjl5Y3lJNlczc2lZblZtWm1WeVZtbGxkeUk2TUN3aVkyOXRjRzl1Wlc1MFZIbHdaU0k2TlRFeU5pd2lZMjkxYm5RaU9qSTRMQ0p0WVhnaU9sc3hMalE1TWpVMk1UTTBNRE16TWpBek1USXNNQzR3TnpVMU5ESTFNekU1TURjMU5UZzBOQ3d4TGpZd05UY3hNREUwT0RneE1UTTBNRE5kTENKdGFXNGlPbHN4TGpJNU1EUTFNakl3TURreE9UTTRPVGRsTFRBMUxDMHdMakE0TVRNNE56QTBNams1T1RJMk56VTRMRGN1TVRFMU16QTBORGN3TURZeU1qVTJaUzB3Tmwwc0luUjVjR1VpT2lKV1JVTXpJbjBzZXlKaWRXWm1aWEpXYVdWM0lqb3hMQ0pqYjIxd2IyNWxiblJVZVhCbElqbzFNVEkyTENKamIzVnVkQ0k2TWpnc0luUjVjR1VpT2lKV1JVTXlJbjBzZXlKaWRXWm1aWEpXYVdWM0lqb3lMQ0pqYjIxd2IyNWxiblJVZVhCbElqbzFNVEkyTENKamIzVnVkQ0k2TWpnc0luUjVjR1VpT2lKV1JVTXpJbjBzZXlKaWRXWm1aWEpXYVdWM0lqb3pMQ0pqYjIxd2IyNWxiblJVZVhCbElqbzFNVEl6TENKamIzVnVkQ0k2TXpZc0luUjVjR1VpT2lKVFEwRk1RVklpZlYwc0ltSjFabVpsY2xacFpYZHpJanBiZXlKaWRXWm1aWElpT2pBc0ltSjVkR1ZNWlc1bmRHZ2lPak16Tml3aVlubDBaVTltWm5ObGRDSTZNQ3dpZEdGeVoyVjBJam96TkRrMk1uMHNleUppZFdabVpYSWlPakFzSW1KNWRHVk1aVzVuZEdnaU9qSXlOQ3dpWW5sMFpVOW1abk5sZENJNk16TTJMQ0owWVhKblpYUWlPak0wT1RZeWZTeDdJbUoxWm1abGNpSTZNQ3dpWW5sMFpVeGxibWQwYUNJNk16TTJMQ0ppZVhSbFQyWm1jMlYwSWpvMU5qQXNJblJoY21kbGRDSTZNelE1TmpKOUxIc2lZblZtWm1WeUlqb3dMQ0ppZVhSbFRHVnVaM1JvSWpvM01pd2lZbmwwWlU5bVpuTmxkQ0k2T0RrMkxDSjBZWEpuWlhRaU9qTTBPVFl6ZlYwc0ltSjFabVpsY25NaU9sdDdJbUo1ZEdWTVpXNW5kR2dpT2prMk9IMWRmU0RJQXdBQVFrbE9BRUFNdno4SXRwbzlmTkVpUDBBTXZ6OEl0cG85Zk5FaVAwQU12ejhJdHBvOWZORWlQMXdoSHo4QXRwbzkyOUpPUDF3aEh6OEF0cG85MjlKT1Axd2hIejhBdHBvOTI5Sk9QMXdoSHo4QXRwbzkyOUpPUDRDQVdEY0x0cG85QUFEdk5vQ0FXRGNMdHBvOUFBRHZOb0NBV0RjTHRwbzlBQUR2Tm9DQVdEY0x0cG85QUFEdk5uZkpiVDRBdHBvOTZZZk5QM2ZKYlQ0QXRwbzk2WWZOUDNmSmJUNEF0cG85NllmTlAwQU12ejg0cnFhOWZORWlQMEFNdno4NHJxYTlmTkVpUDBBTXZ6ODRycWE5Zk5FaVAxd2hIejg0cnFhOTI5Sk9QMXdoSHo4NHJxYTkyOUpPUDF3aEh6ODRycWE5MjlKT1Axd2hIejg0cnFhOTI5Sk9QNENBV0RjdnJxYTlBTUR1Tm9DQVdEY3ZycWE5QU1EdU5vQ0FXRGN2cnFhOUFNRHVOb0NBV0RjdnJxYTlBTUR1Tm5mSmJUNUFycWE5NllmTlAzZkpiVDVBcnFhOTZZZk5QM2ZKYlQ1QXJxYTk2WWZOUHdBQUlEOEFBSUErQUFBZ1B3QUFnRDRBQUNBL0FBQ0FQZ0FBd0Q0QUFJQStBQURBUGdBQWdENEFBTUErQUFDQVBnQUF3RDRBQUlBK0FBQWdQd0FBQUFBQUFDQS9BQUFBQUFBQUlEOEFBQUFBQUFBZ1B3QUFBQUFBQU1BK0FBQUFBQUFBd0Q0QUFBQUFBQURBUGdBQUFBQUFBQ0EvQUFDQVBnQUFJRDhBQUlBK0FBQWdQd0FBZ0Q0QUFNQStBQUNBUGdBQXdENEFBSUErQUFEQVBnQUFnRDRBQU1BK0FBQ0FQZ0FBSUQ4QUFBQUFBQUFnUHdBQUFBQUFBQ0EvQUFBQUFBQUFJRDhBQUFBQUFBREFQZ0FBQUFBQUFNQStBQUFBQUFBQXdENEFBQUFBOHk4S3N3QUFnRC8zcFE4MHFFWkdQZ0FBQUFDNUozcy93clhJUGgxZmV6U0VnbXUvOHk4S3N3QUFnRC8zcFE4MEVtbkZNLy8vZnovZUhDa3pxRVpHUGdBQUFBQzVKM3MvYWc5bVB3QUFBQURJa3VBK1VsMTl2d0FBQUFCcmpoSSs4eThLc3dBQWdELzNwUTgwRW1uRk0vLy9mei9lSENrendyWElQaDFmZXpTRWdtdS9VbDE5dndBQUFBQnJqaEkrRW1uRk0vLy9mei9lSENremFnOW1Qd0FBQUFESWt1QStFR2xGc2dBQWdMOGV2cHF6cUVaR1BnQUFBQUM1SjNzL3dyWElQaDFmZXpTRWdtdS9xTzBkcy8vL2Y3OWlXYWV6RUdsRnNnQUFnTDhldnBxenFFWkdQZ0FBQUFDNUozcy9hZzltUHdBQUFBRElrdUErVWwxOXZ3QUFBQUJyamhJK3FPMGRzLy8vZjc5aVdhZXpFR2xGc2dBQWdMOGV2cHF6d3JYSVBoMWZlelNFZ211L1VsMTl2d0FBQUFCcmpoSStxTzBkcy8vL2Y3OWlXYWV6YWc5bVB3QUFBQURJa3VBK0JBQUpBQXdBQ0FBREFBQUFFUUFhQUJZQUZ3QU9BQklBQWdBUUFCZ0FBZ0FZQUFvQUJ3QVZBQmtBQndBWkFBc0FEUUFiQUJRQURRQVVBQVlBQlFBVEFBOEFCUUFQQUFFQScA+vqQpgbRARNjdXJzb3JDb25zdGFudFNjYWxlAgQA+vqQpgayrwIBOCcA+vqQpgbRARVjdXJzb3JJbml0aWFsRGlzdGFuY2UCBAD6+pCmBrSvAgMyMjUnAPr6kKYG0QEQb25BbnlCb3RzQ2hhbmdlZAIEAPr6kKYGuK8C5ghAY29uc3QgZ3JpZFBvcnRhbEJvdEluZGV4ID0gdGhhdC5maW5kSW5kZXgoKGVsKSA9PiB7CiAgICBpZiAoZWwgJiYgZ2xvYmFsVGhpcy5ncmlkUG9ydGFsQm90ICYmIGVsLmJvdCA9PT0gZ3JpZFBvcnRhbEJvdCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9KTsKCmlmIChncmlkUG9ydGFsQm90SW5kZXggPj0gMCkgewogICAgY29uc3QgY2hhbmdlZFRhZ3MgPSB0aGF0W2dyaWRQb3J0YWxCb3RJbmRleF0udGFnczsKICAgIGNvbnN0IGNhbWVyYUNoYW5nZWQgPSBjaGFuZ2VkVGFncy5zb21lKCh0KSA9PiB7CiAgICAgICAgcmV0dXJuIHQgPT09ICdjYW1lcmFQb3NpdGlvblgnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFQb3NpdGlvblknIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFQb3NpdGlvblonIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFQb3NpdGlvbk9mZnNldFgnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFQb3NpdGlvbk9mZnNldFknIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFQb3NpdGlvbk9mZnNldHonIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvblgnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvblknIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvblonIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvbk9mZnNldFgnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvbk9mZnNldFknIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvbk9mZnNldFonIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFSb3RhdGlvbk9mZnNldFcnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFGb2N1c1gnIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFGb2N1c1knIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFGb2N1c1onIHx8CiAgICAgICAgICAgIHQgPT09ICdjYW1lcmFab29tJyB8fAogICAgICAgICAgICB0ID09PSAnY2FtZXJhWm9vbU9mZnNldCc7CiAgICB9KQoKICAgIGlmIChjYW1lcmFDaGFuZ2VkKSB7CiAgICAgICAgc2hvdXQoJ29uR3JpZFBvcnRhbENhbWVyYUNoYW5nZWQnLCB7IGNoYW5nZWRUYWdzIH0pOwogICAgfQp9JwD6+pCmBtEBFmZsb2F0aW5nQ3Vyc29yRGlzdGFuY2UCBAD6+pCmBp+4AgMwLjcnAPr6kKYG0QEJYWJWZXJzaW9uAgQA+vqQpgajuAIFMTAuMzUnAPr6kKYG0QEFbGVhcm4CBAD6+pCmBqm4Aijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwD6+pCmBtEBD3BpbmdSaXBwbGVNb2RlbAIEAPr6kKYG0LgCJS9hYi9tZXNoZXMvcGluZ19yaXBwbGVfdG9ydXNfZmxhdC5nbGIA"}]}