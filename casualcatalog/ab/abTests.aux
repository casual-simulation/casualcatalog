{"version":2,"updates":[{"id":0,"timestamp":1756481169495,"update":"ASnC6/LABwAnAQRib3RzJGI4M2Q5NzJiLTA1MzUtNDA1MS1iNTg5LTQxY2VkYTg1MzVmMQEnAMLr8sAHAAZzeXN0ZW0CBADC6/LABwEQYWIudGVzdHMubWFuYWdlcicAwuvywAcAC3J1blRlc3RDYXNlAgQAwuvywAcS/xpAY29uc3QgdGVzdENhc2UgPSBnZXRCb3QoJ2lkJywgdGhhdCk7DQppZiAoIXRlc3RDYXNlKSB7DQogICAgY29uc29sZS5sb2coJ1Rlc3QgY2FzZSBub3QgZm91bmQhJyk7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAodGVzdENhc2UudGFncy5zeXN0ZW0pIHsNCiAgICBkZXN0cm95KGdldEJvdHMoDQogICAgICAgIGJ5VGFnKCdfX3Rlc3RSZXN1bHQnLCB0cnVlKQ0KICAgICkpOw0KfQ0KDQpjb25zdCBkID0gYXdhaXQgb3MuY3JlYXRlRGVidWdnZXIoew0KICAgIHBhdXNhYmxlOiB0cnVlLA0KICAgIGFsbG93QXN5bmNocm9ub3VzU2NyaXB0czogdHJ1ZQ0KfSk7DQoNCmlmICh0eXBlb2YgdGVzdENhc2UudGFncy5yYW5kb21TZWVkID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgdGVzdENhc2UudGFncy5yYW5kb21TZWVkID09PSAnc3RyaW5nJykgew0KICAgIGQubWF0aC5zZXRSYW5kb21TZWVkKHRlc3RDYXNlLnRhZ3MucmFuZG9tU2VlZCk7DQp9DQpjb25zdCB0aW1lbGluZSA9IFtdOw0KYXdhaXQgYm90Lmhvb2t1cERlYnVnZ2VyKHsgZGVidWc6IGQsIHRpbWVsaW5lIH0pOw0KYXdhaXQgYm90LmFkZEJvdHNUb0RlYnVnZ2VyKGQpOw0KDQpsZXQgYWN0aW9uc1RvUGVyZm9ybSA9IFtdOw0KbGV0IGFzeW5jUmVzdWx0cyA9IHt9OyANCg0KZm9yIChsZXQgZXZlbnQgb2YgdGVzdENhc2UudGFncy50aW1lbGluZSkgew0KICAgIHByZXByb2Nlc3NFdmVudChldmVudCk7DQp9DQoNCmZ1bmN0aW9uIHByZXByb2Nlc3NFdmVudChldmVudCkgew0KICAgIGlmIChldmVudC50eXBlID09PSAndXNlcl9hY3Rpb24nKSB7DQogICAgICAgIGlmICgndGltZWxpbmUnIGluIGV2ZW50KSB7DQogICAgICAgICAgICBmb3IgKGxldCBlIG9mIGV2ZW50LnRpbWVsaW5lKSB7DQogICAgICAgICAgICAgICAgcHJlcHJvY2Vzc0V2ZW50KGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbGV0IGFjdGlvbiA9IGV2ZW50LmFjdGlvbjsNCiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PT0gJ2FjdGlvbicgJiYgJ2tleXMnIGluIGFjdGlvbikgew0KICAgICAgICAgICAgICAgIGxldCBib3RJZHMgPSBhY3Rpb24ua2V5cy5tYXAoayA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkLmdldElEKGQuZ2V0Qm90KA0KICAgICAgICAgICAgICAgICAgICAgICAgZWl0aGVyKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5VGFnKCdzeXN0ZW0nLCBrKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieVRhZygnX19rZXknLCBrKSkNCiAgICAgICAgICAgICAgICAgICAgKSk7DQogICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICBhY3Rpb24gPSB7DQogICAgICAgICAgICAgICAgICAgIC4uLmFjdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgYm90SWRzLA0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgZGVsZXRlIGFjdGlvbi5rZXlzOw0KICAgICAgICAgICAgICAgIGFjdGlvbnNUb1BlcmZvcm0ucHVzaChhY3Rpb24pOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24udHlwZSA9PT0gJ2FzeW5jX3Jlc3VsdCcpIHsNCiAgICAgICAgICAgICAgICBhc3luY1Jlc3VsdHNbYWN0aW9uLnRhc2tJZF0gPSBhY3Rpb247DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICdzY3JpcHQnKSB7DQogICAgICAgIGZvciAobGV0IGUgb2YgZXZlbnQudGltZWxpbmUpIHsNCiAgICAgICAgICAgIHByZXByb2Nlc3NFdmVudChlKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KbGV0IHJlc29sdmU7DQpsZXQgcmVqZWN0Ow0KbGV0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHsNCiAgICByZXNvbHZlID0gcmVzOw0KICAgIHJlamVjdCA9IHJlajsNCn0pDQoNCmNvbnN0IGV4cGVjdGVkVGltZWxpbmUgPSB0ZXN0Q2FzZS50YWdzLnRpbWVsaW5lLnNsaWNlKCk7DQoNCmQub25TY3JpcHRBY3Rpb25FbnF1ZXVlZChhID0+IHsNCiAgICBpZiAoYS50eXBlICE9PSAnYXN5bmNfcmVzdWx0JyAmJiAndGFza0lkJyBpbiBhKSB7DQogICAgICAgIC8vIGFzeW5jIHRhc2sgd2FzIGVucXVldWVkDQogICAgICAgIC8vIHNlbmQgYXN5bmMgcmVzdWx0DQogICAgICAgIGxldCByZXN1bHQgPSBhc3luY1Jlc3VsdHNbYS50YXNrSWRdOw0KICAgICAgICBpZiAocmVzdWx0KSB7DQogICAgICAgICAgICBkLnBlcmZvcm1Vc2VyQWN0aW9uKHJlc3VsdCk7DQogICAgICAgIH0NCiAgICB9DQp9KTsNCg0KZm9yIChsZXQgYSBvZiBhY3Rpb25zVG9QZXJmb3JtKSB7DQogICAgY29uc29sZS5sb2coJ3BlcmZvcm0nLCBhKTsNCiAgICBhd2FpdCBkLnBlcmZvcm1Vc2VyQWN0aW9uKGEpOw0KfQ0KDQpmb3IgKGxldCBpID0gMDsgaSA8IDUwOyBpKyspIHsNCiAgICBhd2FpdCBQcm9taXNlLnJlc29sdmUoKTsNCn0NCg0KY29uc3QgcmVzdWx0VGltZWxpbmUgPSBib3QuY29tcGlsZVRpbWVsaW5lKHsgdGltZWxpbmU6IHRpbWVsaW5lIH0pOw0KDQpjb25zb2xlLmxvZygnUmVzdWx0JywgcmVzdWx0VGltZWxpbmUpOw0KDQpsZXQgcmVuZGVyZWRSZXN1bHQgPSB0aGlzQm90LnJlbmRlclRpbWVsaW5lKHsgdGltZWxpbmU6IHJlc3VsdFRpbWVsaW5lLCBuYW1lOiB0ZXN0Q2FzZS50YWdzLnRlc3ROYW1lIH0pOw0KbGV0IGV4cGVjdGVkUmVzdWx0ID0gdGhpc0JvdC5yZW5kZXJUaW1lbGluZSh7IHRpbWVsaW5lOiBleHBlY3RlZFRpbWVsaW5lLCBuYW1lOiB0ZXN0Q2FzZS50YWdzLnRlc3ROYW1lIH0pOw0KDQppZiAocmVuZGVyZWRSZXN1bHQuc3RyaW5nID09PSBleHBlY3RlZFJlc3VsdC5zdHJpbmcpIHsNCiAgICByZXR1cm4gew0KICAgICAgICBzdWNjZXNzOiB0cnVlDQogICAgfTsNCiAgICAvLyBvcy50b2FzdCgnU3VjZXNzIScpOw0KfSBlbHNlIHsNCiAgICBjb25zdCBzeXN0ZW0gPSAndGVzdC1mYWlsdXJlcy4nICsgdGVzdENhc2UudGFncy50ZXN0TmFtZTsNCiAgICBsZXQgeyByZXN1bHRCb3QgfSA9IHRoaXNCb3QuY3JlYXRlQm90c0ZvclJlbmRlcmVkVGltZWxpbmUoew0KICAgICAgICBzeXN0ZW0sDQogICAgICAgIHJlc3VsdDogcmVuZGVyZWRSZXN1bHQsDQogICAgICAgIGNyZWF0b3I6IHRlc3RDYXNlLA0KICAgICAgICBzeXN0ZW1UYWc6ICd0ZXN0U3lzdGVtJw0KICAgIH0pOw0KDQogICAgbGV0IHsgcmVzdWx0Qm90OiBleHBlY3RlZEJvdCB9ID0gdGhpc0JvdC5jcmVhdGVCb3RzRm9yUmVuZGVyZWRUaW1lbGluZSh7DQogICAgICAgIHN5c3RlbSwNCiAgICAgICAgcmVzdWx0OiBleHBlY3RlZFJlc3VsdCwNCiAgICAgICAgdGVzdENhc2UsDQogICAgICAgIHN5c3RlbVRhZzogJ3N5c3RlbScNCiAgICB9KTsNCg0KICAgIHJldHVybiB7DQogICAgICAgIHN1Y2Nlc3M6IGZhbHNlLA0KICAgICAgICBzeXN0ZW06IHN5c3RlbSwNCiAgICAgICAgZGlmZkJvdElkOiBleHBlY3RlZEJvdC5pZCwNCiAgICB9Ow0KfScAwuvywAcADmhvb2t1cERlYnVnZ2VyAgQAwuvywAeSG7g+QGNvbnN0IHsgZGVidWc6IGQsIGFkZEtleXMsIHRpbWVsaW5lLCBub1dhcm5NaXNzaW5nS2V5cyB9ID0gdGhhdDsNCmNvbnN0IGJvdFRpbWVsaW5lID0gdGltZWxpbmUgPz8gW107DQoNCmNvbnN0IGFjdGlvblRpbWVsaW5lcyA9IHt9Ow0KY29uc3Qgc2NyaXB0VGltZWxpbmVzID0ge307DQoNCmxldCBlbWl0dGVkQWN0aW9ucyA9IFtdOw0KY29uc3QgYXN5bmNSZXF1ZXN0cyA9IG5ldyBNYXAoKTsNCmxldCBhc3luY1RpbWVsaW5lID0gbnVsbDsNCmxldCBzeW5jQ291bnRlciA9IDA7DQoNCmxldCBib3RLZXlzID0ge307DQoNCmZ1bmN0aW9uIHNob3VsZFNraXBBY3Rpb24oYSkgew0KICAgIGNvbnN0IGMgPSBkLmNvbmZpZ0JvdDsNCiAgICBpZiAoIWMpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIGlmIChhLnR5cGUgIT09ICdhY3Rpb24nKSB7DQogICAgICAgIGlmIChhLnR5cGUgPT09ICd1cGRhdGVfYm90Jykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnYWRkX2JvdCcpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKGEudHlwZSA9PT0gJ3JlbW92ZV9ib3QnKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdhc3luY19yZXN1bHQnKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnYXN5bmNfZXJyb3InKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnYXBwbHlfc3RhdGUnKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdyZWdpc3Rlcl9idWlsdGluX3BvcnRhbCcpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYoYS50eXBlID09PSAnY3VzdG9tX2FwcF9jb250YWluZXJfYXZhaWxhYmxlJykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAncmVnaXN0ZXJfaHRtbF9hcHAnICYmIGEuYXBwSWQgPT09ICdfcm9vdCcpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKGEudHlwZSA9PT0gJ2RlZmluZV9nbG9iYWxfYm90Jykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KDQpmdW5jdGlvbiBzaG91bGRTa2lwVXBkYXRlRm9yQm90KHVwZGF0ZSkgew0KICAgIGNvbnN0IGIgPSBnZXRCb3QoYnlJRCh1cGRhdGUuYm90SWQpKTsNCiAgICByZXR1cm4gKA0KICAgICAgICBiICYmICgNCiAgICAgICAgICAgIGJ5VGFnKCdhYicpKGIpIHx8IGJ5VGFnKCdhYklEJykoYikNCiAgICAgICAgKQ0KICAgICk7DQp9DQoNCmQub25CZWZvcmVVc2VyQWN0aW9uKGEgPT4gew0KICAgIGlmIChzaG91bGRTa2lwQWN0aW9uKGEpKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgY29uc29sZS5sb2coJ3VzZXIgYWN0aW9uJywgYSk7DQoNCiAgICBpZiAoYS50eXBlID09PSAnYWN0aW9uJykgew0KICAgICAgICBhc3luY1RpbWVsaW5lID0gbnVsbDsNCiAgICAgICAgc3luY0NvdW50ZXIgKz0gMTsNCiAgICAgICAgYWRkQm90QWN0aW9uKGEpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChhLnR5cGUgPT09ICdhc3luY19yZXN1bHQnKSB7DQogICAgICAgICAgICAvLyB0aGUgdGltZWxpbmUgdGhhdCBzdGFydGVkIHRoZSBhc3luYyByZXF1ZXN0Lg0KICAgICAgICAgICAgYXN5bmNUaW1lbGluZSA9IGFzeW5jUmVxdWVzdHMuZ2V0KGEudGFza0lkKTsNCiAgICAgICAgICAgIGlmICghYXN5bmNUaW1lbGluZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhc3luYycsIGFzeW5jUmVxdWVzdHMsIGEpOw0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQXN5bmMgdGltZWxpbmUgbm90IGZvdW5kIGZvciB0YXNrISAodGFza0lkOiAke2EudGFza0lkfSlgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGFzeW5jVGltZWxpbmUucHVzaCh7DQogICAgICAgICAgICAgICAgdHlwZTogJ3VzZXJfYWN0aW9uJywNCiAgICAgICAgICAgICAgICBhY3Rpb246IGEsDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGJvdFRpbWVsaW5lLnB1c2goew0KICAgICAgICAgICAgICAgIHR5cGU6ICd1c2VyX2FjdGlvbicsDQogICAgICAgICAgICAgICAgYWN0aW9uOiBhLA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQp9KTsNCg0KZC5vblNjcmlwdEFjdGlvbkVucXVldWVkKGEgPT4gew0KICAgIGNvbnNvbGUubG9nKCdlbWl0IGFjdGlvbicsIGEpOw0KICAgIGNvbnNvbGUubG9nKCdjYWxsIHN0YWNrJywgZC5nZXRDYWxsU3RhY2soKSk7DQogICAgbGV0IHRpbWVsaW5lID0gZ2V0Q3VycmVudFNjcmlwdFRpbWVsaW5lKCk7DQoNCiAgICBpZiAodGltZWxpbmUpIHsNCiAgICAgICAgdGltZWxpbmUucHVzaCh7DQogICAgICAgICAgICB0eXBlOiAnZW1pdHRlZF9hY3Rpb24nLA0KICAgICAgICAgICAgYWN0aW9uOiBhLA0KICAgICAgICAgICAgbG9jYXRpb246IGdldEN1cnJlbnRTY3JpcHRMb2NhdGlvbigpIA0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICBpZiAoJ3Rhc2tJZCcgaW4gYSkgew0KICAgICAgICBpZiAoIXRpbWVsaW5lKSB7DQogICAgICAgICAgICBkZWJ1Z2dlcjsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHRpbWVsaW5lIGZvciB0aGUgc2NyaXB0IGFjdGlvbiBjb3VsZCBub3QgYmUgZm91bmQhJyk7DQogICAgICAgIH0NCiAgICAgICAgYXN5bmNSZXF1ZXN0cy5zZXQoYS50YXNrSWQsIHRpbWVsaW5lKTsNCiAgICB9DQp9KTsNCg0KZC5vbkFmdGVyU2NyaXB0VXBkYXRlZFRhZyh1cGRhdGUgPT4gew0KICAgIGlmIChzaG91bGRTa2lwVXBkYXRlRm9yQm90KHVwZGF0ZSkpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnNvbGUubG9nKCd1cGRhdGUgdGFnJywgdXBkYXRlKTsNCiAgICBjb25zb2xlLmxvZygnY2FsbCBzdGFjaycsIGQuZ2V0Q2FsbFN0YWNrKCkpOw0KICAgIGxldCB0aW1lbGluZSA9IGdldEN1cnJlbnRTY3JpcHRUaW1lbGluZSgpOw0KDQogICAgaWYgKHRpbWVsaW5lKSB7DQogICAgICAgIGxldCB7IGJvdElkLCAuLi5yZXN0IH0gPSB1cGRhdGU7DQoNCiAgICAgICAgdGltZWxpbmUucHVzaCh7DQogICAgICAgICAgICB0eXBlOiAndXBkYXRlX3RhZycsDQogICAgICAgICAgICB1cGRhdGU6IHsNCiAgICAgICAgICAgICAgICAuLi5yZXN0LA0KICAgICAgICAgICAgICAgIGJvdElkOiBnZXRCb3RLZXkoYm90SWQpID8/IGJvdElkDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgbG9jYXRpb246IGdldEN1cnJlbnRTY3JpcHRMb2NhdGlvbigpDQogICAgICAgIH0pOw0KICAgIH0NCn0pOw0KDQpkLm9uQWZ0ZXJTY3JpcHRVcGRhdGVkVGFnTWFzayh1cGRhdGUgPT4gew0KICAgIGlmIChzaG91bGRTa2lwVXBkYXRlRm9yQm90KHVwZGF0ZSkpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnNvbGUubG9nKCd1cGRhdGUgdGFnIG1hc2snLCB1cGRhdGUpOw0KICAgIGNvbnNvbGUubG9nKCdjYWxsIHN0YWNrJywgZC5nZXRDYWxsU3RhY2soKSk7DQogICAgbGV0IHRpbWVsaW5lID0gZ2V0Q3VycmVudFNjcmlwdFRpbWVsaW5lKCk7DQoNCiAgICBpZiAodGltZWxpbmUpIHsNCiAgICAgICAgbGV0IHsgYm90SWQsIC4uLnJlc3QgfSA9IHVwZGF0ZTsNCg0KICAgICAgICB0aW1lbGluZS5wdXNoKHsNCiAgICAgICAgICAgIHR5cGU6ICd1cGRhdGVfdGFnX21hc2snLA0KICAgICAgICAgICAgdXBkYXRlOiB7DQogICAgICAgICAgICAgICAgLi4ucmVzdCwNCiAgICAgICAgICAgICAgICBib3RJZDogZ2V0Qm90S2V5KGJvdElkKSA/PyBib3RJZA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGxvY2F0aW9uOiBnZXRDdXJyZW50U2NyaXB0TG9jYXRpb24oKQ0KICAgICAgICB9KTsNCiAgICB9DQp9KTsNCg0KZnVuY3Rpb24gZ2V0Q3VycmVudFNjcmlwdFRpbWVsaW5lKCkgew0KICAgIGlmICghYXN5bmNUaW1lbGluZSkgew0KICAgICAgICBsZXQgY3VycmVudFNjcmlwdCA9IGdldEN1cnJlbnRTY3JpcHQoKTsNCiAgICAgICAgaWYgKGN1cnJlbnRTY3JpcHQpIHsNCiAgICAgICAgICAgIHJldHVybiBnZXRTY3JpcHRUaW1lbGluZShjdXJyZW50U2NyaXB0LmJvdElkLCBjdXJyZW50U2NyaXB0LnRhZywgc3luY0NvdW50ZXIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBhc3luY1RpbWVsaW5lOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gZ2V0U2NyaXB0VGltZWxpbmUoYm90SWQsIHRhZywgc3luY0NvdW50ZXIpIHsNCiAgICBjb25zdCBrZXkgPSBgJHtib3RJZH0uJHt0YWd9OiR7c3luY0NvdW50ZXJ9YDsNCiAgICBsZXQgdGltZWxpbmUgPSBzY3JpcHRUaW1lbGluZXNba2V5XTsNCiAgICBpZiAoIXRpbWVsaW5lKSB7DQogICAgICAgIHNjcmlwdFRpbWVsaW5lc1trZXldID0gdGltZWxpbmUgPSBbXTsNCiAgICAgICAgbGV0IGFjdGlvblRpbWVsaW5lID0gYWN0aW9uVGltZWxpbmVzW3N5bmNDb3VudGVyXTsNCg0KICAgICAgICBpZiAoYWN0aW9uVGltZWxpbmUpIHsNCiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsQm90SWQgPSBnZXRPcmlnaW5hbEJvdElkKGJvdElkKTsNCiAgICAgICAgICAgIGFjdGlvblRpbWVsaW5lLnB1c2goew0KICAgICAgICAgICAgICAgIHR5cGU6ICdzY3JpcHQnLA0KICAgICAgICAgICAgICAgIGJvdElkOiBnZXRCb3RLZXkoYm90SWQpLA0KICAgICAgICAgICAgICAgIHRhZzogdGFnLA0KICAgICAgICAgICAgICAgIGNvdW50OiBzeW5jQ291bnRlciwNCiAgICAgICAgICAgICAgICB0aW1lbGluZSwNCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogew0KICAgICAgICAgICAgICAgICAgICBib3RJZDogb3JpZ2luYWxCb3RJZCwNCiAgICAgICAgICAgICAgICAgICAgdGFnLA0KICAgICAgICAgICAgICAgICAgICBsaW5lOiAwLA0KICAgICAgICAgICAgICAgICAgICBjb2x1bW46IDANCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdGltZWxpbmU7DQp9DQoNCmZ1bmN0aW9uIGdldEN1cnJlbnRTY3JpcHQoKSB7DQogICAgY29uc3QgY2FsbFN0YWNrID0gZC5nZXRDYWxsU3RhY2soKTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhbGxTdGFjay5sZW5ndGg7IGkrKykgew0KICAgICAgICBsZXQgZnJhbWUgPSBjYWxsU3RhY2tbaV07DQogICAgICAgIGlmIChmcmFtZS5sb2NhdGlvbj8uYm90SWQgJiYgZnJhbWUubG9jYXRpb24/LnRhZykgew0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICBib3RJZDogZnJhbWUubG9jYXRpb24uYm90SWQsDQogICAgICAgICAgICAgICAgdGFnOiBmcmFtZS5sb2NhdGlvbi50YWcNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICByZXR1cm4gbnVsbDsNCn0NCg0KZnVuY3Rpb24gZ2V0Q3VycmVudFNjcmlwdExvY2F0aW9uKCkgew0KICAgIGNvbnN0IGNhbGxTdGFjayA9IGQuZ2V0Q2FsbFN0YWNrKCk7DQogICAgZm9yIChsZXQgaSA9IGNhbGxTdGFjay5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgew0KICAgICAgICBsZXQgZnJhbWUgPSBjYWxsU3RhY2tbaV07DQogICAgICAgIGlmIChmcmFtZS5sb2NhdGlvbj8uYm90SWQgJiYgZnJhbWUubG9jYXRpb24/LnRhZykgew0KICAgICAgICAgICAgY29uc3QgYm90SWQgPSBnZXRPcmlnaW5hbEJvdElkKGZyYW1lLmxvY2F0aW9uLmJvdElkKTsNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgYm90SWQ6IGJvdElkLA0KICAgICAgICAgICAgICAgIHRhZzogZnJhbWUubG9jYXRpb24udGFnLA0KICAgICAgICAgICAgICAgIGxpbmU6IGZyYW1lLmxvY2F0aW9uLmxpbmVOdW1iZXIsDQogICAgICAgICAgICAgICAgY29sdW1uOiBmcmFtZS5sb2NhdGlvbi5jb2x1bW5OdW1iZXINCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgcmV0dXJuIG51bGw7DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIGFkZEJvdEFjdGlvbihhKSB7DQogICAgbGV0IGFjdGlvbjsNCiAgICBpZiAoYS5ib3RJZHMpIHsNCiAgICAgICAgbGV0IGtleXMgPSBbXTsNCiAgICAgICAgZm9yIChsZXQgYm90SWQgb2YgYS5ib3RJZHMpIHsNCiAgICAgICAgICAgIGNvbnN0IGtleSA9IGdldEJvdEtleShib3RJZCk7DQogICAgICAgICAgICBpZiAoIWtleSkgew0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBrZXlzLnB1c2goa2V5KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGFjdGlvbiA9IHsNCiAgICAgICAgICAgIC4uLmEsDQogICAgICAgICAgICBrZXlzDQogICAgICAgIH07DQogICAgICAgIGRlbGV0ZSBhY3Rpb24uYm90SWRzOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGFjdGlvbiA9IGE7DQogICAgfQ0KDQogICAgY29uc3QgdGltZWxpbmUgPSBhY3Rpb25UaW1lbGluZXNbc3luY0NvdW50ZXJdID0gWw0KICAgICAgICB7DQogICAgICAgICAgICB0eXBlOiAndXNlcl9hY3Rpb24nLA0KICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sDQogICAgICAgIH0NCiAgICBdOw0KICAgIGJvdFRpbWVsaW5lLnB1c2goew0KICAgICAgICB0eXBlOiAndXNlcl9hY3Rpb24nLA0KICAgICAgICB0aW1lbGluZTogdGltZWxpbmUNCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gZ2V0T3JpZ2luYWxCb3RJZChib3RJZCkgew0KICAgIGxldCBib3QgPSBkLmdldEJvdCgnaWQnLCBib3RJZCk7DQogICAgaWYgKCFib3QgfHwgIWJvdC50YWdzLl9fb3JpZ2luYWxCb3RJZCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgbGV0IG9yaWdpbmFsQm90ID0gZ2V0Qm90KCdpZCcsIGJvdC50YWdzLl9fb3JpZ2luYWxCb3RJZCk7DQogICAgaWYgKCFvcmlnaW5hbEJvdCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQoNCiAgICByZXR1cm4gb3JpZ2luYWxCb3QuaWQ7DQp9DQoNCmZ1bmN0aW9uIGdldEJvdEtleShib3RJZCkgew0KICAgIGxldCBib3QgPSBkLmdldEJvdCgnaWQnLCBib3RJZCk7DQogICAgaWYgKCFib3QgfHwgIWJvdC50YWdzLl9fb3JpZ2luYWxCb3RJZCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgbGV0IG9yaWdpbmFsQm90ID0gZ2V0Qm90KCdpZCcsIGJvdC50YWdzLl9fb3JpZ2luYWxCb3RJZCk7DQogICAgaWYgKCFvcmlnaW5hbEJvdCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgbGV0IGtleSA9IGJvdC50YWdzLl9fa2V5ID8/IGJvdC50YWdzLnN5c3RlbSA/PyBib3RLZXlzW2JvdElkXTsNCiAgICBpZiAoIWtleSkgew0KICAgICAgICBpZiAoYWRkS2V5cykgew0KICAgICAgICAgICAga2V5ID0gYm90S2V5c1tib3RJZF0gPSBvcmlnaW5hbEJvdC50YWdzLl9fa2V5ID0gdXVpZCgpOw0KICAgICAgICB9IGVsc2UgaWYgKG5vV2Fybk1pc3NpbmdLZXlzKSB7DQogICAgICAgICAgICBrZXkgPSBvcmlnaW5hbEJvdC5pZDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnNvbGUud2FybihgTm8ga2V5IGNvdWxkIGJlIGRldGVybWluZWQgZm9yICR7Ym90SWR9ISBTZXQgdGhlIHN5c3RlbSB0YWcgb3IgdGhlIF9fa2V5IHRhZyB0byBlbmFibGUgY29uc2lzdGVudCB0ZXN0cy5gKTsNCiAgICAgICAgICAgIG9zLnRvYXN0KGBObyBrZXkgY291bGQgYmUgZGV0ZXJtaW5lZCBmb3IgJHtib3RJZH0hIFNldCB0aGUgc3lzdGVtIHRhZyBvciB0aGUgX19rZXkgdGFnIHRvIGVuYWJsZSBjb25zaXN0ZW50IHRlc3RzLmApOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBrZXk7DQp9JwDC6/LABwAPY29tcGlsZVRpbWVsaW5lAgQAwuvywAfLWdoEQGxldCBmaW5hbFRpbWVsaW5lID0gW107DQpsZXQgaGFzVXNlckFjdGlvbiA9IGZhbHNlOw0KbGV0IHRpbWVsaW5lID0gdGhhdC50aW1lbGluZTsNCg0KZm9yKGxldCBpID0gMDsgaSA8IHRpbWVsaW5lLmxlbmd0aDsgaSsrKSB7DQogICAgY29uc3QgZXZlbnQgPSB0aW1lbGluZVtpXTsNCg0KICAgIGlmIChldmVudC50eXBlID09PSAndXNlcl9hY3Rpb24nKSB7DQogICAgICAgIGhhc1VzZXJBY3Rpb24gPSB0cnVlOw0KDQogICAgICAgIGlmICgndGltZWxpbmUnIGluIGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoZXZlbnQudGltZWxpbmUubGVuZ3RoIDw9IDEpIHsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoIWhhc1VzZXJBY3Rpb24pIHsNCiAgICAgICAgY29udGludWU7DQogICAgfQ0KDQogICAgZmluYWxUaW1lbGluZS5wdXNoKGV2ZW50KTsNCn0NCg0KY29uc29sZS5sb2coJ1tkZWJ1Z10gVGltZWxpbmUnLCB0aW1lbGluZS5zbGljZSgpKTsNCmNvbnNvbGUubG9nKCdbZGVidWddIEZpbmFsIFRpbWVsaW5lJywgZmluYWxUaW1lbGluZSk7DQpyZXR1cm4gZmluYWxUaW1lbGluZTsnAMLr8sAHABFhZGRCb3RzVG9EZWJ1Z2dlcgIEAMLr8sAHpl7kCEBjb25zdCBkID0gdGhhdDsNCmNvbnN0IHRlc3RhYmxlQm90cyA9IGdldEJvdHMoDQogICAgbm90KGJ5VGFnKCdfX3Rlc3QnKSksDQogICAgbm90KGJ5VGFnKCdhYicpKSwNCiAgICBub3QoYnlUYWcoJ2FiSUQnKSksDQogICAgbm90KGJ5SUQoZ2V0SUQodGhpc0JvdCkpKSwNCiAgICBub3QoYnlUYWcoJ2FiVGVzdFRvb2xzJykpLA0KICAgIG5vdChieVNwYWNlKCdib290c3RyYXAnKSkNCik7DQoNCmlmICh0ZXN0YWJsZUJvdHMubGVuZ3RoIDw9IDApIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYWJsZSB0byBjcmVhdGUgdGVzdCB3aXRoIG5vIGJvdHMhJyk7DQp9DQpmb3IgKGxldCBiIG9mIHRlc3RhYmxlQm90cykgew0KICAgIGlmIChiLmlkID09PSBncmlkUG9ydGFsQm90LmlkIHx8IA0KICAgICAgICBiLmlkID09PSBjb25maWdCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbWluaUdyaWRQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbWFwUG9ydGFsQm90LmlkIHx8DQogICAgICAgIGIuaWQgPT09IHN5c3RlbVBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSBzaGVldFBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSB0YWdQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbWVudVBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSBpZGVQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbWVldFBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSBib3RQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbWluaU1hcFBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSBsZWZ0V3Jpc3RQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gcmlnaHRXcmlzdFBvcnRhbEJvdC5pZCkgew0KICAgICAgICBjb250aW51ZTsNCiAgICB9DQoNCiAgICBsZXQgdGFncyA9IE9iamVjdC5rZXlzKGIudGFncyk7DQoNCiAgICBpZiAodGFncy5sZW5ndGggPD0gMCkgew0KICAgICAgICBjb25zb2xlLmxvZygnbm8gdGFncyEnLCBiKTsNCiAgICAgICAgY29udGludWU7DQogICAgfQ0KICAgIGF3YWl0IGQuY3JlYXRlKGIsIHsNCiAgICAgICAgX19vcmlnaW5hbEJvdElkOiBiLmlkDQogICAgfSk7DQp9JwDC6/LABwAEYWJJRAIEAMLr8sAHi2cNdGVzdHMtbWFuYWdlcicAwuvywAcABWNvbG9yAgQAwuvywAeZZwcjZjFmZjNhJwDC6/LABwAPb25Qb3J0YWxDaGFuZ2VkAgQAwuvywAehZ5EEQGlmICh0aGF0LnBvcnRhbCA9PT0gJ3N5c3RlbVBvcnRhbCcpIHsNCiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmNvZGVUb29sc1BvcnRhbCkgew0KICAgICAgICBjb25maWdCb3QubWFza3MuY29kZVRvb2xzUG9ydGFsID0gJ2FiVGVzdFRvb2xzJzsNCg0KICAgICAgICBkZXN0cm95KGdldEJvdHMoDQogICAgICAgICAgICBieVRhZygnYWJUZXN0VG9vbHMnLCB0cnVlKSwNCiAgICAgICAgICAgIGJ5U3BhY2UoJ3RlbXBMb2NhbCcpDQogICAgICAgICkpOw0KDQogICAgICAgIGNvbnN0IHJ1blRlc3RzQnV0dG9uID0gY3JlYXRlKHsNCiAgICAgICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywNCiAgICAgICAgICAgIGFiVGVzdFRvb2xzOiB0cnVlLA0KICAgICAgICAgICAgbGFiZWw6ICdSdW4gVGVzdHMnLA0KICAgICAgICAgICAgb25DbGljazogYEBzaG91dCgiYWJSdW5UZXN0cyIpYCwNCiAgICAgICAgfSk7DQoNCiAgICAgICAgdGhpc0JvdC5tYXNrcy5ydW5UZXN0c0J1dHRvbiA9IHJ1blRlc3RzQnV0dG9uLmxpbms7DQogICAgfQ0KfScAwuvywAcADGFiUmVjb3JkVGVzdAIEAMLr8sAHs2uUDEBjb25zdCB0ZXN0TmFtZSA9IGF3YWl0IG9zLnNob3dJbnB1dCgnJywgew0KICAgIHRpdGxlOiAnRW50ZXIgdGVzdCBuYW1lJw0KfSk7DQoNCmlmICghdGVzdE5hbWUpIHsNCiAgICBvcy50b2FzdCgiWW91IG11c3QgcHJvdmlkZSBhIHRlc3QgbmFtZSBpbiBvcmRlciB0byByZWNvcmQgYSB0ZXN0LiIpOw0KICAgIHJldHVybjsNCn0NCg0KY29uc3QgZCA9IGF3YWl0IG9zLmNyZWF0ZURlYnVnZ2VyKHsNCiAgICBwYXVzYWJsZTogdHJ1ZSwNCiAgICBhbGxvd0FzeW5jaHJvbm91c1NjcmlwdHM6IHRydWUNCn0pOw0KDQpjb25zdCBzZWVkID0gbWF0aC5yYW5kb21JbnQoLTIxNDc0ODM2NDgsIDIxNDc0ODM2NDcpOw0KYm90LnZhcnMudHJhY2luZyA9IG51bGw7DQpib3QudmFycy50ZXN0TmFtZSA9IHRlc3ROYW1lOw0KYm90LnZhcnMucmFuZG9tU2VlZCA9IHNlZWQ7DQpib3QudmFycy5kZWJ1ZyA9IGQ7DQpkLm1hdGguc2V0UmFuZG9tU2VlZChzZWVkKTsNCmJvdC52YXJzLnRpbWVsaW5lID0gW107DQphd2FpdCBib3QuaG9va3VwRGVidWdnZXIoeyBkZWJ1ZzogZCwgYWRkS2V5czogdHJ1ZSwgdGltZWxpbmU6IGJvdC52YXJzLnRpbWVsaW5lIH0pOw0KYXdhaXQgYm90LmFkZEJvdHNUb0RlYnVnZ2VyKGQpOw0KDQphd2FpdCBvcy5hdHRhY2hEZWJ1Z2dlcihkLCB7DQogICAgdGFnTmFtZU1hcHBlcjogew0KICAgICAgICBmb3J3YXJkOiBmb3J3YXJkTWFwVGFnTmFtZSwNCiAgICAgICAgcmV2ZXJzZTogcmV2ZXJzZU1hcFRhZ05hbWUNCiAgICB9LA0KfSk7DQoNCmF3YWl0IG9zLnNsZWVwKDEwMDApOw0KDQppZiAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCkgew0KICAgIGJvdC52YXJzLm9yaWdpbmFsR3JpZFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7DQogICAgZC5jb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9ICd0ZXN0LScgKyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOw0KfQ0KDQpzaG91dCgiYWJTbGVlcCIsICJzbGVlcCIpOw0Kc2hvdXQoJ2FiUmVzZXQnKTsNCg0KZnVuY3Rpb24gZm9yd2FyZE1hcFRhZ05hbWUobmFtZSkgew0KICAgIGNvbnN0IGJ1aWx0aW5UYWdzID0gb3MubGlzdEJ1aWx0aW5UYWdzKCk7DQogICAgaWYgKGJ1aWx0aW5UYWdzLnNvbWUodCA9PiB0ID09PSBuYW1lKSkgew0KICAgICAgICByZXR1cm4gbmFtZTsNCiAgICB9DQoNCiAgICByZXR1cm4gJ3Rlc3QtJyArIG5hbWU7DQp9DQoNCmZ1bmN0aW9uIHJldmVyc2VNYXBUYWdOYW1lKG5hbWUpIHsNCiAgICBjb25zdCBidWlsdGluVGFncyA9IG9zLmxpc3RCdWlsdGluVGFncygpOw0KICAgIGlmIChidWlsdGluVGFncy5zb21lKHQgPT4gdCA9PT0gbmFtZSkpIHsNCiAgICAgICAgcmV0dXJuIG5hbWU7DQogICAgfQ0KDQogICAgbGV0IHdpdGhvdXRUZXN0ID0gbmFtZS5zdWJzdHJpbmcoJ3Rlc3QtJy5sZW5ndGgpOw0KICAgIHJldHVybiB3aXRob3V0VGVzdDsNCn0NCg0KYXdhaXQgb3MucmVnaXN0ZXJBcHAoJ2FiVGVzdGluZ0FwcCcsIHRoaXNCb3QpOw0KdGhpc0JvdC5yZW5kZXJUZXN0aW5nQXBwKCk7JwDC6/LABwAQcmVuZGVyVGVzdGluZ0FwcAIEAMLr8sAHyHesA0BsZXQgcmVzdWx0Ow0KDQppZiAgKHRoaXNCb3QudmFycy5kZWJ1Zykgew0KICAgIGlmICh0aGlzQm90LnZhcnMudHJhY2luZykgew0KICAgICAgICByZXN1bHQgPSA8ZGl2Pg0KICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiB0aGlzQm90LmFiU3RvcFRyYWNpbmcoKX0+U3RvcCBUcmFjaW5nPC9idXR0b24+DQogICAgICAgIDwvZGl2Pg0KICAgIH0gZWxzZSB7DQogICAgICAgIHJlc3VsdCA9IDxkaXY+DQogICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHRoaXNCb3QuYWJTdG9wUmVjb3JkaW5nKCl9PlN0b3AgUmVjb3JkaW5nPC9idXR0b24+DQogICAgICAgIDwvZGl2Pg0KICAgIH0NCn0gZWxzZSB7DQogICAgcmVzdWx0ID0gPGRpdj48L2Rpdj47DQp9DQoNCm9zLmNvbXBpbGVBcHAoJ2FiVGVzdGluZ0FwcCcsIHJlc3VsdCk7JwDC6/LABwAPYWJTdG9wUmVjb3JkaW5nAgQAwuvywAf1etIFQGlmIChib3QudmFycy5kZWJ1Zykgew0KICAgIGF3YWl0IG9zLmRldGFjaERlYnVnZ2VyKGJvdC52YXJzLmRlYnVnKTsNCn0NCg0KYm90LnZhcnMuZGVidWcgPSBudWxsOw0KYm90LnZhcnMudHJhY2luZyA9IG51bGw7DQoNCmlmIChib3QudmFycy5vcmlnaW5hbEdyaWRQb3J0YWwpIHsNCiAgICBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gYm90LnZhcnMub3JpZ2luYWxHcmlkUG9ydGFsOw0KICAgIGJvdC52YXJzLm9yaWdpbmFsR3JpZFBvcnRhbCA9IG51bGw7DQp9DQoNCmNvbnNvbGUubG9nKCdbZGVidWddIERvbmUhJyk7DQpsZXQgZmluYWxUaW1lbGluZSA9IGJvdC5jb21waWxlVGltZWxpbmUoeyB0aW1lbGluZTogYm90LnZhcnMudGltZWxpbmUgfSk7DQoNCmNyZWF0ZSh7DQogICAgX190ZXN0OiB0cnVlLA0KICAgIF9fdGVzdENhc2U6IHRydWUsDQogICAgdGltZWxpbmU6ICfwn6esJyArIGdldEZvcm1hdHRlZEpTT04oZmluYWxUaW1lbGluZS5zbGljZSgpKSwNCiAgICBvbkNsaWNrOiBgQHNob3V0KCdydW5UZXN0Q2FzZScsIHRoaXNCb3QuaWQpYCwNCiAgICBzeXN0ZW06ICd0ZXN0cy4nICsgYm90LnZhcnMudGVzdE5hbWUsDQogICAgcmFuZG9tU2VlZDogYm90LnZhcnMucmFuZG9tU2VlZCwNCiAgICB0ZXN0TmFtZTogYm90LnZhcnMudGVzdE5hbWUNCn0pOw0KDQpzaG91dCgiYWJTbGVlcCIsICJ3YWtlIik7DQp0aGlzQm90LnJlbmRlclRlc3RpbmdBcHAoKTsnAMLr8sAHAAphYlJ1blRlc3RzAgQAwuvywAfGgAGfDUBjb25zdCB0ZXN0Q2FzZXMgPSBnZXRCb3RzKA0KICAgIGJ5VGFnKCdfX3Rlc3QnLCB0cnVlKSwNCiAgICBieVRhZygnX190ZXN0Q2FzZScsIHRydWUpDQopOw0KDQpsZXQgdG90YWxDb3VudCA9IHRlc3RDYXNlcy5sZW5ndGg7DQpsZXQgY29tcGxldGVkQ291bnQgPSAwOw0KbGV0IHN1Y2Nlc3NDb3VudCA9IDA7DQpsZXQgZmFpbHVyZUNvdW50ID0gMDsNCmxldCBwcm9taXNlcyA9IFtdOw0KZm9yKGxldCB0ZXN0Q2FzZSBvZiB0ZXN0Q2FzZXMpIHsNCiAgICBpZiAodGVzdENhc2UudGFncy5za2lwKSB7DQogICAgICAgIGNvbnRpbnVlOw0KICAgIH0NCg0KICAgIGNvbnN0IHByb21pc2UgPSB0aGlzQm90LnJ1blRlc3RDYXNlKGdldElEKHRlc3RDYXNlKSkudGhlbigocmVzdWx0KSA9PiB7DQogICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykgew0KICAgICAgICAgICAgc3VjY2Vzc0NvdW50ICs9IDE7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBmYWlsdXJlQ291bnQgKz0gMTsNCiAgICAgICAgfQ0KICAgICAgICBjb21wbGV0ZWRDb3VudCArPSAxOw0KICAgICAgICBpZiAodGhpc0JvdC5saW5rcy5ydW5UZXN0c0J1dHRvbikgew0KICAgICAgICAgICAgdGhpc0JvdC5saW5rcy5ydW5UZXN0c0J1dHRvbi5tYXNrcy5sYWJlbCA9IGAke2NvbXBsZXRlZENvdW50fS8ke3RvdGFsQ291bnR9YDsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfSk7DQogICAgcHJvbWlzZXMucHVzaChwcm9taXNlKTsNCn0NCg0KY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTsNCg0KbGV0IHN1Y2Nlc3MgPSB0cnVlOw0KbGV0IGZpcnN0VW5zdWNlc3NmdWxSZXN1bHQgPSBudWxsOw0KZm9yKGxldCByZXN1bHQgb2YgcmVzdWx0cykgew0KICAgIGlmIChyZXN1bHQuc3VjY2Vzcykgew0KICAgICAgICBjb250aW51ZTsNCiAgICB9DQogICAgc3VjY2VzcyA9IGZhbHNlOw0KICAgIGZpcnN0VW5zdWNlc3NmdWxSZXN1bHQgPSByZXN1bHQ7DQogICAgYnJlYWs7DQp9DQoNCmlmIChzdWNjZXNzKSB7DQogICAgb3MudG9hc3QoIlN1Y2Nlc3MhIik7DQoNCiAgICBpZiAodGhpc0JvdC5saW5rcy5ydW5UZXN0c0J1dHRvbikgew0KICAgICAgICB0aGlzQm90LmxpbmtzLnJ1blRlc3RzQnV0dG9uLm1hc2tzLmxhYmVsID0gYOKckyAke3N1Y2Nlc3NDb3VudH0vJHt0b3RhbENvdW50fWA7DQogICAgfQ0KDQogICAgcmV0dXJuIHRydWU7DQp9IGVsc2Ugew0KICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbERpZmYgPSAndGVzdFN5c3RlbSc7DQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gZmlyc3RVbnN1Y2Vzc2Z1bFJlc3VsdC5zeXN0ZW07DQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsUGFuZSA9ICdkaWZmJzsNCiAgICBjb25maWdCb3QudGFncy5zeXN0ZW1Qb3J0YWxEaWZmQm90ID0gZmlyc3RVbnN1Y2Vzc2Z1bFJlc3VsdC5kaWZmQm90SWQ7DQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsRGlmZlRhZyA9ICd0aW1lbGluZSc7DQoNCiAgICBpZiAodGhpc0JvdC5saW5rcy5ydW5UZXN0c0J1dHRvbikgew0KICAgICAgICB0aGlzQm90LmxpbmtzLnJ1blRlc3RzQnV0dG9uLm1hc2tzLmxhYmVsID0gYOKdjCAke3N1Y2Nlc3NDb3VudH0vJHt0b3RhbENvdW50fWA7DQogICAgfQ0KDQogICAgcmV0dXJuIGZhbHNlOw0KfScAwuvywAcADWFiUmVjb3JkVHJhY2UCBADC6/LAB+KNAb8KQGNvbnN0IGQgPSBhd2FpdCBvcy5jcmVhdGVEZWJ1Z2dlcih7DQogICAgcGF1c2FibGU6IHRydWUsDQogICAgYWxsb3dBc3luY2hyb25vdXNTY3JpcHRzOiB0cnVlDQp9KTsNCg0KaWYgKCFib3QudmFycy50cmFjZUNvdW50ZXIpIHsNCiAgICBib3QudmFycy50cmFjZUNvdW50ZXIgPSAwOw0KfQ0KYm90LnZhcnMudHJhY2VDb3VudGVyICs9IDE7DQpib3QudmFycy5kZWJ1ZyA9IGQ7DQpib3QudmFycy50cmFjaW5nID0gdHJ1ZTsNCmJvdC52YXJzLnRpbWVsaW5lID0gW107DQphd2FpdCBib3QuaG9va3VwRGVidWdnZXIoeyBkZWJ1ZzogZCwgYWRkS2V5czogZmFsc2UsIHRpbWVsaW5lOiBib3QudmFycy50aW1lbGluZSwgbm9XYXJuTWlzc2luZ0tleXM6IHRydWUgfSk7DQphd2FpdCBib3QuYWRkQm90c1RvRGVidWdnZXIoZCk7DQoNCmF3YWl0IG9zLmF0dGFjaERlYnVnZ2VyKGQsIHsNCiAgICB0YWdOYW1lTWFwcGVyOiB7DQogICAgICAgIGZvcndhcmQ6IGZvcndhcmRNYXBUYWdOYW1lLA0KICAgICAgICByZXZlcnNlOiByZXZlcnNlTWFwVGFnTmFtZQ0KICAgIH0sDQp9KTsNCg0KYXdhaXQgb3Muc2xlZXAoMTAwMCk7DQoNCmlmIChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsKSB7DQogICAgYm90LnZhcnMub3JpZ2luYWxHcmlkUG9ydGFsID0gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsNCiAgICBkLmNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gJ3Rlc3QtJyArIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7DQp9DQoNCnNob3V0KCJhYlNsZWVwIiwgInNsZWVwIik7DQpzaG91dCgnYWJSZXNldCcpOw0KDQpmdW5jdGlvbiBmb3J3YXJkTWFwVGFnTmFtZShuYW1lKSB7DQogICAgY29uc3QgYnVpbHRpblRhZ3MgPSBvcy5saXN0QnVpbHRpblRhZ3MoKTsNCiAgICBpZiAoYnVpbHRpblRhZ3Muc29tZSh0ID0+IHQgPT09IG5hbWUpKSB7DQogICAgICAgIHJldHVybiBuYW1lOw0KICAgIH0NCg0KICAgIHJldHVybiAndGVzdC0nICsgbmFtZTsNCn0NCg0KZnVuY3Rpb24gcmV2ZXJzZU1hcFRhZ05hbWUobmFtZSkgew0KICAgIGNvbnN0IGJ1aWx0aW5UYWdzID0gb3MubGlzdEJ1aWx0aW5UYWdzKCk7DQogICAgaWYgKGJ1aWx0aW5UYWdzLnNvbWUodCA9PiB0ID09PSBuYW1lKSkgew0KICAgICAgICByZXR1cm4gbmFtZTsNCiAgICB9DQoNCiAgICBsZXQgd2l0aG91dFRlc3QgPSBuYW1lLnN1YnN0cmluZygndGVzdC0nLmxlbmd0aCk7DQogICAgcmV0dXJuIHdpdGhvdXRUZXN0Ow0KfQ0KDQphd2FpdCBvcy5yZWdpc3RlckFwcCgnYWJUZXN0aW5nQXBwJywgdGhpc0JvdCk7DQp0aGlzQm90LnJlbmRlclRlc3RpbmdBcHAoKTsnAMLr8sAHAA1hYlN0b3BUcmFjaW5nAgQAwuvywAeimAHGCEBpZiAoYm90LnZhcnMuZGVidWcpIHsNCiAgICBhd2FpdCBvcy5kZXRhY2hEZWJ1Z2dlcihib3QudmFycy5kZWJ1Zyk7DQp9DQoNCmJvdC52YXJzLmRlYnVnID0gbnVsbDsNCmJvdC52YXJzLnRyYWNpbmcgPSBudWxsOw0KDQppZiAoYm90LnZhcnMub3JpZ2luYWxHcmlkUG9ydGFsKSB7DQogICAgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9IGJvdC52YXJzLm9yaWdpbmFsR3JpZFBvcnRhbDsNCiAgICBib3QudmFycy5vcmlnaW5hbEdyaWRQb3J0YWwgPSBudWxsOw0KfQ0KDQpjb25zb2xlLmxvZygnW2RlYnVnXSBEb25lIScpOw0KbGV0IGZpbmFsVGltZWxpbmUgPSBib3QuY29tcGlsZVRpbWVsaW5lKHsgdGltZWxpbmU6IGJvdC52YXJzLnRpbWVsaW5lIH0pOw0KDQpjb25zdCB0cmFjZU5hbWUgPSAndHJhY2VzLicgKyBwYWQoYm90LnZhcnMudHJhY2VDb3VudGVyLnRvU3RyaW5nKCkpOw0KY29uc3QgcmVuZGVyZWQgPSB0aGlzQm90LnJlbmRlclRpbWVsaW5lKHsgdGltZWxpbmU6IGZpbmFsVGltZWxpbmUsIG5hbWU6IHRyYWNlTmFtZSB9KTsNCmNvbnN0IHsgcmVzdWx0Qm90IH0gPSB0aGlzQm90LmNyZWF0ZUJvdHNGb3JSZW5kZXJlZFRpbWVsaW5lKHsgcmVzdWx0OiByZW5kZXJlZCwgc3lzdGVtOiB0cmFjZU5hbWUgfSk7DQoNCnNob3V0KCJhYlNsZWVwIiwgIndha2UiKTsNCnRoaXNCb3QucmVuZGVyVGVzdGluZ0FwcCgpOw0KDQpvcy5mb2N1c09uKHJlc3VsdEJvdCwgew0KICAgIHRhZzogJ3RpbWVsaW5lJywNCiAgICBwb3J0YWw6ICdzeXN0ZW0nLA0KICAgIGxpbmVOdW1iZXI6IDAsDQogICAgY29sdW1uTnVtYmVyOiAwDQp9KS5jYXRjaChlID0+IHt9KQ0KDQpmdW5jdGlvbiBwYWQoc3RyKSB7DQoNCiAgICBsZXQgcmVtYWluaW5nID0gNiAtIHN0ci5sZW5ndGg7DQogICAgaWYgKHJlbWFpbmluZyA+IDApIHsNCiAgICAgICAgbGV0IHBhZGRlZCA9ICcwJy5yZXBlYXQocmVtYWluaW5nKTsNCiAgICAgICAgcmV0dXJuIHBhZGRlZCArIHN0cjsNCiAgICB9DQoNCiAgICAvLyB3aGlsZShzdHIubGVuZ3RoIDwgNikgew0KICAgIC8vICAgICBzdHIgKz0gJzAnICsgc3RyOw0KICAgIC8vIH0NCg0KICAgIHJldHVybiBzdHI7DQp9JwDC6/LABwAOcmVuZGVyVGltZWxpbmUCBADC6/LAB+mgAZYlQGNsYXNzIFN0cmluZ0J1aWxkZXIgew0KICAgIGNvbnN0cnVjdG9yKHN0cikgew0KICAgICAgICB0aGlzLmluZGVudCA9IDA7DQogICAgICAgIHRoaXMubWFya2VycyA9IFtdOw0KICAgICAgICB0aGlzLnN0ciA9IHN0cjsNCiAgICAgICAgdGhpcy5sb2MgPSBsb2Moc3RyKTsNCiAgICB9DQoNCiAgICBhcHBlbmRMaW5lKHMpIHsNCiAgICAgICAgaWYgKHRoaXMuaW5kZW50ID4gMCkgew0KICAgICAgICAgICAgdGhpcy5zdHIgKz0gaW5kZW50KHMsIHRoaXMuaW5kZW50KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuc3RyICs9IHM7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5zdHIgKz0gJ1xuJzsNCiAgICAgICAgdGhpcy5sb2MgPSBsb2ModGhpcy5zdHIpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICBhcHBlbmQocykgew0KICAgICAgICB0aGlzLnN0ciArPSBzOw0KICAgICAgICB0aGlzLmxvYyA9IGxvYyh0aGlzLnN0cik7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gbG9jKHN0cikgew0KICAgIGNvbnN0IGxpbmVzID0gc3RyLnNwbGl0KCdcbicpOw0KICAgIGNvbnN0IGxpbmUgPSBsaW5lcy5sZW5ndGg7DQogICAgY29uc3QgY29sID0gbGluZXNbbGluZXMubGVuZ3RoIC0gMV0ubGVuZ3RoOw0KICAgIHJldHVybiB7DQogICAgICAgIGxpbmUsDQogICAgICAgIGNvbA0KICAgIH07DQp9DQoNCmZ1bmN0aW9uIHJlbmRlclRpbWVsaW5lKHRpbWVsaW5lLCBuYW1lKSB7DQogICAgbGV0IGJ1aWxkZXIgPSBuZXcgU3RyaW5nQnVpbGRlcignQCcpOw0KICAgIGJ1aWxkZXIuYXBwZW5kTGluZSgnLy8gTm90ZTogdGhpcyBpcyBhIHZpc3VhbGl6YXRpb24gb2YgdGhlIHRlc3QgdGltZWxpbmUuJyk7DQogICAgYnVpbGRlci5hcHBlbmRMaW5lKCcvLyBJdCBkb2VzIG5vdCBjb250YWluIHdvcmtpbmcgY29kZS5cbicpOw0KICAgIGJ1aWxkZXIuYXBwZW5kTGluZShgc3RhcnQoJyR7bmFtZX0nKWApOw0KICAgIGZvcihsZXQgZXZlbnQgb2YgdGltZWxpbmUpIHsNCiAgICAgICAgcmVuZGVyRXZlbnQoZXZlbnQsIGJ1aWxkZXIpOw0KICAgIH0NCg0KICAgIGNvbnNvbGUubG9nKGJ1aWxkZXIuc3RyKTsNCiAgICBidWlsZGVyLmFwcGVuZExpbmUoJ2VuZCgpJyk7DQogICAgcmV0dXJuIHsNCiAgICAgICAgc3RyaW5nOiBidWlsZGVyLnN0ciwNCiAgICAgICAgbWFya2VyczogYnVpbGRlci5tYXJrZXJzDQogICAgfTsNCn0NCg0KZnVuY3Rpb24gcmVuZGVyRXZlbnQoZXZlbnQsIGJ1aWxkZXIpIHsNCiAgICBjb25zb2xlLmxvZygncmVuZGVyJywgZXZlbnQpOw0KICAgIGlmIChldmVudC50eXBlID09PSAndXNlcl9hY3Rpb24nKSB7DQogICAgICAgIHJlbmRlclVzZXJBY3Rpb24oZXZlbnQsIGJ1aWxkZXIpOw0KICAgIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gJ2VtaXR0ZWRfYWN0aW9uJykgew0KICAgICAgICByZW5kZXJFbWl0dGVkQWN0aW9uKGV2ZW50LCBidWlsZGVyKTsNCiAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICdjaGVjaycpIHsNCiAgICAgICAgYnVpbGRlci5hcHBlbmRMaW5lKGBjaGVjazogJHtnZXRGb3JtYXR0ZWRKU09OKGV2ZW50LmRpZmYpfWApOw0KICAgIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gJ3VwZGF0ZV90YWcnKSB7DQogICAgICAgIHJlbmRlclVwZGF0ZVRhZyhldmVudCwgYnVpbGRlcik7DQogICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAndXBkYXRlX3RhZ19tYXNrJykgew0KICAgICAgICByZW5kZXJVcGRhdGVUYWdNYXNrKGV2ZW50LCBidWlsZGVyKTsNCiAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICdzY3JpcHQnKSB7DQogICAgICAgIHJlbmRlclNjcmlwdChldmVudCwgYnVpbGRlcik7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiByZW5kZXJTaG91dChldmVudCwgYnVpbGRlcikgew0KICAgIGJ1aWxkZXIuYXBwZW5kTGluZShgLy8gQCR7ZXZlbnQuYWN0aW9uLmV2ZW50TmFtZX1gKTsNCiAgICBpZiAoZXZlbnQuYWN0aW9uLmtleXMubGVuZ3RoID4gMCkgew0KICAgICAgICBidWlsZGVyLmFwcGVuZExpbmUoYHdoaXNwZXIuJHtldmVudC5hY3Rpb24uZXZlbnROYW1lfSgnJHtldmVudC5hY3Rpb24ua2V5cy5qb2luKCcsJyl9JylgKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBidWlsZGVyLmFwcGVuZExpbmUoYHNob3V0LiR7ZXZlbnQuYWN0aW9uLmV2ZW50TmFtZX0oKWApOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gcmVuZGVyRW1pdHRlZEFjdGlvbihldmVudCwgYnVpbGRlcikgew0KICAgIGxldCBwcmVmaXggPSAnJzsNCiAgICBpZiAoJ3Rhc2tJZCcgaW4gZXZlbnQuYWN0aW9uKSB7DQogICAgICAgIHByZWZpeCA9IGBcJCR7ZXZlbnQuYWN0aW9uLnRhc2tJZH06IGA7DQogICAgfQ0KICAgIGxldCB7IHRhc2tJZCwgdHlwZSwgLi4ucmVzdCB9ID0gZXZlbnQuYWN0aW9uOw0KDQogICAgaWYgKGV2ZW50LmxvY2F0aW9uKSB7DQogICAgICAgIGJ1aWxkZXIubWFya2Vycy5wdXNoKHsNCiAgICAgICAgICAgIGxpbmU6IGJ1aWxkZXIubG9jLmxpbmUsDQogICAgICAgICAgICBsYWJlbDogJ0dvIHRvIGFjdGlvbicsDQogICAgICAgICAgICBsb2NhdGlvbjogZXZlbnQubG9jYXRpb24NCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgYnVpbGRlci5hcHBlbmRMaW5lKGAke3ByZWZpeH0ke3R5cGV9KCR7Z2V0Rm9ybWF0dGVkSlNPTihyZXN0KX0pYCk7DQp9DQoNCmZ1bmN0aW9uIHJlbmRlclVwZGF0ZVRhZyhldmVudCwgYnVpbGRlcikgew0KICAgIGlmIChldmVudC5sb2NhdGlvbikgew0KICAgICAgICBidWlsZGVyLm1hcmtlcnMucHVzaCh7DQogICAgICAgICAgICBsaW5lOiBidWlsZGVyLmxvYy5saW5lLA0KICAgICAgICAgICAgbGFiZWw6ICdHbyB0byBUYWcgVXBkYXRlJywNCiAgICAgICAgICAgIGxvY2F0aW9uOiBldmVudC5sb2NhdGlvbg0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICBidWlsZGVyLmFwcGVuZExpbmUoYHVwZGF0ZVRhZygke2V2ZW50LnVwZGF0ZS50YWd9LCAke2dldEZvcm1hdHRlZEpTT04oZXZlbnQudXBkYXRlLm5ld1ZhbHVlKX0pYCk7DQp9DQoNCmZ1bmN0aW9uIHJlbmRlclVwZGF0ZVRhZ01hc2soZXZlbnQsIGJ1aWxkZXIpIHsNCiAgICBpZiAoZXZlbnQubG9jYXRpb24pIHsNCiAgICAgICAgYnVpbGRlci5tYXJrZXJzLnB1c2goew0KICAgICAgICAgICAgbGluZTogYnVpbGRlci5sb2MubGluZSwNCiAgICAgICAgICAgIGxhYmVsOiAnR28gdG8gVGFnIE1hc2sgVXBkYXRlJywNCiAgICAgICAgICAgIGxvY2F0aW9uOiBldmVudC5sb2NhdGlvbg0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICBidWlsZGVyLmFwcGVuZExpbmUoYHVwZGF0ZVRhZ01hc2soJHtldmVudC51cGRhdGUudGFnfSwgJHtldmVudC51cGRhdGUuc3BhY2V9LCAke2dldEZvcm1hdHRlZEpTT04oZXZlbnQudXBkYXRlLm5ld1ZhbHVlKX0pYCk7DQp9DQoNCmZ1bmN0aW9uIHJlbmRlclNjcmlwdChldmVudCwgYnVpbGRlcikgew0KICAgIGlmIChldmVudC5sb2NhdGlvbikgew0KICAgICAgICBidWlsZGVyLm1hcmtlcnMucHVzaCh7DQogICAgICAgICAgICBsaW5lOiBidWlsZGVyLmxvYy5saW5lLA0KICAgICAgICAgICAgbGFiZWw6ICdHbyB0byBTY3JpcHQnLA0KICAgICAgICAgICAgbG9jYXRpb246IGV2ZW50LmxvY2F0aW9uDQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIGJ1aWxkZXIuYXBwZW5kTGluZShgcnVuX3NjcmlwdCgnJHtldmVudC5ib3RJZH0nLCAnJHtldmVudC50YWd9JywgKCkgPT4ge2ApOw0KICAgIGJ1aWxkZXIuaW5kZW50ICs9IDQ7DQogICAgZm9yIChsZXQgZSBvZiBldmVudC50aW1lbGluZSkgew0KICAgICAgICByZW5kZXJFdmVudChlLCBidWlsZGVyKTsNCiAgICB9DQogICAgYnVpbGRlci5pbmRlbnQgLT0gNDsNCiAgICBidWlsZGVyLmFwcGVuZExpbmUoJ1xufSknKTsNCn0NCg0KZnVuY3Rpb24gcmVuZGVyVXNlckFjdGlvbihldmVudCwgYnVpbGRlcikgew0KICAgIGlmICgndGltZWxpbmUnIGluIGV2ZW50KSB7DQogICAgICAgIGZvciAobGV0IGUgb2YgZXZlbnQudGltZWxpbmUpIHsNCiAgICAgICAgICAgIHJlbmRlckV2ZW50KGUsIGJ1aWxkZXIpOw0KICAgICAgICB9DQogICAgfSBlbHNlIGlmIChldmVudC5hY3Rpb24udHlwZSA9PT0gJ2FjdGlvbicpIHsNCiAgICAgICAgcmVuZGVyU2hvdXQoZXZlbnQsIGJ1aWxkZXIpOw0KICAgIH0gZWxzZSBpZiAoZXZlbnQuYWN0aW9uLnR5cGUgPT09ICdhc3luY19yZXN1bHQnKSB7DQogICAgICAgIGxldCBmb3JtYXR0ZWQgPSBnZXRGb3JtYXR0ZWRKU09OKGV2ZW50LmFjdGlvbi5yZXN1bHQpOw0KICAgICAgICBsZXQgY29tbWVudGVkID0gZm9ybWF0dGVkLnNwbGl0KCdcbicpLm1hcChsaW5lID0+IGAvLyAke2xpbmV9YCkuam9pbignXG4nKTsNCg0KICAgICAgICBidWlsZGVyLmFwcGVuZExpbmUoYCR7Y29tbWVudGVkfSAtPiBcJCR7ZXZlbnQuYWN0aW9uLnRhc2tJZH1gKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGluZGVudChzdHIsIGxldmVsKSB7DQogICAgbGV0IGxpbmVzID0gc3RyLnNwbGl0KCdcbicpOw0KICAgIGxldCBpbmRlbnRTdHJpbmcgPSAnICcucmVwZWF0KGxldmVsKTsNCiAgICBsZXQgaW5kZW50ZWQgPSBsaW5lcy5tYXAobCA9PiBsLmxlbmd0aCA+IDAgPyBpbmRlbnRTdHJpbmcgKyBsIDogbCk7DQogICAgcmV0dXJuIGluZGVudGVkLmpvaW4oJ1xuJyk7DQp9DQoNCmNvbnN0IHsgdGltZWxpbmUsIG5hbWUgfSA9IHRoYXQ7DQoNCnJldHVybiByZW5kZXJUaW1lbGluZSh0aW1lbGluZSwgbmFtZSk7JwDC6/LABwAdY3JlYXRlQm90c0ZvclJlbmRlcmVkVGltZWxpbmUCBADC6/LAB4DGAaAHQGNvbnN0IHsgc3lzdGVtLCByZXN1bHQsIGNyZWF0b3IsIHN5c3RlbVRhZyB9ID0gdGhhdDsNCg0KLy8gY29uc3Qgc3lzdGVtID0gc3lzdGVtUHJlZml4ICsgdGVzdENhc2UudGFncy50ZXN0TmFtZTsNCg0KbGV0IHJlc3VsdEJvdCA9IGNyZWF0ZSh7DQogICAgc3BhY2U6ICd0ZW1wTG9jYWwnLA0KICAgIGNyZWF0b3I6IGNyZWF0b3I/LmlkLA0KICAgIF9fdGVzdDogdHJ1ZSwNCiAgICBfX3Rlc3RSZXN1bHQ6IHRydWUsDQogICAgdGltZWxpbmU6IHJlc3VsdC5zdHJpbmcsDQogICAgW3N5c3RlbVRhZyA/PyAnc3lzdGVtJ106IHN5c3RlbQ0KfSk7DQoNCmNvbnN0IG1hcmtlck1vZCA9IHsNCiAgICBzcGFjZTogJ3RlbXBMb2NhbCcsDQogICAgY3JlYXRvcjogcmVzdWx0Qm90LmlkLA0KICAgIF9fdGVzdDogdHJ1ZSwNCiAgICBfX3Rlc3RSZXN1bHQ6IHRydWUsDQogICAgZm9ybTogJ2NvZGVCdXR0b24nLA0KICAgIG9uQ2xpY2s6IGBAb3MuZm9jdXNPbihib3QudGFncy5sb2NhdGlvbi5ib3RJZCwgeyBwb3J0YWw6ICdzeXN0ZW0nLCB0YWc6IGJvdC50YWdzLmxvY2F0aW9uLnRhZywgbGluZU51bWJlcjogYm90LnRhZ3MubG9jYXRpb24ubGluZSwgY29sdW1uTnVtYmVyOiBib3QudGFncy5sb2NhdGlvbi5jb2x1bW4gfSkuY2F0Y2goZSA9PiB7fSlgDQp9Ow0KDQpmb3IgKGxldCBtYXJrZXIgb2YgcmVzdWx0Lm1hcmtlcnMpIHsNCiAgICBjcmVhdGUobWFya2VyTW9kLCB7DQogICAgICAgIFtgJHtyZXN1bHRCb3QuaWR9LnRpbWVsaW5lYF06IHRydWUsDQogICAgICAgIFtgJHtyZXN1bHRCb3QuaWR9LnRpbWVsaW5lU3RhcnRgXTogbWFya2VyLmxpbmUsDQogICAgICAgIGxhYmVsOiBtYXJrZXIubGFiZWwsDQogICAgICAgIGxvY2F0aW9uOiBtYXJrZXIubG9jYXRpb24sDQogICAgfSk7DQp9DQoNCnJldHVybiB7DQogICAgcmVzdWx0Qm90DQp9OycAwuvywAcAB2FiVGVzdHMCBADC6/LAB6HNAQR0cnVlJwDC6/LABwAEZm9ybQIEAMLr8sAHps0BB25vdGhpbmcnAMLr8sAHAAhhYklnbm9yZQIEAMLr8sAHrs0BBHRydWUnAMLr8sAHAAlhYlZlcnNpb24CBADC6/LAB7PNAQQxMC42AA=="}]}