{"version":2,"updates":[{"id":0,"timestamp":1772043145588,"update":"AYcB6Lu3sgMAJwEEYm90cyQwN2NmZTg5NS0zYWVlLTQwYjYtODFlYS01M2ZkNTBiMzFjZDkBJwDou7eyAwAGc3lzdGVtAgQA6Lu3sgMBCmFiLmFpLm11dGUnAOi7t7IDABBhYkNvcmVNZW51QWN0aW9uAgQA6Lu3sgMMmgRAc2V0VGFnTWFzayh0aGlzQm90LCAibXV0ZWQiLCAhdGFncy5tdXRlZCk7DQoNCmNvbnN0IG1lbnVCb3QgPSBnZXRCb3QoYnlUYWcoImJhc2VTa2lsbCIsICfwn5SXJyArIGdldElEKHRoaXNCb3QpKSwgYnlUYWcoImFiTWVudSIsIHRydWUpKTsNCmlmIChtZW51Qm90KSB7DQogICAgaWYgKHRhZ3MubXV0ZWQpIHsNCiAgICAgICAgbWVudUJvdC50YWdzLmxhYmVsID0gInVubXV0ZSI7DQogICAgICAgIG1lbnVCb3QudGFncy5mb3JtQWRkcmVzcyA9ICdtaWNfb2ZmJzsNCiAgICB9IGVsc2Ugew0KICAgICAgICBtZW51Qm90LnRhZ3MubGFiZWwgPSAibXV0ZSI7DQogICAgICAgIG1lbnVCb3QudGFncy5mb3JtQWRkcmVzcyA9ICdtaWMnOw0KICAgICAgICANCiAgICAgICAgY29uc3Qgdm9pY2VCb3QgPSBnZXRCb3QoInN5c3RlbSIsICJhYi5haS52b2ljZSIpOw0KICAgICAgICBpZiAodm9pY2VCb3QgJiYgIXZvaWNlQm90LnZhcnMuaHVtZVNvY2tldCkgew0KICAgICAgICAgICAgdm9pY2VCb3Quc3RhcnRIdW1lKCk7DQogICAgICAgIH0NCiAgICB9DQp9JwDou7eyAwAOYWJBcnRpZmFjdE5hbWUCBADou7eyA6UEB2FiVm9pY2UoAOi7t7IDAAVtdXRlZAF4JwDou7eyAwAOYWJDb3JlTWVudUljb24CBADou7eyA64EB21pY19vZmYnAOi7t7IDAA9hYkNvcmVNZW51TGFiZWwCBADou7eyA7YEBnVubXV0ZScA6Lu3sgMABWxhYmVsAgQA6Lu3sgO9BARtdXRlJwDou7eyAwALZm9ybUFkZHJlc3MCBADou7eyA8IEA21pYycA6Lu3sgMAE2FiQ29yZU1lbnVTb3J0T3JkZXICBADou7eyA8YEBDEwMDAnAOi7t7IDABhhYkNvcmVNZW51T25CZWZvcmVDcmVhdGUCBADou7eyA8sEsQFAaWYgKHRhZ3MubXV0ZWQpIHsNCiAgICB0YWdzLmFiQ29yZU1lbnVMYWJlbCA9ICJ1bm11dGUiOw0KICAgIHRhZ3MuYWJDb3JlTWVudUljb24gPSAnbWljX29mZic7DQp9IGVsc2Ugew0KICAgIHRhZ3MuYWJDb3JlTWVudUxhYmVsID0gIm11dGUiOw0KICAgIHRhZ3MuYWJDb3JlTWVudUljb24gPSAnbWljJzsNCn0nAOi7t7IDAAphYklET3JpZ2luAgQA6Lu3sgP9BQdhYlZvaWNlJwDou7eyAwAHYWJWb2ljZQIEAOi7t7IDhQYEdHJ1ZScA6Lu3sgMACWFiVmVyc2lvbgIEAOi7t7IDigYFMTAuNDMnAQRib3RzJDI1N2JlMzM3LWYwYTEtNDE5Mi1iZTk3LTM3NzNmYWUyODJjYgEnAOi7t7IDkAYHY3JlYXRvcgIEAOi7t7IDkQYkMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwDou7eyA5AGBnN5c3RlbQIEAOi7t7IDtgYPYWIuYWkuYXV0b1NwZWFrJwDou7eyA5AGDmFiQ29yZU1lbnVJY29uAgQA6Lu3sgPGBgdtaWNfb2ZmJwDou7eyA5AGEGFiQ29yZU1lbnVBY3Rpb24CBADou7eyA84GzgNAc2V0VGFnTWFzayh0aGlzQm90LCAiYXV0b1NwZWFrIiwgIXRhZ3MuYXV0b1NwZWFrKTsNCg0KY29uc3QgbWVudUJvdCA9IGdldEJvdChieVRhZygiYmFzZVNraWxsIiwgJ/CflJcnICsgZ2V0SUQodGhpc0JvdCkpLCBieVRhZygiYWJNZW51IiwgdHJ1ZSkpOw0KaWYgKG1lbnVCb3QpIHsNCiAgICBpZiAoIXRhZ3MuYXV0b1NwZWFrKSB7DQogICAgICAgIG1lbnVCb3QudGFncy5sYWJlbCA9ICJ1bm11dGUgIiArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsNCiAgICAgICAgbWVudUJvdC50YWdzLmZvcm1BZGRyZXNzID0gJ21pY19vZmYnOw0KICAgIH0gZWxzZSB7DQogICAgICAgIG1lbnVCb3QudGFncy5sYWJlbCA9ICJtdXRlICIgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7DQogICAgICAgIG1lbnVCb3QudGFncy5mb3JtQWRkcmVzcyA9ICdtaWMnOw0KICAgIH0NCn0nAOi7t7IDkAYYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQA6Lu3sgObCoYCQGlmICghdGFncy5hdXRvU3BlYWspIHsNCiAgICB0YWdzLmFiQ29yZU1lbnVMYWJlbCA9ICJ1bm11dGUgIiArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsNCiAgICB0YWdzLmFiQ29yZU1lbnVJY29uID0gJ21pY19vZmYnOw0KfSBlbHNlIHsNCiAgICB0YWdzLmFiQ29yZU1lbnVMYWJlbCA9ICJtdXRlICIgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7DQogICAgdGFncy5hYkNvcmVNZW51SWNvbiA9ICdtaWMnOw0KfScA6Lu3sgOQBg9hYkNvcmVNZW51TGFiZWwCBADou7eyA6IMEXVubXV0ZSBjYXN1YWwuYm90JwDou7eyA5AGE2FiQ29yZU1lbnVTb3J0T3JkZXICBADou7eyA7QMAzk5OSgA6Lu3sgOQBglhdXRvU3BlYWsBeScA6Lu3sgOQBgtvbkFueUNyZWF0ZQIEAOi7t7IDuQxxQGlmICh0aGF0LmJvdC50YWdzLm5hbWUgPT0gImFiVm9pY2VOb3RpZkJvdCIpIHsNCiAgICBpZiAodGFncy5hdXRvU3BlYWspIHsNCiAgICAgICAgdGhhdC5ib3Qub25DbGljaygpOw0KICAgIH0NCn0nAOi7t7IDkAYKYWJJRE9yaWdpbgIEAOi7t7IDqw0HYWJWb2ljZScA6Lu3sgOQBgdhYlZvaWNlAgQA6Lu3sgOzDQR0cnVlJwDou7eyA5AGCWFiVmVyc2lvbgIEAOi7t7IDuA0FMTAuNDMnAQRib3RzJDk5ZWE1ODZkLTQyMmItNDYyYy1iMGRmLWFlMWNiNDA4MjE1MQEnAOi7t7IDvg0Gc3lzdGVtAgQA6Lu3sgO/DQthYi5haS52b2ljZScA6Lu3sgO+DRRhYkNvcmVNZW51T25HZW5lcmF0ZQIEAOi7t7IDyw31A0B0YWdzLm9uU3VibWl0ID0gYEANCiAgICBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiY29yZSJ9KTsNCiAgICBtYXNrcy5tZW51SXRlbVRleHQgPSAiIjsNCmA7DQoNCnRhZ3MuZm9ybSA9ICJpbnB1dCI7DQoNCmlmICghYXV0aEJvdCkNCnsNCiAgICB0YWdzLmxhYmVsID0gInlvdSBtdXN0IGJlIGxvZ2dlZCBpbiB0byBjaGF0IHdpdGggIiArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsNCn0NCmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpDQp7DQogICAgdGFncy5sYWJlbCA9ICJjaGF0IHdpdGggIiArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICIgKGxpbWl0ZWQpIjsNCn0NCmVsc2UNCnsNCiAgICB0YWdzLmxhYmVsID0gImNoYXQgd2l0aCAiICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Ow0KfScA6Lu3sgO+DRBhYkNvcmVNZW51QWN0aW9uAgQA6Lu3sgPBEa0DQGlmICh0aGF0ICYmIHRoYXQubWVzc2FnZSkgew0KICAgIGlmICh0aGF0Lm1lc3NhZ2UgPT0gJy5zdG9wSHVtZScpIHsNCiAgICAgICAgdGhpc0JvdC5lbmRIdW1lKCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBsZXQgdXNlcm5hbWUgPSBhd2FpdCB0aGlzQm90LmdldFVzZXJOYW1lKCk7DQoNCiAgICBpZiAoIXRoaXNCb3QudmFycy5odW1lU29ja2V0KSB7DQogICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImF3YWl0aW5nVGV4dCIsIHt1c2VyOiB1c2VybmFtZSwgbWVzc2FnZTogdGhhdC5tZXNzYWdlfSk7DQogICAgICAgIGF3YWl0IHRoaXNCb3Quc3RhcnRIdW1lKCk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgdGhpc0JvdC50ZXh0UmVzcG9uc2Uoe3VzZXI6IHVzZXJuYW1lLCBtZXNzYWdlOiB0aGF0Lm1lc3NhZ2V9KTsNCiAgICB9DQp9JwDou7eyA74NCXN0YXJ0SHVtZQIEAOi7t7ID7xTdJ0Bjb25zdCBlbmRwb2ludCA9ICJ3c3M6Ly9hcGkuaHVtZS5haS92MC9ldmkvY2hhdCI7DQpjb25zdCBhY2Nlc3NUb2tlbiA9IChhd2FpdCBhaS5odW1lLmdldEFjY2Vzc1Rva2VuKCkpLmFjY2Vzc1Rva2VuOw0KLy9jb25zdCBjb25maWdJRCA9ICJlMDRiMDJkNS1jYjc4LTQyOTItYWJhNC1hOTEyZDg5MjZkZGQiOw0KY29uc3QgY29uZmlnSUQgPSAiZmYxMTMzZmItMmEyNy00YTljLTg4MDEtMjU4ZWNmN2ViMmFhIjsNCg0KY29uc3QgdXJsID0gbmV3IFVSTChlbmRwb2ludCk7DQp1cmwuc2VhcmNoUGFyYW1zLnNldCgiYWNjZXNzX3Rva2VuIiwgYWNjZXNzVG9rZW4pOw0KdXJsLnNlYXJjaFBhcmFtcy5zZXQoImNvbmZpZ19pZCIsIGNvbmZpZ0lEKTsNCg0KY29uc3QgaHVtZVNvY2tldCA9IG5ldyBXZWJTb2NrZXQodXJsLnRvU3RyaW5nKCkpOw0KdGhpc0JvdC52YXJzLmh1bWVTb2NrZXQgPSBodW1lU29ja2V0Ow0KdGhpc0JvdC52YXJzLnBsYXlpbmdRdWV1ZSA9IGZhbHNlOw0KDQpjb25zdCBzZXNzaW9uX3NldHRpbmdzID0gew0KICAgICJ0eXBlIjogInNlc3Npb25fc2V0dGluZ3MiLA0KICAgICJ2YXJpYWJsZXMiOiB7DQogICAgICAgICJuYW1lIjogYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LA0KICAgICAgICAiY2F0YWxvZ19hc2tzIjogYXdhaXQgdGhpc0JvdC5nZXRDYXRhbG9nQXNrcygpDQogICAgfQ0KfTsNCg0KaHVtZVNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdvcGVuJywgKGV2ZW50KSA9PiB7DQogICAgY29uc29sZS53YXJuKCJIdW1lIFNvY2tldCBvcGVuZWQ6ICIsIGV2ZW50KTsNCg0KICAgIHRoaXNCb3QuY2xlYXJRdWV1ZXMoKTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJoYW5kUmFpc2VkIiwgZmFsc2UpOw0KDQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAibGF0ZXN0SW5xdWlyeSIsIG51bGwpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImxhdGVzdElucXVpcnlJRCIsIG51bGwpOw0KDQogICAgdGhpc0JvdC52YXJzLnBsYXlIdW1lQXVkaW8gPSB0cnVlOw0KDQogICAgLy9JZiBjb25zb2xlIGlzIG5vdCBvcGVuLCBvcGVuIGNvbnNvbGUNCiAgICBpZiAoIWxpbmtzLmNvbnNvbGUubWFza3Mub3Blbikgew0KICAgICAgICB3aGlzcGVyKGxpbmtzLmNvbnNvbGUsICJzaG93Q29uc29sZSIpOw0KICAgICAgICBsaW5rcy5jb25zb2xlLm1hc2tzLm9wZW4gPSB0cnVlOw0KICAgIH0NCg0KICAgIGh1bWVTb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeShzZXNzaW9uX3NldHRpbmdzKSk7DQoNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJzZW50SW5pdENodW5rIiwgZmFsc2UpOw0KDQogICAgb3MuYmVnaW5BdWRpb1JlY29yZGluZyh7DQogICAgICAgIHN0cmVhbTogdHJ1ZSwNCiAgICAgICAgbWltZVR5cGU6ICdhdWRpby93YXYnDQogICAgfSk7DQoNCiAgICBvcy50b2FzdCgiSHVtZSBhY3RpdmUuLi4iKTsNCiAgICBzaG91dCgib25IdW1lU29ja2V0T3BlbmVkIik7DQp9KTsNCg0KaHVtZVNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdjbG9zZScsIChldmVudCkgPT4gew0KICAgIGNvbnNvbGUud2FybigiSHVtZSBTb2NrZXQgY2xvc2VkOiAiLCBldmVudCk7DQogICAgdGhpc0JvdC5lbmRIdW1lKCk7DQoNCiAgICBjb25zdCBtdXRlQm90ID0gZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuYWkubXV0ZSIpOw0KICAgIGlmIChtdXRlQm90ICYmICFtdXRlQm90LnRhZ3MubXV0ZWQpIHsNCiAgICAgICAgbXV0ZUJvdC5hYkNvcmVNZW51QWN0aW9uKCk7DQogICAgfQ0KDQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAibGF0ZXN0SW5xdWlyeSIsIG51bGwpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImxhdGVzdElucXVpcnlJRCIsIG51bGwpOw0KDQogICAgb3MudG9hc3QoIkh1bWUgY2xvc2VkLi4uIik7DQogICAgLy8gc2hvdXQoIm9uSHVtZUNoYXRFbmRlZCIsIGV2ZW50KTsNCn0pOw0KDQpodW1lU29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBhc3luYyAoZXZlbnQpID0+IHsNCiAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTsNCg0KICAgIGlmIChkYXRhLnR5cGUgPT0gImF1ZGlvX291dHB1dCIpIHsNCiAgICAgICAgdGhpc0JvdC5xdWV1ZUF1ZGlvKGRhdGEuZGF0YSk7DQogICAgfQ0KICAgIGVsc2UgaWYgKGRhdGEudHlwZSA9PSAiYXNzaXN0YW50X21lc3NhZ2UiKSB7DQogICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2UuY29udGVudDsNCg0KICAgICAgICB0aGlzQm90LnF1ZXVlVGV4dChtZXNzYWdlKTsgDQogICAgICAgIA0KICAgIH0NCiAgICBlbHNlIGlmIChkYXRhLnR5cGUgPT0gImFzc2lzdGFudF9lbmQiKSB7DQogICAgICAgIC8vdGFncy50aGlua2luZyA9IHRydWU7DQogICAgfQ0KICAgIGVsc2UgaWYgKGRhdGEudHlwZSA9PSAiZXJyb3IiKSB7DQogICAgICAgIGNvbnNvbGUud2FybignZXJyb3I6ICcsIGRhdGEubWVzc2FnZSk7DQogICAgfQ0KICAgIGVsc2UgaWYgKGRhdGEudHlwZSA9PSAidXNlcl9tZXNzYWdlIikgew0KICAgICAgICBsZXQgdXNlcm5hbWUgPSBhd2FpdCB0aGlzQm90LmdldFVzZXJOYW1lKCk7DQogICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImhhbmRSYWlzZWQiLCBmYWxzZSk7DQoNCiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGRhdGEubWVzc2FnZS5jb250ZW50Ow0KDQogICAgICAgIGlmIChtZXNzYWdlKSB7DQogICAgICAgICAgICBhYi5sb2coew0KICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsDQogICAgICAgICAgICAgICAgbmFtZTogdXNlcm5hbWUsDQogICAgICAgICAgICAgICAgc3BhY2U6ICJzaGFyZWQiLA0KICAgICAgICAgICAgICAgIG1lc3NhZ2VPcmlnaW46IGNvbmZpZ0JvdC5pZCwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2UgaWYgKGRhdGEudHlwZSA9PSAidG9vbF9jYWxsIikgew0KICAgICAgICBjb25zb2xlLmxvZygiVG9vbCBjYWxsZWQ6ICIsIGRhdGEubmFtZSwgZGF0YSk7DQogICAgICAgIGlmICh0YWdzLmRlYnVnTW9kZSA9PSB0cnVlICYmIGRhdGEubmFtZSAhPSAndGhpbmsnKSB7DQogICAgICAgICAgICBhYi5sb2coew0KICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGRhdGEubmFtZSArICc6ICcgKyBkYXRhLnBhcmFtZXRlcnMsDQogICAgICAgICAgICAgICAgbmFtZTogYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LA0KICAgICAgICAgICAgICAgIHNwYWNlOiAic2hhcmVkIiwNCiAgICAgICAgICAgICAgICBtZXNzYWdlT3JpZ2luOiBjb25maWdCb3QuaWQsDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZGF0YS5uYW1lID09ICJ0aGluayIpIHsNCiAgICAgICAgICAgIGlmIChKU09OLnBhcnNlKGRhdGEucGFyYW1ldGVycykubWVzc2FnZSkgew0KICAgICAgICAgICAgICAgIGFiLmxvZyh7IG1lc3NhZ2U6IEpTT04ucGFyc2UoZGF0YS5wYXJhbWV0ZXJzKS5tZXNzYWdlLCBuYW1lOiBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksIHNwYWNlOiAic2hhcmVkIiwgbWVzc2FnZU9yaWdpbjogY29uZmlnQm90LmlkIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKGRhdGEubmFtZSA9PSAibWFrZVRvRG9Cb3QiKSB7DQogICAgICAgICAgICB0aGlzQm90Lm1ha2VUb0RvQm90KHtpZDogZGF0YS50b29sX2NhbGxfaWQsIGRhdGE6IGRhdGEucGFyYW1ldGVyc30pOw0KICAgICAgICB9IGVsc2UgaWYgKGRhdGEubmFtZSA9PSAiY29tcGxldGVUb0RvcyIpIHsNCiAgICAgICAgICAgIHRoaXNCb3QuY29tcGxldGVUb0Rvcyh7aWQ6IGRhdGEudG9vbF9jYWxsX2lkfSk7DQogICAgICAgIH0gIGVsc2UgaWYgKGRhdGEubmFtZSA9PSAibWFrZSIpIHsNCiAgICAgICAgICAgIHRoaXNCb3QubWFrZVNvbWV0aGluZyh7aWQ6IGRhdGEudG9vbF9jYWxsX2lkLCBkYXRhOiBkYXRhLnBhcmFtZXRlcnN9KTsNCiAgICAgICAgfSAgZWxzZSBpZiAoZGF0YS5uYW1lID09ICJwdWxsRnJvbUNhdGFsb2ciKSB7DQogICAgICAgICAgICB0aGlzQm90LnB1bGxGcm9tQ2F0YWxvZyh7aWQ6IGRhdGEudG9vbF9jYWxsX2lkLCBkYXRhOiBkYXRhLnBhcmFtZXRlcnN9KTsNCiAgICAgICAgfSAgZWxzZSBpZiAoZGF0YS5uYW1lID09ICJnZXRTY2VuZURhdGEiKSB7DQogICAgICAgICAgICB0aGlzQm90LmdldFNjZW5lRGF0YSh7aWQ6IGRhdGEudG9vbF9jYWxsX2lkLCBkYXRhOiBkYXRhLnBhcmFtZXRlcnN9KTsNCiAgICAgICAgfSAgZWxzZSBpZiAoZGF0YS5uYW1lID09ICJzZWVVc2VyRm9jdXMiKSB7DQogICAgICAgICAgICB0aGlzQm90LnNlZVVzZXJGb2N1cyh7aWQ6IGRhdGEudG9vbF9jYWxsX2lkLCBkYXRhOiBkYXRhLnBhcmFtZXRlcnN9KTsNCiAgICAgICAgfSAgZWxzZSBpZiAoZGF0YS5uYW1lID09ICJjbGlja09uIikgew0KICAgICAgICAgICAgdGhpc0JvdC5haUNsaWNrKGRhdGEucGFyYW1ldGVycyk7DQogICAgICAgICAgICB0aGlzQm90LnNlbmRUb29sQ29tcGxldGVNZXNzYWdlKHtpZDogZGF0YS50b29sX2NhbGxfaWR9KTsNCiAgICAgICAgfSAgDQoNCiAgICAgICAgbGV0IGRlbGF5ID0gMjAwMDA7DQogICAgICAgIGlmIChkYXRhLm5hbWUgPT0gImNvbXBsZXRlVG9Eb3MiKSB7DQogICAgICAgICAgICBkZWxheSA9IDEyMDAwMDsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzQm90LnZhcnNbInRvb2xSZXNwb25zZVRpbWVvdXQiICsgZGF0YS50b29sX2NhbGxfaWRdID0gYXdhaXQgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICB0aGlzQm90LnNlbmRUb29sQ29tcGxldGVNZXNzYWdlKHtpZDogZGF0YS50b29sX2NhbGxfaWQsIGNvbnRlbnQ6ICJmYWlsZWQifSk7DQogICAgICAgIH0sIFtkZWxheV0pOw0KICAgIH0NCiAgICBlbHNlIGlmIChkYXRhLnR5cGUgPT0gInVzZXJfaW50ZXJydXB0aW9uIikgew0KICAgICAgICB0aGlzQm90LmNsZWFyUXVldWVzKCk7DQoNCiAgICAgICAgdGhpc0JvdC52YXJzLnBsYXlIdW1lQXVkaW8gPSB0cnVlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc29sZS5sb2coInVuZXhwZWN0ZWQgbWVzc2FnZToiLCBkYXRhLnR5cGUsIGRhdGEpOw0KICAgIH0NCn0pOycA6Lu3sgO+DQdlbmRIdW1lAgQA6Lu3sgPNPMICQGNvbnN0IGh1bWVTb2NrZXQgPSB0aGlzQm90LnZhcnMuaHVtZVNvY2tldDsNCg0KY29uc3Qgbm90aWZCb3RzID0gZ2V0Qm90cygiYWJWb2ljZU5vdGlmaWNhdGlvbkJvdCIsIHRydWUpOw0KZGVzdHJveShub3RpZkJvdHMpOw0KDQppZihodW1lU29ja2V0KSB7DQogICAgaHVtZVNvY2tldC5jbG9zZSgxMDAwLCAnVXNlciBlbmRlZCB0aGUgY2hhdCcpOw0KICAgIGRlbGV0ZSB0aGlzQm90LnZhcnMuaHVtZVNvY2tldDsNCn0NCg0KdHJ5IHsNCiAgICBhd2FpdCBvcy5lbmRBdWRpb1JlY29yZGluZygpOw0KfSBjYXRjaChlKSB7DQogICAgY29uc29sZS53YXJuKGUpOw0KfScA6Lu3sgO+DQlxdWV1ZVRleHQCBADou7eyA5A/fkBjb25zdCB0ZXh0ID0gdGhhdDsNCg0KdGhpc0JvdC5tYXNrcy50ZXh0UXVldWUgPSB0aGlzQm90Lm1hc2tzLnRleHRRdWV1ZSA/IFsuLi50aGlzQm90Lm1hc2tzLnRleHRRdWV1ZV0uY29uY2F0KHRleHQpIDogW3RleHRdOycA6Lu3sgO+DQ9wbGF5UXVldWVkQXVkaW8CBADou7eyA49A2g1AaWYgKHRoaXNCb3QudmFycy5wbGF5aW5nUXVldWUpDQp7DQogICAgcmV0dXJuOw0KfQ0KDQp0aGlzQm90LnZhcnMucGxheWluZ1F1ZXVlID0gdHJ1ZTsNCg0Kd2hpbGUgKHRoaXNCb3QubWFza3MuYXVkaW9RdWV1ZT8ubGVuZ3RoID4gMCkNCnsNCiAgICBjb25zdCBhY3RpdmVBdWRpbyA9IHRoaXNCb3QubWFza3MuYXVkaW9RdWV1ZVswXTsNCiAgICBjb25zdCBhY3RpdmVUZXh0ID0gdGhpc0JvdC5tYXNrcy50ZXh0UXVldWVbMF07DQoNCiAgICB0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUuc3BsaWNlKDAsIDEpOw0KICAgIHRoaXNCb3QubWFza3MudGV4dFF1ZXVlLnNwbGljZSgwLDEpOw0KDQogICAgbGV0IHNvdW5kSWQgPSBvcy5wbGF5U291bmQoYWN0aXZlQXVkaW8pOw0KICAgIHRoaXNCb3QubWFza3MuYWN0aXZlU291bmQgPSBzb3VuZElkOw0KICAgIGlmIChhY3RpdmVUZXh0KSB7DQogICAgICAgIGFiLmxvZyh7IG1lc3NhZ2U6IGFjdGl2ZVRleHQsIG5hbWU6IGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwgc3BhY2U6ICJzaGFyZWQiLCBtZXNzYWdlT3JpZ2luOiBjb25maWdCb3QuaWQgfSk7DQogICAgfQ0KICAgIA0KICAgIGF3YWl0IG9zLnNsZWVwKChnZXREdXJhdGlvbihhY3RpdmVBdWRpbykgKiAxMDAwKSk7DQogICAgDQogICAgdGhpc0JvdC5tYXNrcy5hY3RpdmVTb3VuZCA9IG51bGw7DQp9DQoNCnRoaXNCb3QudmFycy5wbGF5aW5nUXVldWUgPSBudWxsOw0KDQpmdW5jdGlvbiBiYXNlNjRUb0FycmF5QnVmZmVyKGJhc2U2NCkgew0KICAgIGNvbnN0IGJpbmFyeVN0cmluZyA9IHNlbGYuYXRvYihiYXNlNjQuc3BsaXQoJywnKVsxXSk7DQogICAgY29uc3QgYnl0ZXMgPSBVaW50OEFycmF5LmZyb20oYmluYXJ5U3RyaW5nLCBjaGFyID0+IGNoYXIuY2hhckNvZGVBdCgwKSk7DQogICAgcmV0dXJuIGJ5dGVzLmJ1ZmZlcjsNCn0NCg0KZnVuY3Rpb24gZ2V0V2F2RHVyYXRpb24oYXJyYXlCdWZmZXIpIHsNCiAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KGFycmF5QnVmZmVyKTsNCg0KICAgIC8vIENoZWNrIHRoZSAiUklGRiIgaWRlbnRpZmllcg0KICAgIGlmICh2aWV3LmdldFVpbnQzMigwLCBmYWxzZSkgIT09IDB4NTI0OTQ2NDYpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIFdBViBmaWxlIik7DQogICAgfQ0KDQogICAgLy8gQ2hlY2sgdGhlICJXQVZFIiBpZGVudGlmaWVyDQogICAgaWYgKHZpZXcuZ2V0VWludDMyKDgsIGZhbHNlKSAhPT0gMHg1NzQxNTY0NSkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgV0FWIGZpbGUiKTsNCiAgICB9DQoNCiAgICAvLyBHZXQgdGhlIGJ5dGUgcmF0ZSBmcm9tIHRoZSBmbXQgc3ViY2h1bmsNCiAgICBjb25zdCBieXRlUmF0ZSA9IHZpZXcuZ2V0VWludDMyKDI4LCB0cnVlKTsNCg0KICAgIC8vIEdldCB0aGUgdG90YWwgbnVtYmVyIG9mIGJ5dGVzIGluIHRoZSBkYXRhIHN1YmNodW5rDQogICAgY29uc3QgZGF0YUNodW5rU2l6ZSA9IHZpZXcuZ2V0VWludDMyKDQwLCB0cnVlKTsNCg0KICAgIC8vIENhbGN1bGF0ZSBkdXJhdGlvbg0KICAgIGNvbnN0IGR1cmF0aW9uID0gZGF0YUNodW5rU2l6ZSAvIGJ5dGVSYXRlOw0KDQogICAgcmV0dXJuIGR1cmF0aW9uOw0KfQ0KDQpmdW5jdGlvbiBnZXREdXJhdGlvbihiYXNlNjQpIHsNCiAgICB2YXIgYXJyQnVmZmVyID0gYmFzZTY0VG9BcnJheUJ1ZmZlcihiYXNlNjQpOw0KICAgIHJldHVybiBnZXRXYXZEdXJhdGlvbihhcnJCdWZmZXIpOw0KfScA6Lu3sgO+DQx0ZXh0UmVzcG9uc2UCBADou7eyA+pNkwJALy8gbGV0IHJlc3BvbnNlID0gYXdhaXQgYWkuY2hhdChyZXNwb25zZVByb21wdCwgew0KLy8gICAgIHByZWZlcnJlZE1vZGVsOiB0YWdzLmFpTW9kZWwNCi8vIH0pOw0KDQpjb25zdCBodW1lU29ja2V0ID0gdGhpc0JvdC52YXJzLmh1bWVTb2NrZXQ7DQoNCmlmKGh1bWVTb2NrZXQpIHsNCiAgICBodW1lU29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAidHlwZSI6ICJ1c2VyX2lucHV0IiwNCiAgICAgICAgInRleHQiOiB0aGF0Lm1lc3NhZ2UsDQogICAgfSkpOw0KfScA6Lu3sgO+DRNhYkNvcmVNZW51U29ydE9yZGVyAgQA6Lu3sgP+TwQxMDAxJwDou7eyA74NDG9uQXVkaW9DaHVuawIEAOi7t7IDg1CrB0Bjb25zdCBtdXRlQm90ID0gZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuYWkubXV0ZSIpOw0KbGV0IGF1ZGlvRGF0YTsNCmlmIChtdXRlQm90ICYmIG11dGVCb3QudGFncy5tdXRlZCAmJiB0YWdzLnNlbnRJbml0Q2h1bmspIHsNCiAgICBjb25zdCBzaWxlbmNlID0gbmV3IEJsb2IoW25ldyBVaW50OEFycmF5KHRoYXQuc2l6ZSldLCB7IHR5cGU6ICdhdWRpby93YXYnIH0pOw0KICAgIGF1ZGlvRGF0YSA9IGF3YWl0IGJsb2JUb0Jhc2U2NChzaWxlbmNlKTsNCn0gZWxzZSB7DQogICAgYXVkaW9EYXRhID0gYXdhaXQgYmxvYlRvQmFzZTY0KHRoYXQpOw0KfQ0KDQpzZXRUYWdNYXNrKHRoaXNCb3QsICJzZW50SW5pdENodW5rIiwgdHJ1ZSk7DQoNCmNvbnN0IGh1bWVTb2NrZXQgPSB0aGlzQm90LnZhcnMuaHVtZVNvY2tldDsNCg0KY29uc3QgcGFja2V0SGFzaCA9IGNyeXB0by5oYXNoKCdzaGExJywgJ2hleCcsIGF1ZGlvRGF0YSk7DQoNCmlmKGh1bWVTb2NrZXQpIHsNCiAgICBjb25zb2xlLmxvZygicGFja2V0IGhlcmUiLCBwYWNrZXRIYXNoKTsNCg0KICAgIGh1bWVTb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICJ0eXBlIjogImF1ZGlvX2lucHV0IiwNCiAgICAgICAgImRhdGEiOiBhdWRpb0RhdGENCiAgICB9KSk7DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIGJsb2JUb0Jhc2U2NChibG9iKSB7DQogIC8vIFJlYWQgdGhlIEJsb2IgYXMgYW4gQXJyYXlCdWZmZXINCiAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBibG9iLmFycmF5QnVmZmVyKCk7DQogIA0KICAvLyBDb252ZXJ0IHRoZSBBcnJheUJ1ZmZlciB0byBhIEJhc2U2NCBzdHJpbmcNCiAgY29uc3QgYmFzZTY0U3RyaW5nID0gYnl0ZXMudG9CYXNlNjRTdHJpbmcobmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIpLCAnYXVkaW8vd2F2Jyk7DQogIA0KICByZXR1cm4gYmFzZTY0U3RyaW5nOw0KfScA6Lu3sgO+DQpxdWV1ZUF1ZGlvAgQA6Lu3sgOvV/QCQGNvbnN0IGJhc2U2NEF1ZGlvID0gdGhhdDsNCg0KY29uc3QgbWltZVR5cGUgPSAiYXVkaW8vd2F2IjsgLy8gQWRqdXN0IE1JTUUgdHlwZSBhcyBuZWVkZWQNCmNvbnN0IGRhdGFVUkwgPSBgZGF0YToke21pbWVUeXBlfTtiYXNlNjQsJHtiYXNlNjRBdWRpb31gOw0KDQp0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUgPSB0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUgPyBbLi4udGhpc0JvdC5tYXNrcy5hdWRpb1F1ZXVlXS5jb25jYXQoZGF0YVVSTCkgOiBbZGF0YVVSTF07DQoNCi8vdGhpc0JvdC5wbGF5UXVldWVkQXVkaW8oKTsNCmlmICghdGFncy5oYW5kUmFpc2VkKSB7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiaGFuZFJhaXNlZCIsIHRydWUpOw0KfQ0KJwDou7eyA74NC2dldFVzZXJOYW1lAgQA6Lu3sgOkWqUDQGxldCB1c2VybmFtZSA9ICJ1c2VyIjsNCg0KaWYgKGF1dGhCb3QgJiYgYXV0aEJvdC50YWdzLm5hbWUgJiYgYXV0aEJvdC50YWdzLm5hbWUgIT0gIiIpIHsNCiAgICB1c2VybmFtZSA9IGF1dGhCb3QudGFncy5uYW1lOw0KfSBlbHNlIGlmIChhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWUpIHsNCiAgICB1c2VybmFtZSA9IGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZTsNCn0gZWxzZSB7DQogICAgdXNlcm5hbWUgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsNCiAgICAgICAgdGl0bGU6ICJXaGF0IHdvdWxkIHlvdSBsaWtlIG1lIHRvIGNhbGwgeW91PyINCiAgICB9KTsNCiAgICBhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWUgPSB1c2VybmFtZTsNCn0NCg0KcmV0dXJuIHVzZXJuYW1lOycA6Lu3sgO+DQphYklET3JpZ2luAgQA6Lu3sgPKXQdhYlZvaWNlJwDou7eyA74NDmFiQ29yZU1lbnVJY29uAgQA6Lu3sgPSXQRjdWJlJwDou7eyA74NA2FzawIEAOi7t7ID110o8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycA6Lu3sgO+DQxvbkJvdENoYW5nZWQCBADou7eyA/5dwgpAaWYgKHRoYXQudGFncy5pbmNsdWRlcygiaGFuZFJhaXNlZCIpKSB7DQogICAgLy9jcmVhdGUgYm90IGFib3ZlIGFiIHdpdGggc3BlY2lhbCBjbGlja2FibGUgbGFiZWwNCiAgICANCiAgICBjb25zdCBhYkJvdCA9IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3Q7DQogICAgaWYgKCFhYkJvdCkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgaWYgKHRhZ3MuaGFuZFJhaXNlZCkgew0KICAgICAgICBjb25zdCBub3RpZkJvdHMgPSBnZXRCb3RzKCJhYlZvaWNlTm90aWZpY2F0aW9uQm90IiwgdHJ1ZSk7DQogICAgICAgIGRlc3Ryb3kobm90aWZCb3RzKTsNCiAgICAgICAgDQogICAgICAgIGNyZWF0ZSh7DQogICAgICAgICAgICB0cmFuc2Zvcm1lcjogZ2V0SUQoYWJCb3QpLA0KICAgICAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgICAgICBsaW5rcy52b2ljZS5jYWxsZWRPbih0aGlzQm90KTsNCiAgICAgICAgICAgIGAsDQogICAgICAgICAgICBuYW1lOiAiYWJWb2ljZU5vdGlmQm90IiwNCiAgICAgICAgICAgIHZvaWNlOiBnZXRMaW5rKHRoaXNCb3QpLA0KICAgICAgICAgICAgYWJWb2ljZU5vdGlmaWNhdGlvbkJvdDogdHJ1ZSwNCiAgICAgICAgICAgIFthYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uXTogdHJ1ZSwNCiAgICAgICAgICAgIFthYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uICsgJ1onXTogMSwNCiAgICAgICAgICAgIGZvcm06ICdzcHJpdGUnLA0KICAgICAgICAgICAgZm9jdXNhYmxlOiB0cnVlLA0KICAgICAgICAgICAgb25Gb2N1c0VudGVyOiBgQA0KICAgICAgICAgICAgICAgIGlmICh0aGF0LmJvdCA9PSB0aGlzQm90KSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXNCb3Qub25DbGljaygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGAsDQogICAgICAgICAgICBvcmllbnRhdGlvbk1vZGU6ICdiaWxsYm9hcmQnLA0KICAgICAgICAgICAgc3BhY2U6ICJ0ZW1wTG9jYWwiLA0KICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LXByb2QtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vNjRiZWI0MzktMTJiOS00MTU1LWIzODgtZGIwM2I3ZWMxYzljLzg5Mjk5ZDhjNThmOTdmODg1M2E5ZTg3ZDRhMDIwNzU3NDgzOWRiZWIzYzY2YjkyZWE2OTFkYjcxMGIzM2M1MTYnLA0KDQogICAgICAgIH0pDQogICAgfSBlbHNlIHsNCiAgICAgICAgY29uc3Qgbm90aWZCb3RzID0gZ2V0Qm90cygiYWJWb2ljZU5vdGlmaWNhdGlvbkJvdCIsIHRydWUpOw0KICAgICAgICBkZXN0cm95KG5vdGlmQm90cyk7DQogICAgfQ0KfScA6Lu3sgO+DQdjb25zb2xlAgQA6Lu3sgPBaCjwn5SXMjRiN2U2NmYtMGQ1Yi00MDY0LWJmNDgtYjU2MmI5ZTZlM2ViJwDou7eyA74NCGNhbGxlZE9uAgQA6Lu3sgPoaC1AZGVzdHJveSh0aGF0KTsNCg0KdGhpc0JvdC5wbGF5UXVldWVkQXVkaW8oKTsnAOi7t7IDvg0Sb25IdW1lU29ja2V0T3BlbmVkAgQA6Lu3sgOWaXpAaWYgKHRhZ3MuYXdhaXRpbmdUZXh0KSB7DQogICAgdGhpc0JvdC50ZXh0UmVzcG9uc2UodGFncy5hd2FpdGluZ1RleHQpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImF3YWl0aW5nVGV4dCIsIG51bGwpOw0KfScA6Lu3sgO+DQtjbGVhclF1ZXVlcwIEAOi7t7IDkWqAA0B0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUgJiYgdGhpc0JvdC5tYXNrcy5hdWRpb1F1ZXVlLmxlbmd0aCA+IDAgPyB0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUubGVuZ3RoID0gMSA6IG51bGw7DQp0aGlzQm90Lm1hc2tzLnRleHRRdWV1ZSAmJiB0aGlzQm90Lm1hc2tzLnRleHRRdWV1ZS5sZW5ndGggPiAwID8gdGhpc0JvdC5tYXNrcy50ZXh0UXVldWUubGVuZ3RoID0gMSA6IG51bGw7DQoNCm9zLmNhbmNlbFNvdW5kKHRoaXNCb3QubWFza3MuYWN0aXZlU291bmQpOw0KDQpjb25zdCBub3RpZkJvdHMgPSBnZXRCb3RzKCJhYlZvaWNlTm90aWZpY2F0aW9uQm90IiwgdHJ1ZSk7DQpkZXN0cm95KG5vdGlmQm90cyk7DQoNCnRoaXNCb3QubWFza3MuYWN0aXZlU291bmQgPSBudWxsOygA6Lu3sgO+DQh0aGlua2luZwF4JwDou7eyA74NC21ha2VUb0RvQm90AgQA6Lu3sgOTbdcHQGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHRoYXQuZGF0YSk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5ib3RzLmxlbmd0aDsgKytpKSB7DQogICAgY29uc3QgYWJBcnRpZmFjdFNoYXJkID0gew0KICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICBwcm9tcHQ6IGRhdGEuYm90c1tpXS5wcm9tcHQsDQogICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogYWIubGlua3MucmVtZW1iZXIuYWJHcmlkRm9jdXM/LmRpbWVuc2lvbiA/PyB0YWdzLmRpbWVuc2lvbiA/PyAnaG9tZScsDQogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgICAgICB4OiBhYi5saW5rcy5yZW1lbWJlci5hYkdyaWRGb2N1cz8ucG9zaXRpb24/LnggPz8gZGF0YS5ib3RzW2ldLmxvY2F0aW9uPy54ID8/IDAsDQogICAgICAgICAgICAgICAgICAgICAgICB5OiBhYi5saW5rcy5yZW1lbWJlci5hYkdyaWRGb2N1cz8ucG9zaXRpb24/LnggPz8gZGF0YS5ib3RzW2ldLmxvY2F0aW9uPy55ID8/IDANCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgZGVwZW5kZW5jaWVzOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXNrSUQ6ICd0b0RvQm90Jw0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfTsNCiAgICBhd2FpdCBhYi5saW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0UHJvbWlzZUJvdCh7DQogICAgICAgIGFiQXJ0aWZhY3ROYW1lOiAndG9Eb0JvdCcsDQogICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgIGFiQXJ0aWZhY3RTaGFyZCwNCiAgICB9KTsNCn0NCg0KdGhpc0JvdC5zZW5kVG9vbENvbXBsZXRlTWVzc2FnZSh7aWQ6IHRoYXQuaWR9KTsnAOi7t7IDvg0OZ2V0Q2F0YWxvZ0Fza3MCBADou7eyA+t0+wZAY29uc3QgY2F0YWxvZ0FyciA9IFtdOw0KY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBhYi5saW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspDQp7DQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBpZiAoIWV4dGFudEJvdCkNCiAgICB7DQogICAgICAgIGNvbnN0IG9iaiA9IHsNCiAgICAgICAgICAgICJuYW1lIjogYWN0aXZlVG9vbGJveC50aXRsZSwNCiAgICAgICAgICAgICJpZCI6IGFjdGl2ZVRvb2xib3gubmFtZQ0KICAgICAgICB9DQogICAgICAgIGNhdGFsb2dBcnIucHVzaChvYmopOw0KICAgIH0NCn0NCg0KY29uc3QgbG9hZGVkVG9vbGJveGVzID0gZ2V0Qm90cygidG9vbF9hcnJheSIpOw0KZm9yIChsZXQgaiA9IDA7IGogPCBsb2FkZWRUb29sYm94ZXMubGVuZ3RoOyArK2opIHsNCiAgICBjb25zdCBhcnIgPSBsb2FkZWRUb29sYm94ZXNbal0udGFncy50b29sX2FycmF5ID8/IFtdOw0KICAgIGZvciAobGV0IGsgPSAwOyBrIDwgYXJyLmxlbmd0aDsgKytrKSB7DQogICAgICAgIGNvbnN0IG9iaiA9IHsNCiAgICAgICAgICAgICJuYW1lIjogYXJyW2tdLm5hbWUgPz8gYXJyW2tdLnRhcmdldEFCLA0KICAgICAgICAgICAgImlkIjogYXJyW2tdLnRhcmdldEFCDQogICAgICAgIH0NCiAgICAgICAgY2F0YWxvZ0Fyci5wdXNoKG9iaik7DQogICAgfQ0KfQ0KDQpyZXR1cm4gY2F0YWxvZ0FycjsnAOi7t7IDvg0NbWFrZVNvbWV0aGluZwIEAOi7t7ID53uhHkBjb25zdCBkYXRhID0gSlNPTi5wYXJzZSh0aGF0LmRhdGEpOw0KaWYgKGRhdGEgJiYgZGF0YS5wcm9tcHQpIHsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJsYXRlc3RJbnF1aXJ5IiwgZGF0YS5wcm9tcHQpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImxhdGVzdElucXVpcnlJRCIsIHRoYXQuaWQpOw0KICAgIA0KICAgIC8vYWIubGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24oZGF0YS5wcm9tcHQpOw0KICAgIGNvbnN0IGFiQXJ0aWZhY3RTaGFyZCA9IHsNCiAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgcHJvbXB0OiBkYXRhLnByb21wdCwNCiAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHsNCiAgICAgICAgICAgICAgICAgICAgZGltZW5zaW9uOiBhYi5saW5rcy5yZW1lbWJlci5hYkdyaWRGb2N1cz8uZGltZW5zaW9uID8/IHRhZ3MuZGltZW5zaW9uID8/ICdob21lJywNCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IGFiLmxpbmtzLnJlbWVtYmVyLmFiR3JpZEZvY3VzPy5wb3NpdGlvbj8ueCA/PyAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgeTogYWIubGlua3MucmVtZW1iZXIuYWJHcmlkRm9jdXM/LnBvc2l0aW9uPy54ID8/IDANCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgZGVwZW5kZW5jaWVzOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXNrSUQ6ICd0b0RvQm90Jw0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfTsNCiAgICBhd2FpdCBhYi5saW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0UHJvbWlzZUJvdCh7DQogICAgICAgIGFiQXJ0aWZhY3ROYW1lOiAndG9Eb0JvdCcsDQogICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgIGFiQXJ0aWZhY3RTaGFyZCwNCiAgICB9KTsNCg0KICAgIGF3YWl0IG9zLnNsZWVwKDEwMDApOw0KDQogICAgY29uc3QgYWJCb3QgPSBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90Ow0KICAgIC8vcHVsbCBpbiBhZ2VudCBib3QNCiAgICBhd2FpdCBhYi5saW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgIGFza0lEOiAnYWdlbnRfYm90X3Rvb2wnLA0KICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHsNCiAgICAgICAgICAgICAgICBkaW1lbnNpb246IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPz8gJ2hvbWUnLA0KICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgIHg6IGFiQm90LnRhZ3NbKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPz8gJ2hvbWUnKSArICdYJ10gPz8gMSwNCiAgICAgICAgICAgICAgICAgICAgeTogYWJCb3QudGFnc1soY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA/PyAnaG9tZScpICsgJ1knXSA/PyAwDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGFpTW9kZWw6IGFiUGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwsDQogICAgICAgIH0NCiAgICB9KQ0KICAgIGxldCBhZ2VudEJvdCA9IGdldEJvdCgiYWdlbnRfYm90X3Rvb2wiLCB0cnVlKTsNCg0KICAgIGlmICghYWdlbnRCb3QpIHsNCiAgICAgICAgb3MudG9hc3QoImNvdWxkIG5vdCBjcmVhdGUgYWkgYWdlbnQiKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vY29tcGxldGUgdGhlIHRvZG8NCiAgICBjb25zdCB0b0RvQm90ID0gZ2V0Qm90KGJ5VGFnKCJ0b0RvIiwgdHJ1ZSksIGJ5VGFnKCJwcm9tcHQiLCBkYXRhLnByb21wdCkpOw0KICAgIGNvbnN0IHByb21wdCA9IHRvRG9Cb3QudGFncy5wcm9tcHQ7DQogICAgaWYgKCFwcm9tcHQpIHsNCiAgICAgICAgb3MudG9hc3QoImZhaWxlZCB0byBleGVjdXRlIHJlcXVlc3QiKQ0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgY29uc3QgeFBvcyA9IHRvRG9Cb3QudGFnc1t0b0RvQm90LnRhZ3MuZGltZW5zaW9uICsgJ1gnXTsNCiAgICBjb25zdCB5UG9zID0gdG9Eb0JvdC50YWdzW3RvRG9Cb3QudGFncy5kaW1lbnNpb24gKyAnWSddOw0KDQogICAgY29uc3QgYWdlbnRYUG9zID0gKGFnZW50Qm90LnRhZ3NbdG9Eb0JvdC50YWdzLmRpbWVuc2lvbiArICdYJ10gJiYgYWdlbnRCb3QudGFnc1t0b0RvQm90LnRhZ3MuZGltZW5zaW9uICsgJ1gnXSA+IHRvRG9Cb3QudGFnc1t0b0RvQm90LnRhZ3MuZGltZW5zaW9uICsgJ1gnXSkgPyB0b0RvQm90LnRhZ3NbdG9Eb0JvdC50YWdzLmRpbWVuc2lvbiArICdYJ10gKyAzIDogdG9Eb0JvdC50YWdzW3RvRG9Cb3QudGFncy5kaW1lbnNpb24gKyAnWCddIC0gMzsNCiAgICBjb25zdCBhZ2VudFlQb3MgPSAoYWdlbnRCb3QudGFnc1t0b0RvQm90LnRhZ3MuZGltZW5zaW9uICsgJ1knXSAmJiBhZ2VudEJvdC50YWdzW3RvRG9Cb3QudGFncy5kaW1lbnNpb24gKyAnWSddID4gdG9Eb0JvdC50YWdzW3RvRG9Cb3QudGFncy5kaW1lbnNpb24gKyAnWSddKSA/IHRvRG9Cb3QudGFnc1t0b0RvQm90LnRhZ3MuZGltZW5zaW9uICsgJ1knXSArIDMgOiB0b0RvQm90LnRhZ3NbdG9Eb0JvdC50YWdzLmRpbWVuc2lvbiArICdZJ10gLSAzOw0KDQogICAgYXdhaXQgdGhpc0JvdC5tb3ZlQm90KHsNCiAgICAgICAgYm90OiBhZ2VudEJvdCwNCiAgICAgICAgZGltZW5zaW9uOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID8/ICdob21lJywNCiAgICAgICAgcG9zaXRpb246IHsNCiAgICAgICAgICAgIHg6IGFnZW50WFBvcywNCiAgICAgICAgICAgIHk6IGFnZW50WVBvcw0KICAgICAgICB9DQogICAgfSkNCg0KICAgIGF3YWl0IG9zLnNsZWVwKDI1MCk7DQoNCiAgICBsaW5rcy5hcm1fdG9vbC5hYkNyZWF0ZUFybSh7DQogICAgICAgIG9yaWdpbkJvdDogYWdlbnRCb3QsDQogICAgICAgIGRpbWVuc2lvbjogdG9Eb0JvdC50YWdzLmRpbWVuc2lvbiwNCiAgICAgICAgcG9zaXRpb246IHsNCiAgICAgICAgICAgIHg6IHhQb3MsDQogICAgICAgICAgICB5OiB5UG9zLA0KICAgICAgICAgICAgejogMA0KICAgICAgICB9DQogICAgfSkNCiAgICBhd2FpdCBvcy5zbGVlcCgxMDAwKTsNCg0KICAgIGNvbnN0IHJlcXVlc3REYXRhID0ge307DQogICAgaWYgKGFnZW50Qm90LmxpbmtzLmFybUJvdCkgew0KICAgICAgICBjb25zdCBhcm1Cb3QgPSBhZ2VudEJvdC5saW5rcy5hcm1Cb3Q7DQogICAgICAgIGNvbnN0IGFybURpbWVuc2lvbiA9IGFybUJvdC50YWdzLmRpbWVuc2lvbjsNCg0KICAgICAgICByZXF1ZXN0RGF0YS5hcm1EaW1lbnNpb24gPSBhcm1EaW1lbnNpb247DQogICAgICAgIHJlcXVlc3REYXRhLmFybURpbWVuc2lvblggPSBhcm1Cb3QudGFnc1thcm1EaW1lbnNpb24gKyAiWCJdOw0KICAgICAgICByZXF1ZXN0RGF0YS5hcm1EaW1lbnNpb25ZID0gYXJtQm90LnRhZ3NbYXJtRGltZW5zaW9uICsgIlkiXTsNCiAgICB9DQoNCiAgICBhZ2VudEJvdC5tYXNrcy50YXJnZXRCb3QgPSBnZXRMaW5rKHRvRG9Cb3QpOw0KICAgIGFnZW50Qm90Lm1hc2tzLnByb21wdFR5cGUgPSAnZ3JpZCc7DQogICAgYWdlbnRCb3QuYWdlbnRPblJlcXVlc3Qoew0KICAgICAgICBpbnF1aXJ5OiBwcm9tcHQsDQogICAgICAgIGRhdGE6IHJlcXVlc3REYXRhLCANCiAgICAgICAgbW9kZWw6IGFnZW50Qm90LnRhZ3MuYWlNb2RlbA0KICAgIH0pOw0KDQogICAgdG9Eb0JvdC50YWdzW3RvRG9Cb3QudGFncy5kaW1lbnNpb25dID0gZmFsc2U7DQogICAgLy8gZGVzdHJveSh0b0RvQm90KTsNCiAgICAvLyBkZXN0cm95KGFnZW50Qm90KTsNCg0KICAgIGF3YWl0IG9zLnNsZWVwKDEwMDApOw0KfScA6Lu3sgO+DQ9wdWxsRnJvbUNhdGFsb2cCBADou7eyA4maAdwRQGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHRoYXQuZGF0YSk7DQoNCi8vZ2V0IGdyaWQgZGF0YQ0KaWYgKCFhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzKSB7DQogIGNvbnN0IGdyaWREYXRhID0gew0KICAgICAgZGltZW5zaW9uOiBhYlJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb24gPz8gJ2hvbWUnLCANCiAgICAgIHBvc2l0aW9uOiB7DQogICAgICAgICAgeDogMCwNCiAgICAgICAgICB5OiAwDQogICAgICB9DQogIH0NCiAgYWIubGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cyA9IGdyaWREYXRhOw0KfQ0KDQovL21ha2Ugc3VyZSB0aGUgYXNrIGlzIHRoZXJlDQppZiAoZGF0YSAmJiBkYXRhLmFzaykgew0KDQogIC8vSWYgcHVsbGluZyBhIHRvb2xib3gNCiAgaWYgKGRhdGEuYXNrLmluY2x1ZGVzKCJ0b29sYm94IikpIHsNCiAgICBjb25zdCB0b29sYm94RGF0YSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheS5maW5kKHRvb2xCb3ggPT4gdG9vbEJveC5uYW1lID09IGRhdGEuYXNrKTsNCiAgICBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdG9vbGJveERhdGEsIGdyaWREYXRhOiBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzfSk7DQogIH0gDQogIC8vZWxzZSBwdWxsaW5nIGFydGlmYWN0IG9yIGFzaw0KICBlbHNlIHsNCiAgICBsZXQgaXNBcnRpZmFjdCA9IGZhbHNlOw0KDQogICAgLy9maW5kIHRoZSB0b29sYm94IGZvciB0aGlzIGFzaywgdG8gZGV0ZXJtaW5lIGlmIGl0cyBhbiBhcnRpZmFjdA0KICAgIGNvbnN0IHRvb2xib3ggPSBnZXRCb3QoYnlUYWcoInRvb2xfYXJyYXkiLCB0b29sX2FyciA9PiB7DQogICAgICBpZiAodG9vbF9hcnIuZmluZCh0b29sID0+IHRvb2wudGFyZ2V0QUIgPT0gZGF0YS5hc2spKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfX0NCiAgICApKTsNCiAgICBpZiAodG9vbGJveCkgew0KICAgICAgaXNBcnRpZmFjdCA9IHRvb2xib3gudGFncy50b29sX2FycmF5LmZpbmQodG9vbCA9PiB0b29sLnRhcmdldEFCID09IGRhdGEuYXNrKT8uYXJ0aWZhY3Q7DQogICAgfQ0KDQogICAgLy9pcyBhcnRpZmFjdA0KICAgIGlmIChpc0FydGlmYWN0KSB7DQogICAgICBjb25zdCBhYkFydGlmYWN0U2hhcmQgPSB7DQogICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiBudWxsLA0KICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgIGRlcGVuZGVuY2llczogWw0KICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICBhc2tJRDogZGF0YS5hc2sNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIF0NCiAgICAgIH07DQogICAgICBhYi5saW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0UHJvbWlzZUJvdCh7DQogICAgICAgICAgYWJBcnRpZmFjdE5hbWU6IGRhdGEuYXNrLA0KICAgICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgICAgYWJBcnRpZmFjdFNoYXJkLA0KICAgICAgfSk7DQogICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgdGhpc0JvdC5zZW5kVG9vbENvbXBsZXRlTWVzc2FnZSh7aWQ6IHRoYXQuaWR9KTsNCiAgICB9IA0KICAgIC8vaXMgbm90IGFydGlmYWN0DQogICAgZWxzZSB7DQogICAgICBjb25zdCByZXNwb25zZSA9IGFiLmxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsNCiAgICAgICAgICBhc2tJRDogZGF0YS5hc2ssDQogICAgICAgICAgc291cmNlRXZlbnQ6ICd0b29sJywNCiAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgIHRvb2xib3hCb3Q6IG51bGwsDQogICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogYWIubGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cw0KICAgICAgICAgIH0sDQogICAgICB9KTsNCiAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykgew0KICAgICAgICB0aGlzQm90LnNlbmRUb29sQ29tcGxldGVNZXNzYWdlKHtpZDogdGhhdC5pZH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpc0JvdC5zZW5kVG9vbENvbXBsZXRlTWVzc2FnZSh7aWQ6IHRoYXQuaWQsIGNvbnRlbnQ6ICJmYWlsZWQifSk7DQogICAgICB9DQogICAgfQ0KICB9DQp9JwDou7eyA74NDm9uQW55Qm90c0FkZGVkAgQA6Lu3sgPmqwGpBUBmb3IgKGxldCBpID0gMDsgaSA8IHRoYXQuYm90cy5sZW5ndGg7ICsraSkgew0KICAgIGlmICh0aGF0LmJvdHNbaV0udGFncy50b29sX2FycmF5KSB7DQogICAgICAgIGNvbnN0IGh1bWVTb2NrZXQgPSB0aGlzQm90LnZhcnMuaHVtZVNvY2tldDsNCg0KICAgICAgICBpZihodW1lU29ja2V0KSB7DQogICAgICAgICAgICBodW1lU29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAgICAgICAgICJ0eXBlIjogInNlc3Npb25fc2V0dGluZ3MiLA0KICAgICAgICAgICAgICAgICJ2YXJpYWJsZXMiOiB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LA0KICAgICAgICAgICAgICAgICAgICAiY2F0YWxvZ19hc2tzIjogYXdhaXQgdGhpc0JvdC5nZXRDYXRhbG9nQXNrcygpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgaWYgKHRoYXQuYm90c1tpXS50YWdzLmFiUGF0Y2hCb3QgPT0gdHJ1ZSAmJiB0aGF0LmJvdHNbaV0udGFncy5hYlBhdGNoQXNrSW5wdXQ/LmlucXVpcnkgPT0gdGFncy5sYXRlc3RJbnF1aXJ5KSB7DQogICAgICAgIHRoaXNCb3Quc2VuZFRvb2xDb21wbGV0ZU1lc3NhZ2Uoe2lkOiB0YWdzLmxhdGVzdElucXVpcnlJRH0pOw0KICAgIH0NCn0NCicA6Lu3sgO+DRdzZW5kVG9vbENvbXBsZXRlTWVzc2FnZQIEAOi7t7IDkLEBhANAY29uc3QgY29tcGxldGVfc2V0dGluZ3MgPSB7DQogICAgInR5cGUiOiAidG9vbF9yZXNwb25zZSIsDQogICAgInRvb2xfY2FsbF9pZCI6IHRoYXQuaWQsDQogICAgImNvbnRlbnQiOiB0aGF0LmNvbnRlbnQgPz8gImNvbXBsZXRlZCINCn07DQoNCmlmICh0aGlzQm90LnZhcnNbInRvb2xSZXNwb25zZVRpbWVvdXQiICsgdGhhdC5pZF0pIHsNCiAgICBjbGVhclRpbWVvdXQodGhpc0JvdC52YXJzWyJ0b29sUmVzcG9uc2VUaW1lb3V0IiArIHRoYXQuaWRdKTsNCn0NCg0KY29uc3QgaHVtZVNvY2tldCA9IHRoaXNCb3QudmFycy5odW1lU29ja2V0Ow0KDQppZihodW1lU29ja2V0KSB7DQogICAgaHVtZVNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KGNvbXBsZXRlX3NldHRpbmdzKSk7DQp9JwDou7eyA74NB21hbmFnZXICBADou7eyA5W0ASjwn5SXMTNmMzNhNTEtYzJmYS00NmRhLWE4OGUtZTVjMDY3NTU2ZDAyJwDou7eyA74NDGdldFNjZW5lRGF0YQIEAOi7t7IDvLQB/QRAY29uc3QgYm90cyA9IGdldEJvdHMoYnlUYWcoYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbiwgdHJ1ZSksIG5vdChieVRhZygiYWJJZ25vcmUiLCB0cnVlKSksIG5vdChieVRhZygiYWJCb3QiLCB0cnVlKSkpOw0KDQpjb25zdCB0b29sX3Jlc3BvbnNlID0gew0KICAgICJ0eXBlIjogInRvb2xfcmVzcG9uc2UiLA0KICAgICJ0b29sX2NhbGxfaWQiOiB0aGF0LmlkLA0KICAgICJjb250ZW50IjogSlNPTi5zdHJpbmdpZnkoYm90cykNCn07DQoNCmNvbnNvbGUubG9nKCJTY2VuZSBEYXRhIFNlbnQ6ICIsIGJvdHMpDQppZiAodGFncy5kZWJ1Z01vZGUgPT0gdHJ1ZSkgew0KICAgIGFiLmxvZyh7DQogICAgICAgIG1lc3NhZ2U6ICJTY2VuZSBEYXRhIFNlbnQ6ICIgKyBKU09OLnN0cmluZ2lmeShib3RzKSwNCiAgICAgICAgbmFtZTogJ2Nhc3VhbG9zJywNCiAgICAgICAgc3BhY2U6ICJzaGFyZWQiLA0KICAgICAgICBtZXNzYWdlT3JpZ2luOiBjb25maWdCb3QuaWQsDQogICAgfSk7DQp9DQoNCmNvbnN0IGh1bWVTb2NrZXQgPSB0aGlzQm90LnZhcnMuaHVtZVNvY2tldDsNCg0KaWYoaHVtZVNvY2tldCkgew0KICAgIGh1bWVTb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh0b29sX3Jlc3BvbnNlKSk7DQp9JwDou7eyA74NDHNlZVVzZXJGb2N1cwIEAOi7t7IDurkBuAVAY29uc3QgZm9jdXMgPSBhYi5saW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMgPz8gYWIubGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cyA/PyBhYi5saW5rcy5yZW1lbWJlci5saW5rcy5hYkdyaWRGb2N1cyA/PyBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzID8/IG51bGwNCg0KY29uc3QgdG9vbF9yZXNwb25zZSA9IHsNCiAgICAidHlwZSI6ICJ0b29sX3Jlc3BvbnNlIiwNCiAgICAidG9vbF9jYWxsX2lkIjogdGhhdC5pZCwNCiAgICAiY29udGVudCI6IEpTT04uc3RyaW5naWZ5KGZvY3VzKQ0KfTsNCg0KY29uc3QgaHVtZVNvY2tldCA9IHRoaXNCb3QudmFycy5odW1lU29ja2V0Ow0KDQpjb25zb2xlLmxvZygiVXNlciBGb2N1cyBEYXRhIFNlbnQ6ICIsIGZvY3VzKQ0KaWYgKHRhZ3MuZGVidWdNb2RlID09IHRydWUpIHsNCiAgICBhYi5sb2coew0KICAgICAgICBtZXNzYWdlOiAiVXNlciBGb2N1cyBEYXRhIFNlbnQ6ICIgKyBKU09OLnN0cmluZ2lmeShmb2N1cyksDQogICAgICAgIG5hbWU6ICdjYXN1YWxvcycsDQogICAgICAgIHNwYWNlOiAic2hhcmVkIiwNCiAgICAgICAgbWVzc2FnZU9yaWdpbjogY29uZmlnQm90LmlkLA0KICAgIH0pOw0KfQ0KDQppZihodW1lU29ja2V0KSB7DQogICAgaHVtZVNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHRvb2xfcmVzcG9uc2UpKTsNCn0nAOi7t7IDvg0HYWlDbGljawIEAOi7t7ID874Be0Bjb25zdCBkYXRhID0gSlNPTi5wYXJzZSh0aGF0KTsNCg0KaWYgKCFkYXRhIHx8ICFkYXRhLmJvdCkgew0KICAgIHJldHVybjsNCn0NCg0Kd2hpc3BlcihnZXRCb3QoYnlJRChkYXRhLmJvdCkpLCAib25DbGljayIpOycA6Lu3sgO+DQ1jb21wbGV0ZVRvRG9zAgQA6Lu3sgPvvwHRFUBjb25zdCB0b0RvQm90cyA9IGdldEJvdHMoInRvRG8iLCB0cnVlKTsNCmxldCBhZ2VudEJvdCA9IGdldEJvdCgiYWdlbnRfYm90X3Rvb2wiLCB0cnVlKTsNCmlmICghYWdlbnRCb3QpIHsNCiAgICAvL2NyZWF0ZSBhZ2VudCBib3QNCiAgICBhd2FpdCBhYi5saW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgIGFza0lEOiAnYWdlbnRfYm90X3Rvb2wnLA0KICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHsNCiAgICAgICAgICAgICAgICBkaW1lbnNpb246IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPz8gJ2hvbWUnLA0KICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgIHg6IDEsDQogICAgICAgICAgICAgICAgICAgIHk6IDANCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYWlNb2RlbDogYWJQZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCwNCiAgICAgICAgfQ0KICAgIH0pDQogICAgYWdlbnRCb3QgPSBnZXRCb3QoImFnZW50X2JvdF90b29sIiwgdHJ1ZSk7DQp9DQoNCmlmICghYWdlbnRCb3QpIHsNCiAgICBvcy50b2FzdCgiY291bGQgbm90IGZpbmQgb3IgY3JlYXRlIGFpIGFnZW50Iik7DQogICAgcmV0dXJuOw0KfQ0KDQpzZXRUYWdNYXNrKHRoaXNCb3QsICJsYXRlc3RJbnF1aXJ5IiwgdG9Eb0JvdHNbdG9Eb0JvdHMubGVuZ3RoIC0gMV0udGFncy5wcm9tcHQpOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAibGF0ZXN0SW5xdWlyeUlEIiwgdGhhdC5pZCk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgdG9Eb0JvdHMubGVuZ3RoOyArK2kpIHsNCiAgICBjb25zdCBwcm9tcHQgPSB0b0RvQm90c1tpXS50YWdzLnByb21wdDsNCiAgICBpZiAoIXByb21wdCkgew0KICAgICAgICBjb250aW51ZTsNCiAgICB9DQoNCiAgICBjb25zdCB4UG9zID0gdG9Eb0JvdHNbaV0udGFnc1t0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiArICdYJ107DQogICAgY29uc3QgeVBvcyA9IHRvRG9Cb3RzW2ldLnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWSddOw0KDQogICAgY29uc3QgYWdlbnRYUG9zID0gKGFnZW50Qm90LnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWCddICYmIGFnZW50Qm90LnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWCddID4gdG9Eb0JvdHNbaV0udGFnc1t0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiArICdYJ10pID8gdG9Eb0JvdHNbaV0udGFnc1t0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiArICdYJ10gKyAzIDogdG9Eb0JvdHNbaV0udGFnc1t0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiArICdYJ10gLSAzOw0KICAgIGNvbnN0IGFnZW50WVBvcyA9IChhZ2VudEJvdC50YWdzW3RvRG9Cb3RzW2ldLnRhZ3MuZGltZW5zaW9uICsgJ1knXSAmJiBhZ2VudEJvdC50YWdzW3RvRG9Cb3RzW2ldLnRhZ3MuZGltZW5zaW9uICsgJ1knXSA+IHRvRG9Cb3RzW2ldLnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWSddKSA/IHRvRG9Cb3RzW2ldLnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWSddICsgMyA6IHRvRG9Cb3RzW2ldLnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWSddIC0gMzsNCg0KICAgIGF3YWl0IHRoaXNCb3QubW92ZUJvdCh7DQogICAgICAgIGJvdDogYWdlbnRCb3QsDQogICAgICAgIGRpbWVuc2lvbjogdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gPz8gJ2hvbWUnLA0KICAgICAgICBwb3NpdGlvbjogew0KICAgICAgICAgICAgeDogYWdlbnRYUG9zLA0KICAgICAgICAgICAgeTogYWdlbnRZUG9zDQogICAgICAgIH0NCiAgICB9KQ0KDQogICAgYXdhaXQgb3Muc2xlZXAoNTAwKTsNCg0KICAgIGxpbmtzLmFybV90b29sLmFiQ3JlYXRlQXJtKHsNCiAgICAgICAgb3JpZ2luQm90OiBhZ2VudEJvdCwNCiAgICAgICAgZGltZW5zaW9uOiB0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiwNCiAgICAgICAgcG9zaXRpb246IHsNCiAgICAgICAgICAgIHg6IHhQb3MsDQogICAgICAgICAgICB5OiB5UG9zLA0KICAgICAgICAgICAgejogMA0KICAgICAgICB9DQogICAgfSkNCiAgICBhd2FpdCBvcy5zbGVlcCgxMDAwKTsNCg0KICAgIGNvbnN0IHJlcXVlc3REYXRhID0ge307DQogICAgaWYgKGFnZW50Qm90LmxpbmtzLmFybUJvdCkgew0KICAgICAgICBjb25zdCBhcm1Cb3QgPSBhZ2VudEJvdC5saW5rcy5hcm1Cb3Q7DQogICAgICAgIGNvbnN0IGFybURpbWVuc2lvbiA9IGFybUJvdC50YWdzLmRpbWVuc2lvbjsNCg0KICAgICAgICByZXF1ZXN0RGF0YS5hcm1EaW1lbnNpb24gPSBhcm1EaW1lbnNpb247DQogICAgICAgIHJlcXVlc3REYXRhLmFybURpbWVuc2lvblggPSBhcm1Cb3QudGFnc1thcm1EaW1lbnNpb24gKyAiWCJdOw0KICAgICAgICByZXF1ZXN0RGF0YS5hcm1EaW1lbnNpb25ZID0gYXJtQm90LnRhZ3NbYXJtRGltZW5zaW9uICsgIlkiXTsNCiAgICB9DQoNCiAgICBhZ2VudEJvdC5tYXNrcy50YXJnZXRCb3QgPSBnZXRMaW5rKHRvRG9Cb3RzW2ldKTsNCiAgICBhZ2VudEJvdC5tYXNrcy5wcm9tcHRUeXBlID0gJ2dyaWQnOw0KICAgIGFnZW50Qm90LmFnZW50T25SZXF1ZXN0KHsNCiAgICAgICAgaW5xdWlyeTogcHJvbXB0LA0KICAgICAgICBkYXRhOiByZXF1ZXN0RGF0YSwgDQogICAgICAgIG1vZGVsOiBhZ2VudEJvdC50YWdzLmFpTW9kZWwNCiAgICB9KTsNCg0KICAgIGF3YWl0IG9zLnNsZWVwKDEwMDApOw0KfScA6Lu3sgO+DQhhcm1fdG9vbAIEAOi7t7IDwdUBKPCflJczYzc0YzlmMS04MmRjLTQ2NTUtOGIzOC1lN2YxMWRlODk3OGUnAOi7t7IDvg0KaGFuZFJhaXNlZAIEAOi7t7ID6NUBBWZhbHNlJwDou7eyA74ND29uQUJJbml0aWFsaXplZAIEAOi7t7ID7tUBGEB0YWdzLmRlYnVnTW9kZSA9IGZhbHNlOycA6Lu3sgO+DQdhYlZvaWNlAgQA6Lu3sgOH1gEEdHJ1ZScA6Lu3sgO+DQlhYlZlcnNpb24CBADou7eyA4zWAQUxMC40MygA6Lu3sgO+DQlkZWJ1Z01vZGUBeScA6Lu3sgO+DRBvbkFCUGF0Y2hBcHByb3ZlAgQA6Lu3sgOT1gG8AkBpZiAodGhhdC5hYlBhdGNoQXNrSW5wdXQ/LmlucXVpcnkgPT0gdGFncy5sYXRlc3RJbnF1aXJ5KSB7DQogICAgY29uc3QgYWdlbnRCb3QgPSBnZXRCb3QoYnlJRCh0aGF0LmFiUGF0Y2hBc2tJbnB1dD8uYWJCb3QpKTsNCiAgICBpZiAoYWdlbnRCb3QgJiYgYWdlbnRCb3QudGFncy5hZ2VudF9ib3RfdG9vbCkgew0KICAgICAgICBkZXN0cm95KGFnZW50Qm90KTsNCiAgICB9DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAibGF0ZXN0SW5xdWlyeSIsIG51bGwpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImxhdGVzdElucXVpcnlJRCIsIG51bGwpOyANCn0nAOi7t7IDvg0Qb25BQlBhdGNoQXBwbGllZAIEAOi7t7ID0NgBiwJAY29uc3QgcHJvbXB0ID0gdGhhdC5hYlBhdGNoQXNrSW5wdXQ/LmlucXVpcnk7DQpjb25zdCB0b0RvQm90ID0gZ2V0Qm90KGJ5VGFnKCJ0b0RvIiwgdHJ1ZSksIGJ5VGFnKCJwcm9tcHQiLCBwcm9tcHQpKTsNCmlmICh0b0RvQm90KSB7DQogICAgZGVzdHJveSh0b0RvQm90KTsNCn0NCg0KaWYgKHRhZ3MubGF0ZXN0SW5xdWlyeSA9PSBwcm9tcHQpIHsNCiAgICB0aGlzQm90LnNlbmRUb29sQ29tcGxldGVNZXNzYWdlKHtpZDogdGFncy5sYXRlc3RJbnF1aXJ5SUR9KTsNCn0nAOi7t7IDvg0Pb25BQlBhdGNoRmFpbGVkAgQA6Lu3sgPc2gGTAkBjb25zdCBwcm9tcHQgPSB0aGF0LmFiUGF0Y2hBc2tJbnB1dD8uaW5xdWlyeTsNCg0KaWYgKHRhZ3MubGF0ZXN0SW5xdWlyeSA9PSBwcm9tcHQpIHsNCiAgICB0aGlzQm90LnNlbmRUb29sQ29tcGxldGVNZXNzYWdlKHtpZDogdGFncy5sYXRlc3RJbnF1aXJ5SUQsIGNvbnRlbnQ6ICJmYWlsZWQifSk7DQoNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJsYXRlc3RJbnF1aXJ5IiwgbnVsbCk7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAibGF0ZXN0SW5xdWlyeUlEIiwgbnVsbCk7DQp9JwDou7eyA74NDW9uQUJQYXRjaFVuZG8CBADou7eyA/DcAbwCQGlmICh0aGF0LmFiUGF0Y2hBc2tJbnB1dD8uaW5xdWlyeSA9PSB0YWdzLmxhdGVzdElucXVpcnkpIHsNCiAgICBjb25zdCBhZ2VudEJvdCA9IGdldEJvdChieUlEKHRoYXQuYWJQYXRjaEFza0lucHV0Py5hYkJvdCkpOw0KICAgIGlmIChhZ2VudEJvdCAmJiBhZ2VudEJvdC50YWdzLmFnZW50X2JvdF90b29sKSB7DQogICAgICAgIGRlc3Ryb3koYWdlbnRCb3QpOw0KICAgIH0NCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJsYXRlc3RJbnF1aXJ5IiwgbnVsbCk7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAibGF0ZXN0SW5xdWlyeUlEIiwgbnVsbCk7IA0KfScA6Lu3sgO+DQdtb3ZlQm90AgQA6Lu3sgOt3wGgB0ANCnRoYXQuYm90LnRhZ3NbdGhhdC5kaW1lbnNpb25dID0gdHJ1ZTsNCg0KY29uc3QgcHJldlggPSB0aGF0LmJvdC50YWdzW3RoYXQuZGltZW5zaW9uICsgJ1gnXSA/PyAwOw0KY29uc3QgcHJldlkgPSB0aGF0LmJvdC50YWdzW3RoYXQuZGltZW5zaW9uICsgJ1knXSA/PyAwOw0KDQpjb25zdCBkaXN0YW5jZSA9IE1hdGguc3FydChNYXRoLnBvdygodGhhdC5wb3NpdGlvbi54IC0gcHJldlgpLCAyKSArIE1hdGgucG93KCh0aGF0LnBvc2l0aW9uLnkgLSBwcmV2WSksIDIpKTsNCmxldCBzcGVlZCA9IDAuMDU7DQoNCmlmIChjb25maWdCb3QudGFncy5tYXBQb3J0YWwpIHsNCiAgICBzcGVlZCA9IDUwMDsNCn0NCg0KbGV0IGR1ciA9IGRpc3RhbmNlICogc3BlZWQ7DQoNCmlmIChkaXN0YW5jZSA+IDMwKSB7DQogICAgZHVyID0gMjsNCn0NCg0KaWYgKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCkgew0KICAgIGlmIChkaXN0YW5jZSA+IC4xKSB7DQogICAgICAgIGR1ciA9IDI7DQogICAgfQ0KfQ0KDQpjbGVhckFuaW1hdGlvbnModGhhdC5ib3QpOw0KYXdhaXQgYW5pbWF0ZVRhZyh0aGF0LmJvdCwgew0KICAgIGZyb21WYWx1ZTogew0KICAgICAgICBbdGhhdC5kaW1lbnNpb24gKyAnWCddOiB0aGF0LmJvdC50YWdzW3RoYXQuZGltZW5zaW9uICsgJ1gnXSA/PyAwLA0KICAgICAgICBbdGhhdC5kaW1lbnNpb24gKyAnWSddOiB0aGF0LmJvdC50YWdzW3RoYXQuZGltZW5zaW9uICsgJ1knXSA/PyAwLA0KICAgIH0sDQogICAgdG9WYWx1ZTogew0KICAgICAgICBbdGhhdC5kaW1lbnNpb24gKyAnWCddOiB0aGF0LnBvc2l0aW9uLngsDQogICAgICAgIFt0aGF0LmRpbWVuc2lvbiArICdZJ106IHRoYXQucG9zaXRpb24ueSwNCiAgICB9LA0KICAgIGR1cmF0aW9uOiBkdXIsDQogICAgdGFnTWFza1NwYWNlOiAnc2hhcmVkJw0KfSk7DQoNCnJldHVybjsA"}]}