{"version":2,"updates":[{"id":0,"timestamp":1771866502044,"update":"AX6io+GZAQAnAQRib3RzJDA3Y2ZlODk1LTNhZWUtNDBiNi04MWVhLTUzZmQ1MGIzMWNkOQEnAKKj4ZkBAAZzeXN0ZW0CBACio+GZAQEKYWIuYWkubXV0ZScAoqPhmQEAEGFiQ29yZU1lbnVBY3Rpb24CBACio+GZAQyaBEBzZXRUYWdNYXNrKHRoaXNCb3QsICJtdXRlZCIsICF0YWdzLm11dGVkKTsNCg0KY29uc3QgbWVudUJvdCA9IGdldEJvdChieVRhZygiYmFzZVNraWxsIiwgJ/CflJcnICsgZ2V0SUQodGhpc0JvdCkpLCBieVRhZygiYWJNZW51IiwgdHJ1ZSkpOw0KaWYgKG1lbnVCb3QpIHsNCiAgICBpZiAodGFncy5tdXRlZCkgew0KICAgICAgICBtZW51Qm90LnRhZ3MubGFiZWwgPSAidW5tdXRlIjsNCiAgICAgICAgbWVudUJvdC50YWdzLmZvcm1BZGRyZXNzID0gJ21pY19vZmYnOw0KICAgIH0gZWxzZSB7DQogICAgICAgIG1lbnVCb3QudGFncy5sYWJlbCA9ICJtdXRlIjsNCiAgICAgICAgbWVudUJvdC50YWdzLmZvcm1BZGRyZXNzID0gJ21pYyc7DQogICAgICAgIA0KICAgICAgICBjb25zdCB2b2ljZUJvdCA9IGdldEJvdCgic3lzdGVtIiwgImFiLmFpLnZvaWNlIik7DQogICAgICAgIGlmICh2b2ljZUJvdCAmJiAhdm9pY2VCb3QudmFycy5odW1lU29ja2V0KSB7DQogICAgICAgICAgICB2b2ljZUJvdC5zdGFydEh1bWUoKTsNCiAgICAgICAgfQ0KICAgIH0NCn0nAKKj4ZkBAA5hYkFydGlmYWN0TmFtZQIEAKKj4ZkBpQQHYWJWb2ljZSgAoqPhmQEABW11dGVkAXgnAKKj4ZkBAA5hYkNvcmVNZW51SWNvbgIEAKKj4ZkBrgQHbWljX29mZicAoqPhmQEAD2FiQ29yZU1lbnVMYWJlbAIEAKKj4ZkBtgQGdW5tdXRlJwCio+GZAQAFbGFiZWwCBACio+GZAb0EBG11dGUnAKKj4ZkBAAtmb3JtQWRkcmVzcwIEAKKj4ZkBwgQDbWljJwCio+GZAQATYWJDb3JlTWVudVNvcnRPcmRlcgIEAKKj4ZkBxgQEMTAwMCcAoqPhmQEAGGFiQ29yZU1lbnVPbkJlZm9yZUNyZWF0ZQIEAKKj4ZkBywSxAUBpZiAodGFncy5tdXRlZCkgew0KICAgIHRhZ3MuYWJDb3JlTWVudUxhYmVsID0gInVubXV0ZSI7DQogICAgdGFncy5hYkNvcmVNZW51SWNvbiA9ICdtaWNfb2ZmJzsNCn0gZWxzZSB7DQogICAgdGFncy5hYkNvcmVNZW51TGFiZWwgPSAibXV0ZSI7DQogICAgdGFncy5hYkNvcmVNZW51SWNvbiA9ICdtaWMnOw0KfScAoqPhmQEACmFiSURPcmlnaW4CBACio+GZAf0FB2FiVm9pY2UnAKKj4ZkBAAdhYlZvaWNlAgQAoqPhmQGFBgR0cnVlJwCio+GZAQAJYWJWZXJzaW9uAgQAoqPhmQGKBgUxMC40MicBBGJvdHMkMjU3YmUzMzctZjBhMS00MTkyLWJlOTctMzc3M2ZhZTI4MmNiAScAoqPhmQGQBgdjcmVhdG9yAgQAoqPhmQGRBiQzNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAKKj4ZkBkAYGc3lzdGVtAgQAoqPhmQG2Bg9hYi5haS5hdXRvU3BlYWsnAKKj4ZkBkAYOYWJDb3JlTWVudUljb24CBACio+GZAcYGB21pY19vZmYnAKKj4ZkBkAYQYWJDb3JlTWVudUFjdGlvbgIEAKKj4ZkBzgbOA0BzZXRUYWdNYXNrKHRoaXNCb3QsICJhdXRvU3BlYWsiLCAhdGFncy5hdXRvU3BlYWspOw0KDQpjb25zdCBtZW51Qm90ID0gZ2V0Qm90KGJ5VGFnKCJiYXNlU2tpbGwiLCAn8J+UlycgKyBnZXRJRCh0aGlzQm90KSksIGJ5VGFnKCJhYk1lbnUiLCB0cnVlKSk7DQppZiAobWVudUJvdCkgew0KICAgIGlmICghdGFncy5hdXRvU3BlYWspIHsNCiAgICAgICAgbWVudUJvdC50YWdzLmxhYmVsID0gInVubXV0ZSAiICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Ow0KICAgICAgICBtZW51Qm90LnRhZ3MuZm9ybUFkZHJlc3MgPSAnbWljX29mZic7DQogICAgfSBlbHNlIHsNCiAgICAgICAgbWVudUJvdC50YWdzLmxhYmVsID0gIm11dGUgIiArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsNCiAgICAgICAgbWVudUJvdC50YWdzLmZvcm1BZGRyZXNzID0gJ21pYyc7DQogICAgfQ0KfScAoqPhmQGQBhhhYkNvcmVNZW51T25CZWZvcmVDcmVhdGUCBACio+GZAZsKhgJAaWYgKCF0YWdzLmF1dG9TcGVhaykgew0KICAgIHRhZ3MuYWJDb3JlTWVudUxhYmVsID0gInVubXV0ZSAiICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Ow0KICAgIHRhZ3MuYWJDb3JlTWVudUljb24gPSAnbWljX29mZic7DQp9IGVsc2Ugew0KICAgIHRhZ3MuYWJDb3JlTWVudUxhYmVsID0gIm11dGUgIiArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsNCiAgICB0YWdzLmFiQ29yZU1lbnVJY29uID0gJ21pYyc7DQp9JwCio+GZAZAGD2FiQ29yZU1lbnVMYWJlbAIEAKKj4ZkBogwRdW5tdXRlIGNhc3VhbC5ib3QnAKKj4ZkBkAYTYWJDb3JlTWVudVNvcnRPcmRlcgIEAKKj4ZkBtAwDOTk5KACio+GZAZAGCWF1dG9TcGVhawF5JwCio+GZAZAGC29uQW55Q3JlYXRlAgQAoqPhmQG5DHFAaWYgKHRoYXQuYm90LnRhZ3MubmFtZSA9PSAiYWJWb2ljZU5vdGlmQm90Iikgew0KICAgIGlmICh0YWdzLmF1dG9TcGVhaykgew0KICAgICAgICB0aGF0LmJvdC5vbkNsaWNrKCk7DQogICAgfQ0KfScAoqPhmQGQBgphYklET3JpZ2luAgQAoqPhmQGrDQdhYlZvaWNlJwCio+GZAZAGB2FiVm9pY2UCBACio+GZAbMNBHRydWUnAKKj4ZkBkAYJYWJWZXJzaW9uAgQAoqPhmQG4DQUxMC40MicBBGJvdHMkOTllYTU4NmQtNDIyYi00NjJjLWIwZGYtYWUxY2I0MDgyMTUxAScAoqPhmQG+DQZzeXN0ZW0CBACio+GZAb8NC2FiLmFpLnZvaWNlJwCio+GZAb4NFGFiQ29yZU1lbnVPbkdlbmVyYXRlAgQAoqPhmQHLDfUDQHRhZ3Mub25TdWJtaXQgPSBgQA0KICAgIGxpbmtzLmJhc2VTa2lsbC5hYkNvcmVNZW51QWN0aW9uKHttZXNzYWdlOiB0aGF0LnRleHQsIG1lbnU6ICJjb3JlIn0pOw0KICAgIG1hc2tzLm1lbnVJdGVtVGV4dCA9ICIiOw0KYDsNCg0KdGFncy5mb3JtID0gImlucHV0IjsNCg0KaWYgKCFhdXRoQm90KQ0Kew0KICAgIHRhZ3MubGFiZWwgPSAieW91IG11c3QgYmUgbG9nZ2VkIGluIHRvIGNoYXQgd2l0aCAiICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Ow0KfQ0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikNCnsNCiAgICB0YWdzLmxhYmVsID0gImNoYXQgd2l0aCAiICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIiAobGltaXRlZCkiOw0KfQ0KZWxzZQ0Kew0KICAgIHRhZ3MubGFiZWwgPSAiY2hhdCB3aXRoICIgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7DQp9JwCio+GZAb4NEGFiQ29yZU1lbnVBY3Rpb24CBACio+GZAcERrQNAaWYgKHRoYXQgJiYgdGhhdC5tZXNzYWdlKSB7DQogICAgaWYgKHRoYXQubWVzc2FnZSA9PSAnLnN0b3BIdW1lJykgew0KICAgICAgICB0aGlzQm90LmVuZEh1bWUoKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGxldCB1c2VybmFtZSA9IGF3YWl0IHRoaXNCb3QuZ2V0VXNlck5hbWUoKTsNCg0KICAgIGlmICghdGhpc0JvdC52YXJzLmh1bWVTb2NrZXQpIHsNCiAgICAgICAgc2V0VGFnTWFzayh0aGlzQm90LCAiYXdhaXRpbmdUZXh0Iiwge3VzZXI6IHVzZXJuYW1lLCBtZXNzYWdlOiB0aGF0Lm1lc3NhZ2V9KTsNCiAgICAgICAgYXdhaXQgdGhpc0JvdC5zdGFydEh1bWUoKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzQm90LnRleHRSZXNwb25zZSh7dXNlcjogdXNlcm5hbWUsIG1lc3NhZ2U6IHRoYXQubWVzc2FnZX0pOw0KICAgIH0NCn0nAKKj4ZkBvg0Jc3RhcnRIdW1lAgQAoqPhmQHvFO0jQGNvbnN0IGVuZHBvaW50ID0gIndzczovL2FwaS5odW1lLmFpL3YwL2V2aS9jaGF0IjsNCmNvbnN0IGFjY2Vzc1Rva2VuID0gKGF3YWl0IGFpLmh1bWUuZ2V0QWNjZXNzVG9rZW4oKSkuYWNjZXNzVG9rZW47DQovL2NvbnN0IGNvbmZpZ0lEID0gImUwNGIwMmQ1LWNiNzgtNDI5Mi1hYmE0LWE5MTJkODkyNmRkZCI7DQpjb25zdCBjb25maWdJRCA9ICJmZjExMzNmYi0yYTI3LTRhOWMtODgwMS0yNThlY2Y3ZWIyYWEiOw0KDQpjb25zdCB1cmwgPSBuZXcgVVJMKGVuZHBvaW50KTsNCnVybC5zZWFyY2hQYXJhbXMuc2V0KCJhY2Nlc3NfdG9rZW4iLCBhY2Nlc3NUb2tlbik7DQp1cmwuc2VhcmNoUGFyYW1zLnNldCgiY29uZmlnX2lkIiwgY29uZmlnSUQpOw0KDQpjb25zdCBodW1lU29ja2V0ID0gbmV3IFdlYlNvY2tldCh1cmwudG9TdHJpbmcoKSk7DQp0aGlzQm90LnZhcnMuaHVtZVNvY2tldCA9IGh1bWVTb2NrZXQ7DQp0aGlzQm90LnZhcnMucGxheWluZ1F1ZXVlID0gZmFsc2U7DQoNCmNvbnN0IHNlc3Npb25fc2V0dGluZ3MgPSB7DQogICAgInR5cGUiOiAic2Vzc2lvbl9zZXR0aW5ncyIsDQogICAgInZhcmlhYmxlcyI6IHsNCiAgICAgICAgIm5hbWUiOiBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksDQogICAgICAgICJjYXRhbG9nX2Fza3MiOiBhd2FpdCB0aGlzQm90LmdldENhdGFsb2dBc2tzKCkNCiAgICB9DQp9Ow0KDQpodW1lU29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoJ29wZW4nLCAoZXZlbnQpID0+IHsNCiAgICBjb25zb2xlLndhcm4oIkh1bWUgU29ja2V0IG9wZW5lZDogIiwgZXZlbnQpOw0KDQogICAgdGhpc0JvdC5jbGVhclF1ZXVlcygpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImhhbmRSYWlzZWQiLCB0cnVlKTsNCg0KICAgIHRoaXNCb3QudmFycy5wbGF5SHVtZUF1ZGlvID0gdHJ1ZTsNCg0KICAgIC8vSWYgY29uc29sZSBpcyBub3Qgb3Blbiwgb3BlbiBjb25zb2xlDQogICAgaWYgKCFsaW5rcy5jb25zb2xlLm1hc2tzLm9wZW4pIHsNCiAgICAgICAgd2hpc3BlcihsaW5rcy5jb25zb2xlLCAic2hvd0NvbnNvbGUiKTsNCiAgICAgICAgbGlua3MuY29uc29sZS5tYXNrcy5vcGVuID0gdHJ1ZTsNCiAgICB9DQoNCiAgICBodW1lU29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoc2Vzc2lvbl9zZXR0aW5ncykpOw0KDQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAic2VudEluaXRDaHVuayIsIGZhbHNlKTsNCg0KICAgIG9zLmJlZ2luQXVkaW9SZWNvcmRpbmcoew0KICAgICAgICBzdHJlYW06IHRydWUsDQogICAgICAgIG1pbWVUeXBlOiAnYXVkaW8vd2F2Jw0KICAgIH0pOw0KDQogICAgb3MudG9hc3QoIkh1bWUgYWN0aXZlLi4uIik7DQogICAgc2hvdXQoIm9uSHVtZVNvY2tldE9wZW5lZCIpOw0KfSk7DQoNCmh1bWVTb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCAoZXZlbnQpID0+IHsNCiAgICBjb25zb2xlLndhcm4oIkh1bWUgU29ja2V0IGNsb3NlZDogIiwgZXZlbnQpOw0KICAgIHRoaXNCb3QuZW5kSHVtZSgpOw0KDQogICAgY29uc3QgbXV0ZUJvdCA9IGdldEJvdCgic3lzdGVtIiwgImFiLmFpLm11dGUiKTsNCiAgICBpZiAobXV0ZUJvdCAmJiAhbXV0ZUJvdC50YWdzLm11dGVkKSB7DQogICAgICAgIG11dGVCb3QuYWJDb3JlTWVudUFjdGlvbigpOw0KICAgIH0NCg0KICAgIHRhZ3MucmVjZW50VG9vbENhbGwgPSBudWxsOw0KDQogICAgb3MudG9hc3QoIkh1bWUgY2xvc2VkLi4uIik7DQogICAgLy8gc2hvdXQoIm9uSHVtZUNoYXRFbmRlZCIsIGV2ZW50KTsNCn0pOw0KDQpodW1lU29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBhc3luYyAoZXZlbnQpID0+IHsNCiAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTsNCg0KICAgIGlmIChkYXRhLnR5cGUgPT0gImF1ZGlvX291dHB1dCIpIHsNCiAgICAgICAgdGhpc0JvdC5xdWV1ZUF1ZGlvKGRhdGEuZGF0YSk7DQogICAgfQ0KICAgIGVsc2UgaWYgKGRhdGEudHlwZSA9PSAiYXNzaXN0YW50X21lc3NhZ2UiKSB7DQogICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2UuY29udGVudDsNCg0KICAgICAgICB0aGlzQm90LnF1ZXVlVGV4dChtZXNzYWdlKTsgDQogICAgICAgIA0KICAgIH0NCiAgICBlbHNlIGlmIChkYXRhLnR5cGUgPT0gImFzc2lzdGFudF9lbmQiKSB7DQogICAgICAgIC8vdGFncy50aGlua2luZyA9IHRydWU7DQogICAgfQ0KICAgIGVsc2UgaWYgKGRhdGEudHlwZSA9PSAiZXJyb3IiKSB7DQogICAgICAgIGNvbnNvbGUud2FybignZXJyb3I6ICcsIGRhdGEubWVzc2FnZSk7DQogICAgfQ0KICAgIGVsc2UgaWYgKGRhdGEudHlwZSA9PSAidXNlcl9tZXNzYWdlIikgew0KICAgICAgICBsZXQgdXNlcm5hbWUgPSBhd2FpdCB0aGlzQm90LmdldFVzZXJOYW1lKCk7DQogICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImhhbmRSYWlzZWQiLCB0cnVlKTsNCg0KICAgICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5tZXNzYWdlLmNvbnRlbnQ7DQoNCiAgICAgICAgaWYgKG1lc3NhZ2UpIHsNCiAgICAgICAgICAgIGFiLmxvZyh7DQogICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSwNCiAgICAgICAgICAgICAgICBuYW1lOiB1c2VybmFtZSwNCiAgICAgICAgICAgICAgICBzcGFjZTogInNoYXJlZCIsDQogICAgICAgICAgICAgICAgbWVzc2FnZU9yaWdpbjogY29uZmlnQm90LmlkLA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSBpZiAoZGF0YS50eXBlID09ICJ0b29sX2NhbGwiKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJUb29sIGNhbGxlZDogIiwgZGF0YS5uYW1lLCBkYXRhKTsNCiAgICAgICAgaWYgKHRhZ3MuZGVidWdNb2RlID09IHRydWUgJiYgZGF0YS5uYW1lICE9ICd0aGluaycpIHsNCiAgICAgICAgICAgIGFiLmxvZyh7DQogICAgICAgICAgICAgICAgbWVzc2FnZTogZGF0YS5uYW1lICsgJzogJyArIGRhdGEucGFyYW1ldGVycywNCiAgICAgICAgICAgICAgICBuYW1lOiBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksDQogICAgICAgICAgICAgICAgc3BhY2U6ICJzaGFyZWQiLA0KICAgICAgICAgICAgICAgIG1lc3NhZ2VPcmlnaW46IGNvbmZpZ0JvdC5pZCwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIHRhZ3MucmVjZW50VG9vbENhbGwgPSBkYXRhLnRvb2xfY2FsbF9pZDsNCiAgICAgICAgaWYgKGRhdGEubmFtZSA9PSAidGhpbmsiKSB7DQogICAgICAgICAgICBpZiAoSlNPTi5wYXJzZShkYXRhLnBhcmFtZXRlcnMpLm1lc3NhZ2UpIHsNCiAgICAgICAgICAgICAgICBhYi5sb2coeyBtZXNzYWdlOiBKU09OLnBhcnNlKGRhdGEucGFyYW1ldGVycykubWVzc2FnZSwgbmFtZTogYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LCBzcGFjZTogInNoYXJlZCIsIG1lc3NhZ2VPcmlnaW46IGNvbmZpZ0JvdC5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmIChkYXRhLm5hbWUgPT0gIm1ha2VUb0RvQm90Iikgew0KICAgICAgICAgICAgdGhpc0JvdC5tYWtlVG9Eb0JvdChkYXRhLnBhcmFtZXRlcnMpOw0KICAgICAgICAgICAgdGhpc0JvdC5zZW5kVG9vbENvbXBsZXRlTWVzc2FnZSgpOw0KICAgICAgICB9IGVsc2UgaWYgKGRhdGEubmFtZSA9PSAiY29tcGxldGVUb0RvcyIpIHsNCiAgICAgICAgICAgIHRoaXNCb3QuY29tcGxldGVUb0RvcygpOw0KICAgICAgICAgICAgdGhpc0JvdC5zZW5kVG9vbENvbXBsZXRlTWVzc2FnZSgpOw0KICAgICAgICB9ICBlbHNlIGlmIChkYXRhLm5hbWUgPT0gIm1ha2UiKSB7DQogICAgICAgICAgICB0aGlzQm90Lm1ha2VTb21ldGhpbmcoZGF0YS5wYXJhbWV0ZXJzKTsNCiAgICAgICAgICAgIHRoaXNCb3Quc2VuZFRvb2xDb21wbGV0ZU1lc3NhZ2UoKTsNCiAgICAgICAgfSAgZWxzZSBpZiAoZGF0YS5uYW1lID09ICJwdWxsRnJvbUNhdGFsb2ciKSB7DQogICAgICAgICAgICB0aGlzQm90LnB1bGxGcm9tQ2F0YWxvZyhkYXRhLnBhcmFtZXRlcnMpOw0KICAgICAgICAgICAgdGhpc0JvdC5zZW5kVG9vbENvbXBsZXRlTWVzc2FnZSgpOw0KICAgICAgICB9ICBlbHNlIGlmIChkYXRhLm5hbWUgPT0gImdldFNjZW5lRGF0YSIpIHsNCiAgICAgICAgICAgIHRoaXNCb3QuZ2V0U2NlbmVEYXRhKGRhdGEucGFyYW1ldGVycyk7DQogICAgICAgIH0gIGVsc2UgaWYgKGRhdGEubmFtZSA9PSAic2VlVXNlckZvY3VzIikgew0KICAgICAgICAgICAgdGhpc0JvdC5zZWVVc2VyRm9jdXMoZGF0YS5wYXJhbWV0ZXJzKTsNCiAgICAgICAgfSAgZWxzZSBpZiAoZGF0YS5uYW1lID09ICJjbGlja09uIikgew0KICAgICAgICAgICAgdGhpc0JvdC5haUNsaWNrKGRhdGEucGFyYW1ldGVycyk7DQogICAgICAgIH0gICANCiAgICB9DQogICAgZWxzZSBpZiAoZGF0YS50eXBlID09ICJ1c2VyX2ludGVycnVwdGlvbiIpIHsNCiAgICAgICAgdGhpc0JvdC5jbGVhclF1ZXVlcygpOw0KDQogICAgICAgIHRoaXNCb3QudmFycy5wbGF5SHVtZUF1ZGlvID0gdHJ1ZTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJ1bmV4cGVjdGVkIG1lc3NhZ2U6IiwgZGF0YS50eXBlLCBkYXRhKTsNCiAgICB9DQp9KTsnAKKj4ZkBvg0HZW5kSHVtZQIEAKKj4ZkB3TjCAkBjb25zdCBodW1lU29ja2V0ID0gdGhpc0JvdC52YXJzLmh1bWVTb2NrZXQ7DQoNCmNvbnN0IG5vdGlmQm90cyA9IGdldEJvdHMoImFiVm9pY2VOb3RpZmljYXRpb25Cb3QiLCB0cnVlKTsNCmRlc3Ryb3kobm90aWZCb3RzKTsNCg0KaWYoaHVtZVNvY2tldCkgew0KICAgIGh1bWVTb2NrZXQuY2xvc2UoMTAwMCwgJ1VzZXIgZW5kZWQgdGhlIGNoYXQnKTsNCiAgICBkZWxldGUgdGhpc0JvdC52YXJzLmh1bWVTb2NrZXQ7DQp9DQoNCnRyeSB7DQogICAgYXdhaXQgb3MuZW5kQXVkaW9SZWNvcmRpbmcoKTsNCn0gY2F0Y2goZSkgew0KICAgIGNvbnNvbGUud2FybihlKTsNCn0nAKKj4ZkBvg0JcXVldWVUZXh0AgQAoqPhmQGgO35AY29uc3QgdGV4dCA9IHRoYXQ7DQoNCnRoaXNCb3QubWFza3MudGV4dFF1ZXVlID0gdGhpc0JvdC5tYXNrcy50ZXh0UXVldWUgPyBbLi4udGhpc0JvdC5tYXNrcy50ZXh0UXVldWVdLmNvbmNhdCh0ZXh0KSA6IFt0ZXh0XTsnAKKj4ZkBvg0PcGxheVF1ZXVlZEF1ZGlvAgQAoqPhmQGfPNoNQGlmICh0aGlzQm90LnZhcnMucGxheWluZ1F1ZXVlKQ0Kew0KICAgIHJldHVybjsNCn0NCg0KdGhpc0JvdC52YXJzLnBsYXlpbmdRdWV1ZSA9IHRydWU7DQoNCndoaWxlICh0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWU/Lmxlbmd0aCA+IDApDQp7DQogICAgY29uc3QgYWN0aXZlQXVkaW8gPSB0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWVbMF07DQogICAgY29uc3QgYWN0aXZlVGV4dCA9IHRoaXNCb3QubWFza3MudGV4dFF1ZXVlWzBdOw0KDQogICAgdGhpc0JvdC5tYXNrcy5hdWRpb1F1ZXVlLnNwbGljZSgwLCAxKTsNCiAgICB0aGlzQm90Lm1hc2tzLnRleHRRdWV1ZS5zcGxpY2UoMCwxKTsNCg0KICAgIGxldCBzb3VuZElkID0gb3MucGxheVNvdW5kKGFjdGl2ZUF1ZGlvKTsNCiAgICB0aGlzQm90Lm1hc2tzLmFjdGl2ZVNvdW5kID0gc291bmRJZDsNCiAgICBpZiAoYWN0aXZlVGV4dCkgew0KICAgICAgICBhYi5sb2coeyBtZXNzYWdlOiBhY3RpdmVUZXh0LCBuYW1lOiBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksIHNwYWNlOiAic2hhcmVkIiwgbWVzc2FnZU9yaWdpbjogY29uZmlnQm90LmlkIH0pOw0KICAgIH0NCiAgICANCiAgICBhd2FpdCBvcy5zbGVlcCgoZ2V0RHVyYXRpb24oYWN0aXZlQXVkaW8pICogMTAwMCkpOw0KICAgIA0KICAgIHRoaXNCb3QubWFza3MuYWN0aXZlU291bmQgPSBudWxsOw0KfQ0KDQp0aGlzQm90LnZhcnMucGxheWluZ1F1ZXVlID0gbnVsbDsNCg0KZnVuY3Rpb24gYmFzZTY0VG9BcnJheUJ1ZmZlcihiYXNlNjQpIHsNCiAgICBjb25zdCBiaW5hcnlTdHJpbmcgPSBzZWxmLmF0b2IoYmFzZTY0LnNwbGl0KCcsJylbMV0pOw0KICAgIGNvbnN0IGJ5dGVzID0gVWludDhBcnJheS5mcm9tKGJpbmFyeVN0cmluZywgY2hhciA9PiBjaGFyLmNoYXJDb2RlQXQoMCkpOw0KICAgIHJldHVybiBieXRlcy5idWZmZXI7DQp9DQoNCmZ1bmN0aW9uIGdldFdhdkR1cmF0aW9uKGFycmF5QnVmZmVyKSB7DQogICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhhcnJheUJ1ZmZlcik7DQoNCiAgICAvLyBDaGVjayB0aGUgIlJJRkYiIGlkZW50aWZpZXINCiAgICBpZiAodmlldy5nZXRVaW50MzIoMCwgZmFsc2UpICE9PSAweDUyNDk0NjQ2KSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBXQVYgZmlsZSIpOw0KICAgIH0NCg0KICAgIC8vIENoZWNrIHRoZSAiV0FWRSIgaWRlbnRpZmllcg0KICAgIGlmICh2aWV3LmdldFVpbnQzMig4LCBmYWxzZSkgIT09IDB4NTc0MTU2NDUpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIFdBViBmaWxlIik7DQogICAgfQ0KDQogICAgLy8gR2V0IHRoZSBieXRlIHJhdGUgZnJvbSB0aGUgZm10IHN1YmNodW5rDQogICAgY29uc3QgYnl0ZVJhdGUgPSB2aWV3LmdldFVpbnQzMigyOCwgdHJ1ZSk7DQoNCiAgICAvLyBHZXQgdGhlIHRvdGFsIG51bWJlciBvZiBieXRlcyBpbiB0aGUgZGF0YSBzdWJjaHVuaw0KICAgIGNvbnN0IGRhdGFDaHVua1NpemUgPSB2aWV3LmdldFVpbnQzMig0MCwgdHJ1ZSk7DQoNCiAgICAvLyBDYWxjdWxhdGUgZHVyYXRpb24NCiAgICBjb25zdCBkdXJhdGlvbiA9IGRhdGFDaHVua1NpemUgLyBieXRlUmF0ZTsNCg0KICAgIHJldHVybiBkdXJhdGlvbjsNCn0NCg0KZnVuY3Rpb24gZ2V0RHVyYXRpb24oYmFzZTY0KSB7DQogICAgdmFyIGFyckJ1ZmZlciA9IGJhc2U2NFRvQXJyYXlCdWZmZXIoYmFzZTY0KTsNCiAgICByZXR1cm4gZ2V0V2F2RHVyYXRpb24oYXJyQnVmZmVyKTsNCn0nAKKj4ZkBvg0MdGV4dFJlc3BvbnNlAgQAoqPhmQH6SZMCQC8vIGxldCByZXNwb25zZSA9IGF3YWl0IGFpLmNoYXQocmVzcG9uc2VQcm9tcHQsIHsNCi8vICAgICBwcmVmZXJyZWRNb2RlbDogdGFncy5haU1vZGVsDQovLyB9KTsNCg0KY29uc3QgaHVtZVNvY2tldCA9IHRoaXNCb3QudmFycy5odW1lU29ja2V0Ow0KDQppZihodW1lU29ja2V0KSB7DQogICAgaHVtZVNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHsNCiAgICAgICAgInR5cGUiOiAidXNlcl9pbnB1dCIsDQogICAgICAgICJ0ZXh0IjogdGhhdC5tZXNzYWdlLA0KICAgIH0pKTsNCn0nAKKj4ZkBvg0TYWJDb3JlTWVudVNvcnRPcmRlcgIEAKKj4ZkBjkwEMTAwMScAoqPhmQG+DQxvbkF1ZGlvQ2h1bmsCBACio+GZAZNMqwdAY29uc3QgbXV0ZUJvdCA9IGdldEJvdCgic3lzdGVtIiwgImFiLmFpLm11dGUiKTsNCmxldCBhdWRpb0RhdGE7DQppZiAobXV0ZUJvdCAmJiBtdXRlQm90LnRhZ3MubXV0ZWQgJiYgdGFncy5zZW50SW5pdENodW5rKSB7DQogICAgY29uc3Qgc2lsZW5jZSA9IG5ldyBCbG9iKFtuZXcgVWludDhBcnJheSh0aGF0LnNpemUpXSwgeyB0eXBlOiAnYXVkaW8vd2F2JyB9KTsNCiAgICBhdWRpb0RhdGEgPSBhd2FpdCBibG9iVG9CYXNlNjQoc2lsZW5jZSk7DQp9IGVsc2Ugew0KICAgIGF1ZGlvRGF0YSA9IGF3YWl0IGJsb2JUb0Jhc2U2NCh0aGF0KTsNCn0NCg0Kc2V0VGFnTWFzayh0aGlzQm90LCAic2VudEluaXRDaHVuayIsIHRydWUpOw0KDQpjb25zdCBodW1lU29ja2V0ID0gdGhpc0JvdC52YXJzLmh1bWVTb2NrZXQ7DQoNCmNvbnN0IHBhY2tldEhhc2ggPSBjcnlwdG8uaGFzaCgnc2hhMScsICdoZXgnLCBhdWRpb0RhdGEpOw0KDQppZihodW1lU29ja2V0KSB7DQogICAgY29uc29sZS5sb2coInBhY2tldCBoZXJlIiwgcGFja2V0SGFzaCk7DQoNCiAgICBodW1lU29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAidHlwZSI6ICJhdWRpb19pbnB1dCIsDQogICAgICAgICJkYXRhIjogYXVkaW9EYXRhDQogICAgfSkpOw0KfQ0KDQphc3luYyBmdW5jdGlvbiBibG9iVG9CYXNlNjQoYmxvYikgew0KICAvLyBSZWFkIHRoZSBCbG9iIGFzIGFuIEFycmF5QnVmZmVyDQogIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICANCiAgLy8gQ29udmVydCB0aGUgQXJyYXlCdWZmZXIgdG8gYSBCYXNlNjQgc3RyaW5nDQogIGNvbnN0IGJhc2U2NFN0cmluZyA9IGJ5dGVzLnRvQmFzZTY0U3RyaW5nKG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyKSwgJ2F1ZGlvL3dhdicpOw0KICANCiAgcmV0dXJuIGJhc2U2NFN0cmluZzsNCn0nAKKj4ZkBvg0KcXVldWVBdWRpbwIEAKKj4ZkBv1PSAkBjb25zdCBiYXNlNjRBdWRpbyA9IHRoYXQ7DQoNCmNvbnN0IG1pbWVUeXBlID0gImF1ZGlvL3dhdiI7IC8vIEFkanVzdCBNSU1FIHR5cGUgYXMgbmVlZGVkDQpjb25zdCBkYXRhVVJMID0gYGRhdGE6JHttaW1lVHlwZX07YmFzZTY0LCR7YmFzZTY0QXVkaW99YDsNCg0KdGhpc0JvdC5tYXNrcy5hdWRpb1F1ZXVlID0gdGhpc0JvdC5tYXNrcy5hdWRpb1F1ZXVlID8gWy4uLnRoaXNCb3QubWFza3MuYXVkaW9RdWV1ZV0uY29uY2F0KGRhdGFVUkwpIDogW2RhdGFVUkxdOw0KDQovL3RoaXNCb3QucGxheVF1ZXVlZEF1ZGlvKCk7DQpzZXRUYWdNYXNrKHRoaXNCb3QsICJoYW5kUmFpc2VkIiwgdHJ1ZSk7JwCio+GZAb4NC2dldFVzZXJOYW1lAgQAoqPhmQGSVqUDQGxldCB1c2VybmFtZSA9ICJ1c2VyIjsNCg0KaWYgKGF1dGhCb3QgJiYgYXV0aEJvdC50YWdzLm5hbWUgJiYgYXV0aEJvdC50YWdzLm5hbWUgIT0gIiIpIHsNCiAgICB1c2VybmFtZSA9IGF1dGhCb3QudGFncy5uYW1lOw0KfSBlbHNlIGlmIChhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWUpIHsNCiAgICB1c2VybmFtZSA9IGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZTsNCn0gZWxzZSB7DQogICAgdXNlcm5hbWUgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsNCiAgICAgICAgdGl0bGU6ICJXaGF0IHdvdWxkIHlvdSBsaWtlIG1lIHRvIGNhbGwgeW91PyINCiAgICB9KTsNCiAgICBhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWUgPSB1c2VybmFtZTsNCn0NCg0KcmV0dXJuIHVzZXJuYW1lOycAoqPhmQG+DQphYklET3JpZ2luAgQAoqPhmQG4WQdhYlZvaWNlJwCio+GZAb4NDmFiQ29yZU1lbnVJY29uAgQAoqPhmQHAWQRjdWJlJwCio+GZAb4NA2FzawIEAKKj4ZkBxVko8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAoqPhmQG+DQxvbkJvdENoYW5nZWQCBACio+GZAexZwgpAaWYgKHRoYXQudGFncy5pbmNsdWRlcygiaGFuZFJhaXNlZCIpKSB7DQogICAgLy9jcmVhdGUgYm90IGFib3ZlIGFiIHdpdGggc3BlY2lhbCBjbGlja2FibGUgbGFiZWwNCiAgICANCiAgICBjb25zdCBhYkJvdCA9IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3Q7DQogICAgaWYgKCFhYkJvdCkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgaWYgKHRhZ3MuaGFuZFJhaXNlZCkgew0KICAgICAgICBjb25zdCBub3RpZkJvdHMgPSBnZXRCb3RzKCJhYlZvaWNlTm90aWZpY2F0aW9uQm90IiwgdHJ1ZSk7DQogICAgICAgIGRlc3Ryb3kobm90aWZCb3RzKTsNCiAgICAgICAgDQogICAgICAgIGNyZWF0ZSh7DQogICAgICAgICAgICB0cmFuc2Zvcm1lcjogZ2V0SUQoYWJCb3QpLA0KICAgICAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgICAgICBsaW5rcy52b2ljZS5jYWxsZWRPbih0aGlzQm90KTsNCiAgICAgICAgICAgIGAsDQogICAgICAgICAgICBuYW1lOiAiYWJWb2ljZU5vdGlmQm90IiwNCiAgICAgICAgICAgIHZvaWNlOiBnZXRMaW5rKHRoaXNCb3QpLA0KICAgICAgICAgICAgYWJWb2ljZU5vdGlmaWNhdGlvbkJvdDogdHJ1ZSwNCiAgICAgICAgICAgIFthYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uXTogdHJ1ZSwNCiAgICAgICAgICAgIFthYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uICsgJ1onXTogMSwNCiAgICAgICAgICAgIGZvcm06ICdzcHJpdGUnLA0KICAgICAgICAgICAgZm9jdXNhYmxlOiB0cnVlLA0KICAgICAgICAgICAgb25Gb2N1c0VudGVyOiBgQA0KICAgICAgICAgICAgICAgIGlmICh0aGF0LmJvdCA9PSB0aGlzQm90KSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXNCb3Qub25DbGljaygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGAsDQogICAgICAgICAgICBvcmllbnRhdGlvbk1vZGU6ICdiaWxsYm9hcmQnLA0KICAgICAgICAgICAgc3BhY2U6ICJ0ZW1wTG9jYWwiLA0KICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LXByb2QtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vNjRiZWI0MzktMTJiOS00MTU1LWIzODgtZGIwM2I3ZWMxYzljLzg5Mjk5ZDhjNThmOTdmODg1M2E5ZTg3ZDRhMDIwNzU3NDgzOWRiZWIzYzY2YjkyZWE2OTFkYjcxMGIzM2M1MTYnLA0KDQogICAgICAgIH0pDQogICAgfSBlbHNlIHsNCiAgICAgICAgY29uc3Qgbm90aWZCb3RzID0gZ2V0Qm90cygiYWJWb2ljZU5vdGlmaWNhdGlvbkJvdCIsIHRydWUpOw0KICAgICAgICBkZXN0cm95KG5vdGlmQm90cyk7DQogICAgfQ0KfScAoqPhmQG+DQdjb25zb2xlAgQAoqPhmQGvZCjwn5SXMjRiN2U2NmYtMGQ1Yi00MDY0LWJmNDgtYjU2MmI5ZTZlM2ViJwCio+GZAb4NCGNhbGxlZE9uAgQAoqPhmQHWZC1AZGVzdHJveSh0aGF0KTsNCg0KdGhpc0JvdC5wbGF5UXVldWVkQXVkaW8oKTsnAKKj4ZkBvg0Sb25IdW1lU29ja2V0T3BlbmVkAgQAoqPhmQGEZXpAaWYgKHRhZ3MuYXdhaXRpbmdUZXh0KSB7DQogICAgdGhpc0JvdC50ZXh0UmVzcG9uc2UodGFncy5hd2FpdGluZ1RleHQpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImF3YWl0aW5nVGV4dCIsIG51bGwpOw0KfScAoqPhmQG+DQtjbGVhclF1ZXVlcwIEAKKj4ZkB/2WAA0B0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUgJiYgdGhpc0JvdC5tYXNrcy5hdWRpb1F1ZXVlLmxlbmd0aCA+IDAgPyB0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUubGVuZ3RoID0gMSA6IG51bGw7DQp0aGlzQm90Lm1hc2tzLnRleHRRdWV1ZSAmJiB0aGlzQm90Lm1hc2tzLnRleHRRdWV1ZS5sZW5ndGggPiAwID8gdGhpc0JvdC5tYXNrcy50ZXh0UXVldWUubGVuZ3RoID0gMSA6IG51bGw7DQoNCm9zLmNhbmNlbFNvdW5kKHRoaXNCb3QubWFza3MuYWN0aXZlU291bmQpOw0KDQpjb25zdCBub3RpZkJvdHMgPSBnZXRCb3RzKCJhYlZvaWNlTm90aWZpY2F0aW9uQm90IiwgdHJ1ZSk7DQpkZXN0cm95KG5vdGlmQm90cyk7DQoNCnRoaXNCb3QubWFza3MuYWN0aXZlU291bmQgPSBudWxsOygAoqPhmQG+DQh0aGlua2luZwF4JwCio+GZAb4NC21ha2VUb0RvQm90AgQAoqPhmQGBaaEHQGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHRoYXQpOw0KDQpmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEuYm90cy5sZW5ndGg7ICsraSkgew0KICAgIGNvbnN0IGFiQXJ0aWZhY3RTaGFyZCA9IHsNCiAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgcHJvbXB0OiBkYXRhLmJvdHNbaV0ucHJvbXB0LA0KICAgICAgICAgICAgZWdnUGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogew0KICAgICAgICAgICAgICAgICAgICBkaW1lbnNpb246IGFiLmxpbmtzLnJlbWVtYmVyLmFiR3JpZEZvY3VzPy5kaW1lbnNpb24gPz8gdGFncy5kaW1lbnNpb24gPz8gJ2hvbWUnLA0KICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogew0KICAgICAgICAgICAgICAgICAgICAgICAgeDogYWIubGlua3MucmVtZW1iZXIuYWJHcmlkRm9jdXM/LnBvc2l0aW9uPy54ID8/IGRhdGEuYm90c1tpXS5sb2NhdGlvbj8ueCA/PyAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgeTogYWIubGlua3MucmVtZW1iZXIuYWJHcmlkRm9jdXM/LnBvc2l0aW9uPy54ID8/IGRhdGEuYm90c1tpXS5sb2NhdGlvbj8ueSA/PyAwDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGRlcGVuZGVuY2llczogWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGFza0lEOiAndG9Eb0JvdCcNCiAgICAgICAgICAgIH0NCiAgICAgICAgXQ0KICAgIH07DQogICAgYXdhaXQgYWIubGlua3MuYXJ0aWZhY3QuYWJDcmVhdGVBcnRpZmFjdFByb21pc2VCb3Qoew0KICAgICAgICBhYkFydGlmYWN0TmFtZTogJ3RvRG9Cb3QnLA0KICAgICAgICBhYkFydGlmYWN0SW5zdGFuY2VJRDogdXVpZCgpLA0KICAgICAgICBhYkFydGlmYWN0U2hhcmQsDQogICAgfSk7DQp9DQonAKKj4ZkBvg0OZ2V0Q2F0YWxvZ0Fza3MCBACio+GZAaNw+wZAY29uc3QgY2F0YWxvZ0FyciA9IFtdOw0KY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBhYi5saW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspDQp7DQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBpZiAoIWV4dGFudEJvdCkNCiAgICB7DQogICAgICAgIGNvbnN0IG9iaiA9IHsNCiAgICAgICAgICAgICJuYW1lIjogYWN0aXZlVG9vbGJveC50aXRsZSwNCiAgICAgICAgICAgICJpZCI6IGFjdGl2ZVRvb2xib3gubmFtZQ0KICAgICAgICB9DQogICAgICAgIGNhdGFsb2dBcnIucHVzaChvYmopOw0KICAgIH0NCn0NCg0KY29uc3QgbG9hZGVkVG9vbGJveGVzID0gZ2V0Qm90cygidG9vbF9hcnJheSIpOw0KZm9yIChsZXQgaiA9IDA7IGogPCBsb2FkZWRUb29sYm94ZXMubGVuZ3RoOyArK2opIHsNCiAgICBjb25zdCBhcnIgPSBsb2FkZWRUb29sYm94ZXNbal0udGFncy50b29sX2FycmF5ID8/IFtdOw0KICAgIGZvciAobGV0IGsgPSAwOyBrIDwgYXJyLmxlbmd0aDsgKytrKSB7DQogICAgICAgIGNvbnN0IG9iaiA9IHsNCiAgICAgICAgICAgICJuYW1lIjogYXJyW2tdLm5hbWUgPz8gYXJyW2tdLnRhcmdldEFCLA0KICAgICAgICAgICAgImlkIjogYXJyW2tdLnRhcmdldEFCDQogICAgICAgIH0NCiAgICAgICAgY2F0YWxvZ0Fyci5wdXNoKG9iaik7DQogICAgfQ0KfQ0KDQpyZXR1cm4gY2F0YWxvZ0FycjsnAKKj4ZkBvg0NbWFrZVNvbWV0aGluZwIEAKKj4ZkBn3dxQGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHRoYXQpOw0KaWYgKGRhdGEgJiYgZGF0YS5wcm9tcHQpIHsNCiAgICBhYi5saW5rcy5hc2suYWJDb3JlTWVudUFjdGlvbihkYXRhLnByb21wdCk7DQp9DQonAKKj4ZkBvg0PcHVsbEZyb21DYXRhbG9nAgQAoqPhmQGReOMNQGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHRoYXQpOw0KaWYgKCFhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzKSB7DQogIGNvbnN0IGdyaWREYXRhID0gew0KICAgICAgZGltZW5zaW9uOiBhYlJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb24gPz8gJ2hvbWUnLCANCiAgICAgIHBvc2l0aW9uOiB7DQogICAgICAgICAgeDogMCwNCiAgICAgICAgICB5OiAwDQogICAgICB9DQogIH0NCiAgYWIubGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cyA9IGdyaWREYXRhOw0KfQ0KaWYgKGRhdGEgJiYgZGF0YS5hc2spIHsNCiAgaWYgKGRhdGEuYXNrLmluY2x1ZGVzKCJ0b29sYm94IikpIHsNCiAgICBjb25zdCB0b29sYm94RGF0YSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheS5maW5kKHRvb2xCb3ggPT4gdG9vbEJveC5uYW1lID09IGRhdGEuYXNrKTsNCiAgICBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdG9vbGJveERhdGEsIGdyaWREYXRhOiBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzfSk7DQogIH0gZWxzZSB7DQogICAgbGV0IGlzQXJ0aWZhY3QgPSBmYWxzZTsNCiAgICBjb25zdCB0b29sYm94ID0gZ2V0Qm90KGJ5VGFnKCJ0b29sX2FycmF5IiwgdG9vbF9hcnIgPT4gew0KICAgICAgaWYgKHRvb2xfYXJyLmZpbmQodG9vbCA9PiB0b29sLnRhcmdldEFCID09IGRhdGEuYXNrKSkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH19DQogICAgKSk7DQogICAgaWYgKHRvb2xib3gpIHsNCiAgICAgIGlzQXJ0aWZhY3QgPSB0b29sYm94LnRhZ3MudG9vbF9hcnJheS5maW5kKHRvb2wgPT4gdG9vbC50YXJnZXRBQiA9PSBkYXRhLmFzayk/LmFydGlmYWN0Ow0KICAgIH0NCg0KICAgIGlmIChpc0FydGlmYWN0KSB7DQogICAgICBjb25zdCBhYkFydGlmYWN0U2hhcmQgPSB7DQogICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiBudWxsLA0KICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgIGRlcGVuZGVuY2llczogWw0KICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICBhc2tJRDogZGF0YS5hc2sNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIF0NCiAgICAgIH07DQogICAgICBhYi5saW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0UHJvbWlzZUJvdCh7DQogICAgICAgICAgYWJBcnRpZmFjdE5hbWU6IGRhdGEuYXNrLA0KICAgICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgICAgYWJBcnRpZmFjdFNoYXJkLA0KICAgICAgfSk7DQogICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICB9IGVsc2Ugew0KICAgICAgYWIubGlua3Muc2VhcmNoLm9uTG9va3VwQXNrSUQoew0KICAgICAgICAgIGFza0lEOiBkYXRhLmFzaywNCiAgICAgICAgICBzb3VyY2VFdmVudDogJ3Rvb2wnLA0KICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgdG9vbGJveEJvdDogbnVsbCwNCiAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzDQogICAgICAgICAgfSwNCiAgICAgIH0pOw0KICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsNCiAgICB9DQogIH0NCn0nAKKj4ZkBvg0Ob25BbnlCb3RzQWRkZWQCBACio+GZAfWFAeMDQGZvciAobGV0IGkgPSAwOyBpIDwgdGhhdC5ib3RzLmxlbmd0aDsgKytpKSB7DQogICAgaWYgKHRoYXQuYm90c1tpXS50YWdzLnRvb2xfYXJyYXkpIHsNCiAgICAgICAgY29uc3QgaHVtZVNvY2tldCA9IHRoaXNCb3QudmFycy5odW1lU29ja2V0Ow0KDQogICAgICAgIGlmKGh1bWVTb2NrZXQpIHsNCiAgICAgICAgICAgIGh1bWVTb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICAgICAgInR5cGUiOiAic2Vzc2lvbl9zZXR0aW5ncyIsDQogICAgICAgICAgICAgICAgInZhcmlhYmxlcyI6IHsNCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHksDQogICAgICAgICAgICAgICAgICAgICJjYXRhbG9nX2Fza3MiOiBhd2FpdCB0aGlzQm90LmdldENhdGFsb2dBc2tzKCkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KSk7DQogICAgICAgIH0NCiAgICB9DQp9JwCio+GZAb4NF3NlbmRUb29sQ29tcGxldGVNZXNzYWdlAgQAoqPhmQHZiQGDAkBjb25zdCBjb21wbGV0ZV9zZXR0aW5ncyA9IHsNCiAgICAidHlwZSI6ICJ0b29sX3Jlc3BvbnNlIiwNCiAgICAidG9vbF9jYWxsX2lkIjogdGFncy5yZWNlbnRUb29sQ2FsbCwNCiAgICAiY29udGVudCI6ICJjb21wbGV0ZWQiDQp9Ow0KDQpjb25zdCBodW1lU29ja2V0ID0gdGhpc0JvdC52YXJzLmh1bWVTb2NrZXQ7DQoNCmlmKGh1bWVTb2NrZXQpIHsNCiAgICBodW1lU29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoY29tcGxldGVfc2V0dGluZ3MpKTsNCn0nAKKj4ZkBvg0HbWFuYWdlcgIEAKKj4ZkB3YsBKPCflJcxM2YzM2E1MS1jMmZhLTQ2ZGEtYTg4ZS1lNWMwNjc1NTZkMDInAKKj4ZkBvg0MZ2V0U2NlbmVEYXRhAgQAoqPhmQGEjAGJBUBjb25zdCBib3RzID0gZ2V0Qm90cyhieVRhZyhhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uLCB0cnVlKSwgbm90KGJ5VGFnKCJhYklnbm9yZSIsIHRydWUpKSwgbm90KGJ5VGFnKCJhYkJvdCIsIHRydWUpKSk7DQoNCmNvbnN0IHRvb2xfcmVzcG9uc2UgPSB7DQogICAgInR5cGUiOiAidG9vbF9yZXNwb25zZSIsDQogICAgInRvb2xfY2FsbF9pZCI6IHRhZ3MucmVjZW50VG9vbENhbGwsDQogICAgImNvbnRlbnQiOiBKU09OLnN0cmluZ2lmeShib3RzKQ0KfTsNCg0KY29uc29sZS5sb2coIlNjZW5lIERhdGEgU2VudDogIiwgYm90cykNCmlmICh0YWdzLmRlYnVnTW9kZSA9PSB0cnVlKSB7DQogICAgYWIubG9nKHsNCiAgICAgICAgbWVzc2FnZTogIlNjZW5lIERhdGEgU2VudDogIiArIEpTT04uc3RyaW5naWZ5KGJvdHMpLA0KICAgICAgICBuYW1lOiAnY2FzdWFsb3MnLA0KICAgICAgICBzcGFjZTogInNoYXJlZCIsDQogICAgICAgIG1lc3NhZ2VPcmlnaW46IGNvbmZpZ0JvdC5pZCwNCiAgICB9KTsNCn0NCg0KY29uc3QgaHVtZVNvY2tldCA9IHRoaXNCb3QudmFycy5odW1lU29ja2V0Ow0KDQppZihodW1lU29ja2V0KSB7DQogICAgaHVtZVNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHRvb2xfcmVzcG9uc2UpKTsNCn0nAKKj4ZkBvg0Mc2VlVXNlckZvY3VzAgQAoqPhmQGOkQHEBUBjb25zdCBmb2N1cyA9IGFiLmxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyA/PyBhYi5saW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzID8/IGFiLmxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiR3JpZEZvY3VzID8/IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMgPz8gbnVsbA0KDQpjb25zdCB0b29sX3Jlc3BvbnNlID0gew0KICAgICJ0eXBlIjogInRvb2xfcmVzcG9uc2UiLA0KICAgICJ0b29sX2NhbGxfaWQiOiB0YWdzLnJlY2VudFRvb2xDYWxsLA0KICAgICJjb250ZW50IjogSlNPTi5zdHJpbmdpZnkoZm9jdXMpDQp9Ow0KDQpjb25zdCBodW1lU29ja2V0ID0gdGhpc0JvdC52YXJzLmh1bWVTb2NrZXQ7DQoNCmNvbnNvbGUubG9nKCJVc2VyIEZvY3VzIERhdGEgU2VudDogIiwgZm9jdXMpDQppZiAodGFncy5kZWJ1Z01vZGUgPT0gdHJ1ZSkgew0KICAgIGFiLmxvZyh7DQogICAgICAgIG1lc3NhZ2U6ICJVc2VyIEZvY3VzIERhdGEgU2VudDogIiArIEpTT04uc3RyaW5naWZ5KGZvY3VzKSwNCiAgICAgICAgbmFtZTogJ2Nhc3VhbG9zJywNCiAgICAgICAgc3BhY2U6ICJzaGFyZWQiLA0KICAgICAgICBtZXNzYWdlT3JpZ2luOiBjb25maWdCb3QuaWQsDQogICAgfSk7DQp9DQoNCmlmKGh1bWVTb2NrZXQpIHsNCiAgICBodW1lU29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkodG9vbF9yZXNwb25zZSkpOw0KfScAoqPhmQG+DQdhaUNsaWNrAgQAoqPhmQHTlgF7QGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHRoYXQpOw0KDQppZiAoIWRhdGEgfHwgIWRhdGEuYm90KSB7DQogICAgcmV0dXJuOw0KfQ0KDQp3aGlzcGVyKGdldEJvdChieUlEKGRhdGEuYm90KSksICJvbkNsaWNrIik7JwCio+GZAb4NCWRlYnVnTW9kZQIEAKKj4ZkBz5cBBWZhbHNlJwCio+GZAb4NDWNvbXBsZXRlVG9Eb3MCBACio+GZAdWXAbQOQGNvbnN0IHRvRG9Cb3RzID0gZ2V0Qm90cygidG9EbyIsIHRydWUpOw0KbGV0IGFnZW50Qm90ID0gZ2V0Qm90KCJhZ2VudF9ib3RfdG9vbCIsIHRydWUpOw0KaWYgKCFhZ2VudEJvdCkgew0KICAgIC8vY3JlYXRlIGFnZW50IGJvdA0KICAgIGF3YWl0IGFiLmxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsNCiAgICAgICAgYXNrSUQ6ICdhZ2VudF9ib3RfdG9vbCcsDQogICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogew0KICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA/PyAnaG9tZScsDQogICAgICAgICAgICAgICAgcG9zaXRpb246IHsNCiAgICAgICAgICAgICAgICAgICAgeDogMSwNCiAgICAgICAgICAgICAgICAgICAgeTogMA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBhaU1vZGVsOiBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJQcmVmZXJyZWRBSU1vZGVsLA0KICAgICAgICB9DQogICAgfSkNCiAgICBhZ2VudEJvdCA9IGdldEJvdCgiYWdlbnRfYm90X3Rvb2wiLCB0cnVlKTsNCn0NCg0KaWYgKCFhZ2VudEJvdCkgew0KICAgIG9zLnRvYXN0KCJjb3VsZCBub3QgZmluZCBvciBjcmVhdGUgYWkgYWdlbnQiKTsNCiAgICByZXR1cm47DQp9DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgdG9Eb0JvdHMubGVuZ3RoOyArK2kpIHsNCiAgICBjb25zdCBwcm9tcHQgPSB0b0RvQm90c1tpXS50YWdzLnByb21wdDsNCiAgICBpZiAoIXByb21wdCkgew0KICAgICAgICBjb250aW51ZTsNCiAgICB9DQoNCiAgICBjb25zdCB4UG9zID0gdG9Eb0JvdHNbaV0udGFnc1t0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiArICdYJ107DQogICAgY29uc3QgeVBvcyA9IHRvRG9Cb3RzW2ldLnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWSddOw0KDQogICAgbGlua3MuYXJtX3Rvb2wuYWJDcmVhdGVBcm0oew0KICAgICAgICBvcmlnaW5Cb3Q6IGFnZW50Qm90LA0KICAgICAgICBkaW1lbnNpb246IHRvRG9Cb3RzW2ldLnRhZ3MuZGltZW5zaW9uLA0KICAgICAgICBwb3NpdGlvbjogew0KICAgICAgICAgICAgeDogeFBvcywNCiAgICAgICAgICAgIHk6IHlQb3MsDQogICAgICAgICAgICB6OiAwDQogICAgICAgIH0NCiAgICB9KQ0KICAgIGF3YWl0IG9zLnNsZWVwKDEwMDApOw0KDQogICAgY29uc3QgcmVxdWVzdERhdGEgPSB7fTsNCiAgICBpZiAoYWdlbnRCb3QubGlua3MuYXJtQm90KSB7DQogICAgICAgIGNvbnN0IGFybUJvdCA9IGFnZW50Qm90LmxpbmtzLmFybUJvdDsNCiAgICAgICAgY29uc3QgYXJtRGltZW5zaW9uID0gYXJtQm90LnRhZ3MuZGltZW5zaW9uOw0KDQogICAgICAgIHJlcXVlc3REYXRhLmFybURpbWVuc2lvbiA9IGFybURpbWVuc2lvbjsNCiAgICAgICAgcmVxdWVzdERhdGEuYXJtRGltZW5zaW9uWCA9IGFybUJvdC50YWdzW2FybURpbWVuc2lvbiArICJYIl07DQogICAgICAgIHJlcXVlc3REYXRhLmFybURpbWVuc2lvblkgPSBhcm1Cb3QudGFnc1thcm1EaW1lbnNpb24gKyAiWSJdOw0KICAgIH0NCg0KICAgIGFnZW50Qm90Lm1hc2tzLnRhcmdldEJvdCA9IGdldExpbmsodG9Eb0JvdHNbaV0pOw0KICAgIGFnZW50Qm90Lm1hc2tzLnByb21wdFR5cGUgPSAnZ3JpZCc7DQogICAgYWdlbnRCb3QuYWdlbnRPblJlcXVlc3Qoew0KICAgICAgICBpbnF1aXJ5OiBwcm9tcHQsDQogICAgICAgIGRhdGE6IHJlcXVlc3REYXRhLCANCiAgICAgICAgbW9kZWw6IGFnZW50Qm90LnRhZ3MuYWlNb2RlbA0KICAgIH0pOw0KDQogICAgZGVzdHJveSh0b0RvQm90c1tpXSk7DQoNCiAgICBhd2FpdCBvcy5zbGVlcCgxMDAwKTsNCn0nAKKj4ZkBvg0IYXJtX3Rvb2wCBACio+GZAYqmASjwn5SXM2M3NGM5ZjEtODJkYy00NjU1LThiMzgtZTdmMTFkZTg5NzhlJwCio+GZAb4NCmhhbmRSYWlzZWQCBACio+GZAbGmAQVmYWxzZScAoqPhmQG+DQ9vbkFCSW5pdGlhbGl6ZWQCBACio+GZAbemARhAdGFncy5kZWJ1Z01vZGUgPSBmYWxzZTsnAKKj4ZkBvg0HYWJWb2ljZQIEAKKj4ZkB0KYBBHRydWUnAKKj4ZkBvg0JYWJWZXJzaW9uAgQAoqPhmQHVpgEFMTAuNDIA"}]}