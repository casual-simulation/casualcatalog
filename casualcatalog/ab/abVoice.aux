{"version":2,"updates":[{"id":0,"timestamp":1772136842382,"update":"AYUB0vaQuQ8AJwEEYm90cyQwN2NmZTg5NS0zYWVlLTQwYjYtODFlYS01M2ZkNTBiMzFjZDkBJwDS9pC5DwAGc3lzdGVtAgQA0vaQuQ8BCmFiLmFpLm11dGUnANL2kLkPABBhYkNvcmVNZW51QWN0aW9uAgQA0vaQuQ8MmgRAc2V0VGFnTWFzayh0aGlzQm90LCAibXV0ZWQiLCAhdGFncy5tdXRlZCk7DQoNCmNvbnN0IG1lbnVCb3QgPSBnZXRCb3QoYnlUYWcoImJhc2VTa2lsbCIsICfwn5SXJyArIGdldElEKHRoaXNCb3QpKSwgYnlUYWcoImFiTWVudSIsIHRydWUpKTsNCmlmIChtZW51Qm90KSB7DQogICAgaWYgKHRhZ3MubXV0ZWQpIHsNCiAgICAgICAgbWVudUJvdC50YWdzLmxhYmVsID0gInVubXV0ZSI7DQogICAgICAgIG1lbnVCb3QudGFncy5mb3JtQWRkcmVzcyA9ICdtaWNfb2ZmJzsNCiAgICB9IGVsc2Ugew0KICAgICAgICBtZW51Qm90LnRhZ3MubGFiZWwgPSAibXV0ZSI7DQogICAgICAgIG1lbnVCb3QudGFncy5mb3JtQWRkcmVzcyA9ICdtaWMnOw0KICAgICAgICANCiAgICAgICAgY29uc3Qgdm9pY2VCb3QgPSBnZXRCb3QoInN5c3RlbSIsICJhYi5haS52b2ljZSIpOw0KICAgICAgICBpZiAodm9pY2VCb3QgJiYgIXZvaWNlQm90LnZhcnMuaHVtZVNvY2tldCkgew0KICAgICAgICAgICAgdm9pY2VCb3Quc3RhcnRIdW1lKCk7DQogICAgICAgIH0NCiAgICB9DQp9KADS9pC5DwAFbXV0ZWQBeCcA0vaQuQ8ADmFiQ29yZU1lbnVJY29uAgQA0vaQuQ+mBAdtaWNfb2ZmJwDS9pC5DwAPYWJDb3JlTWVudUxhYmVsAgQA0vaQuQ+uBAZ1bm11dGUnANL2kLkPAAVsYWJlbAIEANL2kLkPtQQEbXV0ZScA0vaQuQ8AC2Zvcm1BZGRyZXNzAgQA0vaQuQ+6BANtaWMnANL2kLkPABNhYkNvcmVNZW51U29ydE9yZGVyAgQA0vaQuQ++BAQxMDAwJwDS9pC5DwAYYWJDb3JlTWVudU9uQmVmb3JlQ3JlYXRlAgQA0vaQuQ/DBLEBQGlmICh0YWdzLm11dGVkKSB7DQogICAgdGFncy5hYkNvcmVNZW51TGFiZWwgPSAidW5tdXRlIjsNCiAgICB0YWdzLmFiQ29yZU1lbnVJY29uID0gJ21pY19vZmYnOw0KfSBlbHNlIHsNCiAgICB0YWdzLmFiQ29yZU1lbnVMYWJlbCA9ICJtdXRlIjsNCiAgICB0YWdzLmFiQ29yZU1lbnVJY29uID0gJ21pYyc7DQp9JwDS9pC5DwAKYWJJRE9yaWdpbgIEANL2kLkP9QUHYWJWb2ljZScA0vaQuQ8AB2FiVm9pY2UCBADS9pC5D/0FBHRydWUnANL2kLkPAAlhYlZlcnNpb24CBADS9pC5D4IGBTEwLjQzJwEEYm90cyQyNTdiZTMzNy1mMGExLTQxOTItYmU5Ny0zNzczZmFlMjgyY2IBJwDS9pC5D4gGB2NyZWF0b3ICBADS9pC5D4kGJDM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycA0vaQuQ+IBgZzeXN0ZW0CBADS9pC5D64GD2FiLmFpLmF1dG9TcGVhaycA0vaQuQ+IBg5hYkNvcmVNZW51SWNvbgIEANL2kLkPvgYHbWljX29mZicA0vaQuQ+IBhBhYkNvcmVNZW51QWN0aW9uAgQA0vaQuQ/GBs4DQHNldFRhZ01hc2sodGhpc0JvdCwgImF1dG9TcGVhayIsICF0YWdzLmF1dG9TcGVhayk7DQoNCmNvbnN0IG1lbnVCb3QgPSBnZXRCb3QoYnlUYWcoImJhc2VTa2lsbCIsICfwn5SXJyArIGdldElEKHRoaXNCb3QpKSwgYnlUYWcoImFiTWVudSIsIHRydWUpKTsNCmlmIChtZW51Qm90KSB7DQogICAgaWYgKCF0YWdzLmF1dG9TcGVhaykgew0KICAgICAgICBtZW51Qm90LnRhZ3MubGFiZWwgPSAidW5tdXRlICIgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7DQogICAgICAgIG1lbnVCb3QudGFncy5mb3JtQWRkcmVzcyA9ICdtaWNfb2ZmJzsNCiAgICB9IGVsc2Ugew0KICAgICAgICBtZW51Qm90LnRhZ3MubGFiZWwgPSAibXV0ZSAiICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Ow0KICAgICAgICBtZW51Qm90LnRhZ3MuZm9ybUFkZHJlc3MgPSAnbWljJzsNCiAgICB9DQp9JwDS9pC5D4gGGGFiQ29yZU1lbnVPbkJlZm9yZUNyZWF0ZQIEANL2kLkPkwqGAkBpZiAoIXRhZ3MuYXV0b1NwZWFrKSB7DQogICAgdGFncy5hYkNvcmVNZW51TGFiZWwgPSAidW5tdXRlICIgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7DQogICAgdGFncy5hYkNvcmVNZW51SWNvbiA9ICdtaWNfb2ZmJzsNCn0gZWxzZSB7DQogICAgdGFncy5hYkNvcmVNZW51TGFiZWwgPSAibXV0ZSAiICsgYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5Ow0KICAgIHRhZ3MuYWJDb3JlTWVudUljb24gPSAnbWljJzsNCn0nANL2kLkPiAYPYWJDb3JlTWVudUxhYmVsAgQA0vaQuQ+aDBF1bm11dGUgY2FzdWFsLmJvdCcA0vaQuQ+IBhNhYkNvcmVNZW51U29ydE9yZGVyAgQA0vaQuQ+sDAM5OTkoANL2kLkPiAYJYXV0b1NwZWFrAXknANL2kLkPiAYLb25BbnlDcmVhdGUCBADS9pC5D7EMcUBpZiAodGhhdC5ib3QudGFncy5uYW1lID09ICJhYlZvaWNlTm90aWZCb3QiKSB7DQogICAgaWYgKHRhZ3MuYXV0b1NwZWFrKSB7DQogICAgICAgIHRoYXQuYm90Lm9uQ2xpY2soKTsNCiAgICB9DQp9JwDS9pC5D4gGCmFiSURPcmlnaW4CBADS9pC5D6MNB2FiVm9pY2UnANL2kLkPiAYHYWJWb2ljZQIEANL2kLkPqw0EdHJ1ZScA0vaQuQ+IBglhYlZlcnNpb24CBADS9pC5D7ANBTEwLjQzJwEEYm90cyQ5OWVhNTg2ZC00MjJiLTQ2MmMtYjBkZi1hZTFjYjQwODIxNTEBJwDS9pC5D7YNBnN5c3RlbQIEANL2kLkPtw0LYWIuYWkudm9pY2UnANL2kLkPtg0UYWJDb3JlTWVudU9uR2VuZXJhdGUCBADS9pC5D8MN9QNAdGFncy5vblN1Ym1pdCA9IGBADQogICAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogImNvcmUifSk7DQogICAgbWFza3MubWVudUl0ZW1UZXh0ID0gIiI7DQpgOw0KDQp0YWdzLmZvcm0gPSAiaW5wdXQiOw0KDQppZiAoIWF1dGhCb3QpDQp7DQogICAgdGFncy5sYWJlbCA9ICJ5b3UgbXVzdCBiZSBsb2dnZWQgaW4gdG8gY2hhdCB3aXRoICIgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHk7DQp9DQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKQ0Kew0KICAgIHRhZ3MubGFiZWwgPSAiY2hhdCB3aXRoICIgKyBhYlBlcnNvbmFsaXR5LnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7DQp9DQplbHNlDQp7DQogICAgdGFncy5sYWJlbCA9ICJjaGF0IHdpdGggIiArIGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsNCn0nANL2kLkPtg0QYWJDb3JlTWVudUFjdGlvbgIEANL2kLkPuRGtA0BpZiAodGhhdCAmJiB0aGF0Lm1lc3NhZ2UpIHsNCiAgICBpZiAodGhhdC5tZXNzYWdlID09ICcuc3RvcEh1bWUnKSB7DQogICAgICAgIHRoaXNCb3QuZW5kSHVtZSgpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgbGV0IHVzZXJuYW1lID0gYXdhaXQgdGhpc0JvdC5nZXRVc2VyTmFtZSgpOw0KDQogICAgaWYgKCF0aGlzQm90LnZhcnMuaHVtZVNvY2tldCkgew0KICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhd2FpdGluZ1RleHQiLCB7dXNlcjogdXNlcm5hbWUsIG1lc3NhZ2U6IHRoYXQubWVzc2FnZX0pOw0KICAgICAgICBhd2FpdCB0aGlzQm90LnN0YXJ0SHVtZSgpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXNCb3QudGV4dFJlc3BvbnNlKHt1c2VyOiB1c2VybmFtZSwgbWVzc2FnZTogdGhhdC5tZXNzYWdlfSk7DQogICAgfQ0KfScA0vaQuQ+2DQlzdGFydEh1bWUCBADS9pC5D+cUniVAY29uc3QgZW5kcG9pbnQgPSAid3NzOi8vYXBpLmh1bWUuYWkvdjAvZXZpL2NoYXQiOw0KY29uc3QgYWNjZXNzVG9rZW4gPSAoYXdhaXQgYWkuaHVtZS5nZXRBY2Nlc3NUb2tlbigpKS5hY2Nlc3NUb2tlbjsNCi8vY29uc3QgY29uZmlnSUQgPSAiZTA0YjAyZDUtY2I3OC00MjkyLWFiYTQtYTkxMmQ4OTI2ZGRkIjsNCmNvbnN0IGNvbmZpZ0lEID0gImZmMTEzM2ZiLTJhMjctNGE5Yy04ODAxLTI1OGVjZjdlYjJhYSI7DQoNCmNvbnN0IHVybCA9IG5ldyBVUkwoZW5kcG9pbnQpOw0KdXJsLnNlYXJjaFBhcmFtcy5zZXQoImFjY2Vzc190b2tlbiIsIGFjY2Vzc1Rva2VuKTsNCnVybC5zZWFyY2hQYXJhbXMuc2V0KCJjb25maWdfaWQiLCBjb25maWdJRCk7DQoNCmNvbnN0IGh1bWVTb2NrZXQgPSBuZXcgV2ViU29ja2V0KHVybC50b1N0cmluZygpKTsNCnRoaXNCb3QudmFycy5odW1lU29ja2V0ID0gaHVtZVNvY2tldDsNCnRoaXNCb3QudmFycy5wbGF5aW5nUXVldWUgPSBmYWxzZTsNCg0KY29uc3Qgc2Vzc2lvbl9zZXR0aW5ncyA9IHsNCiAgICAidHlwZSI6ICJzZXNzaW9uX3NldHRpbmdzIiwNCiAgICAidmFyaWFibGVzIjogew0KICAgICAgICAibmFtZSI6IGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwNCiAgICAgICAgImNhdGFsb2dfYXNrcyI6IGF3YWl0IHRoaXNCb3QuZ2V0Q2F0YWxvZ0Fza3MoKQ0KICAgIH0NCn07DQoNCmh1bWVTb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignb3BlbicsIChldmVudCkgPT4gew0KICAgIGNvbnNvbGUud2FybigiSHVtZSBTb2NrZXQgb3BlbmVkOiAiLCBldmVudCk7DQoNCiAgICB0aGlzQm90LmNsZWFyUXVldWVzKCk7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiaGFuZFJhaXNlZCIsIGZhbHNlKTsNCg0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImxhdGVzdElucXVpcnkiLCBudWxsKTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJsYXRlc3RJbnF1aXJ5SUQiLCBudWxsKTsNCg0KICAgIHRoaXNCb3QudmFycy5wbGF5SHVtZUF1ZGlvID0gdHJ1ZTsNCg0KICAgIC8vSWYgY29uc29sZSBpcyBub3Qgb3Blbiwgb3BlbiBjb25zb2xlDQogICAgaWYgKCFsaW5rcy5jb25zb2xlLm1hc2tzLm9wZW4pIHsNCiAgICAgICAgd2hpc3BlcihsaW5rcy5jb25zb2xlLCAic2hvd0NvbnNvbGUiKTsNCiAgICAgICAgbGlua3MuY29uc29sZS5tYXNrcy5vcGVuID0gdHJ1ZTsNCiAgICB9DQoNCiAgICBodW1lU29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoc2Vzc2lvbl9zZXR0aW5ncykpOw0KDQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAic2VudEluaXRDaHVuayIsIGZhbHNlKTsNCg0KICAgIG9zLmJlZ2luQXVkaW9SZWNvcmRpbmcoew0KICAgICAgICBzdHJlYW06IHRydWUsDQogICAgICAgIG1pbWVUeXBlOiAnYXVkaW8vd2F2Jw0KICAgIH0pOw0KDQogICAgb3MudG9hc3QoIkh1bWUgYWN0aXZlLi4uIik7DQogICAgc2hvdXQoIm9uSHVtZVNvY2tldE9wZW5lZCIpOw0KfSk7DQoNCmh1bWVTb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCAoZXZlbnQpID0+IHsNCiAgICBjb25zb2xlLndhcm4oIkh1bWUgU29ja2V0IGNsb3NlZDogIiwgZXZlbnQpOw0KICAgIHRoaXNCb3QuZW5kSHVtZSgpOw0KDQogICAgY29uc3QgbXV0ZUJvdCA9IGdldEJvdCgic3lzdGVtIiwgImFiLmFpLm11dGUiKTsNCiAgICBpZiAobXV0ZUJvdCAmJiAhbXV0ZUJvdC50YWdzLm11dGVkKSB7DQogICAgICAgIG11dGVCb3QuYWJDb3JlTWVudUFjdGlvbigpOw0KICAgIH0NCg0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImxhdGVzdElucXVpcnkiLCBudWxsKTsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJsYXRlc3RJbnF1aXJ5SUQiLCBudWxsKTsNCg0KICAgIG9zLnRvYXN0KCJIdW1lIGNsb3NlZC4uLiIpOw0KICAgIC8vIHNob3V0KCJvbkh1bWVDaGF0RW5kZWQiLCBldmVudCk7DQp9KTsNCg0KaHVtZVNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgYXN5bmMgKGV2ZW50KSA9PiB7DQogICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7DQoNCiAgICBpZiAoZGF0YS50eXBlID09ICJhdWRpb19vdXRwdXQiKSB7DQogICAgICAgIHRoaXNCb3QucXVldWVBdWRpbyhkYXRhLmRhdGEpOw0KICAgIH0NCiAgICBlbHNlIGlmIChkYXRhLnR5cGUgPT0gImFzc2lzdGFudF9tZXNzYWdlIikgew0KICAgICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5tZXNzYWdlLmNvbnRlbnQ7DQoNCiAgICAgICAgdGhpc0JvdC5xdWV1ZVRleHQobWVzc2FnZSk7IA0KICAgICAgICANCiAgICB9DQogICAgZWxzZSBpZiAoZGF0YS50eXBlID09ICJhc3Npc3RhbnRfZW5kIikgew0KICAgICAgICAvL3RhZ3MudGhpbmtpbmcgPSB0cnVlOw0KICAgIH0NCiAgICBlbHNlIGlmIChkYXRhLnR5cGUgPT0gImVycm9yIikgew0KICAgICAgICBjb25zb2xlLndhcm4oJ2Vycm9yOiAnLCBkYXRhLm1lc3NhZ2UpOw0KICAgIH0NCiAgICBlbHNlIGlmIChkYXRhLnR5cGUgPT0gInVzZXJfbWVzc2FnZSIpIHsNCiAgICAgICAgbGV0IHVzZXJuYW1lID0gYXdhaXQgdGhpc0JvdC5nZXRVc2VyTmFtZSgpOw0KICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJoYW5kUmFpc2VkIiwgZmFsc2UpOw0KDQogICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2UuY29udGVudDsNCg0KICAgICAgICBpZiAobWVzc2FnZSkgew0KICAgICAgICAgICAgYWIubG9nKHsNCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLA0KICAgICAgICAgICAgICAgIG5hbWU6IHVzZXJuYW1lLA0KICAgICAgICAgICAgICAgIHNwYWNlOiAic2hhcmVkIiwNCiAgICAgICAgICAgICAgICBtZXNzYWdlT3JpZ2luOiBjb25maWdCb3QuaWQsDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIGlmIChkYXRhLnR5cGUgPT0gInRvb2xfY2FsbCIpIHsNCiAgICAgICAgY29uc29sZS5sb2coIlRvb2wgY2FsbGVkOiAiLCBkYXRhLm5hbWUsIGRhdGEpOw0KICAgICAgICBpZiAodGFncy5kZWJ1Z01vZGUgPT0gdHJ1ZSAmJiBkYXRhLm5hbWUgIT0gJ3RoaW5rJykgew0KICAgICAgICAgICAgYWIubG9nKHsNCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBkYXRhLm5hbWUgKyAnOiAnICsgZGF0YS5wYXJhbWV0ZXJzLA0KICAgICAgICAgICAgICAgIG5hbWU6IGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwNCiAgICAgICAgICAgICAgICBzcGFjZTogInNoYXJlZCIsDQogICAgICAgICAgICAgICAgbWVzc2FnZU9yaWdpbjogY29uZmlnQm90LmlkLA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGRhdGEubmFtZSA9PSAidGhpbmsiKSB7DQogICAgICAgICAgICBpZiAoSlNPTi5wYXJzZShkYXRhLnBhcmFtZXRlcnMpLm1lc3NhZ2UpIHsNCiAgICAgICAgICAgICAgICBhYi5sb2coeyBtZXNzYWdlOiBKU09OLnBhcnNlKGRhdGEucGFyYW1ldGVycykubWVzc2FnZSwgbmFtZTogYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LCBzcGFjZTogInNoYXJlZCIsIG1lc3NhZ2VPcmlnaW46IGNvbmZpZ0JvdC5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmIChkYXRhLm5hbWUgPT0gIm1ha2VUb0RvQm90Iikgew0KICAgICAgICAgICAgdGhpc0JvdC5tYWtlVG9Eb0JvdCh7aWQ6IGRhdGEudG9vbF9jYWxsX2lkLCBkYXRhOiBkYXRhLnBhcmFtZXRlcnN9KTsNCiAgICAgICAgfSBlbHNlIGlmIChkYXRhLm5hbWUgPT0gImNvbXBsZXRlVG9Eb3MiKSB7DQogICAgICAgICAgICB0aGlzQm90LmNvbXBsZXRlVG9Eb3Moe2lkOiBkYXRhLnRvb2xfY2FsbF9pZH0pOw0KICAgICAgICB9ICBlbHNlIGlmIChkYXRhLm5hbWUgPT0gIm1ha2UiKSB7DQogICAgICAgICAgICB0aGlzQm90Lm1ha2VTb21ldGhpbmcoe2lkOiBkYXRhLnRvb2xfY2FsbF9pZCwgZGF0YTogZGF0YS5wYXJhbWV0ZXJzfSk7DQogICAgICAgIH0gIGVsc2UgaWYgKGRhdGEubmFtZSA9PSAicHVsbEZyb21DYXRhbG9nIikgew0KICAgICAgICAgICAgdGhpc0JvdC5wdWxsRnJvbUNhdGFsb2coe2lkOiBkYXRhLnRvb2xfY2FsbF9pZCwgZGF0YTogZGF0YS5wYXJhbWV0ZXJzfSk7DQogICAgICAgIH0gIGVsc2UgaWYgKGRhdGEubmFtZSA9PSAiZ2V0U2NlbmVEYXRhIikgew0KICAgICAgICAgICAgdGhpc0JvdC5nZXRTY2VuZURhdGEoe2lkOiBkYXRhLnRvb2xfY2FsbF9pZCwgZGF0YTogZGF0YS5wYXJhbWV0ZXJzfSk7DQogICAgICAgIH0gIGVsc2UgaWYgKGRhdGEubmFtZSA9PSAic2VlVXNlckZvY3VzIikgew0KICAgICAgICAgICAgdGhpc0JvdC5zZWVVc2VyRm9jdXMoe2lkOiBkYXRhLnRvb2xfY2FsbF9pZCwgZGF0YTogZGF0YS5wYXJhbWV0ZXJzfSk7DQogICAgICAgIH0gIGVsc2UgaWYgKGRhdGEubmFtZSA9PSAiY2xpY2tPbiIpIHsNCiAgICAgICAgICAgIHRoaXNCb3QuYWlDbGljayhkYXRhLnBhcmFtZXRlcnMpOw0KICAgICAgICAgICAgdGhpc0JvdC5zZW5kVG9vbENvbXBsZXRlTWVzc2FnZSh7aWQ6IGRhdGEudG9vbF9jYWxsX2lkfSk7DQogICAgICAgIH0gIA0KICAgIH0NCiAgICBlbHNlIGlmIChkYXRhLnR5cGUgPT0gInVzZXJfaW50ZXJydXB0aW9uIikgew0KICAgICAgICB0aGlzQm90LmNsZWFyUXVldWVzKCk7DQoNCiAgICAgICAgdGhpc0JvdC52YXJzLnBsYXlIdW1lQXVkaW8gPSB0cnVlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc29sZS5sb2coInVuZXhwZWN0ZWQgbWVzc2FnZToiLCBkYXRhLnR5cGUsIGRhdGEpOw0KICAgIH0NCn0pOycA0vaQuQ+2DQdlbmRIdW1lAgQA0vaQuQ+GOsICQGNvbnN0IGh1bWVTb2NrZXQgPSB0aGlzQm90LnZhcnMuaHVtZVNvY2tldDsNCg0KY29uc3Qgbm90aWZCb3RzID0gZ2V0Qm90cygiYWJWb2ljZU5vdGlmaWNhdGlvbkJvdCIsIHRydWUpOw0KZGVzdHJveShub3RpZkJvdHMpOw0KDQppZihodW1lU29ja2V0KSB7DQogICAgaHVtZVNvY2tldC5jbG9zZSgxMDAwLCAnVXNlciBlbmRlZCB0aGUgY2hhdCcpOw0KICAgIGRlbGV0ZSB0aGlzQm90LnZhcnMuaHVtZVNvY2tldDsNCn0NCg0KdHJ5IHsNCiAgICBhd2FpdCBvcy5lbmRBdWRpb1JlY29yZGluZygpOw0KfSBjYXRjaChlKSB7DQogICAgY29uc29sZS53YXJuKGUpOw0KfScA0vaQuQ+2DQlxdWV1ZVRleHQCBADS9pC5D8k8fkBjb25zdCB0ZXh0ID0gdGhhdDsNCg0KdGhpc0JvdC5tYXNrcy50ZXh0UXVldWUgPSB0aGlzQm90Lm1hc2tzLnRleHRRdWV1ZSA/IFsuLi50aGlzQm90Lm1hc2tzLnRleHRRdWV1ZV0uY29uY2F0KHRleHQpIDogW3RleHRdOycA0vaQuQ+2DQ9wbGF5UXVldWVkQXVkaW8CBADS9pC5D8g92g1AaWYgKHRoaXNCb3QudmFycy5wbGF5aW5nUXVldWUpDQp7DQogICAgcmV0dXJuOw0KfQ0KDQp0aGlzQm90LnZhcnMucGxheWluZ1F1ZXVlID0gdHJ1ZTsNCg0Kd2hpbGUgKHRoaXNCb3QubWFza3MuYXVkaW9RdWV1ZT8ubGVuZ3RoID4gMCkNCnsNCiAgICBjb25zdCBhY3RpdmVBdWRpbyA9IHRoaXNCb3QubWFza3MuYXVkaW9RdWV1ZVswXTsNCiAgICBjb25zdCBhY3RpdmVUZXh0ID0gdGhpc0JvdC5tYXNrcy50ZXh0UXVldWVbMF07DQoNCiAgICB0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUuc3BsaWNlKDAsIDEpOw0KICAgIHRoaXNCb3QubWFza3MudGV4dFF1ZXVlLnNwbGljZSgwLDEpOw0KDQogICAgbGV0IHNvdW5kSWQgPSBvcy5wbGF5U291bmQoYWN0aXZlQXVkaW8pOw0KICAgIHRoaXNCb3QubWFza3MuYWN0aXZlU291bmQgPSBzb3VuZElkOw0KICAgIGlmIChhY3RpdmVUZXh0KSB7DQogICAgICAgIGFiLmxvZyh7IG1lc3NhZ2U6IGFjdGl2ZVRleHQsIG5hbWU6IGFiUGVyc29uYWxpdHkudGFncy5hYkJ1aWxkZXJJZGVudGl0eSwgc3BhY2U6ICJzaGFyZWQiLCBtZXNzYWdlT3JpZ2luOiBjb25maWdCb3QuaWQgfSk7DQogICAgfQ0KICAgIA0KICAgIGF3YWl0IG9zLnNsZWVwKChnZXREdXJhdGlvbihhY3RpdmVBdWRpbykgKiAxMDAwKSk7DQogICAgDQogICAgdGhpc0JvdC5tYXNrcy5hY3RpdmVTb3VuZCA9IG51bGw7DQp9DQoNCnRoaXNCb3QudmFycy5wbGF5aW5nUXVldWUgPSBudWxsOw0KDQpmdW5jdGlvbiBiYXNlNjRUb0FycmF5QnVmZmVyKGJhc2U2NCkgew0KICAgIGNvbnN0IGJpbmFyeVN0cmluZyA9IHNlbGYuYXRvYihiYXNlNjQuc3BsaXQoJywnKVsxXSk7DQogICAgY29uc3QgYnl0ZXMgPSBVaW50OEFycmF5LmZyb20oYmluYXJ5U3RyaW5nLCBjaGFyID0+IGNoYXIuY2hhckNvZGVBdCgwKSk7DQogICAgcmV0dXJuIGJ5dGVzLmJ1ZmZlcjsNCn0NCg0KZnVuY3Rpb24gZ2V0V2F2RHVyYXRpb24oYXJyYXlCdWZmZXIpIHsNCiAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KGFycmF5QnVmZmVyKTsNCg0KICAgIC8vIENoZWNrIHRoZSAiUklGRiIgaWRlbnRpZmllcg0KICAgIGlmICh2aWV3LmdldFVpbnQzMigwLCBmYWxzZSkgIT09IDB4NTI0OTQ2NDYpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIFdBViBmaWxlIik7DQogICAgfQ0KDQogICAgLy8gQ2hlY2sgdGhlICJXQVZFIiBpZGVudGlmaWVyDQogICAgaWYgKHZpZXcuZ2V0VWludDMyKDgsIGZhbHNlKSAhPT0gMHg1NzQxNTY0NSkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgV0FWIGZpbGUiKTsNCiAgICB9DQoNCiAgICAvLyBHZXQgdGhlIGJ5dGUgcmF0ZSBmcm9tIHRoZSBmbXQgc3ViY2h1bmsNCiAgICBjb25zdCBieXRlUmF0ZSA9IHZpZXcuZ2V0VWludDMyKDI4LCB0cnVlKTsNCg0KICAgIC8vIEdldCB0aGUgdG90YWwgbnVtYmVyIG9mIGJ5dGVzIGluIHRoZSBkYXRhIHN1YmNodW5rDQogICAgY29uc3QgZGF0YUNodW5rU2l6ZSA9IHZpZXcuZ2V0VWludDMyKDQwLCB0cnVlKTsNCg0KICAgIC8vIENhbGN1bGF0ZSBkdXJhdGlvbg0KICAgIGNvbnN0IGR1cmF0aW9uID0gZGF0YUNodW5rU2l6ZSAvIGJ5dGVSYXRlOw0KDQogICAgcmV0dXJuIGR1cmF0aW9uOw0KfQ0KDQpmdW5jdGlvbiBnZXREdXJhdGlvbihiYXNlNjQpIHsNCiAgICB2YXIgYXJyQnVmZmVyID0gYmFzZTY0VG9BcnJheUJ1ZmZlcihiYXNlNjQpOw0KICAgIHJldHVybiBnZXRXYXZEdXJhdGlvbihhcnJCdWZmZXIpOw0KfScA0vaQuQ+2DQx0ZXh0UmVzcG9uc2UCBADS9pC5D6NLkwJALy8gbGV0IHJlc3BvbnNlID0gYXdhaXQgYWkuY2hhdChyZXNwb25zZVByb21wdCwgew0KLy8gICAgIHByZWZlcnJlZE1vZGVsOiB0YWdzLmFpTW9kZWwNCi8vIH0pOw0KDQpjb25zdCBodW1lU29ja2V0ID0gdGhpc0JvdC52YXJzLmh1bWVTb2NrZXQ7DQoNCmlmKGh1bWVTb2NrZXQpIHsNCiAgICBodW1lU29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAidHlwZSI6ICJ1c2VyX2lucHV0IiwNCiAgICAgICAgInRleHQiOiB0aGF0Lm1lc3NhZ2UsDQogICAgfSkpOw0KfScA0vaQuQ+2DRNhYkNvcmVNZW51U29ydE9yZGVyAgQA0vaQuQ+3TQQxMDAxJwDS9pC5D7YNDG9uQXVkaW9DaHVuawIEANL2kLkPvE2rB0Bjb25zdCBtdXRlQm90ID0gZ2V0Qm90KCJzeXN0ZW0iLCAiYWIuYWkubXV0ZSIpOw0KbGV0IGF1ZGlvRGF0YTsNCmlmIChtdXRlQm90ICYmIG11dGVCb3QudGFncy5tdXRlZCAmJiB0YWdzLnNlbnRJbml0Q2h1bmspIHsNCiAgICBjb25zdCBzaWxlbmNlID0gbmV3IEJsb2IoW25ldyBVaW50OEFycmF5KHRoYXQuc2l6ZSldLCB7IHR5cGU6ICdhdWRpby93YXYnIH0pOw0KICAgIGF1ZGlvRGF0YSA9IGF3YWl0IGJsb2JUb0Jhc2U2NChzaWxlbmNlKTsNCn0gZWxzZSB7DQogICAgYXVkaW9EYXRhID0gYXdhaXQgYmxvYlRvQmFzZTY0KHRoYXQpOw0KfQ0KDQpzZXRUYWdNYXNrKHRoaXNCb3QsICJzZW50SW5pdENodW5rIiwgdHJ1ZSk7DQoNCmNvbnN0IGh1bWVTb2NrZXQgPSB0aGlzQm90LnZhcnMuaHVtZVNvY2tldDsNCg0KY29uc3QgcGFja2V0SGFzaCA9IGNyeXB0by5oYXNoKCdzaGExJywgJ2hleCcsIGF1ZGlvRGF0YSk7DQoNCmlmKGh1bWVTb2NrZXQpIHsNCiAgICBjb25zb2xlLmxvZygicGFja2V0IGhlcmUiLCBwYWNrZXRIYXNoKTsNCg0KICAgIGh1bWVTb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICJ0eXBlIjogImF1ZGlvX2lucHV0IiwNCiAgICAgICAgImRhdGEiOiBhdWRpb0RhdGENCiAgICB9KSk7DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIGJsb2JUb0Jhc2U2NChibG9iKSB7DQogIC8vIFJlYWQgdGhlIEJsb2IgYXMgYW4gQXJyYXlCdWZmZXINCiAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBibG9iLmFycmF5QnVmZmVyKCk7DQogIA0KICAvLyBDb252ZXJ0IHRoZSBBcnJheUJ1ZmZlciB0byBhIEJhc2U2NCBzdHJpbmcNCiAgY29uc3QgYmFzZTY0U3RyaW5nID0gYnl0ZXMudG9CYXNlNjRTdHJpbmcobmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIpLCAnYXVkaW8vd2F2Jyk7DQogIA0KICByZXR1cm4gYmFzZTY0U3RyaW5nOw0KfScA0vaQuQ+2DQpxdWV1ZUF1ZGlvAgQA0vaQuQ/oVPQCQGNvbnN0IGJhc2U2NEF1ZGlvID0gdGhhdDsNCg0KY29uc3QgbWltZVR5cGUgPSAiYXVkaW8vd2F2IjsgLy8gQWRqdXN0IE1JTUUgdHlwZSBhcyBuZWVkZWQNCmNvbnN0IGRhdGFVUkwgPSBgZGF0YToke21pbWVUeXBlfTtiYXNlNjQsJHtiYXNlNjRBdWRpb31gOw0KDQp0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUgPSB0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUgPyBbLi4udGhpc0JvdC5tYXNrcy5hdWRpb1F1ZXVlXS5jb25jYXQoZGF0YVVSTCkgOiBbZGF0YVVSTF07DQoNCi8vdGhpc0JvdC5wbGF5UXVldWVkQXVkaW8oKTsNCmlmICghdGFncy5oYW5kUmFpc2VkKSB7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAiaGFuZFJhaXNlZCIsIHRydWUpOw0KfQ0KJwDS9pC5D7YNC2dldFVzZXJOYW1lAgQA0vaQuQ/dV6UDQGxldCB1c2VybmFtZSA9ICJ1c2VyIjsNCg0KaWYgKGF1dGhCb3QgJiYgYXV0aEJvdC50YWdzLm5hbWUgJiYgYXV0aEJvdC50YWdzLm5hbWUgIT0gIiIpIHsNCiAgICB1c2VybmFtZSA9IGF1dGhCb3QudGFncy5uYW1lOw0KfSBlbHNlIGlmIChhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWUpIHsNCiAgICB1c2VybmFtZSA9IGFiLmxpbmtzLmNvbnNvbGUubWFza3MucHJlZmVycmVkTmFtZTsNCn0gZWxzZSB7DQogICAgdXNlcm5hbWUgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsNCiAgICAgICAgdGl0bGU6ICJXaGF0IHdvdWxkIHlvdSBsaWtlIG1lIHRvIGNhbGwgeW91PyINCiAgICB9KTsNCiAgICBhYi5saW5rcy5jb25zb2xlLm1hc2tzLnByZWZlcnJlZE5hbWUgPSB1c2VybmFtZTsNCn0NCg0KcmV0dXJuIHVzZXJuYW1lOycA0vaQuQ+2DQphYklET3JpZ2luAgQA0vaQuQ+DWwdhYlZvaWNlJwDS9pC5D7YNDmFiQ29yZU1lbnVJY29uAgQA0vaQuQ+LWwRjdWJlJwDS9pC5D7YNA2FzawIEANL2kLkPkFso8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycA0vaQuQ+2DQxvbkJvdENoYW5nZWQCBADS9pC5D7dbwgpAaWYgKHRoYXQudGFncy5pbmNsdWRlcygiaGFuZFJhaXNlZCIpKSB7DQogICAgLy9jcmVhdGUgYm90IGFib3ZlIGFiIHdpdGggc3BlY2lhbCBjbGlja2FibGUgbGFiZWwNCiAgICANCiAgICBjb25zdCBhYkJvdCA9IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3Q7DQogICAgaWYgKCFhYkJvdCkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgaWYgKHRhZ3MuaGFuZFJhaXNlZCkgew0KICAgICAgICBjb25zdCBub3RpZkJvdHMgPSBnZXRCb3RzKCJhYlZvaWNlTm90aWZpY2F0aW9uQm90IiwgdHJ1ZSk7DQogICAgICAgIGRlc3Ryb3kobm90aWZCb3RzKTsNCiAgICAgICAgDQogICAgICAgIGNyZWF0ZSh7DQogICAgICAgICAgICB0cmFuc2Zvcm1lcjogZ2V0SUQoYWJCb3QpLA0KICAgICAgICAgICAgb25DbGljazogYEANCiAgICAgICAgICAgICAgICBsaW5rcy52b2ljZS5jYWxsZWRPbih0aGlzQm90KTsNCiAgICAgICAgICAgIGAsDQogICAgICAgICAgICBuYW1lOiAiYWJWb2ljZU5vdGlmQm90IiwNCiAgICAgICAgICAgIHZvaWNlOiBnZXRMaW5rKHRoaXNCb3QpLA0KICAgICAgICAgICAgYWJWb2ljZU5vdGlmaWNhdGlvbkJvdDogdHJ1ZSwNCiAgICAgICAgICAgIFthYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uXTogdHJ1ZSwNCiAgICAgICAgICAgIFthYi5saW5rcy5yZW1lbWJlci50YWdzLmFiQWN0aXZlRGltZW5zaW9uICsgJ1onXTogMSwNCiAgICAgICAgICAgIGZvcm06ICdzcHJpdGUnLA0KICAgICAgICAgICAgZm9jdXNhYmxlOiB0cnVlLA0KICAgICAgICAgICAgb25Gb2N1c0VudGVyOiBgQA0KICAgICAgICAgICAgICAgIGlmICh0aGF0LmJvdCA9PSB0aGlzQm90KSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXNCb3Qub25DbGljaygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGAsDQogICAgICAgICAgICBvcmllbnRhdGlvbk1vZGU6ICdiaWxsYm9hcmQnLA0KICAgICAgICAgICAgc3BhY2U6ICJ0ZW1wTG9jYWwiLA0KICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdodHRwczovL2F1dGgtYXV4LXByb2QtZmlsZXNidWNrZXQtNjgyMzk3NjkwNjYwLnMzLmFtYXpvbmF3cy5jb20vNjRiZWI0MzktMTJiOS00MTU1LWIzODgtZGIwM2I3ZWMxYzljLzg5Mjk5ZDhjNThmOTdmODg1M2E5ZTg3ZDRhMDIwNzU3NDgzOWRiZWIzYzY2YjkyZWE2OTFkYjcxMGIzM2M1MTYnLA0KDQogICAgICAgIH0pDQogICAgfSBlbHNlIHsNCiAgICAgICAgY29uc3Qgbm90aWZCb3RzID0gZ2V0Qm90cygiYWJWb2ljZU5vdGlmaWNhdGlvbkJvdCIsIHRydWUpOw0KICAgICAgICBkZXN0cm95KG5vdGlmQm90cyk7DQogICAgfQ0KfScA0vaQuQ+2DQdjb25zb2xlAgQA0vaQuQ/6ZSjwn5SXMjRiN2U2NmYtMGQ1Yi00MDY0LWJmNDgtYjU2MmI5ZTZlM2ViJwDS9pC5D7YNCGNhbGxlZE9uAgQA0vaQuQ+hZi1AZGVzdHJveSh0aGF0KTsNCg0KdGhpc0JvdC5wbGF5UXVldWVkQXVkaW8oKTsnANL2kLkPtg0Sb25IdW1lU29ja2V0T3BlbmVkAgQA0vaQuQ/PZnpAaWYgKHRhZ3MuYXdhaXRpbmdUZXh0KSB7DQogICAgdGhpc0JvdC50ZXh0UmVzcG9uc2UodGFncy5hd2FpdGluZ1RleHQpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImF3YWl0aW5nVGV4dCIsIG51bGwpOw0KfScA0vaQuQ+2DQtjbGVhclF1ZXVlcwIEANL2kLkPymeAA0B0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUgJiYgdGhpc0JvdC5tYXNrcy5hdWRpb1F1ZXVlLmxlbmd0aCA+IDAgPyB0aGlzQm90Lm1hc2tzLmF1ZGlvUXVldWUubGVuZ3RoID0gMSA6IG51bGw7DQp0aGlzQm90Lm1hc2tzLnRleHRRdWV1ZSAmJiB0aGlzQm90Lm1hc2tzLnRleHRRdWV1ZS5sZW5ndGggPiAwID8gdGhpc0JvdC5tYXNrcy50ZXh0UXVldWUubGVuZ3RoID0gMSA6IG51bGw7DQoNCm9zLmNhbmNlbFNvdW5kKHRoaXNCb3QubWFza3MuYWN0aXZlU291bmQpOw0KDQpjb25zdCBub3RpZkJvdHMgPSBnZXRCb3RzKCJhYlZvaWNlTm90aWZpY2F0aW9uQm90IiwgdHJ1ZSk7DQpkZXN0cm95KG5vdGlmQm90cyk7DQoNCnRoaXNCb3QubWFza3MuYWN0aXZlU291bmQgPSBudWxsOygA0vaQuQ+2DQh0aGlua2luZwF4JwDS9pC5D7YNC21ha2VUb0RvQm90AgQA0vaQuQ/MatcHQGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHRoYXQuZGF0YSk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5ib3RzLmxlbmd0aDsgKytpKSB7DQogICAgY29uc3QgYWJBcnRpZmFjdFNoYXJkID0gew0KICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICBwcm9tcHQ6IGRhdGEuYm90c1tpXS5wcm9tcHQsDQogICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogYWIubGlua3MucmVtZW1iZXIuYWJHcmlkRm9jdXM/LmRpbWVuc2lvbiA/PyB0YWdzLmRpbWVuc2lvbiA/PyAnaG9tZScsDQogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgICAgICB4OiBhYi5saW5rcy5yZW1lbWJlci5hYkdyaWRGb2N1cz8ucG9zaXRpb24/LnggPz8gZGF0YS5ib3RzW2ldLmxvY2F0aW9uPy54ID8/IDAsDQogICAgICAgICAgICAgICAgICAgICAgICB5OiBhYi5saW5rcy5yZW1lbWJlci5hYkdyaWRGb2N1cz8ucG9zaXRpb24/LnggPz8gZGF0YS5ib3RzW2ldLmxvY2F0aW9uPy55ID8/IDANCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgZGVwZW5kZW5jaWVzOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXNrSUQ6ICd0b0RvQm90Jw0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfTsNCiAgICBhd2FpdCBhYi5saW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0UHJvbWlzZUJvdCh7DQogICAgICAgIGFiQXJ0aWZhY3ROYW1lOiAndG9Eb0JvdCcsDQogICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgIGFiQXJ0aWZhY3RTaGFyZCwNCiAgICB9KTsNCn0NCg0KdGhpc0JvdC5zZW5kVG9vbENvbXBsZXRlTWVzc2FnZSh7aWQ6IHRoYXQuaWR9KTsnANL2kLkPtg0OZ2V0Q2F0YWxvZ0Fza3MCBADS9pC5D6Ry+wZAY29uc3QgY2F0YWxvZ0FyciA9IFtdOw0KY29uc3QgcG9zc2libGVUb29sYm94ZXMgPSBhYi5saW5rcy5yZW1lbWJlci50YWdzLnRvb2xib3hfYXJyYXk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgcG9zc2libGVUb29sYm94ZXMubGVuZ3RoOyBpKyspDQp7DQogICAgY29uc3QgYWN0aXZlVG9vbGJveCA9IHBvc3NpYmxlVG9vbGJveGVzW2ldOw0KICAgIGNvbnN0IGV4dGFudEJvdCA9IGFjdGl2ZVRvb2xib3guc3R1ZGlvID8gZ2V0Qm90KCJhYklET3JpZ2luIiwgYWN0aXZlVG9vbGJveC5uYW1lKTogZ2V0Qm90KGFjdGl2ZVRvb2xib3gubmFtZSwgdHJ1ZSk7DQoNCiAgICBpZiAoIWV4dGFudEJvdCkNCiAgICB7DQogICAgICAgIGNvbnN0IG9iaiA9IHsNCiAgICAgICAgICAgICJuYW1lIjogYWN0aXZlVG9vbGJveC50aXRsZSwNCiAgICAgICAgICAgICJpZCI6IGFjdGl2ZVRvb2xib3gubmFtZQ0KICAgICAgICB9DQogICAgICAgIGNhdGFsb2dBcnIucHVzaChvYmopOw0KICAgIH0NCn0NCg0KY29uc3QgbG9hZGVkVG9vbGJveGVzID0gZ2V0Qm90cygidG9vbF9hcnJheSIpOw0KZm9yIChsZXQgaiA9IDA7IGogPCBsb2FkZWRUb29sYm94ZXMubGVuZ3RoOyArK2opIHsNCiAgICBjb25zdCBhcnIgPSBsb2FkZWRUb29sYm94ZXNbal0udGFncy50b29sX2FycmF5ID8/IFtdOw0KICAgIGZvciAobGV0IGsgPSAwOyBrIDwgYXJyLmxlbmd0aDsgKytrKSB7DQogICAgICAgIGNvbnN0IG9iaiA9IHsNCiAgICAgICAgICAgICJuYW1lIjogYXJyW2tdLm5hbWUgPz8gYXJyW2tdLnRhcmdldEFCLA0KICAgICAgICAgICAgImlkIjogYXJyW2tdLnRhcmdldEFCDQogICAgICAgIH0NCiAgICAgICAgY2F0YWxvZ0Fyci5wdXNoKG9iaik7DQogICAgfQ0KfQ0KDQpyZXR1cm4gY2F0YWxvZ0FycjsnANL2kLkPtg0NbWFrZVNvbWV0aGluZwIEANL2kLkPoHmhHkBjb25zdCBkYXRhID0gSlNPTi5wYXJzZSh0aGF0LmRhdGEpOw0KaWYgKGRhdGEgJiYgZGF0YS5wcm9tcHQpIHsNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJsYXRlc3RJbnF1aXJ5IiwgZGF0YS5wcm9tcHQpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImxhdGVzdElucXVpcnlJRCIsIHRoYXQuaWQpOw0KICAgIA0KICAgIC8vYWIubGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24oZGF0YS5wcm9tcHQpOw0KICAgIGNvbnN0IGFiQXJ0aWZhY3RTaGFyZCA9IHsNCiAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgcHJvbXB0OiBkYXRhLnByb21wdCwNCiAgICAgICAgICAgIGVnZ1BhcmFtZXRlcnM6IHsNCiAgICAgICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHsNCiAgICAgICAgICAgICAgICAgICAgZGltZW5zaW9uOiBhYi5saW5rcy5yZW1lbWJlci5hYkdyaWRGb2N1cz8uZGltZW5zaW9uID8/IHRhZ3MuZGltZW5zaW9uID8/ICdob21lJywNCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IGFiLmxpbmtzLnJlbWVtYmVyLmFiR3JpZEZvY3VzPy5wb3NpdGlvbj8ueCA/PyAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgeTogYWIubGlua3MucmVtZW1iZXIuYWJHcmlkRm9jdXM/LnBvc2l0aW9uPy54ID8/IDANCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgZGVwZW5kZW5jaWVzOiBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXNrSUQ6ICd0b0RvQm90Jw0KICAgICAgICAgICAgfQ0KICAgICAgICBdDQogICAgfTsNCiAgICBhd2FpdCBhYi5saW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0UHJvbWlzZUJvdCh7DQogICAgICAgIGFiQXJ0aWZhY3ROYW1lOiAndG9Eb0JvdCcsDQogICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgIGFiQXJ0aWZhY3RTaGFyZCwNCiAgICB9KTsNCg0KICAgIGF3YWl0IG9zLnNsZWVwKDEwMDApOw0KDQogICAgY29uc3QgYWJCb3QgPSBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90Ow0KICAgIC8vcHVsbCBpbiBhZ2VudCBib3QNCiAgICBhd2FpdCBhYi5saW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgIGFza0lEOiAnYWdlbnRfYm90X3Rvb2wnLA0KICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHsNCiAgICAgICAgICAgICAgICBkaW1lbnNpb246IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPz8gJ2hvbWUnLA0KICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgIHg6IGFiQm90LnRhZ3NbKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPz8gJ2hvbWUnKSArICdYJ10gPz8gMSwNCiAgICAgICAgICAgICAgICAgICAgeTogYWJCb3QudGFnc1soY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA/PyAnaG9tZScpICsgJ1knXSA/PyAwDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGFpTW9kZWw6IGFiUGVyc29uYWxpdHkudGFncy5hYlByZWZlcnJlZEFJTW9kZWwsDQogICAgICAgIH0NCiAgICB9KQ0KICAgIGxldCBhZ2VudEJvdCA9IGdldEJvdCgiYWdlbnRfYm90X3Rvb2wiLCB0cnVlKTsNCg0KICAgIGlmICghYWdlbnRCb3QpIHsNCiAgICAgICAgb3MudG9hc3QoImNvdWxkIG5vdCBjcmVhdGUgYWkgYWdlbnQiKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vY29tcGxldGUgdGhlIHRvZG8NCiAgICBjb25zdCB0b0RvQm90ID0gZ2V0Qm90KGJ5VGFnKCJ0b0RvIiwgdHJ1ZSksIGJ5VGFnKCJwcm9tcHQiLCBkYXRhLnByb21wdCkpOw0KICAgIGNvbnN0IHByb21wdCA9IHRvRG9Cb3QudGFncy5wcm9tcHQ7DQogICAgaWYgKCFwcm9tcHQpIHsNCiAgICAgICAgb3MudG9hc3QoImZhaWxlZCB0byBleGVjdXRlIHJlcXVlc3QiKQ0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgY29uc3QgeFBvcyA9IHRvRG9Cb3QudGFnc1t0b0RvQm90LnRhZ3MuZGltZW5zaW9uICsgJ1gnXTsNCiAgICBjb25zdCB5UG9zID0gdG9Eb0JvdC50YWdzW3RvRG9Cb3QudGFncy5kaW1lbnNpb24gKyAnWSddOw0KDQogICAgY29uc3QgYWdlbnRYUG9zID0gKGFnZW50Qm90LnRhZ3NbdG9Eb0JvdC50YWdzLmRpbWVuc2lvbiArICdYJ10gJiYgYWdlbnRCb3QudGFnc1t0b0RvQm90LnRhZ3MuZGltZW5zaW9uICsgJ1gnXSA+IHRvRG9Cb3QudGFnc1t0b0RvQm90LnRhZ3MuZGltZW5zaW9uICsgJ1gnXSkgPyB0b0RvQm90LnRhZ3NbdG9Eb0JvdC50YWdzLmRpbWVuc2lvbiArICdYJ10gKyAzIDogdG9Eb0JvdC50YWdzW3RvRG9Cb3QudGFncy5kaW1lbnNpb24gKyAnWCddIC0gMzsNCiAgICBjb25zdCBhZ2VudFlQb3MgPSAoYWdlbnRCb3QudGFnc1t0b0RvQm90LnRhZ3MuZGltZW5zaW9uICsgJ1knXSAmJiBhZ2VudEJvdC50YWdzW3RvRG9Cb3QudGFncy5kaW1lbnNpb24gKyAnWSddID4gdG9Eb0JvdC50YWdzW3RvRG9Cb3QudGFncy5kaW1lbnNpb24gKyAnWSddKSA/IHRvRG9Cb3QudGFnc1t0b0RvQm90LnRhZ3MuZGltZW5zaW9uICsgJ1knXSArIDMgOiB0b0RvQm90LnRhZ3NbdG9Eb0JvdC50YWdzLmRpbWVuc2lvbiArICdZJ10gLSAzOw0KDQogICAgYXdhaXQgdGhpc0JvdC5tb3ZlQm90KHsNCiAgICAgICAgYm90OiBhZ2VudEJvdCwNCiAgICAgICAgZGltZW5zaW9uOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID8/ICdob21lJywNCiAgICAgICAgcG9zaXRpb246IHsNCiAgICAgICAgICAgIHg6IGFnZW50WFBvcywNCiAgICAgICAgICAgIHk6IGFnZW50WVBvcw0KICAgICAgICB9DQogICAgfSkNCg0KICAgIGF3YWl0IG9zLnNsZWVwKDI1MCk7DQoNCiAgICBsaW5rcy5hcm1fdG9vbC5hYkNyZWF0ZUFybSh7DQogICAgICAgIG9yaWdpbkJvdDogYWdlbnRCb3QsDQogICAgICAgIGRpbWVuc2lvbjogdG9Eb0JvdC50YWdzLmRpbWVuc2lvbiwNCiAgICAgICAgcG9zaXRpb246IHsNCiAgICAgICAgICAgIHg6IHhQb3MsDQogICAgICAgICAgICB5OiB5UG9zLA0KICAgICAgICAgICAgejogMA0KICAgICAgICB9DQogICAgfSkNCiAgICBhd2FpdCBvcy5zbGVlcCgxMDAwKTsNCg0KICAgIGNvbnN0IHJlcXVlc3REYXRhID0ge307DQogICAgaWYgKGFnZW50Qm90LmxpbmtzLmFybUJvdCkgew0KICAgICAgICBjb25zdCBhcm1Cb3QgPSBhZ2VudEJvdC5saW5rcy5hcm1Cb3Q7DQogICAgICAgIGNvbnN0IGFybURpbWVuc2lvbiA9IGFybUJvdC50YWdzLmRpbWVuc2lvbjsNCg0KICAgICAgICByZXF1ZXN0RGF0YS5hcm1EaW1lbnNpb24gPSBhcm1EaW1lbnNpb247DQogICAgICAgIHJlcXVlc3REYXRhLmFybURpbWVuc2lvblggPSBhcm1Cb3QudGFnc1thcm1EaW1lbnNpb24gKyAiWCJdOw0KICAgICAgICByZXF1ZXN0RGF0YS5hcm1EaW1lbnNpb25ZID0gYXJtQm90LnRhZ3NbYXJtRGltZW5zaW9uICsgIlkiXTsNCiAgICB9DQoNCiAgICBhZ2VudEJvdC5tYXNrcy50YXJnZXRCb3QgPSBnZXRMaW5rKHRvRG9Cb3QpOw0KICAgIGFnZW50Qm90Lm1hc2tzLnByb21wdFR5cGUgPSAnZ3JpZCc7DQogICAgYWdlbnRCb3QuYWdlbnRPblJlcXVlc3Qoew0KICAgICAgICBpbnF1aXJ5OiBwcm9tcHQsDQogICAgICAgIGRhdGE6IHJlcXVlc3REYXRhLCANCiAgICAgICAgbW9kZWw6IGFnZW50Qm90LnRhZ3MuYWlNb2RlbA0KICAgIH0pOw0KDQogICAgdG9Eb0JvdC50YWdzW3RvRG9Cb3QudGFncy5kaW1lbnNpb25dID0gZmFsc2U7DQogICAgLy8gZGVzdHJveSh0b0RvQm90KTsNCiAgICAvLyBkZXN0cm95KGFnZW50Qm90KTsNCg0KICAgIGF3YWl0IG9zLnNsZWVwKDEwMDApOw0KfScA0vaQuQ+2DQ9wdWxsRnJvbUNhdGFsb2cCBADS9pC5D8KXAdwRQGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHRoYXQuZGF0YSk7DQoNCi8vZ2V0IGdyaWQgZGF0YQ0KaWYgKCFhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzKSB7DQogIGNvbnN0IGdyaWREYXRhID0gew0KICAgICAgZGltZW5zaW9uOiBhYlJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb24gPz8gJ2hvbWUnLCANCiAgICAgIHBvc2l0aW9uOiB7DQogICAgICAgICAgeDogMCwNCiAgICAgICAgICB5OiAwDQogICAgICB9DQogIH0NCiAgYWIubGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cyA9IGdyaWREYXRhOw0KfQ0KDQovL21ha2Ugc3VyZSB0aGUgYXNrIGlzIHRoZXJlDQppZiAoZGF0YSAmJiBkYXRhLmFzaykgew0KDQogIC8vSWYgcHVsbGluZyBhIHRvb2xib3gNCiAgaWYgKGRhdGEuYXNrLmluY2x1ZGVzKCJ0b29sYm94IikpIHsNCiAgICBjb25zdCB0b29sYm94RGF0YSA9IGFiLmxpbmtzLnJlbWVtYmVyLnRhZ3MudG9vbGJveF9hcnJheS5maW5kKHRvb2xCb3ggPT4gdG9vbEJveC5uYW1lID09IGRhdGEuYXNrKTsNCiAgICBsaW5rcy5tYW5hZ2VyLnRvb2xib3hfYWRkKHt0b29sYm94RGF0YTogdG9vbGJveERhdGEsIGdyaWREYXRhOiBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzfSk7DQogIH0gDQogIC8vZWxzZSBwdWxsaW5nIGFydGlmYWN0IG9yIGFzaw0KICBlbHNlIHsNCiAgICBsZXQgaXNBcnRpZmFjdCA9IGZhbHNlOw0KDQogICAgLy9maW5kIHRoZSB0b29sYm94IGZvciB0aGlzIGFzaywgdG8gZGV0ZXJtaW5lIGlmIGl0cyBhbiBhcnRpZmFjdA0KICAgIGNvbnN0IHRvb2xib3ggPSBnZXRCb3QoYnlUYWcoInRvb2xfYXJyYXkiLCB0b29sX2FyciA9PiB7DQogICAgICBpZiAodG9vbF9hcnIuZmluZCh0b29sID0+IHRvb2wudGFyZ2V0QUIgPT0gZGF0YS5hc2spKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfX0NCiAgICApKTsNCiAgICBpZiAodG9vbGJveCkgew0KICAgICAgaXNBcnRpZmFjdCA9IHRvb2xib3gudGFncy50b29sX2FycmF5LmZpbmQodG9vbCA9PiB0b29sLnRhcmdldEFCID09IGRhdGEuYXNrKT8uYXJ0aWZhY3Q7DQogICAgfQ0KDQogICAgLy9pcyBhcnRpZmFjdA0KICAgIGlmIChpc0FydGlmYWN0KSB7DQogICAgICBjb25zdCBhYkFydGlmYWN0U2hhcmQgPSB7DQogICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgICAgICB0b29sYm94Qm90OiBudWxsLA0KICAgICAgICAgICAgICAgICAgZ3JpZEluZm9ybWF0aW9uOiBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgIGRlcGVuZGVuY2llczogWw0KICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICBhc2tJRDogZGF0YS5hc2sNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIF0NCiAgICAgIH07DQogICAgICBhYi5saW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0UHJvbWlzZUJvdCh7DQogICAgICAgICAgYWJBcnRpZmFjdE5hbWU6IGRhdGEuYXNrLA0KICAgICAgICAgIGFiQXJ0aWZhY3RJbnN0YW5jZUlEOiB1dWlkKCksDQogICAgICAgICAgYWJBcnRpZmFjdFNoYXJkLA0KICAgICAgfSk7DQogICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOw0KICAgICAgdGhpc0JvdC5zZW5kVG9vbENvbXBsZXRlTWVzc2FnZSh7aWQ6IHRoYXQuaWR9KTsNCiAgICB9IA0KICAgIC8vaXMgbm90IGFydGlmYWN0DQogICAgZWxzZSB7DQogICAgICBjb25zdCByZXNwb25zZSA9IGFiLmxpbmtzLnNlYXJjaC5vbkxvb2t1cEFza0lEKHsNCiAgICAgICAgICBhc2tJRDogZGF0YS5hc2ssDQogICAgICAgICAgc291cmNlRXZlbnQ6ICd0b29sJywNCiAgICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICAgIHRvb2xib3hCb3Q6IG51bGwsDQogICAgICAgICAgICAgIGdyaWRJbmZvcm1hdGlvbjogYWIubGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cw0KICAgICAgICAgIH0sDQogICAgICB9KTsNCiAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7DQogICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykgew0KICAgICAgICB0aGlzQm90LnNlbmRUb29sQ29tcGxldGVNZXNzYWdlKHtpZDogdGhhdC5pZH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpc0JvdC5zZW5kVG9vbENvbXBsZXRlTWVzc2FnZSh7aWQ6IHRoYXQuaWQsIGNvbnRlbnQ6ICJmYWlsZWQifSk7DQogICAgICB9DQogICAgfQ0KICB9DQp9JwDS9pC5D7YNDm9uQW55Qm90c0FkZGVkAgQA0vaQuQ+fqQGpBUBmb3IgKGxldCBpID0gMDsgaSA8IHRoYXQuYm90cy5sZW5ndGg7ICsraSkgew0KICAgIGlmICh0aGF0LmJvdHNbaV0udGFncy50b29sX2FycmF5KSB7DQogICAgICAgIGNvbnN0IGh1bWVTb2NrZXQgPSB0aGlzQm90LnZhcnMuaHVtZVNvY2tldDsNCg0KICAgICAgICBpZihodW1lU29ja2V0KSB7DQogICAgICAgICAgICBodW1lU29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAgICAgICAgICJ0eXBlIjogInNlc3Npb25fc2V0dGluZ3MiLA0KICAgICAgICAgICAgICAgICJ2YXJpYWJsZXMiOiB7DQogICAgICAgICAgICAgICAgICAgICJuYW1lIjogYWJQZXJzb25hbGl0eS50YWdzLmFiQnVpbGRlcklkZW50aXR5LA0KICAgICAgICAgICAgICAgICAgICAiY2F0YWxvZ19hc2tzIjogYXdhaXQgdGhpc0JvdC5nZXRDYXRhbG9nQXNrcygpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgaWYgKHRoYXQuYm90c1tpXS50YWdzLmFiUGF0Y2hCb3QgPT0gdHJ1ZSAmJiB0aGF0LmJvdHNbaV0udGFncy5hYlBhdGNoQXNrSW5wdXQ/LmlucXVpcnkgPT0gdGFncy5sYXRlc3RJbnF1aXJ5KSB7DQogICAgICAgIHRoaXNCb3Quc2VuZFRvb2xDb21wbGV0ZU1lc3NhZ2Uoe2lkOiB0YWdzLmxhdGVzdElucXVpcnlJRH0pOw0KICAgIH0NCn0NCicA0vaQuQ+2DRdzZW5kVG9vbENvbXBsZXRlTWVzc2FnZQIEANL2kLkPya4BhANAY29uc3QgY29tcGxldGVfc2V0dGluZ3MgPSB7DQogICAgInR5cGUiOiAidG9vbF9yZXNwb25zZSIsDQogICAgInRvb2xfY2FsbF9pZCI6IHRoYXQuaWQsDQogICAgImNvbnRlbnQiOiB0aGF0LmNvbnRlbnQgPz8gImNvbXBsZXRlZCINCn07DQoNCmlmICh0aGlzQm90LnZhcnNbInRvb2xSZXNwb25zZVRpbWVvdXQiICsgdGhhdC5pZF0pIHsNCiAgICBjbGVhclRpbWVvdXQodGhpc0JvdC52YXJzWyJ0b29sUmVzcG9uc2VUaW1lb3V0IiArIHRoYXQuaWRdKTsNCn0NCg0KY29uc3QgaHVtZVNvY2tldCA9IHRoaXNCb3QudmFycy5odW1lU29ja2V0Ow0KDQppZihodW1lU29ja2V0KSB7DQogICAgaHVtZVNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KGNvbXBsZXRlX3NldHRpbmdzKSk7DQp9JwDS9pC5D7YNB21hbmFnZXICBADS9pC5D86xASjwn5SXMTNmMzNhNTEtYzJmYS00NmRhLWE4OGUtZTVjMDY3NTU2ZDAyJwDS9pC5D7YNDGdldFNjZW5lRGF0YQIEANL2kLkP9bEB/QRAY29uc3QgYm90cyA9IGdldEJvdHMoYnlUYWcoYWIubGlua3MucmVtZW1iZXIudGFncy5hYkFjdGl2ZURpbWVuc2lvbiwgdHJ1ZSksIG5vdChieVRhZygiYWJJZ25vcmUiLCB0cnVlKSksIG5vdChieVRhZygiYWJCb3QiLCB0cnVlKSkpOw0KDQpjb25zdCB0b29sX3Jlc3BvbnNlID0gew0KICAgICJ0eXBlIjogInRvb2xfcmVzcG9uc2UiLA0KICAgICJ0b29sX2NhbGxfaWQiOiB0aGF0LmlkLA0KICAgICJjb250ZW50IjogSlNPTi5zdHJpbmdpZnkoYm90cykNCn07DQoNCmNvbnNvbGUubG9nKCJTY2VuZSBEYXRhIFNlbnQ6ICIsIGJvdHMpDQppZiAodGFncy5kZWJ1Z01vZGUgPT0gdHJ1ZSkgew0KICAgIGFiLmxvZyh7DQogICAgICAgIG1lc3NhZ2U6ICJTY2VuZSBEYXRhIFNlbnQ6ICIgKyBKU09OLnN0cmluZ2lmeShib3RzKSwNCiAgICAgICAgbmFtZTogJ2Nhc3VhbG9zJywNCiAgICAgICAgc3BhY2U6ICJzaGFyZWQiLA0KICAgICAgICBtZXNzYWdlT3JpZ2luOiBjb25maWdCb3QuaWQsDQogICAgfSk7DQp9DQoNCmNvbnN0IGh1bWVTb2NrZXQgPSB0aGlzQm90LnZhcnMuaHVtZVNvY2tldDsNCg0KaWYoaHVtZVNvY2tldCkgew0KICAgIGh1bWVTb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh0b29sX3Jlc3BvbnNlKSk7DQp9JwDS9pC5D7YNDHNlZVVzZXJGb2N1cwIEANL2kLkP87YBuAVAY29uc3QgZm9jdXMgPSBhYi5saW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMgPz8gYWIubGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cyA/PyBhYi5saW5rcy5yZW1lbWJlci5saW5rcy5hYkdyaWRGb2N1cyA/PyBhYi5saW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzID8/IG51bGwNCg0KY29uc3QgdG9vbF9yZXNwb25zZSA9IHsNCiAgICAidHlwZSI6ICJ0b29sX3Jlc3BvbnNlIiwNCiAgICAidG9vbF9jYWxsX2lkIjogdGhhdC5pZCwNCiAgICAiY29udGVudCI6IEpTT04uc3RyaW5naWZ5KGZvY3VzKQ0KfTsNCg0KY29uc3QgaHVtZVNvY2tldCA9IHRoaXNCb3QudmFycy5odW1lU29ja2V0Ow0KDQpjb25zb2xlLmxvZygiVXNlciBGb2N1cyBEYXRhIFNlbnQ6ICIsIGZvY3VzKQ0KaWYgKHRhZ3MuZGVidWdNb2RlID09IHRydWUpIHsNCiAgICBhYi5sb2coew0KICAgICAgICBtZXNzYWdlOiAiVXNlciBGb2N1cyBEYXRhIFNlbnQ6ICIgKyBKU09OLnN0cmluZ2lmeShmb2N1cyksDQogICAgICAgIG5hbWU6ICdjYXN1YWxvcycsDQogICAgICAgIHNwYWNlOiAic2hhcmVkIiwNCiAgICAgICAgbWVzc2FnZU9yaWdpbjogY29uZmlnQm90LmlkLA0KICAgIH0pOw0KfQ0KDQppZihodW1lU29ja2V0KSB7DQogICAgaHVtZVNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHRvb2xfcmVzcG9uc2UpKTsNCn0nANL2kLkPtg0HYWlDbGljawIEANL2kLkPrLwBe0Bjb25zdCBkYXRhID0gSlNPTi5wYXJzZSh0aGF0KTsNCg0KaWYgKCFkYXRhIHx8ICFkYXRhLmJvdCkgew0KICAgIHJldHVybjsNCn0NCg0Kd2hpc3BlcihnZXRCb3QoYnlJRChkYXRhLmJvdCkpLCAib25DbGljayIpOycA0vaQuQ+2DQ1jb21wbGV0ZVRvRG9zAgQA0vaQuQ+ovQHRFUBjb25zdCB0b0RvQm90cyA9IGdldEJvdHMoInRvRG8iLCB0cnVlKTsNCmxldCBhZ2VudEJvdCA9IGdldEJvdCgiYWdlbnRfYm90X3Rvb2wiLCB0cnVlKTsNCmlmICghYWdlbnRCb3QpIHsNCiAgICAvL2NyZWF0ZSBhZ2VudCBib3QNCiAgICBhd2FpdCBhYi5saW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7DQogICAgICAgIGFza0lEOiAnYWdlbnRfYm90X3Rvb2wnLA0KICAgICAgICBlZ2dQYXJhbWV0ZXJzOiB7DQogICAgICAgICAgICBncmlkSW5mb3JtYXRpb246IHsNCiAgICAgICAgICAgICAgICBkaW1lbnNpb246IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPz8gJ2hvbWUnLA0KICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgIHg6IDEsDQogICAgICAgICAgICAgICAgICAgIHk6IDANCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYWlNb2RlbDogYWJQZXJzb25hbGl0eS50YWdzLmFiUHJlZmVycmVkQUlNb2RlbCwNCiAgICAgICAgfQ0KICAgIH0pDQogICAgYWdlbnRCb3QgPSBnZXRCb3QoImFnZW50X2JvdF90b29sIiwgdHJ1ZSk7DQp9DQoNCmlmICghYWdlbnRCb3QpIHsNCiAgICBvcy50b2FzdCgiY291bGQgbm90IGZpbmQgb3IgY3JlYXRlIGFpIGFnZW50Iik7DQogICAgcmV0dXJuOw0KfQ0KDQpzZXRUYWdNYXNrKHRoaXNCb3QsICJsYXRlc3RJbnF1aXJ5IiwgdG9Eb0JvdHNbdG9Eb0JvdHMubGVuZ3RoIC0gMV0udGFncy5wcm9tcHQpOw0Kc2V0VGFnTWFzayh0aGlzQm90LCAibGF0ZXN0SW5xdWlyeUlEIiwgdGhhdC5pZCk7DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgdG9Eb0JvdHMubGVuZ3RoOyArK2kpIHsNCiAgICBjb25zdCBwcm9tcHQgPSB0b0RvQm90c1tpXS50YWdzLnByb21wdDsNCiAgICBpZiAoIXByb21wdCkgew0KICAgICAgICBjb250aW51ZTsNCiAgICB9DQoNCiAgICBjb25zdCB4UG9zID0gdG9Eb0JvdHNbaV0udGFnc1t0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiArICdYJ107DQogICAgY29uc3QgeVBvcyA9IHRvRG9Cb3RzW2ldLnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWSddOw0KDQogICAgY29uc3QgYWdlbnRYUG9zID0gKGFnZW50Qm90LnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWCddICYmIGFnZW50Qm90LnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWCddID4gdG9Eb0JvdHNbaV0udGFnc1t0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiArICdYJ10pID8gdG9Eb0JvdHNbaV0udGFnc1t0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiArICdYJ10gKyAzIDogdG9Eb0JvdHNbaV0udGFnc1t0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiArICdYJ10gLSAzOw0KICAgIGNvbnN0IGFnZW50WVBvcyA9IChhZ2VudEJvdC50YWdzW3RvRG9Cb3RzW2ldLnRhZ3MuZGltZW5zaW9uICsgJ1knXSAmJiBhZ2VudEJvdC50YWdzW3RvRG9Cb3RzW2ldLnRhZ3MuZGltZW5zaW9uICsgJ1knXSA+IHRvRG9Cb3RzW2ldLnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWSddKSA/IHRvRG9Cb3RzW2ldLnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWSddICsgMyA6IHRvRG9Cb3RzW2ldLnRhZ3NbdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gKyAnWSddIC0gMzsNCg0KICAgIGF3YWl0IHRoaXNCb3QubW92ZUJvdCh7DQogICAgICAgIGJvdDogYWdlbnRCb3QsDQogICAgICAgIGRpbWVuc2lvbjogdG9Eb0JvdHNbaV0udGFncy5kaW1lbnNpb24gPz8gJ2hvbWUnLA0KICAgICAgICBwb3NpdGlvbjogew0KICAgICAgICAgICAgeDogYWdlbnRYUG9zLA0KICAgICAgICAgICAgeTogYWdlbnRZUG9zDQogICAgICAgIH0NCiAgICB9KQ0KDQogICAgYXdhaXQgb3Muc2xlZXAoNTAwKTsNCg0KICAgIGxpbmtzLmFybV90b29sLmFiQ3JlYXRlQXJtKHsNCiAgICAgICAgb3JpZ2luQm90OiBhZ2VudEJvdCwNCiAgICAgICAgZGltZW5zaW9uOiB0b0RvQm90c1tpXS50YWdzLmRpbWVuc2lvbiwNCiAgICAgICAgcG9zaXRpb246IHsNCiAgICAgICAgICAgIHg6IHhQb3MsDQogICAgICAgICAgICB5OiB5UG9zLA0KICAgICAgICAgICAgejogMA0KICAgICAgICB9DQogICAgfSkNCiAgICBhd2FpdCBvcy5zbGVlcCgxMDAwKTsNCg0KICAgIGNvbnN0IHJlcXVlc3REYXRhID0ge307DQogICAgaWYgKGFnZW50Qm90LmxpbmtzLmFybUJvdCkgew0KICAgICAgICBjb25zdCBhcm1Cb3QgPSBhZ2VudEJvdC5saW5rcy5hcm1Cb3Q7DQogICAgICAgIGNvbnN0IGFybURpbWVuc2lvbiA9IGFybUJvdC50YWdzLmRpbWVuc2lvbjsNCg0KICAgICAgICByZXF1ZXN0RGF0YS5hcm1EaW1lbnNpb24gPSBhcm1EaW1lbnNpb247DQogICAgICAgIHJlcXVlc3REYXRhLmFybURpbWVuc2lvblggPSBhcm1Cb3QudGFnc1thcm1EaW1lbnNpb24gKyAiWCJdOw0KICAgICAgICByZXF1ZXN0RGF0YS5hcm1EaW1lbnNpb25ZID0gYXJtQm90LnRhZ3NbYXJtRGltZW5zaW9uICsgIlkiXTsNCiAgICB9DQoNCiAgICBhZ2VudEJvdC5tYXNrcy50YXJnZXRCb3QgPSBnZXRMaW5rKHRvRG9Cb3RzW2ldKTsNCiAgICBhZ2VudEJvdC5tYXNrcy5wcm9tcHRUeXBlID0gJ2dyaWQnOw0KICAgIGFnZW50Qm90LmFnZW50T25SZXF1ZXN0KHsNCiAgICAgICAgaW5xdWlyeTogcHJvbXB0LA0KICAgICAgICBkYXRhOiByZXF1ZXN0RGF0YSwgDQogICAgICAgIG1vZGVsOiBhZ2VudEJvdC50YWdzLmFpTW9kZWwNCiAgICB9KTsNCg0KICAgIGF3YWl0IG9zLnNsZWVwKDEwMDApOw0KfScA0vaQuQ+2DQhhcm1fdG9vbAIEANL2kLkP+tIBKPCflJczYzc0YzlmMS04MmRjLTQ2NTUtOGIzOC1lN2YxMWRlODk3OGUnANL2kLkPtg0KaGFuZFJhaXNlZAIEANL2kLkPodMBBWZhbHNlJwDS9pC5D7YND29uQUJJbml0aWFsaXplZAIEANL2kLkPp9MBGEB0YWdzLmRlYnVnTW9kZSA9IGZhbHNlOycA0vaQuQ+2DQdhYlZvaWNlAgQA0vaQuQ/A0wEEdHJ1ZScA0vaQuQ+2DQlhYlZlcnNpb24CBADS9pC5D8XTAQUxMC40MygA0vaQuQ+2DQlkZWJ1Z01vZGUBeScA0vaQuQ+2DRBvbkFCUGF0Y2hBcHByb3ZlAgQA0vaQuQ/M0wG8AkBpZiAodGhhdC5hYlBhdGNoQXNrSW5wdXQ/LmlucXVpcnkgPT0gdGFncy5sYXRlc3RJbnF1aXJ5KSB7DQogICAgY29uc3QgYWdlbnRCb3QgPSBnZXRCb3QoYnlJRCh0aGF0LmFiUGF0Y2hBc2tJbnB1dD8uYWJCb3QpKTsNCiAgICBpZiAoYWdlbnRCb3QgJiYgYWdlbnRCb3QudGFncy5hZ2VudF9ib3RfdG9vbCkgew0KICAgICAgICBkZXN0cm95KGFnZW50Qm90KTsNCiAgICB9DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAibGF0ZXN0SW5xdWlyeSIsIG51bGwpOw0KICAgIHNldFRhZ01hc2sodGhpc0JvdCwgImxhdGVzdElucXVpcnlJRCIsIG51bGwpOyANCn0nANL2kLkPtg0Qb25BQlBhdGNoQXBwbGllZAIEANL2kLkPidYBiwJAY29uc3QgcHJvbXB0ID0gdGhhdC5hYlBhdGNoQXNrSW5wdXQ/LmlucXVpcnk7DQpjb25zdCB0b0RvQm90ID0gZ2V0Qm90KGJ5VGFnKCJ0b0RvIiwgdHJ1ZSksIGJ5VGFnKCJwcm9tcHQiLCBwcm9tcHQpKTsNCmlmICh0b0RvQm90KSB7DQogICAgZGVzdHJveSh0b0RvQm90KTsNCn0NCg0KaWYgKHRhZ3MubGF0ZXN0SW5xdWlyeSA9PSBwcm9tcHQpIHsNCiAgICB0aGlzQm90LnNlbmRUb29sQ29tcGxldGVNZXNzYWdlKHtpZDogdGFncy5sYXRlc3RJbnF1aXJ5SUR9KTsNCn0nANL2kLkPtg0Pb25BQlBhdGNoRmFpbGVkAgQA0vaQuQ+V2AGTAkBjb25zdCBwcm9tcHQgPSB0aGF0LmFiUGF0Y2hBc2tJbnB1dD8uaW5xdWlyeTsNCg0KaWYgKHRhZ3MubGF0ZXN0SW5xdWlyeSA9PSBwcm9tcHQpIHsNCiAgICB0aGlzQm90LnNlbmRUb29sQ29tcGxldGVNZXNzYWdlKHtpZDogdGFncy5sYXRlc3RJbnF1aXJ5SUQsIGNvbnRlbnQ6ICJmYWlsZWQifSk7DQoNCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJsYXRlc3RJbnF1aXJ5IiwgbnVsbCk7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAibGF0ZXN0SW5xdWlyeUlEIiwgbnVsbCk7DQp9JwDS9pC5D7YNDW9uQUJQYXRjaFVuZG8CBADS9pC5D6naAbwCQGlmICh0aGF0LmFiUGF0Y2hBc2tJbnB1dD8uaW5xdWlyeSA9PSB0YWdzLmxhdGVzdElucXVpcnkpIHsNCiAgICBjb25zdCBhZ2VudEJvdCA9IGdldEJvdChieUlEKHRoYXQuYWJQYXRjaEFza0lucHV0Py5hYkJvdCkpOw0KICAgIGlmIChhZ2VudEJvdCAmJiBhZ2VudEJvdC50YWdzLmFnZW50X2JvdF90b29sKSB7DQogICAgICAgIGRlc3Ryb3koYWdlbnRCb3QpOw0KICAgIH0NCiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJsYXRlc3RJbnF1aXJ5IiwgbnVsbCk7DQogICAgc2V0VGFnTWFzayh0aGlzQm90LCAibGF0ZXN0SW5xdWlyeUlEIiwgbnVsbCk7IA0KfScA0vaQuQ+2DQdtb3ZlQm90AgQA0vaQuQ/m3AGgB0ANCnRoYXQuYm90LnRhZ3NbdGhhdC5kaW1lbnNpb25dID0gdHJ1ZTsNCg0KY29uc3QgcHJldlggPSB0aGF0LmJvdC50YWdzW3RoYXQuZGltZW5zaW9uICsgJ1gnXSA/PyAwOw0KY29uc3QgcHJldlkgPSB0aGF0LmJvdC50YWdzW3RoYXQuZGltZW5zaW9uICsgJ1knXSA/PyAwOw0KDQpjb25zdCBkaXN0YW5jZSA9IE1hdGguc3FydChNYXRoLnBvdygodGhhdC5wb3NpdGlvbi54IC0gcHJldlgpLCAyKSArIE1hdGgucG93KCh0aGF0LnBvc2l0aW9uLnkgLSBwcmV2WSksIDIpKTsNCmxldCBzcGVlZCA9IDAuMDU7DQoNCmlmIChjb25maWdCb3QudGFncy5tYXBQb3J0YWwpIHsNCiAgICBzcGVlZCA9IDUwMDsNCn0NCg0KbGV0IGR1ciA9IGRpc3RhbmNlICogc3BlZWQ7DQoNCmlmIChkaXN0YW5jZSA+IDMwKSB7DQogICAgZHVyID0gMjsNCn0NCg0KaWYgKGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCkgew0KICAgIGlmIChkaXN0YW5jZSA+IC4xKSB7DQogICAgICAgIGR1ciA9IDI7DQogICAgfQ0KfQ0KDQpjbGVhckFuaW1hdGlvbnModGhhdC5ib3QpOw0KYXdhaXQgYW5pbWF0ZVRhZyh0aGF0LmJvdCwgew0KICAgIGZyb21WYWx1ZTogew0KICAgICAgICBbdGhhdC5kaW1lbnNpb24gKyAnWCddOiB0aGF0LmJvdC50YWdzW3RoYXQuZGltZW5zaW9uICsgJ1gnXSA/PyAwLA0KICAgICAgICBbdGhhdC5kaW1lbnNpb24gKyAnWSddOiB0aGF0LmJvdC50YWdzW3RoYXQuZGltZW5zaW9uICsgJ1knXSA/PyAwLA0KICAgIH0sDQogICAgdG9WYWx1ZTogew0KICAgICAgICBbdGhhdC5kaW1lbnNpb24gKyAnWCddOiB0aGF0LnBvc2l0aW9uLngsDQogICAgICAgIFt0aGF0LmRpbWVuc2lvbiArICdZJ106IHRoYXQucG9zaXRpb24ueSwNCiAgICB9LA0KICAgIGR1cmF0aW9uOiBkdXIsDQogICAgdGFnTWFza1NwYWNlOiAnc2hhcmVkJw0KfSk7DQoNCnJldHVybjsA"}]}