{"version":1,"state":{"128250dd-c910-4c48-adb2-2ee97de8f628":{"id":"128250dd-c910-4c48-adb2-2ee97de8f628","space":"shared","tags":{"creator":"34c3c210-5bf1-49cf-b151-ee2d07f0e673","abIDOrigin":"erGeoArtifact","abIDStudio":"a144b2cf-c860-437c-92ec-db6bd2c0e5ef","addGeoArtifactMenuItem":"@//adding custom menu, with additional tags\r\nlet additionalTags = that;\r\nlet menuButton = {\r\n    space: \"tempLocal\",\r\n    geoArtifact: `ðŸ”—${tags.id}`,\r\n    color: tags.artifactMenuButtonColor,\r\n    geoArtifactTool: true,\r\n    pointable: false,\r\n    geoArtifactMenuReset: \"@ destroy(thisBot)\",\r\n    draggable: false,\r\n    geoArtifactConfigMenu: true,\r\n}\r\n\r\nfor (const tag in additionalTags) {\r\n    menuButton[tag] = additionalTags[tag];\r\n}\r\n\r\nif (!ab.links.menu) {\r\n    // Load abInterface skill if ab.links.menu is not available.\r\n    await ab.abAdapt('abInterface');\r\n}\r\n\r\n// Call abCreateMenuButton to make the menu button bot.\r\nab.links.menu.abCreateMenuButton(menuButton);","artifactLocked":false,"artifactMenuButtonColor":"#4BB7E6","color":"#4BB7E6","createGeoArtifactMenu":"@//Creating a prompt menu\r\nconfigBot.tags.menuPortal = \"geoArtifactConfigMenu\";\r\n\r\nthisBot.resetGeoArtifactMenu();\r\n\r\nconst titleConfig = {\r\n    formAddress: tags.artifactLocked ? \"\" : \"edit\",\r\n    form: tags.artifactLocked ? \"\" : tags.editingTitle ? \"input\" : \"\",\r\n    label: tags.artifactLocked || !tags.editingTitle ? tags.artifactTitle ?? \"title\" : \"title\",\r\n    onSubmit: `@\r\n        links.geoArtifact.tags.editingTitle = false;\r\n        links.geoArtifact.tags.artifactTitle = that.text;\r\n        links.geoArtifact.createGeoArtifactMenu();`,\r\n    onCreate: !tags.artifactLocked ? `@setTagMask(thisBot, \"menuItemText\", \"${tags.artifactTitle ?? \"\"}\", \"tempLocal\");` : \"\",\r\n    onClick: `@if (${!tags.artifactLocked}) {\r\n        if (${!tags.editingTitle}) {\r\n            links.geoArtifact.tags.editingDescription = false;\r\n            links.geoArtifact.tags.editingLink = false;\r\n            links.geoArtifact.tags.editingLocation = false;\r\n            links.geoArtifact.tags.editingTitle = true;\r\n            links.geoArtifact.createGeoArtifactMenu();\r\n        }\r\n    }\r\n    `\r\n}\r\nconst descriptionConfig = {\r\n    formAddress: tags.artifactLocked ? \"\" : \"edit\",\r\n    form: tags.artifactLocked ? \"\" : tags.editingDescription ? \"input\" : \"\",\r\n    formSubtype: \"multiline\",\r\n    label: tags.artifactLocked || !tags.editingDescription ? tags.artifactDescription ?? \"story\" : \"story\",\r\n    onSubmit: `@\r\n        links.geoArtifact.tags.editingDescription = false;\r\n        links.geoArtifact.tags.artifactDescription = that.text;\r\n        links.geoArtifact.createGeoArtifactMenu();`,\r\n    onCreate: !tags.artifactLocked ? `@setTagMask(thisBot, \"menuItemText\", \"${tags.artifactDescription ?? \"\"}\", \"tempLocal\");` : \"\",\r\n    onClick: `@if (${!tags.artifactLocked}) {\r\n        if (${!tags.editingDescription}) {\r\n            links.geoArtifact.tags.editingDescription = true;\r\n            links.geoArtifact.tags.editingLink = false;\r\n            links.geoArtifact.tags.editingLocation = false;\r\n            links.geoArtifact.tags.editingTitle = false;\r\n            links.geoArtifact.createGeoArtifactMenu();\r\n        }\r\n    }\r\n    `\r\n}\r\n\r\nconst viewRecord = {\r\n    formAddress: tags.artifactLocked ? \"\" : \"edit\",\r\n    form: tags.artifactLocked ? \"\" : tags.editingLink ? \"input\" : \"\",\r\n    label: tags.artifactLocked ? \"view record\" : !tags.editingLink ? tags.artifactLink ?? \"link\" : \"link\",\r\n    onSubmit: `@\r\n        links.geoArtifact.tags.editingLink = false;\r\n        links.geoArtifact.tags.artifactLink = that.text;\r\n        links.geoArtifact.createGeoArtifactMenu();`,\r\n    onCreate: !tags.artifactLocked ? `@setTagMask(thisBot, \"menuItemText\", \"${tags.artifactLink ?? \"\"}\", \"tempLocal\");` : \"\",\r\n    onClick: `@\r\n            if (${tags.artifactLocked}) {\r\n                os.openURL(\"${tags.artifactLink}\");\r\n            } \r\n            else {\r\n                if (${!tags.editingLink}) {\r\n                    links.geoArtifact.tags.editingDescription = false;\r\n                    links.geoArtifact.tags.editingLink = true;\r\n                    links.geoArtifact.tags.editingLocation = false;\r\n                    links.geoArtifact.tags.editingTitle = false;\r\n                    links.geoArtifact.createGeoArtifactMenu();\r\n                }\r\n            }`,\r\n    pointable: true\r\n}\r\n\r\nconst geoLocation = {\r\n    formAddress: tags.artifactLocked ? \"\" : \"edit\",\r\n    form: tags.artifactLocked ? \"\" : tags.editingLocation ? \"input\" : \"\",\r\n    label: tags.artifactLocked || !tags.editingLocation ? (tags.latitude && tags.longitude) ? tags.longitude + \", \" + tags.latitude : \"location\" : \"location: longitude, latitude\",\r\n    onSubmit: `@\r\n        links.geoArtifact.tags.editingLocation = false;\r\n        const curPortName = configBot.tags.mapPortal ?? configBot.tags.gridPortal;\r\n        links.geoArtifact.tags[curPortName + \"X\"] = that.text.split(\",\")[0].replace(\" \", \"\");\r\n        links.geoArtifact.tags[curPortName + \"Y\"] = that.text.split(\",\")[1].replace(\" \", \"\");\r\n        links.geoArtifact.updateLatitudeLongitude(curPortName);\r\n    `,\r\n    onCreate: !tags.artifactLocked ? `@setTagMask(thisBot, \"menuItemText\", \"${tags.longitude != undefined && tags.latitude != undefined ? tags.longitude + \", \" + tags.latitude : \"\"}\", \"tempLocal\");` : \"\",\r\n    onClick: `@if (${!tags.artifactLocked}) {\r\n        if (${!tags.editingLocation}) {\r\n            links.geoArtifact.tags.editingDescription = false;\r\n            links.geoArtifact.tags.editingLink = false;\r\n            links.geoArtifact.tags.editingLocation = true;\r\n            links.geoArtifact.tags.editingTitle = false;\r\n            links.geoArtifact.createGeoArtifactMenu();\r\n        }\r\n    }\r\n    `\r\n}\r\n\r\nconst lockUnlock = {\r\n    formAddress: \"lock\",\r\n    label:  tags.artifactLocked ? \"unlock\" : \"lock\",\r\n    onClick: `@\r\n                links.geoArtifact.tags.artifactLocked = ${tags.artifactLocked ? false : true}; \r\n                links.geoArtifact.createGeoArtifactMenu();\r\n                links.geoArtifact.tags.draggable = ${tags.artifactLocked ? true : false};`,\r\n}\r\n\r\nawait thisBot.addGeoArtifactMenuItem(titleConfig);\r\nawait thisBot.addGeoArtifactMenuItem(descriptionConfig);\r\nawait thisBot.addGeoArtifactMenuItem(viewRecord);\r\nawait thisBot.addGeoArtifactMenuItem(geoLocation);\r\nawait thisBot.addGeoArtifactMenuItem(lockUnlock);\r\n\r\nsetTagMask(thisBot, \"menuOpen\", true, \"tempLocal\");","draggable":true,"editingDescription":false,"editingLink":false,"editingLocation":false,"editingTitle":false,"home":true,"homeX":-85.67174035461935,"homeY":42.964684684684684,"homeZ":0,"listening":true,"menuOpen":false,"onBotChanged":"@const dimension = configBot.tags.mapPortal ?? configBot.tags.gridPortal;\r\n\r\nif (!dimension) {\r\n    return;\r\n}\r\n\r\nif (that.tags.includes(dimension + \"X\") || that.tags.includes(dimension + \"Y\")) {\r\n    tags.longitude = tags[dimension + \"X\"];\r\n    tags.latitude = tags[dimension + \"Y\"];\r\n}","onClick":"@thisBot.createGeoArtifactMenu();","onCreate":"@tags.artifactLocked = false;\r\ntags.artifactTitle = \"\";\r\ntags.artifactDescription = \"\";\r\ntags.artifactLink = \"\";\r\ntags.latitude = \"\";\r\ntags.longitude = \"\";\r\ntags.editingTitle = false;\r\ntags.editingDescription = false;\r\ntags.editingLink = false;\r\ntags.editingLocation = false;\r\ntags.menuOpen = false;\r\ntags.draggable = true;","onDestroy":"@thisBot.resetGeoArtifactMenu();","onDrop":"@const dimension = configBot.tags.mapPortal ?? configBot.tags.gridPortal;\r\n\r\nif (!dimension) {\r\n    return;\r\n}\r\n\r\ntags.longitude = tags[dimension + \"X\"];\r\ntags.latitude = tags[dimension + \"Y\"];\r\n\r\nif (tags.menuOpen && configBot.tags.menuPortal == \"geoArtifactConfigMenu\") {\r\n    thisBot.createGeoArtifactMenu();\r\n}\r\n","onEggHatch":"@applyMod(thisBot, that.eggParameters);","onGridClick":"@thisBot.resetGeoArtifactMenu();\r\n\r\ntags.editingTitle = false;\r\ntags.editingDescription = false;\r\ntags.editingLink = false;\r\ntags.editingLocation = false;","onPortalChanged":null,"resetGeoArtifactMenu":"@const menuBots = getBots(b=>{\r\n    if(b.tags.space == \"tempLocal\" && b.tags.geoArtifactTool == true){\r\n        return true;\r\n    }\r\n})\r\n\r\nwhisper(menuBots, \"geoArtifactMenuReset\");\r\nsetTagMask(thisBot, \"menuOpen\", false, \"tempLocal\");","updateLatitudeLongitude":"@if (!that) {\r\n    return;\r\n}\r\n\r\ntags.longitude = tags[that + \"X\"];\r\ntags.latitude = tags[that + \"Y\"];\r\n\r\nthisBot.createGeoArtifactMenu();","longitude":-85.67174035461935,"latitude":42.964684684684684,"system":"casual_kit.tool.geo artifact","geoArtifact":"true","abVersion":"10.5"}}}}