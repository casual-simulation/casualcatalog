{"version":2,"updates":[{"id":0,"timestamp":1758910125288,"update":"ATnH+dXjBgAnAQRib3RzJDUxNTY5NDhjLTEwYTktNGE5YS05MzE4LWQxYjI3NzhmOGNjNQEnAMf51eMGAAdjcmVhdG9yAgQAx/nV4wYBJDM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycAx/nV4wYABnN5c3RlbQIEAMf51eMGJhdhYkFydGlmYWN0V2l6YXJkLndpemFyZCcAx/nV4wYABWxhYmVsAgQAx/nV4wY+D2FydGlmYWN0IHdpemFyZCcAx/nV4wYABmN1cnNvcgIEAMf51eMGTgdwb2ludGVyJwDH+dXjBgALZm9ybU9wYWNpdHkCBADH+dXjBlYEMC4zMycAx/nV4wYAC3N0cm9rZUNvbG9yAgQAx/nV4wZbByNjMGIzZmMnAMf51eMGAA1sYWJlbFBvc2l0aW9uAgQAx/nV4wZjEWZsb2F0aW5nQmlsbGJvYXJkJwDH+dXjBgAHb25DbGljawIEAMf51eMGdVtAdGhpc0JvdC5hYkFydGlmYWN0V2l6YXJkTWVudU9wZW4oeyB3aXphcmRCb3Q6IHRoaXNCb3QsIHdpemFyZERpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24gfSk7JwDH+dXjBgAJYWJWZXJzaW9uAgQAx/nV4wbRAQUxMC4xMCcAx/nV4wYACm9uRWdnSGF0Y2gCBADH+dXjBtcBugNAaWYgKHRoYXQuZWdnUGFyYW1ldGVycykgewogICAgY29uc3QgZGltZW5zaW9uID0gdGhhdC5lZ2dQYXJhbWV0ZXJzLmdyaWRJbmZvcm1hdGlvbj8uZGltZW5zaW9uID8/ICdob21lJzsKICAgIGNvbnN0IGRpbWVuc2lvblggPSB0aGF0LmVnZ1BhcmFtZXRlcnMuZ3JpZEluZm9ybWF0aW9uPy5wb3NpdGlvbj8ueCA/PyAwOwogICAgY29uc3QgZGltZW5zaW9uWSA9IHRoYXQuZWdnUGFyYW1ldGVycy5ncmlkSW5mb3JtYXRpb24/LnBvc2l0aW9uPy55ID8/IDA7CgogICAgdGFnc1tkaW1lbnNpb25dID0gdHJ1ZTsKICAgIHRhZ3NbZGltZW5zaW9uICsgJ1gnXSA9IGRpbWVuc2lvblg7CiAgICB0YWdzW2RpbWVuc2lvbiArICdZJ10gPSBkaW1lbnNpb25ZOwoKICAgIHRoaXNCb3QuYWJBcnRpZmFjdFdpemFyZE1lbnVPcGVuKHsgd2l6YXJkRGltZW5zaW9uOiBkaW1lbnNpb24gfSk7Cn0KJwDH+dXjBgAPZGVzdHJveUFmdGVyVXNlAgQAx/nV4waSBQR0cnVlJwDH+dXjBgAIYWJJZ25vcmUCBADH+dXjBpcFBHRydWUnAMf51eMGABFsYWJlbFdvcmRXcmFwTW9kZQIEAMf51eMGnAUKYnJlYWtXb3JkcygAx/nV4wYAEGFiQXJ0aWZhY3RXaXphcmQBeCcAx/nV4wYABWNvbG9yAgQAx/nV4waoBQcjQUVBMUZGJwDH+dXjBgAcbGFiZWxGbG9hdGluZ0JhY2tncm91bmRDb2xvcgIEAMf51eMGsAUHI0FFQTFGRicAx/nV4wYACmxhYmVsQ29sb3ICBADH+dXjBrgFByMxZTFiMmQnAMf51eMGAAhyZW1lbWJlcgIEAMf51eMGwAUo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAx/nV4wYACGFydGlmYWN0AgQAx/nV4wbnBSjwn5SXNzhlNDE1MDMtYzkzMy00ZjhhLTgxN2EtYmE5N2JmOGQ1ZDI3JwDH+dXjBgAFbGVhcm4CBADH+dXjBo4GKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAMf51eMGABhhYkFydGlmYWN0V2l6YXJkTWVudU9wZW4CBADH+dXjBrUGkWxAY29uc3QgewogICAgd2l6YXJkRGltZW5zaW9uID0gYWIudGFncy5hYkluc3QsCn0gPSB0aGF0ID8/IHt9OwoKc2hvdXQoJ2FiQXJ0aWZhY3RXaXphcmRNZW51UmVzZXQnKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gJ2FiQXJ0aWZhY3RXaXphcmRNYWluTWVudSc7Cgpjb25zdCBhcnRpZmFjdEluc3RhbmNlczogUmVjb3JkPHN0cmluZywgQm90W10+ID0gbGlua3MuYXJ0aWZhY3QuYWJHZXRBcnRpZmFjdEluc3RhbmNlcygpOwpjb25zdCBhcnRpZmFjdFBhdHRlcm5zOiBSZWNvcmQ8c3RyaW5nLCBCb3RbXT4gPSBsaW5rcy5hcnRpZmFjdC5hYkdldEFydGlmYWN0UGF0dGVybnMoKTsKCmNvbnN0IGluc3RhbmNlSURzID0gT2JqZWN0LmtleXMoYXJ0aWZhY3RJbnN0YW5jZXMpOwpjb25zdCBwYXR0ZXJuTmFtZXMgPSBPYmplY3Qua2V5cyhhcnRpZmFjdFBhdHRlcm5zKTsKCmlmIChpbnN0YW5jZUlEcy5sZW5ndGggPT09IDAgJiYgcGF0dGVybk5hbWVzLmxlbmd0aCA9PT0gMCkgewogICAgbGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6IGBObyBhcnRpZmFjdHMgZm91bmQgaW4gdGhlIGluc3QuYCB9KQogICAgcmV0dXJuOwp9Cgpjb25zdCBhYkFydGlmYWN0QmFzZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkFydGlmYWN0QmFzZUNvbG9yID8/IGxpbmtzLmFydGlmYWN0LnRhZ3MuYWJBcnRpZmFjdEJhc2VDb2xvckRlZmF1bHQ7CmNvbnN0IGFiQXJ0aWZhY3RMYWJlbENvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkFydGlmYWN0TGFiZWxDb2xvciA/PyBsaW5rcy5hcnRpZmFjdC50YWdzLmFiQXJ0aWZhY3RMYWJlbENvbG9yRGVmYXVsdDsKCi8qKgogKiBNZW51IHBvcnRhbDogYWJBcnRpZmFjdFdpemFyZE1haW5NZW51CiAqLwoKY29uc3QgY3JlYXRlQnV0dG9uID0gbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgYWJBcnRpZmFjdFdpemFyZE1haW5NZW51OiB0cnVlLAogICAgZm9ybUFkZHJlc3M6ICdhZGRfYm94JywKICAgIGxhYmVsOiBgYXJ0aWZhY3QgYm90YCwKICAgIGNvbG9yOiBhYkFydGlmYWN0QmFzZUNvbG9yLAogICAgbGFiZWxDb2xvcjogYWJBcnRpZmFjdExhYmVsQ29sb3IsCiAgICB3aXphcmRCb3Q6IGdldExpbmsodGhpc0JvdCksCiAgICB3aXphcmREaW1lbnNpb24sCiAgICBhYkFydGlmYWN0V2l6YXJkTWVudVJlc2V0OiBgQGRlc3Ryb3kodGhpc0JvdClgLAogICAgb25BcnRpZmFjdFdpemFyZFNlbGVjdGlvbjogYEAKICAgICAgICBjb25zdCBhYkFydGlmYWN0TmFtZSA9IHRoYXQuYWJBcnRpZmFjdE5hbWU7CiAgICAgICAgbGV0IGFiQXJ0aWZhY3RJbnN0YW5jZUlEID0gdGhhdC5hYkFydGlmYWN0SW5zdGFuY2VJRDsKCiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbihsaW5rcy53aXphcmRCb3QsIHRhZ3Mud2l6YXJkRGltZW5zaW9uKTsKCiAgICAgICAgbGV0IGFiQXJ0aWZhY3RCb3QgPSBnZXRCb3QoKGIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGIudGFncy5hYkFydGlmYWN0TmFtZSA9PT0gYWJBcnRpZmFjdE5hbWUgJiYKICAgICAgICAgICAgICAgICAgIGIudGFncy5hYkFydGlmYWN0SW5zdGFuY2VJRCA9PT0gYWJBcnRpZmFjdEluc3RhbmNlSUQgJiYKICAgICAgICAgICAgICAgICAgIGIudGFncy5hYkFydGlmYWN0Qm90ID09PSB0cnVlCiAgICAgICAgfSkKCiAgICAgICAgaWYgKGFiQXJ0aWZhY3RCb3QpIHsKICAgICAgICAgICAgLy8gQWRkIGV4aXN0aW5nIGFydGlmYWN0IGJvdCB0byBjdXJyZW50IGRpbWVuc2lvbiBhbmQgcG9zaXRpb24uCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdleGlzdGluZyBhcnRpZmFjdCBib3QgdXNlZCcpOwogICAgICAgICAgICBhYkFydGlmYWN0Qm90LnRhZ3NbdGFncy53aXphcmREaW1lbnNpb25dID0gdHJ1ZTsKICAgICAgICAgICAgYWJBcnRpZmFjdEJvdC50YWdzW3RhZ3Mud2l6YXJkRGltZW5zaW9uICsgJ1gnXSA9IHBvc2l0aW9uLng7CiAgICAgICAgICAgIGFiQXJ0aWZhY3RCb3QudGFnc1t0YWdzLndpemFyZERpbWVuc2lvbiArICdZJ10gPSBwb3NpdGlvbi55OwogICAgICAgICAgICBhYkFydGlmYWN0Qm90LnRhZ3NbdGFncy53aXphcmREaW1lbnNpb24gKyAnWiddID0gcG9zaXRpb24uejsKCiAgICAgICAgICAgIGxpbmtzLndpemFyZEJvdC5saW5rcy5hcnRpZmFjdC5hYlVwZGF0ZUFydGlmYWN0U2hhcmRzKHsgYWJBcnRpZmFjdE5hbWUsIGFiQXJ0aWZhY3RJbnN0YW5jZUlEIH0pCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCFhYkFydGlmYWN0SW5zdGFuY2VJRCkgewogICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgYSBuZXcgaW5zdGFuY2UgaWQgYW5kIGFzc2lnbiBwYXR0ZXJuIGJvdHMgdG8gaXQsIHRoZXNlIHBhdHRlcm4gYm90cyBhcmUgbm93IHNoYXJkcyBvZiB0aGUgYXJ0aWZhY3QgaW5zdGFuY2UuCiAgICAgICAgICAgICAgICBhYkFydGlmYWN0SW5zdGFuY2VJRCA9IHV1aWQoKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhc3NpZ25pbmcgbmV3IGFydGlmYWN0IGluc3RhbmNlIGlkOicsIGFiQXJ0aWZhY3RJbnN0YW5jZUlEKTsKCiAgICAgICAgICAgICAgICBjb25zdCBwYXR0ZXJucyA9IGxpbmtzLndpemFyZEJvdC5saW5rcy5hcnRpZmFjdC5hYkdldEFydGlmYWN0UGF0dGVybnMoeyBhYkFydGlmYWN0TmFtZSB9KTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhdHRlcm5Cb3RzID0gcGF0dGVybnNbYWJBcnRpZmFjdE5hbWVdOwoKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcGF0dGVybkJvdCBvZiBwYXR0ZXJuQm90cykgewogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5Cb3QudGFncy5hYkFydGlmYWN0SW5zdGFuY2VJRCA9IGFiQXJ0aWZhY3RJbnN0YW5jZUlEOwogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5Cb3QudGFncy5hYkFydGlmYWN0U2hhcmRJbnN0YW5jZUlEID0gdXVpZCgpOwogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5Cb3QudGFncy5hYkFydGlmYWN0SW5zdGFuY2VPd25lciA9IGF1dGhCb3QuaWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCduZXcgYXJ0aWZhY3QgYm90IGNyZWF0ZWQnKTsKICAgICAgICAgICAgYWJBcnRpZmFjdEJvdCA9IGF3YWl0IGxpbmtzLndpemFyZEJvdC5saW5rcy5hcnRpZmFjdC5hYkNyZWF0ZUFydGlmYWN0Qm90KHsKICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3ROYW1lLAogICAgICAgICAgICAgICAgYWJBcnRpZmFjdEluc3RhbmNlSUQsCiAgICAgICAgICAgICAgICBkaW1lbnNpb246IHRhZ3Mud2l6YXJkRGltZW5zaW9uLAogICAgICAgICAgICAgICAgcG9zaXRpb24sCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGFiQXJ0aWZhY3RCb3QpIHsKICAgICAgICAgICAgaWYgKGxpbmtzLndpemFyZEJvdCAmJiBsaW5rcy53aXphcmRCb3QudGFncy5kZXN0cm95QWZ0ZXJVc2UgJiYgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCAhPT0gJ2FiQXJ0aWZhY3RXaXphcmQnKSB7CiAgICAgICAgICAgICAgICBkZXN0cm95KGxpbmtzLndpemFyZEJvdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2hvdXQoImFiQXJ0aWZhY3RXaXphcmRNZW51UmVzZXQiKTsKICAgIGAsCiAgICBvbkNsaWNrOiBgQAogICAgICAgIGlmICghYXV0aEJvdCkgewogICAgICAgICAgICBsaW5rcy53aXphcmRCb3QubGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6ICdZb3UgbXVzdCBiZSBsb2dnZWQgaW4gdG8gY3JlYXRlIGFuIGFydGlmYWN0IGluc3RhbmNlJywgbG9nVHlwZTogJ2Vycm9yJ30pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25maWdCb3QudGFncy5hYkFydGlmYWN0V2l6YXJkU2VsZWN0aW9uTWVudVRhcmdldCA9IGdldExpbmsodGhpc0JvdCk7CiAgICAgICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAnYWJBcnRpZmFjdFdpemFyZFNlbGVjdGlvbk1lbnUnOwogICAgYCwKfSkKCmNvbnN0IGRvd25sb2FkQnV0dG9uID0gbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgYWJBcnRpZmFjdFdpemFyZE1haW5NZW51OiB0cnVlLAogICAgZm9ybUFkZHJlc3M6ICdkb3dubG9hZCcsCiAgICBsYWJlbDogYGRvd25sb2FkIGFydGlmYWN0IHBhdHRlcm5gLAogICAgd2l6YXJkQm90OiBnZXRMaW5rKHRoaXNCb3QpLAogICAgY29sb3I6IGFiQXJ0aWZhY3RCYXNlQ29sb3IsCiAgICBsYWJlbENvbG9yOiBhYkFydGlmYWN0TGFiZWxDb2xvciwKICAgIGFiQXJ0aWZhY3RXaXphcmRNZW51UmVzZXQ6IGBAZGVzdHJveSh0aGlzQm90KWAsCiAgICBvbkFydGlmYWN0V2l6YXJkU2VsZWN0aW9uOiBgQAogICAgICAgIGNvbnN0IHsgYWJBcnRpZmFjdE5hbWUsIGFiQXJ0aWZhY3RJbnN0YW5jZUlEIH0gPSB0aGF0OwoKICAgICAgICBjb25zdCBzaGFyZEJvdHMgPSBnZXRCb3RzKGIgPT4gYi50YWdzLmFiQXJ0aWZhY3ROYW1lID09PSBhYkFydGlmYWN0TmFtZSAmJiBiLnRhZ3MuYWJBcnRpZmFjdEluc3RhbmNlSUQgPT09IGFiQXJ0aWZhY3RJbnN0YW5jZUlEICYmIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmICFiLnRhZ3MuYWJJZ25vcmUpOwoKICAgICAgICBpZiAoc2hhcmRCb3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgbGlua3Mud2l6YXJkQm90LmxpbmtzLmFydGlmYWN0LmFiRG93bmxvYWRBcnRpZmFjdFBhdHRlcm4oeyBhYkFydGlmYWN0TmFtZSwgc2hhcmRCb3RzIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxpbmtzLndpemFyZEJvdC5saW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KHsgbWVzc2FnZTogJ0NvdWxkIG5vdCBmaW5kIGFueSBzaGFyZCBib3RzLicgLCBsb2dUeXBlOiAnZXJyb3InIH0pCiAgICAgICAgfQoKICAgICAgICBpZiAobGlua3Mud2l6YXJkQm90LnRhZ3MuZGVzdHJveUFmdGVyVXNlICYmIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgIT09ICdhYkFydGlmYWN0V2l6YXJkJykgewogICAgICAgICAgICBkZXN0cm95KGxpbmtzLndpemFyZEJvdCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHNob3V0KCJhYkFydGlmYWN0V2l6YXJkTWVudVJlc2V0Iik7CiAgICBgLAogICAgb25DbGljazogYEAKICAgICAgICBjb25maWdCb3QudGFncy5hYkFydGlmYWN0V2l6YXJkU2VsZWN0aW9uTWVudVRhcmdldCA9IGdldExpbmsodGhpc0JvdCk7CiAgICAgICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAnYWJBcnRpZmFjdFdpemFyZFNlbGVjdGlvbk1lbnUnOwogICAgYCwKfSkKCmNvbnN0IHB1Ymxpc2hCdXR0b24gPSBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICBhYkFydGlmYWN0V2l6YXJkTWFpbk1lbnU6IHRydWUsCiAgICBmb3JtQWRkcmVzczogJ2lvc19zaGFyZScsCiAgICBsYWJlbDogYHB1Ymxpc2ggYXJ0aWZhY3QgcGF0dGVybmAsCiAgICBjb2xvcjogYWJBcnRpZmFjdEJhc2VDb2xvciwKICAgIHdpemFyZEJvdDogZ2V0TGluayh0aGlzQm90KSwKICAgIGxhYmVsQ29sb3I6IGFiQXJ0aWZhY3RMYWJlbENvbG9yLAogICAgYWJBcnRpZmFjdFdpemFyZE1lbnVSZXNldDogYEBkZXN0cm95KHRoaXNCb3QpYCwKICAgIG9uQXJ0aWZhY3RXaXphcmRTZWxlY3Rpb246IGBACiAgICAgICAgY29uc3QgeyBhYkFydGlmYWN0TmFtZSwgYWJBcnRpZmFjdEluc3RhbmNlSUQgfSA9IHRoYXQ7CgogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3RlZEFydGlmYWN0TmFtZSA9IGFiQXJ0aWZhY3ROYW1lOwogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3RlZEFydGlmYWN0SW5zdGFuY2VJRCA9IGFiQXJ0aWZhY3RJbnN0YW5jZUlEOwogICAgICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gJ2FiQXJ0aWZhY3RXaXphcmRQdWJsaXNoTWVudSc7CiAgICBgLAogICAgb25DbGljazogYEAgICAgICAgIAogICAgICAgIGlmICghYXV0aEJvdCkgewogICAgICAgICAgICBsaW5rcy53aXphcmRCb3QubGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6ICdZb3UgbXVzdCBiZSBsb2dnZWQgaW4gdG8gcHVibGlzaCBhbiBhcnRpZmFjdCBwYXR0ZXJuJywgbG9nVHlwZTogJ2Vycm9yJ30pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3Rpb25NZW51VGFyZ2V0ID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICdhYkFydGlmYWN0V2l6YXJkU2VsZWN0aW9uTWVudSc7CiAgICBgLAp9KQoKLyoqCiAqIE1lbnUgcG9ydGFsOiBhYkFydGlmYWN0V2l6YXJkU2VsZWN0aW9uTWVudQogKi8KCmNvbnN0IHNlbGVjdGlvbk9wdGlvbnM6IHsgbmFtZTogc3RyaW5nLCBpbnN0YW5jZUlEPzogc3RyaW5nfVtdID0gW107Cgpmb3IgKGNvbnN0IGluc3RhbmNlSUQgb2YgaW5zdGFuY2VJRHMpIHsKICAgIGNvbnN0IHNoYXJkQm90ID0gYXJ0aWZhY3RJbnN0YW5jZXNbaW5zdGFuY2VJRF1bMF07CgogICAgc2VsZWN0aW9uT3B0aW9ucy5wdXNoKHsgbmFtZTogc2hhcmRCb3QudGFncy5hYkFydGlmYWN0TmFtZSwgaW5zdGFuY2VJRCB9KQp9Cgpmb3IgKGNvbnN0IHBhdHRlcm5OYW1lIG9mIHBhdHRlcm5OYW1lcykgewogICAgc2VsZWN0aW9uT3B0aW9ucy5wdXNoKHsgbmFtZTogcGF0dGVybk5hbWUgfSk7Cn0KCi8vIFNvcnQgYWxwaGFiZXRpY2FsbHkgYnkgbmFtZSBmaXJzdCwgdGhlbiBieSBpbnN0YW5jZUlECnNlbGVjdGlvbk9wdGlvbnMuc29ydCgoYSwgYikgPT4gewogICAgY29uc3QgbmFtZUNvbXBhcmlzb24gPSBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpOwogICAgCiAgICAvLyBJZiBuYW1lcyBhcmUgdGhlIHNhbWUsIGNvbXBhcmUgYnkgaW5zdGFuY2VJRAogICAgaWYgKG5hbWVDb21wYXJpc29uID09PSAwKSB7CiAgICAgICAgaWYgKGEuaW5zdGFuY2VJRCAmJiBiLmluc3RhbmNlSUQpIHsKICAgICAgICAgICAgcmV0dXJuIGEuaW5zdGFuY2VJRC5sb2NhbGVDb21wYXJlKGIuaW5zdGFuY2VJRCk7CiAgICAgICAgfSBlbHNlIGlmIChhLmluc3RhbmNlSUQgJiYgIWIuaW5zdGFuY2VJRCkgewogICAgICAgICAgICByZXR1cm4gLTE7IC8vIEl0ZW1zIHdpdGggaW5zdGFuY2VJRCBjb21lIGJlZm9yZSB0aG9zZSB3aXRob3V0CiAgICAgICAgfSBlbHNlIGlmICghYS5pbnN0YW5jZUlEICYmIGIuaW5zdGFuY2VJRCkgewogICAgICAgICAgICByZXR1cm4gMTsgLy8gSXRlbXMgd2l0aG91dCBpbnN0YW5jZUlEIGNvbWUgYWZ0ZXIgdGhvc2Ugd2l0aAogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsgLy8gQm90aCBkb24ndCBoYXZlIGluc3RhbmNlSUQKICAgIH0KICAgIAogICAgcmV0dXJuIG5hbWVDb21wYXJpc29uOwp9KTsKCgpmb3IgKGNvbnN0IG9wdGlvbiBvZiBzZWxlY3Rpb25PcHRpb25zKSB7CiAgICBsZXQgbGFiZWwgPSBvcHRpb24ubmFtZTsKICAgIGlmIChvcHRpb24uaW5zdGFuY2VJRCkgewogICAgICAgIGxhYmVsICs9IGAgKGluc3QgaWQ6ICR7b3B0aW9uLmluc3RhbmNlSUQuc3Vic3RyaW5nKDAsIDcpfSlgOwogICAgfQoKICAgIGNvbnN0IG9wdGlvbkJ1dHRvbiA9IGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgICAgICBhYkFydGlmYWN0V2l6YXJkU2VsZWN0aW9uTWVudTogdHJ1ZSwKICAgICAgICBsYWJlbCwKICAgICAgICBuYW1lOiBvcHRpb24ubmFtZSwKICAgICAgICBpbnN0YW5jZUlEOiBvcHRpb24uaW5zdGFuY2VJRCwKICAgICAgICBjb2xvcjogYWJBcnRpZmFjdEJhc2VDb2xvciwKICAgICAgICBsYWJlbENvbG9yOiBhYkFydGlmYWN0TGFiZWxDb2xvciwKICAgICAgICBhYkFydGlmYWN0V2l6YXJkTWVudVJlc2V0OiBgQGRlc3Ryb3kodGhpc0JvdClgLAogICAgICAgIG9uUG9ydGFsQ2hhbmdlZDogYEAKICAgICAgICAgICAgaWYgKHRoYXQucG9ydGFsICE9PSAnbWVudVBvcnRhbCcgJiYgdGhhdC5kaW1lbnNpb24gIT09ICdhYkFydGlmYWN0V2l6YXJkU2VsZWN0aW9uTWVudScpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3RlZEFydGlmYWN0TmFtZSA9PT0gdGFncy5uYW1lICYmIAogICAgICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MuYWJBcnRpZmFjdFdpemFyZFNlbGVjdGVkQXJ0aWZhY3RJbnN0YW5jZUlEID09PSB0YWdzLmluc3RhbmNlSUQKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ3JhZGlvX2J1dHRvbl9jaGVja2VkJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAncmFkaW9fYnV0dG9uX3VuY2hlY2tlZCc7CiAgICAgICAgICAgIH0KICAgICAgICBgLAogICAgICAgIG9uQ2xpY2s6IGBACiAgICAgICAgICAgIHdoaXNwZXIoY29uZmlnQm90LmxpbmtzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3Rpb25NZW51VGFyZ2V0LCAnb25BcnRpZmFjdFdpemFyZFNlbGVjdGlvbicsIHsgYWJBcnRpZmFjdE5hbWU6IHRhZ3MubmFtZSwgYWJBcnRpZmFjdEluc3RhbmNlSUQ6IHRhZ3MuaW5zdGFuY2VJRCB9KTsKICAgICAgICBgLAogICAgfSkKfQoKLyoqCiAqIE1lbnUgcG9ydGFsOiBhYkFydGlmYWN0V2l6YXJkUHVibGlzaE1lbnUKICovCgpjb25zdCBuYW1lQnV0dG9uID0gbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgYWJBcnRpZmFjdFdpemFyZFB1Ymxpc2hNZW51OiB0cnVlLAogICAgZm9ybUFkZHJlc3M6ICdyYWRpb19idXR0b25fY2hlY2tlZCcsCiAgICBwdWJsaXNoQnV0dG9uOiBnZXRMaW5rKHB1Ymxpc2hCdXR0b24pLAogICAgY29sb3I6IGFiQXJ0aWZhY3RCYXNlQ29sb3IsCiAgICBsYWJlbENvbG9yOiBhYkFydGlmYWN0TGFiZWxDb2xvciwKICAgIGFiQXJ0aWZhY3RXaXphcmRNZW51UmVzZXQ6IGBAZGVzdHJveSh0aGlzQm90KWAsCiAgICBvblBvcnRhbENoYW5nZWQ6IGBACiAgICAgICAgaWYgKHRoYXQucG9ydGFsICE9PSAnbWVudVBvcnRhbCcgJiYgdGhhdC5kaW1lbnNpb24gIT09ICdhYkFydGlmYWN0V2l6YXJkUHVibGlzaE1lbnUnKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3RlZEFydGlmYWN0TmFtZSAmJgogICAgICAgICAgICBjb25maWdCb3QudGFncy5hYkFydGlmYWN0V2l6YXJkU2VsZWN0ZWRBcnRpZmFjdEluc3RhbmNlSUQKICAgICAgICApIHsKICAgICAgICAgICAgdGFncy5sYWJlbCA9IGNvbmZpZ0JvdC50YWdzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3RlZEFydGlmYWN0TmFtZSArICcgKGluc3QgaWQ6ICcgKyBjb25maWdCb3QudGFncy5hYkFydGlmYWN0V2l6YXJkU2VsZWN0ZWRBcnRpZmFjdEluc3RhbmNlSUQuc3Vic3RyaW5nKDAsIDcpICsgJyknOwogICAgICAgIH0gZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MuYWJBcnRpZmFjdFdpemFyZFNlbGVjdGVkQXJ0aWZhY3ROYW1lKSB7CiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSBjb25maWdCb3QudGFncy5hYkFydGlmYWN0V2l6YXJkU2VsZWN0ZWRBcnRpZmFjdE5hbWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdTZWxlY3QgYW4gYXJ0aWZhY3QnOwogICAgICAgIH0KICAgIGAsCiAgICBvbkNsaWNrOiBgQAogICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3Rpb25NZW51VGFyZ2V0ID0gZ2V0TGluayhsaW5rcy5wdWJsaXNoQnV0dG9uKTsKICAgICAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICdhYkFydGlmYWN0V2l6YXJkU2VsZWN0aW9uTWVudSc7CiAgICBgLAp9KQoKY29uc3Qgc3R1ZGlvQnV0dG9uID0gbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgYWJBcnRpZmFjdFdpemFyZFB1Ymxpc2hNZW51OiB0cnVlLAogICAgZm9ybUFkZHJlc3M6ICdpbnZlbnRvcnlfMicsCiAgICBjb2xvcjogYWJBcnRpZmFjdEJhc2VDb2xvciwKICAgIGxhYmVsQ29sb3I6IGFiQXJ0aWZhY3RMYWJlbENvbG9yLAogICAgd2l6YXJkQm90OiBnZXRMaW5rKHRoaXNCb3QpLAogICAgYWJBcnRpZmFjdFdpemFyZE1lbnVSZXNldDogYEBkZXN0cm95KHRoaXNCb3QpYCwKICAgIG9uUG9ydGFsQ2hhbmdlZDogYEAKICAgICAgICBpZiAodGhhdC5wb3J0YWwgIT09ICdtZW51UG9ydGFsJyAmJiB0aGF0LmRpbWVuc2lvbiAhPT0gJ2FiQXJ0aWZhY3RXaXphcmRQdWJsaXNoTWVudScpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbGV0IGZvdW5kUmVjb3JkS2V5OwoKICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MuYWJBcnRpZmFjdFdpemFyZFNlbGVjdGVkQXJ0aWZhY3ROYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IGFydGlmYWN0QnVuZGxlcyA9IGxpbmtzLndpemFyZEJvdC5saW5rcy5hcnRpZmFjdC5hYkZpbmRBcnRpZmFjdEJ1bmRsZXMoeyAKICAgICAgICAgICAgICAgIGFiQXJ0aWZhY3ROYW1lOiBjb25maWdCb3QudGFncy5hYkFydGlmYWN0V2l6YXJkU2VsZWN0ZWRBcnRpZmFjdE5hbWUsCiAgICAgICAgICAgICAgICBhYkFydGlmYWN0SW5zdGFuY2VJRDogY29uZmlnQm90LnRhZ3MuYWJBcnRpZmFjdFdpemFyZFNlbGVjdGVkQXJ0aWZhY3RJbnN0YW5jZUlECiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIGFydGlmYWN0QnVuZGxlcykgewogICAgICAgICAgICAgICAgY29uc3QgYXJ0aWZhY3RCdW5kbGUgPSBhcnRpZmFjdEJ1bmRsZXNba2V5XTsKCiAgICAgICAgICAgICAgICBpZiAoYXJ0aWZhY3RCdW5kbGUuZGVwZW5kZW5jaWVzICYmIGFydGlmYWN0QnVuZGxlLmRlcGVuZGVuY2llcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hpbmdEZXAgPSBhcnRpZmFjdEJ1bmRsZS5kZXBlbmRlbmNpZXMuZmluZChkID0+IGQuYWJJRCA9PT0gY29uZmlnQm90LnRhZ3MuYWJBcnRpZmFjdFdpemFyZFNlbGVjdGVkQXJ0aWZhY3ROYW1lICYmIGQucmVjb3JkS2V5KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoaW5nRGVwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kUmVjb3JkS2V5ID0gbWF0Y2hpbmdEZXAucmVjb3JkS2V5OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChmb3VuZFJlY29yZEtleSkgewogICAgICAgICAgICB0YWdzLnJlY29yZEtleSA9IGZvdW5kUmVjb3JkS2V5OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZ3MucmVjb3JkS2V5ID0gYXV0aEJvdC5pZDsKICAgICAgICB9CiAgICBgLAogICAgb25DbGljazogYEAKICAgICAgICBjb25zdCBpbnB1dCA9IGF3YWl0IG9zLnNob3dJbnB1dCh0YWdzLnJlY29yZEtleSwgeyBhdXRvU2VsZWN0OiB0cnVlLCB0aXRsZTogJ3N0dWRpbyByZWNvcmQga2V5JyB9KTsKCiAgICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgICAgIHRhZ3MucmVjb3JkS2V5ID0gaW5wdXQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5yZWNvcmRLZXkgPSBhdXRoQm90LmlkOwogICAgICAgIH0KICAgIGAsCiAgICBvbkJvdENoYW5nZWQ6IGBACiAgICAgICAgY29uc3QgY2hhbmdlZFRhZ3MgPSB0aGF0LnRhZ3M7CgogICAgICAgIGlmIChjaGFuZ2VkVGFncy5pbmNsdWRlcygncmVjb3JkS2V5JykpIHsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdzdHVkaW89JyArIHRhZ3MucmVjb3JkS2V5OwogICAgICAgIH0KICAgIGAsCn0pCgpjb25zdCBzdWJtaXRCdXR0b24gPSBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICBhYkFydGlmYWN0V2l6YXJkUHVibGlzaE1lbnU6IHRydWUsCiAgICBmb3JtQWRkcmVzczogJ3B1Ymxpc2gnLAogICAgY29sb3I6IGFiQXJ0aWZhY3RCYXNlQ29sb3IsCiAgICBsYWJlbENvbG9yOiBhYkFydGlmYWN0TGFiZWxDb2xvciwKICAgIHN0dWRpb0J1dHRvbjogZ2V0TGluayhzdHVkaW9CdXR0b24pLAogICAgd2l6YXJkQm90OiBnZXRMaW5rKHRoaXNCb3QpLAogICAgYWJBcnRpZmFjdFdpemFyZE1lbnVSZXNldDogYEBkZXN0cm95KHRoaXNCb3QpYCwKICAgIG9uUG9ydGFsQ2hhbmdlZDogYEAKICAgICAgICBpZiAodGhhdC5wb3J0YWwgIT09ICdtZW51UG9ydGFsJyAmJiB0aGF0LmRpbWVuc2lvbiAhPT0gJ2FiQXJ0aWZhY3RXaXphcmRQdWJsaXNoTWVudScpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgb3Muc2xlZXAoMCk7CgogICAgICAgIGNvbnN0IG5hbWUgPSBjb25maWdCb3QudGFncy5hYkFydGlmYWN0V2l6YXJkU2VsZWN0ZWRBcnRpZmFjdE5hbWU7CiAgICAgICAgY29uc3QgaW5zdGFuY2VJRCA9IGNvbmZpZ0JvdC50YWdzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3RlZEFydGlmYWN0SW5zdGFuY2VJRDsKICAgICAgICBjb25zdCByZWNvcmRLZXkgPSBsaW5rcy5zdHVkaW9CdXR0b24udGFncy5yZWNvcmRLZXk7CgogICAgICAgIGNvbnN0IHNoYXJkQm90cyA9IGdldEJvdHMoYiA9PiBiLnRhZ3MuYWJBcnRpZmFjdE5hbWUgPT09IG5hbWUgJiYgYi50YWdzLmFiQXJ0aWZhY3RJbnN0YW5jZUlEID09PSBpbnN0YW5jZUlEICYmIGIuc3BhY2UgPT09ICdzaGFyZWQnICYmICFiLnRhZ3MuYWJJZ25vcmUgKTsKICAgICAgICB0aGlzQm90LnZhcnMuc2hhcmRCb3RzID0gc2hhcmRCb3RzOwoKICAgICAgICBpZiAoc2hhcmRCb3RzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdQdWJsaXNoICgnICsgc2hhcmRCb3RzLmxlbmd0aCArICcgYm90cyknOwogICAgICAgIH0gZWxzZSBpZiAoc2hhcmRCb3RzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICB0YWdzLmxhYmVsID0gJ1B1Ymxpc2ggKDEgYm90KSc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdObyBib3RzIHRvIHB1Ymxpc2gnOwogICAgICAgIH0KICAgIGAsCiAgICBvbkNsaWNrOiBgQAogICAgICAgIGNvbnN0IG5hbWUgPSBjb25maWdCb3QudGFncy5hYkFydGlmYWN0V2l6YXJkU2VsZWN0ZWRBcnRpZmFjdE5hbWU7CiAgICAgICAgY29uc3QgcmVjb3JkS2V5ID0gbGlua3Muc3R1ZGlvQnV0dG9uLnRhZ3MucmVjb3JkS2V5OwogICAgICAgIGNvbnN0IHNoYXJkQm90cyA9IHRoaXNCb3QudmFycy5zaGFyZEJvdHM7CgogICAgICAgIHRyeSB7IAogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsaW5rcy53aXphcmRCb3QubGlua3MuYXJ0aWZhY3QuYWJQdWJsaXNoQXJ0aWZhY3RQYXR0ZXJuKHsgYWJBcnRpZmFjdE5hbWU6IG5hbWUsIHN0dWRpbzogcmVjb3JkS2V5LCBzaGFyZEJvdHMsIG1hbnVhbFB1Ymxpc2g6IHRydWUgfSkKCiAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgaWYgKGxpbmtzLndpemFyZEJvdCAmJiBsaW5rcy53aXphcmRCb3QudGFncy5kZXN0cm95QWZ0ZXJVc2UgJiYgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCAhPT0gJ2FiQXJ0aWZhY3RXaXphcmQnKSB7CiAgICAgICAgICAgICAgICAgICAgZGVzdHJveShsaW5rcy53aXphcmRCb3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBsaW5rcy53aXphcmRCb3QubGlua3MudXRpbHMuYWJMb2dBbmRUb2FzdCh7IG1lc3NhZ2U6IGUubWVzc2FnZSwgbG9nVHlwZTogJ2Vycm9yJyB9KTsKICAgICAgICB9CgogICAgYAp9KScAx/nV4wYAGWFiQXJ0aWZhY3RXaXphcmRNZW51UmVzZXQCBADH+dXjBsdy3AFAY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwpjb25maWdCb3QudGFncy5hYkFydGlmYWN0V2l6YXJkU2VsZWN0aW9uTWVudVRhcmdldCA9IG51bGw7CmNvbmZpZ0JvdC50YWdzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3RlZEFydGlmYWN0TmFtZSA9IG51bGw7CmNvbmZpZ0JvdC50YWdzLmFiQXJ0aWZhY3RXaXphcmRTZWxlY3RlZEFydGlmYWN0SW5zdGFuY2VJRCA9IG51bGw7JwDH+dXjBgAQb25BbnlCb3RzUmVtb3ZlZAIEAMf51eMGpHRlQGNvbnN0IHsgYm90SURzIH0gPSB0aGF0OwoKaWYgKGJvdElEcy5pbmNsdWRlcyh0aGlzQm90LmlkKSkgewogICAgdGhpc0JvdC5hYkFydGlmYWN0Qm90TWVudVJlc2V0KCk7Cn0nAMf51eMGAAtvbkdyaWRDbGljawIEAMf51eMGinUlQHRoaXNCb3QuYWJBcnRpZmFjdFdpemFyZE1lbnVSZXNldCgpOycAx/nV4wYABG1lbnUCBADH+dXjBrB1KPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAMf51eMGAAV1dGlscwIEAMf51eMG13Uo8J+UlzkzZDk2NWUwLWQyMGUtNGI0NS04Y2EwLTY0OTI3M2I3MTM4YygAx/nV4wYAEWFiQXJ0aWZhY3RXaXphcmRYAX0AKADH+dXjBgARYWJBcnRpZmFjdFdpemFyZFkBfQMoAMf51eMGABFhYkFydGlmYWN0V2l6YXJkWgF9ACcAx/nV4wYACmFiSURPcmlnaW4CBADH+dXjBoF2EGFiQXJ0aWZhY3RXaXphcmQA"}]}