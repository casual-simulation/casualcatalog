{"version":2,"updates":[{"id":0,"timestamp":1771722576847,"update":"AUb07L6lDgAnAQRib3RzJGUzNjUzNTI0LWI1NzItNDJiMi1hY2EwLWRlNDI1ZjcyMDkyOAEnAPTsvqUOAAdjcmVhdG9yAgQA9Oy+pQ4BJDM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycA9Oy+pQ4ABnN5c3RlbQIEAPTsvqUOJhNhYlBhdGNoQm90LnRlbXBsYXRlJwD07L6lDgAHb25DbGljawIEAPTsvqUOOjJAdGhpc0JvdC5hYlBhdGNoTWVudU9wZW4oKTsKdGhpc0JvdC5hbmltYXRlU3BpbigpOycA9Oy+pQ4AD2FiUGF0Y2hNZW51T3BlbgIEAPTsvqUObYQiQHNob3V0KCdhYlBhdGNoTWVudVJlc2V0Jyk7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICdhYlBhdGNoTWVudSc7CgovLyBUaGlzIGJvdCBoYW5kbGVzIHJlbW92aW5nIHRoaXMgbWVudSBpZiB0aGUgcGF0Y2ggYm90IHRoYXQgY3JlYXRlZCBpdCBnZXRzIGRlc3Ryb3llZC4KY3JlYXRlKHsKICAgIHNwYWNlOiAndGVtcExvY2FsJywKICAgIHBhdGNoQm90SWQ6IHRoaXNCb3QuaWQsCiAgICBhYlBhdGNoTWVudVJlc2V0OiBgQGRlc3Ryb3kodGhpc0JvdClgLAogICAgb25Cb3RBZGRlZDogYEAKICAgICAgICBjb25zdCBwYXRjaEJvdCA9IGdldEJvdCgnaWQnLCB0YWdzLnBhdGNoQm90SWQpOwogICAgICAgIGlmICghcGF0Y2hCb3QpIHsKICAgICAgICAgICAgLy8gVGhlIHBhdGNoIGJvdCB3YXMgZGVsZXRlZCBiZWZvcmUgdGhlIG1lbnUgb3BlbmVkLgogICAgICAgICAgICBzaG91dCgnYWJQYXRjaE1lbnVSZXNldCcpOwogICAgICAgIH0KICAgIGAsCiAgICBvbkFueUJvdHNSZW1vdmVkOiBgQAogICAgICAgIGNvbnN0IHsgYm90SURzIH0gPSB0aGF0OwoKICAgICAgICBpZiAoYm90SURzLmluY2x1ZGVzKHRhZ3MucGF0Y2hCb3RJZCkpIHsKICAgICAgICAgICAgc2hvdXQoJ2FiUGF0Y2hNZW51UmVzZXQnKTsKICAgICAgICB9CiAgICBgLAp9KQoKLyoqCiAqIE1lbnUgZ3JvdXAgZm9yIHRoaXMgcGF0Y2ggYm90LgogKi8KY29uc3QgcGF0Y2hNZW51R3JvdXAgPSB7CiAgICBncm91cFNvcnRPcmRlcjogMTAwLAogICAgYWJQYXRjaE1lbnU6IHRydWUsCiAgICBhYlBhdGNoTWVudVJlc2V0OiBgQGRlc3Ryb3kodGhpc0JvdClgLAogICAgcGF0Y2hCb3Q6IGdldExpbmsodGhpc0JvdCksCiAgICBjb2xvcjogdGFncy5hYlBhdGNoQ29sb3IsCiAgICBtZW51SXRlbXM6IFtdCn0KCnBhdGNoTWVudUdyb3VwLm1lbnVJdGVtcy5wdXNoKHsKICAgIGxhYmVsOiBgJHt0YWdzLmFiUGF0Y2hBc2tJbnB1dC5vcmlnaW5hbFVzZXJJbnF1aXJ5fWAsCiAgICBtZW51SXRlbVR5cGU6ICd0ZXh0JywKICAgIGZvcm1BZGRyZXNzOiAnbm90ZXMnLAogICAgbWVudUl0ZW1TdHlsZTogewogICAgICAgICJwYWRkaW5nLXRvcCI6ICI2cHgiLAogICAgICAgICJwYWRkaW5nLWJvdHRvbSI6ICI2cHgiLAogICAgfSwKICAgIG1lbnVJdGVtTGFiZWxTdHlsZTogewogICAgICAgICJmb250LXN0eWxlIjogIml0YWxpYyIKICAgIH0KfSk7CgppZiAodGFncy5hYlBhdGNoRXJyb3IpIHsKICAgIHBhdGNoTWVudUdyb3VwLm1lbnVJdGVtcy5wdXNoKHsKICAgICAgICBsYWJlbDogYCR7dGFncy5hYlBhdGNoRXJyb3J9YCwKICAgICAgICBtZW51SXRlbVR5cGU6ICd0ZXh0JywKICAgICAgICBmb3JtQWRkcmVzczogJ2Vycm9yJywKICAgICAgICBjb2xvcjogJ2ZpcmVicmljaycsCiAgICAgICAgbGFiZWxDb2xvcjogJ3doaXRlJywKICAgICAgICBtZW51SXRlbVN0eWxlOiB7CiAgICAgICAgICAgICJwYWRkaW5nLXRvcCI6ICI2cHgiLAogICAgICAgICAgICAicGFkZGluZy1ib3R0b20iOiAiNnB4IiwKICAgICAgICB9LAogICAgfSk7Cn0KCmlmICh0YWdzLmFiUGF0Y2hJbnZhbGlkKSB7CiAgICBwYXRjaE1lbnVHcm91cC5tZW51SXRlbXMucHVzaCh7CiAgICAgICAgbGFiZWw6ICdkaXNwb3NlIHBhdGNoJywKICAgICAgICBmb3JtQWRkcmVzczogJ2RlbGV0ZScsCiAgICAgICAgb25DbGljazogYEAKICAgICAgICAgICAgZGVzdHJveShsaW5rcy5wYXRjaEJvdCk7CiAgICAgICAgYAogICAgfSk7Cn0gZWxzZSB7CiAgICBwYXRjaE1lbnVHcm91cC5tZW51SXRlbXMucHVzaCh7CiAgICAgICAgbGFiZWw6ICdhcHByb3ZlIHBhdGNoJywKICAgICAgICBmb3JtQWRkcmVzczogJ2RvbmUnLAogICAgICAgIG9uQ2xpY2s6IGBACiAgICAgICAgICAgIGlmIChsaW5rcy5wYXRjaEJvdC50YWdzLmFiUGF0Y2hCb3RJbnN0YW5jZSkgewogICAgICAgICAgICAgICAgd2hpc3BlcihsaW5rcy5wYXRjaEJvdCwgJ29uQUJQYXRjaEFwcHJvdmVDbGljaycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgb3MudG9hc3QoJ2RvIG5vdGhpbmc6IHRoaXMgaXMgYSBwYXRjaCBib3QgdGVtcGxhdGUnKTsKICAgICAgICAgICAgfQogICAgICAgIGAKICAgIH0pOwoKICAgIHBhdGNoTWVudUdyb3VwLm1lbnVJdGVtcy5wdXNoKHsKICAgICAgICBsYWJlbDogJ3VuZG8gcGF0Y2gnLAogICAgICAgIGZvcm1BZGRyZXNzOiAndW5kbycsCiAgICAgICAgb25DbGljazogYEAKICAgICAgICAgICAgaWYgKGxpbmtzLnBhdGNoQm90LnRhZ3MuYWJQYXRjaEJvdEluc3RhbmNlKSB7CiAgICAgICAgICAgICAgICB3aGlzcGVyKGxpbmtzLnBhdGNoQm90LCAnb25BQlBhdGNoVW5kb0NsaWNrJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvcy50b2FzdCgnZG8gbm90aGluZzogdGhpcyBpcyBhIHBhdGNoIGJvdCB0ZW1wbGF0ZScpOwogICAgICAgICAgICB9CiAgICAgICAgYAogICAgfSk7Cn0KCnBhdGNoTWVudUdyb3VwLm1lbnVJdGVtcy5wdXNoKHsKICAgIGxhYmVsOiAndHJ5IGFnYWluJywKICAgIGZvcm1BZGRyZXNzOiAncmVwbGF5JywKICAgIG9uQ2xpY2s6IExpc3RlbmVyU3RyaW5nKCgpID0+IHsKICAgICAgICBpZiAobGlua3MucGF0Y2hCb3QudGFncy5hYlBhdGNoQm90SW5zdGFuY2UpIHsKICAgICAgICAgICAgd2hpc3BlcihsaW5rcy5wYXRjaEJvdCwgJ29uQUJQYXRjaFRyeUFnYWluQ2xpY2snKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvcy50b2FzdCgnZG8gbm90aGluZzogdGhpcyBpcyBwYXRjaCBib3QgdGVtcGxhdGUnKTsKICAgICAgICB9CiAgICB9KQp9KQoKYWIubGlua3MubWVudS5hYkNyZWF0ZU1lbnVHcm91cChwYXRjaE1lbnVHcm91cCk7CgovKioKICogTWVudSBncm91cCBmb3IgYXBwbHlpbmcvdW5kb2luZyAiYWxsIiBwYXRjaCBib3RzLgogKi8KaWYgKCF0YWdzLmFiUGF0Y2hJbnZhbGlkKSB7CiAgICBjb25zdCBhYkFwcGxpZWRQYXRjaEJvdHMgPSB0aGlzQm90LmFiR2V0QXBwbGllZFBhdGNoQm90cygpOwogICAgCiAgICBpZiAoYWJBcHBsaWVkUGF0Y2hCb3RzLmxlbmd0aCA+IDEpIHsKICAgICAgICBjb25zdCBhbGxQYXRjaGVzTWVudUdyb3VwID0gewogICAgICAgICAgICBncm91cFNvcnRPcmRlcjogMjAwLAogICAgICAgICAgICBhYlBhdGNoTWVudTogdHJ1ZSwKICAgICAgICAgICAgYWJQYXRjaE1lbnVSZXNldDogYEBkZXN0cm95KHRoaXNCb3QpYCwKICAgICAgICAgICAgcGF0Y2hCb3Q6IGdldExpbmsodGhpc0JvdCksCiAgICAgICAgICAgIGNvbG9yOiB0YWdzLmFiUGF0Y2hDb2xvciwKICAgICAgICAgICAgbWVudUl0ZW1zOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdhcHByb3ZlIGFsbCBwYXRjaGVzJywKICAgICAgICAgICAgICAgICAgICBmb3JtQWRkcmVzczogJ2RvbmVfYWxsJywKICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBgQAogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGlua3MucGF0Y2hCb3QudGFncy5hYlBhdGNoQm90SW5zdGFuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaXNwZXIobGlua3MucGF0Y2hCb3QsICdvbkFCUGF0Y2hBcHByb3ZlQWxsQ2xpY2snKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLnRvYXN0KCdkbyBub3RoaW5nOiB0aGlzIGlzIGEgcGF0Y2ggYm90IHRlbXBsYXRlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBgCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxhYmVsOiAndW5kbyBhbGwgcGF0Y2hlcycsCiAgICAgICAgICAgICAgICAgICAgZm9ybUFkZHJlc3M6ICdmYXN0X3Jld2luZCcsCiAgICAgICAgICAgICAgICAgICAgb25DbGljazogYEAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmtzLnBhdGNoQm90LnRhZ3MuYWJQYXRjaEJvdEluc3RhbmNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlzcGVyKGxpbmtzLnBhdGNoQm90LCAnb25BQlBhdGNoVW5kb0FsbENsaWNrJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy50b2FzdCgnZG8gbm90aGluZzogdGhpcyBpcyBhIHBhdGNoIGJvdCB0ZW1wbGF0ZScpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgfQoKICAgICAgICBhYi5saW5rcy5tZW51LmFiQ3JlYXRlTWVudUdyb3VwKGFsbFBhdGNoZXNNZW51R3JvdXApOwogICAgfQp9JwD07L6lDgAQYWJQYXRjaE1lbnVSZXNldAIEAPTsvqUO8iJdQGlmIChjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9PT0gJ2FiUGF0Y2hNZW51JykgewogICAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwp9JwD07L6lDgALb25HcmlkQ2xpY2sCBAD07L6lDtAjG0BzaG91dCgnYWJQYXRjaE1lbnVSZXNldCcpOycA9Oy+pQ4ACm9uRWdnSGF0Y2gCBAD07L6lDuwjoRBAaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gdGhhdDpgLCB0aGF0KTsKfQoKY29uc3Qgc291cmNlRXZlbnQgPSB0aGF0Py5zb3VyY2VFdmVudDsKCmlmIChzb3VyY2VFdmVudCA9PT0gJ2Fza19ncHQnKSB7CiAgICBjb25zdCBwYXRjaENvZGUgPSB0aGF0LmVnZ1BhcmFtZXRlcnMucGF0Y2hDb2RlOwogICAgY29uc3QgYXNrSW5wdXQgPSB0aGF0LmVnZ1BhcmFtZXRlcnMuYXNrSW5wdXQ7CiAgICBjb25zdCBkaW1lbnNpb24gPSB0aGF0LmVnZ1BhcmFtZXRlcnMuZGltZW5zaW9uOwogICAgY29uc3QgcG9zaXRpb24gPSB0aGF0LmVnZ1BhcmFtZXRlcnMucG9zaXRpb247CiAgICBjb25zdCBhbHdheXNBcHByb3ZlID0gdGhhdC5lZ2dQYXJhbWV0ZXJzLmFsd2F5c0FwcHJvdmUgPz8gZmFsc2U7CgogICAgdGFncy5hYklnbm9yZSA9IHRydWU7CiAgICB0YWdzLmFiUGF0Y2hCb3RJbnN0YW5jZSA9IHRydWU7CiAgICB0YWdzLmFiUGF0Y2hBc2tJbnB1dCA9IGDwn6esJHtKU09OLnN0cmluZ2lmeShhc2tJbnB1dCl9YDsKICAgIHRhZ3MuYWJQYXRjaENvZGUgPSBgQCR7cGF0Y2hDb2RlfWA7CiAgICB0YWdzLmFiUGF0Y2hCb3RJZGVudGl0eSA9IGBwYXRjaCAke3RoaXNCb3QuaWQuc3Vic3RyaW5nKDAsIDUpfWA7CiAgICB0YWdzLmFiUGF0Y2hMYWJlbCA9IGByZXZpZXcgJHt0YWdzLmFiUGF0Y2hCb3RJZGVudGl0eX1gOwogICAgdGFncy5zeXN0ZW0gPSBgYWJQYXRjaEJvdC4ke3RhZ3MuYWJQYXRjaEJvdElkZW50aXR5fWA7CiAgICB0YWdzW2RpbWVuc2lvbl0gPSB0cnVlOwogICAgdGFnc1tkaW1lbnNpb24gKyAnWCddID0gcG9zaXRpb24/LnggPz8gMDsKICAgIHRhZ3NbZGltZW5zaW9uICsgJ1knXSA9IHBvc2l0aW9uPy55ID8/IDA7CiAgICB0YWdzW2RpbWVuc2lvbiArICdaJ10gPSBwb3NpdGlvbj8ueiA/PyAwOwoKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgdGhpc0JvdC5hYlBhdGNoQXBwbHkoKTsKICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpc0JvdC51cGRhdGVQYXRjaENvbG9yKCk7CiAgICB9CgogICAgYXdhaXQgb3Muc2xlZXAoMCk7IC8vIE5PVEU6IE5lZWQgdG8gd2FpdCAxIGZyYW1lIGFuZCBsZXQgdGFncy9tYXNrcyB1cGRhdGVzIGluIHRoZSBwYXRjaCBib3RzIG90aGVyd2lzZSB0aGUgbWVudSB3b250IGJlIGFibGUgdG8gcmV0cmlldmUgYWxsIHBhdGNoIGJvdHMgc3VjY2Vzc2Z1bGx5LgoKICAgIGlmIChhbHdheXNBcHByb3ZlICYmIHRhZ3MuYWJQYXRjaEFwcGxpZWQpIHsKICAgICAgICB0aGlzQm90Lm9uQUJQYXRjaEFwcHJvdmVDbGljaygpOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBjb25zdCBhYkJvdCA9IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3Q7CiAgICAgICAgLy8gaWYgKGFiQm90KSB7CiAgICAgICAgLy8gICAgIGNvbnN0IGFiQm90UG9zaXRpb24gPSBnZXRCb3RQb3NpdGlvbihhYkJvdCwgZGltZW5zaW9uKTsKICAgICAgICAvLyAgICAgaWYgKGFiQm90UG9zaXRpb24ueCA9PSBwb3NpdGlvbi54ICYmIAogICAgICAgIC8vICAgICAgICAgYWJCb3RQb3NpdGlvbi55ID09IHBvc2l0aW9uLnkgJiYKICAgICAgICAvLyAgICAgICAgIGFiQm90UG9zaXRpb24ueiA9PSBwb3NpdGlvbi56CiAgICAgICAgLy8gICAgICkgewogICAgICAgIC8vICAgICAgICAgaWYgKCFjb25maWdCb3QudGFncy5hYlN0YXlBd2FrZSkgewogICAgICAgIC8vICAgICAgICAgICAgIC8vIElmIHRoZSBhYiBib3QgaXMgaW4gdGhlIGN1cnJlbnQgcG9zaXRpb24gb2YgdGhpcyBwYXRjaCBib3QsIGhpZGUgdGhlIGFiIGJvdC4KICAgICAgICAvLyAgICAgICAgICAgICBkZXN0cm95KGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgICAgIC8vICAgICAgICAgfQoKICAgICAgICAvLyAgICAgICAgIC8vIElmIHRoZSBhYiBib3QgZGlkbid0IG1vdmUsIGF1dG9tYXRpY2FsbHkgb3BlbiB0aGUgbWVudSBmb3IgdGhpcyBuZXcgcGF0Y2ggYm90LgogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gfQoKICAgICAgICB0aGlzQm90LmFiUGF0Y2hNZW51T3BlbigpOwogICAgfQp9CicA9Oy+pQ4ADGFiUGF0Y2hBcHBseQIEAPTsvqUOjDSiD0BpZiAodGFncy5hYlBhdGNoQXBwbGllZCB8fCB0YWdzLmFiUGF0Y2hBcHBseWluZykgewogICAgcmV0dXJuOwp9CgppZiAodHlwZW9mIHRoaXNCb3QuYWJQYXRjaENvZGUgPT09ICdmdW5jdGlvbicpIHsKICAgIHRyeSB7CiAgICAgICAgdGFncy5hYlBhdGNoQXBwbHlpbmcgPSB0cnVlOwogICAgICAgIGNvbnN0IGFiUGF0Y2hSZXN1bHRzOiBBQlBhdGNoUmVzdWx0W10gPSBhd2FpdCB0aGlzQm90LmFiUGF0Y2hDb2RlKCk7CgogICAgICAgIGlmICh0YWdzLmRlYnVnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gcGF0Y2ggcmVzdWx0czpgLCBhYlBhdGNoUmVzdWx0cyk7CiAgICAgICAgfQoKICAgICAgICAvLyBTdG9yZSB0aGUgcGF0Y2ggcmVzdWx0cyBvbiB0aGlzIHBhdGNoIGJvdC4KICAgICAgICB0YWdzLmFiUGF0Y2hSZXN1bHRzID0gYPCfp6wke0pTT04uc3RyaW5naWZ5KGFiUGF0Y2hSZXN1bHRzLCB1bmRlZmluZWQsIDQpfWA7CgogICAgICAgIC8vIEZvciBhbGwgcGF0Y2hlZCBib3RzLCByZW1vdmUgdGhlICdjcmVhdG9yJyB0YWcgb24gdGhlbSBpZiB0aGUgY3JlYXRvciB3YXMgdGhpcyBwYXRjaCBib3QuCiAgICAgICAgLy8gV2UgZG9uJ3Qgd2FudCBvdXIgcGF0Y2hlZCBib3RzIHRvIGdldCBkZXN0cm95ZWQgd2hlbiB0aGlzIHBhdGNoIGJvdCBpcyBkZXN0cm95ZWQuCiAgICAgICAgZm9yIChjb25zdCByZXN1bHQgb2YgYWJQYXRjaFJlc3VsdHMpIHsKICAgICAgICAgICAgY29uc3QgYm90ID0gZ2V0Qm90KCdpZCcsIHJlc3VsdC5ib3RJZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoYm90ICYmIGJvdC50YWdzLmNyZWF0b3IgPT09IHRoaXNCb3QuaWQpIHsKICAgICAgICAgICAgICAgIGJvdC50YWdzLmNyZWF0b3IgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0YWdzLmFiUGF0Y2hBcHBsaWVkID0gdHJ1ZTsKICAgICAgICB0YWdzLmFiUGF0Y2hBcHBsaWVkVGltZXN0YW1wID0gb3MuaXNDb2xsYWJvcmF0aXZlKCkgPyBvcy5hZ3JlZWRVcG9uVGltZSA6IG9zLmxvY2FsVGltZTsKICAgICAgICB0YWdzLmxpbmVUbyA9IGdldExpbmsoYWJQYXRjaFJlc3VsdHMubWFwKHIgPT4gZ2V0Qm90KCdpZCcsIHIuYm90SWQpKSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYFNvbWV0aGluZyB3ZW50IHdyb25nIGFwcGx5aW5nIHBhdGNoIOKAlCAke2FiLmxpbmtzLnV0aWxzLmdldEVycm9yTWVzc2FnZShlKX1gOwogICAgICAgIGFiLmxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoeyBuYW1lOiB0YWdzLnBhdGNoTGFiZWwsIG1lc3NhZ2U6IGVycm9yTWVzc2FnZSwgbG9nVHlwZTogJ2Vycm9yJyB9KTsKICAgICAgICB0YWdzLmFiUGF0Y2hFcnJvciA9IGVycm9yTWVzc2FnZTsKICAgIH0gZmluYWxseSB7CiAgICAgICAgdGFncy5hYlBhdGNoQXBwbHlpbmcgPSBudWxsOwoKICAgICAgICBpZiAoIXRhZ3MuYWJQYXRjaFJlc3VsdHMgfHwgIXRhZ3MuYWJQYXRjaEFwcGxpZWQpIHsKICAgICAgICAgICAgLy8gSWYgcGF0Y2ggaXMgbm90IGFwcGxpZWQgb3IgcmVzdWx0cyBhcmUgbm90IHN1Y2Nlc3NmdWxseSByZWNvcmRlZCwgdGhlbiB3ZSBtYXJrIHRoaXMgcGF0Y2ggYXMgaW52YWxpZC4KICAgICAgICAgICAgdGFncy5hYlBhdGNoSW52YWxpZCA9IHRydWU7CiAgICAgICAgfQogICAgfQp9IGVsc2UgewogICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYFBhdGNoIGNvZGUgaXMgbm90IGEgdmFsaWQgZnVuY3Rpb24uYDsKICAgIGFiLmxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoeyBuYW1lOiB0YWdzLnBhdGNoTGFiZWwsIG1lc3NhZ2U6IGVycm9yTWVzc2FnZSwgbG9nVHlwZTogJ2Vycm9yJyB9KTsKICAgIHRhZ3MuYWJQYXRjaEludmFsaWQgPSB0cnVlOwogICAgdGFncy5hYlBhdGNoRXJyb3IgPSBlcnJvck1lc3NhZ2U7Cn0nAPTsvqUOAAthYlBhdGNoVW5kbwIEAPTsvqUOq0O0EEBpZiAoIXRhZ3MuYWJQYXRjaEFwcGxpZWQgfHwgdGFncy5hYlBhdGNoQXBwbHlpbmcpIHsKICAgIHJldHVybjsKfQoKY29uc3QgYWJQYXRjaFJlc3VsdHM6IEFCUGF0Y2hSZXN1bHRbXSA9IHRhZ3MuYWJQYXRjaFJlc3VsdHM7CgppZiAoYWJQYXRjaFJlc3VsdHMgJiYgYWJQYXRjaFJlc3VsdHMubGVuZ3RoID4gMCkgewogICAgZm9yIChsZXQgcmVzdWx0IG9mIGFiUGF0Y2hSZXN1bHRzKSB7CiAgICAgICAgY29uc3QgcGF0Y2hlZEJvdCA9IGdldEJvdCgnaWQnLCByZXN1bHQuYm90SWQpOwoKICAgICAgICBpZiAocGF0Y2hlZEJvdCkgewogICAgICAgICAgICBpZiAocmVzdWx0LmNyZWF0ZWQpIHsKICAgICAgICAgICAgICAgIC8vIFRoaXMgcGF0Y2ggY3JlYXRlZCB0aGUgYm90LCB0byB1bmRvIGl0IHdlIGRlc3Ryb3kgaXQuCiAgICAgICAgICAgICAgICBkZXN0cm95KHBhdGNoZWRCb3QpOwogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQucm9sbGJhY2tEaWZmKSB7CiAgICAgICAgICAgICAgICAvLyBUaGlzIHBhdGNoIG1vZGlmaWVkIHRoZSBib3QsIHRvIHVuZG8gaXQgd2UgYXBwbHkgYWxsIHRoZSB0aGUgdGFncyBhbmQgbWFza3MgaW4gdGhlIHJvbGxiYWNrIGRpZmYgdG8gdGhlIGJvdC4KICAgICAgICAgICAgICAgIGNvbnN0IHJvbGxiYWNrQm90RGF0YSA9IHJlc3VsdC5yb2xsYmFja0RpZmZbcGF0Y2hlZEJvdC5pZF07CiAgICAgICAgICAgICAgICBjb25zdCByb2xsYmFja1RhZ3MgPSByb2xsYmFja0JvdERhdGEudGFnczsKICAgICAgICAgICAgICAgIGNvbnN0IHJvbGxiYWNrTWFza3MgPSByb2xsYmFja0JvdERhdGEubWFza3M7CgogICAgICAgICAgICAgICAgaWYgKHJvbGxiYWNrVGFncykgewogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdGFnTmFtZSBpbiByb2xsYmFja1RhZ3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGFnKHBhdGNoZWRCb3QsIHRhZ05hbWUsIHJvbGxiYWNrVGFnc1t0YWdOYW1lXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyb2xsYmFja01hc2tzKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBzcGFjZSBpbiByb2xsYmFja01hc2tzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzcGFjZSA9PT0gJ3JlbW90ZVRlbXBTaGFyZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDYW50IHNldCByZW1vdGVUZW1wU2hhcmVkIG1hc2tzLCB0aGV5IGFyZSBvd25lZCBieSBzb21lb25lIGVsc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB0YWdOYW1lIGluIHJvbGxiYWNrTWFza3Nbc3BhY2VdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUYWdNYXNrKHBhdGNoZWRCb3QsIHRhZ05hbWUsIHJvbGxiYWNrTWFza3Nbc3BhY2VdW3RhZ05hbWVdLCBzcGFjZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQWZ0ZXIgdGFncyBhbmQgbWFza3MgaGF2ZSBiZWVuIHJvbGxlZCBiYWNrLCBkZXN0cm95IHRoaXMgcGF0Y2ggYm90LgogICAgICAgICAgICAgICAgZGVzdHJveSh0aGlzQm90KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFiLmxpbmtzLnV0aWxzLmFiTG9nQW5kVG9hc3QoeyBtZXNzYWdlOiBgQ2Fubm90IHVuZG8gJHt0YWdzLmFiUGF0Y2hCb3RJZGVudGl0eX0uIFNvbWV0aGluZyB3ZW50IHdyb25nIGR1cmluZyBwYXRjaCBwcm9jZXNzPyBObyBkYXRhIGZvdW5kIHRvIHVuZG8gY2hhbmdlcy5gLCBsb2dUeXBlOiAnd2FybmluZycgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBQYXRjaGVkIGJvdCBub3QgZm91bmQsIHF1aWV0bHkgZGVzdHJveSB0aGUgcGF0Y2ggYm90LgogICAgICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgICAgIH0KICAgIH0KfScA9Oy+pQ4ADGFiUGF0Y2hDb2xvcgIEAPTsvqUO4FMFd2hpdGUnAPTsvqUOAAZjdXJzb3ICBAD07L6lDuZTB3BvaW50ZXIoAPTsvqUOAAphYlBhdGNoQm90AXgnAPTsvqUOAAtmb3JtT3BhY2l0eQIEAPTsvqUO71MEMC4zMycA9Oy+pQ4AC3N0cm9rZUNvbG9yAgQA9Oy+pQ70UwV3aGl0ZScA9Oy+pQ4ABWNvbG9yAgQA9Oy+pQ76UwV3aGl0ZScA9Oy+pQ4ACm9uQm90QWRkZWQCBAD07L6lDoBU9wFAbGV0IHdhaXRUaW1lID0gMDsKCndoaWxlKCFnbG9iYWxUaGlzLmFiPy5saW5rcy5ib3RfZmFjdG9yeSkgewogICAgaWYgKHdhaXRUaW1lID49IDUwMDApIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIGF3YWl0IG9zLnNsZWVwKDI1MCk7CiAgICB3YWl0VGltZSArPSAyNTA7Cn0KCm1hc2tzLnJlYWR5ID0gdHJ1ZTsKCnRoaXNCb3QudXBkYXRlUGF0Y2hDb2xvcigpOwp0aGlzQm90LnVwZGF0ZUJpbGxib2FyZExhYmVsKCk7JwD07L6lDgAUdXBkYXRlQmlsbGJvYXJkTGFiZWwCBAD07L6lDvhV8QRAaWYgKHRoaXNCb3QudmFycy5iaWxsYm9hcmRMYWJlbEJvdCkgewogICAgZGVzdHJveSh0aGlzQm90LnZhcnMuYmlsbGJvYXJkTGFiZWxCb3QpOwogICAgdGhpc0JvdC52YXJzLmJpbGxib2FyZExhYmVsQm90ID0gbnVsbDsKfQoKY29uc3QgY3VycmVudERpbWVuc2lvbiA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/PyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwpjb25zdCBib3RJbkRpbWVuc2lvbiA9IGN1cnJlbnREaW1lbnNpb24gJiYgdGhpc0JvdC50YWdzW2N1cnJlbnREaW1lbnNpb25dID09PSB0cnVlOwoKaWYgKGJvdEluRGltZW5zaW9uKSB7CiAgICB0aGlzQm90LnZhcnMuYmlsbGJvYXJkTGFiZWxCb3QgPSBhYi5saW5rcy5ib3RfZmFjdG9yeS5hYkNyZWF0ZUJpbGxib2FyZExhYmVsKHsgCiAgICAgICAgYm90OiB0aGlzQm90LAogICAgICAgIGxhYmVsOiB0YWdzLmFiUGF0Y2hMYWJlbCwKICAgICAgICBsYWJlbENvbG9yOiB0YWdzLmFiUGF0Y2hMYWJlbENvbG9yLAogICAgICAgIGNvbG9yOiB0YWdzLmFiUGF0Y2hMYWJlbEJhY2tncm91bmRDb2xvciwKICAgICAgICBkaW1lbnNpb246IGN1cnJlbnREaW1lbnNpb24sCiAgICAgICAgc3BhY2U6ICd0ZW1wTG9jYWwnLAogICAgfSkKfQoKJwD07L6lDgAMb25Cb3RDaGFuZ2VkAgQA9Oy+pQ7qWu8FQGNvbnN0IGN1cnJlbnREaW1lbnNpb24gPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPz8gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKCmxldCBuZWVkVXBkYXRlQmlsbGJvYXJkTGFiZWwgPSBmYWxzZTsKbGV0IG5lZWRVcGRhdGVQYXRjaENvbG9yID0gZmFsc2U7Cgpmb3IgKGNvbnN0IHQgb2YgdGhhdC50YWdzKSB7CiAgICBpZiAoIW5lZWRVcGRhdGVCaWxsYm9hcmRMYWJlbCkgewogICAgICAgIG5lZWRVcGRhdGVCaWxsYm9hcmRMYWJlbCA9IHQgPT09ICdhYlBhdGNoTGFiZWwnIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9PT0gJ2FiUGF0Y2hMYWJlbENvbG9yJyB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPT09ICdhYlBhdGNoTGFiZWxCYWNrZ3JvdW5kQ29sb3InIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9PT0gY3VycmVudERpbWVuc2lvbjsKICAgIH0KCiAgICBpZiAoIW5lZWRVcGRhdGVQYXRjaENvbG9yKSB7CiAgICAgICAgbmVlZFVwZGF0ZVBhdGNoQ29sb3IgPSB0ID09PSAnYWJQYXRjaEVycm9yJyB8fCB0ID09PSAnYWJQYXRjaEludmFsaWQnOwogICAgfQp9CgppZiAobmVlZFVwZGF0ZVBhdGNoQ29sb3IpIHsKICAgIHRoaXNCb3QudXBkYXRlUGF0Y2hDb2xvcigpOwp9CgppZiAobmVlZFVwZGF0ZUJpbGxib2FyZExhYmVsICYmIHRhZ3MucmVhZHkpIHsKICAgIHRoaXNCb3QudXBkYXRlQmlsbGJvYXJkTGFiZWwoKTsKfScA9Oy+pQ4ADGFiUGF0Y2hMYWJlbAIEAPTsvqUO2mAScGF0Y2ggYm90IHRlbXBsYXRlJwD07L6lDgAVb25BQlBhdGNoQXBwcm92ZUNsaWNrAgQA9Oy+pQ7tYE5AaWYgKHRhZ3MuYWJQYXRjaEFwcGxpZWQgJiYgdGFncy5hYlBhdGNoQm90SW5zdGFuY2UpIHsKICAgIGRlc3Ryb3kodGhpc0JvdCk7Cn0nAPTsvqUOABJvbkFCUGF0Y2hVbmRvQ2xpY2sCBAD07L6lDrxhU0BpZiAodGFncy5hYlBhdGNoQXBwbGllZCAmJiB0YWdzLmFiUGF0Y2hCb3RJbnN0YW5jZSkgewogICAgdGhpc0JvdC5hYlBhdGNoVW5kbygpOwp9JwD07L6lDgAFdHlwZXMCBAD07L6lDpBi4ATwn5OEaW50ZXJmYWNlIEFCUGF0Y2hSZXN1bHQgewogICAgLyoqIFRoZSBpZCBvZiB0aGUgYm90IHRoYXQgd2FzIGNyZWF0ZWQgLyBtb2RpZmllZC4gKi8KICAgIGJvdElkOiBzdHJpbmc7CgogICAgLyoqIFdldGhlciBvciBub3QgdGhpcyBib3Qgd2FzIGNyZWF0ZWQgYnkgdGhlIHBhdGNoLiAqLwogICAgY3JlYXRlZDogYm9vbGVhbjsKCiAgICAvKiogCiAgICAqIEEgcm9sbGJhY2sgZGlmZiBvZiB0aGUgYm90IHRoYXQgc3RvcmVzIHRoZSBvcmlnaW5hbCB2YWx1ZXMgb2YgdGFncyBvbiB0aGUgYm90IGJlZm9yZSB0aGUgcGF0Y2ggY29kZSB3YXMgcnVuLiBJZiB0aGUgYm90IHdhcyBjcmVhdGVkIGJ5IHRoZSBwYXRjaCBjb2RlIHRoZW4gdGhpcyBtdXN0IGJlIG51bGwuCiAgICAqIAogICAgKiBTbmFwc2hvdHMgb2YgYm90cyBjYW4gYmUgb2J0YWluZWQgYnkgcnVubmluZyBnZXRTbmFwc2hvdChib3QpIGFuZCB0aGVuIGEgcm9sbGJhY2sgZGlmZiBjYW4gYmUgY3JlYXRlZCBieSBydW5uaW5nIGRpZmZTbmFwc2hvdHMocG9zdFBhdGNoU25hcHNob3QsIHByZVBhdGNoU25hcHNob3QpLgogICAgKi8KICAgIHJvbGxiYWNrRGlmZjogUGFydGlhbEJvdFN0YXRlIHwgbnVsbDsKfScA9Oy+pQ4AGG9uQUJQYXRjaEFwcHJvdmVBbGxDbGljawIEAPTsvqUO72ZFQGlmICh0YWdzLmFiUGF0Y2hCb3RJbnN0YW5jZSkgewogICAgc2hvdXQoJ29uQUJQYXRjaEFwcHJvdmVDbGljaycpOwp9JwD07L6lDgAVb25BQlBhdGNoVW5kb0FsbENsaWNrAgQA9Oy+pQ61Z+kBQGlmICh0YWdzLmFiUGF0Y2hBcHBsaWVkICYmIHRhZ3MuYWJQYXRjaEJvdEluc3RhbmNlKSB7CiAgICBjb25zdCBhYkFwcGxpZWRQYXRjaEJvdHMgPSB0aGlzQm90LmFiR2V0QXBwbGllZFBhdGNoQm90cygpOwogICAgCiAgICBmb3IgKGNvbnN0IGFiUGF0Y2hCb3Qgb2YgYWJBcHBsaWVkUGF0Y2hCb3RzKSB7CiAgICAgICAgd2hpc3BlcihhYlBhdGNoQm90LCAnb25BQlBhdGNoVW5kb0NsaWNrJyk7CiAgICB9Cn0nAPTsvqUOAAlhYlZlcnNpb24CBAD07L6lDp9pBTEwLjQyJwD07L6lDgAFZGVidWcCBAD07L6lDqVpBWZhbHNlJwD07L6lDgAVYWJHZXRBcHBsaWVkUGF0Y2hCb3RzAgQA9Oy+pQ6rae8CQGNvbnN0IGFiQXBwbGllZFBhdGNoQm90cyA9IGdldEJvdHMoYm90ID0+IGJvdC50YWdzLmFiUGF0Y2hCb3QgJiYgYm90LnRhZ3MuYWJQYXRjaEJvdEluc3RhbmNlICYmIGJvdC50YWdzLmFiUGF0Y2hBcHBsaWVkKTsKCi8vIFNvcnQgYWJBcHBsaWVkUGF0Y2hCb3RzIGJ5IHRoZWlyIGFiUGF0Y2hBcHBsaWVkVGltZXN0YW1wIGluIGRlc2NlbmRpbmcgb3JkZXIgKG1vc3QgcmVjZW50IHRvIG9sZGVzdCBwYXRjaCBib3RzKTsKYWJBcHBsaWVkUGF0Y2hCb3RzLnNvcnQoKGEsIGIpID0+IGIudGFncy5hYlBhdGNoQXBwbGllZFRpbWVzdGFtcCAtIGEudGFncy5hYlBhdGNoQXBwbGllZFRpbWVzdGFtcCk7CgpyZXR1cm4gYWJBcHBsaWVkUGF0Y2hCb3RzOycA9Oy+pQ4AEWFiUGF0Y2hCb3RWZXJzaW9uAgQA9Oy+pQ6bbAMxLjMnAPTsvqUOABB1cGRhdGVQYXRjaENvbG9yAgQA9Oy+pQ6fbIoEQGxldCBib3RDb2xvcjsKbGV0IGxhYmVsQ29sb3I7CgppZiAodGFncy5hYlBhdGNoSW52YWxpZCB8fCB0YWdzLmFiUGF0Y2hFcnJvcikgewogICAgYm90Q29sb3IgPSAnZmlyZWJyaWNrJzsKICAgIGxhYmVsQ29sb3IgPSAnd2hpdGUnOwp9IGVsc2UgewogICAgYm90Q29sb3IgPSAnd2hpdGUnLAogICAgbGFiZWxDb2xvciA9ICdibGFjayc7Cn0KCmlmICh0YWdzLmFiUGF0Y2hMYWJlbENvbG9yICE9PSBsYWJlbENvbG9yKSB7CiAgICB0YWdzLmFiUGF0Y2hMYWJlbENvbG9yID0gbGFiZWxDb2xvcjsKfQoKaWYgKHRhZ3MuYWJQYXRjaExhYmVsQmFja2dyb3VuZENvbG9yICE9PSBib3RDb2xvcikgewogICAgdGFncy5hYlBhdGNoTGFiZWxCYWNrZ3JvdW5kQ29sb3IgPSBib3RDb2xvcjsKfQoKaWYgKHRhZ3MuY29sb3IgIT09IGJvdENvbG9yKSB7CiAgICB0YWdzLmNvbG9yID0gYm90Q29sb3I7Cn0KCmlmICh0YWdzLnN0cm9rZUNvbG9yICE9PSBib3RDb2xvcikgewogICAgdGFncy5zdHJva2VDb2xvciA9IGJvdENvbG9yOwp9JwD07L6lDgALYW5pbWF0ZVNwaW4CBAD07L6lDqpwvQZAY2xlYXJBbmltYXRpb25zKHRoaXNCb3QpOwoKY29uc3QgZGltZW5zaW9uID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8/IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CmxldCBjdXJyZW50Um90WiA9IHRhZ3NbZGltZW5zaW9uICsgJ1JvdGF0aW9uWiddID8/IDA7CgpmdW5jdGlvbiBnZXROZXh0T3J0aG9nb25hbFNwaW4oY3VycmVudFJvdFopIHsKICAgIGNvbnN0IEhBTEZfVFVSTiA9IE1hdGguUEk7CiAgICBjb25zdCBRVUFSVEVSX1RVUk4gPSBNYXRoLlBJIC8gMjsKCiAgICBjb25zdCBtaW5UYXJnZXQgPSBjdXJyZW50Um90WiArIEhBTEZfVFVSTjsKICAgIGNvbnN0IG5leHRNdWx0aXBsZSA9IE1hdGguY2VpbChtaW5UYXJnZXQgLyBRVUFSVEVSX1RVUk4pICogUVVBUlRFUl9UVVJOOwogICAgcmV0dXJuIG5leHRNdWx0aXBsZTsKfQoKY29uc3QgdGFyZ2V0Um90WiA9IGdldE5leHRPcnRob2dvbmFsU3BpbihjdXJyZW50Um90Wik7Cgphd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgIGZyb21WYWx1ZTogewogICAgICAgIFtkaW1lbnNpb24gKyAnUm90YXRpb25aJ106IGN1cnJlbnRSb3RaLAogICAgfSwKICAgIHRvVmFsdWU6IHsKICAgICAgICBbZGltZW5zaW9uICsgJ1JvdGF0aW9uWiddOiB0YXJnZXRSb3RaLAogICAgfSwKICAgIGVhc2luZzogewogICAgICAgIHR5cGU6ICJzaW51c29pZGFsIiwKICAgICAgICBtb2RlOiAiaW5vdXQiCiAgICB9LAogICAgZHVyYXRpb246IDAuNSwKICAgIHRhZ01hc2tTcGFjZTogJ3RlbXBMb2NhbCcsCn0pLmNhdGNoKCgpID0+IHt9KTsKCm1hc2tzW2RpbWVuc2lvbiArICdSb3RhdGlvblonXSA9IG51bGw7JwD07L6lDgAPb25Qb3J0YWxDaGFuZ2VkAgQA9Oy+pQ7odoQBQGNvbnN0IHsgcG9ydGFsLCBkaW1lbnNpb24gfSA9IHRoYXQ7CgppZiAocG9ydGFsID09PSAnZ3JpZFBvcnRhbCcgfHwgcG9ydGFsID09PSAnbWFwUG9ydGFsJykgewogICAgdGhpc0JvdC51cGRhdGVCaWxsYm9hcmRMYWJlbCgpOwp9JwD07L6lDgAKYWJJRE9yaWdpbgIEAPTsvqUO7XcKYWJQYXRjaEJvdCcA9Oy+pQ4AEWFiUGF0Y2hMYWJlbENvbG9yAgQA9Oy+pQ74dwVibGFjaycA9Oy+pQ4AG2FiUGF0Y2hMYWJlbEJhY2tncm91bmRDb2xvcgIEAPTsvqUO/ncFd2hpdGUnAPTsvqUOABZvbkFCUGF0Y2hUcnlBZ2FpbkNsaWNrAgQA9Oy+pQ6EeM0PQGNvbnN0IGFza0lucHV0ID0gc2VsZi5zdHJ1Y3R1cmVkQ2xvbmUodGFncy5hYlBhdGNoQXNrSW5wdXQpOwoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXNrSW5wdXQ6YCwgc2VsZi5zdHJ1Y3R1cmVkQ2xvbmUoYXNrSW5wdXQpKTsKfQoKbGV0IGNhblRyeUFnYWluID0gdHJ1ZTsgLy8gRmxhZyB0byBkZXRlcm1pbmUgYnkgdGhlIGVuZCBpZiB3ZSBoYXZlIGFsbCB0aGUgZGF0YSBuZWNlc3NhcnkgdG8gdHJ5IGFnYWluLgoKLy8gUmVjb25zdHJ1Y3QgYXNrR1BUIHBhcmFtZXRlcnMgZnJvbSB0aGUgcGF0Y2ggYm90cyBzdG9yZWQgYXNrSW5wdXQuCmNvbnN0IGFza0dQVFBhcmFtcyA9IHt9Owphc2tHUFRQYXJhbXMuZGF0YSA9IHt9OwoKYXNrR1BUUGFyYW1zLmlucXVpcnkgPSBhc2tJbnB1dC5vcmlnaW5hbFVzZXJJbnF1aXJ5Owphc2tHUFRQYXJhbXMuZGF0YS5tZXNzYWdlID0gYXNrSW5wdXQub3JpZ2luYWxVc2VySW5xdWlyeTsKZGVsZXRlIGFza0lucHV0Lm9yaWdpbmFsVXNlcklucXVpcnk7Cgphc2tHUFRQYXJhbXMucHJvbXB0ID0gYXNrSW5wdXQubWVudTsKYXNrR1BUUGFyYW1zLmRhdGEubWVudSA9IGFza0lucHV0Lm1lbnU7CmRlbGV0ZSBhc2tJbnB1dC5tZW51OwoKYXNrR1BUUGFyYW1zLnNvdXJjZUlkID0gYXNrSW5wdXQuc291cmNlSWQ7CmRlbGV0ZSBhc2tJbnB1dC5zb3VyY2VJZDsKCi8vIENvbnZlcnQgc2VyaWFsaXplZCBib3QgZGF0YSAvIGlkcyBiYWNrIGludG8gYm90IHJlZmVyZW5jZXMuCmlmIChhc2tJbnB1dC5ib3QpIHsKICAgIGxldCBpZDsgCgogICAgaWYgKHR5cGVvZiBhc2tJbnB1dC5ib3QgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgaWQgPSBhc2tJbnB1dC5ib3Q7CiAgICB9IGVsc2UgewogICAgICAgIGlkID0gYXNrSW5wdXQuYm90LmlkOwogICAgfQoKICAgIGNvbnN0IGJvdCA9IGdldEJvdCgnaWQnLCAgICAgaWQpOwoKICAgIGlmIChib3QpIHsKICAgICAgICBhc2tHUFRQYXJhbXMuZGF0YS5ib3QgPSBib3Q7CiAgICB9IGVsc2UgewogICAgICAgIGNhblRyeUFnYWluID0gZmFsc2U7CiAgICB9CgogICAgZGVsZXRlIGFza0lucHV0LmJvdDsKfSBlbHNlIGlmIChhc2tJbnB1dC5ib3RzKSB7CiAgICBsZXQgaWRzID0gYXNrSW5wdXQuYm90czsKICAgIGxldCBib3RzID0gW107CgogICAgZm9yIChsZXQgaWQgb2YgaWRzKSB7CiAgICAgICAgY29uc3QgYm90ID0gZ2V0Qm90KCdpZCcsIGlkKTsKCiAgICAgICAgaWYgKGJvdCkgewogICAgICAgICAgICBib3RzLnB1c2goYm90KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjYW5UcnlBZ2FpbiA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoYm90cy5sZW5ndGggPiAwKSB7CiAgICAgICAgYXNrR1BUUGFyYW1zLmRhdGEuYm90cyA9IGJvdHM7CiAgICB9CgogICAgZGVsZXRlIGFza0lucHV0LmJvdHM7Cn0KCi8vIENvcHkgdGhlIHJlc3Qgb2YgdGhlIGVudHJpZXMgaW4gYXNrSW5wdXQgaW50byB0aGUgYXNrR1BUUGFyYW1zIGRhdGEgb2JqZWN0Lgphc2tHUFRQYXJhbXMuZGF0YSA9IHsKICAgIC4uLmFza0dQVFBhcmFtcy5kYXRhLAogICAgLi4uYXNrSW5wdXQKfQoKaWYgKHRhZ3MuZGVidWcpIHsKICAgIGNvbnNvbGUubG9nKGBbJHt0YWdzLnN5c3RlbX0uJHt0YWdOYW1lfV0gYXNrR1BUUGFyYW1zOmAsIGFza0dQVFBhcmFtcyk7Cn0KCmlmIChjYW5UcnlBZ2FpbikgewogICAgaWYgKHRhZ3MuYWJQYXRjaEludmFsaWQpIHsKICAgICAgICBkZXN0cm95KHRoaXNCb3QpOwogICAgfSBlbHNlIHsKICAgICAgICB3aGlzcGVyKHRoaXNCb3QsICdvbkFCUGF0Y2hVbmRvQ2xpY2snKTsKICAgIH0KCiAgICBhYi5saW5rcy5hc2suYXNrR1BUKGFza0dQVFBhcmFtcyk7Cn0gZWxzZSB7CiAgICBhYi5saW5rcy51dGlscy5hYkxvZ0FuZFRvYXN0KGBDYW4ndCB0cnkgYWdhaW4g4oCUIGRhdGEgbWlzc2luZyBmcm9tIHRoZSBvcmlnaW5hbCB1c2VyIHJlcXVlc3QuYCk7Cn0A"}]}