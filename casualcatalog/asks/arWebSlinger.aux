{"version":1,"state":{"368eac7c-1eaa-4656-973c-bc4e3192f365":{"id":"368eac7c-1eaa-4656-973c-bc4e3192f365","space":"shared","tags":{"form":"sphere","formOpacity":"0.5","listening":true,"onClick":"@thisBot.arWebSlingerMenuOpen();","onExitClick":"@if (configBot.tags.arEnabled) {\n    os.disableAR();\n} else if (configBot.tags.vrEnabled) {\n    os.disableVR();\n}","scale":"1.5","system":"arWebSlinger.manager","abVersion":"10.6","abArtifactName":"arWebSlinger","onABArtifactCollectShards":"@const shard: ABArtifactShard = {\n    data: {\n        managerDimension: tags.dimension,\n        managerDimensionX: tags[tags.dimension + 'X'],\n        managerDimensionY: tags[tags.dimension + 'Y'],\n        managerDimensionZ: tags[tags.dimension + 'Z'],\n    },\n    dependencies: [\n        { askID: 'arWebSlinger' }\n    ]\n}\n\nreturn shard;","onABArtifactReconstitute":"@const data = that.data;\n\nif (data.eggParameters) {\n    if (data.eggParameters.gridInformation) {\n        const dimension = data.eggParameters.gridInformation.dimension ?? 'home';\n        const dimensionX = data.eggParameters.gridInformation.position?.x ?? 0;\n        const dimensionY = data.eggParameters.gridInformation.position?.y ?? 0;\n\n        tags.dimension = dimension;\n        tags[dimension] = true;\n        tags[dimension + 'X'] = dimensionX;\n        tags[dimension + 'Y'] = dimensionY;\n    }\n}\n\nif (data.managerDimension) {\n    tags.dimension = data.managerDimension;\n    tags[data.managerDimension] = true;\n    tags[data.managerDimension + 'X'] = data.managerDimensionX;\n    tags[data.managerDimension + 'Y'] = data.managerDimensionY;\n    tags[data.managerDimension + 'Z'] = data.managerDimensionZ;\n}\n\nthisBot.refreshHex();\n\nif (data.eggParameters) {\n    thisBot.arWebSlingerMenuOpen();\n}","onABStripArtifactInstanceDataFromBotData":"@console.log(`[${tags.system}.${tagName}]`, JSON.parse(JSON.stringify(that)));\n\nconst { data } = that;\n\nconst dimension = data.tags.dimension;\n\ndelete data.tags.dimension;\ndelete data.tags[dimension];\ndelete data.tags[dimension + 'X'];\ndelete data.tags[dimension + 'Y'];\ndelete data.tags[dimension + 'Z'];","refreshHex":"@if (!links.hex) {\n    const hex = create({\n        space: 'tempLocal',\n        form: 'hex',\n        color: '#00D9CD',\n        manager: getLink(thisBot),\n        scale: 0.5,\n        scaleZ: 0.2,\n        transformer: thisBot.id,\n        pointable: false,\n        onCreate: `@\n            os.addBotListener(links.manager, 'onBotChanged', (listenerThat) => {\n                const changedTags = listenerThat.tags;\n\n                if (changedTags.includes('dimension')) {\n                    links.manager.refreshHex();\n                }\n            })\n        `\n    })\n\n    masks.hex = getLink(hex);\n}\n\nif (links.hex.tags.dimension) {\n    // Remove hex from its previous dimension.\n    const prevDim = links.hex.tags.dimension;\n    \n    console.log(`[${tags.system}.${tagName}] removing from prevDim:`, prevDim);\n\n    links.hex.tags.dimension = null;\n    links.hex.tags[prevDim] = null;\n    links.hex.tags[prevDim + 'X'] = null;\n    links.hex.tags[prevDim + 'Y'] = null;\n    links.hex.tags[prevDim + 'Z'] = null;\n    links.hex.tags[prevDim + 'RotationX'] = null;\n    links.hex.tags[prevDim + 'RotationY'] = null;\n    links.hex.tags[prevDim + 'RotationZ'] = null;\n}\n\nif (tags.dimension) {\n    // Put hex in the current dimension.\n    const curDim = tags.dimension;\n\n    console.log(`[${tags.system}.${tagName}] adding to curDim:`, curDim);\n\n    links.hex.tags.dimension = curDim;\n    links.hex.tags[curDim] = true;\n    links.hex.tags[curDim + 'X'] = 0;\n    links.hex.tags[curDim + 'Y'] = 0;\n    links.hex.tags[curDim + 'Z'] = -0.5;\n    links.hex.tags[curDim + 'RotationX'] = 0.785398;\n    links.hex.tags[curDim + 'RotationY'] = 0;\n    links.hex.tags[curDim + 'RotationZ'] = 0;\n}","debug":"false","onEnterAR":"@configBot.tags.arEnabled = true;\nthisBot.xrSetup();\nthisBot.arWebSlingerMenuReset();","onExitAR":"@configBot.tags.arEnabled = false;\nthisBot.xrTeardown();","onGridClick":"@thisBot.arWebSlingerMenuReset();","arWebSlingerMenuOpen":"@shout('arWebSlingerMenuReset');\n\nconfigBot.masks.menuPortal = 'arWebSlingerMenu';\n\nconst device = os.device();\n\nif (device.supportsAR || device.supportsVR) {\n    if (device.supportsAR) {\n        const arButton = ab.links.menu.abCreateMenuButton({\n            arWebSlingerMenu: true,\n            label: 'enter ar',\n            arWebSlingerMenuReset: `@destroy(thisBot)`,\n            onClick: `@\n                os.enableAR();\n            `\n        })\n    }\n\n    if (device.supportsVR) {\n        const vrButton = ab.links.menu.abCreateMenuButton({\n            arWebSlingerMenu: true,\n            label: 'enter vr',\n            arWebSlingerMenuReset: `@destroy(thisBot)`,\n            onClick: `@\n                os.enableVR();\n            `\n        })\n    }\n} else {\n    // Device does not support WebXR.\n    ab.links.utils.abLogAndToast({ message: 'WebXR is not available on this device.'});\n    masks.color = 'red';\n}\n","arWebSlingerMenuReset":"@configBot.masks.menuPortal = null;","cursor":"pointer","onEnterVR":"@configBot.tags.vrEnabled = true;\nthisBot.xrSetup();\nthisBot.arWebSlingerMenuReset();","onExitVR":"@configBot.tags.vrEnabled = false;\nthisBot.xrTeardown();","xrSetup":"@configBot.masks.leftWristPortal = \"arWebSlinger_leftWrist\";\n\n// Put the menu3d portal bot in the left wrist portal.\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal] = true;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'X'] = 0;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'Y'] = 0;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'Z'] = 0;\n\n// Need to move out of the mapPortal if we are in it.\nmasks.mapPortalBeforeAR = configBot.tags.mapPortal;\n\nif (configBot.tags.mapPortal) {\n    configBot.tags.mapPortal = null;\n\n    if (!configBot.tags.gridPortal) {\n        configBot.tags.gridPortal = masks.mapPortalBeforeAR;\n    }\n}\n\n// Make this manager bot into a exit ar/vr button. Put it in the wrist portal.\nmasks.onClick = `@ thisBot.onExitClick();`;\nmasks.label = \"X\";\nmasks.form = null;\nmasks.formOpacity = 1;\nmasks.draggable = false;\nmasks.color = \"clear\";\nmasks.scaleZ = 0.1;\nmasks.labelColor = \"#FFFFFF\";\nmasks.onPointerEnter = \"@ masks.scale = 1.1;\";\nmasks.onPointerExit = \"@ masks.scale = null;\";\nmasks[tags.dimension] = false;\nmasks[configBot.masks.leftWristPortal] = true;\nmasks[configBot.masks.leftWristPortal + 'X'] = 4;\nmasks[configBot.masks.leftWristPortal + 'Y'] = 3;\nmasks[configBot.masks.leftWristPortal + 'Z'] = 0;\n\nconst hexBot = getBot(\"transformer\", thisBot.id);\nhexBot.masks.color = \"clear\";","xrTeardown":"@// Remove the menu3d portal bot from the left wrist portal.\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal] = null;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'X'] = null;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'Y'] = null;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'Z'] = null;\n\nif (masks.mapPortalBeforeAR) {\n    configBot.tags.mapPortal = masks.mapPortalBeforeAR;\n}\n\nclearTagMasks(thisBot);\n\nconfigBot.masks.leftWristPortal = null;\n\nconst hexBot = getBot(\"transformer\", thisBot.id);\nclearTagMasks(hexBot);","onBotAdded":"@thisBot.refreshHex();","abIDOrigin":"arWebSlinger","onDestroy":"@thisBot.arWebSlingerMenuReset();\ndestroy([links.hex, links.keyboard_controller, links.menu3dPortalBot, links.menu3dBotPool]);","menu3dPortalBot":"ðŸ”—ea412f92-f8cd-4309-a2cd-55275bff5d4a","keyboard_controller":"ðŸ”—e50573c6-676d-425d-b3ec-19c228149fa8","menu3dBotPool":"ðŸ”—5c4af281-b164-431f-962c-8ad7b50fd453"}},"5c4af281-b164-431f-962c-8ad7b50fd453":{"id":"5c4af281-b164-431f-962c-8ad7b50fd453","space":"shared","tags":{"system":"arWebSlinger.menu3dBotPool","abArtifactName":"arWebSlinger","initialize":"@if (masks.initialized) {\n    return;\n}\n\n// Initialize the pool.\nthisBot.vars.pool = [];\n\nmasks.initialized = true;\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] invoke`);\n}\n\nfor (let i = 0; i < tags.startSize; i++) {\n    const menu3dBot = thisBot.retrieve();\n    thisBot.release(menu3dBot);\n}\n","startSize":"10","debug":"false","retrieve":"@if (!masks.initialized) {\n    return;\n}\n\nlet menu3dBot;\n\nif (thisBot.vars.pool && thisBot.vars.pool.length > 0) {\n    menu3dBot = thisBot.vars.pool.pop();\n\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] retrieved from pool (${thisBot.vars.pool.length}):`, menu3dBot);\n    }\n} else {\n    menu3dBot = thisBot._newMenu3dBot();\n\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] pool is empty, created new:`, menu3dBot);\n    }\n}\n\nwhisper(menu3dBot, 'onRetrievedFromPool');\nreturn menu3dBot;","release":"@if (!masks.initialized) {\n    return;\n}\n\nconst menu3dBot = that;\n\nassert(menu3dBot && menu3dBot.id && menu3dBot.tags, `[${tags.system}.${tagName}] must be given a Bot`);\n\nif (!menu3dBot.tags.inPool) {\n    whisper(menu3dBot, 'onReleasedToPool');\n\n    thisBot.vars.pool.push(menu3dBot);\n\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] released to pool (${thisBot.vars.pool.length}):`, menu3dBot);\n    }\n} else {\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] already in pool:`, menu3dBot);\n    }\n}\n","_newMenu3dBot":"@const menu3dBots = [];\n\nconst MENU3DBOT_BASE_TAGS = {\n    space: 'tempLocal',\n    menu3dBotPool: getLink(thisBot),\n    menu3dPortalBot: tags.menu3dPortalBot,\n    keyboard_controller: getLink(links.manager.links.keyboard_controller),\n    debug: tags.debug,\n    draggable: false,\n    pointable: false,\n}\n\nconst menu3dRootBot = create({\n    ...MENU3DBOT_BASE_TAGS,\n    menu3dBotType: 'root',\n    form: 'nothing',\n    anchorPoint: 'center',\n    onRetrievedFromPool: ListenerString(() => {\n        tags.inPool = false;\n    }),\n    configure: ListenerString(() => {\n        const { menuBot, dimension } = that;\n\n        if (tags.debug) {\n            console.log(`[menu3dRootBot.${tagName}] that:`, that);\n        }\n\n        tags.menuBot = getLink(menuBot);\n        tags.dimension = dimension;\n        tags[dimension] = true;\n        tags[dimension + 'X'] = 0;\n        tags[dimension + 'Y'] = 0;\n        tags[dimension + 'Z'] = 0;\n\n        thisBot.vars.onMenuBotChanged = (listenerThat) => {\n            if (tags.debug) {\n                console.log(`[menu3dRootBot.onMenuBotChanged] changed tags:`, listenerThat.tags);\n            }\n\n            thisBot.resyncMenuBot();\n        }\n\n        thisBot.vars.onMenuBotDestroyed = () => {\n            if (tags.debug) {\n                console.log(`[${tags.system}.onMenuBotDestroyed] menu bot was just destroyed, destroy menu 3d bot.`);\n            }\n\n            // [SLOP] Do a full refresh of the menu 3d portal.\n            if (tags.debug) {\n                console.log(`[${tags.system}.${tagName}] going to refresh menu 3d portal because a menu bot was destroyed.`);\n            }\n\n            if (links.menu3dPortalBot) {\n                links.menu3dPortalBot.refreshPortal();\n            }\n        }\n\n        os.addBotListener(links.menuBot, 'onBotChanged', thisBot.vars.onMenuBotChanged);\n        os.addBotListener(links.menuBot, 'onDestroy', thisBot.vars.onMenuBotDestroyed);\n\n        // Adjust some settings for dropdown option buttons.\n        if (menuBot.tags.abDropdownOption) {\n            tags[dimension + 'X'] = 0.5;\n        } else {\n            tags[dimension + 'X'] = 0;\n        }\n\n        const otherMenu3dBots = links.menu3dBots.filter(b => b !== thisBot);\n\n        // Set up some parameters to be the same across all other related bots.\n        for (const bot of otherMenu3dBots) {\n            bot.tags.menuBot = getLink(menuBot);\n            bot.tags.dimension = dimension;\n            bot.tags[dimension] = true;\n            bot.tags[dimension + 'X'] = 0;\n            bot.tags[dimension + 'Y'] = 0;\n            bot.tags[dimension + 'Z'] = 0;\n        }\n\n        whisper(otherMenu3dBots, 'onConfigure', that);\n\n        thisBot.resyncMenuBot();\n    }),\n    onReleasedToPool: ListenerString(() => {\n        if (tags.debug) {\n            console.log(`[menu3dRootBot.${tagName}] invoke`);\n        }\n\n        tags.inPool = true;\n\n        const dimension = tags.dimension;\n\n        if (dimension) {\n            tags.dimension = null;\n            tags[dimension] = null;\n            tags[dimension + 'X'] = null;\n            tags[dimension + 'Y'] = null;\n            tags[dimension + 'Z'] = null;\n        }\n\n        if (links.menuBot) {\n            os.removeBotListener(links.menuBot, 'onBotChanged', thisBot.vars.onMenuBotChanged);\n            os.removeBotListener(links.menuBot, 'onDestroy', thisBot.vars.onMenuBotDestroyed);\n        }\n        \n        tags.menuBot = null;\n\n        if (links.menu3dBots) {\n            const otherMenu3dBots = links.menu3dBots.filter(b => b !== thisBot);\n\n            // Reset some parameters across all other related bots.\n            for (const bot of otherMenu3dBots) {\n                bot.tags.menuBot = null;\n\n                if (dimension) {\n                    bot.tags.dimension = null;\n                    bot.tags[dimension] = null;\n                    bot.tags[dimension + 'X'] = null;\n                    bot.tags[dimension + 'Y'] = null;\n                    bot.tags[dimension + 'Z'] = null;\n                }\n            }\n\n            whisper(otherMenu3dBots, 'onReleasedToPool');\n        }\n    }),\n    resyncMenuBot: ListenerString(() => {\n        const menuBot = links.menuBot;\n\n        if (!menuBot) {\n            if (tags.debug) {\n                console.log(`[menu3dRootBot.${tagName}] menu bot is no longer around, releasing back to pool.`);\n            }\n\n            links.menu3dBotPool.release(thisBot);\n            return;\n        }\n        \n        if (tags.debug) {\n            console.log(`[menu3dRootBot.onMenuBotChanged] resync menu bot.`);\n        }\n\n        whisper(links.menu3dBots, 'onResyncMenuBot');\n    }),\n    onDestroy: ListenerString(() => {\n        if (tags.debug) {\n            console.log(`[menu3dRootBot.${tagName}] invoke`);\n        }\n    })\n})\n\n// Every menu 3d bot after this point gets a link to the root bot.\nMENU3DBOT_BASE_TAGS.menu3dRootBot = getLink(menu3dRootBot);\n\n// Every menu 3d bot after this point is parented to the root bot.\nMENU3DBOT_BASE_TAGS.transformer = menu3dRootBot.id;\n\nconst menu3dShapeBot = create({\n    ...MENU3DBOT_BASE_TAGS,\n    menu3dBotType: 'shape',\n    form: 'cube',\n    pointable: true,\n    scaleX: tags.menu3dBot_width,\n    scaleY: tags.menu3dBot_height,\n    scaleZ: tags.menu3dBot_depth,\n    onClick: ListenerString(() => {\n        if (links.menuBot.tags.form === 'input') {\n            // Focus this bot for keyboard input.\n            links.keyboard_controller.focus({ targetBot: thisBot })\n        } else {\n            whisper(links.menuBot, 'onClick', that);\n        }\n    }),\n    onPointerEnter: ListenerString(() => {\n        tags.hover = true;\n    }),\n    onPointerExit: ListenerString(() => {\n        tags.hover = false;\n    }),\n    onPointerDown: ListenerString(() => {\n        tags.down = true;\n    }),\n    onPointerUp: ListenerString(() => {\n        tags.down = false;\n    }),\n    onKeyboardFocus: ListenerString(() => {\n        masks.strokeColor = 'white';\n        masks.strokeWidth = 5;\n    }),\n    onKeyboardBlur: ListenerString(() => {\n        masks.strokeColor = null;\n        masks.strokeWidth = null;\n    }),\n    onReleasedToPool: ListenerString(() => {\n        masks.strokeColor = null;\n        masks.strokeWidth = null;\n    }),\n    onKeyboardClick: ListenerString(() => {\n        const { key } = that;\n\n        if (key === 'Enter') {\n            // [SLOP] Treat enter as submit for 3d menu inputs.\n            if (links.menuBot.tags.menuItemText) {\n                whisper(links.menuBot, 'onSubmit', { text: links.menuBot.tags.menuItemText });\n            }\n        } else {\n            if (tags.debug) {\n                console.log(`[menu3dShapeBot.${tagName}] that:`, that);\n            }\n\n            links.menuBot.tags.menuItemText = ab.links.utils.applyKeyToText({ key, text: links.menuBot.tags.menuItemText });\n\n            whisper(links.menuBot, 'onInputTyping', { text: links.menuBot.tags.menuItemText });\n        }\n\n    }),\n    refreshPointerState: ListenerString(() => {\n        if (tags.hover) {\n            if (tags.down) {\n                masks.color = ab.links.utils.adjustBrightness({ color: tags.baseColor, factor: 0.9 });\n            } else {\n                masks.color = ab.links.utils.adjustBrightness({ color: tags.baseColor, factor: 1.1 });\n            }\n        } else {\n            masks.color = null;\n        }\n    }),\n    onBotChanged: ListenerString(() => {\n        let baseColorChanged = false;\n        let hoverChanged = false;\n        let downChanged = false;\n\n        for (let tag of that.tags) {\n            if (tag === 'hover') {\n                hoverChanged = true;\n            } else if (tag === 'down') {\n                downChanged = true;\n            } else if (tag === 'baseColor') {\n                baseColorChanged = true;\n            }\n        }\n\n        if (hoverChanged || downChanged || baseColorChanged) {\n            thisBot.refreshPointerState();\n        }\n    }),\n    onResyncMenuBot: ListenerString(() => {\n        let cursor;\n        if (links.menuBot.tags.form === 'input') {\n            cursor = 'text';\n        } else {\n            if (links.menuBot.tags.onClick) {\n                cursor = 'pointer';\n            }\n        }\n\n        if (tags.cursor !== cursor) {\n            tags.cursor = cursor;\n        }\n\n        if (tags.color !== links.menuBot.tags.color) {\n            tags.baseColor = links.menuBot.tags.color;\n            tags.color = links.menuBot.tags.color;\n        }\n    })\n});\n\nmenu3dBots.push(menu3dShapeBot);\nmenu3dRootBot.tags.menu3dShapeBot = getLink(menu3dShapeBot);\n\nconst menu3dLabelBot = create({\n    ...MENU3DBOT_BASE_TAGS,\n    menu3dBotType: 'label',\n    color: 'clear',\n    // color: 'red',\n    pointable: false,\n    label: '',\n    scaleZ: 0,\n    labelFontSize: 1,\n    labelAlignment: 'left',\n    labelWordWrapMode: 'breakWords',\n    onResyncMenuBot: ListenerString(() => {\n        const inXR = configBot.tags.arEnabled || configBot.tags.vrEnabled;\n\n        // Label size\n        let labelWidth;\n        let labelX;\n        let labelZ = inXR ? 0 : links.menu3dBotPool.tags.menu3dBot_depth;\n\n        if (links.menuBot.tags.menuItemText) {\n            // Submit button should be enabled.\n            labelWidth = links.menu3dBotPool.tags.menu3dBot_width - (links.menu3dBotPool.tags.menu3dBot_iconWidth * 2);\n            labelX = 0;\n        } else {\n            // No submit button.\n            labelWidth = links.menu3dBotPool.tags.menu3dBot_width - links.menu3dBotPool.tags.menu3dBot_iconWidth;\n            labelX = links.menu3dBotPool.tags.menu3dBot_iconWidth / 2;\n        }\n\n        if (tags.scaleX !== labelWidth) {\n            tags.scaleX = labelWidth;\n        }\n        \n        if (tags[tags.dimension + 'X'] !== labelX) {\n            tags[tags.dimension + 'X'] = labelX;\n        }\n\n        if (tags[tags.dimension + 'Z'] !== labelZ) {\n            tags[tags.dimension + 'Z'] = labelZ;\n        }\n\n        // Label text\n        let labelText;\n\n        if (links.menuBot.tags.form === 'input') {\n            if (links.menuBot.tags.menuItemText) {\n                labelText = links.menuBot.tags.menuItemText;\n            } else {\n                labelText = links.menuBot.tags.label;\n            }\n        } else {\n            labelText = links.menuBot.tags.label;\n        }\n\n        if (tags.label !== labelText) {\n            tags.label = labelText;\n        }\n    })\n})\n\nmenu3dBots.push(menu3dLabelBot);\nmenu3dRootBot.tags.menu3dLabelBot = getLink(menu3dLabelBot);\n\nconst ICON_X = -(tags.menu3dBot_width / 2) + (tags.menu3dBot_iconWidth / 2);\n\nconst menu3dIconBot = create({\n    ...MENU3DBOT_BASE_TAGS,\n    menu3dBotType: 'icon',\n    form: 'nothing',\n    pointable: false,\n    scaleX: tags.menu3dBot_iconSize,\n    scaleY: tags.menu3dBot_iconSize,\n    scaleZ: 0.1,\n    iconX: ICON_X,\n    iconZ: tags.menu3dBot_depth,\n    onResyncMenuBot: ListenerString(async () => {\n        await os.sleep(0);\n        if (tags.icon !== links.menuBot.tags.formAddress) {\n            tags.icon = links.menuBot.tags.formAddress;\n\n            if (tags.icon) {\n                tags.form = 'sprite';\n\n                if (tags.icon.startsWith('https://')) {\n                    tags.formAddress = tags.icon;\n                } else  {\n                    const iconUrl = links.menu3dBotPool.getMaterialIconURL({ iconName: tags.icon });\n                    tags.formAddress = iconUrl;\n                }\n            } else {\n                tags.form = 'nothing';\n            }\n        }\n\n        if (tags[tags.dimension + 'X'] !== tags.iconX){\n            tags[tags.dimension + 'X'] = tags.iconX;\n        }\n\n        if (tags[tags.dimension + 'Z'] !== tags.iconZ){\n            tags[tags.dimension + 'Z'] = tags.iconZ;\n        }\n    }),\n})\n\nmenu3dBots.push(menu3dIconBot);\nmenu3dRootBot.tags.menu3dIconBot = getLink(menu3dIconBot);\n\nconst SUBMIT_X = (tags.menu3dBot_width / 2) - (tags.menu3dBot_iconWidth / 2);\n\nconst menu3dSubmitBot = create({\n    ...MENU3DBOT_BASE_TAGS,\n    menu3dBotType: 'submit',\n    pointable: true,\n    formAddress: thisBot.getMaterialIconURL({ iconName: 'send' }),\n    scaleX: tags.menu3dBot_iconSize,\n    scaleY: tags.menu3dBot_iconSize,\n    scaleZ: 0.1,\n    cursor: 'pointer',\n    submitX: SUBMIT_X,\n    submitZ: tags.menu3dBot_depth,\n    onClick: ListenerString(() => {\n        if (links.menuBot.tags.menuItemText) {\n            whisper(links.menuBot, 'onSubmit', { text: links.menuBot.tags.menuItemText });\n        }\n    }),\n    onResyncMenuBot: ListenerString(() => {\n        // Show/Hide submit button based on if there is text inputted.\n        let form = links.menuBot.tags.menuItemText ? 'sprite' : 'nothing';\n        if (tags.form !== form) {\n            tags.form = form;\n        }\n\n        if (tags[tags.dimension + 'X'] !== tags.submitX) {\n            tags[tags.dimension + 'X'] = tags.submitX\n        }\n        \n        if (tags[tags.dimension + 'Z'] !== tags.submitZ) {\n            tags[tags.dimension + 'Z'] = tags.submitZ\n        }\n    }),\n})\n\nmenu3dBots.push(menu3dSubmitBot);\nmenu3dRootBot.tags.menu3dSubmitBot = getLink(menu3dSubmitBot);\n\nmenu3dRootBot.masks.menu3dBots = getLink(menu3dBots);\n\nreturn menu3dRootBot;","menu3dBot_depth":"0.3","menu3dBot_height":"1","menu3dBot_iconSize":"0.5","menu3dBot_iconWidth":"1","menu3dBot_width":"8","getMaterialIconURL":"@const { \n    iconName,\n    style = 'filled'          // 'filled', 'outlined', 'round', 'sharp', 'two-tone'\n} = that;\n\nif (iconName === 'cube') {\n    // Hardcoded icon supported by CasualOS.\n    return 'https://cdn.jsdelivr.net/gh/casual-simulation/casualos@latest/src/aux-components/icons/Cube.svg';\n} else if (iconName === 'egg') {\n    // Hardcoded icon supported by CasualOS.\n    return 'https://cdn.jsdelivr.net/gh/casual-simulation/casualos@latest/src/aux-components/icons/Egg.svg';\n} else if (iconName === 'helix') {\n    // Hardcoded icon supported by CasualOS.\n    return 'https://cdn.jsdelivr.net/gh/casual-simulation/casualos@latest/src/aux-components/icons/Helix.svg';\n} else {\n    // Map style names to package directory names\n    const styleMap = {\n        'filled': 'filled',\n        'outlined': 'outlined',\n        'round': 'round',\n        'sharp': 'sharp',\n        'twotone': 'two-tone',\n        'two-tone': 'two-tone'\n    };\n\n    const iconStyle = styleMap[style] ?? 'filled';\n\n    // Using jsDelivr CDN for @material-design-icons/svg (auto-updated, latest icons)\n    // [SLOP] We should not use a google CDN for this but instead our own repository (casual catalog).\n    const url = `https://cdn.jsdelivr.net/npm/@material-design-icons/svg@latest/${iconStyle}/${iconName}.svg`;\n\n    return url;\n}","manager":"ðŸ”—368eac7c-1eaa-4656-973c-bc4e3192f365","menu3dPortalBot":"ðŸ”—ea412f92-f8cd-4309-a2cd-55275bff5d4a"}},"e50573c6-676d-425d-b3ec-19c228149fa8":{"id":"e50573c6-676d-425d-b3ec-19c228149fa8","space":"shared","tags":{"system":"arWebSlinger.keyboard_controller","abArtifactName":"arWebSlinger","show":"@const {\n    dimension = configBot.tags.gridPortal ?? 'home',\n    position = new Vector3(0, 0, 0),\n    scale = 1,\n} = that ?? {};\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] that:`, that);\n}\n\nif (!links.keyboardBot) {\n    const keyboardBot = create({\n        space: 'tempLocal',\n        form: 'keyboard',\n        controller: getLink(thisBot),\n        draggable: false,\n        onKeyClick: ListenerString(() => {\n            links.controller.keyClick(that);\n        })\n    })\n\n    masks.keyboardBot = getLink(keyboardBot);\n}\n\nlinks.keyboardBot.tags.dimension = dimension;\nlinks.keyboardBot.tags[dimension] = true;\nlinks.keyboardBot.tags[dimension + 'X'] = position.x;\nlinks.keyboardBot.tags[dimension + 'Y'] = position.y;\nlinks.keyboardBot.tags[dimension + 'Z'] = position.z;\nlinks.keyboardBot.tags.scaleX = scale;\nlinks.keyboardBot.tags.scaleY = scale;\n\nreturn links.keyboardBot;","blur":"@if (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] invoke`);\n}\n\n\nwhisper(links.targetBot, 'onKeyboardBlur');\nshout('onAnyKeyboardBlur', { targetBot: links.targetBot });\n\nmasks.targetBot = null;\nmasks.targetBotId = null;","focus":"@const { targetBot } = that;\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] that:`, that);\n}\n\nassert(targetBot && targetBot.id && targetBot.tags, `[${tags.system}.${tagName}] targetBot is a required Bot parameter.`);\n\nmasks.targetBot = getLink(targetBot);\nmasks.targetBotId = targetBot.id;\n\nwhisper(links.targetBot, 'onKeyboardFocus');\nshout('onAnyKeyboardFocus', { targetBot });\n","hide":"@if (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] invoke`);\n}\n\nif (links.keyboardBot) {\n    destroy(links.keyboardBot);\n    thisBot.blur();\n}","keyClick":"@const { key } = that;\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] that:`, that);\n}\n\nif (links.targetBot) {\n    whisper(links.targetBot, 'onKeyboardClick', { key });\n}\n\nshout('onAnyKeyboardClick', { key, targetBot: links.targetBot });","debug":"false","onKeyDown":"@if (!links.targetBot) {\n    // Ignore physical keyboard keystrokes if we do not have a target bot.\n    return;\n}\n\nconst { keys } = that;\n\nfor (let key of keys) {\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] physical keyboard key down:`, key);\n    }\n    \n    thisBot.keyClick({ key });\n}","onKeyRepeat":"@// Just forward the repeat key event to our onKeyDown handler.\nthisBot.onKeyDown(that);","onAnyBotClicked":"@const { bot } = that;\n\nif (links.targetBot) {\n    if (bot !== links.targetBot && bot !== links.keyboardBot) {\n        thisBot.blur();\n    }\n}","abIDOrigin":"arWebSlinger","onGridClick":"@thisBot.blur();","onAnyBotsRemoved":"@const { botIDs } = that;\n\nif (masks.targetBotId) {\n    if (botIDs.includes(masks.targetBotId)) {\n        // Hide keyboard if target bot gets destroyed.\n        thisBot.hide();\n    }\n}"}},"ea412f92-f8cd-4309-a2cd-55275bff5d4a":{"id":"ea412f92-f8cd-4309-a2cd-55275bff5d4a","space":"shared","tags":{"system":"arWebSlinger.menu3dPortalBot","onPortalChanged":"@if (!masks.initialized) {\n    return;\n}\n\nconst { portal, dimension } = that;\n\nif (portal === 'menuPortal') {\n    if (masks.showingMenuPortal !== dimension) {\n        masks.showingMenuPortal = dimension;\n        \n        if (tags.debug) {\n            console.log(`[${tags.system}.${tagName}] going to refresh menu 3d portal because menu portal dimension was changed: ${dimension}`);\n        }\n\n        thisBot.refreshPortal();\n    }\n}","form":"portal","formAddress":"arWebSlinger_menu3d","onAnyBotsAdded":"@if (!masks.initialized) {\n    return;\n}\n\nif (!configBot) {\n    return;\n}\n\nconst menuPortal = configBot.tags.menuPortal;\n\nif (menuPortal) {\n    // Add bots that are in the current menu portal to the web slinger's 3d menu.\n    let needRefreshPortal = false;\n\n    for (let i = 0; i < that.bots.length; i++) {\n        const bot = that.bots[i];\n\n        if (bot) {\n            if (bot.tags[menuPortal] == true) {\n                needRefreshPortal = true;\n                break;\n            }\n        }\n    }\n\n    if (needRefreshPortal) {\n        if (tags.debug) {\n            console.log(`[${tags.system}.${tagName}] going to refresh menu 3d portal because new bots were added to the menu portal.`);\n        }\n        \n        thisBot.refreshPortal();\n    }\n}\n","manager":"ðŸ”—368eac7c-1eaa-4656-973c-bc4e3192f365","abArtifactName":"arWebSlinger","onABInitialized":"@thisBot.initialize();","debug":"false","home":"false","refreshPortal":"@if (!masks.initialized) {\n    return;\n}\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] invoke`);\n}\n\nconst runId = uuid();\nthisBot.vars.currentRunId = runId;\n\nawait os.sleep(0);\n\nif (runId !== thisBot.vars.currentRunId) {\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] ignore call because a newer one has occured.`);\n    }\n\n    return;\n}\n\nconst menu3dDimension = tags.formAddress;\n\nif (!links.menu3dParentBot) {\n    const menu3dParentBot = create({\n        space: 'tempLocal',\n        form: 'nothing',\n        scale: 0.5,\n        dimension: menu3dDimension,\n        [menu3dDimension]: true,\n        [menu3dDimension + 'X']: 0,\n        [menu3dDimension + 'Y']: 0,\n    })\n\n    masks.menu3dParentBot = getLink(menu3dParentBot);\n}\n\n// [SLOP] This is lazy - we dont need to release menu 3d bots to the pool if they still exist in the menu portal.\nconst existingMenu3dBots = getBots(b => b.tags.menu3dBotType === 'root');\nfor (const menu3dBot of existingMenu3dBots) {\n    links.menu3dBotPool.release(menu3dBot);\n}\n\nconst menuPortal = configBot.tags.menuPortal;\n\n// Store what menu portal we are currently showing.\nmasks.showingMenuPortal = menuPortal;\n\nif (menuPortal) {\n    const menuBots = getBots((b) => {\n        return b.tags[menuPortal] === true\n    })\n\n    if (tags.debug) {\n        const menuBotCreateTimes = menuBots.map((b) => {\n            return { label: b.tags.label, abCreateTime: b.tags.abCreateTime }\n        })\n\n        console.log(`[${tags.system}.${tagName}] menuBotCreateTimes:`, menuBotCreateTimes);\n    }\n\n    // Sort bots to be in the same order that they appear in the menu portal.\n    menuBots.sort((a, b) => {\n        const aSortOrder = a.tags[menuPortal + 'SortOrder'] ?? 0;\n        const bSortOrder = b.tags[menuPortal + 'SortOrder'] ?? 0;\n\n        if (aSortOrder == bSortOrder) {\n            const aCreateTime = a.tags.abCreateTime ?? 0;\n            const bCreateTime = b.tags.abCreateTime ?? 0;\n\n            // If a and b have the same sort order, then sort by creation time.\n            return aCreateTime - bCreateTime;\n        } else {\n            return aSortOrder - bSortOrder;\n        }\n    });\n\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] ${menuBots.length} bots found in menu portal '${menuPortal}':`, menuBots);\n    }\n\n    if (menuBots.length > 0) {\n        menuBots.reverse();\n\n        for (let i = 0; i < menuBots.length; i++) {\n            const menuBot = menuBots[i];\n            const menu3dBot = links.menu3dBotPool.retrieve();\n            menu3dBot.configure({ menuBot, dimension: menu3dDimension });\n\n            // Parent each menu3dBot to the menu3dParentBot.\n            menu3dBot.tags.transformer = links.menu3dParentBot.id;\n            \n            menu3dBot.tags[menu3dDimension + 'Y'] = i * (links.menu3dBotPool.tags.menu3dBot_height + tags.menu3d_botSpacing)\n\n        }\n    }\n} else {\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] No menu portal is open.`);\n    }\n}","menu3d_botSpacing":"0.2","onABArtifactReconstitute":"@thisBot.initialize();","initialize":"@if (masks.initialized) {\n    return;\n}\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] invoke`);\n}\n\nmasks.initialized = true;\n\nawait links.menu3dBotPool.initialize();\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] going to refresh menu 3d portal because the menu 3d portal has been initialized.`);\n}\n\nthisBot.refreshPortal();","onEggHatch":"@thisBot.initialize();","abIDOrigin":"arWebSlinger","menu3dBotProperties":"ðŸ§¬{\n    \"hello\": \"world!\"\n\n}","inWristPortal":"@const leftWristPortal = configBot.tags.leftWristPortal;\nconst rightWristPortal = configBot.tags.rightWristPortal;\n\nif (leftWristPortal && tags[leftWristPortal] === true) {\n    return true;\n} else if (rightWristPortal && tags[rightWristPortal]) {\n    return true;\n}\n\nreturn false;","onDestroy":"@destroy(links.menu3dParentBot);","onAnyKeyboardFocus":"@// [SLOP] Show keyboard in menu 3d portal.\nconst dimension = tags.formAddress;\n\nconst keyboardBot = links.keyboard_controller.show({\n    dimension,\n    position: new Vector3(0, -1.5, 0),\n    scale: 5,\n})","onAnyKeyboardBlur":"@// [SLOP] always hide keyboard when blur happens.\nlinks.keyboard_controller.hide();","keyboard_controller":"ðŸ”—e50573c6-676d-425d-b3ec-19c228149fa8","menu3dBotPool":"ðŸ”—5c4af281-b164-431f-962c-8ad7b50fd453","onAnyBotsChanged":"@if (!masks.initialized) {\n    return;\n}\n\nif (!configBot) {\n    return;\n}\n\nconst menuPortal = configBot.tags.menuPortal;\n\nif (menuPortal) {\n    let needRefreshPortal = false;\n\n    for (let entry of that) {\n        if (entry.tags.includes(menuPortal)) {\n            needRefreshPortal = true;\n            break;\n        }\n    }\n\n    if (needRefreshPortal) {\n        if (tags.debug) {\n            console.log(`[${tags.system}.${tagName}] going to refresh menu 3d portal because bots entered/exited the menu portal.`);\n        }\n        \n        thisBot.refreshPortal();\n    }\n}"}}}}