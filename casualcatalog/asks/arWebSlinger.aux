{"version":1,"state":{"42972966-b631-4f76-b3cc-af3a86b8e14a":{"id":"42972966-b631-4f76-b3cc-af3a86b8e14a","space":"shared","tags":{"system":"arWebSlinger.menu3dPortalBot","onPortalChanged":"@if (!masks.initialized) {\n    return;\n}\n\nconst { portal, dimension } = that;\n\nif (portal === 'menuPortal') {\n    if (masks.showingMenuPortal !== dimension) {\n        masks.showingMenuPortal = dimension;\n        \n        if (tags.debug) {\n            console.log(`[${tags.system}.${tagName}] going to refresh menu 3d portal because menu portal dimension was changed: ${dimension}`);\n        }\n\n        thisBot.refreshPortal();\n    }\n}","form":"portal","formAddress":"arWebSlinger_menu3d","onAnyBotsAdded":"@if (!masks.initialized) {\n    return;\n}\n\nconst menuPortal = configBot.tags.menuPortal;\n\n// Add bots that are in the current menu portal to the web slinger's 3d menu.\nlet needRefreshPortal = false;\n\nfor (let i = 0; i < that.bots.length; i++) {\n    const bot = that.bots[i];\n\n    if (bot) {\n        if (bot.tags[menuPortal] == true) {\n            needRefreshPortal = true;\n        }\n    }\n}\n\nif (needRefreshPortal) {\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] going to refresh menu 3d portal because bots were added to the menu portal.`);\n    }\n    \n    thisBot.refreshPortal();\n}","manager":"ðŸ”—bfc32898-55c6-40ce-bb68-dba3e7f5d772","abArtifactName":"arWebSlinger","onABInitialized":"@thisBot.initialize();","debug":"false","home":"false","refreshPortal":"@if (!masks.initialized) {\n    return;\n}\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] invoke`);\n}\n\nconst runId = uuid();\nthisBot.vars.currentRunId = runId;\n\nawait os.sleep(0);\n\nif (runId !== thisBot.vars.currentRunId) {\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] ignore call because a newer one has occured.`);\n    }\n\n    return;\n}\n\nconst menu3dDimension = tags.formAddress;\n\nif (!links.menu3dParentBot) {\n    const menu3dParentBot = create({\n        space: 'tempLocal',\n        form: 'nothing',\n        scale: 0.5,\n        dimension: menu3dDimension,\n        [menu3dDimension]: true,\n        [menu3dDimension + 'X']: 0,\n        [menu3dDimension + 'Y']: 0,\n    })\n\n    masks.menu3dParentBot = getLink(menu3dParentBot);\n}\n\n// [SLOP] This is bad and we should optimize this, we dont need to always destroy everything if its still needed.\nconst existingMenu3dBots = getBots(b => b.tags.isMenu3dBot);\ndestroy(existingMenu3dBots);\n\nconst menuPortal = configBot.tags.menuPortal;\n\n// Store what menu portal we are currently showing.\nmasks.showingMenuPortal = menuPortal;\n\nif (menuPortal) {\n    const menuBots = getBots((b) => {\n        return b.tags[menuPortal] === true\n    })\n\n    if (tags.debug) {\n        const menuBotCreateTimes = menuBots.map((b) => {\n            return { label: b.tags.label, abCreateTime: b.tags.abCreateTime }\n        })\n\n        console.log(`[${tags.system}.${tagName}] menuBotCreateTimes:`, menuBotCreateTimes);\n    }\n\n    // Sort bots to be in the same order that they appear in the menu portal.\n    menuBots.sort((a, b) => {\n        const aSortOrder = a.tags[menuPortal + 'SortOrder'] ?? 0;\n        const bSortOrder = b.tags[menuPortal + 'SortOrder'] ?? 0;\n\n        if (aSortOrder == bSortOrder) {\n            const aCreateTime = a.tags.abCreateTime ?? 0;\n            const bCreateTime = b.tags.abCreateTime ?? 0;\n\n            // If a and b have the same sort order, then sort by creation time.\n            return aCreateTime - bCreateTime;\n        } else {\n            return aSortOrder - bSortOrder;\n        }\n    });\n\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] ${menuBots.length} bots found in menu portal '${menuPortal}':`, menuBots);\n    }\n\n    if (menuBots.length > 0) {\n        menuBots.reverse();\n\n        for (let i = 0; i < menuBots.length; i++) {\n            const menuBot = menuBots[i];\n            const menu3dBot = thisBot.createMenu3dBot({ menuBot });\n\n            // Parent each menu3dBot to the menu3dParentBot.\n            menu3dBot.tags.transformer = links.menu3dParentBot.id;\n            \n            menu3dBot.tags[menu3dDimension + 'Y'] = i * (tags.menu3dBot_height + tags.menu3d_botSpacing)\n\n        }\n    }\n} else {\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] No menu portal is open.`);\n    }\n}","createMenu3dBot":"@const {\n    menuBot\n} = that;\n\nif (!menuBot) {\n    console.error(`[${tags.system}.${tagName}] must provide original menuBot to create menu3dBot for.`);\n    return null;\n}\n\nconst dimension = tags.formAddress;\nconst menu3dBots = [];\n\nconst MENU3DBOT_BASE_TAGS = {\n    space: 'tempLocal',\n    isMenu3dBot: true,\n    menuBot: getLink(menuBot),\n    menu3dPortalBot: getLink(thisBot),\n    keyboard_controller: getLink(links.manager.links.keyboard_controller),\n    dimension,\n    draggable: false,\n    pointable: false,\n    [dimension]: true,\n    [dimension + 'X']: 0,\n    [dimension + 'Y']: 0,\n    [dimension + 'Z']: 0,\n}\n\nconst menu3dRootBot = create({\n    ...MENU3DBOT_BASE_TAGS,\n    menu3dBotType: 'root',\n    form: 'nothing',\n    anchorPoint: 'center',\n    initialize: ListenerString(async () => {\n        const { bots } = that;\n\n        if (tags.initialized) {\n            return;\n        }\n\n        tags.initialized = true;\n\n        links.menu3dBots = getLink(bots);\n\n        links.menu3dShapeBot = bots.find(b => b.tags.menu3dBotType === 'shape');\n        links.menu3dLabelBot = bots.find(b => b.tags.menu3dBotType === 'label');\n        links.menu3dIconBot = bots.find(b => b.tags.menu3dBotType === 'icon');\n        links.menu3dSubmitBot = bots.find(b => b.tags.menu3dBotType === 'submit');\n\n        if (links.menu3dPortalBot.tags.debug) {\n            console.log(`[menu3dRootBot.${tagName}] invoke`);\n        }\n        \n        thisBot.vars.onMenuBotChanged = (listenerThat) => {\n            if (links.menu3dPortalBot.tags.debug) {\n                console.log(`[menu3dRootBot.onMenuBotChanged] changed tags:`, listenerThat.tags);\n            }\n\n            thisBot.resyncMenuBot();\n        }\n\n        thisBot.vars.onMenuBotDestroyed = () => {\n            if (links.menu3dPortalBot.tags.debug) {\n                console.log(`[${tags.system}.onMenuBotDestroyed] menu bot was just destroyed, destroy menu 3d bot.`);\n            }\n\n            // [SLOP] Do a full refresh of the menu 3d portal.\n            if (tags.debug) {\n                console.log(`[${tags.system}.${tagName}] going to refresh menu 3d portal because a menu bot was destroyed.`);\n            }\n\n            links.menu3dPortalBot.refreshPortal();\n        }\n\n        os.addBotListener(links.menuBot, 'onBotChanged', thisBot.vars.onMenuBotChanged);\n        os.addBotListener(links.menuBot, 'onDestroy', thisBot.vars.onMenuBotDestroyed);\n\n        // Hide all bots while we wait for CasualOS to catchup.\n        for (const menu3dBot of links.menu3dBots) {\n            menu3dBot.masks[tags.dimension] = false;\n        }\n        \n        await os.sleep(0);\n\n        // Show all bots while we wait for CasualOS to catchup.\n        for (const menu3dBot of links.menu3dBots) {\n            menu3dBot.masks[tags.dimension] = null;\n        }\n\n        thisBot.resyncMenuBot();\n    }),\n    resyncMenuBot: ListenerString(() => {\n        const menuBot = links.menuBot;\n\n        if (!menuBot) {\n            if (links.menu3dPortalBot.tags.debug) {\n                console.log(`[menu3dRootBot.${tagName}] menu bot is no longer around, destroying menu 3d bot.`);\n            }\n\n            destroy(thisBot);\n            return;\n        }\n        \n        if (links.menu3dPortalBot.tags.debug) {\n            console.log(`[menu3dRootBot.onMenuBotChanged] resync menu bot.`);\n        }\n\n        whisper(links.menu3dBots, 'onResyncMenuBot');\n    }),\n    onDestroy: ListenerString(() => {\n        if (links.menu3dPortalBot.tags.debug) {\n            console.log(`[menu3dRootBot.${tagName}] invoke`);\n        }\n\n        if (links.menuBot) {\n            os.removeBotListener(links.menuBot, 'onBotChanged', thisBot.vars.onMenuBotChanged);\n            os.removeBotListener(links.menuBot, 'onDestroy', thisBot.vars.onMenuBotDestroyed);\n        }\n    })\n})\n\n// Adjust some settings for dropdown option buttons.\nif (menuBot.tags.abDropdownOption) {\n    menu3dRootBot.tags[dimension + 'X'] += 0.5;\n}\n\n// Every menu 3d bot after this point gets a link to the root bot.\nMENU3DBOT_BASE_TAGS.menu3dRootBot = getLink(menu3dRootBot);\n\n// Every menu 3d bot after this point is parented to the root bot.\nMENU3DBOT_BASE_TAGS.transformer = menu3dRootBot.id;\n\nconst menu3dShapeBot = create({\n    ...MENU3DBOT_BASE_TAGS,\n    menu3dBotType: 'shape',\n    form: 'cube',\n    pointable: true,\n    scaleX: tags.menu3dBot_width,\n    scaleY: tags.menu3dBot_height,\n    scaleZ: tags.menu3dBot_depth,\n    onClick: ListenerString(() => {\n        if (links.menuBot.tags.form === 'input') {\n            // Focus this bot for keyboard input.\n            links.keyboard_controller.focus({ targetBot: thisBot })\n        } else {\n            whisper(links.menuBot, 'onClick', that);\n        }\n    }),\n    onKeyboardFocus: ListenerString(() => {\n        masks.strokeColor = 'white';\n        masks.strokeWidth = 5;\n    }),\n    onKeyboardBlur: ListenerString(() => {\n        masks.strokeColor = null;\n        masks.strokeWidth = null;\n    }),\n    onKeyboardClick: ListenerString(() => {\n        const { key } = that;\n\n        if (links.menu3dPortalBot.tags.debug) {\n            console.log(`[menu3dShapeBot.${tagName}] that:`, that);\n        }\n\n        links.menuBot.tags.menuItemText = ab.links.utils.applyKeyToText({ key, text: links.menuBot.tags.menuItemText });\n    }),\n    onResyncMenuBot: ListenerString(() => {\n        let cursor;\n        if (links.menuBot.tags.form === 'input') {\n            cursor = 'text';\n        } else {\n            if (links.menuBot.tags.onClick) {\n                cursor = 'pointer';\n            }\n        }\n\n        if (tags.cursor !== cursor) {\n            tags.cursor = cursor;\n        }\n\n        if (tags.color !== links.menuBot.tags.color) {\n            tags.color = links.menuBot.tags.color;\n        }\n    })\n});\n\nmenu3dBots.push(menu3dShapeBot);\n\nconst menu3dLabelBot = create({\n    ...MENU3DBOT_BASE_TAGS,\n    menu3dBotType: 'label',\n    color: 'clear',\n    // color: 'red',\n    pointable: false,\n    label: '',\n    scaleZ: 0.1,\n    labelAlignment: 'left',\n    [dimension + 'Z']: tags.menu3dBot_depth,\n    onResyncMenuBot: ListenerString(() => {\n        // Label size\n        let labelWidth;\n        let labelX;\n\n        if (links.menuBot.tags.menuItemText) {\n            // Submit button should be enabled.\n            labelWidth = links.menu3dPortalBot.tags.menu3dBot_width - (links.menu3dPortalBot.tags.menu3dBot_iconWidth * 2);\n            labelX = 0;\n        } else {\n            // No submit button.\n            labelWidth = links.menu3dPortalBot.tags.menu3dBot_width - links.menu3dPortalBot.tags.menu3dBot_iconWidth;\n            labelX = links.menu3dPortalBot.tags.menu3dBot_iconWidth / 2;\n        }\n\n        if (tags.scaleX !== labelWidth) {\n            tags.scaleX = labelWidth;\n        }\n        \n        if (tags[tags.dimension + 'X'] !== labelX) {\n            tags[tags.dimension + 'X'] = labelX;\n        }\n\n        // Label text\n        let labelText;\n\n        if (links.menuBot.tags.form === 'input') {\n            if (links.menuBot.tags.menuItemText) {\n                labelText = links.menuBot.tags.menuItemText;\n            } else {\n                labelText = links.menuBot.tags.label;\n            }\n        } else {\n            labelText = links.menuBot.tags.label;\n        }\n\n        if (tags.label !== labelText) {\n            tags.label = labelText;\n        }\n    })\n})\n\nmenu3dBots.push(menu3dLabelBot);\n\nconst ICON_X = -(tags.menu3dBot_width / 2) + (tags.menu3dBot_iconWidth / 2);\n\nconst menu3dIconBot = create({\n    ...MENU3DBOT_BASE_TAGS,\n    menu3dBotType: 'icon',\n    form: 'nothing',\n    pointable: false,\n    scaleX: tags.menu3dBot_iconSize,\n    scaleY: tags.menu3dBot_iconSize,\n    scaleZ: 0.1,\n    [dimension + 'X']: ICON_X,\n    [dimension + 'Z']: tags.menu3dBot_depth,\n    onResyncMenuBot: ListenerString(() => {\n        if (tags.icon !== links.menuBot.tags.formAddress) {\n            tags.icon = links.menuBot.tags.formAddress;\n        }\n    }),\n    onBotChanged: ListenerString(() => {\n        if (that.tags.includes('icon')) {\n            if (tags.icon) {\n                tags.form = 'sprite';\n\n                if (tags.icon.startsWith('https://')) {\n                    tags.formAddress = tags.icon;\n                } else  {\n                    const iconUrl = links.menu3dPortalBot.getMaterialIconURL({ iconName: tags.icon });\n                    tags.formAddress = iconUrl;\n                }\n            } else {\n                tags.form = 'nothing';\n            }\n        }\n    })\n})\n\nmenu3dBots.push(menu3dIconBot);\n\nif (menuBot.tags.form === 'input') {\n    const SUBMIT_X = (tags.menu3dBot_width / 2) - (tags.menu3dBot_iconWidth / 2);\n\n    const menu3dSubmitBot = create({\n        ...MENU3DBOT_BASE_TAGS,\n        menu3dBotType: 'submit',\n        formAddress: thisBot.getMaterialIconURL({ iconName: 'send' }),\n        scaleX: tags.menu3dBot_iconSize,\n        scaleY: tags.menu3dBot_iconSize,\n        scaleZ: 0.1,\n        cursor: 'pointer',\n        [dimension + 'X']: SUBMIT_X,\n        [dimension + 'Z']: tags.menu3dBot_depth,\n        onClick: ListenerString(() => {\n            if (links.menuBot.tags.menuItemText) {\n                whisper(links.menuBot, 'onSubmit', { text: links.menuBot.tags.menuItemText });\n            }\n        }),\n        onResyncMenuBot: ListenerString(() => {\n            // Show/Hide submit button based on if there is text inputted.\n            let form = links.menuBot.tags.menuItemText ? 'sprite' : 'nothing';\n            if (tags.form !== form) {\n                tags.form = form;\n            }\n        }),\n    })\n\n    menu3dBots.push(menu3dSubmitBot);\n}\n\n// Manually Kick off initialization now that everything is ready.\nwhisper(menu3dRootBot, 'initialize', { bots: menu3dBots });\n\nreturn menu3dRootBot;","menu3dBot_width":"8","menu3dBot_height":"1","menu3dBot_depth":"0.3","menu3d_botSpacing":"0.2","onABArtifactReconstitute":"@thisBot.initialize();","initialize":"@if (masks.initialized) {\n    return;\n}\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] invoke`);\n}\n\nmasks.initialized = true;\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] going to refresh menu 3d portal because the menu 3d portal has been initialized.`);\n}\n\nthisBot.refreshPortal();","onEggHatch":"@thisBot.initialize();","abIDOrigin":"arWebSlinger","menu3dParentBot":"ðŸ”—1480a73d-c167-4f02-b524-3f06d1cea346","getMaterialIconURL":"@const { \n    iconName,\n    style = 'filled'          // 'filled', 'outlined', 'round', 'sharp', 'two-tone'\n} = that;\n\nif (iconName === 'cube') {\n    // Hardcoded icon supported by CasualOS.\n    return 'https://cdn.jsdelivr.net/gh/casual-simulation/casualos@latest/src/aux-components/icons/Cube.svg';\n} else if (iconName === 'egg') {\n    // Hardcoded icon supported by CasualOS.\n    return 'https://cdn.jsdelivr.net/gh/casual-simulation/casualos@latest/src/aux-components/icons/Egg.svg';\n} else if (iconName === 'helix') {\n    // Hardcoded icon supported by CasualOS.\n    return 'https://cdn.jsdelivr.net/gh/casual-simulation/casualos@latest/src/aux-components/icons/Helix.svg';\n} else {\n    // Map style names to package directory names\n    const styleMap = {\n        'filled': 'filled',\n        'outlined': 'outlined',\n        'round': 'round',\n        'sharp': 'sharp',\n        'twotone': 'two-tone',\n        'two-tone': 'two-tone'\n    };\n\n    const iconStyle = styleMap[style] ?? 'filled';\n\n    // Using jsDelivr CDN for @material-design-icons/svg (auto-updated, latest icons)\n    // [SLOP] We should not use a google CDN for this but instead our own repository (casual catalog).\n    const url = `https://cdn.jsdelivr.net/npm/@material-design-icons/svg@latest/${iconStyle}/${iconName}.svg`;\n\n    return url;\n}","menu3dBot_iconWidth":"1","menu3dBotProperties":"ðŸ§¬{\n    \"hello\": \"world!\"\n\n}","menu3dBot_iconSize":"0.5","inWristPortal":"@const leftWristPortal = configBot.tags.leftWristPortal;\nconst rightWristPortal = configBot.tags.rightWristPortal;\n\nif (leftWristPortal && tags[leftWristPortal] === true) {\n    return true;\n} else if (rightWristPortal && tags[rightWristPortal]) {\n    return true;\n}\n\nreturn false;","onDestroy":"@destroy(links.menu3dParentBot);"}},"6b57df2b-ce7e-46e3-8ce4-a5a010d63b4d":{"id":"6b57df2b-ce7e-46e3-8ce4-a5a010d63b4d","space":"shared","tags":{"system":"arWebSlinger.keyboard_controller","abArtifactName":"arWebSlinger","show":"@const {\n    dimension = configBot.tags.gridPortal ?? 'home',\n    position = new Vector3(0, 0, 0),\n} = that ?? {};\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] that:`, that);\n}\n\nconst keyboardBot = create({\n    space: 'tempLocal',\n    form: 'keyboard',\n    dimension,\n    [dimension]: true,\n    [dimension + 'X']: position.x,\n    [dimension + 'Y']: position.y,\n    [dimension + 'Z']: position.z,\n    scale: 1,\n    controller: getLink(thisBot),\n    onKeyClick: ListenerString(() => {\n        controller.keyClick(that);\n    })\n})\n\nmasks.keyboardBot = getLink(keyboardBot);","blur":"@if (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] invoke`);\n}\n\nmasks.targetBot = null;\n\nwhisper(links.targetBot, 'onKeyboardBlur');","focus":"@const { targetBot } = that;\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] that:`, that);\n}\n\nassert(targetBot && targetBot.id && targetBot.tags, `[${tags.system}.${tagName}] targetBot is a required Bot parameter.`);\n\nmasks.targetBot = getLink(targetBot);\n\nwhisper(links.targetBot, 'onKeyboardFocus');\n","hide":"@if (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] invoke`);\n}\n\nif (links.keyboardBot) {\n    destroy(links.keyboardBot);\n    thisBot.blur();\n}","keyClick":"@const { key } = that;\n\nif (tags.debug) {\n    console.log(`[${tags.system}.${tagName}] that:`, that);\n}\n\nif (links.targetBot) {\n    whisper(links.targetBot, 'onKeyboardClick', { key });\n}\n\nshout('onAnyKeyboardClick', { key, targetBot: links.targetBot });","debug":"false","onKeyDown":"@if (!links.targetBot) {\n    // Ignore physical keyboard keystrokes if we do not have a target bot.\n    return;\n}\n\nconst { keys } = that;\n\nfor (let key of keys) {\n    if (tags.debug) {\n        console.log(`[${tags.system}.${tagName}] physical keyboard key down:`, key);\n    }\n    \n    thisBot.keyClick({ key });\n}","onKeyRepeat":"@// Just forward the repeat key event to our onKeyDown handler.\nthisBot.onKeyDown(that);","onAnyBotClicked":"@const { bot } = that;\n\nif (links.targetBot) {\n    if (bot !== links.targetBot) {\n        thisBot.blur();\n    }\n}"}},"bfc32898-55c6-40ce-bb68-dba3e7f5d772":{"id":"bfc32898-55c6-40ce-bb68-dba3e7f5d772","space":"shared","tags":{"form":"sphere","formOpacity":"0.5","listening":true,"onClick":"@thisBot.arWebSlingerMenuOpen();","onExitClick":"@if (configBot.tags.arEnabled) {\n    os.disableAR();\n} else if (configBot.tags.vrEnabled) {\n    os.disableVR();\n}","scale":"1.5","system":"arWebSlinger.manager","abVersion":"10.6","abArtifactName":"arWebSlinger","onABArtifactCollectShards":"@const shard: ABArtifactShard = {\n    data: {\n        managerDimension: tags.dimension,\n        managerDimensionX: tags[tags.dimension + 'X'],\n        managerDimensionY: tags[tags.dimension + 'Y'],\n        managerDimensionZ: tags[tags.dimension + 'Z'],\n    },\n    dependencies: [\n        { askID: 'arWebSlinger' }\n    ]\n}\n\nreturn shard;","onABArtifactReconstitute":"@const data = that.data;\n\nif (data.eggParameters) {\n    if (data.eggParameters.gridInformation) {\n        const dimension = data.eggParameters.gridInformation.dimension ?? 'home';\n        const dimensionX = data.eggParameters.gridInformation.position?.x ?? 0;\n        const dimensionY = data.eggParameters.gridInformation.position?.y ?? 0;\n\n        tags.dimension = dimension;\n        tags[dimension] = true;\n        tags[dimension + 'X'] = dimensionX;\n        tags[dimension + 'Y'] = dimensionY;\n    }\n}\n\nif (data.managerDimension) {\n    tags.dimension = data.managerDimension;\n    tags[data.managerDimension] = true;\n    tags[data.managerDimension + 'X'] = data.managerDimensionX;\n    tags[data.managerDimension + 'Y'] = data.managerDimensionY;\n    tags[data.managerDimension + 'Z'] = data.managerDimensionZ;\n}\n\nthisBot.refreshHex();","onABStripArtifactInstanceDataFromBotData":"@console.log(`[${tags.system}.${tagName}]`, JSON.parse(JSON.stringify(that)));\n\nconst { data } = that;\n\nconst dimension = data.tags.dimension;\n\ndelete data.tags.dimension;\ndelete data.tags[dimension];\ndelete data.tags[dimension + 'X'];\ndelete data.tags[dimension + 'Y'];\ndelete data.tags[dimension + 'Z'];","refreshHex":"@if (!links.hex) {\n    const hex = create({\n        space: 'tempLocal',\n        form: 'hex',\n        color: '#00D9CD',\n        manager: getLink(thisBot),\n        scale: 0.5,\n        scaleZ: 0.2,\n        transformer: thisBot.id,\n        pointable: false,\n        onCreate: `@\n            os.addBotListener(links.manager, 'onBotChanged', (listenerThat) => {\n                const changedTags = listenerThat.tags;\n\n                if (changedTags.includes('dimension')) {\n                    links.manager.refreshHex();\n                }\n            })\n        `\n    })\n\n    masks.hex = getLink(hex);\n}\n\nif (links.hex.tags.dimension) {\n    // Remove hex from its previous dimension.\n    const prevDim = links.hex.tags.dimension;\n    \n    console.log(`[${tags.system}.${tagName}] removing from prevDim:`, prevDim);\n\n    links.hex.tags.dimension = null;\n    links.hex.tags[prevDim] = null;\n    links.hex.tags[prevDim + 'X'] = null;\n    links.hex.tags[prevDim + 'Y'] = null;\n    links.hex.tags[prevDim + 'Z'] = null;\n    links.hex.tags[prevDim + 'RotationX'] = null;\n    links.hex.tags[prevDim + 'RotationY'] = null;\n    links.hex.tags[prevDim + 'RotationZ'] = null;\n}\n\nif (tags.dimension) {\n    // Put hex in the current dimension.\n    const curDim = tags.dimension;\n\n    console.log(`[${tags.system}.${tagName}] adding to curDim:`, curDim);\n\n    links.hex.tags.dimension = curDim;\n    links.hex.tags[curDim] = true;\n    links.hex.tags[curDim + 'X'] = 0;\n    links.hex.tags[curDim + 'Y'] = 0;\n    links.hex.tags[curDim + 'Z'] = -0.5;\n    links.hex.tags[curDim + 'RotationX'] = 0.785398;\n    links.hex.tags[curDim + 'RotationY'] = 0;\n    links.hex.tags[curDim + 'RotationZ'] = 0;\n}","debug":"false","onEnterAR":"@configBot.tags.arEnabled = true;\nthisBot.xrSetup();","onExitAR":"@configBot.tags.arEnabled = false;\nthisBot.xrTeardown();","onGridClick":"@thisBot.arWebSlingerMenuReset();","arWebSlingerX":"-3","arWebSlingerY":"3","arWebSlingerMenuOpen":"@shout('arWebSlingerMenuReset');\n\nconfigBot.masks.menuPortal = 'arWebSlingerMenu';\n\nconst device = os.device();\n\nif (device.supportsAR || device.supportsVR) {\n    if (device.supportsAR) {\n        const arButton = ab.links.menu.abCreateMenuButton({\n            arWebSlingerMenu: true,\n            label: 'enter ar',\n            arWebSlingerMenuReset: `@destroy(thisBot)`,\n            onClick: `@\n                os.enableAR();\n            `\n        })\n    }\n\n    if (device.supportsVR) {\n        const vrButton = ab.links.menu.abCreateMenuButton({\n            arWebSlingerMenu: true,\n            label: 'enter vr',\n            arWebSlingerMenuReset: `@destroy(thisBot)`,\n            onClick: `@\n                os.enableVR();\n            `\n        })\n    }\n} else {\n    // Device does not support WebXR.\n    ab.links.utils.abLogAndToast({ message: 'WebXR is not available on this device.'});\n    masks.color = 'red';\n}\n","arWebSlingerMenuReset":"@configBot.masks.menuPortal = null;","cursor":"pointer","onEnterVR":"@configBot.tags.vrEnabled = true;\nthisBot.xrSetup();","onExitVR":"@configBot.tags.vrEnabled = false;\nthisBot.xrTeardown();","xrSetup":"@configBot.masks.leftWristPortal = \"arWebSlinger_leftWrist\";\n\n// Put the menu3d portal bot in the left wrist portal.\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal] = true;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'X'] = 0;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'Y'] = 0;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'Z'] = 0;\n\n// Need to move out of the mapPortal if we are in it.\nmasks.mapPortalBeforeAR = configBot.tags.mapPortal;\n\nif (configBot.tags.mapPortal) {\n    configBot.tags.mapPortal = null;\n\n    if (!configBot.tags.gridPortal) {\n        configBot.tags.gridPortal = masks.mapPortalBeforeAR;\n    }\n}\n\nmasks.arWebSlinger = true;\nmasks.onClick = `@ thisBot.onExitClick();`;\nmasks.label = \"X\";\nmasks.form = null;\nmasks.formOpacity = 1;\nmasks.draggable = false;\nmasks.color = \"clear\";\nmasks.scaleZ = 0.1;\nmasks.labelColor = \"#FFFFFF\";\nmasks.onPointerEnter = \"@ masks.scale = 1.1;\";\nmasks.onPointerExit = \"@ masks.scale = null;\";\n\nconst hexBot = getBot(\"transformer\", thisBot.id);\nhexBot.masks.color = \"clear\";","xrTeardown":"@// Remove the menu3d portal bot from the left wrist portal.\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal] = null;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'X'] = null;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'Y'] = null;\nlinks.menu3dPortalBot.masks[configBot.masks.leftWristPortal + 'Z'] = null;\n\nif (masks.mapPortalBeforeAR) {\n    configBot.tags.mapPortal = masks.mapPortalBeforeAR;\n}\n\nclearTagMasks(thisBot);\n\nconfigBot.masks.leftWristPortal = null;\n\nconst hexBot = getBot(\"transformer\", thisBot.id);\nclearTagMasks(hexBot);","onBotAdded":"@thisBot.refreshHex();","abIDOrigin":"arWebSlinger","onDestroy":"@thisBot.arWebSlingerMenuReset();\ndestroy([links.hex, links.keyboard_controller, links.menu3dPortalBot]);","menu3dPortalBot":"ðŸ”—42972966-b631-4f76-b3cc-af3a86b8e14a","keyboard_controller":"ðŸ”—6b57df2b-ce7e-46e3-8ce4-a5a010d63b4d"}}}}