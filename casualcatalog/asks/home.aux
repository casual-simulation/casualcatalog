{"version":1,"state":{"0ca72ff3-385c-474e-b4c8-619acbe98c3a":{"id":"0ca72ff3-385c-474e-b4c8-619acbe98c3a","space":"shared","tags":{"creator":"34c3c210-5bf1-49cf-b151-ee2d07f0e673","system":"ab.home.egg","homeEgg":"true","abVersion":"10.6","abIDOrigin":"home","onEggHatch":"@const currentDim = ab.links.remember.tags.abActiveDimension;\r\nconst currentPortal = configBot.tags.mapPortal ? \"map\" : configBot.tags.gridPortal == \"blueprint\" ? \"blueprint\" :\"grid\";\r\n\r\nif (currentPortal != 'map') {\r\n    configBot.tags.mapPortal = currentDim;\r\n}\r\n\r\nab.links.input.onChat({ message: \"..\" });\r\n\r\nif (!authBot) {\r\n    console.log(\"[ab.home.egg]: onEggHatch authBot not found\");\r\n    await os.requestAuthBotInBackground();\r\n}\r\n\r\nif (!authBot) {\r\n    console.log(\"[ab.home.egg]: User not logged in.\");\r\n    return;\r\n}\r\n\r\nconst homeEggData = await os.getData(authBot.id, 'home');\r\nconsole.log(\"[ab.home.egg]: onEggHatch homeEggData\", homeEggData, authBot);\r\n\r\nif (!homeEggData.success) {\r\n    if(homeEggData.errorCode && homeEggData.errorCode == 'not_authorized') {\r\n        const permissions = await os.grantInstAdminPermission(authBot.id);\r\n        const homeEggData2 = await os.getData(authBot.id, 'home');\r\n\r\n        console.log(\"[ab.home.egg]: onEggHatch homeEggData2\", homeEggData2, permissions);\r\n        if (!homeEggData2.success) {\r\n            thisBot.saveData();\r\n        }\r\n    }\r\n}","saveData":"@if (!authBot) {\r\n    console.log(\"[ab.home.egg]: saveData no authbot\");\r\n    await os.requestAuthBotInBackground();\r\n}\r\n\r\nif (!authBot) {\r\n    console.log(\"[ab.home.egg]: User not logged in.\");\r\n    return;\r\n}\r\n\r\nconst publishAttempt = await ab.links.store.abPublishAB({ab: 'home', sourceEvent: 'home_egg_publish'});\r\nconsole.log(\"[ab.home.egg]: saveData publishAttempt 1\", publishAttempt);\r\n\r\nif (!publishAttempt.success) {\r\n    const permissions = await os.grantInstAdminPermission(authBot.id);\r\n\r\n    console.log(\"[ab.home.egg]: saveData permissions\", permissions);\r\n\r\n    const secondPublishAttempt = await ab.links.store.abPublishAB({ab: 'home', sourceEvent: 'home_egg_publish'});\r\n    console.log(\"[ab.home.egg]: saveData publishAttempt 2\", secondPublishAttempt);\r\n\r\n    if (!secondPublishAttempt.success){\r\n        console.log(\"[ab.home.egg]: Could not publish\", secondPublishAttempt);\r\n    }\r\n}","processInstChange":"@if (thisBot.vars.saveTimout) {\r\n    clearTimeout(thisBot.vars.saveTimout);\r\n    thisBot.vars.saveTimout = null;\r\n}\r\n\r\nthisBot.vars.saveTimout = await setTimeout(() => {\r\n    thisBot.saveData();\r\n}, 5000);","onAnyBotsChanged":"@let validChange = false;\r\n\r\nfor (const addedBot of that) {\r\n    if (addedBot.bot.tags.space == 'tempLocal' || addedBot.bot.tags.space == 'local') {\r\n        continue;\r\n    }\r\n\r\n    if (addedBot.bot.tags.abIgnore) {\r\n        continue;\r\n    }\r\n\r\n    if (addedBot.bot.tags.system && addedBot.bot?.tags?.system?.substring(0, 3) == 'ab.') {\r\n        continue;\r\n    }\r\n    \r\n    validChange = true;\r\n    break;\r\n}\r\n\r\nif (validChange) {\r\n    thisBot.processInstChange();\r\n}","onAnyBotsAdded":"@let validChange = false;\r\nfor (const addedBot of that.bots) {\r\n    if (addedBot.tags.space == 'tempLocal' || addedBot.tags.space == 'local') {\r\n        continue;\r\n    }\r\n\r\n    if (addedBot.tags.abIgnore) {\r\n        continue;\r\n    }\r\n\r\n    if (addedBot.tags.system && addedBot.tags.system.substring(0, 3) == 'ab.') {\r\n        continue;\r\n    }\r\n\r\n    validChange = true;\r\n    break;\r\n}\r\n\r\nif (validChange) {\r\n    thisBot.processInstChange();\r\n}"}}}}