{"version":1,"state":{"884d27cb-4f2d-4af9-ba59-6efa7d3e914b":{"id":"884d27cb-4f2d-4af9-ba59-6efa7d3e914b","space":"shared","tags":{"abIDOrigin":"instBot","abVersion":"10.9","cursor":"pointer","expireInstBot":"@if (tags.expiredInstBot) {\r\n    return;\r\n}\r\n\r\nsetTagMask(thisBot, 'expiredInstBot', true, \"shared\");\r\nsetTagMask(thisBot, 'color', 'gray', \"shared\");\r\nsetTagMask(thisBot, 'strokeColor', 'white', \"shared\");\r\nsetTagMask(thisBot, 'label', 'expired', \"shared\");\r\nsetTagMask(thisBot, 'labelColor', 'white', \"shared\");\r\nsetTagMask(thisBot, 'labelFloatingBackgroundColor', 'gray', \"shared\");\r\nsetTagMask(thisBot, 'onClick', `@`, \"shared\");\r\nsetTagMask(thisBot, 'cursor', null, \"shared\");\r\nsetTagMask(thisBot, 'onPointerEnter', `@`, \"shared\");","homeWorldBot":"true","instBot":"true","onBotAdded":"@let waitTime = 0;\r\n\r\nwhile(!globalThis.ab?.links.bot_factory) {\r\n    if (waitTime >= 5000) {\r\n        return;\r\n    }\r\n    \r\n    await os.sleep(250);\r\n    waitTime += 250;\r\n}\r\n\r\nmasks.ready = true;","onClick":"@if (that) {\r\n    if (that.modality == 'mouse' && that.buttonId == 'right') {\r\n        return;\r\n    }\r\n}\r\n    \r\nos.openURL(tags.instURL);","onPointerEnter":"@if (tags.biosSetting == 'free') {\r\n    const now = DateTime.now().toMillis();\r\n    const expiration = (tags.expirationTime - now) / (1000 * 60 * 60);\r\n    const expHr = Math.trunc(expiration);\r\n    const expMin = String(Math.trunc((expiration % 1) * 60)).padStart(2, '0');\r\n\r\n    if (expiration > 0) {\r\n        os.tip(`temporary (expires in ${expHr}:${expMin})`);\r\n    }\r\n    \r\n    if (expiration <= 0 && tags.label != \"expired\") {\r\n        thisBot.expireInstBot();\r\n    }\r\n}\r\n","system":"server_toolbox.tools.instBot","onABArtifactCollectShards":"@const shard: ABArtifactShard = {\r\n    data: {\r\n        label: tags.label,\r\n        biosSetting: tags.biosSetting,\r\n        creationTime: tags.creationTime,\r\n        expirationTime: tags.expirationTime,\r\n        instSetting: tags.instSetting,\r\n        instURL: tags.instURL,\r\n        patternSetting: tags.patternSetting,\r\n        studioSetting: tags.studioSetting,\r\n        lineTo: tags.lineTo,\r\n        versionSetting: tags.versionSetting,\r\n        color: tags.color,\r\n        channelSetting: tags.channelSetting,\r\n        scale: tags.scale,\r\n        expiredInstBot: tags.expiredInstBot,\r\n\r\n        dimensionData: {\r\n            dimension: ab.links.remember.tags.abActiveDimension,\r\n            [ab.links.remember.tags.abActiveDimension]: tags[ab.links.remember.tags.abActiveDimension],\r\n            [ab.links.remember.tags.abActiveDimension + 'X']: tags[ab.links.remember.tags.abActiveDimension + 'X'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Y']: tags[ab.links.remember.tags.abActiveDimension + 'Y'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Z']: tags[ab.links.remember.tags.abActiveDimension + 'Z'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationX']: tags[ab.links.remember.tags.abActiveDimension + 'RotationX'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationY']: tags[ab.links.remember.tags.abActiveDimension + 'RotationY'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationZ']: tags[ab.links.remember.tags.abActiveDimension + 'RotationZ'],\r\n        }\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'instBot'\r\n        }\r\n    ]\r\n}\r\n\r\nreturn shard;","onABArtifactReconstitute":"@const data = that.data;\r\n\r\ntags.label = data.label ?? null;\r\ntags.biosSetting = data.biosSetting ?? null;\r\ntags.creationTime = data.creationTime ?? null;\r\ntags.expirationTime = data.expirationTime ?? null;\r\ntags.instSetting = data.instSetting ?? null;\r\ntags.instURL = data.instURL ?? null;\r\ntags.patternSetting = data.patternSetting ?? null;\r\ntags.studioSetting = data.studioSetting ?? null;\r\ntags.versionSetting = data.versionSetting ?? null;\r\ntags.channelSetting = data.channelSetting ?? null;\r\ntags.scale = data.scale ?? null;\r\ntags.color = data.color ?? abPersonality?.tags?.abBaseColor ?? '#0000FF';\r\ntags.labelFloatingBackgroundColor = data.labelFloatingBackgroundColor ?? abPersonality?.tags?.abBaseColor ?? '#0000FF'; \r\ntags.labelColor = data.labelColor ?? abPersonality?.tags?.abBaseLabelColor ?? 'black'\r\n\r\ntags.studioStationID = data.studioStationID;\r\n\r\nif (data.lineTo) {\r\n    const newLineBot = getBot(\"prevBotID\", data.lineTo);\r\n    if (newLineBot) {\r\n        tags.lineTo = newLineBot.id;\r\n    } else {\r\n        tags.lineTo = data.lineTo;\r\n    }\r\n}\r\n\r\nif (tags.studioStationID) {\r\n    const studioBot = getBot(\"studioId\", tags.studioStatioID);\r\n    if (studioBot) {\r\n        tags.lineTo = [studioBot.id]\r\n    }\r\n}\r\n\r\nif (!tags.label) {\r\n    let instShortening;\r\n    if(data.instSetting) {\r\n        instShortening = data?.instSetting?.slice(-4);\r\n    }\r\n    let label = (instShortening ?? 'inst ') + (tags.biosSetting ? (\" (\" + tags.biosSetting + \")\") : \"\");\r\n    tags.label = label;\r\n}\r\n\r\nif (data.dimensionData) {\r\n    for (const tagName in data.dimensionData) {\r\n        tags[tagName] = data.dimensionData[tagName];\r\n    }\r\n}\r\n\r\nif (data.eggParameters) {\r\n    const dimension = data.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = data.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = data.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags.dimension = dimension;\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n}\r\n\r\n//set creation time if none provided\r\nif (!tags.creationTime) {\r\n    tags.creationTime = DateTime?.now()?.toMillis();\r\n\r\n    if (tags.biosSetting == 'free') {\r\n        tags.expirationTime = DateTime?.fromMillis(tags.creationTime + (24 * 1000 * 60 * 60))?.toMillis();\r\n    }\r\n}\r\n\r\n//Check if expired\r\nif (tags.biosSetting && tags.biosSetting == 'free') {\r\n    const currTime = DateTime?.now()?.toMillis();\r\n\r\n    //TODO: ab1 has different expire times than auxplayer and brandplayer\r\n    //Treating as all expire in 24hr for now\r\n\r\n    const elapsedMS = currTime - tags.creationTime;\r\n    const hoursPassed = elapsedMS / (1000 * 60 * 60);\r\n\r\n    if (hoursPassed >= 24) {\r\n        thisBot.expireInstBot();\r\n    }\r\n}\r\n\r\nif (data.expiredInstBot) {\r\n    thisBot.expireInstBot();\r\n}\r\n\r\nshout('clearInstCreatorMenu');","onABStripArtifactInstanceDataFromBotData":"@const { data } = that;\r\n\r\ndelete data.tags.label;\r\ndelete data.tags.biosSetting;\r\ndelete data.tags.creationTime;\r\ndelete data.tags.expirationTime;\r\ndelete data.tags.instSetting;\r\ndelete data.tags.instURL;\r\ndelete data.tags.patternSetting;\r\ndelete data.tags.studioSetting;\r\ndelete data.tags.lineTo;\r\ndelete data.tags.versionSetting;\r\ndelete data.tags[data.tags.dimension];\r\ndelete data.tags[data.tags.dimension + 'X'];\r\ndelete data.tags[data.tags.dimension + 'Y'];\r\ndelete data.tags[data.tags.dimension + 'Z'];\r\ndelete data.tags[data.tags.dimension + 'RotationX'];\r\ndelete data.tags[data.tags.dimension + 'RotationY'];\r\ndelete data.tags[data.tags.dimension + 'RotationZ'];\r\ndelete data.tags.dimension;\r\ndelete data.tags.channelSetting;\r\ndelete data.tags.color;\r\ndelete data.tags.scale;\r\ndelete data.tags.expiredInstBot;","abArtifactName":"instBot","strokeColor":"#00008c","showRightClickMenu":"@const menuOptions = {\r\n    abMenuRefresh: `@destroy(thisBot);`,\r\n    abMenu: true,\r\n    instBot: getLink(thisBot)\r\n}\r\n\r\nconst renameButton = {\r\n    ...menuOptions,\r\n    formAddress: 'edit',\r\n    label: 'rename server bot',\r\n    onClick: `@const newName = await os.showInput(links.instBot.tags.label, {\r\n        autoSelect: true,\r\n        title: 'rename this bot'\r\n    });\r\n    if (newName) {\r\n        links.instBot.tags.label = newName;\r\n    }\r\n    shout('abMenuRefresh');\r\n    `\r\n}\r\n\r\nab.links.menu.abCreateMenuButton(renameButton);","onABOpenMenu":"@if (that.menuType != 'abBotMenu' || ab.links.remember.links.abBotFocus != thisBot) {\r\n    return;\r\n}\r\n\r\nthisBot.showRightClickMenu();","studioStationID":"33a13525-b6c0-4c59-b9cd-5f4cdb9d3d39","form":"mesh","formSubtype":"gltf","formAddress":"https://auth-aux-prod-filesbucket-682397690660.s3.amazonaws.com/64beb439-12b9-4155-b388-db03b7ec1c9c/5f70915108593e9ec8463c253a11c4809279c903fb1b5c93beb4ef3948871b70.xml","labelPosition":"floatingBillboard","labelWordWrapMode":"breakWords","labelFloatingBackgroundColor":"#FCC400","labelColor":"#000000","labelSize":"1.5"}}}}