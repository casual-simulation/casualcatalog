{"version":1,"state":{"6b409c8e-744d-42fc-9d2e-d2041e43efde":{"id":"6b409c8e-744d-42fc-9d2e-d2041e43efde","space":"shared","tags":{"creator":"34c3c210-5bf1-49cf-b151-ee2d07f0e673","abIDOrigin":"home","abIDStudio":"33a13525-b6c0-4c59-b9cd-5f4cdb9d3d39","abVersion":"10.9","biosSetting":"public","color":"#0000FF","creationTime":1757437441205,"cursor":"pointer","expirationTime":1757523841205,"expireInstBot":"@if (tags.abIDOrigin == \"instBot\") {\r\n    return;\r\n}\r\n\r\nsetTagMask(thisBot, 'color', 'gray', \"shared\");\r\nsetTagMask(thisBot, 'instBotLabel', 'expired', \"shared\");\r\nsetTagMask(thisBot, 'instBotLabelColor', 'white', \"shared\");\r\nsetTagMask(thisBot, 'instBotLabelFloatingBackgroundColor', 'gray', \"shared\");\r\nsetTagMask(thisBot, 'onClick', null, \"shared\");\r\nsetTagMask(thisBot, 'cursor', null, \"shared\");\r\nsetTagMask(thisBot, 'onPointerEnter', null, \"shared\");","home":true,"homeWorldBot":"true","homeX":-73.7653162092338,"homeY":41.02,"homeZ":0,"instBot":"true","instBotLabel":"b5996d72-d5b2-459e-9f6b-4f5431b1fab6","instBotLabelColor":"#00001c","instBotLabelFloatingBackgroundColor":"#0000FF","instSetting":"b5996d72-d5b2-459e-9f6b-4f5431b1fab6","instURL":"https://dev.auxplayer.com/?owner=public&inst=b5996d72-d5b2-459e-9f6b-4f5431b1fab6&gridPortal=home","onBotAdded":"@let waitTime = 0;\r\n\r\nwhile(!globalThis.ab?.links.bot_factory) {\r\n    if (waitTime >= 5000) {\r\n        return;\r\n    }\r\n    \r\n    await os.sleep(250);\r\n    waitTime += 250;\r\n}\r\n\r\nmasks.ready = true;\r\n\r\nthisBot.updateBillboardLabel();","onClick":"@os.openURL(tags.instURL);","onEggHatch":"@if (tags.abIDOrigin == \"instBot\") {\r\n    tags.instBotLabel = \"instBot\";\r\n    tags.biosSetting = null;\r\n    tags.instSetting = null;\r\n    tags.instURL = null;\r\n    tags.creationTime = null;\r\n    tags.expirationTime = null;\r\n}\r\n\r\nif (that.eggParameters) {\r\n    const dimension = that.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = that.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = that.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n\r\n    if (that.eggParameters.serverParameters) {\r\n        tags.instBotLabel = that.eggParameters.serverParameters.label ?? that.eggParameters.serverParameters.inst;\r\n\r\n        tags.studioSetting = that.eggParameters.serverParameters.studio;\r\n        tags.biosSetting = that.eggParameters.serverParameters.bios;\r\n        tags.instSetting = that.eggParameters.serverParameters.inst;\r\n        // tags.patternSetting = that.eggParameters.serverParameters.pattern;\r\n        tags.instURL = that.eggParameters.serverParameters.url;\r\n\r\n        if (!tags.creationTime) {\r\n            tags.creationTime = DateTime?.now()?.toMillis();\r\n\r\n            if (that.eggParameters.serverParameters.bios == 'public') {\r\n                tags.expirationTime = DateTime?.fromMillis(tags.creationTime + (24 * 1000 * 60 * 60))?.toMillis();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nif (tags.biosSetting && tags.biosSetting == 'public') {\r\n    const currTime = DateTime?.now()?.toMillis();\r\n\r\n    //TODO: ab1 has different expire times than auxplayer and brandplayer\r\n    //Treating as all expire in 24hr for now\r\n\r\n    const elapsedMS = currTime - tags.creationTime;\r\n    const hoursPassed = elapsedMS / (1000 * 60 * 60);\r\n\r\n    if (hoursPassed >= 24) {\r\n        thisBot.expireInstBot();\r\n    }\r\n}","onPointerEnter":"@if (tags.biosSetting == 'public') {\r\n    const now = DateTime.now().toMillis();\r\n    const expiration = (tags.expirationTime - now) / (1000 * 60 * 60);\r\n    const expHr = Math.trunc(expiration);\r\n    const expMin = String(Math.trunc((expiration % 1) * 60)).padStart(2, '0');\r\n\r\n    if (expiration > 0) {\r\n        os.tip(`temporary (expires in ${expHr}:${expMin})`);\r\n    }\r\n    \r\n    if (expiration <= 0 && tags.instBotLabel != \"expired\") {\r\n        thisBot.expireInstBot();\r\n    }\r\n}","system":"server_toolbox.tools.instBot","updateBillboardLabel":"@if (thisBot.vars.billboardLabelBot) {\r\n    destroy(thisBot.vars.billboardLabelBot);\r\n    thisBot.vars.billboardLabelBot = null;\r\n}\r\n\r\nthisBot.vars.billboardLabelBot = ab.links.bot_factory.abCreateBillboardLabel({ \r\n    bot: thisBot, \r\n    label: tags.instBotLabel,\r\n    color: tags.instBotLabelFloatingBackgroundColor,\r\n    dimension: configBot.tags.mapPortal ?? configBot.tags.gridPortal ?? 'home',\r\n    // botLabelMargin: 0,\r\n    labelColor: tags.instBotLabelColor,\r\n    space: 'tempLocal',\r\n})"}}}}