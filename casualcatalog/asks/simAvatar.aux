{"version":1,"state":{"a24c981d-c45c-4d68-b234-eb7aa909d7ee":{"id":"a24c981d-c45c-4d68-b234-eb7aa909d7ee","space":"shared","tags":{"system":"sim_toolbox.tools.simAvatar","onABArtifactCollectShards":"@const shard: ABArtifactShard = {\r\n    data: {\r\n        label: tags.label,\r\n        dimensionData: {\r\n            dimension: ab.links.remember.tags.abActiveDimension,\r\n            [ab.links.remember.tags.abActiveDimension]: tags[ab.links.remember.tags.abActiveDimension],\r\n            [ab.links.remember.tags.abActiveDimension + 'X']: tags[ab.links.remember.tags.abActiveDimension + 'X'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Y']: tags[ab.links.remember.tags.abActiveDimension + 'Y'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Z']: tags[ab.links.remember.tags.abActiveDimension + 'Z'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationX']: tags[ab.links.remember.tags.abActiveDimension + 'RotationX'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationY']: tags[ab.links.remember.tags.abActiveDimension + 'RotationY'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationZ']: tags[ab.links.remember.tags.abActiveDimension + 'RotationZ'],\r\n        },\r\n        labelFloatingBackgroundColor: tags.labelFloatingBackgroundColor,\r\n        labelColor: tags.labelColor,\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'simAvatar'\r\n        }\r\n    ]\r\n}\r\n\r\nreturn shard;","onABArtifactReconstitute":"@let data = that.data;\r\nif (data.config) {\r\n    data = data.config;\r\n}\r\n\r\ntags.remoteID = configBot.tags.id;\r\n\r\nlet label = data.label ?? 'player';\r\nif (!data.label && authBot && authBot.tags.name) {\r\n    label = authBot.tags.name;\r\n}\r\n\r\ntags.label = label;\r\ntags.color = data.color ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD';\r\ntags.labelFloatingBackgroundColor = data.labelFloatingBackgroundColor ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD'; \r\ntags.labelColor = data.labelColor ?? 'white';\r\ntags.strokeColor = data.strokeColor ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD';\r\n\r\nthisBot.setIcon(data.formAddress);\r\n\r\nsetTagMask(thisBot, \"abIgnore\", true, \"shared\");\r\n\r\n//Place bot correctly\r\nif (data.dimensionData) {\r\n    for (const tagName in data.dimensionData) {\r\n        tags[tagName] = data.dimensionData[tagName];\r\n    }\r\n}\r\n\r\n//If new action\r\nif (data.eggParameters) {\r\n    const dimension = data.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = data.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = data.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags.dimension = dimension;\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n}\r\n","onABStripArtifactInstanceDataFromBotData":"@const { data } = that;\r\n\r\ndelete data.tags.label;\r\ndelete data.tags.labelColor;\r\ndelete data.tags.labelFloatingBackgroundColor;\r\ndelete data.tags.color;\r\ndelete data.tags[data.tags.dimension + \"X\"];\r\ndelete data.tags[data.tags.dimension + \"Y\"];\r\ndelete data.tags[data.tags.dimension + \"Z\"];\r\ndelete data.tags[data.tags.dimension + \"RotationX\"];\r\ndelete data.tags[data.tags.dimension + \"RotationY\"];\r\ndelete data.tags[data.tags.dimension + \"RotationZ\"];\r\ndelete data.tags[data.tags.dimension];\r\ndelete data.tags.dimension;\r\ndelete data.tags.form;\r\ndelete data.tags.formSubtype;\r\ndelete data.tags.formAddress;\r\ndelete data.tags.formAddressAspectRatio;\r\ndelete data.tags.currentRole;\r\ndelete data.tags.strokeColor;","onClick":"@if (tags.remoteID != getID(configBot)) {\r\n    return;\r\n}\r\n\r\nshout('abMenuRefresh');\r\nshout(\"clearSimPlayerMenu\");\r\n\r\nif (that) {\r\n    if (that.modality == 'mouse' && that.buttonId == 'right') { \r\n        return;\r\n    }\r\n}\r\n\r\n// configBot.tags.menuPortal = 'simPlayer_menu';\r\n\r\n// const menuOptions = {\r\n//     simPlayer_menu: true,\r\n//     clearSimPlayerMenu: `@destroy(thisBot);`,\r\n//     abMenuRefresh: \"@ destroy(thisBot);\",\r\n//     simPlayer: getLink(thisBot)\r\n// }\r\n\r\n//pull up player menu\r\nconst playerBot = await getBot(byTag(\"simPlayer\", true), byTag(\"remoteID\", getID(configBot)));\r\nif (playerBot) {\r\n    playerBot.showActionMenu();\r\n}\r\n","abArtifactName":"simAvatar","abIDOrigin":"simAvatar","onBotAdded":"@let waitTime = 0;\r\n\r\nwhile(!globalThis.ab?.links.bot_factory) {\r\n    if (waitTime >= 5000) {\r\n        return;\r\n    }\r\n    \r\n    await os.sleep(250);\r\n    waitTime += 250;\r\n}\r\n\r\nmasks.ready = true;","onGridClick":"@if (tags.remoteID != getID(configBot)) {\r\n    return;\r\n}\r\n\r\nshout(\"clearSimPlayerMenu\");\r\n\r\nif (that) {\r\n    if (that.modality == 'mouse' && that.buttonId == 'right') { \r\n        return;\r\n    }\r\n}\r\n\r\nif (that.dimension != tags.dimension) {\r\n    tags[tags.dimension] = null;\r\n    links.spriteBot.tags[tags.dimension] = null;\r\n\r\n    tags.dimension = that.dimension;\r\n    links.spriteBot.tags.dimension = that.dimension;\r\n}\r\n\r\ntags[that.dimension] = true;\r\nlinks.spriteBot.tags[that.dimension] = true;\r\nlinks.spriteBot.tags[that.dimension + 'Z'] = -0.5;\r\n\r\nconst prevX = tags[that.dimension + 'X'] ?? 0;\r\nconst prevY = tags[that.dimension + 'Y'] ?? 0;\r\n\r\nconst distance = Math.sqrt(Math.pow((that.position.x - prevX), 2) + Math.pow((that.position.y - prevY), 2));\r\nlet speed = 0.05;\r\n\r\nif (configBot.tags.mapPortal) {\r\n    speed = 500;\r\n}\r\n\r\nlet dur = distance * speed;\r\n\r\nif (distance > 30) {\r\n    dur = 2;\r\n}\r\n\r\nif (configBot.tags.mapPortal) {\r\n    if (distance > .1) {\r\n        dur = 2;\r\n    }\r\n}\r\n\r\nclearAnimations(thisBot);\r\nawait animateTag(bot, {\r\n    fromValue: {\r\n        [that.dimension + 'X']: tags[that.dimension + 'X'] ?? 0,\r\n        [that.dimension + 'Y']: tags[that.dimension + 'Y'] ?? 0,\r\n    },\r\n    toValue: {\r\n        [that.dimension + 'X']: that.position.x,\r\n        [that.dimension + 'Y']: that.position.y,\r\n    },\r\n    duration: dur,\r\n    tagMaskSpace: 'shared'\r\n});","cursor":"pointer","onInstStreaming":"@if (tags.remoteID) {\r\n    if (configBot.tags.staticInst) {\r\n        destroy(thisBot);\r\n    } else {\r\n        const remotes = await os.remotes();\r\n        if (!remotes || !remotes.includes(tags.remoteID)) {\r\n            destroy(thisBot);\r\n        }\r\n    }\r\n}","onABOpenMenu":"@if (tags.remoteID != getID(configBot)) {\r\n    return;\r\n}\r\n\r\nif (that.menuType != 'abBotMenu' || ab.links.remember.links.abBotFocus != thisBot) {\r\n    return;\r\n}\r\n\r\nconst menuOptions = {\r\n    abMenuRefresh: `@destroy(thisBot);`,\r\n    abMenu: true,\r\n    simPlayer: getLink(thisBot)\r\n}\r\n\r\nconst leaveButton = {\r\n    ...menuOptions,\r\n    label: 'leave simulation',\r\n    formAddress: 'exit_to_app',\r\n    onClick: `@\r\n        configBot.tags.gridPortal = 'home';\r\n        const playerBot = getBot(byTag(\"simPlayer\", true), byTag(\"remoteID\", getID(configBot)));\r\n        if (playerBot) {\r\n            playerBot.resetPlayer();\r\n            const roleBot = getBot(\"simID\", playerBot.tags.chosenRole);\r\n\r\n            if (roleBot) {\r\n                roleBot.removeRoleOwner();\r\n            }\r\n        }\r\n        \r\n        destroy(links.simPlayer);\r\n\r\n        shout(\"clearActionMenu\");\r\n        shout(\"abMenuRefresh\");\r\n    `,\r\n    abMenuSortOrder: -1\r\n}\r\n\r\nconst restartButton = {\r\n    ...menuOptions,\r\n    label: 'restart simulation',\r\n    formAddress: 'replay',\r\n    onClick: `@\r\n        if (configBot.tags.staticInst) {\r\n            shout(\"onRemoteData\", {\r\n                name: \"onStartMenu\",\r\n                that: null,\r\n                remoteId: getID(configBot)\r\n            });\r\n        } else {\r\n            const remotes = await os.remotes();\r\n            await sendRemoteData(remotes, \"onStartMenu\"); \r\n        }\r\n        shout(\"abMenuRefresh\");\r\n    `,\r\n    abMenuSortOrder: -2\r\n}\r\n\r\nab.links.menu.abCreateMenuButton(restartButton);\r\nab.links.menu.abCreateMenuButton(leaveButton);","formOpacity":".3","scale":"2","labelPosition":"floatingBillboard","labelWordWrapMode":"breakWords","labelSize":"2","labelFontSize":"1","remoteID":"ef273c07-77c3-4f3c-ad7c-b428a4f90ef2","simAvatar":"true","setIcon":"@let iconURL = that;\r\nif (!that) {\r\n    const link = '/ab/userIcons/';\r\n    const icons = [\"avatar_antelope_128.png\", \"avatar_bot_128.png\", \"avatar_bunny_128.png\", \"avatar_cat_128.png\", \"avatar_clownfish_128.png\", \"avatar_duck_128.png\", \"avatar_flamingo_128.png\", \"avatar_frog_128.png\", \"avatar_horse_128.png\", \"avatar_lion_128.png\", \"avatar_otter_128.png\", \"avatar_ox_128.png\", \"avatar_penguin_128.png\", \"avatar_polarbear_128.png\"]\r\n\r\n    const iconIndex = Math.floor(Math.random() * (icons.length));\r\n    iconURL = await ab.abBuildCasualCatalogURL(link + icons[iconIndex]);\r\n}\r\n\r\nif (ab.links.personality.userIcon) {\r\n    iconURL = ab.links.personality.userIcon;\r\n}\r\n\r\ntags.color = 'clear';\r\ntags.strokeColor = null;\r\n\r\nif (links.spriteBot) {\r\n    destroy(links.spriteBot);\r\n}\r\n\r\nconst spriteBot = await create({\r\n    form: 'sprite',\r\n    formAddress: iconURL,\r\n    orientationMode: 'billboard',\r\n    pointable: false,\r\n    transformer: getID(thisBot),\r\n    [tags.dimension]: true,\r\n    anchorPoint: 'center',\r\n    [tags.dimension + 'Z']: -.5\r\n})\r\n\r\nlinks.spriteBot = getLink(spriteBot);","spriteBot":"ðŸ”—fd405dc4-1285-434e-9bb7-7c42827b816e","gardenX":0,"gardenY":0}}}}