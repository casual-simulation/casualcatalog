{"version":1,"state":{"678df187-c9f4-4ed4-9411-12a9f6f13d2d":{"id":"678df187-c9f4-4ed4-9411-12a9f6f13d2d","space":"shared","tags":{"system":"sim_toolbox.tools.simDoor","onABArtifactCollectShards":"@const shard: ABArtifactShard = {\r\n    data: {\r\n        label: tags.label,\r\n        dimensionData: {\r\n            dimension: ab.links.remember.tags.abActiveDimension,\r\n            [ab.links.remember.tags.abActiveDimension]: tags[ab.links.remember.tags.abActiveDimension],\r\n            [ab.links.remember.tags.abActiveDimension + 'X']: tags[ab.links.remember.tags.abActiveDimension + 'X'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Y']: tags[ab.links.remember.tags.abActiveDimension + 'Y'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Z']: tags[ab.links.remember.tags.abActiveDimension + 'Z'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationX']: tags[ab.links.remember.tags.abActiveDimension + 'RotationX'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationY']: tags[ab.links.remember.tags.abActiveDimension + 'RotationY'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationZ']: tags[ab.links.remember.tags.abActiveDimension + 'RotationZ'],\r\n        },\r\n        color: tags.color,\r\n        labelFloatingBackgroundColor: tags.labelFloatingBackgroundColor,\r\n        labelColor: tags.labelColor,\r\n        destination: tags.destination,\r\n        formAddress: tags.formAddress,\r\n        form: tags.form,\r\n        scaleX: tags.scaleX,\r\n        scaleY: tags.scaleY,\r\n        scaleZ: tags.scaleZ,\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'simDoor'\r\n        }\r\n    ]\r\n}\r\n\r\nreturn shard;","onABArtifactReconstitute":"@let data = that.data;\r\nif (data.config) {\r\n    data = data.config;\r\n}\r\n\r\ntags.label = data.label ?? 'door';\r\ntags.color = data.color ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD';\r\ntags.labelFloatingBackgroundColor = data.labelFloatingBackgroundColor ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD'; \r\ntags.labelColor = data.labelColor ?? 'white';\r\ntags.destination = data.destination;\r\ntags.formAddress = data.formAddress;\r\ntags.form = data.form;\r\ntags.scaleX = data.scaleX ?? 1.5;\r\ntags.scaleY = data.scaleY ?? .3;\r\ntags.scaleZ = data.scaleZ ?? 2.5;\r\n\r\nif (tags.formAddress) {\r\n    tags.scaleX = 2;\r\n    tags.scaleY = 2;\r\n    tags.scaleZ = 2;\r\n\r\n    thisBot.makeMiniSkybox();\r\n}\r\n\r\n//Place bot correctly\r\nif (data.dimensionData) {\r\n    for (const tagName in data.dimensionData) {\r\n        tags[tagName] = data.dimensionData[tagName];\r\n    }\r\n}\r\n\r\n//If new action\r\nif (data.eggParameters) {\r\n    const dimension = data.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = data.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = data.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags.dimension = dimension;\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n\r\n    thisBot.onClick();\r\n}","onABStripArtifactInstanceDataFromBotData":"@const { data } = that;\r\n\r\ndelete data.tags.label;\r\ndelete data.tags.labelColor;\r\ndelete data.tags.labelFloatingBackgroundColor;\r\ndelete data.tags.color;\r\ndelete data.tags[data.tags.dimension + \"X\"];\r\ndelete data.tags[data.tags.dimension + \"Y\"];\r\ndelete data.tags[data.tags.dimension + \"Z\"];\r\ndelete data.tags[data.tags.dimension + \"RotationX\"];\r\ndelete data.tags[data.tags.dimension + \"RotationY\"];\r\ndelete data.tags[data.tags.dimension + \"RotationZ\"];\r\ndelete data.tags[data.tags.dimension];\r\ndelete data.tags.dimension;\r\ndelete data.tags.destination;\r\ndelete data.tags.formAddress;\r\ndelete data.tags.form;\r\ndelete data.tags.scaleX;\r\ndelete data.tags.scaleY;\r\ndelete data.tags.scaleZ;","onClick":"@if (that) {\r\n    if (that.modality == 'mouse' && that.buttonId == 'right') {\r\n        return;\r\n    }\r\n}\r\n\r\nshout('abMenuRefresh');\r\nshout(\"clearSimDoorMenu\");\r\n\r\nconfigBot.tags.menuPortal = 'simDoor_menu';\r\n\r\nconst menuOptions = {\r\n    simDoor_menu: true,\r\n    clearSimDoorMenu: `@destroy(thisBot);`,\r\n    abMenuRefresh: \"@destroy(thisBot);\",\r\n    door: getLink(thisBot)\r\n}\r\n\r\nconst chooseExitButton = {\r\n    ...menuOptions,\r\n    label: 'choose destination',\r\n    defaultOpen: true,\r\n    simDoor_menuSortOrder: 1,\r\n    dropdownSortOrder: 1\r\n}\r\n\r\nconst options = [];\r\nconst places = getBots(\"simPlace\", true);\r\nfor (let i = 0; i < places.length; ++i) {\r\n    const tempDropdown = {\r\n        ...menuOptions,\r\n        label: places[i].tags.label,\r\n        place: getLink(places[i]),\r\n        onClick:  `@\r\n            links.door.tags.destination = links.place.tags.simID;\r\n            links.door.tags.label = links.place.tags.label;\r\n            links.door.tags.color = null;\r\n            links.door.tags.form = \"sphere\";\r\n            links.door.tags.formAddress = links.place.tags.formAddress;\r\n            links.door.tags.scaleX = 2;\r\n            links.door.tags.scaleY = 2;\r\n            links.door.tags.scaleZ = 2;\r\n            links.door.makeMiniSkybox();\r\n            shout(\"clearSimDoorMenu\");\r\n        `\r\n    }\r\n\r\n    options.push(tempDropdown);\r\n}\r\n\r\nchooseExitButton.dropdownOptions = options;\r\n\r\n// const travelButton = {\r\n//     ...menuOptions,\r\n//     label: 'travel to: ' + tags.label ?? '',\r\n//     place: getLink(getBot(\"simID\", tags.destination)),\r\n//     simDoor_menuSortOrder: 1,\r\n//     onClick: `@\r\n//         shout(\"activateStoryPlaceSkybox\", links?.place?.tags.formAddress);\r\n//     `\r\n// }\r\n\r\nif (!tags.destination) {\r\n    if (options.length == 0) {\r\n        os.toast(\"no destinations found\");\r\n    } else {\r\n    ab.links.menu.abCreateMenuDropdown(chooseExitButton); \r\n    }\r\n} else {\r\n    const place = getBot(\"simID\", tags.destination);\r\n    shout(\"activateStoryPlaceSkybox\", place.tags.formAddress);\r\n    // ab.links.menu.abCreateMenuButton(travelButton);\r\n}","abArtifactName":"simDoor","abIDOrigin":"simDoor","onBotAdded":"@let waitTime = 0;\r\n\r\nwhile(!globalThis.ab?.links.bot_factory) {\r\n    if (waitTime >= 5000) {\r\n        return;\r\n    }\r\n    \r\n    await os.sleep(250);\r\n    waitTime += 250;\r\n}\r\n\r\nmasks.ready = true;","onGridClick":"@shout(\"clearSimDoorMenu\");","strokeColor":"white","cursor":"pointer","simDoor":"true","labelWordWrapMode":"breakWords","labelPosition":"floatingBillboard","labelFontSize":"1","labelSize":"2","makeMiniSkybox":"@tags.anchorPoint = 'center';\r\n\r\nconst miniSkybox = await create({\r\n    form: 'sphere',\r\n    formAddress: tags.formAddress,\r\n    pointable: false,\r\n    scale: 1.1,\r\n    [tags.dimension]: true,\r\n    anchorPoint: 'center',\r\n    [tags.dimension + \"RotationX\"]: 1.5708,\r\n    abIgnore: true,\r\n    transformer: getID(thisBot),\r\n    onAnyBotDrop: `@if (that.bot == thisBot) {  \r\n        tags[tags.dimension + \"RotationX\"] = 1.5708;\r\n    }`\r\n});\r\n\r\nif (links && links.miniSkybox) {\r\n    destroy(miniSkybox);\r\n}\r\ntags.miniSkybox = getLink(miniSkybox);","miniSkybox":"ðŸ”—9707ecfa-8321-441c-805b-c6154d3a49fe","anchorPoint":"center","onSimPlaceSkyboxLoaded":"@if (that && tags.destination && that.tags.simID == tags.destination) {\r\n    tags.destination = that.tags.simID;\r\n    tags.label = that.tags.label;\r\n    tags.color = null;\r\n    tags.form = \"sphere\";\r\n    tags.formAddress = that.tags.formAddress;\r\n    tags.scaleX = 2;\r\n    tags.scaleY = 2;\r\n    tags.scaleZ = 2;\r\n    makeMiniSkybox();\r\n}"}}}}