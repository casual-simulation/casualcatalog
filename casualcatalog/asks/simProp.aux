{"version":1,"state":{"21a397d1-e9f2-40bf-8b17-991812575d44":{"id":"21a397d1-e9f2-40bf-8b17-991812575d44","space":"shared","tags":{"system":"sim_toolbox.tools.simProp","onABArtifactCollectShards":"@const shard: ABArtifactShard = {\r\n    data: {\r\n        label: tags.label,\r\n        dimensionData: {\r\n            dimension: ab.links.remember.tags.abActiveDimension,\r\n            [ab.links.remember.tags.abActiveDimension]: tags[ab.links.remember.tags.abActiveDimension],\r\n            [ab.links.remember.tags.abActiveDimension + 'X']: tags[ab.links.remember.tags.abActiveDimension + 'X'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Y']: tags[ab.links.remember.tags.abActiveDimension + 'Y'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Z']: tags[ab.links.remember.tags.abActiveDimension + 'Z'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationX']: tags[ab.links.remember.tags.abActiveDimension + 'RotationX'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationY']: tags[ab.links.remember.tags.abActiveDimension + 'RotationY'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationZ']: tags[ab.links.remember.tags.abActiveDimension + 'RotationZ'],\r\n        },\r\n        color: tags.color,\r\n        labelFloatingBackgroundColor: tags.labelFloatingBackgroundColor,\r\n        labelColor: tags.labelColor,\r\n        simID: tags.simID,\r\n        form: tags.form,\r\n        formSubtype: tags.formSubtype,\r\n        formAddress: tags.formAddress,\r\n        formAddressAspectRatio: tags.formAddressAspectRatio,\r\n        simAttributes: tags.simAttributesStartingValues,\r\n        propLocked: tags.propLocked,\r\n        roleName: tags.roleName,\r\n        trackedStat: tags.trackedStat,\r\n        trackedStatStartingValue: tags.trackedStatStartingValue,\r\n        trackedStatEndingValue: tags.trackedStatEndingValue\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'simProp'\r\n        }\r\n    ]\r\n}\r\n\r\nreturn shard;","onABArtifactReconstitute":"@let data = that.data;\r\nif (data.config) {\r\n    data = data.config;\r\n}\r\ntags.label = data.label ?? 'prop';\r\ntags.color = data.color ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD';\r\ntags.labelFloatingBackgroundColor = data.labelFloatingBackgroundColor ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD'; \r\ntags.labelColor = data.labelColor ?? 'white';\r\ntags.simID = data.simID ?? uuid();\r\ntags.form = data.form ?? null;\r\ntags.formSubtype = data.formSubtype;\r\ntags.formAddress = data.formAddress;\r\ntags.formAddressAspectRatio = data.formAddressAspectRatio;\r\ntags.simAttributes = data.simAttributes;\r\ntags.simAttributesStartingValues = data.simAttributes;\r\ntags.propLocked = data.propLocked ?? false;\r\ntags.roleName = data.roleName;\r\ntags.trackedStat = data.trackedStat;\r\ntags.trackedStatStartingValue = data.trackedStatStartingValue ?? 0;\r\ntags.trackedStatEndingValue = data.trackedStatEndingValue ?? 100;\r\n\r\nif (!tags.simAttributes) {\r\n    tags.simAttributes = {};\r\n}\r\n\r\nthisBot.setProgressBar();\r\n\r\nshout(\"onPropReconstituted\", thisBot);\r\n\r\n//Place bot correctly\r\nif (data.dimensionData) {\r\n    for (const tagName in data.dimensionData) {\r\n        tags[tagName] = data.dimensionData[tagName];\r\n    }\r\n}\r\n\r\n//If new action\r\nif (data.eggParameters) {\r\n    const dimension = data.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = data.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = data.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags.dimension = dimension;\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n\r\n    thisBot.onClick();\r\n}\r\n\r\nif (tags.dimension && tags.dimension != 'blueprint') {\r\n    tags.blueprint = true;\r\n    tags.blueprintX = tags[tags.dimension + 'X'];\r\n    tags.blueprintY = tags[tags.dimension + 'Y'];\r\n}\r\n\r\nif (data.autoGenerateReactions == false) {\r\n    return;\r\n} else {\r\n   thisBot.createPropReactions(); \r\n}","onABStripArtifactInstanceDataFromBotData":"@const { data } = that;\r\n\r\ndelete data.tags.label;\r\ndelete data.tags.labelColor;\r\ndelete data.tags.labelFloatingBackgroundColor;\r\ndelete data.tags.color;\r\ndelete data.tags[data.tags.dimension + \"X\"];\r\ndelete data.tags[data.tags.dimension + \"Y\"];\r\ndelete data.tags[data.tags.dimension + \"Z\"];\r\ndelete data.tags[data.tags.dimension + \"RotationX\"];\r\ndelete data.tags[data.tags.dimension + \"RotationY\"];\r\ndelete data.tags[data.tags.dimension + \"RotationZ\"];\r\ndelete data.tags[data.tags.dimension];\r\ndelete data.tags.dimension;\r\ndelete data.tags.simID;\r\ndelete data.tags.form;\r\ndelete data.tags.formSubtype;\r\ndelete data.tags.formAddress;\r\ndelete data.tags.formAddressAspectRatio;\r\ndelete data.tags.simAttributes;\r\ndelete data.tags.propLocked;\r\ndelete data.tags.roleName;\r\ndelete data.tags.simAttributesStartingValues;\r\ndelete data.tags.statsButton;\r\ndelete data.tags.trackedStat;\r\ndelete data.tags.trackedStatStartingValue;\r\ndelete data.tags.trackedStatEndingValue;\r\ndelete data.tags.progressBarBackgroundColor;\r\ndelete data.tags.progressBarColor;\r\ndelete data.tags.progressBar;","onClick":"@shout('abMenuRefresh');\r\nshout(\"clearSimPropMenu\");\r\n\r\nif (that) {\r\n    if (that.modality == 'mouse' && that.buttonId == 'right') {\r\n        return;\r\n    }\r\n}\r\n\r\nconst triggerBot = getBot(\"choosingProp\", true);\r\n\r\nif (triggerBot) {\r\n    triggerBot.addTrigger(thisBot);\r\n    tags.color = tags.prevColor;\r\n    tags.prevColor = null;\r\n    return;\r\n}\r\n\r\nconfigBot.tags.menuPortal = 'simProp_menu';\r\n\r\nconst menuOptions = {\r\n    simProp_menu: true,\r\n    clearSimPropMenu: `@destroy(thisBot);`,\r\n    abMenuRefresh: \"@ destroy(thisBot);\",\r\n    prop: getLink(thisBot)\r\n}\r\n\r\nconst propButton = {\r\n    ...menuOptions,\r\n    label: 'set prop name: ' + (tags.roleName ?? \"\"),\r\n    simProp_menuSortOrder: 1,\r\n    onClick: `@\r\n        const response = await os.showInput(links.prop.tags.roleName, {\r\n            autoSelect: true,\r\n            title: 'set this prop name'\r\n        });\r\n        links.prop.tags.roleName = response;\r\n        links.prop.tags.label = response;\r\n        links.prop.onClick();\r\n    `\r\n}\r\n\r\nconst addAttributeButton = {\r\n    ...menuOptions,\r\n    label: 'add new stat',\r\n    simProp_menuSortOrder: 2,\r\n    onClick: `@\r\n        const response = await os.showInput(\"\", {\r\n            autoSelect: true,\r\n            title: 'stat name'\r\n        });\r\n\r\n        if (!response) {\r\n            return;\r\n        }\r\n\r\n        const response2 = await os.showInput(\"\", {\r\n            autoSelect: true,\r\n            title: 'starting stat value'\r\n        });\r\n\r\n        if (!response2) {\r\n            return;\r\n        }\r\n\r\n        if (!links.prop.tags.simAttributes) {\r\n            links.prop.tags.simAttributes = {};\r\n        }\r\n\r\n        const tempAttributes = {...links.prop.tags.simAttributes};\r\n        tempAttributes[response] = response2;\r\n\r\n        links.prop.tags.simAttributes = tempAttributes;\r\n        links.prop.onClick();\r\n    `\r\n}\r\n\r\nconst seeAttributesButton = {\r\n    ...menuOptions,\r\n    label: 'stats',\r\n    menuItemType: 'dropdown'\r\n}\r\n\r\nseeAttributesButton.dropdownOptions = [];\r\nfor (const item in tags.simAttributes) {\r\n    const tempDropdownItem = {\r\n        ...menuOptions,\r\n        label: `${item}: ${tags.simAttributes[item]}`\r\n    }\r\n    seeAttributesButton.dropdownOptions.push(tempDropdownItem);\r\n}\r\n\r\nconst attributesGroup = {\r\n    groupSortOrder: 2,\r\n    simProp_menuSortOrder: 2,\r\n    menuItems: [addAttributeButton]\r\n}\r\n\r\nif (tags.simAttributes && Object.keys(tags.simAttributes).length != 0) {\r\n    attributesGroup.menuItems.push(seeAttributesButton);\r\n}\r\n\r\nconst trackAttributeButton = {\r\n    ...menuOptions,\r\n    label: 'tracked stat: ' + (tags.trackedStat ?? \"\"),\r\n    simProp_menuSortOrder: 4,\r\n    onClick: `@\r\n        const response = await os.showInput(links.prop.tags.trackedStat, {\r\n            autoSelect: true,\r\n            title: 'what stat would you like to track?'\r\n        });\r\n        links.prop.tags.trackedStat = response;\r\n        links.prop.onClick();\r\n    `\r\n}\r\n\r\nconst trackAttributeStartButton = {\r\n    ...menuOptions,\r\n    label: 'tracked stat starting value: ' + (tags.trackedStatStartingValue ?? \"\"),\r\n    simProp_menuSortOrder: 5,\r\n    onClick: `@\r\n        const response = await os.showInput(links.prop.tags.trackedStatStartingValue ?? 0, {\r\n            autoSelect: true,\r\n            title: 'choose a starting value for the tracked stat'\r\n        });\r\n        links.prop.tags.trackedStatStartingValue = response;\r\n        links.prop.onClick();\r\n    `\r\n}\r\n\r\nconst trackAttributeEndButton = {\r\n    ...menuOptions,\r\n    label: 'tracked stat ending value: ' + (tags.trackedStatEndingValue ?? \"\"),\r\n    simProp_menuSortOrder: 6,\r\n    onClick: `@\r\n        const response = await os.showInput(links.prop.tags.trackedStatEndingValue ?? 0, {\r\n            autoSelect: true,\r\n            title: 'choose an ending value for the tracked stat'\r\n        });\r\n        links.prop.tags.trackedStatEndingValue = response;\r\n        links.prop.onClick();\r\n    `\r\n}\r\n\r\nconst lockPropButton = {\r\n    ...menuOptions,\r\n    label: 'lock prop',\r\n    simProp_menuSortOrder: 7,\r\n    onClick: `@\r\n        const response = await os.showConfirm({\r\n            title: 'Lock this prop?',\r\n            content: 'you will not be able to edit this prop anymore'\r\n        });\r\n        if (response) {\r\n            links.prop.tags.propLocked = true;\r\n            links.prop.tags.simAttributesStartingValues = links.prop.tags.simAttributes;\r\n            links.prop.setProgressBar();\r\n        }\r\n        links.prop.onClick();\r\n    `\r\n}\r\n\r\n\r\nif (!tags.propLocked) {\r\n    ab.links.menu.abCreateMenuButton(propButton);  \r\n\r\n    ab.links.menu.abCreateMenuGroup(attributesGroup);\r\n\r\n    ab.links.menu.abCreateMenuButton(trackAttributeButton);   \r\n    ab.links.menu.abCreateMenuButton(trackAttributeStartButton);   \r\n    ab.links.menu.abCreateMenuButton(trackAttributeEndButton);   \r\n    ab.links.menu.abCreateMenuButton(lockPropButton);   \r\n} else {\r\n    // shout(\"clearActionMenu\");\r\n\r\n    // if (configBot.tags.menuPortal != \"action_menu\") {\r\n    //     configBot.tags.menuPortal = \"action_menu\";\r\n    // }\r\n\r\n    thisBot.showStats();\r\n    const avatarBot = getBot(byTag(\"simAvatar\", true), byTag(\"remoteID\", getID(configBot)));\r\n    if (avatarBot) {\r\n        const xPos = (avatarBot.tags[tags.dimension + 'X'] && avatarBot.tags[tags.dimension + 'X'] > tags[tags.dimension + 'X']) ? tags[tags.dimension + 'X'] + 3 : tags[tags.dimension + 'X'] - 3;\r\n        const yPos = (avatarBot.tags[tags.dimension + 'Y'] && avatarBot.tags[tags.dimension + 'Y'] > tags[tags.dimension + 'Y']) ? tags[tags.dimension + 'Y'] + 3 : tags[tags.dimension + 'Y'] - 3;\r\n        avatarBot.onGridClick({\r\n            position: {\r\n                x: xPos,\r\n                y: yPos\r\n            },\r\n            dimension: tags.dimension\r\n        })\r\n    }\r\n\r\n    // const actionBots = getBots(byTag(\"simAction\", true), byTag(\"startingAction\", true));\r\n\r\n    // for (let i = 0; i < actionBots.length; ++i) {\r\n    //     if (actionBots[i].tags.roleTags && actionBots[i].tags.roleTags.length != 0) {\r\n    //         if(actionBots[i].tags.roleTags.includes(tags.roleName)) {\r\n    //             actionBots[i].showAction();\r\n    //         }\r\n    //     }\r\n    // }\r\n}\r\n","abArtifactName":"simProp","abIDOrigin":"simProp","onBotAdded":"@let waitTime = 0;\r\n\r\nwhile(!globalThis.ab?.links.bot_factory) {\r\n    if (waitTime >= 5000) {\r\n        return;\r\n    }\r\n    \r\n    await os.sleep(250);\r\n    waitTime += 250;\r\n}\r\n\r\nmasks.ready = true;","onGridClick":"@shout(\"clearSimPropMenu\");\r\nshout(\"clearPropMenu\");","strokeColor":"#ffffff","cursor":"pointer","editAttribute":"@const attributeName = that.attributeName;\r\nconst newValue = that.value;\r\n\r\nconst tempAttributes = {...tags.simAttributes};\r\n\r\nif (!attributeName) {\r\n    console.log(\"[Sim Attributes]: editAttribute, no attribute name provided.\");\r\n    return;\r\n}\r\n\r\nif (!newValue && newValue != 0) {\r\n    console.log(\"[Sim Attributes]: editAttribute, no new value provided.\");\r\n    return;\r\n}\r\n\r\ntempAttributes[attributeName] = newValue;\r\ntags.simAttributes = tempAttributes;\r\n\r\n// tags.simAttributes[attributeName] = newValue;\r\n\r\nthisBot.setProgressBar();\r\n\r\nshout(\"clearSimPropMenu\");\r\nshout(\"clearPropStatsMenu\");\r\n\r\nif (links.statsButton) {\r\n    thisBot.showStats();\r\n}\r\n","onRemoteData":"@if (that.name == \"onStartMenu\") {\r\n    if (tags.simAttributesStartingValues) {\r\n        tags.simAttributes = tags.simAttributesStartingValues;\r\n    }\r\n\r\n    thisBot.setProgressBar();\r\n    shout(\"clearPropStatsMenu\");\r\n    shout('abMenuRefresh');\r\n}","showStats":"@shout(\"clearPropMenu\");\r\nawait os.sleep(0);\r\n\r\nconst menuOptions = {\r\n    action_menu: true,\r\n    //clearActionMenu: `@destroy(thisBot);`,\r\n    clearPropMenu: `@destroy(thisBot);`,\r\n    abMenuRefresh: `@destroy(thisBot);`\r\n}\r\n\r\nconfigBot.tags.menuPortal = \"action_menu\"\r\n\r\nconst seeAttributesButton = {\r\n    ...menuOptions,\r\n    label: tags.label + ' stats',\r\n    defaultOpen: true,\r\n    ignoreOpenDropdownRules: true,\r\n    dropdownSortOrder: 100,\r\n    action_menuSortOrder: 100\r\n}\r\n\r\nseeAttributesButton.dropdownOptions = [];\r\nfor (const item in tags.simAttributes) {\r\n    const tempDropdownItem = {\r\n        ...menuOptions,\r\n        label: `${item}: ${tags.simAttributes[item]}`\r\n    }\r\n    seeAttributesButton.dropdownOptions.push(tempDropdownItem);\r\n}\r\n\r\nif (tags.statsButton) {\r\n    destroy(links?.statsButton);\r\n}\r\n\r\nif (tags.simAttributes && Object.keys(tags.simAttributes).length != 0) {\r\n    const stats = await ab.links.menu.abCreateMenuDropdown(seeAttributesButton);\r\n    tags.statsButton = getLink(stats);\r\n}","simProp":"true","scaleX":"2","scaleY":"2","setProgressBar":"@if (tags.trackedStat) {\r\n    if (tags.simAttributes && (tags.simAttributes[tags.trackedStat] || tags.simAttributes[tags.trackedStat] == 0)) {\r\n        tags.progressBarBackgroundColor = 'black';\r\n        tags.progressBarColor = 'white';\r\n        const currentValue = tags.simAttributes[tags.trackedStat];\r\n        let progressBarValue;\r\n        if (tags.trackedStatStartingValue > tags.trackedStatEndingValue) {\r\n            progressBarValue = currentValue / tags.trackedStatStartingValue;\r\n        } else {\r\n            progressBarValue = currentValue / tags.trackedStatEndingValue;\r\n        }\r\n        tags.progressBar = progressBarValue;\r\n        console.log(\"prog\", progressBarValue, tags.trackedStatStartingValue, tags.trackedStatEndingValue, currentValue);\r\n    }\r\n}","progressBarPosition":"front","onABOpenMenu":"@if (that.menuType != 'abBotMenu' || ab.links.remember.links.abBotFocus != thisBot) {\r\n    return;\r\n}\r\n\r\nconst menuOptions = {\r\n    abMenuRefresh: `@destroy(thisBot);`,\r\n    abMenu: true,\r\n    prop: getLink(thisBot)\r\n}\r\n\r\nconst propMenuButton = {\r\n    ...menuOptions,\r\n    formAddress: 'lock',\r\n    label: 'unlock',\r\n    onClick: `@\r\n        links.prop.tags.propLocked = false;\r\n        shout('abMenuRefresh');\r\n        shout(\"clearSimPropMenu\");\r\n\r\n        links.prop.onClick();\r\n    `\r\n}\r\n\r\nif (tags.propLocked) {\r\n    ab.links.menu.abCreateMenuButton(propMenuButton); \r\n}","labelPosition":"floatingBillboard","labelWordWrapMode":"breakWords","labelFontSize":"1","labelSize":"2","onPointerExit":"@const triggerBot = getBot(\"choosingProp\", true);\r\n\r\nif (triggerBot) {\r\n    tags.color = tags.prevColor;\r\n    tags.prevColor = null;\r\n}","onPointerEnter":"@const triggerBot = getBot(\"choosingProp\", true);\r\n\r\nif (triggerBot) {\r\n    tags.prevColor = tags.color;\r\n    tags.color = '#fcba03';\r\n}","blueprint":true,"blueprintX":10,"blueprintY":5,"blueprintZ":0,"onAnyBotClicked":"@if (!that.bot.tags.action_menu) {\r\n  shout(\"clearPropMenu\");  \r\n}","createPropReactions":"@//make onClick\r\nconst abArtifactShard = {\r\n    data: {\r\n        label: 'onClick',\r\n        propReactionType: 'onClick',\r\n        actionTriggers: [tags.simID],\r\n        dimensionData: {\r\n            dimension: 'blueprint',\r\n            blueprint: true,\r\n            blueprintX: tags.blueprintX + 3,\r\n            blueprintY: tags.blueprintY\r\n        }\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'simPropReaction'\r\n        }\r\n    ]\r\n};\r\nconst clickBot = await ab.links.artifact.abCreateArtifactPromiseBot({\r\n    abArtifactName: 'simPropReaction',\r\n    abArtifactInstanceID: uuid(),\r\n    abArtifactShard,\r\n});\r\n\r\n//make onDrag\r\nconst abArtifactShard2 = {\r\n    data: {\r\n        label: 'onDrag',\r\n        propReactionType: 'onDrag',\r\n        actionTriggers: [tags.simID],\r\n        dimensionData: {\r\n            dimension: 'blueprint',\r\n            blueprint: true,\r\n            blueprintX: tags.blueprintX,\r\n            blueprintY: tags.blueprintY + 3\r\n        }\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'simPropReaction'\r\n        }\r\n    ]\r\n};\r\nconst dragBot = await ab.links.artifact.abCreateArtifactPromiseBot({\r\n    abArtifactName: 'simPropReaction',\r\n    abArtifactInstanceID: uuid(),\r\n    abArtifactShard: abArtifactShard2,\r\n});"}}}}