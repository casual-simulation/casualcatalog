{"version":1,"state":{"767a6370-e8bb-4dfe-b4bd-575fcc232c6c":{"id":"767a6370-e8bb-4dfe-b4bd-575fcc232c6c","space":"shared","tags":{"system":"sim_toolbox.tools.simWizard","onABArtifactCollectShards":"@const shard: ABArtifactShard = {\r\n    data: {\r\n        label: tags.label,\r\n        dimensionData: {\r\n            dimension: ab.links.remember.tags.abActiveDimension,\r\n            [ab.links.remember.tags.abActiveDimension]: tags[ab.links.remember.tags.abActiveDimension],\r\n            [ab.links.remember.tags.abActiveDimension + 'X']: tags[ab.links.remember.tags.abActiveDimension + 'X'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Y']: tags[ab.links.remember.tags.abActiveDimension + 'Y'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Z']: tags[ab.links.remember.tags.abActiveDimension + 'Z'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationX']: tags[ab.links.remember.tags.abActiveDimension + 'RotationX'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationY']: tags[ab.links.remember.tags.abActiveDimension + 'RotationY'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationZ']: tags[ab.links.remember.tags.abActiveDimension + 'RotationZ'],\r\n        },\r\n        color: tags.color,\r\n        labelFloatingBackgroundColor: tags.labelFloatingBackgroundColor,\r\n        labelColor: tags.labelColor,\r\n        simID: tags.simID\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'simWizard'\r\n        }\r\n    ]\r\n}\r\n\r\nreturn shard;","onABArtifactReconstitute":"@const data = that.data;\r\ntags.label = data.label ?? 'sim wizard';\r\ntags.color = data.color ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD';\r\ntags.labelFloatingBackgroundColor = data.labelFloatingBackgroundColor ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD'; \r\ntags.labelColor = data.labelColor ?? 'white';\r\ntags.simID = data.simID ?? uuid();\r\n\r\n//Place bot correctly\r\nif (data.dimensionData) {\r\n    for (const tagName in data.dimensionData) {\r\n        tags[tagName] = data.dimensionData[tagName];\r\n    }\r\n}\r\n\r\n//If new action\r\nif (data.eggParameters) {\r\n    const dimension = data.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = data.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = data.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags.dimension = dimension;\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n\r\n    thisBot.onClick();\r\n}\r\n\r\nif (!ab.links.console.masks.open) {\r\n    whisper(ab.links.console, \"showConsole\");\r\n    ab.links.console.masks.open = true;\r\n}","onABStripArtifactInstanceDataFromBotData":"@const { data } = that;\r\n\r\ndelete data.tags.label;\r\ndelete data.tags.labelColor;\r\ndelete data.tags.labelFloatingBackgroundColor;\r\ndelete data.tags.color;\r\ndelete data.tags[data.tags.dimension + \"X\"];\r\ndelete data.tags[data.tags.dimension + \"Y\"];\r\ndelete data.tags[data.tags.dimension + \"Z\"];\r\ndelete data.tags[data.tags.dimension + \"RotationX\"];\r\ndelete data.tags[data.tags.dimension + \"RotationY\"];\r\ndelete data.tags[data.tags.dimension + \"RotationZ\"];\r\ndelete data.tags[data.tags.dimension];\r\ndelete data.tags.dimension;\r\ndelete data.tags.simID;\r\ndelete data.tags.wizardPrompt;","onClick":"@if (that) {\r\n    if (that.modality == 'mouse' && that.buttonId == 'right') {\r\n        return;\r\n    }\r\n}\r\n\r\nshout('abMenuRefresh');\r\nshout(\"clearSimWizardMenu\");\r\n\r\nconfigBot.tags.menuPortal = 'simWizard_menu';\r\n\r\nconst menuOptions = {\r\n    simWizard_menu: true,\r\n    clearSimWizardMenu: `@destroy(thisBot);`,\r\n    abMenuRefresh: \"@ destroy(thisBot);\",\r\n    wizard: getLink(thisBot)\r\n}\r\n\r\nconst promptButton = {\r\n    ...menuOptions,\r\n    label: 'submit prompt',\r\n    simWizard_menuSortOrder: 1,\r\n    formAddress: 'edit',\r\n    onClick: `@\r\n        const response = await os.showInput(links.wizard.tags.wizardPrompt, {\r\n            autoSelect: true,\r\n            title: 'describe this simulation'\r\n        });\r\n        links.wizard.tags.wizardPrompt = response;\r\n        links.wizard.generateFromPrompt(response);\r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nconst csvButton = {\r\n    ...menuOptions,\r\n    label: 'upload csv',\r\n    formAddress: 'upload',\r\n    simWizard_menuSortOrder: 2,\r\n    onClick: `@\r\n        const files = await os.showUploadFiles(); \r\n        if (files) {\r\n            links.wizard.generateFromCSV(files[0]);\r\n        } \r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nconst downloadButton = {\r\n    ...menuOptions,\r\n    label: 'download simulation',\r\n    formAddress: 'download',\r\n    simWizard_menuSortOrder: 3,\r\n    onClick: `@\r\n        links.wizard.downloadSim();\r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nconst cameraButton = {\r\n    ...menuOptions,\r\n    label: 'use camera to generate sim',\r\n    formAddress: 'photo_camera',\r\n    simWizard_menuSortOrder: 4,\r\n    onClick: `@\r\n        links.wizard.generateFromCamera();\r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nab.links.menu.abCreateMenuButton(promptButton);\r\nab.links.menu.abCreateMenuButton(csvButton);\r\nab.links.menu.abCreateMenuButton(downloadButton);\r\nab.links.menu.abCreateMenuButton(cameraButton);\r\n","abIDOrigin":"simWizard","onBotAdded":"@let waitTime = 0;\r\n\r\nwhile(!globalThis.ab?.links.bot_factory) {\r\n    if (waitTime >= 5000) {\r\n        return;\r\n    }\r\n    \r\n    await os.sleep(250);\r\n    waitTime += 250;\r\n}\r\n\r\nmasks.ready = true;","onGridClick":"@shout(\"clearSimWizardMenu\");","strokeColor":"white","cursor":"pointer","scaleZ":"2","onABOpenMenu":"@if (that.menuType != 'abBotMenu' || ab.links.remember.links.abBotFocus != thisBot) {\r\n    return;\r\n}\r\n\r\nconst menuOptions = {\r\n    abMenuRefresh: `@destroy(thisBot);`,\r\n    abMenu: true,\r\n    action: getLink(thisBot)\r\n}\r\n\r\nreturn;","abArtifactName":"simWizard","generateFromPrompt":"@const prompt = that;\r\ntags.userPrompt = that;\r\n\r\nconfigBot.tags.menuPortal = \"simWizardLoading\";\r\nconst loadingBar = ab.links.menu.abCreateMenuBusyIndicator({\r\n    label: \"thinking\",\r\n    simWizardLoading: true\r\n});\r\n\r\nconst basePrompt = `You will be given a prompt for a simulation. You must return a csv with the simulation items that you decide should be created based on the content of the prompt. Your csv must have two fields: type and configuration. You must provide location information for each item you wish to create. Place these items with these rules in mind: \r\n    PLACEMENT RULES: \r\n        - place items in ways that make visual sense in a 3d world\r\n        - units are in feet, they should be integers\r\n        - leave space between items\r\n\r\n    You must answer quickly, preferrably within 30 seconds. Favor speed over extra detail.\r\n    a trigger_type can be an action or reaction or prop reaction or prop actions or smart reactions.\r\n    \r\n    Your options for simulation items are:\r\n        - SIM_ACTION: \r\n            description: an action for a user to take or complete. These will typically be in action/reaction chains, starting with a \"startingAction\" or a prop reaction (triggered by a user interacting with a prop), this chain is indicated using triggers.\r\n            configuration: {\r\n                label: the text that should appear on the action (keep it brief, less than 10 words)\r\n                simID: a unique id used to determine triggers\r\n                triggers: an array of trigger_types that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this action to be unlocked and able to follow a trigger.\r\n                roles: an array of the names of roles and/or the names of props (case sensitive, do NOT use simIDs) that this action should appear for (example: a 'doctor' role can 'check test results', but a 'patient' role cannot, a 'notepad' prop can be written in).  \r\n                startingAction: a true or false value representing whether or not this action is one of the first actions a user sees.\r\n                groups: an array of group ids. If two actions have the same group id only one action in the group can be completed.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_ROLE: \r\n            description: a role that a user can take on (example: doctor, patient).\r\n            configuration: {\r\n                name: the name of the role.\r\n                attributes: a json object of attribute name keys and attribute values.\r\n                numUsers: an integer number representing how many users can occupy this role at one time.\r\n                place: the simID of the sim place that a user should be sent to upon choosing this role.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_REACTION: \r\n            description: an effect that can happen in response to an action, that changes a stat of a chosen role or prop.\r\n            configuration: {\r\n                label: A brief description of the reaction (less than 5 words).\r\n                affectedAttribute: the attribute of a prop or role that should be affected.\r\n                effect: the way that the attribute is affected. This value can be +, -, or =.\r\n                value: The amount that the attribute should be changed by (example 2).\r\n                roles: an array of the names of roles and/or the names of props (case sensitive, do NOT use simIDs) that this reaction should affect (example: a patient role can have it's health attribute reduced).\r\n                simID: a unique id used to determine triggers.\r\n                triggers: an array of trigger_types that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this reaction to be unlocked and able to follow a trigger.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PROP:\r\n            description: a prop in the simulation that is not a player but has stats.\r\n            configuration: {\r\n                name: The name of the prop.\r\n                trackedAttribute: The main attribute that should be visually represented for this prop. This value can be left empty.\r\n                lowestValue: The lowest value allowed for the tracked attribute.\r\n                highestValue: The highest value allowed for the tracked attribute.\r\n                attributes: a json object of attribute name keys and attribute values, make sure the tracked attribute is included.\r\n                place: the simID of the place where this prop should be located.\r\n                simID: a unique id used to determine triggers.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PROP_ACTION: \r\n            description: a type of action, exactly like a sim action, except these are hidden by a prop reaction trigger and completed by the completion of different action, reaction, or prop reaction triggers.\r\n            configuration: {\r\n                label: the text that should appear on the prop action (keep it brief, less than 10 words, EXAMPLE: \"click on the trash can\")\r\n                simID: a unique id used to determine triggers\r\n                triggers: an array of trigger_types that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this action to be unlocked and able to follow a trigger.\r\n                completionTriggers: an array of trigger_types that should cause this prop action to complete.\r\n                hideTriggers: an array of prop reactions that should cause this prop action to hide.\r\n                roles: an array of the names of roles (case sensitive, do NOT use simIDs) that this action should appear for (example: a 'Doctor' role can 'check test results', but a 'Patient' role cannot).  \r\n                startingAction: a true or false value representing whether or not this prop action is one of the first actions a user sees.\r\n                groups: an array of group ids. If two actions have the same group id only one action in the group can be completed.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PLACE:\r\n            description: a location in the simulation that a player can move to and items can be placed in.\r\n            configuration: {\r\n                prompt: A prompt describing the location that should be displayed.\r\n                name: the name of the location (keep it brief, less than 4 words).\r\n                simID: a unique id for sim doors and props to reference.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_DOOR: \r\n            description: a door that can be placed in a sim place that leads to a different sim place.\r\n            configuration: {\r\n                label: the name of the place that this door should lead to.\r\n                destination: the simID of the place that this door should lead to.\r\n                place: the simID of the place where this door should be located.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PROP_REACTION: \r\n            description: a trigger for other actions/reactions that is activated by a physical interaction with a prop. There are two possible types, onClick and onDrag\r\n            configuration: {\r\n                simID: a unique id used to determine triggers.\r\n                reactionType: can be either \"onClick\" or \"onDrag\"\r\n                roles: an array of the names of roles (case sensitive, no NOT use simIDs)  that this reaction should happen for (example: a janitor clicking on a trash can triggers new actions such as taking out the trash to appear).\r\n                props: an array of props that this reaction will watch for user reactions. This cannot be an empty array.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PLAYER:\r\n            description: a player slot for a user to occupy, if no sim players are provided, users will not be able to accept a role. There should be the same number of simPlayers as the number of roles in most cases.\r\n            configuration: {\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n        \r\n        - SIM_SMART_REACTION: \r\n            description: a listener that watches for its triggers to be completed, or added to the queue of available actions, depending on the configuration.\r\n            configuration: {\r\n                label: A brief description of the reaction (less than 5 words).\r\n                simID: a unique id used to determine triggers.\r\n                triggers: an array of trigger_types that this action should listen for.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this reaction to be unlocked and able to follow a trigger.\r\n                useQueue: if true the smart reaction will look in the queue of available actions for its triggers, if false, it will look in the log of completed actions.\r\n                orderMatters: if true the triggers must be in order (example: triggers:[a, b, c], log: [a, b, d, c] would complete this smart action, log: [a, c, b] would not).\r\n                sequentialMatters: if true the triggers must not be interupted by a different action in the queue/log (example: triggers:[a, b, c], log: [a, b, d, c] would not complete this action, log: [a, c, b] would).\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n    EXAMPLE:\r\n        prompt: \"a patient who has the flu and a doctor who must run tests and diagnose them\"\r\n\r\n        response: \"\"csv\r\n            type,configuration\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Run cold test\"\", \"\"simID\"\": \"\"cold_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  15}}\"\r\n            SIM_PLACE,\"{\"\"prompt\"\": \"\"A medical examination room with equipment and seating\"\", \"\"name\"\": \"\"Exam Room\"\", \"\"simID\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": -11, \"\"y\"\": 4}}\"\r\n            SIM_ROLE,\"{\"\"name\"\": \"\"Doctor\"\", \"\"attributes\"\": {\"\"knowledge\"\": 100}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 5}}\"\r\n            SIM_PROP_REACTION,\"{\"\"simID\"\": \"\"click_cart\"\", \"\"reactionType\"\": \"\"onClick\"\", \"\"roles\"\": [\"\"Doctor\"\"], \"\"props\"\": [\"\"med_cart\"\"], \"\"location\"\": {\"\"x\"\": 14, \"\"y\"\":  5}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Run Flu test\"\", \"\"simID\"\": \"\"flu_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  10}}\"\r\n            SIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 15, \"\"y\"\": 5}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Greet patient\"\", \"\"simID\"\": \"\"greet\"\", \"\"triggers\"\": [], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": true, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 21, \"\"y\"\":  -2}}\"undefined\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Describe symptoms\"\", \"\"simID\"\": \"\"symptoms\"\", \"\"triggers\"\": [\"\"greet\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Patient\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 28, \"\"y\"\":  -2}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Diagnose flu\"\", \"\"simID\"\": \"\"diagnose\"\", \"\"triggers\"\": [\"\"check_results\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 50, \"\"y\"\":  12}}\"\r\n            SIM_PROP_ACTION,\"{\"\"label\"\": \"\"click on the medical cart\"\", \"\"simID\"\": \"\"click_med_cart_prop_action\"\", \"\"triggers\"\": [\"\"symptoms\"\"], \"\"triggerFilter\"\": [], \"\"hideTriggers\"\": [\"\"click_cart\"\"], \"\"completionTriggers\"\": [\"\"tests_complete_smart_reaction\"\"], \"\"roles\"\": [], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 36, \"\"y\"\":  -2}}\"\r\n            SIM_REACTION,\"{\"\"label\"\": \"\"Patient diagnosed\"\", \"\"affectedAttribute\"\": \"\"diagnosed\"\", \"\"effect\"\": \"\"=\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Patient\"\"], \"\"simID\"\": \"\"diagnosed_reaction\"\", \"\"triggers\"\": [\"\"diagnose\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 54, \"\"y\"\":  12}}\"\r\n            SIM_REACTION,\"{\"\"label\"\": \"\"Test Was Completed\"\", \"\"affectedAttribute\"\": \"\"tests_completed\"\", \"\"effect\"\": \"\"+\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Medical Cart\"\"], \"\"simID\"\": \"\"test_number_increase\"\", \"\"triggers\"\": [\"\"cold_test\"\", \"\"flu_test\"\", \"\"strep_test\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  20}}\"\r\n            SIM_ROLE,\"{\"\"name\"\": \"\"Patient\"\", \"\"attributes\"\": {\"\"health\"\": 50,\"\"has_flu\"\": 1,\"\"diagnosed\"\": 0}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 10}}\"\r\n            SIM_PROP,\"{\"\"name\"\": \"\"Medical Cart\"\", \"\"trackedAttribute\"\": \"\"tests_completed\"\", \"\"lowestValue\"\": 0, \"\"highestValue\"\": 3, \"\"attributes\"\": {\"\"tests_completed\"\": 0}, \"\"place\"\": \"\"exam_room\"\", \"\"simID\"\": \"\"med_cart\"\", \"\"location\"\": {\"\"x\"\": 9, \"\"y\"\":  5}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Run Strep test\"\", \"\"simID\"\": \"\"strep_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  5}}\"\r\n            SIM_SMART_REACTION,\"{\"\"label\"\": \"\"tests completed\"\", \"\"simID\"\": \"\"tests_complete_smart_reaction\"\", \"\"triggers\"\": [\"\"strep_test\"\", \"\"flu_test\"\", \"\"cold_test\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 42, \"\"y\"\":  12}, \"\"useQueue\"\": false, \"\"orderMatters\"\": false, \"\"sequentialMatters\"\": false}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Check results\"\", \"\"simID\"\": \"\"check_results\"\", \"\"triggers\"\": [\"\"tests_complete_smart_reaction\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 46, \"\"y\"\":  12}}\"\r\n            SIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 15, \"\"y\"\": 0}}\"\r\n        \"\"\r\n`\r\nconst aiChatMessages: AIChatMessage[] = [];\r\n\r\naiChatMessages.push({\r\n    role: 'system',\r\n    content: [\r\n        { text: basePrompt }\r\n    ]\r\n})\r\n\r\naiChatMessages.push({\r\n    role: 'assistant',\r\n    content: [\r\n        { text: 'hello world'}\r\n    ]\r\n})\r\n\r\naiChatMessages.push({\r\n    role: 'user',\r\n    content: [\r\n        { text: 'prompt: ' + prompt}\r\n    ]\r\n})\r\n\r\nconst aiChatOptions: AIChatOptions = { \r\n    preferredModel: ab.links.personality.tags.abPreferredAIModel\r\n}\r\n\r\ntry {\r\n    const response = await ai.chat(aiChatMessages, aiChatOptions);\r\n    console.log(response);\r\n    if (response) {\r\n        thisBot.generateFromCSV(response.content);\r\n    }  \r\n} catch (e) {\r\n    os.toast(\"Error generating sim. Please try again\", 8);\r\n    console.log(\"Error generating sim. Please try again\", e);\r\n    destroy(loadingBar);\r\n}\r\n\r\nif (loadingBar) {\r\n    destroy(loadingBar);\r\n}\r\n\r\n//old example:\r\n// EXAMPLE:\r\n//         prompt: \"give me a sim with a doctor and patient, with a medical cart prop, used to run tests on the patient. The patient has flu but doesnt know it, the doctor needs to run tests and end up diagnosing the patient.\"\r\n//         response: \"\"csv\r\n//         type,configuration\r\n//         SIM_PLACE,\"{\"\"prompt\"\": \"\"A modern medical examination room with medical equipment and comfortable seating\"\", \"\"name\"\": \"\"Examination Room\"\", \"\"simID\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": -16, \"\"y\"\": 10}}\"\r\n//         SIM_ROLE,\"{\"\"name\"\": \"\"Doctor\"\", \"\"attributes\"\": {\"\"knowledge\"\": 100, \"\"diagnostic_skill\"\": 90}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": -7, \"\"y\"\": 9}}\"\r\n//         SIM_ROLE,\"{\"\"name\"\": \"\"Patient\"\", \"\"attributes\"\": {\"\"health\"\": 60, \"\"anxiety\"\": 50, \"\"has_flu\"\": 1, \"\"diagnosed\"\": 0}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": -7, \"\"y\"\": 12}}\"\r\n//         SIM_PROP,\"{\"\"name\"\": \"\"Medical Cart\"\", \"\"trackedAttribute\"\": \"\"test_status\"\", \"\"lowestValue\"\": 0, \"\"highestValue\"\": 2, \"\"attributes\"\": {\"\"test_status\"\": 0, \"\"results_available\"\": 0}, \"\"place\"\": \"\"exam_room\"\", \"\"simID\"\": \"\"medical_cart\"\", \"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 6}}\"\r\n//         SIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 0}}\"\r\n//         SIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 3}}\"\r\n//         SIM_PROP_ACTION,\"{\"\"label\"\": \"\"click on the medical cart\"\", \"\"simID\"\": \"\"click_med_cart_prop_action\"\", \"\"triggers\"\": [\"\"describe_symptoms\"\"], \"\"triggerFilter\"\": [], \"\"hideTriggers\"\": [\"\"interact_medical_cart\"\"], \"\"completionTriggers\"\": [\"\"run_tests\"\"], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 11, \"\"y\"\": 4}}\"\r\n//         SIM_ACTION,\"{\"\"label\"\": \"\"Greet patient and ask about symptoms\"\", \"\"simID\"\": \"\"greet_patient\"\", \"\"triggers\"\": [], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": true, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 25, \"\"y\"\": 4}}\"\r\n//         SIM_ACTION,\"{\"\"label\"\": \"\"Describe feeling unwell\"\", \"\"simID\"\": \"\"describe_symptoms\"\", \"\"triggers\"\": [\"\"greet_patient\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Patient\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 18, \"\"y\"\": 4}}\"\r\n//         SIM_ACTION,\"{\"\"label\"\": \"\"Run diagnostic tests\"\", \"\"simID\"\": \"\"run_tests\"\", \"\"triggers\"\": [\"\"interact_medical_cart\"\"], \"\"triggerFilter\"\": [\"\"describe_symptoms\"\"], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 11, \"\"y\"\": 8}}\"\r\n//         SIM_ACTION,\"{\"\"label\"\": \"\"Check test results\"\", \"\"simID\"\": \"\"check_results\"\", \"\"triggers\"\": [\"\"tests_completed\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 18, \"\"y\"\": 8}}\"\r\n//         SIM_ACTION,\"{\"\"label\"\": \"\"Diagnose patient with flu\"\", \"\"simID\"\": \"\"diagnose_flu\"\", \"\"triggers\"\": [\"\"results_available\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 25, \"\"y\"\": 8}}\"\r\n//         SIM_ACTION,\"{\"\"label\"\": \"\"Leave doctor's office\"\", \"\"simID\"\": \"\"leave_office\"\", \"\"triggers\"\": [\"\"completion_check\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Patient\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 39, \"\"y\"\": 8}}\"\r\n//         SIM_PROP_REACTION,\"{\"\"simID\"\": \"\"interact_medical_cart\"\", \"\"reactionType\"\": \"\"onClick\"\", \"\"roles\"\": [\"\"Doctor\"\"], \"\"props\"\": [\"\"medical_cart\"\"], \"\"location\"\": {\"\"x\"\": 3, \"\"y\"\": 6}}\"\r\n//         SIM_REACTION,\"{\"\"label\"\": \"\"Tests completed\"\", \"\"affectedAttribute\"\": \"\"test_status\"\", \"\"effect\"\": \"\"=\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Medical Cart\"\"], \"\"simID\"\": \"\"tests_completed\"\", \"\"triggers\"\": [\"\"run_tests\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 14, \"\"y\"\": 8}}\"\r\n//         SIM_REACTION,\"{\"\"label\"\": \"\"Results available\"\", \"\"affectedAttribute\"\": \"\"results_available\"\", \"\"effect\"\": \"\"=\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Medical Cart\"\"], \"\"simID\"\": \"\"results_available\"\", \"\"triggers\"\": [\"\"check_results\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 21, \"\"y\"\": 8}}\"\r\n//         SIM_REACTION,\"{\"\"label\"\": \"\"Patient diagnosed\"\", \"\"affectedAttribute\"\": \"\"diagnosed\"\", \"\"effect\"\": \"\"=\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Patient\"\"], \"\"simID\"\": \"\"patient_diagnosed\"\", \"\"triggers\"\": [\"\"diagnose_flu\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 30, \"\"y\"\": 9}}\"\r\n//         SIM_REACTION,\"{\"\"label\"\": \"\"Anxiety reduced\"\", \"\"affectedAttribute\"\": \"\"anxiety\"\", \"\"effect\"\": \"\"-\"\", \"\"value\"\": 30, \"\"roles\"\": [\"\"Patient\"\"], \"\"simID\"\": \"\"anxiety_reduced\"\", \"\"triggers\"\": [\"\"diagnose_flu\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 30, \"\"y\"\": 7}}\"\r\n//         SIM_SMART_REACTION,\"{\"\"label\"\": \"\"End appointment\"\", \"\"simID\"\": \"\"completion_check\"\", \"\"triggers\"\": [\"\"diagnose_flu\"\", \"\"anxiety_reduced\"\"], \"\"triggerFilter\"\": [], \"\"useQueue\"\": false, \"\"orderMatters\"\": false, \"\"sequentialMatters\"\": false, \"\"location\"\": {\"\"x\"\": 32, \"\"y\"\": 8}}\"\r\n//         \"\"","generateFromCSV":"@const csvData = that;\r\n\r\nlet cleanedCSV = csvData?.replaceAll('`', '');\r\nif (cleanedCSV.indexOf('csv') == 0) {\r\n    cleanedCSV = cleanedCSV.replace('csv', '');\r\n}\r\n\r\nconst lines = cleanedCSV.split('\\n');\r\nconst result = [];\r\n\r\nfor (let i = 1; i < lines.length; i++) {\r\n    const obj = {};\r\n    const currentline = lines[i].split(',');\r\n\r\n    let simType = currentline[0];\r\n    let config = currentline?.slice(1)?.join(',')?.trim() ?? \"{}\";\r\n    if (config[0] == '\"') {\r\n        config = config.slice(1);\r\n    }\r\n    if (config[config.length - 1] == '\"') {\r\n        config = config.slice(0, -1);\r\n    }\r\n\r\n    if (simType == 'type' || !config) {\r\n        continue;\r\n    }\r\n\r\n    obj['type'] = simType;\r\n    obj['configuration'] = JSON.parse(config.replaceAll('\"\"', '\"'));\r\n\r\n    result.push(obj);\r\n}\r\n\r\nconst jsonString = JSON.stringify(result, null, 2); // Convert the array of objects to a JSON string\r\nconst jsonData = JSON.parse(jsonString);\r\n\r\nthisBot.provideReceipt({raw: csvData, parsed: jsonData});\r\n\r\nlet numPlayers = 1;\r\n\r\nconfigBot.tags.gridPortal = 'blueprint';\r\n\r\nfor (const item of jsonData) {\r\n    if (item[\"type\"]) {\r\n        const xVal = Math.floor(Math.random() * (15 - (-15) + 1)) + (-15);\r\n        const yVal = Math.floor(Math.random() * (15 - (-15) + 1)) + (-15);\r\n        let dimensionName = ab.links.remember.tags.currentDimension ?? 'blueprint';\r\n\r\n        //SIM ROLE\r\n        if (item[\"type\"] == 'SIM_ROLE') {\r\n            const conData = item[\"configuration\"];\r\n            let chosenPlaceName = conData.place.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            chosenPlaceName = chosenPlaceName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.name,\r\n                        simAttributes: conData.attributes,\r\n                        roleLocked: true,\r\n                        roleName: conData.name,\r\n                        numUsers: conData.numUsers,\r\n                        defaultPlace: chosenPlaceName,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simRole'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simRole',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n\r\n        } \r\n        //SIM ACTION\r\n        else if (item[\"type\"] == 'SIM_ACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        roleTags: conData.roles,\r\n                        startingAction: conData.startingAction,\r\n                        groupTags: conData.groups,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simAction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simAction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM DIRECTIVE\r\n        else if (item[\"type\"] == 'SIM_PROP_ACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        roleTags: conData.roles,\r\n                        startingAction: conData.startingAction,\r\n                        groupTags: conData.groups,\r\n                        completionTriggers: conData.completionTriggers,\r\n                        hideTriggers: conData.hideTriggers,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simPropAction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simPropAction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM REACTION\r\n        else if (item[\"type\"] == 'SIM_REACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        reactionAttribute: conData.affectedAttribute,\r\n                        reactionEffect: conData.effect,\r\n                        reactionValue: conData.value,\r\n                        roleTags: conData.roles,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simReaction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simReaction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM PLACE\r\n        else if (item[\"type\"] == 'SIM_PLACE') {\r\n            const conData = item[\"configuration\"];\r\n            let chosenDimensionName = conData.simID.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            chosenDimensionName = chosenDimensionName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.name,\r\n                        placePrompt: conData.prompt,\r\n                        simID: conData.simID,\r\n                        chosenDimension: chosenDimensionName,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simPlace'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simPlace',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM DOOR\r\n        else if (item[\"type\"] == 'SIM_DOOR') {\r\n            const conData = item[\"configuration\"];\r\n            dimensionName = conData.place.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            dimensionName = dimensionName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        destination: conData.destination,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simDoor'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simDoor',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM PROP\r\n        else if (item[\"type\"] == 'SIM_PROP') {\r\n            const conData = item[\"configuration\"];\r\n            dimensionName = conData.place?.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            dimensionName = dimensionName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.name,\r\n                        simID: conData.simID,\r\n                        roleName: conData.name,\r\n                        simAttributes: conData.attributes,\r\n                        trackedStat: conData.trackedAttribute,\r\n                        trackedStatStartingValue: conData.lowestValue,\r\n                        trackedStatEndingValue: conData.highestValue,\r\n                        destination: conData.destination,\r\n                        autoGenerateReactions: false,\r\n                        propLocked: true,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simProp'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simProp',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        }\r\n    \r\n        //SIM PLAYER\r\n        else if (item[\"type\"] == 'SIM_PLAYER') {\r\n            const conData = item[\"configuration\"];\r\n            dimensionName = conData.place?.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            dimensionName = dimensionName.toLowerCase();\r\n            const playerLabel = 'P' + numPlayers;\r\n            numPlayers += 1;\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: playerLabel,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simPlayer'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simPlayer',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        }\r\n        //SIM SCENE REACTION\r\n        else if (item[\"type\"] == 'SIM_PROP_REACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        simID: conData.simID,\r\n                        label: conData.reactionType,\r\n                        propReactionType: conData.reactionType,\r\n                        roleTags: conData.roles,\r\n                        actionTriggers: conData.props,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simPropReaction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simPropReaction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        }\r\n        //SIM SMART REACTION\r\n        else if (item[\"type\"] == 'SIM_SMART_REACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        checkQueue: conData.useQueue,\r\n                        orderMatters: conData.orderMatters,\r\n                        sequentialMatters: conData.sequentialMatters,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simSmartReaction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simSmartReaction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n    }\r\n}\r\n\r\n\r\n//create home place\r\nlet chosenDimensionName = 'home';\r\nconst abArtifactShard = {\r\n    data: {\r\n        config: {\r\n            label: 'home',\r\n            formAddress: 'https://images.blockadelabs.com/images/imagine/M3_Low-Poly_Render_equirectangular-jpg_a_lobby_of_a_1535619319_14882626.jpg?ver=1',\r\n            simID: uuid(),\r\n            chosenDimension: chosenDimensionName,\r\n            dimensionData: {\r\n                dimension: 'blueprint',\r\n                ['blueprint']: true,\r\n                ['blueprint' + 'X']: -7,\r\n                ['blueprint' + 'Y']: -26\r\n            }\r\n        }\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'simPlace'\r\n        }\r\n    ]\r\n};\r\nab.links.artifact.abCreateArtifactPromiseBot({\r\n    abArtifactName: 'simPlace',\r\n    abArtifactInstanceID: uuid(),\r\n    abArtifactShard,\r\n});\r\n\r\nif (tags.destroyAfterUse) {\r\n    destroy(thisBot);\r\n}","downloadSim":"@const simItems = getBots(\"simID\");\r\n\r\nlet csvString = `\"\"csv\r\ntype,configuration`\r\n\r\nfor (let i = 0; i < simItems.length; ++i) {\r\n    let newLine;\r\n    //SIM PLACE\r\n    if (simItems[i].tags.simPlace == true) {\r\n        if (simItems[i].tags.label == 'home') {\r\n            continue;\r\n        }\r\n        newLine = `\\nSIM_PLACE,\"{\"\"prompt\"\": \"\"${simItems[i].tags.placePrompt ?? 'none'}\"\", \"\"name\"\": \"\"${simItems[i].tags.label}\"\", \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    } \r\n    //SIM ROLE\r\n    else if (simItems[i].tags.simRole == true) {\r\n        let attString = ``;\r\n        for (const att in simItems[i].tags.simAttributes) {\r\n            attString += `\"\"${att}\"\": ${simItems[i].tags.simAttributes[att]},`\r\n        }\r\n        attString = attString.slice(0, -1);\r\n        newLine = `\\nSIM_ROLE,\"{\"\"name\"\": \"\"${simItems[i].tags.label}\"\", \"\"attributes\"\": {${attString}}, \"\"numUsers\"\": ${simItems[i].tags.numUsers}, \"\"place\"\": \"\"${simItems[i].tags.defaultPlace}\"\", \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    }\r\n    //SIM PROP\r\n    else if (simItems[i].tags.simProp == true) {\r\n        let attString = ``;\r\n        for (const att in simItems[i].tags.simAttributesStartingValues) {\r\n            attString += `\"\"${att}\"\": ${simItems[i].tags.simAttributesStartingValues[att]},`\r\n        }\r\n        attString = attString.slice(0, -1);\r\n        newLine = `\\nSIM_PROP,\"{\"\"name\"\": \"\"${simItems[i].tags.label}\"\", \"\"trackedAttribute\"\": \"\"${simItems[i].tags.trackedStat}\"\", \"\"lowestValue\"\": ${simItems[i].tags.trackedStatStartingValue}, \"\"highestValue\"\": ${simItems[i].tags.trackedStatEndingValue}, \"\"attributes\"\": {${attString}}, \"\"place\"\": \"\"${simItems[i].tags.dimension}\"\", \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    } \r\n    //SIM PLAYER\r\n    else if (simItems[i].tags.simPlayer == true) {\r\n        newLine = `\\nSIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    } \r\n    //SIM PROP ACTION\r\n    else if (simItems[i].tags.simPropAction == true) {\r\n        let triggers = ``;\r\n        let triggerFilter = ``;\r\n        let hideTriggers = ``;\r\n        let completionTriggers = ``;\r\n        let roles = ``;\r\n        let groups = ``;\r\n\r\n        for (let a = 0; a < simItems[i].tags.actionTriggers?.length; ++a) {\r\n            triggers += `\"\"${simItems[i].tags.actionTriggers[a]}\"\", `;\r\n        }\r\n        triggers = triggers.slice(0, -2);\r\n        \r\n        for (let b = 0; b < simItems[i].tags.actionTriggerFilter?.length; ++b) {\r\n            triggerFilter += `\"\"${simItems[i].tags.actionTriggerFilter[b]}\"\", `;\r\n        }\r\n        triggerFilter = triggerFilter.slice(0, -2);\r\n\r\n        for (let c = 0; c < simItems[i].tags.hideTriggers?.length; ++c) {\r\n            hideTriggers += `\"\"${simItems[i].tags.hideTriggers[c]}\"\", `;\r\n        }\r\n        hideTriggers = hideTriggers.slice(0, -2);\r\n\r\n        for (let d = 0; d < simItems[i].tags.completionTriggers?.length; ++d) {\r\n            completionTriggers += `\"\"${simItems[i].tags.completionTriggers[d]}\"\", `;\r\n        }\r\n        completionTriggers = completionTriggers.slice(0, -2);\r\n\r\n        for (let e = 0; e < simItems[i].tags.roleTags?.length; ++e) {\r\n            roles += `\"\"${simItems[i].tags.roleTags[e]}\"\", `;\r\n        }\r\n        roles = roles.slice(0, -2);\r\n\r\n        for (let f = 0; f < simItems[i].tags.groupTags?.length; ++f) {\r\n            groups += `\"\"${simItems[i].tags.groupTags[f]}\"\", `;\r\n        }\r\n        groups = groups.slice(0, -2);\r\n\r\n        newLine = `\\nSIM_PROP_ACTION,\"{\"\"label\"\": \"\"${simItems[i].tags.label}\"\", \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"triggers\"\": [${triggers}], \"\"triggerFilter\"\": [${triggerFilter}], \"\"hideTriggers\"\": [${hideTriggers}], \"\"completionTriggers\"\": [${completionTriggers}], \"\"roles\"\": [${roles}], \"\"startingAction\"\": ${simItems[i].tags.startingAction ?? false}, \"\"groups\"\": [${groups}], \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    } \r\n    //SIM SMART REACTION\r\n    else if (simItems[i].tags.simSmartReaction == true) {\r\n        let triggers = ``;\r\n        let triggerFilter = ``;\r\n\r\n        for (let a = 0; a < simItems[i].tags.actionTriggers?.length; ++a) {\r\n            triggers += `\"\"${simItems[i].tags.actionTriggers[a]}\"\", `;\r\n        }\r\n        triggers = triggers.slice(0, -2);\r\n\r\n        for (let b = 0; b < simItems[i].tags.actionTriggerFilter?.length; ++b) {\r\n            triggerFilter += `\"\"${simItems[i].tags.actionTriggerFilter[b]}\"\", `;\r\n        }\r\n        triggerFilter = triggerFilter.slice(0, -2);\r\n\r\n        newLine = `\\nSIM_SMART_REACTION,\"{\"\"label\"\": \"\"${simItems[i].tags.label}\"\", \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"triggers\"\": [${triggers}], \"\"triggerFilter\"\": [${triggerFilter}], \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}, \"\"useQueue\"\": ${simItems[i].tags.checkQueue}, \"\"orderMatters\"\": ${simItems[i].tags.orderMatters}, \"\"sequentialMatters\"\": ${simItems[i].tags.sequentialMatters}}\"`;\r\n    } \r\n    //SIM PROP REACTION\r\n    else if (simItems[i].tags.simPropReaction == true) {\r\n        let triggers = ``;\r\n        let roles = ``;\r\n\r\n        for (let a = 0; a < simItems[i].tags.actionTriggers?.length; ++a) {\r\n            triggers += `\"\"${simItems[i].tags.actionTriggers[a]}\"\", `;\r\n        }\r\n        triggers = triggers.slice(0, -2);\r\n\r\n        for (let e = 0; e < simItems[i].tags.roleTags?.length; ++e) {\r\n            roles += `\"\"${simItems[i].tags.roleTags[e]}\"\", `;\r\n        }\r\n        roles = roles.slice(0, -2);\r\n\r\n        newLine = `\\nSIM_PROP_REACTION,\"{\"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"reactionType\"\": \"\"${simItems[i].tags.propReactionType}\"\", \"\"roles\"\": [${roles}], \"\"props\"\": [${triggers}], \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    } \r\n    //SIM REACTION\r\n    else if (simItems[i].tags.simReaction == true) {\r\n        let roles = ``;\r\n        let triggers = ``;\r\n        let triggerFilter = ``;\r\n\r\n        for (let a = 0; a < simItems[i].tags.actionTriggers?.length; ++a) {\r\n            triggers += `\"\"${simItems[i].tags.actionTriggers[a]}\"\", `;\r\n        }\r\n        triggers = triggers.slice(0, -2);\r\n\r\n        for (let b = 0; b < simItems[i].tags.actionTriggerFilter?.length; ++b) {\r\n            triggerFilter += `\"\"${simItems[i].tags.actionTriggerFilter[b]}\"\", `;\r\n        }\r\n        triggerFilter = triggerFilter.slice(0, -2);\r\n\r\n        for (let e = 0; e < simItems[i].tags.roleTags?.length; ++e) {\r\n            roles += `\"\"${simItems[i].tags.roleTags[e]}\"\", `;\r\n        }\r\n        roles = roles.slice(0, -2);\r\n\r\n        newLine = `\\nSIM_REACTION,\"{\"\"label\"\": \"\"${simItems[i].tags.label}\"\", \"\"affectedAttribute\"\": \"\"${simItems[i].tags.reactionAttribute}\"\", \"\"effect\"\": \"\"${simItems[i].tags.reactionEffect}\"\", \"\"value\"\": ${simItems[i].tags.reactionValue}, \"\"roles\"\": [${roles}], \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"triggers\"\": [${triggers}], \"\"triggerFilter\"\": [${triggerFilter}], \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    }\r\n    //SIM ACTION\r\n    else if (simItems[i].tags.simAction == true) {\r\n        let triggers = ``;\r\n        let triggerFilter = ``;\r\n        let roles = ``;\r\n        let groups = ``;\r\n\r\n        for (let a = 0; a < simItems[i].tags.actionTriggers?.length; ++a) {\r\n            triggers += `\"\"${simItems[i].tags.actionTriggers[a]}\"\", `;\r\n        }\r\n        triggers = triggers.slice(0, -2);\r\n        \r\n        for (let b = 0; b < simItems[i].tags.actionTriggerFilter?.length; ++b) {\r\n            triggerFilter += `\"\"${simItems[i].tags.actionTriggerFilter[b]}\"\", `;\r\n        }\r\n        triggerFilter = triggerFilter.slice(0, -2);\r\n\r\n        for (let e = 0; e < simItems[i].tags.roleTags?.length; ++e) {\r\n            roles += `\"\"${simItems[i].tags.roleTags[e]}\"\", `;\r\n        }\r\n        roles = roles.slice(0, -2);\r\n\r\n        for (let f = 0; f < simItems[i].tags.groupTags?.length; ++f) {\r\n            groups += `\"\"${simItems[i].tags.groupTags[f]}\"\", `;\r\n        }\r\n        groups = groups.slice(0, -2);\r\n\r\n        newLine = `\\nSIM_ACTION,\"{\"\"label\"\": \"\"${simItems[i].tags.label}\"\", \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"triggers\"\": [${triggers}], \"\"triggerFilter\"\": [${triggerFilter}], \"\"roles\"\": [${roles}], \"\"startingAction\"\": ${simItems[i].tags.startingAction ?? false}, \"\"groups\"\": [${groups}], \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    }\r\n\r\n    csvString += newLine;\r\n\r\n}\r\n\r\ncsvString += `\\n\"\"`;\r\n\r\nos.setClipboard(csvString);\r\nos.toast(\"copied to clipboard\");","labelPosition":"floatingBillboard","labelWordWrapMode":"breakWords","labelSize":"2","labelFontSize":"1","generateFromCamera":"@const photo = await os.capturePhoto();\r\nif (!photo)\r\n{\r\n    return;\r\n}\r\n\r\nconfigBot.tags.menuPortal = \"simWizardLoading\";\r\nconst loadingBar = ab.links.menu.abCreateMenuBusyIndicator({\r\n    label: \"parsing photo\",\r\n    simWizardLoading: true\r\n});\r\n\r\nconst response = await ai.chat({\r\n    role: 'user',\r\n    content: [\r\n        {\r\n            text: `Please generate a detailed \"description\" of what is in the captured image, following these rules:\r\n                a. Do not use any special characters or asteriks.\r\n                b. Make it a clear concise prompt.\r\n                c. keep in mind this prompt is for generating a simulation, so pay attention to people, places, and objects in the space.\r\n            \r\n            Not following the above rules could hurt or break the experience.\r\n            `\r\n        },\r\n        {\r\n            base64: bytes.toBase64String(new Uint8Array(await photo.data.arrayBuffer())),\r\n            mimeType: photo.data.type,\r\n        }\r\n    ]\r\n}, \r\n{\r\n    preferredModel: abPersonality.tags.abPreferredAIModel\r\n});\r\n\r\ndestroy(loadingBar);\r\n\r\nlet promptResponse = response.content;\r\n\r\nconsole.log(\"PROMPT: \"+promptResponse);\r\n\r\nif (promptResponse) {\r\n    thisBot.generateFromPrompt(promptResponse);\r\n} else {\r\n    os.toast(\"Invalid AI response\");\r\n}","destroyAfterUse":"true","provideReceipt":"@const receiptBot = create({\r\n    abIgnore: true,\r\n    prompt: tags.userPrompt,\r\n    rawResponse: that.raw,\r\n    parsedResponse: that.parsed,\r\n    system: \"sim_toolbox.simReceipt\",\r\n    onClick: `@\r\n        configBot.tags.tagPortal = getID(thisBot) + \".parsedResponse\"; \r\n    `,\r\n    blueprint: true,\r\n    blueprintX: -13,\r\n    blueprintY: -25,\r\n    label: 'sim receipt',\r\n    labelColor: 'black',\r\n    scaleX: 2,\r\n    scaleY: 4,\r\n    scaleZ: 0.1,\r\n    labelWordWrapMode: 'breakWords',\r\n    creator: null,\r\n    onCreate: `@await os.sleep(500);\r\n    tags.labelColor = 'black';`\r\n});","test":"\"\"csv\r\ntype,configuration\r\nSIM_ACTION,\"{\"\"label\"\": \"\"Run cold test\"\", \"\"simID\"\": \"\"cold_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  15}}\"\r\nSIM_PLACE,\"{\"\"prompt\"\": \"\"A medical examination room with equipment and seating\"\", \"\"name\"\": \"\"Exam Room\"\", \"\"simID\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": -11, \"\"y\"\": 4}}\"\r\nSIM_ROLE,\"{\"\"name\"\": \"\"Doctor\"\", \"\"attributes\"\": {\"\"knowledge\"\": 100}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"examroom\"\", \"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 5}}\"\r\nSIM_PROP_REACTION,\"{\"\"simID\"\": \"\"click_cart\"\", \"\"reactionType\"\": \"\"onClick\"\", \"\"roles\"\": [\"\"Doctor\"\"], \"\"props\"\": [\"\"med_cart\"\"], \"\"location\"\": {\"\"x\"\": 14, \"\"y\"\":  5}}\"\r\nSIM_ACTION,\"{\"\"label\"\": \"\"Run Flu test\"\", \"\"simID\"\": \"\"flu_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  10}}\"\r\nSIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 15, \"\"y\"\": 5}}\"\r\nSIM_ACTION,\"{\"\"label\"\": \"\"Greet patient\"\", \"\"simID\"\": \"\"greet\"\", \"\"triggers\"\": [], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": true, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 21, \"\"y\"\":  -2}}\"\r\nSIM_ACTION,\"{\"\"label\"\": \"\"Describe symptoms\"\", \"\"simID\"\": \"\"symptoms\"\", \"\"triggers\"\": [\"\"greet\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Patient\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 28, \"\"y\"\":  -2}}\"\r\nSIM_ACTION,\"{\"\"label\"\": \"\"Diagnose flu\"\", \"\"simID\"\": \"\"diagnose\"\", \"\"triggers\"\": [\"\"check_results\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 50, \"\"y\"\":  12}}\"\r\nSIM_PROP_ACTION,\"{\"\"label\"\": \"\"click on the medical cart\"\", \"\"simID\"\": \"\"click_med_cart_prop_action\"\", \"\"triggers\"\": [\"\"symptoms\"\"], \"\"triggerFilter\"\": [], \"\"hideTriggers\"\": [\"\"click_cart\"\"], \"\"completionTriggers\"\": [\"\"tests_complete_smart_reaction\"\"], \"\"roles\"\": [], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 36, \"\"y\"\":  -2}}\"\r\nSIM_ACTION,\"{\"\"label\"\": \"\"Patient diagnosed\"\", \"\"simID\"\": \"\"diagnosed_reaction\"\", \"\"triggers\"\": [\"\"diagnose\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Patient\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 54, \"\"y\"\":  12}}\"\r\nSIM_ROLE,\"{\"\"name\"\": \"\"Patient\"\", \"\"attributes\"\": {\"\"health\"\": 50,\"\"has_flu\"\": 1,\"\"diagnosed\"\": 0}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"examroom\"\", \"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 10}}\"\r\nSIM_PROP,\"{\"\"name\"\": \"\"Medical Cart\"\", \"\"trackedAttribute\"\": \"\"tests_completed\"\", \"\"lowestValue\"\": 0, \"\"highestValue\"\": 3, \"\"attributes\"\": {\"\"tests_completed\"\": 0}, \"\"place\"\": \"\"examroom\"\", \"\"simID\"\": \"\"med_cart\"\", \"\"location\"\": {\"\"x\"\": 9, \"\"y\"\":  5}}\"\r\nSIM_ACTION,\"{\"\"label\"\": \"\"Run Strep test\"\", \"\"simID\"\": \"\"strep_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  5}}\"\r\nSIM_SMART_REACTION,\"{\"\"label\"\": \"\"tests completed\"\", \"\"simID\"\": \"\"tests_complete_smart_reaction\"\", \"\"triggers\"\": [\"\"strep_test\"\", \"\"flu_test\"\", \"\"cold_test\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 42, \"\"y\"\":  12}, \"\"useQueue\"\": false, \"\"orderMatters\"\": false, \"\"sequentialMatters\"\": false}\"\r\nSIM_ACTION,\"{\"\"label\"\": \"\"Check results\"\", \"\"simID\"\": \"\"check_results\"\", \"\"triggers\"\": [\"\"tests_complete_smart_reaction\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 46, \"\"y\"\":  12}}\"\r\nSIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 15, \"\"y\"\": 0}}\"\r\n\"\""}}}}