{"version":1,"state":{"19815088-76bd-45cb-bd6d-a0f669f93d2f":{"id":"19815088-76bd-45cb-bd6d-a0f669f93d2f","space":"shared","tags":{"system":"sim_toolbox.tools.simWizard","onABArtifactCollectShards":"@const shard: ABArtifactShard = {\r\n    data: {\r\n        label: tags.label,\r\n        dimensionData: {\r\n            dimension: ab.links.remember.tags.abActiveDimension,\r\n            [ab.links.remember.tags.abActiveDimension]: tags[ab.links.remember.tags.abActiveDimension],\r\n            [ab.links.remember.tags.abActiveDimension + 'X']: tags[ab.links.remember.tags.abActiveDimension + 'X'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Y']: tags[ab.links.remember.tags.abActiveDimension + 'Y'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Z']: tags[ab.links.remember.tags.abActiveDimension + 'Z'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationX']: tags[ab.links.remember.tags.abActiveDimension + 'RotationX'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationY']: tags[ab.links.remember.tags.abActiveDimension + 'RotationY'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationZ']: tags[ab.links.remember.tags.abActiveDimension + 'RotationZ'],\r\n        },\r\n        color: tags.color,\r\n        labelFloatingBackgroundColor: tags.labelFloatingBackgroundColor,\r\n        labelColor: tags.labelColor,\r\n        simID: tags.simID\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'simWizard'\r\n        }\r\n    ]\r\n}\r\n\r\nreturn shard;","onABArtifactReconstitute":"@const data = that.data;\r\ntags.label = data.label ?? 'sim wizard';\r\ntags.color = data.color ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD';\r\ntags.labelFloatingBackgroundColor = data.labelFloatingBackgroundColor ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD'; \r\ntags.labelColor = data.labelColor ?? 'white';\r\ntags.simID = data.simID ?? uuid();\r\n\r\n//Place bot correctly\r\nif (data.dimensionData) {\r\n    for (const tagName in data.dimensionData) {\r\n        tags[tagName] = data.dimensionData[tagName];\r\n    }\r\n}\r\n\r\n//If new action\r\nif (data.eggParameters) {\r\n    const dimension = data.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = data.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = data.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags.dimension = dimension;\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n\r\n    thisBot.onClick();\r\n}\r\n\r\nif (!ab.links.console.masks.open) {\r\n    whisper(ab.links.console, \"showConsole\");\r\n    ab.links.console.masks.open = true;\r\n}","onABStripArtifactInstanceDataFromBotData":"@const { data } = that;\r\n\r\ndelete data.tags.label;\r\ndelete data.tags.labelColor;\r\ndelete data.tags.labelFloatingBackgroundColor;\r\ndelete data.tags.color;\r\ndelete data.tags[data.tags.dimension + \"X\"];\r\ndelete data.tags[data.tags.dimension + \"Y\"];\r\ndelete data.tags[data.tags.dimension + \"Z\"];\r\ndelete data.tags[data.tags.dimension + \"RotationX\"];\r\ndelete data.tags[data.tags.dimension + \"RotationY\"];\r\ndelete data.tags[data.tags.dimension + \"RotationZ\"];\r\ndelete data.tags[data.tags.dimension];\r\ndelete data.tags.dimension;\r\ndelete data.tags.simID;\r\ndelete data.tags.wizardPrompt;","onClick":"@if (that) {\r\n    if (that.modality == 'mouse' && that.buttonId == 'right') {\r\n        return;\r\n    }\r\n}\r\n\r\nshout('abMenuRefresh');\r\nshout(\"clearSimWizardMenu\");\r\n\r\nconfigBot.tags.menuPortal = 'simWizard_menu';\r\n\r\nconst menuOptions = {\r\n    simWizard_menu: true,\r\n    clearSimWizardMenu: `@destroy(thisBot);`,\r\n    abMenuRefresh: \"@ destroy(thisBot);\",\r\n    wizard: getLink(thisBot)\r\n}\r\n\r\nconst promptButton = {\r\n    ...menuOptions,\r\n    label: 'submit prompt',\r\n    simWizard_menuSortOrder: 1,\r\n    formAddress: 'edit',\r\n    onSubmit: `@\r\n        masks.menuItemText = null;\r\n        links.wizard.tags.wizardPrompt = that.text;\r\n        links.wizard.generatePrompt(that.text);\r\n    `\r\n}\r\n\r\nconst detailedPromptButton = {\r\n    ...menuOptions,\r\n    label: 'submit detailed prompt',\r\n    simWizard_menuSortOrder: 2,\r\n    formAddress: 'edit',\r\n    onSubmit: `@\r\n        masks.menuItemText = null;\r\n        links.wizard.tags.wizardPrompt = that.text;\r\n        links.wizard.generateFromPrompt(that.text);\r\n    `\r\n}\r\n\r\nconst csvButton = {\r\n    ...menuOptions,\r\n    label: 'upload csv',\r\n    formAddress: 'upload',\r\n    simWizard_menuSortOrder: 4,\r\n    onClick: `@\r\n        const files = await os.showUploadFiles(); \r\n        if (files) {\r\n            links.wizard.generateFromCSV(files[0]);\r\n        } \r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nconst downloadButton = {\r\n    ...menuOptions,\r\n    label: 'download simulation',\r\n    formAddress: 'download',\r\n    simWizard_menuSortOrder: 5,\r\n    onClick: `@\r\n        links.wizard.downloadSim();\r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nconst cameraButton = {\r\n    ...menuOptions,\r\n    label: 'use camera to generate sim',\r\n    formAddress: 'photo_camera',\r\n    simWizard_menuSortOrder: 3,\r\n    onClick: `@\r\n        links.wizard.generateFromCamera();\r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nab.links.menu.abCreateMenuInput(promptButton);\r\nab.links.menu.abCreateMenuInput(detailedPromptButton);\r\nab.links.menu.abCreateMenuButton(csvButton);\r\nab.links.menu.abCreateMenuButton(downloadButton);\r\nab.links.menu.abCreateMenuButton(cameraButton);\r\n","abIDOrigin":"simWizard","onBotAdded":"@let waitTime = 0;\r\n\r\nwhile(!globalThis.ab?.links.bot_factory) {\r\n    if (waitTime >= 5000) {\r\n        return;\r\n    }\r\n    \r\n    await os.sleep(250);\r\n    waitTime += 250;\r\n}\r\n\r\nmasks.ready = true;","onGridClick":"@shout(\"clearSimWizardMenu\");","strokeColor":"white","cursor":"pointer","scaleZ":"2","onABOpenMenu":"@if (that.menuType != 'abBotMenu' || ab.links.remember.links.abBotFocus != thisBot) {\r\n    return;\r\n}\r\n\r\nconst menuOptions = {\r\n    abMenuRefresh: `@destroy(thisBot);`,\r\n    abMenu: true,\r\n    action: getLink(thisBot)\r\n}\r\n\r\nreturn;","abArtifactName":"simWizard","generateFromPrompt":"@const prompt = that;\ntags.userPrompt = that;\n\nif (!prompt) {\n    return;\n}\n\nconfigBot.tags.menuPortal = \"simWizardLoading\";\nconst loadingBar = ab.links.menu.abCreateMenuBusyIndicator({\n    label: \"thinking\",\n    simWizardLoading: true\n});\n\nconst basePrompt = tags.oldPrompt;\nconst aiChatMessages: AIChatMessage[] = [];\n\naiChatMessages.push({\n    role: 'system',\n    content: [\n        { text: basePrompt }\n    ]\n})\n\naiChatMessages.push({\n    role: 'assistant',\n    content: [\n        { text: 'hello world'}\n    ]\n})\n\naiChatMessages.push({\n    role: 'user',\n    content: [\n        { text: 'prompt: ' + prompt}\n    ]\n})\n\nconst aiChatOptions: AIChatOptions = { \n    preferredModel: ab.links.personality.tags.abPreferredAIModel\n}\n\ntry {\n    const response = await ai.chat(aiChatMessages, aiChatOptions);\n    console.log(response);\n    if (response) {\n        thisBot.generateFromCSV(response.content);\n    }  \n} catch (e) {\n    os.toast(\"Error generating sim. Please try again\", 8);\n    console.log(\"Error generating sim. Please try again\", e);\n    destroy(loadingBar);\n}\n\nif (loadingBar) {\n    destroy(loadingBar);\n}","generateFromCSV":"@const csvData = that;\r\n\r\nlet cleanedCSV = csvData?.replaceAll('`', '');\r\nif (cleanedCSV.indexOf('csv') == 0) {\r\n    cleanedCSV = cleanedCSV.replace('csv', '');\r\n}\r\n\r\nconst lines = cleanedCSV.split('\\n');\r\nconst result = [];\r\n\r\nfor (let i = 1; i < lines.length; i++) {\r\n    const obj = {};\r\n    const currentline = lines[i].split(',');\r\n\r\n    let simType = currentline[0];\r\n    let config = currentline?.slice(1)?.join(',')?.trim() ?? \"{}\";\r\n    if (config[0] == '\"') {\r\n        config = config.slice(1);\r\n    }\r\n    if (config[config.length - 1] == '\"') {\r\n        config = config.slice(0, -1);\r\n    }\r\n\r\n    if (simType == 'type' || !config) {\r\n        continue;\r\n    }\r\n\r\n    obj['type'] = simType;\r\n    obj['configuration'] = JSON.parse(config.replaceAll('\"\"', '\"'));\r\n\r\n    result.push(obj);\r\n}\r\n\r\nconst jsonString = JSON.stringify(result, null, 2);\r\nconst jsonData = JSON.parse(jsonString);\r\n\r\nthisBot.provideReceipt({raw: csvData, parsed: jsonData});\r\n\r\nlet numPlayers = 1;\r\n\r\nconfigBot.tags.gridPortal = 'blueprint';\r\n\r\nfor (const item of jsonData) {\r\n    if (item[\"type\"]) {\r\n        const xVal = Math.floor(Math.random() * (15 - (-15) + 1)) + (-15);\r\n        const yVal = Math.floor(Math.random() * (15 - (-15) + 1)) + (-15);\r\n        let dimensionName = ab.links.remember.tags.currentDimension ?? 'blueprint';\r\n\r\n        //SIM ROLE\r\n        if (item[\"type\"] == 'SIM_ROLE') {\r\n            const conData = item[\"configuration\"];\r\n            let chosenPlaceName = conData.place.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            chosenPlaceName = chosenPlaceName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.name,\r\n                        simAttributes: conData.attributes,\r\n                        roleLocked: true,\r\n                        roleName: conData.name,\r\n                        numUsers: conData.numUsers,\r\n                        defaultPlace: chosenPlaceName,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simRole'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simRole',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n\r\n        } \r\n        //SIM ACTION\r\n        else if (item[\"type\"] == 'SIM_ACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        roleTags: conData.roles,\r\n                        startingAction: conData.startingAction,\r\n                        groupTags: conData.groups,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simAction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simAction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM DIRECTIVE\r\n        else if (item[\"type\"] == 'SIM_PROP_ACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        roleTags: conData.roles,\r\n                        startingAction: conData.startingAction,\r\n                        groupTags: conData.groups,\r\n                        completionTriggers: conData.completionTriggers,\r\n                        hideTriggers: conData.hideTriggers,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simPropAction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simPropAction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM REACTION\r\n        else if (item[\"type\"] == 'SIM_REACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        reactionAttribute: conData.affectedAttribute,\r\n                        reactionEffect: conData.effect,\r\n                        reactionValue: conData.value,\r\n                        roleTags: conData.roles,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simReaction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simReaction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM PLACE\r\n        else if (item[\"type\"] == 'SIM_PLACE') {\r\n            const conData = item[\"configuration\"];\r\n            let chosenDimensionName = conData.simID.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            chosenDimensionName = chosenDimensionName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.name,\r\n                        placePrompt: conData.prompt,\r\n                        simID: conData.simID,\r\n                        chosenDimension: chosenDimensionName,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simPlace'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simPlace',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM DOOR\r\n        else if (item[\"type\"] == 'SIM_DOOR') {\r\n            const conData = item[\"configuration\"];\r\n            dimensionName = conData.place.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            dimensionName = dimensionName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        destination: conData.destination,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simDoor'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simDoor',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM PROP\r\n        else if (item[\"type\"] == 'SIM_PROP') {\r\n            const conData = item[\"configuration\"];\r\n            dimensionName = conData.place?.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            dimensionName = dimensionName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.name,\r\n                        simID: conData.simID,\r\n                        roleName: conData.name,\r\n                        simAttributes: conData.attributes,\r\n                        trackedStat: conData.trackedAttribute,\r\n                        trackedStatStartingValue: conData.lowestValue,\r\n                        trackedStatEndingValue: conData.highestValue,\r\n                        destination: conData.destination,\r\n                        autoGenerateReactions: false,\r\n                        propLocked: true,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simProp'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simProp',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        }\r\n    \r\n        //SIM PLAYER\r\n        else if (item[\"type\"] == 'SIM_PLAYER') {\r\n            const conData = item[\"configuration\"];\r\n            dimensionName = conData.place?.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            dimensionName = dimensionName.toLowerCase();\r\n            const playerLabel = 'P' + numPlayers;\r\n            numPlayers += 1;\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: playerLabel,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simPlayer'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simPlayer',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        }\r\n        //SIM SCENE REACTION\r\n        else if (item[\"type\"] == 'SIM_PROP_REACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        simID: conData.simID,\r\n                        label: conData.reactionType,\r\n                        propReactionType: conData.reactionType,\r\n                        roleTags: conData.roles,\r\n                        actionTriggers: conData.props,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simPropReaction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simPropReaction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        }\r\n        //SIM SMART REACTION\r\n        else if (item[\"type\"] == 'SIM_SMART_REACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        checkQueue: conData.useQueue,\r\n                        orderMatters: conData.orderMatters,\r\n                        sequentialMatters: conData.sequentialMatters,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simSmartReaction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simSmartReaction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n    }\r\n}\r\n\r\nconst homePlace = getBot(byTag(\"simPlace\", true), byTag(\"chosenDimension\", \"home\"));\r\n\r\nif (!homePlace) {\r\n    //create home place\r\n    let chosenDimensionName = 'home';\r\n    const abArtifactShard = {\r\n        data: {\r\n            config: {\r\n                label: 'home',\r\n                formAddress: 'https://images.blockadelabs.com/images/imagine/M3_Low-Poly_Render_equirectangular-jpg_a_lobby_of_a_1535619319_14882626.jpg?ver=1',\r\n                simID: uuid(),\r\n                chosenDimension: chosenDimensionName,\r\n                dimensionData: {\r\n                    dimension: 'blueprint',\r\n                    ['blueprint']: true,\r\n                    ['blueprint' + 'X']: -7,\r\n                    ['blueprint' + 'Y']: -26\r\n                }\r\n            }\r\n        },\r\n        dependencies: [\r\n            {\r\n                askID: 'simPlace'\r\n            }\r\n        ]\r\n    };\r\n    ab.links.artifact.abCreateArtifactPromiseBot({\r\n        abArtifactName: 'simPlace',\r\n        abArtifactInstanceID: uuid(),\r\n        abArtifactShard,\r\n    });\r\n}\r\n\r\nif (tags.destroyAfterUse) {\r\n    destroy(thisBot);\r\n}","downloadSim":"@const simItems = getBots(\"simID\");\r\n\r\nlet csvString = `\"\"csv\r\ntype,configuration`\r\n\r\nfor (let i = 0; i < simItems.length; ++i) {\r\n    let newLine;\r\n    //SIM PLACE\r\n    if (simItems[i].tags.simPlace == true) {\r\n        if (simItems[i].tags.label == 'home') {\r\n            continue;\r\n        }\r\n        newLine = `\\nSIM_PLACE,\"{\"\"prompt\"\": \"\"${simItems[i].tags.placePrompt ?? 'none'}\"\", \"\"name\"\": \"\"${simItems[i].tags.label}\"\", \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    } \r\n    //SIM ROLE\r\n    else if (simItems[i].tags.simRole == true) {\r\n        let attString = ``;\r\n        for (const att in simItems[i].tags.simAttributes) {\r\n            attString += `\"\"${att}\"\": ${simItems[i].tags.simAttributes[att]},`\r\n        }\r\n        attString = attString.slice(0, -1);\r\n        newLine = `\\nSIM_ROLE,\"{\"\"name\"\": \"\"${simItems[i].tags.label}\"\", \"\"attributes\"\": {${attString}}, \"\"numUsers\"\": ${simItems[i].tags.numUsers}, \"\"place\"\": \"\"${simItems[i].tags.defaultPlace}\"\", \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    }\r\n    //SIM PROP\r\n    else if (simItems[i].tags.simProp == true) {\r\n        let attString = ``;\r\n        for (const att in simItems[i].tags.simAttributesStartingValues) {\r\n            attString += `\"\"${att}\"\": ${simItems[i].tags.simAttributesStartingValues[att]},`\r\n        }\r\n        attString = attString.slice(0, -1);\r\n        newLine = `\\nSIM_PROP,\"{\"\"name\"\": \"\"${simItems[i].tags.label}\"\", \"\"trackedAttribute\"\": \"\"${simItems[i].tags.trackedStat}\"\", \"\"lowestValue\"\": ${simItems[i].tags.trackedStatStartingValue}, \"\"highestValue\"\": ${simItems[i].tags.trackedStatEndingValue}, \"\"attributes\"\": {${attString}}, \"\"place\"\": \"\"${simItems[i].tags.dimension}\"\", \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    } \r\n    //SIM PLAYER\r\n    else if (simItems[i].tags.simPlayer == true) {\r\n        newLine = `\\nSIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    } \r\n    //SIM PROP ACTION\r\n    else if (simItems[i].tags.simPropAction == true) {\r\n        let triggers = ``;\r\n        let triggerFilter = ``;\r\n        let hideTriggers = ``;\r\n        let completionTriggers = ``;\r\n        let roles = ``;\r\n        let groups = ``;\r\n\r\n        for (let a = 0; a < simItems[i].tags.actionTriggers?.length; ++a) {\r\n            triggers += `\"\"${simItems[i].tags.actionTriggers[a]}\"\", `;\r\n        }\r\n        triggers = triggers.slice(0, -2);\r\n        \r\n        for (let b = 0; b < simItems[i].tags.actionTriggerFilter?.length; ++b) {\r\n            triggerFilter += `\"\"${simItems[i].tags.actionTriggerFilter[b]}\"\", `;\r\n        }\r\n        triggerFilter = triggerFilter.slice(0, -2);\r\n\r\n        for (let c = 0; c < simItems[i].tags.hideTriggers?.length; ++c) {\r\n            hideTriggers += `\"\"${simItems[i].tags.hideTriggers[c]}\"\", `;\r\n        }\r\n        hideTriggers = hideTriggers.slice(0, -2);\r\n\r\n        for (let d = 0; d < simItems[i].tags.completionTriggers?.length; ++d) {\r\n            completionTriggers += `\"\"${simItems[i].tags.completionTriggers[d]}\"\", `;\r\n        }\r\n        completionTriggers = completionTriggers.slice(0, -2);\r\n\r\n        for (let e = 0; e < simItems[i].tags.roleTags?.length; ++e) {\r\n            roles += `\"\"${simItems[i].tags.roleTags[e]}\"\", `;\r\n        }\r\n        roles = roles.slice(0, -2);\r\n\r\n        for (let f = 0; f < simItems[i].tags.groupTags?.length; ++f) {\r\n            groups += `\"\"${simItems[i].tags.groupTags[f]}\"\", `;\r\n        }\r\n        groups = groups.slice(0, -2);\r\n\r\n        newLine = `\\nSIM_PROP_ACTION,\"{\"\"label\"\": \"\"${simItems[i].tags.label}\"\", \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"triggers\"\": [${triggers}], \"\"triggerFilter\"\": [${triggerFilter}], \"\"hideTriggers\"\": [${hideTriggers}], \"\"completionTriggers\"\": [${completionTriggers}], \"\"roles\"\": [${roles}], \"\"startingAction\"\": ${simItems[i].tags.startingAction ?? false}, \"\"groups\"\": [${groups}], \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    } \r\n    //SIM SMART REACTION\r\n    else if (simItems[i].tags.simSmartReaction == true) {\r\n        let triggers = ``;\r\n        let triggerFilter = ``;\r\n\r\n        for (let a = 0; a < simItems[i].tags.actionTriggers?.length; ++a) {\r\n            triggers += `\"\"${simItems[i].tags.actionTriggers[a]}\"\", `;\r\n        }\r\n        triggers = triggers.slice(0, -2);\r\n\r\n        for (let b = 0; b < simItems[i].tags.actionTriggerFilter?.length; ++b) {\r\n            triggerFilter += `\"\"${simItems[i].tags.actionTriggerFilter[b]}\"\", `;\r\n        }\r\n        triggerFilter = triggerFilter.slice(0, -2);\r\n\r\n        newLine = `\\nSIM_SMART_REACTION,\"{\"\"label\"\": \"\"${simItems[i].tags.label}\"\", \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"triggers\"\": [${triggers}], \"\"triggerFilter\"\": [${triggerFilter}], \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}, \"\"useQueue\"\": ${simItems[i].tags.checkQueue}, \"\"orderMatters\"\": ${simItems[i].tags.orderMatters}, \"\"sequentialMatters\"\": ${simItems[i].tags.sequentialMatters}}\"`;\r\n    } \r\n    //SIM PROP REACTION\r\n    else if (simItems[i].tags.simPropReaction == true) {\r\n        let triggers = ``;\r\n        let roles = ``;\r\n\r\n        for (let a = 0; a < simItems[i].tags.actionTriggers?.length; ++a) {\r\n            triggers += `\"\"${simItems[i].tags.actionTriggers[a]}\"\", `;\r\n        }\r\n        triggers = triggers.slice(0, -2);\r\n\r\n        for (let e = 0; e < simItems[i].tags.roleTags?.length; ++e) {\r\n            roles += `\"\"${simItems[i].tags.roleTags[e]}\"\", `;\r\n        }\r\n        roles = roles.slice(0, -2);\r\n\r\n        newLine = `\\nSIM_PROP_REACTION,\"{\"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"reactionType\"\": \"\"${simItems[i].tags.propReactionType}\"\", \"\"roles\"\": [${roles}], \"\"props\"\": [${triggers}], \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    } \r\n    //SIM REACTION\r\n    else if (simItems[i].tags.simReaction == true) {\r\n        let roles = ``;\r\n        let triggers = ``;\r\n        let triggerFilter = ``;\r\n\r\n        for (let a = 0; a < simItems[i].tags.actionTriggers?.length; ++a) {\r\n            triggers += `\"\"${simItems[i].tags.actionTriggers[a]}\"\", `;\r\n        }\r\n        triggers = triggers.slice(0, -2);\r\n\r\n        for (let b = 0; b < simItems[i].tags.actionTriggerFilter?.length; ++b) {\r\n            triggerFilter += `\"\"${simItems[i].tags.actionTriggerFilter[b]}\"\", `;\r\n        }\r\n        triggerFilter = triggerFilter.slice(0, -2);\r\n\r\n        for (let e = 0; e < simItems[i].tags.roleTags?.length; ++e) {\r\n            roles += `\"\"${simItems[i].tags.roleTags[e]}\"\", `;\r\n        }\r\n        roles = roles.slice(0, -2);\r\n\r\n        newLine = `\\nSIM_REACTION,\"{\"\"label\"\": \"\"${simItems[i].tags.label}\"\", \"\"affectedAttribute\"\": \"\"${simItems[i].tags.reactionAttribute}\"\", \"\"effect\"\": \"\"${simItems[i].tags.reactionEffect}\"\", \"\"value\"\": ${simItems[i].tags.reactionValue}, \"\"roles\"\": [${roles}], \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"triggers\"\": [${triggers}], \"\"triggerFilter\"\": [${triggerFilter}], \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    }\r\n    //SIM ACTION\r\n    else if (simItems[i].tags.simAction == true) {\r\n        let triggers = ``;\r\n        let triggerFilter = ``;\r\n        let roles = ``;\r\n        let groups = ``;\r\n\r\n        for (let a = 0; a < simItems[i].tags.actionTriggers?.length; ++a) {\r\n            triggers += `\"\"${simItems[i].tags.actionTriggers[a]}\"\", `;\r\n        }\r\n        triggers = triggers.slice(0, -2);\r\n        \r\n        for (let b = 0; b < simItems[i].tags.actionTriggerFilter?.length; ++b) {\r\n            triggerFilter += `\"\"${simItems[i].tags.actionTriggerFilter[b]}\"\", `;\r\n        }\r\n        triggerFilter = triggerFilter.slice(0, -2);\r\n\r\n        for (let e = 0; e < simItems[i].tags.roleTags?.length; ++e) {\r\n            roles += `\"\"${simItems[i].tags.roleTags[e]}\"\", `;\r\n        }\r\n        roles = roles.slice(0, -2);\r\n\r\n        for (let f = 0; f < simItems[i].tags.groupTags?.length; ++f) {\r\n            groups += `\"\"${simItems[i].tags.groupTags[f]}\"\", `;\r\n        }\r\n        groups = groups.slice(0, -2);\r\n\r\n        newLine = `\\nSIM_ACTION,\"{\"\"label\"\": \"\"${simItems[i].tags.label}\"\", \"\"simID\"\": \"\"${simItems[i].tags.simID}\"\", \"\"triggers\"\": [${triggers}], \"\"triggerFilter\"\": [${triggerFilter}], \"\"roles\"\": [${roles}], \"\"startingAction\"\": ${simItems[i].tags.startingAction ?? false}, \"\"groups\"\": [${groups}], \"\"location\"\": {\"\"x\"\": ${simItems[i].tags[simItems[i].tags.dimension + 'X']}, \"\"y\"\":  ${simItems[i].tags[simItems[i].tags.dimension + 'Y']}}}\"`;\r\n    }\r\n\r\n    csvString += newLine;\r\n\r\n}\r\n\r\ncsvString += `\\n\"\"`;\r\n\r\nos.setClipboard(csvString);\r\nos.toast(\"copied to clipboard\");","labelPosition":"floatingBillboard","labelWordWrapMode":"breakWords","labelSize":"2","labelFontSize":"1","generateFromCamera":"@const inXR = configBot.tags.arEnabled || configBot.tags.vrEnabled;\r\n\r\nif (inXR) {\r\n    thisBot.onCaptureClick();\r\n    return;\r\n}\r\n\r\nconst photo = await os.capturePhoto();\r\nif (!photo)\r\n{\r\n    return;\r\n}\r\n\r\nthisBot.parsePhoto(photo);","destroyAfterUse":"true","provideReceipt":"@const receiptBot = create({\r\n    abIgnore: true,\r\n    originalPrompt: tags.originalPrompt ?? tags.userPrompt,\r\n    prompt: tags.userPrompt,\r\n    rawResponse: that.raw,\r\n    parsedResponse: that.parsed,\r\n    system: \"sim_toolbox.simReceipt\",\r\n    onClick: `@\r\n        configBot.tags.tagPortal = getID(thisBot) + \".parsedResponse\"; \r\n    `,\r\n    blueprint: true,\r\n    blueprintX: -13,\r\n    blueprintY: -25,\r\n    label: 'sim receipt',\r\n    labelColor: 'black',\r\n    scaleX: 2,\r\n    scaleY: 4,\r\n    scaleZ: 0.1,\r\n    labelWordWrapMode: 'breakWords',\r\n    creator: null,\r\n    onCreate: `@await os.sleep(500);\r\n    tags.labelColor = 'black';`\r\n});","onPhotoCameraOpened":"@const inXR = configBot.tags.arEnabled || configBot.tags.vrEnabled;\r\n\r\nif (!inXR) {\r\n    return;\r\n} \r\n\r\ntags.cameraState = 'opened';\r\n\r\nfor (let i = 0; i < tags.captureTimerSeconds; i++) {\r\n    os.sleep(i * 1000).then(() => {\r\n        if (tags.cameraState === 'opened') {\r\n            links.loadingBar?.tags.label = tags.captureTimerSeconds - i;\r\n            const soundURL = await ab.abBuildCasualCatalogURL(tags.beepSoundUrl);\r\n            if (soundURL) {\r\n                os.playSound(soundURL);\r\n            }\r\n        }\r\n    })\r\n}","onPhotoCameraClosed":"@const inXR = configBot.tags.arEnabled || configBot.tags.vrEnabled;\r\n\r\nif (!inXR) {\r\n    return;\r\n}\r\n\r\nif (tags.cameraState === 'opened') {\r\n    // User closed the photo camera early, thus canceling it.\r\n    destroy(links.loadingBar);\r\n}\r\n\r\ntags.cameraState = 'closed';","onPhotoCaptured":"@const inXR = configBot.tags.arEnabled || configBot.tags.vrEnabled;\r\n\r\nif (!inXR) {\r\n    return;\r\n}\r\n\r\nconst { photo } = that;\r\n\r\ntags.cameraState = 'captured';\r\n\r\nif (tags.shutterSoundUrl) {\r\n    const soundURL = await ab.abBuildCasualCatalogURL(tags.shutterSoundUrl);\r\n    if (soundURL) {\r\n        os.playSound(soundURL);\r\n    }\r\n}\r\n\r\ndestroy(links.loadingBar);\r\n\r\nthisBot.parsePhoto(photo);","onCaptureClick":"@const inXR = configBot.tags.arEnabled || configBot.tags.vrEnabled;\r\n\r\nif (!inXR) {\r\n    return;\r\n}\r\n\r\nconfigBot.tags.menuPortal = \"simWizardLoading\";\r\nconst loadingBar = ab.links.menu.abCreateMenuBusyIndicator({\r\n    label: 'Starting camera...',\r\n    simWizardLoading: true\r\n});\r\n\r\ntags.loadingBar = getLink(loadingBar);\r\n        \r\nos.capturePhoto({\r\n    cameraType: 'auto',\r\n    imageFormat: 'png',\r\n    skipConfirm: true,\r\n    takePhotoAfterSeconds: tags.captureTimerSeconds,\r\n    idealResolution: { width: 1920, height: 1080 }\r\n})","captureTimerSeconds":"3","parsePhoto":"@configBot.tags.menuPortal = \"simWizardLoading\";\r\nconst loadingBar = ab.links.menu.abCreateMenuBusyIndicator({\r\n    label: \"parsing photo\",\r\n    simWizardLoading: true\r\n});\r\n\r\nconst response = await ai.chat({\r\n    role: 'user',\r\n    content: [\r\n        {\r\n            text: `Please generate a detailed \"description\" of what is in the captured image, following these rules:\r\n                a. Do not use any special characters or asteriks.\r\n                b. Make it a clear concise prompt.\r\n                c. keep in mind this prompt is for generating a simulation, so pay attention to people, places, and objects in the space.\r\n            \r\n            Not following the above rules could hurt or break the experience.\r\n            `\r\n        },\r\n        {\r\n            base64: bytes.toBase64String(new Uint8Array(await that.data.arrayBuffer())),\r\n            mimeType: that.data.type,\r\n        }\r\n    ]\r\n}, \r\n{\r\n    preferredModel: abPersonality.tags.abPreferredAIModel\r\n});\r\n\r\ndestroy(loadingBar);\r\n\r\nlet promptResponse = response.content;\r\n\r\nconsole.log(\"PROMPT: \"+promptResponse);\r\n\r\nif (promptResponse) {\r\n    thisBot.generateFromPrompt(promptResponse);\r\n} else {\r\n    os.toast(\"Invalid AI response\");\r\n}","shutterSoundUrl":"/asks/teleXR-assets/camera-shutter.mp3","beepSoundURL":"/asks/teleXR-assets/beep.mp3","oldPrompt":"ðŸ“„`You will be given a prompt for a simulation. You must return a csv with the simulation items that you decide should be created based on the content of the prompt. Your csv must have two fields: type and configuration. You must provide location information for each item you wish to create. Place these items with these rules in mind: \r\n    PLACEMENT RULES: \r\n        - place items in ways that make visual sense in a 3d world\r\n        - units are in feet, they should be integers\r\n        - leave space between items\r\n\r\n    You must answer quickly, less than 30 seconds. Favor speed over extra detail. If you do not answer within 30 seconds the program will fail.\r\n    a trigger_type can be an action or reaction or prop reaction or prop actions or smart reactions.\r\n    Always use a prop action when the user should click on a prop.\r\n    \r\n    Your options for simulation items are:\r\n        - SIM_ACTION: \r\n            description: an action for a user to take or complete. These will typically be in action/reaction chains, starting with a \"startingAction\" or a prop reaction (triggered by a user interacting with a prop), this chain is indicated using triggers.\r\n            configuration: {\r\n                label: the text that should appear on the action (keep it brief, less than 10 words)\r\n                simID: a unique id used to determine triggers\r\n                triggers: an array of trigger_types that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this action to be unlocked and able to follow a trigger.\r\n                roles: an array of the names of roles and/or the names of props (case sensitive, do NOT use simIDs) that this action should appear for (example: a 'doctor' role can 'check test results', but a 'patient' role cannot, a 'notepad' prop can be written in).  \r\n                startingAction: a true or false value representing whether or not this action is one of the first actions a user sees.\r\n                groups: an array of group ids. If two actions have the same group id only one action in the group can be completed.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_ROLE: \r\n            description: a role that a user can take on (example: doctor, patient).\r\n            configuration: {\r\n                name: the name of the role.\r\n                attributes: a json object of attribute name keys and attribute values.\r\n                numUsers: an integer number representing how many users can occupy this role at one time.\r\n                place: the simID of the sim place that a user should be sent to upon choosing this role.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_REACTION: \r\n            description: an effect that can happen in response to an action, that changes a stat of a chosen role or prop.\r\n            configuration: {\r\n                label: A brief description of the reaction (less than 5 words).\r\n                affectedAttribute: the attribute of a prop or role that should be affected.\r\n                effect: the way that the attribute is affected. This value can be +, -, or =.\r\n                value: The amount that the attribute should be changed by (example 2).\r\n                roles: an array of the names of roles and/or the names of props (case sensitive, do NOT use simIDs) that this reaction should affect (example: a patient role can have it's health attribute reduced).\r\n                simID: a unique id used to determine triggers.\r\n                triggers: an array of trigger_types that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this reaction to be unlocked and able to follow a trigger.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PROP:\r\n            description: a prop in the simulation that is not a player but has stats.\r\n            configuration: {\r\n                name: The name of the prop.\r\n                trackedAttribute: The main attribute that should be visually represented for this prop. This value can be left empty.\r\n                lowestValue: The lowest value allowed for the tracked attribute.\r\n                highestValue: The highest value allowed for the tracked attribute.\r\n                attributes: a json object of attribute name keys and attribute values, make sure the tracked attribute is included.\r\n                place: the simID of the place where this prop should be located.\r\n                simID: a unique id used to determine triggers.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PROP_ACTION: \r\n            description: a type of action, exactly like a sim action, except these are hidden by a prop reaction trigger and completed by the completion of different action, reaction, or prop reaction triggers. The hideTriggers and completionsTriggers should almost never be the same. CompletionTriggers are generally the trigger_types that follow the prop reaction that is in the hideTriggers. This is so that the user gets prompted to do this action again to complete all actions.\r\n            configuration: {\r\n                label: the text that should appear on the prop action (keep it brief, less than 10 words, EXAMPLE: \"click on the trash can\")\r\n                simID: a unique id used to determine triggers\r\n                triggers: an array of trigger_types that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this action to be unlocked and able to follow a trigger.\r\n                completionTriggers: an array of trigger_types that should cause this prop action to complete.\r\n                hideTriggers: an array of prop reactions that should cause this prop action to hide.\r\n                roles: an array of the names of roles (case sensitive, do NOT use simIDs) that this action should appear for (example: a 'Doctor' role can 'check test results', but a 'Patient' role cannot).  \r\n                startingAction: a true or false value representing whether or not this prop action is one of the first actions a user sees.\r\n                groups: an array of group ids. If two actions have the same group id only one action in the group can be completed.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PLACE:\r\n            description: a location in the simulation that a player can move to and items can be placed in.\r\n            configuration: {\r\n                prompt: A prompt describing the location that should be displayed.\r\n                name: the name of the location (keep it brief, less than 4 words).\r\n                simID: a unique id for sim doors and props to reference.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_DOOR: \r\n            description: a door that can be placed in a sim place that leads to a different sim place.\r\n            configuration: {\r\n                label: the name of the place that this door should lead to.\r\n                destination: the simID of the place that this door should lead to.\r\n                place: the simID of the place where this door should be located.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PROP_REACTION: \r\n            description: a trigger for other actions/reactions that is activated by a physical interaction with a prop. There are two possible types, onClick and onDrag\r\n            configuration: {\r\n                simID: a unique id used to determine triggers.\r\n                reactionType: can be either \"onClick\" or \"onDrag\"\r\n                roles: an array of the names of roles (case sensitive, no NOT use simIDs)  that this reaction should happen for (example: a janitor clicking on a trash can triggers new actions such as taking out the trash to appear).\r\n                props: an array of simIDs of props that this reaction will watch for user reactions. This cannot be an empty array.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PLAYER:\r\n            description: a player slot for a user to occupy, if no sim players are provided, users will not be able to accept a role. There should be the same number of simPlayers as the number of roles in most cases.\r\n            configuration: {\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n        \r\n        - SIM_SMART_REACTION: \r\n            description: a listener that watches for its triggers to be completed, or added to the queue of available actions, depending on the configuration.\r\n            configuration: {\r\n                label: A brief description of the reaction (less than 5 words).\r\n                simID: a unique id used to determine triggers.\r\n                triggers: an array of trigger_types that this action should listen for, no duplicates.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this reaction to be unlocked and able to follow a trigger.\r\n                useQueue: if true the smart reaction will look in the queue of available actions for its triggers, if false, it will look in the log of completed actions.\r\n                orderMatters: if true the triggers must be in order (example: triggers:[a, b, c], log: [a, b, d, c] would complete this smart action, log: [a, c, b] would not).\r\n                sequentialMatters: if true the triggers must not be interupted by a different action in the queue/log (example: triggers:[a, b, c], log: [a, b, d, c] would not complete this action, log: [a, c, b] would).\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n    EXAMPLE:\r\n        prompt: \"a patient who has the flu and a doctor who must run tests and diagnose them\"\r\n\r\n        response: \"\"csv\r\n            type,configuration\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Run cold test\"\", \"\"simID\"\": \"\"cold_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  15}}\"\r\n            SIM_PLACE,\"{\"\"prompt\"\": \"\"A medical examination room with equipment and seating\"\", \"\"name\"\": \"\"Exam Room\"\", \"\"simID\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": -11, \"\"y\"\": 4}}\"\r\n            SIM_ROLE,\"{\"\"name\"\": \"\"Doctor\"\", \"\"attributes\"\": {\"\"knowledge\"\": 100}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 5}}\"\r\n            SIM_PROP_REACTION,\"{\"\"simID\"\": \"\"click_cart\"\", \"\"reactionType\"\": \"\"onClick\"\", \"\"roles\"\": [\"\"Doctor\"\"], \"\"props\"\": [\"\"med_cart\"\"], \"\"location\"\": {\"\"x\"\": 14, \"\"y\"\":  5}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Run Flu test\"\", \"\"simID\"\": \"\"flu_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  10}}\"\r\n            SIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 15, \"\"y\"\": 5}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Greet patient\"\", \"\"simID\"\": \"\"greet\"\", \"\"triggers\"\": [], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": true, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 21, \"\"y\"\":  -2}}\"undefined\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Describe symptoms\"\", \"\"simID\"\": \"\"symptoms\"\", \"\"triggers\"\": [\"\"greet\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Patient\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 28, \"\"y\"\":  -2}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Diagnose flu\"\", \"\"simID\"\": \"\"diagnose\"\", \"\"triggers\"\": [\"\"check_results\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 50, \"\"y\"\":  12}}\"\r\n            SIM_PROP_ACTION,\"{\"\"label\"\": \"\"click on the medical cart\"\", \"\"simID\"\": \"\"click_med_cart_prop_action\"\", \"\"triggers\"\": [\"\"symptoms\"\"], \"\"triggerFilter\"\": [], \"\"hideTriggers\"\": [\"\"click_cart\"\"], \"\"completionTriggers\"\": [\"\"tests_complete_smart_reaction\"\"], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 36, \"\"y\"\":  -2}}\"\r\n            SIM_REACTION,\"{\"\"label\"\": \"\"Patient diagnosed\"\", \"\"affectedAttribute\"\": \"\"diagnosed\"\", \"\"effect\"\": \"\"=\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Patient\"\"], \"\"simID\"\": \"\"diagnosed_reaction\"\", \"\"triggers\"\": [\"\"diagnose\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 54, \"\"y\"\":  12}}\"\r\n            SIM_REACTION,\"{\"\"label\"\": \"\"Test Was Completed\"\", \"\"affectedAttribute\"\": \"\"tests_completed\"\", \"\"effect\"\": \"\"+\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Medical Cart\"\"], \"\"simID\"\": \"\"test_number_increase\"\", \"\"triggers\"\": [\"\"cold_test\"\", \"\"flu_test\"\", \"\"strep_test\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  20}}\"\r\n            SIM_ROLE,\"{\"\"name\"\": \"\"Patient\"\", \"\"attributes\"\": {\"\"health\"\": 50,\"\"has_flu\"\": 1,\"\"diagnosed\"\": 0}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 10}}\"\r\n            SIM_PROP,\"{\"\"name\"\": \"\"Medical Cart\"\", \"\"trackedAttribute\"\": \"\"tests_completed\"\", \"\"lowestValue\"\": 0, \"\"highestValue\"\": 3, \"\"attributes\"\": {\"\"tests_completed\"\": 0}, \"\"place\"\": \"\"exam_room\"\", \"\"simID\"\": \"\"med_cart\"\", \"\"location\"\": {\"\"x\"\": 9, \"\"y\"\":  5}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Run Strep test\"\", \"\"simID\"\": \"\"strep_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\":  5}}\"\r\n            SIM_SMART_REACTION,\"{\"\"label\"\": \"\"tests completed\"\", \"\"simID\"\": \"\"tests_complete_smart_reaction\"\", \"\"triggers\"\": [\"\"strep_test\"\", \"\"flu_test\"\", \"\"cold_test\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 42, \"\"y\"\":  12}, \"\"useQueue\"\": false, \"\"orderMatters\"\": false, \"\"sequentialMatters\"\": false}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Check results\"\", \"\"simID\"\": \"\"check_results\"\", \"\"triggers\"\": [\"\"tests_complete_smart_reaction\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 46, \"\"y\"\":  12}}\"\r\n            SIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 15, \"\"y\"\": 0}}\"\r\n        \"\"\r\n`","basePrompt":"ðŸ“„`You will be given a prompt for a simulation. You must return a csv with the simulation items that you decide should be created based on the content of the prompt. Your csv must have two fields: type and configuration. You must provide location information for each item you wish to create. Place these items with these rules in mind:\r\n    PLACEMENT RULES:\r\n        - place items in ways that make visual sense in a 3d world\r\n        - units are in feet, they should be integers\r\n        - leave space between items\r\n\r\n    OUTPUT FORMAT:\r\n        - Return ONLY the raw CSV. Do not wrap in markdown code fences, backticks, or any other formatting.\r\n        - The first line must be: type,configuration\r\n        - The last line must be: \"\"\r\n        - Do not include any text before or after the CSV.\r\n\r\n    DESIGN RULES (critical â€” these determine whether the simulation actually works at runtime):\r\n        1. STARTING ACTIONS: At least one SIM_ACTION or SIM_PROP_ACTION in the entire simulation MUST have startingAction set to true. Without this, the simulation will have no entry point and the user will see nothing. The starting action should belong to whichever role logically acts first.\r\n        2. TRIGGER CHAINS: Every action/reaction is connected by simID references in trigger arrays. When action A completes, any action/reaction whose triggers array contains A's simID will activate next. You must ensure there are no dead ends â€” every non-starting action must be reachable through a trigger chain from a starting action.\r\n        3. simID VALUES: Every simID must be a unique lowercase_snake_case string. These are used as references throughout the simulation. If two items share the same simID, the simulation will break.\r\n        4. PLACE MATCHING: A SIM_PLACE's simID is converted to a dimension name by removing all non-alphanumeric characters and lowercasing. When a SIM_ROLE references a place, or a SIM_PROP references a place, the place value must be the SIM_PLACE's simID (not its name). For example, if a SIM_PLACE has simID \"exam_room\", roles and props must use place: \"exam_room\".\r\n        5. REACTION TARGETING: A SIM_REACTION's roles array must contain the exact name of the role or prop whose attribute it modifies. This is case-sensitive. For example, to modify a prop named \"Medical Cart\", use roles: [\"Medical Cart\"]. To modify a role named \"Doctor\", use roles: [\"Doctor\"].\r\n        6. PROP REACTIONS: A SIM_PROP_REACTION's props array must contain the simID (not the name) of the prop it watches for clicks/drags. For example, if a prop has simID \"med_cart\", use props: [\"med_cart\"].\r\n        7. PROP ACTION FLOW: SIM_PROP_ACTION is used to guide users to interact with a prop. The typical flow is:\r\n            a. A SIM_PROP_ACTION with a label like \"click on the medical cart\" appears in the user's action menu\r\n            b. Its hideTriggers should reference the SIM_PROP_REACTION that fires when the prop is clicked â€” this hides the instruction once the user clicks the prop\r\n            c. Its completionTriggers should reference actions/reactions that follow from the prop click â€” this marks the prop action as complete\r\n            d. hideTriggers and completionTriggers should almost never be the same\r\n        8. SMART REACTIONS: A SIM_SMART_REACTION acts as an AND gate. It watches for ALL of its triggers to be completed (or queued). Use this when you need multiple actions to be done before proceeding (e.g., \"all machines maintained\" before \"submit report\"). Set useQueue to false and orderMatters/sequentialMatters to false unless the scenario specifically requires ordering.\r\n        9. PLAYERS: Create one SIM_PLAYER for each role. If there are 2 roles, create 2 SIM_PLAYERS.\r\n        10. SINGLE PLACE SIMULATIONS: Most simulations need only one SIM_PLACE. Only create multiple places if the scenario explicitly involves distinct locations with movement between them (use SIM_DOORs to connect them).\r\n\r\n    COMMON MISTAKES TO AVOID:\r\n        - Do not set all startingAction values to false â€” at least one must be true\r\n        - Do not reference a simID in a triggers array that does not exist on any other item\r\n        - Do not use a prop's name where its simID is required (e.g., in SIM_PROP_REACTION props array)\r\n        - Do not use a place's name where its simID is required (e.g., in SIM_ROLE place field)\r\n        - Do not create orphaned SIM_PLACEs with no roles, props, or actions assigned to them\r\n        - Do not create attributes on roles or props that are never affected by any SIM_REACTION â€” every stat must be impacted by at least one reaction\r\n        - Do not forget to create SIM_PLACEs â€” every simulation needs at least one\r\n        - Do not create SIM_PROP_ACTIONs without corresponding SIM_PROP_REACTIONs\r\n        - When a reaction targets a prop, the roles array must use the prop's name, not its simID\r\n\r\n    A trigger_type can be an action, reaction, prop reaction, prop action, or smart reaction.\r\n    Always use a prop action when the user should click on a prop.\r\n\r\n    Your options for simulation items are:\r\n        - SIM_ACTION:\r\n            description: an action for a user to take or complete. These will typically be in action/reaction chains, starting with a \"startingAction\" or a prop reaction (triggered by a user interacting with a prop), this chain is indicated using triggers.\r\n            configuration: {\r\n                label: the text that should appear on the action (keep it brief, less than 10 words)\r\n                simID: a unique id used to determine triggers\r\n                triggers: an array of trigger_types that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this action to be unlocked and able to follow a trigger.\r\n                roles: an array of the names of roles and/or the names of props (case sensitive, do NOT use simIDs) that this action should appear for (example: a 'doctor' role can 'check test results', but a 'patient' role cannot, a 'notepad' prop can be written in).\r\n                startingAction: a true or false value representing whether or not this action is one of the first actions a user sees.\r\n                groups: an array of group ids. If two actions have the same group id only one action in the group can be completed.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_ROLE:\r\n            description: a role that a user can take on (example: doctor, patient).\r\n            configuration: {\r\n                name: the name of the role.\r\n                attributes: a json object of attribute name keys and attribute values.\r\n                numUsers: an integer number representing how many users can occupy this role at one time.\r\n                place: the simID of the sim place that a user should be sent to upon choosing this role.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_REACTION:\r\n            description: an effect that can happen in response to an action, that changes a stat of a chosen role or prop.\r\n            configuration: {\r\n                label: A brief description of the reaction (less than 5 words).\r\n                affectedAttribute: the attribute of a prop or role that should be affected.\r\n                effect: the way that the attribute is affected. This value can be +, -, or =.\r\n                value: The amount that the attribute should be changed by (example 2).\r\n                roles: an array of the names of roles and/or the names of props (case sensitive, do NOT use simIDs) that this reaction should affect (example: a patient role can have it's health attribute reduced).\r\n                simID: a unique id used to determine triggers.\r\n                triggers: an array of trigger_types that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this reaction to be unlocked and able to follow a trigger.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PROP:\r\n            description: a prop in the simulation that is not a player but has stats.\r\n            configuration: {\r\n                name: The name of the prop.\r\n                trackedAttribute: The main attribute that should be visually represented for this prop. This value can be left empty.\r\n                lowestValue: The lowest value allowed for the tracked attribute.\r\n                highestValue: The highest value allowed for the tracked attribute.\r\n                attributes: a json object of attribute name keys and attribute values, make sure the tracked attribute is included.\r\n                place: the simID of the place where this prop should be located.\r\n                simID: a unique id used to determine triggers.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PROP_ACTION:\r\n            description: a type of action, exactly like a sim action, except these are hidden by a prop reaction trigger and completed by the completion of different action, reaction, or prop reaction triggers. The hideTriggers and completionTriggers should almost never be the same. CompletionTriggers are generally the trigger_types that follow the prop reaction that is in the hideTriggers. This is so that the user gets prompted to do this action again to complete all actions.\r\n            configuration: {\r\n                label: the text that should appear on the prop action (keep it brief, less than 10 words, EXAMPLE: \"click on the trash can\")\r\n                simID: a unique id used to determine triggers\r\n                triggers: an array of trigger_types that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this action to be unlocked and able to follow a trigger.\r\n                completionTriggers: an array of trigger_types that should cause this prop action to complete.\r\n                hideTriggers: an array of prop reactions that should cause this prop action to hide.\r\n                roles: an array of the names of roles (case sensitive, do NOT use simIDs) that this action should appear for (example: a 'Doctor' role can 'check test results', but a 'Patient' role cannot).\r\n                startingAction: a true or false value representing whether or not this prop action is one of the first actions a user sees.\r\n                groups: an array of group ids. If two actions have the same group id only one action in the group can be completed.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PLACE:\r\n            description: a location in the simulation that a player can move to and items can be placed in.\r\n            configuration: {\r\n                prompt: A prompt describing the location that should be displayed.\r\n                name: the name of the location (keep it brief, less than 4 words).\r\n                simID: a unique id for sim doors and props to reference.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_DOOR:\r\n            description: a door that can be placed in a sim place that leads to a different sim place.\r\n            configuration: {\r\n                label: the name of the place that this door should lead to.\r\n                destination: the simID of the place that this door should lead to.\r\n                place: the simID of the place where this door should be located.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PROP_REACTION:\r\n            description: a trigger for other actions/reactions that is activated by a physical interaction with a prop. There are two possible types, onClick and onDrag\r\n            configuration: {\r\n                simID: a unique id used to determine triggers.\r\n                reactionType: can be either \"onClick\" or \"onDrag\"\r\n                roles: an array of the names of roles (case sensitive, no NOT use simIDs)  that this reaction should happen for (example: a janitor clicking on a trash can triggers new actions such as taking out the trash to appear).\r\n                props: an array of simIDs of props that this reaction will watch for user reactions. This cannot be an empty array.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PLAYER:\r\n            description: a player slot for a user to occupy, if no sim players are provided, users will not be able to accept a role. There should be the same number of simPlayers as the number of roles in most cases.\r\n            configuration: {\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_SMART_REACTION:\r\n            description: a listener that watches for its triggers to be completed, or added to the queue of available actions, depending on the configuration.\r\n            configuration: {\r\n                label: A brief description of the reaction (less than 5 words).\r\n                simID: a unique id used to determine triggers.\r\n                triggers: an array of trigger_types that this action should listen for, no duplicates.\r\n                triggerFilter: an array of trigger_types that must be completed in order for this reaction to be unlocked and able to follow a trigger.\r\n                useQueue: if true the smart reaction will look in the queue of available actions for its triggers, if false, it will look in the log of completed actions.\r\n                orderMatters: if true the triggers must be in order (example: triggers:[a, b, c], log: [a, b, d, c] would complete this smart action, log: [a, c, b] would not).\r\n                sequentialMatters: if true the triggers must not be interupted by a different action in the queue/log (example: triggers:[a, b, c], log: [a, b, d, c] would not complete this action, log: [a, c, b] would).\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n    EXAMPLE:\r\n        prompt: \"a patient who has the flu and a doctor who must run tests and diagnose them\"\r\n\r\n        response: \"\"csv\r\n            type,configuration\r\n            SIM_PLACE,\"{\"\"prompt\"\": \"\"A hospital lobby with reception desk and seating area\"\", \"\"name\"\": \"\"Hospital Lobby\"\", \"\"simID\"\": \"\"hospital_lobby\"\", \"\"location\"\": {\"\"x\"\": -15, \"\"y\"\": 4}}\"\r\n            SIM_PLACE,\"{\"\"prompt\"\": \"\"A medical examination room with equipment and seating\"\", \"\"name\"\": \"\"Exam Room\"\", \"\"simID\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": -15, \"\"y\"\": 15}}\"\r\n            SIM_DOOR,\"{\"\"label\"\": \"\"Exam Room\"\", \"\"destination\"\": \"\"exam_room\"\", \"\"place\"\": \"\"hospital_lobby\"\", \"\"location\"\": {\"\"x\"\": -5, \"\"y\"\": 10}}\"\r\n            SIM_DOOR,\"{\"\"label\"\": \"\"Hospital Lobby\"\", \"\"destination\"\": \"\"hospital_lobby\"\", \"\"place\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": -5, \"\"y\"\": 20}}\"\r\n            SIM_ROLE,\"{\"\"name\"\": \"\"Doctor\"\", \"\"attributes\"\": {\"\"patients_treated\"\": 0}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"hospital_lobby\"\", \"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 5}}\"\r\n            SIM_ROLE,\"{\"\"name\"\": \"\"Patient\"\", \"\"attributes\"\": {\"\"health\"\": 50, \"\"diagnosed\"\": 0}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"hospital_lobby\"\", \"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 10}}\"\r\n            SIM_PROP,\"{\"\"name\"\": \"\"Medical Cart\"\", \"\"trackedAttribute\"\": \"\"tests_completed\"\", \"\"lowestValue\"\": 0, \"\"highestValue\"\": 3, \"\"attributes\"\": {\"\"tests_completed\"\": 0}, \"\"place\"\": \"\"exam_room\"\", \"\"simID\"\": \"\"med_cart\"\", \"\"location\"\": {\"\"x\"\": 9, \"\"y\"\": 15}}\"\r\n            SIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 15, \"\"y\"\": 5}}\"\r\n            SIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 15, \"\"y\"\": 0}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Greet patient\"\", \"\"simID\"\": \"\"greet\"\", \"\"triggers\"\": [], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": true, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 21, \"\"y\"\": -2}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Describe symptoms\"\", \"\"simID\"\": \"\"symptoms\"\", \"\"triggers\"\": [\"\"greet\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Patient\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 28, \"\"y\"\": -2}}\"\r\n            SIM_PROP_ACTION,\"{\"\"label\"\": \"\"Click on the medical cart\"\", \"\"simID\"\": \"\"click_med_cart_prop_action\"\", \"\"triggers\"\": [\"\"symptoms\"\"], \"\"triggerFilter\"\": [], \"\"hideTriggers\"\": [\"\"click_cart\"\"], \"\"completionTriggers\"\": [\"\"tests_complete_smart_reaction\"\"], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 36, \"\"y\"\": -2}}\"\r\n            SIM_PROP_REACTION,\"{\"\"simID\"\": \"\"click_cart\"\", \"\"reactionType\"\": \"\"onClick\"\", \"\"roles\"\": [\"\"Doctor\"\"], \"\"props\"\": [\"\"med_cart\"\"], \"\"location\"\": {\"\"x\"\": 14, \"\"y\"\": 18}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Run cold test\"\", \"\"simID\"\": \"\"cold_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\": 15}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Run flu test\"\", \"\"simID\"\": \"\"flu_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\": 10}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Run strep test\"\", \"\"simID\"\": \"\"strep_test\"\", \"\"triggers\"\": [\"\"click_cart\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 35, \"\"y\"\": 5}}\"\r\n            SIM_REACTION,\"{\"\"label\"\": \"\"Test completed\"\", \"\"affectedAttribute\"\": \"\"tests_completed\"\", \"\"effect\"\": \"\"+\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Medical Cart\"\"], \"\"simID\"\": \"\"test_number_increase\"\", \"\"triggers\"\": [\"\"cold_test\"\", \"\"flu_test\"\", \"\"strep_test\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 42, \"\"y\"\": 10}}\"\r\n            SIM_SMART_REACTION,\"{\"\"label\"\": \"\"Tests completed\"\", \"\"simID\"\": \"\"tests_complete_smart_reaction\"\", \"\"triggers\"\": [\"\"strep_test\"\", \"\"flu_test\"\", \"\"cold_test\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 48, \"\"y\"\": 10}, \"\"useQueue\"\": false, \"\"orderMatters\"\": false, \"\"sequentialMatters\"\": false}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Check results\"\", \"\"simID\"\": \"\"check_results\"\", \"\"triggers\"\": [\"\"tests_complete_smart_reaction\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 55, \"\"y\"\": 10}}\"\r\n            SIM_ACTION,\"{\"\"label\"\": \"\"Diagnose flu\"\", \"\"simID\"\": \"\"diagnose\"\", \"\"triggers\"\": [\"\"check_results\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 62, \"\"y\"\": 10}}\"\r\n            SIM_REACTION,\"{\"\"label\"\": \"\"Patient diagnosed\"\", \"\"affectedAttribute\"\": \"\"diagnosed\"\", \"\"effect\"\": \"\"=\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Patient\"\"], \"\"simID\"\": \"\"diagnosed_reaction\"\", \"\"triggers\"\": [\"\"diagnose\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 69, \"\"y\"\": 10}}\"\r\n            SIM_REACTION,\"{\"\"label\"\": \"\"Patient treated\"\", \"\"affectedAttribute\"\": \"\"patients_treated\"\", \"\"effect\"\": \"\"+\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Doctor\"\"], \"\"simID\"\": \"\"treated_reaction\"\", \"\"triggers\"\": [\"\"diagnose\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 69, \"\"y\"\": 5}}\"\r\n            SIM_REACTION,\"{\"\"label\"\": \"\"Health restored\"\", \"\"affectedAttribute\"\": \"\"health\"\", \"\"effect\"\": \"\"=\"\", \"\"value\"\": 100, \"\"roles\"\": [\"\"Patient\"\"], \"\"simID\"\": \"\"health_restored\"\", \"\"triggers\"\": [\"\"diagnose\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 69, \"\"y\"\": 15}}\"\r\n        \"\"\r\n`","generatePrompt":"@const prompt = that;\r\ntags.originalPrompt = that;\r\n\r\nif (!prompt) {\r\n    return;\r\n}\r\n\r\nconfigBot.tags.menuPortal = \"simWizardLoading\";\r\nconst loadingBar = ab.links.menu.abCreateMenuBusyIndicator({\r\n    label: \"generating detailed prompt\",\r\n    simWizardLoading: true\r\n});\r\n\r\nconst basePrompt = tags.genPrompt;\r\nconst aiChatMessages: AIChatMessage[] = [];\r\n\r\naiChatMessages.push({\r\n    role: 'system',\r\n    content: [\r\n        { text: basePrompt }\r\n    ]\r\n})\r\n\r\naiChatMessages.push({\r\n    role: 'assistant',\r\n    content: [\r\n        { text: 'hello world'}\r\n    ]\r\n})\r\n\r\naiChatMessages.push({\r\n    role: 'user',\r\n    content: [\r\n        { text: 'prompt: ' + prompt}\r\n    ]\r\n})\r\n\r\nconst aiChatOptions: AIChatOptions = { \r\n    preferredModel: ab.links.personality.tags.abPreferredAIModel\r\n}\r\n\r\ntry {\r\n    const response = await ai.chat(aiChatMessages, aiChatOptions);\r\n    console.log(response);\r\n    if (response) {\r\n        thisBot.generateFromPrompt(response.content);\r\n    }  \r\n} catch (e) {\r\n    os.toast(\"Error generating prompt. Please try again\", 8);\r\n    console.log(\"Error generating prompt. Please try again\", e);\r\n    destroy(loadingBar);\r\n}\r\n\r\nif (loadingBar) {\r\n    destroy(loadingBar);\r\n}","genPrompt":"ðŸ“„`I will give you a one-line idea for a simulation. Expand it into a richly designed simulation prompt.\r\n\r\nInclude:\r\n    - The settings\r\n    \r\n    - Key props/agents and their roles\r\n\r\n    - Actions for props/agents to complete\r\n\r\n    - attributes for said props/agents and how they may be changed by different actions\r\n\r\n    - How different actions/props/agents interact and influence each other\r\n\r\nMake the simulation feel alive and internally coherent. Focus on how everything connects and flows together rather than just listing features.\r\n\r\nRules:\r\n\r\n    - Props cannot move between settings.\r\n\r\n    - Settings cannot affect props/agents/actions.\r\n\r\n    - Timing cannot influence any aspects of the sim.\r\n\r\nRespond quickly, less than 20 seconds. Favor speed over extra detail.`","originalPrompt":"how to train my dog","userPrompt":"# Dog Training Simulation\n\n## Settings\n\n**Living Room** - Indoor space with furniture where basic commands are practiced\n**Backyard** - Outdoor area for physical exercises and play-based training\n**Kitchen** - Food preparation area where treat-based rewards are managed\n\n## Props/Agents\n\n**Dog (Agent)**\n- Attributes: Obedience (0-100), Energy (0-100), Focus (0-100), Trust (0-100), Hunger (0-100)\n- Actions: Sit, Stay, Come, Bark, Jump, Ignore Command, Play, Eat Treat\n\n**Trainer (Agent)**\n- Attributes: Patience (0-100), Consistency (0-100), Authority (0-100), Treat Supply (0-20)\n- Actions: Give Command, Reward with Treat, Use Praise, Correct Behavior, Ignore Behavior, Restock Treats\n\n**Treat Bag (Prop)**\n- Attributes: Treat Count (0-20), Treat Quality (1-5)\n- Affected by: Trainer restocking, Dog receiving treats\n\n**Training Clicker (Prop)**\n- Attributes: Click Clarity (1-10), Association Strength (0-100)\n- Affected by: Frequency of use paired with rewards\n\n## How It Flows Together\n\nWhen the Trainer gives a command, the Dog's response depends on its current Focus, Trust, and Obedience levels. High Energy decreases Focus. High Hunger increases treat motivation but decreases Focus.\n\nIf the Dog obeys, the Trainer can Reward with Treat (depletes Treat Bag, raises Dog's Obedience +5, Trust +3, decreases Hunger -10) or Use Praise (raises Trust +2, Obedience +2). Using the Clicker before rewards increases Association Strength, which multiplies future Obedience gains by 1.5x when Click Clarity is above 7.\n\nIf the Dog ignores commands, Trainer's Patience decreases -5. Low Patience (<30) causes inconsistent corrections that reduce Dog's Trust -8 and confusion lowers Focus -10. High Consistency (>70) amplifies all Obedience gains by 1.3x.\n\nPlay action reduces Dog's Energy -20 but increases Focus +10 and Trust +5. Training when Energy >80 causes frequent failed commands. Treat Quality multiplies Obedience gains (Quality 5 = 2x multiplier).\n\nWhen Treat Supply hits 0, Trainer must Restock Treats (restores 20 treats, costs Patience -10 due to interruption). Authority increases +3 each time Dog successfully completes Stay or Come, making future commands more effective (+1% success per Authority point)."}}}}