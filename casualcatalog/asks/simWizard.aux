{"version":1,"state":{"7e90fa98-20af-4d0f-8fed-51302fe820c6":{"id":"7e90fa98-20af-4d0f-8fed-51302fe820c6","space":"shared","tags":{"system":"sim_toolbox.tools.simWizard","onABArtifactCollectShards":"@const shard: ABArtifactShard = {\r\n    data: {\r\n        label: tags.label,\r\n        dimensionData: {\r\n            dimension: ab.links.remember.tags.abActiveDimension,\r\n            [ab.links.remember.tags.abActiveDimension]: tags[ab.links.remember.tags.abActiveDimension],\r\n            [ab.links.remember.tags.abActiveDimension + 'X']: tags[ab.links.remember.tags.abActiveDimension + 'X'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Y']: tags[ab.links.remember.tags.abActiveDimension + 'Y'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Z']: tags[ab.links.remember.tags.abActiveDimension + 'Z'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationX']: tags[ab.links.remember.tags.abActiveDimension + 'RotationX'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationY']: tags[ab.links.remember.tags.abActiveDimension + 'RotationY'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationZ']: tags[ab.links.remember.tags.abActiveDimension + 'RotationZ'],\r\n        },\r\n        color: tags.color,\r\n        labelFloatingBackgroundColor: tags.labelFloatingBackgroundColor,\r\n        labelColor: tags.labelColor,\r\n        simID: tags.simID\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'simWizard'\r\n        }\r\n    ]\r\n}\r\n\r\nreturn shard;","onABArtifactReconstitute":"@const data = that.data;\r\ntags.label = data.label ?? 'wizard';\r\ntags.color = data.color ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD';\r\ntags.labelFloatingBackgroundColor = data.labelFloatingBackgroundColor ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD'; \r\ntags.labelColor = data.labelColor ?? 'white';\r\ntags.simID = data.simID ?? uuid();\r\n\r\n//Place bot correctly\r\nif (data.dimensionData) {\r\n    for (const tagName in data.dimensionData) {\r\n        tags[tagName] = data.dimensionData[tagName];\r\n    }\r\n}\r\n\r\n//If new action\r\nif (data.eggParameters) {\r\n    const dimension = data.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = data.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = data.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags.dimension = dimension;\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n\r\n    thisBot.onClick();\r\n}\r\n\r\nif (!ab.links.console.masks.open) {\r\n    whisper(ab.links.console, \"showConsole\");\r\n    ab.links.console.masks.open = true;\r\n}","onABStripArtifactInstanceDataFromBotData":"@const { data } = that;\r\n\r\ndelete data.tags.label;\r\ndelete data.tags.labelColor;\r\ndelete data.tags.labelFloatingBackgroundColor;\r\ndelete data.tags.color;\r\ndelete data.tags[data.tags.dimension + \"X\"];\r\ndelete data.tags[data.tags.dimension + \"Y\"];\r\ndelete data.tags[data.tags.dimension + \"Z\"];\r\ndelete data.tags[data.tags.dimension + \"RotationX\"];\r\ndelete data.tags[data.tags.dimension + \"RotationY\"];\r\ndelete data.tags[data.tags.dimension + \"RotationZ\"];\r\ndelete data.tags[data.tags.dimension];\r\ndelete data.tags.dimension;\r\ndelete data.tags.simID;\r\ndelete data.tags.wizardPrompt;","onClick":"@if (that) {\r\n    if (that.modality == 'mouse' && that.buttonId == 'right') {\r\n        return;\r\n    }\r\n}\r\n\r\nshout('abMenuRefresh');\r\nshout(\"clearSimWizardMenu\");\r\n\r\nconfigBot.tags.menuPortal = 'simWizard_menu';\r\n\r\nconst menuOptions = {\r\n    simWizard_menu: true,\r\n    clearSimWizardMenu: `@destroy(thisBot);`,\r\n    abMenuRefresh: \"@ destroy(thisBot);\",\r\n    wizard: getLink(thisBot)\r\n}\r\n\r\nconst promptButton = {\r\n    ...menuOptions,\r\n    label: 'submit prompt',\r\n    simWizard_menuSortOrder: 1,\r\n    formAddress: 'edit',\r\n    onClick: `@\r\n        const response = await os.showInput(links.wizard.tags.wizardPrompt, {\r\n            autoSelect: true,\r\n            title: 'describe this simulation'\r\n        });\r\n        links.wizard.tags.wizardPrompt = response;\r\n        links.wizard.generateFromPrompt(response);\r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nconst csvButton = {\r\n    ...menuOptions,\r\n    label: 'upload csv',\r\n    formAddress: 'upload',\r\n    simWizard_menuSortOrder: 2,\r\n    onClick: `@\r\n        const files = await os.showUploadFiles(); \r\n        if (files) {\r\n            links.wizard.generateFromCSV(files[0]);\r\n        } \r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nconst downloadButton = {\r\n    ...menuOptions,\r\n    label: 'download simulation',\r\n    formAddress: 'download',\r\n    simWizard_menuSortOrder: 3,\r\n    onClick: `@\r\n        links.wizard.downloadSim();\r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nconst cameraButton = {\r\n    ...menuOptions,\r\n    label: 'use camera to generate sim',\r\n    formAddress: 'photo_camera',\r\n    simWizard_menuSortOrder: 4,\r\n    onClick: `@\r\n        links.wizard.generateFromCamera();\r\n        shout(\"clearSimWizardMenu\");\r\n    `\r\n}\r\n\r\nab.links.menu.abCreateMenuButton(promptButton);\r\nab.links.menu.abCreateMenuButton(csvButton);\r\n// ab.links.menu.abCreateMenuButton(downloadButton);\r\nab.links.menu.abCreateMenuButton(cameraButton);\r\n","abIDOrigin":"simWizard","onBotAdded":"@let waitTime = 0;\r\n\r\nwhile(!globalThis.ab?.links.bot_factory) {\r\n    if (waitTime >= 5000) {\r\n        return;\r\n    }\r\n    \r\n    await os.sleep(250);\r\n    waitTime += 250;\r\n}\r\n\r\nmasks.ready = true;","onGridClick":"@shout(\"clearSimWizardMenu\");","strokeColor":"white","cursor":"pointer","scaleZ":"2","onABOpenMenu":"@if (that.menuType != 'abBotMenu' || ab.links.remember.links.abBotFocus != thisBot) {\r\n    return;\r\n}\r\n\r\nconst menuOptions = {\r\n    abMenuRefresh: `@destroy(thisBot);`,\r\n    abMenu: true,\r\n    action: getLink(thisBot)\r\n}\r\n\r\nreturn;","abArtifactName":"simWizard","generateFromPrompt":"@const prompt = that;\r\n\r\nconfigBot.tags.menuPortal = \"simWizardLoading\";\r\nconst loadingBar = ab.links.menu.abCreateMenuBusyIndicator({\r\n    label: \"thinking\",\r\n    simWizardLoading: true\r\n});\r\n\r\nconst basePrompt = `You will be given a prompt for a simulation. You must return a csv with the simulation items that you decide should be created based on the content of the prompt. Your csv must have two fields: type and configuration. You must provide location information for each item you wish to create. Place these items with these rules in mind: \r\n    PLACEMENT RULES: \r\n        - place items in ways that make visual sense in a 3d world\r\n        - units are in feet, they should be integers\r\n        - leave space between items\r\n    \r\n    Your options for simulation items are:\r\n        - SIM_ACTION: \r\n            description: an action for a user to take or complete. These will typically be in action/reaction chains, starting with a \"startingAction\" or a scene reaction (triggered by a user interacting with a prop), this chain is indicated using triggers.\r\n            configuration: {\r\n                label: the text that should appear on the action (keep it brief, less than 10 words)\r\n                simID: a unique id used to determine triggers\r\n                triggers: an array of actions and/or reactions and/or scene reactions and/or directives that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of actions and/or reactions and/or scene reactions and/or directives that must be completed in order for this action to be unlocked and able to follow a trigger.\r\n                roles: an array of the names of roles and/or props that this action should appear for (example: a 'doctor' role can 'check test results', but a 'patient' role cannot, a 'notepad' prop can be written in).  \r\n                startingAction: a true or false value representing whether or not this action is one of the first actions a user sees.\r\n                groups: an array of group ids. If two actions have the same group id only one action in the group can be completed.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_ROLE: \r\n            description: a role that a user can take on (example: doctor, patient).\r\n            configuration: {\r\n                name: the name of the role.\r\n                attributes: a json object of attribute name keys and attribute values.\r\n                numUsers: an integer number representing how many users can occupy this role at one time.\r\n                place: the simID of the sim place that a user should be sent to upon choosing this role.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_REACTION: \r\n            description: an effect that can happen in response to an action, that changes a stat of a chosen role or prop.\r\n            configuration: {\r\n                label: A brief description of the reaction (less than 5 words).\r\n                affectedAttribute: the attribute of a prop or role that should be affected.\r\n                effect: the way that the attribute is affected. This value can be +, -, or =.\r\n                value: The amount that the attribute should be changed by (example 2).\r\n                roles: an array of the names of roles and/or props that this reaction should affect (example: a patient role can have it's health attribute reduced).\r\n                simID: a unique id used to determine triggers.\r\n                triggers: an array of actions and/or reactions and/or scene reactions and/or directives that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of actions and/or reactions and/or scene reactions and/or directives that must be completed in order for this reaction to be unlocked and able to follow a trigger.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PROP:\r\n            description: a prop in the simulation that is not a player but has stats.\r\n            configuration: {\r\n                name: The name of the prop.\r\n                trackedAttribute: The main attribute that should be visually represented for this prop. This value can be left empty.\r\n                lowestValue: The lowest value allowed for the tracked attribute.\r\n                highestValue: The highest value allowed for the tracked attribute.\r\n                attributes: a json object of attribute name keys and attribute values, make sure the tracked attribute is included.\r\n                place: the simID of the place where this prop should be located.\r\n                simID: a unique id used to determine triggers.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_DIRECTIVE: \r\n            description: a typoe of action, exactly like a sim action, except these are completed by a scene reaction, and contain an array of completionTriggers for this purpose.\r\n            configuration: {\r\n                label: the text that should appear on the directive (keep it brief, less than 10 words, EXAMPLE: \"click on the trash can\")\r\n                simID: a unique id used to determine triggers\r\n                triggers: an array of actions and/or reactions and/or scene reactions and/or directives that this action should follow. This can be an empty array.\r\n                triggerFilter: an array of actions and/or reactions and/or scene reactions and/or directives that must be completed in order for this action to be unlocked and able to follow a trigger.\r\n                completionTriggers: an array of scene reactions that should cause this directive to complete.\r\n                roles: an array of the names of roles that this action should appear for (example: a 'doctor' role can 'check test results', but a 'patient' role cannot).  \r\n                startingAction: a true or false value representing whether or not this directive is one of the first actions a user sees.\r\n                groups: an array of group ids. If two actions have the same group id only one action in the group can be completed.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PLACE:\r\n            description: a location in the simulation that a player can move to and items can be placed in.\r\n            configuration: {\r\n                prompt: A prompt describing the location that should be displayed.\r\n                name: the name of the location (keep it brief, less than 4 words).\r\n                simID: a unique id for sim doors to reference.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_DOOR: \r\n            description: a door that can be placed in a sim place that leads to a different sim place.\r\n            configuration: {\r\n                label: the name of the place that this door should lead to.\r\n                destination: the simID of the place that this door should lead to.\r\n                place: the simID of the place where this door should be located.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_SCENE_REACTION: \r\n            description: a trigger for other actions/reactions that is activated by a physical interaction with a prop. There are two possible types, onClick and onDrag\r\n            configuration: {\r\n                simID: a unique id used to determine triggers.\r\n                reactionType: can be either \"onClick\" or \"onDrag\"\r\n                roles: an array of the names of roles that this reaction should happen for (example: a janitor clicking on a trash can triggers new actions such as taking out the trash to appear).\r\n                props: an array of props that this reaction will watch for user reactions. This cannot be an empty array.\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n        - SIM_PLAYER:\r\n            description: a player slot for a user to occupy, if no sim players are provided, users will not be able to accept a role.\r\n            configuration: {\r\n                location: {\r\n                    x: integer,\r\n                    y: integer\r\n                }\r\n            }\r\n\r\n\r\n    EXAMPLE:\r\n        prompt: \"give me a sim with a doctor and patient, with a medical cart prop, used to run tests on the patient. The patient has flu but doesnt know it, the doctor needs to run tests and end up diagnosing the patient.\"\r\n\r\n        response: \"\"csv\r\n        type,configuration\r\n        SIM_PLACE,\"{\"\"prompt\"\": \"\"A modern medical examination room with medical equipment and comfortable seating\"\", \"\"name\"\": \"\"Examination Room\"\", \"\"simID\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": 10, \"\"y\"\": 10}}\"\r\n        SIM_ROLE,\"{\"\"name\"\": \"\"Doctor\"\", \"\"attributes\"\": {\"\"knowledge\"\": 100, \"\"diagnostic_skill\"\": 90}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": 5, \"\"y\"\": 5}}\"\r\n        SIM_ROLE,\"{\"\"name\"\": \"\"Patient\"\", \"\"attributes\"\": {\"\"health\"\": 60, \"\"anxiety\"\": 50, \"\"has_flu\"\": 1, \"\"diagnosed\"\": 0}, \"\"numUsers\"\": 1, \"\"place\"\": \"\"exam_room\"\", \"\"location\"\": {\"\"x\"\": 20, \"\"y\"\": 5}}\"\r\n        SIM_PROP,\"{\"\"name\"\": \"\"Medical Cart\"\", \"\"trackedAttribute\"\": \"\"test_status\"\", \"\"lowestValue\"\": 0, \"\"highestValue\"\": 2, \"\"attributes\"\": {\"\"test_status\"\": 0, \"\"results_available\"\": 0}, \"\"place\"\": \"\"exam_room\"\", \"\"simID\"\": \"\"medical_cart\"\", \"\"location\"\": {\"\"x\"\": 12, \"\"y\"\": 12}}\"\r\n        SIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 0}}\"\r\n        SIM_PLAYER,\"{\"\"location\"\": {\"\"x\"\": 0, \"\"y\"\": 3}}\"\r\n        SIM_DIRECTIVE,\"{\"\"label\"\": \"\"click on the medical cart\"\", \"\"simID\"\": \"\"click_med_cart_directive\"\", \"\"triggers\"\": [\"\"describe_symptoms\"\"], \"\"triggerFilter\"\": [], \"\"completionTriggers\"\": [\"\"interact_medical_cart\"\"], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 5, \"\"y\"\": 8}}\"\r\n        SIM_ACTION,\"{\"\"label\"\": \"\"Greet patient and ask about symptoms\"\", \"\"simID\"\": \"\"greet_patient\"\", \"\"triggers\"\": [], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": true, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 5, \"\"y\"\": 8}}\"\r\n        SIM_ACTION,\"{\"\"label\"\": \"\"Describe feeling unwell\"\", \"\"simID\"\": \"\"describe_symptoms\"\", \"\"triggers\"\": [\"\"greet_patient\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Patient\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 20, \"\"y\"\": 8}}\"\r\n        SIM_ACTION,\"{\"\"label\"\": \"\"Run diagnostic tests\"\", \"\"simID\"\": \"\"run_tests\"\", \"\"triggers\"\": [\"\"interact_medical_cart\"\"], \"\"triggerFilter\"\": [\"\"describe_symptoms\"\"], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 5, \"\"y\"\": 11}}\"\r\n        SIM_ACTION,\"{\"\"label\"\": \"\"Check test results\"\", \"\"simID\"\": \"\"check_results\"\", \"\"triggers\"\": [\"\"tests_completed\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 5, \"\"y\"\": 14}}\"\r\n        SIM_ACTION,\"{\"\"label\"\": \"\"Diagnose patient with flu\"\", \"\"simID\"\": \"\"diagnose_flu\"\", \"\"triggers\"\": [\"\"results_available\"\"], \"\"triggerFilter\"\": [], \"\"roles\"\": [\"\"Doctor\"\"], \"\"startingAction\"\": false, \"\"groups\"\": [], \"\"location\"\": {\"\"x\"\": 5, \"\"y\"\": 17}}\"\r\n        SIM_SCENE_REACTION,\"{\"\"simID\"\": \"\"interact_medical_cart\"\", \"\"reactionType\"\": \"\"onClick\"\", \"\"roles\"\": [\"\"Doctor\"\"], \"\"props\"\": [\"\"medical_cart\"\"], \"\"location\"\": {\"\"x\"\": 15, \"\"y\"\": 12}}\"\r\n        SIM_REACTION,\"{\"\"label\"\": \"\"Tests completed\"\", \"\"affectedAttribute\"\": \"\"test_status\"\", \"\"effect\"\": \"\"=\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"medical_cart\"\"], \"\"simID\"\": \"\"tests_completed\"\", \"\"triggers\"\": [\"\"run_tests\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 8, \"\"y\"\": 11}}\"\r\n        SIM_REACTION,\"{\"\"label\"\": \"\"Results available\"\", \"\"affectedAttribute\"\": \"\"results_available\"\", \"\"effect\"\": \"\"=\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"medical_cart\"\"], \"\"simID\"\": \"\"results_available\"\", \"\"triggers\"\": [\"\"check_results\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 8, \"\"y\"\": 14}}\"\r\n        SIM_REACTION,\"{\"\"label\"\": \"\"Patient diagnosed\"\", \"\"affectedAttribute\"\": \"\"diagnosed\"\", \"\"effect\"\": \"\"=\"\", \"\"value\"\": 1, \"\"roles\"\": [\"\"Patient\"\"], \"\"simID\"\": \"\"patient_diagnosed\"\", \"\"triggers\"\": [\"\"diagnose_flu\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 20, \"\"y\"\": 17}}\"\r\n        SIM_REACTION,\"{\"\"label\"\": \"\"Anxiety reduced\"\", \"\"affectedAttribute\"\": \"\"anxiety\"\", \"\"effect\"\": \"\"-\"\", \"\"value\"\": 30, \"\"roles\"\": [\"\"Patient\"\"], \"\"simID\"\": \"\"anxiety_reduced\"\", \"\"triggers\"\": [\"\"diagnose_flu\"\"], \"\"triggerFilter\"\": [], \"\"location\"\": {\"\"x\"\": 23, \"\"y\"\": 17}}\"\"\"\r\n\"\r\n`\r\nconst aiChatMessages: AIChatMessage[] = [];\r\n\r\naiChatMessages.push({\r\n    role: 'system',\r\n    content: [\r\n        { text: basePrompt }\r\n    ]\r\n})\r\n\r\naiChatMessages.push({\r\n    role: 'system',\r\n    content: [\r\n        { text: 'prompt: ' + prompt}\r\n    ]\r\n})\r\n\r\nconst aiChatOptions: AIChatOptions = { \r\n    preferredModel: ab.links.personality.tags.abPreferredAIModel\r\n}\r\n\r\ntry {\r\n    const response = await ai.chat(aiChatMessages, aiChatOptions);\r\n    console.log(response);\r\n    if (response) {\r\n        thisBot.generateFromCSV(response.content);\r\n    }  \r\n} catch (e) {\r\n    os.toast(\"Error generating sim. Please try again\", e);\r\n    destroy(loadingBar);\r\n}\r\n\r\nif (loadingBar) {\r\n    destroy(loadingBar);\r\n}","generateFromCSV":"@const csvData = that;\r\n\r\nlet cleanedCSV = csvData?.replaceAll('`', '');\r\nif (cleanedCSV.indexOf('csv') == 0) {\r\n    cleanedCSV = cleanedCSV.replace('csv', '');\r\n}\r\n\r\nconst lines = cleanedCSV.split('\\n');\r\nconst result = [];\r\n\r\nfor (let i = 1; i < lines.length; i++) {\r\n    const obj = {};\r\n    const currentline = lines[i].split(',');\r\n\r\n    let simType = currentline[0];\r\n    let config = currentline?.slice(1)?.join(',')?.trim() ?? \"{}\";\r\n    if (config[0] == '\"') {\r\n        config = config.slice(1);\r\n    }\r\n    if (config[config.length - 1] == '\"') {\r\n        config = config.slice(0, -1);\r\n    }\r\n\r\n    if (simType == 'type' || !config) {\r\n        continue;\r\n    }\r\n\r\n    obj['type'] = simType;\r\n    obj['configuration'] = JSON.parse(config.replaceAll('\"\"', '\"'));\r\n\r\n    result.push(obj);\r\n}\r\n\r\nconst jsonString = JSON.stringify(result, null, 2); // Convert the array of objects to a JSON string\r\nconst jsonData = JSON.parse(jsonString);\r\n\r\nlet numPlayers = 1;\r\n\r\nconfigBot.tags.gridPortal = 'blueprint';\r\n\r\nfor (const item of jsonData) {\r\n    if (item[\"type\"]) {\r\n        const xVal = Math.floor(Math.random() * (15 - (-15) + 1)) + (-15);\r\n        const yVal = Math.floor(Math.random() * (15 - (-15) + 1)) + (-15);\r\n        let dimensionName = ab.links.remember.tags.currentDimension ?? 'blueprint';\r\n\r\n        //SIM ROLE\r\n        if (item[\"type\"] == 'SIM_ROLE') {\r\n            const conData = item[\"configuration\"];\r\n            let chosenPlaceName = conData.place.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            chosenPlaceName = chosenPlaceName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.name,\r\n                        simAttributes: conData.attributes,\r\n                        roleLocked: true,\r\n                        roleName: conData.name,\r\n                        numUsers: conData.numUsers,\r\n                        defaultPlace: chosenPlaceName,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simRole'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simRole',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n\r\n        } \r\n        //SIM ACTION\r\n        else if (item[\"type\"] == 'SIM_ACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        roleTags: conData.roles,\r\n                        startingAction: conData.startingAction,\r\n                        groupTags: conData.groups,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simAction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simAction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM DIRECTIVE\r\n        else if (item[\"type\"] == 'SIM_DIRECTIVE') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        roleTags: conData.roles,\r\n                        startingAction: conData.startingAction,\r\n                        groupTags: conData.groups,\r\n                        completionTriggers: conData.completionTriggers,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simDirective'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simDirective',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM REACTION\r\n        else if (item[\"type\"] == 'SIM_REACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        simID: conData.simID,\r\n                        actionTriggers: conData.triggers,\r\n                        actionTriggerFilter: conData.triggerFilter,\r\n                        reactionAttribute: conData.affectedAttribute,\r\n                        reactionEffect: conData.effect,\r\n                        reactionValue: conData.value,\r\n                        roleTags: conData.roles,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simReaction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simReaction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM PLACE\r\n        else if (item[\"type\"] == 'SIM_PLACE') {\r\n            const conData = item[\"configuration\"];\r\n            let chosenDimensionName = conData.simID.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            chosenDimensionName = chosenDimensionName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.name,\r\n                        placePrompt: conData.prompt,\r\n                        simID: conData.simID,\r\n                        chosenDimension: chosenDimensionName,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simPlace'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simPlace',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM DOOR\r\n        else if (item[\"type\"] == 'SIM_DOOR') {\r\n            const conData = item[\"configuration\"];\r\n            dimensionName = conData.place.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            dimensionName = dimensionName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.label,\r\n                        destination: conData.destination,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simDoor'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simDoor',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        } \r\n        //SIM PROP\r\n        else if (item[\"type\"] == 'SIM_PROP') {\r\n            const conData = item[\"configuration\"];\r\n            dimensionName = conData.place?.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            dimensionName = dimensionName.toLowerCase();\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: conData.name,\r\n                        simID: conData.simID,\r\n                        roleName: conData.name,\r\n                        simAttributes: conData.attributes,\r\n                        trackedStat: conData.trackedAttribute,\r\n                        trackedStatStartingValue: conData.lowestValue,\r\n                        trackedStatEndingValue: conData.highestValue,\r\n                        destination: conData.destination,\r\n                        propLocked: true,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simProp'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simProp',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        }\r\n    \r\n        //SIM PLAYER\r\n        else if (item[\"type\"] == 'SIM_PLAYER') {\r\n            const conData = item[\"configuration\"];\r\n            dimensionName = conData.place?.replace(/[^a-zA-Z0-9]/g, '') ?? 'home';\r\n            dimensionName = dimensionName.toLowerCase();\r\n            const playerLabel = 'player ' + numPlayers;\r\n            numPlayers += 1;\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        label: playerLabel,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simPlayer'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simPlayer',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        }\r\n        //SIM SCENE REACTION\r\n        else if (item[\"type\"] == 'SIM_SCENE_REACTION') {\r\n            const conData = item[\"configuration\"];\r\n            const abArtifactShard = {\r\n                data: {\r\n                    config: {\r\n                        simID: conData.simID,\r\n                        label: conData.reactionType,\r\n                        sceneReactionType: conData.reactionType,\r\n                        roleTags: conData.roles,\r\n                        actionTriggers: conData.props,\r\n                        dimensionData: {\r\n                            dimension: dimensionName,\r\n                            [dimensionName]: true,\r\n                            [dimensionName + 'X']: conData.location?.x ?? xVal,\r\n                            [dimensionName + 'Y']: conData.location?.y ?? yVal\r\n                        }\r\n                    }\r\n                },\r\n                dependencies: [\r\n                    {\r\n                        askID: 'simSceneReaction'\r\n                    }\r\n                ]\r\n            };\r\n            ab.links.artifact.abCreateArtifactPromiseBot({\r\n                abArtifactName: 'simSceneReaction',\r\n                abArtifactInstanceID: uuid(),\r\n                abArtifactShard,\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\nif (tags.destroyAfterUse) {\r\n    destroy(thisBot);\r\n}","downloadSim":"@// const simItems = getBots(\"simID\");","labelPosition":"floatingBillboard","labelWordWrapMode":"breakWords","labelSize":"2","labelFontSize":"1","generateFromCamera":"@const photo = await os.capturePhoto();\r\nif (!photo)\r\n{\r\n    return;\r\n}\r\n\r\nconfigBot.tags.menuPortal = \"simWizardLoading\";\r\nconst loadingBar = ab.links.menu.abCreateMenuBusyIndicator({\r\n    label: \"parsing photo\",\r\n    simWizardLoading: true\r\n});\r\n\r\nconst response = await ai.chat({\r\n    role: 'user',\r\n    content: [\r\n        {\r\n            text: `Please generate a detailed \"description\" of what is in the captured image, following these rules:\r\n                a. Do not use any special characters or asteriks.\r\n                b. Make it a clear concise prompt.\r\n                c. keep in mind this prompt is for generating a simulation, so pay attention to people, places, and objects in the space.\r\n            \r\n            Not following the above rules could hurt or break the experience.\r\n            `\r\n        },\r\n        {\r\n            base64: bytes.toBase64String(new Uint8Array(await photo.data.arrayBuffer())),\r\n            mimeType: photo.data.type,\r\n        }\r\n    ]\r\n}, \r\n{\r\n    preferredModel: 'gpt-4o'\r\n});\r\n\r\ndestroy(loadingBar);\r\n\r\nlet promptResponse = response.content;\r\n\r\nconsole.log(\"PROMPT: \"+promptResponse);\r\n\r\nif (promptResponse) {\r\n    thisBot.generateFromPrompt(promptResponse);\r\n} else {\r\n    os.toast(\"Invalid AI response\");\r\n}","destroyAfterUse":"true"}}}}