{"version":1,"state":{"caa9be61-3e88-4b2c-9b82-bda0c2ef768c":{"id":"caa9be61-3e88-4b2c-9b82-bda0c2ef768c","space":"shared","tags":{"creator":"34c3c210-5bf1-49cf-b151-ee2d07f0e673","system":"story_toolbox.storyPlace","storyPlace":"true","onEggHatch":"@if (that.eggParameters) {\r\n    const dimension = that.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = that.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = that.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n}\r\n\r\nif (tags.abIDOrigin == 'storyPlace') {\r\n    shout(\"abMenuRefresh\");\r\n\r\n    thisBot.tags.formAddress = null;\r\n    thisBot.tags.label = 'storyPlace';\r\n    thisBot.tags.artifactInstanceID = null;\r\n\r\n    if (that.eggParameters && that.eggParameters.storyParameters) {\r\n        thisBot.createSkybox({\"prompt\": that.eggParameters.storyParameters.prompt, \"target\": that.eggParameters.storyParameters.target});\r\n    } else {\r\n        thisBot.createSkybox();\r\n    }\r\n}","createSkybox":"@let prompt;\r\nlet target;\r\nif (that && that.prompt && that.target) {\r\n    prompt = that.prompt;\r\n    target = that.target;\r\n} else {\r\n    target = await os.showInput('', {\r\n        title: \"What would you like this place to be named?\"\r\n    })\r\n    prompt = await os.showInput('', {\r\n        title: \"Describe this place\"\r\n    })\r\n}\r\n\r\ntags.label = target;\r\ntags.placePrompt = prompt;\r\n\r\nconfigBot.tags.menuPortal = \"storyPlaceLoading\";\r\nconst loadingBar = ab.links.menu.abCreateMenuBusyIndicator({\r\n    label: \"Generating story place\",\r\n    storyPlaceLoading: true\r\n});\r\n\r\nif (!prompt) {\r\n    return;\r\n}\r\n\r\nconst skyboxImage = await ai.generateSkybox(prompt)  \r\ndestroy(loadingBar); \r\n\r\ntags.formAddress = skyboxImage;\r\nsetTagMask(thisBot, \"activeSkybox\", true, \"shared\");\r\n\r\nconst dimension = configBot.tags.gridPortal;\r\nconst artifactInstanceID = uuid();\r\ntags.artifactInstanceID = artifactInstanceID;\r\n\r\nlinks.artifact.abCreateArtifactPromiseBot({\r\n    abArtifactName: 'msSkyBot',\r\n    abArtifactInstanceID: artifactInstanceID,\r\n    abArtifactShard: {\r\n        data: {\r\n            toolboxBot: tags.toolbox ?? \"\",\r\n            gridInformation: tags.gridInformation,\r\n            skyboxImage: skyboxImage,\r\n            skyboxTags: {\r\n                scale: 450,\r\n                [dimension + \"Z\"]: -100,\r\n                onInstJoined: tags.instJoinedString\r\n            }\r\n        },\r\n        dependencies: [\r\n            { askID: 'msSkyBot' }\r\n        ]\r\n\r\n    }\r\n})\r\n\r\nshout(\"onStorySceneChange\", target);\r\n\r\ngridPortalBot.tags.portalCameraType = \"perspective\";\r\ngridPortalBot.tags.portalPannableMaxX = 30;\r\ngridPortalBot.tags.portalPannableMinX = -30;\r\ngridPortalBot.tags.portalPannableMaxY = 30;\r\ngridPortalBot.tags.portalPannableMinY = -30;\r\ngridPortalBot.tags.portalZoomable = false;","artifact":"ðŸ”—78e41503-c933-4f8a-817a-ba97bf8d5d27","onClick":"@if (tags.formAddress) {\r\n    if (links?.skybox?.tags[configBot.tags.gridPortal] != true) {\r\n       shout(\"onStorySceneChange\", tags.label); \r\n    } \r\n    links?.skybox?.links?.toggle?.onClick();\r\n} else {\r\n    thisBot.createSkybox();\r\n}","home":true,"homeX":-5,"homeY":-6,"homeZ":0,"form":"sphere","onAnyABArtifactReconstituted ":"@// console.log(\"arbys\", that);\r\n// if (that.abArtifactInstanceID == tags.artifactInstanceID) {\r\n//     for (const bot of that.shardBots) {\r\n//         console.log(\"skybox shardBot\", bot, that.shardBots);\r\n//         if (bot.tags.toggle) {\r\n//             tags.skybox = getLink(bot);\r\n//         } else {\r\n//             bot.tags[configBot.tags.gridPortal] = false;\r\n//         }\r\n//     }\r\n// }","abVersion":"10.5","abIDOrigin":"storyPlace","onAnyBotsAdded":"@for (const artifactbot of that.bots) {\r\n    if (artifactbot.tags.abArtifactInstanceID == tags.artifactInstanceID) {\r\n        if (artifactbot.tags.toggle) {\r\n            tags.skybox = getLink(artifactbot);\r\n        } else {\r\n            if (artifactbot != thisBot) {\r\n                setTagMask(artifactbot, configBot.tags.gridPortal, false, \"shared\");\r\n            }\r\n        }\r\n    }\r\n}","skybox":"ðŸ”—6fa16385-e075-4245-83fc-7c300a0b5b38","skyboxToggle":"@if(tags.formAddress == that){\r\n    setTagMask(thisBot, 'activeSkybox', links.skybox.tags.home == false ? true : false, 'shared');\r\n}\r\nelse {\r\n    setTagMask(thisBot, 'activeSkybox', false, 'shared');\r\n}"}}}}