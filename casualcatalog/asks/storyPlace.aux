{"version":1,"state":{"671ae7c1-657e-410e-ae24-489b9a9ad9bb":{"id":"671ae7c1-657e-410e-ae24-489b9a9ad9bb","space":"shared","tags":{"creator":"34c3c210-5bf1-49cf-b151-ee2d07f0e673","system":"story_toolbox.storyPlace","storyPlace":"true","onEggHatch":"@if (that.eggParameters) {\r\n    const dimension = that.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = that.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = that.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n}\r\n\r\nif (tags.abIDOrigin == 'storyPlace') {\r\n    shout(\"abMenuRefresh\");\r\n\r\n    thisBot.tags.formAddress = null;\r\n    thisBot.tags.label = 'storyPlace';\r\n    thisBot.tags.artifactInstanceID = null;\r\n    thisBot.tags.skybox = null;\r\n    thisBot.tags.placePrompt = null;\r\n\r\n    if (that.eggParameters && that.eggParameters.storyParameters) {\r\n        thisBot.createSkybox({\"prompt\": that.eggParameters.storyParameters.prompt, \"target\": that.eggParameters.storyParameters.target});\r\n    } else {\r\n        thisBot.createSkybox();\r\n    }\r\n}","createSkybox":"@let prompt;\r\nlet target;\r\nif (that && that.prompt && that.target) {\r\n    prompt = that.prompt;\r\n    target = that.target;\r\n} else {\r\n    target = await os.showInput('', {\r\n        title: \"What would you like this place to be named?\"\r\n    })\r\n    prompt = await os.showInput('', {\r\n        title: \"Describe this place\"\r\n    })\r\n}\r\n\r\nif (!target || !prompt) {\r\n    os.toast(\"You must provide a name and description.\");\r\n    return;\r\n}\r\n\r\ntags.label = target;\r\ntags.placePrompt = prompt;\r\n\r\nconfigBot.tags.menuPortal = \"storyPlaceLoading\";\r\nconst loadingBar = ab.links.menu.abCreateMenuBusyIndicator({\r\n    label: \"Generating story place\",\r\n    storyPlaceLoading: true\r\n});\r\n\r\nconst skyboxImage = await ai.generateSkybox(prompt)  \r\ndestroy(loadingBar); \r\n\r\ntags.formAddress = skyboxImage;\r\nsetTagMask(thisBot, \"activeSkybox\", true, \"shared\");\r\n\r\nconst dimension = configBot.tags.gridPortal;\r\n\r\nconst skybox = create({\r\n    form: 'skybox',\r\n    formAddress: skyboxImage,\r\n    pointable: false,\r\n    scale: 200,\r\n    [dimension + 'X']: 0,\r\n    [dimension + 'Y']: 0,\r\n    [dimension]: true,\r\n    anchorPoint: 'center',\r\n    [dimension + \"RotationX\"]: 1.5708,\r\n    system: 'story_toolbox.genBots.skybox'\r\n});\r\n\r\ntags.skybox = getLink(skybox);\r\n// const artifactInstanceID = uuid();\r\n// tags.artifactInstanceID = artifactInstanceID;\r\n\r\n// links.artifact.abCreateArtifactPromiseBot({\r\n//     abArtifactName: 'msSkyBot',\r\n//     abArtifactInstanceID: artifactInstanceID,\r\n//     abArtifactShard: {\r\n//         data: {\r\n//             toolboxBot: tags.toolbox ?? \"\",\r\n//             gridInformation: tags.gridInformation,\r\n//             skyboxImage: skyboxImage,\r\n//             skyboxTags: {\r\n//                 scale: 450,\r\n//                 [dimension + \"Z\"]: -100,\r\n//                 onInstJoined: tags.instJoinedString\r\n//             }\r\n//         },\r\n//         dependencies: [\r\n//             { askID: 'msSkyBot' }\r\n//         ]\r\n\r\n//     }\r\n// })\r\n\r\nshout(\"onStorySceneChange\", target);\r\n\r\ngridPortalBot.tags.portalCameraType = \"perspective\";","artifact":"ðŸ”—78e41503-c933-4f8a-817a-ba97bf8d5d27","onClick":"@if (tags.formAddress) {\r\n     shout(\"activateStoryPlaceSkybox\", tags.formAddress);\r\n} else {\r\n    thisBot.createSkybox();\r\n}","home":true,"homeX":6,"homeY":5,"homeZ":0,"form":"sphere","onAnyABArtifactReconstituted ":"@// console.log(\"arbys\", that);\r\n// if (that.abArtifactInstanceID == tags.artifactInstanceID) {\r\n//     for (const bot of that.shardBots) {\r\n//         console.log(\"skybox shardBot\", bot, that.shardBots);\r\n//         if (bot.tags.toggle) {\r\n//             tags.skybox = getLink(bot);\r\n//         } else {\r\n//             bot.tags[configBot.tags.gridPortal] = false;\r\n//         }\r\n//     }\r\n// }","abVersion":"10.6","abIDOrigin":"storyPlace","label":"ice castle","onAnyBotsAdded":"@// for (const bot of that.bots) {\r\n\r\n//     if (bot === thisBot) {\r\n//         continue;\r\n//     }\r\n    \r\n//     if (tags.abArtifactInstanceID && bot.tags.abArtifactInstanceID == tags.artifactInstanceID) {\r\n//         if (bot.tags.toggle) {\r\n//             tags.skybox = getLink(bot);\r\n//         }\r\n//     }\r\n// }","onSkyboxToggleInitialized":"@if (that && that.tags.abArtifactInstanceID && that.tags.abArtifactInstanceID == tags.artifactInstanceID) {\r\n    setTagMask(that, configBot.tags.gridPortal, false, \"shared\");\r\n}","activateStoryPlaceSkybox":"@if (tags.formAddress && that == tags.formAddress) {\r\n    setTagMask(links.skybox, 'home', true);\r\n    setTagMask(thisBot, 'activeSkybox', true, 'shared');\r\n    shout(\"onStorySceneChange\", tags.label); \r\n} else {\r\n    setTagMask(thisBot, 'activeSkybox', false, 'shared');\r\n    setTagMask(links.skybox, 'home', false);\r\n}","placePrompt":"an icy castle on a cliff","formAddress":"https://images.blockadelabs.com/images/imagine/Advanced_no_style_equirectangular-jpg_an_icy_castle_on_9379326567_14234848.jpg?ver=1","skybox":"ðŸ”—0b3c9f23-6355-4e99-a250-97be273229de"}}}}