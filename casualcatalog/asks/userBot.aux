{"version":1,"state":{"2724d100-5871-48cf-ae1a-d076f59466ae":{"id":"2724d100-5871-48cf-ae1a-d076f59466ae","space":"shared","tags":{"system":"social_toolbox.tools.userBot","onABArtifactCollectShards":"@const shard: ABArtifactShard = {\r\n    data: {\r\n        label: tags.bbLabel,\r\n        dimensionData: {\r\n            dimension: ab.links.remember.tags.abActiveDimension,\r\n            [ab.links.remember.tags.abActiveDimension]: tags[ab.links.remember.tags.abActiveDimension],\r\n            [ab.links.remember.tags.abActiveDimension + 'X']: tags[ab.links.remember.tags.abActiveDimension + 'X'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Y']: tags[ab.links.remember.tags.abActiveDimension + 'Y'],\r\n            [ab.links.remember.tags.abActiveDimension + 'Z']: tags[ab.links.remember.tags.abActiveDimension + 'Z'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationX']: tags[ab.links.remember.tags.abActiveDimension + 'RotationX'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationY']: tags[ab.links.remember.tags.abActiveDimension + 'RotationY'],\r\n            [ab.links.remember.tags.abActiveDimension + 'RotationZ']: tags[ab.links.remember.tags.abActiveDimension + 'RotationZ'],\r\n        },\r\n        color: tags.color,\r\n        labelFloatingBackgroundColor: tags.bbLabelFloatingBackgroundColor,\r\n        labelColor: tags.bbLabelColor,\r\n        form: tags.form,\r\n        formSubtype: tags.formSubtype,\r\n        formAddress: tags.formAddress,\r\n        formAddressAspectRatio: tags.formAddressAspectRatio,\r\n        userID: tags.userID,\r\n        pokeNotifsAllowed: tags.pokeNotifsAllowed\r\n    },\r\n    dependencies: [\r\n        {\r\n            askID: 'userBot'\r\n        }\r\n    ]\r\n}\r\n\r\nreturn shard;","onABArtifactReconstitute":"@const data = that.data;\r\ntags.bbLabel = data.label ?? 'user';\r\ntags.color = data.color ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD';\r\ntags.bbLabelFloatingBackgroundColor = data.labelFloatingBackgroundColor ?? abPersonality?.tags?.abBaseColor ?? '#00D9CD'; \r\ntags.bbLabelColor = data.labelColor ?? 'white';\r\ntags.form = data.form ?? null;\r\ntags.formSubtype = data.formSubtype;\r\ntags.formAddress = data.formAddress;\r\ntags.formAddressAspectRatio = data.formAddressAspectRatio;\r\ntags.pokeNotifsAllowed = data.pokeNotifsAllowed ?? false;\r\n\r\n//Place bot correctly\r\nif (data.dimensionData) {\r\n    for (const tagName in data.dimensionData) {\r\n        tags[tagName] = data.dimensionData[tagName];\r\n    }\r\n}\r\n\r\nif (data.userID) {\r\n    tags.userID = data.userID\r\n} else {\r\n    if (!authBot) {\r\n        await os.requestAuthBotInBackground();\r\n    }\r\n\r\n    tags.userID = authBot?.id;\r\n    \r\n    if (authBot.name) {\r\n        tags.bbLabel = authBot.name;\r\n    }\r\n\r\n    thisBot.updateBillboardLabel();\r\n}\r\n\r\n//If new action\r\nif (data.eggParameters) {\r\n    const dimension = data.eggParameters.gridInformation?.dimension ?? 'home';\r\n    const dimensionX = data.eggParameters.gridInformation?.position?.x ?? 0;\r\n    const dimensionY = data.eggParameters.gridInformation?.position?.y ?? 0;\r\n\r\n    tags.dimension = dimension;\r\n    tags[dimension] = true;\r\n    tags[dimension + 'X'] = dimensionX;\r\n    tags[dimension + 'Y'] = dimensionY;\r\n\r\n    thisBot.onClick();\r\n}","onABStripArtifactInstanceDataFromBotData":"@const { data } = that;\r\n\r\ndelete data.tags.bbLabel;\r\ndelete data.tags.bbLabelColor;\r\ndelete data.tags.bbLabelFloatingBackgroundColor;\r\ndelete data.tags.color;\r\ndelete data.tags[data.tags.dimension + \"X\"];\r\ndelete data.tags[data.tags.dimension + \"Y\"];\r\ndelete data.tags[data.tags.dimension + \"Z\"];\r\ndelete data.tags[data.tags.dimension + \"RotationX\"];\r\ndelete data.tags[data.tags.dimension + \"RotationY\"];\r\ndelete data.tags[data.tags.dimension + \"RotationZ\"];\r\ndelete data.tags[data.tags.dimension];\r\ndelete data.tags.dimension;\r\ndelete data.tags.form;\r\ndelete data.tags.formSubtype;\r\ndelete data.tags.formAddress;\r\ndelete data.tags.formAddressAspectRatio;\r\ndelete data.tags.userID;\r\ndelete data.tags.pokeNotifsAllowed;","onClick":"@shout('abMenuRefresh');\r\nshout(\"clearUserBotMenu\");\r\n\r\nif (that) {\r\n    if (that.modality == 'mouse' && that.buttonId == 'right') {\r\n        return;\r\n    }\r\n}\r\n\r\nconfigBot.tags.menuPortal = 'userBot_menu';\r\n\r\nconst menuOptions = {\r\n    userBot_menu: true,\r\n    clearUserBotMenu: `@destroy(thisBot);`,\r\n    abMenuRefresh: \"@ destroy(thisBot);\",\r\n    userBot: getLink(thisBot)\r\n}\r\n\r\nconst pokeButton = {\r\n    ...menuOptions,\r\n    label: 'poke',\r\n    userBot_menuSortOrder: 1,\r\n    onClick: `@\r\n        links.userBot.sendPoke();\r\n        shout(\"clearUserBotMenu\");\r\n    `\r\n}\r\n\r\nconst subscribeButton = {\r\n    ...menuOptions,\r\n    label: 'allow poke notifications: ' + tags.pokeNotifsAllowed,\r\n    userBot_menuSortOrder: 1,\r\n    onClick: `@\r\n        links.userBot.allowPokes();\r\n        shout(\"clearUserBotMenu\");\r\n    `\r\n}\r\n\r\nif (tags.userID == authBot?.id ) {\r\n    if (!tags.pokeNotifsAllowed) {\r\n        ab.links.menu.abCreateMenuButton(subscribeButton);\r\n    }\r\n} else {\r\n    ab.links.menu.abCreateMenuButton(pokeButton);    \r\n}\r\n\r\n","abArtifactName":"userBot","abIDOrigin":"userBot","onBotAdded":"@let waitTime = 0;\r\n\r\nwhile(!globalThis.ab?.links.bot_factory) {\r\n    if (waitTime >= 5000) {\r\n        return;\r\n    }\r\n    \r\n    await os.sleep(250);\r\n    waitTime += 250;\r\n}\r\n\r\nmasks.ready = true;\r\n\r\nthisBot.updateBillboardLabel();","onBotChanged":"@const needUpdateBillboardLabel = that.tags.some(t => t === 'bbLabel' || t === 'bbLabelFloatingBackgroundColor' || t === 'bbLabelColor');\r\n\r\nif (needUpdateBillboardLabel && tags.ready) {\r\n    thisBot.updateBillboardLabel();\r\n}","updateBillboardLabel":"@if (thisBot.vars.billboardLabelBot) {\r\n    destroy(thisBot.vars.billboardLabelBot);\r\n    thisBot.vars.billboardLabelBot = null;\r\n}\r\n\r\nthisBot.vars.billboardLabelBot = ab.links.bot_factory.abCreateBillboardLabel({ \r\n    bot: thisBot, \r\n    label: tags.bbLabel,\r\n    color: tags.bbLabelFloatingBackgroundColor,\r\n    dimension: tags.dimension ?? 'home',\r\n    // botLabelMargin: 0,\r\n    labelColor: tags.bbLabelColor,\r\n    space: 'tempLocal',\r\n})","onGridClick":"@shout(\"clearUserBotMenu\");","cursor":"pointer","simProp":"true","bbLabelFloatingBillboardColor":"#FB9E00","scaleX":"1.5","scaleY":"1","onABOpenMenu":"@if (that.menuType != 'abBotMenu' || ab.links.remember.links.abBotFocus != thisBot) {\r\n    return;\r\n}\r\n\r\nconst menuOptions = {\r\n    abMenuRefresh: `@destroy(thisBot);`,\r\n    abMenu: true,\r\n    prop: getLink(thisBot)\r\n}\r\n\r\nconst propMenuButton = {\r\n    ...menuOptions,\r\n    formAddress: 'lock',\r\n    label: 'unlock',\r\n    onClick: `@\r\n        links.prop.tags.propLocked = false;\r\n        shout('abMenuRefresh');\r\n        shout(\"clearSimPropMenu\");\r\n\r\n        links.prop.onClick();\r\n    `\r\n}\r\n\r\nif (tags.propLocked) {\r\n    ab.links.menu.abCreateMenuButton(propMenuButton); \r\n}","scaleZ":"3","sendPoke":"@await os.sendNotification(tags.userID, 'pokeNotifications', {\r\n    user: authBot?.id,\r\n    name: authBot?.name,\r\n    timestamp: new Date.now()\r\n});","allowPokes":"@const notifications = await os.listNotifications(authBot?.id);\r\nif (notifications.success && notifications.items && !notifications.items.includes(\"pokeNotifications\")) {\r\n    await os.recordNotification(authBot?.id, {\r\n        address: 'pokeNotifications',\r\n        description: 'my poke notifications',\r\n        markers: ['publicRead']\r\n    });\r\n}\r\n\r\nawait os.subscribeToNotification(authBot.id, \"pokeNotifications\");\r\ntags.pokeNotifsAllowed = true;","store":"ðŸ”—76af0491-3919-4984-aa82-22c742f4263f"}}}}